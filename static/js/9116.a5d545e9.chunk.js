"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[9116,7554],{47554:function(e,n,t){t.r(n),t.d(n,{default:function(){return T}});var r=t(33028),s=t(96234),a=t(96902),o=t(91188),i=t(4782),c=t(99836),l=t(97531),d=t(46186),u=t(16644),m=t(50543),f=t(35388),h=t(78566),p=t(29938),v=(0,o.ZL)()((function(e){var n=e.palette,t=n.tertiary,r=n.primary;return{rubberband:{height:"100%",background:t?(0,u.Fq)(t.main,.7):(0,u.Fq)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:t?t.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},sm:{fontSize:10}}})),b=(0,i.observer)((function(e){var n=e.model,t=e.coordX,r=v().classes;return(0,p.jsx)(m.Z,{open:!0,placement:"top",title:n.views.map((function(e){return e.pxToBp(t)})).map((function(e){return(0,p.jsx)(f.Z,{className:r.sm,children:(0,l.stringify)(e)},JSON.stringify(e))})),arrow:!0,children:(0,p.jsx)("div",{className:r.guide,style:{left:t,background:"red"}})})}));var x=(0,i.observer)((function(e){var n=e.model,t=e.ControlComponent,r=void 0===t?(0,p.jsx)("div",{}):t,o=(0,a.useState)(),i=(0,s.Z)(o,2),c=i[0],u=i[1],m=(0,a.useState)(),x=(0,s.Z)(m,2),g=x[0],j=x[1],y=(0,a.useState)(),Z=(0,s.Z)(y,2),w=Z[0],k=Z[1],S=(0,a.useState)(),C=(0,s.Z)(S,2),N=C[0],M=C[1],L=(0,a.useRef)(null),T=(0,a.useRef)(null),A=v().classes,P=void 0!==c&&void 0===w;function E(e){e.preventDefault(),e.stopPropagation();var n=e.clientX-e.target.getBoundingClientRect().left;u(n),j(n)}function I(e){var n=e.target;M(e.clientX-n.getBoundingClientRect().left)}function O(){M(void 0),n.views.forEach((function(e){return e.setOffsets(void 0,void 0)}))}function B(){k(void 0),u(void 0),j(void 0)}(0,a.useEffect)((function(){function e(e){if(L.current&&P){var n=e.clientX-L.current.getBoundingClientRect().left;j(n)}}function t(e){if(void 0!==c&&L.current){var t=e.clientX,r=e.clientY,s=t-L.current.getBoundingClientRect().left;k({offsetX:s,clientX:t,clientY:r}),n.views.forEach((function(e){var n=function(e,n){if(void 0!==c){var t=c,r=e;if(r<t){var s=[r,t];t=s[0],r=s[1]}return{leftOffset:n.pxToBp(t),rightOffset:n.pxToBp(r)}}}(s,e);if(n){var t=n.leftOffset,r=n.rightOffset;e.setOffsets(t,r)}})),M(void 0)}}return P?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[c,P,w,n]),(0,a.useEffect)((function(){!P&&void 0!==g&&void 0!==c&&Math.abs(g-c)<=3&&B()}),[P,g,c]);var F=Boolean(w);if(void 0===c)return(0,p.jsxs)(p.Fragment,{children:[void 0!==N?(0,p.jsx)(b,{model:n,coordX:N}):null,(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:A.rubberbandControl,role:"presentation",ref:L,onMouseDown:E,onMouseOut:O,onMouseMove:I,children:r})]});var D=w?w.offsetX:g||0,R=D<c?D:c,z=Math.abs(D-c),X=n.views,q=X.map((function(e){return e.pxToBp(R)})),H=X.map((function(e){return e.pxToBp(R+z)})),_=X.map((function(e){return Math.ceil(z*e.bpPerPx)}));return(0,p.jsxs)(p.Fragment,{children:[T.current?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.ZP,{className:A.popover,classes:{paper:A.paper},open:!0,anchorEl:T.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:q.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))}),(0,p.jsx)(h.ZP,{className:A.popover,classes:{paper:A.paper},open:!0,anchorEl:T.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:H.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))})]}):null,(0,p.jsx)("div",{ref:T,className:A.rubberband,style:{left:R,width:z},children:(0,p.jsx)(f.Z,{variant:"h6",className:A.rubberbandText,children:_.map((function(e,n){return(0,p.jsx)(f.Z,{children:"".concat(e.toLocaleString("en-US"),"bp")},"".concat(e,"_").concat(n))}))})}),(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:A.rubberbandControl,role:"presentation",ref:L,onMouseDown:E,onMouseOut:O,onMouseMove:I,children:r}),w?(0,p.jsx)(d.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:w.clientX,top:w.clientY},onMenuItemClick:function(e,n){n(),B()},open:F,onClose:B,menuItems:n.rubberBandMenuItems()}):null]})})),g=t(25322),j=t(92777),y=t(38238),Z=t(23642),w=(0,o.ZL)()((function(){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},iconButton:{margin:5},bp:{display:"flex",alignItems:"center",marginLeft:10},searchContainer:{marginLeft:5},searchBox:{display:"flex"}}})),k=(0,i.observer)((function(e){var n=e.model;return(0,p.jsx)(g.Z,{onClick:n.activateTrackSelector,title:"Open track selector",children:(0,p.jsx)(Z.GD,{})})})),S=(0,i.observer)((function(e){var n=e.model,t=w().classes,r=(0,a.useState)(),o=(0,s.Z)(r,2),i=o[0],c=o[1],l=n.views.some((function(e){return!e.hideHeader}));return(0,p.jsxs)("div",{className:t.headerBar,children:[(0,p.jsx)(k,{model:n}),(0,p.jsx)(g.Z,{onClick:function(e){return c(e.currentTarget)},className:t.iconButton,children:(0,p.jsx)(y.Z,{})}),l?null:n.views.map((function(e){return(0,p.jsxs)("div",{className:t.searchBox,children:[(0,p.jsx)("div",{className:t.searchContainer,children:(0,p.jsx)(j.Rj,{model:e,showHelp:!1})}),(0,p.jsx)("div",{className:t.bp,children:(0,p.jsxs)(f.Z,{variant:"body2",color:"textSecondary",className:t.bp,children:[Math.round(e.coarseTotalBp).toLocaleString("en-US")," bp"]})})]},e.id)})),(0,p.jsx)("div",{className:t.spacer}),i?(0,p.jsx)(d.Menu,{anchorEl:i,open:!0,onMenuItemClick:function(e,n){n(),c(void 0)},menuItems:n.headerMenuItems(),onClose:function(){return c(void 0)}}):null]})})),C=(0,o.ZL)()((function(e){return{container:{display:"grid"},overlay:{zIndex:100,gridArea:"1/1"},content:{gridArea:"1/1",position:"relative"},grid:{display:"grid"},relative:{position:"relative"},rubberbandContainer:{position:"relative",overflow:"hidden"},rubberbandDiv:{width:"100%",background:e.palette.action.disabledBackground,height:15,"&:hover":{background:e.palette.action.selected}}}})),N=(0,i.observer)((function(e){var n=e.model,t=C().classes;return(0,p.jsx)(p.Fragment,{children:n.tracks.map((function(e){var r=(0,s.Z)(e.displays,1)[0],a=r.RenderingComponent,o=(0,c.getConf)(e,"trackId");return a?(0,p.jsx)("div",{className:t.overlay,style:{height:n.middleComparativeHeight,overflow:"hidden"},children:(0,p.jsx)(a,{model:r})},o):null}))})})),M=(0,i.observer)((function(e){var n=e.model,t=C().classes,r=n.views,s=(0,l.getEnv)(n).pluginManager.getViewType(r[0].type).ReactComponent;return(0,p.jsxs)("div",{className:t.rubberbandContainer,children:[(0,p.jsx)(S,{model:n}),(0,p.jsx)(x,{model:n,ControlComponent:(0,p.jsx)("div",{className:t.rubberbandDiv})}),(0,p.jsxs)("div",{className:t.container,children:[(0,p.jsx)(s,{model:r[0]}),(0,p.jsx)("div",{className:t.grid,children:(0,p.jsx)(N,{model:n})}),(0,p.jsx)(d.ResizeHandle,{onDrag:function(e){return n.setMiddleComparativeHeight(n.middleComparativeHeight+e)},style:{height:4,background:"#ccc"}}),(0,p.jsx)(s,{model:r[1]})]})]})})),L=(0,i.observer)((function(e){var n=e.model,t=C().classes,r=n.views,s=(0,l.getEnv)(n).pluginManager;return(0,p.jsxs)("div",{className:t.rubberbandContainer,children:[(0,p.jsx)(S,{model:n}),(0,p.jsx)(x,{model:n,ControlComponent:(0,p.jsx)("div",{className:t.rubberbandDiv})}),(0,p.jsx)("div",{className:t.container,children:(0,p.jsxs)("div",{className:t.content,children:[(0,p.jsx)("div",{className:t.relative,children:r.map((function(e){var n=s.getViewType(e.type).ReactComponent;return(0,p.jsx)(n,{model:e},e.id)}))}),(0,p.jsx)(N,{model:n})]})})]})})),T=(0,i.observer)((function(e){return e.model.tracks.some((function(e){return e.displays.some((function(e){return(0,c.getConf)(e,"middle")}))}))?(0,p.jsx)(M,(0,r.Z)({},e)):(0,p.jsx)(L,(0,r.Z)({},e))}))},49116:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var r=t(96902),s=t(4782),a=t(47554),o=t(32723),i=t(34795),c=t(96234),l=t(13655),d=t(2868),u=t(99782),m=t(80367),f=t(12221),h=t(34592),p=t(54417),v=t(6880),b=t(44536),x=t(91188),g=t(97531),j=t(46186),y=t(88315),Z=t.n(y),w=t(35388),k=t(29938);function S(e){var n=e.radioOption,t=e.assembly1,r=e.assembly2,s=e.fileLocation,a=e.bed1Location,o=e.bed2Location;if(".paf"===n)return{type:"PAFAdapter",pafLocation:s,queryAssembly:t,targetAssembly:r};if(".out"===n)return{type:"MashMapAdapter",outLocation:s,queryAssembly:t,targetAssembly:r};if(".delta"===n)return{type:"DeltaAdapter",deltaLocation:s,queryAssembly:t,targetAssembly:r};if(".chain"===n)return{type:"ChainAdapter",chainLocation:s,queryAssembly:t,targetAssembly:r};if(".anchors"===n)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:s,bed1Location:a,bed2Location:o,assemblyNames:[t,r]};if(".anchors.simple"===n)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:s,bed1Location:a,bed2Location:o,assemblyNames:[t,r]};throw new Error("Unknown type")}var C=(0,s.observer)((function(e){e.sessionTrackData;var n=e.assembly1,t=e.assembly2,s=e.setSessionTrackData,a=(0,r.useState)(),o=(0,c.Z)(a,2),i=o[0],l=o[1],d=(0,r.useState)(),h=(0,c.Z)(d,2),b=h[0],x=h[1],g=(0,r.useState)(),y=(0,c.Z)(g,2),C=y[0],N=y[1],M=(0,r.useState)(""),L=(0,c.Z)(M,2),T=L[0],A=L[1],P=(0,r.useState)(),E=(0,c.Z)(P,2),I=E[0],O=E[1],B=function(e){return e?e.uri||e.localPath||e.name:void 0}(C),F=T||(B?Z().extname(function(e){return e.endsWith(".gz")?e.slice(0,e.length-3):e}(B)):"");return(0,r.useEffect)((function(){try{if(C){var e=B?Z().basename(B):"MyTrack",r="".concat(e,"-").concat(Date.now());O(void 0),s({trackId:r,name:e,assemblyNames:[t,n],type:"SyntenyTrack",adapter:S({radioOption:F,assembly1:n,assembly2:t,fileLocation:C,bed1Location:b,bed2Location:i})})}}catch(a){console.error(a),O(a)}}),[B,n,t,b,i,C,F,s]),(0,k.jsxs)(v.Z,{style:{padding:12},children:[I?(0,k.jsx)(j.ErrorMessage,{error:I}):null,(0,k.jsx)(w.Z,{style:{textAlign:"center"},children:"Add a .paf, .out (MashMap), .delta (Mummer), .chain, .anchors or .anchors.simple (MCScan) file to view in the dotplot. These file types can also be gzipped. The first assembly should be the query sequence (e.g. left column of the PAF) and the second assembly should be the target sequence (e.g. right column of the PAF)"}),(0,k.jsx)(u.Z,{value:F,onChange:function(e){return A(e.target.value)},children:(0,k.jsxs)(p.ZP,{container:!0,justifyContent:"center",children:[(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".paf",control:(0,k.jsx)(f.Z,{}),label:".paf"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".out",control:(0,k.jsx)(f.Z,{}),label:".out"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".delta",control:(0,k.jsx)(f.Z,{}),label:".delta"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".chain",control:(0,k.jsx)(f.Z,{}),label:".chain"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".anchors",control:(0,k.jsx)(f.Z,{}),label:".anchors"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".anchors.simple",control:(0,k.jsx)(f.Z,{}),label:".anchors.simple"})})]})}),(0,k.jsx)(p.ZP,{container:!0,justifyContent:"center",children:(0,k.jsx)(p.ZP,{item:!0,children:".anchors"===T||".anchors.simple"===T?(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{style:{margin:20},children:["Open the ",T," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",(0,k.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,k.jsxs)("div",{style:{display:"flex"},children:[(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:".anchors file",description:"",location:C,setLocation:function(e){return N(e)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:"genome 1 .bed (left column of anchors file)",description:"",location:b,setLocation:function(e){return x(e)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:"genome 2 .bed (right column of anchors file)",description:"",location:i,setLocation:function(e){return l(e)}})})]})]}):(0,k.jsx)(j.FileSelector,{name:T?T+" location":"",description:"",location:C,setLocation:function(e){return N(e)}})})})]})})),N=t(68079),M=t(33266),L=t(15996),T=t(16151),A=t(99836);var P=(0,s.observer)((function(e){var n,t=e.model,s=e.assembly1,a=e.assembly2,o=e.setShowTrackId,i=(0,g.getSession)(t),l=i.tracks,d=void 0===l?[]:l,u=i.sessionTracks,m=void 0===u?[]:u,f=[].concat((0,N.Z)(d),(0,N.Z)(m)).filter((function(e){return function(e,n,t){var r=(0,A.readConfObject)(e,"assemblyNames");return r.includes(n)&&r.includes(t)&&e.type.includes("Synteny")}(e,a,s)})),h=(null===(n=f[0])||void 0===n?void 0:n.trackId)||"",p=(0,r.useState)(h),b=(0,c.Z)(p,2),x=b[0],y=b[1];return(0,r.useEffect)((function(){y(h)}),[h]),(0,r.useEffect)((function(){o(x)}),[x,o]),(0,k.jsxs)(v.Z,{style:{padding:12},children:[(0,k.jsx)(w.Z,{paragraph:!0,children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),f.length?(0,k.jsx)(M.Z,{value:x,onChange:function(e){return y(e.target.value)},children:f.map((function(e){return(0,k.jsx)(L.Z,{value:e.trackId,children:(0,T.getTrackName)(e,i)},e.trackId)}))}):(0,k.jsx)(j.ErrorMessage,{error:"No synteny tracks found for ".concat(s,",").concat(a)})]})})),E=(0,x.ZL)()((function(e){return{importFormContainer:{padding:e.spacing(4),margin:"0 auto"},assemblySelector:{width:"75%",margin:"0 auto"}}}));function I(e){var n=e.setSessionTrackData,t=e.setShowTrackId,s=e.sessionTrackData,a=e.assembly1,o=e.assembly2,i=e.model,h=(0,r.useState)("none"),p=(0,c.Z)(h,2),v=p[0],b=p[1];return(0,r.useEffect)((function(){"none"===v&&(n(void 0),t(void 0))}),[v,n,t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.Z,{children:[(0,k.jsx)(d.Z,{id:"group-label",children:"(Optional) Select or add a synteny track"}),(0,k.jsxs)(u.Z,{row:!0,value:v,onChange:function(e){return b(e.target.value)},"aria-labelledby":"group-label",children:[(0,k.jsx)(m.Z,{value:"none",control:(0,k.jsx)(f.Z,{}),label:"None"}),(0,k.jsx)(m.Z,{value:"tracklist",control:(0,k.jsx)(f.Z,{}),label:"Existing track"}),(0,k.jsx)(m.Z,{value:"custom",control:(0,k.jsx)(f.Z,{}),label:"New track"})]})]}),"custom"===v?(0,k.jsx)(C,{setSessionTrackData:n,sessionTrackData:s,assembly2:o,assembly1:a}):null,"tracklist"===v?(0,k.jsx)(P,{model:i,assembly1:a,assembly2:o,setShowTrackId:t}):null]})}var O=(0,s.observer)((function(e){var n=e.model,t=E().classes,s=(0,g.getSession)(n),a=s.assemblyNames,d=(0,r.useState)(a[0]||""),u=(0,c.Z)(d,2),m=u[0],f=u[1],x=(0,r.useState)(a[0]||""),y=(0,c.Z)(x,2),Z=y[0],w=y[1],S=(0,r.useState)(),C=(0,c.Z)(S,2),N=C[0],M=C[1],L=(0,r.useState)(),T=(0,c.Z)(L,2),A=T[0],P=T[1],O=(0,r.useState)(),B=(0,c.Z)(O,2),F=B[0],D=B[1];function R(){return R=(0,i.Z)((0,o.Z)().mark((function e(){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,g.isSessionWithAddTracks)(s)){e.next=3;break}return e.abrupt("return");case 3:return M(void 0),t=s.assemblyManager,r=[Z,m],e.t0=n,e.next=9,Promise.all(r.map(function(){var e=(0,i.Z)((0,o.Z)().mark((function e(n){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.waitForAssembly(n);case 2:if(r=e.sent){e.next=5;break}throw new Error("Assembly ".concat(n," failed to load"));case 5:return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:r.regions});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 9:e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),n.views.forEach((function(e){return e.setWidth(n.width)})),A?(s.addTrackConf(A),n.toggleTrack(A.trackId)):F&&n.showTrack(F),e.next=19;break;case 15:e.prev=15,e.t2=e.catch(0),console.error(e.t2),M(e.t2);case 19:case"end":return e.stop()}}),e,null,[[0,15]])}))),R.apply(this,arguments)}var z=N;return(0,k.jsxs)(h.Z,{className:t.importFormContainer,children:[z?(0,k.jsx)(j.ErrorMessage,{error:z}):null,(0,k.jsx)(p.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",className:t.assemblySelector,children:(0,k.jsxs)(p.ZP,{item:!0,children:[(0,k.jsxs)(v.Z,{style:{padding:12},children:[(0,k.jsx)("p",{style:{textAlign:"center"},children:"Select assemblies for linear synteny view"}),(0,k.jsxs)(p.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(j.AssemblySelector,{selected:Z,onChange:function(e){return w(e)},session:s})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(j.AssemblySelector,{selected:m,onChange:function(e){return f(e)},session:s})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(l.Z,{children:(0,k.jsx)(b.Z,{onClick:function(){return R.apply(this,arguments)},variant:"contained",color:"primary",children:"Launch"})})})]})]}),(0,k.jsx)(I,{setShowTrackId:D,assembly2:m,assembly1:Z,setSessionTrackData:P,sessionTrackData:A,model:n})]})})]})})),B=O,F=(0,s.observer)((function(e){var n=e.model;return n.initialized?(0,k.jsx)(a.default,{model:n}):(0,k.jsx)(B,{model:n})}))}}]);
//# sourceMappingURL=9116.a5d545e9.chunk.js.map