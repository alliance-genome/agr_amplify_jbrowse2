{"version":3,"sources":["../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/components/HierarchicalTrackSelector.js"],"names":["CloseConnectionDialog","lazy","DeleteConnectionDialog","ManageConnectionsDialog","ToggleConnectionsDialog","useStyles","makeStyles","theme","searchBox","marginBottom","spacing","menuIcon","marginRight","fab","position","bottom","right","compactCheckbox","padding","checkboxLabel","backgroundColor","accordionBase","display","accordionCard","cursor","nestingLevelMarker","borderLeft","accordionColor","background","palette","tertiary","_theme$palette$tertia","main","color","_theme$palette$tertia2","contrastText","width","paddingLeft","accordionText","margin","Node","props","data","isOpen","style","setOpen","isLeaf","nestingLevel","checked","id","name","onChange","toggleCollapse","conf","onMoreInfo","drawerPosition","classes","marginLeft","unsupported","endsWith","description","readConfObject","React","className","undefined","Array","fill","map","_","idx","key","left","height","onClick","whiteSpace","Tooltip","title","placement","FormControlLabel","control","Checkbox","disabled","inputProps","label","IconButton","e","target","currentTarget","MoreIcon","Typography","ArrowDropDownIcon","ArrowRightIcon","getNodeData","node","extra","defaultHeight","isOpenByDefault","HierarchicalTree","observer","tree","model","filterText","view","treeRef","useRef","useState","info","setMoreInfo","session","getSession","useMemo","trackId","toggleTrack","pathName","toggleCategory","treeWalker","useCallback","i","children","length","_context","parentMeta","curr","menuItems","getTrackActionMenuItems","_session$getTrackActi","useEffect","current","recomputeTree","refreshNodes","useDefaultHeight","VariableSizeTree","ref","JBrowseMenu","anchorEl","onMenuItemClick","_event","callback","open","Boolean","onClose","AutoSizedHierarchicalTree","offset","jest","AutoSizer","disableWidth","Wrapper","overrideDimensions","HierarchicalTrackSelectorContainer","toolbarHeight","setAnchorEl","handleFabClose","HierarchicalTrackSelector","Fab","event","AddIcon","Menu","MenuItem","widget","addWidget","showWidget","HierarchicalTrackSelectorHeader","setHeaderHeight","setAssemblyIdx","assemblyIdx","connectionAnchorEl","setConnectionAnchorEl","menuAnchorEl","setMenuAnchorEl","modalInfo","setModalInfo","deleteDialogDetails","setDeleteDialogDetails","connectionManagerOpen","setConnectionManagerOpen","connectionToggleOpen","setConnectionToggleOpen","assemblyNames","assemblyName","breakConnection","connectionConf","deletingConnection","result","prepareToBreakConnection","safelyBreakConnection","dereferenceTypeCount","Object","keys","connectionMenuItems","assemblyMenuItems","subMenu","getBoundingClientRect","MenuIcon","PowerOutlinedIcon","TextField","value","setFilterText","fullWidth","InputProps","endAdornment","InputAdornment","clearFilterText","ClearIcon","Suspense","fallback","handleClose","headerHeight","hierarchy"],"mappings":"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","file":"static/js/46.c28e1ce2.chunk.js","sourcesContent":["/* eslint-disable react/prop-types */\nimport React, {\n  Suspense,\n  lazy,\n  useCallback,\n  useMemo,\n  useState,\n  useRef,\n  useEffect,\n} from 'react'\nimport {\n  Checkbox,\n  Fab,\n  FormControlLabel,\n  IconButton,\n  InputAdornment,\n  Menu,\n  MenuItem,\n  TextField,\n  Tooltip,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\n// icons\nimport ClearIcon from '@material-ui/icons/Clear'\nimport AddIcon from '@material-ui/icons/Add'\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown'\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight'\nimport MenuIcon from '@material-ui/icons/Menu'\nimport MoreIcon from '@material-ui/icons/MoreHoriz'\nimport PowerOutlinedIcon from '@material-ui/icons/PowerOutlined'\n\n// other\nimport AutoSizer from 'react-virtualized-auto-sizer'\nimport JBrowseMenu from '@jbrowse/core/ui/Menu'\nimport { getSession } from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { VariableSizeTree } from 'react-vtree'\n\nconst CloseConnectionDialog = lazy(() => import('./CloseConnectionDialog'))\nconst DeleteConnectionDialog = lazy(() => import('./DeleteConnectionDialog'))\nconst ManageConnectionsDialog = lazy(() => import('./ManageConnectionsDialog'))\nconst ToggleConnectionsDialog = lazy(() => import('./ToggleConnectionsDialog'))\n\nconst useStyles = makeStyles(theme => ({\n  searchBox: {\n    marginBottom: theme.spacing(2),\n  },\n  menuIcon: {\n    marginRight: theme.spacing(1),\n    marginBottom: 0,\n  },\n  fab: {\n    position: 'absolute',\n    bottom: theme.spacing(6),\n    right: theme.spacing(6),\n  },\n  compactCheckbox: {\n    padding: 0,\n  },\n\n  checkboxLabel: {\n    marginRight: 0,\n    '&:hover': {\n      backgroundColor: '#eee',\n    },\n  },\n\n  // this accordionBase element's small padding is used to give a margin to\n  // accordionColor it a \"margin\" because the virtualized elements can't really\n  // use margin in a conventional way (it doesn't affect layout)\n  accordionBase: {\n    display: 'flex',\n  },\n\n  accordionCard: {\n    padding: 3,\n    cursor: 'pointer',\n    display: 'flex',\n  },\n\n  nestingLevelMarker: {\n    position: 'absolute',\n    borderLeft: '1.5px solid #555',\n  },\n  // accordionColor set's display:flex so that the child accordionText use\n  // vertically centered text\n  accordionColor: {\n    background: theme.palette.tertiary?.main,\n    color: theme.palette.tertiary?.contrastText,\n    width: '100%',\n    display: 'flex',\n    paddingLeft: 5,\n  },\n\n  // margin:auto 0 to center text vertically\n  accordionText: {\n    margin: 'auto 0',\n  },\n}))\n\n// An individual node in the track selector. Note: manually sets cursor:\n// pointer improves usability for what can be clicked\nconst Node = props => {\n  const { data, isOpen, style, setOpen } = props\n  const {\n    isLeaf,\n    nestingLevel,\n    checked,\n    id,\n    name,\n    onChange,\n    toggleCollapse,\n    conf,\n    onMoreInfo,\n    drawerPosition,\n  } = data\n\n  const classes = useStyles()\n  const width = 10\n  const marginLeft = nestingLevel * width + (isLeaf ? width : 0)\n  const unsupported =\n    name && (name.endsWith('(Unsupported)') || name.endsWith('(Unknown)'))\n  const description = (conf && readConfObject(conf, ['description'])) || ''\n\n  return (\n    <div style={style} className={!isLeaf ? classes.accordionBase : undefined}>\n      {new Array(nestingLevel).fill(0).map((_, idx) => (\n        <div\n          key={`mark-${idx}`}\n          style={{ left: idx * width + 4, height: style.height }}\n          className={classes.nestingLevelMarker}\n        />\n      ))}\n      <div\n        className={!isLeaf ? classes.accordionCard : undefined}\n        onClick={() => {\n          toggleCollapse(id)\n          setOpen(!isOpen)\n        }}\n        style={{\n          marginLeft,\n          whiteSpace: 'nowrap',\n          width: '100%',\n        }}\n      >\n        <div className={!isLeaf ? classes.accordionColor : undefined}>\n          {!isLeaf ? (\n            <div className={classes.accordionText}>\n              <Typography>\n                {isOpen ? <ArrowDropDownIcon /> : <ArrowRightIcon />}\n                {name}\n              </Typography>\n            </div>\n          ) : (\n            <>\n              <Tooltip\n                title={description}\n                placement={drawerPosition === 'left' ? 'right' : 'left'}\n              >\n                <FormControlLabel\n                  className={classes.checkboxLabel}\n                  control={\n                    <Checkbox\n                      className={classes.compactCheckbox}\n                      checked={checked}\n                      onChange={() => onChange(id)}\n                      color=\"primary\"\n                      disabled={unsupported}\n                      inputProps={{\n                        'data-testid': `htsTrackEntry-${id}`,\n                      }}\n                    />\n                  }\n                  label={name}\n                />\n              </Tooltip>\n              <IconButton\n                onClick={e => onMoreInfo({ target: e.currentTarget, id, conf })}\n                color=\"secondary\"\n                data-testid={`htsTrackEntryMenu-${id}`}\n              >\n                <MoreIcon />\n              </IconButton>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nconst getNodeData = (node, nestingLevel, extra) => {\n  const isLeaf = !!node.conf\n  return {\n    data: {\n      defaultHeight: isLeaf ? 22 : 40,\n      isLeaf,\n      isOpenByDefault: true,\n      nestingLevel,\n      ...node,\n      ...extra,\n    },\n    nestingLevel,\n    node,\n  }\n}\n\n// this is the main tree component for the hierarchical track selector in note:\n// in jbrowse-web the toolbar is position=\"sticky\" which means the autosizer\n// includes the height of the toolbar, so we subtract the given offsets\nconst HierarchicalTree = observer(({ height, tree, model }) => {\n  const { filterText, view } = model\n  const treeRef = useRef(null)\n  const [info, setMoreInfo] = useState()\n  const session = getSession(model)\n  const { drawerPosition } = session\n\n  const extra = useMemo(\n    () => ({\n      onChange: trackId => view.toggleTrack(trackId),\n      toggleCollapse: pathName => model.toggleCategory(pathName),\n      onMoreInfo: setMoreInfo,\n      drawerPosition,\n    }),\n    [view, model, drawerPosition],\n  )\n  const treeWalker = useCallback(\n    function* treeWalker() {\n      for (let i = 0; i < tree.children.length; i++) {\n        yield getNodeData(tree.children[i], 0, extra)\n      }\n\n      while (true) {\n        const parentMeta = yield\n\n        for (let i = 0; i < parentMeta.node.children.length; i++) {\n          const curr = parentMeta.node.children[i]\n          yield getNodeData(curr, parentMeta.nestingLevel + 1, extra)\n        }\n      }\n    },\n    [tree, extra],\n  )\n\n  const conf = info?.conf\n  const menuItems = (conf && session.getTrackActionMenuItems?.(conf)) || []\n\n  useEffect(() => {\n    treeRef.current.recomputeTree({\n      refreshNodes: true,\n      useDefaultHeight: true,\n    })\n  }, [tree, filterText])\n  return (\n    <>\n      <VariableSizeTree ref={treeRef} treeWalker={treeWalker} height={height}>\n        {Node}\n      </VariableSizeTree>\n      <JBrowseMenu\n        anchorEl={info?.target}\n        menuItems={menuItems}\n        onMenuItemClick={(_event, callback) => {\n          callback()\n          setMoreInfo(undefined)\n        }}\n        open={Boolean(info)}\n        onClose={() => setMoreInfo(undefined)}\n      />\n    </>\n  )\n})\n\n// Don't use autosizer in jest and instead hardcode a height, otherwise fails\n// jest tests\nconst AutoSizedHierarchicalTree = ({ tree, model, offset }) => {\n  return typeof jest === 'undefined' ? (\n    <AutoSizer disableWidth>\n      {({ height }) => {\n        return (\n          <HierarchicalTree\n            height={height - offset}\n            model={model}\n            tree={tree}\n          />\n        )\n      }}\n    </AutoSizer>\n  ) : (\n    <HierarchicalTree height={9000} model={model} tree={tree} />\n  )\n}\n\nconst Wrapper = ({ overrideDimensions, children }) => {\n  return overrideDimensions ? (\n    <div style={{ ...overrideDimensions }}>{children}</div>\n  ) : (\n    <>{children}</>\n  )\n}\nconst HierarchicalTrackSelectorContainer = observer(\n  ({ model, toolbarHeight, overrideDimensions }) => {\n    const classes = useStyles()\n    const session = getSession(model)\n    const [anchorEl, setAnchorEl] = useState(null)\n\n    function handleFabClose() {\n      setAnchorEl(null)\n    }\n    return (\n      <Wrapper overrideDimensions={overrideDimensions}>\n        <HierarchicalTrackSelector\n          model={model}\n          toolbarHeight={toolbarHeight}\n          overrideDimensions={overrideDimensions}\n        />\n        <Fab\n          color=\"secondary\"\n          className={classes.fab}\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n        >\n          <AddIcon />\n        </Fab>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onClose={() => setAnchorEl(null)}\n        >\n          <MenuItem\n            onClick={() => {\n              handleFabClose()\n              const widget = session.addWidget(\n                'AddConnectionWidget',\n                'addConnectionWidget',\n              )\n              session.showWidget(widget)\n            }}\n          >\n            Add connection\n          </MenuItem>\n          <MenuItem\n            onClick={() => {\n              handleFabClose()\n              const widget = session.addWidget(\n                'AddTrackWidget',\n                'addTrackWidget',\n                {\n                  view: model.view.id,\n                },\n              )\n              session.showWidget(widget)\n            }}\n          >\n            Add track\n          </MenuItem>\n        </Menu>\n      </Wrapper>\n    )\n  },\n)\n\nconst HierarchicalTrackSelectorHeader = observer(\n  ({ model, setHeaderHeight, setAssemblyIdx, assemblyIdx }) => {\n    const classes = useStyles()\n    const session = getSession(model)\n    const [connectionAnchorEl, setConnectionAnchorEl] = useState()\n    const [menuAnchorEl, setMenuAnchorEl] = useState()\n    const [modalInfo, setModalInfo] = useState()\n    const [deleteDialogDetails, setDeleteDialogDetails] = useState()\n    const [connectionManagerOpen, setConnectionManagerOpen] = useState(false)\n    const [connectionToggleOpen, setConnectionToggleOpen] = useState(false)\n    const { assemblyNames } = model\n    const assemblyName = assemblyNames[assemblyIdx]\n\n    function breakConnection(connectionConf, deletingConnection) {\n      const name = readConfObject(connectionConf, 'name')\n      const result = session.prepareToBreakConnection(connectionConf)\n      if (result) {\n        const [safelyBreakConnection, dereferenceTypeCount] = result\n        if (Object.keys(dereferenceTypeCount).length > 0) {\n          setModalInfo({\n            connectionConf,\n            safelyBreakConnection,\n            dereferenceTypeCount,\n            name,\n          })\n        } else {\n          safelyBreakConnection()\n        }\n      }\n      if (deletingConnection) {\n        setDeleteDialogDetails({ name, connectionConf })\n      }\n    }\n\n    const connectionMenuItems = [\n      {\n        label: 'Turn on/off connections...',\n        onClick: () => setConnectionToggleOpen(true),\n      },\n      {\n        label: 'Delete connections...',\n        onClick: () => setConnectionManagerOpen(true),\n      },\n    ]\n    const assemblyMenuItems =\n      assemblyNames.length > 1\n        ? [\n            {\n              label: 'Select assembly...',\n              subMenu: assemblyNames.map((name, idx) => ({\n                label: name,\n                onClick: () => {\n                  setAssemblyIdx(idx)\n                },\n              })),\n            },\n          ]\n        : []\n\n    const menuItems = [\n      {\n        label: 'Add track...',\n        onClick: () => {\n          session.showWidget(\n            session.addWidget('AddTrackWidget', 'addTrackWidget', {\n              view: model.view.id,\n            }),\n          )\n        },\n      },\n\n      ...assemblyMenuItems,\n    ]\n\n    return (\n      <div\n        ref={ref => setHeaderHeight(ref?.getBoundingClientRect().height || 0)}\n        data-testid=\"hierarchical_track_selector\"\n      >\n        <div style={{ display: 'flex' }}>\n          <IconButton\n            className={classes.menuIcon}\n            onClick={event => {\n              setMenuAnchorEl(event.currentTarget)\n            }}\n          >\n            <MenuIcon />\n          </IconButton>\n          <IconButton\n            className={classes.menuIcon}\n            onClick={event => {\n              setConnectionAnchorEl(event.currentTarget)\n            }}\n          >\n            <PowerOutlinedIcon />\n          </IconButton>\n          <TextField\n            className={classes.searchBox}\n            label=\"Filter tracks\"\n            value={model.filterText}\n            onChange={event => model.setFilterText(event.target.value)}\n            fullWidth\n            InputProps={{\n              endAdornment: (\n                <InputAdornment position=\"end\">\n                  <IconButton color=\"secondary\" onClick={model.clearFilterText}>\n                    <ClearIcon />\n                  </IconButton>\n                </InputAdornment>\n              ),\n            }}\n          />\n        </div>\n\n        <JBrowseMenu\n          anchorEl={connectionAnchorEl}\n          open={Boolean(connectionAnchorEl)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setConnectionAnchorEl(undefined)\n          }}\n          onClose={() => {\n            setConnectionAnchorEl(undefined)\n          }}\n          menuItems={[\n            {\n              label: 'Add connection',\n              onClick: () => {\n                session.showWidget(\n                  session.addWidget(\n                    'AddConnectionWidget',\n                    'addConnectionWidget',\n                  ),\n                )\n              },\n            },\n            ...connectionMenuItems,\n          ]}\n        />\n\n        <JBrowseMenu\n          anchorEl={menuAnchorEl}\n          open={Boolean(menuAnchorEl)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setMenuAnchorEl(undefined)\n          }}\n          onClose={() => {\n            setMenuAnchorEl(undefined)\n          }}\n          menuItems={menuItems}\n        />\n\n        <Suspense fallback={<div />}>\n          {modalInfo ? (\n            <CloseConnectionDialog\n              modalInfo={modalInfo}\n              setModalInfo={setModalInfo}\n              session={session}\n            />\n          ) : deleteDialogDetails ? (\n            <DeleteConnectionDialog\n              handleClose={() => {\n                setDeleteDialogDetails(undefined)\n              }}\n              deleteDialogDetails={deleteDialogDetails}\n              session={session}\n            />\n          ) : null}\n          {connectionManagerOpen ? (\n            <ManageConnectionsDialog\n              handleClose={() => setConnectionManagerOpen(false)}\n              breakConnection={breakConnection}\n              session={session}\n            />\n          ) : null}\n          {connectionToggleOpen ? (\n            <ToggleConnectionsDialog\n              handleClose={() => setConnectionToggleOpen(false)}\n              session={session}\n              breakConnection={breakConnection}\n              assemblyName={assemblyName}\n            />\n          ) : null}\n        </Suspense>\n      </div>\n    )\n  },\n)\nconst HierarchicalTrackSelector = observer(({ model, toolbarHeight = 0 }) => {\n  const [assemblyIdx, setAssemblyIdx] = useState(0)\n  const [headerHeight, setHeaderHeight] = useState(0)\n\n  const { assemblyNames } = model\n  const assemblyName = assemblyNames[assemblyIdx]\n  return assemblyName ? (\n    <>\n      <HierarchicalTrackSelectorHeader\n        model={model}\n        setHeaderHeight={setHeaderHeight}\n        setAssemblyIdx={setAssemblyIdx}\n        assemblyIdx={assemblyIdx}\n      />\n      <AutoSizedHierarchicalTree\n        tree={model.hierarchy(assemblyName)}\n        model={model}\n        offset={toolbarHeight + headerHeight}\n      />\n    </>\n  ) : null\n})\n\nexport default HierarchicalTrackSelectorContainer\n"],"sourceRoot":""}