{"version":3,"file":"static/js/2693.c4e8c0ae.chunk.js","mappings":"uSAKMA,EAAW,CAAEC,QAAS,UAEtBC,EAAW,CAAEC,OAAQ,WAKNC,EAAa,WAMhC,WAAoBC,EAAgBC,EAAkBC,IAAc,oBAAhDF,UAAAA,EAAc,KAL1BG,kBAAY,OAEZC,cAAQ,EAIdC,KAAKD,SAAWF,GAAMF,EAAUE,KAChCG,KAAKF,aAAeF,CACtB,CAwEC,OAxEA,2BAED,WACE,MAAM,IAAIK,MAAM,kBAClB,GAAC,4BAED,SAAeC,GAGb,OADeZ,EAASY,IAAQA,GAClBC,aAChB,GAAC,4BAED,SAAeD,GACb,IAAME,EAAIF,EAAIC,cAGd,OADeX,EAASY,IAAMA,CAEhC,GAEA,iBACA,SAAIC,GAAwB,IAAD,OACnBC,EAAON,KAAKL,UAAUY,IAAIP,KAAKQ,eAAeH,IACpD,OAAIC,GAAqB,gBAAbD,EAEHC,EAAKG,KAAI,SAACC,GAAe,OAAK,IAAIhB,EAAcgB,EAAY,EAAK,IAEnEJ,CACT,GAEA,kBAGA,WAAkB,IAAD,OACf,OAAON,KAAKL,UAAUgB,OAAOF,KAAI,SAACL,GAAS,OAAK,EAAKQ,eAAeR,EAAE,GACxE,GAEA,gBAGA,WACE,OAAOJ,KAAKD,QACd,GAEA,oBAGA,WACE,OAAOC,KAAKF,YACd,GAEA,sBAGA,WACE,OAAOE,KAAKO,IAAI,cAClB,GAAC,oBAED,WAAmC,IAAD,OAC1BM,EAAgC,CAAEd,SAAUC,KAAKH,MAavD,OAZAG,KAAKL,UAAUgB,OAAOG,SAAQ,SAACZ,GAC7B,IAAMa,EAAY,EAAKH,eAAeV,GAChCc,EAAQ,EAAKrB,UAAUY,IAAIL,GACf,gBAAda,EACFF,EAAKI,aAAeD,GAAS,IAAIP,KAAI,SAACS,GAEpC,OAAO,IAAIxB,EAAcwB,EAAG,GAAMC,QACpC,IAEAN,EAAKE,GAAaC,CAEtB,IACOH,CACT,KAAC,EAjF+B,GCGbO,EAAa,0CAMhC,WACEC,EACAC,EACAC,GACC,IAAD,mBACA,cAAMF,EAAQC,EAAeC,IATvBC,YAAM,IAENC,oBAAc,EAQpB,IAAMC,EAAW,EAAKC,QAAQ,YACxBC,EAAkB,EAAKD,QAAQ,mBAcnC,OAbF,EAAKF,eAAiBC,EAEtB,EAAKF,OAAS,IAAIK,EAAAA,EAAY,CAC5BC,QAAS,GACTC,YAAaH,EAAgBI,IAC7BC,SAAU,SAACC,GAAW,OACpB,IAAIC,EAAAA,GACFC,OACER,EAAgBS,QACZ,IAAIC,IAAIJ,EAAKN,EAAgBS,SAASE,WACtCL,IAEND,UAAU,IACd,CACJ,CA+CkB,OA7ClB,mCAQA,SAAYO,GAAyC,IAAD,OAAxBC,EAAiB,uDAAG,CAAC,EAC/C,OAAOC,EAAAA,EAAAA,kBAAgB,yCAAU,WAAMC,GAAQ,wFACrCC,EAAWH,EAAXG,OAAM,6BACc,EAAKpB,OAAOqB,YAAYL,EAAQC,IAAK,iFAAhDK,EAAO,SACtBC,EAAAA,EAAAA,kBAAiBH,GACjBD,EAASK,KAAK,EAAKC,YAAYH,IAAS,kTAE1CH,EAASO,WAAU,4EACpB,mDAPsB,GAQzB,GAEA,yBACA,SAAYvD,GACV,OAAO,IAAID,EACTC,OACAwD,EAAU,GAAD,OACNnD,KAAKH,GAAE,YAAIF,EAAUE,MAE5B,GAAC,wEAED,WAAwBN,GAAe,4FAClBS,KAAKwB,OAAO4B,YAAY7D,GAAQ,OAAzC,OAAJ8D,EAAI,4BACAA,GAAQA,EAAKC,OAASD,EAAKC,MAAMC,eAAa,gDACzD,mDALA,IAOD,kEAGA,4GACSvD,KAAKyB,gBAAkB,IAAE,gDACjC,kDALD,IAOA,2BAKA,WAAiB,KAAC,EA3Ec,CAAS+B,EAAAA,uB","sources":["../../../plugins/legacy-jbrowse/src/NCListAdapter/NCListFeature.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/NCListAdapter.ts"],"sourcesContent":["import {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\n\nconst jb2ToJb1 = { refName: 'seq_id' }\n\nconst jb1ToJb2 = { seq_id: 'refName' }\n\n/**\n * wrapper to adapt nclist features to act like jbrowse 2 features\n */\nexport default class NCListFeature implements Feature {\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(private ncFeature: any, parent?: Feature, id?: string) {\n    this.uniqueId = id || ncFeature.id()\n    this.parentHandle = parent\n  }\n\n  set(): void {\n    throw new Error('not implemented')\n  }\n\n  jb2TagToJb1Tag(tag: string): string {\n    // @ts-ignore\n    const mapped = jb2ToJb1[tag] || tag\n    return mapped.toLowerCase()\n  }\n\n  jb1TagToJb2Tag(tag: string): string {\n    const t = tag.toLowerCase()\n    // @ts-ignore\n    const mapped = jb1ToJb2[t] || t\n    return mapped\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(attrName: string): any {\n    const attr = this.ncFeature.get(this.jb2TagToJb1Tag(attrName))\n    if (attr && attrName === 'subfeatures') {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return attr.map((subfeature: any) => new NCListFeature(subfeature, this))\n    }\n    return attr\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[] {\n    return this.ncFeature.tags().map((t: string) => this.jb1TagToJb2Tag(t))\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    const data: SimpleFeatureSerialized = { uniqueId: this.id() }\n    this.ncFeature.tags().forEach((tag: string) => {\n      const mappedTag = this.jb1TagToJb2Tag(tag)\n      const value = this.ncFeature.get(tag)\n      if (mappedTag === 'subfeatures') {\n        data.subfeatures = (value || []).map((f: Feature) => {\n          // note: was new NCListFeature(f, `${this.id()}-${i}`, this).toJSON()\n          return new NCListFeature(f, this).toJSON()\n        })\n      } else {\n        data[mappedTag] = value\n      }\n    })\n    return data\n  }\n}\n","import NCListStore from '@gmod/nclist'\nimport { Region } from '@jbrowse/core/util/types'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { checkAbortSignal } from '@jbrowse/core/util'\nimport { RemoteFile } from 'generic-filehandle'\nimport NCListFeature from './NCListFeature'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\nexport default class NCListAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private nclist: any\n\n  private configRefNames?: string[]\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const refNames = this.getConf('refNames')\n    const rootUrlTemplate = this.getConf('rootUrlTemplate')\n    this.configRefNames = refNames\n\n    this.nclist = new NCListStore({\n      baseUrl: '',\n      urlTemplate: rootUrlTemplate.uri,\n      readFile: (url: string) =>\n        new RemoteFile(\n          String(\n            rootUrlTemplate.baseUri\n              ? new URL(url, rootUrlTemplate.baseUri).toString()\n              : url,\n          ),\n        ).readFile(),\n    })\n  }\n\n  /**\n   * Fetch features for a certain region. Use getFeaturesInRegion() if you also\n   * want to verify that the store has features for the given reference sequence\n   * before fetching.\n   * @param region -\n   * @param opts - [signal] optional signalling object for aborting the fetch\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { signal } = opts\n      for await (const feature of this.nclist.getFeatures(region, opts)) {\n        checkAbortSignal(signal)\n        observer.next(this.wrapFeature(feature))\n      }\n      observer.complete()\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  wrapFeature(ncFeature: any): NCListFeature {\n    return new NCListFeature(\n      ncFeature,\n      undefined,\n      `${this.id}-${ncFeature.id()}`,\n    )\n  }\n\n  async hasDataForRefName(refName: string) {\n    const root = await this.nclist.getDataRoot(refName)\n    return !!(root && root.stats && root.stats.featureCount)\n  }\n\n  /**\n   * NCList is unable to get list of ref names so returns empty\n   */\n  async getRefNames() {\n    return this.configRefNames || []\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources() {}\n}\n"],"names":["jb2ToJb1","refName","jb1ToJb2","seq_id","NCListFeature","ncFeature","parent","id","parentHandle","uniqueId","this","Error","tag","toLowerCase","t","attrName","attr","get","jb2TagToJb1Tag","map","subfeature","tags","jb1TagToJb2Tag","data","forEach","mappedTag","value","subfeatures","f","toJSON","NCListAdapter","config","getSubAdapter","pluginManager","nclist","configRefNames","refNames","getConf","rootUrlTemplate","NCListStore","baseUrl","urlTemplate","uri","readFile","url","RemoteFile","String","baseUri","URL","toString","region","opts","ObservableCreate","observer","signal","getFeatures","feature","checkAbortSignal","next","wrapFeature","complete","undefined","getDataRoot","root","stats","featureCount","BaseFeatureDataAdapter"],"sourceRoot":""}