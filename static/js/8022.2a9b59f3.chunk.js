"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[8022],{78022:function(e,t,n){n.d(t,{pC:function(){return B}});var r=n(32723),a=n(34795),i=n(9249),o=n(87371),s=n(89410),u=n.n(s),c=n(43245),f=n.n(c),l=n(44765),h=n(5482),d=n(42098),p=n(45754),v=n(13820);function b(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw new Error("integer overflow");return e.toNumber()}var m=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n)}((0,n(30364).Z)(Error));function k(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var t=new m("aborted");throw t.code="ERR_ABORTED",t}}function x(e,t){var n=[],r=null;return 0===e.length?e:(e.sort((function(e,t){var n=e.minv.blockPosition-t.minv.blockPosition;return 0!==n?n:e.minv.dataPosition-t.minv.dataPosition})),e.forEach((function(e){var a,i;(!t||e.maxv.compareTo(t)>0)&&(null===r?(n.push(e),r=e):(a=r,(i=e).minv.blockPosition-a.maxv.blockPosition<65e3&&i.maxv.blockPosition-a.minv.blockPosition<5e6?e.maxv.compareTo(r.maxv)>0&&(r.maxv=e.maxv):(n.push(e),r=e)))})),n)}var w=n(96234),g=n(41361),y=n(62821),E=n.n(y),Z=function(){function e(t,n){(0,i.Z)(this,e),this.blockPosition=t,this.dataPosition=n}return(0,o.Z)(e,[{key:"toString",value:function(){return"".concat(this.blockPosition,":").concat(this.dataPosition)}},{key:"compareTo",value:function(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}],[{key:"min",value:function(){for(var e,t=0,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];for(;!e;t+=1)e=r[t];for(;t<r.length;t+=1)e.compareTo(r[t])>0&&(e=r[t]);return e}}]),e}();function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])throw new Error("big-endian virtual file offsets not implemented");return new Z(1099511627776*e[t+7]+4294967296*e[t+6]+16777216*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}var I=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;(0,i.Z)(this,e),this.minv=t,this.maxv=n,this.bin=r,this._fetchedSize=a}return(0,o.Z)(e,[{key:"toUniqueString",value:function(){return"".concat(this.minv,"..").concat(this.maxv," (bin ").concat(this.bin,", fetchedSize ").concat(this.fetchedSize(),")")}},{key:"toString",value:function(){return this.toUniqueString()}},{key:"compareTo",value:function(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}},{key:"fetchedSize",value:function(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}]),e}(),T=n(59740),C=["indices"],L=function(){function e(t){var n=t.filehandle,r=t.renameRefSeqs,a=void 0===r?function(e){return e}:r;(0,i.Z)(this,e),this.filehandle=n,this.renameRefSeq=a}return(0,o.Z)(e,[{key:"getMetadata",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.parse(t);case 3:return n=e.sent,n.indices,a=(0,T.Z)(n,C),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_findFirstData",value:function(e,t){return e?e.compareTo(t)>0?t:e:t}},{key:"parse",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n=this,a=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},this.parseP||(this.parseP=this._parse(t).catch((function(e){throw n.parseP=void 0,e}))),e.abrupt("return",this.parseP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.parse(n);case 3:if(e.t1=t,e.t0=e.sent.indices[e.t1],e.t0){e.next=7;break}e.t0={};case 7:return e.abrupt("return",!!e.t0.binIndex);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function _(e,t){return[[0,0],[1+((e+=1)>>26),1+((t-=1)>>26)],[9+(e>>23),9+(t>>23)],[73+(e>>20),73+(t>>20)],[585+(e>>17),585+(t>>17)],[4681+(e>>14),4681+(t>>14)]]}var N=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"lineCount",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i,o,s=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.parse(n);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",-1);case 6:if(i=a.refNameToId[t],a.indices[i]){e.next=10;break}return e.abrupt("return",-1);case 10:if(!(o=a.indices[i].stats)){e.next=13;break}return e.abrupt("return",o.lineCount);case 13:return e.abrupt("return",-1);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_parse",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,i,o,s,u,c,f,l,h,p,v,b,m,x,w,g,y,E,Z=this,T=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=T.length>0&&void 0!==T[0]?T[0]:{},e.next=3,this.filehandle.readFile(t);case 3:return n=e.sent,e.next=6,(0,d.unzip)(n);case 6:if(a=e.sent,k(t.signal),21578324===a.readUInt32LE(0)){e.next=10;break}throw new Error("Not a TBI file");case 10:if(i=a.readInt32LE(4),o=a.readInt32LE(8),s=65536&o?"zero-based-half-open":"1-based-closed",u={0:"generic",1:"SAM",2:"VCF"}[15&o]){e.next=17;break}throw new Error("invalid Tabix preset format flags ".concat(o));case 17:return c={ref:a.readInt32LE(12),start:a.readInt32LE(16),end:a.readInt32LE(20)},f=a.readInt32LE(24),5,l=37449,h=Math.pow(2,29),p=f?String.fromCharCode(f):null,v=a.readInt32LE(28),b=a.readInt32LE(32),m=this._parseNameBytes(a.slice(36,36+b)),x=m.refNameToId,w=m.refIdToName,g=36+b,E=new Array(i).fill(0).map((function(){var e=a.readInt32LE(g);g+=4;for(var t,n={},r=0;r<e;r+=1){var i=a.readUInt32LE(g);if(g+=4,i>37450)throw new Error("tabix index contains too many bins, please use a CSI index");if(37450===i){var o=a.readInt32LE(g);g+=4,2===o&&(t=Z.parsePseudoBin(a,g)),g+=16*o}else{var s=a.readInt32LE(g);g+=4;for(var u=new Array(s),c=0;c<s;c+=1){var f=S(a,g),l=S(a,g+8);g+=16,y=Z._findFirstData(y,f),u[c]=new I(f,l,i)}n[i]=u}}var h=a.readInt32LE(g);g+=4;for(var d=new Array(h),p=0;p<h;p+=1)d[p]=S(a,g),g+=8,y=Z._findFirstData(y,d[p]);return{binIndex:n,linearIndex:d,stats:t}})),e.abrupt("return",{indices:E,metaChar:p,maxBinNumber:l,maxRefLength:h,skipLines:v,firstDataLine:y,columnNumbers:c,coordinateType:s,format:u,refIdToName:w,refNameToId:x,maxBlockSize:65536});case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parsePseudoBin",value:function(e,t){return{lineCount:b(E().fromBytesLE(e.slice(t+16,t+24),!0))}}},{key:"_parseNameBytes",value:function(e){for(var t=0,n=0,r=[],a={},i=0;i<e.length;i+=1)if(!e[i]){if(n<i){var o=e.toString("utf8",n,i);o=this.renameRefSeq(o),r[t]=o,a[o]=t}n=i+1,t+=1}return{refNameToId:a,refIdToName:r}}},{key:"blocksForRange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a){var i,o,s,u,c,f,l,h,d,p,v,b,m,k,y,E,S,T,C,L,N=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=N.length>3&&void 0!==N[3]?N[3]:{},n<0&&(n=0),e.next=4,this.parse(i);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(s=o.refNameToId[t],u=o.indices[s]){e.next=11;break}return e.abrupt("return",[]);case 11:(u.linearIndex.length?u.linearIndex[n>>14>=u.linearIndex.length?u.linearIndex.length-1:n>>14]:new Z(0,0))||console.warn("querying outside of possible tabix range"),c=_(n,a),f=[],l=(0,g.Z)(c);try{for(l.s();!(h=l.n()).done;)for(d=(0,w.Z)(h.value,2),p=d[0],v=d[1],b=p;b<=v;b++)if(u.binIndex[b])for(m=u.binIndex[b],k=0;k<m.length;++k)f.push(new I(m[k].minv,m[k].maxv,b))}catch(r){l.e(r)}finally{l.f()}for(y=u.linearIndex.length,E=null,S=Math.min(n>>14,y-1),T=Math.min(a>>14,y-1),C=S;C<=T;++C)(L=u.linearIndex[C])&&(!E||L.compareTo(E)<0)&&(E=L);return e.abrupt("return",x(f,E));case 23:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(L),P=n(33028);function A(e,t){return Math.floor(e/Math.pow(2,t))}var R=function(e){(0,p.Z)(n,e);var t=(0,v.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).maxBinNumber=0,r.depth=0,r.minShift=0,r}return(0,o.Z)(n,[{key:"lineCount",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i,o,s=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.parse(n);case 3:if(a=e.sent){e.next=6;break}return e.abrupt("return",-1);case 6:if(i=a.refNameToId[t],a.indices[i]){e.next=10;break}return e.abrupt("return",-1);case 10:if(!(o=a.indices[i].stats)){e.next=13;break}return e.abrupt("return",o.lineCount);case 13:return e.abrupt("return",-1);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("CSI indexes do not support indexcov");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"parseAuxData",value:function(e,t){var n=e.readInt32LE(t),r=65536&n?"zero-based-half-open":"1-based-closed",a={0:"generic",1:"SAM",2:"VCF"}[15&n];if(!a)throw new Error("invalid Tabix preset format flags ".concat(n));var i={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},o=e.readInt32LE(t+16),s=o?String.fromCharCode(o):null,u=e.readInt32LE(t+20),c=e.readInt32LE(t+24),f=this._parseNameBytes(e.slice(t+28,t+28+c));return{refIdToName:f.refIdToName,refNameToId:f.refNameToId,skipLines:u,metaChar:s,columnNumbers:i,format:a,coordinateType:r}}},{key:"_parseNameBytes",value:function(e){for(var t=0,n=0,r=[],a={},i=0;i<e.length;i+=1)if(!e[i]){if(n<i){var o=e.toString("utf8",n,i);o=this.renameRefSeq(o),r[t]=o,a[o]=t}n=i+1,t+=1}return{refNameToId:a,refIdToName:r}}},{key:"_parse",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,i,o,s,u,c,f,l,h=this,p=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},e.t0=d.unzip,e.next=4,this.filehandle.readFile(t);case 4:return e.t1=e.sent,e.next=7,(0,e.t0)(e.t1);case 7:if(21582659!==(n=e.sent).readUInt32LE(0)){e.next=12;break}a=1,e.next=17;break;case 12:if(38359875!==n.readUInt32LE(0)){e.next=16;break}a=2,e.next=17;break;case 16:throw new Error("Not a CSI file");case 17:return this.minShift=n.readInt32LE(4),this.depth=n.readInt32LE(8),this.maxBinNumber=((1<<3*(this.depth+1))-1)/7,i=Math.pow(2,this.minShift+3*this.depth),o=n.readInt32LE(12),s=o&&o>=30?this.parseAuxData(n,16):{refIdToName:[],refNameToId:{},metaChar:null,columnNumbers:{ref:0,start:1,end:2},coordinateType:"zero-based-half-open",format:"generic"},u=n.readInt32LE(16+o),f=16+o+4,l=new Array(u).fill(0).map((function(){var e=n.readInt32LE(f);f+=4;for(var t,r={},a=0;a<e;a+=1){var i=n.readUInt32LE(f);if(i>h.maxBinNumber)t=h.parsePseudoBin(n,f+4),f+=48;else{var o=S(n,f+4);c=h._findFirstData(c,o);var s=n.readInt32LE(f+12);f+=16;for(var u=new Array(s),l=0;l<s;l+=1){var d=S(n,f),p=S(n,f+8);f+=16,u[l]=new I(d,p,i)}r[i]=u}}return{binIndex:r,stats:t}})),e.abrupt("return",(0,P.Z)((0,P.Z)({},s),{},{csi:!0,refCount:u,maxBlockSize:65536,firstDataLine:c,csiVersion:a,indices:l,depth:this.depth,maxBinNumber:this.maxBinNumber,maxRefLength:i}));case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parsePseudoBin",value:function(e,t){return{lineCount:b(E().fromBytesLE(e.slice(t+28,t+36),!0))}}},{key:"blocksForRange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a){var i,o,s,u,c,f,l,h,d,p,v,b,m,k,y=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=y.length>3&&void 0!==y[3]?y[3]:{},n<0&&(n=0),e.next=4,this.parse(i);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(s=o.refNameToId[t],u=o.indices[s]){e.next=11;break}return e.abrupt("return",[]);case 11:c=this.reg2bins(n,a),f=[],l=(0,g.Z)(c);try{for(l.s();!(h=l.n()).done;)for(d=(0,w.Z)(h.value,2),p=d[0],v=d[1],b=p;b<=v;b++)if(u.binIndex[b])for(m=u.binIndex[b],k=0;k<m.length;++k)f.push(new I(m[k].minv,m[k].maxv,b))}catch(r){l.e(r)}finally{l.f()}return e.abrupt("return",x(f,new Z(0,0)));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){(e-=1)<1&&(e=1),t>Math.pow(2,50)&&(t=Math.pow(2,34)),t-=1;for(var n,r=0,a=0,i=this.minShift+3*this.depth,o=[];r<=this.depth;i-=3,a+=(n=3*r,1*Math.pow(2,n)),r+=1){var s=a+A(e,i),u=a+A(t,i);if(u-s+o.length>this.maxBinNumber)throw new Error("query ".concat(e,"-").concat(t," is too large for current binning scheme (shift ").concat(this.minShift,", depth ").concat(this.depth,"), try a smaller query or a coarser index binning scheme"));o.push([s,u])}return o}}]),n}(L),M="undefined"!==typeof TextDecoder?new TextDecoder("utf-8"):void 0;function z(e){return new Promise((function(t){return setTimeout(t,e)}))}var B=function(){function e(t){var n=this,r=t.path,a=t.filehandle,o=t.tbiPath,s=t.tbiFilehandle,c=t.csiPath,l=t.csiFilehandle,d=t.yieldTime,p=void 0===d?500:d,v=t.chunkSizeLimit,b=void 0===v?5e7:v,m=t.renameRefSeqs,k=void 0===m?function(e){return e}:m,x=t.chunkCacheSize,w=void 0===x?5*Math.pow(2,20):x;if((0,i.Z)(this,e),a)this.filehandle=a;else{if(!r)throw new TypeError("must provide either filehandle or path");this.filehandle=new h.S9(r)}if(s)this.index=new N({filehandle:s,renameRefSeqs:k});else if(l)this.index=new R({filehandle:l,renameRefSeqs:k});else if(o)this.index=new N({filehandle:new h.S9(o),renameRefSeqs:k});else if(c)this.index=new R({filehandle:new h.S9(c),renameRefSeqs:k});else{if(!r)throw new TypeError("must provide one of tbiFilehandle, tbiPath, csiFilehandle, or csiPath");this.index=new N({filehandle:new h.S9("".concat(r,".tbi")),renameRefSeqs:k})}this.chunkSizeLimit=b,this.renameRefSeq=k,this.yieldTime=p,this.chunkCache=new(u())({cache:new(f())({maxSize:Math.floor(w/65536)}),fill:function(e,t){return n.readChunk(e,{signal:t})}})}return(0,o.Z)(e,[{key:"getLines",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a,i){var o,s,u,c,f,l,h,d,p,v,b,m,x,w,g,y,E,Z,S,I,T,C,L;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s={},"undefined"!==typeof i){e.next=3;break}throw new TypeError("line callback must be provided");case 3:if("function"===typeof i?u=i:(s=i,u=i.lineCallback),void 0!==t){e.next=6;break}throw new TypeError("must provide a reference sequence name");case 6:if(u){e.next=8;break}throw new TypeError("line callback must be provided");case 8:return e.next=10,this.index.getMetadata(s);case 10:if(c=e.sent,k(o),n||(n=0),a||(a=c.maxRefLength),n<=a){e.next=16;break}throw new TypeError("invalid start and end coordinates. start must be less than or equal to end");case 16:if(n!==a){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,this.index.blocksForRange(t,n,a,s);case 20:f=e.sent,k(o),l=0;case 23:if(!(l<f.length)){e.next=30;break}if(!((h=f[l].fetchedSize())>this.chunkSizeLimit)){e.next=27;break}throw new Error("Too much data. Chunk size ".concat(h.toLocaleString()," bytes exceeds chunkSizeLimit of ").concat(this.chunkSizeLimit.toLocaleString(),"."));case 27:l+=1,e.next=23;break;case 30:d=Date.now(),p=0;case 32:if(!(p<f.length)){e.next=72;break}return v=void 0,b=f[p],e.next=37,this.chunkCache.get(b.toString(),b);case 37:m=e.sent,x=m.buffer,w=m.cpositions,g=m.dpositions,k(o),y=0,E=0;case 44:if(!(y<x.length)){e.next=69;break}if(-1!==(Z=x.indexOf("\n",y))){e.next=48;break}return e.abrupt("break",69);case 48:if(S=x.slice(y,Z),I=(null===M||void 0===M?void 0:M.decode(S))||S.toString(),g){for(;y+b.minv.dataPosition>=g[E++];);E--}if(T=this.checkLine(c,t,n,a,I),C=T.startCoordinate,L=T.overlaps,!(void 0!==v&&void 0!==C&&v>C)){e.next=54;break}throw new Error("Lines not sorted by start coordinate (".concat(v," > ").concat(C,"), this file is not usable with Tabix."));case 54:if(v=C,!L){e.next=59;break}u(I.trim(),256*w[E]+(y-g[E])+b.minv.dataPosition+1),e.next=61;break;case 59:if(!(void 0!==C&&C>=a)){e.next=61;break}return e.abrupt("return");case 61:if(!(this.yieldTime&&d-Date.now()>this.yieldTime)){e.next=66;break}return d=Date.now(),k(o),e.next=66,z(1);case 66:y=Z+1,e.next=44;break;case 69:p+=1,e.next=32;break;case 72:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.abrupt("return",this.index.getMetadata(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeaderBuffer",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,i,o,s,u,c,f,l,h,p=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},e.next=3,this.getMetadata(t);case 3:return n=e.sent,a=n.firstDataLine,i=n.metaChar,o=n.maxBlockSize,k(t.signal),s=((null===a||void 0===a?void 0:a.blockPosition)||0)+o,e.next=11,this._readRegion(0,s,t);case 11:return u=e.sent,k(t.signal),e.prev=13,e.next=16,(0,d.unzip)(u);case 16:u=e.sent,e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),console.error(e.t0),new Error("error decompressing block ".concat(e.t0.code," at 0 (length ").concat(s,") ").concat(e.t0));case 23:if(!i){e.next=36;break}c=-1,f="\n".charCodeAt(0),l=i.charCodeAt(0),h=0;case 28:if(!(h<u.length)){e.next=35;break}if(h!==c+1||u[h]===l){e.next=31;break}return e.abrupt("break",35);case 31:u[h]===f&&(c=h);case 32:h+=1,e.next=28;break;case 35:u=u.slice(0,c+1);case 36:return e.abrupt("return",u);case 37:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.getHeaderBuffer(t);case 3:return n=e.sent,e.abrupt("return",n.toString("utf8"));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getReferenceSequenceNames",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.getMetadata(t);case 3:return n=e.sent,e.abrupt("return",n.refIdToName);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkLine",value:function(e,t,n,r,a){var i=e.columnNumbers,o=e.metaChar,s=e.coordinateType,u=e.format;if(a.charAt(0)===o)return{overlaps:!1};var c=i.ref,f=i.start,l=i.end;c||(c=0),f||(f=0),l||(l=0),"VCF"===u&&(l=8);for(var h=Math.max(c,f,l),d=1,p=0,v="",b=-1/0,m=0;m<a.length+1;m+=1)if("\t"===a[m]||m===a.length){if(d===c){if(this.renameRefSeq(a.slice(p,m))!==t)return{overlaps:!1}}else if(d===f){if(b=parseInt(a.slice(p,m),10),"1-based-closed"===s&&(b-=1),b>=r)return{startCoordinate:b,overlaps:!1};if((0===l||l===f)&&b+1<=n)return{startCoordinate:b,overlaps:!1}}else if("VCF"===u&&4===d)v=a.slice(p,m);else if(d===l){if(("VCF"===u?this._getVcfEnd(b,v,a.slice(p,m)):parseInt(a.slice(p,m),10))<=n)return{overlaps:!1}}if(p=m+1,(d+=1)>h)break}return{startCoordinate:b,overlaps:!0}}},{key:"_getVcfEnd",value:function(e,t,n){var r=e+t.length,a=-1!==n.indexOf("SVTYPE=TRA");if("."===n[0]||a){if(a)return e+1}else for(var i=";",o=0;o<n.length;o+=1){if(";"===i&&"END="===n.slice(o,o+4)){var s=n.indexOf(";",o);-1===s&&(s=n.length),r=parseInt(n.slice(o+4,s),10);break}i=n[o]}return r}},{key:"lineCount",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.abrupt("return",this.index.lineCount(t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_readRegion",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,i,o,s,u,c=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>2&&void 0!==c[2]?c[2]:{},i=l.Buffer.alloc(n),e.next=4,this.filehandle.read(i,0,n,t,a);case 4:return o=e.sent,s=o.bytesRead,u=o.buffer,e.abrupt("return",u.slice(0,s));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readChunk",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},e.next=3,this._readRegion(t.minv.blockPosition,t.fetchedSize(),n);case 3:return a=e.sent,e.prev=4,e.abrupt("return",(0,d.unzipChunkSlice)(a,t));case 8:throw e.prev=8,e.t0=e.catch(4),new Error("error decompressing c ".concat(t.toString()," ").concat(e.t0));case 11:case"end":return e.stop()}}),e,this,[[4,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()},28313:function(e,t,n){var r=n(53100).default,a=n(98870).default,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(28909),s=i(n(32984)),u=i(n(77088)),c=function(){function e(t){var n=t.fill,a=t.cache;if(r(this,e),"function"!==typeof n)throw new TypeError("must pass a fill function");if("object"!==typeof a)throw new TypeError("must pass a cache object");if("function"!==typeof a.get||"function"!==typeof a.set||"function"!==typeof a.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=a,this.fillCallback=n}return a(e,[{key:"evict",value:function(e,t){this.cache.get(e)===t&&this.cache.delete(e)}},{key:"fill",value:function(e,t,n,r){var a=this,i=new s.default,o=new u.default;o.addCallback(r);var c={aborter:i,promise:this.fillCallback(t,i.signal,(function(e){o.callback(e)})),settled:!1,statusReporter:o,get aborted(){return this.aborter.signal.aborted}};c.aborter.addSignal(n),c.aborter.signal.addEventListener("abort",(function(){c.settled||a.evict(e,c)})),c.promise.then((function(){c.settled=!0}),(function(){c.settled=!0,a.evict(e,c)})).catch((function(e){throw console.error(e),e})),this.cache.set(e,c)}},{key:"has",value:function(e){return this.cache.has(e)}},{key:"get",value:function(t,n,r,a){if(!r&&n instanceof o.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");var i=this.cache.get(t);return i?i.aborted&&!i.settled?(this.evict(t,i),this.get(t,n,r,a)):i.settled?i.promise:(i.aborter.addSignal(r),i.statusReporter.addCallback(a),e.checkSinglePromise(i.promise,r)):(this.fill(t,n,r,a),e.checkSinglePromise(this.cache.get(t).promise,r))}},{key:"delete",value:function(e){var t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}},{key:"clear",value:function(){for(var e=this.cache.keys(),t=0,n=e.next();!n.done;n=e.next())this.delete(n.value),t+=1;return t}}],[{key:"isAbortException",value:function(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}},{key:"checkSinglePromise",value:function(e,t){function n(){if(t&&t.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then((function(e){return n(),e}),(function(e){throw n(),e}))}}]),e}();t.default=c},32984:function(e,t,n){var r=n(98870).default,a=n(53100).default;Object.defineProperty(t,"__esModule",{value:!0});var i=n(28909),o=r((function e(){a(this,e)})),s=function(){function e(){a(this,e),this.signals=new Set,this.abortController=new i.AbortController}return r(e,[{key:"addSignal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o;if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(t),t.aborted?this.handleAborted(t):"function"===typeof t.addEventListener&&t.addEventListener("abort",(function(){e.handleAborted(t)}))}},{key:"handleAborted",value:function(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}},{key:"signal",get:function(){return this.abortController.signal}},{key:"abort",value:function(){this.abortController.abort()}}]),e}();t.default=s},77088:function(e,t,n){var r=n(53100).default,a=n(98870).default;Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){r(this,e),this.callbacks=new Set}return a(e,[{key:"addCallback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.callbacks.add(e),e(this.currentMessage)}},{key:"callback",value:function(e){this.currentMessage=e,this.callbacks.forEach((function(t){t(e)}))}}]),e}();t.default=i},28909:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.AbortSignal=t.AbortController=void 0;var r=n(82741),a=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")},i="undefined"===typeof a().AbortController?r.AbortController:a().AbortController;t.AbortController=i;var o="undefined"===typeof a().AbortController?r.AbortSignal:a().AbortSignal;t.AbortSignal=o},89410:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(28313));t.default=a.default}}]);
//# sourceMappingURL=8022.2a9b59f3.chunk.js.map