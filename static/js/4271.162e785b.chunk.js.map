{"version":3,"file":"static/js/4271.162e785b.chunk.js","mappings":"mWAwBMA,GAAYC,EAAAA,EAAAA,KAAAA,EAAa,iBAAO,CACpCC,SAAU,CACRC,OAAQ,GAEX,IAEKC,GAAuBC,EAAAA,EAAAA,WAAS,SAAAC,GAMlC,IALFC,EAAOD,EAAPC,QACAC,EAAKF,EAALE,MAKQC,EAAYT,IAAZS,QACRC,GAAsBC,EAAAA,EAAAA,UAAS,IAAGC,GAAAC,EAAAA,EAAAA,GAAAH,EAAA,GAA3BI,EAAGF,EAAA,GAAEG,EAAMH,EAAA,GAClBI,GAA0BL,EAAAA,EAAAA,YAAmBM,GAAAJ,EAAAA,EAAAA,GAAAG,EAAA,GAAtCE,EAAKD,EAAA,GAAEE,EAAQF,EAAA,GACtBG,GAA8BT,EAAAA,EAAAA,WAAS,GAAKU,GAAAR,EAAAA,EAAAA,GAAAO,EAAA,GAArCE,EAAOD,EAAA,GAAEE,EAAUF,EAAA,GACpBG,GAAUC,EAAAA,EAAAA,YAAWjB,GACnBkB,EAAsBlB,EAAtBkB,kBACFC,EAAwC,IAA7BD,EAAkBE,OAC7BC,EACyB,IAA7BH,EAAkBE,OACdpB,EAAMsB,kBACNtB,EAAMuB,qBAqCZ,OAnCAC,EAAAA,EAAAA,YAAU,WACR,IAAIC,GAAY,EA8BhB,OA5BCC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAC,SAAAC,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAN,EAAAA,EAAAA,KAAAO,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UAAAF,EAAAC,KAAA,GAEOE,EAAAA,EAAAA,uBAAsBtB,GAAS,CAADmB,EAAAE,KAAA,cAC3B,IAAIE,MAAM,0BAAyB,OAIM,OAFjDxB,GAAW,GACLe,GAAOU,EAAAA,EAAAA,aAAYnB,GACnBU,EAAc,IAAIU,IAAIC,OAAOC,SAASC,MAAKT,EAAAE,KAAA,GAC5BQ,EAAAA,EAAAA,GACnBf,EACAd,EAAQ8B,SACRf,EAAYa,MACb,OAJKZ,EAAMG,EAAAY,KAKPtB,KACGQ,EAAS,IAAIe,gBAAgBjB,EAAYkB,SACxCC,IAAI,YAAY,SAADC,OAAWnB,EAAOoB,KAAKC,YAC7CpB,EAAOiB,IAAI,WAAYlB,EAAOsB,UAC9BvB,EAAYkB,OAAShB,EAAOsB,WAC5BhD,EAAOwB,EAAYa,MACnB7B,GAAW,IACZoB,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAqB,GAAArB,EAAA,SAEDxB,EAAQwB,EAAAqB,IAAG,QAEM,OAFNrB,EAAAC,KAAA,GAEXrB,GAAW,GAAMoB,EAAAsB,OAAA,6BAAAtB,EAAAuB,OAAA,GAAA7B,EAAA,wBAxBpBH,GA4BM,WACLD,GAAY,CACd,CACF,GAAG,CAACJ,EAAkBL,KAEpB2C,EAAAA,EAAAA,MAACC,EAAAA,OAAM,CAACC,MAAI,EAAC9D,QAASA,EAAS+D,MAAM,kBAAiBC,SAAA,EACpDJ,EAAAA,EAAAA,MAACK,EAAAA,EAAa,CACZC,MAAO,CAAEC,QAAS,OAAQC,SAAU,SAAUC,IAAK,OAAQL,SAAA,EAE3DM,EAAAA,EAAAA,KAACC,EAAAA,EAAK,CAACC,SAAS,OAAMR,SACnB5C,GACCwC,EAAAA,EAAAA,MAAAa,EAAAA,SAAA,CAAAT,SAAA,EACEM,EAAAA,EAAAA,KAAA,QAAAN,SAAM,mCACNM,EAAAA,EAAAA,KAAA,UACAA,EAAAA,EAAAA,KAAA,QAAAN,SAAM,mEAKR,6CAGJM,EAAAA,EAAAA,KAACI,EAAAA,EAAiB,CAAAV,SAAC,gDAGlBrD,GACC2D,EAAAA,EAAAA,KAACK,EAAAA,aAAY,CAAChE,MAAOA,IACnBI,GACFuD,EAAAA,EAAAA,KAACM,EAAAA,EAAU,CAAAZ,SAAC,6BAEZM,EAAAA,EAAAA,KAACO,EAAAA,EAAS,CACRC,MAAM,MACNC,MAAOxE,EACPyE,WAAY,CAAEC,UAAU,GACxBC,QAAQ,SACRC,WAAS,EACTC,QAAS,SAAAC,GACQA,EAAMC,OACdC,QACT,KAGJjB,EAAAA,EAAAA,KAACI,EAAAA,EAAiB,CAAAV,SAAC,wIAKrBM,EAAAA,EAAAA,KAACkB,EAAAA,EAAa,CAAAxB,UACZM,EAAAA,EAAAA,KAACmB,EAAAA,EAAM,CACLC,UAAWxF,EAAQP,SACnB,cAAY,cACZuF,QAAQ,YACRS,MAAM,UACNC,SAAU7E,EACV8E,WAAWvB,EAAAA,EAAAA,KAACwB,EAAAA,GAAe,IAC3BV,SAAOzD,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAE,SAAAkE,IAAA,OAAAnE,EAAAA,EAAAA,KAAAO,MAAA,SAAA6D,GAAA,cAAAA,EAAA3D,KAAA2D,EAAA1D,MAAA,OACP2D,IAAK1F,GACLU,EAAQiF,OAAO,sBAAuB,WACtClG,IAAS,wBAAAgG,EAAArC,OAAA,GAAAoC,EAAA,KACT/B,SACH,wBAMT,IAEA,W,+HCrIA,IAAMmC,EAAO,eAAApG,GAAA4B,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAG,SAAAC,EAAOsE,EAAc7C,GAAgB,IAAA8C,EAAA,OAAAzE,EAAAA,EAAAA,KAAAO,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACjC,8DAAuB,OAAhC,OAAH+D,EAAGjE,EAAAY,KAAAZ,EAAAkE,OAAA,SACFD,EAAIF,QAAQC,EAAM7C,GAAUC,YAAU,wBAAApB,EAAAuB,OAAA,GAAA7B,EAAA,KAC9C,gBAHYyE,EAAAC,GAAA,OAAAzG,EAAA0G,MAAA,KAAAC,UAAA,KAKPC,EAAO,eAAAC,GAAAjF,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAG,SAAAkE,EAAOK,EAAc7C,GAAgB,IAAA8C,EAAAQ,EAAAC,EAAA,OAAAlF,EAAAA,EAAAA,KAAAO,MAAA,SAAA6D,GAAA,cAAAA,EAAA3D,KAAA2D,EAAA1D,MAAA,cAAA0D,EAAA1D,KAAA,EACjC,8DAAuB,OAAhC,OAAH+D,EAAGL,EAAAhD,KAAAgD,EAAA1D,KAAA,EACU,qCAA4B,OACN,OADnCuE,EAAIb,EAAAhD,KACJ8D,EAAQT,EAAIM,QAAQP,EAAM7C,GAASyC,EAAAM,OAAA,SAClCQ,EAAMtD,SAASqD,IAAK,wBAAAb,EAAArC,OAAA,GAAAoC,EAAA,KAC5B,gBALYgB,EAAAC,GAAA,OAAAJ,EAAAH,MAAA,KAAAC,UAAA,KAOb,SAASO,EAAYC,GACnB,IAEE,OADYC,KAAKC,MAAMF,GACZG,OACb,CAAE,MAAOC,GACP,OAAOJ,CACT,CACF,CAEO,SAAepE,EAAoByE,EAAAC,EAAAC,GAAA,OAAAC,EAAAjB,MAAC,KAADC,UAAA,CA8BzC,SAAAgB,IAAA,OAAAA,GAAA/F,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MA9BM,SAAA8F,EACL1G,EACAV,EACAqH,GAAe,IAAAC,EAAAtE,EAAAuE,EAAAC,EAAAC,EAAAd,EAAA7D,EAAA,OAAAzB,EAAAA,EAAAA,KAAAO,MAAA,SAAA8F,GAAA,cAAAA,EAAA5F,KAAA4F,EAAA3F,MAAA,cAAA2F,EAAA3F,KAAA,GAEI4F,EAAAA,EAAAA,IAAaf,KAAKgB,UAAUlH,IAAS,OACzB,OADzB4G,EAAII,EAAAjF,KArCS3B,EAsCU,EAAvBkC,EArCCZ,OACJyF,MACCC,EAAAA,EAAAA,GAAI1F,OAAO2F,OAAOC,gBAAgB,IAAIC,WAAoB,EAATnH,KAC9CoH,KAAI,SAAAC,GAAC,OAAIC,OAAOC,aAAaF,EAAE,IAC/BG,KAAK,KAETC,WAAW,QAAS,IACpBC,MAAM,EAAG1H,GA8BmB4G,EAAA3F,KAAA,EACA6D,EAAQ0B,EAAMtE,GAAS,OAKvB,OALzBuE,EAAgBG,EAAAjF,MAEhB+E,EAAO,IAAIiB,UACZC,OAAO,UAAWnB,GACvBC,EAAKkB,OAAO,aAAa,GAAD7F,OAAK8F,KAAKC,QAClCpB,EAAKkB,OAAO,UAAWrB,GAAQK,EAAA3F,KAAA,GAER8G,MAAM,GAADhG,OAAI7C,EAAG,SAAS,CAC1C8I,OAAQ,OACRC,KAAM,OACNC,KAAMxB,IACN,QAJY,IAARC,EAAQC,EAAAjF,MAMAwG,GAAG,CAADvB,EAAA3F,KAAA,gBAAA2F,EAAA3F,KAAA,GACI0F,EAAS5B,OAAM,QAAxB,MAAHc,EAAGe,EAAAjF,KACH,IAAIR,MAAMyE,EAAYC,IAAK,eAAAe,EAAA3F,KAAA,GAEhB0F,EAAS3E,OAAM,QAAxB,OAAJA,EAAI4E,EAAAjF,KAAAiF,EAAA3B,OAAA,SACH,CACLjD,KAAAA,EACAyE,iBAAAA,EACAvE,SAAAA,IACD,yBAAA0E,EAAAtE,OA7DH,IAAqBtC,CA6DlB,GAAAsG,EAAA,MACFlB,MAAA,KAAAC,UAAA,CAEM,SAAe+C,EAAqBC,EAAAC,EAAAC,EAAAC,GAAA,OAAAC,EAAArD,MAAC,KAADC,UAAA,CAmB1C,SAAAoD,IAAA,OAAAA,GAAAnI,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAnBM,SAAAkI,EACLC,EACAC,EACA1G,EACA2G,GAAoB,IAAA5G,EAAA/C,EAAAyH,EAAAd,EAAA7D,EAAA,OAAAzB,EAAAA,EAAAA,KAAAO,MAAA,SAAAgI,GAAA,cAAAA,EAAA9H,KAAA8H,EAAA7H,MAAA,OAG6C,OAD3DgB,EAAY2G,EAAkBG,MAAM,UAAU,GAC9C7J,EAAG,GAAA6C,OAAM4G,EAAO,eAAA5G,OAAciH,mBAAmB/G,IAAU6G,EAAA7H,KAAA,EAC1C8G,MAAM7I,EAAK,CAChC2J,OAAAA,IACA,OAFY,IAARlC,EAAQmC,EAAAnH,MAIAwG,GAAG,CAADW,EAAA7H,KAAA,gBAAA6H,EAAA7H,KAAA,EACI0F,EAAS5B,OAAM,OAAxB,MAAHc,EAAGiD,EAAAnH,KACH,IAAIR,MAAMyE,EAAYC,IAAK,eAAAiD,EAAA7H,KAAA,GAGhB0F,EAAS3E,OAAM,QAAxB,OAAJA,EAAI8G,EAAAnH,KAAAmH,EAAA7D,OAAA,SACHK,EAAQtD,EAAKpC,QAASsC,IAAS,yBAAA4G,EAAAxG,OAAA,GAAAoG,EAAA,MACvCtD,MAAA,KAAAC,UAAA,C","sources":["../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/ShareBookmarksDialog.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/sessionSharing.ts"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport {\n  Alert,\n  Button,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport copy from 'copy-to-clipboard'\n\nimport { getSession, isSessionWithShareURL } from '@jbrowse/core/util'\nimport { Dialog, ErrorMessage } from '@jbrowse/core/ui'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\n\n// locals\nimport { shareSessionToDynamo } from '../sessionSharing'\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles()(() => ({\n  flexItem: {\n    margin: 5,\n  },\n}))\n\nconst ShareBookmarksDialog = observer(function ({\n  onClose,\n  model,\n}: {\n  onClose: () => void\n  model: GridBookmarkModel\n}) {\n  const { classes } = useStyles()\n  const [url, setUrl] = useState('')\n  const [error, setError] = useState<unknown>()\n  const [loading, setLoading] = useState(true)\n  const session = getSession(model)\n  const { selectedBookmarks } = model\n  const shareAll = selectedBookmarks.length === 0\n  const bookmarksToShare =\n    selectedBookmarks.length === 0\n      ? model.allBookmarksModel\n      : model.sharedBookmarksModel\n\n  useEffect(() => {\n    let cancelled = false\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    ;(async () => {\n      try {\n        if (!isSessionWithShareURL(session)) {\n          throw new Error('No shareURL configured')\n        }\n        setLoading(true)\n        const snap = getSnapshot(bookmarksToShare)\n        const locationUrl = new URL(window.location.href)\n        const result = await shareSessionToDynamo(\n          snap,\n          session.shareURL,\n          locationUrl.href,\n        )\n        if (!cancelled) {\n          const params = new URLSearchParams(locationUrl.search)\n          params.set('bookmarks', `share-${result.json.sessionId}`)\n          params.set('password', result.password)\n          locationUrl.search = params.toString()\n          setUrl(locationUrl.href)\n          setLoading(false)\n        }\n      } catch (e) {\n        setError(e)\n      } finally {\n        setLoading(false)\n      }\n    })()\n\n    return () => {\n      cancelled = true\n    }\n  }, [bookmarksToShare, session])\n  return (\n    <Dialog open onClose={onClose} title=\"Share bookmarks\">\n      <DialogContent\n        style={{ display: 'flex', flexFlow: 'column', gap: '5px' }}\n      >\n        <Alert severity=\"info\">\n          {shareAll ? (\n            <>\n              <span>All bookmarks will be shared.</span>\n              <br />\n              <span>\n                Use the checkboxes to select individual bookmarks to share.\n              </span>\n            </>\n          ) : (\n            'Only selected bookmarks will be shared.'\n          )}\n        </Alert>\n        <DialogContentText>\n          Copy the URL below to share your bookmarks.\n        </DialogContentText>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <Typography>Generating short URL...</Typography>\n        ) : (\n          <TextField\n            label=\"URL\"\n            value={url}\n            InputProps={{ readOnly: true }}\n            variant=\"filled\"\n            fullWidth\n            onClick={event => {\n              const target = event.target as HTMLTextAreaElement\n              target.select()\n            }}\n          />\n        )}\n        <DialogContentText>\n          The URL should be pasted into the \"Import from share link\" field in\n          the \"Import\" form found in the \"Bookmarked regions\" drawer.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          className={classes.flexItem}\n          data-testid=\"dialogShare\"\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={loading}\n          startIcon={<ContentCopyIcon />}\n          onClick={async () => {\n            copy(url)\n            session.notify('Copied to clipboard', 'success')\n            onClose()\n          }}\n        >\n          Copy share link\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default ShareBookmarksDialog\n","// duplicated from products/jbrowse-web/src/sessionSharing.ts ; could possibly be moved into a higher directory and shared between the two\nimport { toUrlSafeB64 } from './utils'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nconst encrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  const Utf8 = await import('crypto-js/enc-utf8')\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n"],"names":["useStyles","makeStyles","flexItem","margin","ShareBookmarksDialog","observer","_ref","onClose","model","classes","_useState","useState","_useState2","_slicedToArray","url","setUrl","_useState3","_useState4","error","setError","_useState5","_useState6","loading","setLoading","session","getSession","selectedBookmarks","shareAll","length","bookmarksToShare","allBookmarksModel","sharedBookmarksModel","useEffect","cancelled","_asyncToGenerator","_regeneratorRuntime","mark","_callee","snap","locationUrl","result","params","wrap","_context","prev","next","isSessionWithShareURL","Error","getSnapshot","URL","window","location","href","shareSessionToDynamo","shareURL","sent","URLSearchParams","search","set","concat","json","sessionId","password","toString","t0","finish","stop","_jsxs","Dialog","open","title","children","DialogContent","style","display","flexFlow","gap","_jsx","Alert","severity","_Fragment","DialogContentText","ErrorMessage","Typography","TextField","label","value","InputProps","readOnly","variant","fullWidth","onClick","event","target","select","DialogActions","Button","className","color","disabled","startIcon","ContentCopyIcon","_callee2","_context2","copy","notify","encrypt","text","AES","abrupt","_x","_x2","apply","arguments","decrypt","_ref2","Utf8","bytes","_x3","_x4","getErrorMsg","err","JSON","parse","message","e","_x5","_x6","_x7","_shareSessionToDynamo","_callee3","referer","sess","encryptedSession","data","response","_context3","toUrlSafeB64","stringify","btoa","_toConsumableArray","crypto","getRandomValues","Uint8Array","map","b","String","fromCharCode","join","replaceAll","slice","FormData","append","Date","now","fetch","method","mode","body","ok","readSessionFromDynamo","_x8","_x9","_x10","_x11","_readSessionFromDynamo","_callee4","baseUrl","sessionQueryParam","signal","_context4","split","encodeURIComponent"],"sourceRoot":""}