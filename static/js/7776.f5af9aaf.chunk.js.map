{"version":3,"file":"static/js/7776.f5af9aaf.chunk.js","mappings":"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","sources":["../../../plugins/alignments/src/BamAdapter/BamSlightlyLazyFeature.ts","../../../plugins/alignments/src/BamAdapter/BamAdapter.ts"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { BamRecord } from '@gmod/bam'\n\n// locals\nimport { getClip, getMismatches } from '../MismatchParser'\nimport BamAdapter from './BamAdapter'\n\nexport default class BamSlightlyLazyFeature implements Feature {\n  // uses parameter properties to automatically create fields on the class\n  // https://www.typescriptlang.org/docs/handbook/classes.html#parameter-properties\n  constructor(\n    private record: BamRecord,\n    private adapter: BamAdapter,\n    private ref?: string,\n  ) {}\n\n  _get_name() {\n    return this.record.get('name')\n  }\n\n  _get_type(): string {\n    return 'match'\n  }\n\n  _get_score(): number {\n    return this.record.get('mq')\n  }\n\n  _get_flags(): string {\n    return this.record.flags\n  }\n\n  _get_strand(): number {\n    return this.record.isReverseComplemented() ? -1 : 1\n  }\n\n  _get_pair_orientation() {\n    return this.record.isPaired() ? this.record.getPairOrientation() : undefined\n  }\n\n  _get_next_ref() {\n    return this.record.isPaired()\n      ? this.adapter.refIdToName(this.record._next_refid())\n      : undefined\n  }\n\n  _get_next_pos() {\n    return this.record.isPaired() ? this.record._next_pos() : undefined\n  }\n\n  _get_next_segment_position() {\n    return this.record.isPaired()\n      ? `${this.adapter.refIdToName(this.record._next_refid())}:${\n          this.record._next_pos() + 1\n        }`\n      : undefined\n  }\n\n  _get_seq() {\n    return this.record.getReadBases()\n  }\n\n  qualRaw() {\n    return this.record.qualRaw()\n  }\n\n  set() {}\n\n  tags() {\n    const properties = Object.getOwnPropertyNames(\n      BamSlightlyLazyFeature.prototype,\n    )\n\n    return [\n      ...new Set(\n        properties\n          .filter(\n            prop =>\n              prop.startsWith('_get_') &&\n              prop !== '_get_mismatches' &&\n              prop !== '_get_tags',\n          )\n          .map(methodName => methodName.replace('_get_', ''))\n          .concat(this.record._tags()),\n      ),\n    ]\n  }\n\n  id() {\n    return `${this.adapter.id}-${this.record.id()}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    const methodName = `_get_${field}`\n    // @ts-expect-error\n    if (this[methodName]) {\n      // @ts-expect-error\n      return this[methodName]()\n    }\n    return this.record.get(field)\n  }\n\n  _get_refName() {\n    return this.adapter.refIdToName(this.record.seq_id())\n  }\n\n  parent() {\n    return undefined\n  }\n\n  children() {\n    return undefined\n  }\n\n  pairedFeature() {\n    return false\n  }\n\n  toJSON(): SimpleFeatureSerialized {\n    return {\n      ...Object.fromEntries(\n        this.tags()\n          .map(t => [t, this.get(t)])\n          .filter(elt => elt[1] !== undefined),\n      ),\n      uniqueId: this.id(),\n    }\n  }\n\n  _get_mismatches() {\n    return getMismatches(\n      this.get('CIGAR'),\n      this.get('MD'),\n      this.get('seq'),\n      this.ref,\n      this.qualRaw(),\n    )\n  }\n\n  _get_clipPos() {\n    const cigar = this.get('CIGAR') || ''\n    return getClip(cigar, this.get('strand'))\n  }\n}\n","import { BamFile } from '@gmod/bam'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { bytesForRegions, updateStatus, Feature } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { toArray } from 'rxjs/operators'\nimport { firstValueFrom } from 'rxjs'\n\n// locals\nimport BamSlightlyLazyFeature from './BamSlightlyLazyFeature'\n\ninterface Header {\n  idToName: string[]\n  nameToId: Record<string, number>\n}\n\nexport default class BamAdapter extends BaseFeatureDataAdapter {\n  private samHeader?: Header\n\n  private setupP?: Promise<Header>\n  private configureP?: Promise<{\n    bam: BamFile\n    sequenceAdapter?: BaseFeatureDataAdapter\n  }>\n\n  // derived classes may not use the same configuration so a custom\n  // configure method allows derived classes to override this behavior\n  protected async configurePre() {\n    const bamLocation = this.getConf('bamLocation')\n    const location = this.getConf(['index', 'location'])\n    const indexType = this.getConf(['index', 'indexType'])\n    const pm = this.pluginManager\n    const csi = indexType === 'CSI'\n    const bam = new BamFile({\n      bamFilehandle: openLocation(bamLocation, pm),\n      csiFilehandle: csi ? openLocation(location, pm) : undefined,\n      baiFilehandle: !csi ? openLocation(location, pm) : undefined,\n\n      // chunkSizeLimit and fetchSizeLimit are more troublesome than\n      // helpful, and have given overly large values on the ultra long\n      // nanopore reads even with 500MB limits, so disabled with infinity\n      yieldThreadTime: Infinity,\n    })\n\n    const adapterConfig = this.getConf('sequenceAdapter')\n    if (adapterConfig && this.getSubAdapter) {\n      const { dataAdapter } = await this.getSubAdapter(adapterConfig)\n      return {\n        bam,\n        sequenceAdapter: dataAdapter as BaseFeatureDataAdapter,\n      }\n    } else {\n      return { bam }\n    }\n  }\n\n  protected async configure() {\n    if (!this.configureP) {\n      this.configureP = this.configurePre().catch(e => {\n        this.configureP = undefined\n        throw e\n      })\n    }\n    return this.configureP\n  }\n\n  async getHeader(opts?: BaseOptions) {\n    const { bam } = await this.configure()\n    return bam.getHeaderText(opts)\n  }\n\n  private async setupPre(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    const { bam } = await this.configure()\n    this.samHeader = await updateStatus(\n      'Downloading index',\n      statusCallback,\n      async () => {\n        const samHeader = await bam.getHeader(opts)\n\n        // use the @SQ lines in the header to figure out the\n        // mapping between ref ref ID numbers and names\n        const idToName: string[] = []\n        const nameToId: Record<string, number> = {}\n        samHeader\n          ?.filter(l => l.tag === 'SQ')\n          .forEach((sqLine, refId) => {\n            sqLine.data.forEach(item => {\n              if (item.tag === 'SN') {\n                // this is the ref name\n                const refName = item.value\n                nameToId[refName] = refId\n                idToName[refId] = refName\n              }\n            })\n          })\n\n        return { idToName, nameToId }\n      },\n    )\n    return this.samHeader\n  }\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  async getRefNames(opts?: BaseOptions) {\n    const { idToName } = await this.setup(opts)\n    return idToName\n  }\n\n  private async seqFetch(refName: string, start: number, end: number) {\n    const { sequenceAdapter } = await this.configure()\n    const refSeqStore = sequenceAdapter\n    if (!refSeqStore) {\n      return undefined\n    }\n    if (!refName) {\n      return undefined\n    }\n\n    const features = refSeqStore.getFeatures({\n      refName,\n      start,\n      end,\n      assemblyName: '',\n    })\n\n    const seqChunks = await firstValueFrom(features.pipe(toArray()))\n\n    let sequence = ''\n    seqChunks\n      .sort((a, b) => a.get('start') - b.get('start'))\n      .forEach(chunk => {\n        const chunkStart = chunk.get('start')\n        const chunkEnd = chunk.get('end')\n        const trimStart = Math.max(start - chunkStart, 0)\n        const trimEnd = Math.min(end - chunkStart, chunkEnd - chunkStart)\n        const trimLength = trimEnd - trimStart\n        const chunkSeq = chunk.get('seq') || chunk.get('residues')\n        sequence += chunkSeq.slice(trimStart, trimStart + trimLength)\n      })\n\n    if (sequence.length !== end - start) {\n      throw new Error(\n        `sequence fetch failed: fetching ${refName}:${(\n          start - 1\n        ).toLocaleString()}-${end.toLocaleString()} returned ${sequence.length.toLocaleString()} bases, but should have returned ${(\n          end - start\n        ).toLocaleString()}`,\n      )\n    }\n    return sequence\n  }\n\n  getFeatures(\n    region: Region & { originalRefName?: string },\n    opts?: BaseOptions & {\n      filterBy: {\n        flagInclude: number\n        flagExclude: number\n        tagFilter: { tag: string; value: unknown }\n        readName: string\n      }\n    },\n  ) {\n    const { refName, start, end, originalRefName } = region\n    const { signal, filterBy, statusCallback = () => {} } = opts || {}\n    return ObservableCreate<Feature>(async observer => {\n      const { bam } = await this.configure()\n      await this.setup(opts)\n      const records = await updateStatus(\n        'Downloading alignments',\n        statusCallback,\n        () => bam.getRecordsForRange(refName, start, end, opts),\n      )\n\n      await updateStatus('Processing alignments', statusCallback, async () => {\n        const {\n          flagInclude = 0,\n          flagExclude = 0,\n          tagFilter,\n          readName,\n        } = filterBy || {}\n\n        for (const record of records) {\n          let ref: string | undefined\n          if (!record.get('MD')) {\n            ref = await this.seqFetch(\n              originalRefName || refName,\n              record.get('start'),\n              record.get('end'),\n            )\n          }\n\n          const flags = record.flags\n          if ((flags & flagInclude) !== flagInclude && !(flags & flagExclude)) {\n            continue\n          }\n\n          if (tagFilter) {\n            const v = record.get(tagFilter.tag)\n            if (!(v === '*' ? v !== undefined : `${v}` === tagFilter.value)) {\n              continue\n            }\n          }\n\n          if (readName && record.get('name') !== readName) {\n            continue\n          }\n\n          observer.next(new BamSlightlyLazyFeature(record, this, ref))\n        }\n        observer.complete()\n      })\n    }, signal)\n  }\n\n  async getMultiRegionFeatureDensityStats(\n    regions: Region[],\n    opts?: BaseOptions,\n  ) {\n    const { bam } = await this.configure()\n    // this is a method to avoid calling on htsget adapters\n    if (bam.index) {\n      const bytes = await bytesForRegions(regions, bam)\n      const fetchSizeLimit = this.getConf('fetchSizeLimit')\n      return { bytes, fetchSizeLimit }\n    } else {\n      return super.getMultiRegionFeatureDensityStats(regions, opts)\n    }\n  }\n\n  freeResources(/* { region } */): void {}\n\n  // depends on setup being called before the BAM constructor\n  refIdToName(refId: number) {\n    return this.samHeader?.idToName[refId]\n  }\n}\n"],"names":["BamSlightlyLazyFeature","record","adapter","ref","_classCallCheck","_createClass","key","value","this","get","flags","isReverseComplemented","isPaired","getPairOrientation","undefined","refIdToName","_next_refid","_next_pos","concat","getReadBases","qualRaw","properties","Object","getOwnPropertyNames","prototype","_toConsumableArray","Set","filter","prop","startsWith","map","methodName","replace","_tags","id","field","seq_id","_this","_objectSpread","fromEntries","tags","t","elt","uniqueId","getMismatches","cigar","getClip","BamAdapter","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_len","arguments","length","args","Array","_key","call","apply","samHeader","setupP","configureP","_configurePre","_asyncToGenerator","_regeneratorRuntime","mark","_callee","bamLocation","location","indexType","pm","csi","bam","adapterConfig","_yield$this$getSubAda","dataAdapter","wrap","_context","prev","next","getConf","pluginManager","BamFile","bamFilehandle","openLocation","csiFilehandle","baiFilehandle","yieldThreadTime","Infinity","getSubAdapter","sent","abrupt","sequenceAdapter","stop","_configure","_callee2","_this2","_context2","configurePre","catch","e","_getHeader","_callee3","opts","_yield$this$configure","_context3","configure","getHeaderText","_x","_setupPre","_callee5","_ref$statusCallback","statusCallback","_yield$this$configure2","_context5","updateStatus","_callee4","idToName","nameToId","_context4","getHeader","l","tag","forEach","sqLine","refId","data","item","refName","_x2","_setup","_callee6","_this3","_context6","setupPre","_x3","_getRefNames","_callee7","_yield$this$setup","_context7","setup","_x4","_seqFetch","_callee8","start","end","_yield$this$configure3","refSeqStore","features","seqChunks","sequence","_context8","getFeatures","assemblyName","firstValueFrom","pipe","toArray","sort","a","b","chunk","chunkStart","chunkEnd","trimStart","Math","max","trimLength","min","chunkSeq","slice","Error","toLocaleString","_x5","_x6","_x7","region","_this4","originalRefName","_ref3","signal","filterBy","_ref3$statusCallback","ObservableCreate","_ref4","_callee10","observer","_yield$_this4$configu","records","_context10","getRecordsForRange","_callee9","_ref6","_ref6$flagInclude","flagInclude","_ref6$flagExclude","flagExclude","tagFilter","readName","_iterator","_step","v","_context9","_createForOfIteratorHelper","s","n","done","seqFetch","t0","f","finish","complete","_x8","_getMultiRegionFeatureDensityStats","_callee11","regions","_yield$this$configure4","bytes","fetchSizeLimit","_context11","index","bytesForRegions","_get","_getPrototypeOf","_x9","_x10","_this$samHeader","BaseFeatureDataAdapter"],"sourceRoot":""}