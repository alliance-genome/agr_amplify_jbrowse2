"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[9116,7554],{47554:function(e,n,t){t.r(n),t.d(n,{default:function(){return T}});var r=t(33028),s=t(96234),o=t(96902),a=t(91188),i=t(4782),c=t(99836),l=t(42054),u=t(2769),d=t(16644),m=t(50543),f=t(35388),h=t(78566),p=t(29938),v=(0,a.ZL)()((function(e){var n=e.palette,t=n.tertiary,r=n.primary;return{rubberband:{height:"100%",background:t?(0,d.Fq)(t.main,.7):(0,d.Fq)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:t?t.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},sm:{fontSize:10}}})),x=(0,i.observer)((function(e){var n=e.model,t=e.coordX,r=v().classes;return(0,p.jsx)(m.Z,{open:!0,placement:"top",title:n.views.map((function(e){return e.pxToBp(t)})).map((function(e){return(0,p.jsx)(f.Z,{className:r.sm,children:(0,l.stringify)(e)},JSON.stringify(e))})),arrow:!0,children:(0,p.jsx)("div",{className:r.guide,style:{left:t,background:"red"}})})}));var b=(0,i.observer)((function(e){var n=e.model,t=e.ControlComponent,r=void 0===t?(0,p.jsx)("div",{}):t,a=(0,o.useState)(),i=(0,s.Z)(a,2),c=i[0],d=i[1],m=(0,o.useState)(),b=(0,s.Z)(m,2),g=b[0],j=b[1],y=(0,o.useState)(),Z=(0,s.Z)(y,2),w=Z[0],k=Z[1],S=(0,o.useState)(),C=(0,s.Z)(S,2),M=C[0],L=C[1],N=(0,o.useRef)(null),T=(0,o.useRef)(null),A=v().classes,P=void 0!==c&&void 0===w;function E(e){e.preventDefault(),e.stopPropagation();var n=e.clientX-e.target.getBoundingClientRect().left;d(n),j(n)}function O(e){var n=e.target;L(e.clientX-n.getBoundingClientRect().left)}function I(){L(void 0),n.views.forEach((function(e){return e.setOffsets(void 0,void 0)}))}function F(){k(void 0),d(void 0),j(void 0)}(0,o.useEffect)((function(){function e(e){if(N.current&&P){var n=e.clientX-N.current.getBoundingClientRect().left;j(n)}}function t(e){if(void 0!==c&&N.current){var t=e.clientX,r=e.clientY,s=t-N.current.getBoundingClientRect().left;k({offsetX:s,clientX:t,clientY:r}),n.views.forEach((function(e){var n=function(e,n){if(void 0!==c){var t=c,r=e;if(r<t){var s=[r,t];t=s[0],r=s[1]}return{leftOffset:n.pxToBp(t),rightOffset:n.pxToBp(r)}}}(s,e);if(n){var t=n.leftOffset,r=n.rightOffset;e.setOffsets(t,r)}})),L(void 0)}}return P?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[c,P,w,n]),(0,o.useEffect)((function(){!P&&void 0!==g&&void 0!==c&&Math.abs(g-c)<=3&&F()}),[P,g,c]);var B=Boolean(w);if(void 0===c)return(0,p.jsxs)(p.Fragment,{children:[void 0!==M?(0,p.jsx)(x,{model:n,coordX:M}):null,(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:A.rubberbandControl,role:"presentation",ref:N,onMouseDown:E,onMouseOut:I,onMouseMove:O,children:r})]});var R=w?w.offsetX:g||0,D=R<c?R:c,z=Math.abs(R-c),X=n.views,q=X.map((function(e){return e.pxToBp(D)})),H=X.map((function(e){return e.pxToBp(D+z)})),_=X.map((function(e){return Math.ceil(z*e.bpPerPx)}));return(0,p.jsxs)(p.Fragment,{children:[T.current?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.ZP,{className:A.popover,classes:{paper:A.paper},open:!0,anchorEl:T.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:q.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))}),(0,p.jsx)(h.ZP,{className:A.popover,classes:{paper:A.paper},open:!0,anchorEl:T.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:H.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))})]}):null,(0,p.jsx)("div",{ref:T,className:A.rubberband,style:{left:D,width:z},children:(0,p.jsx)(f.Z,{variant:"h6",className:A.rubberbandText,children:_.map((function(e,n){return(0,p.jsx)(f.Z,{children:"".concat(e.toLocaleString("en-US"),"bp")},"".concat(e,"_").concat(n))}))})}),(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:A.rubberbandControl,role:"presentation",ref:N,onMouseDown:E,onMouseOut:I,onMouseMove:O,children:r}),w?(0,p.jsx)(u.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:w.clientX,top:w.clientY},onMenuItemClick:function(e,n){n(),F()},open:B,onClose:F,menuItems:n.rubberBandMenuItems()}):null]})})),g=t(25322),j=t(92777),y=t(38238),Z=t(23642),w=(0,a.ZL)()((function(){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},iconButton:{margin:5},bp:{display:"flex",alignItems:"center",marginLeft:10},searchContainer:{marginLeft:5},searchBox:{display:"flex"}}})),k=(0,i.observer)((function(e){var n=e.model;return(0,p.jsx)(g.Z,{onClick:n.activateTrackSelector,title:"Open track selector",children:(0,p.jsx)(Z.GD,{color:"primary"})})})),S=(0,i.observer)((function(e){var n=e.model,t=w().classes,r=(0,o.useState)(),a=(0,s.Z)(r,2),i=a[0],c=a[1],l=n.views.some((function(e){return!e.hideHeader}));return(0,p.jsxs)("div",{className:t.headerBar,children:[(0,p.jsx)(k,{model:n}),(0,p.jsx)(g.Z,{onClick:function(e){return c(e.currentTarget)},className:t.iconButton,color:"secondary",children:(0,p.jsx)(y.Z,{})}),l?null:n.views.map((function(e){return(0,p.jsxs)("div",{className:t.searchBox,children:[(0,p.jsx)("div",{className:t.searchContainer,children:(0,p.jsx)(j.Rj,{model:e,showHelp:!1})}),(0,p.jsx)("div",{className:t.bp,children:(0,p.jsxs)(f.Z,{variant:"body2",color:"textSecondary",className:t.bp,children:[Math.round(e.coarseTotalBp).toLocaleString("en-US")," bp"]})})]},e.id)})),(0,p.jsx)("div",{className:t.spacer}),i?(0,p.jsx)(u.Menu,{anchorEl:i,open:!0,onMenuItemClick:function(e,n){n(),c(void 0)},menuItems:n.headerMenuItems(),onClose:function(){return c(void 0)}}):null]})})),C=(0,a.ZL)()((function(){return{container:{display:"grid"},overlay:{zIndex:100,gridArea:"1/1"},content:{gridArea:"1/1",position:"relative"},grid:{display:"grid"},relative:{position:"relative"},rubberbandContainer:{position:"relative",overflow:"hidden"}}})),M=(0,i.observer)((function(e){var n=e.model,t=C().classes;return(0,p.jsx)(p.Fragment,{children:n.tracks.map((function(e){var r=(0,s.Z)(e.displays,1)[0],o=r.RenderingComponent,a=(0,c.getConf)(e,"trackId");return o?(0,p.jsx)("div",{className:t.overlay,style:{height:n.middleComparativeHeight,overflow:"hidden"},children:(0,p.jsx)(o,{model:r})},a):null}))})})),L=(0,i.observer)((function(e){var n=e.model,t=C().classes,r=n.views,a=(0,l.getEnv)(n).pluginManager.getViewType(r[0].type).ReactComponent,i=(0,o.useState)(!1),c=(0,s.Z)(i,2),d=c[0],m=c[1];return(0,p.jsxs)("div",{className:t.rubberbandContainer,children:[(0,p.jsx)(S,{model:n}),(0,p.jsx)(b,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",background:d?"#999":"#ccc",height:15},onMouseOver:function(){return m(!0)},onMouseLeave:function(){return m(!1)}})}),(0,p.jsxs)("div",{className:t.container,children:[(0,p.jsx)(a,{model:r[0]}),(0,p.jsx)("div",{className:t.grid,children:(0,p.jsx)(M,{model:n})}),(0,p.jsx)(u.ResizeHandle,{onDrag:function(e){return n.setMiddleComparativeHeight(n.middleComparativeHeight+e)},style:{height:4,background:"#ccc"}}),(0,p.jsx)(a,{model:r[1]})]})]})})),N=(0,i.observer)((function(e){var n=e.model,t=C().classes,r=n.views,a=(0,l.getEnv)(n).pluginManager,i=(0,o.useState)(!1),c=(0,s.Z)(i,2),u=c[0],d=c[1];return(0,p.jsxs)("div",{className:t.rubberbandContainer,children:[(0,p.jsx)(S,{model:n}),(0,p.jsx)(b,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",background:u?"#aaa":"#ccc",height:15},onMouseOver:function(){return d(!0)},onMouseLeave:function(){return d(!1)}})}),(0,p.jsx)("div",{className:t.container,children:(0,p.jsxs)("div",{className:t.content,children:[(0,p.jsx)("div",{className:t.relative,children:r.map((function(e){var n=a.getViewType(e.type).ReactComponent;return(0,p.jsx)(n,{model:e},e.id)}))}),(0,p.jsx)(M,{model:n})]})})]})})),T=(0,i.observer)((function(e){return e.model.tracks.some((function(e){return e.displays.some((function(e){return(0,c.getConf)(e,"middle")}))}))?(0,p.jsx)(L,(0,r.Z)({},e)):(0,p.jsx)(N,(0,r.Z)({},e))}))},49116:function(e,n,t){t.r(n),t.d(n,{default:function(){return B}});var r=t(96902),s=t(4782),o=t(47554),a=t(32723),i=t(34795),c=t(96234),l=t(13655),u=t(2868),d=t(99782),m=t(80367),f=t(12221),h=t(34592),p=t(54417),v=t(6880),x=t(44536),b=t(91188),g=t(42054),j=t(2769),y=t(88315),Z=t.n(y),w=t(35388),k=t(29938);function S(e){var n=e.radioOption,t=e.assembly1,r=e.assembly2,s=e.fileLocation,o=e.bed1Location,a=e.bed2Location;if(".paf"===n)return{type:"PAFAdapter",pafLocation:s,queryAssembly:t,targetAssembly:r};if(".out"===n)return{type:"MashMapAdapter",outLocation:s,queryAssembly:t,targetAssembly:r};if(".delta"===n)return{type:"DeltaAdapter",deltaLocation:s,queryAssembly:t,targetAssembly:r};if(".chain"===n)return{type:"ChainAdapter",chainLocation:s,queryAssembly:t,targetAssembly:r};if(".anchors"===n)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:s,bed1Location:o,bed2Location:a,assemblyNames:[t,r]};if(".anchors.simple"===n)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:s,bed1Location:o,bed2Location:a,assemblyNames:[t,r]};throw new Error("Unknown type")}var C=(0,s.observer)((function(e){e.sessionTrackData;var n=e.assembly1,t=e.assembly2,s=e.setSessionTrackData,o=(0,r.useState)(),a=(0,c.Z)(o,2),i=a[0],l=a[1],u=(0,r.useState)(),h=(0,c.Z)(u,2),x=h[0],b=h[1],g=(0,r.useState)(),y=(0,c.Z)(g,2),C=y[0],M=y[1],L=(0,r.useState)(""),N=(0,c.Z)(L,2),T=N[0],A=N[1],P=(0,r.useState)(),E=(0,c.Z)(P,2),O=E[0],I=E[1],F=function(e){return e?e.uri||e.localPath||e.name:void 0}(C),B=T||(F?Z().extname(function(e){return e.endsWith(".gz")?e.slice(0,e.length-3):e}(F)):"");return(0,r.useEffect)((function(){try{if(C){var e=F?Z().basename(F):"MyTrack",r="".concat(e,"-").concat(Date.now());I(void 0),s({trackId:r,name:e,assemblyNames:[t,n],type:"SyntenyTrack",adapter:S({radioOption:B,assembly1:n,assembly2:t,fileLocation:C,bed1Location:x,bed2Location:i})})}}catch(o){console.error(o),I(o)}}),[F,n,t,x,i,C,B,s]),(0,k.jsxs)(v.Z,{style:{padding:12},children:[O?(0,k.jsx)(j.ErrorMessage,{error:O}):null,(0,k.jsx)(w.Z,{style:{textAlign:"center"},children:"Add a .paf, .out (MashMap), .delta (Mummer), .chain, .anchors or .anchors.simple (MCScan) file to view in the dotplot. These file types can also be gzipped. The first assembly should be the query sequence (e.g. left column of the PAF) and the second assembly should be the target sequence (e.g. right column of the PAF)"}),(0,k.jsx)(d.Z,{value:B,onChange:function(e){return A(e.target.value)},children:(0,k.jsxs)(p.ZP,{container:!0,justifyContent:"center",children:[(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".paf",control:(0,k.jsx)(f.Z,{}),label:".paf"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".out",control:(0,k.jsx)(f.Z,{}),label:".out"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".delta",control:(0,k.jsx)(f.Z,{}),label:".delta"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".chain",control:(0,k.jsx)(f.Z,{}),label:".chain"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".anchors",control:(0,k.jsx)(f.Z,{}),label:".anchors"})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(m.Z,{value:".anchors.simple",control:(0,k.jsx)(f.Z,{}),label:".anchors.simple"})})]})}),(0,k.jsx)(p.ZP,{container:!0,justifyContent:"center",children:(0,k.jsx)(p.ZP,{item:!0,children:".anchors"===T||".anchors.simple"===T?(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{style:{margin:20},children:["Open the ",T," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",(0,k.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,k.jsxs)("div",{style:{display:"flex"},children:[(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:".anchors file",description:"",location:C,setLocation:function(e){return M(e)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:"genome 1 .bed (left column of anchors file)",description:"",location:x,setLocation:function(e){return b(e)}})}),(0,k.jsx)("div",{children:(0,k.jsx)(j.FileSelector,{name:"genome 2 .bed (right column of anchors file)",description:"",location:i,setLocation:function(e){return l(e)}})})]})]}):(0,k.jsx)(j.FileSelector,{name:T?T+" location":"",description:"",location:C,setLocation:function(e){return M(e)}})})})]})})),M=t(68079),L=t(33266),N=t(15996),T=t(16151),A=t(99836);var P=(0,s.observer)((function(e){var n,t=e.model,s=e.assembly1,o=e.assembly2,a=e.setShowTrackId,i=(0,g.getSession)(t),l=i.tracks,u=void 0===l?[]:l,d=i.sessionTracks,m=void 0===d?[]:d,f=[].concat((0,M.Z)(u),(0,M.Z)(m)).filter((function(e){return function(e,n,t){var r=(0,A.readConfObject)(e,"assemblyNames");return r.includes(n)&&r.includes(t)&&e.type.includes("Synteny")}(e,o,s)})),h=(null===(n=f[0])||void 0===n?void 0:n.trackId)||"",p=(0,r.useState)(h),x=(0,c.Z)(p,2),b=x[0],y=x[1];return(0,r.useEffect)((function(){y(h)}),[h]),(0,r.useEffect)((function(){a(b)}),[b,a]),(0,k.jsxs)(v.Z,{style:{padding:12},children:[(0,k.jsx)(w.Z,{paragraph:!0,children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),f.length?(0,k.jsx)(L.Z,{value:b,onChange:function(e){return y(e.target.value)},children:f.map((function(e){return(0,k.jsx)(N.Z,{value:e.trackId,children:(0,T.getTrackName)(e,i)},e.trackId)}))}):(0,k.jsx)(j.ErrorMessage,{error:"No synteny tracks found for ".concat(s,",").concat(o)})]})})),E=(0,b.ZL)()((function(e){return{importFormContainer:{padding:e.spacing(4),margin:"0 auto"},assemblySelector:{width:"75%",margin:"0 auto"}}}));function O(e){var n=e.setSessionTrackData,t=e.setShowTrackId,s=e.sessionTrackData,o=e.assembly1,a=e.assembly2,i=e.model,h=(0,r.useState)("none"),p=(0,c.Z)(h,2),v=p[0],x=p[1];return(0,r.useEffect)((function(){"none"===v&&(n(void 0),t(void 0))}),[v,n,t]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(l.Z,{children:[(0,k.jsx)(u.Z,{id:"group-label",children:"(Optional) Select or add a synteny track"}),(0,k.jsxs)(d.Z,{row:!0,value:v,onChange:function(e){return x(e.target.value)},"aria-labelledby":"group-label",children:[(0,k.jsx)(m.Z,{value:"none",control:(0,k.jsx)(f.Z,{}),label:"None"}),(0,k.jsx)(m.Z,{value:"tracklist",control:(0,k.jsx)(f.Z,{}),label:"Existing track"}),(0,k.jsx)(m.Z,{value:"custom",control:(0,k.jsx)(f.Z,{}),label:"New track"})]})]}),"custom"===v?(0,k.jsx)(C,{setSessionTrackData:n,sessionTrackData:s,assembly2:a,assembly1:o}):null,"tracklist"===v?(0,k.jsx)(P,{model:i,assembly1:o,assembly2:a,setShowTrackId:t}):null]})}var I=(0,s.observer)((function(e){var n=e.model,t=E().classes,s=(0,g.getSession)(n),o=s.assemblyNames,u=(0,r.useState)(o[0]||""),d=(0,c.Z)(u,2),m=d[0],f=d[1],b=(0,r.useState)(o[0]||""),y=(0,c.Z)(b,2),Z=y[0],w=y[1],S=(0,r.useState)(),C=(0,c.Z)(S,2),M=C[0],L=C[1],N=(0,r.useState)(),T=(0,c.Z)(N,2),A=T[0],P=T[1],I=(0,r.useState)(),F=(0,c.Z)(I,2),B=F[0],R=F[1];function D(){return D=(0,i.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,g.isSessionWithAddTracks)(s)){e.next=3;break}return e.abrupt("return");case 3:return L(void 0),t=s.assemblyManager,r=[Z,m],e.t0=n,e.next=9,Promise.all(r.map(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.waitForAssembly(n);case 2:if(r=e.sent){e.next=5;break}throw new Error("Assembly ".concat(n," failed to load"));case 5:return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:r.regions});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 9:e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),n.views.forEach((function(e){return e.setWidth(n.width)})),A?(s.addTrackConf(A),n.toggleTrack(A.trackId)):B&&n.showTrack(B),e.next=19;break;case 15:e.prev=15,e.t2=e.catch(0),console.error(e.t2),L(e.t2);case 19:case"end":return e.stop()}}),e,null,[[0,15]])}))),D.apply(this,arguments)}var z=M;return(0,k.jsxs)(h.Z,{className:t.importFormContainer,children:[z?(0,k.jsx)(j.ErrorMessage,{error:z}):null,(0,k.jsx)(p.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",className:t.assemblySelector,children:(0,k.jsxs)(p.ZP,{item:!0,children:[(0,k.jsxs)(v.Z,{style:{padding:12},children:[(0,k.jsx)("p",{style:{textAlign:"center"},children:"Select assemblies for linear synteny view"}),(0,k.jsxs)(p.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(j.AssemblySelector,{selected:Z,onChange:function(e){return w(e)},session:s})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(j.AssemblySelector,{selected:m,onChange:function(e){return f(e)},session:s})}),(0,k.jsx)(p.ZP,{item:!0,children:(0,k.jsx)(l.Z,{children:(0,k.jsx)(x.Z,{onClick:function(){return D.apply(this,arguments)},variant:"contained",color:"primary",children:"Launch"})})})]})]}),(0,k.jsx)(O,{setShowTrackId:R,assembly2:m,assembly1:Z,setSessionTrackData:P,sessionTrackData:A,model:n})]})})]})})),F=I,B=(0,s.observer)((function(e){var n=e.model;return n.initialized?(0,k.jsx)(o.default,{model:n}):(0,k.jsx)(F,{model:n})}))}}]);
//# sourceMappingURL=9116.cc53e2b6.chunk.js.map