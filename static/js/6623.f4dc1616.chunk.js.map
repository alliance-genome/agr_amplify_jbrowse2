{"version":3,"file":"static/js/6623.f4dc1616.chunk.js","mappings":"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CAFtB,OAEsB,+BAJvE,SAAQ6I,GAAsC,GAAC,uBAE/C,SAAUA,GAAsC,KAAC,EATf,E,ihBCDpC,GACE,OACA,kBACA,QACA,YACA,aACA,mBACA,sBACA,0BACA,gBACA,oBACA,gBACA,aAEA,uBACA,2BACA,8BACA,qCACA,qCACA,0BACA,+BACA,iCACA,2BACA,gCACA,6BACA,0BACA,wBACA,gCACA,2BACA,gCACA,yBACA,gCACA,mCACA,gCACA,+BACA,8BACA,qCACA,6BACA,sCACA,yBACA,6BACA,8BACA,2BACA,kCACA,gCACA,kCACA,sCACA,4BACA,2BACA,wBACA,yBACA,gCACA,8BACA,gCACA,qCACA,mCACA,8BACA,yBACA,yBACA,yBACA,+BACA,0BACA,8BACA,+BACA,mCACA,yBACA,mCACA,yBACA,6BACA,mCACA,4CACA,iCACA,kCACA,iCACA,yBACA,6BACA,6BACA,0BACA,iCACA,kCACA,+BACA,mCACA,0BACA,4BACA,2BACA,2BACA,0BACA,+BACA,2BACA,sCACA,2BACA,6BACA,2BACA,6BACA,oCACA,8BACA,oCACA,kCACA,0BACA,yBACA,+BACA,kCACA,8BACA,6BACA,4BACA,4BACA,2BACA,wBACA,0BACA,8BACA,8BACA,mCACA,gCACA,8BACA,oCACA,6BACA,mCACA,yBACA,8BACA,qCACA,iCACA,sCACA,4BACA,4BACA,+BACA,0BACA,iCACA,iCACA,sBACA,2BACA,6BACA,uBACA,4BACA,yBACA,sBACA,oBACA,4BACA,uBACA,4BACA,qBACA,4BACA,+BACA,4BACA,2BACA,0BACA,iCACA,yBACA,kCACA,qBACA,yBACA,0BACA,uBACA,8BACA,4BACA,8BACA,kCACA,wBACA,uBACA,oBACA,qBACA,4BACA,0BACA,4BACA,iCACA,+BACA,0BACA,qBACA,qBACA,qBACA,2BACA,sBACA,0BACA,2BACA,+BACA,qBACA,+BACA,qBACA,yBACA,+BACA,wCACA,6BACA,8BACA,6BACA,qBACA,yBACA,yBACA,sBACA,6BACA,8BACA,2B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","sources":["../../../packages/core/BaseFeatureWidget/index.ts","../../../packages/core/rpc/coreRpcMethods.ts","../../../packages/core/data_adapters/CytobandAdapter.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/Plugin.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/modules.tsx","../../../packages/core/ReExports/index.ts","../../../packages/core/TextSearch/BaseResults.ts","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../packages/core/configuration/util.ts","../../../packages/core/data_adapters/BaseAdapter.ts","../../../packages/core/data_adapters/dataAdapterCache.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../packages/core/pluggableElementTypes/AddTrackWorkflowType.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/InternetAccountType.ts","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/pluggableElementTypes/TextSearchAdapterType.ts","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.ts","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/InternetAccountModel.ts","../../../packages/core/pluggableElementTypes/models/baseInternetAccountConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/FeatureRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.ts","../../../packages/core/pluggableElementTypes/renderers/ServerSideRenderedContent.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.tsx","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/ui/Drawer.tsx","../../../packages/core/ui/DrawerWidget.tsx","../../../packages/core/ui/DropDownMenu.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../packages/core/ui/FileSelector/LocalFileChooser.tsx","../../../packages/core/ui/FileSelector/UrlChooser.tsx","../../../packages/core/ui/Icons.tsx","../../../packages/core/ui/LoadingEllipses.tsx","../../../packages/core/ui/Snackbar.tsx","../../../packages/core/ui/ViewContainer.tsx","../../../packages/core/ui/colors.ts","../../../packages/core/util/Base1DUtils.ts","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/util/calculateStaticBlocks.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../packages/core/util/idMaker.ts","../../../packages/core/util/index.ts","../../../packages/core/util/io/RemoteFileWithRangeCache.ts","../../../packages/core/util/io/index.ts","../../../packages/core/util/jexl.ts","../../../packages/core/util/jexlStrings.ts","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../packages/core/util/layouts/PrecomputedMultiLayout.js","../../../packages/core/util/layouts/SceneGraph.ts","../../../packages/core/util/mst-reflection.js","../../../packages/core/util/range.ts","../../../packages/core/util/rxjs.ts","../../../packages/core/util/simpleFeature.ts","../../../packages/core/util/stats.ts","../../../packages/core/util/tracks.ts","../../../packages/core/util/types/mst.ts","../../../plugins/alignments/src/BamAdapter/MismatchParser.ts","../../../plugins/alignments/src/SNPCoverageAdapter/SNPCoverageAdapter.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.ts","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.ts","../../../plugins/alignments/src/PileupRenderer/PileupLayoutSession.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.ts","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/model.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../../../plugins/alignments/src/shared.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearPileupDisplay/index.ts","../../../plugins/alignments/src/AlignmentsTrack/index.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.ts","../../../plugins/alignments/src/PileupRPC/rpcMethods.ts","../../../plugins/alignments/src/index.ts","../../../plugins/alignments/src/util.ts","../../../plugins/arc/src/LinearArcDisplay/model.tsx","../../../plugins/arc/src/ArcRenderer/ArcRendering.tsx","../../../plugins/arc/src/ArcRenderer/configSchema.tsx","../../../plugins/arc/src/ArcRenderer/ArcRenderer.tsx","../../../plugins/arc/src/index.ts","../../../plugins/arc/src/LinearArcDisplay/configSchema.tsx","../../../plugins/authentication/src/OAuthModel/configSchema.ts","../../../plugins/authentication/src/OAuthModel/model.tsx","../../../plugins/authentication/src/ExternalTokenModel/configSchema.ts","../../../plugins/authentication/src/ExternalTokenModel/ExternalTokenEntryForm.tsx","../../../plugins/authentication/src/ExternalTokenModel/model.tsx","../../../plugins/authentication/src/HTTPBasicModel/configSchema.ts","../../../plugins/authentication/src/HTTPBasicModel/HTTPBasicLoginForm.tsx","../../../plugins/authentication/src/HTTPBasicModel/model.tsx","../../../plugins/authentication/src/DropboxOAuthModel/configSchema.ts","../../../plugins/authentication/src/DropboxOAuthModel/model.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/configSchema.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/model.tsx","../../../plugins/authentication/src/index.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/BedAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.ts","../../../plugins/breakpoint-split-view/src/util.ts","../../../plugins/breakpoint-split-view/src/components/AlignmentConnections.tsx","../../../plugins/breakpoint-split-view/src/components/Breakends.tsx","../../../plugins/breakpoint-split-view/src/components/Header.tsx","../../../plugins/breakpoint-split-view/src/components/Translocations.tsx","../../../plugins/breakpoint-split-view/src/components/BreakpointSplitView.tsx","../../../plugins/breakpoint-split-view/src/model.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/circular-view/src/CircularView/models/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/models/slices.ts","../../../plugins/circular-view/src/CircularView/models/CircularView.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/RpcRenderedSvgGroup.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/models/renderReaction.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/BaseChordDisplayModel.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/baseChordDisplayConfig.ts","../../../plugins/circular-view/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/ChainAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/index.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/index.ts","../../../plugins/comparative-adapters/src/ChainAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/index.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/JsonEditor.tsx","../../../plugins/config/src/FromConfigAdapter/FromConfigAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigRegionsAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigSequenceAdapter.ts","../../../plugins/config/src/RefNameAliasAdapter/RefNameAliasAdapter.ts","../../../plugins/config/src/ConfigurationEditorWidget/model.ts","../../../plugins/config/src/ConfigurationEditorWidget/index.tsx","../../../plugins/config/src/FromConfigAdapter/fromConfig.ts","../../../plugins/config/src/FromConfigAdapter/fromConfigSequence.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/index.ts","../../../plugins/data-management/src/AddConnectionWidget/model.ts","../../../plugins/data-management/src/AddConnectionWidget/index.ts","../../../plugins/data-management/src/AddTrackWidget/model.ts","../../../plugins/data-management/src/AddTrackWidget/index.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/configSchema.ts","../../../plugins/data-management/src/PluginStoreWidget/model.ts","../../../plugins/data-management/src/PluginStoreWidget/index.ts","../../../plugins/data-management/src/ucsc-trackhub/configSchema.ts","../../../plugins/data-management/src/ucsc-trackhub/ucscAssemblies.js","../../../plugins/data-management/src/ucsc-trackhub/ucscTrackHub.js","../../../plugins/data-management/src/ucsc-trackhub/model.js","../../../plugins/dotplot-view/src/DotplotView/components/util.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/renderDotplotBlock.ts","../../../plugins/dotplot-view/src/DotplotDisplay/stateModelFactory.ts","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../plugins/dotplot-view/src/LaunchDotplotView.ts","../../../plugins/dotplot-view/src/ComparativeRenderer/index.ts","../../../plugins/dotplot-view/src/util.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef/DotplotReadVsRef.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/dotplot-view/src/DotplotView/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/index.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef/index.ts","../../../plugins/gccontent/src/GCContentAdapter/configSchema.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/index.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/config.ts","../../../plugins/gccontent/src/LinearGCContentDisplay/stateModel.ts","../../../plugins/gccontent/src/index.ts","../../../plugins/gccontent/src/GCContentAdapter/index.ts","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/Gff3Adapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/model.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/index.ts","../../../plugins/grid-bookmark/src/index.ts","../../../plugins/gtf/src/GtfAdapter/configSchema.ts","../../../plugins/gtf/src/index.ts","../../../plugins/hic/src/configSchema.ts","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.tsx","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/model.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/HttpMap.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/JBrowse1TextSearchAdapter.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/util.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigParse.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigLoad.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ToJb2.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.tsx","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/Icons.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/components/LinearComparativeDisplay.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/configSchemaF.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/stateModelFactory.ts","../../../plugins/linear-comparative-view/src/util.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/components/SyntenyTooltip.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/components/LinearSyntenyRendering.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/configSchema.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/LinearSyntenyRenderer.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LaunchLinearSyntenyView.ts","../../../plugins/linear-comparative-view/src/SyntenyTrack/configSchema.ts","../../../plugins/linear-comparative-view/src/SyntenyFeatureDetail/index.ts","../../../plugins/linear-comparative-view/src/LinearReadVsRef/util.ts","../../../plugins/linear-comparative-view/src/LinearReadVsRef/LinearReadVsRef.tsx","../../../plugins/linear-comparative-view/src/index.tsx","../../../plugins/linear-comparative-view/src/SyntenyTrack/index.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LGVSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearReadVsRef/index.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Gridlines.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/CenterLine.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ImportForm.tsx","../../../packages/core/util/formatFastaStrings.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/GetSequenceDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchResultsDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Ruler.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeViewSvg.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchBox.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ExportSvgDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/index.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/baseLinearDisplayConfigSchema.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BlockMsg.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/TooLargeMessage.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Tooltip.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/LinearBareDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/FeatureTrack/configSchema.ts","../../../plugins/linear-genome-view/src/BasicTrack/configSchema.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/linear-genome-view/src/BasicTrack/index.ts","../../../plugins/linear-genome-view/src/FeatureTrack/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/configSchema.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/components/Lollipop.js","../../../plugins/lollipop/src/LollipopRenderer/components/Stick.js","../../../plugins/lollipop/src/LollipopRenderer/components/LollipopRendering.js","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.js","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/index.ts","../../../plugins/menus/src/HelpWidget/index.ts","../../../plugins/menus/src/ImportSessionWidget/index.ts","../../../plugins/menus/src/SessionManager/index.ts","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/SPARQLAdapter.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/SequenceSearchAdapter/configSchema.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/index.ts","../../../plugins/sequence/src/ReferenceSequenceTrack/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/index.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/TwoBitAdapter/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/index.ts","../../../plugins/sequence/src/ChromSizesAdapter/index.ts","../../../plugins/sequence/src/IndexedFastaAdapter/index.ts","../../../plugins/sequence/src/SequenceSearchAdapter/index.ts","../../../plugins/sequence/src/createExtensionPoints.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/MakeSpreadsheetColumnType.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocString.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Text.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocRef.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Number.tsx","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocStart.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocEnd.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Row.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/StaticRowSet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Spreadsheet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/FilterControls.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/SpreadsheetView.ts","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/components/SvInspectorView.tsx","../../../plugins/sv-inspector/src/SvInspectorView/models/adhocFeatureUtils.js","../../../plugins/sv-inspector/src/SvInspectorView/models/breakpointSplitViewFromTableRow.js","../../../plugins/sv-inspector/src/SvInspectorView/models/SvInspectorView.ts","../../../plugins/sv-inspector/src/SvInspectorView/SvInspectorViewType.js","../../../plugins/sv-inspector/src/index.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Arrow.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.tsx","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/trackhub-registry/src/trackhub-registry/configSchema.ts","../../../plugins/trackhub-registry/src/trackhub-registry/tracks.js","../../../plugins/trackhub-registry/src/trackhub-registry/model.ts","../../../plugins/trackhub-registry/src/index.ts","../../../plugins/trackhub-registry/src/trackhub-registry/util.tsx","../../../plugins/trix/src/TrixTextSearchAdapter/TrixTextSearchAdapter.ts","../../../plugins/trix/src/TrixTextSearchAdapter/configSchema.ts","../../../plugins/trix/src/index.ts","../../../plugins/variants/src/VcfTabixAdapter/VcfFeature.ts","../../../plugins/variants/src/VcfAdapter/configSchema.ts","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/VariantTrack/configSchema.ts","../../../plugins/variants/src/ChordVariantDisplay/models/configSchema.ts","../../../plugins/variants/src/ChordVariantDisplay/models/stateModelFactory.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/LinearVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/configSchema.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.tsx","../../../plugins/variants/src/StructuralVariantChordRenderer/index.ts","../../../plugins/variants/src/VariantFeatureWidget/index.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/VariantTrack/index.ts","../../../plugins/variants/src/VcfAdapter/index.ts","../../../plugins/variants/src/VcfTabixAdapter/index.ts","../../../plugins/variants/src/extensionPoints.ts","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/wiggle/src/WiggleBaseRenderer.tsx","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/QuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/configSchema.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/configSchema.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/DensityRenderer/configSchema.ts","../../../plugins/wiggle/src/util.ts","../../../plugins/wiggle/src/drawxy.ts","../../../plugins/wiggle/src/DensityRenderer/DensityRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/configSchema.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.ts","../../../plugins/wiggle/src/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/YScaleBar.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/models/model.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/configSchema.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/components/YScaleBar.tsx","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/models/model.tsx","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/index.ts","../../../plugins/wiggle/src/MultiLinearWiggleDisplay/models/configSchema.ts","../../../plugins/wiggle/src/MultiWiggleRendering.tsx","../../../plugins/wiggle/src/MultiXYPlotRenderer/MultiXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/MultiRowXYPlotRenderer.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiDensityRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiDensityRenderer/MultiDensityRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/MultiLineRenderer.ts","../../../plugins/wiggle/src/MultiLineRenderer/configSchema.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/MultiRowLineRenderer.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/configSchema.ts","../../../plugins/wiggle/src/CreateMultiWiggleExtension/index.ts","../../../plugins/wiggle/src/MultiWiggleAddTrackWidget/AddTrackWorkflow.tsx","../../../plugins/wiggle/src/MultiWiggleAddTrackWidget/index.ts","../../../plugins/wiggle/src/WiggleRPC/rpcMethods.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/MultiWiggleAdapter/index.ts","../../../plugins/wiggle/src/BigWigAdapter/index.ts","../../../plugins/wiggle/src/QuantitativeTrack/index.ts","../../../plugins/wiggle/src/MultiQuantitativeTrack/index.ts","../../../plugins/wiggle/src/LinePlotRenderer/index.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/MultiXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiRowXYPlotRenderer/index.ts","../../../plugins/wiggle/src/MultiDensityRenderer/index.ts","../../../plugins/wiggle/src/MultiLineRenderer/index.ts","../../../plugins/wiggle/src/MultiRowLineRenderer/index.ts"],"sourcesContent":["import { types, addDisposer } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport clone from 'clone'\n\n// locals\nimport PluginManager from '../PluginManager'\nimport {\n  getConf,\n  ConfigurationSchema,\n  AnyConfigurationModel,\n} from '../configuration'\nimport { getSession } from '../util'\nimport { ElementId } from '../util/types/mst'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\n\ninterface Feat {\n  subfeatures?: Record<string, unknown>[]\n}\n\nfunction formatSubfeatures(\n  obj: Feat,\n  depth: number,\n  parse: (obj: Record<string, unknown>) => void,\n  currentDepth = 0,\n  returnObj = {} as Record<string, unknown>,\n) {\n  if (depth <= currentDepth) {\n    return returnObj\n  }\n  returnObj.subfeatures = obj.subfeatures?.map(sub => {\n    formatSubfeatures(sub, depth, parse, currentDepth + 1, returnObj)\n    return parse(sub)\n  })\n  return returnObj\n}\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('BaseFeatureWidget', {\n      id: ElementId,\n      type: types.literal('BaseFeatureWidget'),\n      featureData: types.frozen(),\n      formattedFields: types.frozen(),\n      unformattedFeatureData: types.frozen(),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      track: types.safeReference(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n      trackId: types.maybe(types.string),\n      trackType: types.maybe(types.string),\n    })\n    .actions(self => ({\n      setFeatureData(featureData: Record<string, unknown>) {\n        self.unformattedFeatureData = featureData\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n      setFormattedData(feat: Record<string, unknown>) {\n        self.featureData = feat\n      },\n      setExtra(type?: string, trackId?: string) {\n        self.trackId = trackId\n        self.trackType = type\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setExtra(self.track?.type, self.track?.configuration.trackId)\n            const { unformattedFeatureData, track } = self\n            const session = getSession(self)\n            if (unformattedFeatureData) {\n              const feature = clone(unformattedFeatureData)\n\n              const f = (\n                obj: { configuration: AnyConfigurationModel },\n                arg2: string,\n              ) => getConf(obj, ['formatDetails', arg2], { feature })\n\n              if (track) {\n                // eslint-disable-next-line no-underscore-dangle\n                feature.__jbrowsefmt = {\n                  ...f(session, 'feature'),\n                  ...f(track, 'feature'),\n                }\n                const depth = getConf(track, ['formatDetails', 'depth'])\n                formatSubfeatures(feature, depth, sub => {\n                  // eslint-disable-next-line no-underscore-dangle\n                  sub.__jbrowsefmt = {\n                    ...f(session, 'subfeature'),\n                    ...f(track, 'subfeature'),\n                  }\n                })\n              }\n\n              self.setFormattedData(feature)\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // @ts-ignore\n      const { featureData, finalizedFeatureData, ...rest } = snap\n      return {\n        unformattedFeatureData: featureData,\n        featureData: finalizedFeatureData,\n        ...rest,\n      }\n    })\n    .postProcessSnapshot(snap => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const { unformattedFeatureData, featureData, ...rest } = snap as Omit<\n        typeof snap,\n        symbol\n      >\n      // finalizedFeatureData avoids running formatter twice if loading from\n      // snapshot\n      return {\n        // replacing undefined with null helps with allowing fields to be\n        // hidden, setting null is not allowed by jexl so we set it to\n        // undefined to hide. see config guide. this replacement happens both\n        // here and when displaying the featureData in base feature widget\n        finalizedFeatureData: JSON.parse(\n          JSON.stringify(featureData, (_, v) =>\n            typeof v === 'undefined' ? null : v,\n          ),\n        ),\n        ...rest,\n      }\n    })\n}\n\nexport { configSchema, stateModelFactory }\n","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { toArray } from 'rxjs/operators'\nimport {\n  freeAdapterResources,\n  getAdapter,\n} from '../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../pluggableElementTypes/RpcMethodType'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport { RemoteAbortSignal } from './remoteAbortSignals'\nimport { isFeatureAdapter } from '../data_adapters/BaseAdapter'\nimport {\n  checkAbortSignal,\n  renameRegionsIfNeeded,\n  getLayoutId,\n  Region,\n} from '../util'\nimport SimpleFeature, { SimpleFeatureSerialized } from '../util/simpleFeature'\n\nexport class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (isFeatureAdapter(dataAdapter)) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\nexport class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetMetadata extends RpcMethodType {\n  name = 'CoreGetMetadata'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getMetadata(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetFeatures extends RpcMethodType {\n  name = 'CoreGetFeatures'\n\n  async deserializeReturn(\n    feats: SimpleFeatureSerialized[],\n    args: unknown,\n    rpcDriver: string,\n  ) {\n    const superDeserialized = (await super.deserializeReturn(\n      feats,\n      args,\n      rpcDriver,\n    )) as SimpleFeatureSerialized[]\n    return superDeserialized.map(feat => new SimpleFeature(feat))\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    return super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    ) as Promise<RenderArgs>\n  }\n\n  async execute(\n    args: {\n      sessionId: string\n      regions: Region[]\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      opts?: any\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { signal, sessionId, adapterConfig, regions, opts } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    const ret = dataAdapter.getFeaturesInMultipleRegions(regions, {\n      ...opts,\n      signal,\n    })\n    const r = await ret.pipe(toArray()).toPromise()\n    return r.map(f => f.toJSON())\n  }\n}\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(specification: {}) {\n    let deleteCount = 0\n\n    deleteCount += freeAdapterResources(specification)\n\n    // pass the freeResources hint along to all the renderers as well\n    this.pluginManager.getRendererTypes().forEach(renderer => {\n      const count = renderer.freeResources(/* specification */)\n      if (count) {\n        deleteCount += count\n      }\n    })\n\n    return deleteCount\n  }\n  async serializeArguments(args: {}, _rpcDriver: string): Promise<{}> {\n    return args\n  }\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  assemblyName: string\n  regions: Region[]\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport class CoreEstimateRegionStats extends RpcMethodType {\n  name = 'CoreEstimateRegionStats'\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriver: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriver)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      regions: Region[]\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriver: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    return dataAdapter.estimateRegionsStats(regions, deserializedArgs)\n  }\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    const result =\n      rpcDriver === 'MainThreadRpcDriver'\n        ? await RendererType.render(deserializedArgs)\n        : await RendererType.renderInWorker(deserializedArgs)\n\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const des = await super.deserializeReturn(serializedReturn, args, rpcDriver)\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return des\n    }\n\n    const { rendererType } = args\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n    return RendererType.deserializeResultsInClient(\n      des as ResultsSerialized,\n      args,\n    )\n  }\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreGetFeatureDetails extends RpcMethodType {\n  name = 'CoreGetFeatureDetails'\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel!.session!.assemblyManager\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriver,\n    )) as RenderArgs\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { rendererType, featureId } = deserializedArgs\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    // @ts-ignore\n    const sess = RendererType.sessions[getLayoutId(args)]\n    const { layout } = sess.cachedLayout\n    const xref = layout.getDataByID(featureId)\n\n    return { feature: xref.toJSON() }\n  }\n}\n\nfunction validateRendererType<T>(rendererType: string, RendererType: T) {\n  if (!RendererType) {\n    throw new Error(`renderer \"${rendererType}\" not found`)\n  }\n  // @ts-ignore\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n\n  if (!(RendererType instanceof ServerSideRendererType)) {\n    throw new Error(\n      'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n    )\n  }\n  return RendererType\n}\n","import SimpleFeature from '../util/simpleFeature'\nimport { ConfigurationSchema, readConfObject } from '../configuration'\nimport { openLocation } from '../util/io'\nimport { BaseAdapter } from './BaseAdapter'\n\n/**\n * #config CytobandAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CytobandAdapter',\n  {\n    /**\n     * #slot\n     */\n    cytobandLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/cytoband.txt.gz' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nclass CytobandAdapter extends BaseAdapter {\n  async getData() {\n    const loc = readConfObject(this.config, 'cytobandLocation')\n    if (loc.uri === '' || loc.uri === '/path/to/cytoband.txt.gz') {\n      return []\n    }\n    const data = await openLocation(loc).readFile('utf8')\n    return data\n      .split(/\\n|\\r\\n|\\r/)\n      .filter(f => !!f.trim())\n      .map(line => {\n        const [refName, start, end, name, type] = line.split('\\t')\n        return new SimpleFeature({\n          uniqueId: line,\n          refName,\n          start: +start,\n          end: +end,\n          name,\n          type,\n        })\n      })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n\nexport { configSchema, CytobandAdapter as DataAdapter }\n","import { lazy } from 'react'\nimport { configSchema, stateModelFactory } from './BaseFeatureWidget'\nimport Plugin from './Plugin'\nimport PluginManager from './PluginManager'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport {\n  configSchema as cytobandConfigSchema,\n  DataAdapter,\n} from './data_adapters/CytobandAdapter'\n\n// the core plugin, which registers types that ALL JBrowse applications are\n// expected to need.\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    Object.values(coreRpcMethods).forEach(RpcMethod => {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    })\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'CytobandAdapter',\n          configSchema: cytobandConfigSchema,\n          AdapterClass: DataAdapter,\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'BaseFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./BaseFeatureWidget/BaseFeatureDetail'),\n        ),\n      })\n    })\n  }\n}\n","import PluginManager from './PluginManager'\nimport { AnyConfigurationSchemaType } from './configuration/configurationSchema'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  url?: string\n\n  version?: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n\n  configurationSchema: AnyConfigurationSchemaType | undefined = undefined\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","/**\n * Used by plugin build systems to determine if a module is provided by JBrowse\n * globally and thus doesn't need to be bundled. A check in ./modules.tsx makes\n * sure this is in sync with the re-exported modules.\n */\nexport default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react-dom',\n  'mobx-react',\n  '@mui/x-data-grid',\n  '@mui/material/utils',\n  '@material-ui/core/utils',\n  'tss-react/mui',\n  '@material-ui/core',\n  '@mui/material',\n  'prop-types',\n\n  '@mui/material/styles',\n  '@material-ui/core/styles',\n  '@material-ui/core/Accordion',\n  '@material-ui/core/AccordionActions',\n  '@material-ui/core/AccordionDetails',\n  '@material-ui/core/Alert',\n  '@material-ui/core/AlertTitle',\n  '@material-ui/core/Autocomplete',\n  '@material-ui/core/Avatar',\n  '@material-ui/core/AvatarGroup',\n  '@material-ui/core/Backdrop',\n  '@material-ui/core/Badge',\n  '@material-ui/core/Box',\n  '@material-ui/core/Breadcrumbs',\n  '@material-ui/core/Button',\n  '@material-ui/core/ButtonGroup',\n  '@material-ui/core/Card',\n  '@material-ui/core/CardActions',\n  '@material-ui/core/CardActionArea',\n  '@material-ui/core/CardContent',\n  '@material-ui/core/CardHeader',\n  '@material-ui/core/CardMedia',\n  '@material-ui/core/CircularProgress',\n  '@material-ui/core/Collapse',\n  '@material-ui/core/ClickAwayListener',\n  '@material-ui/core/Chip',\n  '@material-ui/core/Checkbox',\n  '@material-ui/core/Container',\n  '@material-ui/core/Dialog',\n  '@material-ui/core/DialogActions',\n  '@material-ui/core/DialogTitle',\n  '@material-ui/core/DialogContent',\n  '@material-ui/core/DialogContentText',\n  '@material-ui/core/Divider',\n  '@material-ui/core/Drawer',\n  '@material-ui/core/Fab',\n  '@material-ui/core/Fade',\n  '@material-ui/core/FilledInput',\n  '@material-ui/core/FormLabel',\n  '@material-ui/core/FormControl',\n  '@material-ui/core/FormControlLabel',\n  '@material-ui/core/FormHelperText',\n  '@material-ui/core/FormGroup',\n  '@material-ui/core/Grid',\n  '@material-ui/core/Grow',\n  '@material-ui/core/Icon',\n  '@material-ui/core/IconButton',\n  '@material-ui/core/Input',\n  '@material-ui/core/InputBase',\n  '@material-ui/core/InputLabel',\n  '@material-ui/core/InputAdornment',\n  '@material-ui/core/Link',\n  '@material-ui/core/LinearProgress',\n  '@material-ui/core/List',\n  '@material-ui/core/ListItem',\n  '@material-ui/core/ListItemAvatar',\n  '@material-ui/core/ListItemSecondaryAction',\n  '@material-ui/core/ListItemIcon',\n  '@material-ui/core/ListSubheader',\n  '@material-ui/core/ListItemText',\n  '@material-ui/core/Menu',\n  '@material-ui/core/MenuItem',\n  '@material-ui/core/MenuList',\n  '@material-ui/core/Modal',\n  '@material-ui/core/NativeSelect',\n  '@material-ui/core/OutlinedInput',\n  '@material-ui/core/Pagination',\n  '@material-ui/core/PaginationItem',\n  '@material-ui/core/Paper',\n  '@material-ui/core/Popover',\n  '@material-ui/core/Popper',\n  '@material-ui/core/Portal',\n  '@material-ui/core/Radio',\n  '@material-ui/core/RadioGroup',\n  '@material-ui/core/Rating',\n  '@material-ui/core/ScopedCssBaseline',\n  '@material-ui/core/Select',\n  '@material-ui/core/Skeleton',\n  '@material-ui/core/Slider',\n  '@material-ui/core/Snackbar',\n  '@material-ui/core/SnackbarContent',\n  '@material-ui/core/SpeedDial',\n  '@material-ui/core/SpeedDialAction',\n  '@material-ui/core/SpeedDialIcon',\n  '@material-ui/core/Stack',\n  '@material-ui/core/Step',\n  '@material-ui/core/StepButton',\n  '@material-ui/core/StepConnector',\n  '@material-ui/core/StepLabel',\n  '@material-ui/core/StepIcon',\n  '@material-ui/core/Stepper',\n  '@material-ui/core/SvgIcon',\n  '@material-ui/core/Switch',\n  '@material-ui/core/Tab',\n  '@material-ui/core/Table',\n  '@material-ui/core/TableBody',\n  '@material-ui/core/TableCell',\n  '@material-ui/core/TableContainer',\n  '@material-ui/core/TableFooter',\n  '@material-ui/core/TableHead',\n  '@material-ui/core/TablePagination',\n  '@material-ui/core/TableRow',\n  '@material-ui/core/TableSortLabel',\n  '@material-ui/core/Tabs',\n  '@material-ui/core/TextField',\n  '@material-ui/core/TextareaAutosize',\n  '@material-ui/core/ToggleButton',\n  '@material-ui/core/ToggleButtonGroup',\n  '@material-ui/core/Toolbar',\n  '@material-ui/core/Tooltip',\n  '@material-ui/core/Typography',\n  '@mui/material/Accordion',\n  '@mui/material/AccordionActions',\n  '@mui/material/AccordionDetails',\n  '@mui/material/Alert',\n  '@mui/material/AlertTitle',\n  '@mui/material/Autocomplete',\n  '@mui/material/Avatar',\n  '@mui/material/AvatarGroup',\n  '@mui/material/Backdrop',\n  '@mui/material/Badge',\n  '@mui/material/Box',\n  '@mui/material/Breadcrumbs',\n  '@mui/material/Button',\n  '@mui/material/ButtonGroup',\n  '@mui/material/Card',\n  '@mui/material/CardActions',\n  '@mui/material/CardActionArea',\n  '@mui/material/CardContent',\n  '@mui/material/CardHeader',\n  '@mui/material/CardMedia',\n  '@mui/material/CircularProgress',\n  '@mui/material/Collapse',\n  '@mui/material/ClickAwayListener',\n  '@mui/material/Chip',\n  '@mui/material/Checkbox',\n  '@mui/material/Container',\n  '@mui/material/Dialog',\n  '@mui/material/DialogActions',\n  '@mui/material/DialogTitle',\n  '@mui/material/DialogContent',\n  '@mui/material/DialogContentText',\n  '@mui/material/Divider',\n  '@mui/material/Drawer',\n  '@mui/material/Fab',\n  '@mui/material/Fade',\n  '@mui/material/FilledInput',\n  '@mui/material/FormLabel',\n  '@mui/material/FormControl',\n  '@mui/material/FormControlLabel',\n  '@mui/material/FormHelperText',\n  '@mui/material/FormGroup',\n  '@mui/material/Grid',\n  '@mui/material/Grow',\n  '@mui/material/Icon',\n  '@mui/material/IconButton',\n  '@mui/material/Input',\n  '@mui/material/InputBase',\n  '@mui/material/InputLabel',\n  '@mui/material/InputAdornment',\n  '@mui/material/Link',\n  '@mui/material/LinearProgress',\n  '@mui/material/List',\n  '@mui/material/ListItem',\n  '@mui/material/ListItemAvatar',\n  '@mui/material/ListItemSecondaryAction',\n  '@mui/material/ListItemIcon',\n  '@mui/material/ListSubheader',\n  '@mui/material/ListItemText',\n  '@mui/material/Menu',\n  '@mui/material/MenuItem',\n  '@mui/material/MenuList',\n  '@mui/material/Modal',\n  '@mui/material/NativeSelect',\n  '@mui/material/OutlinedInput',\n  '@mui/material/Pagination',\n  '@mui/material/PaginationItem',\n  '@mui/material/Paper',\n  '@mui/material/Popover',\n  '@mui/material/Popper',\n  '@mui/material/Portal',\n  '@mui/material/Radio',\n  '@mui/material/RadioGroup',\n  '@mui/material/Rating',\n  '@mui/material/ScopedCssBaseline',\n  '@mui/material/Select',\n  '@mui/material/Skeleton',\n  '@mui/material/Slider',\n  '@mui/material/Snackbar',\n  '@mui/material/SnackbarContent',\n  '@mui/material/SpeedDial',\n  '@mui/material/SpeedDialAction',\n  '@mui/material/SpeedDialIcon',\n  '@mui/material/Stack',\n  '@mui/material/Step',\n  '@mui/material/StepButton',\n  '@mui/material/StepConnector',\n  '@mui/material/StepLabel',\n  '@mui/material/StepIcon',\n  '@mui/material/Stepper',\n  '@mui/material/SvgIcon',\n  '@mui/material/Switch',\n  '@mui/material/Tab',\n  '@mui/material/Table',\n  '@mui/material/TableBody',\n  '@mui/material/TableCell',\n  '@mui/material/TableContainer',\n  '@mui/material/TableFooter',\n  '@mui/material/TableHead',\n  '@mui/material/TablePagination',\n  '@mui/material/TableRow',\n  '@mui/material/TableSortLabel',\n  '@mui/material/Tabs',\n  '@mui/material/TextField',\n  '@mui/material/TextareaAutosize',\n  '@mui/material/ToggleButton',\n  '@mui/material/ToggleButtonGroup',\n  '@mui/material/Toolbar',\n  '@mui/material/Tooltip',\n  '@mui/material/Typography',\n  '@material-ui/lab/ToggleButton',\n  '@material-ui/lab/ToggleButtonGroup',\n  '@material-ui/lab/Autocomplete',\n  '@material-ui/lab/Alert',\n  '@material-ui/lab',\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/layouts',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/util/rxjs',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","// this is all the stuff that the pluginManager re-exports for plugins to use\nimport React, { lazy, LazyExoticComponent, Suspense } from 'react'\nimport * as ReactDom from 'react-dom'\nimport * as mobx from 'mobx'\nimport * as mst from 'mobx-state-tree'\nimport * as mxreact from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport PropTypes from 'prop-types'\n\nimport * as MUIStyles from '@mui/material/styles'\nimport * as MUIUtils from '@mui/material/utils'\nimport { useTheme } from '@mui/material'\nimport {\n  useGridApiContext,\n  useGridApiRef,\n  useGridRootProps,\n} from '@mui/x-data-grid'\n\n// material-ui lab\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\n\nimport Base1DView from '../util/Base1DViewModel'\nimport * as pluggableElementTypes from '../pluggableElementTypes'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\n\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport * as ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport * as BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\nimport * as FeatureRendererType from '../pluggableElementTypes/renderers/FeatureRendererType'\nimport * as RendererType from '../pluggableElementTypes/renderers/RendererType'\n\nimport * as Configuration from '../configuration'\nimport Plugin from '../Plugin'\nimport * as coreUi from '../ui'\nimport * as coreUtil from '../util'\nimport * as coreColor from '../util/color'\nimport * as coreLayouts from '../util/layouts'\nimport * as trackUtils from '../util/tracks'\nimport * as coreIo from '../util/io'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as rxjs from '../util/rxjs'\nimport * as mstTypes from '../util/types/mst'\n\nimport reExportsList from './list'\n\nconst Entries = {\n  Accordion: lazy(() => import('@mui/material/Accordion')),\n  AccordionActions: lazy(() => import('@mui/material/AccordionActions')),\n  AccordionDetails: lazy(() => import('@mui/material/AccordionDetails')),\n  Alert: lazy(() => import('@mui/material/Alert')),\n  AlertTitle: lazy(() => import('@mui/material/AlertTitle')),\n  Autocomplete: lazy(() => import('@mui/material/Autocomplete')),\n  Avatar: lazy(() => import('@mui/material/Avatar')),\n  AvatarGroup: lazy(() => import('@mui/material/AvatarGroup')),\n  Backdrop: lazy(() => import('@mui/material/Backdrop')),\n  Badge: lazy(() => import('@mui/material/Badge')),\n  Box: lazy(() => import('@mui/material/Box')),\n  Breadcrumbs: lazy(() => import('@mui/material/Breadcrumbs')),\n  Button: lazy(() => import('@mui/material/Button')),\n  ButtonGroup: lazy(() => import('@mui/material/ButtonGroup')),\n  Card: lazy(() => import('@mui/material/Card')),\n  CardActions: lazy(() => import('@mui/material/CardActions')),\n  CardActionArea: lazy(() => import('@mui/material/CardActionArea')),\n  CardContent: lazy(() => import('@mui/material/CardContent')),\n  CardHeader: lazy(() => import('@mui/material/CardHeader')),\n  CardMedia: lazy(() => import('@mui/material/CardMedia')),\n  CircularProgress: lazy(() => import('@mui/material/CircularProgress')),\n  Collapse: lazy(() => import('@mui/material/Collapse')),\n  ClickAwayListener: lazy(() => import('@mui/material/ClickAwayListener')),\n  Chip: lazy(() => import('@mui/material/Chip')),\n  Checkbox: lazy(() => import('@mui/material/Checkbox')),\n  Container: lazy(() => import('@mui/material/Container')),\n  Dialog: lazy(() => import('@mui/material/Dialog')),\n  DialogActions: lazy(() => import('@mui/material/DialogActions')),\n  DialogTitle: lazy(() => import('@mui/material/DialogTitle')),\n  DialogContent: lazy(() => import('@mui/material/DialogContent')),\n  DialogContentText: lazy(() => import('@mui/material/DialogContentText')),\n  Divider: lazy(() => import('@mui/material/Divider')),\n  Drawer: lazy(() => import('@mui/material/Drawer')),\n  Fab: lazy(() => import('@mui/material/Fab')),\n  Fade: lazy(() => import('@mui/material/Fade')),\n  FilledInput: lazy(() => import('@mui/material/FilledInput')),\n  FormLabel: lazy(() => import('@mui/material/FormLabel')),\n  FormControl: lazy(() => import('@mui/material/FormControl')),\n  FormControlLabel: lazy(() => import('@mui/material/FormControlLabel')),\n  FormHelperText: lazy(() => import('@mui/material/FormHelperText')),\n  FormGroup: lazy(() => import('@mui/material/FormGroup')),\n  Grid: lazy(() => import('@mui/material/Grid')),\n  Grow: lazy(() => import('@mui/material/Grow')),\n  Icon: lazy(() => import('@mui/material/Icon')),\n  IconButton: lazy(() => import('@mui/material/IconButton')),\n  Input: lazy(() => import('@mui/material/Input')),\n  InputBase: lazy(() => import('@mui/material/InputBase')),\n  InputLabel: lazy(() => import('@mui/material/InputLabel')),\n  InputAdornment: lazy(() => import('@mui/material/InputAdornment')),\n  Link: lazy(() => import('@mui/material/Link')),\n  LinearProgress: lazy(() => import('@mui/material/LinearProgress')),\n  List: lazy(() => import('@mui/material/List')),\n  ListItem: lazy(() => import('@mui/material/ListItem')),\n  ListItemAvatar: lazy(() => import('@mui/material/ListItemAvatar')),\n  ListItemSecondaryAction: lazy(\n    () => import('@mui/material/ListItemSecondaryAction'),\n  ),\n  ListItemIcon: lazy(() => import('@mui/material/ListItemIcon')),\n  ListSubheader: lazy(() => import('@mui/material/ListSubheader')),\n  ListItemText: lazy(() => import('@mui/material/ListItemText')),\n  Menu: lazy(() => import('@mui/material/Menu')),\n  MenuItem: lazy(() => import('@mui/material/MenuItem')),\n  MenuList: lazy(() => import('@mui/material/MenuList')),\n  Modal: lazy(() => import('@mui/material/Modal')),\n  NativeSelect: lazy(() => import('@mui/material/NativeSelect')),\n  OutlinedInput: lazy(() => import('@mui/material/OutlinedInput')),\n  Pagination: lazy(() => import('@mui/material/Pagination')),\n  PaginationItem: lazy(() => import('@mui/material/PaginationItem')),\n  Paper: lazy(() => import('@mui/material/Paper')),\n  Popover: lazy(() => import('@mui/material/Popover')),\n  Popper: lazy(() => import('@mui/material/Popper')),\n  Portal: lazy(() => import('@mui/material/Portal')),\n  Radio: lazy(() => import('@mui/material/Radio')),\n  RadioGroup: lazy(() => import('@mui/material/RadioGroup')),\n  Rating: lazy(() => import('@mui/material/Rating')),\n  ScopedCssBaseline: lazy(() => import('@mui/material/ScopedCssBaseline')),\n  Select: lazy(() => import('@mui/material/Select')),\n  Skeleton: lazy(() => import('@mui/material/Skeleton')),\n  Slider: lazy(() => import('@mui/material/Slider')),\n  Snackbar: lazy(() => import('@mui/material/Snackbar')),\n  SnackbarContent: lazy(() => import('@mui/material/SnackbarContent')),\n  SpeedDial: lazy(() => import('@mui/material/SpeedDial')),\n  SpeedDialAction: lazy(() => import('@mui/material/SpeedDialAction')),\n  SpeedDialIcon: lazy(() => import('@mui/material/SpeedDialIcon')),\n  Stack: lazy(() => import('@mui/material/Stack')),\n  Step: lazy(() => import('@mui/material/Step')),\n  StepButton: lazy(() => import('@mui/material/StepButton')),\n  StepConnector: lazy(() => import('@mui/material/StepConnector')),\n  StepLabel: lazy(() => import('@mui/material/StepLabel')),\n  StepIcon: lazy(() => import('@mui/material/StepIcon')),\n  Stepper: lazy(() => import('@mui/material/Stepper')),\n  SvgIcon: lazy(() => import('@mui/material/SvgIcon')),\n  Switch: lazy(() => import('@mui/material/Switch')),\n  Tab: lazy(() => import('@mui/material/Tab')),\n  Table: lazy(() => import('@mui/material/Table')),\n  TableBody: lazy(() => import('@mui/material/TableBody')),\n  TableCell: lazy(() => import('@mui/material/TableCell')),\n  TableContainer: lazy(() => import('@mui/material/TableContainer')),\n  TableFooter: lazy(() => import('@mui/material/TableFooter')),\n  TableHead: lazy(() => import('@mui/material/TableHead')),\n  TablePagination: lazy(() => import('@mui/material/TablePagination')),\n  TableRow: lazy(() => import('@mui/material/TableRow')),\n  TableSortLabel: lazy(() => import('@mui/material/TableSortLabel')),\n  Tabs: lazy(() => import('@mui/material/Tabs')),\n  TextField: lazy(() => import('@mui/material/TextField')),\n  TextareaAutosize: lazy(() => import('@mui/material/TextareaAutosize')),\n  ToggleButton: lazy(() => import('@mui/material/ToggleButton')),\n  ToggleButtonGroup: lazy(() => import('@mui/material/ToggleButtonGroup')),\n  Toolbar: lazy(() => import('@mui/material/Toolbar')),\n  Tooltip: lazy(() => import('@mui/material/Tooltip')),\n  Typography: lazy(() => import('@mui/material/Typography')),\n}\n\nconst LazyMUICore = Object.fromEntries(\n  Object.entries(Entries).map(([key, ReactComponent]) => [\n    key,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (props: any) => (\n      <Suspense fallback={<div />}>\n        <ReactComponent {...props} />\n      </Suspense>\n    ),\n  ]),\n)\n\nconst MaterialPrefixMUI = Object.fromEntries(\n  Object.entries(LazyMUICore).map(([key, value]) => [\n    '@material-ui/core/' + key,\n    value,\n  ]),\n)\n\nconst MuiPrefixMUI = Object.fromEntries(\n  Object.entries(LazyMUICore).map(([key, value]) => [\n    '@mui/material/' + key,\n    value,\n  ]),\n)\n\nconst Attributes = lazy(() => import('./Attributes'))\nconst FeatureDetails = lazy(() => import('./FeatureDetails'))\nconst BaseCard = lazy(() => import('./BaseCard'))\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst DataGridEntries: Record<string, LazyExoticComponent<any>> = {\n  DataGrid: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.DataGrid })),\n  ),\n  GridActionsCellItem: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridActionsCellItem,\n    })),\n  ),\n  GridAddIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridAddIcon,\n    })),\n  ),\n  GridArrowDownwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowDownwardIcon,\n    })),\n  ),\n  GridArrowUpwardIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridArrowUpwardIcon,\n    })),\n  ),\n  GridAutoSizer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridAutoSizer,\n    })),\n  ),\n  GridCellCheckboxForwardRef: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxForwardRef,\n    })),\n  ),\n  GridCellCheckboxRenderer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCellCheckboxRenderer,\n    })),\n  ),\n  GridCheckCircleIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckCircleIcon,\n    })),\n  ),\n  GridCheckIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCheckIcon,\n    })),\n  ),\n  GridCloseIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridCloseIcon,\n    })),\n  ),\n  GridColumnHeaderSeparator: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSeparator,\n    })),\n  ),\n  GridColumnHeaderSortIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnHeaderSortIcon,\n    })),\n  ),\n  GridColumnIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnIcon,\n    })),\n  ),\n  GridColumnMenu: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenu,\n    })),\n  ),\n  GridColumnMenuContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridColumnMenuContainer,\n    })),\n  ),\n  GridDragIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridDragIcon,\n    })),\n  ),\n  GridExpandMoreIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridExpandMoreIcon,\n    })),\n  ),\n  GridFilterAltIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterAltIcon,\n    })),\n  ),\n  GridFilterForm: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterForm,\n    })),\n  ),\n  GridFilterListIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterListIcon,\n    })),\n  ),\n  GridFilterPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFilterPanel,\n    })),\n  ),\n  GridFooter: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridFooter })),\n  ),\n  GridFooterContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridFooterContainer,\n    })),\n  ),\n  GridHeader: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridHeader })),\n  ),\n  GridHeaderCheckbox: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridHeaderCheckbox,\n    })),\n  ),\n  GridKeyboardArrowRight: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridKeyboardArrowRight,\n    })),\n  ),\n  GridLoadIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadIcon,\n    })),\n  ),\n  GridLoadingOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridLoadingOverlay,\n    })),\n  ),\n  GridMenuIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMenuIcon,\n    })),\n  ),\n  GridMoreVertIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridMoreVertIcon,\n    })),\n  ),\n  GridNoRowsOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridNoRowsOverlay,\n    })),\n  ),\n  GridOverlay: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridOverlay,\n    })),\n  ),\n  GridPagination: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPagination,\n    })),\n  ),\n  GridPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridPanel })),\n  ),\n  GridPanelWrapper: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPanelWrapper,\n    })),\n  ),\n  GridPreferencesPanel: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridPreferencesPanel,\n    })),\n  ),\n  GridRemoveIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRemoveIcon,\n    })),\n  ),\n  GridRoot: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({ default: module.GridRoot })),\n  ),\n  GridRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridRowCount,\n    })),\n  ),\n  GridSaveAltIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSaveAltIcon,\n    })),\n  ),\n  GridScrollArea: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridScrollArea,\n    })),\n  ),\n  GridSearchIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSearchIcon,\n    })),\n  ),\n  GridSelectedRowCount: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSelectedRowCount,\n    })),\n  ),\n  GridSeparatorIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridSeparatorIcon,\n    })),\n  ),\n  GridTableRowsIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTableRowsIcon,\n    })),\n  ),\n  GridToolbar: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbar,\n    })),\n  ),\n  GridToolbarColumnsButton: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarColumnsButton,\n    })),\n  ),\n  GridToolbarContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarContainer,\n    })),\n  ),\n  GridToolbarDensitySelector: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarDensitySelector,\n    })),\n  ),\n  GridToolbarExport: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarExport,\n    })),\n  ),\n  GridToolbarExportContainer: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarExportContainer,\n    })),\n  ),\n  GridToolbarFilterButton: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridToolbarFilterButton,\n    })),\n  ),\n  GridTripleDotsVerticalIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridTripleDotsVerticalIcon,\n    })),\n  ),\n  GridViewHeadlineIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewHeadlineIcon,\n    })),\n  ),\n  GridViewStreamIcon: lazy(() =>\n    import('@mui/x-data-grid').then(module => ({\n      default: module.GridViewStreamIcon,\n    })),\n  ),\n}\n\nconst LazyDataGridComponents = Object.fromEntries(\n  Object.entries(DataGridEntries).map(([key, ReactComponent]) => [\n    key,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (props: any) => (\n      <Suspense fallback={<div />}>\n        <ReactComponent {...props} />\n      </Suspense>\n    ),\n  ]),\n)\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyAttributes = (props: any) => (\n  <Suspense fallback={<div />}>\n    <Attributes {...props} />\n  </Suspense>\n)\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyFeatureDetails = (props: any) => (\n  <Suspense fallback={<div />}>\n    <FeatureDetails {...props} />\n  </Suspense>\n)\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LazyBaseCard = (props: any) => (\n  <Suspense fallback={<div />}>\n    <BaseCard {...props} />\n  </Suspense>\n)\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react-dom': ReactDom,\n  'mobx-react': mxreact,\n  '@mui/x-data-grid': {\n    useGridApiContext,\n    useGridApiRef,\n    useGridRootProps,\n    ...LazyDataGridComponents,\n  },\n\n  // special case so plugins can easily use @mui/icons-material; don't remove\n  '@mui/material/utils': MUIUtils,\n  '@material-ui/core/utils': MUIUtils,\n  'tss-react/mui': { makeStyles },\n\n  '@material-ui/core': {\n    ...LazyMUICore,\n    useTheme,\n    alpha: MUIStyles.alpha,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    makeStyles: (args: any) => {\n      const useStyles = makeStyles()(args)\n      return () => useStyles().classes\n    },\n  },\n  '@mui/material': LazyMUICore,\n  'prop-types': PropTypes,\n\n  // end special case\n  // material-ui subcomponents, should get rid of these\n  '@mui/material/styles': MUIStyles,\n  '@material-ui/core/styles': MUIStyles,\n  ...MaterialPrefixMUI,\n  ...MuiPrefixMUI,\n\n  // these are core in @mui/material, but used to be in @material-ui/lab\n  '@material-ui/lab/ToggleButton': Entries.ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': Entries.ToggleButtonGroup,\n  '@material-ui/lab/Autocomplete': Entries.Autocomplete,\n  '@material-ui/lab/Alert': Entries.Alert,\n  '@material-ui/lab': {\n    Alert: Entries.Alert,\n    Autocomplete: Entries.Autocomplete,\n    ToggleButton: Entries.ToggleButton,\n    ToggleButtonGroup: Entries.ToggleButtonGroup,\n  },\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes': pluggableElementTypes,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType':\n    ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType':\n    CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType':\n    BoxRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType':\n    FeatureRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType': RendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/layouts': coreLayouts,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/util/rxjs': rxjs,\n\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': {\n    Attributes: LazyAttributes,\n    FeatureDetails: LazyFeatureDetails,\n    BaseCard: LazyBaseCard,\n  },\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\nconst libsList = Array.from(Object.keys(libs))\n\n// make sure that all the items in the ReExports/list array (used by build\n// systems and such) are included here, and vice versa\nconst inLibsOnly = libsList.filter(mod => !reExportsList.includes(mod))\nif (inLibsOnly.length) {\n  throw new Error(\n    `The following modules are in the re-exports list, but not the modules libs: ${inLibsOnly.join(\n      ', ',\n    )}`,\n  )\n}\nconst inReExportsOnly = reExportsList.filter(mod => !libsList.includes(mod))\nif (inReExportsOnly.length) {\n  throw new Error(\n    `The following modules are in the modules libs, but not the re-exports list: ${inReExportsOnly.join(\n      ', ',\n    )}`,\n  )\n}\n\nexport default libs\n","import modules from './modules'\n\nexport default modules\n","import React from 'react'\nimport TextSearchAdapterType from '../pluggableElementTypes/TextSearchAdapterType'\nimport { SearchType } from '../data_adapters/BaseAdapter'\n\nexport interface BaseResultArgs {\n  label: string\n\n  displayString?: string\n\n  renderingComponent?: React.ReactElement\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  locString?: string\n\n  refName?: string\n\n  trackId?: string\n\n  score?: number\n\n  results?: BaseResult[]\n}\n\nexport default class BaseResult {\n  label: string\n\n  renderingComponent?: React.ReactElement\n\n  displayString?: string\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  trackId?: string\n\n  score: number\n\n  locString?: string\n\n  results?: BaseResult[]\n  constructor(args: BaseResultArgs) {\n    this.label = args.label\n    this.locString = args.locString\n    this.renderingComponent = args.renderingComponent\n    this.displayString = args.displayString\n    this.matchedAttribute = args.matchedAttribute\n    this.matchedObject = args.matchedObject\n    this.textSearchAdapter = args.textSearchAdapter\n    this.relevance = args.relevance\n    this.trackId = args.trackId\n    this.score = args.score || 1\n    this.results = args.results || []\n  }\n\n  getLabel() {\n    return this.label\n  }\n\n  getDisplayString() {\n    return this.displayString || this.label\n  }\n\n  getRenderingComponent() {\n    return this.renderingComponent\n  }\n\n  getTrackId() {\n    return this.trackId\n  }\n\n  getScore() {\n    return this.score\n  }\n\n  updateScore(newScore: number) {\n    this.score = newScore\n    return this.score\n  }\n\n  getId() {\n    return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`\n  }\n\n  hasLocation() {\n    return !!this.locString\n  }\n\n  getLocation() {\n    return this.locString\n  }\n\n  getComboResults() {\n    return this.results\n  }\n}\n\nexport class RefSequenceResult extends BaseResult {\n  refName: string\n\n  constructor(args: BaseResultArgs) {\n    super(args)\n    this.refName = args.refName ?? ''\n  }\n\n  getLocation() {\n    return this.refName\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, IAnyModelType, IAnyComplexType } from 'mobx-state-tree'\nimport { stringToJexlExpression } from '../util/jexlStrings'\nimport { FileLocation } from '../util/types/mst'\nimport { getEnv } from '../util'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: { [typeName: string]: any } = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: { [typeName: string]: any } = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt', locationType: 'UriLocation' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: { [typeName: string]: (self: any) => any } = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\n// const FunctionStringType = types.refinement(\n//   'FunctionString',\n//   types.string,\n//   str => functionRegexp.test(str),\n// )\n\nconst JexlStringType = types.refinement('JexlString', types.string, str =>\n  str.startsWith('jexl:'),\n)\n\nexport interface ConfigSlotDefinition {\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  contextVariable?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    contextVariable = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) {\n    throw new Error('type name required')\n  }\n  if (!model) {\n    model = typeModels[type]\n  }\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) {\n    throw new Error(\"no 'defaultValue' provided\")\n  }\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(types.union(JexlStringType, model), defaultValue),\n    })\n    .volatile(() => ({\n      contextVariable,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return String(self.value).startsWith('jexl:')\n      },\n    }))\n    .views(self => ({\n      get expr() {\n        if (self.isCallback) {\n          // compile as jexl function\n          const { pluginManager } = getEnv(self)\n          if (!pluginManager && typeof jest === 'undefined') {\n            console.warn(\n              'no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)',\n            )\n          }\n          return stringToJexlExpression(String(self.value), pluginManager?.jexl)\n        }\n        return { evalSync: () => self.value }\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) {\n          return undefined\n        }\n        function json(value: { toJSON: Function } | any) {\n          if (value && value.toJSON) {\n            return value.toJSON()\n          }\n          return `\"${value}\"`\n        }\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(val =>\n      typeof val === 'object' && val.name === slotName\n        ? val\n        : {\n            name: slotName,\n            description,\n            type,\n            value: val,\n          },\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object') {\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      }\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) {\n          return\n        }\n        self.value = `jexl:${self.valueJSON || \"''\"}`\n      },\n      convertToValue() {\n        if (!self.isCallback) {\n          return\n        }\n        // try calling it with no arguments\n        try {\n          const funcResult = self.expr.evalSync()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a callback),\n        // then use the last-resort fallback default\n\n        // if defaultValue has jexl: string, run this part\n        if (self.isCallback) {\n          if (!(type in fallbackDefaults)) {\n            throw new Error(`no fallbackDefault defined for type ${type}`)\n          }\n          self.value = fallbackDefaults[type]\n        }\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","import {\n  types,\n  isStateTreeNode,\n  isType,\n  isLateType,\n  getSnapshot,\n  Instance,\n  IAnyType,\n  SnapshotOut,\n} from 'mobx-state-tree'\n\nimport { ElementId } from '../util/types/mst'\n\nimport ConfigSlot, { ConfigSlotDefinition } from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\ninterface ConfigurationSchemaOptions {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: string\n  implicitIdentifier?: string | boolean\n  baseConfiguration?: AnyConfigurationSchemaType\n\n  actions?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  views?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  extend?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  preProcessSnapshot?: (snapshot: {}) => {}\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (\n    inputOptions.baseConfiguration &&\n    inputOptions.baseConfiguration.jbrowseSchemaDefinition\n  ) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...(inputOptions.baseConfiguration.jbrowseSchemaOptions || {}),\n      ...inputOptions,\n    }\n    delete options.baseConfiguration\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions,\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const modelDefinition: Record<string, any> = {}\n  let identifier\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier) {\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  }\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  Object.entries(schemaDefinition).forEach(([slotName, slotDefinition]) => {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  })\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(slotName: string, data: unknown) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const modelDefault = options.explicitlyTyped\n    ? { type: modelName, ...identifierDefault }\n    : identifierDefault\n\n  const defaultSnap = getSnapshot(completeModel.create(modelDefault))\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    let matchesDefault = true\n    // let keyCount = 0\n    for (const [key, value] of Object.entries(snap)) {\n      if (matchesDefault) {\n        if (typeof defaultSnap[key] === 'object' && typeof value === 'object') {\n          if (JSON.stringify(defaultSnap[key]) !== JSON.stringify(value)) {\n            matchesDefault = false\n          }\n        } else if (defaultSnap[key] !== value) {\n          matchesDefault = false\n        }\n      }\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    }\n    if (matchesDefault) {\n      return {}\n    }\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  return types.optional(completeModel, modelDefault)\n}\n\nexport interface AnyConfigurationSchemaType\n  extends ReturnType<typeof makeConfigurationSchemaModel> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: ConfigurationSchemaDefinition\n  jbrowseSchemaOptions: ConfigurationSchemaOptions\n  type: string\n}\n\nexport type AnyConfigurationModel = Instance<AnyConfigurationSchemaType>\n\nexport type ConfigurationModel<SCHEMA extends AnyConfigurationSchemaType> =\n  Instance<SCHEMA>\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions,\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: OPTIONS,\n) {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference(schemaType: IAnyType) {\n  return types.union(types.reference(schemaType), schemaType)\n}\n","import {\n  isStateTreeNode,\n  getSnapshot,\n  getType,\n  isMapType,\n  isType,\n  isUnionType,\n  isOptionalType,\n  isArrayType,\n  isModelType,\n  isLateType,\n} from 'mobx-state-tree'\n\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from './configurationSchema'\nimport {\n  getUnionSubTypes,\n  getDefaultValue,\n  getSubType,\n  resolveLateType,\n} from '../util/mst-reflection'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject(\n  confObject: AnyConfigurationModel,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): any {\n  if (!confObject) {\n    throw new TypeError('must provide conf object to read')\n  }\n  if (!slotPath) {\n    return JSON.parse(JSON.stringify(getSnapshot(confObject)))\n  }\n  if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefine\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    }\n\n    if (slot.expr) {\n      const appliedFunc = slot.expr.evalSync(args)\n      if (isStateTreeNode(appliedFunc)) {\n        return JSON.parse(JSON.stringify(getSnapshot(appliedFunc)))\n      }\n      return appliedFunc\n    }\n    if (isStateTreeNode(slot)) {\n      return JSON.parse(JSON.stringify(getSnapshot(slot)))\n    }\n    return slot\n  }\n\n  const slotName = slotPath[0]\n  if (slotPath.length > 1) {\n    const newPath = slotPath.slice(1)\n    let subConf = confObject[slotName]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !subConf &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      subConf = confObject.get(slotName)\n    }\n    return subConf ? readConfObject(subConf, newPath, args) : undefined\n  }\n  return readConfObject(confObject, slotName, args)\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf(\n  model: unknown,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n) {\n  if (!model) {\n    throw new TypeError('must provide a model object')\n  }\n  const { configuration } = model as { configuration: unknown }\n  if (isConfigurationModel(configuration)) {\n    return readConfObject(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-ignore\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      getUnionSubTypes(maybeUnionType).forEach(type => {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      })\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (!isType(thing)) {\n    return false\n  }\n\n  // written as a series of if-statements instead of a big logical OR\n  // because this construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because\n  // for example some union types are also optional types\n\n  if (isBareConfigurationSchemaType(thing)) {\n    return true\n  }\n\n  if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  }\n\n  if (isOptionalType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isArrayType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  return false\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","import { Observable, merge } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\nimport { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { ObservableCreate } from '../util/rxjs'\nimport { checkAbortSignal } from '../util'\nimport { Feature } from '../util/simpleFeature'\nimport {\n  readConfObject,\n  AnyConfigurationModel,\n  ConfigurationSchema,\n} from '../configuration'\nimport { getSubAdapterType } from './dataAdapterCache'\nimport { AugmentedRegion as Region, NoAssemblyRegion } from '../util/types'\nimport { blankStats, rectifyStats, scoresToStats } from '../util/stats'\nimport BaseResult from '../TextSearch/BaseResults'\nimport idMaker from '../util/idMaker'\nimport PluginManager from '../PluginManager'\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  bpPerPx?: number\n  sessionId?: string\n  statusCallback?: (message: string) => void\n  headers?: Record<string, string>\n  [key: string]: unknown\n}\n\nexport type SearchType = 'full' | 'prefix' | 'exact'\n\nexport interface BaseArgs {\n  searchType?: SearchType\n  queryString: string\n  signal?: AbortSignal\n  limit?: number\n  pageNumber?: number\n}\n// see\n// https://www.typescriptlang.org/docs/handbook/2/classes.html#abstract-construct-signatures\n// for why this is the abstract construct signature\nexport interface AnyAdapter {\n  new (\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager | undefined,\n  ): AnyDataAdapter\n}\n\nexport type AnyDataAdapter =\n  | BaseAdapter\n  | BaseFeatureDataAdapter\n  | BaseRefNameAliasAdapter\n  | BaseTextSearchAdapter\n  | RegionsAdapter\n  | BaseSequenceAdapter\n\nexport interface SequenceAdapter\n  extends BaseFeatureDataAdapter,\n    RegionsAdapter {}\n\nconst EmptyConfig = ConfigurationSchema('empty', {})\n\nexport abstract class BaseAdapter {\n  public id: string\n\n  static capabilities = [] as string[]\n\n  constructor(\n    public config: AnyConfigurationModel = EmptyConfig.create(),\n    public getSubAdapter?: getSubAdapterType,\n    public pluginManager?: PluginManager,\n  ) {\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(config) ? getSnapshot(config) : config\n      this.id = `${idMaker(data)}`\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  getConf(arg: string | string[]) {\n    return readConfObject(this.config, arg)\n  }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the forseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  public abstract freeResources(region: Region): void\n}\n\nexport interface Stats {\n  featureDensity?: number\n  fetchSizeLimit?: number\n  bytes?: number\n}\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter extends BaseAdapter {\n  /**\n   * Get all reference sequence names used in the data source\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract getRefNames(opts?: BaseOptions): Promise<string[]>\n  // public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  //   await this.setup()\n  //   const { refNames } = this.metadata\n  //   return refNames\n  // }\n  //\n\n  /**\n   * Get features from the data source that overlap a region\n   * @param region - Region\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n  // public abstract getFeatures(\n  //   region: Region,\n  //   opts: BaseOptions,\n  // ): Observable<Feature> {\n  //   return ObservableCreate(observer => {\n  //     const records = getRecords(assembly, refName, start, end)\n  //     records.forEach(record => {\n  //       observer.next(this.recordToFeature(record))\n  //     })\n  //     observer.complete()\n  //   })\n  // }\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkAbortSignal(opts.signal)\n      if (!hasData) {\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts).subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters\n   * that are frequently called on multiple regions simultaneously may\n   * want to implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    return merge(\n      ...regions.map(region => {\n        return this.getFeaturesInRegion(region, opts)\n      }),\n    )\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n\n  public async getRegionStats(region: Region, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n\n  public async getMultiRegionStats(regions: Region[] = [], opts?: BaseOptions) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionStats(region, opts)),\n    )\n\n    const scoreMax = feats.map(a => a.scoreMax).reduce((a, b) => Math.max(a, b))\n    const scoreMin = feats.map(a => a.scoreMin).reduce((a, b) => Math.min(a, b))\n    const scoreSum = feats.reduce((a, b) => a + b.scoreSum, 0)\n    const scoreSumSquares = feats.reduce((a, b) => a + b.scoreSumSquares, 0)\n    const featureCount = feats.reduce((a, b) => a + b.featureCount, 0)\n    const basesCovered = feats.reduce((a, b) => a + b.basesCovered, 0)\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n\n  public async estimateRegionsStats(regions: Region[], opts?: BaseOptions) {\n    if (!regions.length) {\n      throw new Error('No regions to estimate stats for')\n    }\n    const region = regions[0]\n    let lastTime = +Date.now()\n    const statsFromInterval = async (length: number, expansionTime: number) => {\n      const { start, end } = region\n      const sampleCenter = start * 0.75 + end * 0.25\n      const query = {\n        ...region,\n        start: Math.max(0, Math.round(sampleCenter - length / 2)),\n        end: Math.min(Math.round(sampleCenter + length / 2), end),\n      }\n\n      const features = await this.getFeatures(query, opts)\n        .pipe(toArray())\n        .toPromise()\n\n      return maybeRecordStats(\n        length,\n        { featureDensity: features.length / length },\n        features.length,\n        expansionTime,\n      )\n    }\n\n    const maybeRecordStats = async (\n      interval: number,\n      stats: Stats,\n      statsSampleFeatures: number,\n      expansionTime: number,\n    ): Promise<Stats> => {\n      const refLen = region.end - region.start\n      if (statsSampleFeatures >= 70 || interval * 2 > refLen) {\n        return stats\n      } else if (expansionTime <= 5000) {\n        const currTime = +Date.now()\n        expansionTime += currTime - lastTime\n        lastTime = currTime\n        return statsFromInterval(interval * 2, expansionTime)\n      } else {\n        console.warn(\n          \"Stats estimation reached timeout, or didn't get enough features\",\n        )\n        return { featureDensity: Infinity }\n      }\n    }\n\n    return statsFromInterval(1000, 0)\n  }\n}\n\nexport interface RegionsAdapter extends BaseAdapter {\n  getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n\nexport abstract class BaseSequenceAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter\n{\n  async estimateRegionsStats() {\n    return { featureDensity: 0 }\n  }\n\n  abstract getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n\nexport function isSequenceAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseSequenceAdapter {\n  return 'getRegions' in thing && 'getFeatures' in thing\n}\n\nexport function isRegionsAdapter(\n  thing: AnyDataAdapter,\n): thing is RegionsAdapter {\n  return 'getRegions' in thing\n}\n\nexport function isFeatureAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseFeatureDataAdapter {\n  return 'getFeatures' in thing\n}\n\nexport interface Alias {\n  refName: string\n  aliases: string[]\n}\nexport interface BaseRefNameAliasAdapter extends BaseAdapter {\n  getRefNameAliases(opts: BaseOptions): Promise<Alias[]>\n}\nexport function isRefNameAliasAdapter(\n  thing: object,\n): thing is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in thing\n}\nexport interface BaseTextSearchAdapter extends BaseAdapter {\n  searchIndex(args: BaseArgs): Promise<BaseResult[]>\n}\nexport function isTextSearchAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseTextSearchAdapter {\n  return 'searchIndex' in thing\n}\n","import { SnapshotIn } from 'mobx-state-tree'\nimport PluginManager from '../PluginManager'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyDataAdapter } from './BaseAdapter'\nimport { Region } from '../util/types'\nimport idMaker from '../util/idMaker'\n\nfunction adapterConfigCacheKey(\n  adapterConfig: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  return `${idMaker(adapterConfig)}`\n}\n\ninterface AdapterCacheEntry {\n  dataAdapter: AnyDataAdapter\n  sessionIds: Set<string>\n}\n\nlet adapterCache: Record<string, AdapterCacheEntry> = {}\n\n/**\n * instantiate a data adapter, or return an already-instantiated one if we have one with the same\n * configuration\n *\n * @param pluginManager -\n * @param sessionId - session ID of the associated worker session.\n *   used for reference counting\n * @param adapterConfigSnapshot - plain-JS configuration snapshot for the adapter\n */\nexport async function getAdapter(\n  pluginManager: PluginManager,\n  sessionId: string,\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  // cache the adapter object\n  const cacheKey = adapterConfigCacheKey(adapterConfigSnapshot)\n  if (!adapterCache[cacheKey]) {\n    const adapterType = (adapterConfigSnapshot || {}).type\n    if (!adapterType) {\n      throw new Error(\n        'could not determine adapter type from adapter config snapshot',\n      )\n    }\n    const dataAdapterType = pluginManager.getAdapterType(adapterType)\n    if (!dataAdapterType) {\n      throw new Error(`unknown data adapter type ${adapterType}`)\n    }\n\n    // instantiate the data adapter's config schema so it gets its defaults,\n    // callbacks, etc\n    const adapterConfig = dataAdapterType.configSchema.create(\n      adapterConfigSnapshot,\n      { pluginManager },\n    )\n\n    const getSubAdapter = getAdapter.bind(null, pluginManager, sessionId)\n\n    // instantiate the adapter itself with its config schema, and a bound\n    // func that it can use to get any inner adapters\n    // (such as sequence adapters or wrapped subadapters) that it needs\n    //\n    const { AdapterClass, getAdapterClass } = dataAdapterType\n\n    // @ts-ignore\n    const CLASS = AdapterClass || (await getAdapterClass())\n    if (!CLASS) {\n      throw new Error('Failed to get adapter')\n    }\n\n    const dataAdapter = new CLASS(adapterConfig, getSubAdapter, pluginManager)\n\n    // store it in our cache\n    adapterCache[cacheKey] = {\n      dataAdapter,\n      sessionIds: new Set([sessionId]),\n    }\n  }\n\n  const cacheEntry = adapterCache[cacheKey]\n  cacheEntry.sessionIds.add(sessionId)\n\n  return cacheEntry\n}\n\n/**\n * this is a callback that is passed to adapters that\n * allows them to get any sub-adapters that they need\n * internally, staying with the same worker session ID\n */\nexport type getSubAdapterType = (\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) => ReturnType<typeof getAdapter>\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function freeAdapterResources(specification: Record<string, any>) {\n  let deleteCount = 0\n\n  const specKeys = Object.keys(specification)\n\n  // if we don't specify a range, delete any adapters that are\n  // only associated with that session\n  if (specKeys.length === 1 && specKeys[0] === 'sessionId') {\n    const { sessionId } = specification\n    Object.entries(adapterCache).forEach(([cacheKey, cacheEntry]) => {\n      cacheEntry.sessionIds.delete(sessionId)\n      if (cacheEntry.sessionIds.size === 0) {\n        deleteCount += 1\n        delete adapterCache[cacheKey]\n      }\n    })\n  } else {\n    // otherwise call freeResources on all the cached data adapters\n    Object.values(adapterCache).forEach(cacheEntry => {\n      if (!cacheEntry.dataAdapter.freeResources) {\n        console.warn(cacheEntry.dataAdapter, 'does not implement freeResources')\n      } else {\n        const regions =\n          specification.regions ||\n          (specification.region ? [specification.region] : [])\n        regions.forEach((region: Region) => {\n          if (region.refName !== undefined) {\n            cacheEntry.dataAdapter.freeResources(region)\n          }\n        })\n      }\n    })\n  }\n\n  return deleteCount\n}\n\nexport function clearAdapterCache() {\n  adapterCache = {}\n}\n","/* eslint curly:error */\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport type AdapterMetadata = {\n  category: string | null\n  hiddenFromGUI: boolean | null\n  displayName: string | null\n  description: string | null\n}\n\nexport default class AdapterType extends PluggableElementBase {\n  AdapterClass?: AnyAdapter\n\n  getAdapterClass: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  adapterCapabilities: string[]\n\n  adapterMetadata?: AdapterMetadata\n\n  constructor(\n    stuff: {\n      name: string\n      configSchema: AnyConfigurationSchemaType\n      adapterCapabilities?: string[]\n      adapterMetadata?: AdapterMetadata\n    } & (\n      | { AdapterClass: AnyAdapter }\n      | { getAdapterClass: () => Promise<AnyAdapter> }\n    ),\n  ) {\n    super(stuff)\n    if ('AdapterClass' in stuff) {\n      this.AdapterClass = stuff.AdapterClass\n      this.getAdapterClass = async () => stuff.AdapterClass\n    } else if ('getAdapterClass' in stuff) {\n      this.getAdapterClass = stuff.getAdapterClass\n    } else {\n      throw new Error(\n        `no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`,\n      )\n    }\n    this.configSchema = stuff.configSchema\n    this.adapterCapabilities = stuff.adapterCapabilities || []\n\n    this.adapterMetadata = stuff.adapterMetadata\n  }\n}\n","import React from 'react'\nimport { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\n\ntype BasicComponent = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n}>\ntype AddTrackWorkflowComponent =\n  | React.LazyExoticComponent<BasicComponent>\n  | BasicComponent\n\nexport default class AddTrackWorkflow extends PluggableElementBase {\n  ReactComponent: AddTrackWorkflowComponent\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AddTrackWorkflowComponent\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../util'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayName: string\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.displayName = stuff.displayName\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for connection ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema defined for connection ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyReactComponentType } from '../util'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  trackType: string\n\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for display ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for display ${this.name}`)\n    }\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent provided for display ${this.name}`)\n    }\n    if (!this.trackType) {\n      throw new Error(`no trackType provided for display ${this.name}`)\n    }\n    if (!this.viewType) {\n      throw new Error(`no viewType provided for display ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class InternetAccountType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(\n        `no stateModel defined for internet account type ${this.name}`,\n      )\n    }\n    if (!this.configSchema) {\n      throw new Error(\n        `no configSchema provided for internet account type ${this.name}`,\n      )\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","export default abstract class PluggableElementBase {\n  name = ''\n\n  constructor(args: { name: string }) {\n    this.name = args.name\n  }\n}\n","import PluginManager from '../PluginManager'\nimport PluggableElementBase from './PluggableElementBase'\nimport { setBlobMap, getBlobMap } from '../util/tracks'\nimport { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport {\n  isAppRootModel,\n  isUriLocation,\n  isAuthNeededException,\n  RetryError,\n  UriLocation,\n} from '../util/types'\n\nimport {\n  deserializeAbortSignal,\n  isRemoteAbortSignal,\n  RemoteAbortSignal,\n} from '../rpc/remoteAbortSignals'\n\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default abstract class RpcMethodType extends PluggableElementBase {\n  name = 'UNKNOWN'\n\n  constructor(public pluginManager: PluginManager) {\n    super({ name: '' })\n  }\n\n  async serializeArguments(args: {}, _rpcDriverClassName: string): Promise<{}> {\n    const blobMap = getBlobMap()\n    await this.augmentLocationObjects(args)\n    return { ...args, blobMap }\n  }\n\n  async serializeNewAuthArguments(loc: UriLocation) {\n    const rootModel = this.pluginManager.rootModel\n\n    // args dont need auth or already have auth\n    if (!isAppRootModel(rootModel) || loc.internetAccountPreAuthorization) {\n      return loc\n    }\n\n    const account = rootModel?.findAppropriateInternetAccount(loc)\n\n    if (account) {\n      loc.internetAccountPreAuthorization =\n        await account.getPreAuthorizationInformation(loc)\n    }\n    return loc\n  }\n\n  async deserializeArguments<\n    SERIALIZED extends {\n      signal?: RemoteAbortSignal\n      blobMap?: Record<string, File>\n    },\n  >(serializedArgs: SERIALIZED, _rpcDriverClassName: string) {\n    if (serializedArgs.blobMap) {\n      setBlobMap(serializedArgs.blobMap)\n    }\n    const { signal } = serializedArgs\n    if (signal && isRemoteAbortSignal(signal)) {\n      return { ...serializedArgs, signal: deserializeAbortSignal(signal) }\n    }\n\n    return { ...serializedArgs, signal: undefined }\n  }\n\n  abstract execute(\n    serializedArgs: unknown,\n    rpcDriverClassName: string,\n  ): Promise<unknown>\n\n  async serializeReturn(\n    originalReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    return originalReturn\n  }\n\n  async deserializeReturn(\n    serializedReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ): Promise<unknown> {\n    let r\n    const { rootModel } = this.pluginManager\n    try {\n      r = await serializedReturn\n    } catch (error) {\n      if (isAuthNeededException(error)) {\n        // @ts-ignore\n        const retryAccount = rootModel?.createEphemeralInternetAccount(\n          `HTTPBasicInternetAccount-${new URL(error.url).origin}`,\n          {},\n          error.url,\n        )\n        throw new RetryError(\n          'Retrying with created internet account',\n          retryAccount.internetAccountId,\n        )\n      }\n      throw error\n    }\n    return r\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async augmentLocationObjects(thing: any): Promise<any> {\n    if (isStateTreeNode(thing) && !isAlive(thing)) {\n      return thing\n    }\n\n    if (isUriLocation(thing)) {\n      await this.serializeNewAuthArguments(thing)\n    }\n    if (Array.isArray(thing)) {\n      for (const val of thing) {\n        await this.augmentLocationObjects(val)\n      }\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      for (const value of Object.values(thing)) {\n        if (Array.isArray(value)) {\n          for (const val of value) {\n            await this.augmentLocationObjects(val)\n          }\n        } else if (typeof value === 'object' && value !== null) {\n          await this.augmentLocationObjects(value)\n        }\n      }\n    }\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport default class TextSearchAdapterType extends PluggableElementBase {\n  AdapterClass: AnyAdapter\n\n  configSchema: AnyConfigurationSchemaType\n\n  description?: string\n\n  constructor(stuff: {\n    name: string\n    description?: string\n    configSchema: AnyConfigurationSchemaType\n    AdapterClass: AnyAdapter\n  }) {\n    super(stuff)\n    this.description = stuff.description\n    this.configSchema = stuff.configSchema\n    this.AdapterClass = stuff.AdapterClass\n    if (!this.AdapterClass) {\n      throw new Error(`no AdapterClass defined for adapter type ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport DisplayType from './DisplayType'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for track ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for track ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport DisplayType from './DisplayType'\n\ntype BasicView = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n  session?: IAnyStateTreeNode\n}>\ntype ViewReactComponent = React.LazyExoticComponent<BasicView> | BasicView\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewReactComponent\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  // extendedName can be used for when you extend a given view type, and want\n  // to register all of that view types displays to yourself e.g. you create a\n  // linear-genome-view subtype, and want all the tracks that are compatible\n  // display types for the linear-genome-view to be compatible with your type\n  // also (without this, display types are only registered to a single view\n  // type)\n  extendedName?: string\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: ViewReactComponent\n    stateModel: IAnyModelType\n    extendedName?: string\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    this.extendedName = stuff.extendedName\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React, { ComponentType, LazyExoticComponent } from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for widget ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for widget ${this.name}`)\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport { ElementId } from '../../util/types/mst'\nimport { MenuItem } from '../../ui'\n\n/**\n * #stateModel BaseViewModel\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n\n    /**\n     * #property\n     * displayName is displayed in the header of the view, or assembly names\n     * being used if none is specified\n     */\n    displayName: types.maybe(types.string),\n\n    /**\n     * #property\n     */\n    minimized: false,\n  })\n  .volatile(() => ({\n    width: 800,\n  }))\n  .views(() => ({\n    /**\n     * #getter\n     */\n    menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n\n    /**\n     * #action\n     * width is an important attribute of the view model, when it becomes set, it\n     * often indicates when the app can start drawing to it. certain views like\n     * lgv are strict about this because if it tries to draw before it knows the\n     * width it should draw to, it may start fetching data for regions it doesn't\n     * need to\n     *\n     * setWidth is updated by a ResizeObserver generally, the views often need\n     * to know how wide they are to properly draw genomic regions\n     */\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n\n    /**\n     * #action\n     */\n    setMinimized(flag: boolean) {\n      self.minimized = flag\n    },\n  }))\n\nexport default BaseViewModel\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface IBaseViewModel extends Instance<typeof BaseViewModel> {}\n","import { ConfigurationSchema } from '../../configuration'\n\n/**\n * #config BaseConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'BaseConnection',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'optional list of names of assemblies in this connection',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'connectionId',\n  },\n)\n","import { cast, types } from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\n/**\n * #stateModel BaseConnectionModel\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('Connection', {\n      /**\n       * #property\n       */\n      name: types.identifier,\n      /**\n       * #property\n       */\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n    })\n    .actions(self => ({\n      afterAttach() {\n        if (!self.tracks.length) {\n          // @ts-ignore\n          self.connect(self.configuration)\n        }\n      },\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      /**\n       * #action\n       */\n      addTrackConfs(trackConfs: AnyConfigurationModel[]) {\n        const length = self.tracks.push(...trackConfs)\n        return self.tracks.slice(length - 1 - trackConfs.length, length - 1)\n      },\n      /**\n       * #action\n       */\n      setTrackConfs(trackConfs: AnyConfigurationModel[]) {\n        self.tracks = cast(trackConfs)\n        return self.tracks\n      },\n      /**\n       * #action\n       */\n      clear() {},\n    }))\n}\n\nexport default stateModelFactory\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { getParent, Instance, types, isRoot } from 'mobx-state-tree'\n\n// locals\nimport { getConf } from '../../configuration'\nimport { MenuItem } from '../../ui'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { getEnv } from '../../util'\nimport { ElementId } from '../../util/types/mst'\n\n/**\n * #stateModel BaseDisplay\n */\nfunction stateModelFactory() {\n  return types\n    .model('BaseDisplay', {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.string,\n      /**\n       * #property\n       */\n      rpcDriverName: types.maybe(types.string),\n    })\n    .volatile(() => ({\n      rendererTypeName: '',\n      error: undefined as unknown,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get RenderingComponent(): React.FC<{\n        model: typeof self\n        onHorizontalScroll?: Function\n        blockState?: Record<string, any>\n      }> {\n        const { pluginManager } = getEnv(self)\n        const displayType = pluginManager.getDisplayType(self.type)\n        return displayType.ReactComponent as React.FC<{\n          model: typeof self\n          onHorizontalScroll?: Function\n          blockState?: Record<string, any>\n        }>\n      },\n\n      /**\n       * #getter\n       */\n      get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n        return null\n      },\n\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return getConf(this.parentTrack, 'adapter')\n      },\n\n      /**\n       * #getter\n       */\n      get parentTrack() {\n        let track = getParent<any>(self)\n        while (!(track.configuration && getConf(track, 'trackId'))) {\n          if (isRoot(track)) {\n            throw new Error(`No parent track found for ${self.type} ${self.id}`)\n          }\n          track = getParent<any>(track)\n        }\n        return track\n      },\n\n      /**\n       * #method\n       * the react props that are passed to the Renderer when data\n       * is rendered in this display\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n        }\n      },\n\n      /**\n       * #getter\n       * the pluggable element type object for this display's\n       * renderer\n       */\n      get rendererType() {\n        const { pluginManager } = getEnv(self)\n        const RendererType = pluginManager.getRendererType(\n          self.rendererTypeName,\n        )\n        if (!RendererType) {\n          throw new Error(`renderer \"${self.rendererTypeName}\" not found`)\n        }\n        if (!RendererType.ReactComponent) {\n          throw new Error(\n            `renderer ${self.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n          )\n        }\n        return RendererType\n      },\n\n      /**\n       * #getter\n       * if a display-level message should be displayed instead,\n       * make this return a react component\n       */\n      get DisplayMessageComponent() {\n        return undefined as undefined | React.FC<any>\n      },\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return []\n      },\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       *  return a react node + string of text.\n       *  string of text describes why it cannot be rendered\n       *  react node allows user to force load at current setting\n       */\n      regionCannotBeRendered(/* region */) {\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setError(error?: unknown) {\n        self.error = error\n      },\n      /**\n       * #action\n       */\n      setRpcDriverName(rpcDriverName: string) {\n        self.rpcDriverName = rpcDriverName\n      },\n      /**\n       * #action\n       * base display reload does nothing, see specialized displays for details\n       */\n      reload() {},\n    }))\n}\n\nexport const BaseDisplay = stateModelFactory()\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","import React from 'react'\nimport { Instance, types } from 'mobx-state-tree'\nimport { getConf } from '../../configuration'\nimport { RemoteFileWithRangeCache } from '../../util/io'\nimport { ElementId } from '../../util/types/mst'\nimport { UriLocation, AnyReactComponentType } from '../../util/types'\n\nconst inWebWorker = typeof sessionStorage === 'undefined'\n\n/**\n * #stateModel BaseInternetAccountModel\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const InternetAccount = types\n  .model('InternetAccount', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    type: types.string,\n  })\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get name(): string {\n      return getConf(self, 'name')\n    },\n    /**\n     * #getter\n     */\n    get description(): string {\n      return getConf(self, 'description')\n    },\n    /**\n     * #getter\n     */\n    get internetAccountId(): string {\n      return getConf(self, 'internetAccountId')\n    },\n    /**\n     * #getter\n     */\n    get authHeader(): string {\n      return getConf(self, 'authHeader')\n    },\n    /**\n     * #getter\n     */\n    get tokenType(): string {\n      return getConf(self, 'tokenType')\n    },\n    /**\n     * #getter\n     */\n    get domains(): string[] {\n      return getConf(self, 'domains')\n    },\n    /**\n     * #getter\n     * Can use this to customize what is displayed in fileSelector's toggle box\n     */\n    get toggleContents(): React.ReactNode {\n      return null\n    },\n    /**\n     * #getter\n     * Can use this to customize what the fileSelector. It takes a prop called\n     * `setLocation` that should be used to set a UriLocation\n     */\n    get SelectorComponent(): AnyReactComponentType | undefined {\n      return undefined\n    },\n    /**\n     * #getter\n     * Can use this to add a label to the UrlChooser. Has no effect if a custom\n     * SelectorComponent is supplied\n     */\n    get selectorLabel(): string | undefined {\n      return undefined\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     * Determine whether this internetAccount provides credentials for a URL\n     * @param location  - UriLocation of resource\n     * @returns true or false\n     */\n    handlesLocation(location: UriLocation) {\n      return self.domains.some(domain => location?.uri.includes(domain))\n    },\n    /**\n     * #getter\n     * The key used to store this internetAccount's token in sessionStorage\n     */\n    get tokenKey() {\n      return `${self.internetAccountId}-token`\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Must be implemented by a model extending or composing this one. Pass the\n     * user's token to `resolve`.\n     * @param resolve - Pass the token to this function\n     * @param reject - If there is an error getting the token, call this function\n     */\n    getTokenFromUser(\n      resolve: (token: string) => void,\n      reject: (error: Error) => void,\n    ): void {\n      throw new Error('getTokenFromUser must be implemented by extending model')\n    },\n    /**\n     * #action\n     */\n    storeToken(token: string) {\n      sessionStorage.setItem(self.tokenKey, token)\n    },\n    /**\n     * #action\n     */\n    removeToken() {\n      sessionStorage.removeItem(self.tokenKey)\n    },\n    /**\n     * #action\n     */\n    retrieveToken() {\n      return sessionStorage.getItem(self.tokenKey)\n    },\n    /**\n     * #action\n     * This can be used by an internetAccount to validate a token works before\n     * it is used. This is run when preAuthorizationInformation is requested, so\n     * it can be used to check that a token is valid before sending it to a\n     * worker thread. It expects the token to be returned so that this action\n     * can also be used to generate a new token (e.g. by using a refresh token)\n     * if the original one was invalid. Should throw an error if a token is\n     * invalid.\n     * @param token - Auth token\n     * @param loc - UriLocation of the resource\n     * @returns - Valid auth token\n     */\n    async validateToken(token: string, loc: UriLocation) {\n      return token\n    },\n  }))\n  .actions(self => {\n    let tokenPromise: Promise<string> | undefined = undefined\n    return {\n      /**\n       * #action\n       * Try to get the token from the location pre-auth, from local storage,\n       * or from a previously cached promise. If token is not available, uses\n       * `getTokenFromUser`.\n       * @param location - UriLocation of the resource\n       * @returns A promise for the token\n       */\n      async getToken(location?: UriLocation): Promise<string> {\n        if (tokenPromise) {\n          return tokenPromise\n        }\n        let token = location?.internetAccountPreAuthorization?.authInfo?.token\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        if (inWebWorker) {\n          throw new Error(\n            'Did not get internet account pre-authorization info in worker',\n          )\n        }\n        token = self.retrieveToken()\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        tokenPromise = new Promise((r, x) => {\n          function resolve(token: string) {\n            self.storeToken(token)\n            r(token)\n          }\n          function reject(error: Error) {\n            self.removeToken()\n            x(error)\n          }\n          self.getTokenFromUser(resolve, reject)\n        })\n        return tokenPromise\n      },\n    }\n  })\n  .actions(self => ({\n    /**\n     * #action\n     */\n    addAuthHeaderToInit(init: RequestInit = {}, token: string) {\n      const tokenInfoString = self.tokenType\n        ? `${self.tokenType} ${token}`\n        : token\n      const newHeaders = new Headers(init.headers || {})\n      newHeaders.append(self.authHeader, tokenInfoString)\n      return { ...init, headers: newHeaders }\n    },\n    /**\n     * #action\n     * Gets the token and returns it along with the information needed to\n     * create a new internetAccount.\n     * @param location - UriLocation of the resource\n     * @returns\n     */\n    async getPreAuthorizationInformation(location: UriLocation) {\n      const authToken = await self.getToken(location)\n      let validatedToken: string\n      try {\n        validatedToken = await self.validateToken(authToken, location)\n      } catch (error) {\n        self.removeToken()\n        throw error\n      }\n      return {\n        internetAccountType: self.type,\n        authInfo: { token: validatedToken, configuration: getConf(self) },\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Get a fetch method that will add any needed authentication headers to\n     * the request before sending it. If location is provided, it will be\n     * checked to see if it includes a token in it pre-auth information.\n     * @param loc - UriLocation of the resource\n     * @returns A function that can be used to fetch\n     */\n    getFetcher(loc?: UriLocation) {\n      return async (input: RequestInfo, init?: RequestInit) => {\n        const authToken = await self.getToken(loc)\n        const newInit = self.addAuthHeaderToInit(init, authToken)\n        return fetch(input, newInit)\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * Gets a filehandle that uses a fetch that adds auth headers\n     * @param location - UriLocation of the resource\n     * @returns A filehandle\n     */\n    openLocation(location: UriLocation) {\n      return new RemoteFileWithRangeCache(location.uri, {\n        fetch: self.getFetcher(location),\n      })\n    },\n  }))\n\nexport type BaseInternetAccountStateModel = typeof InternetAccount\nexport type BaseInternetAccountModel = Instance<BaseInternetAccountStateModel>\n","import { ConfigurationSchema } from '../../configuration'\nimport { Instance } from 'mobx-state-tree'\n\n/**\n * #config InternetAccount\n * the \"base\" internet account type\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const BaseInternetAccountConfig = ConfigurationSchema(\n  'InternetAccount',\n  {\n    /**\n     * #slot\n     */\n    name: {\n      description: 'descriptive name of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    description: {\n      description: 'a description of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    authHeader: {\n      description: 'request header for credentials',\n      type: 'string',\n      defaultValue: 'Authorization',\n    },\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'internetAccountId',\n    explicitlyTyped: true,\n  },\n)\n\nexport type BaseInternetAccountConfigModel = typeof BaseInternetAccountConfig\nexport type BaseInternetAccountConfig = Instance<BaseInternetAccountConfigModel>\n","import { transaction } from 'mobx'\nimport { getRoot, resolveIdentifier, types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '../../configuration'\nimport PluginManager from '../../PluginManager'\nimport { MenuItem } from '../../ui'\nimport { getContainingView, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\n/**\n * #stateModel BaseTrackModel\n * these MST models only exist for tracks that are *shown*.\n * they should contain only UI state for the track, and have\n * a reference to a track configuration (stored under\n * session.configuration.assemblies.get(assemblyName).tracks).\n * note that multiple displayed tracks could use the same\n * configuration.\n */\nexport function createBaseTrackModel(\n  pm: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      type: types.literal(trackType),\n      /**\n       * #property\n       */\n      configuration: ConfigurationReference(baseTrackConfig),\n      /**\n       * #property\n       */\n      minimized: false,\n      /**\n       * #property\n       */\n      displays: types.array(pm.pluggableMstType('display', 'stateModel')),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       * determines which webworker to send the track to, currently based on trackId\n       */\n      get rpcSessionId() {\n        return self.configuration.trackId\n      },\n      /**\n       * #getter\n       */\n      get name() {\n        return getConf(self, 'name')\n      },\n      /**\n       * #getter\n       */\n      get textSearchAdapter() {\n        return getConf(self, 'textSearchAdapter')\n      },\n\n      /**\n       * #getter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        if (!adapterConfig) {\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        }\n        const adapterType = pm.getAdapterType(adapterConfig.type)\n        if (!adapterType) {\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        }\n        return adapterType\n      },\n\n      /**\n       * #getter\n       */\n      get viewMenuActions(): MenuItem[] {\n        return self.displays.map(d => d.viewMenuActions).flat()\n      },\n\n      /**\n       * #getter\n       */\n      get canConfigure() {\n        const session = getSession(self)\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          // @ts-ignore\n          (session.adminMode ||\n            // @ts-ignore\n            session.sessionTracks.find(track => {\n              return track.trackId === self.configuration.trackId\n            }))\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMinimized(flag: boolean) {\n        self.minimized = flag\n      },\n      /**\n       * #action\n       */\n      activateConfigurationUI() {\n        const session = getSession(self)\n        const view = getContainingView(self)\n        if (isSessionModelWithConfigEditing(session)) {\n          // @ts-ignore\n          const trackConf = session.editTrackConfiguration(self.configuration)\n          if (trackConf && trackConf !== self.configuration) {\n            // @ts-ignore\n            view.hideTrack(self.configuration)\n            // @ts-ignore\n            view.showTrack(trackConf)\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n        self.displays.push(display)\n      },\n\n      /**\n       * #action\n       */\n      hideDisplay(displayId: string) {\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), displayId)\n        const t = self.displays.filter(d => d.configuration === conf)\n        transaction(() => t.forEach(d => self.displays.remove(d)))\n        return t.length\n      },\n\n      /**\n       * #action\n       */\n      replaceDisplay(oldId: string, newId: string, initialSnapshot = {}) {\n        const idx = self.displays.findIndex(\n          d => d.configuration.displayId === oldId,\n        )\n        if (idx === -1) {\n          throw new Error(`could not find display id ${oldId} to replace`)\n        }\n        const schema = pm.pluggableConfigSchemaType('display')\n        const conf = resolveIdentifier(schema, getRoot(self), newId)\n        const displayType = pm.getDisplayType(conf.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${conf.type}`)\n        }\n        self.displays.splice(idx, 1, {\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n        })\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      trackMenuItems() {\n        const menuItems: MenuItem[] = self.displays\n          .map(d => d.trackMenuItems())\n          .flat()\n        const displayChoices: MenuItem[] = []\n        const view = getContainingView(self)\n        const viewType = pm.getViewType(view.type)\n        const compatibleDisplayTypes = viewType.displayTypes.map(d => d.name)\n        const compatibleDisplays = self.configuration.displays.filter(\n          (d: AnyConfigurationModel) => compatibleDisplayTypes.includes(d.type),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        if (compatibleDisplays.length > 1) {\n          displayChoices.push(\n            { type: 'divider' },\n            { type: 'subHeader', label: 'Display types' },\n          )\n          compatibleDisplays.forEach((displayConf: AnyConfigurationModel) => {\n            displayChoices.push({\n              type: 'radio',\n              label: displayConf.type,\n              checked: displayConf.displayId === shownId,\n              onClick: () =>\n                self.replaceDisplay(shownId, displayConf.displayId),\n            })\n          })\n        }\n        return [...menuItems, ...displayChoices]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\n/**\n * #config BaseTrack\n */\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      /**\n       * #slot\n       */\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      /**\n       * #slot\n       */\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      /**\n       * #slot\n       */\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      /**\n       * #slot\n       */\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      /**\n       * #slot\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      textSearching: ConfigurationSchema('textSearching', {\n        /**\n         * #slot textSearching.indexedAttributes\n         */\n        indexingAttributes: {\n          type: 'stringArray',\n          description:\n            'list of which feature attributes to index for text searching',\n          defaultValue: ['Name', 'ID'],\n        },\n        /**\n         * #slot textSearching.indexingFeatureTypesToExclude\n         */\n        indexingFeatureTypesToExclude: {\n          type: 'stringArray',\n          description: 'list of feature types to exclude in text search index',\n          defaultValue: ['CDS', 'exon'],\n        },\n\n        /**\n         * #slot textSearching.textSearchAdapter\n         */\n        textSearchAdapter: pluginManager.pluggableConfigSchemaType(\n          'text search adapter',\n        ),\n      }),\n\n      /**\n       * #slot\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      formatDetails: ConfigurationSchema('FormatDetails', {\n        /**\n         * #slot formatDetails.feature\n         */\n        feature: {\n          type: 'frozen',\n          description: 'adds extra fields to the feature details',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n\n        /**\n         * #slot formatDetails.subfeatures\n         */\n        subfeatures: {\n          type: 'frozen',\n          description: 'adds extra fields to the subfeatures of a feature',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n\n        /**\n         * #slot formatDetails.depth\n         */\n        depth: {\n          type: 'number',\n          defaultValue: 2,\n          description:\n            'depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2',\n        },\n      }),\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration object in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(conf: { type: string; displayId: string }) {\n          const { type } = conf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === conf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(conf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigModel = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigModel>\n","import deepEqual from 'fast-deep-equal'\n\n// layouts\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\nimport { SerializedLayout, BaseLayout } from '../../util/layouts/BaseLayout'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\n\n// other\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized as FeatureRenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults as FeatureRenderResults,\n  ResultsSerialized as FeatureResultsSerialized,\n  ResultsDeserialized as FeatureResultsDeserialized,\n} from './FeatureRendererType'\nimport { getLayoutId, Region, Feature } from '../../util'\nimport { readConfObject, AnyConfigurationModel } from '../../configuration'\nimport SerializableFilterChain from './util/serializableFilterChain'\nimport RpcManager from '../../rpc/RpcManager'\n\nexport interface LayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n}\n\nexport type MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\nexport interface CachedLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport class LayoutSession implements LayoutSessionProps {\n  config: AnyConfigurationModel\n\n  bpPerPx: number\n\n  filters: SerializableFilterChain\n\n  constructor(args: LayoutSessionProps) {\n    this.config = args.config\n    this.bpPerPx = args.bpPerPx\n    this.filters = args.filters\n    this.update(args)\n  }\n\n  update(props: LayoutSessionProps) {\n    Object.assign(this, props)\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.config, 'maxHeight'),\n      displayMode: readConfObject(this.config, 'displayMode'),\n      pitchX: this.bpPerPx,\n      pitchY: readConfObject(this.config, 'noSpacing') ? 1 : 3,\n    })\n  }\n\n  /**\n   * @param layout -\n   * @returns true if the given layout is a valid one to use for this session\n   */\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout &&\n      cachedLayout.layout.subLayoutConstructorArgs.pitchX === this.bpPerPx &&\n      deepEqual(readConfObject(this.config), cachedLayout.config) &&\n      deepEqual(this.filters, cachedLayout.filters)\n    )\n  }\n\n  cachedLayout: CachedLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\nexport interface RenderArgs extends FeatureRenderArgs {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderArgsSerialized extends FeatureRenderArgsSerialized {\n  bpPerPx: number\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderResults extends FeatureRenderResults {\n  layout: BaseLayout<Feature>\n}\n\nexport interface ResultsSerialized extends FeatureResultsSerialized {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport interface ResultsDeserialized extends FeatureResultsDeserialized {\n  maxHeightReached: boolean\n  layout: PrecomputedLayout<string>\n}\n\nexport default class BoxRendererType extends FeatureRendererType {\n  sessions: { [key: string]: LayoutSession } = {}\n\n  getWorkerSession(\n    props: LayoutSessionProps & { sessionId: string; layoutId: string },\n  ) {\n    const key = getLayoutId(props)\n    if (!this.sessions[key]) {\n      this.sessions[key] = this.createSession(props)\n    }\n    const session = this.sessions[key]\n    session.update(props)\n    return session\n  }\n\n  // expands region for glyphs to use\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    if (!region) {\n      return region\n    }\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      config === undefined\n        ? 0\n        : readConfObject(config, 'maxFeatureGlyphExpansion')\n    if (!maxFeatureGlyphExpansion) {\n      return region\n    }\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  createSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const { regions } = args\n    const key = getLayoutId(args)\n    let freed = 0\n    const session = this.sessions[key]\n    if (!regions && session) {\n      delete this.sessions[key]\n      freed = 1\n    }\n    if (session && regions) {\n      session.layout.discardRange(\n        regions[0].refName,\n        regions[0].start,\n        regions[0].end,\n      )\n    }\n    return freed + (await super.freeResourcesInClient(rpcManager, args))\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const layout = this.deserializeLayoutInClient(result.layout)\n    const deserialized = super.deserializeResultsInClient(\n      { ...result, layout } as FeatureResultsSerialized,\n      args,\n    ) as ResultsDeserialized\n\n    // // debugging aid: check if there are features in `features` that are not in the layout\n    // const featureIds1 = iterMap(deserialized.features.values(), f =>\n    //   f.id(),\n    // ).sort()\n    // const featureIds2 = Object.keys(\n    //   deserialized.layout.toJSON().rectangles,\n    // ).sort()\n    // if (\n    //   featureIds1.length > featureIds2.length &&\n    //   !deserialized.layout.maxHeightReached\n    // )\n    //   debugger\n\n    return deserialized\n  }\n\n  createLayoutInWorker(args: RenderArgsDeserialized) {\n    const { regions } = args\n    const session = this.getWorkerSession(args)\n    const subLayout = session.layout.getSublayout(regions[0].refName)\n    return subLayout\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(\n      results,\n      args,\n    ) as ResultsSerialized\n\n    const [region] = args.regions\n    serialized.layout = results.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    if (serialized.layout.rectangles) {\n      serialized.features = serialized.features.filter(f => {\n        return Boolean(serialized.layout.rectangles[f.uniqueId])\n      })\n    }\n\n    serialized.maxHeightReached = serialized.layout.maxHeightReached\n    return serialized\n  }\n\n  /**\n   * gets layout and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const layout =\n      (props.layout as undefined | BaseLayout<unknown>) ||\n      this.createLayoutInWorker(props)\n    const result = await super.render({ ...props, layout })\n    return { ...result, layout }\n  }\n}\n","import FeatureRenderer from './FeatureRendererType'\n\nexport default class CircularChordRendererType extends FeatureRenderer {}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { filter, toArray } from 'rxjs/operators'\nimport { Feature } from '../../util/simpleFeature'\nimport { Region } from '../../util/types'\nimport ServerSideRenderer, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from './ServerSideRendererType'\nimport RpcManager from '../../rpc/RpcManager'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport type { RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  blockKey: string\n}\n\nexport default class ComparativeServerSideRenderer extends ServerSideRenderer {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n\n  async renameRegionsIfNeeded(args: RenderArgs) {\n    return args\n  }\n\n  serializeArgsInClient(args: RenderArgs) {\n    const deserializedArgs = {\n      ...args,\n      displayModel: {},\n    }\n\n    return super.serializeArgsInClient(deserializedArgs)\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserialized = super.deserializeResultsInClient(result, args)\n    return { ...deserialized, blockKey: args.blockKey }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    return rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      args,\n    ) as Promise<ResultsSerialized>\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  async getFeatures(renderArgs: any) {\n    const pm = this.pluginManager\n    const { sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    let regions = [] as Region[]\n\n    // @ts-ignore this is instantiated by the getFeatures call\n    regions = renderArgs.regions\n\n    if (!regions || regions.length === 0) {\n      console.warn('no regions supplied to comparative renderer')\n      return []\n    }\n\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    return (dataAdapter as BaseFeatureDataAdapter)\n      .getFeaturesInMultipleRegions(requestRegions, renderArgs)\n      .pipe(\n        filter(f => this.featurePassesFilters(renderArgs, f)),\n        toArray(),\n      )\n      .toPromise()\n  }\n}\n","import { toArray } from 'rxjs/operators'\nimport { checkAbortSignal, iterMap } from '../../util'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\nimport { AugmentedRegion as Region } from '../../util/types'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults as ServerSideRenderResults,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\nimport { isFeatureAdapter } from '../../data_adapters/BaseAdapter'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderResults extends ServerSideRenderResults {\n  features: Map<string, Feature>\n}\n\nexport interface ResultsSerialized extends ServerSideResultsSerialized {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  features: Map<string, Feature>\n  blockKey: string\n}\n\nexport default class FeatureRendererType extends ServerSideRendererType {\n  /**\n   * replaces the `displayModel` param (which on the client is a MST model) with\n   * a stub that only contains the `selectedFeature`, since this is the only\n   * part of the track model that most renderers read. also serializes the\n   * config and regions to JSON from MST objects.\n   *\n   * @param args - the arguments passed to render\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    const { displayModel, regions } = args\n    const serializedArgs = {\n      ...args,\n      displayModel: displayModel && {\n        id: displayModel.id,\n        selectedFeatureId: displayModel.selectedFeatureId,\n      },\n      regions: JSON.parse(JSON.stringify(regions)),\n    }\n    return super.serializeArgsInClient(serializedArgs)\n  }\n\n  /**\n   * Adds feature deserialization to base server-side result deserialization\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserializedFeatures = new Map<string, SimpleFeature>()\n    result.features.forEach(j => {\n      const f = SimpleFeature.fromJSON(j)\n      deserializedFeatures.set(String(f.id()), f)\n    })\n    const deserialized = super.deserializeResultsInClient(\n      {\n        ...result,\n        features: deserializedFeatures,\n      } as ServerSideResultsSerialized,\n      args,\n    )\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n      features: deserializedFeatures,\n    }\n  }\n\n  /**\n   * Adds feature serialization to base server-side result serialization\n   *\n   * @param result - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    result: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(result, args)\n    const { features } = result\n    return {\n      ...serialized,\n      features: iterMap(features.values(), f => f.toJSON(), features.size),\n    }\n  }\n\n  /**\n   * will expand if soft clipping or feature glyphs are shown\n   *\n   * @param region - rendering region\n   * @param _renderArgs - render args, unused, may be used in deriving classes\n   */\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(\n    renderArgs: RenderArgsDeserialized,\n  ): Promise<Map<string, Feature>> {\n    const { signal, regions, sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!isFeatureAdapter(dataAdapter)) {\n      throw new Error('Adapter does not support retrieving features')\n    }\n    const features = new Map()\n\n    if (!regions || regions.length === 0) {\n      return features\n    }\n\n    const requestRegions = regions.map((r: Region) => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.ceil(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    const region = requestRegions[0]\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? dataAdapter.getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            renderArgs,\n          )\n        : dataAdapter.getFeaturesInMultipleRegions(requestRegions, renderArgs)\n\n    const feats = await featureObservable.pipe(toArray()).toPromise()\n    checkAbortSignal(signal)\n    return new Map(\n      feats\n        .filter(feat => this.featurePassesFilters(renderArgs, feat))\n        .map(feat => [feat.id(), feat]),\n    )\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    if (!renderArgs.filters) {\n      return true\n    }\n    return renderArgs.filters.passes(feature, renderArgs)\n  }\n\n  /**\n   * gets features and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const features =\n      (props.features as undefined | Map<string, Feature>) ||\n      (await this.getFeatures(props))\n    const result = await super.render({ ...props, features })\n    return { ...result, features }\n  }\n}\n","import React, { ReactElement } from 'react'\nimport { getDefaultValue } from '../../util/mst-reflection'\nimport PluggableElementBase from '../PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../../util'\nimport PluginManager from '../../PluginManager'\n\nexport type RenderProps = Record<string, unknown>\n\nexport interface RenderResults {\n  reactElement?: ReactElement\n  html?: string\n}\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  supportsSVG = false\n\n  configSchema: AnyConfigurationSchemaType\n\n  pluginManager: PluginManager\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    configSchema: AnyConfigurationSchemaType\n    pluginManager: PluginManager\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n    this.pluginManager = stuff.pluginManager\n\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for renderer ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      throw new Error(\n        `${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`,\n      )\n    }\n    if (!this.pluginManager) {\n      throw new Error(`no plugin manager defined for renderer ${this.name}`)\n    }\n  }\n\n  async render(props: RenderProps): Promise<RenderResults> {\n    return {\n      reactElement: React.createElement(this.ReactComponent, props, null),\n    }\n  }\n\n  /**\n   * frees resources associated with the given range, session, etc.\n   * optionally returns the number of data items deleted\n   */\n  freeResources(/* specification: {} */): number {\n    return 0\n  }\n}\n","import React, { useEffect, useRef } from 'react'\nimport { ThemeProvider } from '@mui/material/styles'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport { createJBrowseTheme } from '../../ui'\nimport { rIC } from '../../util'\nimport { ResultsSerialized, RenderArgs } from './ServerSideRendererType'\n\ninterface ServerSideRenderedContentProps extends ResultsSerialized, RenderArgs {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  RenderingComponent: React.ComponentType<any>\n}\n\nexport default function ServerSideRenderedContent(\n  props: ServerSideRenderedContentProps,\n) {\n  const ssrContainerNode = useRef<HTMLDivElement>(null)\n\n  const { theme, html, RenderingComponent, ...rest } = props\n\n  const jbrowseTheme = createJBrowseTheme(theme)\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    function doHydrate() {\n      if (domNode) {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        // defer main-thread rendering and hydration for when\n        // we have some free time. helps keep the framerate up.\n        //\n        // note: the timeout param to rIC below helps when you are doing\n        // a long continuous scroll, it forces it to evaluate because\n        // otherwise the continuous scroll would never give it time to do\n        // so\n        rIC(\n          () => {\n            hydrate(\n              <ThemeProvider theme={jbrowseTheme}>\n                <RenderingComponent {...rest} />\n              </ThemeProvider>,\n              domNode,\n            )\n          },\n          { timeout: 300 },\n        )\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [html, jbrowseTheme, rest, RenderingComponent])\n\n  return (\n    <div\n      ref={ssrContainerNode}\n      data-html-size={html.length}\n      className=\"ssr-container\"\n    />\n  )\n}\n","import React from 'react'\nimport { DeprecatedThemeOptions } from '@mui/material'\nimport { ThemeProvider } from '@mui/material/styles'\nimport { CanvasSequence } from 'canvas-sequencer'\nimport { renderToString } from 'react-dom/server'\n\nimport {\n  SnapshotOrInstance,\n  SnapshotIn,\n  getSnapshot,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { checkAbortSignal, updateStatus } from '../../util'\nimport RendererType, { RenderProps, RenderResults } from './RendererType'\nimport SerializableFilterChain, {\n  SerializedFilterChain,\n} from './util/serializableFilterChain'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport RpcManager from '../../rpc/RpcManager'\nimport { createJBrowseTheme } from '../../ui'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\ninterface BaseRenderArgs extends RenderProps {\n  sessionId: string\n  // Note that signal serialization happens after serializeArgsInClient and\n  // deserialization happens before deserializeArgsInWorker\n  signal?: AbortSignal\n  theme: DeprecatedThemeOptions\n  exportSVG: { rasterizeLayers?: boolean }\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: (arg: string) => void\n  config: SnapshotIn<AnyConfigurationModel>\n  filters: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport type { RenderResults }\n\nexport interface ResultsSerialized extends Omit<RenderResults, 'reactElement'> {\n  html: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nfunction isSvgExport(\n  elt: ResultsSerialized,\n): elt is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in elt\n}\n\nexport type ResultsDeserialized = RenderResults\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized and\n   * sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      filters: args.filters && args.filters.toJSON().filters,\n    }\n  }\n\n  /**\n   * Deserialize the render results from the worker in the client. Includes\n   * hydrating of the React HTML string, and not hydrating the result if SVG is\n   * being rendered\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    results: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const { html, ...rest } = results\n\n    // if we are rendering svg, we skip hydration\n    if (args.exportSVG) {\n      // only return the results if the renderer explicitly has\n      // this.supportsSVG support to avoid garbage being rendered in SVG\n      // document\n      return {\n        ...results,\n        html: this.supportsSVG\n          ? results.html\n          : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n      }\n    }\n\n    // hydrate results using ServerSideRenderedContent\n    return {\n      ...rest,\n      reactElement: (\n        <ServerSideRenderedContent\n          {...args}\n          {...results}\n          RenderingComponent={this.ReactComponent}\n        />\n      ),\n    }\n  }\n\n  /**\n   * modifies the passed arguments object to inflate arguments as necessary.\n   * called in the worker process.\n   *\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = { ...args } as unknown as RenderArgsDeserialized\n    deserialized.config = this.configSchema.create(args.config || {}, {\n      pluginManager: this.pluginManager,\n    })\n    deserialized.filters = new SerializableFilterChain({\n      filters: args.filters,\n    })\n\n    return deserialized\n  }\n\n  /**\n   * Serialize results of the render to send them to the client. Includes\n   * rendering React to an HTML string.\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const html = renderToString(\n      <ThemeProvider theme={createJBrowseTheme(args.theme)}>\n        {results.reactElement}\n      </ThemeProvider>,\n    )\n    delete results.reactElement\n    return { ...results, html }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then calls\n   * \"CoreRender\" with the RPC manager.\n   *\n   * @param rpcManager - RPC mananger\n   * @param args - render args\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'CoreRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      const { width, height, canvasRecordedData } = results\n\n      const C2S = await import('canvas2svg')\n      const ctx = new C2S.default(width, height)\n      const seq = new CanvasSequence(canvasRecordedData)\n      seq.execute(ctx)\n      const str = ctx.getSvg()\n      // innerHTML strips the outer <svg> element from returned data, we add\n      // our own <svg> element in the view's SVG export\n      results.html = str.innerHTML\n      delete results.reactElement\n    }\n    return results\n  }\n\n  /**\n   * Render method called on the worker. `render` is called here in server-side\n   * rendering\n   *\n   * @param args - serialized render args\n   */\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { signal, statusCallback = () => {} } = args\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    const results = await updateStatus('Rendering plot', statusCallback, () =>\n      this.render(deserializedArgs),\n    )\n    checkAbortSignal(signal)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    return updateStatus('Serializing results', statusCallback, () =>\n      this.serializeResultsInWorker(results, deserializedArgs),\n    )\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    const freed = this.freeResources()\n    const freedRpc = (await rpcManager.call(\n      args.sessionId,\n      'CoreFreeResources',\n      serializedArgs,\n    )) as number\n    return freed + freedRpc\n  }\n}\n","import { stringToJexlExpression } from '../../../util/jexlStrings'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FilterExpression = (...args: Record<string, any>[] | any[]) => boolean\n\ninterface Filter {\n  string: string\n  expr: FilterExpression\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters.map(inputFilter => {\n      if (typeof inputFilter === 'string') {\n        const expr = stringToJexlExpression(inputFilter) as FilterExpression\n        return { expr, string: inputFilter }\n      }\n      throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  passes(...args: any[]) {\n    for (let i = 0; i < this.filterChain.length; i += 1) {\n      if (\n        // @ts-ignore\n        !this.filterChain[i].expr.evalSync({ feature: args[0] })\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import React from 'react'\nimport { Paper } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport ResizeHandle from './ResizeHandle'\nimport { SessionWithDrawerWidgets } from '../util/types'\n\nconst useStyles = makeStyles()(theme => ({\n  paper: {\n    overflowY: 'auto',\n    height: '100%',\n    zIndex: theme.zIndex.drawer,\n    outline: 'none',\n    background: theme.palette.background.default,\n  },\n  resizeHandle: {\n    width: 4,\n    position: 'fixed',\n    top: 0,\n    zIndex: theme.zIndex.drawer + 1,\n  },\n}))\n\nfunction Drawer({\n  children,\n  session,\n}: {\n  children: React.ReactNode\n  session: SessionWithDrawerWidgets\n}) {\n  const { drawerPosition, drawerWidth } = session\n  const { classes } = useStyles()\n\n  return (\n    <Paper className={classes.paper} elevation={16} square>\n      {drawerPosition === 'right' ? (\n        <ResizeHandle\n          onDrag={session.resizeDrawer}\n          className={classes.resizeHandle}\n          vertical\n        />\n      ) : null}\n      {children}\n      {drawerPosition === 'left' ? (\n        <ResizeHandle\n          onDrag={session.resizeDrawer}\n          className={classes.resizeHandle}\n          style={{ left: drawerWidth }}\n          vertical\n        />\n      ) : null}\n    </Paper>\n  )\n}\n\nexport default observer(Drawer)\n","import React, { Suspense, useState } from 'react'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport {\n  AppBar,\n  FormControl,\n  IconButton,\n  Menu,\n  MenuItem,\n  Select,\n  Toolbar,\n  Tooltip,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getEnv } from '../util'\nimport LoadingEllipses from './LoadingEllipses'\nimport { SessionWithDrawerWidgets } from '../util/types'\n\n// icons\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport CloseIcon from '@mui/icons-material/Close'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport MoreVertIcon from '@mui/icons-material/MoreVert'\n\n// locals\nimport Drawer from './Drawer'\nimport ErrorMessage from './ErrorMessage'\n\nconst useStyles = makeStyles()(theme => ({\n  formControl: {\n    margin: 0,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  drawerSelect: {\n    margin: 0,\n    color: theme.palette.secondary.contrastText,\n  },\n\n  dropDownIcon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  header: {\n    background: theme.palette.secondary.main,\n  },\n}))\n\nconst DrawerHeader = observer(\n  ({\n    session,\n    setToolbarHeight,\n  }: {\n    session: SessionWithDrawerWidgets\n    setToolbarHeight: (arg: number) => void\n  }) => {\n    const { pluginManager } = getEnv(session)\n    const { visibleWidget, activeWidgets, drawerPosition } = session\n    const { classes } = useStyles()\n\n    const [anchorEl, setAnchorEl] = useState<null | HTMLElement>(null)\n\n    return (\n      <AppBar\n        position=\"sticky\"\n        className={classes.header}\n        ref={ref => setToolbarHeight(ref?.getBoundingClientRect().height || 0)}\n      >\n        <Toolbar disableGutters>\n          <FormControl className={classes.formControl}>\n            <Select\n              value={visibleWidget?.id}\n              data-testid=\"widget-drawer-selects\"\n              className={classes.drawerSelect}\n              classes={{ icon: classes.dropDownIcon }}\n              renderValue={widgetId => {\n                const widget = session.activeWidgets.get(widgetId as string)\n                if (!widget) {\n                  return (\n                    <Typography variant=\"h6\" color=\"inherit\">\n                      Unknown widget\n                    </Typography>\n                  )\n                }\n                const widgetType = pluginManager.getWidgetType(widget.type)\n                const { HeadingComponent, heading } = widgetType\n                return HeadingComponent ? (\n                  <HeadingComponent model={widget} />\n                ) : (\n                  <Typography variant=\"h6\" color=\"inherit\">\n                    {heading}\n                  </Typography>\n                )\n              }}\n              onChange={e => {\n                const w = session.activeWidgets.get(e.target.value)\n                if (!w) {\n                  session.notify(\n                    `Widget not found ${e.target.value}`,\n                    'warning',\n                  )\n                } else {\n                  session.showWidget(w)\n                }\n              }}\n            >\n              {Array.from(activeWidgets.values()).map(widget => {\n                const widgetType = pluginManager.getWidgetType(widget.type)\n                const { HeadingComponent, heading } = widgetType\n                return (\n                  <MenuItem\n                    data-testid={`widget-drawer-selects-item-${widget.type}`}\n                    key={widget.id}\n                    value={widget.id}\n                  >\n                    {HeadingComponent ? (\n                      <HeadingComponent model={widget} />\n                    ) : (\n                      <Typography variant=\"h6\" color=\"inherit\">\n                        {heading}\n                      </Typography>\n                    )}\n                    <IconButton\n                      data-testid={`${widget.type}-drawer-delete`}\n                      color=\"inherit\"\n                      aria-label=\"Delete\"\n                      onClick={() => session.hideWidget(widget)}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </MenuItem>\n                )\n              })}\n            </Select>\n          </FormControl>\n          <div className={classes.spacer} />\n          <div>\n            <IconButton\n              data-testid=\"drawer-close\"\n              color=\"inherit\"\n              onClick={event => setAnchorEl(event.currentTarget)}\n            >\n              <MoreVertIcon />\n            </IconButton>\n            <Tooltip title=\"Minimize drawer\">\n              <IconButton\n                data-testid=\"drawer-minimize\"\n                color=\"inherit\"\n                onClick={() => {\n                  session.notify(\n                    `Drawer minimized, click button on ${drawerPosition} side of screen to re-open`,\n                    'info',\n                  )\n                  session.minimizeWidgetDrawer()\n                }}\n              >\n                <MinimizeIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Close drawer\">\n              <IconButton\n                data-testid=\"drawer-close\"\n                color=\"inherit\"\n                onClick={() => session.hideWidget(visibleWidget)}\n              >\n                <CloseIcon />\n              </IconButton>\n            </Tooltip>\n          </div>\n        </Toolbar>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onClose={() => setAnchorEl(null)}\n        >\n          {['left', 'right'].map(option => (\n            <MenuItem\n              key={option}\n              selected={drawerPosition === 'option'}\n              onClick={() => {\n                session.setDrawerPosition(option)\n                setAnchorEl(null)\n              }}\n            >\n              {option}\n            </MenuItem>\n          ))}\n        </Menu>\n      </AppBar>\n    )\n  },\n)\n\nconst DrawerWidget = observer(\n  ({ session }: { session: SessionWithDrawerWidgets }) => {\n    const { visibleWidget } = session\n    const { pluginManager } = getEnv(session)\n\n    const DrawerComponent = visibleWidget\n      ? (pluginManager.evaluateExtensionPoint(\n          'Core-replaceWidget',\n          pluginManager.getWidgetType(visibleWidget.type).ReactComponent,\n          {\n            session,\n            model: visibleWidget,\n          },\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        ) as React.FC<any>)\n      : null\n\n    // we track the toolbar height because components that use virtualized\n    // height want to be able to fill the contained, minus the toolbar height\n    // (the position static/sticky is included in AutoSizer estimates)\n    const [toolbarHeight, setToolbarHeight] = useState(0)\n\n    return (\n      <Drawer session={session}>\n        <DrawerHeader session={session} setToolbarHeight={setToolbarHeight} />\n        <Suspense fallback={<LoadingEllipses />}>\n          <ErrorBoundary\n            FallbackComponent={({ error }) => <ErrorMessage error={error} />}\n          >\n            {DrawerComponent ? (\n              <DrawerComponent\n                model={visibleWidget}\n                session={session}\n                toolbarHeight={toolbarHeight}\n              />\n            ) : null}\n          </ErrorBoundary>\n        </Suspense>\n      </Drawer>\n    )\n  },\n)\n\nexport default DrawerWidget\n","import React, { useRef, useState } from 'react'\nimport { Button, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport ArrowDropDown from '@mui/icons-material/ArrowDropDown'\n\nimport Menu, { MenuItem } from './Menu'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    display: 'flex',\n  },\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nfunction DropDownMenu({\n  menuTitle,\n  session,\n  menuItems,\n}: {\n  menuTitle: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  session: any\n  menuItems: MenuItem[]\n}) {\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const { classes } = useStyles()\n\n  function handleToggle() {\n    setOpen(!open)\n  }\n\n  function handleMenuItemClick(_event: unknown, callback: Function) {\n    callback(session)\n    handleClose()\n  }\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Button\n        ref={anchorEl}\n        onClick={handleToggle}\n        color=\"inherit\"\n        data-testid=\"dropDownMenuButton\"\n        classes={{ root: classes.buttonRoot }}\n      >\n        {menuTitle}\n        <ArrowDropDown />\n      </Button>\n      <Menu\n        anchorEl={anchorEl.current}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        onMenuItemClick={handleMenuItemClick}\n        open={open}\n        onClose={handleClose}\n        menuItems={menuItems}\n      />\n    </div>\n  )\n}\n\nexport default observer(DropDownMenu)\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n} from '@mui/material'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => setDialogOpen(true)}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => setDialogOpen(false)}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\n\nconst FatalErrorDialog = ({\n  componentStack,\n  error = 'No error message provided',\n  onFactoryReset,\n  resetButtonText = 'Factory Reset',\n}: {\n  componentStack?: string\n  error?: unknown\n  onFactoryReset: Function\n  resetButtonText?: string\n}) => {\n  console.error(error)\n  return (\n    <Dialog open>\n      <DialogTitle style={{ background: '#e88' }}>Fatal error</DialogTitle>\n      <DialogContent>\n        <pre>\n          {`${error}`}\n          {componentStack}\n        </pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => window.location.reload()}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default FatalErrorDialog\n","import React from 'react'\nimport { Box, Button, Typography, FormControl } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { isElectron } from '../../util'\nimport { LocalPathLocation, FileLocation, BlobLocation } from '../../util/types'\nimport { getBlob, storeBlobLocation } from '../../util/tracks'\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nconst useStyles = makeStyles()(theme => ({\n  filename: {\n    marginLeft: theme.spacing(1),\n  },\n}))\n\nfunction LocalFileChooser(props: {\n  location?: FileLocation\n  setLocation: Function\n}) {\n  const { classes } = useStyles()\n  const { location, setLocation } = props\n\n  const filename =\n    location &&\n    ((isBlobLocation(location) && location.name) ||\n      (isLocalPathLocation(location) && location.localPath))\n\n  const needToReload =\n    location && isBlobLocation(location) && !getBlob(location.blobId)\n\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\">\n      <Box>\n        <FormControl fullWidth>\n          <Button variant=\"outlined\" component=\"label\">\n            Choose File\n            <input\n              type=\"file\"\n              hidden\n              onChange={({ target }) => {\n                const file = target && target.files && target.files[0]\n                if (file) {\n                  if (isElectron) {\n                    setLocation({\n                      localPath: (file as File & { path: string }).path,\n                      locationType: 'LocalPathLocation',\n                    })\n                  } else {\n                    setLocation(storeBlobLocation({ blob: file }))\n                  }\n                }\n              }}\n            />\n          </Button>\n        </FormControl>\n      </Box>\n      <Box>\n        <Typography\n          component=\"span\"\n          className={classes.filename}\n          color={filename ? 'initial' : 'textSecondary'}\n        >\n          {filename || 'No file chosen'}\n        </Typography>\n        {needToReload ? (\n          <Typography color=\"error\">(need to reload)</Typography>\n        ) : null}\n      </Box>\n    </Box>\n  )\n}\n\nexport default LocalFileChooser\n","import React from 'react'\nimport { TextField } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { FileLocation, isUriLocation } from '../../util/types'\n\nfunction UrlChooser(props: {\n  location?: FileLocation\n  setLocation: Function\n  label?: string\n}) {\n  const { location, setLocation, label } = props\n\n  return (\n    <>\n      <TextField\n        fullWidth\n        variant=\"outlined\"\n        inputProps={{ 'data-testid': 'urlInput' }}\n        defaultValue={location && isUriLocation(location) ? location.uri : ''}\n        label={label || 'Enter URL'}\n        onChange={event => {\n          setLocation({\n            uri: event.target.value.trim(),\n            locationType: 'UriLocation',\n          })\n        }}\n      />\n    </>\n  )\n}\n\nexport default observer(UrlChooser)\n","import SvgIcon, { SvgIconProps } from '@mui/material/SvgIcon'\nimport React from 'react'\n\n// Icons below come from https://material.io/resources/icons/?icon=line_style&style=baseline\nexport function ContentCopy(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\" />\n    </SvgIcon>\n  )\n}\n\n// https://materialdesignicons.com/ text-search icon\nexport function Indexing(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentCut(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentPaste(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n\n//  content-save-edit from https://materialdesignicons.com/\nexport function SaveAs(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M10,19L10.14,18.86C8.9,18.5 8,17.36 8,16A3,3 0 0,1 11,13C12.36,13 13.5,13.9 13.86,15.14L20,9V7L16,3H4C2.89,3 2,3.9 2,5V19A2,2 0 0,0 4,21H10V19M4,5H14V9H4V5M20.04,12.13C19.9,12.13 19.76,12.19 19.65,12.3L18.65,13.3L20.7,15.35L21.7,14.35C21.92,14.14 21.92,13.79 21.7,13.58L20.42,12.3C20.31,12.19 20.18,12.13 20.04,12.13M18.07,13.88L12,19.94V22H14.06L20.12,15.93L18.07,13.88Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  content-save from https://materialdesignicons.com/\nexport function Save(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  dna from https://materialdesignicons.com/\nexport function DNA(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function Cable(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z\" />\n    </SvgIcon>\n  )\n}\n","import React from 'react'\nimport { Typography, TypographyProps } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { keyframes } from 'tss-react'\n\nconst useStyles = makeStyles()({\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      content: '\"\"',\n      width: '1em',\n      textAlign: 'left',\n      animation: `${keyframes`\n      0% {\n        content: '';\n      }\n      25% {\n          content: '.';\n      }\n      50% {\n        content: '..';\n      }\n      75% {\n        content: '...';\n      }\n      `} 1.4s infinite ease-in-out`,\n    },\n  },\n})\n\ninterface Props extends TypographyProps {\n  message?: string\n}\n\nexport default function LoadingEllipses({\n  message = 'Loading',\n  variant = 'body2',\n  ...rest\n}: Props) {\n  const { classes } = useStyles()\n  return (\n    <Typography className={classes.dots} {...rest} variant={variant}>\n      {`${message || 'Loading'}`}\n    </Typography>\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { Alert, Button, IconButton, Snackbar } from '@mui/material'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AbstractSessionModel, NotificationLevel, SnackAction } from '../util'\n\ntype SnackbarMessage = [string, NotificationLevel, SnackAction]\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nfunction MessageSnackbar({\n  session,\n}: {\n  session: SnackbarSession & IAnyStateTreeNode\n}) {\n  const [open, setOpen] = useState(false)\n  const [snackbarMessage, setSnackbarMessage] = useState<SnackbarMessage>()\n\n  const { popSnackbarMessage, snackbarMessages } = session\n\n  const latestMessage = snackbarMessages.length\n    ? snackbarMessages[snackbarMessages.length - 1]\n    : null\n\n  useEffect(() => {\n    let timeoutId: ReturnType<typeof setTimeout>\n\n    if (snackbarMessage) {\n      if (!latestMessage) {\n        setSnackbarMessage(undefined)\n      } else if (snackbarMessage[0] !== latestMessage[0]) {\n        setOpen(false)\n        timeoutId = setTimeout(() => {\n          setSnackbarMessage(latestMessage)\n          setOpen(true)\n        }, 100)\n      }\n    } else if (latestMessage) {\n      setSnackbarMessage(latestMessage)\n      setOpen(true)\n    }\n\n    return () => {\n      clearTimeout(timeoutId)\n    }\n  }, [latestMessage, snackbarMessage])\n\n  const handleClose = (_event: unknown, reason?: string) => {\n    if (reason === 'clickaway') {\n      return\n    }\n    popSnackbarMessage()\n    setOpen(false)\n  }\n  const [message, level, action] = snackbarMessage || []\n  return (\n    <Snackbar\n      open={open && !!message}\n      onClose={handleClose}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n    >\n      <Alert\n        onClose={handleClose}\n        action={\n          action ? (\n            <>\n              <Button\n                color=\"inherit\"\n                onClick={e => {\n                  action.onClick()\n                  handleClose(e)\n                }}\n              >\n                {action.name}\n              </Button>\n              <IconButton\n                aria-label=\"close\"\n                color=\"inherit\"\n                onClick={handleClose}\n              >\n                <CloseIcon />\n              </IconButton>\n            </>\n          ) : null\n        }\n        severity={level || 'warning'}\n      >\n        {message}\n      </Alert>\n    </Snackbar>\n  )\n}\n\nexport default observer(MessageSnackbar)\n","import React, { useEffect, useRef, useState } from 'react'\nimport {\n  SvgIconProps,\n  IconButton,\n  IconButtonProps as IconButtonPropsType,\n  Paper,\n  Tooltip,\n  useTheme,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport useMeasure from 'react-use-measure'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport AddIcon from '@mui/icons-material/Add'\nimport MenuIcon from '@mui/icons-material/Menu'\nimport ArrowDownward from '@mui/icons-material/ArrowDownward'\nimport ArrowUpward from '@mui/icons-material/ArrowUpward'\n\n// locals\nimport { getSession } from '../util'\nimport { IBaseViewModel } from '../pluggableElementTypes/models'\nimport EditableTypography from './EditableTypography'\nimport Menu from './Menu'\n\nconst useStyles = makeStyles()(theme => ({\n  viewContainer: {\n    overflow: 'hidden',\n    background: theme.palette.secondary.main,\n    margin: theme.spacing(0.5),\n  },\n  icon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n\n  input: {\n    paddingBottom: 0,\n    paddingTop: 2,\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst ViewMenu = observer(\n  ({\n    model,\n    IconButtonProps,\n    IconProps,\n  }: {\n    model: IBaseViewModel\n    IconButtonProps?: IconButtonPropsType\n    IconProps: SvgIconProps\n  }) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n    const { menuItems } = model\n    const session = getSession(model)\n\n    const items = [\n      ...(session.views.length > 1\n        ? [\n            {\n              label: 'Move view up',\n              icon: ArrowUpward,\n              onClick: () => session.moveViewUp(model.id),\n            },\n            {\n              label: 'Move view down',\n              icon: ArrowDownward,\n              onClick: () => session.moveViewDown(model.id),\n            },\n          ]\n        : []),\n\n      // <=1.3.3 didn't use a function, so check as value also\n      ...((typeof menuItems === 'function' ? menuItems() : menuItems) || []),\n    ]\n\n    return (\n      <>\n        <IconButton\n          {...IconButtonProps}\n          onClick={event => setAnchorEl(event.currentTarget)}\n          data-testid=\"view_menu_icon\"\n        >\n          <MenuIcon {...IconProps} fontSize=\"small\" />\n        </IconButton>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onMenuItemClick={(_event, callback) => {\n            callback()\n            setAnchorEl(undefined)\n          }}\n          onClose={() => setAnchorEl(undefined)}\n          menuItems={items}\n        />\n      </>\n    )\n  },\n)\nconst ViewContainer = observer(\n  ({\n    view,\n    onClose,\n    onMinimize,\n    style,\n    children,\n  }: {\n    view: IBaseViewModel\n    onClose: () => void\n    onMinimize: () => void\n    style?: React.CSSProperties\n    children: React.ReactNode\n  }) => {\n    const { classes } = useStyles()\n    const theme = useTheme()\n    const padWidth = theme.spacing(1)\n\n    const [ref, { width }] = useMeasure()\n\n    useEffect(() => {\n      if (width && isAlive(view)) {\n        view.setWidth(width - parseInt(padWidth, 10) * 2)\n      }\n    }, [padWidth, view, width])\n\n    const scrollRef = useRef<HTMLDivElement>(null)\n    // scroll the view into view when first mounted\n    // note that this effect will run only once, because of\n    // the empty array second param\n    useEffect(() => {\n      scrollRef.current?.scrollIntoView?.({ block: 'center' })\n    }, [])\n\n    return (\n      <Paper\n        ref={ref}\n        elevation={12}\n        className={classes.viewContainer}\n        style={{ ...style, padding: `0px ${padWidth} ${padWidth}` }}\n      >\n        <div ref={scrollRef} style={{ display: 'flex' }}>\n          <ViewMenu model={view} IconProps={{ className: classes.icon }} />\n          <div className={classes.grow} />\n          <Tooltip title=\"Rename view\" arrow>\n            <EditableTypography\n              value={\n                (view.displayName ||\n                  // @ts-ignore\n                  view.assemblyNames?.join(',') ||\n                  'Untitled view') + (view.minimized ? ' (minimized)' : '')\n              }\n              setValue={val => view.setDisplayName(val)}\n              variant=\"body2\"\n              classes={{\n                input: classes.input,\n                inputBase: classes.inputBase,\n                inputRoot: classes.inputRoot,\n                inputFocused: classes.inputFocused,\n              }}\n            />\n          </Tooltip>\n          <div className={classes.grow} />\n          <IconButton data-testid=\"minimize_view\" onClick={onMinimize}>\n            {view.minimized ? (\n              <AddIcon className={classes.icon} fontSize=\"small\" />\n            ) : (\n              <MinimizeIcon className={classes.icon} fontSize=\"small\" />\n            )}\n          </IconButton>\n          <IconButton data-testid=\"close_view\" onClick={onClose}>\n            <CloseIcon className={classes.icon} fontSize=\"small\" />\n          </IconButton>\n        </div>\n        <Paper>{children}</Paper>\n      </Paper>\n    )\n  },\n)\n\nexport default ViewContainer\n","const category10 = [\n  '#1f77b4',\n  '#ff7f0e',\n  '#2ca02c',\n  '#d62728',\n  '#9467bd',\n  '#8c564b',\n  '#e377c2',\n  '#7f7f7f',\n  '#bcbd22',\n  '#17becf',\n]\nconst dark2 = [\n  '#1b9e77',\n  '#d95f02',\n  '#7570b3',\n  '#e7298a',\n  '#66a61e',\n  '#e6ab02',\n  '#a6761d',\n  '#666666',\n]\nconst set1 = [\n  '#e41a1c',\n  '#377eb8',\n  '#4daf4a',\n  '#984ea3',\n  '#ff7f00',\n  '#ffff33',\n  '#a65628',\n  '#f781bf',\n  '#999999',\n]\nconst set2 = [\n  '#66c2a5',\n  '#fc8d62',\n  '#8da0cb',\n  '#e78ac3',\n  '#a6d854',\n  '#ffd92f',\n  '#e5c494',\n  '#b3b3b3',\n]\nconst tableau10 = [\n  '#4e79a7',\n  '#f28e2c',\n  '#e15759',\n  '#76b7b2',\n  '#59a14f',\n  '#edc949',\n  '#af7aa1',\n  '#ff9da7',\n  '#9c755f',\n  '#bab0ab',\n]\n\nconst ggplot2Colors6 = [\n  '#F8766D',\n  '#B79F00',\n  '#00BA38',\n  '#00BFC4',\n  '#619CFF',\n  '#F564E3',\n]\n\nconst ggplot2Colors5 = ['#F8766D', '#A3A500', '#00BF7D', '#00B0F6', '#E76BF3']\nconst ggplot2Colors4 = ['#F8766D', '#7CAE00', '#00BFC4', '#C77CFF']\nconst ggplot2Colors3 = ['#F8766D', '#00BA38', '#619CFF']\n\nexport {\n  set1,\n  set2,\n  tableau10,\n  dark2,\n  category10,\n  ggplot2Colors6,\n  ggplot2Colors5,\n  ggplot2Colors4,\n  ggplot2Colors3,\n}\n","import { getSnapshot } from 'mobx-state-tree'\nimport { ViewSnap } from './index'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nfunction lengthBetween(self: ViewSnap, start: BpOffset, end: BpOffset) {\n  let bpSoFar = 0\n  const { displayedRegions } = self\n  if (start.index === end.index) {\n    bpSoFar += end.offset - start.offset\n  } else {\n    const s = displayedRegions[start.index]\n    bpSoFar += s.end - s.start - start.offset\n    if (end.index - start.index >= 2) {\n      for (let i = start.index + 1; i < end.index; i++) {\n        const region = displayedRegions[i]\n        const len = region.end - region.start\n        bpSoFar += len\n      }\n    }\n    bpSoFar += end.offset\n  }\n  return bpSoFar\n}\n\nexport function moveTo(\n  self: ViewSnap & {\n    zoomTo: (arg: number) => number\n    scrollTo: (arg: number) => void\n  },\n  start?: BpOffset,\n  end?: BpOffset,\n) {\n  if (!start || !end) {\n    return\n  }\n  const {\n    width,\n    interRegionPaddingWidth,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n  } = self\n\n  const len = lengthBetween(self, start, end)\n  let numBlocksWideEnough = 0\n  for (let i = start.index; i < end.index; i++) {\n    const r = displayedRegions[i]\n    if ((r.end - r.start) / bpPerPx > minimumBlockWidth) {\n      numBlocksWideEnough++\n    }\n  }\n\n  const targetBpPerPx =\n    len / (width - interRegionPaddingWidth * numBlocksWideEnough)\n  const newBpPerPx = self.zoomTo(targetBpPerPx)\n\n  // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n  // the scroll so the requested range is in the middle of the screen\n  let extraBp = 0\n  if (targetBpPerPx < newBpPerPx) {\n    extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n  }\n\n  let bpToStart = -extraBp\n\n  for (let i = 0; i < self.displayedRegions.length; i += 1) {\n    const region = self.displayedRegions[i]\n    if (start.index === i) {\n      bpToStart += start.offset\n      break\n    } else {\n      bpToStart += region.end - region.start\n    }\n  }\n\n  self.scrollTo(Math.round(bpToStart / self.bpPerPx))\n}\n\n// manual return type since getSnapshot hard to infer here\nexport function pxToBp(\n  self: ViewSnap,\n  px: number,\n): {\n  coord: number\n  index: number\n  refName: string\n  oob: boolean\n  assemblyName: string\n  offset: number\n  start: number\n  end: number\n  reversed: boolean\n} {\n  let bpSoFar = 0\n  const {\n    bpPerPx,\n    offsetPx,\n    displayedRegions,\n    interRegionPaddingWidth,\n    staticBlocks,\n  } = self\n  const blocks = staticBlocks.contentBlocks\n  const bp = (offsetPx + px) * bpPerPx\n  if (bp < 0) {\n    const region = displayedRegions[0]\n    const snap = getSnapshot(region)\n    // @ts-ignore\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      coord: region.reversed\n        ? Math.floor(region.end - bp) + 1\n        : Math.floor(region.start + bp) + 1,\n      offset: bp,\n      index: 0,\n    }\n  }\n\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n  for (let i = 0; i < displayedRegions.length; i++) {\n    const region = displayedRegions[i]\n    const len = region.end - region.start\n    const offset = bp - bpSoFar\n    if (len + bpSoFar > bp && bpSoFar <= bp) {\n      const snap = getSnapshot(region)\n      // @ts-ignore\n      return {\n        // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n        ...(snap as Omit<typeof snap, symbol>),\n        oob: false,\n        offset,\n        coord: region.reversed\n          ? Math.floor(region.end - offset) + 1\n          : Math.floor(region.start + offset) + 1,\n        index: i,\n      }\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n\n  if (bp >= bpSoFar) {\n    const region = displayedRegions[displayedRegions.length - 1]\n    const len = region.end - region.start\n    const offset = bp - bpSoFar + len\n\n    const snap = getSnapshot(region)\n    // @ts-ignore\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(snap as Omit<typeof snap, symbol>),\n      oob: true,\n      offset,\n      coord: region.reversed\n        ? Math.floor(region.end - offset) + 1\n        : Math.floor(region.start + offset) + 1,\n      index: displayedRegions.length - 1,\n    }\n  }\n  return {\n    coord: 0,\n    index: 0,\n    refName: '',\n    oob: true,\n    assemblyName: '',\n    offset: 0,\n    start: 0,\n    end: 0,\n    reversed: false,\n  }\n}\n\nexport function bpToPx({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let bpSoFar = 0\n\n  const { interRegionPaddingWidth, bpPerPx, displayedRegions, staticBlocks } =\n    self\n  const blocks = staticBlocks.contentBlocks\n  const interRegionPaddingBp = interRegionPaddingWidth * bpPerPx\n  let currBlock = 0\n\n  let i = 0\n  for (; i < displayedRegions.length; i++) {\n    const region = displayedRegions[i]\n    const len = region.end - region.start\n    if (\n      refName === region.refName &&\n      coord >= region.start &&\n      coord <= region.end\n    ) {\n      if (regionNumber ? regionNumber === i : true) {\n        bpSoFar += region.reversed ? region.end - coord : coord - region.start\n        break\n      }\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen e.g. in\n    // a static block\n    if (blocks[currBlock]?.regionNumber === i) {\n      bpSoFar += len + interRegionPaddingBp\n      currBlock++\n    } else {\n      bpSoFar += len\n    }\n  }\n  const found = displayedRegions[i]\n  if (found) {\n    return {\n      index: i,\n      offsetPx: Math.round(bpSoFar / bpPerPx),\n    }\n  }\n\n  return undefined\n}\n","import { types, cast, Instance } from 'mobx-state-tree'\nimport { clamp } from './index'\nimport { Feature } from './simpleFeature'\nimport { Region, ElementId } from './types/mst'\nimport { Region as IRegion } from './types'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\nimport { moveTo, pxToBp, bpToPx, BpOffset } from './Base1DUtils'\n\n/**\n * #stateModel Base1DView\n * used in non-lgv view representations of a 1d view e.g. the two axes of the\n * dotplot use this\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Base1DView = types\n  .model('Base1DView', {\n    /**\n     * #property\n     */\n    id: ElementId,\n    /**\n     * #property\n     */\n    displayedRegions: types.array(Region),\n    /**\n     * #property\n     */\n    bpPerPx: 0,\n    /**\n     * #property\n     */\n    offsetPx: 0,\n    /**\n     * #property\n     */\n    interRegionPaddingWidth: types.optional(types.number, 0),\n    /**\n     * #property\n     */\n    minimumBlockWidth: types.optional(types.number, 0),\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    /**\n     * #action\n     */\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    /**\n     * #action\n     */\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get width() {\n      return self.volatileWidth\n    },\n    /**\n     * #getter\n     */\n    get assemblyNames() {\n      return [\n        ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n      ]\n    },\n    /**\n     * #getter\n     */\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    /**\n     * #getter\n     */\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    /**\n     * #getter\n     */\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n\n    /**\n     * #getter\n     */\n    get totalBp() {\n      return self.displayedRegions\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .views(self => ({\n    /**\n     * #getter\n     */\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n\n    /**\n     * #getter\n     */\n    get currBp() {\n      return this.dynamicBlocks\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n  }))\n  .views(self => ({\n    /**\n     * #method\n     */\n    pxToBp(px: number) {\n      return pxToBp(self, px)\n    },\n\n    /**\n     * #method\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      return bpToPx({ refName, coord, regionNumber, self })?.offsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     */\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    /**\n     * #action\n     * this makes a zoomed out view that shows all displayedRegions that makes\n     * the overview bar square with the scale bar\n     */\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n\n    /**\n     * #action\n     */\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    /**\n     * #action\n     */\n    zoomTo(newBpPerPx: number, offset = self.width / 2) {\n      const bpPerPx = newBpPerPx\n      if (bpPerPx === self.bpPerPx) {\n        return self.bpPerPx\n      }\n      const oldBpPerPx = self.bpPerPx\n      self.bpPerPx = bpPerPx\n\n      // tweak the offset so that the center of the view remains at the same coordinate\n      self.offsetPx = clamp(\n        Math.round(((self.offsetPx + offset) * oldBpPerPx) / bpPerPx - offset),\n        self.minOffset,\n        self.maxOffset,\n      )\n      return self.bpPerPx\n    },\n\n    /**\n     * #action\n     */\n    scrollTo(offsetPx: number) {\n      const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n      self.offsetPx = newOffsetPx\n      return newOffsetPx\n    },\n    /**\n     * #action\n     */\n    centerAt(coord: number, refName: string | undefined, regionNumber: number) {\n      if (!refName) {\n        return\n      }\n      const centerPx = self.bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      })\n      if (centerPx) {\n        this.scrollTo(Math.round(centerPx - self.width / 2))\n      }\n    },\n\n    /**\n     * #action\n     * note: the scroll is clamped to keep the view on the main screen\n     */\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n  .actions(self => ({\n    /**\n     * #action\n     * offset is the base-pair-offset in the displayed region, index is the index of the\n     * displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start?: BpOffset, end?: BpOffset) {\n      moveTo(self, start, end)\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","type Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  constructor(public blocks: BaseBlock[] = []) {}\n\n  push(block: BaseBlock) {\n    if (block instanceof ElidedBlock) {\n      if (this.blocks.length) {\n        const lastBlock = this.blocks[this.blocks.length - 1]\n        if (lastBlock instanceof ElidedBlock) {\n          lastBlock.push(block)\n          return\n        }\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length\n      ? this.blocks.map(blocks => blocks.widthPx).reduce((a, b) => a + b)\n      : 0\n  }\n\n  get totalWidthPxWithoutBorders() {\n    return this.blocks.length\n      ? this.blocks\n          .filter(block => block.variant !== 'boundary')\n          .map(blocks => blocks.widthPx)\n          .reduce((a, b) => a + b)\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length ? this.blocks[0].offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block instanceof ContentBlock)\n  }\n\n  get totalBp() {\n    return this.contentBlocks\n      .map(block => block.end - block.start)\n      .reduce((a, b) => a + b, 0)\n  }\n}\n\nexport class BaseBlock {\n  public regionNumber?: number\n\n  public reversed?: boolean\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  public offsetPx: number\n\n  public widthPx = 0\n\n  public variant?: string\n\n  public isLeftEndOfDisplayedRegion?: boolean\n\n  /**\n   * a block that should be shown as filled with data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: any) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n    this.offsetPx = data.offsetPx\n  }\n\n  /**\n   * rename the reference sequence of this block and return a new one\n   *\n   * @param refName -\n   * @returns either a new block with a renamed reference sequence,\n   * or the same block, if the ref name is not actually different\n   */\n  renameReference(refName: string) {\n    if (this.refName && refName !== this.refName) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return new (this.constructor as any)({ ...this, refName })\n    }\n    return this\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  public widthPx: number\n\n  public elidedBlockCount = 0\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: ElidedBlock) {\n    this.elidedBlockCount += 1\n\n    if (otherBlock) {\n      this.refName = ''\n      this.start = 0\n      this.end = 0\n      this.widthPx += otherBlock.widthPx\n    }\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {}\n","import { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { intersection2 } from './range'\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  displayedRegions.forEach((region, regionNumber) => {\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    if (\n      displayedRegionLeftPx < windowRightPx &&\n      displayedRegionRightPx > windowLeftPx\n    ) {\n      // this displayed region overlaps the view, so make a record for it\n      const [leftPx, rightPx] = intersection2(\n        windowLeftPx,\n        windowRightPx,\n        displayedRegionLeftPx,\n        displayedRegionRightPx,\n      )\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n          displayedRegionLeftPx += interRegionPaddingWidth\n        }\n\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  })\n  return blocks\n}\n","import { isStateTreeNode, getSnapshot, Instance } from 'mobx-state-tree'\nimport { assembleLocStringFast } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Region } from './types'\nimport { Region as RegionModel } from './types/mst'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: (Region | Instance<typeof RegionModel>)[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n  width = 800,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n    width: modelWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + modelWidth) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  displayedRegions.forEach((region, regionNumber) => {\n    // find the block numbers of the left and right window sides,\n    // clamp those to the region range, and then make blocks for that range\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n    const parentRegion = isStateTreeNode(region) ? getSnapshot(region) : region\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount) {\n      windowRightBlockNum = regionBlockCount - 1\n    }\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) {\n      windowLeftBlockNum = 0\n    }\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocStringFast(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += regionEnd - regionStart\n  })\n  return blocks\n}\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@mui/material/styles'\nimport { namedColorToHex, isNamedColor } from './cssColorsLevel4'\n\nexport { namedColorToHex, isNamedColor }\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n","import { hashCode } from './'\n\n// generates a short \"id fingerprint\" from the config passed to the base\n// feature adapter by recursively enumerating props, but if config is too big\n// does not process entire config (FromConfigAdapter for example can be large)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default function idMaker(args: any, id = '') {\n  const keys = Object.keys(args)\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i]\n    if (id.length > 5000) {\n      break\n    }\n    if (typeof args[key] === 'object' && args[key]) {\n      id += idMaker(args[key], id)\n    } else {\n      id += `${key}-${args[key]};`\n    }\n  }\n  return hashCode(id)\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useRef, useState } from 'react'\nimport isObject from 'is-object'\nimport PluginManager from '../PluginManager'\nimport {\n  addDisposer,\n  getParent,\n  getSnapshot,\n  getEnv as getEnvMST,\n  isAlive,\n  isStateTreeNode,\n  hasParent,\n  IAnyStateTreeNode,\n  IStateTreeNode,\n} from 'mobx-state-tree'\nimport { reaction, IReactionPublic, IReactionOptions } from 'mobx'\nimport SimpleFeature, { Feature, isFeature } from './simpleFeature'\nimport {\n  isSessionModel,\n  isDisplayModel,\n  isViewModel,\n  isTrackModel,\n  AssemblyManager,\n  Region,\n  TypeTestedByPredicate,\n} from './types'\nimport { isAbortException, checkAbortSignal } from './aborting'\nimport { BaseBlock } from './blockTypes'\nimport { isUriLocation } from './types'\n\nexport type { Feature }\nexport * from './types'\nexport * from './aborting'\nexport * from './when'\nexport * from './range'\nexport { SimpleFeature, isFeature }\n\nexport * from './offscreenCanvasPonyfill'\nexport * from './offscreenCanvasUtils'\n\nexport const inDevelopment =\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_ENV === 'development'\nexport const inProduction = !inDevelopment\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handle = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handle)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// https://stackoverflow.com/questions/56283920/how-to-debounce-a-callback-in-functional-component-using-hooks\nexport function useDebouncedCallback<A extends any[]>(\n  callback: (...args: A) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<A>()\n  const timeout = useRef<ReturnType<typeof setTimeout>>()\n\n  function cleanup() {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }\n\n  // make sure our timeout gets cleared if our consuming component gets unmounted\n  useEffect(() => cleanup, [])\n\n  return function debouncedCallback(...args: A) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    cleanup()\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/** find the first node in the hierarchy that matches the given predicate */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  if (!hasParent(node)) {\n    throw new Error('node does not have parent')\n  }\n  let currentNode: IAnyStateTreeNode | undefined = getParent<any>(node)\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) {\n      return currentNode\n    }\n    if (hasParent(currentNode)) {\n      currentNode = getParent<any>(currentNode)\n    } else {\n      break\n    }\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 170,\n  friction = 26,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = Date.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const endOfAnimation = isVelocity && isDisplacement\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() =>\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        }),\n      )\n    }\n  }\n\n  return [\n    () => update({ lastPosition: fromValue }),\n    () => cancelAnimationFrame(animationFrameId),\n  ]\n}\n\n/** find the first node in the hierarchy that matches the given 'is' typescript type guard predicate */\nexport function findParentThatIs<\n  PREDICATE extends (thing: IAnyStateTreeNode) => boolean,\n>(\n  node: IAnyStateTreeNode,\n  predicate: PREDICATE,\n): TypeTestedByPredicate<PREDICATE> & IAnyStateTreeNode {\n  return findParentThat(node, predicate) as TypeTestedByPredicate<PREDICATE> &\n    IAnyStateTreeNode\n}\n\n/** get the current JBrowse session model, starting at any node in the state tree */\nexport function getSession(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isSessionModel)\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingView(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isViewModel)\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingTrack(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isTrackModel)\n  } catch (e) {\n    throw new Error('no containing track found')\n  }\n}\n\nexport function getContainingDisplay(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isDisplayModel)\n  } catch (e) {\n    throw new Error('no containing display found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * //  '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * //  'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * //  'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * //  'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString): string {\n  return assembleLocStringFast(region, toLocale)\n}\n\n// same as assembleLocString above, but does not perform toLocaleString which\n// can slow down the speed of block calculations which use assembleLocString\n// for block.key\nexport function assembleLocStringFast(\n  region: ParsedLocString,\n  cb = (n: number): string | number => n,\n): string {\n  const { assemblyName, refName, start, end, reversed } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString\n  if (start !== undefined) {\n    startString = `:${cb(start + 1)}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString\n  if (end !== undefined) {\n    endString = start !== undefined && start + 1 === end ? '' : `..${cb(end)}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  let rev = ''\n  if (reversed) {\n    rev = '[rev]'\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}${rev}`\n}\n\nexport interface ParsedLocString {\n  assemblyName?: string\n  refName: string\n  start?: number\n  end?: number\n  reversed?: boolean\n}\n\nexport function parseLocStringOneBased(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n): ParsedLocString {\n  if (!locString) {\n    throw new Error('no location string provided, could not parse')\n  }\n  let reversed = false\n  if (locString.endsWith('[rev]')) {\n    reversed = true\n    locString = locString.replace(/\\[rev\\]$/, '')\n  }\n  // remove any whitespace\n  locString = locString.replace(/\\s/, '')\n  // refNames can have colons, ref https://samtools.github.io/hts-specs/SAMv1.pdf Appendix A\n  const assemblyMatch = locString.match(/(\\{(.+)\\})?(.+)/)\n  if (!assemblyMatch) {\n    throw new Error(`invalid location string: \"${locString}\"`)\n  }\n  const [, , assemblyName, location] = assemblyMatch\n  if (!assemblyName && location.startsWith('{}')) {\n    throw new Error(`no assembly name was provided in location \"${location}\"`)\n  }\n  const lastColonIdx = location.lastIndexOf(':')\n  if (lastColonIdx === -1) {\n    if (isValidRefName(location, assemblyName)) {\n      return { assemblyName, refName: location, reversed }\n    }\n    throw new Error(`Unknown reference sequence \"${location}\"`)\n  }\n  const prefix = location.slice(0, lastColonIdx)\n  const suffix = location.slice(lastColonIdx + 1)\n  if (\n    isValidRefName(prefix, assemblyName) &&\n    isValidRefName(location, assemblyName)\n  ) {\n    throw new Error(`ambiguous location string: \"${locString}\"`)\n  } else if (isValidRefName(prefix, assemblyName)) {\n    if (suffix) {\n      // see if it's a range\n      const rangeMatch = suffix.match(\n        /^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)(-?(\\d+|\\d{1,3}(,\\d{3})*))$/,\n      )\n      // see if it's a single point\n      const singleMatch = suffix.match(/^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)?$/)\n      if (rangeMatch) {\n        const [, start, , , , end] = rangeMatch\n        if (start !== undefined && end !== undefined) {\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +end.replace(/,/g, ''),\n            reversed,\n          }\n        }\n      } else if (singleMatch) {\n        const [, start, , , separator] = singleMatch\n        if (start !== undefined) {\n          if (separator) {\n            // indefinite end\n            return {\n              assemblyName,\n              refName: prefix,\n              start: +start.replace(/,/g, ''),\n              reversed,\n            }\n          }\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +start.replace(/,/g, ''),\n            reversed,\n          }\n        }\n      } else {\n        throw new Error(\n          `could not parse range \"${suffix}\" on location \"${locString}\"`,\n        )\n      }\n    } else {\n      return { assemblyName, refName: prefix, reversed }\n    }\n  } else if (isValidRefName(location, assemblyName)) {\n    return { assemblyName, refName: location, reversed }\n  }\n  throw new Error(`unknown reference sequence name in location \"${locString}\"`)\n}\n\n/**\n * Parse a 1-based location string into an interbase genomic location\n * @param locString - Location string\n * @param isValidRefName - Function that checks if a refName exists in the set\n * of all known refNames, or in the set of refNames for an assembly if\n * assemblyName is given\n * @example\n * ```ts\n * parseLocString('chr1:1..100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1-100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString(`{hg19}chr1:1..100`, isValidRefName)\n * //  { assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1', isValidRefName)\n * //  { refName: 'chr1' }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 1 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1..', isValidRefName)\n * //  { refName: 'chr1', start: 0}\n * ```\n */\nexport function parseLocString(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const parsed = parseLocStringOneBased(locString, isValidRefName)\n  if (typeof parsed.start === 'number') {\n    parsed.start -= 1\n  }\n  return parsed\n}\n\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) {\n    return assemblyComp\n  }\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) {\n    return refComp\n  }\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) {\n      return startComp\n    }\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) {\n      return endComp\n    }\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number) {\n  if (num < min) {\n    return min\n  }\n  if (num > max) {\n    return max\n  }\n  return num\n}\n\nfunction roundToNearestPointOne(num: number) {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  {\n    reversed,\n    end = 0,\n    start = 0,\n  }: { start?: number; end?: number; reversed?: boolean },\n  bpPerPx: number,\n) {\n  return roundToNearestPointOne((reversed ? end - bp : bp - start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180.0 / Math.PI\nconst piOverOneEighty = Math.PI / 180.0\nexport function radToDeg(radians: number) {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number) {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number) {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)] as [number, number]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta] as [number, number]\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? [end, start] : [start, end]\n}\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iterable: Iterable<T>,\n  func: (item: T) => U,\n  sizeHint?: number,\n): U[] {\n  const results = sizeHint ? new Array(sizeHint) : []\n  let counter = 0\n  for (const item of iterable) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\n// https://stackoverflow.com/a/53187807\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise.\n * @param array - The source array to search in\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true. If such an\n * element is found, findLastIndex immediately returns that element index.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: Array<T>,\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): number {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(signal), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    signal: AbortSignal,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  // @ts-ignore\n  reactionOptions: IReactionOptions,\n  startedFunction: (aborter: AbortController) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: unknown) => void,\n) {\n  let inProgress: AbortController | undefined\n\n  function handleError(error: unknown) {\n    if (!isAbortException(error)) {\n      if (isAlive(self)) {\n        errorFunction(error)\n      } else {\n        console.error(error)\n      }\n    }\n  }\n\n  addDisposer(\n    self,\n    reaction(\n      () => {\n        try {\n          return dataFunction(self)\n        } catch (e) {\n          handleError(e)\n          return undefined\n        }\n      },\n      async (data, mobxReactionHandle) => {\n        if (inProgress && !inProgress.signal.aborted) {\n          inProgress.abort()\n        }\n\n        if (!isAlive(self)) {\n          return\n        }\n        inProgress = new AbortController()\n\n        const thisInProgress = inProgress\n        startedFunction(thisInProgress)\n        try {\n          const result = await asyncReactionFunction(\n            data,\n            thisInProgress.signal,\n            self,\n            // @ts-ignore\n            mobxReactionHandle,\n          )\n          checkAbortSignal(thisInProgress.signal)\n          if (isAlive(self)) {\n            successFunction(result)\n          }\n        } catch (e) {\n          if (thisInProgress && !thisInProgress.signal.aborted) {\n            thisInProgress.abort()\n          }\n          handleError(e)\n        }\n      },\n      reactionOptions,\n    ),\n  )\n  addDisposer(self, () => {\n    if (inProgress && !inProgress.signal.aborted) {\n      inProgress.abort()\n    }\n  })\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string>,\n  region: Region,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n\n  if (region && refNameMap && refNameMap[region.refName]) {\n    // clone the region so we don't modify it\n    if (isStateTreeNode(region)) {\n      // @ts-ignore\n      region = { ...getSnapshot(region) }\n    } else {\n      region = { ...region }\n    }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return { ...region, refName: newRef, originalRefName: region.refName }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    signal?: AbortSignal\n    adapterConfig: unknown\n    sessionId: string\n    statusCallback?: (arg: string) => void\n  },\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { regions = [], adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n\n  const assemblyNames = regions.map(region => region.assemblyName)\n  const assemblyMaps = Object.fromEntries(\n    await Promise.all(\n      assemblyNames.map(async assemblyName => {\n        return [\n          assemblyName,\n          await assemblyManager.getRefNameMapForAdapter(\n            adapterConfig,\n            assemblyName,\n            args,\n          ),\n        ]\n      }),\n    ),\n  )\n\n  return {\n    ...args,\n    regions: regions.map((region, i) =>\n      // note: uses assemblyNames defined above since region could be dead now\n      renameRegionIfNeeded(assemblyMaps[assemblyNames[i]], region),\n    ),\n  }\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)]\n}\n\nexport function shorten(name: string, max = 70, short = 30) {\n  return name.length > max\n    ? name.slice(0, short) + '...' + name.slice(-short)\n    : name\n}\n\nexport function stringify({\n  refName,\n  coord,\n  oob,\n}: {\n  coord: number\n  refName?: string\n  oob?: boolean\n}) {\n  return refName\n    ? `${shorten(refName)}:${toLocale(coord)}${oob ? ' (out of bounds)' : ''}`\n    : ''\n}\n\n// this is recommended in a later comment in https://github.com/electron/electron/issues/2288\n// for detecting electron in a renderer process, which is the one that has node enabled for us\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nexport const isElectron = /electron/i.test(\n  typeof navigator !== 'undefined' ? navigator.userAgent : '',\n)\n\nexport function revcom(seqString: string) {\n  return reverse(complement(seqString))\n}\n\nexport function reverse(seqString: string) {\n  return seqString.split('').reverse().join('')\n}\n\nexport const complement = (() => {\n  const complementRegex = /[ACGT]/gi\n\n  // from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n  // generated with:\n  // perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\n  const complementTable = {\n    S: 'S',\n    w: 'w',\n    T: 'A',\n    r: 'y',\n    a: 't',\n    N: 'N',\n    K: 'M',\n    x: 'x',\n    d: 'h',\n    Y: 'R',\n    V: 'B',\n    y: 'r',\n    M: 'K',\n    h: 'd',\n    k: 'm',\n    C: 'G',\n    g: 'c',\n    t: 'a',\n    A: 'T',\n    n: 'n',\n    W: 'W',\n    X: 'X',\n    m: 'k',\n    v: 'b',\n    B: 'V',\n    s: 's',\n    H: 'D',\n    c: 'g',\n    D: 'H',\n    b: 'v',\n    R: 'Y',\n    G: 'C',\n  } as { [key: string]: string }\n\n  return (seqString: string) => {\n    return seqString.replace(complementRegex, m => complementTable[m] || '')\n  }\n})()\n\nexport function blobToDataURL(blob: Blob): Promise<string> {\n  const a = new FileReader()\n  return new Promise((resolve, reject) => {\n    a.onload = e => {\n      if (e.target) {\n        resolve(e.target.result as string)\n      } else {\n        reject(new Error('unknown result reading blob from canvas'))\n      }\n    }\n    a.readAsDataURL(blob)\n  })\n}\n\n// requires immediate execution in jest environment, because (hypothesis) it\n// otherwise listens for prerendered_canvas but reads empty pixels, and doesn't\n// get the contents of the canvas\nexport const rIC =\n  typeof jest === 'undefined'\n    ? // @ts-ignore\n      typeof window !== 'undefined' && window.requestIdleCallback\n      ? // @ts-ignore\n        window.requestIdleCallback\n      : (cb: Function) => setTimeout(() => cb(), 1)\n    : (cb: Function) => cb()\n\n// prettier-ignore\nconst widths = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2796875,0.2765625,0.3546875,0.5546875,0.5546875,0.8890625,0.665625,0.190625,0.3328125,0.3328125,0.3890625,0.5828125,0.2765625,0.3328125,0.2765625,0.3015625,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.2765625,0.2765625,0.584375,0.5828125,0.584375,0.5546875,1.0140625,0.665625,0.665625,0.721875,0.721875,0.665625,0.609375,0.7765625,0.721875,0.2765625,0.5,0.665625,0.5546875,0.8328125,0.721875,0.7765625,0.665625,0.7765625,0.721875,0.665625,0.609375,0.721875,0.665625,0.94375,0.665625,0.665625,0.609375,0.2765625,0.3546875,0.2765625,0.4765625,0.5546875,0.3328125,0.5546875,0.5546875,0.5,0.5546875,0.5546875,0.2765625,0.5546875,0.5546875,0.221875,0.240625,0.5,0.221875,0.8328125,0.5546875,0.5546875,0.5546875,0.5546875,0.3328125,0.5,0.2765625,0.5546875,0.5,0.721875,0.5,0.5,0.5,0.3546875,0.259375,0.353125,0.5890625]\n\n// xref https://gist.github.com/tophtucker/62f93a4658387bb61e4510c37e2e97cf\nexport function measureText(str: unknown, fontSize = 10) {\n  const avg = 0.5279276315789471\n  const s = String(str)\n  let total = 0\n  for (let i = 0; i < s.length; i++) {\n    const code = s.charCodeAt(i)\n    total += widths[code] ?? avg\n  }\n  return total * fontSize\n}\n\nexport const defaultStarts = ['ATG']\nexport const defaultStops = ['TAA', 'TAG', 'TGA']\nexport const defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n *  take CodonTable above and generate larger codon table that includes\n *  all permutations of upper and lower case nucleotides\n */\nexport function generateCodonTable(table: any) {\n  const tempCodonTable: { [key: string]: string } = {}\n  Object.keys(table).forEach(codon => {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i][0] = nuc.toUpperCase()\n      nucs[i][1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0][i]\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1][j]\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2][k]\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  })\n  return tempCodonTable\n}\n\n// call statusCallback with current status and clear when finished\nexport async function updateStatus<U>(\n  msg: string,\n  cb: (arg: string) => void,\n  fn: () => U,\n) {\n  cb(msg)\n  const res = await fn()\n  cb('')\n  return res\n}\n\nexport function hashCode(str: string) {\n  let hash = 0\n  if (str.length === 0) {\n    return hash\n  }\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\nexport function objectHash(obj: Record<string, any>) {\n  return `${hashCode(JSON.stringify(obj))}`\n}\n\ninterface VirtualOffset {\n  blockPosition: number\n}\ninterface Block {\n  minv: VirtualOffset\n  maxv: VirtualOffset\n}\n\nexport async function bytesForRegions(\n  regions: Region[],\n  index: {\n    blocksForRange: (\n      ref: string,\n      start: number,\n      end: number,\n    ) => Promise<Block[]>\n  },\n) {\n  const blockResults = await Promise.all(\n    regions.map(r => index.blocksForRange(r.refName, r.start, r.end)),\n  )\n\n  return blockResults\n    .flat()\n    .map(block => ({\n      start: block.minv.blockPosition,\n      end: block.maxv.blockPosition + 65535,\n    }))\n    .reduce((a, b) => a + b.end - b.start, 0)\n}\n\nexport type ViewSnap = {\n  bpPerPx: number\n  interRegionPaddingWidth: number\n  minimumBlockWidth: number\n  width: number\n  offsetPx: number\n  staticBlocks: { contentBlocks: BaseBlock[]; blocks: BaseBlock[] }\n  displayedRegions: (IStateTreeNode & {\n    start: number\n    end: number\n    refName: string\n    reversed: boolean\n    assemblyName: string\n  })[]\n}\n\n// supported adapter types by text indexer\n//  ensure that this matches the method found in @jbrowse/text-indexing/util\nexport function supportedIndexingAdapters(type: string) {\n  return [\n    'Gff3TabixAdapter',\n    'VcfTabixAdapter',\n    'Gff3Adapter',\n    'VcfAdapter',\n  ].includes(type)\n}\n\nexport function getBpDisplayStr(totalBp: number) {\n  let str\n  if (Math.floor(totalBp / 1_000_000) > 0) {\n    str = `${parseFloat((totalBp / 1_000_000).toPrecision(3))}Mbp`\n  } else if (Math.floor(totalBp / 1_000) > 0) {\n    str = `${parseFloat((totalBp / 1_000).toPrecision(3))}Kbp`\n  } else {\n    str = `${toLocale(Math.floor(totalBp))}bp`\n  }\n  return str\n}\n\nexport function toLocale(n: number) {\n  return n.toLocaleString('en-US')\n}\n\nexport function getTickDisplayStr(totalBp: number, bpPerPx: number) {\n  let str\n  if (Math.floor(bpPerPx / 1_000) > 0) {\n    str = `${toLocale(parseFloat((totalBp / 1_000_000).toFixed(2)))}M`\n  } else {\n    str = `${toLocale(Math.floor(totalBp))}`\n  }\n  return str\n}\n\nexport function getViewParams(model: IAnyStateTreeNode, exportSVG?: boolean) {\n  // @ts-ignore\n  const { dynamicBlocks, staticBlocks, offsetPx } = getContainingView(model)\n  const b = dynamicBlocks?.contentBlocks[0] || {}\n  const staticblock = staticBlocks?.contentBlocks[0] || {}\n  const staticblock1 = staticBlocks?.contentBlocks[1] || {}\n  return {\n    offsetPx: exportSVG ? 0 : offsetPx - staticblock.offsetPx,\n    offsetPx1: exportSVG ? 0 : offsetPx - staticblock1.offsetPx,\n    start: b.start,\n    end: b.end,\n  }\n}\n\nexport function getLayoutId({\n  sessionId,\n  layoutId,\n}: {\n  sessionId: string\n  layoutId: string\n}) {\n  return sessionId + '-' + layoutId\n}\n\n// Hook from https://usehooks.com/useLocalStorage/\nexport function useLocalStorage<T>(key: string, initialValue: T) {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    if (typeof window === 'undefined') {\n      return initialValue\n    }\n    try {\n      const item = window.localStorage.getItem(key)\n      return item ? JSON.parse(item) : initialValue\n    } catch (error) {\n      console.error(error)\n      return initialValue\n    }\n  })\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      const valueToStore =\n        value instanceof Function ? value(storedValue) : value\n      setStoredValue(valueToStore)\n      if (typeof window !== 'undefined') {\n        window.localStorage.setItem(key, JSON.stringify(valueToStore))\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  return [storedValue, setValue] as const\n}\n\nexport function getUriLink(value: { uri: string; baseUri?: string }) {\n  const { uri, baseUri = '' } = value\n  let href\n  try {\n    href = new URL(uri, baseUri).href\n  } catch (e) {\n    href = uri\n  }\n  return href\n}\n\nexport function getStr(obj: unknown) {\n  return isObject(obj)\n    ? isUriLocation(obj)\n      ? getUriLink(obj)\n      : JSON.stringify(obj)\n    : String(obj)\n}\n\n// heuristic measurement for a column of a @mui/x-data-grid, pass in values from a column\nexport function measureGridWidth(elements: string[]) {\n  return Math.max(\n    ...elements.map(element =>\n      Math.min(Math.max(measureText(getStr(element), 14) + 50, 80), 1000),\n    ),\n  )\n}\n\nexport function getEnv(obj: any) {\n  return getEnvMST<{ pluginManager: PluginManager }>(obj)\n}\n","import { HttpRangeFetcher } from 'http-range-fetcher'\nimport { Buffer } from 'buffer'\nimport { RemoteFile, PolyfilledResponse } from 'generic-filehandle'\n\ntype BinaryRangeFetch = (\n  url: string,\n  start: number,\n  end: number,\n  options?: { headers?: HeadersInit; signal?: AbortSignal },\n) => Promise<BinaryRangeResponse>\n\nexport interface BinaryRangeResponse {\n  headers: Record<string, string>\n  requestDate: Date\n  responseDate: Date\n  buffer: Buffer\n}\n\nconst fetchers: Record<string, BinaryRangeFetch> = {}\n\nfunction binaryRangeFetch(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n): Promise<BinaryRangeResponse> {\n  const fetcher = fetchers[url]\n  if (!fetcher) {\n    throw new Error(`fetch not registered for ${url}`)\n  }\n  return fetcher(url, start, end, options)\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  fetch: binaryRangeFetch,\n  size: 500 * 1024 ** 2, // 500MiB\n  chunkSize: 128 * 124, // 128KiB\n  maxFetchSize: 100 * 1024 ** 2, // 100MiB\n  minimumTTL: 24 * 60 * 60 * 1000, // 1 day\n})\n\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport class RemoteFileWithRangeCache extends RemoteFile {\n  public async fetch(\n    url: RequestInfo,\n    init?: RequestInit,\n  ): Promise<PolyfilledResponse> {\n    if (!fetchers[String(url)]) {\n      fetchers[String(url)] = this.fetchBinaryRange.bind(this)\n    }\n    // if it is a range request, route it through the range cache\n    const requestHeaders = init && init.headers\n    let range\n    if (requestHeaders) {\n      if (requestHeaders instanceof Headers) {\n        range = requestHeaders.get('range')\n      } else if (Array.isArray(requestHeaders)) {\n        ;[, range] = requestHeaders.find(([key]) => key === 'range') || [\n          undefined,\n          undefined,\n        ]\n      } else {\n        range = requestHeaders.range\n      }\n    }\n    if (range) {\n      const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n      if (rangeParse) {\n        const [, start, end] = rangeParse\n        const s = parseInt(start, 10)\n        const e = parseInt(end, 10)\n        const response = (await globalRangeCache.getRange(url, s, e - s + 1, {\n          signal: init && init.signal,\n        })) as BinaryRangeResponse\n        const { headers } = response\n        return new Response(response.buffer, { status: 206, headers })\n      }\n    }\n    return super.fetch(url, init)\n  }\n\n  public async fetchBinaryRange(\n    url: string,\n    start: number,\n    end: number,\n    options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n  ): Promise<BinaryRangeResponse> {\n    const requestDate = new Date()\n    const requestHeaders = {\n      ...options.headers,\n      range: `bytes=${start}-${end}`,\n    }\n    const res = await super.fetch(url, {\n      ...options,\n      headers: requestHeaders,\n    })\n    const responseDate = new Date()\n    if (res.status !== 206) {\n      const errorMessage = `HTTP ${res.status} (${res.statusText}) when fetching ${url} bytes ${start}-${end}`\n      const hint = ' (should be 206 for range requests)'\n      throw new Error(`${errorMessage}${res.status === 200 ? hint : ''}`)\n    }\n\n    // translate the Headers object into a regular key -> value object.\n    // will miss duplicate headers of course\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const headers: Record<string, any> = {}\n    for (const [k, v] of res.headers.entries()) {\n      headers[k] = v\n    }\n\n    // return the response headers, and the data buffer\n    const arrayBuffer = await res.arrayBuffer()\n    return {\n      headers,\n      requestDate,\n      responseDate,\n      buffer: Buffer.from(arrayBuffer),\n    }\n  }\n}\n","import {\n  BlobFile,\n  GenericFilehandle,\n  LocalFile,\n  Fetcher,\n} from 'generic-filehandle'\nimport isNode from 'detect-node'\n\n// locals\nimport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\nimport {\n  FileLocation,\n  LocalPathLocation,\n  BlobLocation,\n  isRootModelWithInternetAccounts,\n  isUriLocation,\n  AuthNeededError,\n  UriLocation,\n} from '../types'\nimport { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport { getBlob } from '../tracks'\nimport PluginManager from '../../PluginManager'\nimport { isElectron } from '../'\n\nexport { RemoteFileWithRangeCache }\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nexport function openLocation(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): GenericFilehandle {\n  if (!location) {\n    throw new Error('must provide a location to openLocation')\n  }\n  if (isLocalPathLocation(location)) {\n    if (!location.localPath) {\n      throw new Error('No local path provided')\n    }\n\n    if (isNode || isElectron) {\n      return new LocalFile(location.localPath)\n    } else {\n      throw new Error(\"can't use local files in the browser\")\n    }\n  }\n  if (isBlobLocation(location)) {\n    // special case where blob is not directly stored on the model, use a getter\n    const blob = getBlob(location.blobId)\n    if (!blob) {\n      throw new Error(\n        `file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`,\n      )\n    }\n    return new BlobFile(blob)\n  }\n  if (isUriLocation(location)) {\n    // Check for empty string\n    if (!location.uri) {\n      throw new Error('No URI provided')\n    }\n    // Resolve any relative URLs to absolute URLs\n    const absoluteLocation = location.baseUri\n      ? { ...location, uri: new URL(location.uri, location.baseUri).href }\n      : location\n    // If there is a plugin manager, we can try internet accounts\n    if (pluginManager) {\n      const internetAccount = getInternetAccount(location, pluginManager)\n      // If an internetAccount was found, use it to open the location\n      if (internetAccount) {\n        return internetAccount.openLocation(absoluteLocation)\n      }\n    }\n    // Otherwise fall back on usual open\n    return new RemoteFileWithRangeCache(absoluteLocation.uri, {\n      fetch: checkAuthNeededFetch,\n    })\n  }\n  throw new Error('invalid fileLocation')\n}\n\nexport function getFetcher(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): Fetcher {\n  if (!isUriLocation(location)) {\n    throw new Error(`Not a valid UriLocation: ${JSON.stringify(location)}`)\n  }\n  if (pluginManager) {\n    const internetAccount = getInternetAccount(location, pluginManager)\n    if (internetAccount) {\n      return internetAccount.getFetcher(location)\n    }\n  }\n  return checkAuthNeededFetch\n}\n\nfunction getInternetAccount(\n  location: UriLocation,\n  pluginManager: PluginManager,\n): BaseInternetAccountModel | undefined {\n  const { rootModel } = pluginManager\n  // If there is an appRootModel, use it to find the internetAccount\n  if (rootModel && isRootModelWithInternetAccounts(rootModel)) {\n    return rootModel.findAppropriateInternetAccount(location)\n  }\n  // If there is no appRootModel, but there is pre-auth, create a temporary\n  // internetAccount. This is typical in a worker.\n  if (location.internetAccountPreAuthorization) {\n    if (!location.internetAccountPreAuthorization.authInfo.token) {\n      throw new Error(\n        'Failed to obtain token from internet account. Try reloading the page',\n      )\n    }\n    const internetAccountType = pluginManager.getInternetAccountType(\n      location.internetAccountPreAuthorization.internetAccountType,\n    )\n    return internetAccountType.stateModel.create({\n      type: location.internetAccountPreAuthorization.internetAccountType,\n      configuration:\n        location.internetAccountPreAuthorization.authInfo.configuration,\n    })\n  }\n  return\n}\n\n// This fetch throws a special error if the response is \"401\" and includes a\n// \"WWW-Authenticate: Basic\" header. This is so downstream code can retry if\n// needed with HTTP Basic authentication included\nasync function checkAuthNeededFetch(url: RequestInfo, opts?: RequestInit) {\n  const response = await fetch(url, opts)\n  if (response.status === 401) {\n    if (response.headers.get('WWW-Authenticate')?.includes('Basic')) {\n      throw new AuthNeededError(\n        'Accessing HTTPBasic resource without authentication',\n        url.toString(),\n      )\n    }\n  }\n  return response\n}\n","import jexl from 'jexl'\nimport { Feature } from './simpleFeature'\n\ntype JexlWithAddFunction = typeof jexl & {\n  addFunction(name: string, func: Function): void\n}\ntype JexlNonBuildable = Omit<typeof jexl, 'Jexl'>\n\nexport default function (/* config?: any*/): JexlNonBuildable {\n  const j = new jexl.Jexl() as JexlWithAddFunction\n  // someday will make sure all of configs callbacks are added in, including\n  // ones passed in\n\n  // below are core functions\n  j.addFunction('get', (feature: Feature, data: string) => feature.get(data))\n  j.addFunction('parent', (feature: Feature) => feature.parent())\n\n  j.addFunction('id', (feature: Feature) => feature.id())\n\n  // let user cast a jexl type into a javascript type\n  j.addFunction('cast', (arg: unknown) => arg)\n\n  // logging\n  j.addFunction('log', (thing: unknown) => {\n    console.log(thing) // eslint-disable-line no-console\n    return thing\n  })\n\n  // math\n  // addfunction added in jexl 2.3 but types/jexl still on 2.2\n  j.addFunction('max', Math.max)\n  j.addFunction('min', Math.min)\n  j.addFunction('sqrt', Math.sqrt)\n  j.addFunction('ceil', Math.ceil)\n  j.addFunction('floor', Math.floor)\n  j.addFunction('round', Math.round)\n  j.addFunction('abs', Math.abs)\n  j.addFunction('log10', Math.log10)\n  j.addFunction('parseInt', Number.parseInt)\n  j.addFunction('parseFloat', Number.parseFloat)\n\n  // string\n  j.addFunction('split', (s: string, char: string) => s.split(char))\n  j.addFunction('charAt', (s: string, index: number) => s.charAt(index))\n  j.addFunction('charCodeAt', (s: string, index: number) => s.charCodeAt(index))\n  j.addFunction('codePointAt', (s: string, pos: number) => s.codePointAt(pos))\n  j.addFunction('startsWith', (s: string, search: string, len?: number) =>\n    s.startsWith(search, len),\n  )\n  j.addFunction('endsWith', (s: string, search: string, len?: number) =>\n    s.endsWith(search, len),\n  )\n  j.addFunction('padEnd', (s: string, len: number, pad?: string) =>\n    s.padEnd(len, pad),\n  )\n  j.addFunction('padStart', (s: string, len: number, fill?: string) =>\n    s.padStart(len, fill),\n  )\n  j.addFunction('repeat', (s: string, count: number) => s.repeat(count))\n  j.addFunction('replace', (s: string, match: string, sub: string) =>\n    s.replace(match, sub),\n  )\n  j.addFunction('replaceAll', (s: string, match: string, sub: string) =>\n    s.replaceAll(match, sub),\n  )\n  j.addFunction('slice', (s: string, start: number, end?: number) =>\n    s.slice(start, end),\n  )\n  j.addFunction('startsWith', (s: string, search: string, pos?: number) =>\n    s.startsWith(search, pos),\n  )\n  j.addFunction('substring', (s: string, start: number, end?: number) =>\n    s.substring(start, end),\n  )\n  j.addFunction('toLowerCase', (s: string) => s.toLowerCase())\n  j.addFunction('toUpperCase', (s: string) => s.toUpperCase())\n  j.addFunction('trim', (s: string) => s.trim())\n  j.addFunction('trimEnd', (s: string) => s.trimEnd())\n  j.addFunction('trimStart', (s: string) => s.trimStart())\n\n  j.addFunction('getTag', (feature: Feature, s: string) => {\n    const tags = feature.get('tags')\n    return tags ? tags[s] : feature.get(s)\n  })\n\n  j.addBinaryOp('&', 15, (a: number, b: number) => a & b)\n\n  return j\n}\n","import createJexlInstance from './jexl'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst compilationCache: Record<string, any> = {}\n\n// revert function strings back to main, create a different file for jexlStrings.ts\n// pass the jexl property of the pluginManager as a param\n\n/**\n * compile a jexlExpression to a string\n *\n * @param str - string of code like `jexl:...`\n * @param options -\n */\nexport function stringToJexlExpression(\n  str: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl?: any,\n) {\n  const cacheKey = `nosig|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = str.startsWith('jexl:')\n    if (!match) {\n      throw new Error('string does not appear to be in jexl format')\n    }\n    const code = str.split('jexl:')[1]\n    const compiled = jexl\n      ? jexl.compile(`${code}`)\n      : createJexlInstance().compile(`${code}`)\n    compilationCache[cacheKey] = compiled\n  }\n\n  return compilationCache[cacheKey]\n}\n","import {\n  RectTuple,\n  SerializedLayout,\n  Rectangle,\n  BaseLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: (Record<string, T> | string | undefined)[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding = 1\n\n  private allFilled?: Record<string, T> | string\n\n  private widthLimit = 1_000_000\n\n  private rowState?: RowState<T>\n\n  // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n  // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n  // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n  //      (modified by pitchX, but we don't know that in this class)\n\n  setAllFilled(data: Record<string, T> | string): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | string | undefined {\n    if (this.allFilled) {\n      return this.allFilled\n    }\n    if (\n      this.rowState?.min === undefined ||\n      x < this.rowState.min ||\n      x >= this.rowState.max\n    ) {\n      return undefined\n    }\n    return this.rowState.bits[x - this.rowState.offset]\n  }\n\n  isRangeClear(left: number, right: number) {\n    if (this.allFilled) {\n      return false\n    }\n\n    if (\n      this.rowState === undefined ||\n      right <= this.rowState.min ||\n      left >= this.rowState.max\n    ) {\n      return true\n    }\n    const { min, max, offset, bits } = this.rowState\n\n    const maxX = Math.min(max, right) - offset\n    let flag = true\n    for (let x = Math.max(min, left) - offset; x < maxX && flag; x++) {\n      flag = bits[x] === undefined\n    }\n\n    return flag\n  }\n\n  // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are\n  // interbase coordinates\n  initialize(left: number, right: number): RowState<T> {\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: new Array(3 * rectWidth),\n    }\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | string): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = this.rowState.bits.concat(\n          new Array(additionalLength),\n        )\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = new Array(additionalLength).concat(\n          this.rowState.bits,\n        )\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n    const w = oRight - oLeft\n\n    if (w > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${w} bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) {\n      this.rowState.min = left\n    }\n    if (right > this.rowState.max) {\n      this.rowState.max = right\n    }\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) {\n      return\n    } // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) {\n      return\n    }\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) {\n      return\n    }\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: Map<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  /**\n   * pitchX - layout grid pitch in the X direction\n   * pitchY - layout grid pitch in the Y direction\n   * maxHeight - maximum layout height, default Infinity (no max)\n   */\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 10000,\n    displayMode = 'normal',\n  }: {\n    pitchX?: number\n    pitchY?: number\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new Map()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: T,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) {\n        return null\n      }\n\n      // add it to the bitmap again, since that bitmap range may have been\n      // discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) {\n          break\n        }\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number) {\n    const { bitmap } = this\n\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row !== undefined && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number) {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>) {\n    if (rect.top === null) {\n      return\n    }\n\n    const data = rect.id\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just pretend, for\n      // the purposes of layout, that it extends infinitely.  this will cause\n      // weird layout if a user scrolls manually for a very, very long time\n      // along the genome at the same zoom level.  but most users will not do\n      // that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number) {\n    // console.log( 'discard', left, right );\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (let y = 0; y < bitmap.length; y += 1) {\n      const row = bitmap[y]\n      if (row) {\n        row.discardRange(pLeft, pRight)\n      }\n    }\n  }\n\n  hasSeen(id: string) {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number) {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) {\n      return undefined\n    }\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string) {\n    const r = this.rectangles.get(id)\n    if (r) {\n      const t = (r.top as number) * this.pitchY\n      return [\n        r.l * this.pitchX,\n        t,\n        r.r * this.pitchX,\n        t + r.originalHeight,\n      ] as RectTuple\n    }\n\n    return undefined\n  }\n\n  getDataByID(id: string) {\n    return this.rectangles.get(id)?.data\n  }\n\n  cleanup() {}\n\n  getTotalHeight() {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  get totalHeight() {\n    return this.getTotalHeight()\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      Array.from(this.rectangles.entries()).map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: { [key: string]: RectTuple } = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = Object.fromEntries(this.getRectangles())\n    return {\n      rectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts: Map<string, SUB_LAYOUT_CLASS> = new Map()\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    public SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    public subLayoutConstructorArgs: Record<string, any> = {},\n  ) {}\n\n  getDataByID(id: string): unknown {\n    for (const layout of this.subLayouts.values()) {\n      // @ts-ignore\n      const r = layout.getDataByID(id)\n      if (r) {\n        return r\n      }\n    }\n    return undefined\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    return this.subLayouts.get(layoutName)?.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import {\n  RectTuple,\n  SerializedLayout,\n  BaseLayout,\n  Rectangle,\n} from './BaseLayout'\nimport RBush from 'rbush'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  private rbush: RBush<Layout>\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n    this.rbush = new RBush()\n    for (const [key, layout] of Object.entries(rectangles)) {\n      this.rbush.insert({\n        minX: layout[0],\n        minY: layout[1],\n        maxX: layout[2],\n        maxY: layout[3],\n        name: key,\n      })\n    }\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  getByCoord(x: number, y: number) {\n    const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n    return this.rbush.collides(rect)\n      ? this.rbush.search(rect)[0].name\n      : undefined\n  }\n\n  getByID(id: string) {\n    return this.rectangles.get(id)\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: Object.fromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import MultiLayout from './MultiLayout'\nimport PrecomputedLayout from './PrecomputedLayout'\n\nclass ThrowingLayout {\n  constructor() {\n    throw new Error('invalid layout name')\n  }\n}\n\nexport default class PrecomputedMultiLayout extends MultiLayout {\n  constructor(json) {\n    // use ThrowingLayout because there is not supposed to be any creation\n    // of new layouts in a precomputed layout\n    super(ThrowingLayout)\n    Object.entries(json).forEach(([layoutName, sublayoutJson]) => {\n      this.subLayouts.set(layoutName, new PrecomputedLayout(sublayoutJson))\n    })\n  }\n}\n","import { inDevelopment } from '..'\n\ninterface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    public name: string,\n    public left: number,\n    public top: number,\n    public width: number,\n    public height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public data?: Record<string, any>,\n  ) {\n    if (\n      inDevelopment &&\n      (typeof name !== 'string' ||\n        typeof left !== 'number' ||\n        Number.isNaN(left) ||\n        typeof top !== 'number' ||\n        Number.isNaN(top) ||\n        typeof width !== 'number' ||\n        Number.isNaN(width) ||\n        typeof height !== 'number' ||\n        Number.isNaN(height))\n    ) {\n      throw new TypeError('invalid SceneGraph arguments')\n    }\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ): SceneGraph {\n    let child: SceneGraph\n    if (nameOrSceneGraph instanceof SceneGraph) {\n      child = nameOrSceneGraph\n    } else {\n      child = new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n    }\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name)) {\n      throw new Error(`child named \"${child.name}\" already exists`)\n    }\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string): SceneGraph | undefined {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given\n   * absolute extents, extend it to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(\n    newLeft: number,\n    newRight: number,\n    newTop: number,\n    newBottom: number,\n  ): void {\n    const { left, right, top, bottom } = this.absolute\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) {\n      this.parent.expand(newLeft, newRight, newTop, newBottom)\n    }\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  walkParents(callback: Function): void {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: Function): void {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute(): AbsoluteCache {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number): void {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren((c: SceneGraph) => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  isOptionalType,\n  isUnionType,\n  isArrayType,\n  isMapType,\n  isLateType,\n} from 'mobx-state-tree'\n\n/**\n * get the inner type of an MST optional, array, or late type object\n *\n * @param {IModelType} type\n * @returns {IModelType}\n */\nexport function getSubType(type) {\n  let t\n  if (isOptionalType(type)) {\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    t = type._subtype || type._subType || type.subType\n  } else if (typeof type.getSubType === 'function') {\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  if (!t) {\n    // debugger\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of\n * @param {MST Union Type obj} unionType\n * @returns {Array<IModelType>}\n */\nexport function getUnionSubTypes(unionType) {\n  if (!isUnionType(unionType)) {\n    throw new TypeError('not an MST union type')\n  }\n  const t =\n    unionType._types ||\n    unionType.types ||\n    getSubType(unionType)._types ||\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n *\n * @param {IModelType} type\n * @param {string} propertyName\n * @returns {IModelType}\n */\nexport function getPropertyType(type, propertyName) {\n  const propertyType = type.properties[propertyName]\n  return propertyType\n}\n\n/**\n * get the base type from inside an MST optional type\n * @param {*} type\n */\nexport function getDefaultValue(type) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  return type._defaultValue || type.defaultValue\n}\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type) {\n  const subtypes = getUnionSubTypes(type)\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","import { Observable, Observer } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { observeAbortSignal } from '.'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  signal?: AbortSignal,\n): Observable<T> {\n  return Observable.create((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      // catch async errors\n      if (ret && ret.catch) {\n        ret.catch(error => observer.error(error))\n      }\n    } catch (error) {\n      // catch sync errors\n      observer.error(error)\n    }\n  }).pipe(takeUntil(observeAbortSignal(signal)))\n}\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  get(name: 'refName'): string\n  get(name: 'start'): number\n  get(name: 'end'): number\n  get(name: 'subfeatures'): Feature[] | undefined\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(name: string): any\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  set(name: string, val: any): void\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[]\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /**\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: {}\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\nexport interface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private data: Record<string, any>\n\n  private subfeatures?: SimpleFeature[]\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data || {}\n      // load handle from args.parent (not args.data.parent)\n      // this reason is because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from\n    // args.id, args.data.uniqueId, or args.uniqueId due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n\n    if (this.data.subfeatures) {\n      this.subfeatures = this.data.subfeatures?.map(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (f: any, i: number) =>\n          typeof f.get !== 'function'\n            ? new SimpleFeature({\n                id: f.uniqueId || `${id}-${i}`,\n                data: {\n                  strand: this.data.strand,\n                  ...f,\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                } as Record<string, any>,\n                parent: this,\n              })\n            : f,\n      )\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public get(name: string): any {\n    return name === 'subfeatures'\n      ? this.subfeatures\n      : name === 'parent'\n      ? this.parent()\n      : this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) {\n      d.parentId = p.id()\n    }\n    const c = this.children()\n    if (c) {\n      d.subfeatures = c.map(child => child.toJSON())\n    }\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","import { Observable } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\nimport { NoAssemblyRegion } from './types'\nimport { Feature } from './simpleFeature'\n\nexport interface UnrectifiedFeatureStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface FeatureStats extends UnrectifiedFeatureStats {\n  featureDensity: number\n  scoreMean: number\n  scoreStdDev: number\n}\n\n/**\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @returns - the estimated std deviation\n */\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) {\n    return 0\n  }\n  let variance\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/**\n * @param stats - a summary stats object with scoreSum, featureCount, scoreSumSquares, and basesCovered\n * @returns - a summary stats object with scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedFeatureStats): FeatureStats {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  }\n}\n\n/**\n * calculates per-base scores for variable width features over a region\n * @param region - object contains start, end\n * @param features - list of features with start, end, score\n * @returns array of numeric scores\n */\nexport function calcPerBaseStats(\n  region: NoAssemblyRegion,\n  features: Feature[],\n): number[] {\n  const { start, end } = region\n  const scores = []\n  const feats = features.sort((a, b) => a.get('start') - b.get('start'))\n  let pos = start\n  let currentFeat = 0\n  let i = 0\n\n  while (pos < end) {\n    while (currentFeat < feats.length && pos >= feats[currentFeat].get('end')) {\n      currentFeat += 1\n    }\n    const f = feats[currentFeat]\n    if (!f) {\n      scores[i] = 0\n    } else if (pos >= f.get('start') && pos < f.get('end')) {\n      scores[i] = f.get('score')\n    } else {\n      scores[i] = 0\n    }\n    i += 1\n    pos += 1\n  }\n  return scores\n}\n\ninterface Seed {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n}\n\n/**\n * transform a list of scores to summary statistics\n * @param region - object with start, end\n * @param features - array of features which are possibly summary features\n * @returns - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  features: Observable<Feature>,\n) {\n  const { start, end } = region\n\n  const { scoreMin, scoreMax, scoreSum, scoreSumSquares, featureCount } =\n    await features\n      .pipe(\n        reduce(\n          (seed: Seed, f: Feature) => {\n            const s = f.get('score')\n            const summary = f.get('summary')\n            const { scoreMax, scoreMin } = seed\n            seed.scoreMax = Math.max(scoreMax, summary ? f.get('maxScore') : s)\n            seed.scoreMin = Math.min(scoreMin, summary ? f.get('minScore') : s)\n            seed.scoreSum += s\n            seed.scoreSumSquares += s * s\n            seed.featureCount += 1\n\n            return seed\n          },\n          {\n            scoreMin: Number.MAX_VALUE,\n            scoreMax: Number.MIN_VALUE,\n            scoreSum: 0,\n            scoreSumSquares: 0,\n            featureCount: 0,\n          },\n        ),\n      )\n      .toPromise()\n\n  return rectifyStats({\n    scoreMax,\n    scoreMin,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n    basesCovered: end - start + 1,\n  })\n}\n\nexport function blankStats(): FeatureStats {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  }\n}\n","import { getParent, isRoot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getSession, objectHash, getEnv } from './index'\nimport { PreFileLocation, FileLocation } from './types'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationModel,\n} from '../configuration'\n\n/* utility functions for use by track models and so forth */\n\nexport function getTrackAssemblyNames(\n  track: IAnyStateTreeNode & { configuration: AnyConfigurationModel },\n) {\n  const trackAssemblyNames = getConf(track, 'assemblyNames') as string[]\n  if (!trackAssemblyNames) {\n    // Check if it's an assembly sequence track\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parent = getParent<any>(track.configuration)\n    if ('sequence' in parent) {\n      return [readConfObject(parent, 'name') as string]\n    }\n  }\n  return trackAssemblyNames\n}\n\n/** return the rpcSessionId of the highest parent node in the tree that has an rpcSessionId */\n\nexport function getRpcSessionId(thisNode: IAnyStateTreeNode) {\n  interface NodeWithRpcSessionId extends IAnyStateTreeNode {\n    rpcSessionId: string\n  }\n  let highestRpcSessionId\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  for (let node = thisNode; !isRoot(node); node = getParent<any>(node)) {\n    if ('rpcSessionId' in node) {\n      highestRpcSessionId = (node as NodeWithRpcSessionId).rpcSessionId\n    }\n  }\n  if (!highestRpcSessionId) {\n    throw new Error(\n      'getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute',\n    )\n  }\n  return highestRpcSessionId\n}\n\n/**\n * given an MST node, get the renderprops of the first parent container that has\n * renderProps\n * @param node -\n * @returns renderprops, or empty object if none found\n */\nexport function getParentRenderProps(node: IAnyStateTreeNode) {\n  for (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let currentNode = getParent<any>(node);\n    !isRoot(currentNode);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    currentNode = getParent<any>(currentNode)\n  ) {\n    if ('renderProps' in currentNode) {\n      return currentNode.renderProps()\n    }\n  }\n\n  return {}\n}\n\nexport const UNKNOWN = 'UNKNOWN'\nexport const UNSUPPORTED = 'UNSUPPORTED'\n\nlet blobMap: { [key: string]: File } = {}\n\n// get a specific blob\nexport function getBlob(id: string) {\n  return blobMap[id]\n}\n\n// used to export entire context to webworker\nexport function getBlobMap() {\n  return blobMap\n}\n\n// used in new contexts like webworkers\nexport function setBlobMap(map: { [key: string]: File }) {\n  blobMap = map\n}\n\nlet counter = 0\n\n// blob files are stored in a global map. the blobId is based on a combination\n// of timestamp plus counter to be unique across sessions and fast repeated\n// calls\nexport function storeBlobLocation(location: PreFileLocation) {\n  if (location && 'blob' in location) {\n    const blobId = `b${+Date.now()}-${counter++}`\n    blobMap[blobId] = location.blob\n    return { name: location?.blob.name, blobId, locationType: 'BlobLocation' }\n  }\n  return location\n}\n\n/**\n * creates a new location from the provided location including the appropriate suffix and location type\n * @param location - the FileLocation\n * @param suffix - the file suffix (e.g. .bam)\n * @returns the constructed location object from the provided prameters\n */\nexport function makeIndex(location: FileLocation, suffix: string) {\n  if ('uri' in location) {\n    return { uri: location.uri + suffix, locationType: 'UriLocation' }\n  }\n\n  if ('localPath' in location) {\n    return {\n      localPath: location.localPath + suffix,\n      locationType: 'LocalPathLocation',\n    }\n  }\n\n  return location\n}\n\n/**\n * constructs a potential index file (with suffix) from the provided file name\n * @param name - the name of the index file\n * @param typeA - one option of a potential two file suffix (e.g. CSI, BAI)\n * @param typeB - the second option of a potential two file suffix (e.g. CSI, BAI)\n * @returns a likely name of the index file for a given filename\n */\nexport function makeIndexType(\n  name: string | undefined,\n  typeA: string,\n  typeB: string,\n) {\n  return name?.toUpperCase().endsWith(typeA) ? typeA : typeB\n}\n\nexport interface AdapterConfig {\n  type: string\n  [key: string]: unknown\n}\n\nexport type AdapterGuesser = (\n  file: FileLocation,\n  index?: FileLocation,\n  adapterHint?: string,\n) => AdapterConfig | undefined\n\nexport type TrackTypeGuesser = (adapterName: string) => string | undefined\n\nexport function getFileName(track: FileLocation) {\n  const uri = 'uri' in track ? track.uri : undefined\n  const localPath = 'localPath' in track ? track.localPath : undefined\n  const blob = 'blobId' in track ? track : undefined\n  return (\n    blob?.name ||\n    uri?.slice(uri.lastIndexOf('/') + 1) ||\n    localPath?.slice(localPath.lastIndexOf('/') + 1) ||\n    ''\n  )\n}\n\nexport function guessAdapter(\n  file: FileLocation,\n  index: FileLocation | undefined,\n  adapterHint?: string,\n  model?: IAnyStateTreeNode,\n) {\n  if (model) {\n    const { pluginManager } = getEnv(model)\n    const adapterGuesser = pluginManager.evaluateExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (\n        _file: FileLocation,\n        _index?: FileLocation,\n        _adapterHint?: string,\n      ): AdapterConfig | undefined => {\n        return undefined\n      },\n    ) as AdapterGuesser\n\n    const adapter = adapterGuesser(file, index, adapterHint)\n\n    if (adapter) {\n      return adapter\n    }\n  }\n\n  return {\n    type: UNKNOWN,\n  }\n}\n\nexport function guessTrackType(\n  adapterType: string,\n  model?: IAnyStateTreeNode,\n): string {\n  if (model) {\n    // @ts-ignore\n    const session = getSession(model)\n\n    const trackTypeGuesser = getEnv(\n      session,\n    ).pluginManager.evaluateExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (_adapterName: string): AdapterConfig | undefined => {\n        return undefined\n      },\n    ) as TrackTypeGuesser\n\n    const trackType = trackTypeGuesser(adapterType)\n\n    if (trackType) {\n      return trackType\n    }\n  }\n  return 'FeatureTrack'\n}\n\nexport function generateUnsupportedTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unsupported)`,\n    description: `Support not yet implemented for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n\nexport function generateUnknownTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unknown)`,\n    description: `Could not determine track type for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n\nexport function getTrackName(\n  conf: AnyConfigurationModel,\n  session: { assemblies: AnyConfigurationModel[] },\n) {\n  const trackName = readConfObject(conf, 'name')\n  if (!trackName && readConfObject(conf, 'type') === 'ReferenceSequenceTrack') {\n    const asm = session.assemblies.find(a => a.sequence === conf)\n    return asm\n      ? `Reference sequence (${\n          readConfObject(asm, 'displayName') || readConfObject(asm, 'name')\n        })`\n      : 'Reference sequence'\n  }\n  return trackName\n}\n","import shortid from 'shortid'\nimport { types } from 'mobx-state-tree'\nimport propTypes from 'prop-types'\nimport { PropTypes as MxPropTypes } from 'mobx-react'\n\nexport const ElementId = types.optional(types.identifier, shortid.generate)\n\n// PropTypes that are useful when working with instances of these in react components\nexport const PropTypes = {\n  Region: propTypes.shape({\n    refName: propTypes.string.isRequired,\n    start: propTypes.number.isRequired,\n    end: propTypes.number.isRequired,\n  }),\n  ConfigSchema: MxPropTypes.objectOrObservableObject,\n  Feature: propTypes.shape({\n    get: propTypes.func.isRequired,\n    id: propTypes.func.isRequired,\n  }),\n}\n\nexport const NoAssemblyRegion = types\n  .model('NoAssemblyRegion', {\n    refName: types.string,\n    start: types.number,\n    end: types.number,\n    reversed: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setRefName(newRefName: string): void {\n      self.refName = newRefName\n    },\n  }))\n\nexport const Region = types.compose(\n  'Region',\n  NoAssemblyRegion,\n  types.model({\n    assemblyName: types.string,\n  }),\n)\n\nexport const LocalPathLocation = types.model('LocalPathLocation', {\n  locationType: types.literal('LocalPathLocation'),\n  localPath: types.string,\n})\n\n// like how blobId is used to get a blob map\nexport const BlobLocation = types.model('BlobLocation', {\n  locationType: types.literal('BlobLocation'),\n  name: types.string,\n  blobId: types.string,\n})\n\nexport const UriLocationRaw = types.model('UriLocation', {\n  locationType: types.literal('UriLocation'),\n  uri: types.string,\n  baseUri: types.maybe(types.string),\n\n  internetAccountId: types.maybe(types.string),\n\n  // auths information (such as tokens) needed for using this resource.\n  // if provided, these must be completely sufficient for using it\n  internetAccountPreAuthorization: types.maybe(\n    types.model('InternetAccountPreAuthorization', {\n      internetAccountType: types.string,\n      authInfo: types.frozen(),\n    }),\n  ),\n})\n\nexport const UriLocation = types.snapshotProcessor(UriLocationRaw, {\n  postProcessor: snap => {\n    // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n    const { baseUri, ...rest } = snap as Omit<typeof snap, symbol>\n    if (!baseUri) {\n      return rest\n    }\n    return snap\n  },\n})\n\nexport const FileLocation = types.snapshotProcessor(\n  types.union(LocalPathLocation, UriLocation, BlobLocation),\n  {\n    // @ts-ignore\n    preProcessor(snap) {\n      if (!snap) {\n        return undefined\n      }\n\n      // @ts-ignore\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const { locationType, ...rest } = snap as Omit<typeof snap, symbol>\n      if (!locationType) {\n        // @ts-ignore\n        const { uri, localPath, blob } = rest\n        let locationType = ''\n        if (uri !== undefined) {\n          locationType = 'UriLocation'\n        } else if (localPath !== undefined) {\n          locationType = 'LocalPathLocation'\n        } else if (blob !== undefined) {\n          locationType = 'BlobLocation'\n        }\n\n        return { ...rest, locationType }\n      }\n      return snap\n    },\n  },\n)\n","import { revcom } from '@jbrowse/core/util'\nexport interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\nconst mdRegex = new RegExp(/(\\d+|\\^[a-z]+|[a-z])/gi)\nconst modificationRegex = new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/)\nexport function parseCigar(cigar = '') {\n  return cigar.split(/([MIDNSHPX=])/).slice(0, -1)\n}\nexport function cigarToMismatches(\n  ops: string[],\n  seq?: string,\n  ref?: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let roffset = 0 // reference offset\n  let soffset = 0 // seq offset\n  const mismatches: Mismatch[] = []\n  const hasRefAndSeq = ref && seq\n  for (let i = 0; i < ops.length; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n\n    if (op === 'M' || op === '=' || op === 'E') {\n      if (hasRefAndSeq) {\n        for (let j = 0; j < len; j++) {\n          if (\n            // @ts-ignore in the full yarn build of the repo, this says that object is possibly undefined for some reason, ignored\n            seq[soffset + j].toUpperCase() !== ref[roffset + j].toUpperCase()\n          ) {\n            mismatches.push({\n              start: roffset + j,\n              type: 'mismatch',\n              base: seq[soffset + j],\n              altbase: ref[roffset + j],\n              length: 1,\n            })\n          }\n        }\n      }\n      soffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: roffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      soffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: roffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: roffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq?.slice(soffset, soffset + len) || []\n      const q = qual?.slice(soffset, soffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: roffset + j,\n          type: 'mismatch',\n          base: r[j],\n          qual: q[j],\n          length: 1,\n        })\n      }\n      soffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: roffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: roffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      soffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      roffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the reference\n * @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  ops: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  const mismatchRecords: Mismatch[] = []\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < ops.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +ops[i]\n      const op = ops[i + 1]\n\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(mdRegex) || []\n  for (let i = 0; i < md.length; i++) {\n    const token = md[i]\n    const num = +token\n    if (!Number.isNaN(num)) {\n      curr.start += num\n    } else if (token.startsWith('^')) {\n      curr.start += token.length - 1\n    } else {\n      // mismatch\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = getTemplateCoordLocal(curr.start)\n        curr.base = seq[s] || 'X'\n        curr.qual = qual?.[s]\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getMismatches(\n  cigar: string,\n  md?: string,\n  seq?: string,\n  ref?: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let mismatches: Mismatch[] = []\n  const ops = parseCigar(cigar)\n\n  // parse the CIGAR tag if it has one\n  if (cigar) {\n    mismatches = mismatches.concat(cigarToMismatches(ops, seq, ref, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (md && seq) {\n    mismatches = mismatches.concat(\n      mdToMismatches(md, ops, mismatches, seq, qual),\n    )\n  }\n\n  return mismatches\n}\n// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function* getNextRefPos(cigarOps: string[], positions: number[]) {\n  let readPos = 0\n  let refPos = 0\n  let currPos = 0\n\n  for (let i = 0; i < cigarOps.length && currPos < positions.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          currPos++\n        }\n      }\n      readPos += len\n    } else if (op === 'D' || op === 'N') {\n      refPos += len\n    } else if (op === 'M' || op === 'X' || op === '=') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          yield refPos + i\n          currPos++\n        }\n      }\n      readPos += len\n      refPos += len\n    }\n  }\n}\nexport function getModificationPositions(\n  mm: string,\n  fseq: string,\n  fstrand: number,\n) {\n  const seq = fstrand === -1 ? revcom(fseq) : fseq\n  const mods = mm.split(';').filter(mod => !!mod)\n  const result = []\n  for (let i = 0; i < mods.length; i++) {\n    const mod = mods[i]\n    const [basemod, ...skips] = mod.split(',')\n\n    // regexes based on parse_mm.pl from hts-specs\n    const matches = basemod.match(modificationRegex)\n    if (!matches) {\n      throw new Error('bad format for MM tag')\n    }\n    const [, base, strand, typestr] = matches\n\n    // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n    // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n    const types = typestr.split(/(\\d+|.)/).filter(f => !!f)\n\n    if (strand === '-') {\n      console.warn('unsupported negative strand modifications')\n      // make sure to return a somewhat matching type even in this case\n      result.push({ type: 'unsupported', positions: [] as number[] })\n    }\n\n    // this logic also based on parse_mm.pl from hts-specs is that in the\n    // sequence of the read, if we have a modification type e.g. C+m;2 and a\n    // sequence ACGTACGTAC we skip the two instances of C and go to the last\n    // C\n    for (let j = 0; j < types.length; j++) {\n      const type = types[j]\n      let i = 0\n      const positions = []\n      for (let k = 0; k < skips.length; k++) {\n        let delta = +skips[k]\n        do {\n          if (base === 'N' || base === seq[i]) {\n            delta--\n          }\n          i++\n        } while (delta >= 0 && i < seq.length)\n\n        const temp = i - 1\n        positions.push(fstrand === -1 ? seq.length - 1 - temp : temp)\n      }\n      if (fstrand === -1) {\n        positions.sort((a, b) => a - b)\n      }\n      result.push({\n        type,\n        positions,\n      })\n    }\n  }\n  return result\n}\n\nexport function getModificationTypes(mm: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod] = mod.split(',')\n\n      const matches = basemod.match(modificationRegex)\n      if (!matches) {\n        throw new Error(`bad format for MM tag: ${mm}`)\n      }\n      const [, , , typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr.split(/(\\d+|.)/).filter(f => !!f)\n    })\n    .flat()\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { toArray } from 'rxjs/operators'\nimport {\n  getTag,\n  getTagAlt,\n  fetchSequence,\n  shouldFetchReferenceSequence,\n} from '../util'\nimport {\n  parseCigar,\n  getNextRefPos,\n  getModificationPositions,\n  Mismatch,\n} from '../BamAdapter/MismatchParser'\n\nfunction mismatchLen(mismatch: Mismatch) {\n  return !isInterbase(mismatch.type) ? mismatch.length : 1\n}\n\nfunction isInterbase(type: string) {\n  return type === 'softclip' || type === 'hardclip' || type === 'insertion'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction inc(bin: any, strand: number, type: string, field: string) {\n  let thisBin = bin[type][field]\n  if (thisBin === undefined) {\n    thisBin = bin[type][field] = {\n      total: 0,\n      '-1': 0,\n      '0': 0,\n      '1': 0,\n    }\n  }\n  thisBin.total++\n  thisBin[strand]++\n}\n\nexport default class SNPCoverageAdapter extends BaseFeatureDataAdapter {\n  protected async configure() {\n    const subadapterConfig = this.getConf('subadapter')\n    const sequenceConf = this.getConf(['subadapter', 'sequenceAdapter'])\n    const dataAdapter = await this.getSubAdapter?.(subadapterConfig)\n\n    const sequenceAdapter = sequenceConf\n      ? await this.getSubAdapter?.(sequenceConf)\n      : undefined\n\n    if (!dataAdapter) {\n      throw new Error('Failed to get subadapter')\n    }\n\n    return {\n      subadapter: dataAdapter.dataAdapter as BaseFeatureDataAdapter,\n      sequenceAdapter: sequenceAdapter?.dataAdapter as\n        | BaseFeatureDataAdapter\n        | undefined,\n    }\n  }\n\n  async fetchSequence(region: Region) {\n    const { sequenceAdapter } = await this.configure()\n    if (!sequenceAdapter) {\n      return undefined\n    }\n\n    return fetchSequence(region, sequenceAdapter)\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { subadapter } = await this.configure()\n      const feats = await subadapter\n        .getFeatures(region, opts)\n        .pipe(toArray())\n        .toPromise()\n\n      const { bins, skipmap } = await this.generateCoverageBins(\n        feats,\n        region,\n        opts,\n      )\n\n      bins.forEach((bin, index) => {\n        const start = region.start + index\n        observer.next(\n          new SimpleFeature({\n            id: `${this.id}-${start}`,\n            data: {\n              score: bin.total,\n              snpinfo: bin,\n              start,\n              end: start + 1,\n              refName: region.refName,\n            },\n          }),\n        )\n      })\n\n      // make fake features from the coverage\n      Object.entries(skipmap).forEach(([key, skip]) => {\n        observer.next(\n          new SimpleFeature({\n            id: key,\n            data: {\n              type: 'skip',\n              start: skip.start,\n              end: skip.end,\n              strand: skip.strand,\n              score: skip.score,\n              xs: skip.xs,\n            },\n          }),\n        )\n      })\n\n      observer.complete()\n    }, opts.signal)\n  }\n\n  async estimateRegionsStats(regions: Region[], opts?: BaseOptions) {\n    const { subadapter } = await this.configure()\n    return subadapter.estimateRegionsStats(regions, opts)\n  }\n\n  async getRefNames(opts: BaseOptions = {}) {\n    const { subadapter } = await this.configure()\n    return subadapter.getRefNames(opts)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  async generateCoverageBins(\n    features: Feature[],\n    region: Region,\n    opts: { bpPerPx?: number; colorBy?: { type: string; tag?: string } },\n  ) {\n    const { colorBy } = opts\n    const binMax = Math.ceil(region.end - region.start)\n\n    const skipmap = {} as {\n      [key: string]: {\n        score: number\n        feature: unknown\n        start: number\n        end: number\n        strand: number\n        xs: string\n      }\n    }\n\n    // bins contain:\n    // - cov feature if they contribute to coverage\n    // - noncov are insertions/clip features that don't contribute to coverage\n    // - delskips deletions or introns that don't contribute to coverage\n    type BinType = { total: number; strands: { [key: string]: number } }\n\n    const regionSeq =\n      features.length && shouldFetchReferenceSequence(opts.colorBy?.type)\n        ? await this.fetchSequence(region)\n        : undefined\n\n    const bins = [] as {\n      refbase?: string\n      total: number\n      all: number\n      ref: number\n      '-1': 0\n      '0': 0\n      '1': 0\n      lowqual: BinType\n      cov: BinType\n      delskips: BinType\n      noncov: BinType\n    }[]\n\n    for (let i = 0; i < features.length; i++) {\n      const feature = features[i]\n      const fstart = feature.get('start')\n      const fend = feature.get('end')\n      const fstrand = feature.get('strand') as -1 | 0 | 1\n\n      for (let j = fstart; j < fend + 1; j++) {\n        const i = j - region.start\n        if (i >= 0 && i < binMax) {\n          if (bins[i] === undefined) {\n            bins[i] = {\n              total: 0,\n              all: 0,\n              ref: 0,\n              '-1': 0,\n              '0': 0,\n              '1': 0,\n              lowqual: {} as BinType,\n              cov: {} as BinType,\n              delskips: {} as BinType,\n              noncov: {} as BinType,\n            }\n          }\n          if (j !== fend) {\n            bins[i].total++\n            bins[i].all++\n            bins[i].ref++\n            bins[i][fstrand]++\n          }\n        }\n      }\n\n      if (colorBy?.type === 'modifications') {\n        const seq = feature.get('seq') as string\n        const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n        const ops = parseCigar(feature.get('CIGAR'))\n        const fend = feature.get('end')\n\n        getModificationPositions(mm, seq, fstrand).forEach(\n          ({ type, positions }) => {\n            const mod = `mod_${type}`\n            for (const pos of getNextRefPos(ops, positions)) {\n              const epos = pos + fstart - region.start\n              if (epos >= 0 && epos < bins.length && pos + fstart < fend) {\n                const bin = bins[epos]\n                if (bin) {\n                  inc(bin, fstrand, 'cov', mod)\n                } else {\n                  console.warn(\n                    'Undefined position in modifications snpcoverage encountered',\n                  )\n                }\n              }\n            }\n          },\n        )\n      }\n\n      // methylation based coloring takes into account both reference\n      // sequence CpG detection and reads\n      else if (colorBy?.type === 'methylation') {\n        if (!regionSeq) {\n          throw new Error(\n            'no region sequence detected, need sequenceAdapter configuration',\n          )\n        }\n        const seq = feature.get('seq')\n        const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n        const methBins = new Array(region.end - region.start).fill(0)\n        const ops = parseCigar(feature.get('CIGAR'))\n\n        getModificationPositions(mm, seq, fstrand).forEach(\n          ({ type, positions }) => {\n            // we are processing methylation\n            if (type === 'm') {\n              for (const pos of getNextRefPos(ops, positions)) {\n                const epos = pos + fstart - region.start\n                if (epos >= 0 && epos < methBins.length) {\n                  methBins[epos] = 1\n                }\n              }\n            }\n          },\n        )\n\n        for (let j = fstart; j < fend; j++) {\n          const i = j - region.start\n          if (i >= 0 && i < bins.length - 1) {\n            const l1 = regionSeq[i].toLowerCase()\n            const l2 = regionSeq[i + 1].toLowerCase()\n            const bin = bins[i]\n            const bin1 = bins[i + 1]\n\n            // color\n            if (l1 === 'c' && l2 === 'g') {\n              if (methBins[i] || methBins[i + 1]) {\n                inc(bin, fstrand, 'cov', 'meth')\n                inc(bin1, fstrand, 'cov', 'meth')\n                bins[i].ref--\n                bins[i][fstrand]--\n                bins[i + 1].ref--\n                bins[i + 1][fstrand]--\n              } else {\n                inc(bin, fstrand, 'cov', 'unmeth')\n                inc(bin1, fstrand, 'cov', 'unmeth')\n                bins[i].ref--\n                bins[i][fstrand]--\n                bins[i + 1].ref--\n                bins[i + 1][fstrand]--\n              }\n            }\n          }\n        }\n      }\n\n      // normal SNP based coloring\n      const mismatches = (feature.get('mismatches') as Mismatch[]) || []\n      const colorSNPs =\n        colorBy?.type !== 'modifications' && colorBy?.type !== 'methylation'\n\n      for (let i = 0; i < mismatches.length; i++) {\n        const mismatch = mismatches[i]\n        const mstart = fstart + mismatch.start\n        const mlen = mismatchLen(mismatch)\n        const mend = mstart + mlen\n        for (let j = mstart; j < mstart + mlen; j++) {\n          const epos = j - region.start\n          if (epos >= 0 && epos < bins.length) {\n            const bin = bins[epos]\n            const { base, type } = mismatch\n            const interbase = isInterbase(type)\n            if (!interbase) {\n              bin.ref--\n              bin[fstrand]--\n            } else {\n              inc(bin, fstrand, 'noncov', type)\n            }\n\n            if (type === 'deletion' || type === 'skip') {\n              inc(bin, fstrand, 'delskips', type)\n              bin.total--\n            } else if (!interbase && colorSNPs) {\n              inc(bin, fstrand, 'cov', base)\n              bin.refbase = mismatch.altbase\n            }\n          }\n        }\n\n        if (mismatch.type === 'skip') {\n          const hash = `${mstart}_${mend}_${fstrand}`\n          if (skipmap[hash] === undefined) {\n            skipmap[hash] = {\n              feature: feature,\n              start: mstart,\n              end: mend,\n              strand: fstrand,\n              xs: getTag(feature, 'XS') || getTag(feature, 'TS'),\n              score: 0,\n            }\n          }\n          skipmap[hash].score++\n        }\n      }\n    }\n\n    return { bins, skipmap }\n  }\n}\n\nconst { capabilities } = SNPCoverageAdapter\nexport { capabilities }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config CramAdapter\n * used to configure CRAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'CramAdapter',\n  {\n    /**\n     * #slot fetchSizeLimit\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 3_000_000,\n    },\n\n    /**\n     * #slot cramLocation\n     */\n    cramLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot craiLocation\n     */\n    craiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.cram.crai',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot sequenceAdapter\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description: 'sequence data adapter',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\n// locals\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'CramAdapter',\n      configSchema,\n      getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BamAdapter\n * used to configure BAM adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'BamAdapter',\n  {\n    /**\n     * #slot\n     */\n    bamLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bam', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('BamIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['BAI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'BAI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bam.bai',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      description:\n        'size to fetch in bytes over which to display a warning to the user that too much data will be fetched',\n      defaultValue: 5_000_000,\n    },\n    /**\n     * #slot\n     * generally refers to the reference genome assembly's sequence adapter\n     * currently needs to be manually added\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'BamAdapter',\n      configSchema,\n      getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config HtsgetBamAdapter\n * Used to fetch data from Htsget endpoints in BAM format, using the gmod/bam library\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HtsgetBamAdapter = ConfigurationSchema(\n  'HtsgetBamAdapter',\n  {\n    /**\n     * #slot\n     */\n    htsgetBase: {\n      type: 'string',\n      description: 'the base URL to fetch from',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    htsgetTrackId: {\n      type: 'string',\n      description: 'the trackId, which is appended to the base URL',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      description:\n        'sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HtsgetBamAdapter\n","import configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'HtsgetBamAdapter',\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        configSchema,\n        getAdapterClass: () =>\n          import('./HtsgetBamAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SNPCoverageAdapter',\n  {\n    /**\n     * #slot\n     * normally refers to a BAM or CRAM adapter\n     */\n    subadapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\nimport { capabilities } from './SNPCoverageAdapter'\n\nexport default function (pluginManager: PluginManager) {\n  pluginManager.addAdapterType(() => {\n    return new AdapterType({\n      name: 'SNPCoverageAdapter',\n      adapterMetadata: {\n        category: null,\n        displayName: null,\n        hiddenFromGUI: true,\n        description: null,\n      },\n      getAdapterClass: () =>\n        import('./SNPCoverageAdapter').then(r => r.default),\n      configSchema,\n      adapterCapabilities: capabilities,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SNPCoverageRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SNPCoverageRenderer = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.4,\n    },\n    /**\n     * #slot\n     */\n    drawArcs: {\n      type: 'boolean',\n      description: 'Draw sashimi-style arcs for intron features',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    drawInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    drawIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SNPCoverageRenderer\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx, bpSpanPx, Feature } from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized as FeatureRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n  YSCALEBAR_LABEL_OFFSET,\n} from '@jbrowse/plugin-wiggle'\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  ticks: { values: number[] }\n  displayCrossHatches: boolean\n  modificationTagMap?: Record<string, string>\n}\n\ntype Counts = {\n  [key: string]: { total: number; strands: { [key: string]: number } }\n}\n\ninterface SNPInfo {\n  cov: Counts\n  noncov: Counts\n  total: number\n}\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      displayCrossHatches,\n      modificationTagMap = {},\n      scaleOpts,\n      height: unadjustedHeight,\n      theme: configTheme,\n      config: cfg,\n      ticks,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const { domain } = scaleOpts\n    if (!domain) {\n      return\n    }\n    const opts = { ...scaleOpts, range: [0, height] }\n    const viewScale = getScale(opts)\n\n    // clipping and insertion indicators, uses a smaller height/2 scale\n    const indicatorViewScale = getScale({\n      ...opts,\n      range: [0, height / 2],\n      scaleType: 'linear',\n    })\n    const originY = getOrigin(scaleOpts.scaleType)\n\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold')\n    const drawInterbaseCounts = readConfObject(cfg, 'drawInterbaseCounts')\n    const drawArcs = readConfObject(cfg, 'drawArcs')\n    const drawIndicators = readConfObject(cfg, 'drawIndicators')\n\n    // get the y coordinate that we are plotting at, this can be log scale\n    const toY = (n: number) => height - (viewScale(n) || 0) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    const indicatorToY = (n: number) =>\n      height - (indicatorViewScale(n) || 0) + offset\n    const indicatorToHeight = (n: number) =>\n      indicatorToY(getOrigin('linear')) - indicatorToY(n)\n\n    const { bases } = theme.palette\n    const colorForBase: { [key: string]: string } = {\n      A: bases.A.main,\n      C: bases.C.main,\n      G: bases.G.main,\n      T: bases.T.main,\n      total: 'lightgrey',\n      insertion: 'purple',\n      softclip: 'blue',\n      hardclip: 'red',\n      meth: 'red',\n      unmeth: 'blue',\n      ref: 'lightgrey',\n    }\n\n    const feats = [...features.values()]\n    const coverage = feats.filter(f => f.get('type') !== 'skip')\n    const skips = feats.filter(f => f.get('type') === 'skip')\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher\n    // bpPerPx First pass: draw the gray background\n    ctx.fillStyle = colorForBase.total\n    for (let i = 0; i < coverage.length; i++) {\n      const feature = coverage[i]\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3\n      const score = feature.get('score') as number\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n\n    // Keep track of previous total which we will use it to draw the interbase\n    // indicator (if there is a sudden clip, there will be no read coverage but\n    // there will be \"clip\" coverage) at that position beyond the read. if the\n    // clip is right at a block boundary then prevTotal will not be available,\n    // so this is a best attempt to plot interbase indicator at the \"cliffs\"\n    let prevTotal = 0\n\n    // extraHorizontallyFlippedOffset is used to draw interbase items, which\n    // are located to the left when forward and right when reversed\n    const extraHorizontallyFlippedOffset = region.reversed ? 1 / bpPerPx : 0\n\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px\n    // which can be wider than the actual bpPerPx This reduces overdrawing of\n    // the grey background over the SNPs\n\n    for (let i = 0; i < coverage.length; i++) {\n      const feature = coverage[i]\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      const score = feature.get('score') as number\n      const snpinfo = feature.get('snpinfo') as SNPInfo\n      const w = Math.max(rightPx - leftPx + 0.3, 1)\n      const totalScore = snpinfo.total\n      const keys = Object.keys(snpinfo.cov).sort()\n\n      let curr = 0\n      for (let i = 0; i < keys.length; i++) {\n        const base = keys[i]\n        const { total } = snpinfo.cov[base]\n        ctx.fillStyle =\n          colorForBase[base] ||\n          modificationTagMap[base.replace('mod_', '')] ||\n          '#888'\n\n        const height = toHeight(score)\n        const bottom = toY(score) + height\n        ctx.fillRect(\n          leftPx,\n          bottom - ((total + curr) / score) * height,\n          w,\n          (total / score) * height,\n        )\n        curr += total\n      }\n\n      const interbaseEvents = Object.keys(snpinfo.noncov)\n      const indicatorHeight = 4.5\n      if (drawInterbaseCounts) {\n        let curr = 0\n        for (let i = 0; i < interbaseEvents.length; i++) {\n          const base = interbaseEvents[i]\n          const { total } = snpinfo.noncov[base]\n          ctx.fillStyle = colorForBase[base]\n          ctx.fillRect(\n            leftPx - 0.6 + extraHorizontallyFlippedOffset,\n            indicatorHeight + indicatorToHeight(curr),\n            1.2,\n            indicatorToHeight(total),\n          )\n          curr += total\n        }\n      }\n\n      if (drawIndicators) {\n        let accum = 0\n        let max = 0\n        let maxBase = ''\n        for (let i = 0; i < interbaseEvents.length; i++) {\n          const base = interbaseEvents[i]\n          const { total } = snpinfo.noncov[base]\n          accum += total\n          if (total > max) {\n            max = total\n            maxBase = base\n          }\n        }\n\n        // avoid drawing a bunch of indicators if coverage is very low e.g.\n        // less than 7, uses the prev total in the case of the \"cliff\"\n        const indicatorComparatorScore = Math.max(totalScore, prevTotal)\n        if (\n          accum > indicatorComparatorScore * indicatorThreshold &&\n          indicatorComparatorScore > 7\n        ) {\n          ctx.fillStyle = colorForBase[maxBase]\n          ctx.beginPath()\n          const l = leftPx + extraHorizontallyFlippedOffset\n          ctx.moveTo(l - 3.5, 0)\n          ctx.lineTo(l + 3.5, 0)\n          ctx.lineTo(l, indicatorHeight)\n          ctx.fill()\n        }\n      }\n      prevTotal = totalScore\n    }\n\n    if (drawArcs) {\n      for (let i = 0; i < skips.length; i++) {\n        const f = skips[i]\n        const [left, right] = bpSpanPx(\n          f.get('start'),\n          f.get('end'),\n          region,\n          bpPerPx,\n        )\n\n        ctx.beginPath()\n        const str = f.get('strand') as number\n        const xs = f.get('xs') as string\n        const pos = 'rgba(255,200,200,0.7)'\n        const neg = 'rgba(200,200,255,0.7)'\n        const neutral = 'rgba(200,200,200,0.7)'\n\n        if (xs === '+') {\n          ctx.strokeStyle = pos\n        } else if (xs === '-') {\n          ctx.strokeStyle = neg\n        } else if (str === 1) {\n          ctx.strokeStyle = pos\n        } else if (str === -1) {\n          ctx.strokeStyle = neg\n        } else {\n          ctx.strokeStyle = neutral\n        }\n\n        ctx.lineWidth = Math.log(f.get('score') + 1)\n        ctx.moveTo(left, height - offset * 2)\n        ctx.bezierCurveTo(left, 0, right, 0, right, height - offset * 2)\n        ctx.stroke()\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(140,140,140,0.8)'\n      ticks.values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport SNPCoverageRenderer from './SNPCoverageRenderer'\n\nimport { WiggleRendering } from '@jbrowse/plugin-wiggle'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new SNPCoverageRenderer({\n        name: 'SNPCoverageRenderer',\n        ReactComponent: WiggleRendering,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import deepEqual from 'fast-deep-equal'\nimport { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport interface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: boolean\n}\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nexport class PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n  filterBy: unknown\n\n  showSoftClip = false\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.showSoftClip === cachedLayout.showSoftClip &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy) &&\n      deepEqual(this.filterBy, cachedLayout.filterBy)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        filterBy: this.filterBy,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import { Theme } from '@mui/material/styles'\nimport BoxRendererType, {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as BoxRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport {\n  bpSpanPx,\n  iterMap,\n  measureText,\n  Region,\n  Feature,\n} from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\n\n// locals\nimport {\n  Mismatch,\n  parseCigar,\n  getModificationPositions,\n  getNextRefPos,\n} from '../BamAdapter/MismatchParser'\nimport { sortFeature } from './sortUtil'\nimport {\n  getTagAlt,\n  orientationTypes,\n  fetchSequence,\n  shouldFetchReferenceSequence,\n} from '../util'\nimport {\n  PileupLayoutSession,\n  PileupLayoutSessionProps,\n} from './PileupLayoutSession'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nfunction fillRect(\n  ctx: CanvasRenderingContext2D,\n  l: number,\n  t: number,\n  w: number,\n  h: number,\n  cw: number,\n  color?: string,\n) {\n  if (l + w < 0 || l > cw) {\n    return\n  } else {\n    if (color) {\n      ctx.fillStyle = color\n    }\n    ctx.fillRect(l, t, w, h)\n  }\n}\n\nfunction getColorBaseMap(theme: Theme) {\n  const { bases } = theme.palette\n  return {\n    A: bases.A.main,\n    C: bases.C.main,\n    G: bases.G.main,\n    T: bases.T.main,\n    deletion: '#808080', // gray\n  }\n}\n\nfunction getContrastBaseMap(theme: Theme) {\n  return Object.fromEntries(\n    Object.entries(getColorBaseMap(theme)).map(([key, value]) => [\n      key,\n      theme.palette.getContrastText(value),\n    ]),\n  )\n}\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: { type: string; tag?: string }\n  colorTagMap?: Record<string, string>\n  modificationTagMap?: Record<string, string>\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n    assemblyName: string\n    tag?: string\n  }\n  showSoftClip: boolean\n  highResolutionScaling: number\n}\n\nexport interface RenderArgsDeserializedWithFeaturesAndLayout\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence?: string\n}\n\ninterface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nconst alignmentColoring: { [key: string]: string } = {\n  color_fwd_strand_not_proper: '#ECC8C8',\n  color_rev_strand_not_proper: '#BEBED8',\n  color_fwd_strand: '#EC8B8B',\n  color_rev_strand: '#8F8FD8',\n  color_fwd_missing_mate: '#D11919',\n  color_rev_missing_mate: '#1919D1',\n  color_fwd_diff_chr: '#000',\n  color_rev_diff_chr: '#969696',\n  color_pair_lr: '#c8c8c8',\n  color_pair_rr: 'navy',\n  color_pair_rl: 'teal',\n  color_pair_ll: 'green',\n  color_nostrand: '#c8c8c8',\n  color_interchrom: 'orange',\n  color_longinsert: 'red',\n  color_shortinsert: 'pink',\n}\n\ninterface LayoutFeature {\n  heightPx: number\n  topPx: number\n  feature: Feature\n}\n\nfunction shouldDrawSNPsMuted(type?: string) {\n  return ['methylation', 'modifications'].includes(type || '')\n}\n\nfunction shouldDrawIndels(type?: string) {\n  return true\n}\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  // get width and height of chars the height is an approximation: width\n  // letter M is approximately the height\n  getCharWidthHeight() {\n    const charWidth = measureText('A')\n    const charHeight = measureText('M') - 2\n    return { charWidth, charHeight }\n  }\n\n  layoutFeature({\n    feature,\n    layout,\n    bpPerPx,\n    region,\n    showSoftClip,\n    heightPx,\n    displayMode,\n  }: {\n    feature: Feature\n    layout: BaseLayout<Feature>\n    bpPerPx: number\n    region: Region\n    showSoftClip?: boolean\n    heightPx: number\n    displayMode: string\n  }): LayoutRecord | null {\n    let expansionBefore = 0\n    let expansionAfter = 0\n\n    // Expand the start and end of feature when softclipping enabled\n    if (showSoftClip) {\n      const mismatches = feature.get('mismatches') as Mismatch[] | undefined\n      const seq = feature.get('seq') as string\n      if (seq && mismatches) {\n        for (let i = 0; i < mismatches.length; i += 1) {\n          const { type, start, cliplen = 0 } = mismatches[i]\n          if (type === 'softclip') {\n            start === 0\n              ? (expansionBefore = cliplen)\n              : (expansionAfter = cliplen)\n          }\n        }\n      }\n    }\n\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      region,\n      bpPerPx,\n    )\n\n    if (displayMode === 'compact') {\n      heightPx /= 3\n    }\n    if (feature.get('refName') !== region.refName) {\n      throw new Error(\n        `feature ${feature.id()} is not on the current region's reference sequence ${\n          region.refName\n        }`,\n      )\n    }\n    const topPx = layout.addRect(\n      feature.id(),\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      heightPx,\n      feature,\n    )\n    if (topPx === null) {\n      return null\n    }\n\n    return {\n      feature,\n      leftPx,\n      rightPx,\n      topPx: displayMode === 'collapse' ? 0 : topPx,\n      heightPx,\n    }\n  }\n\n  // expands region for clipping to use. possible improvement: use average read\n  // size to set the heuristic maxClippingSize expansion (e.g. short reads\n  // don't have to expand a softclipping size a lot, but long reads might)\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const { start, end } = region\n    const bpExpansion = showSoftClip ? Math.round(maxClippingSize) : 0\n\n    return {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      ...(region as Omit<typeof region, symbol>),\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  colorByOrientation(feature: Feature, config: AnyConfigurationModel) {\n    return alignmentColoring[\n      this.getOrientation(feature, config) || 'color_nostrand'\n    ]\n  }\n\n  getOrientation(feature: Feature, config: AnyConfigurationModel) {\n    const orientationType = readConfObject(config, 'orientationType') as\n      | 'fr'\n      | 'ff'\n      | 'rf'\n    const type = orientationTypes[orientationType]\n    const orientation = type[feature.get('pair_orientation') as string]\n    const map: { [key: string]: string } = {\n      LR: 'color_pair_lr',\n      RR: 'color_pair_rr',\n      RL: 'color_pair_rl',\n      LL: 'color_pair_ll',\n    }\n    return map[orientation]\n  }\n\n  colorByInsertSize(feature: Feature, _config: AnyConfigurationModel) {\n    return feature.get('is_paired') &&\n      feature.get('seq_id') !== feature.get('next_seq_id')\n      ? '#555'\n      : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`\n  }\n\n  colorByStranded(feature: Feature, _config: AnyConfigurationModel) {\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    // is paired\n    if (flags & 1) {\n      const revflag = flags & 64\n      const flipper = revflag ? -1 : 1\n      // proper pairing\n      if (flags & 2) {\n        return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand'\n      }\n      if (feature.get('multi_segment_next_segment_unmapped')) {\n        return strand * flipper === 1\n          ? 'color_rev_missing_mate'\n          : 'color_fwd_missing_mate'\n      }\n      if (feature.get('seq_id') === feature.get('next_seq_id')) {\n        return strand * flipper === 1\n          ? 'color_rev_strand_not_proper'\n          : 'color_fwd_strand_not_proper'\n      }\n      // should only leave aberrant chr\n      return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr'\n    }\n    return strand === 1 ? 'color_fwd_strand' : 'color_rev_strand'\n  }\n\n  colorByPerBaseLettering({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    colorForBase,\n    contrastForBase,\n    charWidth,\n    charHeight,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    colorForBase: Record<string, string>\n    contrastForBase: Record<string, string>\n    charWidth: number\n    charHeight: number\n    canvasWidth: number\n  }) {\n    const heightLim = charHeight - 2\n    const { feature, topPx, heightPx } = feat\n    const seq = feature.get('seq') as string\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const w = 1 / bpPerPx\n    const start = feature.get('start')\n    let soffset = 0 // sequence offset\n    let roffset = 0 // reference offset\n\n    for (let i = 0; i < cigarOps.length; i += 2) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        soffset += len\n      } else if (op === 'D' || op === 'N') {\n        roffset += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const letter = seq[soffset + m]\n          const r = start + roffset + m\n          const [leftPx] = bpSpanPx(r, r + 1, region, bpPerPx)\n          fillRect(\n            ctx,\n            leftPx,\n            topPx,\n            w + 0.5,\n            heightPx,\n            canvasWidth,\n            colorForBase[letter],\n          )\n\n          if (w >= charWidth && heightPx >= heightLim) {\n            // normal SNP coloring\n            ctx.fillStyle = contrastForBase[letter]\n\n            ctx.fillText(\n              letter,\n              leftPx + (w - charWidth) / 2 + 1,\n              topPx + heightPx,\n            )\n          }\n        }\n        soffset += len\n        roffset += len\n      }\n    }\n  }\n  colorByPerBaseQuality({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const qual: string = feature.get('qual') || ''\n    const scores = qual.split(' ').map(val => +val)\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const width = 1 / bpPerPx\n    const start = feature.get('start')\n    let soffset = 0 // sequence offset\n    let roffset = 0 // reference offset\n\n    for (let i = 0; i < cigarOps.length; i += 2) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        soffset += len\n      } else if (op === 'D' || op === 'N') {\n        roffset += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const score = scores[soffset + m]\n          const [leftPx] = bpSpanPx(\n            start + roffset + m,\n            start + roffset + m + 1,\n            region,\n            bpPerPx,\n          )\n          fillRect(\n            ctx,\n            leftPx,\n            topPx,\n            width + 0.5,\n            heightPx,\n            canvasWidth,\n            `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`,\n          )\n        }\n        soffset += len\n        roffset += len\n      }\n    }\n  }\n\n  // ML stores probabilities as array of numerics and MP is scaled phred scores\n  // https://github.com/samtools/hts-specs/pull/418/files#diff-e765c6479316309f56b636f88189cdde8c40b854c7bdcce9ee7fe87a4e76febcR596\n  //\n  // if we have ML or Ml, it is an 8bit probability, divide by 255\n  //\n  // if we have MP or Mp it is phred scaled ASCII, which can go up to 90 but\n  // has very high likelihood basecalls at that point, we really only care\n  // about low qual calls <20 approx\n  //\n  colorByModifications({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    renderArgs,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const { Color, modificationTagMap = {} } = renderArgs\n\n    const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n\n    const ml = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n    const probabilities = ml\n      ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n          e => e / 255,\n        )\n      : (getTagAlt(feature, 'MP', 'Mp') as string)\n          .split('')\n          .map(s => s.charCodeAt(0) - 33)\n          .map(elt => Math.min(1, elt / 50))\n\n    const cigar = feature.get('CIGAR')\n    const start = feature.get('start')\n    const seq = feature.get('seq')\n    const strand = feature.get('strand')\n    const cigarOps = parseCigar(cigar)\n\n    const modifications = getModificationPositions(mm, seq, strand)\n\n    // probIndex applies across multiple modifications e.g.\n    let probIndex = 0\n    for (let i = 0; i < modifications.length; i++) {\n      const { type, positions } = modifications[i]\n      const col = modificationTagMap[type] || 'black'\n\n      // @ts-ignore\n      const base = Color(col)\n      for (const readPos of getNextRefPos(cigarOps, positions)) {\n        const r = start + readPos\n        const [leftPx, rightPx] = bpSpanPx(r, r + 1, region, bpPerPx)\n\n        // give it a little boost of 0.1 to not make them fully\n        // invisible to avoid confusion\n        const prob = probabilities[probIndex]\n\n        fillRect(\n          ctx,\n          leftPx,\n          topPx,\n          rightPx - leftPx + 0.5,\n          heightPx,\n          canvasWidth,\n          prob && prob !== 1\n            ? base\n                .alpha(prob + 0.1)\n                .hsl()\n                .string()\n            : col,\n        )\n        probIndex++\n      }\n    }\n  }\n\n  // Color by methylation is slightly modified version of color by\n  // modifications that focuses on CpG sites, with non-methylated CpG colored\n  // blue\n  colorByMethylation({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    renderArgs,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    canvasWidth: number\n  }) {\n    const { regionSequence } = renderArgs\n    const { feature, topPx, heightPx } = feat\n\n    const mm: string = getTagAlt(feature, 'MM', 'Mm') || ''\n\n    if (!regionSequence) {\n      throw new Error('region sequence required for methylation')\n    }\n\n    const cigar = feature.get('CIGAR')\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n    const seq = feature.get('seq')\n    const strand = feature.get('strand')\n    const cigarOps = parseCigar(cigar)\n\n    const methBins = new Array(region.end - region.start).fill(0)\n    const modifications = getModificationPositions(mm, seq, strand)\n    for (let i = 0; i < modifications.length; i++) {\n      const { type, positions } = modifications[i]\n      if (type === 'm' && positions) {\n        for (const pos of getNextRefPos(cigarOps, positions)) {\n          const epos = pos + fstart - region.start\n          if (epos >= 0 && epos < methBins.length) {\n            methBins[epos] = 1\n          }\n        }\n      }\n    }\n\n    for (let j = fstart; j < fend; j++) {\n      const i = j - region.start\n      if (i >= 0 && i < methBins.length) {\n        const l1 = regionSequence[i].toLowerCase()\n        const l2 = regionSequence[i + 1].toLowerCase()\n\n        // if we are zoomed out, display just a block over the cpg\n        if (bpPerPx > 2) {\n          if (l1 === 'c' && l2 === 'g') {\n            const s = region.start + i\n            const [leftPx, rightPx] = bpSpanPx(s, s + 2, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx,\n              topPx,\n              rightPx - leftPx + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i] || methBins[i + 1] ? 'red' : 'blue',\n            )\n          }\n        }\n        // if we are zoomed in, color the c inside the cpg\n        else {\n          // color\n          if (l1 === 'c' && l2 === 'g') {\n            const s = region.start + i\n            const [leftPx, rightPx] = bpSpanPx(s, s + 1, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx,\n              topPx,\n              rightPx - leftPx + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i] ? 'red' : 'blue',\n            )\n\n            const [leftPx2, rightPx2] = bpSpanPx(s + 1, s + 2, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx2,\n              topPx,\n              rightPx2 - leftPx2 + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i + 1] ? 'red' : 'blue',\n            )\n          }\n        }\n      }\n    }\n  }\n\n  drawRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserialized,\n  ) {\n    const { regions, bpPerPx } = props\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n    const flip = region.reversed ? -1 : 1\n    const strand = feature.get('strand') * flip\n    if (bpPerPx < 10) {\n      if (strand === -1) {\n        ctx.beginPath()\n        ctx.moveTo(leftPx - 5, topPx + heightPx / 2)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx)\n        ctx.lineTo(leftPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      } else {\n        ctx.beginPath()\n        ctx.moveTo(leftPx, topPx)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx + 5, topPx + heightPx / 2)\n        ctx.lineTo(rightPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      }\n    } else {\n      ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx)\n    }\n  }\n\n  drawAlignmentRect({\n    ctx,\n    feat,\n    renderArgs,\n    colorForBase,\n    contrastForBase,\n    charWidth,\n    charHeight,\n    defaultColor,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    colorForBase: Record<string, string>\n    contrastForBase: Record<string, string>\n    charWidth: number\n    charHeight: number\n    defaultColor: boolean\n    canvasWidth: number\n  }) {\n    const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = renderArgs\n\n    const { tag = '', type: colorType = '' } = colorBy || {}\n    const { feature } = feat\n    const region = regions[0]\n\n    // first pass for simple color changes that change the color of the\n    // alignment\n    switch (colorType) {\n      case 'insertSize':\n        ctx.fillStyle = this.colorByInsertSize(feature, config)\n        break\n      case 'strand':\n        ctx.fillStyle = feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B'\n        break\n      case 'mappingQuality':\n        ctx.fillStyle = `hsl(${feature.get('mq')},50%,50%)`\n        break\n\n      case 'pairOrientation':\n        ctx.fillStyle = this.colorByOrientation(feature, config)\n        break\n      case 'stranded':\n        ctx.fillStyle = alignmentColoring[this.colorByStranded(feature, config)]\n        break\n      case 'xs':\n      case 'tag': {\n        const tags = feature.get('tags')\n        const val = tags ? tags[tag] : feature.get(tag)\n\n        // special for for XS/TS tag\n        if (tag === 'XS' || tag === 'TS') {\n          const map: { [key: string]: string | undefined } = {\n            '-': 'color_rev_strand',\n            '+': 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // lower case 'ts' from minimap2 is flipped from xs\n        if (tag === 'ts') {\n          const map: { [key: string]: string } = {\n            '-':\n              feature.get('strand') === -1\n                ? 'color_fwd_strand'\n                : 'color_rev_strand',\n            '+':\n              feature.get('strand') === -1\n                ? 'color_rev_strand'\n                : 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // tag is not one of the autofilled tags, has color-value pairs from\n        // fetchValues\n        else {\n          const foundValue = colorTagMap[val]\n          ctx.fillStyle = foundValue || alignmentColoring['color_nostrand']\n        }\n        break\n      }\n      case 'insertSizeAndPairOrientation':\n        break\n\n      case 'modifications':\n      case 'methylation':\n        // this coloring is similar to igv.js, and is helpful to color negative\n        // strand reads differently because their c-g will be flipped (e.g. g-c\n        // read right to left)\n        if (feature.get('flags') & 16) {\n          ctx.fillStyle = '#c8dcc8'\n        } else {\n          ctx.fillStyle = '#c8c8c8'\n        }\n        break\n\n      case 'normal':\n      default:\n        if (defaultColor) {\n          // avoid a readConfObject call here\n          ctx.fillStyle = '#c8c8c8'\n        } else {\n          ctx.fillStyle = readConfObject(config, 'color', { feature })\n        }\n        break\n    }\n\n    this.drawRect(ctx, feat, renderArgs)\n\n    // second pass for color types that render per-base things that go over the\n    // existing drawing\n    switch (colorType) {\n      case 'perBaseQuality':\n        this.colorByPerBaseQuality({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          canvasWidth,\n        })\n        break\n\n      case 'perBaseLettering':\n        this.colorByPerBaseLettering({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          colorForBase,\n          contrastForBase,\n          charWidth,\n          charHeight,\n          canvasWidth,\n        })\n        break\n\n      case 'modifications':\n        this.colorByModifications({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          renderArgs,\n          canvasWidth,\n        })\n        break\n\n      case 'methylation':\n        this.colorByMethylation({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          renderArgs,\n          canvasWidth,\n        })\n        break\n    }\n  }\n\n  drawMismatches({\n    ctx,\n    feat,\n    renderArgs,\n    minSubfeatureWidth,\n    largeInsertionIndicatorScale,\n    mismatchAlpha,\n    charWidth,\n    charHeight,\n    colorForBase,\n    contrastForBase,\n    canvasWidth,\n    drawSNPsMuted,\n    drawIndels = true,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    colorForBase: { [key: string]: string }\n    contrastForBase: { [key: string]: string }\n    mismatchAlpha?: boolean\n    drawIndels?: boolean\n    drawSNPsMuted?: boolean\n    minSubfeatureWidth: number\n    largeInsertionIndicatorScale: number\n    charWidth: number\n    charHeight: number\n    canvasWidth: number\n  }) {\n    const { Color, bpPerPx, regions } = renderArgs\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const start = feature.get('start')\n\n    const pxPerBp = Math.min(1 / bpPerPx, 2)\n    const w = Math.max(minSubfeatureWidth, pxPerBp)\n    const mismatches = feature.get('mismatches') as Mismatch[] | undefined\n    const heightLim = charHeight - 2\n\n    // extraHorizontallyFlippedOffset is used to draw interbase items, which\n    // are located to the left when forward and right when reversed\n    const extraHorizontallyFlippedOffset = region.reversed\n      ? 1 / bpPerPx + 1\n      : -1\n\n    if (!mismatches) {\n      return\n    }\n\n    // two pass rendering: first pass, draw all the mismatches except wide\n    // insertion markers\n    for (let i = 0; i < mismatches.length; i += 1) {\n      const mismatch = mismatches[i]\n      const mstart = start + mismatch.start\n      const mlen = mismatch.length\n      const mbase = mismatch.base\n      const [leftPx, rightPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx)\n      const widthPx = Math.max(minSubfeatureWidth, Math.abs(leftPx - rightPx))\n      if (mismatch.type === 'mismatch') {\n        if (!drawSNPsMuted) {\n          const baseColor = colorForBase[mismatch.base] || '#888'\n\n          fillRect(\n            ctx,\n            leftPx,\n            topPx,\n            widthPx,\n            heightPx,\n            canvasWidth,\n            !mismatchAlpha\n              ? baseColor\n              : mismatch.qual !== undefined\n              ? // @ts-ignore\n                Color(baseColor)\n                  .alpha(Math.min(1, mismatch.qual / 50))\n                  .hsl()\n                  .string()\n              : baseColor,\n          )\n        }\n\n        if (widthPx >= charWidth && heightPx >= heightLim) {\n          // normal SNP coloring\n          const contrastColor = drawSNPsMuted\n            ? 'black'\n            : contrastForBase[mismatch.base] || 'black'\n          ctx.fillStyle = !mismatchAlpha\n            ? contrastColor\n            : mismatch.qual !== undefined\n            ? // @ts-ignore\n              Color(contrastColor)\n                .alpha(Math.min(1, mismatch.qual / 50))\n                .hsl()\n                .string()\n            : contrastColor\n          ctx.fillText(\n            mbase,\n            leftPx + (widthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'deletion' && drawIndels) {\n        fillRect(\n          ctx,\n          leftPx,\n          topPx,\n          widthPx,\n          heightPx,\n          canvasWidth,\n          colorForBase.deletion,\n        )\n        const txt = `${mismatch.length}`\n        const rwidth = measureText(txt, 10)\n        if (widthPx >= rwidth && heightPx >= heightLim) {\n          ctx.fillStyle = contrastForBase.deletion\n          ctx.fillText(\n            txt,\n            (leftPx + rightPx) / 2 - rwidth / 2,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'insertion' && drawIndels) {\n        ctx.fillStyle = 'purple'\n        const pos = leftPx + extraHorizontallyFlippedOffset\n        const len = +mismatch.base || mismatch.length\n        const insW = Math.max(\n          minSubfeatureWidth / 2,\n          Math.min(1.2, 1 / bpPerPx),\n        )\n        if (len < 10) {\n          fillRect(ctx, pos, topPx, insW, heightPx, canvasWidth, 'purple')\n          if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n            fillRect(ctx, pos - insW, topPx, insW * 3, 1, canvasWidth)\n            fillRect(\n              ctx,\n              pos - insW,\n              topPx + heightPx - 1,\n              insW * 3,\n              1,\n              canvasWidth,\n            )\n            ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx)\n          }\n        }\n      } else if (mismatch.type === 'hardclip' || mismatch.type === 'softclip') {\n        const pos = leftPx + extraHorizontallyFlippedOffset\n        fillRect(\n          ctx,\n          pos,\n          topPx,\n          w,\n          heightPx,\n          canvasWidth,\n          mismatch.type === 'hardclip' ? 'red' : 'blue',\n        )\n        if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n          fillRect(ctx, pos - w, topPx, w * 3, 1, canvasWidth)\n          fillRect(ctx, pos - w, topPx + heightPx - 1, w * 3, 1, canvasWidth)\n          ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx)\n        }\n      } else if (mismatch.type === 'skip') {\n        // fix to avoid bad rendering note that this was also related to chrome\n        // bug https://bugs.chromium.org/p/chromium/issues/detail?id=1131528\n        // also affected firefox ref #1236 #2750\n        if (leftPx + widthPx > 0) {\n          // make small exons more visible when zoomed far out\n          const adjustPx = widthPx - (bpPerPx > 10 ? 1.5 : 0)\n          ctx.clearRect(leftPx, topPx, adjustPx, heightPx)\n          fillRect(\n            ctx,\n            Math.max(0, leftPx),\n            topPx + heightPx / 2 - 1,\n            adjustPx + (leftPx < 0 ? leftPx : 0),\n            2,\n            canvasWidth,\n            '#333',\n          )\n        }\n      }\n    }\n\n    // second pass, draw wide insertion markers on top\n    if (drawIndels) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const mismatch = mismatches[i]\n        const mstart = start + mismatch.start\n        const mlen = mismatch.length\n        const [leftPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx)\n        const len = +mismatch.base || mismatch.length\n        const txt = `${len}`\n        if (mismatch.type === 'insertion' && len >= 10) {\n          if (bpPerPx > largeInsertionIndicatorScale) {\n            fillRect(ctx, leftPx - 1, topPx, 2, heightPx, canvasWidth, 'purple')\n          } else if (heightPx > charHeight) {\n            const rwidth = measureText(txt)\n            const padding = 5\n            fillRect(\n              ctx,\n              leftPx - rwidth / 2 - padding,\n              topPx,\n              rwidth + 2 * padding,\n              heightPx,\n              canvasWidth,\n              'purple',\n            )\n            ctx.fillStyle = 'white'\n            ctx.fillText(txt, leftPx - rwidth / 2, topPx + heightPx)\n          } else {\n            const padding = 2\n            fillRect(\n              ctx,\n              leftPx - padding,\n              topPx,\n              2 * padding,\n              heightPx,\n              canvasWidth,\n              'purple',\n            )\n          }\n        }\n      }\n    }\n  }\n\n  drawSoftClipping({\n    ctx,\n    feat,\n    renderArgs,\n    config,\n    theme,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    config: AnyConfigurationModel\n    theme: Theme\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const { regions, bpPerPx } = renderArgs\n    const [region] = regions\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const mismatches = feature.get('mismatches') as Mismatch[] | undefined\n    const seq = feature.get('seq')\n    const { charWidth, charHeight } = this.getCharWidthHeight()\n    const { bases } = theme.palette\n    const colorForBase: { [key: string]: string } = {\n      A: bases.A.main,\n      C: bases.C.main,\n      G: bases.G.main,\n      T: bases.T.main,\n      deletion: '#808080', // gray\n    }\n\n    // Display all bases softclipped off in lightened colors\n    if (!(seq && mismatches)) {\n      return\n    }\n    mismatches\n      .filter(mismatch => mismatch.type === 'softclip')\n      .forEach(mismatch => {\n        const len = mismatch.cliplen || 0\n        const s = feature.get('start')\n        const start = mismatch.start === 0 ? s - len : s + mismatch.start\n\n        for (let k = 0; k < len; k += 1) {\n          const base = seq.charAt(k + mismatch.start)\n\n          // If softclip length+start is longer than sequence, no need to\n          // continue showing base\n          if (!base) {\n            return\n          }\n\n          const [leftPx, rightPx] = bpSpanPx(\n            start + k,\n            start + k + 1,\n            region,\n            bpPerPx,\n          )\n          const widthPx = Math.max(minFeatWidth, rightPx - leftPx)\n\n          // Black accounts for IUPAC ambiguity code bases such as N that\n          // show in soft clipping\n          const baseColor = colorForBase[base] || '#000000'\n          ctx.fillStyle = baseColor\n          fillRect(ctx, leftPx, topPx, widthPx, heightPx, canvasWidth)\n\n          if (widthPx >= charWidth && heightPx >= charHeight - 5) {\n            ctx.fillStyle = theme.palette.getContrastText(baseColor)\n            ctx.fillText(\n              base,\n              leftPx + (widthPx - charWidth) / 2 + 1,\n              topPx + heightPx,\n            )\n          }\n        }\n      })\n  }\n\n  makeImageData({\n    ctx,\n    layoutRecords,\n    canvasWidth,\n    renderArgs,\n  }: {\n    ctx: CanvasRenderingContext2D\n    canvasWidth: number\n    layoutRecords: (LayoutFeature | null)[]\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n  }) {\n    const {\n      layout,\n      config,\n      showSoftClip,\n      colorBy,\n      theme: configTheme,\n    } = renderArgs\n    const mismatchAlpha = readConfObject(config, 'mismatchAlpha')\n    const minSubfeatureWidth = readConfObject(config, 'minSubfeatureWidth')\n    const largeInsertionIndicatorScale = readConfObject(\n      config,\n      'largeInsertionIndicatorScale',\n    )\n    const defaultColor = readConfObject(config, 'color') === '#f0f'\n\n    const theme = createJBrowseTheme(configTheme)\n    const colorForBase = getColorBaseMap(theme)\n    const contrastForBase = getContrastBaseMap(theme)\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n    ctx.font = 'bold 10px Courier New,monospace'\n\n    const { charWidth, charHeight } = this.getCharWidthHeight()\n    const drawSNPsMuted = shouldDrawSNPsMuted(colorBy?.type)\n    const drawIndels = shouldDrawIndels(colorBy?.type)\n    for (let i = 0; i < layoutRecords.length; i++) {\n      const feat = layoutRecords[i]\n      if (feat === null) {\n        continue\n      }\n\n      this.drawAlignmentRect({\n        ctx,\n        feat,\n        renderArgs,\n        defaultColor,\n        colorForBase,\n        contrastForBase,\n        charWidth,\n        charHeight,\n        canvasWidth,\n      })\n      this.drawMismatches({\n        ctx,\n        feat,\n        renderArgs,\n        mismatchAlpha,\n        drawSNPsMuted,\n        drawIndels,\n        largeInsertionIndicatorScale,\n        minSubfeatureWidth,\n        charWidth,\n        charHeight,\n        colorForBase,\n        contrastForBase,\n        canvasWidth,\n      })\n      if (showSoftClip) {\n        this.drawSoftClipping({\n          ctx,\n          feat,\n          renderArgs,\n          config,\n          theme,\n          canvasWidth,\n        })\n      }\n    }\n  }\n\n  // we perform a full layout before render as a separate method because the\n  // layout determines the height of the canvas that we use to render\n  layoutFeats(props: RenderArgsDeserializedWithFeaturesAndLayout) {\n    const {\n      layout,\n      features,\n      sortedBy,\n      config,\n      bpPerPx,\n      showSoftClip,\n      regions,\n    } = props\n    const [region] = regions\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n\n    const featureMap =\n      sortedBy?.type && region.start === sortedBy.pos\n        ? sortFeature(features, sortedBy)\n        : features\n\n    const heightPx = readConfObject(config, 'height')\n    const displayMode = readConfObject(config, 'displayMode')\n    return iterMap(\n      featureMap.values(),\n      feature =>\n        this.layoutFeature({\n          feature,\n          layout,\n          bpPerPx,\n          region,\n          showSoftClip,\n          heightPx,\n          displayMode,\n        }),\n      featureMap.size,\n    )\n  }\n\n  async fetchSequence(renderProps: RenderArgsDeserialized) {\n    const { sessionId, regions, adapterConfig } = renderProps\n    const { sequenceAdapter } = adapterConfig\n    if (!sequenceAdapter) {\n      return undefined\n    }\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      sequenceAdapter,\n    )\n    const [region] = regions\n    return fetchSequence(region, dataAdapter as BaseFeatureDataAdapter)\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n    const { regions, bpPerPx } = renderProps\n    const [region] = regions\n\n    const layoutRecords = this.layoutFeats({\n      ...renderProps,\n      features,\n      layout,\n    })\n\n    // only need reference sequence if there are features and only for some\n    // cases\n    const regionSequence =\n      features.size && shouldFetchReferenceSequence(renderProps.colorBy?.type)\n        ? await this.fetchSequence(renderProps)\n        : undefined\n    const { end, start } = region\n\n    const width = (end - start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n    const Color = await import('color').then(f => f.default)\n    const res = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      this.makeImageData({\n        ctx,\n        layoutRecords,\n        canvasWidth: width,\n        renderArgs: {\n          ...renderProps,\n          layout,\n          features,\n          regionSequence,\n          Color,\n        },\n      }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features: new Map(),\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n  tag?: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  const isCram = featureArray.length ? featureArray[0].get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag as string\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch && bMismatch.base.toUpperCase()\n        const bcode = aMismatch && aMismatch.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-ignore\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  const sortedMap = new Map(\n    featuresInCenterLine\n      .concat(featuresOutsideCenter)\n      .map(feature => [feature.id(), feature]),\n  )\n\n  return sortedMap\n}\n","import React, { useRef, useState, useEffect } from 'react'\nimport { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst canvasPadding = 100\nfunction PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  colorBy?: { type: string; tag?: string }\n  onMouseMove?: (event: React.MouseEvent, featureId: string | undefined) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n  } = props\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) {\n      return\n    }\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    const selectedRect = selectedFeatureId\n      ? displayModel.getFeatureByID?.(blockKey, selectedFeatureId)\n      : undefined\n    if (selectedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = selectedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    const highlightedRect = highlightedFeature\n      ? displayModel.getFeatureByID?.(blockKey, highlightedFeature)\n      : undefined\n    if (highlightedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = highlightedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    blockKey,\n    selectedFeatureId,\n    displayModel,\n    featureIdUnderMouse,\n    contextMenuFeature,\n  ])\n\n  function onMouseDown(event: React.MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: React.MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: React.MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: React.MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: React.MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: React.MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: React.MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: React.MouseEvent) {\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    let offsetX = 0\n    let offsetY = 0\n    const canvas = highlightOverlayCanvas.current\n    if (canvas) {\n      const { left, top } = canvas.getBoundingClientRect()\n      offsetX = left\n      offsetY = top\n    }\n    offsetX = event.clientX - offsetX\n    offsetY = event.clientY - offsetY\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    const featIdUnderMouse = displayModel.getFeatureOverlapping(\n      blockKey,\n      clientBp,\n      offsetY,\n    )\n\n    if (onMouseMove) {\n      onMouseMove(event, featIdUnderMouse)\n    }\n  }\n\n  function callMouseHandler(handlerName: string, event: React.MouseEvent) {\n    // @ts-ignore\n    // eslint-disable-next-line react/destructuring-assignment\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-ignore\n    // eslint-disable-next-line react/destructuring-assignment\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      data-testid={`pileup-${\n        sortedBy || colorBy\n          ? `${sortedBy?.type || ''}${colorBy?.type || ''}${colorBy?.tag || ''}`\n          : 'normal'\n      }`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height + canvasPadding}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n}\n\nexport default observer(PileupRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config PileupRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PileupRenderer = ConfigurationSchema(\n  'PileupRenderer',\n  {\n    /**\n     * #slot\n     * default magenta here is used to detect the user has not customized this\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orienation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    /**\n     * #slot\n     */\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1',\n      defaultValue: 0.7,\n    },\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    /**\n     * #slot\n     */\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    /**\n     * #slot\n     */\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default PileupRenderer\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport PileupRenderer from './PileupRenderer'\nimport ReactComponent from './components/PileupRendering'\nimport configSchema from './configSchema'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(() => {\n    return new PileupRenderer({\n      name: 'PileupRenderer',\n      ReactComponent,\n      configSchema,\n      pluginManager,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearAlignmentsDisplay\n * has a \"pileup\" sub-display, where you can see individual reads and a\n * quantitative \"snpcoverage\" sub-display track showing SNP frequencies\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configModelFactory = (pm: PluginManager) => {\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      /**\n       * #slot\n       */\n      pileupDisplay: pm.getDisplayType('LinearPileupDisplay').configSchema,\n      /**\n       * #slot\n       */\n      snpCoverageDisplay: pm.getDisplayType('LinearSNPCoverageDisplay')\n        .configSchema,\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type AlignmentsConfigModel = ReturnType<typeof configModelFactory>\nexport default configModelFactory\n","import React from 'react'\nimport {\n  ConfigurationReference,\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, getSnapshot, Instance, types } from 'mobx-state-tree'\nimport { getContainingTrack } from '@jbrowse/core/util'\nimport deepEqual from 'fast-deep-equal'\n\nconst minDisplayHeight = 20\n\n/**\n * #stateModel LinearAlignmentsDisplay\n * extends `BaseDisplay`\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         * refers to LinearPileupDisplay sub-display model\n         */\n        PileupDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearPileupDisplay').stateModel,\n        ),\n        /**\n         * #property\n         * refers to LinearSNPCoverageDisplay sub-display model\n         */\n        SNPCoverageDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n        ),\n        /**\n         * #property\n         */\n        snpCovHeight: 45,\n        /**\n         * #property\n         */\n        type: types.literal('LinearAlignmentsDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        height: 250,\n        /**\n         * #property\n         */\n        showCoverage: true,\n        /**\n         * #property\n         */\n        showPileup: true,\n        /**\n         * #property\n         */\n        userFeatureScreenDensity: types.maybe(types.number),\n      }),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleCoverage() {\n        self.showCoverage = !self.showCoverage\n      },\n      /**\n       * #action\n       */\n      togglePileup() {\n        self.showPileup = !self.showPileup\n      },\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n\n      /**\n       * #action\n       */\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #getter\n         */\n        get pileupDisplayConfig() {\n          const conf = getConf(self, 'pileupDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearPileupDisplay',\n            name: `${getConf(track, 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_pileup_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        /**\n         * #method\n         */\n        getFeatureByID(blockKey: string, id: string) {\n          return self.PileupDisplay.getFeatureByID(blockKey, id)\n        },\n        /**\n         * #method\n         */\n        searchFeatureByID(id: string) {\n          return self.PileupDisplay.searchFeatureByID(id)\n        },\n\n        /**\n         * #getter\n         */\n        get features() {\n          return self.PileupDisplay.features\n        },\n\n        /**\n         * #getter\n         */\n        get DisplayBlurb() {\n          return self.PileupDisplay?.DisplayBlurb\n        },\n\n        /**\n         * #getter\n         */\n        get sortedBy() {\n          return self.PileupDisplay.sortedBy\n        },\n        /**\n         * #getter\n         */\n        get sortedByPosition() {\n          return self.PileupDisplay.sortedByPosition\n        },\n        /**\n         * #getter\n         */\n        get sortedByRefName() {\n          return self.PileupDisplay.sortedByRefName\n        },\n\n        /**\n         * #getter\n         */\n        get snpCoverageDisplayConfig() {\n          const conf = getConf(self, 'snpCoverageDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearSNPCoverageDisplay',\n            name: `${getConf(track, 'name')} snp coverage`,\n            displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: self.SNPCoverageDisplay.trackMenuItems(),\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setSNPCoverageDisplay(configuration: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration,\n          height: self.snpCovHeight,\n        }\n      },\n      /**\n       * #action\n       */\n      updateStatsLimit(stats: unknown) {\n        self.PileupDisplay.updateStatsLimit(stats)\n        self.SNPCoverageDisplay.updateStatsLimit(stats)\n      },\n\n      /**\n       * #action\n       */\n      setPileupDisplay(configuration: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: 'LinearPileupDisplay',\n          configuration,\n        }\n      },\n      /**\n       * #action\n       */\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) {\n          self.height = displayHeight\n        } else {\n          self.height = minDisplayHeight\n        }\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (!self.SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(self.snpCoverageDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.snpCoverageDisplayConfig,\n                getSnapshot(self.SNPCoverageDisplay.configuration),\n              )\n            ) {\n              self.SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              self.SNPCoverageDisplay.setConfig(self.snpCoverageDisplayConfig)\n            }\n\n            if (!self.PileupDisplay) {\n              self.setPileupDisplay(self.pileupDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.pileupDisplayConfig,\n                getSnapshot(self.PileupDisplay.configuration),\n              )\n            ) {\n              self.PileupDisplay.setConfig(self.pileupDisplayConfig)\n            }\n\n            // propagate the filterBy setting from pileupdisplay to snpcoverage\n            // note: the snpcoverage display is not able to control filterBy\n            // itself\n            if (\n              self.PileupDisplay.filterBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.filterBy),\n                getSnapshot(self.SNPCoverageDisplay.filterBy),\n              )\n            ) {\n              self.SNPCoverageDisplay.setFilterBy(\n                getSnapshot(self.PileupDisplay.filterBy),\n              )\n            }\n            if (\n              self.PileupDisplay.colorBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.colorBy),\n                self.SNPCoverageDisplay.colorBy\n                  ? getSnapshot(self.SNPCoverageDisplay.colorBy)\n                  : {},\n              )\n            ) {\n              self.SNPCoverageDisplay.setColorBy(\n                getSnapshot(self.PileupDisplay.colorBy),\n              )\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(() => self.PileupDisplay.ready)\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {await self.PileupDisplay.renderSvg({\n                ...opts,\n                overrideHeight: pileupHeight,\n              })}\n            </g>\n          </>\n        )\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\n\n// locals\nimport { AlignmentsDisplayModel } from '../models/model'\n\nconst useStyles = makeStyles()(() => ({\n  resizeHandle: {\n    height: 2,\n    position: 'absolute',\n    zIndex: 2,\n  },\n}))\n\nfunction AlignmentsDisplay({ model }: { model: AlignmentsDisplayModel }) {\n  const { PileupDisplay, SNPCoverageDisplay, showPileup, showCoverage } = model\n  const { classes } = useStyles()\n  const top = SNPCoverageDisplay.height\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      {showCoverage ? (\n        <>\n          <div data-testid=\"Blockset-snpcoverage\">\n            <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n          </div>\n          <ResizeHandle\n            onDrag={delta => {\n              SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n              return delta\n            }}\n            className={classes.resizeHandle}\n            style={{\n              top,\n            }}\n          />\n        </>\n      ) : null}\n\n      {showPileup ? (\n        <div\n          data-testid=\"Blockset-pileup\"\n          style={{\n            position: 'absolute',\n            top: showCoverage ? SNPCoverageDisplay.height : 0,\n          }}\n        >\n          <PileupDisplay.RenderingComponent model={PileupDisplay} />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nexport default observer(AlignmentsDisplay)\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport ReactComponent from './components/AlignmentsDisplay'\n\nexport default function (pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearAlignmentsDisplay',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Tooltip } from '@jbrowse/plugin-wiggle'\n\ntype Count = {\n  [key: string]: {\n    total: number\n    '-1': number\n    '0': number\n    '1': number\n  }\n}\n\ntype SNPInfo = {\n  cov: Count\n  lowqual: Count\n  noncov: Count\n  delskips: Count\n  refbase: string\n  total: number\n  ref: number\n  all: number\n  '-1': number\n  '0': number\n  '1': number\n}\n\nconst en = (n: number) => n.toLocaleString('en-US')\nconst toP = (s = 0) => +(+s).toFixed(1)\nconst pct = (n: number, total: number) => `${toP((n / (total || 1)) * 100)}%`\n\nconst TooltipContents = React.forwardRef<HTMLDivElement, { feature: Feature }>(\n  ({ feature }, reactRef) => {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const {\n      refbase,\n      all,\n      total,\n      ref,\n      '-1': rn1,\n      '1': r1,\n      '0': r0,\n      ...info\n    } = feature.get('snpinfo') as SNPInfo\n    const loc = [name, start === end ? en(start) : `${en(start)}..${en(end)}`]\n      .filter(f => !!f)\n      .join(':')\n\n    return (\n      <div ref={reactRef}>\n        <table>\n          <caption>{loc}</caption>\n          <thead>\n            <tr>\n              <th>Base</th>\n              <th>Count</th>\n              <th>% of Total</th>\n              <th>Strands</th>\n              <th>Source</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td>Total</td>\n              <td>{all}</td>\n            </tr>\n            <tr>\n              <td>REF {refbase ? `(${refbase.toUpperCase()})` : ''}</td>\n              <td>{ref}</td>\n              <td>{pct(ref, all)}</td>\n              <td>\n                {rn1 ? `${rn1}(-)` : ''}\n                {r1 ? `${r1}(+)` : ''}\n              </td>\n              <td />\n            </tr>\n\n            {Object.entries(info as unknown as Record<string, Count>).map(\n              ([key, entry]) =>\n                Object.entries(entry).map(([base, score]) => (\n                  <tr key={base}>\n                    <td>{base.toUpperCase()}</td>\n                    <td>{score.total}</td>\n                    <td>\n                      {base === 'total' || base === 'skip'\n                        ? '---'\n                        : pct(score.total, all)}\n                    </td>\n                    <td>\n                      {score['-1'] ? `${score['-1']}(-)` : ''}\n                      {score['1'] ? `${score['1']}(+)` : ''}\n                    </td>\n                    <td>{key}</td>\n                  </tr>\n                )),\n            )}\n          </tbody>\n        </table>\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst SNPCoverageTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n  }) => {\n    const { model } = props\n    const { featureUnderMouse: feat } = model\n    return feat && feat.get('type') === 'skip' ? null : (\n      <Tooltip TooltipContents={TooltipContents} {...props} />\n    )\n  },\n)\n\nexport default SNPCoverageTooltip\n","import { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport async function getUniqueTagValues(\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel },\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\nexport async function getUniqueModificationValues(\n  self: IAnyStateTreeNode & {\n    parentTrack: IAnyStateTreeNode & { configuration: AnyConfigurationModel }\n  },\n  adapterConfig: AnyConfigurationModel,\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { addDisposer, types, cast, getEnv, getSnapshot } from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getContainingView } from '@jbrowse/core/util'\n\n// locals\nimport Tooltip from '../components/Tooltip'\nimport { getUniqueModificationValues } from '../../shared'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearSNPCoverageDisplay\n * extends `LinearWiggleDisplay`\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSNPCoverageDisplay'),\n        /**\n         * #property\n         */\n        drawInterbaseCounts: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        drawIndicators: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        drawArcs: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1540),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n        /**\n         * #property\n         */\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      modificationTagMap: observable.map({}),\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      /**\n       * #action\n       */\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n      /**\n       * #action\n       */\n      setColorBy(colorBy?: { type: string; tag?: string }) {\n        self.colorBy = cast(colorBy)\n      },\n\n      /**\n       * #action\n       */\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        let i = 0\n\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const newColor = colorPalette[i++]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #getter\n         */\n        get rendererConfig() {\n          const configBlob =\n            getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n          return self.rendererType.configSchema.create(\n            {\n              ...configBlob,\n              drawInterbaseCounts:\n                self.drawInterbaseCounts ?? configBlob.drawInterbaseCounts,\n              drawIndicators: self.drawIndicators ?? configBlob.drawIndicators,\n              drawArcs: self.drawArcs ?? configBlob.drawArcs,\n            },\n            getEnv(self),\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawArcsSetting() {\n          return (\n            self.drawArcs ?? readConfObject(this.rendererConfig, 'drawArcs')\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawInterbaseCountsSetting() {\n          return (\n            self.drawInterbaseCounts ??\n            readConfObject(this.rendererConfig, 'drawInterbaseCounts')\n          )\n        },\n        /**\n         * #getter\n         */\n        get drawIndicatorsSetting() {\n          return (\n            self.drawIndicators ??\n            readConfObject(this.rendererConfig, 'drawIndicators')\n          )\n        },\n\n        /**\n         * #getter\n         */\n        get modificationsReady() {\n          return self.colorBy?.type === 'modifications'\n            ? Object.keys(JSON.parse(JSON.stringify(self.modificationTagMap)))\n                .length > 0\n            : true\n        },\n\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          const { colorBy, filterBy, modificationTagMap } = self\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !this.modificationsReady,\n            modificationTagMap: Object.fromEntries(modificationTagMap.toJSON()),\n\n            // must use getSnapshot because otherwise changes to e.g. just the\n            // colorBy.type are not read\n            colorBy: colorBy ? getSnapshot(colorBy) : undefined,\n            filterBy: filterBy ? getSnapshot(filterBy) : undefined,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleDrawIndicators() {\n        self.drawIndicators = !self.drawIndicatorsSetting\n      },\n      /**\n       * #action\n       */\n      toggleDrawInterbaseCounts() {\n        self.drawInterbaseCounts = !self.drawInterbaseCountsSetting\n      },\n      /**\n       * #action\n       */\n      toggleDrawArcs() {\n        self.drawArcs = !self.drawArcsSetting\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { colorBy } = self\n                const view = getContainingView(self) as LGV\n\n                if (\n                  !view.initialized ||\n                  !self.estimatedStatsReady ||\n                  self.regionTooLarge\n                ) {\n                  return\n                }\n                const { staticBlocks } = view\n                if (colorBy?.type === 'modifications') {\n                  const adapter = getConf(self.parentTrack, 'adapter')\n                  self.updateModificationColorMap(\n                    await getUniqueModificationValues(\n                      self,\n                      adapter,\n                      colorBy,\n                      staticBlocks,\n                    ),\n                  )\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n    }))\n\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        /**\n         * #getter\n         */\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        /**\n         * #getter\n         */\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        /**\n         * #getter\n         */\n        get needsScalebar() {\n          return true\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          return []\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Draw insertion/clipping indicators',\n              type: 'checkbox',\n              checked: self.drawIndicatorsSetting,\n              onClick: () => self.toggleDrawIndicators(),\n            },\n            {\n              label: 'Draw insertion/clipping counts',\n              type: 'checkbox',\n              checked: self.drawInterbaseCountsSetting,\n              onClick: () => self.toggleDrawInterbaseCounts(),\n            },\n            {\n              label: 'Draw arcs',\n              type: 'checkbox',\n              checked: self.drawArcsSetting,\n              onClick: () => self.toggleDrawArcs(),\n            },\n          ]\n        },\n      }\n    })\n}\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearSNPCoverageDisplay',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearSNPCoverageDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      /**\n       * #slot\n       */ inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      multiTicks: {\n        type: 'boolean',\n        description: 'Display multiple values for the ticks',\n        defaultValue: false,\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: pluginManager.getRendererType(\n          'SNPCoverageRenderer',\n        ).configSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearPileupDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaF(pluginManager: PluginManager) {\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup']),\n        defaultValue: 'pileup',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer:\n          pluginManager.getRendererType('PileupRenderer').configSchema,\n      }),\n      /**\n       * #slot\n       */\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n\n      /**\n       * #slot\n       */\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearPileupDisplayConfigModel = ReturnType<typeof configSchemaF>\nexport type LinearPileupDisplayConfig = Instance<LinearPileupDisplayConfigModel>\nexport default configSchemaF\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Typography } from '@mui/material'\n\nexport interface LinearPileupDisplayBlurbProps {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n    }\n  }\n}\n\nfunction LinearPileupDisplayBlurb(props: LinearPileupDisplayBlurbProps) {\n  const { model } = props\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div\n      data-testid={`blurb-${model.sortedBy}`}\n      style={{ backgroundColor: 'white' }}\n    >\n      <Typography color=\"secondary\" variant=\"caption\">\n        {model.sortedBy\n          ? `Sorted by ${sortedBy.type.toLowerCase()} at ${sortedBy.refName}:${\n              sortedBy.pos\n            }`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n}\nexport default observer(LinearPileupDisplayBlurb)\n","import { lazy } from 'react'\nimport { autorun, observable } from 'mobx'\nimport { cast, types, addDisposer, Instance } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport {\n  AnyConfigurationModel,\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getEnv,\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n  SimpleFeature,\n  Feature,\n} from '@jbrowse/core/util'\n\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\nimport SortIcon from '@mui/icons-material/Sort'\nimport PaletteIcon from '@mui/icons-material/Palette'\nimport FilterListIcon from '@mui/icons-material/ClearAll'\n\n// locals\nimport { LinearPileupDisplayConfigModel } from './configSchema'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\nimport { getUniqueTagValues, getUniqueModificationValues } from '../shared'\nimport { SimpleFeatureSerialized } from '@jbrowse/core/util/simpleFeature'\n\n// async\nconst ColorByTagDlg = lazy(() => import('./components/ColorByTag'))\nconst FilterByTagDlg = lazy(() => import('./components/FilterByTag'))\nconst SortByTagDlg = lazy(() => import('./components/SortByTag'))\nconst SetFeatureHeightDlg = lazy(() => import('./components/SetFeatureHeight'))\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\nconst ModificationsDlg = lazy(() => import('./components/ColorByModifications'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearPileupDisplay\n * extends `BaseLinearDisplay`\n */\nfunction stateModelFactory(configSchema: LinearPileupDisplayConfigModel) {\n  return types\n    .compose(\n      'LinearPileupDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearPileupDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        showSoftClipping: false,\n        /**\n         * #property\n         */\n        featureHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        noSpacing: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        fadeLikelihood: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        mismatchAlpha: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            tag: types.maybe(types.string),\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n\n        /**\n         * #property\n         */\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n\n        /**\n         * #property\n         */\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1540),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      colorTagMap: observable.map<string, string>({}),\n      modificationTagMap: observable.map<string, string>({}),\n      featureUnderMouseVolatile: undefined as undefined | Feature,\n      currSortBpPerPx: 0,\n      ready: false,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setReady(flag: boolean) {\n        self.ready = flag\n      },\n      /**\n       * #action\n       */\n      setCurrSortBpPerPx(n: number) {\n        self.currSortBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      setMaxHeight(n: number) {\n        self.trackMaxHeight = n\n      },\n      /**\n       * #action\n       */\n      setFeatureHeight(n: number) {\n        self.featureHeight = n\n      },\n      /**\n       * #action\n       */\n      setNoSpacing(flag: boolean) {\n        self.noSpacing = flag\n      },\n\n      /**\n       * #action\n       */\n      setColorScheme(colorScheme: { type: string; tag?: string }) {\n        self.colorTagMap = observable.map({}) // clear existing mapping\n        self.colorBy = cast(colorScheme)\n        self.ready = false\n      },\n\n      /**\n       * #action\n       */\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const totalKeys = [...self.modificationTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme\n        // https://cran.r-project.org/web/packages/khroma/vignettes/tol.html\n        // e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        uniqueTag.forEach(value => {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.colorTagMap.set(value, newColor)\n          }\n        })\n      },\n      /**\n       * #action\n       */\n      setFeatureUnderMouse(feat?: Feature) {\n        self.featureUnderMouseVolatile = feat\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { rpcManager } = getSession(self)\n                const view = getContainingView(self) as LGV\n                const {\n                  sortedBy,\n                  colorBy,\n                  parentTrack,\n                  adapterConfig,\n                  rendererType,\n                } = self\n\n                if (\n                  !view.initialized ||\n                  !self.estimatedStatsReady ||\n                  self.regionTooLarge\n                ) {\n                  return\n                }\n\n                const { staticBlocks, bpPerPx } = view\n                // continually generate the vc pairing, set and rerender if any\n                // new values seen\n                if (colorBy?.tag) {\n                  self.updateColorTagMap(\n                    await getUniqueTagValues(self, colorBy, staticBlocks),\n                  )\n                }\n\n                if (colorBy?.type === 'modifications') {\n                  const adapter = getConf(parentTrack, ['adapter'])\n                  self.updateModificationColorMap(\n                    await getUniqueModificationValues(\n                      self,\n                      adapter,\n                      colorBy,\n                      staticBlocks,\n                    ),\n                  )\n                }\n\n                if (sortedBy) {\n                  const { pos, refName, assemblyName } = sortedBy\n                  // render just the sorted region first\n                  // @ts-ignore\n                  await self.rendererType.renderInClient(rpcManager, {\n                    assemblyName,\n                    regions: [\n                      {\n                        start: pos,\n                        end: pos + 1,\n                        refName,\n                        assemblyName,\n                      },\n                    ],\n                    adapterConfig: adapterConfig,\n                    rendererType: rendererType.name,\n                    sessionId: getRpcSessionId(self),\n                    layoutId: view.id,\n                    timeout: 1000000,\n                    ...self.renderProps(),\n                  })\n                  self.setReady(true)\n                  self.setCurrSortBpPerPx(bpPerPx)\n                } else {\n                  self.setReady(true)\n                }\n              } catch (e) {\n                console.error(e)\n                self.setError(e)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n\n        // autorun synchronizes featureUnderMouse with featureIdUnderMouse\n        // asynchronously. this is needed due to how we do not serialize all\n        // features from the BAM/CRAM over the rpc\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            try {\n              const featureId = self.featureIdUnderMouse\n              if (self.featureUnderMouse?.id() !== featureId) {\n                if (!featureId) {\n                  self.setFeatureUnderMouse(undefined)\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const view = getContainingView(self)\n                  const { feature } = (await session.rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId,\n                      sessionId,\n                      layoutId: view.id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: unknown }\n\n                  // check featureIdUnderMouse is still the same as the\n                  // feature.id that was returned e.g. that the user hasn't\n                  // moused over to a new position during the async operation\n                  // above\n                  // @ts-ignore\n                  if (self.featureIdUnderMouse === feature.uniqueId) {\n                    // @ts-ignore\n                    self.setFeatureUnderMouse(new SimpleFeature(feature))\n                  }\n                }\n              }\n            } catch (e) {\n              console.error(e)\n              session.notify(`${e}`, 'error')\n            }\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON(), view: getContainingView(self) },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      /**\n       * #action\n       */\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n\n      /**\n       * #action\n       * uses copy-to-clipboard and generates notification\n       */\n      copyFeatureToClipboard(feature: Feature) {\n        const { uniqueId, ...rest } = feature.toJSON()\n        const session = getSession(self)\n        copy(JSON.stringify(rest, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      /**\n       * #action\n       */\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n\n      /**\n       * #action\n       */\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n\n      /**\n       * #action\n       */\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n\n      /**\n       * #action\n       */\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n\n        if (centerBp < 0 || !refName) {\n          return\n        }\n\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName,\n          assemblyName,\n          tag,\n        }\n        self.ready = false\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        /**\n         * #action\n         */\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        const conf = getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : conf.maxHeight\n      },\n\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            height: self.featureHeight,\n            noSpacing: self.noSpacing,\n            maxHeight: this.maxHeight,\n            mismatchAlpha: self.mismatchAlpha,\n          },\n          getEnv(self),\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get featureHeightSetting() {\n        return (\n          self.featureHeight || readConfObject(this.rendererConfig, 'height')\n        )\n      },\n      /**\n       * #getter\n       */\n      get mismatchAlphaSetting() {\n        return self.mismatchAlpha !== undefined\n          ? self.mismatchAlpha\n          : readConfObject(this.rendererConfig, 'mismatchAlpha')\n      },\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        /**\n         * #method\n         */\n        contextMenuItems() {\n          const feat = self.contextMenuFeature\n          const contextMenuItems = feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n          return contextMenuItems\n        },\n\n        /**\n         * #getter\n         */\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n        /**\n         * #method\n         */\n        renderProps() {\n          const view = getContainingView(self) as LGV\n          const {\n            colorTagMap,\n            modificationTagMap,\n            sortedBy,\n            colorBy,\n            filterBy,\n            rpcDriverName,\n            currSortBpPerPx,\n            ready,\n          } = self\n\n          const superProps = superRenderProps()\n\n          return {\n            ...superProps,\n            notReady:\n              superProps.notReady ||\n              !ready ||\n              (sortedBy && currSortBpPerPx !== view.bpPerPx),\n            rpcDriverName,\n            displayModel: self,\n            sortedBy,\n            colorBy,\n            filterBy: JSON.parse(JSON.stringify(filterBy)),\n            colorTagMap: Object.fromEntries(colorTagMap.toJSON()),\n            modificationTagMap: Object.fromEntries(modificationTagMap.toJSON()),\n            showSoftClip: self.showSoftClipping,\n            config: self.rendererConfig,\n            async onFeatureClick(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: unknown }\n\n                  if (feature) {\n                    // @ts-ignore\n                    self.selectFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n\n            onClick() {\n              self.clearFeatureSelection()\n            },\n            // similar to click but opens a menu with further options\n            async onFeatureContextMenu(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: SimpleFeatureSerialized }\n\n                  if (feature) {\n                    self.setContextMenuFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => ({\n                    label: option,\n                    onClick: () => self.setSortedBy(option),\n                  }),\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SortByTagDlg,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => self.clearSelected(),\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => self.setColorScheme({ type: 'normal' }),\n                },\n                {\n                  label: 'Mapping quality',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'mappingQuality' }),\n                },\n                {\n                  label: 'Strand',\n                  onClick: () => self.setColorScheme({ type: 'strand' }),\n                },\n                {\n                  label: 'Pair orientation',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'pairOrientation' }),\n                },\n                {\n                  label: 'Per-base quality',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'perBaseQuality' }),\n                },\n                {\n                  label: 'Per-base lettering',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'perBaseLettering' }),\n                },\n                {\n                  label: 'Modifications or methylation',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      ModificationsDlg,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => self.setColorScheme({ type: 'insertSize' }),\n                },\n                {\n                  label: 'Stranded paired-end',\n                  onClick: () =>\n                    self.setColorScheme({ type: 'reverseTemplate' }),\n                },\n                {\n                  label: 'Color by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      ColorByTagDlg,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  FilterByTagDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set feature height',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetFeatureHeightDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetMaxHeightDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => self.toggleMismatchAlpha(),\n            },\n          ]\n        },\n      }\n    })\n}\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\n\nexport default stateModelFactory\n","import configSchemaFactory from './configSchema'\nimport modelFactory from './model'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearPileupDisplay',\n      configSchema,\n      stateModel: modelFactory(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n\nexport {\n  modelFactory as linearPileupDisplayStateModelFactory,\n  configSchemaFactory as linearPileupDisplayConfigSchemaFactory,\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config AlignmentsTrack\n * has very little config; most config and state logic is on the display\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'AlignmentsTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\nexport default function register(pm: PluginManager) {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaFactory(pm)\n    const track = new TrackType({\n      name: 'AlignmentsTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'AlignmentsTrack', configSchema),\n    })\n    const linearAlignmentsDisplay = pm.getDisplayType('LinearAlignmentsDisplay')\n    // Add LinearAlignmentsDisplay here so that it has priority over the other\n    // linear displays (defaults to order the displays are added, but we have\n    // to add the Pileup and SNPCoverage displays first).\n    track.addDisplayType(linearAlignmentsDisplay)\n    return track\n  })\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nconst configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('AlignmentsFeatureWidget', {\n      type: types.literal('AlignmentsFeatureWidget'),\n    }),\n  )\n}\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'AlignmentsFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./AlignmentsFeatureDetail')),\n      }),\n  )\n}\n\nexport { configSchema }\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { renameRegionsIfNeeded, Region } from '@jbrowse/core/util'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { toArray } from 'rxjs/operators'\n\n// locals\nimport { getTagAlt } from '../util'\nimport { getModificationTypes } from '../BamAdapter/MismatchParser'\n\nexport class PileupGetGlobalValueForTag extends RpcMethodType {\n  name = 'PileupGetGlobalValueForTag'\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deArgs = await this.deserializeArguments(args, rpcDriverClassName)\n    const { adapterConfig, sessionId, regions, tag } = deArgs\n    const dataAdapter = (await getAdapter(pm, sessionId, adapterConfig))\n      .dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const tags = feature.get('tags')\n      const val = tags ? tags[tag] : feature.get(tag)\n      if (val !== undefined) {\n        uniqueValues.add(`${val}`)\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n\nexport class PileupGetVisibleModifications extends RpcMethodType {\n  name = 'PileupGetVisibleModifications'\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deArgs = await this.deserializeArguments(args, rpcDriverClassName)\n    const { adapterConfig, sessionId, regions } = deArgs\n    const dataAdapter = (await getAdapter(pm, sessionId, adapterConfig))\n      .dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const val = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n      if (val !== undefined) {\n        getModificationTypes(val).forEach(t => uniqueValues.add(t))\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n","import { FileLocation } from '@jbrowse/core/util/types'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport * as MismatchParser from './BamAdapter/MismatchParser'\nimport { LinearPileupDisplayModel } from './LinearPileupDisplay/model'\n\nimport BamAdapterF from './CramAdapter'\nimport CramAdapterF from './BamAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRendererF from './SNPCoverageRenderer'\nimport PileupRendererF from './PileupRenderer'\nimport LinearAlignmentsDisplayF from './LinearAlignmentsDisplay'\nimport LinearSNPCoverageDisplayF from './LinearSNPCoverageDisplay'\nimport LinearPileupDisplayF, {\n  linearPileupDisplayStateModelFactory,\n  linearPileupDisplayConfigSchemaFactory,\n} from './LinearPileupDisplay'\nimport AlignmentsTrackF from './AlignmentsTrack'\nimport AlignmentsFeatureWidgetF from './AlignmentsFeatureDetail'\n\nimport {\n  PileupGetGlobalValueForTag,\n  PileupGetVisibleModifications,\n} from './PileupRPC/rpcMethods'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    ;[\n      CramAdapterF,\n      BamAdapterF,\n      LinearPileupDisplayF,\n      LinearSNPCoverageDisplayF,\n      AlignmentsTrackF,\n      SNPCoverageAdapterF,\n      HtsgetBamAdapterF,\n      PileupRendererF,\n      SNPCoverageRendererF,\n      LinearAlignmentsDisplayF,\n      AlignmentsFeatureWidgetF,\n    ].map(f => f(pluginManager))\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.cram$/i\n          const adapterName = 'CramAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            cramLocation: file,\n            craiLocation: index || makeIndex(file, '.crai'),\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bam$/i\n          const adapterName = 'BamAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n\n          const obj = {\n            type: adapterName,\n            bamLocation: file,\n            index: {\n              location: index || makeIndex(file, '.bai'),\n              indexType: makeIndexType(indexName, 'CSI', 'BAI'),\n            },\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BamAdapter' || adapterName === 'CramAdapter') {\n            return 'AlignmentsTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addRpcMethod(\n      () => new PileupGetGlobalValueForTag(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new PileupGetVisibleModifications(pluginManager),\n    )\n  }\n}\n\nexport {\n  linearPileupDisplayConfigSchemaFactory,\n  linearPileupDisplayStateModelFactory,\n  MismatchParser,\n}\nexport type { LinearPileupDisplayModel }\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { toArray } from 'rxjs/operators'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AugmentedRegion } from '@jbrowse/core/util'\n// get tag from BAM or CRAM feature, where CRAM uses feature.get('tags') and\n// BAM does not\nexport function getTag(feature: Feature, tag: string) {\n  const tags = feature.get('tags')\n  return tags ? tags[tag] : feature.get(tag)\n}\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  return getTag(feature, tag) || getTag(feature, alt)\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as { [key: string]: string },\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as { [key: string]: string },\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as { [key: string]: string },\n}\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n\nexport async function fetchSequence(\n  region: AugmentedRegion,\n  adapter: BaseFeatureDataAdapter,\n) {\n  const { end, originalRefName, refName } = region\n\n  const feats = await adapter\n    .getFeatures({\n      ...region,\n      refName: originalRefName || refName,\n      end: end + 1,\n    })\n    .pipe(toArray())\n    .toPromise()\n  return feats[0]?.get('seq')\n}\n\n// has to check underlying C-G (aka CpG) on the reference sequence\nexport function shouldFetchReferenceSequence(type?: string) {\n  return type === 'methylation'\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n  pluginManager: PluginManager,\n) {\n  const LGVPlugin = pluginManager.getPlugin(\n    'LinearGenomeViewPlugin',\n  ) as import('@jbrowse/plugin-linear-genome-view').default\n  // @ts-ignore\n  const { BaseLinearDisplay } = LGVPlugin.exports\n  return types\n    .compose(\n      'LinearArcDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearArcDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'staticBlocks'\n        },\n        get renderDelay() {\n          return 500\n        },\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import React from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { bpSpanPx, measureText } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { Tooltip } from 'react-svg-tooltip'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction ArcRendering(props: any) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const onClick = (event: any, id: any) => {\n    const { onFeatureClick: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, id)\n  }\n\n  const {\n    features,\n    config,\n    regions,\n    blockKey,\n    bpPerPx,\n    displayModel: { selectedFeatureId },\n  } = props\n  const [region] = regions\n  const arcsRendered = []\n\n  for (const feature of features.values()) {\n    const [left, right] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n\n    const featureId = feature.id()\n    const id = blockKey + '-' + featureId\n    let stroke = readConfObject(config, 'color', { feature })\n    let textStroke = 'black'\n    if (\n      selectedFeatureId &&\n      String(selectedFeatureId) === String(feature.id())\n    ) {\n      stroke = textStroke = 'red'\n    }\n    const label = readConfObject(config, 'label', { feature })\n    const caption = readConfObject(config, 'caption', { feature })\n    const strokeWidth = readConfObject(config, 'thickness', { feature }) || 1\n    const height = readConfObject(config, 'height', { feature }) || 100\n    const ref = React.createRef<SVGPathElement>()\n    const tooltipWidth = 20 + measureText(caption?.toString())\n\n    const t = 0.5\n    // formula: https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B%C3%A9zier_curves\n    const textYCoord =\n      (1 - t) * (1 - t) * (1 - t) * 0 +\n      3 * ((1 - t) * (1 - t)) * (t * height) +\n      3 * (1 - t) * (t * t) * height +\n      t * t * t * 0\n\n    arcsRendered.push(\n      <g key={id} onClick={e => onClick(e, featureId)}>\n        <path\n          id={id}\n          d={`M ${left} 0 C ${left} ${height}, ${right} ${height}, ${right} 0`}\n          stroke={stroke}\n          strokeWidth={strokeWidth}\n          fill=\"transparent\"\n          onClick={e => onClick(e, featureId)}\n          ref={ref}\n          pointerEvents=\"stroke\"\n        />\n        <Tooltip triggerRef={ref}>\n          <rect\n            x={12}\n            y={0}\n            width={tooltipWidth}\n            height={20}\n            rx={5}\n            ry={5}\n            fill=\"black\"\n            fillOpacity=\"50%\"\n          />\n          <text\n            x={22}\n            y={14}\n            fontSize={10}\n            fill=\"white\"\n            textLength={tooltipWidth - 20}\n          >\n            {caption}\n          </text>\n        </Tooltip>\n        <text\n          x={left + (right - left) / 2}\n          y={textYCoord + 3}\n          style={{ stroke: 'white', strokeWidth: '0.6em' }}\n        >\n          {label}\n        </text>\n        <text\n          x={left + (right - left) / 2}\n          y={textYCoord + 3}\n          style={{ stroke: textStroke }}\n        >\n          {label}\n        </text>\n      </g>,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = 500\n\n  return (\n    <svg\n      className=\"ArcRendering\"\n      width={width}\n      height={height}\n      style={{\n        outline: 'none',\n        position: 'relative',\n      }}\n    >\n      {arcsRendered}\n    </svg>\n  )\n}\n\nexport default observer(ArcRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ArcRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ArcRenderer = ConfigurationSchema(\n  'ArcRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of the arcs',\n      defaultValue: 'darkblue',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    thickness: {\n      type: 'number',\n      description: 'the thickness of the arcs',\n      defaultValue: `jexl:logThickness(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    label: {\n      type: 'string',\n      description: 'the label to appear at the apex of the arcs',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'the height of the arcs',\n      defaultValue: `jexl:log10(get(feature,'end')-get(feature,'start'))*50`,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    caption: {\n      type: 'string',\n      description:\n        'the caption to appear when hovering over any point on the arcs',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default ArcRenderer\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n\nexport default class extends FeatureRendererType {}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  configSchemaFactory as linearArcDisplayConfigSchemaFactory,\n  stateModelFactory as LinearArcDisplayStateModelFactory,\n} from './LinearArcDisplay'\nimport ArcRenderer, {\n  configSchema as ArcRendererConfigSchema,\n  ReactComponent as ArcRendererReactComponent,\n} from './ArcRenderer'\n\nexport default class MyProjectPlugin extends Plugin {\n  name = 'ArcRenderer'\n  install(pluginManager: PluginManager) {\n    const LGVPlugin = pluginManager.getPlugin(\n      'LinearGenomeViewPlugin',\n    ) as import('@jbrowse/plugin-linear-genome-view').default\n    // @ts-ignore\n    const { BaseLinearDisplayComponent } = LGVPlugin.exports\n\n    pluginManager.addRendererType(\n      () =>\n        // @ts-ignore error \"expected 0 arguments, but got 1\"?\n        new ArcRenderer({\n          name: 'ArcRenderer',\n          ReactComponent: ArcRendererReactComponent,\n          configSchema: ArcRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearArcDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearArcDisplay',\n        configSchema,\n        stateModel: LinearArcDisplayStateModelFactory(\n          configSchema,\n          pluginManager,\n        ),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.jexl.addFunction(\n      'logThickness',\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (feature: any, attributeName: string) => {\n        return Math.log(feature.get(attributeName) + 1)\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config LinearArcDisplay\n */\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  const LGVPlugin = pluginManager.getPlugin(\n    'LinearGenomeViewPlugin',\n  ) as import('@jbrowse/plugin-linear-genome-view').default\n  const { baseLinearDisplayConfigSchema } = LGVPlugin.exports\n  return ConfigurationSchema(\n    'LinearArcDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'ArcRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config OAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst OAuthConfigSchema = ConfigurationSchema(\n  'OAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Bearer',\n    },\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    clientId: {\n      description: 'id for the OAuth application',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    state: {\n      description: 'optional state for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'code',\n    },\n    /**\n     * #slot\n     */\n    hasRefreshToken: {\n      description: 'true if the endpoint can supply a refresh token',\n      type: 'boolean',\n      defaultValue: false,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type OAuthInternetAccountConfigModel = typeof OAuthConfigSchema\nexport type OAuthInternetAccountConfig =\n  Instance<OAuthInternetAccountConfigModel>\nexport default OAuthConfigSchema\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { isElectron, UriLocation } from '@jbrowse/core/util'\nimport { Instance, types } from 'mobx-state-tree'\nimport jwtDecode, { JwtPayload } from 'jwt-decode'\n\n// locals\nimport { OAuthInternetAccountConfigModel } from './configSchema'\n\ninterface OAuthData {\n  client_id: string\n  redirect_uri: string\n  response_type: 'token' | 'code'\n  scope?: string\n  code_challenge?: string\n  code_challenge_method?: string\n  token_access_type?: string\n  state?: string\n}\n\nfunction fixup(buf: string) {\n  return buf.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '')\n}\n\nfunction getGlobalObject(): Window {\n  // Based on window-or-global\n  // https://github.com/purposeindustries/window-or-global/blob/322abc71de0010c9e5d9d0729df40959e1ef8775/lib/index.js\n  return (\n    // eslint-disable-next-line no-restricted-globals\n    (typeof self === 'object' && self.self === self && self) ||\n    (typeof global === 'object' && global.global === global && global) ||\n    // @ts-ignore\n    this\n  )\n}\n\nconst stateModelFactory = (configSchema: OAuthInternetAccountConfigModel) => {\n  return InternetAccount.named('OAuthInternetAccount')\n    .props({\n      type: types.literal('OAuthInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => {\n      let codeVerifier: string | undefined = undefined\n      return {\n        get codeVerifierPKCE() {\n          if (codeVerifier) {\n            return codeVerifier\n          }\n          const global = getGlobalObject()\n          const array = new Uint8Array(32)\n          global.crypto.getRandomValues(array)\n          codeVerifier = fixup(Buffer.from(array).toString('base64'))\n          return codeVerifier\n        },\n      }\n    })\n    .views(self => ({\n      get authEndpoint(): string {\n        return getConf(self, 'authEndpoint')\n      },\n      get tokenEndpoint(): string {\n        return getConf(self, 'tokenEndpoint')\n      },\n      get needsPKCE(): boolean {\n        return getConf(self, 'needsPKCE')\n      },\n      get clientId(): string {\n        return getConf(self, 'clientId')\n      },\n      get scopes(): string {\n        return getConf(self, 'scopes')\n      },\n      /**\n       * OAuth state parameter: https://www.rfc-editor.org/rfc/rfc6749#section-4.1.1\n       * Can override or extend if dynamic state is needed.\n       */\n      state(): string | undefined {\n        return getConf(self, 'state') || undefined\n      },\n      get responseType(): 'token' | 'code' {\n        return getConf(self, 'responseType')\n      },\n      get hasRefreshToken(): boolean {\n        return getConf(self, 'hasRefreshToken')\n      },\n      get refreshTokenKey() {\n        return `${self.internetAccountId}-refreshToken`\n      },\n    }))\n    .actions(self => ({\n      storeRefreshToken(refreshToken: string) {\n        localStorage.setItem(self.refreshTokenKey, refreshToken)\n      },\n      removeRefreshToken() {\n        localStorage.removeItem(self.refreshTokenKey)\n      },\n      retrieveRefreshToken() {\n        return localStorage.getItem(self.refreshTokenKey)\n      },\n      async exchangeAuthorizationForAccessToken(\n        token: string,\n        redirectUri: string,\n      ): Promise<string> {\n        const data = {\n          code: token,\n          grant_type: 'authorization_code',\n          client_id: self.clientId,\n          code_verifier: self.codeVerifierPKCE,\n          redirect_uri: redirectUri,\n        }\n\n        const params = new URLSearchParams(Object.entries(data))\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Failed to obtain token from endpoint: ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n\n        const accessToken = await response.json()\n        if (accessToken.refresh_token) {\n          this.storeRefreshToken(accessToken.refresh_token)\n        }\n        return accessToken.access_token\n      },\n      async exchangeRefreshForAccessToken(\n        refreshToken: string,\n      ): Promise<string> {\n        const data = {\n          grant_type: 'refresh_token',\n          refresh_token: refreshToken,\n          client_id: self.clientId,\n        }\n\n        const params = new URLSearchParams(Object.entries(data))\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          self.removeToken()\n          let text = await response.text()\n          try {\n            const obj = JSON.parse(text)\n            if (obj.error === 'invalid_grant') {\n              this.removeRefreshToken()\n            }\n            text = obj?.error_description ?? text\n          } catch (e) {\n            /* just use original text as error */\n          }\n\n          throw new Error(\n            `Network response failure  ${response.status} (${\n              response.statusText\n            }) ${text ? ` (${text})` : ''}`,\n          )\n        }\n\n        const accessToken = await response.json()\n        if (accessToken.refresh_token) {\n          this.storeRefreshToken(accessToken.refresh_token)\n        }\n        return accessToken.access_token\n      },\n    }))\n    .actions(self => {\n      let listener: (event: MessageEvent) => void\n      let refreshTokenPromise: Promise<string> | undefined = undefined\n      return {\n        // used to listen to child window for auth code/token\n        addMessageChannel(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          listener = event => {\n            this.finishOAuthWindow(event, resolve, reject)\n          }\n          window.addEventListener('message', listener)\n        },\n        deleteMessageChannel() {\n          window.removeEventListener('message', listener)\n        },\n        async finishOAuthWindow(\n          event: MessageEvent,\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          if (\n            event.data.name !== `JBrowseAuthWindow-${self.internetAccountId}`\n          ) {\n            return this.deleteMessageChannel()\n          }\n          const redirectUriWithInfo = event.data.redirectUri\n          const fixedQueryString = redirectUriWithInfo.replace('#', '?')\n          const redirectUrl = new URL(fixedQueryString)\n          const queryStringSearch = redirectUrl.search\n          const urlParams = new URLSearchParams(queryStringSearch)\n          if (urlParams.has('access_token')) {\n            const token = urlParams.get('access_token')\n            if (!token) {\n              return reject(new Error('Error with token endpoint'))\n            }\n            self.storeToken(token)\n            return resolve(token)\n          }\n          if (urlParams.has('code')) {\n            const code = urlParams.get('code')\n            if (!code) {\n              return reject(new Error('Error with authorization endpoint'))\n            }\n            try {\n              const token = await self.exchangeAuthorizationForAccessToken(\n                code,\n                redirectUrl.origin + redirectUrl.pathname,\n              )\n              self.storeToken(token)\n              return resolve(token)\n            } catch (error) {\n              if (error instanceof Error) {\n                return reject(error)\n              } else {\n                return reject(new Error(String(error)))\n              }\n            }\n          }\n          if (redirectUriWithInfo.includes('access_denied')) {\n            return reject(new Error('OAuth flow was cancelled'))\n          }\n          if (redirectUriWithInfo.includes('error')) {\n            return reject(new Error('Oauth flow error: ' + queryStringSearch))\n          }\n          this.deleteMessageChannel()\n        },\n        // opens external OAuth flow, popup for web and new browser window for desktop\n        async useEndpointForAuthorization(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const redirectUri = isElectron\n            ? 'http://localhost/auth'\n            : window.location.origin + window.location.pathname\n          const data: OAuthData = {\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            response_type: self.responseType || 'code',\n          }\n\n          if (self.state()) {\n            data.state = self.state()\n          }\n\n          if (self.scopes) {\n            data.scope = self.scopes\n          }\n\n          if (self.needsPKCE) {\n            const { codeVerifierPKCE } = self\n\n            const sha256 = await import('crypto-js/sha256').then(f => f.default)\n            const Base64 = await import('crypto-js/enc-base64')\n            const codeChallenge = fixup(\n              Base64.stringify(sha256(codeVerifierPKCE)),\n            )\n            data.code_challenge = codeChallenge\n            data.code_challenge_method = 'S256'\n          }\n\n          if (self.hasRefreshToken) {\n            data.token_access_type = 'offline'\n          }\n\n          const params = new URLSearchParams(Object.entries(data))\n\n          const url = new URL(self.authEndpoint)\n          url.search = params.toString()\n\n          const eventName = `JBrowseAuthWindow-${self.internetAccountId}`\n          if (isElectron) {\n            const { ipcRenderer } = window.require('electron')\n            const redirectUri = await ipcRenderer.invoke('openAuthWindow', {\n              internetAccountId: self.internetAccountId,\n              data,\n              url: url.toString(),\n            })\n\n            const eventFromDesktop = new MessageEvent('message', {\n              data: { name: eventName, redirectUri: redirectUri },\n            })\n            this.finishOAuthWindow(eventFromDesktop, resolve, reject)\n          } else {\n            const options = `width=500,height=600,left=0,top=0`\n            window.open(url, eventName, options)\n          }\n        },\n        async getTokenFromUser(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ): Promise<void> {\n          const refreshToken =\n            self.hasRefreshToken && self.retrieveRefreshToken()\n          if (refreshToken) {\n            resolve(await self.exchangeRefreshForAccessToken(refreshToken))\n          }\n          this.addMessageChannel(resolve, reject)\n          this.useEndpointForAuthorization(resolve, reject)\n        },\n        async validateToken(\n          token: string,\n          location: UriLocation,\n        ): Promise<string> {\n          const decoded = jwtDecode<JwtPayload>(token)\n          if (decoded.exp && decoded.exp < new Date().getTime() / 1000) {\n            const refreshToken =\n              self.hasRefreshToken && self.retrieveRefreshToken()\n            if (refreshToken) {\n              try {\n                if (!refreshTokenPromise) {\n                  refreshTokenPromise =\n                    self.exchangeRefreshForAccessToken(refreshToken)\n                }\n                const newToken = await refreshTokenPromise\n                return this.validateToken(newToken, location)\n              } catch (err) {\n                throw new Error(`Token could not be refreshed. ${err}`)\n              }\n            }\n          } else {\n            refreshTokenPromise = undefined\n          }\n          return token\n        },\n      }\n    })\n}\n\nexport default stateModelFactory\nexport type OAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type OAuthModel = Instance<OAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config ExternalTokenInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ExternalTokenConfigSchema = ConfigurationSchema(\n  'ExternalTokenInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type ExternalTokenInternetAccountConfigModel =\n  typeof ExternalTokenConfigSchema\n\nexport type ExternalTokenInternetAccountConfig =\n  Instance<ExternalTokenInternetAccountConfigModel>\nexport default ExternalTokenConfigSchema\n","import React, { useState } from 'react'\nimport Button from '@mui/material/Button'\nimport Dialog from '@mui/material/Dialog'\nimport DialogContent from '@mui/material/DialogContent'\nimport DialogTitle from '@mui/material/DialogTitle'\nimport DialogActions from '@mui/material/DialogActions'\nimport TextField from '@mui/material/TextField'\n\nexport const ExternalTokenEntryForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (token?: string) => void\n}) => {\n  const [token, setToken] = useState('')\n\n  return (\n    <>\n      <Dialog open maxWidth=\"xl\" data-testid=\"externalToken-form\">\n        <DialogTitle>Enter Token for {internetAccountId}</DialogTitle>\n        <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n          <TextField\n            required\n            label=\"Enter Token\"\n            variant=\"outlined\"\n            inputProps={{ 'data-testid': 'entry-externalToken' }}\n            onChange={event => {\n              setToken(event.target.value)\n            }}\n            margin=\"dense\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            disabled={!token}\n            onClick={() => {\n              if (token) {\n                handleClose(token)\n              }\n            }}\n          >\n            Add\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { ExternalTokenInternetAccountConfigModel } from './configSchema'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\nimport { ExternalTokenEntryForm } from './ExternalTokenEntryForm'\n\nconst stateModelFactory = (\n  configSchema: ExternalTokenInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('ExternalTokenInternetAccount')\n    .props({\n      type: types.literal('ExternalTokenInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          ExternalTokenEntryForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Token could not be validated  ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type ExternalTokenStateModel = ReturnType<typeof stateModelFactory>\nexport type ExternalTokenModel = Instance<ExternalTokenStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\n/**\n * #config HTTPBasicInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HTTPBasicConfigSchema = ConfigurationSchema(\n  'HTTPBasicInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Basic',\n    },\n    /**\n     * #slot\n     */\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type HTTPBasicInternetAccountConfigModel = typeof HTTPBasicConfigSchema\n\nexport type HTTPBasicInternetAccountConfig =\n  Instance<HTTPBasicInternetAccountConfigModel>\nexport default HTTPBasicConfigSchema\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogActions,\n  TextField,\n} from '@mui/material'\n\nexport const HTTPBasicLoginForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (arg?: string) => void\n}) => {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  function onSubmit(event: React.FormEvent<HTMLFormElement>) {\n    if (username && password) {\n      handleClose(btoa(`${username}:${password}`))\n    } else {\n      handleClose()\n    }\n    event.preventDefault()\n  }\n\n  return (\n    <>\n      <Dialog open maxWidth=\"xl\" data-testid=\"login-httpbasic\">\n        <DialogTitle>Log In for {internetAccountId}</DialogTitle>\n        <form onSubmit={onSubmit}>\n          <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n            <TextField\n              required\n              label=\"Username\"\n              variant=\"outlined\"\n              inputProps={{ 'data-testid': 'login-httpbasic-username' }}\n              onChange={event => setUsername(event.target.value)}\n              margin=\"dense\"\n            />\n            <TextField\n              required\n              label=\"Password\"\n              type=\"password\"\n              autoComplete=\"current-password\"\n              variant=\"outlined\"\n              inputProps={{ 'data-testid': 'login-httpbasic-password' }}\n              onChange={event => setPassword(event.target.value)}\n              margin=\"dense\"\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button variant=\"contained\" color=\"primary\" type=\"submit\">\n              Submit\n            </Button>\n            <Button\n              variant=\"contained\"\n              type=\"submit\"\n              onClick={() => handleClose()}\n            >\n              Cancel\n            </Button>\n          </DialogActions>\n        </form>\n      </Dialog>\n    </>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { HTTPBasicInternetAccountConfigModel } from './configSchema'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\nimport { HTTPBasicLoginForm } from './HTTPBasicLoginForm'\n\nconst stateModelFactory = (\n  configSchema: HTTPBasicInternetAccountConfigModel,\n) => {\n  return InternetAccount.named('HTTPBasicInternetAccount')\n    .props({\n      type: types.literal('HTTPBasicInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const { session } = getRoot<any>(self)\n        session.queueDialog((doneCallback: () => void) => [\n          HTTPBasicLoginForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Error validating token  ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type HTTPBasicStateModel = ReturnType<typeof stateModelFactory>\nexport type HTTPBasicModel = Instance<HTTPBasicStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\n/**\n * #config DropboxOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DropboxOAuthConfigSchema = ConfigurationSchema(\n  'DropboxOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://www.dropbox.com/oauth2/authorize',\n    },\n    /**\n     * #slot\n     */\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://api.dropbox.com/oauth2/token',\n    },\n    /**\n     * #slot\n     */\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [\n        'addtodropbox.com',\n        'db.tt',\n        'dropbox.com',\n        'dropboxapi.com',\n        'dropboxbusiness.com',\n        'dropbox.tech',\n        'getdropbox.com',\n      ],\n    },\n    /**\n     * #slot\n     */\n    hasRefreshToken: {\n      description: 'true if the endpoint can supply a refresh token',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type DropboxOAuthInternetAccountConfigModel =\n  typeof DropboxOAuthConfigSchema\n\nexport type DropboxOAuthInternetAccountConfig =\n  Instance<DropboxOAuthInternetAccountConfigModel>\nexport default DropboxOAuthConfigSchema\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { SvgIconProps, SvgIcon } from '@mui/material'\nimport { Instance, types } from 'mobx-state-tree'\nimport { DropboxOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\n\ninterface DropboxError {\n  error_summary: string\n  error: {\n    '.tag': string\n  }\n}\n\n/** Error messages from https://www.dropbox.com/developers/documentation/http/documentation#sharing-get_shared_link_file */\nconst dropboxErrorMessages: Record<string, string | undefined> = {\n  shared_link_not_found: \"The shared link wasn't found.\",\n  shared_link_access_denied:\n    'The caller is not allowed to access this shared link.',\n  unsupported_link_type:\n    'This type of link is not supported; use files/export instead.',\n  shared_link_is_directory: 'Directories cannot be retrieved by this endpoint.',\n}\n\nexport function DropboxIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z\" />\n    </SvgIcon>\n  )\n}\n\nasync function getDescriptiveErrorMessage(response: Response) {\n  let errorMessage\n  try {\n    errorMessage = await response.text()\n  } catch (error) {\n    errorMessage = ''\n  }\n  if (errorMessage) {\n    let errorMessageParsed: DropboxError | undefined\n    try {\n      errorMessageParsed = JSON.parse(errorMessage)\n    } catch (error) {\n      errorMessageParsed = undefined\n    }\n    if (errorMessageParsed) {\n      const messageTag = errorMessageParsed.error['.tag']\n      errorMessage = dropboxErrorMessages[messageTag] || messageTag\n    }\n  }\n  return `Network response failure  ${response.status} (${\n    response.statusText\n  })${errorMessage ? ` (${errorMessage})` : ''}`\n}\n\nconst stateModelFactory = (\n  configSchema: DropboxOAuthInternetAccountConfigModel,\n) => {\n  return baseModel(OAuthConfigSchema)\n    .named('DropboxOAuthInternetAccount')\n    .props({\n      type: types.literal('DropboxOAuthInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      get toggleContents() {\n        return <DropboxIcon />\n      },\n      get selectorLabel() {\n        return 'Enter Dropbox share link'\n      },\n    }))\n    .actions(self => ({\n      getFetcher(\n        location?: UriLocation,\n      ): (input: RequestInfo, init?: RequestInit) => Promise<Response> {\n        return async (\n          input: RequestInfo,\n          init?: RequestInit,\n        ): Promise<Response> => {\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'POST' },\n            authToken,\n          )\n          newInit.headers.append(\n            'Dropbox-API-Arg',\n            JSON.stringify({ url: input }),\n          )\n          const response = await fetch(\n            'https://content.dropboxapi.com/2/sharing/get_shared_link_file',\n            newInit,\n          )\n          if (!response.ok) {\n            const message = await getDescriptiveErrorMessage(response)\n            throw new Error(message)\n          }\n          return response\n        }\n      },\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const response = await fetch(\n          'https://api.dropboxapi.com/2/sharing/get_shared_link_metadata',\n          {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              url: location.uri,\n            }),\n          },\n        )\n        if (!response.ok) {\n          const refreshToken =\n            self.hasRefreshToken && self.retrieveRefreshToken()\n          if (refreshToken) {\n            self.removeRefreshToken()\n            const newToken = await self.exchangeRefreshForAccessToken(\n              refreshToken,\n            )\n            return this.validateToken(newToken, location)\n          }\n          const message = await getDescriptiveErrorMessage(response)\n          throw new Error(`Token could not be validated. ${message}`)\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type DropboxOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type DropboxOAuthModel = Instance<DropboxOAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\n/**\n * #config GoogleDriveOAuthInternetAccount\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GoogleDriveOAuthConfigSchema = ConfigurationSchema(\n  'GoogleDriveOAuthInternetAccount',\n  {\n    /**\n     * #slot\n     */\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://accounts.google.com/o/oauth2/v2/auth',\n    },\n    /**\n     * #slot\n     */\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: 'https://www.googleapis.com/auth/drive.readonly',\n    },\n    /**\n     * #slot\n     */\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: ['drive.google.com\"'],\n    },\n    /**\n     * #slot\n     */\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'token',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: OAuthConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport type GoogleDriveOAuthInternetAccountConfigModel =\n  typeof GoogleDriveOAuthConfigSchema\n\nexport type GoogleDriveOAuthInternetAccountConfig =\n  Instance<GoogleDriveOAuthInternetAccountConfigModel>\nexport default GoogleDriveOAuthConfigSchema\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { Instance, types } from 'mobx-state-tree'\nimport { RemoteFileWithRangeCache } from '@jbrowse/core/util/io'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { SvgIconProps, SvgIcon } from '@mui/material'\nimport {\n  FilehandleOptions,\n  Stats,\n  PolyfilledResponse,\n} from 'generic-filehandle'\n\n// locals\nimport { GoogleDriveOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\n\nexport interface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\ninterface GoogleDriveFilehandleOptions extends FilehandleOptions {\n  fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse>\n}\n\ninterface GoogleDriveError {\n  error: {\n    errors: {\n      domain: string\n      reason: string\n      message: string\n      locationType?: string\n      location?: string\n    }[]\n    code: number\n    message: string\n  }\n}\n\nexport class GoogleDriveFile extends RemoteFileWithRangeCache {\n  private statsPromise: Promise<{ size: number }>\n  constructor(source: string, opts: GoogleDriveFilehandleOptions) {\n    super(source, opts)\n    this.statsPromise = this.fetch(source, {\n      metadataOnly: true,\n    }).then((response: Response) => response.json())\n  }\n\n  async fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse> {\n    return super.fetch(input, opts)\n  }\n\n  async stat(): Promise<Stats> {\n    return this.statsPromise\n  }\n}\n\nfunction GoogleDriveIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z\" />\n    </SvgIcon>\n  )\n}\n\nasync function getDescriptiveErrorMessage(response: Response) {\n  let errorMessage\n  try {\n    errorMessage = await response.text()\n  } catch (error) {\n    errorMessage = ''\n  }\n  if (errorMessage) {\n    let errorMessageParsed: GoogleDriveError | undefined\n    try {\n      errorMessageParsed = JSON.parse(errorMessage)\n    } catch (error) {\n      errorMessageParsed = undefined\n    }\n    if (errorMessageParsed) {\n      errorMessage = errorMessageParsed.error.message\n    }\n  }\n  return `Network response failure  ${response.status} (${\n    response.statusText\n  })${errorMessage ? ` (${errorMessage})` : ''}`\n}\n\nconst stateModelFactory = (\n  configSchema: GoogleDriveOAuthInternetAccountConfigModel,\n) => {\n  return baseModel(OAuthConfigSchema)\n    .named('GoogleDriveOAuthInternetAccount')\n    .props({\n      type: types.literal('GoogleDriveOAuthInternetAccount'),\n      configuration: ConfigurationReference(configSchema),\n    })\n    .views(() => ({\n      get toggleContents() {\n        return <GoogleDriveIcon />\n      },\n      get selectorLabel() {\n        return 'Enter Google Drive share link'\n      },\n    }))\n    .actions(self => ({\n      getFetcher(\n        location?: UriLocation,\n      ): (input: RequestInfo, init?: RequestInit) => Promise<Response> {\n        return async (\n          input: RequestInfo,\n          init?: RequestInitWithMetadata,\n        ): Promise<Response> => {\n          const urlId = String(input).match(/[-\\w]{25,}/)\n          const driveUrl = new URL(\n            `https://www.googleapis.com/drive/v3/files/${urlId}`,\n          )\n          const searchParams = new URLSearchParams()\n          if (init?.metadataOnly) {\n            searchParams.append('fields', 'size')\n          } else {\n            searchParams.append('alt', 'media')\n          }\n          driveUrl.search = searchParams.toString()\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'GET', credentials: 'same-origin' },\n            authToken,\n          )\n          const response = await fetch(driveUrl.toString(), newInit)\n          if (!response.ok) {\n            const message = await getDescriptiveErrorMessage(response)\n            throw new Error(message)\n          }\n          return response\n        }\n      },\n      openLocation(location: UriLocation) {\n        return new GoogleDriveFile(location.uri, {\n          fetch: this.getFetcher(location),\n        })\n      },\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const urlId = location.uri.match(/[-\\w]{25,}/)\n        const response = await fetch(\n          `https://www.googleapis.com/drive/v3/files/${urlId}`,\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/x-www-form-urlencoded',\n            },\n          },\n        )\n        if (!response.ok) {\n          const message = await getDescriptiveErrorMessage(response)\n          throw new Error(`Token could not be validated. ${message}`)\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type GoogleDriveOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type GoogleDriveOAuthModel = Instance<GoogleDriveOAuthStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport InternetAccountType from '@jbrowse/core/pluggableElementTypes/InternetAccountType'\nimport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\nimport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\nimport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\nimport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\nimport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\n\nexport default class AuthenticationPlugin extends Plugin {\n  name = 'AuthenticationPlugin'\n\n  exports = {\n    OAuthConfigSchema,\n    OAuthInternetAccountModelFactory,\n    ExternalTokenConfigSchema,\n    ExternalTokenInternetAccountModelFactory,\n    HTTPBasicConfigSchema,\n    HTTPBasicInternetAccountModelFactory,\n    DropboxOAuthConfigSchema,\n    DropboxOAuthInternetAccountModelFactory,\n    GoogleDriveOAuthConfigSchema,\n    GoogleDriveOAuthInternetAccountModelFactory,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'OAuthInternetAccount',\n        configSchema: OAuthConfigSchema,\n        stateModel: OAuthInternetAccountModelFactory(OAuthConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'ExternalTokenInternetAccount',\n        configSchema: ExternalTokenConfigSchema,\n        stateModel: ExternalTokenInternetAccountModelFactory(\n          ExternalTokenConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'HTTPBasicInternetAccount',\n        configSchema: HTTPBasicConfigSchema,\n        stateModel: HTTPBasicInternetAccountModelFactory(HTTPBasicConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'DropboxOAuthInternetAccount',\n        configSchema: DropboxOAuthConfigSchema,\n        stateModel: DropboxOAuthInternetAccountModelFactory(\n          DropboxOAuthConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'GoogleDriveOAuthInternetAccount',\n        configSchema: GoogleDriveOAuthConfigSchema,\n        stateModel: GoogleDriveOAuthInternetAccountModelFactory(\n          GoogleDriveOAuthConfigSchema,\n        ),\n      })\n    })\n  }\n}\n\nexport {\n  OAuthConfigSchema,\n  OAuthInternetAccountModelFactory,\n  ExternalTokenConfigSchema,\n  ExternalTokenInternetAccountModelFactory,\n  HTTPBasicConfigSchema,\n  HTTPBasicInternetAccountModelFactory,\n  DropboxOAuthConfigSchema,\n  DropboxOAuthInternetAccountModelFactory,\n  GoogleDriveOAuthConfigSchema,\n  GoogleDriveOAuthInternetAccountModelFactory,\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigBedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigBedAdapter = ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bb', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BigBedAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config BedTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedTabixAdapter = ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bed.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BedTabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BedAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BedAdapter = ConfigurationSchema(\n  'BedAdapter',\n  {\n    /**\n     * #slot\n     */\n    bedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n    /**\n     * #slot\n     */\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n    /**\n     * #slot\n     */\n    colRef: {\n      type: 'number',\n      description: 'The column to use as a \"refName\" attribute',\n      defaultValue: 0,\n    },\n    /**\n     * #slot\n     */\n    colStart: {\n      type: 'number',\n      description: 'The column to use as a \"start\" attribute',\n      defaultValue: 1,\n    },\n    /**\n     * #slot\n     */\n    colEnd: {\n      type: 'number',\n      description: 'The column to use as a \"end\" attribute',\n      defaultValue: 2,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BedAdapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema as bigBedAdapterConfigSchema } from './BigBedAdapter'\nimport { configSchema as bedTabixAdapterConfigSchema } from './BedTabixAdapter'\nimport { configSchema as bedAdapterConfigSchema } from './BedAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigBedAdapter',\n          configSchema: bigBedAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BigBedAdapter/BigBedAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(bb|bigbed)$/i\n          const adapterName = 'BigBedAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigBedLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedTabixAdapter',\n          configSchema: bedTabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BedTabixAdapter/BedTabixAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedAdapter',\n          configSchema: bedAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BedAdapter/BedAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed\\.b?gz$/i\n          const adapterName = 'BedTabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedGzLocation: file,\n              index: {\n                location: index || makeIndex(file, '.tbi'),\n                indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n              },\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed$/i\n          const adapterName = 'BedAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data: unknown) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport { configSchema, stateModel }\n","import { useState, useEffect } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { clamp } from '@jbrowse/core/util'\nimport { LayoutRecord } from './model'\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: Instance<LinearGenomeViewStateModel>[],\n  trackConfigId: string,\n  level: number,\n) {\n  const track = views[level].trackRefs[trackConfigId]\n  return track?.getBoundingClientRect().top || 0\n}\n\nexport function getPxFromCoordinate(\n  view: Instance<LinearGenomeViewStateModel>,\n  refName: string,\n  coord: number,\n) {\n  return ((view.bpToPx({ refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackConfigId: string,\n  level: number,\n  views: Instance<LinearGenomeViewStateModel>[],\n  tracks: {\n    displays: [\n      {\n        height: number\n        scrollTop: number\n        SNPCoverageDisplay?: { height: number }\n        showCoverage?: boolean\n      },\n    ]\n  }[], // basic track requirements\n  c: LayoutRecord,\n) {\n  const display = tracks[level].displays[0]\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { showCoverage, SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay && showCoverage) {\n    offset = SNPCoverageDisplay.height\n  }\n  return (\n    clamp(c[TOP] - display.scrollTop + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackConfigId, level) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap\n// changing. the setup of this being a useEffect+useState makes it\n// re-render once the useEffect is called, which is generally the\n// \"next frame\". If we removed the below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState<unknown>()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n","import React, { useMemo, useState } from 'react'\nimport Path from 'svg-path-generator'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { getSession, Feature } from '@jbrowse/core/util'\n\n// locals\nimport { yPos, useNextFrame, getPxFromCoordinate } from '../util'\nimport { BreakpointViewModel } from '../model'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\n// this finds candidate alignment features, aimed at plotting split reads\n// from BAM/CRAM files\nfunction getBadlyPairedAlignments(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  // this finds candidate features that share the same name\n  for (const feature of features.values()) {\n    const flags = feature.get('flags')\n    const id = feature.id()\n    const unmapped = flags & 4\n    const correctlyPaired = flags & 2\n\n    if (!alreadySeen.has(id) && !correctlyPaired && !unmapped) {\n      const n = feature.get('name')\n      if (!candidates[n]) {\n        candidates[n] = []\n      }\n      candidates[n].push(feature)\n    }\n    alreadySeen.add(feature.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\n// this finds candidate alignment features, aimed at plotting split reads\n// from BAM/CRAM files\nfunction getMatchedAlignmentFeatures(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  // this finds candidate features that share the same name\n  for (const feature of features.values()) {\n    const id = feature.id()\n    const unmapped = feature.get('flags') & 4\n    if (!alreadySeen.has(id) && !unmapped) {\n      const n = feature.get('name')\n      if (!candidates[n]) {\n        candidates[n] = []\n      }\n      candidates[n].push(feature)\n    }\n    alreadySeen.add(feature.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\nfunction hasPairedReads(features: Map<string, Feature>) {\n  return [...features.values()].find(f => f.get('flags') & 64)\n}\n\nconst AlignmentConnections = observer(\n  ({\n    model,\n    trackId,\n    parentRef,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views, showIntraviewLinks } = model\n\n    const session = getSession(model)\n    const snap = getSnapshot(model)\n    const { assemblyManager } = session\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    useNextFrame(snap)\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const hasPaired = useMemo(\n      () => hasPairedReads(totalFeatures),\n      [totalFeatures],\n    )\n\n    const layoutMatches = useMemo(() => {\n      const features = hasPaired\n        ? getBadlyPairedAlignments(totalFeatures)\n        : getMatchedAlignmentFeatures(totalFeatures)\n      const layoutMatches = model.getMatchedFeaturesInLayout(trackId, features)\n      if (!hasPaired) {\n        layoutMatches.forEach(m => {\n          m.sort((a, b) => a.feature.get('clipPos') - b.feature.get('clipPos'))\n        })\n      }\n      return layoutMatches\n    }, [totalFeatures, trackId, hasPaired, model])\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n\n    let yOffset = 0\n    if (parentRef.current) {\n      const rect = parentRef.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n\n    if (!assembly) {\n      return null\n    }\n\n    return (\n      <g\n        stroke=\"#333\"\n        fill=\"none\"\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom, just in series\n          // following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n\n            if (!c1 || !c2) {\n              console.warn('received null layout for a overlay feature')\n              return null\n            }\n\n            // disable rendering connections in a single level\n            if (!showIntraviewLinks && level1 === level2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n\n            const s1 = f1.get('strand')\n            const s2 = f2.get('strand')\n            const p1 = hasPaired\n              ? c1[s1 === -1 ? LEFT : RIGHT]\n              : c1[s1 === -1 ? LEFT : RIGHT]\n            const p2 = hasPaired\n              ? c2[s2 === -1 ? LEFT : RIGHT]\n              : c2[s2 === -1 ? RIGHT : LEFT]\n            const x1 = getPxFromCoordinate(views[level1], f1ref, p1)\n            const x2 = getPxFromCoordinate(views[level2], f2ref, p2)\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackId))\n\n            const y1 = yPos(trackId, level1, views, tracks, c1) - yOffset\n            const y2 = yPos(trackId, level2, views, tracks, c2) - yOffset\n\n            // possible todo: use totalCurveHeight to possibly make alternative\n            // squiggle if the S is too small\n            const path = Path()\n              .moveTo(x1, y1)\n              .curveTo(\n                x1 + 200 * f1.get('strand') * (reversed1 ? -1 : 1),\n                y1,\n                x2 -\n                  200 *\n                    f2.get('strand') *\n                    (reversed2 ? -1 : 1) *\n                    (hasPaired ? -1 : 1),\n                y2,\n                x2,\n                y2,\n              )\n              .end()\n            const id = `${f1.id()}-${f2.id()}`\n            ret.push(\n              <path\n                d={path}\n                key={id}\n                data-testid=\"r1\"\n                strokeWidth={mouseoverElt === id ? 5 : 1}\n                onClick={() => {\n                  const featureWidget = session.addWidget?.(\n                    'BreakpointAlignmentsWidget',\n                    'breakpointAlignments',\n                    {\n                      featureData: {\n                        feature1: (\n                          totalFeatures.get(f1.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                        feature2: (\n                          totalFeatures.get(f2.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    },\n                  )\n                  session.showWidget?.(featureWidget)\n                }}\n                onMouseOver={() => setMouseoverElt(id)}\n                onMouseOut={() => setMouseoverElt(undefined)}\n              />,\n            )\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default AlignmentConnections\n","import React, { useState, useMemo } from 'react'\nimport Path from 'svg-path-generator'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { parseBreakend, Breakend } from '@gmod/vcf'\n\n// locals\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\nfunction findMatchingAlt(feat1: Feature, feat2: Feature) {\n  const alts = feat1.get('ALT') as string[] | undefined\n  if (alts) {\n    return Object.fromEntries(\n      alts\n        ?.map(alt => parseBreakend(alt))\n        .filter((f): f is Breakend => !!f)\n        .map(bnd => [bnd.MatePosition, bnd]),\n    )[`${feat2.get('refName')}:${feat2.get('start') + 1}`]\n  }\n  return undefined\n}\n\n// Returns paired BND features across multiple views by inspecting\n// the ALT field to get exact coordinate matches\nfunction getMatchedBreakendFeatures(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  for (const f of features.values()) {\n    if (!alreadySeen.has(f.id())) {\n      if (f.get('type') === 'breakend') {\n        const alts = f.get('ALT') as string[] | undefined\n        alts?.forEach(a => {\n          const cur = `${f.get('refName')}:${f.get('start') + 1}`\n          const bnd = parseBreakend(a)\n          if (bnd) {\n            if (!candidates[cur]) {\n              candidates[bnd.MatePosition || 'none'] = [f]\n            } else {\n              candidates[cur].push(f)\n            }\n          }\n        })\n      }\n    }\n    alreadySeen.add(f.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\nconst Breakends = observer(\n  ({\n    model,\n    trackId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const { assemblyManager } = session\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const layoutMatches = useMemo(\n      () =>\n        model.getMatchedFeaturesInLayout(\n          trackId,\n          getMatchedBreakendFeatures(totalFeatures),\n        ),\n      [totalFeatures, trackId, model],\n    )\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n\n    if (!assembly) {\n      return null\n    }\n\n    let yoff = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yoff = rect.top\n    }\n\n    return (\n      <g\n        stroke=\"green\"\n        strokeWidth={5}\n        fill=\"none\"\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom, just\n          // in series following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n            const id = f1.id()\n\n            const relevantAlt = findMatchingAlt(f1, f2)\n            if (!c1 || !c2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n            const x1 = getPxFromCoordinate(views[level1], f1ref, c1[LEFT])\n            const x2 = getPxFromCoordinate(views[level2], f2ref, c2[LEFT])\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackId))\n            const y1 = yPos(trackId, level1, views, tracks, c1) - yoff\n            const y2 = yPos(trackId, level2, views, tracks, c2) - yoff\n            if (!relevantAlt) {\n              console.warn(\n                'the relevant ALT allele was not found, cannot render',\n              )\n            } else {\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 *\n                      (relevantAlt.Join === 'left' ? -1 : 1) *\n                      (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (relevantAlt.MateDirection === 'left' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: totalFeatures.get(id)?.toJSON(),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Breakends\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { IconButton } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\n// icons\nimport LocationSearching from '@mui/icons-material/LocationSearching'\nimport LocationDisabled from '@mui/icons-material/LocationDisabled'\nimport LeakAdd from '@mui/icons-material/LeakAdd'\nimport LeakRemove from '@mui/icons-material/LeakRemove'\nimport LinkIcon from '@mui/icons-material/Link'\nimport LinkOffIcon from '@mui/icons-material/LinkOff'\n\nimport { BreakpointViewModel } from '../model'\n\nconst useStyles = makeStyles()(theme => ({\n  headerBar: {\n    gridArea: '1/1/auto/span 2',\n    display: 'flex',\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n}))\n\nconst InteractWithSquiggles = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    return (\n      <IconButton\n        onClick={() => model.toggleInteract()}\n        title=\"Toggle interacting with the overlay\"\n      >\n        {model.interactToggled ? <LocationSearching /> : <LocationDisabled />}\n      </IconButton>\n    )\n  },\n)\n\nconst LinkViews = observer(({ model }: { model: BreakpointViewModel }) => {\n  return (\n    <IconButton\n      onClick={() => model.toggleLinkViews()}\n      title=\"Toggle linked scrolls and behavior across views\"\n    >\n      {model.linkViews ? (\n        <LinkIcon color=\"secondary\" />\n      ) : (\n        <LinkOffIcon color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Sync = observer(({ model }: { model: BreakpointViewModel }) => {\n  return (\n    <IconButton\n      onClick={model.toggleIntraviewLinks}\n      title=\"Toggle rendering intraview links\"\n    >\n      {model.showIntraviewLinks ? (\n        <LeakAdd color=\"secondary\" />\n      ) : (\n        <LeakRemove color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Header = observer(({ model }: { model: BreakpointViewModel }) => {\n  const { classes } = useStyles()\n\n  return (\n    <div className={classes.headerBar}>\n      <LinkViews model={model} />\n      <InteractWithSquiggles model={model} />\n      <Sync model={model} />\n\n      <div className={classes.spacer} />\n    </div>\n  )\n})\n\nexport default Header\n","import React, { useState, useMemo } from 'react'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport Path from 'svg-path-generator'\n\n// locals\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel, LayoutRecord } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\n// Getting \"matched\" TRA means just return all TRA\nfunction getMatchedTranslocationFeatures(features: Map<string, Feature>) {\n  const feats: Feature[][] = []\n  const alreadySeen = new Set<string>()\n\n  for (const f of features.values()) {\n    if (!alreadySeen.has(f.id())) {\n      if (f.get('ALT')[0] === '<TRA>') {\n        feats.push([f])\n      }\n    }\n    alreadySeen.add(f.id())\n  }\n\n  return feats\n}\n\nconst Translocations = observer(\n  ({\n    model,\n    trackId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const { assemblyManager } = session\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const layoutMatches = useMemo(\n      () =>\n        model.getMatchedFeaturesInLayout(\n          trackId,\n          getMatchedTranslocationFeatures(totalFeatures),\n        ),\n\n      [totalFeatures, trackId, model],\n    )\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    if (!assembly) {\n      return null\n    }\n\n    let yOffset = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n\n    // we hardcode the TRA to go to the \"other view\" and if there is none, we\n    // just return null here note: would need to do processing of the INFO\n    // CHR2/END and see which view could contain those coordinates to really\n    // do it properly\n    if (views.length < 2) {\n      return null\n    }\n    return (\n      <g\n        fill=\"none\"\n        stroke=\"green\"\n        strokeWidth={5}\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          // we follow a path in the list of chunks, not from top to bottom,\n          // just in series following x1,y1 -> x2,y2\n          const ret = []\n          for (let i = 0; i < chunk.length; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const level2 = level1 === 0 ? 1 : 0\n            const id = f1.id()\n            if (!c1) {\n              return null\n            }\n\n            const info = f1.get('INFO')\n            const chr2 = info.CHR2[0]\n            const end2 = info.END[0]\n            const [myDirection, mateDirection] = info.STRANDS[0].split('')\n\n            const r = getPxFromCoordinate(views[level2], chr2, end2)\n            if (r) {\n              const c2: LayoutRecord = [r, 0, r + 1, 0]\n\n              const x1 = getPxFromCoordinate(\n                views[level1],\n                f1.get('refName'),\n                c1[LEFT],\n              )\n              const x2 = r\n              const reversed1 = views[level1].pxToBp(x1).reversed\n              const reversed2 = views[level2].pxToBp(x2).reversed\n\n              const tracks = views.map(v => v.getTrack(trackId))\n              const y1 = yPos(trackId, level1, views, tracks, c1) - yOffset\n              const y2 = yPos(trackId, level2, views, tracks, c2) - yOffset\n\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 * (myDirection === '+' ? 1 : -1) * (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (mateDirection === '+' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: (\n                          totalFeatures.get(id) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Translocations\n","import React, { useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { makeStyles } from 'tss-react/mui'\n\n// locals\nimport { BreakpointViewModel } from '../model'\nimport AlignmentConnections from './AlignmentConnections'\nimport Breakends from './Breakends'\nimport Header from './Header'\nimport Translocations from './Translocations'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    position: 'relative',\n    marginBottom: theme.spacing(1),\n    overflow: 'hidden',\n  },\n  breakpointMarker: {\n    position: 'absolute',\n    top: 0,\n    height: '100%',\n    width: 3,\n    background: 'magenta',\n  },\n  viewDivider: {\n    background: theme.palette.secondary.main,\n    height: 3,\n  },\n  container: {\n    display: 'grid',\n  },\n  overlay: {\n    display: 'flex',\n    width: '100%',\n    gridArea: '1/1',\n    '& path': {\n      cursor: 'crosshair',\n      fill: 'none',\n    },\n  },\n  content: {\n    gridArea: '1/1',\n  },\n}))\n\nconst Overlay = observer(\n  (props: {\n    parentRef: React.RefObject<SVGSVGElement>\n    model: BreakpointViewModel\n    trackId: string\n  }) => {\n    const { model, trackId } = props\n    const tracks = model.getMatchedTracks(trackId)\n    if (\n      tracks[0]?.type === 'PileupTrack' ||\n      tracks[0]?.type === 'AlignmentsTrack'\n    ) {\n      return <AlignmentConnections {...props} />\n    }\n    if (tracks[0]?.type === 'VariantTrack') {\n      return model.hasTranslocations(trackId) ? (\n        <Translocations {...props} />\n      ) : (\n        <Breakends {...props} />\n      )\n    }\n    return null\n  },\n)\n\nconst BreakpointSplitView = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    const { classes } = useStyles()\n    const { views } = model\n    const { pluginManager } = getEnv(model)\n    const ref = useRef(null)\n\n    return (\n      <div>\n        <Header model={model} />\n        <div className={classes.container}>\n          <div className={classes.content}>\n            <div style={{ position: 'relative' }}>\n              {views.map((view, idx) => {\n                const { ReactComponent } = pluginManager.getViewType(view.type)\n                const viewComponent = (\n                  <ReactComponent key={view.id} model={view} />\n                )\n                if (idx === views.length - 1) {\n                  return viewComponent\n                }\n                return [\n                  viewComponent,\n                  <div\n                    key={`${view.id}-divider`}\n                    className={classes.viewDivider}\n                  />,\n                ]\n              })}\n            </div>\n          </div>\n          <div className={classes.overlay}>\n            <svg\n              ref={ref}\n              style={{\n                width: '100%',\n                zIndex: 10,\n                pointerEvents: model.interactToggled ? undefined : 'none',\n              }}\n            >\n              {model.matchedTracks.map(track => {\n                // note: we must pass ref down, because the child component\n                // needs to getBoundingClientRect on the this components SVG,\n                // and we cannot rely on using getBoundingClientRect in this\n                // component to make sure this works because if it gets\n                // shifted around by another element, this will not re-render\n                // necessarily\n                return (\n                  <Overlay\n                    parentRef={ref}\n                    key={track.configuration.trackId}\n                    model={model}\n                    trackId={track.configuration.trackId}\n                  />\n                )\n              })}\n            </svg>\n          </div>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default BreakpointSplitView\n","import {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  types,\n  getParent,\n  onAction,\n  addDisposer,\n  getPath,\n  Instance,\n} from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { AnyConfigurationModel, getConf } from '@jbrowse/core/configuration'\nimport { autorun } from 'mobx'\n\n// https://stackoverflow.com/a/49186706/2129219 the array-intersection package\n// on npm has a large kb size, and we are just intersecting open track ids so\n// simple is better\nfunction intersect<T>(\n  cb: (l: T) => string,\n  a1: T[] = [],\n  a2: T[] = [],\n  ...rest: T[][]\n): T[] {\n  const ids = a2.map(elt => cb(elt))\n  const a12 = a1.filter(value => ids.includes(cb(value)))\n  return rest.length === 0 ? a12 : intersect(cb, a12, ...rest)\n}\n\nexport interface Breakend {\n  MateDirection: string\n  Join: string\n  Replacement: string\n  MatePosition: string\n}\n\nexport type LayoutRecord = [number, number, number, number]\n\nasync function getBlockFeatures(\n  model: BreakpointViewModel,\n  track: { configuration: AnyConfigurationModel },\n) {\n  const { views } = model\n  const { rpcManager, assemblyManager } = getSession(model)\n  const assemblyName = model.views[0].assemblyNames[0]\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  if (!assembly) {\n    return undefined // throw new Error(`assembly not found: \"${assemblyName}\"`)\n  }\n  const sessionId = track.configuration.trackId\n  return Promise.all(\n    views.map(async view =>\n      (\n        (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n          adapterConfig: getConf(track, ['adapter']),\n          sessionId,\n          regions: view.staticBlocks.contentBlocks,\n        })) as Feature[][]\n      ).flat(),\n    ),\n  )\n}\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const defaultHeight = 400\n  const model = types\n    .model('BreakpointSplitView', {\n      type: types.literal('BreakpointSplitView'),\n      height: types.optional(\n        types.refinement(\n          'viewHeight',\n          types.number,\n          (n: number) => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n      trackSelectorType: 'hierarchical',\n      showIntraviewLinks: true,\n      linkViews: false,\n      interactToggled: false,\n      views: types.array(\n        pluginManager.getViewType('LinearGenomeView')\n          .stateModel as LinearGenomeViewStateModel,\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n      matchedTrackFeatures: {} as { [key: string]: Feature[][] },\n    }))\n    .views(self => ({\n      // Find all track ids that match across multiple views\n      get matchedTracks() {\n        return intersect(\n          elt => elt.configuration.trackId as string,\n          ...self.views.map(view => view.tracks),\n        )\n      },\n\n      menuItems() {\n        self.views\n          .map((view, idx) => [idx, view.menuItems?.()])\n          .filter(f => !!f[1])\n          .map(f => ({ label: `View ${f[0]} Menu`, subMenu: f[1] }))\n      },\n\n      // Get tracks with a given trackId across multiple views\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      // Translocation features are handled differently\n      // since they do not have a mate e.g. they are one sided\n      hasTranslocations(trackConfigId: string) {\n        return [...this.getTrackFeatures(trackConfigId).values()].find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      // Get a composite map of featureId->feature map for a track across\n      // multiple views\n      getTrackFeatures(trackConfigId: string) {\n        return new Map(\n          self.matchedTrackFeatures[trackConfigId]\n            ?.flat()\n            .map(f => [f.id(), f]),\n        )\n      },\n\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        // use reverse to search the second track first\n        const tracks = this.getMatchedTracks(trackConfigId)\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const calc = (track: any, feat: Feature) => {\n          return track.displays[0].searchFeatureByID(feat.id())\n        }\n\n        return features.map(c =>\n          c\n            .map(feature => {\n              const level = tracks.findIndex(track => calc(track, feature))\n              if (level !== -1) {\n                const layout = calc(tracks[level], feature)\n                return {\n                  feature,\n                  layout,\n                  level,\n                }\n              }\n              return undefined\n            })\n            .filter(\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              (f): f is { feature: Feature; layout: any; level: number } => !!f,\n            ),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path?: string\n              args?: unknown[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args?.[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n      setMatchedTrackFeatures(obj: { [key: string]: Feature[][] }) {\n        self.matchedTrackFeatures = obj\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            try {\n              if (!self.views.every(view => view.initialized)) {\n                return\n              }\n              self.setMatchedTrackFeatures(\n                Object.fromEntries(\n                  await Promise.all(\n                    self.matchedTracks.map(async track => [\n                      track.configuration.trackId,\n                      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                      await getBlockFeatures(self as any, track),\n                    ]),\n                  ),\n                ),\n              )\n            } catch (e) {\n              console.error(e)\n              getSession(self).notify(`${e}`, 'error')\n            }\n          }),\n        )\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n\nexport type BreakpointView = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewStateModel = BreakpointView['stateModel']\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import { getSession, Feature } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { parseBreakend } from '@gmod/vcf'\n\n// locals\nimport BreakpointSplitViewComponent from './components/BreakpointSplitView'\nimport BreakpointSplitViewModel from './model'\n\nclass BreakpointSplitViewType extends ViewType {\n  snapshotFromBreakendFeature(feature: Feature, view: LinearGenomeViewModel) {\n    const alt = feature.get('ALT')?.[0]\n    const bnd = alt ? parseBreakend(alt) : undefined\n    const startPos = feature.get('start')\n    let endPos\n    const bpPerPx = 10\n\n    // TODO: Figure this out for multiple assembly names\n    const { assemblyName } = view.displayedRegions[0]\n    const { assemblyManager } = getSession(view)\n    const assembly = assemblyManager.get(assemblyName)\n\n    if (!assembly) {\n      throw new Error(`assembly ${assemblyName} not found`)\n    }\n    if (!assembly.regions) {\n      throw new Error(`assembly ${assemblyName} regions not loaded`)\n    }\n    const { getCanonicalRefName } = assembly as Assembly\n    const featureRefName = getCanonicalRefName(feature.get('refName'))\n    const topRegion = assembly.regions.find(f => f.refName === featureRefName)\n\n    let mateRefName: string | undefined\n    let startMod = 0\n    let endMod = 0\n\n    // a VCF breakend feature\n    if (alt === '<TRA>') {\n      const INFO = feature.get('INFO')\n      endPos = INFO.END[0] - 1\n      mateRefName = getCanonicalRefName(INFO.CHR2[0])\n    } else if (bnd?.MatePosition) {\n      const matePosition = bnd.MatePosition.split(':')\n      endPos = +matePosition[1] - 1\n      mateRefName = getCanonicalRefName(matePosition[0])\n      if (bnd.Join === 'left') {\n        startMod = -1\n      }\n      if (bnd.MateDirection === 'left') {\n        endMod = -1\n      }\n    } else if (feature.get('mate')) {\n      // a generic 'mate' feature\n      const mate = feature.get('mate')\n      mateRefName = getCanonicalRefName(mate.refName)\n      endPos = mate.start\n    }\n\n    if (!mateRefName) {\n      console.warn(\n        `unable to resolve mate refName ${mateRefName} in reference genome`,\n      )\n      return {}\n    }\n\n    const bottomRegion = assembly.regions.find(f => f.refName === mateRefName)\n\n    if (!topRegion || !bottomRegion) {\n      console.warn(\n        `unable to find the refName for the top or bottom of the breakpoint view`,\n      )\n      return {}\n    }\n\n    const topMarkedRegion = [{ ...topRegion }, { ...topRegion }]\n    const bottomMarkedRegion = [{ ...bottomRegion }, { ...bottomRegion }]\n    topMarkedRegion[0].end = startPos + startMod\n    topMarkedRegion[1].start = startPos + startMod\n    bottomMarkedRegion[0].end = endPos + endMod\n    bottomMarkedRegion[1].start = endPos + endMod\n    const snapshot = {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: topMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (topRegion.start + feature.get('start')) / bpPerPx,\n        },\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: bottomMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (bottomRegion.start + endPos) / bpPerPx,\n        },\n      ],\n      displayName: `${\n        feature.get('name') || feature.get('id') || 'breakend'\n      } split detail`,\n    }\n    return snapshot\n  }\n}\n\nexport default (pluginManager: PluginManager) => {\n  const { load } = pluginManager\n\n  const { stateModel } = load(BreakpointSplitViewModel)\n\n  return new BreakpointSplitViewType({\n    name: 'BreakpointSplitView',\n    stateModel,\n    ReactComponent: BreakpointSplitViewComponent,\n  })\n}\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  stateModel as alignmentsFeatureDetailStateModel,\n} from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewFactory from './BreakpointSplitView'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(BreakpointSplitViewFactory),\n    )\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'BreakpointAlignmentsWidget',\n          heading: 'Breakpoint feature details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModel,\n          ReactComponent: lazy(\n            () =>\n              import(\n                './BreakpointAlignmentsFeatureDetail/BreakpointAlignmentsFeatureDetail'\n              ),\n          ),\n        }),\n    )\n  }\n\n  configure() {}\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y])\n  resultArray.push([cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution])\n  resultArray.push([x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) {\n      theta += Math.PI\n    } else {\n      theta -= Math.PI\n    }\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) {\n    return [0, 0]\n  }\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta]\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) {\n    return false\n  }\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) {\n    return true\n  }\n\n  // put both range starts between 2 and 4\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move r2 2 to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move it 2 to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ]\n    let maxRho = -Infinity\n    for (let i = 0; i < vertices.length; i += 1) {\n      const [x, y] = vertices[i]\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) {\n        maxRho = rho\n      }\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)] as [number, number],\n      theta: [0, 2 * Math.PI] as [number, number],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Infinity\n  let rhoMax = -Infinity\n  let thetaMin = Infinity\n  let thetaMax = -Infinity\n  for (let i = 0; i < vertices.length; i += 1) {\n    // ignore vertex if outside the viewport\n    const [vx, vy] = vertices[i]\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) {\n          thetaMin = theta\n        }\n        if (theta > thetaMax && rho > 0.0001) {\n          thetaMax = theta\n        }\n        if (rho < rhoMin) {\n          rhoMin = rho\n        }\n        if (rho > rhoMax) {\n          rhoMax = rho\n        }\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)] as [number, number],\n    theta: [thetaMin, thetaMax] as [number, number],\n  }\n}\n","import { polarToCartesian, assembleLocString, Region } from '@jbrowse/core/util'\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nexport class Slice {\n  key: string\n\n  offsetRadians: number\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    public region: Region & { widthBp: number; elided: boolean },\n    currentRadianOffset: number,\n    public radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key = assembleLocString(region)\n    this.offsetRadians = currentRadianOffset\n    this.bpPerRadian = bpPerRadian\n    this.flipped = false\n\n    this.startRadians = this.offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + this.offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return Object.fromEntries(Object.entries(this))\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction calculateStaticSlices(self: any) {\n  const slices = []\n  let currentRadianOffset = 0\n  for (const region of self.elidedRegions) {\n    const radianWidth =\n      region.widthBp / self.bpPerRadian + self.spacingPx / self.pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\nfunction sliceIsVisible(\n  self: { offsetRadians: number; visibleSection: { theta: [number, number] } },\n  slice: Slice,\n) {\n  const {\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  cast,\n  getParent,\n  getRoot,\n  resolveIdentifier,\n  types,\n  SnapshotOrInstance,\n  Instance,\n} from 'mobx-state-tree'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { transaction } from 'mobx'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\n\nimport {\n  getSession,\n  clamp,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { calculateStaticSlices, sliceIsVisible } from './slices'\n\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\n/**\n * #stateModel CircularView\n * extends `BaseViewModel`\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  return types.compose(\n    BaseViewModel,\n    types\n      .model('CircularView', {\n        /**\n         * #property\n         */\n        type: types.literal('CircularView'),\n        /**\n         * #property\n         * similar to offsetPx in linear genome view\n         */\n        offsetRadians: -Math.PI / 2,\n        /**\n         * #property\n         */\n        bpPerPx: 2000000,\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         */\n        hideVerticalResizeHandle: false,\n        /**\n         * #property\n         */\n        hideTrackSelectorButton: false,\n        /**\n         * #property\n         */\n        lockedFitToWindow: true,\n        /**\n         * #property\n         */\n        disableImportForm: false,\n\n        /**\n         * #property\n         */\n        height: types.optional(\n          types.refinement('trackHeight', types.number, n => n >= minHeight),\n          defaultHeight,\n        ),\n        /**\n         * #property\n         */\n        displayedRegions: types.array(Region),\n        /**\n         * #property\n         */\n        scrollX: 0,\n        /**\n         * #property\n         */\n        scrollY: 0,\n\n        minimumRadiusPx: 25,\n        spacingPx: 10,\n        paddingPx: 80,\n        lockedPaddingPx: 100,\n        minVisibleWidth: 6,\n        minimumBlockWidth: 20,\n\n        trackSelectorType: 'hierarchical',\n      })\n      .volatile(() => ({\n        width: 0,\n      }))\n      .views(self => ({\n        /**\n         * #getter\n         */\n        get staticSlices() {\n          return calculateStaticSlices(self)\n        },\n\n        /**\n         * #getter\n         */\n        get visibleSection() {\n          return viewportVisibleSection(\n            [\n              self.scrollX,\n              self.scrollX + self.width,\n              self.scrollY,\n              self.scrollY + self.height,\n            ],\n            this.centerXY,\n            this.radiusPx,\n          )\n        },\n        /**\n         * #getter\n         */\n        get circumferencePx() {\n          let elidedBp = 0\n          for (const r of this.elidedRegions) {\n            elidedBp += r.widthBp\n          }\n          return (\n            elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n          )\n        },\n        /**\n         * #getter\n         */\n        get radiusPx() {\n          return this.circumferencePx / (2 * Math.PI)\n        },\n        /**\n         * #getter\n         */\n        get bpPerRadian() {\n          return self.bpPerPx * this.radiusPx\n        },\n        /**\n         * #getter\n         */\n        get pxPerRadian() {\n          return this.radiusPx\n        },\n        /**\n         * #getter\n         */\n        get centerXY(): [number, number] {\n          return [\n            this.radiusPx + self.paddingPx,\n            this.radiusPx + self.paddingPx,\n          ]\n        },\n        /**\n         * #getter\n         */\n        get totalBp() {\n          let total = 0\n          for (const region of self.displayedRegions) {\n            total += region.end - region.start\n          }\n          return total\n        },\n        /**\n         * #getter\n         */\n        get maximumRadiusPx() {\n          return self.lockedFitToWindow\n            ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n            : 1000000\n        },\n        /**\n         * #getter\n         */\n        get maxBpPerPx() {\n          const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n          return this.totalBp / minCircumferencePx\n        },\n        /**\n         * #getter\n         */\n        get minBpPerPx() {\n          // min depends on window dimensions, clamp between old min(0.01) and max\n          const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n          return clamp(\n            this.totalBp / maxCircumferencePx,\n            0.0000000001,\n            this.maxBpPerPx,\n          )\n        },\n        /**\n         * #getter\n         */\n        get atMaxBpPerPx() {\n          return self.bpPerPx >= this.maxBpPerPx\n        },\n        /**\n         * #getter\n         */\n        get atMinBpPerPx() {\n          return self.bpPerPx <= this.minBpPerPx\n        },\n        /**\n         * #getter\n         */\n        get tooSmallToLock() {\n          return this.minBpPerPx <= 0.0000000001\n        },\n        /**\n         * #getter\n         */\n        get figureDimensions(): [number, number] {\n          return [\n            this.radiusPx * 2 + 2 * self.paddingPx,\n            this.radiusPx * 2 + 2 * self.paddingPx,\n          ]\n        },\n        /**\n         * #getter\n         */\n        get figureWidth() {\n          return this.figureDimensions[0]\n        },\n        /**\n         * #getter\n         */\n        get figureHeight() {\n          return this.figureDimensions[1]\n        },\n        /**\n         * #getter\n         * this is displayedRegions, post-processed to\n         * elide regions that are too small to see reasonably\n         */\n        get elidedRegions() {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const visible: any[] = []\n          self.displayedRegions.forEach(region => {\n            const widthBp = region.end - region.start\n            const widthPx = widthBp / self.bpPerPx\n            if (widthPx < self.minVisibleWidth) {\n              // too small to see, collapse into a single elision region\n              const lastVisible = visible[visible.length - 1]\n              if (lastVisible && lastVisible.elided) {\n                lastVisible.regions.push({ ...region })\n                lastVisible.widthBp += widthBp\n              } else {\n                visible.push({\n                  elided: true,\n                  widthBp,\n                  regions: [{ ...region }],\n                })\n              }\n            } else {\n              // big enough to see, display it\n              visible.push({ ...region, widthBp })\n            }\n          })\n\n          // remove any single-region elisions\n          for (let i = 0; i < visible.length; i += 1) {\n            const v = visible[i]\n            if (v.elided && v.regions.length === 1) {\n              delete v.elided\n              visible[i] = { ...v, ...v.regions[0] }\n            }\n          }\n          return visible\n        },\n        /**\n         * #getter\n         */\n        get assemblyNames() {\n          const assemblyNames: string[] = []\n          self.displayedRegions.forEach(displayedRegion => {\n            if (!assemblyNames.includes(displayedRegion.assemblyName)) {\n              assemblyNames.push(displayedRegion.assemblyName)\n            }\n          })\n          return assemblyNames\n        },\n        /**\n         * #getter\n         */\n        get initialized() {\n          const { assemblyManager } = getSession(self)\n          return this.assemblyNames.every(\n            a => assemblyManager.get(a)?.initialized,\n          )\n        },\n      }))\n      .views(self => ({\n        /**\n         * #getter\n         */\n        get visibleStaticSlices() {\n          return self.staticSlices.filter(s => sliceIsVisible(self, s))\n        },\n      }))\n      .volatile(() => ({\n        error: undefined as unknown,\n      }))\n      .actions(self => ({\n        /**\n         * #action\n         */\n        setWidth(newWidth: number) {\n          self.width = Math.max(newWidth, minWidth)\n          return self.width\n        },\n        /**\n         * #action\n         */\n        setHeight(newHeight: number) {\n          self.height = Math.max(newHeight, minHeight)\n          return self.height\n        },\n        /**\n         * #action\n         */\n        resizeHeight(distance: number) {\n          const oldHeight = self.height\n          const newHeight = this.setHeight(self.height + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newHeight - oldHeight\n        },\n        /**\n         * #action\n         */\n        resizeWidth(distance: number) {\n          const oldWidth = self.width\n          const newWidth = this.setWidth(self.width + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newWidth - oldWidth\n        },\n        /**\n         * #action\n         */\n        rotateClockwiseButton() {\n          this.rotateClockwise(Math.PI / 6)\n        },\n\n        /**\n         * #action\n         */\n        rotateCounterClockwiseButton() {\n          this.rotateCounterClockwise(Math.PI / 6)\n        },\n\n        /**\n         * #action\n         */\n        rotateClockwise(distance = 0.17) {\n          self.offsetRadians += distance\n        },\n\n        /**\n         * #action\n         */\n        rotateCounterClockwise(distance = 0.17) {\n          self.offsetRadians -= distance\n        },\n\n        /**\n         * #action\n         */\n        zoomInButton() {\n          this.setBpPerPx(self.bpPerPx / 1.4)\n        },\n\n        /**\n         * #action\n         */\n        zoomOutButton() {\n          this.setBpPerPx(self.bpPerPx * 1.4)\n        },\n\n        /**\n         * #action\n         */\n        setBpPerPx(newVal: number) {\n          self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n        },\n\n        /**\n         * #action\n         */\n        setModelViewWhenAdjust(secondCondition: boolean) {\n          if (self.lockedFitToWindow && secondCondition) {\n            this.setBpPerPx(self.minBpPerPx)\n          }\n        },\n\n        /**\n         * #action\n         */\n        closeView() {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          getParent<any>(self, 2).removeView(self)\n        },\n\n        /**\n         * #action\n         */\n        setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n          const previouslyEmpty = self.displayedRegions.length === 0\n          self.displayedRegions = cast(regions)\n\n          if (previouslyEmpty) {\n            this.setBpPerPx(self.minBpPerPx)\n          } else {\n            this.setBpPerPx(self.bpPerPx)\n          }\n        },\n\n        /**\n         * #action\n         */\n        activateTrackSelector() {\n          if (self.trackSelectorType === 'hierarchical') {\n            const session = getSession(self)\n            if (isSessionModelWithWidgets(session)) {\n              const selector = session.addWidget(\n                'HierarchicalTrackSelectorWidget',\n                'hierarchicalTrackSelector',\n                { view: self },\n              )\n              session.showWidget(selector)\n              return selector\n            }\n          }\n          throw new Error(\n            `invalid track selector type ${self.trackSelectorType}`,\n          )\n        },\n\n        /**\n         * #action\n         */\n        toggleTrack(trackId: string) {\n          // if we have any tracks with that configuration, turn them off\n          const hiddenCount = this.hideTrack(trackId)\n          // if none had that configuration, turn one on\n          if (!hiddenCount) {\n            this.showTrack(trackId)\n          }\n        },\n\n        /**\n         * #action\n         */\n        setError(error: unknown) {\n          console.error(error)\n          self.error = error\n        },\n\n        /**\n         * #action\n         */\n        showTrack(trackId: string, initialSnapshot = {}) {\n          const schema = pluginManager.pluggableConfigSchemaType('track')\n          const conf = resolveIdentifier(schema, getRoot(self), trackId)\n          const trackType = pluginManager.getTrackType(conf.type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${conf.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(d => d.name)\n          const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n            supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: conf.type,\n            configuration: conf,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        /**\n         * #action\n         */\n        addTrackConf(\n          configuration: AnyConfigurationModel,\n          initialSnapshot = {},\n        ) {\n          const { type } = configuration\n          const name = readConfObject(configuration, 'name')\n          const trackType = pluginManager.getTrackType(type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(d => d.name)\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            name,\n            type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        /**\n         * #action\n         */\n        hideTrack(trackId: string) {\n          const schema = pluginManager.pluggableConfigSchemaType('track')\n          const conf = resolveIdentifier(schema, getRoot(self), trackId)\n          const t = self.tracks.filter(t => t.configuration === conf)\n          transaction(() => t.forEach(t => self.tracks.remove(t)))\n          return t.length\n        },\n\n        /**\n         * #action\n         */\n        toggleFitToWindowLock() {\n          // when going unlocked -> locked and circle is cut off, set to the locked minBpPerPx\n          self.lockedFitToWindow = !self.lockedFitToWindow\n          this.setModelViewWhenAdjust(self.atMinBpPerPx)\n          return self.lockedFitToWindow\n        },\n      })),\n  )\n}\n\nexport type CircularViewStateModel = ReturnType<typeof stateModelFactory>\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\n/**\nPLANS\n\n- tracks\n- ruler tick marks\n- set viewport scroll from state snapshot\n\n*/\n\nexport default stateModelFactory\n","import React, { useState, useEffect } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()(theme => {\n  const offset = 2\n  const duration = 1.4\n\n  const { primary, secondary, tertiary, quaternary } = theme.palette\n  return {\n    path: {\n      strokeDasharray: 187,\n      strokeDashoffset: 50,\n      animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n        duration * 4\n      }s ease-in-out infinite`,\n    },\n    '@keyframes colors': {\n      '0%': {\n        stroke: primary.light,\n      },\n      '25%': {\n        stroke: secondary.light,\n      },\n      '50%': {\n        stroke: tertiary.light,\n      },\n      '75%': {\n        stroke: quaternary.light,\n      },\n      '100%': {\n        stroke: primary.light,\n      },\n    },\n    '@keyframes dash': {\n      '0%': {\n        strokeDashoffset: offset,\n      },\n      '50%': {\n        strokeDashoffset: offset / 4,\n        transform: 'rotate(135deg)',\n      },\n      '100%': {\n        strokeDashoffset: offset,\n        transform: 'rotate(720deg)',\n      },\n    },\n  }\n})\n\n// 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\nconst Loading = observer(\n  ({\n    model: {\n      renderProps: { radius },\n    },\n  }: {\n    model: { renderProps: { radius: number } }\n  }) => {\n    const { classes } = useStyles()\n\n    // only show the loading message after 400ms to prevent excessive flickering\n    const [shown, setShown] = useState(false)\n    useEffect(() => {\n      const timeout = setTimeout(() => setShown(true), 400)\n      return () => clearTimeout(timeout)\n    })\n\n    return !shown ? null : (\n      <g>\n        <defs>\n          <pattern\n            id=\"diagonalHatch\"\n            width=\"10\"\n            height=\"10\"\n            patternTransform=\"rotate(45 0 0)\"\n            patternUnits=\"userSpaceOnUse\"\n          >\n            <line\n              x1=\"0\"\n              y1=\"0\"\n              x2=\"0\"\n              y2=\"10\"\n              style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n            />\n          </pattern>\n        </defs>\n        <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n        <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n        <text\n          x=\"0\"\n          y=\"0\"\n          transform=\"rotate(90 0 0)\"\n          dominantBaseline=\"middle\"\n          textAnchor=\"middle\"\n        >\n          Loading&hellip;\n        </text>\n        <circle\n          className={classes.path}\n          fill=\"none\"\n          strokeWidth=\"4\"\n          strokeLinecap=\"round\"\n          cx=\"0\"\n          cy=\"0\"\n          r=\"60\"\n        />\n      </g>\n    )\n  },\n)\n\nexport default Loading\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nconst DisplayError = observer(\n  ({\n    model,\n  }: {\n    model: { renderProps: { radius: number }; error: unknown }\n  }) => {\n    const {\n      renderProps: { radius },\n      error,\n    } = model\n    return (\n      <g>\n        <defs>\n          <pattern\n            id=\"diagonalHatch\"\n            width=\"10\"\n            height=\"10\"\n            patternTransform=\"rotate(45 0 0)\"\n            patternUnits=\"userSpaceOnUse\"\n          >\n            <line\n              x1=\"0\"\n              y1=\"0\"\n              x2=\"0\"\n              y2=\"10\"\n              style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n            />\n          </pattern>\n        </defs>\n        <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#ffb4b4\" />\n        <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n        <text\n          x=\"0\"\n          y=\"0\"\n          transform=\"rotate(90 0 0)\"\n          dominantBaseline=\"middle\"\n          textAnchor=\"middle\"\n        >\n          {String(error)}\n        </text>\n      </g>\n    )\n  },\n)\n\nexport default DisplayError\n","import React, { useEffect, useRef } from 'react'\nimport { isAlive } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport { rIC } from '@jbrowse/core/util'\n\nfunction RpcRenderedSvgGroup({\n  model,\n}: {\n  model: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data: any\n    html: string\n    filled: boolean\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    renderingComponent: React.FC<any>\n    renderProps: Function\n  }\n}) {\n  const { data, html, filled, renderingComponent } = model\n\n  const ssrContainerNode = useRef<SVGGElement>(null)\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    function doHydrate() {\n      if (domNode && filled) {\n        if (domNode.innerHTML) {\n          domNode.style.display = 'none'\n          unmountComponentAtNode(domNode)\n        }\n\n        // setting outline:none fixes react \"focusable\" element issue. see\n        // https://github.com/GMOD/jbrowse-components/issues/2160\n        domNode.style.outline = 'none'\n        domNode.innerHTML = html\n        // use requestIdleCallback to defer main-thread rendering\n        // and hydration for when we have some free time. helps\n        // keep the framerate up.\n        rIC(() => {\n          if (!isAlive(model)) {\n            return\n          }\n          const mainThreadRendering = React.createElement(\n            renderingComponent,\n            { ...data, ...model.renderProps() },\n            null,\n          )\n          rIC(() => {\n            if (!isAlive(model)) {\n              return\n            }\n            hydrate(mainThreadRendering, domNode)\n          })\n        })\n      }\n    }\n    doHydrate()\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  })\n\n  return <g ref={ssrContainerNode} />\n}\n\nexport default observer(RpcRenderedSvgGroup)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport Loading from './Loading'\nimport DisplayError from './DisplayError'\nimport RpcRenderedSvgGroup from './RpcRenderedSvgGroup'\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction BaseChordDisplay({ display }: any) {\n  if (display.error) {\n    return <DisplayError model={display} />\n  }\n  if (!display.filled) {\n    return <Loading model={display} />\n  }\n  return <RpcRenderedSvgGroup model={display} />\n}\nexport default observer(BaseChordDisplay)\n","import { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function renderReactionData(self: any) {\n  const view = getContainingView(self)\n  const { rendererType } = self\n  const { rpcManager } = getSession(view)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps: self.renderProps(),\n    renderArgs: {\n      assemblyName: view.displayedRegions[0]?.assemblyName,\n      adapterConfig: JSON.parse(JSON.stringify(self.adapterConfig)),\n      rendererType: rendererType.name,\n      regions: JSON.parse(JSON.stringify(view.displayedRegions)),\n      blockDefinitions: self.blockDefinitions,\n      sessionId: getRpcSessionId(self),\n      timeout: 1000000,\n    },\n  }\n}\n\nexport async function renderReactionEffect(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  props: any,\n  signal: AbortSignal,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  self: any,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const {\n    rendererType,\n    rpcManager,\n    cannotBeRenderedReason,\n    renderArgs,\n    renderProps,\n  } = props\n\n  if (cannotBeRenderedReason) {\n    return { message: cannotBeRenderedReason }\n  }\n\n  // don't try to render 0 or NaN radius or no regions\n  if (\n    !props.renderProps.radius ||\n    !props.renderArgs.regions ||\n    !props.renderArgs.regions.length\n  ) {\n    return { message: 'Skipping render' }\n  }\n\n  // check renderertype compatibility\n  if (!self.isCompatibleWithRenderer(rendererType)) {\n    throw new Error(\n      `renderer ${rendererType.name} is not compatible with this display type`,\n    )\n  }\n\n  const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n    ...renderArgs,\n    ...renderProps,\n    signal,\n  })\n\n  return { html, data, renderingComponent: rendererType.ReactComponent }\n}\n","import React from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport CircularChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport RendererType from '@jbrowse/core/pluggableElementTypes/renderers/RendererType'\nimport {\n  getContainingView,\n  getSession,\n  getEnv,\n  makeAbortableReaction,\n  AnyReactComponentType,\n} from '@jbrowse/core/util'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getParent, isAlive, types } from 'mobx-state-tree'\n\n// locals\nimport { renderReactionData, renderReactionEffect } from './renderReaction'\nimport { CircularViewModel } from '../../CircularView/models/CircularView'\n\n/**\n * #stateModel BaseChordDisplay\n * extends `BaseDisplay`\n */\nfunction stateModelFactory() {\n  return types\n    .compose(\n      'BaseChordDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        bezierRadiusRatio: 0.1,\n        /**\n         * #property\n         */\n        assemblyName: types.maybe(types.string),\n      }),\n    )\n    .volatile(() => {\n      return {\n        // NOTE: all this volatile stuff has to be filled in at once\n        // so that it stays consistent\n        filled: false,\n        reactElement: undefined as React.ReactElement | undefined,\n        data: undefined,\n        message: '',\n        renderingComponent: undefined as undefined | AnyReactComponentType,\n        refNameMap: undefined as Record<string, string> | undefined,\n      }\n    })\n    .actions(self => {\n      const { pluginManager } = getEnv(self)\n      const track = self\n      return {\n        /**\n         * #action\n         */\n        onChordClick(feature: Feature) {\n          getConf(self, 'onChordClick', { feature, track, pluginManager })\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get blockDefinitions() {\n        const origSlices = (getContainingView(self) as CircularViewModel)\n          .staticSlices\n        if (!self.refNameMap) {\n          return origSlices\n        }\n\n        const slices = JSON.parse(JSON.stringify(origSlices))\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        slices.forEach((slice: any) => {\n          const regions = slice.region.elided\n            ? slice.region.regions\n            : [slice.region]\n          regions.forEach((region: Region) => {\n            const renamed = self.refNameMap?.[region.refName]\n            if (renamed && region.refName !== renamed) {\n              region.refName = renamed\n            }\n          })\n        })\n        return slices\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        const view = getContainingView(self) as CircularViewModel\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: this.blockDefinitions,\n          onChordClick: self.onChordClick,\n        }\n      },\n\n      /**\n       * #getter\n       * the pluggable element type object for this diplay's\n       * renderer\n       */\n      get rendererType() {\n        const display = self\n        const { pluginManager } = getEnv(self)\n        const ThisRendererType = pluginManager.getRendererType(\n          self.rendererTypeName,\n        )\n        if (!ThisRendererType) {\n          throw new Error(`renderer \"${display.rendererTypeName}\" not found`)\n        }\n        if (!ThisRendererType.ReactComponent) {\n          throw new Error(\n            `renderer ${display.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n          )\n        }\n        return ThisRendererType\n      },\n\n      /**\n       * #method\n       */\n      isCompatibleWithRenderer(renderer: RendererType) {\n        return !!(renderer instanceof CircularChordRendererType)\n      },\n\n      /**\n       * #getter\n       * returns a string feature ID if the globally-selected object\n       * is probably a feature\n       */\n      get selectedFeatureId() {\n        if (!isAlive(self)) {\n          return undefined\n        }\n        const session = getSession(self)\n        if (!session) {\n          return undefined\n        }\n        const { selection } = session\n        // does it quack like a feature?\n        if (isFeature(selection)) {\n          return selection.id()\n        }\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      renderStarted() {\n        self.filled = false\n        self.message = ''\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      },\n      /**\n       * #action\n       */\n      renderSuccess({\n        message,\n        data,\n        reactElement,\n        renderingComponent,\n      }: {\n        message: string\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        data: any\n        reactElement: React.ReactElement\n        renderingComponent: AnyReactComponentType\n      }) {\n        if (message) {\n          self.filled = false\n          self.message = message\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n        } else {\n          self.filled = true\n          self.message = ''\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n        }\n      },\n      /**\n       * #action\n       */\n      renderError(error: unknown) {\n        console.error(error)\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = ''\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = error\n        self.renderingComponent = undefined\n      },\n\n      /**\n       * #action\n       */\n      setRefNameMap(refNameMap: Record<string, string>) {\n        self.refNameMap = refNameMap\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        makeAbortableReaction(\n          self,\n          renderReactionData,\n\n          // @ts-ignore\n          renderReactionEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            // delay: self.renderDelay || 300,\n            fireImmediately: true,\n          },\n          self.renderStarted,\n          self.renderSuccess,\n          self.renderError,\n        )\n        makeAbortableReaction(\n          self,\n          () => ({\n            assemblyNames: getTrackAssemblyNames(self.parentTrack) as string[],\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            adapter: getConf(getParent<any>(self, 2), 'adapter'),\n            assemblyManager: getSession(self).assemblyManager,\n          }),\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          async ({ assemblyNames, adapter, assemblyManager }: any, signal) => {\n            return assemblyManager.getRefNameMapForAdapter(\n              adapter,\n              assemblyNames[0],\n              { signal, sessionId: getRpcSessionId(self) },\n            )\n          },\n          {\n            name: `${self.type} ${self.id} getting refNames`,\n            fireImmediately: true,\n          },\n          () => {},\n          refNameMap => {\n            self.setRefNameMap(refNameMap)\n          },\n          error => {\n            console.error(error)\n            self.setError(error)\n          },\n        )\n      },\n    }))\n}\n\nexport const BaseChordDisplayModel = stateModelFactory()\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseChordDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    /**\n     * #slot\n     */\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      contextVariable: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n\nexport { baseChordDisplayConfig }\n","import { lazy } from 'react'\nimport { when } from 'mobx'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport DataUsageIcon from '@mui/icons-material/DataUsage'\nimport stateModelFactory, {\n  CircularViewModel,\n  CircularViewStateModel,\n} from './CircularView/models/CircularView'\n\ntype CGV = CircularViewModel\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          ReactComponent: lazy(\n            () => import('./CircularView/components/CircularView'),\n          ),\n          stateModel: stateModelFactory(pluginManager),\n          name: 'CircularView',\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-CircularView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        loc,\n        tracks = [],\n      }: {\n        session: AbstractSessionModel\n        assembly?: string\n        loc: string\n        tracks?: string[]\n      }) => {\n        const { assemblyManager } = session\n        const view = session.addView('CircularView', {}) as CGV\n\n        await when(() => view.initialized)\n\n        if (!assembly) {\n          throw new Error(\n            'No assembly provided when launching circular genome view',\n          )\n        }\n\n        const asm = await assemblyManager.waitForAssembly(assembly)\n        if (!asm) {\n          throw new Error(\n            `Assembly \"${assembly}\" not found when launching circular genome view`,\n          )\n        }\n\n        view.setDisplayedRegions(asm.regions || [])\n\n        tracks.forEach(track => view.showTrack(track))\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseChordDisplayModel,\n  baseChordDisplayConfig,\n  BaseChordDisplayComponent,\n} from './BaseChordDisplay'\n\nexport type { CircularViewModel, CircularViewStateModel }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config PAFAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst PAFAdapter = ConfigurationSchema(\n  'PAFAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.paf',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default PAFAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanAnchorsAdapter = ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MCScanAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MCScanSimpleAnchorsAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MCScanSimpleAnchorsAdapter = ConfigurationSchema(\n  'MCScanSimpleAnchorsAdapter',\n  {\n    /**\n     * #slot\n     */\n    mcscanSimpleAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors.simple',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default MCScanSimpleAnchorsAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MashMapAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MashMapAdapter = ConfigurationSchema(\n  'MashMapAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n\n    /**\n     * #slot\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    outLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mashmap.out',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MashMapAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DeltaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DeltaAdapter = ConfigurationSchema(\n  'DeltaAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    /**\n     * #slot\n     * alternative to assembly names\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    /**\n     * #slot\n     */\n    deltaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.delta', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default DeltaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChainAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChainAdapter = ConfigurationSchema(\n  'ChainAdapter',\n  {\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    /**\n     * #slot\n     * can be specified as alternative to assemblyNames\n     */\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    /**\n     * #slot\n     */\n    chainLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.chain', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default ChainAdapter\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\n\nimport PAFAdapterF from './PAFAdapter'\nimport MCScanAnchorsAdapterF from './MCScanAnchorsAdapter'\nimport MCScanSimpleAnchorsAdapterF from './MCScanSimpleAnchorsAdapter'\nimport MashMapAdapterF from './MashMapAdapter'\nimport DeltaAdapterF from './DeltaAdapter'\nimport ChainAdapterF from './ChainAdapter'\n\nimport {\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class ComparativeAdaptersPlugin extends Plugin {\n  name = 'ComparativeAdaptersPlugin'\n\n  install(pluginManager: PluginManager) {\n    PAFAdapterF(pluginManager)\n    DeltaAdapterF(pluginManager)\n    ChainAdapterF(pluginManager)\n    MCScanAnchorsAdapterF(pluginManager)\n    MCScanSimpleAnchorsAdapterF(pluginManager)\n    MashMapAdapterF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.paf/i\n          const adapterName = 'PAFAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              pafLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'PAFAdapter') {\n            return 'SyntenyTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PAFAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () => import('./PAFAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'DeltaAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n\n        getAdapterClass: () => import('./DeltaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChainAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () => import('./ChainAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanAnchorsAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n\n        getAdapterClass: () =>\n          import('./MCScanAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanSimpleAnchorsAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () =>\n          import('./MCScanSimpleAnchorsAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MashMapAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () => import('./MashMapAdapter').then(r => r.default),\n      }),\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { InputLabel, TextField } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// fontSize and fontFamily have to match between Editor and SyntaxHighlighter\nconst fontSize = '12px'\n// Optimize by using system default fonts: https://css-tricks.com/snippets/css/font-stacks/\nconst fontFamily =\n  'Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", \"Nimbus Mono L\", Monaco, \"Courier New\", Courier, monospace'\n\nconst useStyles = makeStyles()(theme => ({\n  error: {\n    color: 'red',\n    fontSize: '0.8em',\n  },\n  callbackEditor: {\n    fontFamily,\n    fontSize,\n    background: theme.palette.background.default,\n    width: 800,\n    marginTop: '16px',\n    border: '1px solid rgba(0,0,0,0.42)',\n  },\n  callbackContainer: {\n    width: '100%',\n    overflowX: 'auto',\n  },\n  textAreaFont: {\n    fontFamily,\n  },\n}))\n\nfunction JsonEditor({\n  slot,\n}: {\n  slot: {\n    name: string\n    description: string\n    value: unknown\n    set: (arg: unknown) => void\n  }\n}) {\n  const { classes } = useStyles()\n  const [contents, setContents] = useState(JSON.stringify(slot.value, null, 2))\n  const [error, setError] = useState<unknown>()\n\n  useEffect(() => {\n    try {\n      setError(undefined)\n      slot.set(JSON.parse(contents))\n    } catch (e) {\n      console.error({ e })\n      setError(e)\n    }\n  }, [contents, slot])\n\n  return (\n    <>\n      {error ? <p className={classes.error}>{`${error}`}</p> : null}\n      <div className={classes.callbackContainer}>\n        <InputLabel shrink htmlFor=\"json-editor\">\n          {slot.name}\n        </InputLabel>\n        <TextField\n          id=\"json-editor\"\n          className={classes.callbackEditor}\n          value={contents}\n          helperText={slot.description}\n          multiline\n          onChange={event => setContents(event.target.value)}\n          style={{ background: error ? '#fdd' : undefined }}\n          InputProps={{\n            classes: {\n              input: classes.textAreaFont,\n            },\n          }}\n        />\n      </div>\n    </>\n  )\n}\n\nexport default observer(JsonEditor)\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\n\nexport default class FromConfigAdapter extends BaseFeatureDataAdapter {\n  protected features: Map<string, Feature[]>\n\n  constructor(\n    conf: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(conf, getSubAdapter, pluginManager)\n    const feats = readConfObject(conf, 'features') as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(feats || [])\n  }\n\n  static makeFeatures(fdata: SimpleFeatureSerialized[]) {\n    const features = new Map<string, Feature[]>()\n    for (let i = 0; i < fdata.length; i += 1) {\n      if (fdata[i]) {\n        const f = this.makeFeature(fdata[i])\n        const refName = f.get('refName') as string\n        let bucket = features.get(refName)\n        if (!bucket) {\n          bucket = []\n          features.set(refName, bucket)\n        }\n\n        bucket.push(f)\n      }\n    }\n\n    // sort the features on each reference sequence by start coordinate\n    for (const refFeatures of features.values()) {\n      refFeatures.sort((a, b) => a.get('start') - b.get('start'))\n    }\n\n    return features\n  }\n\n  static makeFeature(data: SimpleFeatureSerialized) {\n    return new SimpleFeature(data)\n  }\n\n  async getRefNames() {\n    return [...this.features.keys()]\n  }\n\n  async getRefNameAliases() {\n    return Array.from(this.features.values()).map(featureArray => ({\n      refName: featureArray[0].get('refName'),\n      aliases: featureArray[0].get('aliases'),\n    }))\n  }\n\n  getFeatures(region: NoAssemblyRegion) {\n    const { refName, start, end } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      const features = this.features.get(refName) || []\n      for (let i = 0; i < features.length; i++) {\n        const f = features[i]\n\n        if (f.get('end') > start && f.get('start') < end) {\n          observer.next(f)\n        }\n      }\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import {\n  BaseAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport FromConfigAdapter from './FromConfigAdapter'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\nexport default class FromConfigRegionsAdapter\n  extends BaseAdapter\n  implements RegionsAdapter\n{\n  private features: Map<string, Feature[]>\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const features = readConfObject(\n      config,\n      'features',\n    ) as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(features || [])\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    // sort the regions by refName\n    regions.sort((a, b) => a.refName.localeCompare(b.refName))\n\n    return regions\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { toArray } from 'rxjs/operators'\nimport FromConfigAdapter from './FromConfigAdapter'\nimport { RegionsAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nexport default class FromConfigSequenceAdapter\n  extends FromConfigAdapter\n  implements RegionsAdapter\n{\n  /**\n   * Fetch features for a certain region\n   * @param region - Region\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: NoAssemblyRegion) {\n    return ObservableCreate<Feature>(async observer => {\n      const feats = await super.getFeatures(region).pipe(toArray()).toPromise()\n      const feat = feats[0]\n      observer.next(\n        new SimpleFeature({\n          ...feat.toJSON(),\n          uniqueId: `${feat.id()}:${region.start}-${region.end}`,\n          end: region.end,\n          start: region.start,\n          seq: feat\n            .get('seq')\n            .slice(\n              Math.max(region.start - feat.get('start'), 0),\n              Math.max(region.end - feat.get('start'), 0),\n            ),\n        }),\n      )\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    return regions\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import {\n  BaseRefNameAliasAdapter,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport default class RefNameAliasAdapter\n  extends BaseAdapter\n  implements BaseRefNameAliasAdapter\n{\n  async getRefNameAliases() {\n    const loc = readConfObject(this.config, 'location')\n    if (loc.uri === '' || loc.uri === '/path/to/my/aliases.txt') {\n      return []\n    }\n    const results = await openLocation(loc).readFile('utf8')\n    const refColumn = readConfObject(this.config, 'refNameColumn')\n    return results\n      .trim()\n      .split(/\\n|\\r\\n|\\r/)\n      .filter(f => !!f && !f.startsWith('#'))\n      .map(row => {\n        const aliases = row.split('\\t')\n        const [refName] = aliases.splice(refColumn, 1)\n        return { refName, aliases: aliases.filter(f => !!f.trim()) }\n      })\n  }\n\n  async freeResources() {}\n}\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) =>\n  types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .actions(self => ({\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      setTarget(newTarget: any) {\n        self.target = newTarget\n      },\n    }))\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { isStateTreeNode, getType } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\nexport const HeadingComponent = observer(\n  ({ model }: { model?: { target: { type: string } } }) => {\n    if (model?.target) {\n      if (model.target.type) {\n        return <>{`${model.target.type} settings`}</>\n      }\n      if (isStateTreeNode(model.target)) {\n        const type = getType(model.target)\n        if (type?.name) {\n          return (\n            <>{`${type.name.replace('ConfigurationSchema', '')} settings`}</>\n          )\n        }\n      }\n    }\n    return <>Settings</>\n  },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config FromConfigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FromConfigSequenceAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    /**\n     * #slot\n     */\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport default sequenceConfigSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config RefNameAliasAdapter\n * can read \"chromAliases\" type files from UCSC or any tab separated file of\n * refName aliases\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst RefNameAliasAdapter = ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    /**\n     * #slot\n     */\n    location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/aliases.txt',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     * by default, the \"ref names that match the fasta\" are assumed to be in the\n     * first column (0), change this variable if needed\n     */\n    refNameColumn: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default RefNameAliasAdapter\n","import { lazy } from 'react'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as ConfigurationEditorConfigSchema,\n  HeadingComponent as ConfigurationEditorHeadingComponent,\n  stateModelFactory as ConfigurationEditorStateModelFactory,\n} from './ConfigurationEditorWidget'\nimport {\n  configSchema as fromConfigAdapterConfigSchema,\n  regionsConfigSchema as fromConfigRegionsAdapterConfigSchema,\n  sequenceConfigSchema as fromConfigSequenceAdapterConfigSchema,\n} from './FromConfigAdapter'\nimport { configSchema as refNameAliasAdapterConfigSchema } from './RefNameAliasAdapter'\n\nconst LazyConfigurationEditorComponent = lazy(\n  () => import('./ConfigurationEditorWidget/components/ConfigurationEditor'),\n)\n\nexport default class extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigAdapter',\n          configSchema: fromConfigAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./FromConfigAdapter/FromConfigAdapter').then(\n              r => r.default,\n            ),\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigRegionsAdapter',\n          configSchema: fromConfigRegionsAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./FromConfigAdapter/FromConfigRegionsAdapter').then(\n              r => r.default,\n            ),\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigSequenceAdapter',\n          configSchema: fromConfigSequenceAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./FromConfigAdapter/FromConfigSequenceAdapter').then(\n              r => r.default,\n            ),\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'RefNameAliasAdapter',\n          configSchema: refNameAliasAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./RefNameAliasAdapter/RefNameAliasAdapter').then(\n              r => r.default,\n            ),\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ConfigurationEditorWidget',\n        HeadingComponent: ConfigurationEditorHeadingComponent,\n        configSchema: ConfigurationEditorConfigSchema,\n        stateModel: ConfigurationEditorStateModelFactory(pluginManager),\n        ReactComponent: LazyConfigurationEditorComponent,\n      })\n    })\n  }\n}\n\nexport { default as JsonEditor } from './ConfigurationEditorWidget/components/JsonEditor'\n\nexport { LazyConfigurationEditorComponent as ConfigurationEditor }\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModel } from './model'\nexport const configSchema = ConfigurationSchema('AddConnectionWidget', {})\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  guessAdapter,\n  guessTrackType,\n  getFileName,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\n\nfunction isAbsoluteUrl(url = '') {\n  try {\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\ninterface IndexingAttr {\n  attributes: string[]\n  exclude: string[]\n}\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('AddTrackModel', {\n      id: ElementId,\n      type: types.literal('AddTrackWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      trackSource: 'fromFile',\n      trackData: undefined as FileLocation | undefined,\n      indexTrackData: undefined as FileLocation | undefined,\n\n      // alts\n      altAssemblyName: '',\n      altTrackName: '',\n      altTrackType: '',\n\n      adapterHint: '',\n      textIndexTrack: true,\n      textIndexingConf: undefined as IndexingAttr | undefined,\n    }))\n    .actions(self => ({\n      setAdapterHint(obj: string) {\n        self.adapterHint = obj\n      },\n      setTrackSource(str: string) {\n        self.trackSource = str\n      },\n      setTextIndexingConf(conf: IndexingAttr) {\n        self.textIndexingConf = conf\n      },\n      setTextIndexTrack(flag: boolean) {\n        self.textIndexTrack = flag\n      },\n      setTrackData(obj: FileLocation) {\n        self.trackData = obj\n      },\n      setIndexTrackData(obj: FileLocation) {\n        self.indexTrackData = obj\n      },\n      setAssembly(str: string) {\n        self.altAssemblyName = str\n      },\n      setTrackName(str: string) {\n        self.altTrackName = str\n      },\n      setTrackType(str: string) {\n        self.altTrackType = str\n      },\n\n      clearData() {\n        self.trackSource = ''\n        self.altTrackName = ''\n        self.altTrackType = ''\n        self.altAssemblyName = ''\n        self.adapterHint = ''\n        self.indexTrackData = undefined\n        self.trackData = undefined\n        self.textIndexingConf = undefined\n        self.textIndexTrack = true\n      },\n    }))\n    .views(self => ({\n      get trackAdapter() {\n        const { trackData, indexTrackData, adapterHint } = self\n\n        return trackData\n          ? guessAdapter(trackData, indexTrackData, adapterHint, self)\n          : undefined\n      },\n\n      get trackName() {\n        return (\n          self.altTrackName ||\n          (self.trackData ? getFileName(self.trackData) : '')\n        )\n      },\n\n      get isFtp() {\n        const { trackData: track, indexTrackData: index } = self\n        return !!(\n          // @ts-ignore\n          (index?.uri?.startsWith('ftp://') || track?.uri?.startsWith('ftp://'))\n        )\n      },\n\n      get isRelativeTrackUrl() {\n        // @ts-ignore\n        const uri = self.trackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      get isRelativeIndexUrl() {\n        // @ts-ignore\n        const uri = self.indexTrackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      get isRelativeUrl() {\n        return this.isRelativeIndexUrl || this.isRelativeTrackUrl\n      },\n\n      get trackHttp() {\n        // @ts-ignore\n        return self.trackData?.uri?.startsWith('http://')\n      },\n      get indexHttp() {\n        // @ts-ignore\n        return self.indexTrackData?.uri?.startsWith('http://')\n      },\n\n      get wrongProtocol() {\n        return (\n          window.location.protocol === 'https:' &&\n          (this.trackHttp || this.indexHttp)\n        )\n      },\n\n      get unsupported() {\n        return this.trackAdapter?.type === UNSUPPORTED\n      },\n\n      get assembly() {\n        return self.altAssemblyName || self.view.assemblyNames?.[0]\n      },\n\n      get trackType() {\n        return (\n          self.altTrackType ||\n          (this.trackAdapter\n            ? guessTrackType(this.trackAdapter.type, self)\n            : '')\n        )\n      },\n    }))\n    .views(self => ({\n      get warningMessage() {\n        if (self.isFtp) {\n          return `Warning: JBrowse cannot access files using the ftp protocol`\n        } else if (self.isRelativeUrl) {\n          return `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`\n        } else if (self.wrongProtocol) {\n          return `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`\n        }\n        return ''\n      },\n    }))\n}\n\nexport type AddTrackStateModel = ReturnType<typeof f>\nexport type AddTrackModel = Instance<AddTrackStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('AddTrackWidget', {})\n","import { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { AbstractSessionModel, getSession, getEnv } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nfunction hasAnyOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  return !!a1.find(value => a2.includes(value))\n}\n\nfunction passesFilter(\n  filter: string,\n  config: AnyConfigurationModel,\n  session: AbstractSessionModel,\n) {\n  const categories = readConfObject(config, 'category') as string[] | undefined\n  const filterLower = filter.toLowerCase()\n  return (\n    getTrackName(config, session).toLowerCase().includes(filterLower) ||\n    !!categories?.filter(c => c.toLowerCase().includes(filterLower)).length\n  )\n}\n\nexport type TreeNode = {\n  name: string\n  id: string\n  conf?: AnyConfigurationModel\n  checked?: boolean\n  isOpenByDefault?: boolean\n  children: TreeNode[]\n}\n\nfunction filterTracks(\n  tracks: AnyConfigurationModel[],\n  self: { view: { type: string } },\n  assemblyName: string,\n) {\n  const { assemblyManager } = getSession(self)\n  const { pluginManager } = getEnv(self)\n  const assembly = assemblyManager.get(assemblyName)\n\n  if (!assembly) {\n    return []\n  }\n  const { allAliases } = assembly\n  return tracks\n    .filter(c => hasAnyOverlap(allAliases, readConfObject(c, 'assemblyNames')))\n    .filter(c => {\n      const { displayTypes } = pluginManager.getViewType(self.view.type)\n      const compatDisplays = displayTypes.map((d: { name: string }) => d.name)\n      const trackDisplays = c.displays.map((d: { type: string }) => d.type)\n      return hasAnyOverlap(compatDisplays, trackDisplays)\n    })\n}\n\nexport function generateHierarchy(\n  model: HierarchicalTrackSelectorModel,\n  trackConfigurations: AnyConfigurationModel[],\n  collapsed: { get: (arg: string) => boolean | undefined },\n) {\n  const hierarchy = { children: [] as TreeNode[] } as TreeNode\n  const { filterText, view } = model\n  const session = getSession(model)\n\n  trackConfigurations\n    .filter(conf => passesFilter(filterText, conf, session))\n    .forEach(conf => {\n      // copy the categories since this array can be mutated downstream\n      const categories = [...(readConfObject(conf, 'category') || [])]\n\n      // silly thing where if trackId ends with sessionTrack, then push it to\n      // a category that starts with a space to force sort to the top...\n      // double whammy hackyness\n      if (conf.trackId.endsWith('sessionTrack')) {\n        categories.unshift(' Session tracks')\n      }\n\n      let currLevel = hierarchy\n\n      // find existing category to put track into or create it\n      for (let i = 0; i < categories.length; i++) {\n        const category = categories[i]\n        const ret = currLevel.children.find(c => c.name === category)\n        const id = categories.slice(0, i + 1).join(',')\n        if (!ret) {\n          const n = {\n            children: [],\n            name: category,\n            id,\n            isOpenByDefault: !collapsed.get(id),\n          }\n          currLevel.children.push(n)\n          currLevel = n\n        } else {\n          currLevel = ret\n        }\n      }\n      const tracks = view.tracks as { configuration: AnyConfigurationModel }[]\n\n      // using splice here tries to group leaf nodes above hierarchical nodes\n      currLevel.children.splice(\n        currLevel.children.findIndex(elt => elt.children.length),\n        0,\n        {\n          id: conf.trackId,\n          name: getTrackName(conf, session),\n          conf,\n          checked: !!tracks.find(f => f.configuration === conf),\n          children: [],\n        },\n      )\n    })\n\n  return hierarchy.children\n}\n\nexport default function stateTreeFactory(pluginManager: PluginManager) {\n  return types\n    .model('HierarchicalTrackSelectorWidget', {\n      id: ElementId,\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n      collapsed: types.map(types.boolean),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      selection: [] as AnyConfigurationModel[],\n    }))\n    .actions(self => ({\n      addToSelection(elt: AnyConfigurationModel[]) {\n        self.selection = [...self.selection, ...elt]\n      },\n      removeFromSelection(elt: AnyConfigurationModel[]) {\n        self.selection = self.selection.filter(f => !elt.includes(f))\n      },\n      clearSelection() {\n        self.selection = []\n      },\n      setView(view: unknown) {\n        self.view = view\n      },\n      toggleCategory(pathName: string) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      getRefSeqTrackConf(assemblyName: string) {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)\n        if (!trackConf) {\n          return undefined\n        }\n        for (const display of trackConf.displays) {\n          if (viewType.displayTypes.find(d => d.name === display.type)) {\n            return trackConf\n          }\n        }\n      },\n    }))\n    .views(self => ({\n      trackConfigurations(assemblyName: string) {\n        if (!self.view) {\n          return []\n        }\n        const { tracks, assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        if (!assembly) {\n          return []\n        }\n        const refseq = self.getRefSeqTrackConf(assemblyName)\n        // filter out tracks that don't match the current assembly (check all\n        // assembly aliases) and display types\n        return (refseq ? [refseq] : []).concat([\n          ...filterTracks(tracks, self, assemblyName),\n        ])\n      },\n\n      get assemblyNames(): string[] {\n        return self.view?.assemblyNames || []\n      },\n\n      connectionTrackConfigurations(\n        assemblyName: string,\n        connection: { tracks: AnyConfigurationModel[] },\n      ) {\n        if (!self.view) {\n          return []\n        }\n\n        // filter out tracks that don't match the current display types\n        return filterTracks(connection.tracks, self, assemblyName)\n      },\n    }))\n    .views(self => ({\n      hierarchy(assemblyName: string) {\n        const hier = generateHierarchy(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          self.trackConfigurations(assemblyName),\n          self.collapsed,\n        )\n\n        const session = getSession(self)\n        const { connectionInstances } = session\n\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const conns =\n          (assembly &&\n            connectionInstances\n              ?.filter(c =>\n                hasAnyOverlap(assembly.allAliases, getConf(c, 'assemblyNames')),\n              )\n              .map(c => ({\n                // @ts-ignore\n                id: getSnapshot(c).configuration,\n                name: getConf(c, 'name'),\n                children: this.connectionHierarchy(assemblyName, c),\n                state: {\n                  expanded: true,\n                },\n              }))) ||\n          []\n\n        return {\n          name: 'Root',\n          id: 'Root',\n          children: [\n            { name: 'Tracks', id: 'Tracks', children: hier },\n            ...conns,\n          ],\n        }\n      },\n\n      connectionHierarchy(\n        assemblyName: string,\n        connection: { tracks: AnyConfigurationModel[] },\n      ) {\n        return generateHierarchy(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          self.connectionTrackConfigurations(assemblyName, connection),\n          self.collapsed,\n        )\n      },\n    }))\n}\n\nexport type HierarchicalTrackSelectorStateModel = ReturnType<\n  typeof stateTreeFactory\n>\nexport type HierarchicalTrackSelectorModel =\n  Instance<HierarchicalTrackSelectorStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nconst configSchema = ConfigurationSchema('HierarchicalTrackSelectorWidget', {})\nexport default configSchema\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('PluginStoreModel', {\n      id: ElementId,\n      type: types.literal('PluginStoreWidget'),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n}\n\nexport type PluginStoreStateModel = ReturnType<typeof f>\nexport type PluginStoreModel = Instance<PluginStoreStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('PluginStoreWidget', {})\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config UCSCTrackHubConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst UCSCTrackHubConnection = ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    /**\n     * #slot\n     */\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/path/to/hub.txt',\n        locationType: 'UriLocation',\n      },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'optional list of genomes to import from this track hub, if empty all genomes will be imported',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n\nexport default UCSCTrackHubConnection\n","// These are the assemblies for which there is a sequence file located at\n// http://hgdownload.soe.ucsc.edu/goldenPath/${assemblyName}/bigZips/${assemblyName}.2bit\n// This list was generated by `getUcscAssemblies.js`\n\nexport default `ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9`.split(/\\r?\\n/)\n","import { objectHash } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport {\n  generateUnsupportedTrackConf,\n  generateUnknownTrackConf,\n} from '@jbrowse/core/util/tracks'\nimport ucscAssemblies from './ucscAssemblies'\n\nexport { ucscAssemblies }\n\nexport async function fetchHubFile(hubFileLocation) {\n  try {\n    const hubFileText = await openLocation(hubFileLocation).readFile('utf8')\n    const { HubFile } = await import('@gmod/ucsc-hub')\n    return new HubFile(hubFileText)\n  } catch (error) {\n    throw new Error(`Not a valid hub.txt file, got error: '${error}'`)\n  }\n}\n\nexport async function fetchGenomesFile(genomesFileLocation) {\n  const genomesFileText = await openLocation(genomesFileLocation).readFile(\n    'utf8',\n  )\n  const { GenomesFile } = await import('@gmod/ucsc-hub')\n  return new GenomesFile(genomesFileText)\n}\n\nexport async function fetchTrackDbFile(trackDbFileLocation) {\n  const text = await openLocation(trackDbFileLocation).readFile('utf8')\n  const { TrackDbFile } = await import('@gmod/ucsc-hub')\n  return new TrackDbFile(text)\n}\n\nexport function generateTracks(\n  trackDb,\n  trackDbFileLocation,\n  assemblyName,\n  sequenceAdapter,\n) {\n  const tracks = []\n\n  trackDb.forEach((track, trackName) => {\n    const trackKeys = Array.from(track.keys())\n    const parentTrackKeys = [\n      'superTrack',\n      'compositeTrack',\n      'container',\n      'view',\n    ]\n    if (trackKeys.some(key => parentTrackKeys.includes(key))) {\n      return\n    }\n    const parentTracks = []\n    let currentTrackName = trackName\n    do {\n      currentTrackName = trackDb.get(currentTrackName).get('parent')\n      if (currentTrackName) {\n        ;[currentTrackName] = currentTrackName.split(' ')\n        parentTracks.push(trackDb.get(currentTrackName))\n      }\n    } while (currentTrackName)\n    parentTracks.reverse()\n    const categories = parentTracks.map(parentTrack =>\n      parentTrack.get('shortLabel'),\n    )\n    const res = makeTrackConfig(\n      track,\n      categories,\n      trackDbFileLocation,\n      trackDb,\n      sequenceAdapter,\n    )\n    res.trackId = `ucsc-trackhub-${objectHash(res)}`\n    res.assemblyNames = [assemblyName]\n    tracks.push(res)\n  })\n\n  return tracks\n}\n\nfunction makeTrackConfig(\n  track,\n  categories,\n  trackDbFileLocation,\n  trackDb,\n  sequenceAdapter,\n) {\n  let trackType = track.get('type')\n  if (!trackType) {\n    trackType = trackDb.get(track.get('parent')).get('type')\n  }\n  let baseTrackType = trackType.split(' ')[0]\n  if (\n    baseTrackType === 'bam' &&\n    track.get('bigDataUrl').toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  let bigDataLocation\n  if (trackDbFileLocation.uri) {\n    bigDataLocation = {\n      uri: new URL(track.get('bigDataUrl'), trackDbFileLocation.uri).href,\n      locationType: 'UriLocation',\n    }\n  } else {\n    bigDataLocation = {\n      localPath: track.get('bigDataUrl'),\n      locationType: 'LocalPathLocation',\n    }\n  }\n  let bigDataIndexLocation\n\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.bai`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bed5FloatScore':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedGraph':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedRnaElements':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigBarChart':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigBed':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigGenePred':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigChain':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigInteract':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigMaf':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigPsl':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigWig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'coloredExon':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.crai`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.crai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          cramLocation: bigDataLocation,\n          craiLocation: bigDataIndexLocation,\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'narrowPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigNarrowPeak':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'peptideMapping':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'vcfTabix':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.tbi`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.tbi`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'VariantTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'VcfTabixAdapter',\n          vcfGzLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'wigMaf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'hic':\n      return {\n        type: 'HicTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'HicAdapter',\n          hicLocation: bigDataLocation,\n        },\n      }\n    case 'halSnake':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n\n    default:\n      return generateUnknownTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n  }\n}\n","import { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport {\n  fetchGenomesFile,\n  fetchHubFile,\n  fetchTrackDbFile,\n  generateTracks,\n} from './ucscTrackHub'\n\nexport default function UCSCTrackHubConnection(pluginManager) {\n  return types.compose(\n    'UCSCTrackHubConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('UCSCTrackHubConnection'),\n      })\n      .actions(self => ({\n        connect() {\n          const connectionName = getConf(self, 'name')\n          const hubFileLocation = getConf(self, 'hubTxtLocation')\n          const session = getSession(self)\n          fetchHubFile(hubFileLocation)\n            .then(hubFile => {\n              const genomesFileLocation = hubFileLocation.uri\n                ? {\n                    uri: new URL(\n                      hubFile.get('genomesFile'),\n                      hubFileLocation.uri,\n                    ).href,\n                    locationType: 'UriLocation',\n                  }\n                : {\n                    localPath: hubFile.get('genomesFile'),\n                    locationType: 'LocalPathLocation',\n                  }\n              return Promise.all([\n                hubFile,\n                fetchGenomesFile(genomesFileLocation),\n              ])\n            })\n            .then(([hubFile, genomesFile]) => {\n              const trackDbData = []\n              for (const [genomeName, genome] of genomesFile) {\n                const assemblyNames = getConf(self, 'assemblyNames')\n                if (\n                  assemblyNames.length > 0 &&\n                  !assemblyNames.includes(genomeName)\n                ) {\n                  break\n                }\n                const assemblyConf = session.assemblies.find(\n                  assembly => readConfObject(assembly, 'name') === genomeName,\n                )\n                if (!assemblyConf) {\n                  throw new Error(\n                    `Cannot find assembly for \"${genomeName}\" from the genomes file for connection \"${connectionName}\"`,\n                  )\n                }\n                const trackDbFileLocation = hubFileLocation.uri\n                  ? {\n                      uri: new URL(\n                        genome.get('trackDb'),\n                        new URL(\n                          hubFile.get('genomesFile'),\n                          hubFileLocation.uri,\n                        ),\n                      ).href,\n                      locationType: 'UriLocation',\n                    }\n                  : {\n                      localPath: genome.get('trackDb'),\n                      locationType: 'LocalPathLocation',\n                    }\n                trackDbData.push(\n                  Promise.all([\n                    trackDbFileLocation,\n                    fetchTrackDbFile(trackDbFileLocation),\n                    genomeName,\n                    assemblyConf,\n                  ]),\n                )\n              }\n              return Promise.all([...trackDbData])\n            })\n            .then(trackDbData => {\n              for (const [\n                trackDbFileLocation,\n                trackDbFile,\n                genomeName,\n                assemblyConf,\n              ] of trackDbData) {\n                const sequenceAdapter = readConfObject(assemblyConf, [\n                  'sequence',\n                  'adapter',\n                ])\n                const tracks = generateTracks(\n                  trackDbFile,\n                  trackDbFileLocation,\n                  genomeName,\n                  sequenceAdapter,\n                )\n                self.addTrackConfs(tracks)\n              }\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the UCSC Track Hub \"${self.name}\". Please make sure you have entered a valid hub.txt file. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Dotplot1DViewModel } from '../model'\n\nexport function locstr(\n  px: number,\n  view: Dotplot1DViewModel,\n  includeAsm = true,\n) {\n  const { assemblyName, refName, start, offset, oob } = view.pxToBp(px)\n  const coord = Math.floor(start + offset)\n  return oob\n    ? 'out of bounds'\n    : `${\n        includeAsm ? '{' + assemblyName + '}' : ''\n      }${refName}:${coord.toLocaleString('en-US')}`\n}\n\nexport function getBlockLabelKeysToHide(\n  blocks: BaseBlock[],\n  length: number,\n  viewOffsetPx: number,\n) {\n  const blockLabelKeysToHide: string[] = []\n  const sortedBlocks = blocks.slice(0).sort((a, b) => {\n    const alen = a.end - a.start\n    const blen = b.end - b.start\n    return blen - alen\n  })\n  const positions = new Array(Math.round(length))\n  sortedBlocks.forEach(({ key, offsetPx }) => {\n    const y = Math.round(length - offsetPx + viewOffsetPx)\n    const labelBounds = [Math.max(y - 12, 0), y]\n    if (y === 0 || positions.slice(...labelBounds).some(Boolean)) {\n      blockLabelKeysToHide.push(key)\n    } else {\n      positions.fill(true, ...labelBounds)\n    }\n  })\n  return blockLabelKeysToHide\n}\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  regions: BaseBlock[],\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const ticks = []\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  for (let i = 0; i < regions.length; i++) {\n    const region = regions[i]\n    const { start, end, refName } = region\n    let index = 0\n\n    const minBase = start\n    const maxBase = end\n    for (\n      let base = Math.ceil(minBase / iterPitch) * iterPitch;\n      base < maxBase;\n      base += iterPitch\n    ) {\n      if (emitMinor && base % gridPitch.majorPitch) {\n        ticks.push({ type: 'minor', base: base - 1, index, refName })\n        index += 1\n      } else if (\n        emitMajor &&\n        Math.abs(base - region.start) > gridPitch.minorPitch\n      ) {\n        ticks.push({ type: 'major', base: base - 1, index, refName })\n        index += 1\n      }\n    }\n  }\n  return ticks\n}\n","import {\n  addDisposer,\n  cast,\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\n\nimport { makeTicks } from './components/util'\nimport { observable, autorun, transaction } from 'mobx'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  minmax,\n  measureText,\n} from '@jbrowse/core/util'\nimport { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\ntype Coord = [number, number]\n\n// Used in the renderer\n// ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\n//\n//\n\nexport const Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n    },\n    actions: {\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n    },\n  }\n})\n\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).viewHeight\n    },\n  },\n}))\n\n/**\n * #stateModel DotplotView\n */\nexport default function stateModelFactory(pm: PluginManager) {\n  return types\n    .compose(\n      BaseViewModel,\n      types.model('DotplotView', {\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('DotplotView'),\n        /**\n         * #property\n         */\n        height: 600,\n        /**\n         * #property\n         */\n        borderSize: 20,\n        /**\n         * #property\n         */\n        tickSize: 5,\n        /**\n         * #property\n         */\n        vtextRotation: 0,\n        /**\n         * #property\n         */\n        htextRotation: -90,\n        /**\n         * #property\n         */\n        fontSize: 15,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        assemblyNames: types.array(types.string),\n        /**\n         * #property\n         */\n        drawCigar: true,\n        /**\n         * #property\n         */\n        hview: types.optional(DotplotHView, {}),\n        /**\n         * #property\n         */\n        vview: types.optional(DotplotVView, {}),\n        /**\n         * #property\n         */\n        cursorMode: 'crosshair',\n\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pm.pluggableMstType('track', 'stateModel') as BaseTrackStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used\n         * for read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(pm.pluggableConfigSchemaType('track')),\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      volatileError: undefined as unknown,\n      borderX: 100,\n      borderY: 100,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (!self.volatileWidth) {\n          throw new Error('width not initialized')\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        return assemblyNames.every(\n          n => assemblyManager.get(n)?.initialized ?? true,\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        return (\n          self.volatileWidth !== undefined &&\n          self.hview.displayedRegions.length > 0 &&\n          self.vview.displayedRegions.length > 0 &&\n          self.assembliesInitialized\n        )\n      },\n      /**\n       * #getter\n       */\n      get hticks() {\n        const { hview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = hview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get vticks() {\n        const { vview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = vview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n      /**\n       * #getter\n       */\n      get loading() {\n        return self.assemblyNames.length > 0 && !this.initialized\n      },\n      /**\n       * #getter\n       */\n      get viewWidth() {\n        return self.width - self.borderX\n      },\n      /**\n       * #getter\n       */\n      get viewHeight() {\n        return self.height - self.borderY\n      },\n      /**\n       * #getter\n       */\n      get views() {\n        return [self.hview, self.vview]\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          drawCigar: self.drawCigar,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCursorMode(str: string) {\n        self.cursorMode = str\n      },\n      /**\n       * #action\n       */\n      setDrawCigar(flag: boolean) {\n        self.drawCigar = flag\n      },\n      /**\n       * #action\n       * returns to the import form\n       */\n      clearView() {\n        self.hview.setDisplayedRegions([])\n        self.vview.setDisplayedRegions([])\n        self.assemblyNames = cast([])\n        self.tracks.clear()\n      },\n      /**\n       * #action\n       */\n      setBorderX(n: number) {\n        self.borderX = n\n      },\n      /**\n       * #action\n       */\n      setBorderY(n: number) {\n        self.borderY = n\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n        return self.volatileWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = newHeight\n        return self.height\n      },\n\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        self.volatileError = e\n      },\n\n      /**\n       * #action\n       * removes the view itself from the state tree entirely by calling the parent removeView\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      zoomOutButton() {\n        self.hview.zoomOut()\n        self.vview.zoomOut()\n      },\n      /**\n       * #action\n       */\n      zoomInButton() {\n        self.hview.zoomIn()\n        self.vview.zoomIn()\n      },\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const session: any = getSession(self)\n          const selector = session.addWidget(\n            'HierarchicalTrackSelectorWidget',\n            'hierarchicalTrackSelector',\n            { view: self },\n          )\n          session.showWidget(selector)\n          return selector\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const trackType = pm.getTrackType(conf.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${conf.type}`)\n        }\n        const viewType = pm.getViewType(self.type)\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          viewType.displayTypes.find(type => type.name === d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: conf.type,\n          configuration: conf,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pm.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const t = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => t.forEach(t => self.tracks.remove(t)))\n        return t.length\n      },\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n      /**\n       * #action\n       */\n      setAssemblyNames(target: string, query: string) {\n        self.assemblyNames = cast([target, query])\n      },\n      /**\n       * #action\n       */\n      setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n        self.hview = cast(arr[0])\n        self.vview = cast(arr[1])\n      },\n\n      /**\n       * #action\n       */\n      getCoords(mousedown: Coord, mouseup: Coord) {\n        const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n        const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n        return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n          ? [\n              self.hview.pxToBp(xmin),\n              self.hview.pxToBp(xmax),\n              self.vview.pxToBp(self.viewHeight - ymin),\n              self.vview.pxToBp(self.viewHeight - ymax),\n            ]\n          : undefined\n      },\n\n      /**\n       * #action\n       * zooms into clicked and dragged region\n       */\n      zoomIn(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          self.hview.moveTo(x1, x2)\n          self.vview.moveTo(y2, y1)\n        }\n      },\n      /**\n       * #action\n       * creates a linear synteny view from the clicked and dragged region\n       */\n      onDotplotView(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          const session = getSession(self)\n\n          const d1 = Dotplot1DView.create({\n            ...getSnapshot(self.hview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          const d2 = Dotplot1DView.create({\n            ...getSnapshot(self.vview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          d1.setVolatileWidth(self.hview.width)\n          d2.setVolatileWidth(self.vview.width)\n          d1.moveTo(x1, x2)\n          d2.moveTo(y2, y1)\n          d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n          d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n          // add the specific evidence tracks to the LGVs in the split view\n          // note: scales the bpPerPx by scaling proportional of the dotplot\n          // width to the eventual lgv width\n          const tracks = self.tracks\n            .map(track =>\n              track.configuration.displays.find(\n                (display: { type: string }) =>\n                  display.type === 'LinearSyntenyDisplay',\n              ),\n            )\n            .filter(f => !!f)\n            .map(displayConf => {\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              const trackConf = getParent<any>(displayConf, 2)\n              return {\n                type: trackConf.type,\n                configuration: trackConf,\n                displays: [\n                  { type: displayConf.type, configuration: displayConf },\n                ],\n              }\n            })\n\n          const { id: _unused1, ...rest1 } = getSnapshot(d1)\n          const { id: _unused2, ...rest2 } = getSnapshot(d2)\n          const viewSnapshot = {\n            type: 'LinearSyntenyView',\n            views: [\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest1,\n              },\n              {\n                type: 'LinearGenomeView',\n                tracks: [],\n                hideHeader: true,\n                ...rest2,\n              },\n            ],\n            tracks,\n          }\n\n          session.addView('LinearSyntenyView', viewSnapshot)\n        }\n      },\n    }))\n    .actions(self => ({\n      // if any of our assemblies are temporary assemblies\n      beforeDestroy() {\n        const session = getSession(self)\n        self.assemblyNames.forEach(asm => {\n          session.removeTemporaryAssembly(asm)\n        })\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function initializer() {\n              const session = getSession(self)\n              if (self.volatileWidth === undefined) {\n                return\n              }\n\n              if (self.initialized) {\n                return\n              }\n              const axis = [self.viewWidth, self.viewHeight]\n              const views = [self.hview, self.vview]\n              self.assemblyNames.forEach((name, index) => {\n                const assembly = session.assemblyManager.get(name)\n                if (assembly) {\n                  if (assembly.error) {\n                    self.setError(assembly.error)\n                  }\n                  const { regions } = assembly\n                  if (regions && regions.length) {\n                    const regionsSnapshot = regions\n                    if (regionsSnapshot) {\n                      transaction(() => {\n                        const view = views[index]\n                        view.setDisplayedRegions(regionsSnapshot)\n                        view.setBpPerPx(view.totalBp / axis[index])\n                      })\n                    }\n                  }\n                }\n              })\n            },\n            { delay: 1000 },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(function borderSetter() {\n            // make sure we have a width on the view before trying to load\n            const { vview, hview } = self\n            if (self.volatileWidth === undefined) {\n              return\n            }\n            const padding = 10\n            const vblocks = vview.dynamicBlocks.contentBlocks\n            const hblocks = hview.dynamicBlocks.contentBlocks\n            const len = (a: string) => measureText(a.slice(0, 30))\n            const by = hblocks.reduce((a, b) => Math.max(a, len(b.refName)), 0)\n            const bx = vblocks.reduce((a, b) => Math.max(a, len(b.refName)), 0)\n            // these are set via autorun to avoid dependency cycle\n            self.setBorderY(Math.max(by + padding, 100))\n            self.setBorderX(Math.max(bx + padding, 100))\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const { hview, vview } = self\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n      /**\n       * #action\n       */\n      squareViewProportional() {\n        const { hview, vview } = self\n        const ratio = hview.width / vview.width\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg / ratio)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        const session = getSession(self)\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Square view - same bp per pixel',\n            onClick: () => self.squareView(),\n          },\n          {\n            label: 'Rectangular view - same total bp',\n            onClick: () => self.squareView(),\n          },\n          ...(isSessionModelWithWidgets(session)\n            ? [\n                {\n                  label: 'Open track selector',\n                  onClick: self.activateTrackSelector,\n                  icon: TrackSelectorIcon,\n                },\n              ]\n            : []),\n        ]\n      },\n      /**\n       * #getter\n       */\n      get error() {\n        return self.volatileError || self.assemblyErrors\n      },\n    }))\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { Typography } from '@mui/material'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    textAlign: 'center',\n  },\n\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const { classes } = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  return shown ? (\n    <div className={classes.loading}>\n      <LoadingEllipses />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockMessage}>\n      <Typography>{messageText}</Typography>\n    </div>\n  )\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.blockError}>\n      <Typography>{error.message}</Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ model, style }: { model: any; style: any }) => {\n    if (model.error) {\n      return <BlockError error={model.error} data-testid=\"reload_button\" />\n    }\n    if (model.message) {\n      return <BlockMessage messageText={model.message} />\n    }\n    if (!model.filled) {\n      return <LoadingMessage />\n    }\n    return <div style={style}>{model.reactElement}</div>\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","import clone from 'clone'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSnapshot, IAnyStateTreeNode } from 'mobx-state-tree'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\n\nimport { DotplotViewModel } from '../DotplotView/model'\n\nexport function renderBlockData(self: IAnyStateTreeNode) {\n  const { rpcManager } = getSession(self)\n  const { rendererType } = self\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n  getSnapshot(parent)\n\n  if (parent.initialized) {\n    const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: {\n        ...self.renderProps(),\n        view: clone(getSnapshot(parent)),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000, // 10000,\n      },\n    }\n  }\n  return undefined\n}\n\nexport async function renderBlockEffect(\n  props?: ReturnType<typeof renderBlockData>,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n  return {\n    reactElement,\n    data,\n    renderingComponent: rendererType.ReactComponent,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { makeAbortableReaction } from '@jbrowse/core/util'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\n\n// locals\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { renderBlockData, renderBlockEffect } from './renderDotplotBlock'\n\n/**\n * #stateModel DotplotDisplay\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          /**\n           * #property\n           */\n          type: types.literal('DotplotDisplay'),\n          /**\n           * #property\n           */\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          warnings: [] as { message: string; effect: string }[],\n          renderInProgress: undefined as AbortController | undefined,\n          filled: false,\n          data: undefined as any,\n          reactElement: undefined as React.ReactElement | undefined,\n          message: undefined as string | undefined,\n          renderingComponent: undefined as any,\n          ReactComponent2:\n            ServerSideRenderedBlockContent as unknown as React.FC<any>,\n        })),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.configuration.renderer,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            () => renderBlockData(self as any),\n            (blockData): any =>\n              blockData ? renderBlockEffect(blockData) : undefined,\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n        /**\n         * #action\n         */\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        /**\n         * #action\n         */\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        /**\n         * #action\n         */\n        setRendered(args?: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          if (args === undefined) {\n            return\n          }\n          const { data, reactElement, renderingComponent } = args\n          self.warnings = data.warnings\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        /**\n         * #action\n         */\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { DotplotDisplayModel } from '../stateModelFactory'\nimport { DotplotViewModel } from '../../DotplotView/model'\n\nfunction DotplotDisplay(props: {\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}) {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  const view = getContainingView(model) as DotplotViewModel\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <model.ReactComponent2\n        {...props}\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(DotplotDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport { stateModelFactory } from './stateModelFactory'\nimport ReactComponent from './components/DotplotDisplay'\n\nexport default (pm: PluginManager) => {\n  pm.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pm)\n    return new DisplayType({\n      name: 'DotplotDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'DotplotView',\n      ReactComponent,\n    })\n  })\n}\n\n/**\n * #config DotplotDisplay\n */\nexport function configSchemaFactory(pm: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(pm.pluggableConfigSchemaType('renderer'), {\n        type: 'DotplotRenderer',\n      }),\n    },\n    {\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'displayId',\n      explicitlyTyped: true,\n    },\n  )\n}\n","import React from 'react'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { DotplotRenderArgsDeserialized } from '../DotplotRenderer'\n\nfunction DotplotRendering(props: DotplotRenderArgsDeserialized) {\n  return <PrerenderedCanvas {...props} />\n}\n\nexport default observer(DotplotRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config DotplotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description:\n        'the color of each feature in a synteny, used with colorBy:default',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color for forward alignments, used with colorBy:strand',\n      defaultValue: 'blue',\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color for reverse alignments, used with colorBy:strand',\n      defaultValue: 'red',\n    },\n\n    /**\n     * #slot\n     */\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 2.5, // 2.5 is similar to D-GENIES\n    },\n\n    /**\n     * #slot\n     */\n    colorBy: {\n      type: 'stringEnum',\n      model: types.enumeration('colorBy', [\n        'identity',\n        'meanQueryIdentity',\n        'mappingQuality',\n        'strand',\n        'default',\n      ]),\n      description: `Color by options:<br/>\n<ul>\n  <li>\"identity\" - the identity of the particular hit, similar to D-GENIES, use the other config slots 'thresholds' and 'thresholdsPalette' to define colors for this setting</li>\n  <li>\"meanQueryIdentity\" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>\"mappingQuality\" - uses mapping quality from PAF, some adapters don't have this setting</li>\n  <li>\"strand\" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>\"default\" - uses the 'color' config slot</li>\n</ul>`,\n      defaultValue: 'default',\n    },\n\n    /**\n     * #slot\n     */\n    thresholdsPalette: {\n      type: 'stringArray',\n      defaultValue: ['#094b09', '#2ebd40', '#d5670b', '#ffd84b'],\n      description: 'threshold colors, used with colorBy:identity',\n    },\n\n    /**\n     * #slot\n     */\n    thresholds: {\n      type: 'stringArray',\n      defaultValue: ['0.75', '0.5', '0.25', '0'],\n      description: 'threshold breakpoints, used with colorBy:identity',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  renameRegionsIfNeeded,\n  renderToAbstractCanvas,\n  Region,\n  Feature,\n} from '@jbrowse/core/util'\nimport { bpToPx } from '@jbrowse/core/util/Base1DUtils'\nimport { getSnapshot } from 'mobx-state-tree'\nimport ComparativeRenderer, {\n  RenderArgsDeserialized,\n  RenderArgs,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\n\n// locals\nimport { Dotplot1DView, Dotplot1DViewModel } from '../DotplotView/model'\n\nconst { parseCigar } = MismatchParser\n\nexport interface DotplotRenderArgsDeserialized extends RenderArgsDeserialized {\n  height: number\n  width: number\n  highResolutionScaling: number\n  view: {\n    hview: Dotplot1DViewModel\n    vview: Dotplot1DViewModel\n  }\n}\n\ninterface DotplotRenderArgs extends RenderArgs {\n  adapterConfig: AnyConfigurationModel\n  sessionId: string\n  view: {\n    hview: { displayedRegions: Region[] }\n    vview: { displayedRegions: Region[] }\n  }\n}\n\nconst r = 'fell outside of range due to CIGAR string'\nconst lt = '(less than min coordinate of feature)'\nconst gt = '(greater than max coordinate of feature)'\nconst fudgeFactor = 1 // allow 1px fuzzyness before warn\n\nfunction drawCir(ctx: CanvasRenderingContext2D, x: number, y: number, r = 1) {\n  ctx.beginPath()\n  ctx.arc(x, y, r / 2, 0, 2 * Math.PI)\n  ctx.fill()\n}\nexport default class DotplotRenderer extends ComparativeRenderer {\n  async renameRegionsIfNeeded(args: DotplotRenderArgs) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n\n    const { view, sessionId, adapterConfig } = args\n\n    async function process(regions?: Region[]) {\n      if (!assemblyManager) {\n        throw new Error('No assembly manager provided')\n      }\n      const result = await renameRegionsIfNeeded(assemblyManager, {\n        sessionId,\n        adapterConfig,\n        regions,\n      })\n      return result.regions\n    }\n\n    view.hview.displayedRegions = await process(view.hview.displayedRegions)\n    view.vview.displayedRegions = await process(view.vview.displayedRegions)\n\n    return args\n  }\n\n  async drawDotplot(\n    ctx: CanvasRenderingContext2D,\n    props: DotplotRenderArgsDeserialized & { views: Dotplot1DViewModel[] },\n  ) {\n    const { config, views, height, drawCigar } = props\n    const color = readConfObject(config, 'color')\n    const posColor = readConfObject(config, 'posColor')\n    const negColor = readConfObject(config, 'negColor')\n    const colorBy = readConfObject(config, 'colorBy')\n    const lineWidth = readConfObject(config, 'lineWidth')\n    const thresholds = readConfObject(config, 'thresholds')\n    const palette = readConfObject(config, 'thresholdsPalette')\n    const isCallback = config.color.isCallback\n    const [hview, vview] = views\n    const db1 = hview.dynamicBlocks.contentBlocks[0]?.offsetPx\n    const db2 = vview.dynamicBlocks.contentBlocks[0]?.offsetPx\n    const warnings = [] as { message: string; effect: string }[]\n    ctx.lineWidth = lineWidth\n\n    // we operate on snapshots of these attributes of the hview/vview because\n    // it is significantly faster than accessing the mobx objects\n    const { bpPerPx: hBpPerPx } = hview\n    const { bpPerPx: vBpPerPx } = vview\n\n    function clampWithWarnX(\n      num: number,\n      min: number,\n      max: number,\n      feature: Feature,\n    ) {\n      const strand = feature.get('strand') || 1\n      if (strand === -1) {\n        ;[max, min] = [min, max]\n      }\n      if (num < min - fudgeFactor) {\n        let start = feature.get('start')\n        let end = feature.get('end')\n        const refName = feature.get('refName')\n        if (strand === -1) {\n          ;[end, start] = [start, end]\n        }\n\n        warnings.push({\n          message: `feature at (X ${refName}:${start}-${end}) ${r} ${lt}`,\n          effect: 'clipped the feature',\n        })\n        return min\n      }\n      if (num > max + fudgeFactor) {\n        const strand = feature.get('strand') || 1\n        const start = strand === 1 ? feature.get('start') : feature.get('end')\n        const end = strand === 1 ? feature.get('end') : feature.get('start')\n        const refName = feature.get('refName')\n\n        warnings.push({\n          message: `feature at (X ${refName}:${start}-${end}) ${r} ${gt}`,\n          effect: 'clipped the feature',\n        })\n        return max\n      }\n      return num\n    }\n\n    function clampWithWarnY(\n      num: number,\n      min: number,\n      max: number,\n      feature: Feature,\n    ) {\n      if (num < min - fudgeFactor) {\n        const mate = feature.get('mate')\n        const { refName, start, end } = mate\n        warnings.push({\n          message: `feature at (Y ${refName}:${start}-${end}) ${r} ${lt}`,\n          effect: 'clipped the feature',\n        })\n        return min\n      }\n      if (num > max + fudgeFactor) {\n        const mate = feature.get('mate')\n        const { refName, start, end } = mate\n\n        warnings.push({\n          message: `feature at (Y ${refName}:${start}-${end}) ${r} ${gt}`,\n          effect: 'clipped the feature',\n        })\n        return max\n      }\n      return num\n    }\n\n    const hsnap = {\n      ...getSnapshot(hview),\n      staticBlocks: hview.staticBlocks,\n      width: hview.width,\n    }\n    const vsnap = {\n      ...getSnapshot(vview),\n      staticBlocks: vview.staticBlocks,\n      width: vview.width,\n    }\n    hview.features?.forEach(feature => {\n      const strand = feature.get('strand') || 1\n      const start = strand === 1 ? feature.get('start') : feature.get('end')\n      const end = strand === 1 ? feature.get('end') : feature.get('start')\n      const refName = feature.get('refName')\n      const mate = feature.get('mate')\n      const mateRef = mate.refName\n\n      let r\n      if (colorBy === 'identity') {\n        const identity = feature.get('identity')\n        for (let i = 0; i < thresholds.length; i++) {\n          if (identity > +thresholds[i]) {\n            r = palette[i]\n            break\n          }\n        }\n      } else if (colorBy === 'meanQueryIdentity') {\n        r = `hsl(${feature.get('meanScore') * 200},100%,40%)`\n      } else if (colorBy === 'mappingQuality') {\n        r = `hsl(${feature.get('mappingQual')},100%,40%)`\n      } else if (colorBy === 'strand') {\n        r = strand === -1 ? negColor : posColor\n      } else if (colorBy === 'default') {\n        r = isCallback ? readConfObject(config, 'color', { feature }) : color\n      }\n      ctx.fillStyle = r\n      ctx.strokeStyle = r\n\n      const b10 = bpToPx({ self: hsnap, refName, coord: start })\n      const b20 = bpToPx({ self: hsnap, refName, coord: end })\n      const e10 = bpToPx({ self: vsnap, refName: mateRef, coord: mate.start })\n      const e20 = bpToPx({ self: vsnap, refName: mateRef, coord: mate.end })\n      if (\n        b10 !== undefined &&\n        b20 !== undefined &&\n        e10 !== undefined &&\n        e20 !== undefined\n      ) {\n        const b1 = b10.offsetPx - db1\n        const b2 = b20.offsetPx - db1\n        const e1 = e10.offsetPx - db2\n        const e2 = e20.offsetPx - db2\n        if (Math.abs(b1 - b2) <= 4 && Math.abs(e1 - e2) <= 4) {\n          drawCir(ctx, b1, height - e1, lineWidth)\n        } else {\n          let currX = b1\n          let currY = e1\n          const cigar = feature.get('cg') || feature.get('CIGAR')\n          const flipInsDel = feature.get('flipInsDel')\n\n          if (drawCigar && cigar) {\n            const cigarOps = parseCigar(cigar)\n\n            ctx.beginPath()\n            ctx.moveTo(currX, height - currY)\n\n            for (let i = 0; i < cigarOps.length; i += 2) {\n              const val = +cigarOps[i]\n              const op = cigarOps[i + 1]\n              if (op === 'M' || op === '=' || op === 'X') {\n                currX += (val / hBpPerPx) * strand\n                currY += val / vBpPerPx\n              } else if (op === 'D' || op === 'N') {\n                if (flipInsDel) {\n                  currY += val / vBpPerPx\n                } else {\n                  currX += (val / hBpPerPx) * strand\n                }\n              } else if (op === 'I') {\n                if (flipInsDel) {\n                  currX += (val / hBpPerPx) * strand\n                } else {\n                  currY += val / vBpPerPx\n                }\n              }\n              currX = clampWithWarnX(currX, b1, b2, feature)\n              currY = clampWithWarnY(currY, e1, e2, feature)\n              ctx.lineTo(currX, height - currY)\n            }\n\n            ctx.stroke()\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(b1, height - e1)\n            ctx.lineTo(b2, height - e2)\n            ctx.stroke()\n          }\n        }\n      } else {\n        if (warnings.length <= 5) {\n          if (b10 === undefined || b20 === undefined) {\n            warnings.push({\n              message: `feature at (X ${refName}:${start}-${end}) not plotted, fell outside of range`,\n              effect: 'feature not rendered',\n            })\n          } else {\n            warnings.push({\n              message: `feature at (Y ${mateRef}:${mate.start}-${mate.end}) not plotted, fell outside of range`,\n              effect: 'feature not rendered',\n            })\n          }\n        }\n      }\n    })\n\n    return { warnings }\n  }\n\n  async render(renderProps: DotplotRenderArgsDeserialized) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const views = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx])\n      return view\n    })\n    const target = views[0]\n    const feats = await this.getFeatures({\n      ...renderProps,\n      regions: target.dynamicBlocks.contentBlocks,\n    })\n    target.setFeatures(feats)\n\n    const ret = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      this.drawDotplot(ctx, { ...renderProps, views }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...ret,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...ret,\n      height,\n      width,\n      offsetX: views[0].dynamicBlocks.blocks[0].offsetPx,\n      offsetY: views[1].dynamicBlocks.blocks[0].offsetPx,\n    }\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { DotplotViewModel } from './DotplotView/model'\nimport { transaction } from 'mobx'\n\nexport default function LaunchDotplotView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-DotplotView',\n    // @ts-ignore\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const model = session.addView('DotplotView', {}) as DotplotViewModel\n        const assemblyNames = views.map(view => view.assembly)\n\n        transaction(() => {\n          model.setViews([\n            { bpPerPx: 0.1, offsetPx: 0 },\n            { bpPerPx: 0.1, offsetPx: 0 },\n          ])\n          model.setAssemblyNames(assemblyNames[0], assemblyNames[1])\n        })\n\n        // http://localhost:3000/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{\"views\":[{\"type\":\"DotplotView\",\"views\":[{\"assembly\":\"volvox\"},{\"assembly\":\"volvox\"}],\"tracks\":[\"volvox_fake_synteny\"]}]}\n\n        const idsNotFound = [] as string[]\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notify(`${e}`, 'error')\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { checkAbortSignal } from '@jbrowse/core/util'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport ComparativeRenderer, {\n  RenderArgs as ComparativeRenderArgs,\n  RenderArgsSerialized as ComparativeRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\n\ninterface RenderArgs extends ComparativeRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\ninterface RenderArgsSerialized extends ComparativeRenderArgsSerialized {\n  adapterConfig: {}\n  rendererType: string\n}\n\n/**\n * call a synteny renderer with the given args\n * param views: a set of views that each contain a set of regions\n * used instead of passing regions directly as in render()\n */\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async renameRegionsIfNeeeded(args: RenderArgs, rend: ComparativeRenderer) {\n    return rend.renameRegionsIfNeeded(args)\n  }\n\n  getRenderer(rendererType: string) {\n    const pm = this.pluginManager\n    return pm.getRendererType(rendererType) as ComparativeRenderer\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriver: string) {\n    const { rendererType } = args\n    const renderer = this.getRenderer(rendererType)\n    const n = (await super.serializeArguments(args, rpcDriver)) as RenderArgs\n    const result = await this.renameRegionsIfNeeeded(n, renderer)\n\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? result\n      : renderer.serializeArgsInClient(result)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriver: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriver !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(args, rpcDriver)\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const renderer = this.getRenderer(rendererType)\n    return rpcDriver === 'MainThreadRpcDriver'\n      ? renderer.render(deserializedArgs)\n      : renderer.renderInWorker(deserializedArgs)\n  }\n\n  async deserializeReturn(\n    val: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriver: string,\n  ): Promise<unknown> {\n    const ret = (await super.deserializeReturn(\n      val,\n      args,\n      rpcDriver,\n    )) as ResultsSerialized\n    if (rpcDriver === 'MainThreadRpcDriver') {\n      return ret\n    }\n\n    const renderer = this.getRenderer(args.rendererType)\n    return renderer.deserializeResultsInClient(ret, args)\n  }\n}\n","import { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nconst { parseCigar } = MismatchParser\n\nexport function getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nexport function getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\nexport function getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\ninterface Interval {\n  start: number\n  end: number\n}\n\n// source https://gist.github.com/vrachieru/5649bce26004d8a4682b\nexport function mergeIntervals<T extends Interval>(intervals: T[], w = 5000) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = []\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0])\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n    top = stack[stack.length - 1]\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i].start - w) {\n      stack.push(intervals[i])\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i].end) {\n      top.end = Math.max(top.end, intervals[i].end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n\nexport interface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\nexport function gatherOverlaps(regions: BasicFeature[]) {\n  const groups = regions.reduce((memo, x) => {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName].push(x)\n    return memo\n  }, {} as { [key: string]: BasicFeature[] })\n\n  return Object.values(groups)\n    .map(group => mergeIntervals(group.sort((a, b) => a.start - b.start)))\n    .flat()\n}\n\nexport interface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  seqLength: number\n}\n","import {\n  getClip,\n  getTag,\n  getLengthOnRef,\n  getLength,\n  getLengthSansClipping,\n  gatherOverlaps,\n  ReducedFeature,\n} from '../util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\nexport function onClick(feature: Feature, self: LinearPileupDisplayModel) {\n  const session = getSession(self)\n  try {\n    const cigar = feature.get('CIGAR')\n    const clipPos = getClip(cigar, 1)\n    const flags = feature.get('flags')\n    const origStrand = feature.get('strand')\n    const readName = feature.get('name')\n    const readAssembly = `${readName}_assembly_${Date.now()}`\n    const { parentTrack } = self\n    const [trackAssembly] = getConf(parentTrack, 'assemblyNames')\n    const assemblyNames = [trackAssembly, readAssembly]\n    const trackId = `track-${Date.now()}`\n    const trackName = `${readName}_vs_${trackAssembly}`\n    const SA: string = getTag(feature, 'SA') || ''\n    const SAs = SA.split(';')\n      .filter(aln => !!aln)\n      .map((aln, index) => {\n        const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n        const saLengthOnRef = getLengthOnRef(saCigar)\n        const saLength = getLength(saCigar)\n        const saLengthSansClipping = getLengthSansClipping(saCigar)\n        const saStrandNormalized = saStrand === '-' ? -1 : 1\n        const saClipPos = getClip(saCigar, saStrandNormalized * origStrand)\n        const saRealStart = +saStart - 1\n        return {\n          refName: saRef,\n          start: saRealStart,\n          end: saRealStart + saLengthOnRef,\n          seqLength: saLength,\n          clipPos: saClipPos,\n          CIGAR: saCigar,\n          assemblyName: trackAssembly,\n          strand: origStrand * saStrandNormalized,\n          uniqueId: `${feature.id()}_SA${index}`,\n          mate: {\n            start: saClipPos,\n            end: saClipPos + saLengthSansClipping,\n            refName: readName,\n          },\n        }\n      })\n\n    const feat = feature.toJSON()\n    feat.strand = 1\n    feat.mate = {\n      refName: readName,\n      start: clipPos,\n      end: clipPos + getLengthSansClipping(cigar),\n    }\n\n    // if secondary alignment or supplementary, calculate length from SA[0]'s\n    // CIGAR which is the primary alignments. otherwise it is the primary\n    // alignment just use seq.length if primary alignment\n    const totalLength = getLength(flags & 2048 ? SAs[0].CIGAR : cigar)\n\n    const features = [feat, ...SAs] as ReducedFeature[]\n\n    features.sort((a, b) => a.clipPos - b.clipPos)\n\n    const refLength = features.reduce((a, f) => a + f.end - f.start, 0)\n\n    session.addView('DotplotView', {\n      type: 'DotplotView',\n      hview: {\n        offsetPx: 0,\n        bpPerPx: refLength / 800,\n        displayedRegions: gatherOverlaps(\n          features.map((f, index) => {\n            const { start, end, refName } = f\n            return {\n              start,\n              end,\n              refName,\n              index,\n              assemblyName: trackAssembly,\n            }\n          }),\n        ),\n      },\n      vview: {\n        offsetPx: 0,\n        bpPerPx: totalLength / 400,\n        minimumBlockWidth: 0,\n        interRegionPaddingWidth: 0,\n        displayedRegions: [\n          {\n            assemblyName: readAssembly,\n            start: 0,\n            end: totalLength,\n            refName: readName,\n          },\n        ],\n      },\n\n      viewTrackConfigs: [\n        {\n          type: 'SyntenyTrack',\n          assemblyNames,\n          adapter: {\n            type: 'FromConfigAdapter',\n            features,\n          },\n          trackId,\n          name: trackName,\n        },\n      ],\n      assemblyNames,\n      tracks: [\n        {\n          configuration: trackId,\n          type: 'SyntenyTrack',\n          displays: [\n            {\n              type: 'DotplotDisplay',\n              configuration: `${trackId}-DotplotDisplay`,\n            },\n          ],\n        },\n      ],\n\n      displayName: `${readName} vs ${trackAssembly}`,\n    })\n  } catch (e) {\n    console.error(e)\n    session.notify(`${e}`, 'error')\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\n// icons\nimport TimelineIcon from '@mui/icons-material/Timeline'\n\n// locals\nimport DotplotViewF from './DotplotView'\nimport DotplotDisplayF from './DotplotDisplay'\nimport DotplotRendererF from './DotplotRenderer'\nimport LaunchDotplotViewF from './LaunchDotplotView'\nimport ComparativeRenderer from './ComparativeRenderer'\nimport DotplotReadVsRefMenuItem from './DotplotReadVsRef'\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    DotplotViewF(pluginManager)\n    DotplotDisplayF(pluginManager)\n    DotplotRendererF(pluginManager)\n    LaunchDotplotViewF(pluginManager)\n    DotplotReadVsRefMenuItem(pluginManager)\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRenderer(pluginManager))\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n  }\n}\n","import { lazy } from 'react'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport stateModelFactory from './model'\n\nexport default function (pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'DotplotView',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/DotplotView')),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from './components/DotplotRendering'\nimport configSchema from './configSchema'\nimport DotplotRenderer from './DotplotRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new DotplotRenderer({\n        name: 'DotplotRenderer',\n        configSchema: configSchema,\n        ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\nimport { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\n\n// local\nimport { onClick } from './DotplotReadVsRef'\n\nexport default function DotplotReadVsRefMenuItem(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (pluggableElement.name === 'LinearPileupDisplay') {\n        const { stateModel } = pluggableElement as ViewType\n        const newStateModel = stateModel.extend(\n          (self: LinearPileupDisplayModel) => {\n            const superContextMenuItems = self.contextMenuItems\n            return {\n              views: {\n                contextMenuItems() {\n                  const feature = self.contextMenuFeature\n                  if (!feature) {\n                    return superContextMenuItems()\n                  }\n                  const newMenuItems = [\n                    ...superContextMenuItems(),\n                    {\n                      label: 'Dotplot of read vs ref',\n                      icon: AddIcon,\n                      onClick: () => onClick(feature, self),\n                    },\n                  ]\n\n                  return newMenuItems\n                },\n              },\n            }\n          },\n        )\n\n        ;(pluggableElement as ViewType).stateModel = newStateModel\n      }\n      return pluggableElement\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config GCContentAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GCContentAdapterF = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'GCContentAdapter',\n    {\n      /**\n       * #slot\n       */\n      sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n    },\n    { explicitlyTyped: true },\n  )\n}\n\nexport default GCContentAdapterF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport configSchemaFactory from './config'\nimport stateModelFactory from './stateModel'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    const stateModel = stateModelFactory(pluginManager, configSchema)\n    return {\n      name: 'LinearGCContentDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    }\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearGCContentDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const baseConfiguration = pluginManager.getDisplayType(\n    'LinearWiggleDisplay',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearGCContentDisplay',\n    {},\n    { baseConfiguration, explicitlyTyped: true },\n  )\n}\n","import {\n  getConf,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport default function stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  const WigglePlugin = pluginManager.getPlugin(\n    'WigglePlugin',\n  ) as import('@jbrowse/plugin-wiggle').default\n  const { linearWiggleDisplayModelFactory } = WigglePlugin.exports\n  return types\n    .compose(\n      'LinearGCContentDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        type: types.literal('LinearGCContentDisplay'),\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          const sequenceAdapter = getConf(self.parentTrack, 'adapter')\n          return {\n            ...superRenderProps(),\n            adapterConfig: {\n              type: 'GCContentAdapter',\n              sequenceAdapter,\n            },\n          }\n        },\n      }\n    })\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport GCContentAdapterF from './GCContentAdapter'\nimport LinearGCContentDisplayF from './LinearGCContentDisplay'\n\nexport default class GCContentPlugin extends Plugin {\n  name = 'GCContentPlugin'\n\n  install(pluginManager: PluginManager) {\n    GCContentAdapterF(pluginManager)\n    LinearGCContentDisplayF(pluginManager)\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'GCContentAdapter',\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        configSchema: configSchemaF(pluginManager),\n        getAdapterClass: () =>\n          import('./GCContentAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config Gff3TabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3TabixAdapter = ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff.gz', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.indexType\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.gff.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    /**\n     * #slot\n     * the Gff3TabixAdapter has to \"redispatch\" if it fetches a region and\n     * features it finds inside that region extend outside the region we requested.\n     * you can disable this for certain feature types to avoid fetching e.g. the\n     * entire chromosome\n     */\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default Gff3TabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config Gff3Adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst Gff3Adapter = ConfigurationSchema(\n  'Gff3Adapter',\n  {\n    /**\n     * #slot\n     */\n    gffLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default Gff3Adapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gff3TabixAdapterConfigSchema } from './Gff3TabixAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n  getFileName,\n} from '@jbrowse/core/util/tracks'\nimport { configSchema as gff3AdapterConfigSchema } from './Gff3Adapter'\n\nexport default class extends Plugin {\n  name = 'GFF3Plugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3TabixAdapter',\n          configSchema: gff3TabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./Gff3TabixAdapter/Gff3TabixAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gff3?\\.b?gz$/i\n          const adapterName = 'Gff3TabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bamLocation: file,\n              gffGzLocation: file,\n              index: {\n                location: index || makeIndex(file, '.tbi'),\n                indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n              },\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3Adapter',\n          configSchema: gff3AdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./Gff3Adapter/Gff3Adapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gff3?$/i\n          const adapterName = 'Gff3Adapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            gffLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { types, cast, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Region as RegionModel, ElementId } from '@jbrowse/core/util/types/mst'\n\nconst LabeledRegionModel = types\n  .compose(\n    RegionModel,\n    types.model('Label', { label: types.optional(types.string, '') }),\n  )\n  .actions(self => ({\n    setLabel(label: string) {\n      self.label = label\n    },\n  }))\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('GridBookmarkModel', {\n      id: ElementId,\n      type: types.literal('GridBookmarkWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      bookmarkedRegions: types.array(LabeledRegionModel),\n      modelSelectedAssembly: '',\n    })\n    .actions(self => ({\n      importBookmarks(regions: Region[]) {\n        self.bookmarkedRegions = cast(self.bookmarkedRegions.concat(regions))\n      },\n      addBookmark(region: Region) {\n        self.bookmarkedRegions.push(region)\n      },\n      removeBookmark(index: number) {\n        self.bookmarkedRegions.splice(index, 1)\n      },\n      clearAllBookmarks() {\n        self.bookmarkedRegions.clear()\n      },\n      updateBookmarkLabel(index: number, label: string) {\n        self.bookmarkedRegions[index]?.setLabel(label)\n      },\n      setSelectedAssembly(assembly: string) {\n        self.modelSelectedAssembly = assembly\n      },\n    }))\n    .views(self => ({\n      get selectedAssembly() {\n        return (\n          self.modelSelectedAssembly ||\n          (self.bookmarkedRegions.length\n            ? self.bookmarkedRegions[0].assemblyName\n            : '')\n        )\n      },\n      get assemblies() {\n        return [\n          ...new Set(self.bookmarkedRegions.map(region => region.assemblyName)),\n        ]\n      },\n    }))\n}\n\nexport type GridBookmarkStateModel = ReturnType<typeof f>\nexport type GridBookmarkModel = Instance<GridBookmarkStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('GridBookmarkWidget', {})\n","import { lazy } from 'react'\n\nimport BookmarkIcon from '@mui/icons-material/Bookmark'\nimport BookmarksIcon from '@mui/icons-material/Bookmarks'\n\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport {\n  stateModelFactory as GridBookmarkStateModelFactory,\n  configSchema as GridBookmarkConfigSchema,\n} from './GridBookmarkWidget'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\n\nexport default class extends Plugin {\n  name = 'GridBookmarkPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'GridBookmarkWidget',\n        heading: 'Bookmarked regions',\n        configSchema: GridBookmarkConfigSchema,\n        stateModel: GridBookmarkStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./GridBookmarkWidget/components/GridBookmarkWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (pluggableElement.name === 'LinearGenomeView') {\n          const { stateModel } = pluggableElement as ViewType\n          const newStateModel = stateModel.extend(\n            (self: LinearGenomeViewModel) => {\n              const superMenuItems = self.menuItems\n              const superRubberBandMenuItems = self.rubberBandMenuItems\n              return {\n                actions: {\n                  activateBookmarkWidget() {\n                    const session = getSession(self)\n                    if (isSessionModelWithWidgets(session)) {\n                      let bookmarkWidget = session.widgets.get('GridBookmark')\n                      if (!bookmarkWidget) {\n                        bookmarkWidget = session.addWidget(\n                          'GridBookmarkWidget',\n                          'GridBookmark',\n                          { view: self },\n                        )\n                      }\n\n                      session.showWidget(bookmarkWidget)\n                      return bookmarkWidget\n                    }\n\n                    throw new Error('Could not open bookmark widget')\n                  },\n\n                  bookmarkCurrentRegion() {\n                    const selectedRegions = self.getSelectedRegions(\n                      self.leftOffset,\n                      self.rightOffset,\n                    )\n                    const firstRegion = selectedRegions[0]\n                    const session = getSession(self)\n                    if (isSessionModelWithWidgets(session)) {\n                      const { widgets } = session\n                      let bookmarkWidget = widgets.get('GridBookmark')\n                      if (!bookmarkWidget) {\n                        this.activateBookmarkWidget()\n                        bookmarkWidget = widgets.get('GridBookmark')\n                      }\n                      // @ts-ignore\n                      bookmarkWidget.addBookmark(firstRegion)\n                    }\n                  },\n                },\n                views: {\n                  menuItems() {\n                    const newMenuItems = [\n                      ...superMenuItems(),\n                      { type: 'divider' },\n                      {\n                        label: 'Open bookmark widget',\n                        icon: BookmarksIcon,\n                        // @ts-ignore\n                        onClick: self.activateBookmarkWidget,\n                      },\n                      {\n                        label: 'Bookmark current region',\n                        icon: BookmarkIcon,\n                        // @ts-ignore\n                        onClick: self.bookmarkCurrentRegion,\n                      },\n                    ]\n\n                    return newMenuItems\n                  },\n\n                  rubberBandMenuItems() {\n                    const newRubberBandMenuItems = [\n                      ...superRubberBandMenuItems(),\n                      {\n                        label: 'Bookmark region',\n                        icon: BookmarkIcon,\n                        onClick: () => {\n                          const { leftOffset, rightOffset } = self\n                          const selectedRegions = self.getSelectedRegions(\n                            leftOffset,\n                            rightOffset,\n                          )\n                          const firstRegion = selectedRegions[0]\n                          const session = getSession(self)\n                          if (isSessionModelWithWidgets(session)) {\n                            const { widgets } = session\n                            let bookmarkWidget = widgets.get('GridBookmark')\n                            if (!bookmarkWidget) {\n                              // @ts-ignore\n                              self.activateBookmarkWidget()\n                              bookmarkWidget = widgets.get('GridBookmark')\n                            }\n                            // @ts-ignore\n                            bookmarkWidget.addBookmark(firstRegion)\n                          }\n                        },\n                      },\n                    ]\n\n                    return newRubberBandMenuItems\n                  },\n                },\n              }\n            },\n          )\n\n          ;(pluggableElement as ViewType).stateModel = newStateModel\n        }\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(_pluginManager: PluginManager) {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config GtfAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst GtfAdapter = ConfigurationSchema(\n  'GtfAdapter',\n  {\n    /**\n     * #slot\n     */\n    gtfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gtf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default GtfAdapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gtfAdapterConfigSchema } from './GtfAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class GtfPlugin extends Plugin {\n  name = 'GTFPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'GtfAdapter',\n          configSchema: gtfAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./GtfAdapter/GtfAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gtf(\\.gz)?$/i\n          const adapterName = 'GtfAdapter'\n          const fileName = getFileName(file)\n\n          const obj = {\n            type: adapterName,\n            gtfLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config HicTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'HicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction HicRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n}\n\nexport default observer(HicRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicRenderer = ConfigurationSchema(\n  'HicRenderer',\n  {\n    /**\n     * #slot\n     */\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: `jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))`,\n      contextVariable: ['count', 'maxScore', 'baseColor'],\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HicRenderer\n","import ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { abortBreakPoint } from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => Promise<number>\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  regions: Region[]\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  regions: Region[]\n  dataAdapter: HicDataAdapter\n  bpPerPx: number\n  highResolutionScaling: number\n  resolution: number\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: HicFeature[]\n}\n\nexport type { RenderArgsSerialized, RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport type ResultsDeserialized = ServerSideResultsDeserialized\n\nexport default class HicRenderer extends ServerSideRendererType {\n  supportsSVG = true\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      config,\n      bpPerPx,\n      signal,\n      resolution,\n      sessionId,\n      adapterConfig,\n    } = props\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const res = await (dataAdapter as HicDataAdapter).getResolution(\n      bpPerPx / resolution,\n    )\n\n    const Color = await import('color').then(f => f.default)\n    const w = res / (bpPerPx * Math.sqrt(2))\n    const baseColor = Color(readConfObject(config, 'baseColor'))\n    if (features.length) {\n      const offset = features[0].bin1\n      let maxScore = 0\n      let minBin = 0\n      let maxBin = 0\n      await abortBreakPoint(signal)\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        maxScore = Math.max(counts, maxScore)\n        minBin = Math.min(Math.min(bin1, bin2), minBin)\n        maxBin = Math.max(Math.max(bin1, bin2), maxBin)\n      }\n      await abortBreakPoint(signal)\n      ctx.rotate(-Math.PI / 4)\n      let start = Date.now()\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        ctx.fillStyle = readConfObject(config, 'color', {\n          count: counts,\n          maxScore,\n          baseColor,\n        })\n        ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w)\n        if (+Date.now() - start > 400) {\n          await abortBreakPoint(signal)\n          start = +Date.now()\n        }\n      }\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { config, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const height = readConfObject(config, 'maxHeight')\n    const features = await this.getFeatures(renderProps)\n\n    const res = await renderToAbstractCanvas(width, height, renderProps, ctx =>\n      this.makeImageData(ctx, {\n        ...renderProps,\n        features,\n      }),\n    )\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      region: renderProps.regions[0],\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      height,\n      width,\n    }\n  }\n\n  async getFeatures(args: RenderArgsDeserialized) {\n    const { regions, sessionId, adapterConfig } = args\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const features = await (dataAdapter as BaseFeatureDataAdapter)\n      .getFeatures(regions[0], args)\n      .pipe(toArray())\n      .toPromise()\n    // cast to any to avoid return-type conflict, because the\n    // types of features returned by our getFeatures are quite\n    // different from the base interface\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return features as any\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearHicDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.getRendererType('HicRenderer').configSchema,\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types, getEnv } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearHicDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        resolution: types.optional(types.number, 1),\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        get rendererTypeName() {\n          return 'HicRenderer'\n        },\n\n        renderProps() {\n          const config = self.rendererType.configSchema.create(\n            getConf(self, 'renderer') || {},\n            getEnv(self),\n          )\n\n          return {\n            ...superRenderProps(),\n            config,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            resolution: self.resolution,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      setResolution(n: number) {\n        self.resolution = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Resolution',\n              subMenu: [\n                {\n                  label: 'Finer resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution * 2)\n                  },\n                },\n                {\n                  label: 'Coarser resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution / 2)\n                  },\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HicAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst HicAdapter = ConfigurationSchema(\n  'HicAdapter',\n  {\n    /**\n     * #slot\n     */\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.hic',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default HicAdapter\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport configSchemaF from './configSchema'\nimport Color from 'color'\nimport HicRenderer, {\n  configSchema as hicRendererConfigSchema,\n  ReactComponent as HicRendererReactComponent,\n} from './HicRenderer'\nimport {\n  configSchemaFactory as linearHicdisplayConfigSchemaFactory,\n  modelFactory as linearHicdisplayModelFactory,\n} from './LinearHicDisplay'\nimport hicAdapterConfigSchema from './HicAdapter/configSchema'\nimport {\n  AdapterGuesser,\n  getFileName,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HicAdapter',\n          configSchema: hicAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./HicAdapter/HicAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.hic/i\n          const adapterName = 'HicAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            hicLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'HicAdapter') {\n            return 'HicTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n    pluginManager.addRendererType(\n      () =>\n        new HicRenderer({\n          name: 'HicRenderer',\n          ReactComponent: HicRendererReactComponent,\n          configSchema: hicRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = configSchemaF(pluginManager)\n      return new TrackType({\n        name: 'HicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'HicTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearHicdisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearHicDisplay',\n        configSchema,\n        stateModel: linearHicdisplayModelFactory(configSchema),\n        trackType: 'HicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    pluginManager.jexl.addFunction('alpha', (color: Color, value: number) =>\n      color.alpha(value),\n    )\n    pluginManager.jexl.addFunction('hsl', (color: Color) => color.hsl())\n    pluginManager.jexl.addFunction('colorString', (color: Color) =>\n      color.string(),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config NCListAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst NCListAdapter = ConfigurationSchema(\n  'NCListAdapter',\n  {\n    /**\n     * #slot\n     */\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/{refseq}/trackData.json',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default NCListAdapter\n","/**\n * Helper class allows reading names index generated in JBrowse1\n * Adapted from https://github.com/GMOD/jbrowse/blob/master/src/JBrowse/Store/Hash.js\n */\nimport crc32 from 'buffer-crc32'\n\nexport default class HttpMap {\n  url: string\n\n  constructor(args: { url: string }) {\n    // make sure url has a trailing slash\n    this.url = /\\/$/.test(args.url) ? args.url : `${args.url}/`\n  }\n\n  /**\n   * loads meta.json file from names directory and reads number of hash_bits used\n   */\n  async readMeta() {\n    const meta = await this.loadFile('meta.json')\n    const { compress, track_names: tracks } = meta\n    const hashHexCharacters = Math.ceil(meta.hash_bits / 4)\n    return { hashHexCharacters, compress, tracks }\n  }\n\n  async getHashHexCharacters() {\n    const meta = await this.readMeta()\n    return meta.hashHexCharacters\n  }\n\n  async getCompress() {\n    const meta = await this.readMeta()\n    return meta.compress\n  }\n\n  async getTrackNames() {\n    const meta = await this.readMeta()\n    return meta.tracks\n  }\n\n  /**\n   * Returns contents of a bucket given a key\n   * @param key - string\n   */\n  async get(key: string) {\n    const bucket = await this.getBucket(key)\n    return bucket[key]\n  }\n\n  /**\n   * Returns a bucket given a key\n   * @param key - string\n   */\n  async getBucket(key: string) {\n    const bucketIdent = this.hash(key)\n    const hexToDirPath = await this.hexToDirPath(bucketIdent)\n    return this.loadFile(hexToDirPath)\n  }\n\n  /**\n   * Loads a file using the url and provided id.\n   * Returns response object with contents of the file\n   * @param id - string\n   */\n  async loadFile(id: string) {\n    const response = await fetch(`${this.url}${id}`)\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status} ${response.statusText}`)\n    }\n    return response.json()\n  }\n\n  /**\n   * Returns the corresponding path of the file given a hex string\n   * @param hex - hex string\n   */\n  async hexToDirPath(hex: string) {\n    // zero-pad the hex string to be 8 chars if necessary\n    const hashHexCharacters = await this.getHashHexCharacters()\n    if (hashHexCharacters) {\n      const compress = await this.getCompress()\n      while (hex.length < 8) {\n        hex = `0${hex}`\n      }\n      hex = hex.substr(8 - hashHexCharacters)\n      const dirpath = []\n      for (let i = 0; i < hex.length; i += 3) {\n        dirpath.push(hex.substring(i, i + 3))\n      }\n      return `${dirpath.join('/')}.json${compress ? 'z' : ''}`\n    }\n    return ''\n  }\n\n  hash(data: string) {\n    return crc32(Buffer.from(data))\n      .toString('hex')\n      .toLowerCase()\n      .replace('-', 'n')\n  }\n}\n","import {\n  BaseTextSearchAdapter,\n  BaseArgs,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\nimport HttpMap from './HttpMap'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nexport interface TooManyHits {\n  name: string\n  hitLimit: number\n}\n\ninterface SearchResults {\n  prefix: ({ name: string } | string)[]\n  exact: [string, number, string, string, number, number][]\n}\n\nexport type NamesIndexRecord = string | Array<string | number>\n\n//  Jbrowse1 text search adapter\n// Uses index built by generate-names.pl\nexport default class JBrowse1TextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  httpMap: HttpMap\n\n  tracksNames?: string[]\n\n  constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const namesIndexLocation = readConfObject(config, 'namesIndexLocation')\n    if (!namesIndexLocation) {\n      throw new Error('must provide namesIndexLocation')\n    }\n    this.httpMap = new HttpMap({\n      url: namesIndexLocation.baseUri\n        ? new URL(namesIndexLocation.uri, namesIndexLocation.baseUri).href\n        : namesIndexLocation.uri,\n    })\n  }\n\n  /**\n   * Returns the contents of the file containing the query if it exists\n   * else it returns empty\n   * @param query - string query\n   */\n  async loadIndexFile(query: string): Promise<Record<string, SearchResults>> {\n    return this.httpMap.getBucket(query)\n  }\n\n  async searchIndex(args: BaseArgs) {\n    const { searchType, queryString } = args\n    const tracks = this.tracksNames || (await this.httpMap.getTrackNames())\n    const entries = await this.loadIndexFile(queryString.toLowerCase())\n    if (entries[queryString]) {\n      return this.formatResults(entries[queryString], tracks, searchType)\n    }\n    return []\n  }\n  formatResults(results: SearchResults, tracks: string[], searchType?: string) {\n    return [\n      ...(searchType === 'exact'\n        ? []\n        : results.prefix.map(result => {\n            return new BaseResult({\n              label: typeof result === 'object' ? result.name : result,\n              matchedAttribute: 'name',\n              matchedObject: { result: result },\n            })\n          })),\n      ...results.exact.map(result => {\n        const name = result[0] as string\n        const trackIndex = result[1] as number\n        const refName = result[3] as string\n        const start = result[4] as number\n        const end = result[5] as number\n        const locstring = `${refName || name}:${start}-${end}`\n        return new BaseResult({\n          locString: locstring,\n          label: name,\n          matchedAttribute: 'name',\n          matchedObject: result,\n          trackId: tracks[trackIndex],\n        })\n      }),\n    ].filter(result => result.getLabel() !== 'too many matches')\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowse1TextSearchAdapter\n * note: metadata about tracks and assemblies covered by text search adapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'JBrowse1TextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    namesIndexLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/volvox/names', locationType: 'UriLocation' },\n      description: 'the location of the JBrowse1 names index data directory',\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n  },\n)\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config JBrowse1Connection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst JBrowse1Connection = ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    /**\n     * #slot\n     */\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/jbrowse/data/',\n        locationType: 'UriLocation',\n      },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      description:\n        'name of the assembly the connection belongs to, should be a single entry',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n\nexport default JBrowse1Connection\n","import getValue from 'get-value'\nimport { Track, Source } from './types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isTrack(arg: any): arg is Track {\n  return arg && arg.label && typeof arg.label === 'string'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isSource(arg: any): arg is Source {\n  return arg && arg.url && typeof arg.url === 'string'\n}\n\n/**\n * updates a with values from b, recursively\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Obj = Record<string, any>\nexport function deepUpdate(a: Obj, b: Obj): Obj {\n  for (const prop of Object.keys(b)) {\n    if (\n      prop in a &&\n      typeof b[prop] === 'object' &&\n      typeof a[prop] === 'object'\n    ) {\n      deepUpdate(a[prop], b[prop])\n    } else if (\n      typeof a[prop] === 'undefined' ||\n      typeof b[prop] !== 'undefined'\n    ) {\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * replace variables in a template string with values\n * @param template - String with variable names in curly brackets\n * e.g., `http://foo/{bar}?arg={baz.foo}`\n * @param fillWith - object with attribute-value mappings\n * e.g., `{ 'bar': 'someurl', 'baz': { 'foo': 42 } }`\n * @returns the template string with variables in fillWith replaced\n * e.g., 'htp://foo/someurl?arg=valueforbaz'\n */\nexport function fillTemplate(template: string, fillWith: Obj): string {\n  return template.replace(\n    /\\{([\\w\\s.]+)\\}/g,\n    (match, varName: string): string => {\n      varName = varName.replace(/\\s+/g, '') // remove all whitespace\n      const fill = getValue(fillWith, varName)\n      if (fill !== undefined) {\n        if (typeof fill === 'function') {\n          return fill(varName)\n        }\n        return fill\n      }\n      if (fillWith.callback) {\n        // @ts-ignore\n        const v = fillWith.callback.call(this, varName)\n        if (v !== undefined) {\n          return v\n        }\n      }\n      return match\n    },\n  )\n}\n\n/**\n * Clones objects (including DOM nodes) and all children.\n * Warning: do not clone cyclic structures\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n * @param src - The object to clone\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function clone(src: any): any {\n  if (\n    !src ||\n    typeof src !== 'object' ||\n    Object.prototype.toString.call(src) === '[object Function]'\n  ) {\n    // null, undefined, any non-object, or function\n    return src // anything\n  }\n  if (src.nodeType && 'cloneNode' in src) {\n    // DOM Node\n    return src.cloneNode(true) // Node\n  }\n  if (src instanceof Date) {\n    // Date\n    return new Date(src.getTime()) // Date\n  }\n  if (src instanceof RegExp) {\n    // RegExp\n    return new RegExp(src) // RegExp\n  }\n  let r\n  let i\n  let l\n  if (Array.isArray(src)) {\n    // array\n    r = []\n    for (i = 0, l = src.length; i < l; ++i) {\n      if (i in src) {\n        r[i] = clone(src[i])\n      }\n    }\n    // we don't clone functions for performance reasons\n    //    }else if(d.isFunction(src)){\n    //      // function\n    //      r = function(){ return src.apply(this, arguments); };\n  } else {\n    // generic objects\n    r = src.constructor ? new src.constructor() : {}\n  }\n  return mixin(r, src, clone)\n}\n\n/**\n * Copies/adds all properties of source to dest; returns dest.\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n *\n * All properties, including functions (sometimes termed \"methods\"), excluding\n * any non-standard extensions found in Object.prototype, are copied/added to\n * dest. Copying/adding each particular property is delegated to copyFunc\n * (if any); copyFunc defaults to the Javascript assignment operator if not\n * provided. Notice that by default, mixin executes a so-called \"shallow copy\"\n * and aggregate types are copied/added by reference.\n * @param dest - The object to which to copy/add all properties contained in\n * source.\n * @param source - The object from which to draw all properties to copy into dest.\n * @param copyFunc - The process used to copy/add a property in source; defaults\n * to the Javascript assignment operator.\n * @returns dest, as modified\n */\nfunction mixin(dest: Obj, source: Obj, copyFunc: Function): Obj {\n  let name\n  let s\n  const empty = {}\n  for (name in source) {\n    // the (!(name in empty) || empty[name] !== s) condition avoids copying\n    // properties in \"source\" inherited from Object.prototype.\t For example,\n    // if dest has a custom toString() method, don't overwrite it with the\n    // toString() method that source inherited from Object.prototype\n    s = source[name]\n    if (\n      !(name in dest) ||\n      // @ts-ignore\n      (dest[name] !== s && (!(name in empty) || empty[name] !== s))\n    ) {\n      dest[name] = copyFunc ? copyFunc(s) : s\n    }\n  }\n\n  return dest // Object\n}\n","/* eslint no-cond-assign: [\"error\", \"except-parens\"] */\nimport getValue from 'get-value'\nimport setValue from 'set-value'\nimport { objectHash } from '@jbrowse/core/util'\nimport { isSource, isTrack } from './util'\nimport { Config, Track, Source, Store, Names } from './types'\n\nexport function parseJB1Json(config: Config | string, url: string): Config {\n  if (typeof config === 'string') {\n    let parsedConf\n    try {\n      parsedConf = JSON.parse(config)\n    } catch (error) {\n      throw new Error(`${error} when parsing configuration.`)\n    }\n    return regularizeConf(parsedConf, url)\n  }\n  return regularizeConf(config, url)\n}\n\nexport function parseJB1Conf(config: string, url: string): Config {\n  let parsedConf\n  try {\n    parsedConf = parse(config, url)\n  } catch (error) {\n    throw new Error(`${error} when parsing configuration.`)\n  }\n  return regularizeConf(parsedConf, url)\n}\n\nfunction isAlwaysArray(varName: string): boolean {\n  if (varName === 'include') {\n    return true\n  }\n  return false\n}\n\nfunction parse(text: string, url: string): Config {\n  let section: string[] = []\n  let keyPath: string[] | undefined\n  let operation: string\n  let value: string | undefined\n  const data: Config = { tracks: {} }\n  let lineNumber: number\n\n  function recordVal(): void {\n    if (value !== undefined) {\n      let parsedValue:\n        | string\n        | number\n        | boolean\n        | string[]\n        | number[]\n        | boolean[]\n      try {\n        // parse json\n        const match = value.match(/^json:(.+)/i)\n        if (match) {\n          parsedValue = JSON.parse(match[1])\n        }\n        // parse numbers if it looks numeric\n        else if (/^[+-]?[\\d.,]+([eE][-+]?\\d+)?$/.test(value)) {\n          parsedValue = parseFloat(value.replace(/,/g, ''))\n        } else {\n          parsedValue = value\n        }\n\n        if (!keyPath) {\n          throw new Error(`Error parsing in section ${section.join(' - ')}`)\n        }\n        const path = section.concat(keyPath).join('.')\n        if (operation === '+=') {\n          let existing = getValue(data, path)\n          if (existing) {\n            if (!Array.isArray(existing)) {\n              existing = [existing]\n            }\n          } else {\n            existing = []\n          }\n\n          existing.push(parsedValue)\n          parsedValue = existing\n        }\n        if (parsedValue === 'true') {\n          parsedValue = true\n        }\n        if (parsedValue === 'false') {\n          parsedValue = false\n        }\n        setValue(data, path, parsedValue)\n      } catch (e) {\n        throw new Error(\n          `syntax error${url ? ` in ${url}` : ''}${\n            lineNumber ? ` at line ${lineNumber - 1}` : ''\n          }`,\n        )\n      }\n    }\n  }\n\n  text.split(/\\n|\\r\\n|\\r/).forEach((textLine, i): void => {\n    lineNumber = i + 1\n    const line = textLine.replace(/^\\s*#.+/, '')\n\n    // new section\n    let match: RegExpMatchArray | null\n    if ((match = line.match(/^\\s*\\[([^\\]]+)/))) {\n      // new section\n      recordVal()\n      keyPath = undefined\n      value = undefined\n      section = match[1].trim().split(/\\s*\\.\\s*/)\n      if (section.length === 1 && section[0].toLowerCase() === 'general') {\n        section = []\n      }\n    }\n    // new value\n    else if (\n      (match = line.match(\n        value === undefined ? /^([^+=]+)(\\+?=)(.*)/ : /^(\\S[^+=]+)(\\+?=)(.*)/,\n      ))\n    ) {\n      recordVal()\n      keyPath = match[1].trim().split(/\\s*\\.\\s*/)\n      ;[, , operation] = match\n      if (isAlwaysArray(section.concat(keyPath).join('.'))) {\n        operation = '+='\n      }\n      value = match[3].trim()\n    }\n    // add to existing array value\n    else if (\n      keyPath !== undefined &&\n      (match = line.match(/^\\s{0,4}\\+\\s*(.+)/))\n    ) {\n      recordVal()\n      operation = '+='\n      value = match[1].trim()\n    }\n    // add to existing value\n    else if (value !== undefined && (match = line.match(/^\\s+(\\S.*)/))) {\n      value += value.length ? ` ${match[1].trim()}` : match[1].trim()\n    }\n    // done with last value\n    else {\n      recordVal()\n      keyPath = undefined\n      value = undefined\n    }\n  })\n\n  recordVal()\n\n  return data\n}\n\n/**\n * Applies defaults and any other necessary tweaks to the loaded configuration.\n * @param conf - the object containing the configuration, which it modifies\n * in-place\n * @param url - URL of the config file\n * @returns the same object it was passed\n */\nexport function regularizeConf(conf: Config, url: string): Config {\n  // if tracks is not an array, convert it to one\n  if (conf.tracks && !Array.isArray(conf.tracks)) {\n    // if it's a single track config, wrap it in an arrayref\n    if (isTrack(conf.tracks)) {\n      conf.tracks = [conf.tracks]\n    }\n    // otherwise, coerce it to an array\n    else {\n      const tracks: Track[] = []\n      for (const label of Object.keys(conf.tracks)) {\n        const track = conf.tracks[label]\n        if (isTrack(track)) {\n          tracks.push(track)\n        } else {\n          tracks.push({ label, ...track })\n        }\n      }\n      conf.tracks = tracks\n    }\n  }\n\n  // regularize trackMetadata.sources\n  const meta = conf.trackMetadata\n  if (meta && meta.sources) {\n    // if it's a single source config, wrap it in an arrayref\n    if (typeof meta.sources === 'string') {\n      meta.sources = [meta.sources]\n    }\n    if (isSource(meta.sources)) {\n      meta.sources = [meta.sources]\n    }\n\n    if (!Array.isArray(meta.sources)) {\n      const sources: Source[] = []\n      for (const name of Object.keys(meta.sources)) {\n        const source = meta.sources[name]\n        if (!('name' in source)) {\n          source.name = name\n        }\n        sources.push(source)\n      }\n      meta.sources = sources\n    }\n\n    // coerce any string source defs to be URLs, and try to detect their types\n    meta.sources = meta.sources.map((sourceDef: string | Source): Source => {\n      if (typeof sourceDef === 'string') {\n        const newSourceDef: Source = { url: sourceDef }\n        const typeMatch = sourceDef.match(/\\.(\\w+)$/)\n        if (typeMatch) {\n          newSourceDef.type = typeMatch[1].toLowerCase()\n        }\n        return newSourceDef\n      }\n      return sourceDef\n    })\n  }\n\n  conf.sourceUrl = conf.sourceUrl || url\n  if (conf.sourceUrl.startsWith('/')) {\n    conf.sourceUrl = new URL(conf.sourceUrl, window.location.href).href\n  }\n  conf.baseUrl = conf.baseUrl || new URL('.', conf.sourceUrl).href\n  if (conf.baseUrl.length && !conf.baseUrl.endsWith('/')) {\n    conf.baseUrl += '/'\n  }\n\n  if (conf.sourceUrl) {\n    // set a default baseUrl in each of the track and store confs, and the names\n    // conf, if needed\n    const addBase: (Track | Store | Names)[] = []\n    if (conf.tracks) {\n      addBase.push(...conf.tracks)\n    }\n    if (conf.stores) {\n      addBase.push(...Object.values(conf.stores))\n    }\n    if (conf.names) {\n      addBase.push(conf.names)\n    }\n\n    addBase.forEach((t): void => {\n      if (!t.baseUrl) {\n        t.baseUrl = conf.baseUrl || '/'\n      }\n    })\n\n    // resolve the refSeqs and nameUrl if present\n    if (conf.refSeqs && typeof conf.refSeqs === 'string') {\n      conf.refSeqs = new URL(conf.refSeqs, conf.sourceUrl).href\n    }\n    if (conf.nameUrl) {\n      conf.nameUrl = new URL(conf.nameUrl, conf.sourceUrl).href\n    }\n  }\n\n  conf.stores = conf.stores || {}\n  ;(conf.tracks || []).forEach((trackConfig: Track): void => {\n    // if there is a `config` subpart, just copy its keys in to the top-level\n    // config\n    if (trackConfig.config) {\n      const c = trackConfig.config\n      delete trackConfig.config\n      trackConfig = { ...c, ...trackConfig }\n    }\n\n    // skip if it's a new-style track def\n    if (trackConfig.store) {\n      return\n    }\n\n    let trackClassName: string\n    if (trackConfig.type === 'FeatureTrack') {\n      trackClassName = 'JBrowse/View/Track/HTMLFeatures'\n    } else if (trackConfig.type === 'ImageTrack') {\n      trackClassName = 'JBrowse/View/Track/FixedImage'\n    } else if (trackConfig.type === 'ImageTrack.Wiggle') {\n      trackClassName = 'JBrowse/View/Track/FixedImage/Wiggle'\n    } else if (trackConfig.type === 'SequenceTrack') {\n      trackClassName = 'JBrowse/View/Track/Sequence'\n    } else {\n      trackClassName = regularizeClass('JBrowse/View/Track', trackConfig.type)\n    }\n\n    trackConfig.type = trackClassName\n\n    synthesizeTrackStoreConfig(conf, trackConfig)\n\n    if (trackConfig.histograms) {\n      if (!trackConfig.histograms.baseUrl) {\n        trackConfig.histograms.baseUrl = trackConfig.baseUrl\n      }\n      synthesizeTrackStoreConfig(conf, trackConfig.histograms)\n    }\n  })\n\n  return conf\n}\n\n/**\n * prefix class name with `root` if it contains no slashes\n * @param root - Prefix root\n * @param className - class name\n */\nfunction regularizeClass(root: string, className: string | undefined): string {\n  if (!className) {\n    return ''\n  }\n  if (!className.includes('/')) {\n    className = `${root}/${className}`\n  }\n  className = className.replace(/^\\//, '')\n  return className\n}\n\nfunction guessStoreClass(\n  trackConfig: Track | undefined,\n  urlTemplate: string,\n): string {\n  if (!trackConfig) {\n    return ''\n  }\n  if (trackConfig.type && trackConfig.type.includes('/FixedImage')) {\n    return `JBrowse/Store/TiledImage/Fixed${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.jsonz?$/i.test(urlTemplate)) {\n    return `JBrowse/Store/SeqFeature/NCList${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.bam$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BAM'\n  }\n  if (/\\.cram$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/CRAM'\n  }\n  if (/\\.gff3?$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3'\n  }\n  if (/\\.bed$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BED'\n  }\n  if (/\\.vcf.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/VCFTabix'\n  }\n  if (/\\.gff3?.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3Tabix'\n  }\n  if (/\\.bed.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BEDTabix'\n  }\n  if (/\\.(bw|bigwig)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigWig'\n  }\n  if (/\\.(bb|bigbed)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigBed'\n  }\n  if (/\\.(fa|fasta)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/IndexedFasta'\n  }\n  if (/\\.(fa|fasta)\\.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BgzipIndexedFasta'\n  }\n  if (/\\.2bit$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/TwoBit'\n  }\n  if (trackConfig.type && trackConfig.type.endsWith('/Sequence')) {\n    return 'JBrowse/Store/Sequence/StaticChunked'\n  }\n  return ''\n}\n\nfunction synthesizeTrackStoreConfig(\n  mainConf: Config,\n  trackConfig: Track,\n): void {\n  // figure out what data store class to use with the track, applying some\n  // defaults if it is not explicit in the configuration\n  const { urlTemplate = '' } = trackConfig\n\n  let storeClass: string\n  if (trackConfig.storeClass) {\n    storeClass = regularizeClass('JBrowse/Store', trackConfig.storeClass)\n  } else {\n    storeClass = guessStoreClass(trackConfig, urlTemplate)\n  }\n\n  if (!storeClass) {\n    console.warn(\n      `Unable to determine an appropriate data store to use with track '${trackConfig.label}', please explicitly specify a storeClass in the configuration.`,\n    )\n    return\n  }\n\n  // synthesize a separate store conf\n  const storeConf: Store = { ...trackConfig, type: storeClass }\n\n  // if this is the first sequence store we see, and we have no refseqs store\n  // defined explicitly, make this the refseqs store.\n  if (\n    (storeClass === 'JBrowse/Store/Sequence/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/TwoBit' ||\n      storeClass === 'JBrowse/Store/Sequence/TwoBit' ||\n      trackConfig.useAsRefSeqStore) &&\n    !(mainConf.stores && mainConf.stores.refseqs)\n  ) {\n    storeConf.name = 'refseqs'\n  } else {\n    storeConf.name = `store${objectHash(storeConf)}`\n  }\n  // record it\n  if (!mainConf.stores) {\n    mainConf.stores = {}\n  }\n  mainConf.stores[storeConf.name] = storeConf\n\n  // connect it to the track conf\n  trackConfig.store = storeConf.name\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { parseJB1Json, parseJB1Conf, regularizeConf } from './jb1ConfigParse'\nimport { clone, deepUpdate, fillTemplate } from './util'\nimport {\n  JBLocation,\n  UriLocation,\n  LocalPathLocation,\n  Config,\n  Track,\n  Include,\n} from './types'\n\nfunction isUriLocation(location: JBLocation): location is UriLocation {\n  return (location as UriLocation).uri !== undefined\n}\n\nfunction isLocalPathLocation(\n  location: JBLocation,\n): location is LocalPathLocation {\n  return (location as LocalPathLocation).localPath !== undefined\n}\n\nexport async function fetchJb1(\n  dataRoot: JBLocation = { uri: '', locationType: 'UriLocation' },\n  baseConfig: Config = {\n    include: ['{dataRoot}/trackList.json', '{dataRoot}/tracks.conf'],\n  },\n  baseConfigRoot: JBLocation = { uri: '', locationType: 'UriLocation' },\n): Promise<Config> {\n  const protocol = 'uri' in dataRoot ? 'uri' : 'localPath'\n  const dataRootReg = JSON.parse(JSON.stringify(dataRoot))\n  let dataRootLocation = ''\n  if (isUriLocation(dataRoot)) {\n    dataRootLocation = dataRoot.uri\n  }\n  if (isLocalPathLocation(dataRoot)) {\n    dataRootLocation = dataRoot.localPath\n  }\n  if (dataRootLocation.endsWith('/')) {\n    dataRootReg[protocol] = dataRootLocation.slice(\n      0,\n      dataRootLocation.length - 1,\n    )\n  }\n  if (\n    (isUriLocation(baseConfigRoot) && baseConfigRoot.uri) ||\n    (isLocalPathLocation(baseConfigRoot) && baseConfigRoot.localPath)\n  ) {\n    const baseProtocol = 'uri' in baseConfigRoot ? 'uri' : 'localPath'\n    let baseConfigLocation = ''\n    if (isUriLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.uri\n    }\n    if (isLocalPathLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.localPath\n    }\n    if (baseConfigLocation.endsWith('/')) {\n      baseConfigLocation = baseConfigLocation.slice(\n        0,\n        baseConfigLocation.length - 1,\n      )\n    }\n    let newConfig: Config = {}\n    for (const conf of ['jbrowse.conf', 'jbrowse_conf.json']) {\n      let fetchedConfig = null\n      try {\n        // @ts-ignore\n        fetchedConfig = await fetchConfigFile({\n          [baseProtocol]: `${baseConfigLocation}/${conf}`,\n        })\n      } catch (error) {\n        console.error(\n          `tried to access ${baseConfigLocation}/${conf}, but failed`,\n        )\n      }\n      newConfig = mergeConfigs(newConfig, fetchedConfig) || {}\n    }\n    if (dataRootReg[protocol]) {\n      newConfig.dataRoot = dataRootReg[protocol]\n    }\n    return createFinalConfig(newConfig)\n  }\n  const newConfig = regularizeConf(baseConfig, window.location.href)\n  if (dataRootReg[protocol]) {\n    newConfig.dataRoot = dataRootReg[protocol]\n  }\n  return createFinalConfig(newConfig)\n}\n\nexport async function createFinalConfig(\n  baseConfig: Config,\n  defaults = configDefaults,\n): Promise<Config> {\n  const configWithDefaults = deepUpdate(clone(defaults), baseConfig)\n  let finalConfig = await loadIncludes(configWithDefaults)\n  finalConfig = mergeConfigs(finalConfig, baseConfig) || finalConfig\n  fillTemplates(finalConfig, finalConfig)\n  validateConfig(finalConfig)\n  return finalConfig\n}\n\nexport async function fetchConfigFile(location: JBLocation): Promise<Config> {\n  const result = await openLocation(location).readFile('utf8')\n  if (isUriLocation(location)) {\n    return parseJb1(result, location.uri)\n  }\n  if (isLocalPathLocation(location)) {\n    return parseJb1(result, location.localPath)\n  }\n  return parseJb1(result)\n}\n\nexport function parseJb1(config: string, url = ''): Config {\n  if (config.trim().startsWith('{')) {\n    return parseJB1Json(config, url)\n  }\n  return parseJB1Conf(config, url)\n}\n\n/**\n * Merges config object b into a. Properties in b override those in a.\n */\nfunction mergeConfigs(a: Config | null, b: Config | null): Config | null {\n  if (b === null) {\n    return null\n  }\n\n  if (a === null) {\n    a = {}\n  }\n\n  for (const prop of Object.keys(b)) {\n    if (prop === 'tracks' && prop in a) {\n      const aTracks = a[prop] || []\n      const bTracks = b[prop] || []\n      if (Array.isArray(aTracks) && Array.isArray(bTracks)) {\n        a[prop] = mergeTrackConfigs(aTracks || [], bTracks || [])\n      } else {\n        throw new Error(\n          `Track config has not been properly regularized: ${aTracks} ${bTracks}`,\n        )\n      }\n    } else if (\n      !noRecursiveMerge(prop) &&\n      prop in a &&\n      // @ts-ignore\n      typeof b[prop] === 'object' &&\n      // @ts-ignore\n      typeof a[prop] === 'object'\n    ) {\n      // @ts-ignore\n      a[prop] = deepUpdate(a[prop], b[prop])\n    } else if (prop === 'dataRoot') {\n      if (\n        a[prop] === undefined ||\n        (a[prop] === 'data' && b[prop] !== undefined)\n      ) {\n        a[prop] = b[prop]\n      }\n      // @ts-ignore\n    } else if (a[prop] === undefined || b[prop] !== undefined) {\n      // @ts-ignore\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * Special-case merging of two `tracks` configuration arrays.\n */\nfunction mergeTrackConfigs(a: Track[], b: Track[]): Track[] {\n  if (!b.length) {\n    return a\n  }\n\n  // index the tracks in `a` by track label\n  const aTracks: Record<string, Track> = {}\n  a.forEach((t, i): void => {\n    t.index = i\n    aTracks[t.label] = t\n  })\n\n  b.forEach((bT): void => {\n    const aT = aTracks[bT.label]\n    if (aT) {\n      mergeConfigs(aT, bT)\n    } else {\n      a.push(bT)\n    }\n  })\n\n  return a\n}\n\n/**\n * Recursively fetch, parse, and merge all the includes in the given config\n * object.  Calls the callback with the resulting configuration when finished.\n * @param inputConfig - Config to load includes into\n */\nasync function loadIncludes(inputConfig: Config): Promise<Config> {\n  inputConfig = clone(inputConfig)\n\n  async function loadRecur(\n    config: Config,\n    upstreamConf: Config,\n  ): Promise<Config> {\n    const sourceUrl = config.sourceUrl || config.baseUrl\n    if (!sourceUrl) {\n      throw new Error(\n        `Could not determine source URL: ${JSON.stringify(config)}`,\n      )\n    }\n    const newUpstreamConf = mergeConfigs(clone(upstreamConf), config)\n    if (!newUpstreamConf) {\n      throw new Error('Problem merging configs')\n    }\n    const includes = fillTemplates(\n      regularizeIncludes(config.include || []),\n      newUpstreamConf,\n    )\n    delete config.include\n\n    const loads = includes.map(async (include): Promise<Config> => {\n      include.cacheBuster = inputConfig.cacheBuster\n      const includedData = await fetchConfigFile({\n        uri: new URL(include.url, sourceUrl).href,\n        locationType: 'UriLocation',\n      })\n      return loadRecur(includedData, newUpstreamConf)\n    })\n    const includedDataObjects = await Promise.all(loads)\n    includedDataObjects.forEach((includedData): void => {\n      config = mergeConfigs(config, includedData) || config\n    })\n    return config\n  }\n\n  return loadRecur(inputConfig, {})\n}\n\nfunction regularizeIncludes(\n  includes: Include | string | (Include | string)[] | null,\n): Include[] {\n  if (!includes) {\n    return []\n  }\n\n  // coerce include to an array\n  if (!Array.isArray(includes)) {\n    includes = [includes]\n  }\n\n  return includes.map((include): Include => {\n    // coerce bare strings in the includes to URLs\n    if (typeof include === 'string') {\n      include = { url: include }\n    }\n\n    // set defaults for format and version\n    if (!('format' in include)) {\n      include.format = include.url.endsWith('.conf') ? 'conf' : 'JB_json'\n    }\n    if (include.format === 'JB_json' && !('version' in include)) {\n      include.version = 1\n    }\n    return include\n  })\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/no-unnecessary-type-constraint\nfunction fillTemplates<T extends any>(subconfig: T, config: Config): T {\n  if (!subconfig) {\n    return subconfig\n  }\n  if (Array.isArray(subconfig)) {\n    for (let i = 0; i < subconfig.length; i += 1) {\n      subconfig[i] = fillTemplates(subconfig[i], config)\n    }\n  } else if (typeof subconfig === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const sub = subconfig as Record<string, any>\n    for (const name of Object.keys(sub)) {\n      sub[name] = fillTemplates(sub[name], config)\n    }\n  } else if (typeof subconfig === 'string') {\n    // @ts-ignore\n    return fillTemplate(subconfig, config)\n  }\n\n  return subconfig\n}\n\n/**\n * list of config properties that should not be recursively merged\n * @param propName - name of config property\n */\nfunction noRecursiveMerge(propName: string): boolean {\n  return propName === 'datasets'\n}\n\nconst configDefaults = {\n  tracks: [],\n\n  containerID: 'GenomeBrowser',\n  dataRoot: 'data',\n  show_tracklist: true,\n  show_nav: true,\n  show_menu: true,\n  show_overview: true,\n  show_fullviewlink: true,\n  update_browser_title: true,\n  updateBrowserURL: true,\n\n  refSeqs: '{dataRoot}/seq/refSeqs.json',\n  include: ['jbrowse.conf', 'jbrowse_conf.json'],\n  nameUrl: '{dataRoot}/names/root.json',\n\n  datasets: {\n    _DEFAULT_EXAMPLES: true,\n    volvox: { url: '?data=sample_data/json/volvox', name: 'Volvox Example' },\n    modencode: {\n      url: '?data=sample_data/json/modencode',\n      name: 'MODEncode Example',\n    },\n    yeast: { url: '?data=sample_data/json/yeast', name: 'Yeast Example' },\n  },\n\n  highlightSearchedRegions: false,\n  highResolutionMode: 'auto',\n}\n\n/**\n * Examine the loaded and merged configuration for errors.  Throws\n * exceptions if it finds anything amiss.\n * @returns nothing meaningful\n */\nfunction validateConfig(config: Config): void {\n  if (!config.tracks) {\n    config.tracks = []\n  }\n  if (!config.baseUrl) {\n    throw new Error('Must provide a `baseUrl` in configuration')\n  }\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { objectHash } from '@jbrowse/core/util'\nimport {\n  generateUnknownTrackConf,\n  generateUnsupportedTrackConf,\n  guessAdapter,\n  guessTrackType,\n  UNKNOWN,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\nimport { Track, RefSeqs, RefSeq } from './types'\n\ninterface Jb2Track {\n  trackId: string\n  name: string\n  description?: string\n  category?: string[]\n  adapter?: Jb2Adapter\n  type?: string\n  defaultRendering?: string\n}\n\ninterface Jb2Adapter {\n  type: string\n  features?: Jb2Feature[]\n  bamLocation?: Jb2Location\n  cramLocation?: Jb2Location\n  craiLocation?: Jb2Location\n  fastaLocation?: Jb2Location\n  faiLocation?: Jb2Location\n  gziLocation?: Jb2Location\n  twoBitLocation?: Jb2Location\n  bigWigLocation?: Jb2Location\n  bigBedLocation?: Jb2Location\n  vcfGzLocation?: Jb2Location\n  gffLocation?: Jb2Location\n  gffGzLocation?: Jb2Location\n  gtfLocation?: Jb2Location\n  bedGzLocation?: Jb2Location\n  index?: { location: Jb2Location; indexType?: string }\n  rootUrlTemplate?: Jb2Location\n  sequenceAdapter?: Jb2Adapter\n}\n\ninterface Jb2Feature {\n  refName: string\n  uniqueId: string\n  start: number\n  end: number\n}\n\ninterface Jb2Location {\n  uri?: string\n  localPath?: string\n  blobId?: string\n  locationType?: string\n}\n\nexport function convertTrackConfig(\n  jb1TrackConfig: Track,\n  dataRoot: string,\n  sequenceAdapter: Jb2Adapter,\n): Jb2Track {\n  const jb2TrackConfig: Jb2Track = {\n    trackId: objectHash(jb1TrackConfig),\n    name: jb1TrackConfig.key || jb1TrackConfig.label,\n  }\n\n  const description =\n    jb1TrackConfig.metadata &&\n    (jb1TrackConfig.metadata.description || jb1TrackConfig.metadata.Description)\n  if (description) {\n    jb2TrackConfig.description = description\n  }\n\n  const category =\n    jb1TrackConfig.category ||\n    (jb1TrackConfig.metadata && jb1TrackConfig.metadata.category)\n  jb2TrackConfig.category = category ? category.split(/\\s*\\/\\s*/) : []\n\n  const { storeClass } = jb1TrackConfig\n  if (!jb1TrackConfig.urlTemplate) {\n    if (!(storeClass && storeClass.endsWith('FromConfig'))) {\n      const trackIdentifier = jb1TrackConfig.key || jb1TrackConfig.label\n      console.warn(\n        `Could not import JBrowse1 track \"${trackIdentifier}\" because it does not have a \"urlTemplate\" or is not a \"FromConfig\" track`,\n      )\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        trackIdentifier,\n        jb2TrackConfig.category,\n      )\n    }\n    return generateFromConfigTrackConfig(jb1TrackConfig, jb2TrackConfig)\n  }\n\n  const resolveUrlTemplate = (urlTemplate: string) => {\n    return new URL(urlTemplate, `${dataRoot}/`).href\n      .replace(/%7B/gi, '{')\n      .replace(/%7D/gi, '}')\n  }\n  const urlTemplate = resolveUrlTemplate(jb1TrackConfig.urlTemplate)\n\n  if (storeClass) {\n    if (storeClass === 'JBrowse/Store/SeqFeature/BAM') {\n      const adapter: Jb2Adapter = {\n        type: 'BamAdapter',\n        bamLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.baiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.baiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.bai`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/CRAM') {\n      const adapter: Jb2Adapter = {\n        type: 'CramAdapter',\n        cramLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        sequenceAdapter,\n      }\n      if (jb1TrackConfig.craiUrlTemplate) {\n        adapter.craiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.craiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.craiLocation = {\n          uri: `${urlTemplate}.crai`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/NCList') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'NCListAdapter',\n          rootUrlTemplate: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/BigWig' ||\n      storeClass === 'JBrowse/Store/BigWig'\n    ) {\n      if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n        jb2TrackConfig.defaultRendering = 'xyplot'\n      } else if (\n        jb1TrackConfig.type &&\n        jb1TrackConfig.type.endsWith('Density')\n      ) {\n        jb2TrackConfig.defaultRendering = 'density'\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'QuantitativeTrack',\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'VcfTabixAdapter',\n        vcfGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'VariantTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTribble') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `VCFTribble (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'Gff3Adapter',\n          gffLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BigBed') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3Tabix') {\n      const adapter: Jb2Adapter = {\n        type: 'Gff3TabixAdapter',\n        gffGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BED') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `BED (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BEDTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'BedTabixAdapter',\n        bedGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GTF') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'GtfAdapter',\n          gtfLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/StaticChunked'\n    ) {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `StaticChunked (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/UnindexedFasta') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `UnindexedFasta (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.faiLocation = {\n          uri: `${urlTemplate}.fai`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'SequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'BgzipFastaAdapter',\n        fastaLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.faiLocation = {\n          uri: `${urlTemplate}.fai`,\n          locationType: 'UriLocation',\n        }\n      }\n      if (jb1TrackConfig.gziUrlTemplate) {\n        adapter.gziLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.gziUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.gziLocation = {\n          uri: `${urlTemplate}.gzi`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/TwoBit') {\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter: {\n          type: 'TwoBitAdapter',\n          twoBitLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n  }\n\n  // If we don't recogize the store class, make a best effort to guess by file type\n  jb2TrackConfig.adapter = guessAdapter(\n    { uri: urlTemplate, locationType: 'UriLocation' },\n    undefined,\n    urlTemplate,\n  )\n  if (!jb2TrackConfig.adapter) {\n    throw new Error('Could not determine adapter')\n  }\n\n  if (jb2TrackConfig.adapter.type === UNSUPPORTED) {\n    return generateUnsupportedTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n  if (jb2TrackConfig.adapter.type === UNKNOWN) {\n    return generateUnknownTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n\n  jb2TrackConfig.type = guessTrackType(jb2TrackConfig.adapter.type)\n\n  if (jb2TrackConfig.type === 'QuantitativeTrack') {\n    if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n      jb2TrackConfig.defaultRendering = 'xyplot'\n    } else if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('Density')) {\n      jb2TrackConfig.defaultRendering = 'density'\n    }\n  }\n\n  return jb2TrackConfig\n}\n\nfunction generateFromConfigTrackConfig(\n  jb1TrackConfig: Track,\n  jb2TrackConfig: Jb2Track,\n): Jb2Track {\n  const jb1Features = jb1TrackConfig.features || []\n  const jb2Features = jb1Features.map((feature): Jb2Feature => {\n    const jb2Feature: Jb2Feature = JSON.parse(JSON.stringify(feature))\n    jb2Feature.refName = feature.seq_id\n    jb2Feature.uniqueId = `${feature.seq_id}:${feature.start}-${feature.end}:${\n      feature.name || ''\n    }`\n    return jb2Feature\n  })\n  jb2TrackConfig.adapter = {\n    type: 'FromConfigAdapter',\n    features: jb2Features,\n  }\n  jb2TrackConfig.type = 'FeatureTrack'\n  return jb2TrackConfig\n}\n\nexport async function createRefSeqsAdapter(\n  refSeqs: string | RefSeqs,\n): Promise<Jb2Adapter> {\n  if (typeof refSeqs === 'string') {\n    // assume refSeqs is a url if it is string\n    refSeqs = {\n      url: refSeqs,\n    }\n  }\n\n  // check refseq urls\n  if (refSeqs.url) {\n    if (refSeqs.url.match(/.fai$/)) {\n      return {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: {\n          uri: refSeqs.url.slice(0, -4),\n          locationType: 'UriLocation',\n        },\n        faiLocation: {\n          uri: refSeqs.url,\n          locationType: 'UriLocation',\n        },\n      }\n    }\n    if (refSeqs.url.match(/.2bit$/)) {\n      return {\n        type: 'TwoBitAdapter',\n        twoBitLocation: { uri: refSeqs.url, locationType: 'UriLocation' },\n      }\n    }\n    if (refSeqs.url.match(/.fa$/)) {\n      throw new Error('Unindexed FASTA adapter not available')\n    }\n    if (refSeqs.url.match(/.sizes/)) {\n      throw new Error('chromosome SIZES adapter not available')\n    }\n    const refSeqsJson = await openLocation({\n      uri: refSeqs.url,\n      locationType: 'UriLocation',\n    }).readFile('utf8')\n    const refSeqsData: RefSeq[] = JSON.parse(refSeqsJson)\n    return refSeqAdapterFromConfig(refSeqsData)\n  }\n  if ('data' in refSeqs) {\n    return refSeqAdapterFromConfig(refSeqs.data || [])\n  }\n  throw new Error(\n    `Could not determine adapter for JBrowse1 refSeqs: ${\n      refSeqs.url || JSON.stringify(refSeqs)\n    }`,\n  )\n}\n\nfunction refSeqAdapterFromConfig(refSeqsData: RefSeq[]): Jb2Adapter {\n  const features = refSeqsData.map(\n    (refSeq): Jb2Feature => ({\n      refName: refSeq.name,\n      uniqueId: refSeq.name,\n      start: refSeq.start,\n      end: refSeq.end,\n    }),\n  )\n  return {\n    type: 'FromConfigAdapter',\n    features,\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\n\nimport { fetchJb1 } from './jb1ConfigLoad'\nimport { convertTrackConfig } from './jb1ToJb2'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function (pluginManager: PluginManager) {\n  return types\n    .compose(\n      'JBrowse1Connection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      }),\n    )\n\n    .actions(self => ({\n      connect() {\n        const dataDirLocation = readConfObject(\n          self.configuration,\n          'dataDirLocation',\n        )\n        const session = getSession(self)\n        fetchJb1(dataDirLocation)\n          .then(config => {\n            const assemblyName = readConfObject(\n              self.configuration,\n              'assemblyNames',\n            )[0]\n            if (!assemblyName) {\n              throw new Error('assembly name required for JBrowse 1 connection')\n            }\n            const assemblyConf = session.assemblies.find(\n              assembly => readConfObject(assembly, 'name') === assemblyName,\n            )\n            if (!assemblyConf) {\n              throw new Error(`Assembly \"${assemblyName}\" not found`)\n            }\n            const sequenceAdapter = readConfObject(assemblyConf, [\n              'sequence',\n              'adapter',\n            ])\n\n            // @ts-ignore\n            const jb2Tracks = config.tracks?.map(jb1Track => {\n              const jb2Track = convertTrackConfig(\n                jb1Track,\n                config.dataRoot || '',\n                sequenceAdapter,\n              )\n\n              // @ts-ignore\n              jb2Track.assemblyNames = [assemblyName]\n              return jb2Track\n            })\n\n            self.setTrackConfs(jb2Tracks)\n          })\n          .catch(error => {\n            console.error(error)\n            session.notify(\n              `There was a problem connecting to the JBrowse 1 data directory \"${self.name}\". Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n              'error',\n            )\n            session.breakConnection(self.configuration)\n          })\n      },\n    }))\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { configSchema as ncListAdapterConfigSchema } from './NCListAdapter'\nimport {\n  AdapterClass as JBrowse1TextSearchAdapterClass,\n  configSchema as jbrowse1AdapterConfigSchema,\n} from './JBrowse1TextSeachAdapter'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nimport {\n  configSchema as jbrowse1ConfigSchema,\n  modelFactory as jbrowse1ModelFactory,\n} from './JBrowse1Connection'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'NCListAdapter',\n          configSchema: ncListAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./NCListAdapter/NCListAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /trackData.jsonz?$/i\n          const adapterName = 'NCListAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              rootUrlTemplate: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addTextSearchAdapterType(\n      () =>\n        new TextSearchAdapterType({\n          name: 'JBrowse1TextSearchAdapter',\n          configSchema: jbrowse1AdapterConfigSchema,\n          AdapterClass: JBrowse1TextSearchAdapterClass,\n          description: 'A JBrowse 1 text search adapter',\n        }),\n    )\n\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'JBrowse1Connection',\n          configSchema: jbrowse1ConfigSchema,\n          stateModel: jbrowse1ModelFactory(pluginManager),\n          displayName: 'JBrowse 1 Data',\n          description: 'A JBrowse 1 data directory',\n          url: '//jbrowse.org/',\n        }),\n    )\n  }\n}\n","import React from 'react'\nimport { SvgIcon, SvgIconProps } from '@mui/material'\n\nexport function Curves(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function StraightLines(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z\"\n      />\n    </SvgIcon>\n  )\n}\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { LinearComparativeDisplay as LCD } from '../stateModelFactory'\n\nconst LinearComparativeDisplay: React.FC<{\n  model: LCD\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  return (\n    <div>\n      {/* @ts-ignore */}\n      <model.ReactComponent2 {...props} />\n      {children}\n    </div>\n  )\n}\nLinearComparativeDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nLinearComparativeDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(LinearComparativeDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearComparativeDisplay\n */\nfunction configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\n\nconst useStyles = makeStyles()({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const { classes } = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  })\n\n  return shown ? (\n    <div className={classes.loading}>\n      <LoadingEllipses />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const { classes } = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const { classes } = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n  return model.reactElement\n})\n\nexport default ServerSideRenderedBlockContent\n","import React from 'react'\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport clone from 'clone'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { LinearComparativeViewModel } from '../LinearComparativeView/model'\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\n\n/**\n * #stateModel LinearComparativeDisplay\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        height: 100,\n      }),\n    )\n    .volatile((/* self */) => ({\n      renderInProgress: undefined as AbortController | undefined,\n      filled: false,\n      data: undefined as unknown,\n      reactElement: undefined as React.ReactElement | undefined,\n      message: undefined as string | undefined,\n      renderingComponent: undefined as unknown,\n      ReactComponent2: ServerSideRenderedBlockContent as unknown as React.FC,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      /**\n       * #getter\n       */\n      renderProps() {\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          highResolutionScaling: 2,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setRendered(args?: {\n          data: unknown\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          if (!args) {\n            return\n          }\n          const { data, reactElement, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n\n        /**\n         * #action\n         * controlled by a reaction\n         */\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n    .actions(self => ({\n      afterAttach() {\n        makeAbortableReaction(\n          // @ts-ignore\n          self,\n          renderBlockData,\n          renderBlockEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            delay: 1000,\n            fireImmediately: true,\n          },\n          self.setLoading,\n          self.setRendered,\n          self.setError,\n        )\n      },\n    }))\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self)\n  const display = self\n  const { rendererType } = display\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n\n  return parent.initialized\n    ? {\n        rendererType,\n        rpcManager,\n        renderProps: {\n          ...display.renderProps(),\n          view: clone(getSnapshot(parent)),\n          adapterConfig,\n          rendererType: rendererType.name,\n          sessionId,\n          timeout: 1000000,\n        },\n      }\n    : undefined\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    return\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n\n  // @ts-ignore\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n\n  return { reactElement, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport default stateModelFactory\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n","import {\n  addDisposer,\n  cast,\n  getParent,\n  getPath,\n  getRoot,\n  onAction,\n  resolveIdentifier,\n  types,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\nimport { autorun, transaction } from 'mobx'\n\n// jbrowse\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { MenuItem, ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\n/**\n * #stateModel LinearComparativeView\n */\nfunction stateModelFactory(pluginManager: PluginManager) {\n  const defaultHeight = 400\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        /**\n         * #property\n         */\n        id: ElementId,\n        /**\n         * #property\n         */\n        type: types.literal('LinearComparativeView'),\n        /**\n         * #property\n         */\n        height: defaultHeight,\n        /**\n         * #property\n         */\n        trackSelectorType: 'hierarchical',\n        /**\n         * #property\n         */\n        showIntraviewLinks: true,\n        /**\n         * #property\n         */\n        linkViews: false,\n        /**\n         * #property\n         */\n        interactToggled: false,\n        /**\n         * #property\n         */\n        middleComparativeHeight: 100,\n        /**\n         * #property\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        /**\n         * #property\n         * currently this is limited to an array of two\n         */\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        /**\n         * #property\n         * this represents tracks specific to this view specifically used\n         * for read vs ref dotplots where this track would not really apply\n         * elsewhere\n         */\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      width: undefined as number | undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get highResolutionScaling() {\n        return 2\n      },\n      /**\n       * #getter\n       */\n      get initialized() {\n        return self.width !== undefined && self.views.length > 0\n      },\n\n      /**\n       * #getter\n       */\n      get refNames() {\n        return self.views.map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [...new Set(self.views.map(v => v.assemblyNames).flat())]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(self, param => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n              const actions = [\n                'horizontalScroll',\n                'zoomTo',\n                'setScaleFactor',\n                'showTrack',\n                'hideTrack',\n                'toggleTrack',\n              ]\n              if (actions.includes(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      // automatically removes session assemblies associated with this view\n      // e.g. read vs ref\n      beforeDestroy() {\n        const session = getSession(self)\n        self.assemblyNames.forEach(asm => {\n          session.removeTemporaryAssembly(asm)\n        })\n      },\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      onSubviewAction(actionName: string, path: string, args: any[] = []) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n      /**\n       * #action\n       */\n      setHeight(newHeight: number) {\n        self.height = newHeight\n      },\n\n      /**\n       * #action\n       */\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       * removes the view itself from the state tree entirely by calling the parent removeView\n       */\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      /**\n       * #action\n       */\n      setMiddleComparativeHeight(n: number) {\n        self.middleComparativeHeight = n\n        return self.middleComparativeHeight\n      },\n\n      /**\n       * #action\n       */\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          return undefined\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n\n      /**\n       * #action\n       */\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!configuration) {\n          throw new Error(`track not found ${trackId}`)\n        }\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(d => d.name)\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        self.tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          }),\n        )\n      },\n\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const config = resolveIdentifier(schema, getRoot(self), trackId)\n        const shownTracks = self.tracks.filter(t => t.configuration === config)\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n      /**\n       * #action\n       */\n      squareView() {\n        const bpPerPxs = self.views.map(v => v.bpPerPx)\n        const avg = bpPerPxs.reduce((a, b) => a + b, 0) / bpPerPxs.length\n        self.views.forEach(view => {\n          const center = view.pxToBp(view.width / 2)\n          view.setNewView(avg, view.offsetPx)\n          if (!center.refName) {\n            return\n          }\n          view.centerAt(center.coord, center.refName, center.index)\n        })\n      },\n      /**\n       * #action\n       */\n      clearView() {\n        self.views = cast([])\n        self.tracks = cast([])\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      menuItems() {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems?.()) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems(),\n            })\n          }\n        })\n        menuItems.push({\n          label: 'Return to import form',\n          onClick: () => {\n            getSession(self).queueDialog(handleClose => [\n              ReturnToImportFormDialog,\n              { model: self, handleClose },\n            ])\n          },\n          icon: FolderOpenIcon,\n        })\n        menuItems.push({\n          label: 'Open track selector',\n          onClick: self.activateTrackSelector,\n          icon: TrackSelectorIcon,\n        })\n        return menuItems\n      },\n      /**\n       * #method\n       */\n      rubberBandMenuItems() {\n        return [\n          {\n            label: 'Zoom to region(s)',\n            onClick: () => {\n              self.views.forEach(view => {\n                const { leftOffset, rightOffset } = view\n                if (leftOffset && rightOffset) {\n                  view.moveTo(leftOffset, rightOffset)\n                }\n              })\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (self.initialized) {\n              self.views.forEach(v => v.setWidth(self.width))\n            }\n          }),\n        )\n      },\n    }))\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel =\n  Instance<LinearComparativeViewStateModel>\n\nexport default stateModelFactory\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport baseConfigFactory from '../LinearComparativeDisplay/configSchemaF'\n\n/**\n * #config LinearSyntenyDisplay\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      /**\n       * #slot\n       * currently unused\n       */\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'LinearSyntenyRenderer' },\n      ),\n\n      /**\n       * #slot\n       * currently unused\n       */\n      middle: { type: 'boolean', defaultValue: true },\n    },\n    {\n      /**\n       * #baseConfiguration\n       * this refers to the base linear comparative display\n       */\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { types, Instance } from 'mobx-state-tree'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\nimport baseModelFactory from '../LinearComparativeDisplay/stateModelFactory'\nimport { LinearSyntenyViewModel } from '../LinearSyntenyView/model'\n\n/**\n * #stateModel LinearSyntenyDisplay\n * extends `LinearComparativeDisplay` model\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      /**\n       * #method\n       */\n      renderProps() {\n        const parentView = getContainingView(self) as LinearSyntenyViewModel\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: getConf(self, 'renderer'),\n          width: parentView.width,\n          height: parentView.middleComparativeHeight,\n        }\n      },\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      /**\n       * #getter\n       */\n      get adapterConfig() {\n        return {\n          // @ts-ignore\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n      /**\n       * #getter\n       * unused\n       */\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearPileupDisplayConfigSchemaFactory } from '@jbrowse/plugin-alignments'\n\n/**\n * #config LGVSyntenyDisplay\n */\nfunction configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LGVSyntenyDisplay',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearPileupDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaF\n","import {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport {\n  getSession,\n  getContainingTrack,\n  getContainingView,\n  Feature,\n} from '@jbrowse/core/util'\nimport {\n  MismatchParser,\n  linearPileupDisplayStateModelFactory,\n} from '@jbrowse/plugin-alignments'\nimport { types } from 'mobx-state-tree'\nimport { when } from 'mobx'\n\nconst { parseCigar } = MismatchParser\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nasync function navToSynteny(feature: Feature, self: any) {\n  const session = getSession(self)\n  const track = getContainingTrack(self)\n  const view = getContainingView(self)\n  const reg = view.dynamicBlocks.contentBlocks[0]\n  const cigar = parseCigar(feature.get('cg') || '')\n  const regStart = reg.start\n  const regEnd = reg.end\n  const featStart = feature.get('start')\n  const featEnd = feature.get('end')\n  const mate = feature.get('mate')\n  const mateStart = mate.start\n  const mateEnd = mate.end\n  const mateAsm = mate.assemblyName\n  const mateRef = mate.refName\n  const featAsm = reg.assemblyName\n  const featRef = reg.refName\n\n  let rMateStart = mateStart\n  let rMateEnd = mateStart\n  let rFeatStart = featStart\n  let rFeatEnd = featStart\n\n  if (cigar.length) {\n    for (let i = 0; i < cigar.length && rFeatStart < regStart; i += 2) {\n      const len = +cigar[i]\n      const op = cigar[i + 1]\n      if (op === 'I') {\n        rMateStart += len\n      } else if (op === 'D') {\n        rFeatStart += len\n      } else if (op === 'M') {\n        const l2 = Math.min(len, regStart - rFeatStart)\n\n        rMateStart += l2\n        rFeatStart += l2\n      }\n    }\n    for (let i = 0; i < cigar.length && rFeatEnd < regEnd; i += 2) {\n      const len = +cigar[i]\n      const op = cigar[i + 1]\n      if (op === 'I') {\n        rMateEnd += len\n      } else if (op === 'D') {\n        rFeatEnd += len\n      } else if (op === 'M') {\n        const l2 = Math.min(len, regEnd - rFeatEnd)\n        rMateEnd += l2\n        rFeatEnd += l2\n      }\n    }\n  } else {\n    rFeatEnd = featEnd\n    rMateEnd = mateEnd\n  }\n  const trackId = track.configuration.trackId\n\n  const view2 = session.addView('LinearSyntenyView', {\n    type: 'LinearSyntenyView',\n    views: [\n      {\n        id: `${Math.random()}`,\n        type: 'LinearGenomeView',\n        hideHeader: true,\n      },\n      {\n        id: `${Math.random()}`,\n        type: 'LinearGenomeView',\n        hideHeader: true,\n      },\n    ],\n    tracks: [\n      {\n        configuration: trackId,\n        type: 'SyntenyTrack',\n        displays: [\n          {\n            type: 'LinearSyntenyDisplay',\n            configuration: `${trackId}-LinearSyntenyDisplay`,\n          },\n        ],\n      },\n    ],\n  })\n  const f = (n: number) => Math.floor(n)\n  const l1 = `${featRef}:${f(rFeatStart)}-${f(rFeatEnd)}`\n  const l2 = `${mateRef}:${f(rMateStart)}-${f(rMateEnd)}`\n  await when(() => view2.width !== undefined)\n  // @ts-ignore\n  view2.views[0].navToLocString(l1, featAsm)\n  // @ts-ignore\n  view2.views[1].navToLocString(l2, mateAsm)\n}\n\n/**\n * #stateModel LGVSyntenyDisplay\n * extends `LinearBasicDisplay`, displays location of \"synteny\" featur in a\n * plain LGV, allowing linking out to external synteny views\n */\nfunction stateModelFactory(schema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LGVSyntenyDisplay',\n      linearPileupDisplayStateModelFactory(schema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LGVSyntenyDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(schema),\n      }),\n    )\n    .views(self => {\n      const superContextMenuItems = self.contextMenuItems\n      return {\n        contextMenuItems() {\n          const feature = self.contextMenuFeature\n          return [\n            ...superContextMenuItems(),\n            ...(feature\n              ? [\n                  {\n                    label: 'Open synteny view for this position',\n                    onClick: () => navToSynteny(feature, self),\n                  },\n                ]\n              : []),\n          ]\n        },\n      }\n    })\n}\n\nexport default stateModelFactory\n","import { clamp } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport interface ReducedLinearGenomeView {\n  bpPerPx: number\n  offsetPx: number\n  staticBlocks: Region[]\n  dynamicBlocks: Region[]\n  displayedRegions: Region[]\n  headerHeight: number\n  scaleBarHeight: number\n  height: number\n  features: Feature[]\n  tracks: {\n    scrollTop: number\n    height: number\n    configuration: string\n    skip: number\n  }[]\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nexport function cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: ReducedLinearGenomeView[],\n  trackConfigId: string,\n  level: number,\n) {\n  const heightUpUntilThisPoint = views\n    .slice(0, level)\n    .map(v => v.height + 7)\n    .reduce((a, b) => a + b, 0)\n\n  return (\n    heightUpUntilThisPoint +\n    views[level].headerHeight +\n    views[level].scaleBarHeight +\n    getTrackPos(views[level], trackConfigId) +\n    1\n  )\n}\n\nexport function getTrackPos(\n  view: ReducedLinearGenomeView,\n  trackConfigId: string,\n) {\n  const idx = view.tracks.findIndex(t => t.configuration === trackConfigId)\n  let accum = 0\n  for (let i = 0; i < idx; i += 1) {\n    accum += view.tracks[i].height + 3 // +1px for trackresizehandle\n  }\n  return accum\n}\n\n// Uses bpToPx to get the screen pixel coordinates but ignores some conditions\n// where bpToPx could return undefined\nexport function getPxFromCoordinate(\n  view: ReducedLinearGenomeView,\n  refName: string,\n  coord: number,\n) {\n  return (\n    ((bpToPx(view, { refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n  )\n}\n\n// Retrieves the y-position of a layout record in a track\n// If track not found returns 0\nexport function overlayYPos(\n  trackConfigId: string,\n  level: number,\n  views: ReducedLinearGenomeView[],\n  c: LayoutRecord,\n  cond: boolean,\n) {\n  const track = views[level].tracks.find(t => t.configuration === trackConfigId)\n  const ypos = track\n    ? clamp(c[TOP] - (track.scrollTop || 0), 0, track.height) +\n      heightFromSpecificLevel(views, trackConfigId, level) +\n      track.skip\n    : 0\n\n  return ypos + (cond ? cheight(c) : 0)\n}\n\n// Returns the pixel screen position of a refName:coord input, or undefined if\n// the input could not be located. Uses view.displayedRegions as a representation\n// of what is on the screen\n//\n// Note: does not consider that this refName:coord input could multi-match\nfunction bpToPx(\n  view: ReducedLinearGenomeView,\n  { refName, coord }: { refName: string; coord: number },\n) {\n  let offsetBp = 0\n\n  const index = view.displayedRegions.findIndex(r => {\n    if (refName === r.refName && coord >= r.start && coord <= r.end) {\n      offsetBp += coord - r.start\n      return true\n    }\n    offsetBp += r.end - r.start\n    return false\n  })\n  const foundRegion = view.displayedRegions[index]\n  if (foundRegion) {\n    return {\n      index,\n      offsetPx: Math.round(offsetBp / view.bpPerPx),\n    }\n  }\n  return undefined\n}\n\n// Returns either 0 or height depending on condition\nexport function interstitialYPos(cond: boolean, height: number) {\n  return cond ? 0 : height\n}\n\nexport function* generateMatches(\n  l1: Feature[] = [],\n  l2: Feature[] = [],\n  cb: (arg0: Feature) => number,\n) {\n  let i = 0\n  let j = 0\n  while (i < l1.length && j < l2.length) {\n    const a = cb(l1[i])\n    const b = cb(l2[j])\n    if (a < b) {\n      i++\n    } else if (b < a) {\n      j++\n    } else {\n      yield [l1[i], l2[j]]\n      i++\n      j++\n    }\n  }\n}\n","import React, { useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { Portal, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { usePopper } from 'react-popper'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\n\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n}))\n\nconst SyntenyTooltip = observer(\n  ({ x, y, title }: { x: number; y: number; title: string }) => {\n    const [width, setWidth] = useState(0)\n    const [anchorEl, setAnchorEl] = useState<HTMLDivElement | null>(null)\n    const { classes } = useStyles()\n\n    // must be memoized a la https://github.com/popperjs/react-popper/issues/391\n    const virtElement = useMemo(\n      () => ({\n        getBoundingClientRect: () => {\n          return {\n            top: y,\n            left: x + width / 2,\n            bottom: y,\n            right: x,\n            width: 0,\n            height: 0,\n            x,\n            y,\n            toJSON() {},\n          }\n        },\n      }),\n      [x, y, width],\n    )\n    const { styles, attributes } = usePopper(virtElement, anchorEl)\n\n    return title ? (\n      <Portal>\n        <div\n          ref={ref => {\n            setWidth(ref?.getBoundingClientRect().width || 0)\n            setAnchorEl(ref)\n          }}\n          className={classes.tooltip}\n          // zIndex needed to go over widget drawer\n          style={{ ...styles.popper, zIndex: 100000 }}\n          {...attributes.popper}\n        >\n          <SanitizedHTML html={title} />\n        </div>\n      </Portal>\n    ) : null\n  },\n)\n\nexport default SyntenyTooltip\n","import React, { useState, useRef, useMemo, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot, isAlive } from 'mobx-state-tree'\nimport SimpleFeature, {\n  SimpleFeatureSerialized,\n  Feature,\n} from '@jbrowse/core/util/simpleFeature'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport {\n  assembleLocString,\n  getContainingView,\n  getSession,\n  isSessionModelWithWidgets,\n  ViewSnap,\n  AssemblyManager,\n} from '@jbrowse/core/util'\nimport { bpToPx } from '@jbrowse/core/util/Base1DUtils'\n\n// locals\nimport { interstitialYPos, generateMatches } from '../../util'\nimport { LinearSyntenyViewModel } from '../../LinearSyntenyView/model'\nimport { LinearComparativeDisplay } from '../../LinearComparativeDisplay/stateModelFactory'\nimport SyntenyTooltip from './SyntenyTooltip'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\nconst MAX_COLOR_RANGE = 255 * 255 * 255 // max color range\n\ntype RectTuple = [number, number, number, number]\n\nconst colorMap = {\n  I: '#ff03',\n  N: '#0a03',\n  D: '#00f3',\n  X: 'brown',\n  M: '#f003',\n  '=': '#f003',\n}\n\nfunction getId(r: number, g: number, b: number, unitMultiplier: number) {\n  return Math.floor((r * 255 * 255 + g * 255 + b - 1) / unitMultiplier)\n}\n\nfunction px(view: ViewSnap, arg: { refName: string; coord: number }) {\n  const r = bpToPx({ ...arg, self: view })?.offsetPx\n  if (r === undefined) {\n    console.warn('unknown coord', arg)\n  }\n  return r\n}\n\nfunction drawMatchSimple({\n  match,\n  ctx,\n  offsets,\n  cb,\n  viewSnaps,\n  showIntraviewLinks,\n  hideTiny,\n  height,\n  drawCurves,\n}: {\n  match: {\n    layout: RectTuple\n    feature: Feature\n    level: number\n    refName: string\n  }[]\n  ctx: CanvasRenderingContext2D\n  offsets: number[]\n  cb: (ctx: CanvasRenderingContext2D) => void\n  viewSnaps: ViewSnap[]\n  showIntraviewLinks: boolean\n  hideTiny: boolean\n  height: number\n  drawCurves?: boolean\n}) {\n  // we follow a path in the list of chunks, not from top to bottom, just\n  // in series following x1,y1 -> x2,y2\n  for (let i = 0; i < match.length - 1; i += 1) {\n    const { layout: c1, feature: f1, level: l1, refName: ref1 } = match[i]\n    const { layout: c2, feature: f2, level: l2, refName: ref2 } = match[i + 1]\n    const v1 = viewSnaps[l1]\n    const v2 = viewSnaps[l2]\n\n    if (!c1 || !c2) {\n      console.warn('received null layout for a overlay feature')\n      return\n    }\n\n    // disable rendering connections in a single level\n    if (!showIntraviewLinks && l1 === l2) {\n      continue\n    }\n    const length1 = f1.get('end') - f1.get('start')\n    const length2 = f2.get('end') - f2.get('start')\n\n    if ((length1 < v1.bpPerPx || length2 < v2.bpPerPx) && hideTiny) {\n      continue\n    }\n\n    const px11 = px(v1, { refName: ref1, coord: c1[LEFT] })\n    const px12 = px(v1, { refName: ref1, coord: c1[RIGHT] })\n    const px21 = px(v2, { refName: ref2, coord: c2[LEFT] })\n    const px22 = px(v2, { refName: ref2, coord: c2[RIGHT] })\n    if (\n      px11 === undefined ||\n      px12 === undefined ||\n      px21 === undefined ||\n      px22 === undefined\n    ) {\n      continue\n    }\n\n    const x11 = px11 - offsets[l1]\n    const x12 = px12 - offsets[l1]\n    const x21 = px21 - offsets[l2]\n    const x22 = px22 - offsets[l2]\n\n    const y1 = interstitialYPos(l1 < l2, height)\n    const y2 = interstitialYPos(l2 < l1, height)\n    const mid = (y2 - y1) / 2\n\n    // drawing a line if the results are thin: drawing a line results in much\n    // less pixellation than filling in a thin polygon\n    if (length1 < v1.bpPerPx || length2 < v2.bpPerPx) {\n      ctx.beginPath()\n      ctx.moveTo(x11, y1)\n      if (drawCurves) {\n        ctx.bezierCurveTo(x11, mid, x21, mid, x21, y2)\n      } else {\n        ctx.lineTo(x21, y2)\n      }\n      ctx.stroke()\n    } else {\n      ctx.beginPath()\n      ctx.moveTo(x11, y1)\n      ctx.lineTo(x12, y1)\n      if (drawCurves) {\n        ctx.bezierCurveTo(x12, mid, x22, mid, x22, y2)\n      } else {\n        ctx.lineTo(x22, y2)\n      }\n      ctx.lineTo(x21, y2)\n      if (drawCurves) {\n        ctx.bezierCurveTo(x21, mid, x11, mid, x11, y1)\n      } else {\n        ctx.lineTo(x11, y1)\n      }\n      ctx.closePath()\n      cb(ctx)\n    }\n  }\n}\n\nfunction layoutMatches(\n  features: Feature[][],\n  assemblyManager?: AssemblyManager,\n) {\n  const matches = []\n  for (let i = 0; i < features.length; i++) {\n    for (let j = i; j < features.length; j++) {\n      if (i !== j) {\n        for (const [f1, f2] of generateMatches(features[i], features[j], f =>\n          f.get('syntenyId'),\n        )) {\n          let f1s = f1.get('start')\n          let f1e = f1.get('end')\n          const f2s = f2.get('start')\n          const f2e = f2.get('end')\n          if (f1.get('strand') === -1) {\n            ;[f1e, f1s] = [f1s, f1e]\n          }\n          const a1 = assemblyManager?.get(f1.get('assemblyName'))\n          const a2 = assemblyManager?.get(f2.get('assemblyName'))\n          const r1 = f1.get('refName')\n          const r2 = f2.get('refName')\n\n          matches.push([\n            {\n              feature: f1,\n              level: i,\n              refName: a1?.getCanonicalRefName(f1.get('refName')) || r1,\n              layout: [f1s, 0, f1e, 10] as RectTuple,\n            },\n            {\n              feature: f2,\n              level: j,\n              refName: a2?.getCanonicalRefName(f1.get('refName')) || r2,\n              layout: [f2s, 0, f2e, 10] as RectTuple,\n            },\n          ])\n        }\n      }\n    }\n  }\n  return matches\n}\n\nfunction getResources(model: LinearComparativeDisplay) {\n  const inWorker = !('type' in model)\n  if (!inWorker && isAlive(model)) {\n    const parentView = getContainingView(model) as LinearSyntenyViewModel\n    const color = getConf(model, ['renderer', 'color'])\n    const session = getSession(model)\n    const { assemblyManager } = session\n    return { color, session, parentView, assemblyManager }\n  }\n  return {}\n}\n\nfunction LinearSyntenyRendering({\n  height,\n  width,\n  displayModel,\n  features,\n  trackIds,\n  highResolutionScaling = 1,\n}: {\n  width: number\n  height: number\n  displayModel: LinearComparativeDisplay\n  highResolutionScaling: number\n  features: SimpleFeatureSerialized[][]\n  trackIds: string[]\n}) {\n  // canvas used for drawing visible screen\n  const drawRef = useRef<HTMLCanvasElement>(null)\n\n  // canvas used for drawing click map with feature ids\n  // this renders a unique color per alignment, so that it can be re-traced\n  // after a feature click with getImageData at that pixel\n  const clickMapRef = useRef<HTMLCanvasElement>(null)\n\n  // canvas used for drawing click map with cigar data\n  // this can show if you are mousing over a insertion/deletion. it is similar\n  // in purpose to the clickMapRef but was not feasible to pack this into the\n  // clickMapRef\n  const cigarClickMapRef = useRef<HTMLCanvasElement>(null)\n\n  // canvas for drawing mouseover shading\n  // this is separate from the other code for speed: don't have to redraw\n  // entire canvas to do a feature's mouseover shading\n  const mouseoverRef = useRef<HTMLCanvasElement>(null)\n\n  const [mouseoverId, setMouseoverId] = useState<number>()\n  const [clickId, setClickId] = useState<number>()\n  const [visibleCigarOp, setVisibleCigarOp] = useState('')\n  const [currX, setCurrX] = useState<number>()\n  const [currY, setCurrY] = useState<number>()\n  const { color, assemblyManager, parentView } = getResources(displayModel)\n  const es = useMemo(\n    () =>\n      features.map(level =>\n        level\n          .map(f => new SimpleFeature(f))\n          .sort((a, b) => a.get('syntenyId') - b.get('syntenyId')),\n      ),\n    [features],\n  )\n  const matches = useMemo(\n    () => layoutMatches(es, assemblyManager),\n    [es, assemblyManager],\n  )\n\n  const parsedCIGARs = useMemo(\n    () =>\n      new Map(\n        es.flat().map(f => {\n          const cigar = f.get('cg') || f.get('CIGAR')\n          return [f.id(), cigar ? MismatchParser.parseCigar(cigar) : undefined]\n        }),\n      ),\n    [es],\n  )\n  const drawCurves = parentView?.drawCurves\n  const views = parentView?.views\n  const offsets = views?.map(view => view.offsetPx)\n\n  useEffect(\n    () => {\n      if (\n        !drawRef.current ||\n        !clickMapRef.current ||\n        !cigarClickMapRef.current ||\n        !offsets ||\n        !views ||\n        !isAlive(displayModel)\n      ) {\n        return\n      }\n      const ctx1 = drawRef.current.getContext('2d')\n      const ctx2 = clickMapRef.current.getContext('2d')\n      const ctx3 = cigarClickMapRef.current.getContext('2d')\n\n      if (!ctx1 || !ctx2 || !ctx3) {\n        return\n      }\n\n      ctx2.imageSmoothingEnabled = false\n      ctx3.imageSmoothingEnabled = false\n\n      ctx1.resetTransform()\n      ctx1.scale(highResolutionScaling, highResolutionScaling)\n      ctx1.clearRect(0, 0, width, height)\n      ctx2.clearRect(0, 0, width, height)\n      const showIntraviewLinks = false\n      const hideTiny = false\n      const viewSnaps = views.map(view => ({\n        ...getSnapshot(view),\n        width: view.width,\n        staticBlocks: view.staticBlocks,\n        interRegionPaddingWidth: view.interRegionPaddingWidth,\n        minimumBlockWidth: view.minimumBlockWidth,\n      }))\n      const unitMultiplier = Math.floor(MAX_COLOR_RANGE / matches.length)\n      for (let j = 0; j < matches.length; j++) {\n        const m = matches[j]\n        const idx = j * unitMultiplier + 1\n\n        const r = Math.floor(idx / (255 * 255)) % 255\n        const g = Math.floor(idx / 255) % 255\n        const b = idx % 255\n        ctx1.fillStyle = colorMap.M\n        ctx1.strokeStyle = colorMap.M\n        ctx2.fillStyle = `rgb(${r},${g},${b})`\n\n        // too many click map false positives with colored stroked lines\n        // ctx2.strokeStyle = `rgb(${r},${g},${b})`\n        drawMatchSimple({\n          cb: ctx => ctx.fill(),\n          match: m,\n          ctx: ctx2,\n          drawCurves,\n          offsets,\n          hideTiny,\n          height,\n          viewSnaps,\n          showIntraviewLinks,\n        })\n\n        // we follow a path in the list of chunks, not from top to bottom, just\n        // in series following x1,y1 -> x2,y2\n        for (let i = 0; i < m.length - 1; i += 1) {\n          const { layout: c1, feature: f1, level: l1, refName: ref1 } = m[i]\n          const { layout: c2, feature: f2, level: l2, refName: ref2 } = m[i + 1]\n          const v1 = viewSnaps[l1]\n          const v2 = viewSnaps[l2]\n\n          if (!c1 || !c2) {\n            console.warn('received null layout for a overlay feature')\n            return\n          }\n\n          // disable rendering connections in a single level\n          if (!showIntraviewLinks && l1 === l2) {\n            continue\n          }\n          const length1 = f1.get('end') - f1.get('start')\n          const length2 = f2.get('end') - f2.get('start')\n\n          if ((length1 < v1.bpPerPx || length2 < v2.bpPerPx) && hideTiny) {\n            continue\n          }\n\n          const px11 = px(v1, { refName: ref1, coord: c1[LEFT] })\n          const px12 = px(v1, { refName: ref1, coord: c1[RIGHT] })\n          const px21 = px(v2, { refName: ref2, coord: c2[LEFT] })\n          const px22 = px(v2, { refName: ref2, coord: c2[RIGHT] })\n          if (\n            px11 === undefined ||\n            px12 === undefined ||\n            px21 === undefined ||\n            px22 === undefined\n          ) {\n            continue\n          }\n\n          const x11 = px11 - offsets[l1]\n          const x12 = px12 - offsets[l1]\n          const x21 = px21 - offsets[l2]\n          const x22 = px22 - offsets[l2]\n\n          const y1 = interstitialYPos(l1 < l2, height)\n          const y2 = interstitialYPos(l2 < l1, height)\n\n          const mid = (y2 - y1) / 2\n\n          // drawing a line if the results are thin results in much less\n          // pixellation than filling in a thin polygon\n          if (length1 < v1.bpPerPx || length2 < v2.bpPerPx) {\n            ctx1.beginPath()\n            ctx1.moveTo(x11, y1)\n            if (drawCurves) {\n              ctx1.bezierCurveTo(x11, mid, x21, mid, x21, y2)\n            } else {\n              ctx1.lineTo(x21, y2)\n            }\n            ctx1.stroke()\n          } else {\n            let cx1 = x11\n            let cx2 = x21\n\n            // we have to read the CIGAR backwards when looking at negative strand features\n            const f1flipped = f1.get('revCigar') && f1.get('strand') === -1\n            const flipInsDel = f1.get('flipInsDel')\n\n            // flip the direction of the CIGAR drawing in horizontally flipped\n            // modes\n            const rev1 = x11 < x12 ? 1 : -1\n            const rev2 = x21 < x22 ? 1 : -1\n\n            const cigar = parsedCIGARs.get(f1.id())\n            if (cigar) {\n              // continuingFlag helps speed up zoomed out by skipping draw\n              // commands on very small CIGAR features\n              let continuingFlag = false\n              let px1 = 0\n              let px2 = 0\n              const unitMultiplier2 = Math.floor(MAX_COLOR_RANGE / cigar.length)\n              for (\n                let j = f1flipped ? cigar.length - 2 : 0;\n                f1flipped ? j >= 0 : j < cigar.length;\n                j += f1flipped ? -2 : 2\n              ) {\n                const idx = j * unitMultiplier2 + 1\n                const r = Math.floor(idx / (255 * 255)) % 255\n                const g = Math.floor(idx / 255) % 255\n                const b = idx % 255\n                ctx3.fillStyle = `rgb(${r},${g},${b})`\n                const len = +cigar[j]\n                const op = cigar[j + 1] as keyof typeof colorMap\n\n                if (!continuingFlag) {\n                  px1 = cx1\n                  px2 = cx2\n                }\n\n                const d1 = len / viewSnaps[0].bpPerPx\n                const d2 = len / viewSnaps[1].bpPerPx\n\n                if (op === 'M' || op === '=' || op === 'X') {\n                  cx1 += d1 * rev1\n                  cx2 += d2 * rev2\n                } else if (op === 'D' || op === 'N') {\n                  if (flipInsDel) {\n                    cx2 += d2 * rev2\n                  } else {\n                    cx1 += d1 * rev1\n                  }\n                } else if (op === 'I') {\n                  if (flipInsDel) {\n                    cx1 += d1 * rev1\n                  } else {\n                    cx2 += d2 * rev2\n                  }\n                }\n\n                // check that we are even drawing in view here, e.g. that all\n                // points are not all less than 0 or greater than width\n                if (\n                  !(\n                    Math.max(px1, px2, cx1, cx2) < 0 ||\n                    Math.min(px1, px2, cx1, cx2) > width\n                  )\n                ) {\n                  // if it is a small feature and not the last element of the\n                  // CIGAR (which could skip rendering it entire if we did turn\n                  // it on), then turn on continuing flag\n                  const isNotLast = f1flipped ? j > 2 : j < cigar.length - 2\n                  if (\n                    Math.abs(cx1 - px1) < 1 &&\n                    Math.abs(cx2 - px2) < 1 &&\n                    isNotLast\n                  ) {\n                    continuingFlag = true\n                  } else {\n                    continuingFlag = false\n\n                    // allow rendering the dominant color when using continuing\n                    // flag if the last element of continuing was a large\n                    // feature, else just use match\n                    ctx1.fillStyle =\n                      colorMap[(continuingFlag && d1 > 1) || d2 > 1 ? op : 'M']\n\n                    ctx1.beginPath()\n                    ctx3.beginPath()\n                    ctx1.moveTo(px1, y1)\n                    ctx3.moveTo(px1, y1)\n                    ctx1.lineTo(cx1, y1)\n                    ctx3.lineTo(cx1, y1)\n                    if (drawCurves) {\n                      ctx1.bezierCurveTo(cx1, mid, cx2, mid, cx2, y2)\n                      ctx3.bezierCurveTo(cx1, mid, cx2, mid, cx2, y2)\n                    } else {\n                      ctx1.lineTo(cx2, y2)\n                      ctx3.lineTo(cx2, y2)\n                    }\n                    ctx1.lineTo(px2, y2)\n                    ctx3.lineTo(px2, y2)\n                    if (drawCurves) {\n                      ctx1.bezierCurveTo(px2, mid, px1, mid, px1, y1)\n                      ctx3.bezierCurveTo(px2, mid, px1, mid, px1, y1)\n                    } else {\n                      ctx1.lineTo(px1, y1)\n                      ctx3.lineTo(px1, y1)\n                    }\n                    ctx1.closePath()\n                    ctx3.closePath()\n                    ctx1.fill()\n                    ctx3.fill()\n                  }\n                }\n              }\n            } else {\n              ctx1.beginPath()\n              ctx1.moveTo(x11, y1)\n              ctx1.lineTo(x12, y1)\n              if (drawCurves) {\n                ctx1.bezierCurveTo(x12, mid, x22, mid, x22, y2)\n              } else {\n                ctx1.lineTo(x22, y2)\n              }\n              ctx1.lineTo(x21, y2)\n              if (drawCurves) {\n                ctx1.bezierCurveTo(x21, mid, x11, mid, x11, y1)\n              } else {\n                ctx1.lineTo(x11, y1)\n              }\n              ctx1.closePath()\n              ctx1.fill()\n            }\n          }\n        }\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      displayModel,\n      highResolutionScaling,\n      trackIds,\n      width,\n      drawCurves,\n      color,\n      height,\n      matches,\n      parsedCIGARs,\n      // these are checked with a JSON.stringify to help compat with mobx\n      JSON.stringify(views), // eslint-disable-line  react-hooks/exhaustive-deps\n      JSON.stringify(offsets), // eslint-disable-line  react-hooks/exhaustive-deps\n    ],\n  )\n\n  // draw mouseover shading on the mouseover'd ID\n  useEffect(\n    () => {\n      if (\n        !mouseoverRef.current ||\n        !offsets ||\n        !views ||\n        !isAlive(displayModel)\n      ) {\n        return\n      }\n      const ctx = mouseoverRef.current.getContext('2d')\n      if (!ctx) {\n        return\n      }\n      ctx.resetTransform()\n      ctx.scale(highResolutionScaling, highResolutionScaling)\n      ctx.clearRect(0, 0, width, height)\n      const showIntraviewLinks = false\n      const hideTiny = false\n      const viewSnaps = views.map(view => ({\n        ...getSnapshot(view),\n        staticBlocks: view.staticBlocks,\n        width: view.width,\n        interRegionPaddingWidth: view.interRegionPaddingWidth,\n        minimumBlockWidth: view.minimumBlockWidth,\n      }))\n\n      if (mouseoverId !== undefined && matches[mouseoverId]) {\n        const m = matches[mouseoverId]\n        ctx.fillStyle = 'rgb(0,0,0,0.1)'\n        drawMatchSimple({\n          match: m,\n          ctx,\n          offsets,\n          cb: ctx => ctx.fill(),\n          showIntraviewLinks,\n          height,\n          hideTiny,\n          viewSnaps,\n          drawCurves,\n        })\n      }\n\n      if (clickId !== undefined && matches[clickId]) {\n        const m = matches[clickId]\n        ctx.strokeStyle = 'rgb(0, 0, 0, 0.9)'\n        drawMatchSimple({\n          match: m,\n          ctx,\n          offsets,\n          cb: ctx => ctx.stroke(),\n          showIntraviewLinks,\n          height,\n          hideTiny,\n          viewSnaps,\n          drawCurves,\n        })\n      }\n    },\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      displayModel,\n      highResolutionScaling,\n      trackIds,\n      width,\n      drawCurves,\n      color,\n      height,\n      matches,\n      parsedCIGARs,\n      mouseoverId,\n      clickId,\n      // these are checked with a JSON.stringify to help compat with mobx\n      JSON.stringify(views), // eslint-disable-line  react-hooks/exhaustive-deps\n      JSON.stringify(offsets), // eslint-disable-line  react-hooks/exhaustive-deps\n    ],\n  )\n\n  return (\n    <div style={{ position: 'relative' }}>\n      <canvas\n        ref={mouseoverRef}\n        width={width}\n        height={height}\n        style={{ width, height, position: 'absolute', pointerEvents: 'none' }}\n      />\n      <canvas\n        ref={drawRef}\n        onMouseMove={event => {\n          const ref1 = clickMapRef.current\n          const ref2 = cigarClickMapRef.current\n          if (!ref1 || !ref2) {\n            return\n          }\n          const rect = ref1.getBoundingClientRect()\n\n          const ctx1 = ref1.getContext('2d')\n          const ctx2 = ref2.getContext('2d')\n          if (!ctx1 || !ctx2) {\n            return\n          }\n          const { clientX, clientY } = event\n          const x = clientX - rect.left\n          const y = clientY - rect.top\n          setCurrX(clientX)\n          setCurrY(clientY)\n\n          const [r1, g1, b1] = ctx1.getImageData(x, y, 1, 1).data\n          const [r2, g2, b2] = ctx2.getImageData(x, y, 1, 1).data\n          const unitMultiplier = Math.floor(MAX_COLOR_RANGE / matches.length)\n          const id = getId(r1, g1, b1, unitMultiplier)\n          const match1 = matches[id]\n          setMouseoverId(id < 0 ? undefined : id)\n          if (!match1) {\n            setVisibleCigarOp('')\n            return\n          }\n          const cigar = parsedCIGARs.get(match1[0].feature.id()) || []\n          const unitMultiplier2 = Math.floor(MAX_COLOR_RANGE / cigar.length)\n          const cigarIdx = getId(r2, g2, b2, unitMultiplier2)\n          const f1 = match1[0].feature\n          const f2 = match1[1].feature\n          const l1 = f1.get('end') - f1.get('start')\n          const l2 = f2.get('end') - f2.get('start')\n          const identity = f1.get('identity')\n          const n1 = f1.get('name')\n          const n2 = f2.get('name')\n          const tooltip = [`Query len: ${l1}<br/>Target len: ${l2}`]\n          if (identity) {\n            tooltip.push(`Identity: ${identity}`)\n          }\n          if (identity) {\n            // @ts-ignore\n            tooltip.push(`Loc1: ${assembleLocString(f1.toJSON())}`)\n            // @ts-ignore\n            tooltip.push(`Loc2: ${assembleLocString(f2.toJSON())}`)\n          }\n\n          if (cigar[cigarIdx]) {\n            tooltip.push(\n              `CIGAR operator: ${cigar[cigarIdx]}${cigar[cigarIdx + 1]}`,\n            )\n          }\n          if (n1 && n2) {\n            tooltip.push(`Name 1: ${n1}`)\n            tooltip.push(`Name 2: ${n2}`)\n          }\n          setVisibleCigarOp(tooltip.join('<br/>'))\n        }}\n        onMouseLeave={() => setMouseoverId(undefined)}\n        onClick={event => {\n          const ref1 = clickMapRef.current\n          const ref2 = cigarClickMapRef.current\n          if (!ref1 || !ref2) {\n            return\n          }\n          const rect = ref1.getBoundingClientRect()\n\n          const ctx1 = ref1.getContext('2d')\n          const ctx2 = ref2.getContext('2d')\n          if (!ctx1 || !ctx2) {\n            return\n          }\n          const x = event.clientX - rect.left\n          const y = event.clientY - rect.top\n\n          const [r1, g1, b1] = ctx1.getImageData(x, y, 1, 1).data\n          const unitMultiplier = Math.floor(MAX_COLOR_RANGE / matches.length)\n          const id = getId(r1, g1, b1, unitMultiplier)\n          const match1 = matches[id]\n          const session = getSession(displayModel)\n          setClickId(id < 0 ? undefined : id)\n          if (match1 && isSessionModelWithWidgets(session)) {\n            session.showWidget(\n              session.addWidget('SyntenyFeatureWidget', 'syntenyFeature', {\n                featureData: {\n                  feature1: match1[0].feature,\n                  feature2: match1[1].feature,\n                },\n              }),\n            )\n          }\n        }}\n        data-testid=\"synteny_canvas\"\n        style={{ width, height, position: 'absolute' }}\n        width={width * highResolutionScaling}\n        height={height * highResolutionScaling}\n      />\n      <canvas\n        ref={clickMapRef}\n        style={{\n          imageRendering: 'pixelated',\n          pointerEvents: 'none',\n          visibility: 'hidden',\n          position: 'absolute',\n        }}\n        width={width}\n        height={height}\n      />\n      <canvas\n        ref={cigarClickMapRef}\n        style={{\n          imageRendering: 'pixelated',\n          pointerEvents: 'none',\n          visibility: 'hidden',\n          position: 'absolute',\n        }}\n        width={width}\n        height={height}\n      />\n      {mouseoverId !== undefined && currX && currY ? (\n        <SyntenyTooltip x={currX} y={currY} title={visibleCigarOp} />\n      ) : null}\n    </div>\n  )\n}\n\nexport default observer(LinearSyntenyRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config LinearSyntenyRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst LinearSyntenyRenderer = ConfigurationSchema(\n  'LinearSyntenyRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'rgb(255,100,100,0.3)',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default LinearSyntenyRenderer\n","import ComparativeServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport React from 'react'\n\nexport default class LinearSyntenyRenderer extends ComparativeServerSideRendererType {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async renameRegionsIfNeeded(args: any) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n\n    if (!assemblyManager) {\n      throw new Error('No assembly manager provided')\n    }\n    const {\n      view: { views },\n    } = args\n\n    for (let i = 0; i < views.length; i++) {\n      const view = views[i]\n      view.displayedRegions = (\n        await renameRegionsIfNeeded(assemblyManager, {\n          sessionId: args.sessionId,\n          regions: view.displayedRegions,\n          adapterConfig: args.adapterConfig,\n        })\n      ).regions\n    }\n\n    return args\n  }\n  async render(renderProps: {\n    height: number\n    width: number\n    view: { views: Base1DViewModel[] }\n  }) {\n    const { width, view } = renderProps\n    const realizedViews = view.views.map(snap => Base1DView.create(snap))\n    realizedViews.forEach(v => v.setVolatileWidth(width))\n    const features = await Promise.all(\n      realizedViews.map(view =>\n        this.getFeatures({\n          ...renderProps,\n          regions: view.staticBlocks.contentBlocks,\n        }),\n      ),\n    )\n\n    const serializedFeatures = JSON.parse(JSON.stringify(features))\n    for (let i = 0; i < serializedFeatures.length; i++) {\n      for (let j = 0; j < serializedFeatures[i].length; j++) {\n        // eslint-disable-next-line no-underscore-dangle\n        serializedFeatures[i][j]._level = i\n      }\n    }\n\n    return {\n      reactElement: React.createElement(this.ReactComponent, {\n        ...renderProps,\n        features,\n      }),\n      features: serializedFeatures,\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// icons\nimport CropFreeIcon from '@mui/icons-material/CropFree'\nimport LinkIcon from '@mui/icons-material/Link'\nimport LinkOffIcon from '@mui/icons-material/LinkOff'\nimport { Curves, StraightLines } from './components/Icons'\n\n// locals\nimport baseModel from '../LinearComparativeView/model'\n\n/**\n * #stateModel LinearSyntenyView\n * extends the `LinearComparativeView` base model\n */\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      baseModel(pluginManager),\n      types\n        .model('LinearSyntenyView', {\n          /**\n           * #property\n           */\n          type: types.literal('LinearSyntenyView'),\n          /**\n           * #property\n           */\n          drawCurves: false,\n        })\n        .actions(self => ({\n          /**\n           * #action\n           */\n          toggleCurves() {\n            self.drawCurves = !self.drawCurves\n          },\n        })),\n    )\n    .views(self => {\n      const superMenuItems = self.menuItems\n      return {\n        /**\n         * #method\n         * adds functions to draw curves and square the view\n         */\n        menuItems() {\n          return [\n            ...superMenuItems(),\n\n            {\n              label: 'Square view',\n              onClick: self.squareView,\n              description:\n                'Makes both views use the same zoom level, adjusting to the average of each',\n              icon: CropFreeIcon,\n            },\n            {\n              label: self.linkViews ? 'Unlink views' : 'Link views',\n              onClick: self.toggleLinkViews,\n              icon: self.linkViews ? LinkOffIcon : LinkIcon,\n            },\n            {\n              label: self.drawCurves\n                ? 'Use straight lines'\n                : 'Use curved lines',\n              onClick: self.toggleCurves,\n              icon: self.drawCurves ? StraightLines : Curves,\n            },\n          ]\n        },\n      }\n    })\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { LinearSyntenyViewModel } from './LinearSyntenyView/model'\nimport { when } from 'mobx'\n\ntype LSV = LinearSyntenyViewModel\n\nexport default function LaunchLinearSyntenyView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearSyntenyView',\n    // @ts-ignore\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const { assemblyManager } = session\n        const model = session.addView('LinearSyntenyView', {}) as LSV\n\n        await when(() => !!model.width)\n\n        model.setViews(\n          await Promise.all(\n            views.map(async view => {\n              const asm = await assemblyManager.waitForAssembly(view.assembly)\n              if (!asm) {\n                throw new Error(`Assembly ${view.assembly} failed to load`)\n              }\n              return {\n                type: 'LinearGenomeView' as const,\n                bpPerPx: 1,\n                offsetPx: 0,\n                hideHeader: true,\n                displayedRegions: asm.regions,\n              }\n            }),\n          ),\n        )\n\n        await Promise.all(model.views.map(view => when(() => view.initialized)))\n\n        const idsNotFound = [] as string[]\n        for (let i = 0; i < views.length; i++) {\n          const view = model.views[i]\n          const { loc, tracks = [] } = views[i]\n\n          view.navToLocString(loc)\n          tracks.forEach(track => tryTrack(view, track, idsNotFound))\n        }\n\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notify(`${e}`, 'error')\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config SyntenyTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'SyntenyTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('SyntenyFeatureWidget', {})\n\nconst stateModel = types\n  .model('SyntenyFeatureWidget', {\n    id: ElementId,\n    type: types.literal('SyntenyFeatureWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data: unknown) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'SyntenyFeatureWidget',\n        heading: 'Synteny feature details',\n        configSchema,\n        stateModel,\n        ReactComponent: lazy(() => import('./SyntenyFeatureDetail')),\n      }),\n  )\n}\n","import { Feature } from '@jbrowse/core/util'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\n\nconst { parseCigar } = MismatchParser\n\nexport function getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nexport function getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\nexport function getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\nexport function mergeIntervals<T extends { start: number; end: number }>(\n  intervals: T[],\n  w = 5000,\n) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = []\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0])\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n    top = stack[stack.length - 1]\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i].start - w) {\n      stack.push(intervals[i])\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i].end) {\n      top.end = Math.max(top.end, intervals[i].end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n","import React, { useEffect, useState } from 'react'\nimport {\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSession, getContainingView, Feature } from '@jbrowse/core/util'\n\n// locals\nimport {\n  getClip,\n  getLength,\n  getLengthOnRef,\n  getLengthSansClipping,\n  getTag,\n  mergeIntervals,\n} from './util'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  strand: number\n  seqLength: number\n  syntenyId?: number\n  uniqueId: string\n  mate: {\n    refName: string\n    start: number\n    end: number\n    syntenyId?: number\n    uniqueId?: string\n  }\n}\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    width: 300,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\ninterface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\n// hashmap of refName->array of features\ntype FeaturesPerRef = { [key: string]: BasicFeature[] }\n\nfunction gatherOverlaps(regions: BasicFeature[]) {\n  const groups = regions.reduce((memo, x) => {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName].push(x)\n    return memo\n  }, {} as FeaturesPerRef)\n\n  return Object.values(groups)\n    .map(group => mergeIntervals(group.sort((a, b) => a.start - b.start)))\n    .flat()\n}\n\nexport default function ReadVsRefDialog({\n  track,\n  feature: preFeature,\n  handleClose,\n}: {\n  feature: Feature\n  handleClose: () => void\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  track: any\n}) {\n  const { classes } = useStyles()\n\n  // window size stored as string, because it corresponds to a textfield which\n  // is parsed as number on submit\n  const [windowSizeText, setWindowSize] = useState('0')\n  const [error, setError] = useState<unknown>()\n  const [primaryFeature, setPrimaryFeature] = useState<Feature>()\n  const windowSize = +windowSizeText\n\n  // we need to fetch the primary alignment if the selected feature is 2048.\n  // this should be the first in the list of the SA tag\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      setError(undefined)\n      try {\n        if (preFeature.get('flags') & 2048) {\n          const SA: string = getTag(preFeature, 'SA') || ''\n          const primaryAln = SA.split(';')[0]\n          const [saRef, saStart] = primaryAln.split(',')\n          const { rpcManager } = getSession(track)\n          const adapterConfig = getConf(track, 'adapter')\n          const sessionId = getRpcSessionId(track)\n\n          const feats = (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n            adapterConfig,\n            sessionId,\n            regions: [\n              {\n                refName: saRef,\n                start: +saStart - 1,\n                end: +saStart,\n              },\n            ],\n          })) as Feature[]\n\n          const result = feats.find(\n            f =>\n              f.get('name') === preFeature.get('name') &&\n              !(f.get('flags') & 2048),\n          )\n          if (result) {\n            if (!done) {\n              setPrimaryFeature(result)\n            }\n          } else {\n            throw new Error('primary feature not found')\n          }\n        } else {\n          setPrimaryFeature(preFeature)\n        }\n      } catch (e) {\n        console.error(e)\n        setError(e)\n      }\n    })()\n\n    return () => {\n      done = true\n    }\n  }, [preFeature, track])\n\n  function onSubmit() {\n    try {\n      if (!primaryFeature) {\n        return\n      }\n      const feature = primaryFeature\n      const session = getSession(track)\n      const view = getContainingView(track)\n      const cigar = feature.get('CIGAR') as string\n      const flags = feature.get('flags') as number\n      const origStrand = feature.get('strand') as number\n      const SA = (getTag(feature, 'SA') as string) || ''\n      const readName = feature.get('name') as string\n      const clipPos = getClip(cigar, 1)\n\n      const readAssembly = `${readName}_assembly_${Date.now()}`\n      const [trackAssembly] = getConf(track, 'assemblyNames')\n      const assemblyNames = [trackAssembly, readAssembly]\n      const trackId = `track-${Date.now()}`\n      const trackName = `${readName}_vs_${trackAssembly}`\n\n      // get the canonical refname for the read because if the\n      // read.get('refName') is chr1 and the actual fasta refName is 1 then no\n      // tracks can be opened on the top panel of the linear read vs ref\n      const { assemblyManager } = session\n      const assembly = assemblyManager.get(trackAssembly)\n\n      const supplementaryAlignments = SA.split(';')\n        .filter(aln => !!aln)\n        .map((aln, index) => {\n          const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n          const saLengthOnRef = getLengthOnRef(saCigar)\n          const saLength = getLength(saCigar)\n          const saLengthSansClipping = getLengthSansClipping(saCigar)\n          const saStrandNormalized = saStrand === '-' ? -1 : 1\n          const saClipPos = getClip(saCigar, saStrandNormalized * origStrand)\n          const saRealStart = +saStart - 1\n          return {\n            refName: saRef,\n            start: saRealStart,\n            end: saRealStart + saLengthOnRef,\n            seqLength: saLength,\n            clipPos: saClipPos,\n            CIGAR: saCigar,\n            assemblyName: trackAssembly,\n            strand: origStrand * saStrandNormalized,\n            uniqueId: `${feature.id()}_SA${index}`,\n            mate: {\n              start: saClipPos,\n              end: saClipPos + saLengthSansClipping,\n              refName: readName,\n            },\n          }\n        })\n\n      const feat = feature.toJSON()\n      feat.clipPos = clipPos\n      feat.strand = 1\n\n      feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n      }\n\n      // if secondary alignment or supplementary, calculate length from SA[0]'s\n      // CIGAR which is the primary alignments. otherwise it is the primary\n      // alignment just use seq.length if primary alignment\n      const totalLength =\n        flags & 2048\n          ? getLength(supplementaryAlignments[0].CIGAR)\n          : getLength(cigar)\n\n      const features = [feat, ...supplementaryAlignments] as ReducedFeature[]\n\n      features.forEach((f, index) => {\n        f.refName = assembly?.getCanonicalRefName(f.refName) || f.refName\n        f.syntenyId = index\n        f.mate.syntenyId = index\n        f.mate.uniqueId = `${f.uniqueId}_mate`\n      })\n      features.sort((a, b) => a.clipPos - b.clipPos)\n\n      const featSeq = feature.get('seq') as string\n\n      // the config feature store includes synthetic mate features\n      // mapped to the read assembly\n      const configFeatureStore = features.concat(\n        // @ts-ignore\n        features.map(f => f.mate),\n      )\n\n      const expand = 2 * windowSize\n      const refLen = features.reduce((a, f) => a + f.end - f.start + expand, 0)\n\n      const seqTrackId = `${readName}_${Date.now()}`\n      const sequenceTrackConf = getConf(assembly, 'sequence')\n      const lgvRegions = gatherOverlaps(\n        features.map(f => ({\n          ...f,\n          start: Math.max(0, f.start - windowSize),\n          end: f.end + windowSize,\n          assemblyName: trackAssembly,\n        })),\n      )\n\n      session.addTemporaryAssembly({\n        name: `${readAssembly}`,\n        sequence: {\n          type: 'ReferenceSequenceTrack',\n          name: `Read sequence`,\n          trackId: seqTrackId,\n          assemblyNames: [readAssembly],\n          adapter: {\n            type: 'FromConfigSequenceAdapter',\n            noAssemblyManager: true,\n            features: [\n              {\n                start: 0,\n                end: totalLength,\n                seq: featSeq,\n                refName: readName,\n                uniqueId: `${Math.random()}`,\n              },\n            ],\n          },\n        },\n      })\n\n      session.addView('LinearSyntenyView', {\n        type: 'LinearSyntenyView',\n        views: [\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: refLen / view.width,\n            displayedRegions: lgvRegions,\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                assemblyNames: [trackAssembly],\n                configuration: sequenceTrackConf.trackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: true,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n            ],\n          },\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: totalLength / view.width,\n            displayedRegions: [\n              {\n                assemblyName: readAssembly,\n                start: 0,\n                end: totalLength,\n                refName: readName,\n              },\n            ],\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                configuration: seqTrackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: true,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n            ],\n          },\n        ],\n        viewTrackConfigs: [\n          {\n            type: 'SyntenyTrack',\n            assemblyNames,\n            adapter: {\n              type: 'FromConfigAdapter',\n              features: configFeatureStore,\n            },\n            trackId,\n            name: trackName,\n          },\n        ],\n        tracks: [\n          {\n            configuration: trackId,\n            type: 'SyntenyTrack',\n            displays: [\n              {\n                type: 'LinearSyntenyDisplay',\n                configuration: `${trackId}-LinearSyntenyDisplay`,\n              },\n            ],\n          },\n        ],\n        displayName: `${readName} vs ${trackAssembly}`,\n      })\n      handleClose()\n    } catch (e) {\n      console.error(e)\n      setError(e)\n    }\n  }\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Set window size\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <Typography color=\"error\">{`${error}`}</Typography>\n        ) : !primaryFeature ? (\n          <div>\n            <Typography>\n              To accurately perform comparison we are fetching the primary\n              alignment. Loading primary feature...\n            </Typography>\n            <CircularProgress />\n          </div>\n        ) : (\n          <div className={classes.root}>\n            <Typography>\n              Show an extra window size around each part of the split alignment.\n              Using a larger value can allow you to see more genomic context.\n            </Typography>\n\n            <TextField\n              value={windowSize}\n              onChange={event => setWindowSize(event.target.value)}\n              label=\"Set window size\"\n            />\n          </div>\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button variant=\"contained\" color=\"secondary\" onClick={handleClose}>\n          Cancel\n        </Button>\n        <Button\n          disabled={!primaryFeature}\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={onSubmit}\n        >\n          Submit\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport CalendarIcon from '@mui/icons-material/CalendarViewDay'\nimport LinearComparativeDisplayF from './LinearComparativeDisplay'\nimport LinearComparativeViewF from './LinearComparativeView'\nimport LinearSyntenyDisplayF from './LinearSyntenyDisplay'\nimport LGVSyntenyDisplayF from './LGVSyntenyDisplay'\nimport LinearSyntenyRendererF from './LinearSyntenyRenderer'\nimport LinearSyntenyViewF from './LinearSyntenyView'\nimport LaunchLinearSyntenyViewF from './LaunchLinearSyntenyView'\nimport SyntenyTrackF from './SyntenyTrack'\nimport SyntenyFeatureWidgetF from './SyntenyFeatureDetail'\nimport LinearReadVsRefMenuItem from './LinearReadVsRef'\n\nexport default class extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    LinearComparativeViewF(pluginManager)\n    LinearSyntenyViewF(pluginManager)\n    LinearSyntenyRendererF(pluginManager)\n    LinearComparativeDisplayF(pluginManager)\n    LinearSyntenyDisplayF(pluginManager)\n    LGVSyntenyDisplayF(pluginManager)\n    LaunchLinearSyntenyViewF(pluginManager)\n    SyntenyTrackF(pluginManager)\n    SyntenyFeatureWidgetF(pluginManager)\n    LinearReadVsRefMenuItem(pluginManager)\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n  }\n}\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pm: PluginManager) => {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'SyntenyTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'SyntenyTrack', configSchema),\n    })\n  })\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport modelFactory from './model'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearComparativeView',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearComparativeView')),\n    })\n  })\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'LinearSyntenyView',\n      stateModel: modelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/LinearSyntenyView')),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './components/LinearSyntenyRendering'\nimport configSchema from './configSchema'\nimport LinearSyntenyRenderer from './LinearSyntenyRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new LinearSyntenyRenderer({\n        name: 'LinearSyntenyRenderer',\n        configSchema,\n        ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './components/LinearComparativeDisplay'\nimport configSchemaFactory from './configSchemaF'\nimport stateModelFactory from './stateModelFactory'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearComparativeDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearComparativeView',\n      ReactComponent,\n    })\n  })\n}\n\nexport { ReactComponent }\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ReactComponent } from '../LinearComparativeDisplay'\nimport configSchemaF from './configSchemaF'\nimport stateModelFactory from './stateModelFactory'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearSyntenyDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearSyntenyView',\n      ReactComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport configSchemaF from './configSchemaF'\nimport stateModelF from './stateModelFactory'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'LGVSyntenyDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\nimport { getSession, getContainingTrack } from '@jbrowse/core/util'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\n\n// locals\nimport ReadVsRefDialog from './LinearReadVsRef'\n\nfunction isDisplay(elt: { name: string }): elt is DisplayType {\n  return elt.name === 'LinearPileupDisplay'\n}\n\nexport default function (pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'Core-extendPluggableElement',\n    (pluggableElement: PluggableElementType) => {\n      if (!isDisplay(pluggableElement)) {\n        return pluggableElement\n      }\n      pluggableElement.stateModel = pluggableElement.stateModel.extend(self => {\n        const superContextMenuItems = self.contextMenuItems\n        return {\n          views: {\n            contextMenuItems() {\n              const feature = self.contextMenuFeature\n              const track = getContainingTrack(self)\n              return [\n                ...superContextMenuItems(),\n                ...(feature\n                  ? [\n                      {\n                        label: 'Linear read vs ref',\n                        icon: AddIcon,\n                        onClick: () => {\n                          getSession(self).queueDialog(handleClose => [\n                            ReadVsRefDialog,\n                            {\n                              track,\n                              feature,\n                              handleClose,\n                            },\n                          ])\n                        },\n                      },\n                    ]\n                  : []),\n              ]\n            },\n          },\n        }\n      })\n      return pluggableElement\n    },\n  )\n}\n","import React from 'react'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles()(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.primary,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\nconst ContentBlock = observer(\n  ({ block, children }: { block: BaseBlock; children: React.ReactNode }) => {\n    const { classes } = useStyles()\n    const { widthPx } = block\n    return (\n      <div style={{ width: widthPx }} className={classes.contentBlock}>\n        {children}\n      </div>\n    )\n  },\n)\n\nfunction ElidedBlock({ width }: { width: number }) {\n  const { classes } = useStyles()\n  return <div className={classes.elidedBlock} style={{ width }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}) {\n  const { classes } = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import React from 'react'\nimport { IconButton, Paper, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport CascadingMenu from '@jbrowse/core/ui/CascadingMenu'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { getTrackName } from '@jbrowse/core/util/tracks'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\n\nimport {\n  bindTrigger,\n  bindPopover,\n  usePopupState,\n} from 'material-ui-popup-state/hooks'\n\n// icons\nimport MoreVertIcon from '@mui/icons-material/MoreVert'\nimport DragIcon from '@mui/icons-material/DragIndicator'\nimport CloseIcon from '@mui/icons-material/Close'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport AddIcon from '@mui/icons-material/Add'\n\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n    transition: theme.transitions.create(['background'], {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  dragHandle: {\n    cursor: 'grab',\n    color: '#135560',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\ninterface Props {\n  track: BaseTrackModel\n  className?: string\n}\n\nconst TrackLabel = React.forwardRef<HTMLDivElement, Props>(\n  ({ track, className }, ref) => {\n    const { classes, cx } = useStyles()\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const minimized = track.minimized\n    const trackId = getConf(track, 'trackId')\n    const trackName = getTrackName(trackConf, session)\n\n    const popupState = usePopupState({\n      popupId: 'trackLabelMenu',\n      variant: 'popover',\n    })\n\n    const items = [\n      {\n        label: minimized ? 'Restore track' : 'Minimize track',\n        icon: minimized ? AddIcon : MinimizeIcon,\n        onClick: () => track.setMinimized(!minimized),\n      },\n      ...(session.getTrackActionMenuItems?.(trackConf) || []),\n      ...track.trackMenuItems(),\n    ].sort((a, b) => (b.priority || 0) - (a.priority || 0))\n\n    return (\n      <Paper ref={ref} className={cx(className, classes.root)}>\n        <span\n          draggable\n          className={classes.dragHandle}\n          onDragStart={event => {\n            const target = event.currentTarget\n            if (target.parentNode) {\n              const parent = target.parentNode as HTMLElement\n              event.dataTransfer.setDragImage(parent, 20, 20)\n              view.setDraggingTrackId(track.id)\n            }\n          }}\n          onDragEnd={() => view.setDraggingTrackId(undefined)}\n          data-testid={`dragHandle-${view.id}-${trackId}`}\n        >\n          <DragIcon className={classes.dragHandleIcon} fontSize=\"small\" />\n        </span>\n        <IconButton\n          onClick={() => view.hideTrack(trackId)}\n          className={classes.iconButton}\n          title=\"close this track\"\n          color=\"secondary\"\n        >\n          <CloseIcon fontSize=\"small\" />\n        </IconButton>\n\n        <Typography\n          variant=\"body1\"\n          component=\"span\"\n          className={classes.trackName}\n        >\n          {trackName + (minimized ? ' (minimized)' : '')}\n        </Typography>\n        <IconButton\n          {...bindTrigger(popupState)}\n          className={classes.iconButton}\n          color=\"secondary\"\n          data-testid=\"track_menu_icon\"\n          disabled={!items.length}\n        >\n          <MoreVertIcon fontSize=\"small\" />\n        </IconButton>\n        <CascadingMenu\n          {...bindPopover(popupState)}\n          onMenuItemClick={(_: unknown, callback: Function) => callback()}\n          menuItems={items}\n          popupState={popupState}\n        />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(TrackLabel)\n","import React, { useEffect, useRef } from 'react'\nimport { Paper } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle, ErrorMessage } from '@jbrowse/core/ui'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport { useDebouncedCallback } from '@jbrowse/core/util'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles()({\n  root: {\n    marginTop: 2,\n  },\n  resizeHandle: {\n    height: 3,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n  overlay: {\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    zIndex: 3,\n  },\n  trackLabel: {\n    zIndex: 3,\n  },\n\n  // aligns with block bounderies. check for example the breakpoint split view\n  // demo to see if features align if wanting to change things\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n  trackLabelOffset: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n  },\n})\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackContainerLabel = observer(\n  ({ model, view }: { model: BaseTrackModel; view: LGV }) => {\n    const { classes, cx } = useStyles()\n    const display = model.displays[0]\n    const { trackLabel, trackLabelOverlap, trackLabelOffset } = classes\n    const labelStyle =\n      view.trackLabels !== 'overlapping' || display.prefersOffset\n        ? trackLabelOffset\n        : trackLabelOverlap\n\n    return view.trackLabels !== 'hidden' ? (\n      <TrackLabel track={model} className={cx(trackLabel, labelStyle)} />\n    ) : null\n  },\n)\n\nfunction TrackContainer({\n  model,\n  track,\n}: {\n  model: LGV\n  track: BaseTrackModel\n}) {\n  const { classes } = useStyles()\n  const display = track.displays[0]\n  const { horizontalScroll, draggingTrackId, moveTrack } = model\n  const { height, RenderingComponent, DisplayBlurb } = display\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef(null)\n  const dimmed = draggingTrackId !== undefined && draggingTrackId !== display.id\n  const minimized = track.minimized\n  const debouncedOnDragEnter = useDebouncedCallback(() => {\n    if (isAlive(display) && dimmed) {\n      moveTrack(draggingTrackId, track.id)\n    }\n  }, 100)\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n\n  return (\n    <Paper className={classes.root} variant=\"outlined\">\n      <TrackContainerLabel model={track} view={model} />\n      <ErrorBoundary\n        key={track.id}\n        FallbackComponent={({ error }) => <ErrorMessage error={error} />}\n      >\n        <div\n          className={classes.trackRenderingContainer}\n          style={{ height: minimized ? 20 : height }}\n          onScroll={evt => display.setScrollTop(evt.currentTarget.scrollTop)}\n          onDragEnter={debouncedOnDragEnter}\n          data-testid={`trackRenderingContainer-${model.id}-${trackId}`}\n        >\n          {!minimized ? (\n            <>\n              <div\n                ref={ref}\n                className={classes.renderingComponentContainer}\n                style={{ transform: `scaleX(${model.scaleFactor})` }}\n              >\n                <RenderingComponent\n                  model={display}\n                  onHorizontalScroll={horizontalScroll}\n                />\n              </div>\n\n              {DisplayBlurb ? (\n                <div\n                  style={{\n                    position: 'absolute',\n                    left: 0,\n                    top: display.height - 20,\n                  }}\n                >\n                  <DisplayBlurb model={display} />\n                </div>\n              ) : null}\n            </>\n          ) : null}\n        </div>\n      </ErrorBoundary>\n      <div\n        className={classes.overlay}\n        style={{\n          height: display.height,\n          background: dimmed ? 'rgba(0, 0, 0, 0.4)' : undefined,\n        }}\n        onDragEnter={debouncedOnDragEnter}\n      />\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </Paper>\n  )\n}\n\nexport default observer(TrackContainer)\n","import React, { useRef, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { Popover, Tooltip, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { stringify } from '@jbrowse/core/util'\nimport { Menu } from '@jbrowse/core/ui'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => {\n  const { primary, tertiary } = theme.palette\n  const background = tertiary\n    ? alpha(tertiary.main, 0.7)\n    : alpha(primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: tertiary ? tertiary.contrastText : primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst VerticalGuide = observer(\n  ({ model, coordX }: { model: LGV; coordX: number }) => {\n    const { classes } = useStyles()\n    return (\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: coordX,\n            background: 'red',\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction RubberBand({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<{\n    offsetX: number\n    clientX: number\n    clientY: number\n  }>()\n  const [guideX, setGuideX] = useState<number>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const { classes } = useStyles()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  const { setOffsets, pxToBp } = model\n\n  useEffect(() => {\n    function computeOffsets(offsetX: number) {\n      if (startX === undefined) {\n        return\n      }\n      let leftPx = startX\n      let rightPx = offsetX\n      if (rightPx < leftPx) {\n        ;[leftPx, rightPx] = [rightPx, leftPx]\n      }\n      const leftOffset = pxToBp(leftPx)\n      const rightOffset = pxToBp(rightPx)\n\n      return { leftOffset, rightOffset }\n    }\n\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && controlsRef.current) {\n        const { clientX, clientY } = event\n        const ref = controlsRef.current\n        const offsetX = clientX - ref.getBoundingClientRect().left\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        const args = computeOffsets(offsetX)\n        if (args) {\n          const { leftOffset, rightOffset } = args\n          setOffsets(leftOffset, rightOffset)\n        }\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition, setOffsets, pxToBp])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX, model.bpPerPx])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX =\n      event.clientX -\n      (event.target as HTMLDivElement).getBoundingClientRect().left\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    const target = event.target as HTMLDivElement\n    setGuideX(event.clientX - target.getBoundingClientRect().left)\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  const open = Boolean(anchorPosition)\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  if (startX === undefined) {\n    return (\n      <>\n        {guideX !== undefined ? (\n          <VerticalGuide model={model} coordX={guideX} />\n        ) : null}\n        <div\n          data-testid=\"rubberBand_controls\"\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </>\n    )\n  }\n\n  /* Calculating Pixels for Mouse Dragging */\n  const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n  const left = right < startX ? right : startX\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n  return (\n    <>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{ left, width }}\n      >\n        <Typography variant=\"h6\" className={classes.rubberBandText}>\n          {numOfBpSelected.toLocaleString('en-US')} bp\n        </Typography>\n      </div>\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(RubberBand)\n","import { Paper, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { LinearGenomeViewModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\nimport { getTickDisplayStr } from '@jbrowse/core/util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  scaleBarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scaleBarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scaleBar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: '11px',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: '11px',\n    position: 'absolute',\n    left: '2px',\n    top: '-1px',\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block instanceof ContentBlock &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedScaleBarLabels = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  const { bpPerPx, staticBlocks } = model\n\n  return (\n    <>\n      {staticBlocks.map((block, index) => {\n        const { reversed, start, end, key, widthPx } = block\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(start, end, bpPerPx, true, false)\n\n          return (\n            <ContentBlockComponent key={`${key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                if (tick.type === 'major') {\n                  const x =\n                    (reversed ? end - tick.base : tick.base - start) / bpPerPx\n                  const baseNumber = tick.base + 1\n                  return (\n                    <div\n                      key={tick.base}\n                      className={classes.tick}\n                      style={{ left: x }}\n                    >\n                      {baseNumber ? (\n                        <Typography className={classes.majorTickLabel}>\n                          {getTickDisplayStr(baseNumber, bpPerPx)}\n                        </Typography>\n                      ) : null}\n                    </div>\n                  )\n                }\n                return null\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={key} width={widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={key}\n              width={widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\ninterface ScaleBarProps {\n  model: LGV\n  style?: React.CSSProperties\n  className?: string\n}\n\nconst ScaleBar = React.forwardRef<HTMLDivElement, ScaleBarProps>(\n  ({ model, style, className, ...other }, ref) => {\n    const { classes, cx } = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={cx(classes.scaleBarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scaleBarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scaleBar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScaleBarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(ScaleBar)\n","import React from 'react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { LinearGenomeViewModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.text.secondary,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const { classes, cx } = useStyles()\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(block.start, block.end, model.bpPerPx)\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                const x =\n                  (block.reversed\n                    ? block.end - tick.base\n                    : tick.base - block.start) / model.bpPerPx\n                return (\n                  <div\n                    key={tick.base}\n                    className={cx(\n                      classes.tick,\n                      tick.type === 'major' || tick.type === 'labeledMajor'\n                        ? classes.majorTick\n                        : classes.minorTick,\n                    )}\n                    style={{ left: x }}\n                  />\n                )\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nfunction VerticalGuides({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(VerticalGuides)\n","import React, { useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(() => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: '1px black dashed',\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nfunction CenterLine({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n}\n\nexport default observer(CenterLine)\n","import React, { useEffect, useRef, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport normalizeWheel from 'normalize-wheel'\n\n// locals\nimport { LinearGenomeViewModel, SCALE_BAR_HEIGHT } from '..'\nimport RubberBand from './RubberBand'\nimport ScaleBar from './ScaleBar'\nimport Gridlines from './Gridlines'\nimport CenterLine from './CenterLine'\n\nconst useStyles = makeStyles()({\n  tracksContainer: {\n    position: 'relative',\n    overflow: 'hidden',\n  },\n  spacer: {\n    position: 'relative',\n    height: 3,\n  },\n})\n\ntype LGV = LinearGenomeViewModel\ntype Timer = ReturnType<typeof setTimeout>\n\nfunction TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const { classes } = useStyles()\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const delta = useRef(0)\n  const scheduled = useRef(false)\n  const timeout = useRef<Timer>()\n  const ref = useRef<HTMLDivElement>(null)\n  const prevX = useRef<number>(0)\n\n  const [mouseDragging, setMouseDragging] = useState(false)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n\n  function mouseLeave(event: React.MouseEvent) {\n    event.preventDefault()\n  }\n\n  useEffect(() => {\n    const curr = ref.current\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(origEvent: WheelEvent) {\n      const event = normalizeWheel(origEvent)\n      if (origEvent.ctrlKey === true) {\n        origEvent.preventDefault()\n        delta.current += event.pixelY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.pixelX) > Math.abs(2 * event.pixelY)) {\n          origEvent.preventDefault()\n        }\n        delta.current += event.pixelX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model])\n\n  return (\n    <div\n      ref={ref}\n      data-testid=\"trackContainer\"\n      className={classes.tracksContainer}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseLeave={mouseLeave}\n    >\n      {model.showGridlines ? <Gridlines model={model} /> : null}\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n\n      <RubberBand\n        model={model}\n        ControlComponent={\n          <ScaleBar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(TracksContainer)\n","import React, { useState, useEffect, lazy } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  Button,\n  CircularProgress,\n  FormControl,\n  Container,\n  Grid,\n} from '@mui/material'\nimport { ErrorMessage, AssemblySelector } from '@jbrowse/core/ui'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\n\n// locals\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { fetchResults, splitLast } from './util'\nimport { LinearGenomeViewModel } from '..'\nconst SearchResultsDialog = lazy(() => import('./SearchResultsDialog'))\n\nconst useStyles = makeStyles()(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(2),\n  },\n  button: {\n    margin: theme.spacing(2),\n  },\n  container: {\n    padding: theme.spacing(4),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst ImportForm = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const { assemblyNames, assemblyManager, textSearchManager } = session\n  const { rankSearchResults, isSearchDialogDisplayed, error } = model\n  const [selectedAsm, setSelectedAsm] = useState(assemblyNames[0])\n  const [option, setOption] = useState<BaseResult>()\n\n  const searchScope = model.searchScope(selectedAsm)\n\n  const assembly = assemblyManager.get(selectedAsm)\n  const assemblyError = assemblyNames.length\n    ? assembly?.error\n    : 'No configured assemblies'\n  const regions = assembly?.regions || []\n  const displayError = assemblyError || error\n  const [value, setValue] = useState('')\n  const r0 = regions[0]?.refName\n\n  // useEffect resets to an \"initial state\" of displaying first region from assembly\n  // after assembly change. needs to react to selectedAsm as well as r0 because changing\n  // assembly will run setValue('') and then r0 may not change if assembly names are the\n  // same across assemblies, but it still needs to be reset\n  useEffect(() => {\n    setValue(r0)\n  }, [r0, selectedAsm])\n\n  function navToOption(option: BaseResult) {\n    const location = option.getLocation()\n    const trackId = option.getTrackId()\n    if (location) {\n      model.navToLocString(location, selectedAsm)\n      if (trackId) {\n        model.showTrack(trackId)\n      }\n    }\n  }\n\n  // gets a string as input, or use stored option results from previous query,\n  // then re-query and\n  // 1) if it has multiple results: pop a dialog\n  // 2) if it's a single result navigate to it\n  // 3) else assume it's a locstring and navigate to it\n  async function handleSelectedRegion(input: string) {\n    try {\n      if (option?.getDisplayString() === input && option.hasLocation()) {\n        navToOption(option)\n      } else {\n        const [ref, rest] = splitLast(input, ':')\n        const allRefs = assembly?.allRefNamesWithLowerCase || []\n        if (\n          allRefs.includes(input) ||\n          (allRefs.includes(ref) && !Number.isNaN(parseInt(rest, 10)))\n        ) {\n          model.navToLocString(input, selectedAsm)\n        } else {\n          const results = await fetchResults({\n            queryString: input,\n            searchType: 'exact',\n            searchScope,\n            rankSearchResults,\n            textSearchManager,\n            assembly,\n          })\n\n          if (results.length > 1) {\n            model.setSearchResults(results, input.toLowerCase())\n          } else if (results.length === 1) {\n            navToOption(results[0])\n          } else {\n            model.navToLocString(input, selectedAsm)\n          }\n        }\n      }\n    } catch (e) {\n      console.error(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n\n  // implementation notes:\n  // having this wrapped in a form allows intuitive use of enter key to submit\n  return (\n    <div className={classes.container}>\n      {displayError ? <ErrorMessage error={displayError} /> : null}\n      <Container className={classes.importFormContainer}>\n        <form\n          onSubmit={event => {\n            event.preventDefault()\n            model.setError(undefined)\n            if (value) {\n              handleSelectedRegion(value)\n            }\n          }}\n        >\n          <Grid\n            container\n            spacing={1}\n            justifyContent=\"center\"\n            alignItems=\"center\"\n          >\n            <Grid item>\n              <FormControl>\n                <AssemblySelector\n                  onChange={val => {\n                    setSelectedAsm(val)\n                    setValue('')\n                  }}\n                  session={session}\n                  selected={selectedAsm}\n                />\n              </FormControl>\n            </Grid>\n            <Grid item>\n              {selectedAsm ? (\n                assemblyError ? (\n                  <CloseIcon style={{ color: 'red' }} />\n                ) : value ? (\n                  <FormControl>\n                    <RefNameAutocomplete\n                      fetchResults={queryString =>\n                        fetchResults({\n                          queryString,\n                          assembly,\n                          textSearchManager,\n                          rankSearchResults,\n                          searchScope,\n                        })\n                      }\n                      model={model}\n                      assemblyName={assemblyError ? undefined : selectedAsm}\n                      value={value}\n                      // note: minWidth 270 accomodates full width of helperText\n                      minWidth={270}\n                      onChange={str => setValue(str)}\n                      onSelect={val => setOption(val)}\n                      TextFieldProps={{\n                        variant: 'outlined',\n                        helperText:\n                          'Enter sequence name, feature name, or location',\n                        style: { minWidth: '175px' },\n                      }}\n                    />\n                  </FormControl>\n                ) : (\n                  <CircularProgress\n                    role=\"progressbar\"\n                    size={20}\n                    disableShrink\n                  />\n                )\n              ) : null}\n            </Grid>\n            <Grid item>\n              <FormControl>\n                <Button\n                  type=\"submit\"\n                  disabled={!value}\n                  className={classes.button}\n                  variant=\"contained\"\n                  color=\"primary\"\n                >\n                  Open\n                </Button>\n              </FormControl>\n              <FormControl>\n                <Button\n                  disabled={!value}\n                  className={classes.button}\n                  onClick={() => {\n                    model.setError(undefined)\n                    model.showAllRegionsInAssembly(selectedAsm)\n                  }}\n                  variant=\"contained\"\n                  color=\"secondary\"\n                >\n                  Show all regions in assembly\n                </Button>\n              </FormControl>\n            </Grid>\n          </Grid>\n        </form>\n      </Container>\n      {isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          optAssemblyName={selectedAsm}\n          handleClose={() => model.setSearchResults(undefined, undefined)}\n        />\n      ) : null}\n    </div>\n  )\n})\n\nexport default ImportForm\n","export interface SeqChunk {\n  header: string\n  seq: string\n}\n/**\n * Returns sequence with new line every 80 characters\n * ref https://stackoverflow.com/a/51506718/2129219\n *\n * @param seqString -  string\n * @returns formated sequence string\n */\nexport function formatFastaLines(seqString: string) {\n  return seqString.replace(/(.{1,80})/g, '$1\\n').trimEnd()\n}\n/**\n * Formats the sequences chunks into Fasta format\n *\n * @param chunks - array of seq chunks of the form `{ header: string, seq: string }`\n * @returns formatted sequence in fasta format\n */\nexport function formatSeqFasta(chunks: SeqChunk[]) {\n  return chunks\n    .map(chunk => `>${chunk.header}\\n${formatFastaLines(chunk.seq)}`)\n    .join('\\n')\n}\n","import React, { useEffect, useMemo, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport {\n  Button,\n  CircularProgress,\n  Container,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { saveAs } from 'file-saver'\nimport { getConf } from '@jbrowse/core/configuration'\nimport copy from 'copy-to-clipboard'\nimport { getSession, Feature, Region } from '@jbrowse/core/util'\nimport { formatSeqFasta } from '@jbrowse/core/util/formatFastaStrings'\n\n// icons\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport CloseIcon from '@mui/icons-material/Close'\nimport GetAppIcon from '@mui/icons-material/GetApp'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  dialogContent: {\n    width: '80em',\n  },\n  textAreaFont: {\n    fontFamily: 'Courier New',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * Fetches and returns a list features for a given list of regions\n */\nasync function fetchSequence(\n  model: LGV,\n  regions: Region[],\n  signal?: AbortSignal,\n) {\n  const session = getSession(model)\n  const { leftOffset, rightOffset } = model\n\n  if (!leftOffset || !rightOffset) {\n    throw new Error('no offsets on model to use for range')\n  }\n\n  if (leftOffset.assemblyName !== rightOffset.assemblyName) {\n    throw new Error('not able to fetch sequences from multiple assemblies')\n  }\n  const { rpcManager, assemblyManager } = session\n  const assemblyName = leftOffset.assemblyName || rightOffset.assemblyName || ''\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  const adapterConfig = getConf(assembly, ['sequence', 'adapter'])\n\n  const sessionId = 'getSequence'\n  return rpcManager.call(sessionId, 'CoreGetFeatures', {\n    adapterConfig,\n    regions,\n    sessionId,\n    signal,\n  }) as Promise<Feature[]>\n}\n\nfunction SequenceDialog({\n  model,\n  handleClose,\n}: {\n  model: LGV\n  handleClose: () => void\n}) {\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const [error, setError] = useState<unknown>()\n  const [sequence, setSequence] = useState<string>()\n  const loading = Boolean(sequence === undefined)\n  const { leftOffset, rightOffset } = model\n\n  // avoid infinite looping of useEffect\n  // random note: the current selected region can't be a computed because it\n  // uses action on base1dview even though it's on the ephemeral base1dview\n  const regionsSelected = useMemo(\n    () => model.getSelectedRegions(leftOffset, rightOffset),\n    [model, leftOffset, rightOffset],\n  )\n\n  useEffect(() => {\n    let active = true\n    const controller = new AbortController()\n\n    ;(async () => {\n      try {\n        if (regionsSelected.length > 0) {\n          const chunks = await fetchSequence(\n            model,\n            regionsSelected,\n            controller.signal,\n          )\n          if (active) {\n            setSequence(\n              formatSeqFasta(\n                chunks\n                  .filter(f => !!f)\n                  .map(chunk => {\n                    const chunkSeq = chunk.get('seq')\n                    const chunkRefName = chunk.get('refName')\n                    const chunkStart = chunk.get('start') + 1\n                    const chunkEnd = chunk.get('end')\n                    const chunkLocstring = `${chunkRefName}:${chunkStart}-${chunkEnd}`\n                    if (chunkSeq?.length !== chunkEnd - chunkStart + 1) {\n                      throw new Error(\n                        `${chunkLocstring} returned ${chunkSeq.length.toLocaleString()} bases, but should have returned ${(\n                          chunkEnd - chunkStart\n                        ).toLocaleString()}`,\n                      )\n                    }\n                    return { header: chunkLocstring, seq: chunkSeq }\n                  }),\n              ),\n            )\n          }\n        } else {\n          throw new Error('Selected region is out of bounds')\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          setError(e)\n        }\n      }\n    })()\n\n    return () => {\n      controller.abort()\n      active = false\n    }\n  }, [model, session, regionsSelected, setSequence])\n\n  const sequenceTooLarge = sequence ? sequence.length > 1_000_000 : false\n\n  return (\n    <Dialog maxWidth=\"xl\" open onClose={handleClose}>\n      <DialogTitle>\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n              model.setOffsets(undefined, undefined)\n            }}\n            size=\"large\"\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        {error ? <Typography color=\"error\">{`${error}`}</Typography> : null}\n        {loading && !error ? (\n          <Container>\n            Retrieving reference sequence...\n            <CircularProgress\n              style={{\n                marginLeft: 10,\n              }}\n              size={20}\n              disableShrink\n            />\n          </Container>\n        ) : null}\n        <TextField\n          data-testid=\"rubberband-sequence\"\n          variant=\"outlined\"\n          multiline\n          minRows={5}\n          disabled={sequenceTooLarge}\n          className={classes.dialogContent}\n          fullWidth\n          value={\n            sequenceTooLarge\n              ? 'Reference sequence too large to display, use the download FASTA button'\n              : sequence\n          }\n          InputProps={{\n            readOnly: true,\n            classes: {\n              input: classes.textAreaFont,\n            },\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            copy(sequence || '')\n            session.notify('Copied to clipboard', 'success')\n          }}\n          disabled={loading || !!error || sequenceTooLarge}\n          color=\"primary\"\n          startIcon={<ContentCopyIcon />}\n        >\n          Copy to clipboard\n        </Button>\n        <Button\n          onClick={() => {\n            const seqFastaFile = new Blob([sequence || ''], {\n              type: 'text/x-fasta;charset=utf-8',\n            })\n            saveAs(seqFastaFile, 'jbrowse_ref_seq.fa')\n          }}\n          disabled={loading || !!error}\n          color=\"primary\"\n          startIcon={<GetAppIcon />}\n        >\n          Download FASTA\n        </Button>\n        <Button onClick={handleClose} variant=\"contained\">\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(SequenceDialog)\n","import React from 'react'\nimport { Button, Paper, Typography } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\nimport ImportForm from './ImportForm'\nimport GetSequenceDialog from './GetSequenceDialog'\nimport SearchResultsDialog from './SearchResultsDialog'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => ({\n  note: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n}))\n\nconst LinearGenomeView = observer(({ model }: { model: LGV }) => {\n  const { tracks, error, initialized, hasDisplayedRegions } = model\n  const { classes } = useStyles()\n\n  if (!initialized && !error) {\n    return <LoadingEllipses variant=\"h5\" />\n  }\n  if (!hasDisplayedRegions || error) {\n    return <ImportForm model={model} />\n  }\n\n  const MiniControlsComponent = model.MiniControlsComponent()\n  const HeaderComponent = model.HeaderComponent()\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {model.seqDialogDisplayed ? (\n        <GetSequenceDialog\n          model={model}\n          handleClose={() => model.setGetSequenceDialogOpen(false)}\n        />\n      ) : null}\n      {model.isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          handleClose={() => model.setSearchResults(undefined, undefined)}\n        />\n      ) : null}\n      <HeaderComponent model={model} />\n      <MiniControlsComponent model={model} />\n      <TracksContainer model={model}>\n        {!tracks.length ? (\n          <Paper variant=\"outlined\" className={classes.note}>\n            {!model.hideNoTracksActive ? (\n              <>\n                <Typography>No tracks active.</Typography>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={model.activateTrackSelector}\n                  style={{ zIndex: 1000 }}\n                  startIcon={<TrackSelectorIcon />}\n                >\n                  Open track selector\n                </Button>\n              </>\n            ) : (\n              <div style={{ height: '48px' }}></div>\n            )}\n          </Paper>\n        ) : (\n          tracks.map(track => (\n            <TrackContainer key={track.id} model={model} track={track} />\n          ))\n        )}\n      </TracksContainer>\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n","import React, { Suspense, lazy, useMemo, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSession, useDebounce, measureText } from '@jbrowse/core/util'\nimport BaseResult, {\n  RefSequenceResult,\n} from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  Autocomplete,\n  CircularProgress,\n  IconButton,\n  InputAdornment,\n  TextField,\n  TextFieldProps as TFP,\n} from '@mui/material'\n\n// icons\nimport SearchIcon from '@mui/icons-material/Search'\nimport HelpIcon from '@mui/icons-material/Help'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\n// lazy\nconst HelpDialog = lazy(() => import('./HelpDialog'))\n\nexport interface Option {\n  group?: string\n  result: BaseResult\n}\n\n// the logic of this method is to only apply a filter to RefSequenceResults\n// because they do not have a matchedObject. the trix search results already\n// filter so don't need re-filtering\nfunction filterOptions(options: Option[], searchQuery: string) {\n  return options.filter(option => {\n    const { result } = option\n    return (\n      result.getLabel().toLowerCase().includes(searchQuery) ||\n      result.matchedObject\n    )\n  })\n}\n\nfunction RefNameAutocomplete({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  fetchResults,\n  onChange,\n  value,\n  showHelp = true,\n  minWidth = 200,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect?: (region: BaseResult) => void\n  onChange?: (val: string) => void\n  assemblyName?: string\n  value?: string\n  fetchResults: (query: string) => Promise<BaseResult[]>\n  style?: React.CSSProperties\n  minWidth?: number\n  showHelp?: boolean\n  TextFieldProps?: TFP\n}) {\n  const session = getSession(model)\n  const { assemblyManager } = session\n  const [open, setOpen] = useState(false)\n  const [loaded, setLoaded] = useState(true)\n  const [isHelpDialogDisplayed, setHelpDialogDisplayed] = useState(false)\n  const [currentSearch, setCurrentSearch] = useState('')\n  const [inputValue, setInputValue] = useState('')\n  const [searchOptions, setSearchOptions] = useState<Option[]>()\n  const debouncedSearch = useDebounce(currentSearch, 300)\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n  const { coarseVisibleLocStrings, hasDisplayedRegions } = model\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const regions = assembly?.regions || []\n\n  const options = useMemo(\n    () =>\n      regions.map(option => ({\n        result: new RefSequenceResult({\n          refName: option.refName,\n          label: option.refName,\n          matchedAttribute: 'refName',\n        }),\n      })),\n    [regions],\n  )\n\n  useEffect(() => {\n    let active = true\n\n    ;(async () => {\n      try {\n        if (debouncedSearch === '' || !assemblyName) {\n          return\n        }\n\n        setLoaded(false)\n        const results = await fetchResults(debouncedSearch)\n        if (active) {\n          const m: { [key: string]: BaseResult[] } = {}\n\n          for (let i = 0; i < results.length; i++) {\n            const r = results[i]\n            const d = r.getDisplayString()\n            if (!m[d]) {\n              m[d] = []\n            }\n            m[d].push(r)\n          }\n          const display = Object.entries(m).map(([displayString, results]) => {\n            if (results.length === 1) {\n              return { result: results[0] }\n            } else {\n              return {\n                result: new BaseResult({\n                  displayString,\n                  results,\n                  label: displayString,\n                }),\n              }\n            }\n          })\n\n          setSearchOptions(display)\n          setLoaded(true)\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          session.notify(`${e}`, 'error')\n        }\n      }\n    })()\n\n    return () => {\n      active = false\n    }\n  }, [assemblyName, fetchResults, debouncedSearch, session, model])\n\n  const inputBoxVal = coarseVisibleLocStrings || value || ''\n\n  // heuristic, text width + icon width\n  // + 45 accomodates help icon and search icon\n  const width = Math.min(\n    Math.max(measureText(inputBoxVal, 16) + 45, minWidth),\n    550,\n  )\n\n  // notes on implementation:\n  // The selectOnFocus setting helps highlight the field when clicked\n  return (\n    <>\n      <Autocomplete\n        id={`refNameAutocomplete-${model.id}`}\n        data-testid=\"autocomplete\"\n        disableListWrap\n        disableClearable\n        disabled={!assemblyName}\n        freeSolo\n        includeInputInList\n        selectOnFocus\n        style={{ ...style, width }}\n        value={inputBoxVal}\n        loading={!loaded}\n        inputValue={inputValue}\n        onInputChange={(_event, newInputValue) => {\n          setInputValue(newInputValue)\n          onChange?.(newInputValue)\n        }}\n        loadingText=\"loading results\"\n        open={open}\n        onOpen={() => setOpen(true)}\n        onClose={() => {\n          setOpen(false)\n          setLoaded(true)\n          if (hasDisplayedRegions) {\n            setCurrentSearch('')\n            setSearchOptions(undefined)\n          }\n        }}\n        onChange={(_event, selectedOption) => {\n          if (!selectedOption || !assemblyName) {\n            return\n          }\n\n          if (typeof selectedOption === 'string') {\n            // handles string inputs on keyPress enter\n            onSelect?.(new BaseResult({ label: selectedOption }))\n          } else {\n            onSelect?.(selectedOption.result)\n          }\n          setInputValue(inputBoxVal)\n        }}\n        options={!searchOptions?.length ? options : searchOptions}\n        getOptionDisabled={option => option?.group === 'limitOption'}\n        filterOptions={(options, params) => {\n          const filtered = filterOptions(\n            options,\n            params.inputValue.toLocaleLowerCase(),\n          )\n          return [\n            ...filtered.slice(0, 100),\n            ...(filtered.length > 100\n              ? [\n                  {\n                    group: 'limitOption',\n                    result: new BaseResult({\n                      label: 'keep typing for more results',\n                    }),\n                  },\n                ]\n              : []),\n          ]\n        }}\n        renderInput={params => {\n          const { helperText, InputProps = {} } = TextFieldProps\n          return (\n            <TextField\n              onBlur={() =>\n                // this is used to restore a refName or the non-user-typed input\n                // to the box on blurring\n                setInputValue(inputBoxVal)\n              }\n              {...params}\n              {...TextFieldProps}\n              helperText={helperText}\n              InputProps={{\n                ...params.InputProps,\n                ...InputProps,\n\n                endAdornment: (\n                  <>\n                    {regions.length === 0 ? (\n                      <CircularProgress color=\"inherit\" size={20} />\n                    ) : (\n                      <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n                        <SearchIcon fontSize=\"small\" />\n                        {showHelp ? (\n                          <IconButton\n                            onClick={() => setHelpDialogDisplayed(true)}\n                            size=\"small\"\n                          >\n                            <HelpIcon fontSize=\"small\" />\n                          </IconButton>\n                        ) : null}\n                      </InputAdornment>\n                    )}\n                    {params.InputProps.endAdornment}\n                  </>\n                ),\n              }}\n              placeholder=\"Search for location\"\n              onChange={e => setCurrentSearch(e.target.value)}\n            />\n          )\n        }}\n        getOptionLabel={option =>\n          (typeof option === 'string'\n            ? option\n            : option.result.getDisplayString()) || ''\n        }\n      />\n      {isHelpDialogDisplayed ? (\n        <Suspense fallback={<div />}>\n          <HelpDialog handleClose={() => setHelpDialogDisplayed(false)} />\n        </Suspense>\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(RefNameAutocomplete)\n","import React from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { resolveIdentifier, getRoot } from 'mobx-state-tree'\nimport { getSession, getEnv } from '@jbrowse/core/util'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n  Paper,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Typography,\n} from '@mui/material'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { LinearGenomeViewModel } from '../..'\n\nconst useStyles = makeStyles()(theme => ({\n  dialogContent: {\n    width: '80em',\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nexport default function SearchResultsDialog({\n  model,\n  optAssemblyName,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  optAssemblyName?: string\n  handleClose: () => void\n}) {\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(session)\n  const { assemblyManager } = session\n  let assemblyName = optAssemblyName\n  if (model.displayedRegions.length > 0) {\n    assemblyName = model.displayedRegions[0]?.assemblyName\n  }\n  if (!assemblyName) {\n    throw new Error(`Assembly name not found`)\n  }\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  if (!assembly.regions) {\n    throw new Error(`assembly ${assemblyName} regions not loaded`)\n  }\n  const assemblyRegions = assembly.regions\n\n  function handleClick(location: string) {\n    try {\n      const newRegion = assemblyRegions.find(\n        region => location === region.refName,\n      )\n      if (newRegion) {\n        model.setDisplayedRegions([newRegion])\n        // we use showAllRegions after setDisplayedRegions to make the entire\n        // region visible, xref #1703\n        model.showAllRegions()\n      } else {\n        model.navToLocString(location, assemblyName)\n      }\n    } catch (e) {\n      console.warn(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n\n  function getTrackName(trackId: string | undefined) {\n    if (trackId) {\n      const schema = pluginManager.pluggableConfigSchemaType('track')\n      const configuration = resolveIdentifier(schema, getRoot(model), trackId)\n      return configuration?.name?.value || ''\n    }\n    return ''\n  }\n\n  return (\n    <Dialog open maxWidth=\"xl\" onClose={handleClose}>\n      <DialogTitle>\n        Search results\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-resultsDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n            }}\n            size=\"large\"\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n      <DialogContent>\n        {!model.searchResults?.length ? (\n          <Typography>\n            No results found for <b>{model.searchQuery}</b>\n          </Typography>\n        ) : (\n          <>\n            <Typography>\n              Showing results for <b>{model.searchQuery}</b>\n            </Typography>\n            <TableContainer component={Paper}>\n              <Table>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>Name</TableCell>\n                    <TableCell align=\"right\">Location</TableCell>\n                    <TableCell align=\"right\">Track</TableCell>\n                    <TableCell align=\"right\" />\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {model.searchResults.map(result => (\n                    <TableRow key={`${result.getId()}`}>\n                      <TableCell component=\"th\" scope=\"row\">\n                        {result.getLabel()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {result.getLocation()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {getTrackName(result.getTrackId()) || 'N/A'}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        <Button\n                          onClick={() => {\n                            const location = result.getLocation()\n                            if (location) {\n                              handleClick(location)\n                              const resultTrackId = result.getTrackId()\n                              if (resultTrackId) {\n                                model.showTrack(resultTrackId)\n                              }\n                            }\n                            handleClose()\n                          }}\n                          color=\"primary\"\n                          variant=\"contained\"\n                        >\n                          Go\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </TableContainer>\n          </>\n        )}\n      </DialogContent>\n      <Divider />\n      <DialogActions>\n        <Button onClick={() => handleClose()} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { TextSearchManager } from '@jbrowse/core/util'\n\nexport function dedupe(\n  results: BaseResult[] = [],\n  cb: (result: BaseResult) => string,\n) {\n  return results.filter(\n    (elt, idx, self) => idx === self.findIndex(t => cb(t) === cb(elt)),\n  )\n}\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults = await textSearchManager?.search(\n    {\n      queryString,\n      searchType,\n    },\n    searchScope,\n    rankSearchResults,\n  )\n\n  const refNameResults = assembly?.allRefNames\n    ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n    .slice(0, 10)\n    .map(r => new BaseResult({ label: r }))\n\n  return dedupe(\n    [...(refNameResults || []), ...(textSearchResults || [])],\n    elt => elt.getId(),\n  )\n}\n\n// splits on the last instance of a character\nexport function splitLast(str: string, split: string): [string, string] {\n  const lastIndex = str.lastIndexOf(split)\n  if (lastIndex === -1) {\n    return [str, '']\n  } else {\n    const before = str.slice(0, lastIndex)\n    const after = str.slice(lastIndex + 1)\n    return [before, after]\n  }\n}\n","import { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { makeTicks } from '../util'\nimport { getTickDisplayStr } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()((/* theme */) => ({\n  majorTickLabel: {\n    fontSize: '11px',\n    // fill: theme.palette.text.primary,\n  },\n  majorTick: {\n    stroke: '#555',\n    // stroke: theme.palette.text.secondary,\n  },\n  minorTick: {\n    stroke: '#999',\n    // stroke: theme.palette.text.hint,\n  },\n}))\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed,\n  major,\n  minor,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major: boolean\n  minor: boolean\n}) {\n  const { classes } = useStyles()\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={tick.base}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={tick.type === 'major' ? '#555' : '#999'}\n            className={\n              tick.type === 'major' ? classes.majorTick : classes.minorTick\n            }\n            data-bp={tick.base}\n          />\n        )\n      })}\n      {ticks\n        .filter(tick => tick.type === 'major')\n        .map(tick => {\n          const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n          return (\n            <text\n              x={x - 3}\n              y={7 + 11}\n              key={`label-${tick.base}`}\n              style={{ fontSize: '11px' }}\n              className={classes.majorTickLabel}\n            >\n              {getTickDisplayStr(tick.base + 1, bpPerPx)}\n            </text>\n          )\n        })}\n    </>\n  )\n}\n\nRuler.propTypes = {\n  start: ReactPropTypes.number.isRequired,\n  end: ReactPropTypes.number.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  reversed: ReactPropTypes.bool,\n  major: ReactPropTypes.bool,\n  minor: ReactPropTypes.bool,\n}\n\nRuler.defaultProps = {\n  reversed: false,\n  major: true,\n  minor: true,\n}\n\nexport default observer(Ruler)\n","import React, { useRef, useEffect, useState } from 'react'\nimport { Popover, Tooltip, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession, stringify } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { LinearGenomeViewModel, HEADER_OVERVIEW_HEIGHT } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()(theme => {\n  const { tertiary, primary } = theme.palette\n  const background = tertiary\n    ? alpha(tertiary.main, 0.7)\n    : alpha(primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: tertiary ? tertiary.contrastText : primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst HoverTooltip = observer(\n  ({\n    model,\n    open,\n    guideX,\n    overview,\n  }: {\n    model: LGV\n    open: boolean\n    guideX: number\n    overview: Base1DViewModel\n  }) => {\n    const { classes } = useStyles()\n    const { cytobandOffset } = model\n    const { assemblyManager } = getSession(model)\n\n    const px = overview.pxToBp(guideX - cytobandOffset)\n    const assembly = assemblyManager.get(px.assemblyName)\n    const cytoband = assembly?.cytobands?.find(\n      f =>\n        px.coord > f.get('start') &&\n        px.coord < f.get('end') &&\n        px.refName === assembly.getCanonicalRefName(f.get('refName')),\n    )\n\n    return (\n      <Tooltip\n        open={open}\n        placement=\"top\"\n        title={[stringify(px), cytoband?.get('name')].join(' ')}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: guideX,\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction OverviewRubberBand({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const { cytobandOffset } = model\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef<HTMLDivElement>(null)\n  const { classes } = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      const ref = controlsRef.current\n      if (ref && mouseDragging) {\n        const relativeX = event.clientX - ref.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp() {\n      // click and drag\n      if (startX !== undefined && currentX !== undefined) {\n        if (Math.abs(currentX - startX) > 3) {\n          const left = Math.min(startX, currentX)\n          const right = Math.max(startX, currentX)\n          model.moveTo(\n            overview.pxToBp(left - cytobandOffset),\n            overview.pxToBp(right - cytobandOffset),\n          )\n        }\n      }\n\n      // just a click\n      if (startX !== undefined && currentX === undefined) {\n        const click = overview.pxToBp(startX - cytobandOffset)\n        if (!click.refName) {\n          getSession(model).notify('unknown position clicked')\n          console.error('unknown position clicked', click)\n        } else {\n          model.centerAt(Math.round(click.coord), click.refName, click.index)\n        }\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview, cytobandOffset])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (controlsRef.current) {\n      setStartX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (controlsRef.current) {\n      setGuideX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div style={{ position: 'relative' }}>\n        {guideX !== undefined ? (\n          <HoverTooltip\n            model={model}\n            open={!mouseDragging}\n            overview={overview}\n            guideX={guideX}\n          />\n        ) : null}\n        <div\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX - cytobandOffset)\n    rightBpOffset = overview.pxToBp(startX + width - cytobandOffset)\n    if (currentX && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {leftBpOffset ? stringify(leftBpOffset) : ''}\n            </Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {rightBpOffset ? stringify(rightBpOffset) : ''}\n            </Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{\n          left,\n          width: Math.abs(width),\n          height: HEADER_OVERVIEW_HEIGHT,\n        }}\n      />\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewRubberBand)\n","import React from 'react'\nimport { Typography, useTheme, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getSession, getTickDisplayStr } from '@jbrowse/core/util'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\n\n// locals\nimport {\n  LinearGenomeViewModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport OverviewRubberBand from './OverviewRubberBand'\n\nconst wholeSeqSpacer = 2\n\nconst useStyles = makeStyles()(theme => ({\n  scaleBar: {\n    height: HEADER_OVERVIEW_HEIGHT,\n  },\n  scaleBarBorder: {\n    border: '1px solid',\n  },\n  scaleBarContig: {\n    backgroundColor: theme.palette.background.default,\n    position: 'absolute',\n    top: 0,\n    height: HEADER_OVERVIEW_HEIGHT,\n  },\n  scaleBarContigForward: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n  scaleBarContigReverse: {\n    backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n    backgroundRepeat: 'repeat',\n  },\n\n  scaleBarRefName: {\n    position: 'absolute',\n    fontWeight: 'bold',\n    pointerEvents: 'none',\n    zIndex: 100,\n  },\n  scaleBarLabel: {\n    height: HEADER_OVERVIEW_HEIGHT,\n    position: 'absolute',\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  scaleBarVisibleRegion: {\n    position: 'absolute',\n    height: HEADER_OVERVIEW_HEIGHT,\n    pointerEvents: 'none',\n    zIndex: 100,\n    border: '1px solid',\n  },\n  overview: {\n    height: HEADER_BAR_HEIGHT,\n    position: 'relative',\n  },\n  overviewSvg: {\n    width: '100%',\n    position: 'absolute',\n  },\n}))\n\nconst Polygon = observer(\n  ({\n    model,\n    overview,\n    useOffset = true,\n  }: {\n    model: LGV\n    overview: Base1DViewModel\n    useOffset?: boolean\n  }) => {\n    const theme = useTheme()\n    const multiplier = Number(useOffset)\n    const { interRegionPaddingWidth, offsetPx, dynamicBlocks, cytobandOffset } =\n      model\n    const { contentBlocks, totalWidthPxWithoutBorders } = dynamicBlocks\n\n    const { tertiary, primary } = theme.palette\n    const polygonColor = tertiary ? tertiary.light : primary.light\n\n    if (!contentBlocks.length) {\n      return null\n    }\n    const first = contentBlocks[0]\n    const last = contentBlocks[contentBlocks.length - 1]\n    const topLeft =\n      (overview.bpToPx({\n        ...first,\n        coord: first.reversed ? first.end : first.start,\n      }) || 0) +\n      cytobandOffset * multiplier\n    const topRight =\n      (overview.bpToPx({\n        ...last,\n        coord: last.reversed ? last.start : last.end,\n      }) || 0) +\n      cytobandOffset * multiplier\n\n    const startPx = Math.max(0, -offsetPx)\n    const endPx =\n      startPx +\n      totalWidthPxWithoutBorders +\n      (contentBlocks.length * interRegionPaddingWidth) / 2\n\n    const points = [\n      [startPx, HEADER_BAR_HEIGHT],\n      [endPx, HEADER_BAR_HEIGHT],\n      [topRight, 0],\n      [topLeft, 0],\n    ]\n\n    return (\n      <polygon\n        points={points.toString()}\n        fill={alpha(polygonColor, 0.3)}\n        stroke={alpha(polygonColor, 0.8)}\n      />\n    )\n  },\n)\n\ntype LGV = LinearGenomeViewModel\n\n// rounded rect from https://stackoverflow.com/a/45889603/2129219\n// prettier-ignore\nfunction rightRoundedRect(x: number, y: number, width: number, height: number, radius: number) {\n  return \"M\" + x + \",\" + y\n       + \"h\" + (width - radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + radius\n       + \"v\" + (height - 2 * radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + -radius + \",\" + radius\n       + \"h\" + (radius - width)\n       + \"z\";\n}\n\n// prettier-ignore\nfunction leftRoundedRect(x: number, y: number, width: number, height: number, radius: number ) {\n  return \"M\" + (x + radius) + \",\" + y\n       + \"h\" + (width - radius)\n       + \"v\" + height\n       + \"h\" + (radius - width)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + (-radius) + \",\" + (-radius)\n       + \"v\" + (2 * radius - height)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + (-radius)\n       + \"z\";\n}\n\nconst colorMap: { [key: string]: string | undefined } = {\n  gneg: 'rgb(227,227,227)',\n  gpos25: 'rgb(142,142,142)',\n  gpos50: 'rgb(85,85,85)',\n  gpos100: 'rgb(0,0,0)',\n  gpos75: 'rgb(57,57,57)',\n  gvar: 'rgb(0,0,0)',\n  stalk: 'rgb(127,127,127)',\n  acen: '#800',\n}\n\nfunction getCytobands(assembly: Assembly | undefined, refName: string) {\n  return (\n    assembly?.cytobands\n      ?.map(f => ({\n        refName: assembly.getCanonicalRefName(f.get('refName')),\n        start: f.get('start'),\n        end: f.get('end'),\n        type: f.get('type'),\n      }))\n      .filter(f => f.refName === refName) || []\n  )\n}\n\nconst Cytobands = observer(\n  ({\n    overview,\n    block,\n    assembly,\n  }: {\n    overview: Base1DViewModel\n    assembly?: Assembly\n    block: ContentBlock\n  }) => {\n    const { offsetPx, reversed } = block\n    const cytobands = getCytobands(assembly, block.refName)\n    const coords = cytobands.map(f => {\n      const { refName, start, end, type } = f\n      return [\n        overview.bpToPx({\n          refName,\n          coord: start,\n        }),\n        overview.bpToPx({\n          refName,\n          coord: end,\n        }),\n        type,\n      ]\n    })\n\n    const arr = cytobands || []\n    const lcap = reversed ? arr.length - 1 : 0\n    const rcap = reversed ? 0 : arr.length - 1\n\n    let firstCent = true\n    return (\n      <g transform={`translate(-${offsetPx})`}>\n        {coords.map(([start, end, type], index) => {\n          const key = `${start}-${end}-${type}`\n          if (type === 'acen' && firstCent) {\n            firstCent = false\n            return (\n              <polygon\n                key={key}\n                points={[\n                  [start, 0],\n                  [end, HEADER_OVERVIEW_HEIGHT / 2],\n                  [start, HEADER_OVERVIEW_HEIGHT],\n                ].toString()}\n                fill={colorMap[type]}\n              />\n            )\n          }\n          if (type === 'acen' && !firstCent) {\n            return (\n              <polygon\n                key={key}\n                points={[\n                  [start, HEADER_OVERVIEW_HEIGHT / 2],\n                  [end, 0],\n                  [end, HEADER_OVERVIEW_HEIGHT],\n                ].toString()}\n                fill={colorMap[type]}\n              />\n            )\n          }\n\n          if (lcap === index) {\n            return (\n              <path\n                key={key}\n                d={leftRoundedRect(\n                  Math.min(start, end),\n                  0,\n                  Math.abs(end - start),\n                  HEADER_OVERVIEW_HEIGHT,\n                  8,\n                )}\n                fill={colorMap[type]}\n              />\n            )\n          } else if (rcap === index) {\n            return (\n              <path\n                key={key}\n                d={rightRoundedRect(\n                  Math.min(start, end),\n                  0,\n                  Math.abs(end - start) - 2,\n                  HEADER_OVERVIEW_HEIGHT,\n                  8,\n                )}\n                fill={colorMap[type]}\n              />\n            )\n          } else {\n            return (\n              <rect\n                key={key}\n                x={Math.min(start, end)}\n                y={0}\n                width={Math.abs(end - start)}\n                height={HEADER_OVERVIEW_HEIGHT}\n                fill={colorMap[type]}\n              />\n            )\n          }\n        })}\n      </g>\n    )\n  },\n)\n\nconst OverviewBox = observer(\n  ({\n    scale,\n    model,\n    block,\n    overview,\n  }: {\n    scale: number\n    model: LGV\n    block: ContentBlock\n    overview: Base1DViewModel\n  }) => {\n    const { classes, cx } = useStyles()\n    const { cytobandOffset, showCytobands } = model\n    const { start, end, reversed, refName, assemblyName } = block\n    const { majorPitch } = chooseGridPitch(scale, 120, 15)\n    const { assemblyManager } = getSession(model)\n    const assembly = assemblyManager.get(assemblyName)\n    const refNameColor = assembly?.getRefNameColor(refName)\n\n    const tickLabels = []\n    for (let i = 0; i < Math.floor((end - start) / majorPitch); i++) {\n      const offsetLabel = (i + 1) * majorPitch\n      tickLabels.push(reversed ? end - offsetLabel : start + offsetLabel)\n    }\n\n    const canDisplayCytobands =\n      showCytobands && getCytobands(assembly, block.refName).length\n\n    return (\n      <div>\n        {/* name of sequence */}\n        <Typography\n          style={{\n            left: block.offsetPx + 3,\n            color: canDisplayCytobands ? 'black' : refNameColor,\n          }}\n          className={classes.scaleBarRefName}\n        >\n          {refName}\n        </Typography>\n        <div\n          className={cx(\n            classes.scaleBarContig,\n            canDisplayCytobands\n              ? undefined\n              : reversed\n              ? classes.scaleBarContigReverse\n              : classes.scaleBarContigForward,\n            !canDisplayCytobands ? classes.scaleBarBorder : undefined,\n          )}\n          style={{\n            left: block.offsetPx + cytobandOffset,\n            width: block.widthPx,\n            borderColor: refNameColor,\n          }}\n        >\n          {!canDisplayCytobands\n            ? tickLabels.map((tickLabel, labelIdx) => (\n                <Typography\n                  key={`${JSON.stringify(block)}-${tickLabel}-${labelIdx}`}\n                  className={classes.scaleBarLabel}\n                  variant=\"body2\"\n                  style={{\n                    left: ((labelIdx + 1) * majorPitch) / scale,\n                    pointerEvents: 'none',\n                    color: refNameColor,\n                  }}\n                >\n                  {getTickDisplayStr(tickLabel, overview.bpPerPx)}\n                </Typography>\n              ))\n            : null}\n\n          {canDisplayCytobands ? (\n            <svg style={{ width: '100%' }}>\n              <Cytobands\n                overview={overview}\n                assembly={assembly}\n                block={block}\n              />\n            </svg>\n          ) : null}\n        </div>\n      </div>\n    )\n  },\n)\n\nconst ScaleBar = observer(\n  ({\n    model,\n    scale,\n    overview,\n  }: {\n    model: LGV\n    overview: Base1DViewModel\n    scale: number\n  }) => {\n    const { classes } = useStyles()\n    const theme = useTheme()\n    const { dynamicBlocks, showCytobands, cytobandOffset } = model\n    const visibleRegions = dynamicBlocks.contentBlocks\n    const overviewVisibleRegions = overview.dynamicBlocks\n\n    const { tertiary, primary } = theme.palette\n    const scaleBarColor = tertiary ? tertiary.light : primary.light\n\n    if (!visibleRegions.length) {\n      return null\n    }\n    const first = visibleRegions[0]\n    const firstOverviewPx =\n      overview.bpToPx({\n        ...first,\n        coord: first.reversed ? first.end : first.start,\n      }) || 0\n\n    const last = visibleRegions[visibleRegions.length - 1]\n    const lastOverviewPx =\n      overview.bpToPx({\n        ...last,\n        coord: last.reversed ? last.start : last.end,\n      }) || 0\n\n    const color = showCytobands ? '#f00' : scaleBarColor\n    const transparency = showCytobands ? 0.1 : 0.3\n\n    return (\n      <div className={classes.scaleBar}>\n        <div\n          className={classes.scaleBarVisibleRegion}\n          style={{\n            width: lastOverviewPx - firstOverviewPx,\n            left: firstOverviewPx + cytobandOffset,\n            background: alpha(color, transparency),\n            borderColor: color,\n          }}\n        />\n        {/* this is the entire scale bar */}\n        {overviewVisibleRegions.map((block, idx) => {\n          return !(block instanceof ContentBlock) ? (\n            <div\n              key={`${JSON.stringify(block)}-${idx}`}\n              className={classes.scaleBarContig}\n              style={{\n                width: block.widthPx,\n                left: block.offsetPx,\n                backgroundColor: '#999',\n                backgroundImage:\n                  'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n              }}\n            />\n          ) : (\n            <OverviewBox\n              scale={scale}\n              block={block}\n              model={model}\n              overview={overview}\n              key={`${JSON.stringify(block)}-${idx}`}\n            />\n          )\n        })}\n      </div>\n    )\n  },\n)\n\nfunction OverviewScaleBar({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const { classes } = useStyles()\n  const { totalBp, width, cytobandOffset, displayedRegions } = model\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n\n  const modWidth = width - cytobandOffset\n  overview.setVolatileWidth(modWidth)\n  overview.showAllRegions()\n\n  const scale =\n    totalBp / (modWidth - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  return (\n    <div>\n      <OverviewRubberBand\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <ScaleBar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <svg height={HEADER_BAR_HEIGHT} className={classes.overviewSvg}>\n          <Polygon model={model} overview={overview} />\n        </svg>\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewScaleBar)\n\nexport { Cytobands, Polygon }\n","import React from 'react'\nimport { renderToStaticMarkup } from 'react-dom/server'\nimport { when } from 'mobx'\nimport { getParent } from 'mobx-state-tree'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { getSession, getBpDisplayStr } from '@jbrowse/core/util'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport Ruler from './Ruler'\nimport {\n  LinearGenomeViewModel,\n  ExportSvgOptions,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { Polygon, Cytobands } from './OverviewScaleBar'\n\ntype LGV = LinearGenomeViewModel\n\nfunction ScaleBar({ model, fontSize }: { model: LGV; fontSize: number }) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  const displayBp = getBpDisplayStr(totalBp)\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke=\"black\" />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke=\"black\" />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke=\"black\" />\n      <text\n        x={x0 + (x1 - x0) / 2}\n        y={fontSize * 2}\n        textAnchor=\"middle\"\n        fontSize={fontSize}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n\nfunction SVGRuler({\n  model,\n  fontSize,\n  width,\n}: {\n  model: LGV\n  fontSize: number\n  width: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  return (\n    <>\n      <defs>\n        <clipPath id=\"clip-ruler\">\n          <rect x={0} y={0} width={width} height={20} />\n        </clipPath>\n      </defs>\n      {contentBlocks.map(block => {\n        const { key, start, end, reversed, offsetPx, refName } = block\n        const offsetLeft = offsetPx - viewOffsetPx\n        return (\n          <g key={`${key}`} transform={`translate(${offsetLeft} 0)`}>\n            <text x={offsetLeft / bpPerPx} y={fontSize} fontSize={fontSize}>\n              {refName}\n            </text>\n            {renderRuler ? (\n              <g transform=\"translate(0 20)\" clipPath=\"url(#clip-ruler)\">\n                <Ruler\n                  start={start}\n                  end={end}\n                  bpPerPx={bpPerPx}\n                  reversed={reversed}\n                />\n              </g>\n            ) : (\n              <line\n                strokeWidth={1}\n                stroke=\"black\"\n                x1={start / bpPerPx}\n                x2={end / bpPerPx}\n                y1={20}\n                y2={20}\n              />\n            )}\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\nconst fontSize = 15\nconst rulerHeight = 50\nconst textHeight = fontSize + 5\nconst paddingHeight = 20\nconst headerHeight = textHeight + 20\nconst cytobandHeightIfExists = 100\n\ninterface Display {\n  height: number\n}\ninterface Track {\n  displays: Display[]\n}\n\nconst totalHeight = (tracks: Track[]) => {\n  return tracks.reduce((accum, track) => {\n    const display = track.displays[0]\n    return accum + display.height + paddingHeight + textHeight\n  }, 0)\n}\n\n// SVG component, ruler and assembly name\nconst SVGHeader = ({ model }: { model: LGV }) => {\n  const { width, assemblyNames, showCytobands, displayedRegions } = model\n  const { assemblyManager } = getSession(model)\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  const visibleRegions = model.dynamicBlocks.contentBlocks\n\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n  const block = overview.dynamicBlocks.contentBlocks[0]\n\n  const first = visibleRegions[0]\n  const firstOverviewPx =\n    overview.bpToPx({\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const last = visibleRegions[visibleRegions.length - 1]\n  const lastOverviewPx =\n    overview.bpToPx({\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n\n  const cytobandHeight = showCytobands ? cytobandHeightIfExists : 0\n\n  return (\n    <g id=\"header\">\n      <text x={0} y={fontSize} fontSize={fontSize}>\n        {assemblyName}\n      </text>\n\n      {showCytobands ? (\n        <g transform={`translate(0 ${rulerHeight})`}>\n          <Cytobands overview={overview} assembly={assembly} block={block} />\n          <rect\n            stroke=\"red\"\n            fill=\"rgb(255,0,0,0.1)\"\n            width={Math.max(lastOverviewPx - firstOverviewPx, 0.5)}\n            height={HEADER_OVERVIEW_HEIGHT - 1}\n            x={firstOverviewPx}\n            y={0.5}\n          />\n          <g transform={`translate(0,${HEADER_OVERVIEW_HEIGHT})`}>\n            <Polygon overview={overview} model={model} useOffset={false} />\n          </g>\n        </g>\n      ) : null}\n\n      <g transform={`translate(0 ${fontSize + cytobandHeight})`}>\n        <ScaleBar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight + cytobandHeight})`}>\n        <SVGRuler model={model} fontSize={fontSize} width={width} />\n      </g>\n    </g>\n  )\n}\n\n// SVG component, region separator\nconst SVGRegionSeparators = ({\n  model,\n  height,\n}: {\n  height: number\n  model: LGV\n}) => {\n  const { dynamicBlocks, offsetPx, interRegionPaddingWidth } = model\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <rect\n          key={block.key}\n          x={block.offsetPx - offsetPx - interRegionPaddingWidth}\n          width={interRegionPaddingWidth}\n          y={0}\n          height={height}\n          stroke=\"none\"\n          fill=\"grey\"\n        />\n      ))}\n    </>\n  )\n}\n\n// SVG component, tracks\nfunction SVGTracks({\n  displayResults,\n  model,\n  offset,\n}: {\n  displayResults: {\n    track: {\n      configuration: AnyConfigurationModel\n      displays: { height: number }[]\n    }\n    result: string\n  }[]\n  model: LGV\n  offset: number\n}) {\n  return (\n    <>\n      {displayResults.map(({ track, result }) => {\n        const current = offset\n        const trackName =\n          getConf(track, 'name') ||\n          `Reference sequence (${\n            readConfObject(getParent(track.configuration), 'displayName') ||\n            readConfObject(getParent(track.configuration), 'name')\n          })`\n        const display = track.displays[0]\n        offset += display.height + paddingHeight + textHeight\n        return (\n          <g\n            key={track.configuration.trackId}\n            transform={`translate(0 ${current})`}\n          >\n            <text fontSize={fontSize} x={Math.max(-model.offsetPx, 0)}>\n              {trackName}\n            </text>\n            <g transform={`translate(0 ${textHeight})`}>\n              {result}\n              <SVGRegionSeparators model={model} height={display.height} />\n            </g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const { Wrapper = ({ children }) => <>{children}</> } = opts\n  const { width, tracks, showCytobands } = model\n  const shift = 50\n  const offset =\n    headerHeight +\n    rulerHeight +\n    (showCytobands ? cytobandHeightIfExists : 0) +\n    20\n  const height = totalHeight(tracks) + offset\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => (display.ready !== undefined ? display.ready : true))\n      const result = await display.renderSvg(opts)\n      return { track, result }\n    }),\n  )\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <Wrapper>\n      <svg\n        width={width}\n        height={height}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n        viewBox={[0, 0, width + shift * 2, height].toString()}\n      >\n        {/* background white */}\n        <rect width={width + shift * 2} height={height} fill=\"white\" />\n\n        <g stroke=\"none\" transform={`translate(${shift} ${fontSize})`}>\n          <SVGHeader model={model} />\n          <SVGTracks\n            model={model}\n            displayResults={displayResults}\n            offset={offset}\n          />\n        </g>\n      </svg>\n    </Wrapper>,\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { useTheme, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession } from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\n\n// locals\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { fetchResults, splitLast } from './util'\nimport { LinearGenomeViewModel, SPACING, WIDGET_HEIGHT } from '..'\n\nconst useStyles = makeStyles()(() => ({\n  headerRefName: {\n    minWidth: 100,\n  },\n}))\n\nfunction SearchBox({\n  model,\n  showHelp,\n}: {\n  showHelp?: boolean\n  model: LinearGenomeViewModel\n}) {\n  const { classes } = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n\n  const { textSearchManager, assemblyManager } = session\n  const { assemblyNames, rankSearchResults } = model\n  const assemblyName = assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n  const searchScope = model.searchScope(assemblyName)\n\n  function navToOption(option: BaseResult) {\n    const location = option.getLocation()\n    const trackId = option.getTrackId()\n    if (location) {\n      model.navToLocString(location, assemblyName)\n      if (trackId) {\n        model.showTrack(trackId)\n      }\n    }\n  }\n\n  // gets a string as input, or use stored option results from previous query,\n  // then re-query and\n  // 1) if it has multiple results: pop a dialog\n  // 2) if it's a single result navigate to it\n  // 3) else assume it's a locstring and navigate to it\n  async function handleSelectedRegion(option: BaseResult) {\n    try {\n      if (option.hasLocation()) {\n        navToOption(option)\n      } else {\n        const input = option.getLabel()\n        const [ref, rest] = splitLast(input, ':')\n        const allRefs = assembly?.allRefNamesWithLowerCase || []\n        if (\n          allRefs.includes(input) ||\n          (allRefs.includes(ref) && !Number.isNaN(parseInt(rest, 10)))\n        ) {\n          model.navToLocString(input, assemblyName)\n        } else {\n          const results = await fetchResults({\n            queryString: input,\n            searchType: 'exact',\n            searchScope,\n            rankSearchResults,\n            textSearchManager,\n            assembly,\n          })\n\n          if (results.length > 1) {\n            model.setSearchResults(results, input.toLowerCase())\n          } else if (results.length === 1) {\n            navToOption(results[0])\n          } else {\n            model.navToLocString(input, assemblyName)\n          }\n        }\n      }\n    } catch (e) {\n      console.error(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n  return (\n    <RefNameAutocomplete\n      showHelp={showHelp}\n      onSelect={handleSelectedRegion}\n      assemblyName={assemblyName}\n      fetchResults={queryString =>\n        fetchResults({\n          queryString,\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n      }\n      model={model}\n      TextFieldProps={{\n        variant: 'outlined',\n        className: classes.headerRefName,\n        style: { margin: SPACING, minWidth: '175px' },\n        InputProps: {\n          style: {\n            padding: 0,\n            height: WIDGET_HEIGHT,\n            background: alpha(theme.palette.background.paper, 0.8),\n          },\n        },\n      }}\n    />\n  )\n}\n\nexport default observer(SearchBox)\n","import React, { useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport {\n  Button,\n  Checkbox,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControlLabel,\n  IconButton,\n  TextField,\n  Typography,\n} from '@mui/material'\nimport { ErrorMessage } from '@jbrowse/core/ui'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { ExportSvgOptions } from '..'\n\nconst useStyles = makeStyles()(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction LoadingMessage() {\n  return (\n    <div>\n      <CircularProgress size={20} style={{ marginRight: 20 }} />\n      <Typography display=\"inline\">Creating SVG</Typography>\n    </div>\n  )\n}\n\nexport default function ExportSvgDlg({\n  model,\n  handleClose,\n}: {\n  model: { exportSvg(opts: ExportSvgOptions): void }\n  handleClose: () => void\n}) {\n  // @ts-ignore\n  const offscreenCanvas = typeof OffscreenCanvas !== 'undefined'\n  const [rasterizeLayers, setRasterizeLayers] = useState(offscreenCanvas)\n  const [loading, setLoading] = useState(false)\n  const [filename, setFilename] = useState('jbrowse.svg')\n  const [error, setError] = useState<unknown>()\n  const { classes } = useStyles()\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Export SVG\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <LoadingMessage />\n        ) : null}\n        <TextField\n          helperText=\"filename\"\n          value={filename}\n          onChange={event => setFilename(event.target.value)}\n        />\n        {offscreenCanvas ? (\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={rasterizeLayers}\n                onChange={() => setRasterizeLayers(val => !val)}\n              />\n            }\n            label=\"Rasterize canvas based tracks? File may be much larger if this is turned off\"\n          />\n        ) : (\n          <Typography>\n            Note: rasterizing layers not yet supported in this browser, so SVG\n            size may be large\n          </Typography>\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => handleClose()}\n        >\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          onClick={async () => {\n            setLoading(true)\n            setError(undefined)\n            try {\n              await model.exportSvg({ rasterizeLayers, filename })\n              handleClose()\n            } catch (e) {\n              console.error(e)\n              setError(e)\n              setLoading(false)\n            }\n          }}\n        >\n          Submit\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { IconButton, Paper } from '@mui/material'\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport ArrowDown from '@mui/icons-material/KeyboardArrowDown'\nimport Menu from '@jbrowse/core/ui/Menu'\nimport { LinearGenomeViewModel } from '..'\n\nconst MiniControls = observer((props: { model: LinearGenomeViewModel }) => {\n  const { model } = props\n  const { bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor, hideHeader } = model\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n  return hideHeader ? (\n    <div style={{ position: 'absolute', right: '0px', zIndex: '1001' }}>\n      <Paper style={{ background: '#aaa7' }}>\n        <IconButton\n          color=\"secondary\"\n          onClick={event => setAnchorEl(event.currentTarget)}\n        >\n          <ArrowDown fontSize=\"small\" />\n        </IconButton>\n\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => model.zoom(bpPerPx * 2)}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomOut fontSize=\"small\" />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => model.zoom(model.bpPerPx / 2)}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomIn fontSize=\"small\" />\n        </IconButton>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setAnchorEl(undefined)\n          }}\n          onClose={() => setAnchorEl(undefined)}\n          menuItems={model.menuItems()}\n        />\n      </Paper>\n    </div>\n  ) : null\n})\n\nexport default MiniControls\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { Slider, IconButton } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport ZoomIn from '@mui/icons-material/ZoomIn'\nimport ZoomOut from '@mui/icons-material/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles()({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n  },\n})\n\nfunction ZoomControls({ model }: { model: LinearGenomeViewModel }) {\n  const { classes } = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx, scaleFactor } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => model.zoom(bpPerPx * 2)}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n        size=\"large\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        size=\"small\"\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        disabled={scaleFactor !== 1}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => model.zoom(model.bpPerPx / 2)}\n        disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n        size=\"large\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n}\n\nexport default observer(ZoomControls)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Button, FormGroup, Typography, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getBpDisplayStr } from '@jbrowse/core/util'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport ArrowForwardIcon from '@mui/icons-material/ArrowForward'\nimport ArrowBackIcon from '@mui/icons-material/ArrowBack'\n\n// locals\nimport {\n  LinearGenomeViewModel,\n  WIDGET_HEIGHT,\n  SPACING,\n  HEADER_BAR_HEIGHT,\n} from '..'\nimport OverviewScaleBar from './OverviewScaleBar'\nimport ZoomControls from './ZoomControls'\nimport SearchBox from './SearchBox'\n\ntype LGV = LinearGenomeViewModel\nconst useStyles = makeStyles()(theme => ({\n  headerBar: {\n    height: HEADER_BAR_HEIGHT,\n    display: 'flex',\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n\n  panButton: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    height: WIDGET_HEIGHT,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    margin: theme.spacing(0.5),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst HeaderButtons = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  return (\n    <Button\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n      color=\"secondary\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </Button>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const { classes } = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {getBpDisplayStr(coarseTotalBp)}\n    </Typography>\n  )\n})\n\nconst Controls = ({ model }: { model: LGV }) => {\n  const { classes } = useStyles()\n  return (\n    <div className={classes.headerBar}>\n      <HeaderButtons model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <PanControls model={model} />\n        <SearchBox model={model} />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n}\n\nconst LinearGenomeViewHeader = observer(({ model }: { model: LGV }) => {\n  return !model.hideHeader ? (\n    model.hideHeaderOverview ? (\n      <Controls model={model} />\n    ) : (\n      <OverviewScaleBar model={model}>\n        <Controls model={model} />\n      </OverviewScaleBar>\n    )\n  ) : null\n})\n\nexport default LinearGenomeViewHeader\n","import React, { lazy } from 'react'\nimport { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem, ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLastIndex,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  isSessionModelWithWidgets,\n  measureText,\n  parseLocString,\n  springAnimate,\n  isSessionWithAddTracks,\n} from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { transaction, autorun } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getRoot,\n  resolveIdentifier,\n  types,\n  Instance,\n} from 'mobx-state-tree'\n\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport { moveTo, pxToBp, bpToPx } from '@jbrowse/core/util/Base1DUtils'\nimport { saveAs } from 'file-saver'\nimport clone from 'clone'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@mui/icons-material/SyncAlt'\nimport VisibilityIcon from '@mui/icons-material/Visibility'\nimport LabelIcon from '@mui/icons-material/Label'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport PhotoCameraIcon from '@mui/icons-material/PhotoCamera'\nimport ZoomInIcon from '@mui/icons-material/ZoomIn'\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\n\n// locals\nimport { renderToSvg } from './components/LinearGenomeViewSvg'\nimport RefNameAutocomplete from './components/RefNameAutocomplete'\nimport SearchBox from './components/SearchBox'\nimport ExportSvgDlg from './components/ExportSvgDialog'\nimport MiniControls from './components/MiniControls'\nimport Header from './components/Header'\nimport ZoomControls from './components/ZoomControls'\nimport LinearGenomeView from './components/LinearGenomeView'\n\n// lazies\nconst SequenceSearchDialog = lazy(\n  () => import('./components/SequenceSearchDialog'),\n)\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n  assemblyName?: string\n  oob?: boolean\n}\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  Wrapper?: React.FC<any>\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    b => b.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(' ')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\nexport const SPACING = 7\nexport const WIDGET_HEIGHT = 32\n\nfunction localStorageGetItem(item: string) {\n  return typeof localStorage !== 'undefined'\n    ? localStorage.getItem(item)\n    : undefined\n}\n\n/**\n * #stateModel LinearGenomeView\n */\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseViewModel,\n      types.model('LinearGenomeView', {\n        /**\n         * #property\n         */\n        id: ElementId,\n\n        /**\n         * #property\n         * this is a string instead of the const literal 'LinearGenomeView' to reduce some\n         * typescripting strictness, but you should pass the string 'LinearGenomeView' to\n         * the model explicitly\n         */\n        type: types.literal('LinearGenomeView') as unknown as string,\n\n        /**\n         * #property\n         * corresponds roughly to the horizontal scroll of the LGV\n         */\n        offsetPx: 0,\n\n        /**\n         * #property\n         * corresponds roughly to the zoom level, base-pairs per pixel\n         */\n        bpPerPx: 1,\n\n        /**\n         * #property\n         * currently displayed regions, can be a single chromosome, arbitrary subsections,\n         * or the entire  set of chromosomes in the genome, but it not advised to use the\n         * entire set of chromosomes if your assembly is very fragmented\n         */\n        displayedRegions: types.array(MUIRegion),\n\n        /**\n         * #property\n         * array of currently displayed tracks state models instances\n         */\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        /**\n         * #property\n         * array of currently displayed tracks state model's\n         */\n        hideHeader: false,\n\n        /**\n         * #property\n         */\n        hideHeaderOverview: false,\n\n        /**\n         * #property\n         */\n        hideNoTracksActive: false,\n\n        /**\n         * #property\n         */\n        trackSelectorType: types.optional(\n          types.enumeration(['hierarchical']),\n          'hierarchical',\n        ),\n\n        /**\n         * #property\n         * how to display the track labels, can be \"overlapping\", \"offset\", or \"hidden\"\n         */\n        trackLabels: types.optional(\n          types.string,\n          () => localStorageGetItem('lgv-trackLabels') || 'overlapping',\n        ),\n\n        /**\n         * #property\n         * show the \"center line\"\n         */\n        showCenterLine: types.optional(types.boolean, () => {\n          const setting = localStorageGetItem('lgv-showCenterLine')\n          return setting !== undefined && setting !== null ? !!+setting : false\n        }),\n\n        /**\n         * #property\n         * show the \"cytobands\" in the overview scale bar\n         */\n        showCytobandsSetting: types.optional(types.boolean, () => {\n          const setting = localStorageGetItem('lgv-showCytobands')\n          return setting !== undefined && setting !== null ? !!+setting : true\n        }),\n\n        /**\n         * #property\n         * show the \"gridlines\" in the track area\n         */\n        showGridlines: true,\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 3,\n      draggingTrackId: undefined as undefined | string,\n      volatileError: undefined as undefined | Error,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackRefs: {} as { [key: string]: any },\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n      leftOffset: undefined as undefined | BpOffset,\n      rightOffset: undefined as undefined | BpOffset,\n      searchResults: undefined as undefined | BaseResult[],\n      searchQuery: undefined as undefined | string,\n      seqDialogDisplayed: false,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n      /**\n       * #getter\n       */\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      MiniControlsComponent(): React.FC<any> {\n        return MiniControls\n      },\n\n      /**\n       * #method\n       */\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      HeaderComponent(): React.FC<any> {\n        return Header\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n\n      /**\n       * #getter\n       */\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames.every(a => assemblyManager.get(a)?.initialized)\n      },\n\n      /**\n       * #getter\n       */\n      get initialized() {\n        return self.volatileWidth !== undefined && this.assembliesInitialized\n      },\n\n      /**\n       * #getter\n       */\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n\n      /**\n       * #getter\n       */\n      get isSearchDialogDisplayed() {\n        return self.searchResults !== undefined\n      },\n\n      /**\n       * #getter\n       */\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeights() {\n        return self.tracks\n          .map(t => t.displays[0].height)\n          .reduce((a, b) => a + b, 0)\n      },\n\n      /**\n       * #getter\n       */\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n\n      /**\n       * #getter\n       */\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get totalBp() {\n        return self.displayedRegions.reduce((a, b) => a + b.end - b.start, 0)\n      },\n\n      /**\n       * #getter\n       */\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      /**\n       * #getter\n       */\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      /**\n       * #getter\n       */\n      get error() {\n        return self.volatileError || this.assemblyErrors\n      },\n\n      /**\n       * #getter\n       */\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      /**\n       * #getter\n       */\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      /**\n       * #getter\n       */\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n\n      /**\n       * #method\n       */\n      searchScope(assemblyName: string) {\n        return {\n          assemblyName,\n          includeAggregateIndexes: true,\n          tracks: self.tracks,\n        }\n      },\n\n      /**\n       * #method\n       */\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      /**\n       * #method\n       */\n      rankSearchResults(results: BaseResult[]) {\n        // order of rank\n        const openTrackIds = self.tracks.map(\n          track => track.configuration.trackId,\n        )\n        results.forEach(result => {\n          if (openTrackIds.includes(result.trackId)) {\n            result.updateScore(result.getScore() + 1)\n          }\n        })\n        return results\n      },\n\n      /**\n       * #method\n       * modifies view menu action onClick to apply to all tracks of same type\n       */\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach(action => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n      /**\n       * #getter\n       */\n      get trackTypeActions() {\n        const allActions: Map<string, MenuItem[]> = new Map()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setShowCytobands(flag: boolean) {\n        self.showCytobandsSetting = flag\n        localStorage.setItem('lgv-showCytobands', `${+flag}`)\n      },\n      /**\n       * #action\n       */\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      /**\n       * #action\n       */\n      setError(error: Error | undefined) {\n        self.volatileError = error\n      },\n      /**\n       * #action\n       */\n      toggleHeader() {\n        self.hideHeader = !self.hideHeader\n      },\n      /**\n       * #action\n       */\n      toggleHeaderOverview() {\n        self.hideHeaderOverview = !self.hideHeaderOverview\n      },\n      /**\n       * #action\n       */\n      toggleNoTracksActive() {\n        self.hideNoTracksActive = !self.hideNoTracksActive\n      },\n      /**\n       * #action\n       */\n      toggleShowGridlines() {\n        self.showGridlines = !self.showGridlines\n      },\n      /**\n       * #action\n       */\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      zoomTo(bpPerPx: number) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n        self.bpPerPx = newBpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n\n        // tweak the offset so that the center of the view remains at the same coordinate\n        const viewWidth = self.width\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + viewWidth / 2) * oldBpPerPx) / newBpPerPx -\n              viewWidth / 2,\n          ),\n        )\n        return newBpPerPx\n      },\n\n      /**\n       * #action\n       * sets offsets used in the get sequence dialog\n       */\n      setOffsets(left?: BpOffset, right?: BpOffset) {\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      /**\n       * #action\n       */\n      setSearchResults(results?: BaseResult[], query?: string) {\n        self.searchResults = results\n        self.searchQuery = query\n      },\n\n      /**\n       * #action\n       */\n      setGetSequenceDialogOpen(open: boolean) {\n        self.seqDialogDisplayed = open\n      },\n\n      /**\n       * #action\n       */\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      /**\n       * #action\n       */\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          self.displayedRegions\n            .slice()\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      /**\n       * #action\n       */\n      showTrack(\n        trackId: string,\n        initialSnapshot = {},\n        displayInitialSnapshot = {},\n      ) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!conf) {\n          throw new Error(`Could not resolve identifier \"${trackId}\"`)\n        }\n        const trackType = pluginManager.getTrackType(conf?.type)\n        if (!trackType) {\n          throw new Error(`Unknown track type ${conf.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(d => d.name)\n        const displayConf = conf.displays.find((d: AnyConfigurationModel) =>\n          supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `Could not find a compatible display for view type ${self.type}`,\n          )\n        }\n\n        const t = self.tracks.filter(t => t.configuration === conf)\n        if (t.length === 0) {\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: conf.type,\n            configuration: conf,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n                ...displayInitialSnapshot,\n              },\n            ],\n          })\n          self.tracks.push(track)\n          return track\n        }\n        return t[0]\n      },\n      /**\n       * #action\n       */\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const conf = resolveIdentifier(schema, getRoot(self), trackId)\n        const t = self.tracks.filter(t => t.configuration === conf)\n        transaction(() => t.forEach(t => self.tracks.remove(t)))\n        return t.length\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveTrack(movingId: string, targetId: string) {\n        const oldIndex = self.tracks.findIndex(track => track.id === movingId)\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(track => track.id === targetId)\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetId} not found`)\n        }\n        const track = getSnapshot(self.tracks[oldIndex])\n        self.tracks.splice(oldIndex, 1)\n        self.tracks.splice(newIndex, 0, track)\n      },\n\n      /**\n       * #action\n       */\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) {\n            parent.removeView(self)\n          }\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      /**\n       * #action\n       */\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        self.trackLabels = setting\n        localStorage.setItem('lgv-trackLabels', setting)\n      },\n\n      /**\n       * #action\n       */\n      toggleCenterLine() {\n        self.showCenterLine = !self.showCenterLine\n        localStorage.setItem('lgv-showCenterLine', `${+self.showCenterLine}`)\n      },\n\n      /**\n       * #action\n       */\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      /**\n       * #action\n       */\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      /**\n       * #method\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`, offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(leftOffset?: BpOffset, rightOffset?: BpOffset) {\n        const snap = getSnapshot(self)\n        const simView = Base1DView.create({\n          ...snap,\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.moveTo(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => ({\n          ...region,\n          start: Math.floor(region.start),\n          end: Math.ceil(region.end),\n        }))\n      },\n\n      /**\n       * #action\n       * schedule something to be run after the next time displayedRegions is set\n       */\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n\n      /**\n       * #action\n       */\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * #action\n       */\n      center() {\n        const centerBp = self.totalBp / 2\n        const centerPx = centerBp / self.bpPerPx\n        self.scrollTo(Math.round(centerPx - self.width / 2))\n      },\n\n      /**\n       * #action\n       */\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      /**\n       * #action\n       */\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const names = new Set(self.displayedRegions.map(r => r.assemblyName))\n          if (names.size > 1) {\n            session.notify(\n              `Can't perform operation with multiple assemblies currently`,\n            )\n            return\n          }\n          ;[assemblyName] = [...names]\n        }\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const { regions } = assembly\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      /**\n       * #action\n       */\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n\n      /**\n       * #action\n       * this \"clears the view\" and makes the view return to the import form\n       */\n      clearView() {\n        self.displayedRegions.clear()\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n\n      /**\n       * #action\n       * creates an svg export and save using FileSaver\n       */\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const html = await renderToSvg(self as any, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated slide\n       */\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      /**\n       * #action\n       * perform animated zoom\n       */\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get canShowCytobands() {\n        return self.displayedRegions.length === 1 && this.anyCytobandsExist\n      },\n      /**\n       * #getter\n       */\n      get showCytobands() {\n        return this.canShowCytobands && self.showCytobandsSetting\n      },\n      /**\n       * #getter\n       */\n      get anyCytobandsExist() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames.some(\n          a => assemblyManager.get(a)?.cytobands?.length,\n        )\n      },\n      /**\n       * #getter\n       * the cytoband is displayed to the right of the chromosome name,\n       * and that offset is calculated manually with this method\n       */\n      get cytobandOffset() {\n        return this.showCytobands\n          ? measureText(self.displayedRegions[0].refName, 12) + 15\n          : 0\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * return the view menu items\n       */\n      menuItems(): MenuItem[] {\n        const { canShowCytobands, showCytobands } = self\n        const session = getSession(self)\n        const menuItems: MenuItem[] = [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          ...(isSessionWithAddTracks(session)\n            ? [\n                {\n                  label: 'Sequence search',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SequenceSearchDialog,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n              ]\n            : []),\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDlg,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n          {\n            label: 'Horizontally flip',\n            icon: SyncAltIcon,\n            onClick: self.horizontallyFlip,\n          },\n          {\n            label: 'Show...',\n            icon: VisibilityIcon,\n            subMenu: [\n              {\n                label: 'Show all regions in assembly',\n                onClick: self.showAllRegionsInAssembly,\n              },\n              {\n                label: 'Show center line',\n                type: 'checkbox',\n                checked: self.showCenterLine,\n                onClick: self.toggleCenterLine,\n              },\n              {\n                label: 'Show header',\n                type: 'checkbox',\n                checked: !self.hideHeader,\n                onClick: self.toggleHeader,\n              },\n              {\n                label: 'Show header overview',\n                type: 'checkbox',\n                checked: !self.hideHeaderOverview,\n                onClick: self.toggleHeaderOverview,\n                disabled: self.hideHeader,\n              },\n              {\n                label: 'Show no tracks active button',\n                type: 'checkbox',\n                checked: !self.hideNoTracksActive,\n                onClick: self.toggleNoTracksActive,\n              },\n              {\n                label: 'Show guidelines',\n                type: 'checkbox',\n                checked: self.showGridlines,\n                onClick: self.toggleShowGridlines,\n              },\n              ...(canShowCytobands\n                ? [\n                    {\n                      label: 'Show ideogram',\n                      type: 'checkbox' as const,\n                      checked: self.showCytobands,\n                      onClick: () => self.setShowCytobands(!showCytobands),\n                    },\n                  ]\n                : []),\n            ],\n          },\n          {\n            label: 'Track labels',\n            icon: LabelIcon,\n            subMenu: [\n              {\n                label: 'Overlapping',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'overlapping',\n                onClick: () => self.setTrackLabels('overlapping'),\n              },\n              {\n                label: 'Offset',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'offset',\n                onClick: () => self.setTrackLabels('offset'),\n              },\n              {\n                label: 'Hidden',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'hidden',\n                onClick: () => self.setTrackLabels('hidden'),\n              },\n            ],\n          },\n        ]\n\n        // add track's view level menu options\n        for (const [key, value] of self.trackTypeActions.entries()) {\n          if (value.length) {\n            menuItems.push(\n              { type: 'divider' },\n              { type: 'subHeader', label: key },\n            )\n            value.forEach(action => menuItems.push(action))\n          }\n        }\n\n        return menuItems\n      },\n    }))\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        /**\n         * #getter\n         * static blocks are an important concept jbrowse uses to avoid\n         * re-rendering when you scroll to the side. when you horizontally\n         * scroll to the right, old blocks to the left may be removed, and\n         * new blocks may be instantiated on the right. tracks may use the\n         * static blocks to render their data for the region represented by\n         * the block\n         */\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks as BlockSet\n        },\n        /**\n         * #getter\n         * dynamic blocks represent the exact coordinates of the currently\n         * visible genome regions on the screen. they are similar to static\n         * blocks, but statcic blocks can go offscreen while dynamic blocks\n         * represent exactly what is on screen\n         */\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n        /**\n         * #getter\n         * rounded dynamic blocks are dynamic blocks without fractions of bp\n         */\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(\n            block =>\n              ({\n                ...block,\n                start: Math.floor(block.start),\n                end: Math.ceil(block.end),\n              } as BaseBlock),\n          )\n        },\n\n        /**\n         * #getter\n         * a single \"combo-locstring\" representing all the regions visible\n         * on the screen\n         */\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n\n        /**\n         * #getter\n         * same as visibleLocStrings, but only updated every 300ms\n         */\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * offset is the base-pair-offset in the displayed region, index is the index of the\n       * displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start?: BpOffset, end?: BpOffset) {\n        moveTo(self, start, end)\n      },\n\n      /**\n       * #action\n       * navigate to the given locstring\n       *\n       * @param locString - e.g. \"chr1:1-100\"\n       * @param optAssemblyName - (optional) the assembly name to use when navigating to the locstring\n       */\n      async navToLocString(locString: string, optAssemblyName?: string) {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const assemblyName = optAssemblyName || assemblyNames[0]\n        let parsedLocStrings\n        const inputs = locString\n          .split(/(\\s+)/)\n          .map(f => f.trim())\n          .filter(f => !!f)\n\n        if (assemblyName) {\n          await assemblyManager.waitForAssembly(assemblyName)\n        }\n\n        // first try interpreting as a whitespace-separated sequence of\n        // multiple locstrings\n        try {\n          parsedLocStrings = inputs.map(l =>\n            parseLocString(l, ref => isValidRefName(ref, assemblyName)),\n          )\n        } catch (e) {\n          // if this fails, try interpreting as a whitespace-separated refname,\n          // start, end if start and end are integer inputs\n          const [refName, start, end] = inputs\n          if (\n            `${e}`.match(/Unknown reference sequence/) &&\n            Number.isInteger(+start) &&\n            Number.isInteger(+end)\n          ) {\n            parsedLocStrings = [\n              parseLocString(refName + ':' + start + '..' + end, ref =>\n                isValidRefName(ref, assemblyName),\n              ),\n            ]\n          } else {\n            throw e\n          }\n        }\n\n        const locations = await Promise.all(\n          parsedLocStrings?.map(async region => {\n            const asmName = region.assemblyName || assemblyName\n            const asm = await assemblyManager.waitForAssembly(asmName)\n            const { refName } = region\n            if (!asm) {\n              throw new Error(`assembly ${asmName} not found`)\n            }\n            const { regions } = asm\n            if (!regions) {\n              throw new Error(`regions not loaded yet for ${asmName}`)\n            }\n            const canonicalRefName = asm.getCanonicalRefName(region.refName)\n            if (!canonicalRefName) {\n              throw new Error(\n                `Could not find refName ${refName} in ${asm.name}`,\n              )\n            }\n            const parentRegion = regions.find(\n              r => r.refName === canonicalRefName,\n            )\n            if (!parentRegion) {\n              throw new Error(`Could not find refName ${refName} in ${asmName}`)\n            }\n\n            return {\n              ...region,\n              assemblyName: asmName,\n              parentRegion,\n            }\n          }),\n        )\n\n        if (locations.length === 1) {\n          const loc = locations[0]\n          self.setDisplayedRegions([\n            { reversed: loc.reversed, ...loc.parentRegion },\n          ])\n          const { start, end, parentRegion } = loc\n\n          this.navTo({\n            ...loc,\n            start: clamp(start ?? 0, 0, parentRegion.end),\n            end: clamp(end ?? parentRegion.end, 0, parentRegion.end),\n          })\n        } else {\n          self.setDisplayedRegions(\n            // @ts-ignore\n            locations.map(r => (r.start === undefined ? r.parentRegion : r)),\n          )\n          self.showAllRegions()\n        }\n      },\n\n      /**\n       * #action\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Can handle if there are multiple displayedRegions\n       * from same refName. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param query - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      /**\n       * #action\n       */\n      navToMultiple(locations: NavLocation[]) {\n        const firstLocation = locations[0]\n        let { refName } = firstLocation\n        const {\n          start,\n          end,\n          assemblyName = self.assemblyNames[0],\n        } = firstLocation\n\n        if (start !== undefined && end !== undefined && start > end) {\n          throw new Error(`start \"${start + 1}\" is greater than end \"${end}\"`)\n        }\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const canonicalRefName = assembly.getCanonicalRefName(refName)\n          if (canonicalRefName) {\n            refName = canonicalRefName\n          }\n        }\n        let s = start\n        let e = end\n        let refNameMatched = false\n        const predicate = (r: Region) => {\n          if (refName === r.refName) {\n            refNameMatched = true\n            if (s === undefined) {\n              s = r.start\n            }\n            if (e === undefined) {\n              e = r.end\n            }\n            if (s >= r.start && s <= r.end && e <= r.end && e >= r.start) {\n              return true\n            }\n            s = start\n            e = end\n          }\n          return false\n        }\n\n        const lastIndex = findLastIndex(self.displayedRegions, predicate)\n        let index\n        while (index !== lastIndex) {\n          try {\n            const previousIndex: number | undefined = index\n            index = self.displayedRegions\n              .slice(previousIndex === undefined ? 0 : previousIndex + 1)\n              .findIndex(predicate)\n            if (previousIndex !== undefined) {\n              index += previousIndex + 1\n            }\n            if (!refNameMatched) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\"`,\n              )\n            }\n            if (s === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained an end position ${e}`,\n              )\n            }\n            if (e === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained a start position ${\n                  s + 1\n                }`,\n              )\n            }\n            if (index === -1) {\n              throw new Error(\n                `could not find a region that completely contained \"${assembleLocString(\n                  firstLocation,\n                )}\"`,\n              )\n            }\n            if (locations.length === 1) {\n              const f = self.displayedRegions[index]\n              this.moveTo(\n                { index, offset: f.reversed ? f.end - e : s - f.start },\n                { index, offset: f.reversed ? f.end - s : e - f.start },\n              )\n              return\n            }\n            let idx = 0\n            let start = 0\n            let end = 0\n            for (idx; idx < locations.length; idx++) {\n              const location = locations[idx]\n              const region = self.displayedRegions[index + idx]\n              start = location.start || region.start\n              end = location.end || region.end\n              if (location.refName !== region.refName) {\n                throw new Error(\n                  `Entered location ${assembleLocString(\n                    location,\n                  )} does not match with displayed regions`,\n                )\n              }\n            }\n            idx -= 1\n            const startDisplayedRegion = self.displayedRegions[index]\n            const endDisplayedRegion = self.displayedRegions[index + idx]\n            this.moveTo(\n              {\n                index,\n                offset: startDisplayedRegion.reversed\n                  ? startDisplayedRegion.end - e\n                  : s - startDisplayedRegion.start,\n              },\n              {\n                index: index + idx,\n                offset: endDisplayedRegion.reversed\n                  ? endDisplayedRegion.end - start\n                  : end - endDisplayedRegion.start,\n              },\n            )\n            return\n          } catch (error) {\n            if (index === lastIndex) {\n              throw error\n            }\n          }\n        }\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      rubberBandMenuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Zoom to region',\n            icon: ZoomInIcon,\n            onClick: () => {\n              const { leftOffset, rightOffset } = self\n              self.moveTo(leftOffset, rightOffset)\n            },\n          },\n          {\n            label: 'Get sequence',\n            icon: MenuOpenIcon,\n            onClick: () => self.setGetSequenceDialogOpen(true),\n          },\n        ]\n      },\n\n      /**\n       * #method\n       */\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        return bpToPx({ refName, coord, regionNumber, self })\n      },\n\n      /**\n       * #method\n       * scrolls the view to center on the given bp. if that is not in any\n       * of the displayed regions, does nothing\n       * @param coord - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionNumber - index of the displayedRegion\n       */\n      centerAt(coord: number, refName: string, regionNumber: number) {\n        const centerPx = this.bpToPx({\n          refName,\n          coord,\n          regionNumber,\n        })\n        if (centerPx) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      /**\n       * #method\n       */\n      pxToBp(px: number) {\n        return pxToBp(self, px)\n      },\n\n      /**\n       * #getter\n       */\n      get centerLineInfo() {\n        return self.displayedRegions.length\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n}\n\nexport {\n  renderToSvg,\n  RefNameAutocomplete,\n  SearchBox,\n  ZoomControls,\n  LinearGenomeView,\n}\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\nexport { default as ReactComponent } from './components/LinearGenomeView'\n","/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) {\n    return []\n  }\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.ceil(minBase / iterPitch) * iterPitch;\n    base < maxBase;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BaseLinearDisplay\n * BaseLinearDisplay is a \"base\" config that is extended by classes like\n * \"LinearBasicDisplay\" (used for feature tracks, etc) and \"LinearBareDisplay\"\n * (more stripped down than even the basic display, not commonly used)\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    /**\n     * #slot\n     */\n    maxFeatureScreenDensity: {\n      type: 'number',\n      description:\n        'maximum features per pixel that is displayed in the view, used if byte size estimates not available',\n      defaultValue: 0.3,\n    },\n    /**\n     * #slot\n     */\n    fetchSizeLimit: {\n      type: 'number',\n      defaultValue: 1_000_000,\n      description:\n        \"maximum data to attempt to download for a given track, used if adapter doesn't specify one\",\n    },\n  },\n  {\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'displayId',\n  },\n)\n","// takes an array or Map or Set (anything iterable with values()) of Maps\n// and lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  constructor(private submaps: Map<T, U>[]) {}\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return submap.get(id)\n      }\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import React from 'react'\nimport { Tooltip, Button, Alert, AlertColor } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()({\n  ellipses: {\n    textOverflow: 'ellipsis',\n    overflow: 'hidden',\n  },\n})\n\nexport default function BlockMsg({\n  message,\n  severity,\n  buttonText,\n  icon,\n  action,\n}: {\n  message: string\n  severity?: AlertColor\n  buttonText?: string\n  icon?: React.ReactNode\n  action?: () => void\n}) {\n  const { classes } = useStyles()\n  const button = action ? (\n    <Button data-testid=\"reload_button\" onClick={action} startIcon={icon}>\n      {buttonText}\n    </Button>\n  ) : null\n  return (\n    <Tooltip title={message}>\n      <Alert\n        severity={severity}\n        action={button}\n        classes={{ message: classes.ellipses }}\n      >\n        {message}\n      </Alert>\n    </Tooltip>\n  )\n}\n","import React from 'react'\nimport BlockMsg from '../components/BlockMsg'\nimport { Stats } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nfunction TooLargeMessage({\n  model,\n}: {\n  model: {\n    regionTooLargeReason: string\n    estimatedRegionStats?: Stats\n    updateStatsLimit: (s: Stats) => void\n    reload: () => void\n  }\n}) {\n  const { regionTooLargeReason } = model\n  return (\n    <BlockMsg\n      severity=\"warning\"\n      action={() => {\n        if (!model.estimatedRegionStats) {\n          console.error('No global stats?')\n        } else {\n          model.updateStatsLimit(model.estimatedRegionStats)\n          model.reload()\n        }\n      }}\n      buttonText=\"Force load\"\n      message={`${regionTooLargeReason ? regionTooLargeReason + '. ' : ''}\n      Zoom in to see features or force load (may be slow).`}\n    />\n  )\n}\n\nexport default TooLargeMessage\n","import React, { useState, useMemo } from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { SanitizedHTML } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport { Portal, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { usePopper } from 'react-popper'\n\n// locals\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n}))\n\nconst TooltipContents = React.forwardRef<\n  HTMLDivElement,\n  { message: React.ReactNode | string }\n>(({ message }: { message: React.ReactNode | string }, ref) => {\n  return (\n    <div ref={ref}>\n      {React.isValidElement(message) ? (\n        message\n      ) : message ? (\n        <SanitizedHTML html={String(message)} />\n      ) : null}\n    </div>\n  )\n})\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    clientMouseCoord,\n  }: {\n    model: BaseLinearDisplayModel\n    clientMouseCoord: Coord\n  }) => {\n    const { classes } = useStyles()\n    const { featureUnderMouse } = model\n    const [width, setWidth] = useState(0)\n    const [popperElt, setPopperElt] = useState<HTMLDivElement | null>(null)\n\n    // must be memoized a la https://github.com/popperjs/react-popper/issues/391\n    const virtElement = useMemo(\n      () => ({\n        getBoundingClientRect: () => {\n          const x = clientMouseCoord[0] + width / 2 + 20\n          const y = clientMouseCoord[1]\n          return {\n            top: y,\n            left: x,\n            bottom: y,\n            right: x,\n            width: 0,\n            height: 0,\n            x,\n            y,\n            toJSON() {},\n          }\n        },\n      }),\n      [clientMouseCoord, width],\n    )\n    const { styles, attributes } = usePopper(virtElement, popperElt)\n\n    const contents = featureUnderMouse\n      ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n      : undefined\n\n    return featureUnderMouse && contents ? (\n      <Portal>\n        <div\n          ref={setPopperElt}\n          className={classes.tooltip}\n          // zIndex needed to go over widget drawer\n          style={{ ...styles.popper, zIndex: 100000 }}\n          {...attributes.popper}\n        >\n          <TooltipContents\n            ref={elt => setWidth(elt?.getBoundingClientRect().width || 0)}\n            message={contents}\n          />\n        </div>\n      </Portal>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import React from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\n\nconst useStyles = makeStyles()({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\nconst RenderedBlocks = observer(\n  ({ model }: { model: BaseLinearDisplayModel }) => {\n    const { classes } = useStyles()\n    const { blockDefinitions, blockState } = model\n    return (\n      <>\n        {blockDefinitions.map(block => {\n          if (block instanceof ContentBlock) {\n            const state = blockState.get(block.key)\n\n            return (\n              <ContentBlockComponent\n                block={block}\n                key={`${model.id}-${block.key}`}\n              >\n                {state && state.ReactComponent ? (\n                  <state.ReactComponent model={state} />\n                ) : null}\n                {state && state.maxHeightReached ? (\n                  <div\n                    className={classes.heightOverflowed}\n                    style={{\n                      top: state.layout.getTotalHeight() - 16,\n                      pointerEvents: 'none',\n                      height: 16,\n                    }}\n                  >\n                    Max height reached\n                  </div>\n                ) : null}\n              </ContentBlockComponent>\n            )\n          }\n          if (block instanceof ElidedBlock) {\n            return (\n              <ElidedBlockComponent\n                key={`${model.id}-${block.key}`}\n                width={block.widthPx}\n              />\n            )\n          }\n          if (block instanceof InterRegionPaddingBlock) {\n            return (\n              <InterRegionPaddingBlockComponent\n                key={block.key}\n                width={block.widthPx}\n                style={{ background: 'none' }}\n                boundary={block.variant === 'boundary'}\n              />\n            )\n          }\n          throw new Error(`invalid block type ${typeof block}`)\n        })}\n      </>\n    )\n  },\n)\nfunction LinearBlocks({ model }: { model: BaseLinearDisplayModel }) {\n  const { classes } = useStyles()\n  const { blockDefinitions } = model\n  const viewModel = getContainingView(model) as LinearGenomeViewModel\n  return (\n    <div\n      data-testid=\"Blockset\"\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n}\n\nexport { RenderedBlocks, useStyles }\nexport default observer(LinearBlocks)\n","import React, { useState, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\n\n// locals\nimport Tooltip from './Tooltip'\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles()({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(\n  (props: { model: BaseLinearDisplayModel; children?: React.ReactNode }) => {\n    const { classes } = useStyles()\n    const theme = useTheme()\n    const ref = useRef<HTMLDivElement>(null)\n    const [clientRect, setClientRect] = useState<DOMRect>()\n    const [offsetMouseCoord, setOffsetMouseCoord] = useState<Coord>([0, 0])\n    const [clientMouseCoord, setClientMouseCoord] = useState<Coord>([0, 0])\n    const [contextCoord, setContextCoord] = useState<Coord>()\n    const { model, children } = props\n    const {\n      TooltipComponent,\n      DisplayMessageComponent,\n      contextMenuItems,\n      height,\n      setContextMenuFeature,\n    } = model\n\n    return (\n      <div\n        ref={ref}\n        data-testid={`display-${getConf(model, 'displayId')}`}\n        className={classes.display}\n        onContextMenu={event => {\n          event.preventDefault()\n          if (contextCoord) {\n            // There's already a context menu open, so close it\n            setContextCoord(undefined)\n          } else if (ref.current) {\n            setContextCoord([event.clientX, event.clientY])\n          }\n        }}\n        onMouseMove={event => {\n          if (!ref.current) {\n            return\n          }\n          const rect = ref.current.getBoundingClientRect()\n          const { left, top } = rect\n          setOffsetMouseCoord([event.clientX - left, event.clientY - top])\n          setClientMouseCoord([event.clientX, event.clientY])\n          setClientRect(rect)\n        }}\n      >\n        {DisplayMessageComponent ? (\n          <DisplayMessageComponent model={model} />\n        ) : (\n          <LinearBlocks {...props} />\n        )}\n        {children}\n\n        <TooltipComponent\n          model={model}\n          height={height}\n          offsetMouseCoord={offsetMouseCoord}\n          clientMouseCoord={clientMouseCoord}\n          clientRect={clientRect}\n          mouseCoord={offsetMouseCoord}\n        />\n\n        <Menu\n          open={Boolean(contextCoord) && Boolean(contextMenuItems().length)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setContextCoord(undefined)\n          }}\n          onClose={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          TransitionProps={{\n            onExit: () => {\n              setContextCoord(undefined)\n              setContextMenuFeature(undefined)\n            },\n          }}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextCoord\n              ? { top: contextCoord[1], left: contextCoord[0] }\n              : undefined\n          }\n          style={{ zIndex: theme.zIndex.tooltip }}\n          menuItems={contextMenuItems()}\n        />\n      </div>\n    )\n  },\n)\n\nexport default BaseLinearDisplay\nexport { Tooltip }\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\nimport RefreshIcon from '@mui/icons-material/Refresh'\n\nimport BlockMsg from './BlockMsg'\n\nconst useStyles = makeStyles()(theme => ({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: theme.palette.action.disabledBackground,\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n}))\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LoadingMessage = observer(({ model }: { model: any }) => {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const { classes } = useStyles()\n  useEffect(() => {\n    let killed = false\n    const timeout = setTimeout(() => {\n      if (!killed) {\n        setShown(true)\n      }\n    }, 300)\n    return () => {\n      clearTimeout(timeout)\n      killed = true\n    }\n  }, [])\n\n  const { status: blockStatus } = model\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { message: displayStatus } = getParent<any>(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <>\n      {shown ? (\n        <div className={classes.loading}>\n          <LoadingEllipses message={status} />\n        </div>\n      ) : null}\n    </>\n  )\n})\n\nconst ServerSideRenderedBlockContent = observer(\n  ({\n    model,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    model: any\n  }) => {\n    if (model.error) {\n      return (\n        <BlockMsg\n          message={`${model.error}`}\n          severity=\"error\"\n          buttonText=\"reload\"\n          icon={<RefreshIcon />}\n          action={model.reload}\n        />\n      )\n    }\n    if (model.message) {\n      // the message can be a fully rendered react component, e.g. the region too large message\n      return React.isValidElement(model.message) ? (\n        model.message\n      ) : (\n        <BlockMsg message={`${model.message}`} severity=\"info\" />\n      )\n    }\n    if (!model.filled) {\n      return <LoadingMessage model={model} />\n    }\n    return model.reactElement\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { types, getParent, isAlive, cast, Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  assembleLocString,\n  getSession,\n  getContainingDisplay,\n  getContainingView,\n  getViewParams,\n  makeAbortableReaction,\n  Feature,\n} from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport {\n  AbstractDisplayModel,\n  isRetryException,\n} from '@jbrowse/core/util/types'\n\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    reloadFlag: 0,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    features: undefined as Map<string, Feature> | undefined,\n    layout: undefined as any,\n    status: '',\n    error: undefined as unknown,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      doReload() {\n        self.reloadFlag = self.reloadFlag + 1\n      },\n      afterAttach() {\n        const display = getContainingDisplay(self)\n        makeAbortableReaction(\n          self as any,\n          renderBlockData,\n          renderBlockEffect as any, // reaction doesn't expect async here\n          {\n            name: `${display.id}/${assembleLocString(self.region)} rendering`,\n            delay: display.renderDelay,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (renderInProgress !== undefined) {\n          if (!renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n        }\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              reactElement: React.ReactElement\n              features: Map<string, Feature>\n              layout: any\n              maxHeightReached: boolean\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          reactElement,\n          features,\n          layout,\n          maxHeightReached,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.features = features\n        self.layout = layout\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: Error | unknown) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderProps = undefined\n        renderInProgress = undefined\n        if (isRetryException(error as Error)) {\n          this.reload()\n        }\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderProps = undefined\n        getParent<any>(self, 2).reload()\n      },\n      beforeDestroy() {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        const display = getContainingDisplay(self)\n        const { rpcManager } = getSession(self)\n        const { rendererType } = display\n        const { renderArgs } = renderBlockData(cast(self))\n        // renderArgs can be undefined if an error occured in this block\n        if (renderArgs) {\n          rendererType\n            .freeResourcesInClient(\n              rpcManager,\n              JSON.parse(JSON.stringify(renderArgs)),\n            )\n            .catch((e: Error) => {\n              // just console.error if it's something while it's being destroyed\n              console.warn('Error while destroying block', e)\n            })\n        }\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: BlockModel,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const { adapterConfig, rendererType, error, parentTrack } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.find(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const renderProps = display.renderProps()\n    const { config } = renderProps\n\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const layoutId = getContainingView(display).id\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError: error,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        layoutId,\n        blockKey: self.key,\n        reloadFlag: self.reloadFlag,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\ninterface RenderProps {\n  displayError: Error\n  rendererType: any\n  renderProps: { [key: string]: any }\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n  renderArgs: { [key: string]: any }\n}\n\ninterface ErrorProps {\n  displayError: string\n}\n\nasync function renderBlockEffect(\n  props: RenderProps | ErrorProps,\n  signal: AbortSignal,\n  self: BlockModel,\n) {\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props as RenderProps\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const { reactElement, features, layout, maxHeightReached } =\n    await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      ...renderProps,\n      viewParams: getViewParams(self),\n      signal,\n    })\n  return {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  isAbortException,\n  getContainingView,\n  getContainingTrack,\n  getSession,\n  getViewParams,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { Stats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Region } from '@jbrowse/core/util/types'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\n\n// icons\nimport MenuOpenIcon from '@mui/icons-material/MenuOpen'\n\n// locals\nimport TooLargeMessage from './TooLargeMessage'\nimport { LinearGenomeViewModel, ExportSvgOptions } from '../../LinearGenomeView'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState, { renderBlockData } from './serverSideRenderedBlock'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\n// stabilize clipid under test for snapshot\nfunction getId(id: string, index: number) {\n  const isJest = typeof jest === 'undefined'\n  return `clip-${isJest ? id : 'jest'}-${index}`\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nfunction getDisplayStr(totalBytes: number) {\n  let displayBp\n  if (Math.floor(totalBytes / 1000000) > 0) {\n    displayBp = `${parseFloat((totalBytes / 1000000).toPrecision(3))} Mb`\n  } else if (Math.floor(totalBytes / 1000) > 0) {\n    displayBp = `${parseFloat((totalBytes / 1000).toPrecision(3))} Kb`\n  } else {\n    displayBp = `${Math.floor(totalBytes)} bytes`\n  }\n  return displayBp\n}\n\nconst minDisplayHeight = 20\nconst defaultDisplayHeight = 100\n\n/**\n * #stateModel BaseLinearDisplay\n * extends `BaseDisplay`\n */\nfunction stateModelFactory() {\n  return types\n    .compose(\n      'BaseLinearDisplay',\n      BaseDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        height: types.optional(\n          types.refinement(\n            'displayHeight',\n            types.number,\n            n => n >= minDisplayHeight,\n          ),\n          defaultDisplayHeight,\n        ),\n        /**\n         * #property\n         * updated via autorun\n         */\n        blockState: types.map(BlockState),\n        /**\n         * #property\n         */\n        userBpPerPxLimit: types.maybe(types.number),\n        /**\n         * #property\n         */\n        userByteSizeLimit: types.maybe(types.number),\n      }),\n    )\n    .volatile(() => ({\n      currBpPerPx: 0,\n      message: '',\n      featureIdUnderMouse: undefined as undefined | string,\n      contextMenuFeature: undefined as undefined | Feature,\n      scrollTop: 0,\n      estimatedRegionStatsP: undefined as undefined | Promise<Stats>,\n      estimatedRegionStats: undefined as undefined | Stats,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n        return 'staticBlocks'\n      },\n      /**\n       * #getter\n       */\n      get blockDefinitions() {\n        const { blockType } = this\n        const view = getContainingView(self) as LGV\n        if (!view.initialized) {\n          throw new Error('view not initialized yet')\n        }\n        return view[blockType]\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * how many milliseconds to wait for the display to\n       * \"settle\" before re-rendering a block\n       */\n      get renderDelay() {\n        return 50\n      },\n\n      /**\n       * #getter\n       */\n      get TooltipComponent(): React.FC<any> {\n        return Tooltip as unknown as React.FC\n      },\n\n      /**\n       * #getter\n       * returns a string feature ID if the globally-selected object\n       * is probably a feature\n       */\n      get selectedFeatureId() {\n        if (isAlive(self)) {\n          const { selection } = getSession(self)\n          // does it quack like a feature?\n          if (isFeature(selection)) {\n            return selection.id()\n          }\n        }\n        return undefined\n      },\n      /**\n       * #getter\n       * if a display-level message should be displayed instead of the blocks,\n       * make this return a react component\n       */\n      get DisplayMessageComponent() {\n        return undefined as undefined | React.FC<any>\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * a CompositeMap of `featureId -> feature obj` that\n       * just looks in all the block data for that feature\n       */\n      get features() {\n        const featureMaps = []\n        for (const block of self.blockState.values()) {\n          if (block && block.features) {\n            featureMaps.push(block.features)\n          }\n        }\n        return new CompositeMap(featureMaps)\n      },\n\n      /**\n       * #getter\n       */\n      get featureUnderMouse() {\n        const feat = self.featureIdUnderMouse\n        return feat ? this.features.get(feat) : undefined\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureOverlapping(blockKey: string, x: number, y: number) {\n        return self.blockState.get(blockKey)?.layout?.getByCoord(x, y)\n      },\n\n      /**\n       * #getter\n       */\n      getFeatureByID(blockKey: string, id: string): LayoutRecord | undefined {\n        return self.blockState.get(blockKey)?.layout?.getByID(id)\n      },\n\n      /**\n       * #getter\n       */\n      searchFeatureByID(id: string): LayoutRecord | undefined {\n        let ret\n        self.blockState.forEach(block => {\n          const val = block?.layout?.getByID(id)\n          if (val) {\n            ret = val\n          }\n        })\n        return ret\n      },\n\n      /**\n       * #getter\n       */\n      get currentBytesRequested() {\n        return self.estimatedRegionStats?.bytes || 0\n      },\n\n      /**\n       * #getter\n       */\n      get currentFeatureScreenDensity() {\n        const view = getContainingView(self) as LGV\n        return (self.estimatedRegionStats?.featureDensity || 0) * view.bpPerPx\n      },\n\n      /**\n       * #getter\n       */\n      get maxFeatureScreenDensity() {\n        return getConf(self, 'maxFeatureScreenDensity')\n      },\n      /**\n       * #getter\n       */\n      get estimatedStatsReady() {\n        return !!self.estimatedRegionStats\n      },\n\n      /**\n       * #getter\n       */\n      get maxAllowableBytes() {\n        return (\n          self.userByteSizeLimit ||\n          self.estimatedRegionStats?.fetchSizeLimit ||\n          (getConf(self, 'fetchSizeLimit') as number)\n        )\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setMessage(message: string) {\n        self.message = message\n      },\n\n      afterAttach() {\n        // watch the parent's blocks to update our block state when they change,\n        // then we recreate the blocks on our own model (creating and deleting to\n        // match the parent blocks)\n        const blockWatchDisposer = autorun(() => {\n          const blocksPresent: { [key: string]: boolean } = {}\n          const view = getContainingView(self) as LGV\n          if (view.initialized) {\n            self.blockDefinitions.contentBlocks.forEach(block => {\n              blocksPresent[block.key] = true\n              if (!self.blockState.has(block.key)) {\n                this.addBlock(block.key, block)\n              }\n            })\n            self.blockState.forEach((_, key) => {\n              if (!blocksPresent[key]) {\n                this.deleteBlock(key)\n              }\n            })\n          }\n        })\n\n        addDisposer(self, blockWatchDisposer)\n      },\n\n      /**\n       * #action\n       */\n      estimateRegionsStats(\n        regions: Region[],\n        opts: {\n          headers?: Record<string, string>\n          signal?: AbortSignal\n          filters?: string[]\n        },\n      ) {\n        if (self.estimatedRegionStatsP) {\n          return self.estimatedRegionStatsP\n        }\n\n        const { rpcManager } = getSession(self)\n        const { adapterConfig } = self\n        if (!adapterConfig) {\n          // A track extending the base track might not have an adapter config\n          // e.g. Apollo tracks don't use adapters\n          return Promise.resolve({})\n        }\n        const sessionId = getRpcSessionId(self)\n\n        const params = {\n          sessionId,\n          regions,\n          adapterConfig,\n          statusCallback: (message: string) => {\n            if (isAlive(self)) {\n              this.setMessage(message)\n            }\n          },\n          ...opts,\n        }\n\n        self.estimatedRegionStatsP = rpcManager\n          .call(sessionId, 'CoreEstimateRegionStats', params)\n          .catch(e => {\n            this.setRegionStatsP(undefined)\n            throw e\n          }) as Promise<Stats>\n\n        return self.estimatedRegionStatsP\n      },\n      /**\n       * #action\n       */\n      setRegionStatsP(p?: Promise<Stats>) {\n        self.estimatedRegionStatsP = p\n      },\n      /**\n       * #action\n       */\n      setRegionStats(estimatedRegionStats?: Stats) {\n        self.estimatedRegionStats = estimatedRegionStats\n      },\n      /**\n       * #action\n       */\n      clearRegionStats() {\n        self.estimatedRegionStatsP = undefined\n        self.estimatedRegionStats = undefined\n      },\n      /**\n       * #action\n       */\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) {\n          self.height = displayHeight\n        } else {\n          self.height = minDisplayHeight\n        }\n        return self.height\n      },\n      /**\n       * #action\n       */\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n\n      /**\n       * #action\n       */\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n\n      /**\n       * #action\n       */\n      updateStatsLimit(stats: Stats) {\n        const view = getContainingView(self) as LGV\n        if (stats.bytes) {\n          self.userByteSizeLimit = stats.bytes\n        } else {\n          self.userBpPerPxLimit = view.bpPerPx\n        }\n      },\n\n      /**\n       * #action\n       */\n      addBlock(key: string, block: BaseBlock) {\n        self.blockState.set(\n          key,\n          BlockState.create({\n            key,\n            region: block.toRegion(),\n          }),\n        )\n      },\n      /**\n       * #action\n       */\n      setCurrBpPerPx(n: number) {\n        self.currBpPerPx = n\n      },\n      /**\n       * #action\n       */\n      deleteBlock(key: string) {\n        self.blockState.delete(key)\n      },\n      /**\n       * #action\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'BaseFeatureWidget',\n            'baseFeature',\n            {\n              view: getContainingView(self),\n              track: getContainingTrack(self),\n              featureData: feature.toJSON(),\n            },\n          )\n\n          session.showWidget(featureWidget)\n        }\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      /**\n       * #action\n       */\n      clearFeatureSelection() {\n        const session = getSession(self)\n        session.clearSelection()\n      },\n      /**\n       * #action\n       */\n      setFeatureIdUnderMouse(feature: string | undefined) {\n        self.featureIdUnderMouse = feature\n      },\n      /**\n       * #action\n       */\n      reload() {\n        ;[...self.blockState.values()].map(val => val.doReload())\n      },\n      /**\n       * #action\n       */\n      setContextMenuFeature(feature?: Feature) {\n        self.contextMenuFeature = feature\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       * region is too large if:\n       * - stats are ready\n       * - region is greater than 20kb (don't warn when zoomed in less than that)\n       * - and bytes is greater than max allowed bytes or density greater than max density\n       */\n      get regionTooLarge() {\n        const view = getContainingView(self) as LGV\n        if (!self.estimatedStatsReady || view.dynamicBlocks.totalBp < 20_000) {\n          return false\n        }\n        const bpLimitOrDensity = self.userBpPerPxLimit\n          ? view.bpPerPx > self.userBpPerPxLimit\n          : self.currentFeatureScreenDensity > self.maxFeatureScreenDensity\n\n        return (\n          self.currentBytesRequested > self.maxAllowableBytes ||\n          bpLimitOrDensity\n        )\n      },\n\n      /**\n       * #getter\n       * only shows a message of bytes requested is defined, the feature density\n       * based stats don't produce any helpful message besides to zoom in\n       */\n      get regionTooLargeReason() {\n        const req = self.currentBytesRequested\n        const max = self.maxAllowableBytes\n\n        return req && req > max\n          ? `Requested too much data (${getDisplayStr(req)})`\n          : ''\n      },\n    }))\n    .actions(self => {\n      const { reload: superReload } = self\n\n      return {\n        /**\n         * #action\n         */\n        async reload() {\n          self.setError()\n          const aborter = new AbortController()\n          const view = getContainingView(self) as LGV\n\n          // extra check for contentBlocks.length\n          // https://github.com/GMOD/jbrowse-components/issues/2694\n          if (!view.initialized || !view.staticBlocks.contentBlocks.length) {\n            return\n          }\n\n          try {\n            self.estimatedRegionStatsP = self.estimateRegionsStats(\n              view.staticBlocks.contentBlocks,\n              { signal: aborter.signal },\n            )\n            const estimatedRegionStats = await self.estimatedRegionStatsP\n\n            if (isAlive(self)) {\n              self.setRegionStats(estimatedRegionStats)\n              superReload()\n            } else {\n              return\n            }\n          } catch (e) {\n            console.error(e)\n            self.setError(e)\n          }\n        },\n        afterAttach() {\n          // this autorun performs stats estimation\n          //\n          // the chain of events calls estimateRegionsStats against the data\n          // adapter which by default uses featureDensity, but can also respond\n          // with a byte size estimate and fetch size limit (data adapter can\n          // define what is too much data)\n          addDisposer(\n            self,\n            autorun(\n              async () => {\n                try {\n                  const aborter = new AbortController()\n                  const view = getContainingView(self) as LGV\n\n                  // extra check for contentBlocks.length\n                  // https://github.com/GMOD/jbrowse-components/issues/2694\n                  if (\n                    !view.initialized ||\n                    !view.staticBlocks.contentBlocks.length\n                  ) {\n                    return\n                  }\n\n                  // don't re-estimate featureDensity even if zoom level changes,\n                  // jbrowse1-style assume it's sort of representative\n                  if (self.estimatedRegionStats?.featureDensity !== undefined) {\n                    self.setCurrBpPerPx(view.bpPerPx)\n                    return\n                  }\n\n                  // we estimate stats once at a given zoom level\n                  if (view.bpPerPx === self.currBpPerPx) {\n                    return\n                  }\n\n                  self.clearRegionStats()\n                  self.setCurrBpPerPx(view.bpPerPx)\n                  const statsP = self.estimateRegionsStats(\n                    view.staticBlocks.contentBlocks,\n                    { signal: aborter.signal },\n                  )\n                  self.setRegionStatsP(statsP)\n                  const estimatedRegionStats = await statsP\n\n                  if (isAlive(self)) {\n                    self.setRegionStats(estimatedRegionStats)\n                  }\n                } catch (e) {\n                  if (!isAbortException(e) && isAlive(self)) {\n                    console.error(e)\n                    self.setError(e)\n                  }\n                }\n              },\n              { delay: 500 },\n            ),\n          )\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #method\n       */\n      regionCannotBeRenderedText(_region: Region) {\n        return self.regionTooLarge ? 'Force load to see features' : ''\n      },\n\n      /**\n       * #method\n       * @param region -\n       * @returns falsy if the region is fine to try rendering. Otherwise,\n       *  return a react node + string of text.\n       *  string of text describes why it cannot be rendered\n       *  react node allows user to force load at current setting\n       */\n      regionCannotBeRendered(_region: Region) {\n        const { regionTooLarge } = self\n        return regionTooLarge ? <TooLargeMessage model={self} /> : null\n      },\n\n      /**\n       * #method\n       */\n      trackMenuItems(): MenuItem[] {\n        return []\n      },\n\n      /**\n       * #method\n       */\n      contextMenuItems() {\n        return self.contextMenuFeature\n          ? [\n              {\n                label: 'Open feature details',\n                icon: MenuOpenIcon,\n                onClick: () => {\n                  if (self.contextMenuFeature) {\n                    self.selectFeature(self.contextMenuFeature)\n                  }\n                },\n              },\n            ]\n          : []\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        const view = getContainingView(self) as LGV\n        return {\n          ...(getParentRenderProps(self) as any),\n          notReady:\n            self.currBpPerPx !== view.bpPerPx || !self.estimatedRegionStats,\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          onFeatureClick(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              const feature = self.features.get(f)\n              if (feature) {\n                self.selectFeature(feature)\n              }\n            }\n          },\n          onClick() {\n            self.clearFeatureSelection()\n          },\n          // similar to click but opens a menu with further options\n          onFeatureContextMenu(_: unknown, featureId?: string) {\n            const f = featureId || self.featureIdUnderMouse\n            if (!f) {\n              self.clearFeatureSelection()\n            } else {\n              // feature id under mouse passed to context menu\n              self.setContextMenuFeature(self.features.get(f))\n            }\n          },\n\n          onMouseMove(_: unknown, featureId?: string) {\n            self.setFeatureIdUnderMouse(featureId)\n          },\n\n          onMouseLeave(_: unknown) {\n            self.setFeatureIdUnderMouse(undefined)\n          },\n\n          onContextMenu() {\n            self.setContextMenuFeature(undefined)\n            self.clearFeatureSelection()\n          },\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #method\n       */\n      async renderSvg(opts: ExportSvgOptions & { overrideHeight: number }) {\n        const { height, id } = self\n        const { overrideHeight } = opts\n        const view = getContainingView(self) as LGV\n        const { offsetPx: viewOffsetPx, roundedDynamicBlocks, width } = view\n\n        const renderings = await Promise.all(\n          roundedDynamicBlocks.map(block => {\n            const blockState = BlockState.create({\n              key: block.key,\n              region: block,\n            })\n\n            // regionCannotBeRendered can return jsx so look for plaintext\n            // version, or just get the default if none available\n            const cannotBeRenderedReason =\n              self.regionCannotBeRenderedText(block) ||\n              self.regionCannotBeRendered(block)\n\n            if (cannotBeRenderedReason) {\n              return {\n                reactElement: (\n                  <>\n                    <rect x={0} y={0} width={width} height={20} fill=\"#aaa\" />\n                    <text x={0} y={15}>\n                      {cannotBeRenderedReason}\n                    </text>\n                  </>\n                ),\n              }\n            }\n\n            const { rpcManager, renderArgs, renderProps, rendererType } =\n              renderBlockData(blockState, self)\n\n            return rendererType.renderInClient(rpcManager, {\n              ...renderArgs,\n              ...renderProps,\n              viewParams: getViewParams(self, true),\n              exportSVG: opts,\n            })\n          }),\n        )\n\n        return (\n          <>\n            {renderings.map((rendering, index) => {\n              const { offsetPx } = roundedDynamicBlocks[index]\n              const offset = offsetPx - viewOffsetPx\n              const clipid = getId(id, index)\n\n              return (\n                <React.Fragment key={`frag-${index}`}>\n                  <defs>\n                    <clipPath id={clipid}>\n                      <rect\n                        x={0}\n                        y={0}\n                        width={width}\n                        height={overrideHeight || height}\n                      />\n                    </clipPath>\n                  </defs>\n                  <g transform={`translate(${offset} 0)`}>\n                    <g clipPath={`url(#${clipid})`}>\n                      {React.isValidElement(rendering.reactElement) ? (\n                        rendering.reactElement\n                      ) : (\n                        <g\n                          /* eslint-disable-next-line react/no-danger */\n                          dangerouslySetInnerHTML={{ __html: rendering.html }}\n                        />\n                      )}\n                    </g>\n                  </g>\n                </React.Fragment>\n              )\n            })}\n          </>\n        )\n      },\n    }))\n    .postProcessSnapshot(self => {\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const r = self as Omit<typeof self, symbol>\n      const { blockState, ...rest } = r\n      return rest\n    })\n}\n\nexport const BaseLinearDisplay = stateModelFactory()\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\n/**\n * #stateModel LinearBareDisplay\n * extends `BaseLinearDisplay`\n */\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBareDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { lazy } from 'react'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { types, getEnv, Instance } from 'mobx-state-tree'\n\n// icons\nimport VisibilityIcon from '@mui/icons-material/Visibility'\n\n// locals\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\n\n/**\n * #stateModel LinearBasicDisplay\n * used by `FeatureTrack`, has simple settings like \"show/hide feature labels\", etc.\n */\nfunction stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearBasicDisplay'),\n        /**\n         * #property\n         */\n        trackShowLabels: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackShowDescriptions: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        trackDisplayMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        trackMaxHeight: types.maybe(types.number),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      /**\n       * #getter\n       */\n      get showLabels() {\n        return self.trackShowLabels ?? getConf(self, ['renderer', 'showLabels'])\n      },\n\n      /**\n       * #getter\n       */\n      get showDescriptions() {\n        return (\n          self.trackShowDescriptions ??\n          getConf(self, ['renderer', 'showDescriptions'])\n        )\n      },\n\n      /**\n       * #getter\n       */\n      get maxHeight() {\n        return self.trackMaxHeight ?? getConf(self, ['renderer', 'maxHeight'])\n      },\n\n      /**\n       * #getter\n       */\n      get displayMode() {\n        return (\n          self.trackDisplayMode ?? getConf(self, ['renderer', 'displayMode'])\n        )\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n        const config = configBlob as Omit<typeof configBlob, symbol>\n\n        return self.rendererType.configSchema.create(\n          {\n            ...config,\n            showLabels: self.showLabels,\n            showDescriptions: self.showDescriptions,\n            displayMode: self.displayMode,\n            maxHeight: self.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       */\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      /**\n       * #action\n       */\n      toggleShowDescriptions() {\n        self.trackShowDescriptions = !self.showDescriptions\n      },\n      /**\n       * #action\n       */\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      /**\n       * #action\n       */\n      setMaxHeight(val: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const config = self.rendererConfig\n          const superProps = superRenderProps()\n          const superPropsOmit = superProps as Omit<typeof superProps, symbol>\n          return {\n            ...superPropsOmit,\n            config,\n          }\n        },\n\n        /**\n         * #method\n         */\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => self.toggleShowLabels(),\n            },\n            {\n              label: 'Show descriptions',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showDescriptions,\n              onClick: () => self.toggleShowDescriptions(),\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: [\n                'compact',\n                'reducedRepresentation',\n                'normal',\n                'collapse',\n              ].map(val => ({\n                label: val,\n                onClick: () => self.setDisplayMode(val),\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetMaxHeightDlg,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n}\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\n/**\n * #config LinearBasicDisplay\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      /**\n       * #slot\n       */\n      mouseover: {\n        type: 'string',\n        description: 'what to display in a given mouseover',\n        defaultValue: `jexl:get(feature,'name')`,\n\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config FeatureTrack\n * used for basic gene and feature tracks, generally used with LinearBasicDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'FeatureTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      /**\n       * #identifier\n       */\n      explicitIdentifier: 'trackId',\n    },\n  )\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config BasicTrack\n * synonym for FeatureTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'BasicTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n      explicitIdentifier: 'trackId',\n    },\n  )\nexport default configSchema\n","import { lazy } from 'react'\nimport { when } from 'mobx'\n\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@mui/icons-material/LineStyle'\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n  BlockModel,\n} from './BaseLinearDisplay'\nimport {\n  configSchemaFactory as linearBareDisplayConfigSchemaFactory,\n  stateModelFactory as LinearBareDisplayStateModelFactory,\n} from './LinearBareDisplay'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n  stateModelFactory as linearGenomeViewStateModelFactory,\n  renderToSvg,\n  RefNameAutocomplete,\n  SearchBox,\n  ZoomControls,\n  LinearGenomeView,\n} from './LinearGenomeView'\n\nimport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n\nimport FeatureTrackF from './FeatureTrack'\nimport BasicTrackF from './BasicTrack'\n\ntype LGV = LinearGenomeViewModel\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n    SearchBox,\n    ZoomControls,\n    LinearGenomeView,\n  }\n\n  install(pluginManager: PluginManager) {\n    FeatureTrackF(pluginManager)\n    BasicTrackF(pluginManager)\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBareDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBareDisplay',\n        configSchema,\n        stateModel: LinearBareDisplayStateModelFactory(configSchema),\n        trackType: 'BasicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBasicDisplay',\n        configSchema,\n        stateModel: linearBasicDisplayModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          name: 'LinearGenomeView',\n          stateModel: linearGenomeViewStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./LinearGenomeView/components/LinearGenomeView'),\n          ),\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-LinearGenomeView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        loc,\n        tracks = [],\n      }: {\n        session: AbstractSessionModel\n        assembly?: string\n        loc: string\n        tracks?: string[]\n      }) => {\n        try {\n          const { assemblyManager } = session\n          const view = session.addView('LinearGenomeView', {}) as LGV\n\n          await when(() => !!view.volatileWidth)\n\n          if (!assembly) {\n            throw new Error(\n              'No assembly provided when launching linear genome view',\n            )\n          }\n\n          const asm = await assemblyManager.waitForAssembly(assembly)\n          if (!asm) {\n            throw new Error(\n              `Assembly \"${assembly}\" not found when launching linear genome view`,\n            )\n          }\n\n          view.navToLocString(loc, assembly)\n\n          const idsNotFound = [] as string[]\n          tracks.forEach(track => {\n            try {\n              view.showTrack(track)\n            } catch (e) {\n              if (`${e}`.match('Could not resolve identifier')) {\n                idsNotFound.push(track)\n              } else {\n                throw e\n              }\n            }\n          })\n          if (idsNotFound.length) {\n            throw new Error(\n              `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n            )\n          }\n        } catch (e) {\n          session.notify(`${e}`, 'error')\n          throw e\n        }\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  baseLinearDisplayConfigSchema,\n  linearBareDisplayConfigSchemaFactory,\n  linearBasicDisplayConfigSchemaFactory,\n  linearBasicDisplayModelFactory,\n  renderToSvg,\n  BaseLinearDisplayComponent,\n  BaseLinearDisplay,\n  RefNameAutocomplete,\n  SearchBox,\n}\n\nexport type { LinearGenomeViewModel, LinearGenomeViewStateModel, BlockModel }\n\nexport type { BaseLinearDisplayModel } from './BaseLinearDisplay'\n","import {\n  createBaseTrackModel,\n  TrackType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pm: PluginManager) => {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n\n    return new TrackType({\n      name: 'BasicTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'BasicTrack', configSchema),\n    })\n  })\n}\n","import {\n  createBaseTrackModel,\n  TrackType,\n} from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'FeatureTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'FeatureTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\n/**\n * #config LinearBareDisplay\n */\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport { configSchemaFactory }\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearLollipopDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        get renderDelay() {\n          return 500\n        },\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction ScoreText({\n  feature,\n  config,\n  layoutRecord: {\n    y,\n    data: { anchorX, radiusPx, score },\n  },\n}) {\n  const innerColor = readConfObject(config, 'innerColor', { feature })\n\n  const scoreString = String(score)\n  const fontWidth = (radiusPx * 2) / scoreString.length\n  const fontHeight = fontWidth * 1.1\n  if (fontHeight < 12) {\n    return null\n  }\n  return (\n    <text\n      style={{ fontSize: fontHeight, fill: contrastingTextColor(innerColor) }}\n      x={anchorX}\n      y={y + radiusPx - fontHeight / 2.4}\n      textAnchor=\"middle\"\n      dominantBaseline=\"hanging\"\n    >\n      {scoreString}\n    </text>\n  )\n}\n\nScoreText.propTypes = {\n  feature: ReactPropTypes.shape({ get: ReactPropTypes.func.isRequired })\n    .isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }).isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nfunction Lollipop(props) {\n  const onFeatureMouseDown = event => {\n    const { onFeatureMouseDown: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseEnter = event => {\n    const { onFeatureMouseEnter: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOut = event => {\n    const { onFeatureMouseOut: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOver = event => {\n    const { onFeatureMouseOver: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseUp = event => {\n    const { onFeatureMouseUp: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseLeave = event => {\n    const { onFeatureMouseLeave: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseMove = event => {\n    const { onFeatureMouseMove: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureClick = event => {\n    const { onFeatureClick: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, feature.id())\n  }\n\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx, score },\n    },\n    selectedFeatureId,\n  } = props\n\n  const styleOuter = {\n    fill: readConfObject(config, 'strokeColor', { feature }),\n  }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    styleOuter.fill = 'red'\n  }\n\n  const styleInner = {\n    fill: readConfObject(config, 'innerColor', { feature }),\n  }\n\n  const strokeWidth = readConfObject(config, 'strokeWidth', { feature })\n\n  return (\n    <g data-testid={feature.id()}>\n      <title>{readConfObject(config, 'caption', { feature })}</title>\n      <circle\n        cx={anchorLocation}\n        cy={y + radiusPx}\n        r={radiusPx}\n        style={styleOuter}\n        onMouseDown={onFeatureMouseDown}\n        onMouseEnter={onFeatureMouseEnter}\n        onMouseOut={onFeatureMouseOut}\n        onMouseOver={onFeatureMouseOver}\n        onMouseUp={onFeatureMouseUp}\n        onMouseLeave={onFeatureMouseLeave}\n        onMouseMove={onFeatureMouseMove}\n        onClick={onFeatureClick}\n        onFocus={onFeatureMouseOver}\n        onBlur={onFeatureMouseOut}\n      />\n      {radiusPx - strokeWidth <= 2 ? null : (\n        <circle\n          cx={anchorLocation}\n          cy={y + radiusPx}\n          r={radiusPx - strokeWidth}\n          style={styleInner}\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n        />\n      )}\n      <ScoreText {...props} score={score} />\n    </g>\n  )\n}\nLollipop.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }),\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n\n  onFeatureMouseDown: ReactPropTypes.func,\n  onFeatureMouseEnter: ReactPropTypes.func,\n  onFeatureMouseOut: ReactPropTypes.func,\n  onFeatureMouseOver: ReactPropTypes.func,\n  onFeatureMouseUp: ReactPropTypes.func,\n  onFeatureMouseLeave: ReactPropTypes.func,\n  onFeatureMouseMove: ReactPropTypes.func,\n\n  // synthesized from mouseup and mousedown\n  onFeatureClick: ReactPropTypes.func,\n}\n\nLollipop.defaultProps = {\n  selectedFeatureId: undefined,\n\n  onFeatureMouseDown: undefined,\n  onFeatureMouseEnter: undefined,\n  onFeatureMouseOut: undefined,\n  onFeatureMouseOver: undefined,\n  onFeatureMouseUp: undefined,\n  onFeatureMouseLeave: undefined,\n  onFeatureMouseMove: undefined,\n\n  onFeatureClick: undefined,\n}\nexport default observer(Lollipop)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Stick(props) {\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx },\n    },\n    selectedFeatureId,\n  } = props\n\n  const style = { fill: readConfObject(config, 'bodyColor', { feature }) }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    style.fill = 'red'\n  }\n  return (\n    <line\n      x1={anchorLocation}\n      y1={0}\n      x2={anchorLocation}\n      y2={y + 2 * radiusPx}\n      stroke={readConfObject(config, 'stickColor', { feature })}\n      strokeWidth={readConfObject(config, 'stickWidth', { feature })}\n    />\n  )\n}\nStick.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({ radiusPx: ReactPropTypes.number.isRequired })\n      .isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\nStick.defaultProps = {\n  selectedFeatureId: undefined,\n}\n\nexport default observer(Stick)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport Lollipop from './Lollipop'\nimport Stick from './Stick'\n\nfunction LollipopRendering(props) {\n  const onMouseDown = event => {\n    const { onMouseDown: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseUp = event => {\n    const { onMouseUp: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseEnter = event => {\n    const { onMouseEnter: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseLeave = event => {\n    const { onMouseLeave: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOver = event => {\n    const { onMouseOver: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOut = event => {\n    const { onMouseOut: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onClick = event => {\n    const { onClick: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  function layoutFeat(args) {\n    const { feature, bpPerPx, region, layout } = args\n\n    const centerBp = Math.abs(feature.get('end') + feature.get('start')) / 2\n    const centerPx = bpToPx(centerBp, region, bpPerPx)\n    const radiusPx = readConfObject(args.config, 'radius', { feature })\n\n    if (!radiusPx) {\n      console.error(\n        new Error(\n          `lollipop radius ${radiusPx} configured for feature ${feature.id()}`,\n        ),\n      )\n    }\n    layout.add(feature.id(), centerPx, radiusPx * 2, radiusPx * 2, {\n      featureId: feature.id(),\n      anchorX: centerPx,\n      radiusPx,\n      score: readConfObject(args.config, 'score', { feature }),\n    })\n  }\n\n  const {\n    regions,\n    bpPerPx,\n    layout,\n    config,\n    features,\n    displayModel: { selectedFeatureId },\n  } = props\n\n  const [region] = regions\n  const sticksRendered = []\n  const lollipopsRendered = []\n  for (const feature of features.values()) {\n    layoutFeat({\n      feature,\n      bpPerPx,\n      region,\n      config,\n      layout,\n    })\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Stick\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`stick-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Lollipop\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`body-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = layout.getTotalHeight()\n\n  return (\n    <svg\n      className=\"LollipopRendering\"\n      width={width}\n      height={height}\n      style={{\n        position: 'relative',\n      }}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onFocus={onMouseEnter}\n      onBlur={onMouseLeave}\n      onClick={onClick}\n    >\n      {sticksRendered}\n      {lollipopsRendered}\n    </svg>\n  )\n}\n\nLollipopRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    getLayout: ReactPropTypes.func.isRequired,\n    add: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.instanceOf(Map),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    /** id of the currently selected feature, if any */\n    selectedFeatureId: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n}\n\nLollipopRendering.defaultProps = {\n  displayModel: {},\n\n  features: new Map(),\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onClick: undefined,\n}\n\nexport default observer(LollipopRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      contextVariable: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      contextVariable: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      contextVariable: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      contextVariable: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  constructor({ width }: { width: number }) {\n    if (!width) {\n      throw new Error('width required to make a new FloatingLayout')\n    }\n    this.width = width\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  layoutDirty = false\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({ uniqueId, anchorLocation, width, height, data })\n    this.layoutDirty = true\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!this.layoutDirty) {\n      return this.layout\n    }\n    if (!configuration) {\n      throw new Error('configuration object required')\n    }\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = Array(sorted.length)\n    for (let i = 0; i < sorted.length; i += 1) {\n      const currentItem = sorted[i]\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLayedOutItem] = layoutEntries[j]\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLayedOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        { ...currentItem, x: start, y: top },\n      ]\n      if (bottom > maxBottom) {\n        maxBottom = bottom\n      }\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    this.layoutDirty = false\n    return this.layout\n  }\n\n  getTotalHeight() {\n    if (this.layoutDirty) {\n      throw new Error('getTotalHeight does not work when the layout is dirty.')\n    }\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    if (this.layoutDirty) {\n      throw new Error('toJSON does not work when the layout is dirty.')\n    }\n    return { pairs: [...this.getLayout()], totalHeight: this.getTotalHeight() }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId)) {\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n    }\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { FloatingLayout, PrecomputedFloatingLayout } from './Layout'\n\nclass FloatingLayoutSession extends LayoutSession {\n  makeLayout() {\n    'sequenceAdapter'\n\n    const { end, start } = this.regions[0]\n    const widthPx = (end - start) / this.bpPerPx\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid(/* layout */) {\n    return false // layout.left layout.width === this.width\n  }\n}\n\nexport default class extends BoxRendererType {\n  createSession(args) {\n    return new FloatingLayoutSession(args)\n  }\n\n  deserializeLayoutInClient(json) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  configSchemaFactory as linearLollipopDisplayConfigSchemaFactory,\n  stateModelFactory as LinearLollipopDisplayStateModelFactory,\n} from './LinearLollipopDisplay'\nimport LollipopRenderer, {\n  configSchema as lollipopRendererConfigSchema,\n  ReactComponent as LollipopRendererReactComponent,\n} from './LollipopRenderer'\n\nexport default class extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new LollipopRenderer({\n          name: 'LollipopRenderer',\n          ReactComponent: LollipopRendererReactComponent,\n          configSchema: lollipopRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema =\n        linearLollipopDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearLollipopDisplay',\n        configSchema,\n        stateModel: LinearLollipopDisplayStateModelFactory(configSchema),\n        trackType: 'LollipopTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('AboutWidget', {})\n\nexport const stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('HelpWidget', {})\n\nexport const stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('ImportSessionWidget', {})\n\nexport const stateModel = types.model('ImportSessionWidget', {\n  id: ElementId,\n  type: types.literal('ImportSessionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport HelpIcon from '@mui/icons-material/Help'\nimport InfoIcon from '@mui/icons-material/Info'\n\nimport {\n  configSchema as aboutConfigSchema,\n  stateModel as aboutStateModel,\n} from './AboutWidget'\nimport {\n  configSchema as helpConfigSchema,\n  stateModel as helpStateModel,\n} from './HelpWidget'\nimport {\n  configSchema as importSessionConfigSchema,\n  stateModel as importSessionStateModel,\n} from './ImportSessionWidget'\nimport {\n  configSchema as sessionManagerConfigSchema,\n  stateModel as sessionManagerStateModel,\n} from './SessionManager'\n\nexport default class extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AboutWidget',\n        heading: 'About',\n        configSchema: aboutConfigSchema,\n        stateModel: aboutStateModel,\n        ReactComponent: lazy(\n          () => import('./AboutWidget/components/AboutWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HelpWidget',\n        heading: 'Help',\n        configSchema: helpConfigSchema,\n        stateModel: helpStateModel,\n        ReactComponent: lazy(\n          () => import('./HelpWidget/components/HelpWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ImportSessionWidget',\n        heading: 'Import session',\n        configSchema: importSessionConfigSchema,\n        stateModel: importSessionStateModel,\n        ReactComponent: lazy(\n          () => import('./ImportSessionWidget/components/ImportSessionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'SessionManager',\n        heading: 'Sessions',\n        configSchema: sessionManagerConfigSchema,\n        stateModel: sessionManagerStateModel,\n        ReactComponent: lazy(\n          () => import('./SessionManager/components/SessionManager'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport format from 'string-template'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\ninterface SPARQLEntry {\n  type: string\n  value: string\n  dataTypes?: string\n}\n\ninterface SPARQLBinding {\n  [key: string]: SPARQLEntry\n}\n\ninterface SPARQLResponseHead {\n  vars: string[]\n}\n\ninterface SPARQLResponseResults {\n  bindings: SPARQLBinding[]\n}\n\ninterface SPARQLResponse {\n  head: SPARQLResponseHead\n  results: SPARQLResponseResults\n}\n\ninterface SPARQLFeatureData {\n  start: number\n  end: number\n  strand: number\n  subfeatures?: SPARQLFeatureData[]\n  uniqueId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [propName: string]: any\n}\n\ninterface SPARQLFeature {\n  data: SPARQLFeatureData\n}\n\nexport default class SPARQLAdapter extends BaseFeatureDataAdapter {\n  private endpoint: string\n\n  private queryTemplate: string\n\n  private refNamesQueryTemplate: string\n\n  private additionalQueryParams: string[]\n\n  private configRefNames: string[]\n\n  private refNames: string[] | undefined\n\n  public constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    this.endpoint = readConfObject(config, 'endpoint').uri\n    this.queryTemplate = readConfObject(config, 'queryTemplate')\n    this.additionalQueryParams = readConfObject(config, 'additionalQueryParams')\n    this.refNamesQueryTemplate = readConfObject(config, 'refNamesQueryTemplate')\n    this.configRefNames = readConfObject(config, 'refNames')\n  }\n\n  public async getRefNames(opts: BaseOptions = {}): Promise<string[]> {\n    if (this.refNames) {\n      return this.refNames\n    }\n    let refNames = [] as string[]\n    if (this.refNamesQueryTemplate) {\n      const queryTemplate = encodeURIComponent(this.refNamesQueryTemplate)\n      const results = await this.querySparql(queryTemplate, opts)\n      refNames = this.resultsToRefNames(results)\n    } else if (this.configRefNames) {\n      refNames = this.configRefNames\n    }\n    this.refNames = refNames\n    return refNames\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const filledTemplate = encodeURIComponent(\n        format(this.queryTemplate, query),\n      )\n      const { refName } = query\n      const results = await this.querySparql(filledTemplate, opts)\n      this.resultsToFeatures(results, refName).forEach(feature => {\n        observer.next(feature)\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async querySparql(query: string, opts?: BaseOptions): Promise<any> {\n    let additionalQueryParams = ''\n    if (this.additionalQueryParams.length) {\n      additionalQueryParams = `&${this.additionalQueryParams.join('&')}`\n    }\n    const signal = opts && opts.signal\n    const response = await fetch(\n      `${this.endpoint}?query=${query}${additionalQueryParams}`,\n      {\n        headers: { accept: 'application/json,application/sparql-results+json' },\n        signal,\n      },\n    )\n    return response.json()\n  }\n\n  private resultsToRefNames(response: SPARQLResponse): string[] {\n    const rows = ((response || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = response.head.vars\n    if (!fields.includes('refName')) {\n      throw new Error('\"refName\" not found in refNamesQueryTemplate response')\n    }\n    return rows.map(row => row.refName.value)\n  }\n\n  private resultsToFeatures(\n    results: SPARQLResponse,\n    refName: string,\n  ): SimpleFeature[] {\n    const rows = ((results || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = results.head.vars\n    const requiredFields = ['start', 'end', 'uniqueId']\n    requiredFields.forEach(requiredField => {\n      if (!fields.includes(requiredField)) {\n        console.error(\n          `Required field ${requiredField} missing from feature data`,\n        )\n      }\n    })\n    const seenFeatures: Record<string, SPARQLFeature> = {}\n    rows.forEach(row => {\n      const rawData: Record<string, string>[] = [{}]\n      fields.forEach(field => {\n        if (field in row) {\n          const { value } = row[field]\n          let idx = 0\n          while (field.startsWith('sub_')) {\n            field = field.slice(4)\n            idx += 1\n          }\n          while (idx > rawData.length - 1) {\n            rawData.push({})\n          }\n          rawData[idx][field] = value\n        }\n      })\n\n      rawData.forEach((rd, idx) => {\n        const { uniqueId } = rd\n        if (idx < rawData.length - 1) {\n          rawData[idx + 1].parentUniqueId = uniqueId\n        }\n        seenFeatures[uniqueId] = {\n          data: {\n            ...rd,\n            uniqueId,\n            refName,\n            start: parseInt(rd.start, 10),\n            end: parseInt(rd.end, 10),\n            strand: parseInt(rd.strand, 10) || 0,\n          },\n        }\n      })\n    })\n\n    // resolve subfeatures, keeping only top-level features in seenFeatures\n    for (const [uniqueId, f] of Object.entries(seenFeatures)) {\n      const pid = f.data.parentUniqueId\n      delete f.data.parentUniqueId\n      if (pid) {\n        const p = seenFeatures[pid]\n        if (p) {\n          if (!p.data.subfeatures) {\n            p.data.subfeatures = []\n          }\n          p.data.subfeatures.push({\n            ...f.data,\n            uniqueId,\n          })\n          delete seenFeatures[uniqueId]\n        } else {\n          const subfeatures = Object.values(seenFeatures)\n            .map(sf => sf.data.subfeatures)\n            .filter(sf => !!sf)\n            .flat()\n          let found = false\n          for (const subfeature of subfeatures) {\n            if (subfeature && subfeature.uniqueId === pid) {\n              if (!subfeature.subfeatures) {\n                subfeature.subfeatures = []\n              }\n              subfeature.subfeatures.push({\n                ...f.data,\n                uniqueId,\n              })\n              delete seenFeatures[uniqueId]\n              found = true\n              break\n            } else if (subfeature && subfeature.subfeatures) {\n              subfeatures.push(...subfeature.subfeatures)\n            }\n          }\n          if (!found) {\n            console.error(`Could not find parentID ${pid}`)\n          }\n        }\n      }\n    }\n\n    return Object.keys(seenFeatures).map(\n      seenFeature =>\n        new SimpleFeature({\n          ...seenFeatures[seenFeature].data,\n          uniqueId: seenFeature,\n          subfeatures: seenFeatures[seenFeature].data.subfeatures,\n        }),\n    )\n  }\n\n  public async hasDataForRefName(\n    refName: string,\n    opts: BaseOptions = {},\n  ): Promise<boolean> {\n    const refNames = await this.getRefNames(opts)\n    if (refNames.length && !refNames.includes(refName)) {\n      return false\n    }\n    return true\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'https://somesite.com/sparql',\n        locationType: 'UriLocation',\n      },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  AdapterClass as SPARQLAdapterClass,\n  configSchema as sparqlAdapterConfigSchema,\n} from './SPARQLAdapter'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SPARQLAdapter',\n          configSchema: sparqlAdapterConfigSchema,\n          AdapterClass: SPARQLAdapterClass,\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\/sparql$/i\n          const adapterName = 'SPARQLAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              endpoint: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TwoBitAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TwoBitAdapter = ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    /**\n     * #slot\n     */\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.2bit', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/default.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n      description:\n        'An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default TwoBitAdapter\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport {\n  bpSpanPx,\n  revcom,\n  complement,\n  defaultStarts,\n  defaultStops,\n  defaultCodonTable,\n  generateCodonTable,\n} from '@jbrowse/core/util'\n\ninterface MyProps {\n  exportSVG?: { rasterizeLayers: boolean }\n  features: Map<string, Feature>\n  regions: Region[]\n  bpPerPx: number\n  config: AnyConfigurationModel\n  highResolutionScaling: number\n  theme: any\n  showForward: boolean\n  showReverse: boolean\n  showTranslation: boolean\n}\n\nfunction Translation(props: {\n  codonTable: any\n  seq: string\n  frame: number\n  bpPerPx: number\n  region: Region\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: any\n}) {\n  const {\n    codonTable,\n    seq,\n    frame,\n    bpPerPx,\n    region,\n    height,\n    y,\n    reverse = false,\n    theme,\n  } = props\n  const scale = bpPerPx\n\n  // the tilt variable normalizes the frame to where we are starting from,\n  // which increases consistency across blocks\n  const tilt = 3 - (region.start % 3)\n\n  // the effectiveFrame incorporates tilt and the frame to say what the\n  // effective frame that is plotted. The +3 is for when frame is -2 and this\n  // can otherwise result in effectiveFrame -1\n  const effectiveFrame = (frame + tilt + 3) % 3\n\n  const seqSliced = seq.slice(effectiveFrame)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({ letter: aminoAcid, codon: normalizedCodon.toUpperCase() })\n  }\n\n  const w = (1 / scale) * 3\n  const drop = region.start === 0 ? 0 : w\n  const render = 1 / bpPerPx >= 12\n  const width = (region.end - region.start) / bpPerPx\n\n  const map = ['#d8d8d8', '#adadad', '#8f8f8f'].reverse()\n  return (\n    <>\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (w * (index + 1) + effectiveFrame / scale - drop)\n          : w * index + effectiveFrame / scale - drop\n        const { letter, codon } = element\n        return (\n          <React.Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                render ? w : w + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={render ? '#555' : 'none'}\n              fill={\n                defaultStarts.includes(codon)\n                  ? theme.palette.startCodon\n                  : defaultStops.includes(codon)\n                  ? theme.palette.stopCodon\n                  : map[Math.abs(frame)]\n              }\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction DNA(props: {\n  seq: string\n  theme: any\n  bpPerPx: number\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const { bpPerPx, region, feature, theme, height, seq, y } = props\n  const render = 1 / bpPerPx >= 12\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const reverse = region.reversed\n  const len = feature.get('end') - feature.get('start')\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        const color = theme.palette.bases[letter.toUpperCase()]\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          <React.Fragment key={index}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fill={color ? contrastingTextColor(color.main) : 'black'}\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nconst SequenceSVG = ({\n  regions,\n  theme: configTheme,\n  features = new Map(),\n  showReverse,\n  showForward,\n  showTranslation,\n  bpPerPx,\n}: any) => {\n  const [region] = regions\n  const theme = createJBrowseTheme(configTheme)\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const height = 20\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -20\n\n  return (\n    <>\n      {/* the upper translation row. if the view is reversed, the reverse\n        translation is on the top */}\n      {showTranslation && (region.reversed ? showReverse : showForward)\n        ? [2, 1, 0].map(index => (\n            <Translation\n              key={`translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={region.reversed}\n            />\n          ))\n        : null}\n\n      {showForward ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {/* the lower translation row. if the view is reversed, the forward\n        translation is on the bottom */}\n      {showTranslation && (region.reversed ? showForward : showReverse)\n        ? [0, -1, -2].map(index => (\n            <Translation\n              key={`rev-translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={!region.reversed}\n            />\n          ))\n        : null}\n    </>\n  )\n}\n\nconst Wrapper = ({ exportSVG, width, totalHeight, children }: any) => {\n  return exportSVG ? (\n    <>{children}</>\n  ) : (\n    <svg\n      data-testid=\"sequence_track\"\n      width={width}\n      height={totalHeight}\n      style={{ width, height: totalHeight }}\n    >\n      {children}\n    </svg>\n  )\n}\n\nfunction Sequence(props: MyProps) {\n  const { regions, bpPerPx } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const totalHeight = 200\n\n  return (\n    <Wrapper {...props} totalHeight={totalHeight} width={width}>\n      <SequenceSVG {...props} />\n    </Wrapper>\n  )\n}\n\nexport default observer(Sequence)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config DivSequenceRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst DivSequenceRenderer = ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default DivSequenceRenderer\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport ReactComponent from './components/DivSequenceRendering'\nimport configSchema from './configSchema'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new DivSequenceRenderer({\n        name: 'DivSequenceRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config BgzipFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BgzipFastaAdapter = ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.fai',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n    /**\n     * #slot\n     */\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.gzi',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BgzipFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config ChromSizesAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst ChromSizesAdapter = ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    /**\n     * #slot\n     */\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/species.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default ChromSizesAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config IndexedFastaAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst IndexedFastaAdapter = ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    /**\n     * #slot\n     */\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai', locationType: 'UriLocation' },\n    },\n    /**\n     * #slot\n     */\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default IndexedFastaAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config SequenceSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'SequenceSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    search: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Search string or regex to search for',\n    },\n    /**\n     * #slot\n     */\n    sequenceAdapter: {\n      type: 'frozen',\n      defaultValue: null,\n    },\n    /**\n     * #slot\n     */\n    searchForward: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    searchReverse: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    caseInsensitive: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { createReferenceSeqTrackConfig } from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addTrackType(() => {\n    const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n    return new TrackType({\n      name: 'ReferenceSequenceTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'ReferenceSequenceTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// Note: this is primarily a copy of createBaseTrackConfig, except with a\n// subset of the config slots, to avoid including fields that don't make sense\n// for the ReferenceSequenceTrack\n\n/**\n * #config ReferenceSequenceTrack\n * used to display base level DNA sequence tracks\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      /**\n       * #slot\n       * configuration for track adapter\n       */\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n\n      /**\n       * #slot\n       * configuration for the displays e.g. LinearReferenceSequenceDisplay\n       */\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      /**\n       * #slot\n       */\n      name: {\n        type: 'string',\n        description:\n          'optional track name, otherwise uses the \"Reference sequence (assemblyName)\"',\n        defaultValue: '',\n      },\n\n      /**\n       * #slot\n       */\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n\n      formatAbout: ConfigurationSchema('FormatAbout', {\n        /**\n         * #slot formatAbout.config\n         */\n        config: {\n          type: 'frozen',\n          description: 'formats configuration in about dialog',\n          defaultValue: {},\n          contextVariable: ['config'],\n        },\n\n        /**\n         * #slot formatAbout.hideUris\n         */\n        hideUris: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      /**\n       * #identifier\n       * all tracks have a globally unique 'trackId'\n       */\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { default as divSequenceRendererConfigSchema } from '../DivSequenceRenderer/configSchema'\n\n/**\n * #config LinearReferenceSequenceDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  {\n    /**\n     * #slot\n     */\n    renderer: divSequenceRendererConfigSchema,\n  },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nimport { configSchema } from './configSchema'\nimport { modelFactory } from './model'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const stateModel = modelFactory(configSchema)\n    return {\n      name: 'LinearReferenceSequenceDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'ReferenceSequenceTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    }\n  })\n}\n","import { types } from 'mobx-state-tree'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { getContainingView } from '@jbrowse/core/util'\n\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showForward: types.optional(types.boolean, true),\n        showReverse: types.optional(types.boolean, true),\n        showTranslation: types.optional(types.boolean, true),\n        height: 180,\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          const { showForward, showReverse, showTranslation } = self\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n            showForward,\n            showReverse,\n            showTranslation,\n          }\n        },\n        regionCannotBeRendered(/* region */) {\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (view && view.bpPerPx >= 1) {\n            return 'Zoom in to see sequence'\n          }\n          return undefined\n        },\n\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n    .actions(self => ({\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n    }))\n    .views(self => ({\n      trackMenuItems() {\n        return [\n          {\n            label: 'Show forward',\n            type: 'checkbox',\n            checked: self.showForward,\n            onClick: () => {\n              self.toggleShowForward()\n            },\n          },\n          {\n            label: 'Show reverse',\n            type: 'checkbox',\n            checked: self.showReverse,\n            onClick: () => {\n              self.toggleShowReverse()\n            },\n          },\n          {\n            label: 'Show translation',\n            type: 'checkbox',\n            checked: self.showTranslation,\n            onClick: () => {\n              self.toggleShowTranslation()\n            },\n          },\n        ]\n      },\n    }))\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport TwoBitAdapterF from './TwoBitAdapter'\nimport DivSequenceRendererF from './DivSequenceRenderer'\nimport BgzipFastaAdapterF from './BgzipFastaAdapter'\nimport ChromSizesAdapterF from './ChromSizesAdapter'\nimport IndexedFastaAdapterF from './IndexedFastaAdapter'\nimport SequenceSearchAdapterF from './SequenceSearchAdapter'\nimport ReferenceSequenceTrackF from './ReferenceSequenceTrack'\nimport LinearReferenceSequenceDisplayF from './LinearReferenceSequenceDisplay'\nimport createExtensionPoints from './createExtensionPoints'\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    DivSequenceRendererF(pluginManager)\n    TwoBitAdapterF(pluginManager)\n    BgzipFastaAdapterF(pluginManager)\n    ChromSizesAdapterF(pluginManager)\n    IndexedFastaAdapterF(pluginManager)\n    SequenceSearchAdapterF(pluginManager)\n    ReferenceSequenceTrackF(pluginManager)\n    LinearReferenceSequenceDisplayF(pluginManager)\n    createExtensionPoints(pluginManager)\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'TwoBitAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () => import('./TwoBitAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BgzipFastaAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () =>\n          import('./BgzipFastaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChromSizesAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () =>\n          import('./ChromSizesAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'IndexedFastaAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        getAdapterClass: () =>\n          import('./IndexedFastaAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'SequenceSearchAdapter',\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        configSchema,\n        getAdapterClass: () =>\n          import('./SequenceSearchAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.2bit$/i\n        const adapterName = 'TwoBitAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          twoBitLocation: file,\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'TwoBitAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)$/i\n        const adapterName = 'IndexedFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          fastaLocation: file,\n          faiLocation: index || makeIndex(file, '.fai'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'IndexedFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.(fa|fasta|fas|fna|mfa)\\.b?gz$/i\n        const adapterName = 'BgzipFastaAdapter'\n        const fileName = getFileName(file)\n        const obj = {\n          type: adapterName,\n          faiLocation: makeIndex(file, '.fai'),\n          gziLocation: makeIndex(file, '.gzi'),\n        }\n\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'BgzipFastaAdapter') {\n          return 'ReferenceSequenceTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { types } from 'mobx-state-tree'\n\n/** utility function for assembling the MST model of a column data type */\nexport default function MakeSpreadsheetColumnType(\n  name: string,\n  {\n    DataCellReactComponent = null,\n    FilterModelType = null,\n    compare,\n    displayName = undefined,\n    categoryName = undefined,\n  }: {\n    compare?: any\n    DataCellReactComponent?: React.FC<any> | null\n    FilterModelType?: any\n    displayName?: string\n    categoryName?: string\n  },\n) {\n  return types\n    .model(`ColumnDataType${name}`, {\n      type: types.literal(name),\n    })\n    .volatile(() => ({\n      DataCellReactComponent,\n      FilterModelType: FilterModelType as any,\n      displayName: displayName || name,\n      categoryName,\n    }))\n    .views(() => ({\n      compare,\n      get hasFilter() {\n        return !!FilterModelType\n      },\n    }))\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { types, getType, getParent } from 'mobx-state-tree'\nimport { doesIntersect2, isContainedWithin } from '@jbrowse/core/util/range'\nimport ClearIcon from '@mui/icons-material/Clear'\nimport {\n  when,\n  compareLocs,\n  getSession,\n  parseLocString,\n} from '@jbrowse/core/util'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\n\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\n\nconst FilterReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ filterModel }: { filterModel: any }) => {\n    const { classes } = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"range\"\n          placeholder=\"chr1:100-200\"\n          error={filterModel.locStringIsInvalid}\n          value={filterModel.locString}\n          onChange={evt => filterModel.setLocString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setLocString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  },\n)\n\nconst OPERATIONS = [\n  'overlaps with',\n  'contained within',\n  'fully contains',\n  'does not overlap',\n  'not contained within',\n  'does not contain',\n]\n\ninterface Loc {\n  start: number\n  end: number\n  refName: string\n}\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  'overlaps with': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      doesIntersect2(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'contained within': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'fully contains': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        specifiedLocation.start,\n        specifiedLocation.end,\n        cellLocation.start,\n        cellLocation.end,\n      )\n    )\n  },\n} as { [key: string]: (a: Loc, b: Loc) => boolean }\n\nOPERATION_PREDICATES['does not overlap'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['overlaps with'](cellLocation, specifiedLocation)\n}\nOPERATION_PREDICATES['not contained within'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['contained within'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\nOPERATION_PREDICATES['does not contain'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['fully contains'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnLocStringFilter', {\n    type: types.literal('LocString'),\n    columnNumber: types.integer,\n    locString: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    get locStringIsInvalid() {\n      if (self.locString) {\n        const parsed = this.parsedLocString\n        return (\n          !parsed ||\n          parsed.refName === '' ||\n          typeof parsed.start !== 'number' ||\n          typeof parsed.end !== 'number' ||\n          parsed.start > parsed.end\n        )\n      }\n      return false\n    },\n    get parsedLocString() {\n      const session = getSession(self)\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const model = getParent<any>(self, 3).spreadsheet\n      const { assemblyName } = model\n      try {\n        return parseLocString(self.locString, refName =>\n          session.assemblyManager.isValidRefName(refName, assemblyName),\n        )\n      } catch (e) {\n        return undefined\n      }\n    },\n  }))\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      const {\n        locString,\n        locStringIsInvalid,\n        parsedLocString,\n        operation,\n        columnNumber,\n      } = self // avoid closing over self\n      if (!locString || locStringIsInvalid || !parsedLocString) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived: cells } = row\n        const cell = cells[columnNumber]\n\n        if (!cell || !cell.text || !cell.extendedData) {\n          return false\n        }\n        const parsedCellText = cell.extendedData\n        if (!parsedCellText.refName) {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, parsedLocString as Loc)\n      }\n    },\n  }))\n  .actions(self => ({\n    setLocString(s: string) {\n      self.locString = s\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n// opens a new LGV at the location described in the locString in the cell text\n\nasync function locationLinkClick(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  spreadsheet: any,\n  _columnNumber: number,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  cell: any,\n) {\n  const session = getSession(spreadsheet)\n  const { assemblyManager } = session\n  const { assemblyName } = spreadsheet\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const { id } = getParent<any>(spreadsheet)\n\n  try {\n    const assembly = await assemblyManager.waitForAssembly(assemblyName)\n    if (!assembly) {\n      throw new Error(`assembly not found \"${assemblyName}\"`)\n    }\n    const loc = parseLocString(cell.text, name =>\n      assemblyManager.isValidRefName(name, spreadsheet.assemblyName),\n    )\n    const { refName } = loc\n    const canonicalRefName = assembly.getCanonicalRefName(refName)\n    const newDisplayedRegion = assembly.regions?.find(\n      region => region.refName === canonicalRefName,\n    )\n\n    const newViewId = `${id}_${assemblyName}`\n    let view = session.views.find(v => v.id === newViewId) as LGV\n    if (!view) {\n      view = session.addView('LinearGenomeView', {\n        displayName: assemblyName,\n        id: newViewId,\n      }) as LGV\n\n      await when(() => view.initialized)\n\n      // note that we have to clone this because otherwise it adds \"same object\n      // twice to the mst tree\"\n      view.setDisplayedRegions([JSON.parse(JSON.stringify(newDisplayedRegion))])\n    }\n    view.navToLocString(cell.text)\n  } catch (e) {\n    session.notify(`${e}`, 'error')\n  }\n}\n\nconst DataCellReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ cell, columnNumber, spreadsheet }: any) => {\n    return (\n      <a\n        onClick={evt => {\n          evt.preventDefault()\n          locationLinkClick(spreadsheet, columnNumber, cell)\n        }}\n        title=\"open a new linear genome view here\"\n        href=\"#link\"\n      >\n        {cell.text}\n      </a>\n    )\n  },\n)\n\nconst LocStringColumnType = MakeSpreadsheetColumnType('LocString', {\n  categoryName: 'Location',\n  displayName: 'Full location',\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  compare(cellA: { extendedData: any }, cellB: { extendedData: any }) {\n    return compareLocs(cellA.extendedData, cellB.extendedData)\n  },\n  FilterModelType,\n  DataCellReactComponent,\n})\n\nexport default LocStringColumnType\n","import React from 'react'\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types, getType } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\n\n// icons\nimport ClearIcon from '@mui/icons-material/Clear'\n\nconst OPERATIONS = [\n  'equals',\n  'contains',\n  'does not contain',\n  'does not equal',\n  'starts with',\n  'ends with',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  contains: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().indexOf(stringToFind) !== -1\n  },\n  equals: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase() === stringToFind\n  },\n  'starts with': (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().indexOf(stringToFind) === 0\n  },\n  'ends with': (textInCell, stringToFind) => {\n    const index = textInCell.toLowerCase().indexOf(stringToFind)\n    if (index === -1) {\n      return false\n    }\n    return index === textInCell.length - stringToFind.length\n  },\n} as { [key: string]: (a: string, b: string) => boolean }\n\nOPERATION_PREDICATES['does not contain'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.contains(textInCell, stringToFind)\n}\nOPERATION_PREDICATES['does not equal'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.equals(textInCell, stringToFind)\n}\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    margin: 0,\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ filterModel }: { filterModel: any }) => {\n    const { classes } = useStyles()\n    const operationChoices = getEnumerationValues(\n      getSubType(getPropertyType(getType(filterModel), 'operation')),\n    )\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={event => {\n            filterModel.setOperation(String(event.target.value))\n          }}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"text\"\n          value={filterModel.stringToFind}\n          onChange={evt => filterModel.setString(evt.target.value)}\n          className={classes.textFilterControl}\n          InputProps={{\n            endAdornment: (\n              <InputAdornment\n                className={classes.textFilterControlAdornment}\n                position=\"end\"\n              >\n                <IconButton\n                  aria-label=\"clear filter\"\n                  onClick={() => filterModel.setString('')}\n                  color=\"secondary\"\n                >\n                  <ClearIcon />\n                </IconButton>\n              </InputAdornment>\n            ),\n          }}\n        />\n      </>\n    )\n  },\n)\n\n// MST model for the column filter control\nconst ColumnTextFilter = types\n  .model('ColumnTextFilter', {\n    type: types.literal('Text'),\n    columnNumber: types.integer,\n    stringToFind: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      const { stringToFind, columnNumber, operation } = self // avoid closing over self\n      if (!stringToFind) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      const s = stringToFind.toLowerCase() // case insensitive match\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n        if (!cell || !cell.text) {\n          return false\n        }\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n        return predicate(cell.text, s)\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s: string) {\n      self.stringToFind = s\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst TextColumnType = MakeSpreadsheetColumnType('Text', {\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType: ColumnTextFilter,\n})\n\nexport { TextColumnType as TextColumn, ColumnTextFilter as FilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Text'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocRef'),\n  }),\n)\n\nconst LocRef = MakeSpreadsheetColumnType('LocRef', {\n  categoryName: 'Location',\n  displayName: 'Reference seq',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocRef\n","import React from 'react'\nimport { types } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport { MenuItem, Select, TextField } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\nconst OPERATIONS = [\n  'equals',\n  'greater than',\n  'less than',\n  'between',\n  'not between',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  equals: (numberInCell, firstNumber) => {\n    return numberInCell === firstNumber\n  },\n  'greater than': (numberInCell, firstNumber) => {\n    return numberInCell > firstNumber\n  },\n  'less than': (numberInCell, firstNumber) => {\n    return numberInCell < firstNumber\n  },\n  between: (numberInCell, firstNumber, secondNumber) => {\n    return (\n      numberInCell > firstNumber &&\n      secondNumber !== undefined &&\n      numberInCell < secondNumber\n    )\n  },\n} as { [key: string]: (arg0: number, a: number, b?: number) => boolean }\n\nOPERATION_PREDICATES['not between'] = (\n  numberInCell,\n  firstNumber,\n  secondNumber,\n) => {\n  return !OPERATION_PREDICATES.between(numberInCell, firstNumber, secondNumber)\n}\n\nconst useStyles = makeStyles()({\n  textFilterControlAdornment: { marginRight: '-18px' },\n  textFilterControl: {\n    '& .MuiInput-formControl': {\n      marginTop: 8,\n    },\n    '& .MuiInputLabel-formControl': {\n      top: '-7px',\n      '&.MuiInputLabel-shrink': {\n        top: '-3px',\n      },\n    },\n  },\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ filterModel }: { filterModel: any }) => {\n    const { classes } = useStyles()\n\n    const operationChoices = OPERATIONS\n\n    return (\n      <>\n        <Select\n          value={filterModel.operation}\n          onChange={e => filterModel.setOperation(String(e.target.value))}\n        >\n          {operationChoices.map(name => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>{' '}\n        <TextField\n          label=\"number\"\n          placeholder=\"123\"\n          type=\"number\"\n          error={filterModel.firstNumberIsInvalid}\n          defaultValue={filterModel.firstNumber}\n          onChange={evt => {\n            filterModel.setFirstNumber(parseFloat(evt.target.value))\n          }}\n          className={classes.textFilterControl}\n        />\n        {filterModel.operation !== 'between' &&\n        filterModel.operation !== 'not between' ? null : (\n          <>\n            {' and '}\n            <TextField\n              label=\"number\"\n              placeholder=\"456\"\n              type=\"number\"\n              error={filterModel.secondNumberIsInvalid}\n              defaultValue={filterModel.secondNumber}\n              onChange={evt =>\n                filterModel.setSecondNumber(parseFloat(evt.target.value))\n              }\n              className={classes.textFilterControl}\n            />\n          </>\n        )}\n      </>\n    )\n  },\n)\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnNumberFilter', {\n    type: types.literal('Number'),\n    columnNumber: types.integer,\n    firstNumber: types.maybe(types.number),\n    secondNumber: types.maybe(types.number),\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      if (typeof self.firstNumber !== 'number') {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      const { firstNumber, secondNumber, operation, columnNumber } = self // avoid closing over self\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return function stringPredicate(_sheet: any, row: any) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n\n        if (!cell || !cell.text) {\n          return false\n        }\n\n        const parsedCellText = parseFloat(cell.text)\n        if (typeof parsedCellText !== 'number') {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, firstNumber, secondNumber)\n      }\n    },\n  }))\n  .actions(self => ({\n    setFirstNumber(n: number) {\n      if (Number.isNaN(n) || typeof n !== 'number') {\n        self.firstNumber = undefined\n      } else {\n        self.firstNumber = n\n      }\n    },\n    setSecondNumber(n: number) {\n      if (Number.isNaN(n) || typeof n !== 'number') {\n        self.secondNumber = undefined\n      } else {\n        self.secondNumber = n\n      }\n    },\n    setOperation(op: string) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst NumberColumn = MakeSpreadsheetColumnType('Number', {\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport { NumberColumn, FilterModelType }\n","import LocString from './LocString'\nimport LocRef from './LocRef'\nimport LocStart from './LocStart'\nimport LocEnd from './LocEnd'\nimport { NumberColumn as Number } from './Number'\nimport { TextColumn as Text } from './Text'\nimport { types, IAnyModelType } from 'mobx-state-tree'\n\nconst ColumnTypes = {\n  Number,\n  Text,\n  LocString,\n  LocRef,\n  LocStart,\n  LocEnd,\n}\n\nconst allColumnTypes = Object.values(ColumnTypes)\nconst AnyColumnType = types.union(...allColumnTypes)\nconst AnyFilterModelType = types.union(\n  ...allColumnTypes\n    .map(columnType => {\n      // just instantiate the blank types to get their filter model types\n      const { FilterModelType } = columnType.create({\n        // @ts-ignore\n        type: columnType.properties.type.value,\n      })\n      return FilterModelType as unknown as IAnyModelType\n    })\n    // some column types might not have filter machinery, filter those out\n    .filter(t => !!t),\n)\n\nexport { ColumnTypes, AnyColumnType, AnyFilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types } from 'mobx-state-tree'\nimport { FilterModelType as NumberFilterModel } from './Number'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocStart'),\n  }),\n)\n\nconst LocStart = MakeSpreadsheetColumnType('LocStart', {\n  categoryName: 'Location',\n  displayName: 'Start',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocStart\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Number'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocEnd'),\n  }),\n)\n\nconst LocEnd = MakeSpreadsheetColumnType('LocEnd', {\n  categoryName: 'Location',\n  displayName: 'End',\n  compare(cellA: { text: string }, cellB: { text: string }) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocEnd\n","import { types, getParent } from 'mobx-state-tree'\n\nconst CellModel = types.model('SpreadsheetCell', {\n  text: types.string,\n  extendedData: types.maybe(types.frozen()),\n})\n\nconst RowModel = types\n  .model('SpreadsheetRow', {\n    id: types.identifier,\n    cells: types.array(CellModel),\n    extendedData: types.maybe(types.frozen()),\n    isSelected: false,\n  })\n  .actions(self => ({\n    toggleSelect() {\n      self.isSelected = !self.isSelected\n    },\n    unSelect() {\n      self.isSelected = false\n    },\n    select() {\n      self.isSelected = true\n    },\n    setExtendedData(data: unknown) {\n      self.extendedData = data\n    },\n  }))\n  .views(self => ({\n    get cellsWithDerived() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const { columns } = getParent<any>(self, 3)\n      let i = 0\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return columns.map((column: { isDerived: boolean; expr: any }) => {\n        if (column.isDerived) {\n          return column.expr.evalSync({\n            row: self,\n          })\n        }\n        return self.cells[i++]\n      })\n    },\n  }))\n\nexport default RowModel\n","import RowModel from './Row'\nimport { types, getParent } from 'mobx-state-tree'\n\nconst StaticRowModel = types\n  .model('StaticRowSet', {\n    isLoaded: types.literal(true),\n    rows: types.array(RowModel),\n  })\n  .views(self => ({\n    get count() {\n      return self.rows.length\n    },\n\n    get passingFiltersCount() {\n      return this.sortedFilteredRows.length\n    },\n\n    get selectedCount() {\n      return this.selectedRows.length\n    },\n\n    get selectedAndPassingFiltersCount() {\n      return this.selectedFilteredRows.length\n    },\n\n    get sortedRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const parent = getParent<any>(self)\n      return self.rows.slice().sort(parent.rowSortingComparisonFunction)\n    },\n\n    get selectedRows() {\n      return self.rows.filter(r => r.isSelected)\n    },\n\n    get selectedFilteredRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const sheet = getParent<any>(self)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const view = getParent<any>(sheet)\n      const { filterControls } = view\n      return this.selectedRows.filter(row =>\n        filterControls.rowPassesFilters(sheet, row),\n      )\n    },\n\n    // the set of all rows that pass the filters, sorted\n    get sortedFilteredRows() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const sheet = getParent<any>(self)\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const view = getParent<any>(sheet)\n      const { filterControls } = view\n      return self.rows\n        .filter(row => filterControls.rowPassesFilters(sheet, row))\n        .sort(sheet.rowSortingComparisonFunction)\n    },\n  }))\n  .actions(self => ({\n    unselectAll() {\n      self.rows.forEach(row => row.unSelect())\n    },\n  }))\n\nexport default StaticRowModel\n","import { stringToJexlExpression } from '@jbrowse/core/util/jexlStrings'\nimport { getSession, getEnv } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport {\n  addDisposer,\n  types,\n  getParent,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\n\n// locals\nimport { ColumnTypes, AnyColumnType } from './ColumnDataTypes'\nimport StaticRowSetModel from './StaticRowSet'\nimport RowModel from './Row'\n\ntype Row = Instance<typeof RowModel>\n\nconst ColumnDefinition = types\n  .model('ColumnDefinition', {\n    name: types.maybe(types.string),\n    dataType: types.optional(AnyColumnType, () => ({\n      type: 'Text',\n    })),\n    // set to true if column is derived from other columns\n    // if the column is derived, each cell will have a\n    // `derivationFunction` that is called to get its value\n    isDerived: false,\n    // if this cell is derived from other cells, execute this function to get\n    // the value\n    derivationFunctionText: types.maybe(types.string),\n  })\n  .views(self => ({\n    get expr() {\n      if (self.isDerived) {\n        // compile this as a jexl expression\n        return stringToJexlExpression(\n          String(self.derivationFunctionText),\n          getEnv(self).pluginManager.jexl,\n        )\n      }\n      return undefined\n    },\n  }))\n\ntype RowMenuPosition = { anchorEl: Element; rowNumber: string } | null\n\nconst Spreadsheet = types\n  .model('Spreadsheet', {\n    rowSet: types.optional(StaticRowSetModel, () => StaticRowSetModel.create()),\n    columns: types.array(ColumnDefinition),\n    columnDisplayOrder: types.array(types.number),\n    hasColumnNames: false,\n\n    sortColumns: types.array(\n      types\n        .model('SortColumns', {\n          columnNumber: types.number,\n          descending: false,\n        })\n        .actions(self => ({\n          switchDirection() {\n            self.descending = !self.descending\n          },\n        })),\n    ),\n\n    assemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    defaultDataType: ColumnTypes.Text,\n    rowMenuPosition: null as RowMenuPosition,\n    isLoaded: false,\n  }))\n  .views(self => ({\n    get initialized() {\n      const session = getSession(self)\n      const name = self.assemblyName\n      return name ? session.assemblyManager.get(name)?.initialized : false\n    },\n    get hideRowSelection() {\n      // just delegates to parent\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).hideRowSelection\n    },\n\n    // list of data type names to be made available in the column\n    // dropdown menu\n    get dataTypeChoices() {\n      const typeNames = Object.keys(ColumnTypes) as (keyof typeof ColumnTypes)[]\n      return typeNames.map(typeName => {\n        const dataType = ColumnTypes[typeName].create({ type: typeName })\n        const { displayName, categoryName } = dataType\n        return { typeName, displayName, categoryName }\n      })\n    },\n\n    rowSortingComparisonFunction(rowA: Row, rowB: Row) {\n      for (let i = 0; i < self.sortColumns.length; i += 1) {\n        const { columnNumber, descending } = self.sortColumns[i]\n        const { dataType } = self.columns[columnNumber]\n        const result = dataType.compare(\n          rowA.cellsWithDerived[columnNumber],\n          rowB.cellsWithDerived[columnNumber],\n        )\n        if (result) {\n          return descending ? -result : result\n        }\n      }\n      return 0\n    },\n  }))\n  .actions(self => ({\n    afterAttach() {\n      addDisposer(\n        self,\n        autorun(async () => {\n          const session = getSession(self)\n          const { assemblyManager } = session\n          try {\n            if (self.assemblyName) {\n              await assemblyManager.waitForAssembly(self.assemblyName)\n              this.setLoaded(true)\n            }\n          } catch (error) {\n            session.notify(\n              `failed to load assembly ${self.assemblyName} ${error}`,\n              'error',\n            )\n          }\n        }),\n      )\n    },\n\n    setLoaded(flag: boolean) {\n      self.isLoaded = flag\n    },\n\n    setRowMenuPosition(newPosition: RowMenuPosition) {\n      self.rowMenuPosition = newPosition\n    },\n\n    setSortColumns(newSort: NonNullable<SnapshotIn<typeof self.sortColumns>>) {\n      if (newSort) {\n        // @ts-ignore\n        self.sortColumns = newSort\n      }\n    },\n    setColumnType(columnNumber: number, newTypeName: string) {\n      self.columns[columnNumber].dataType = { type: newTypeName }\n    },\n    unselectAll() {\n      return self.rowSet.unselectAll()\n    },\n  }))\n\nexport type SpreadsheetStateModel = typeof Spreadsheet\nexport type SpreadsheetModel = Instance<SpreadsheetStateModel>\n\nexport default Spreadsheet\n","import { types, getParent, Instance } from 'mobx-state-tree'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { getSession, getEnv } from '@jbrowse/core/util'\n\n// 30MB\nconst IMPORT_SIZE_LIMIT = 30_000_000\n\nconst fileTypes = ['CSV', 'TSV', 'VCF', 'BED', 'BEDPE', 'STAR-Fusion']\nconst fileTypeParsers = {\n  CSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseCsvBuffer),\n  TSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseTsvBuffer),\n  VCF: () => import('../importAdapters/VcfImport').then(r => r.parseVcfBuffer),\n  BED: () => import('../importAdapters/BedImport').then(r => r.parseBedBuffer),\n  BEDPE: () =>\n    import('../importAdapters/BedImport').then(r => r.parseBedPEBuffer),\n  'STAR-Fusion': () =>\n    import('../importAdapters/STARFusionImport').then(\n      r => r.parseSTARFusionBuffer,\n    ),\n}\n// regexp used to guess the type of a file or URL from its file extension\nconst fileTypesRegexp = new RegExp(`\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`, 'i')\n\nconst ImportWizard = types\n  .model('SpreadsheetImportWizard', {\n    fileType: types.optional(types.enumeration(fileTypes), 'CSV'),\n    hasColumnNameLine: true,\n    columnNameLineNumber: 1,\n    selectedAssemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    fileTypes,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    fileSource: undefined as any,\n    error: undefined as unknown,\n    loading: false,\n  }))\n  .views(self => ({\n    get isReadyToOpen() {\n      return (\n        !self.error &&\n        self.fileSource &&\n        (self.fileSource.blobId ||\n          self.fileSource.localPath ||\n          self.fileSource.uri)\n      )\n    },\n    get canCancel() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return getParent<any>(self).readyToDisplay\n    },\n\n    get fileName() {\n      return (\n        self.fileSource.uri ||\n        self.fileSource.localPath ||\n        (self.fileSource.blobId && self.fileSource.name)\n      )\n    },\n\n    get requiresUnzip() {\n      return this.fileName.endsWith('gz')\n    },\n\n    isValidRefName(refName: string, assemblyName?: string) {\n      const { assemblyManager } = getSession(self)\n      if (!assemblyName) {\n        return false\n      }\n      return assemblyManager.isValidRefName(refName, assemblyName)\n    },\n  }))\n  .actions(self => ({\n    setSelectedAssemblyName(s: string) {\n      self.selectedAssemblyName = s\n    },\n    setFileSource(newSource: unknown) {\n      self.fileSource = newSource\n      self.error = undefined\n\n      if (self.fileSource) {\n        // try to autodetect the file type, ignore errors\n        const name = self.fileName\n\n        if (name) {\n          const match = fileTypesRegexp.exec(name)\n          if (match && match[1]) {\n            if (match[1] === 'tsv' && name.includes('star-fusion')) {\n              self.fileType = 'STAR-Fusion'\n            } else {\n              self.fileType = match[1].toUpperCase()\n            }\n          }\n        }\n      }\n    },\n\n    toggleHasColumnNameLine() {\n      self.hasColumnNameLine = !self.hasColumnNameLine\n    },\n\n    setColumnNameLineNumber(newnumber: number) {\n      if (newnumber > 0) {\n        self.columnNameLineNumber = newnumber\n      }\n    },\n\n    setFileType(typeName: string) {\n      self.fileType = typeName\n    },\n\n    setError(error: unknown) {\n      console.error(error)\n      self.loading = false\n      self.error = error\n    },\n\n    setLoaded() {\n      self.loading = false\n      self.error = undefined\n    },\n\n    cancelButton() {\n      self.error = undefined\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      getParent<any>(self).setDisplayMode()\n    },\n\n    // fetch and parse the file, make a new Spreadsheet model for it,\n    // then set the parent to display it\n    async import(assemblyName: string) {\n      if (!self.fileSource) {\n        return\n      }\n\n      if (self.loading) {\n        throw new Error('Cannot import, load already in progress')\n      }\n\n      self.selectedAssemblyName = assemblyName\n      self.loading = true\n      const type = self.fileType as keyof typeof fileTypeParsers\n      const typeParser = await fileTypeParsers[type]()\n      if (!typeParser) {\n        throw new Error(`cannot open files of type '${self.fileType}'`)\n      }\n\n      const { unzip } = await import('@gmod/bgzf-filehandle')\n      const { pluginManager } = getEnv(self)\n      const filehandle = openLocation(self.fileSource, pluginManager)\n      try {\n        const stat = await filehandle.stat()\n        if (stat.size > IMPORT_SIZE_LIMIT) {\n          throw new Error(\n            `File is too big. Tabular files are limited to at most ${(\n              IMPORT_SIZE_LIMIT / 1000\n            ).toLocaleString()}kb.`,\n          )\n        }\n      } catch (e) {\n        // not required for stat to succeed to proceed, but it is helpful\n        console.warn(e)\n      }\n\n      try {\n        await filehandle\n          .readFile()\n          .then(buffer => (self.requiresUnzip ? unzip(buffer) : buffer))\n          .then(buffer => typeParser(buffer, self))\n          .then(spreadsheet => {\n            this.setLoaded()\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            getParent<any>(self).displaySpreadsheet(spreadsheet)\n          })\n      } catch (e) {\n        this.setError(e)\n      }\n    },\n  }))\n\nexport type ImportWizardStateModel = typeof ImportWizard\nexport type ImportWizardModel = Instance<ImportWizardStateModel>\n\nexport default ImportWizard\n","import { types, getParent, SnapshotIn } from 'mobx-state-tree'\nimport { AnyFilterModelType as AnyColumnFilter } from './ColumnDataTypes'\n\n// filter that finds a simple string in any of the cells of a row\nconst RowFullTextFilter = types\n  .model('RowFullTextFilter', {\n    type: types.literal('RowFullText'),\n    stringToFind: '',\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      let s = self.stringToFind // avoid closing over self\n      if (!s) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      s = s.toLowerCase()\n      return function stringPredicate(\n        _sheet: unknown,\n        row: { cellsWithDerived: { text: string }[] },\n      ) {\n        const { cellsWithDerived } = row\n        for (\n          let columnNumber = 0;\n          columnNumber < cellsWithDerived.length;\n          columnNumber += 1\n        ) {\n          const cell = cellsWithDerived[columnNumber]\n          // note: case insensitive\n          if (cell.text && cell.text.toLowerCase().includes(s)) {\n            return true\n          }\n        }\n        return false\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s: string) {\n      self.stringToFind = s\n    },\n    clear() {\n      self.stringToFind = ''\n    },\n  }))\n\nconst model = types\n  .model('SpreadsheetFilterControls', {\n    rowFullText: types.optional(\n      RowFullTextFilter,\n      () =>\n        ({\n          type: 'RowFullText',\n          stringToFind: '',\n        } as SnapshotIn<typeof RowFullTextFilter>),\n    ),\n    columnFilters: types.array(AnyColumnFilter),\n  })\n  .views(self => ({\n    get filters() {\n      return [self.rowFullText, ...self.columnFilters].filter(f => !!f)\n    },\n    setRowFullTextFilter(stringToFind: string) {\n      // @ts-ignore\n      self.rowFullText = {\n        type: 'RowFullText',\n        stringToFind,\n      }\n    },\n    rowPassesFilters(sheet: unknown, row: unknown) {\n      for (let i = 0; i < this.filters.length; i += 1) {\n        if (!this.filters[i].predicate(sheet, row)) {\n          return false\n        }\n      }\n      return true\n    },\n  }))\n  .actions(self => ({\n    addBlankColumnFilter(columnNumber: number) {\n      const { dataType } =\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self).spreadsheet.columns[columnNumber]\n      self.columnFilters.push({\n        type: dataType.type,\n        columnNumber,\n      })\n    },\n    removeColumnFilter(filter: typeof AnyColumnFilter) {\n      return self.columnFilters.remove(filter)\n    },\n    clearAllFilters() {\n      self.columnFilters.clear()\n      self.rowFullText.clear()\n    },\n  }))\n\nexport default model\n","import {\n  types,\n  getParent,\n  getEnv,\n  cast,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\n\n// icons\nimport DoneIcon from '@mui/icons-material/Done'\n\nimport SpreadsheetModel from './Spreadsheet'\nimport ImportWizardModel from './ImportWizard'\nimport FilterControlsModel from './FilterControls'\n\ntype Spreadsheet = Instance<typeof SpreadsheetModel>\n\nexport type MenuItemWithDisabledCallback = MenuItem & {\n  disabled?:\n    | boolean\n    | ((\n        viewModel: unknown,\n        spreadsheetModel: Spreadsheet,\n        rowNumber: number,\n        row: Spreadsheet['rowSet']['rows'][0],\n      ) => boolean)\n}\n\nconst defaultRowMenuItems: MenuItemWithDisabledCallback[] = [\n  {\n    label: 'Toggle select',\n    icon: DoneIcon,\n    onClick(_view: unknown, spreadsheet: Spreadsheet) {\n      const rowNumber = spreadsheet.rowMenuPosition?.rowNumber\n      if (rowNumber !== undefined) {\n        spreadsheet.rowSet.rows[+rowNumber - 1].toggleSelect()\n      }\n    },\n  },\n]\n\nconst minHeight = 40\nconst defaultHeight = 440\nconst model = types\n  .model('SpreadsheetView', {\n    type: types.literal('SpreadsheetView'),\n    offsetPx: 0,\n    height: types.optional(\n      types.refinement(\n        'SpreadsheetViewHeight',\n        types.number,\n        n => n >= minHeight,\n      ),\n      defaultHeight,\n    ),\n\n    hideViewControls: false,\n    hideVerticalResizeHandle: false,\n    hideFilterControls: false,\n\n    filterControls: types.optional(FilterControlsModel, () =>\n      FilterControlsModel.create({}),\n    ),\n\n    // switch specifying whether we are showing the import wizard or the\n    // spreadsheet in our viewing area\n    mode: types.optional(\n      types.enumeration('SpreadsheetViewMode', ['import', 'display']),\n      'import',\n    ),\n    importWizard: types.optional(ImportWizardModel, () =>\n      ImportWizardModel.create(),\n    ),\n    spreadsheet: types.maybe(SpreadsheetModel),\n  })\n  .volatile(() => ({\n    width: 400,\n    rowMenuItems: defaultRowMenuItems,\n  }))\n  .views(self => ({\n    get readyToDisplay() {\n      return !!self.spreadsheet && self.spreadsheet.isLoaded\n    },\n\n    get hideRowSelection() {\n      return !!getEnv(self).hideRowSelection\n    },\n\n    get outputRows() {\n      if (self.spreadsheet && self.spreadsheet.rowSet.isLoaded) {\n        const selected = self.spreadsheet.rowSet.selectedFilteredRows\n        if (selected.length) {\n          return selected\n        }\n        return self.spreadsheet.rowSet.sortedFilteredRows\n      }\n      return undefined\n    },\n\n    get assembly() {\n      const name = self.spreadsheet?.assemblyName\n      if (name) {\n        const assemblies = getSession(self).assemblies\n        return assemblies?.find(asm => readConfObject(asm, 'name') === name)\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    setRowMenuItems(newItems: MenuItem[]) {\n      self.rowMenuItems = newItems\n    },\n    setWidth(newWidth: number) {\n      self.width = newWidth\n      return self.width\n    },\n    setHeight(newHeight: number) {\n      if (newHeight > minHeight) {\n        self.height = newHeight\n      } else {\n        self.height = minHeight\n      }\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    resizeWidth(distance: number) {\n      const oldWidth = self.width\n      const newWidth = this.setWidth(self.width + distance)\n      return newWidth - oldWidth\n    },\n\n    /** load a new spreadsheet and set our mode to display it */\n    displaySpreadsheet(spreadsheet: SnapshotIn<typeof SpreadsheetModel>) {\n      self.filterControls.clearAllFilters()\n      self.spreadsheet = cast(spreadsheet)\n      self.mode = 'display'\n    },\n\n    setImportMode() {\n      self.mode = 'import'\n    },\n\n    setDisplayMode() {\n      if (self.readyToDisplay) {\n        self.mode = 'display'\n      }\n    },\n\n    closeView() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      getParent<any>(self, 2).removeView(self)\n    },\n  }))\n\nconst SpreadsheetView = types.compose(BaseViewModel, model)\n\nexport type SpreadsheetViewStateModel = typeof SpreadsheetView\nexport type SpreadsheetViewModel = Instance<SpreadsheetViewStateModel>\n\nexport default SpreadsheetView\n","import { lazy } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewComfyIcon from '@mui/icons-material/ViewComfy'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport SpreadsheetViewModel from './SpreadsheetView/models/SpreadsheetView'\n\ntype SpreadsheetView = Instance<typeof SpreadsheetViewModel>\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() => {\n      return new ViewType({\n        name: 'SpreadsheetView',\n        stateModel: SpreadsheetViewModel,\n        ReactComponent: lazy(\n          () => import('./SpreadsheetView/components/SpreadsheetView'),\n        ),\n      })\n    })\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-SpreadsheetView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        uri,\n        fileType,\n      }: {\n        session: AbstractSessionModel\n        assembly: string\n        uri: string\n        fileType?: string\n      }) => {\n        const view = session.addView('SpreadsheetView') as SpreadsheetView\n\n        if (!view) {\n          throw new Error('Failed to initialize view')\n        }\n        const exts = uri.split('.')\n        let ext = exts?.pop()?.toUpperCase()\n        if (ext === 'GZ') {\n          ext = exts?.pop()?.toUpperCase()\n        }\n\n        view.importWizard.setFileType(fileType || ext || '')\n        view.importWizard.setSelectedAssemblyName(assembly)\n        view.importWizard.setFileSource({\n          uri,\n          locationType: 'UriLocation',\n        })\n        view.importWizard.import(assembly)\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { rootModel } = pluginManager\n    if (isAbstractMenuManager(rootModel)) {\n      rootModel.appendToSubMenu(['Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n\nexport type { SpreadsheetViewModel, SpreadsheetView }\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { IconButton, Grid, FormControlLabel, Checkbox } from '@mui/material'\nimport { grey } from '@mui/material/colors'\nimport { makeStyles } from 'tss-react/mui'\nimport { ResizeHandle } from '@jbrowse/core/ui'\n\n// locals\nimport { SvInspectorViewModel } from '../models/SvInspectorView'\n\n// icons\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\n\nconst headerHeight = 52\n\nconst style = {\n  width: 4,\n  background: '#ccc',\n  boxSizing: 'border-box',\n  borderTop: '1px solid #fafafa',\n}\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    marginBottom: theme.spacing(1),\n    background: 'white',\n    overflow: 'hidden',\n  },\n  header: {\n    overflow: 'hidden',\n    whiteSpace: 'nowrap',\n    boxSizing: 'border-box',\n    height: headerHeight,\n    background: grey[200],\n    // borderBottom: '1px solid #a2a2a2',\n  },\n  viewControls: {\n    margin: 0,\n  },\n  viewsContainer: {\n    display: 'flex',\n  },\n  spreadsheetViewContainer: {\n    borderRight: '1px solid #ccc',\n    overflow: 'hidden',\n  },\n  circularViewOptions: {\n    padding: theme.spacing(1),\n    background: grey[200],\n  },\n}))\n\nconst ViewControls = observer(({ model }: { model: SvInspectorViewModel }) => {\n  const { classes } = useStyles()\n  return (\n    <Grid\n      className={classes.viewControls}\n      container\n      spacing={1}\n      direction=\"row\"\n      alignItems=\"center\"\n    >\n      <Grid item>\n        <IconButton\n          onClick={() => model.setImportMode()}\n          title=\"open a tabular file\"\n          data-testid=\"sv_inspector_view_open\"\n          color=\"secondary\"\n        >\n          <FolderOpenIcon />\n        </IconButton>\n      </Grid>\n    </Grid>\n  )\n})\n\nconst CircularViewOptions = observer(\n  ({ svInspector }: { svInspector: SvInspectorViewModel }) => {\n    const { classes } = useStyles()\n\n    return (\n      <Grid\n        container\n        className={classes.circularViewOptions}\n        style={{ height: svInspector.circularViewOptionsBarHeight }}\n      >\n        <Grid item>\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={svInspector.onlyDisplayRelevantRegionsInCircularView}\n                onChange={e =>\n                  svInspector.setOnlyDisplayRelevantRegionsInCircularView(\n                    e.target.checked,\n                  )\n                }\n              />\n            }\n            label=\"show only regions with data\"\n          />\n        </Grid>\n      </Grid>\n    )\n  },\n)\n\nfunction SvInspectorView({ model }: { model: SvInspectorViewModel }) {\n  const { classes } = useStyles()\n\n  const {\n    resizeHeight,\n    dragHandleHeight,\n    SpreadsheetViewReactComponent,\n    CircularViewReactComponent,\n    showCircularView,\n  } = model\n\n  return (\n    <div className={classes.root} data-testid={model.id}>\n      <Grid container direction=\"row\" className={classes.header}>\n        <Grid item>\n          <ViewControls model={model} />\n        </Grid>\n      </Grid>\n      <div className={classes.viewsContainer}>\n        <div className={classes.spreadsheetViewContainer}>\n          <SpreadsheetViewReactComponent model={model.spreadsheetView} />\n        </div>\n\n        {showCircularView ? (\n          <>\n            <ResizeHandle\n              onDrag={distance => {\n                const ret1 = model.circularView.resizeWidth(-distance)\n                const ret2 = model.spreadsheetView.resizeWidth(-ret1)\n                return ret2\n              }}\n              vertical\n              flexbox\n              style={style}\n            />\n            <div style={{ width: model.circularView.width }}>\n              <CircularViewOptions svInspector={model} />\n              <CircularViewReactComponent model={model.circularView} />\n            </div>\n          </>\n        ) : null}\n      </div>\n      <ResizeHandle\n        onDrag={resizeHeight}\n        style={{\n          height: dragHandleHeight,\n          background: '#ccc',\n          boxSizing: 'border-box',\n          borderTop: '1px solid #fafafa',\n        }}\n      />\n    </div>\n  )\n}\n\nexport default observer(SvInspectorView)\n","// this file contains the rather verbose functions for\n// creating features from CSV/TSV lines\nimport { parseLocString } from '@jbrowse/core/util'\n\nexport function makeAdHocFeature(\n  columns,\n  columnsAlreadyUsedInLocations,\n  row,\n  loc1,\n  loc2,\n  rowNumber,\n) {\n  // load all the other data in the row into an `otherData` object\n  const otherData = {}\n  columns.forEach((column, columnNumber) => {\n    if (columnsAlreadyUsedInLocations.includes(columnNumber)) {\n      return\n    }\n    let { text } = row.cells[columnNumber]\n    if (column.dataType.type === 'Number') {\n      text = parseFloat(text)\n    }\n    otherData[column.name] = text\n  })\n\n  // make the final feature data out of otherData + the parsed locations\n  return {\n    ...otherData,\n    uniqueId: `sv-inspector-adhoc-${rowNumber}`,\n    refName: loc1.refName,\n    start: loc1.start,\n    end: loc1.end,\n    mate: {\n      refName: loc2.refName,\n      start: loc2.start,\n      end: loc2.end,\n    },\n  }\n}\n\nexport function makeAdHocSvFeatureFromTwoLocations(\n  columns,\n  locationColumnNumbers,\n  row,\n  rowNumber,\n  isValidRefName,\n) {\n  // use the first two locations we found (first according to *displayed* order)\n  const loc1 = parseLocString(\n    row.cells[locationColumnNumbers[0]].text,\n    isValidRefName,\n  )\n  const loc2 = parseLocString(\n    row.cells[locationColumnNumbers[1]].text,\n    isValidRefName,\n  )\n\n  const columnsAlreadyUsedInLocations = [\n    locationColumnNumbers[0],\n    locationColumnNumbers[1],\n  ]\n\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\nexport function makeAdHocSvFeatureFromTwoRefStartEndSets(\n  columns,\n  locRefColumnNumbers,\n  locStartColumnNumbers,\n  locEndColumnNumbers,\n  row,\n  rowNumber,\n) {\n  const textOf = colno => row.cells[colno].text\n  const loc1 = {\n    refName: textOf(locRefColumnNumbers[0]),\n    start: parseInt(textOf(locStartColumnNumbers[0]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[0]), 10),\n  }\n  const loc2 = {\n    refName: textOf(locRefColumnNumbers[1]),\n    start: parseInt(textOf(locStartColumnNumbers[1]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[1]), 10),\n  }\n  const columnsAlreadyUsedInLocations = [\n    locRefColumnNumbers[0],\n    locStartColumnNumbers[0],\n    locEndColumnNumbers[0],\n    locRefColumnNumbers[1],\n    locStartColumnNumbers[1],\n    locEndColumnNumbers[1],\n  ]\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\n// makes a feature data object (passed as `data` to a SimpleFeature constructor)\n// out of table row if the row has 2 location columns. undefined if not\nexport function makeAdHocSvFeature(sheet, rowNumber, row, isValidRefName) {\n  const { columns, columnDisplayOrder } = sheet\n  const columnTypes = {}\n  columnDisplayOrder.forEach(columnNumber => {\n    const columnDefinition = columns[columnNumber]\n    if (!columnTypes[columnDefinition.dataType.type]) {\n      columnTypes[columnDefinition.dataType.type] = []\n    }\n    columnTypes[columnDefinition.dataType.type].push(columnNumber)\n  })\n  const locationColumnNumbers = columnTypes.LocString || []\n  const locStartColumnNumbers = columnTypes.LocStart || []\n  const locEndColumnNumbers = columnTypes.LocEnd || []\n  const locRefColumnNumbers = columnTypes.LocRef || []\n\n  // if we have 2 or more columns of type location, make a feature from them\n  if (locationColumnNumbers.length >= 2) {\n    return makeAdHocSvFeatureFromTwoLocations(\n      columns,\n      locationColumnNumbers,\n      row,\n      rowNumber,\n      isValidRefName,\n    )\n  }\n  if (\n    locRefColumnNumbers.length >= 2 &&\n    locStartColumnNumbers.length >= 2 &&\n    locEndColumnNumbers.length >= 2\n  ) {\n    return makeAdHocSvFeatureFromTwoRefStartEndSets(\n      columns,\n      locRefColumnNumbers,\n      locStartColumnNumbers,\n      locEndColumnNumbers,\n      row,\n      rowNumber,\n    )\n  }\n  return undefined\n}\n","import SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { makeAdHocSvFeature } from './adhocFeatureUtils'\nimport { getEnv, getSession } from '@jbrowse/core/util'\n\nexport function getSerializedFeatureForRow(\n  session,\n  spreadsheetView,\n  row,\n  rowNumber,\n) {\n  if (row.extendedData) {\n    if (row.extendedData.vcfFeature) {\n      return row.extendedData.vcfFeature\n    }\n    if (row.extendedData.feature) {\n      return row.extendedData.feature\n    }\n  }\n  const adhocFeature = makeAdHocSvFeature(\n    spreadsheetView.spreadsheet,\n    rowNumber,\n    row,\n    session.assemblyManager.isValidRefName,\n  )\n  if (adhocFeature) {\n    return adhocFeature\n  }\n  return undefined\n}\n\nexport function breakpointSplitViewSnapshotFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const { pluginManager } = getEnv(svInspectorView)\n  const session = getSession(spreadsheetView)\n  const featureData = getSerializedFeatureForRow(\n    session,\n    spreadsheet,\n    row,\n    rowNumber,\n  )\n\n  if (featureData) {\n    const feature = new SimpleFeature(featureData)\n    session.setSelection(feature)\n    const viewType = pluginManager.getViewType('BreakpointSplitView')\n    const { circularView } = svInspectorView\n\n    const viewSnapshot = viewType.snapshotFromBreakendFeature(\n      feature,\n      circularView,\n    )\n    return viewSnapshot\n  }\n  return undefined\n}\n\nexport function openBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  )\n  if (viewSnapshot) {\n    // try to center the offsetPx\n    const { circularView } = svInspectorView\n    viewSnapshot.views[0].offsetPx -= circularView.width / 2 + 100\n    viewSnapshot.views[1].offsetPx -= circularView.width / 2 + 100\n\n    const session = getSession(spreadsheetView)\n    session.addView('BreakpointSplitView', viewSnapshot)\n  }\n}\n\nexport function canOpenBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  try {\n    const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n      svInspectorView,\n      spreadsheetView,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    return Boolean(viewSnapshot)\n  } catch (e) {\n    console.error('Unable to open breakpoint split view from table row', e)\n    return false\n  }\n}\n","import OpenInNewIcon from '@mui/icons-material/OpenInNew'\nimport clone from 'clone'\nimport {\n  getContainingView,\n  getSession,\n  Feature,\n  Region,\n} from '@jbrowse/core/util'\n\nimport { autorun, reaction } from 'mobx'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { types, getParent, addDisposer, Instance } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// locals\nimport {\n  canOpenBreakpointSplitViewFromTableRow,\n  openBreakpointSplitViewFromTableRow,\n  getSerializedFeatureForRow,\n} from './breakpointSplitViewFromTableRow'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SpreadsheetViewModel } from '@jbrowse/plugin-spreadsheet-view'\nimport { CircularViewStateModel } from '@jbrowse/plugin-circular-view'\n\nfunction defaultOnChordClick(\n  feature: Feature,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  chordTrack: any,\n  pluginManager: PluginManager,\n) {\n  const session = getSession(chordTrack)\n  session.setSelection(feature)\n  const view = getContainingView(chordTrack)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const viewType = pluginManager.getViewType('BreakpointSplitView') as any\n  const viewSnapshot = viewType.snapshotFromBreakendFeature(feature, view)\n\n  // try to center the offsetPx\n  viewSnapshot.views[0].offsetPx -= view.width / 2 + 100\n  viewSnapshot.views[1].offsetPx -= view.width / 2 + 100\n  viewSnapshot.featureData = feature.toJSON()\n\n  session.addView('BreakpointSplitView', viewSnapshot)\n}\n\nconst SvInspectorViewF = (pluginManager: PluginManager) => {\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')\n  const CircularViewType = pluginManager.getViewType('CircularView')\n\n  const SpreadsheetModel =\n    SpreadsheetViewType.stateModel as typeof SpreadsheetViewModel\n  const CircularModel = CircularViewType.stateModel as CircularViewStateModel\n\n  const minHeight = 400\n  const defaultHeight = 550\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n  const model = types\n    .model('SvInspectorView', {\n      id: ElementId,\n      type: types.literal('SvInspectorView'),\n      dragHandleHeight: 4,\n      height: types.optional(\n        types.refinement(\n          'SvInspectorViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      onlyDisplayRelevantRegionsInCircularView: false,\n\n      // switch specifying whether we are showing the import wizard or the\n      // spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SvInspectorViewMode', ['import', 'display']),\n        'import',\n      ),\n\n      spreadsheetView: types.optional(SpreadsheetModel, () =>\n        SpreadsheetModel.create({\n          type: 'SpreadsheetView',\n          hideViewControls: true,\n          hideVerticalResizeHandle: true,\n        }),\n      ),\n\n      circularView: types.optional(CircularModel, () =>\n        CircularModel.create({\n          type: 'CircularView',\n          hideVerticalResizeHandle: true,\n          hideTrackSelectorButton: true,\n          disableImportForm: true,\n        }),\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      get selectedRows() {\n        // @ts-ignore\n        return self.spreadsheetView.rowSet.selectedRows\n      },\n\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        return assembly ? readConfObject(assembly, 'name') : undefined\n      },\n\n      get showCircularView() {\n        return self.spreadsheetView.mode === 'display'\n      },\n\n      get featuresAdapterConfigSnapshot() {\n        const session = getSession(self)\n        const { spreadsheetView } = self\n        const { outputRows = [] } = spreadsheetView\n        return {\n          type: 'FromConfigAdapter',\n          features: outputRows\n            .map((r, i) =>\n              getSerializedFeatureForRow(session, spreadsheetView, r, i),\n            )\n            .filter(f => !!f),\n        }\n      },\n\n      // Promise<string[]> of refnames\n      get featuresRefNamesP(): Promise<string[]> {\n        const { getAdapterClass } =\n          pluginManager.getAdapterType('FromConfigAdapter')\n        return getAdapterClass().then(Adapter =>\n          // @ts-ignore\n          new Adapter(self.featuresAdapterConfigSnapshot).getRefNames(),\n        )\n      },\n      get featuresCircularTrackConfiguration() {\n        pluginManager.jexl.addFunction(\n          'defaultOnChordClick',\n          defaultOnChordClick,\n        )\n        return {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: this.featuresAdapterConfigSnapshot,\n          assemblyNames: [this.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick: `jexl:defaultOnChordClick(feature, track, pluginManager)`,\n              renderer: { type: 'StructuralVariantChordRenderer' },\n            },\n          ],\n        }\n      },\n    }))\n    .volatile(() => ({\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      circularViewOptionsBarHeight,\n    }))\n    .actions(self => ({\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n      setHeight(newHeight: number) {\n        if (newHeight > minHeight) {\n          self.height = newHeight\n        } else {\n          self.height = minHeight\n        }\n        return self.height\n      },\n\n      setImportMode() {\n        self.spreadsheetView.setImportMode()\n      },\n\n      setDisplayMode() {\n        self.spreadsheetView.setDisplayMode()\n      },\n\n      closeView() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self, 2).removeView(self)\n      },\n\n      setDisplayedRegions(regions: Region[]) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n\n      setOnlyDisplayRelevantRegionsInCircularView(val: boolean) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n    .actions(self => ({\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            { name: 'SvInspectorView height binding' },\n          ),\n        )\n        // bind circularview displayedRegions to spreadsheet assembly, mediated by\n        // the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              const {\n                assemblyName,\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                featuresRefNamesP,\n              } = self\n              const { tracks } = circularView\n              const session = getSession(self)\n              if (!assemblyName) {\n                return\n              }\n              const { assemblyManager } = session\n              const asm = await assemblyManager.waitForAssembly(assemblyName)\n              if (!asm) {\n                circularView.setDisplayedRegions([])\n                return\n              }\n              const { getCanonicalRefName, regions = [] } = asm\n              if (onlyDisplayRelevantRegionsInCircularView) {\n                if (tracks.length === 1) {\n                  try {\n                    const refNames = await featuresRefNamesP\n                    // canonicalize the store's ref names if necessary\n                    const refSet = new Set(\n                      refNames.map(r => getCanonicalRefName(r) || r),\n                    )\n                    circularView.setDisplayedRegions(\n                      clone(regions.filter(r => refSet.has(r.refName))),\n                    )\n                  } catch (e) {\n                    circularView.setError(e)\n                  }\n                }\n              } else {\n                circularView.setDisplayedRegions(regions)\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf: self?.featuresCircularTrackConfiguration,\n              assemblyName: self?.assemblyName,\n            }),\n            data => {\n              if (!data) {\n                return\n              }\n              const { assemblyName, generatedTrackConf } = data\n              // hide any visible tracks\n              self.circularView.tracks.forEach(track => {\n                self.circularView.hideTrack(track.configuration.trackId)\n              })\n\n              // put our track in as the only track\n              if (assemblyName && generatedTrackConf) {\n                // @ts-ignore\n                self.circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n\n        // bind spreadsheetView row menu actions to us\n        addDisposer(\n          self,\n          autorun(() => {\n            self.spreadsheetView.setRowMenuItems(\n              // these are the MenuItem entries for the row menu actions in the\n              // spreadsheet view.  these are installed into the child\n              // SpreadsheetView using an autorun below\n              [\n                {\n                  label: 'Open split detail view',\n                  icon: OpenInNewIcon,\n                  // @ts-ignore\n                  disabled(spreadsheetView, spreadsheet, rowNumber, row) {\n                    return !canOpenBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n\n                  // @ts-ignore\n                  onClick(spreadsheetView, spreadsheet, rowNumber, row) {\n                    openBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                },\n              ],\n            )\n          }),\n        )\n      },\n    }))\n\n  return { stateModel: types.compose(BaseViewModel, model) }\n}\n\nexport type SvInspectorViewStateModel = ReturnType<\n  typeof SvInspectorViewF\n>['stateModel']\nexport type SvInspectorViewModel = Instance<SvInspectorViewStateModel>\n\nexport default SvInspectorViewF\n","import ReactComponent from './components/SvInspectorView'\nimport StateModelFactory from './models/SvInspectorView'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nconst SvInspectorViewF = ({ jbrequire }) => {\n  const { stateModel } = jbrequire(StateModelFactory)\n\n  return new ViewType({ name: 'SvInspectorView', stateModel, ReactComponent })\n}\n\nexport default SvInspectorViewF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util/types'\nimport TableChartIcon from '@mui/icons-material/TableChart'\nimport SvInspectorViewTypeFactory from './SvInspectorView/SvInspectorViewType'\nimport SvInspectorViewModel from './SvInspectorView/models/SvInspectorView'\n\ntype SvInspectorView = ReturnType<typeof SvInspectorViewModel>['stateModel']\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(SvInspectorViewTypeFactory),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-SvInspectorView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        uri,\n        fileType,\n      }: {\n        session: AbstractSessionModel\n        assembly: string\n        uri: string\n        fileType?: string\n      }) => {\n        // add view, make typescript happy with return type\n        const view = session.addView(\n          'SvInspectorView',\n        ) as unknown as SvInspectorView\n\n        if (!view) {\n          throw new Error('Failed to initialize view')\n        }\n        const exts = uri.split('.')\n        let ext = exts?.pop()?.toUpperCase()\n        if (ext === 'GZ') {\n          ext = exts?.pop()?.toUpperCase()\n        }\n\n        // @ts-ignore\n        view.spreadsheetView.importWizard.setFileType(fileType || ext || '')\n        // @ts-ignore\n        view.spreadsheetView.importWizard.setSelectedAssemblyName(assembly)\n        // @ts-ignore\n        view.spreadsheetView.importWizard.setFileSource({\n          uri,\n          locationType: 'UriLocation',\n        })\n        // @ts-ignore\n        view.spreadsheetView.importWizard.import(assembly)\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import React, { useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport { measureText, getViewParams, Feature, Region } from '@jbrowse/core/util'\nimport { DisplayModel } from './util'\n\nexport default observer(\n  ({\n    text,\n    x,\n    y,\n    region,\n    reversed,\n    bpPerPx,\n    exportSVG,\n    feature,\n    viewParams,\n    color = 'black',\n    fontHeight = 13,\n    featureWidth = 0,\n    allowedWidthExpansion = 0,\n    displayModel = {},\n  }: {\n    text: string\n    x: number\n    y: number\n    color?: string\n    fontHeight?: number\n    featureWidth?: number\n    bpPerPx: number\n    allowedWidthExpansion?: number\n    feature: Feature\n    reversed?: boolean\n    displayModel?: DisplayModel\n    exportSVG?: unknown\n    region: Region\n    viewParams: {\n      start: number\n      end: number\n      offsetPx: number\n      offsetPx1: number\n    }\n  }) => {\n    const totalWidth = featureWidth + allowedWidthExpansion\n    const measuredTextWidth = measureText(text, fontHeight)\n    const params =\n      isStateTreeNode(displayModel) && isAlive(displayModel)\n        ? getViewParams(displayModel)\n        : viewParams\n\n    const viewLeft = reversed ? params.end : params.start\n\n    const [labelVisible, setLabelVisible] = useState(exportSVG)\n\n    // we use an effect to set the label visible because there can be a\n    // mismatch between the server and the client after hydration due to the\n    // floating labels. if we are exporting an SVG we allow it as is though and\n    // do not use the effetct\n    useEffect(() => {\n      setLabelVisible(true)\n    }, [])\n\n    if (isStateTreeNode(region) && !isAlive(region)) {\n      return null\n    }\n\n    const rstart = region.start\n    const rend = region.end\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n\n    const featureWidthBp = measuredTextWidth * bpPerPx\n\n    // this tricky bit of code helps smooth over block boundaries\n    // not supported for reverse mode currently\n    // reason: reverse mode allocates space for the label in the \"normal\n    // forward orientation\" making it hard to slide. The reverse mode should\n    // allocate the label space in the reverse orientation to slide it\n    if (\n      viewLeft < rend &&\n      viewLeft > rstart &&\n      fstart < viewLeft &&\n      viewLeft + featureWidthBp < fend\n    ) {\n      x = params.offsetPx\n    } else if (\n      fstart < viewLeft &&\n      viewLeft + featureWidthBp < fend &&\n      viewLeft + featureWidthBp > rstart &&\n      viewLeft + featureWidthBp < rend\n    ) {\n      x = params.offsetPx1\n    }\n\n    return labelVisible ? (\n      <text x={x} y={y + fontHeight} fill={color} fontSize={fontHeight}>\n        {measuredTextWidth > totalWidth\n          ? `${text.slice(0, totalWidth / (fontHeight * 0.6))}...`\n          : text}\n      </text>\n    ) : null\n  },\n)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Feature, Region } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { observer } from 'mobx-react'\n\n// locals\nimport type { DisplayModel } from './util'\nimport FeatureLabel from './FeatureLabel'\n\nfunction FeatureGlyph(props: {\n  feature: Feature\n  rootLayout: SceneGraph\n  config: AnyConfigurationModel\n  name: string\n  description: string\n  shouldShowName: boolean\n  shouldShowDescription: boolean\n  fontHeight: number\n  allowedWidthExpansion: number\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  selected?: boolean\n  reversed?: boolean\n  topLevel?: boolean\n  region: Region\n  viewParams: {\n    end: number\n    start: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  bpPerPx: number\n}) {\n  const {\n    feature,\n    rootLayout,\n    config,\n    name,\n    description,\n    shouldShowName,\n    shouldShowDescription,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  if (!featureLayout) {\n    return null\n  }\n  const { GlyphComponent } = featureLayout.data || {}\n\n  return (\n    <g>\n      <GlyphComponent featureLayout={featureLayout} {...props} />\n      {shouldShowName ? (\n        <FeatureLabel\n          text={name}\n          x={rootLayout.getSubRecord('nameLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('nameLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'nameColor'], { feature })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n      {shouldShowDescription ? (\n        <FeatureLabel\n          text={description}\n          x={rootLayout.getSubRecord('descriptionLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('descriptionLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'descriptionColor'], {\n            feature,\n          })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n    </g>\n  )\n}\n\nexport default observer(FeatureGlyph)\n","import React from 'react'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\n\ntype LayoutRecord = [number, number, number, number]\n\ninterface SvgOverlayProps {\n  region: Region\n  displayModel?: {\n    getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: Feature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown?: boolean\n  onFeatureMouseDown?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseEnter?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOut?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOver?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseUp?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseLeave?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseMove?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureContextMenu?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n}\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\nfunction SvgOverlay({\n  displayModel = {},\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: SvgOverlayProps) {\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n\n  function onFeatureMouseDown(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: React.MouseEvent<SVGRectElement, MouseEvent>) {\n    if (movedDuringLastMouseDown) {\n      return undefined\n    }\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  return (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(SvgOverlay)\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature } from '@jbrowse/core/util'\n\nconst Arrow = ({\n  feature,\n  featureLayout,\n  config,\n  region,\n}: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n}) => {\n  const strand = feature.get('strand')\n  const size = 5\n  const reverseFlip = region.reversed ? -1 : 1\n  const offset = 7 * strand * reverseFlip\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n  const color2 = readConfObject(config, 'color2', { feature })\n  const p =\n    strand * reverseFlip === -1\n      ? left\n      : strand * reverseFlip === 1\n      ? left + width\n      : null\n  const y = top + height / 2\n\n  return p ? (\n    <>\n      <line x1={p} x2={p + offset} y1={y} y2={y} stroke={color2} />\n      <polygon\n        points={[\n          [p + offset / 2, y - size / 2],\n          [p + offset / 2, y + size / 2],\n          [p + offset, y],\n        ].toString()}\n        stroke={color2}\n      />\n    </>\n  ) : null\n}\n\nexport default observer(Arrow)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Region, Feature } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\n\n// locals\nimport { isUTR } from './util'\nimport Arrow from './Arrow'\n\nconst utrHeightFraction = 0.65\nfunction Box(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  bpPerPx: number\n  selected?: boolean\n  topLevel?: boolean\n  children?: React.ReactNode\n}) {\n  const { feature, region, config, featureLayout, bpPerPx, topLevel } = props\n  const { start, end } = region\n  const screenWidth = (end - start) / bpPerPx\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const { left = 0 } = featureLayout.absolute\n  let { top = 0, height = 0 } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(2, Math.min(width - diff, screenWidth))\n\n  // if feature has parent and type is intron, then don't render the intron\n  // subfeature (if it doesn't have a parent, then maybe the introns are\n  // separately displayed features that should be displayed)\n  return feature.parent() && feature.get('type') === 'intron' ? null : (\n    <>\n      {topLevel ? <Arrow {...props} /> : null}\n      <rect\n        data-testid={`box-${feature.id()}`}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n        fill={\n          isUTR(feature)\n            ? readConfObject(config, 'color3', { feature })\n            : readConfObject(config, 'color1', { feature })\n        }\n        stroke={readConfObject(config, 'outline', { feature }) as string}\n      />\n    </>\n  )\n}\n\nexport default observer(Box)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport Arrow from './Arrow'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature } from '@jbrowse/core/util'\n\nfunction Segments(props: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n  selected?: boolean\n  reversed?: boolean\n  subfeatures?: Feature[]\n  children?: React.ReactNode\n}) {\n  const {\n    feature,\n    featureLayout,\n    selected,\n    config,\n    // some subfeatures may be computed e.g. makeUTRs,\n    // so these are passed as a prop, or feature.get('subfeatures') by default\n    subfeatures = feature.get('subfeatures'),\n  } = props\n\n  const color2 = readConfObject(config, 'color2', { feature })\n\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const y = top + height / 2\n  return (\n    <>\n      <line\n        data-testid={feature.id()}\n        x1={left}\n        y1={y}\n        y2={y}\n        x2={left + width}\n        stroke={color2}\n      />\n      {subfeatures?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        // This subfeature got filtered out\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            topLevel={false}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n      <Arrow {...props} />\n    </>\n  )\n}\n\nexport default observer(Segments)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\n\nimport Segments from './Segments'\nimport { ExtraGlyphValidator, layOutFeature, layOutSubfeatures } from './util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature, SimpleFeature } from '@jbrowse/core/util'\n\nfunction ProcessedTranscript(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  selected?: boolean\n  reversed?: boolean\n  [key: string]: unknown\n}) {\n  const { feature, config } = props\n  const subfeatures = getSubparts(feature, config)\n\n  // we manually compute some subfeatures, so pass these separately\n  return <Segments {...props} subfeatures={subfeatures} />\n}\n\n// returns a callback that will filter features features according to the\n// subParts conf var\nfunction makeSubpartsFilter(\n  confKey = 'subParts',\n  config: AnyConfigurationModel,\n) {\n  let filter = readConfObject(config, confKey) as string[] | string\n\n  if (typeof filter == 'string') {\n    // convert to array\n    filter = filter.split(/\\s*,\\s*/)\n  }\n\n  return (feature: Feature) =>\n    (filter as string[])\n      .map(typeName => typeName.toLowerCase())\n      .includes(feature.get('type').toLowerCase())\n}\n\nfunction filterSubpart(feature: Feature, config: AnyConfigurationModel) {\n  return makeSubpartsFilter('subParts', config)(feature)\n}\n\nfunction isUTR(feature: Feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n\nfunction makeUTRs(parent: Feature, subs: Feature[]) {\n  // based on Lincoln's UTR-making code in Bio::Graphics::Glyph::processed_transcript\n  const subparts = [...subs]\n\n  let codeStart = Infinity\n  let codeEnd = -Infinity\n\n  let haveLeftUTR\n  let haveRightUTR\n\n  // gather exons, find coding start and end, and look for UTRs\n  const exons = []\n  for (let i = 0; i < subparts.length; i++) {\n    const type = subparts[i].get('type')\n    if (/^cds/i.test(type)) {\n      if (codeStart > subparts[i].get('start')) {\n        codeStart = subparts[i].get('start')\n      }\n      if (codeEnd < subparts[i].get('end')) {\n        codeEnd = subparts[i].get('end')\n      }\n    } else if (/exon/i.test(type)) {\n      exons.push(subparts[i])\n    } else if (isUTR(subparts[i])) {\n      haveLeftUTR = subparts[i].get('start') === parent.get('start')\n      haveRightUTR = subparts[i].get('end') === parent.get('end')\n    }\n  }\n\n  // bail if we don't have exons and CDS\n  if (!(exons.length && codeStart < Infinity && codeEnd > -Infinity)) {\n    return subparts\n  }\n\n  // make sure the exons are sorted by coord\n  exons.sort((a, b) => a.get('start') - b.get('start'))\n\n  const strand = parent.get('strand')\n\n  // make the left-hand UTRs\n  let start\n  let end\n  if (!haveLeftUTR) {\n    for (let i = 0; i < exons.length; i++) {\n      start = exons[i].get('start')\n      if (start >= codeStart) {\n        break\n      }\n      end = codeStart > exons[i].get('end') ? exons[i].get('end') : codeStart\n      const type = strand >= 0 ? 'five_prime_UTR' : 'three_prime_UTR'\n      subparts.unshift(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  // make the right-hand UTRs\n  if (!haveRightUTR) {\n    for (let i = exons.length - 1; i >= 0; i--) {\n      end = exons[i].get('end')\n      if (end <= codeEnd) {\n        break\n      }\n\n      start = codeEnd < exons[i].get('start') ? exons[i].get('start') : codeEnd\n      const type = strand >= 0 ? 'three_prime_UTR' : 'five_prime_UTR'\n      subparts.push(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  return subparts\n}\n\nfunction getSubparts(f: Feature, config: AnyConfigurationModel) {\n  let c = f.get('subfeatures')\n  if (!c || !c.length) {\n    return []\n  }\n  const hasUTRs = !!c.find(child => isUTR(child))\n  const isTranscript = ['mRNA', 'transcript'].includes(f.get('type'))\n  const impliedUTRs = !hasUTRs && isTranscript\n\n  // if we think we should use impliedUTRs, or it is specifically in the\n  // config, then makeUTRs\n  if (impliedUTRs || readConfObject(config, 'impliedUTRs')) {\n    c = makeUTRs(f, c)\n  }\n\n  return c.filter(element => filterSubpart(element, config))\n}\n\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const subfeatures = getSubparts(feature, config)\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  return subLayout\n}\n\nexport default observer(ProcessedTranscript)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport {\n  chooseGlyphComponent,\n  ExtraGlyphValidator,\n  layOut,\n  layOutFeature,\n} from './util'\n\nfunction Subfeatures(props: {\n  feature: Feature\n  featureLayout: SceneGraph\n  selected?: boolean\n}) {\n  const { feature, featureLayout, selected } = props\n\n  return (\n    <>\n      {feature.get('subfeatures')?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nSubfeatures.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    let topOffset = 0\n    feature.get('subfeatures')?.forEach(subfeature => {\n      const SubfeatureGlyphComponent = chooseGlyphComponent(\n        subfeature,\n        extraGlyphs,\n      )\n      const subfeatureHeight = readConfObject(config, 'height', {\n        feature: subfeature,\n      }) as number\n\n      const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n        layout: subLayout,\n        feature: subfeature,\n        bpPerPx,\n        reversed,\n        config,\n        extraGlyphs,\n      })\n      subSubLayout.move(0, topOffset)\n      topOffset +=\n        displayMode === 'collapse'\n          ? 0\n          : (displayMode === 'compact'\n              ? subfeatureHeight / 3\n              : subfeatureHeight) + 2\n    })\n  }\n  return subLayout\n}\n\nexport default observer(Subfeatures)\n","import React from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Box from './Box'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\nimport { Region } from '@jbrowse/core/util'\n\nexport interface Glyph\n  extends React.FC<{\n    children: React.ReactNode\n    feature: Feature\n    featureLayout: SceneGraph\n    selected?: boolean\n    config: AnyConfigurationModel\n    region: Region\n    bpPerPx: number\n    topLevel?: boolean\n    [key: string]: unknown\n  }> {\n  layOut?: Function\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface DisplayModel {\n  getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n  getFeatureOverlapping?: (\n    blockKey: string,\n    bp: number,\n    y: number,\n  ) => string | undefined\n  selectedFeatureId?: string\n  featureIdUnderMouse?: string\n  contextMenuFeature?: Feature\n}\n\nexport interface ExtraGlyphValidator {\n  glyph: Glyph\n  validator: (feature: Feature) => boolean\n}\n\nexport function chooseGlyphComponent(\n  feature: Feature,\n  extraGlyphs?: ExtraGlyphValidator[],\n): Glyph {\n  const type = feature.get('type')\n  const subfeatures = feature.get('subfeatures')\n\n  if (subfeatures && type !== 'CDS') {\n    const hasSubSub = subfeatures.find(sub => !!sub.get('subfeatures'))\n    if (\n      ['mRNA', 'transcript', 'primary_transcript'].includes(type) &&\n      subfeatures.find(f => f.get('type') === 'CDS')\n    ) {\n      return ProcessedTranscript\n    } else if (!feature.parent() && hasSubSub) {\n      // only do sub-sub on parent level features like gene\n      return Subfeatures\n    } else {\n      return Segments\n    }\n  }\n\n  return extraGlyphs?.find(f => f.validator(feature))?.glyph || Box\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs): SceneGraph {\n  const { layout, feature, bpPerPx, reversed, config, extraGlyphs } = args\n  const displayMode = readConfObject(config, 'displayMode') as string\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Box\n      : chooseGlyphComponent(feature, extraGlyphs)\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature) {\n    x =\n      (reversed\n        ? parentFeature.get('end') - feature.get('end')\n        : feature.get('start') - parentFeature.get('start')) / bpPerPx\n  }\n  const height = readConfObject(config, 'height', { feature }) as number\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  const subLayout = layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    Math.max(width, 1), // has to be at least one to register in the layout\n    displayMode === 'compact' ? height / 2 : height,\n    { GlyphComponent },\n  )\n  return subLayout\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs): void {\n  const { layout, subfeatures, bpPerPx, reversed, config, extraGlyphs } = args\n  subfeatures.forEach(feature => {\n    ;(chooseGlyphComponent(feature, extraGlyphs).layOut || layOut)({\n      layout,\n      feature,\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  })\n}\n\nexport function isUTR(feature: Feature): boolean {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n","import React, { useEffect, useRef, useState, useCallback } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { bpToPx, measureText, Region, Feature } from '@jbrowse/core/util'\nimport { BaseLayout, SceneGraph } from '@jbrowse/core/util/layouts'\n\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport {\n  chooseGlyphComponent,\n  layOut,\n  ExtraGlyphValidator,\n  DisplayModel,\n} from './util'\n\n// used to make features have a little padding for their labels\nconst namePadding = 2\nconst textPadding = 2\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst svgHeightPadding = 100\n\nfunction RenderedFeatureGlyph(props: {\n  feature: Feature\n  bpPerPx: number\n  region: Region\n  config: AnyConfigurationModel\n  layout: BaseLayout<unknown>\n  extraGlyphs?: ExtraGlyphValidator[]\n  displayMode: string\n  exportSVG?: unknown\n  displayModel?: DisplayModel\n  detectRerender?: () => void\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  [key: string]: unknown\n}) {\n  const {\n    feature,\n    detectRerender,\n    bpPerPx,\n    region,\n    config,\n    displayMode,\n    layout,\n    extraGlyphs,\n  } = props\n\n  // used for unit testing, difficult to mock out so it is in actual source code\n  detectRerender?.()\n\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelsAllowed = displayMode !== 'compact' && displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent(feature, extraGlyphs)\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  let shouldShowName = false\n  let shouldShowDescription = false\n  let name = ''\n  let description = ''\n  let fontHeight = 0\n  let expansion = 0\n  if (labelsAllowed) {\n    const showLabels = readConfObject(config, 'showLabels')\n    const showDescriptions = readConfObject(config, 'showDescriptions')\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], { feature })\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = String(readConfObject(config, ['labels', 'name'], { feature }) || '')\n    shouldShowName = /\\S/.test(name) && showLabels\n\n    const getWidth = (text: string) => {\n      const glyphWidth = rootLayout.width + expansion\n      const textWidth = measureText(text, fontHeight)\n      return Math.round(Math.min(textWidth, glyphWidth)) + namePadding\n    }\n\n    description = String(\n      readConfObject(config, ['labels', 'description'], { feature }) || '',\n    )\n    shouldShowDescription =\n      /\\S/.test(description) && showLabels && showDescriptions\n\n    if (shouldShowName) {\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom + textPadding,\n        getWidth(name),\n        fontHeight,\n      )\n    }\n\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom + textPadding,\n        getWidth(description),\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx,\n    rootLayout.height,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      rootLayout={rootLayout}\n      name={name}\n      shouldShowName={shouldShowName}\n      description={description}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      topLevel={true}\n      {...props}\n    />\n  )\n}\n\nconst RenderedFeatures = observer(\n  (props: {\n    features?: Map<string, Feature>\n    isFeatureDisplayed?: (f: Feature) => boolean\n    bpPerPx: number\n    config: AnyConfigurationModel\n    displayMode: string\n    displayModel?: DisplayModel\n    region: Region\n    exportSVG?: unknown\n    extraGlyphs?: ExtraGlyphValidator[]\n    layout: BaseLayout<unknown>\n    viewParams: {\n      start: number\n      end: number\n      offsetPx: number\n      offsetPx1: number\n    }\n    [key: string]: unknown\n  }) => {\n    const { features = new Map(), isFeatureDisplayed } = props\n    return (\n      <>\n        {[...features.values()]\n          .filter(feature =>\n            isFeatureDisplayed ? isFeatureDisplayed(feature) : true,\n          )\n          .map(feature => (\n            <RenderedFeatureGlyph\n              key={feature.id()}\n              feature={feature}\n              {...props}\n            />\n          ))}\n      </>\n    )\n  },\n)\n\nfunction SvgFeatureRendering(props: {\n  layout: BaseLayout<unknown>\n  blockKey: string\n  regions: Region[]\n  bpPerPx: number\n  detectRerender?: () => void\n  config: AnyConfigurationModel\n  features: Map<string, Feature>\n  displayModel?: DisplayModel\n  exportSVG?: boolean\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  featureDisplayHandler?: (f: Feature) => boolean\n  extraGlyphs?: ExtraGlyphValidator[]\n  onMouseOut?: React.MouseEventHandler\n  onMouseDown?: React.MouseEventHandler\n  onMouseLeave?: React.MouseEventHandler\n  onMouseEnter?: React.MouseEventHandler\n  onMouseOver?: React.MouseEventHandler\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n  onMouseUp?: React.MouseEventHandler\n  onClick?: React.MouseEventHandler\n}) {\n  const {\n    layout,\n    blockKey,\n    regions,\n    bpPerPx,\n    config,\n    displayModel = {},\n    exportSVG,\n    featureDisplayHandler,\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n  } = props\n\n  const [region] = regions || []\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode') as string\n\n  const ref = useRef<SVGSVGElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [height, setHeight] = useState(0)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n\n  const mouseDown = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      return onMouseDown?.(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    (event: React.MouseEvent) => {\n      setMouseIsDown(false)\n      return onMouseUp?.(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseMove = useCallback(\n    (event: React.MouseEvent) => {\n      if (!ref.current) {\n        return\n      }\n      if (mouseIsDown) {\n        setMovedDuringLastMouseDown(true)\n      }\n      const { left, top } = ref.current.getBoundingClientRect()\n      const offsetX = event.clientX - left\n      const offsetY = event.clientY - top\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const featureIdCurrentlyUnderMouse = displayModel.getFeatureOverlapping?.(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    (event: React.MouseEvent) => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      onClick?.(event)\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  if (exportSVG) {\n    return (\n      <RenderedFeatures\n        displayMode={displayMode}\n        isFeatureDisplayed={featureDisplayHandler}\n        region={region}\n        {...props}\n      />\n    )\n  }\n  return (\n    <svg\n      ref={ref}\n      data-testid=\"svgfeatures\"\n      width={width}\n      height={height + svgHeightPadding}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onMouseMove={mouseMove}\n      onClick={click}\n    >\n      <RenderedFeatures\n        displayMode={displayMode}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n        isFeatureDisplayed={featureDisplayHandler}\n        {...props}\n      />\n\n      <SvgOverlay\n        {...props}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n      />\n    </svg>\n  )\n}\n\nexport default observer(SvgFeatureRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config SvgFeatureRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst SvgFeatureRenderer = ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    /**\n     * #slot\n     */\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      contextVariable: ['feature'],\n    },\n\n    /**\n     * #slot\n     */\n    outline: {\n      type: 'color',\n      description: 'the outline for features',\n      defaultValue: '',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    showLabels: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n\n    /**\n     * #slot\n     */\n    showDescriptions: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      /**\n       * #slot labels.name\n       */\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue: `jexl:get(feature,'name') || get(feature,'id')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.nameColor\n       */\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: 'black',\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.description\n       */\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue: `jexl:get(feature,'note') || get(feature,'description')`,\n        contextVariable: ['feature'],\n      },\n      /**\n       * #slot labels.descriptionColor\n       */\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        contextVariable: ['feature'],\n      },\n\n      /**\n       * #slot labels.fontSize\n       */\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 13,\n        contextVariable: ['feature'],\n      },\n    }),\n\n    /**\n     * #slot\n     */\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n\n    /**\n     * #slot\n     */\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n\n    /**\n     * #slot\n     */\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 600,\n    },\n\n    /**\n     * #slot\n     */\n    subParts: {\n      type: 'string',\n      description: 'subparts for a glyph',\n      defaultValue: 'CDS,UTR,five_prime_UTR,three_prime_UTR',\n    },\n\n    /**\n     * #slot\n     */\n    impliedUTRs: {\n      type: 'boolean',\n      description: 'imply UTR from the exon and CDS differences',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default SvgFeatureRenderer\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n\nclass SvgFeatureRenderer extends BoxRendererType {\n  supportsSVG = true\n}\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new SvgFeatureRenderer({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n\nexport { svgFeatureRendererConfigSchema, SvgFeatureRendererReactComponent }\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TheTrackHubRegistryConnection\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'TheTrackHubRegistryConnection',\n  {\n    /**\n     * #slot\n     */\n    trackDbId: {\n      type: 'string',\n      defaultValue: '',\n      description: 'id of the trackDb in The Track Hub Registry',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseConnectionConfig,\n  },\n)\n","import { objectHash } from '@jbrowse/core/util'\nimport { generateUnsupportedTrackConf } from '@jbrowse/core/util/tracks'\n\nexport function generateTracks(trackDb, assemblyName, sequenceAdapter) {\n  // eslint-disable-next-line no-underscore-dangle\n  const { configuration } = trackDb._source\n  const subTracks = getSubtracks({ members: configuration })\n  return subTracks.map(subTrack => {\n    const ret = makeTrackConfig(\n      subTrack,\n      // eslint-disable-next-line no-underscore-dangle\n      trackDb._source.hub.url,\n      sequenceAdapter,\n    )\n    ret.trackId = `trackhub-registry-${objectHash(ret)}`\n    ret.assemblyNames = [assemblyName]\n    return ret\n  })\n\n  function getSubtracks(track, trackPath = []) {\n    if (track.members) {\n      return Object.values(track.members)\n        .map(subTrack =>\n          getSubtracks(\n            subTrack,\n            track.shortLabel ? trackPath.concat([track.shortLabel]) : trackPath,\n          ),\n        )\n        .flat()\n    }\n    track.categories = trackPath\n    return [track]\n  }\n}\n\nfunction makeTrackConfig(track, trackDbUrl, sequenceAdapter) {\n  const trackType = track.type\n  let baseTrackType = trackType.split(' ')[0].toLowerCase()\n  if (\n    baseTrackType === 'bam' &&\n    track.bigDataUrl.toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  const { bigDataUrl } = track\n  const bigDataLocation = {\n    uri: new URL(bigDataUrl, trackDbUrl).href,\n    locationType: 'UriLocation',\n  }\n  const { categories } = track\n  let bigDataIndexLocation\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex, locationType: 'LocalPathLocation' }\n          : {\n              localPath: `${track.bigDataUrl}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bed5floatscore':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedgraph':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedrnaelements':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbarchart':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbed':\n      return {\n        type: 'FeatureTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigchain':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'biginteract':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigpsl':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigwig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'coloredexon':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex, locationType: 'LocalPathLocation' }\n          : {\n              localPath: `${track.bigDataUrl}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          bamLocation: bigDataLocation,\n          index: { location: bigDataIndexLocation },\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'narrowpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'peptidemapping':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'vcftabix':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    default:\n      throw new Error(`Unsupported track type: ${baseTrackType}`)\n  }\n}\n","import {\n  AnyConfigurationModel,\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession } from '@jbrowse/core/util'\nimport { types, Instance } from 'mobx-state-tree'\n\n// locals\nimport configSchema from './configSchema'\nimport { generateTracks } from './tracks'\nimport { mfetch } from './util'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'TheTrackHubRegistryConnection',\n      BaseConnectionModelFactory(pluginManager),\n      types.model({\n        type: types.literal('TheTrackHubRegistryConnection'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .volatile(() => ({\n      error: undefined as unknown,\n    }))\n    .actions(self => ({\n      async connect(connectionConf: AnyConfigurationModel) {\n        // @ts-ignore\n        self.clear()\n        const trackDbId = readConfObject(connectionConf, 'trackDbId')\n        try {\n          const trackDb = await mfetch(\n            `https://www.trackhubregistry.org/api/search/trackdb/${trackDbId}`,\n          )\n          // eslint-disable-next-line no-underscore-dangle\n          const assemblyName = trackDb._source.assembly.name\n          const session = getSession(self)\n          const assembly = session.assemblyManager.get(assemblyName)\n          if (!assembly) {\n            throw new Error(`unknown assembly ${assemblyName}`)\n          }\n          const sequenceAdapter = getConf(assembly, ['sequence', 'adapter'])\n          self.setTrackConfs(\n            generateTracks(trackDb, assemblyName, sequenceAdapter),\n          )\n        } catch (e) {\n          console.error(e)\n          this.setError(e)\n        }\n      },\n      setError(e: unknown) {\n        self.error = e\n      },\n    }))\n}\n\nexport type TrackHubConnectionStateModel = ReturnType<typeof stateModelFactory>\nexport type TrackHubConnectionModel = Instance<TrackHubConnectionStateModel>\n","import { lazy } from 'react'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema, modelFactory } from './trackhub-registry'\n\nexport default class TrackHubRegistryPlugin extends Plugin {\n  name = 'TrackHubRegistryPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'TheTrackHubRegistryConnection',\n          configSchema,\n          configEditorComponent: lazy(\n            () => import('./trackhub-registry/TrackHubRegistrySelect'),\n          ),\n          stateModel: modelFactory(pluginManager),\n          displayName: 'The Track Hub Registry',\n          description: 'A hub from The Track Hub Registry',\n          url: '//trackhubregistry.org/',\n        }),\n    )\n  }\n}\n","export async function mfetch(url: string, request?: RequestInit) {\n  const response = await fetch(url, request)\n  if (!response.ok) {\n    throw new Error(\n      `HTTP \n          ${response.status}: ${await response.text()} from\n          ${url}`,\n    )\n  }\n  return response.json()\n}\n\nexport async function post_with_params(\n  url: string,\n  params = {} as Record<string, unknown>,\n  options = {} as RequestInit,\n) {\n  const urlParams = Object.keys(params)\n    .map(param => `${param}=${params[param]}`)\n    .join(';')\n  return mfetch(`${url}${urlParams ? `?${urlParams}` : ''}`, {\n    ...options,\n    method: 'POST',\n  })\n}\n","import Trix from '@gmod/trix'\nimport {\n  BaseTextSearchAdapter,\n  BaseArgs,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nfunction decodeURIComponentNoThrow(uri: string) {\n  try {\n    return decodeURIComponent(uri)\n  } catch (e) {\n    // avoid throwing exception on a failure to decode URI component\n    return uri\n  }\n}\n\nfunction shorten(str: string, term: string, w = 15) {\n  const tidx = str.toLowerCase().indexOf(term)\n\n  return str.length < 40\n    ? str\n    : (Math.max(0, tidx - w) > 0 ? '...' : '') +\n        str.slice(Math.max(0, tidx - w), tidx + term.length + w).trim() +\n        (tidx + term.length < str.length ? '...' : '')\n}\n\nexport default class TrixTextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  indexingAttributes?: string[]\n  trixJs: Trix\n  tracksNames?: string[]\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const ixFilePath = readConfObject(config, 'ixFilePath')\n    const ixxFilePath = readConfObject(config, 'ixxFilePath')\n\n    if (!ixFilePath) {\n      throw new Error('must provide out.ix')\n    }\n    if (!ixxFilePath) {\n      throw new Error('must provide out.ixx')\n    }\n    this.trixJs = new Trix(\n      openLocation(ixxFilePath),\n      openLocation(ixFilePath),\n      1500,\n    )\n  }\n\n  /**\n   * Returns list of results\n   * @param args - search options/arguments include: search query\n   * limit of results to return, searchType...prefix | full | exact\", etc.\n   */\n  async searchIndex(args: BaseArgs) {\n    const query = args.queryString.toLowerCase()\n    const strs = query.split(' ')\n    const results = await this.trixJs.search(query)\n    const formatted = results\n      // if multi-word search try to filter out relevant items\n      .filter(([, data]) =>\n        strs.every(r =>\n          decodeURIComponentNoThrow(data).toLowerCase().includes(r),\n        ),\n      )\n      .map(([term, data]) => {\n        const result = JSON.parse(data.replace(/\\|/g, ',')) as string[]\n        const [loc, trackId, ...rest] = result.map(record =>\n          decodeURIComponentNoThrow(record),\n        )\n\n        const labelFieldIdx = rest.findIndex(elt => !!elt)\n        const contextIdx = rest\n          .map(elt => elt.toLowerCase())\n          .findIndex(f => f.indexOf(term.toLowerCase()) !== -1)\n\n        const labelField = rest[labelFieldIdx]\n        const contextField = rest[contextIdx]\n        const context =\n          contextIdx !== -1 ? shorten(contextField, term) : undefined\n        const label = shorten(labelField, term)\n\n        const displayString =\n          !context || label.toLowerCase() === context.toLowerCase()\n            ? label\n            : `${label} (${context})`\n\n        return new BaseResult({\n          locString: loc,\n          label: labelField,\n          displayString,\n          matchedObject: result.map(record => decodeURIComponent(record)),\n          trackId,\n        })\n      })\n\n    if (args.searchType === 'exact') {\n      return formatted.filter(\n        res => res.getLabel().toLowerCase() === args.queryString.toLowerCase(),\n      )\n    }\n    return formatted\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config TrixTextSearchAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst TrixTextSearchAdapter = ConfigurationSchema(\n  'TrixTextSearchAdapter',\n  {\n    /**\n     * #slot\n     */\n    ixFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ix', locationType: 'UriLocation' },\n      description: 'the location of the trix ix file',\n    },\n    /**\n     * #slot\n     */\n    ixxFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ixx', locationType: 'UriLocation' },\n      description: 'the location of the trix ixx file',\n    },\n    /**\n     * #slot\n     */\n    metaFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'meta.json', locationType: 'UriLocation' },\n      description: 'the location of the metadata json file for the trix index',\n    },\n    /**\n     * #slot\n     */\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    /**\n     * #slot\n     */\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  {\n    explicitlyTyped: true,\n    /**\n     * #identifier\n     */\n    explicitIdentifier: 'textSearchAdapterId',\n  },\n)\n\nexport default TrixTextSearchAdapter\n","import TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as TrixTextSearchAdapterClass,\n  configSchema as trixAdapterConfigSchema,\n} from './TrixTextSearchAdapter'\n\nexport default class extends Plugin {\n  name = 'TrixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTextSearchAdapterType(\n      () =>\n        new TextSearchAdapterType({\n          name: 'TrixTextSearchAdapter',\n          configSchema: trixAdapterConfigSchema,\n          AdapterClass: TrixTextSearchAdapterClass,\n          description: 'Trix adapter',\n        }),\n    )\n  }\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { parseBreakend } from '@gmod/vcf'\n\n/* eslint-disable no-underscore-dangle */\n\n/**\n * VCF Feature creation with lazy genotype evaluation.\n */\ninterface Samples {\n  [key: string]: {\n    [key: string]: { values: string[] | number[] | null }\n  }\n}\n\ninterface FeatureData {\n  [key: string]: unknown\n  refName: string\n  start: number\n  end: number\n  description?: string\n  type?: string\n  name?: string\n  aliases?: string[]\n  samples?: Samples\n}\n\nexport default class VCFFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private variant: any\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private parser: any\n\n  private data: FeatureData\n\n  private _id: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(args: { variant: any; parser: any; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = this.dataFromVariant(this.variant)\n    this._id = args.id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    return field === 'samples'\n      ? this.variant.SAMPLES\n      : this.data[field] || this.variant[field]\n  }\n\n  set(): void {}\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  tags(): string[] {\n    const t = [\n      ...Object.keys(this.data),\n      ...Object.keys(this.variant),\n      'samples',\n    ]\n    return t\n  }\n\n  id(): string {\n    return this._id\n  }\n\n  dataFromVariant(variant: {\n    REF: string\n    POS: number\n    ALT: string[]\n    CHROM: string\n    INFO: any // eslint-disable-line @typescript-eslint/no-explicit-any\n    ID: string[]\n  }): FeatureData {\n    const { REF, ALT, POS, CHROM, INFO, ID } = variant\n    const start = POS - 1\n    const [SO_term, description] = this._getSOTermAndDescription(REF, ALT)\n    const isTRA = ALT?.some(f => f === '<TRA>')\n    const isSymbolic = ALT?.some(f => f.indexOf('<') !== -1)\n\n    return {\n      refName: CHROM,\n      start,\n      end: isSymbolic && INFO.END && !isTRA ? +INFO.END[0] : start + REF.length,\n      description,\n      type: SO_term,\n      name: ID?.join(','),\n      aliases: ID && ID.length > 1 ? variant.ID.slice(1) : undefined,\n    }\n  }\n\n  /**\n   * Get a sequence ontology (SO) term that describes the variant type\n   */\n  _getSOTermAndDescription(\n    ref: string,\n    alt: string[],\n  ): [string, string] | [undefined, undefined] {\n    // it's just a remark if there are no alternate alleles\n    if (!alt || alt.length === 0) {\n      return ['remark', 'no alternative alleles']\n    }\n\n    const soTerms = new Set<string>()\n    let descriptions = new Set<string>()\n    alt.forEach(a => {\n      let [soTerm, description] = this._getSOAndDescFromAltDefs(ref, a)\n\n      if (!soTerm) {\n        ;[soTerm, description] = this._getSOAndDescByExamination(ref, a)\n      }\n      if (soTerm && description) {\n        soTerms.add(soTerm)\n        descriptions.add(description)\n      }\n    })\n\n    // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n    if (descriptions.size > 1) {\n      const prefixes = new Set(\n        [...descriptions].map(desc => {\n          const prefix = desc.split('->')\n          return prefix[1] ? prefix[0] : desc\n        }),\n      )\n\n      const new_descs = [...prefixes].map(prefix => {\n        const suffixes = [...descriptions]\n          .map(desc => {\n            const pref = desc.split('-> ')\n            return pref[1] && pref[0] === prefix ? pref[1] : ''\n          })\n          .filter(f => !!f)\n\n        return suffixes.length\n          ? prefix + '-> ' + suffixes.join(',')\n          : [...descriptions].join(',')\n      })\n\n      descriptions = new Set(new_descs)\n    }\n    if (soTerms.size) {\n      return [[...soTerms].join(','), [...descriptions].join(',')]\n    }\n    return [undefined, undefined]\n  }\n\n  static _altTypeToSO: { [key: string]: string | undefined } = {\n    DEL: 'deletion',\n    INS: 'insertion',\n    DUP: 'duplication',\n    INV: 'inversion',\n    INVDUP: 'inverted duplication',\n    CNV: 'copy_number_variation',\n    TRA: 'translocation',\n    'DUP:TANDEM': 'tandem_duplication',\n    NON_REF: 'sequence_variant',\n    '*': 'sequence_variant',\n  }\n\n  _getSOAndDescFromAltDefs(\n    ref: string,\n    alt: string,\n  ): [string, string] | [undefined, undefined] {\n    if (typeof alt === 'string' && !alt.startsWith('<')) {\n      return [undefined, undefined]\n    }\n\n    // look for a definition with an SO type for this\n    let soTerm = VCFFeature._altTypeToSO[alt]\n    // if no SO term but ALT is in metadata, assume sequence_variant\n    if (!soTerm && this.parser.getMetadata('ALT', alt)) {\n      soTerm = 'sequence_variant'\n    }\n    if (soTerm) {\n      return [soTerm, alt]\n    }\n\n    // try to look for a definition for a parent term if we can\n    const modAlt = alt.split(':')\n    if (modAlt.length > 1) {\n      return this._getSOAndDescFromAltDefs(\n        ref,\n        `<${modAlt.slice(0, modAlt.length - 1).join(':')}>`,\n      )\n    }\n\n    // no parent\n    return [undefined, undefined]\n  }\n\n  // note: term SNV is used instead of SNP because SO definition of SNP says\n  // abundance must be at least 1% in population, and can't be sure we meet\n  // that\n  _getSOAndDescByExamination(ref: string, alt: string): [string, string] {\n    const bnd = parseBreakend(alt)\n    if (bnd) {\n      return ['breakend', alt]\n    } else if (ref.length === 1 && alt.length === 1) {\n      return ['SNV', this._makeDescriptionString('SNV', ref, alt)]\n    } else if (alt === '<INS>') {\n      return ['insertion', alt]\n    } else if (alt === '<DEL>') {\n      return ['deletion', alt]\n    } else if (alt === '<INV>') {\n      return ['deletion', alt]\n    } else if (alt === '<TRA>') {\n      return ['translocation', alt]\n    } else if (alt.includes('<')) {\n      return ['sv', alt]\n    } else if (ref.length === alt.length) {\n      if (ref.split('').reverse().join('') === alt) {\n        return ['inversion', this._makeDescriptionString('inversion', ref, alt)]\n      }\n      return [\n        'substitution',\n        this._makeDescriptionString('substitution', ref, alt),\n      ]\n    } else if (ref.length <= alt.length) {\n      return ['insertion', this._makeDescriptionString('insertion', ref, alt)]\n    } else if (ref.length > alt.length) {\n      return ['deletion', this._makeDescriptionString('deletion', ref, alt)]\n    }\n\n    return ['indel', this._makeDescriptionString('indel', ref, alt)]\n  }\n\n  _makeDescriptionString(soTerm: string, ref: string, alt: string): string {\n    return `${soTerm} ${ref} -> ${alt}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON(): any {\n    return {\n      uniqueId: this._id,\n      ...this.variant,\n      ...this.data,\n      samples: this.variant.SAMPLES,\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config VcfAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfAdapter = ConfigurationSchema(\n  'VcfAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default VcfAdapter\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config VcfTabixAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst VcfTabixAdapter = ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    /**\n     * #slot\n     */\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf.gz', locationType: 'UriLocation' },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      /**\n       * #slot index.indexType\n       */\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      /**\n       * #slot index.location\n       */\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.vcf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n\nexport default VcfTabixAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config VariantTrack\n * Mostly similar to feature track, but has `ChordDisplayType` registered to it,\n * and custom feature details in `LinearVariantDisplay`\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) =>\n  ConfigurationSchema(\n    'VariantTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseChordDisplayConfig } from '@jbrowse/plugin-circular-view'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config ChordVariantDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction stateModelFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      /**\n       * #slot\n       */\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseChordDisplayConfig,\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport default stateModelFactory\n","import { BaseChordDisplayModel } from '@jbrowse/plugin-circular-view'\nimport {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\n\n/**\n * #stateModel ChordVariantDisplay\n * extends `BaseChordDisplay`\n */\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) => {\n  return types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('ChordVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n\n      /**\n       * #method\n       */\n      renderProps(): Record<string, unknown> {\n        const view = getContainingView(self)\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n\n          // @ts-ignore\n          blockDefinitions: this.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: self.onChordClick,\n        }\n      },\n    }))\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n//\nexport default stateModelFactory\n","import { getConf, ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getContainingTrack,\n  getSession,\n  getContainingView,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\n\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { linearBasicDisplayModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport { LinearVariantDisplayConfigModel } from './configSchema'\n\n/**\n * #stateModel LinearVariantDisplay\n * extends `LinearBasicDisplay`\n * very similar to basic display, but provides custom widget on feature click\n */\nexport default function stateModelFactory(\n  configSchema: LinearVariantDisplayConfigModel,\n) {\n  return types\n    .compose(\n      'LinearVariantDisplay',\n      linearBasicDisplayModelFactory(configSchema),\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearVariantDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .actions(self => ({\n      /**\n       * #action\n       */\n      async selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const view = getContainingView(self)\n          const adapterConfig = getConf(track, 'adapter')\n          const descriptions = await rpcManager.call(\n            sessionId,\n            'CoreGetMetadata',\n            {\n              adapterConfig,\n            },\n          )\n          session.showWidget(\n            session.addWidget('VariantFeatureWidget', 'variantFeature', {\n              featureData: feature.toJSON(),\n              view,\n              track,\n              descriptions,\n            }),\n          )\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport stateModelFactory from './model'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new DisplayType({\n      name: 'LinearVariantDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'VariantTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\n/**\n * #config LinearVariantDisplay\n * mostly empty, this display type is very much\n * like a `FeatureTrack` with a `LinearBasicDisplay` except it has a custom\n * feature details widget\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function configSchemaF(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<typeof configSchemaF>\nexport type LinearVariantDisplayConfig =\n  Instance<LinearVariantDisplayConfigModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config StructuralVariantChordRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'StructuralVariantChordRenderer',\n  {\n    /**\n     * #slot\n     */\n    strokeColor: {\n      type: 'color',\n      description: 'the line color of each arc',\n      defaultValue: 'rgba(255,133,0,0.32)',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorSelected: {\n      type: 'color',\n      description: 'the line color of an arc that has been selected',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot\n     */\n    strokeColorHover: {\n      type: 'color',\n      description:\n        'the line color of an arc that is being hovered over with the mouse',\n      defaultValue: '#555',\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default configSchema\n","import React, { useMemo } from 'react'\nimport { observer } from 'mobx-react'\nimport { polarToCartesian, Feature } from '@jbrowse/core/util'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { parseBreakend } from '@gmod/vcf'\n\ninterface Region {\n  end: number\n  start: number\n  refName: string\n  elided?: false\n}\n\ninterface ElidedRegion {\n  elided: true\n  regions: Region[]\n}\n\ntype AnyRegion = Region | ElidedRegion\n\ninterface Block {\n  flipped: boolean\n  bpPerRadian: number\n  startRadians: number\n  region: AnyRegion\n}\n\nfunction bpToRadians(block: Block, pos: number) {\n  const blockStart = block.region.elided ? 0 : block.region.start\n  const blockEnd = block.region.elided ? 0 : block.region.end\n  const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n  return bpOffset / block.bpPerRadian + block.startRadians\n}\n\nconst Chord = observer(function Chord({\n  feature,\n  blocksForRefs,\n  radius,\n  config,\n  bezierRadius,\n  selected,\n  onClick,\n}: {\n  feature: Feature\n  blocksForRefs: { [key: string]: Block }\n  radius: number\n  config: AnyConfigurationModel\n  bezierRadius: number\n  selected: boolean\n  onClick: (\n    feature: Feature,\n    reg: AnyRegion,\n    endBlock: AnyRegion,\n    evt: unknown,\n  ) => void\n}) {\n  // find the blocks that our start and end points belong to\n  const startBlock = blocksForRefs[feature.get('refName')]\n  if (!startBlock) {\n    return null\n  }\n  let svType\n  if (feature.get('INFO')) {\n    ;[svType] = feature.get('INFO').SVTYPE || []\n  } else if (feature.get('mate')) {\n    svType = 'mate'\n  }\n  let endPosition\n  let endBlock: Block | undefined\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt && parseBreakend(alt)\n  if (bnd) {\n    // VCF BND\n    const matePosition = bnd.MatePosition.split(':')\n    endPosition = +matePosition[1]\n    endBlock = blocksForRefs[matePosition[0]]\n  } else if (alt === '<TRA>') {\n    // VCF TRA\n    const chr2 = feature.get('INFO')?.CHR2?.[0]\n    const end = feature.get('INFO')?.END?.[0]\n    endPosition = parseInt(end, 10)\n    endBlock = blocksForRefs[chr2]\n  } else if (svType === 'mate') {\n    // generic simplefeatures arcs\n    const mate = feature.get('mate')\n    const chr2 = mate.refName\n    endPosition = mate.start\n    endBlock = blocksForRefs[chr2]\n  }\n\n  if (endBlock) {\n    const startPos = feature.get('start')\n    const startRadians = bpToRadians(startBlock, startPos)\n    const endRadians = bpToRadians(endBlock, endPosition)\n    const startXY = polarToCartesian(radius, startRadians)\n    const endXY = polarToCartesian(radius, endRadians)\n    const controlXY = polarToCartesian(\n      bezierRadius,\n      (endRadians + startRadians) / 2,\n    )\n\n    const strokeColor = selected\n      ? readConfObject(config, 'strokeColorSelected', { feature })\n      : readConfObject(config, 'strokeColor', { feature })\n\n    const hoverStrokeColor = readConfObject(config, 'strokeColorHover', {\n      feature,\n    })\n    return (\n      <path\n        data-testid={`chord-${feature.id()}`}\n        d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n        style={{ stroke: strokeColor }}\n        onClick={evt => {\n          if (endBlock && startBlock) {\n            onClick(feature, startBlock.region, endBlock.region, evt)\n          }\n        }}\n        onMouseOver={evt => {\n          if (!selected) {\n            // @ts-ignore\n            evt.target.style.stroke = hoverStrokeColor\n            // @ts-ignore\n            evt.target.style.strokeWidth = 3\n          }\n        }}\n        onMouseOut={evt => {\n          if (!selected) {\n            // @ts-ignore\n            evt.target.style.stroke = strokeColor\n            // @ts-ignore\n            evt.target.style.strokeWidth = 1\n          }\n        }}\n      />\n    )\n  }\n\n  return null\n})\n\nfunction StructuralVariantChords(props: {\n  features: Map<string, Feature>\n  radius: number\n  config: AnyConfigurationModel\n  displayModel: { id: string; selectedFeatureId: string }\n  blockDefinitions: Block[]\n  bezierRadius: number\n  onChordClick: (\n    feature: Feature,\n    reg: AnyRegion,\n    endBlock: AnyRegion,\n    evt: unknown,\n  ) => void\n}) {\n  const {\n    features,\n    config,\n    displayModel,\n    blockDefinitions,\n    radius,\n    bezierRadius,\n    displayModel: { selectedFeatureId },\n    onChordClick,\n  } = props\n  // make a map of refName -> blockDefinition\n  const blocksForRefsMemo = useMemo(() => {\n    const blocksForRefs = {} as { [key: string]: Block }\n    blockDefinitions.forEach(block => {\n      const regions = block.region.elided\n        ? block.region.regions\n        : [block.region]\n      regions.forEach(region => {\n        blocksForRefs[region.refName] = block\n      })\n    })\n    return blocksForRefs\n  }, [blockDefinitions])\n  // console.log(blocksForRefs)\n  const chords = []\n  for (const [id, feature] of features) {\n    const selected = String(selectedFeatureId) === String(feature.id())\n    chords.push(\n      <Chord\n        key={id}\n        feature={feature}\n        config={config}\n        radius={radius}\n        bezierRadius={bezierRadius}\n        blocksForRefs={blocksForRefsMemo}\n        selected={selected}\n        onClick={onChordClick}\n      />,\n    )\n  }\n  const trackStyleId = `chords-${displayModel.id}`\n  return (\n    <g id={trackStyleId} data-testid=\"structuralVariantChordRenderer\">\n      <style\n        // eslint-disable-next-line react/no-danger\n        dangerouslySetInnerHTML={{\n          __html: `\n          #${trackStyleId} > path {\n            cursor: crosshair;\n            fill: none;\n          }\n`,\n        }}\n      />\n      {chords}\n    </g>\n  )\n}\n\nexport default observer(StructuralVariantChords)\n","import ChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from './ReactComponent'\n\nconst ChordRendererConfigF = (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new ChordRendererType({\n        name: 'StructuralVariantChordRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n\nexport default ChordRendererConfigF\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('VariantFeatureWidget', {\n      type: types.literal('VariantFeatureWidget'),\n      descriptions: types.frozen(),\n    }),\n  )\n}\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'VariantFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./VariantFeatureWidget')),\n      }),\n  )\n}\n","import VcfAdapterF from './VcfAdapter'\nimport VcfTabixAdapterF from './VcfTabixAdapter'\nimport ExtensionPointsF from './extensionPoints'\nimport VariantTrackF from './VariantTrack'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ChordVariantDisplayF from './ChordVariantDisplay'\nimport LinearVariantDisplayF from './LinearVariantDisplay'\nimport StructuralVariantChordRendererF from './StructuralVariantChordRenderer'\nimport VariantFeatureWidgetF from './VariantFeatureWidget'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    VcfAdapterF(pluginManager)\n    VcfTabixAdapterF(pluginManager)\n    VariantFeatureWidgetF(pluginManager)\n    VariantTrackF(pluginManager)\n    ExtensionPointsF(pluginManager)\n    LinearVariantDisplayF(pluginManager)\n    StructuralVariantChordRendererF(pluginManager)\n    ChordVariantDisplayF(pluginManager)\n  }\n}\n\nexport { default as VcfFeature } from './VcfTabixAdapter/VcfFeature'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport configSchemaF from './configSchema'\n\nexport default (pm: PluginManager) => {\n  pm.addTrackType(() => {\n    const configSchema = configSchemaF(pm)\n    return new TrackType({\n      name: 'VariantTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(pm, 'VariantTrack', configSchema),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfAdapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport { default as configSchema } from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'VcfTabixAdapter',\n        configSchema,\n        getAdapterClass: () => import('./VcfTabixAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.vcf\\.b?gz$/i\n        const adapterName = 'VcfTabixAdapter'\n        const fileName = getFileName(file)\n        const indexName = index && getFileName(index)\n        const obj = {\n          type: adapterName,\n          vcfGzLocation: file,\n          index: {\n            location: index || makeIndex(file, '.tbi'),\n            indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n          },\n        }\n        if (regexGuess.test(fileName) && !adapterHint) {\n          return obj\n        } else if (adapterHint === adapterName) {\n          return obj\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n  pluginManager.addToExtensionPoint(\n    'Core-guessTrackTypeForLocation',\n    (trackTypeGuesser: TrackTypeGuesser) => {\n      return (adapterName: string) => {\n        if (adapterName === 'VcfTabixAdapter' || adapterName === 'VcfAdapter') {\n          return 'VariantTrack'\n        }\n        return trackTypeGuesser(adapterName)\n      }\n    },\n  )\n\n  pluginManager.addToExtensionPoint(\n    'Core-guessAdapterForLocation',\n    (adapterGuesser: AdapterGuesser) => {\n      return (\n        file: FileLocation,\n        index?: FileLocation,\n        adapterHint?: string,\n      ) => {\n        const regexGuess = /\\.vcf$/i\n        const adapterName = 'VcfAdapter'\n        const fileName = getFileName(file)\n        if (regexGuess.test(fileName) || adapterHint === adapterName) {\n          return {\n            type: adapterName,\n            vcfLocation: file,\n          }\n        }\n        return adapterGuesser(file, index, adapterHint)\n      }\n    },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseChordDisplayComponent } from '@jbrowse/plugin-circular-view'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport configSchemaF from './models/configSchema'\nimport stateModelF from './models/stateModelFactory'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    const stateModel = stateModelF(configSchema)\n    return new DisplayType({\n      name: 'ChordVariantDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'VariantTrack',\n      viewType: 'CircularView',\n      ReactComponent: BaseChordDisplayComponent,\n    })\n  })\n}\n","import FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas, Feature } from '@jbrowse/core/util'\nimport { ThemeOptions } from '@mui/material'\nimport { ScaleOpts, Source } from './util'\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n  displayCrossHatches: boolean\n  ticks: { values: number[] }\n  themeOptions: ThemeOptions\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n}\n\nexport interface MultiRenderArgsDeserialized\n  extends RenderArgsDeserializedWithFeatures {\n  sources: Source[]\n}\n\nexport type {\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n\nexport default abstract class WiggleBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // @ts-ignore\n    const { reducedFeatures, ...rest } = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      ctx =>\n        this.draw(ctx, {\n          ...renderProps,\n          features,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...rest,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...rest,\n      features: (reducedFeatures\n        ? new Map(reducedFeatures.map((r: Feature) => [r.id(), r]))\n        : results.features) as Map<string, Feature>,\n      height,\n      width,\n      containsNoTransferables: true,\n    }\n  }\n\n  /**\n   * draw features to context given props, to be used by derived renderer\n   * classes\n   */\n  abstract draw<T extends RenderArgsDeserializedWithFeatures>(\n    ctx: CanvasRenderingContext2D,\n    props: T,\n  ): Promise<Record<string, unknown> | void>\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\n\nfunction WiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n  blockKey: string\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number) {\n    // calculates feature under mouse\n    let offset = 0\n    if (ref.current) {\n      offset = ref.current.getBoundingClientRect().left\n    }\n    const offsetX = eventClientX - offset\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    for (const feature of features.values()) {\n      // bpPerPx added to the end to accomodate \"reduced features\" (one feature per px)\n      if (\n        clientBp <= feature.get('end') + bpPerPx &&\n        clientBp >= feature.get('start')\n      ) {\n        featureUnderMouse = feature\n        break\n      }\n    }\n    return featureUnderMouse\n  }\n  return (\n    <div\n      ref={ref}\n      data-testid=\"wiggle-rendering-test\"\n      onMouseMove={event =>\n        onMouseMove(event, getFeatureUnderMouse(event.clientX)?.id())\n      }\n      onClick={event =>\n        onFeatureClick(event, getFeatureUnderMouse(event.clientX)?.id())\n      }\n      onMouseLeave={event => onMouseLeave(event)}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n}\n\nexport default observer(WiggleRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config BigWigAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BigWigAdapter = ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    /**\n     * #slot\n     */\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bw',\n        locationType: 'UriLocation',\n      },\n    },\n\n    /**\n     * #slot\n     */\n    source: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Used for multiwiggle',\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default BigWigAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config QuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'QuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchemaFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { createBaseTrackConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiQuantitativeTrack\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'MultiQuantitativeTrack',\n    {},\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: createBaseTrackConfig(pluginManager),\n    },\n  )\n}\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config MultiWiggleAdapter\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MultiWiggleAdapter = ConfigurationSchema(\n  'MultiWiggleAdapter',\n  {\n    /**\n     * #slot\n     */\n    subadapters: {\n      type: 'frozen',\n      defaultValue: [],\n      description: 'array of subadapter JSON objects',\n    },\n    /**\n     * #slot\n     */\n    bigWigs: {\n      type: 'frozen',\n      description:\n        'array of bigwig filenames, alternative to the subadapters slot',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nexport default MultiWiggleAdapter\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config WiggleRenderer\n * this is the \"base wiggle renderer config schema\"\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WiggleRenderer = ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    /**\n     * #slot\n     */\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n    },\n    /**\n     * #slot\n     */\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n    },\n    /**\n     * #slot\n     */\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    /**\n     * #slot\n     */\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default WiggleRenderer\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config DensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { scaleLinear, scaleLog, scaleQuantize } from 'd3-scale'\nimport { autorun } from 'mobx'\nimport {\n  isAbortException,\n  getSession,\n  getContainingView,\n} from '@jbrowse/core/util'\nimport { FeatureStats } from '@jbrowse/core/util/stats'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { addDisposer, isAlive } from 'mobx-state-tree'\n\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { AnyConfigurationModel, getConf } from '@jbrowse/core/configuration'\n\ntype LGV = LinearGenomeViewModel\n\nexport const YSCALEBAR_LABEL_OFFSET = 5\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted: boolean\n}\n\nexport interface Source {\n  name: string\n  color?: string\n  group?: string\n}\n\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale\n  const [min, max] = domain\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog()\n    scale.base(2)\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min\n * or 0 to the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: number[]\n  bounds: number[]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) {\n      max = 0\n    }\n    if (min > 0) {\n      min = 0\n    }\n  }\n  if (scaleType === 'log') {\n    // if the min is 0, assume that it's just something\n    // with no read coverage and that we should ignore it in calculations\n    // if it's greater than 1 pin to 1 for the full range also\n    // otherwise, we may see bigwigs with fractional values\n    if (min === 0 || min > 1) {\n      min = 1\n    }\n  }\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain supplied to stats function')\n  }\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      const scale = scaleLog()\n      scale.base(2)\n      return scale\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n\nexport function groupBy<T>(array: T[], predicate: (v: T) => string) {\n  return array.reduce((acc, value) => {\n    const entry = (acc[predicate(value)] ||= [])\n    entry.push(value)\n    return acc\n  }, {} as { [key: string]: T[] })\n}\n\nexport async function getStats(\n  self: {\n    adapterConfig: AnyConfigurationModel\n    autoscaleType: string\n    setMessage: (str: string) => void\n  },\n  opts: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n): Promise<FeatureStats> {\n  const { rpcManager } = getSession(self)\n  const nd = getConf(self, 'numStdDev') || 3\n  const { adapterConfig, autoscaleType } = self\n  const sessionId = getRpcSessionId(self)\n  const params = {\n    sessionId,\n    adapterConfig,\n    statusCallback: (message: string) => {\n      if (isAlive(self)) {\n        self.setMessage(message)\n      }\n    },\n    ...opts,\n  }\n\n  if (autoscaleType === 'global' || autoscaleType === 'globalsd') {\n    const results: FeatureStats = (await rpcManager.call(\n      sessionId,\n      'WiggleGetGlobalStats',\n      params,\n    )) as FeatureStats\n    const { scoreMin, scoreMean, scoreStdDev } = results\n    // globalsd uses heuristic to avoid unnecessary scoreMin<0\n    // if the scoreMin is never less than 0\n    // helps with most coverage bigwigs just being >0\n    return autoscaleType === 'globalsd'\n      ? {\n          ...results,\n          scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n          scoreMax: scoreMean + nd * scoreStdDev,\n        }\n      : results\n  }\n  if (autoscaleType === 'local' || autoscaleType === 'localsd') {\n    const { dynamicBlocks, bpPerPx } = getContainingView(self) as LGV\n    const results = (await rpcManager.call(\n      sessionId,\n      'WiggleGetMultiRegionStats',\n      {\n        ...params,\n        regions: dynamicBlocks.contentBlocks.map(region => {\n          const { start, end } = region\n          return {\n            ...JSON.parse(JSON.stringify(region)),\n            start: Math.floor(start),\n            end: Math.ceil(end),\n          }\n        }),\n        bpPerPx,\n      },\n    )) as FeatureStats\n    const { scoreMin, scoreMean, scoreStdDev } = results\n\n    // localsd uses heuristic to avoid unnecessary scoreMin<0 if the\n    // scoreMin is never less than 0 helps with most coverage bigwigs\n    // just being >0\n    return autoscaleType === 'localsd'\n      ? {\n          ...results,\n          scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n          scoreMax: scoreMean + nd * scoreStdDev,\n        }\n      : results\n  }\n  if (autoscaleType === 'zscale') {\n    return rpcManager.call(\n      sessionId,\n      'WiggleGetGlobalStats',\n      params,\n    ) as Promise<FeatureStats>\n  }\n  throw new Error(`invalid autoscaleType '${autoscaleType}'`)\n}\n\nexport function statsAutorun(self: {\n  estimatedStatsReady: boolean\n  regionTooLarge: boolean\n  setLoading: (aborter: AbortController) => void\n  setError: (error: unknown) => void\n  updateStats: (stats: FeatureStats, statsRegion: string) => void\n  renderProps: () => Record<string, unknown>\n  adapterConfig: AnyConfigurationModel\n  autoscaleType: string\n  setMessage: (str: string) => void\n}) {\n  addDisposer(\n    self,\n    autorun(\n      async () => {\n        try {\n          const aborter = new AbortController()\n          const view = getContainingView(self) as LGV\n          self.setLoading(aborter)\n\n          if (\n            !view.initialized ||\n            !self.estimatedStatsReady ||\n            self.regionTooLarge\n          ) {\n            return\n          }\n          const statsRegion = JSON.stringify(view.dynamicBlocks)\n\n          const wiggleStats = await getStats(self, {\n            signal: aborter.signal,\n            ...self.renderProps(),\n          })\n\n          if (isAlive(self)) {\n            self.updateStats(wiggleStats, statsRegion)\n          }\n        } catch (e) {\n          if (!isAbortException(e) && isAlive(self)) {\n            console.error(e)\n            self.setError(e)\n          }\n        }\n      },\n      { delay: 1000 },\n    ),\n  )\n}\n\nexport function toP(s = 0) {\n  return +(+s).toPrecision(6)\n}\n\nexport function round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\n","import {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { clamp, featureSpanPx, Feature, Region } from '@jbrowse/core/util'\nimport { getOrigin, getScale, ScaleOpts } from './util'\n\nfunction fillRectCtx(\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  ctx: CanvasRenderingContext2D,\n  color?: string,\n) {\n  if (width < 0) {\n    x += width\n    width = -width\n  }\n  if (height < 0) {\n    y += height\n    height = -height\n  }\n\n  if (color) {\n    ctx.fillStyle = color\n  }\n  ctx.fillRect(x, y, width, height)\n}\n\nconst fudgeFactor = 0.4\nconst clipHeight = 2\n\nexport function drawXY(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    bpPerPx: number\n    regions: Region[]\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    config: AnyConfigurationModel\n    displayCrossHatches: boolean\n    offset?: number\n    colorCallback: (f: Feature, score: number) => string\n    Color: typeof import('color')\n  },\n) {\n  const {\n    features,\n    bpPerPx,\n    regions,\n    scaleOpts,\n    height: unadjustedHeight,\n    config,\n    ticks,\n    displayCrossHatches,\n    offset = 0,\n    colorCallback,\n    Color,\n  } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n\n  // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n  // wiggle display, and makes the height of the actual drawn area add\n  // \"padding\" to the top and bottom of the display\n  const height = unadjustedHeight - offset * 2\n\n  const filled = readConfObject(config, 'filled')\n  const clipColor = readConfObject(config, 'clipColor')\n  const summaryScoreMode = readConfObject(config, 'summaryScoreMode')\n  const pivotValue = readConfObject(config, 'bicolorPivotValue')\n  const minSize = readConfObject(config, 'minSize')\n\n  const scale = getScale({ ...scaleOpts, range: [0, height] })\n  const originY = getOrigin(scaleOpts.scaleType)\n  const [niceMin, niceMax] = scale.domain()\n\n  const toY = (n: number) => clamp(height - (scale(n) || 0), 0, height) + offset\n  const toOrigin = (n: number) => toY(originY) - toY(n)\n  const getHeight = (n: number) => (filled ? toOrigin(n) : Math.max(minSize, 1))\n  let hasClipping = false\n\n  let prevLeftPx = -Infinity\n  const reducedFeatures = []\n  const crossingOrigin = niceMin < pivotValue && niceMax > pivotValue\n\n  // we handle whiskers separately to render max row, min row, and avg in three\n  // passes. this reduces subpixel rendering issues. note: for stylistic\n  // reasons, clipping indicator is only drawn for score, not min/max score\n  if (summaryScoreMode === 'whiskers') {\n    let lastCol\n    let lastMix\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      if (feature.get('summary')) {\n        const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n        const max = feature.get('maxScore')\n        const c = colorCallback(feature, max)\n        const effectiveC = crossingOrigin\n          ? c\n          : c === lastCol\n          ? lastMix\n          : (lastMix = Color(c).lighten(0.4).toString())\n        fillRectCtx(leftPx, toY(max), w, getHeight(max), ctx, effectiveC)\n        lastCol = c\n      }\n    }\n    lastMix = undefined\n    lastCol = undefined\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score')\n      const max = feature.get('maxScore')\n      const min = feature.get('minScore')\n      const summary = feature.get('summary')\n      const c = colorCallback(feature, score)\n      const effectiveC =\n        crossingOrigin && summary\n          ? c === lastCol\n            ? lastMix\n            : (lastMix = Color(colorCallback(feature, max))\n                .mix(Color(colorCallback(feature, min)))\n                .toString())\n          : c\n      const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n      // create reduced features, avoiding multiple features per px\n      if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n        reducedFeatures.push(feature)\n        prevLeftPx = leftPx\n      }\n      hasClipping = hasClipping || score < niceMin || score > niceMax\n      fillRectCtx(leftPx, toY(score), w, getHeight(score), ctx, effectiveC)\n      lastCol = c\n    }\n    lastMix = undefined\n    lastCol = undefined\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      if (feature.get('summary')) {\n        const min = feature.get('minScore')\n        const c = colorCallback(feature, min)\n        const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n        const effectiveC = crossingOrigin\n          ? c\n          : c === lastCol\n          ? lastMix\n          : (lastMix = Color(c).darken(0.4).toString())\n\n        fillRectCtx(leftPx, toY(min), w, getHeight(min), ctx, effectiveC)\n        lastCol = c\n      }\n    }\n  } else {\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      // create reduced features, avoiding multiple features per px\n      if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n        reducedFeatures.push(feature)\n        prevLeftPx = leftPx\n      }\n\n      const score = feature.get('score')\n      const c = colorCallback(feature, score)\n\n      hasClipping = hasClipping || score < niceMin || score > niceMax\n      const w = Math.max(rightPx - leftPx + fudgeFactor, minSize)\n\n      if (summaryScoreMode === 'max') {\n        const s = feature.get('summary') ? feature.get('maxScore') : score\n        fillRectCtx(leftPx, toY(s), w, getHeight(s), ctx, c)\n      } else if (summaryScoreMode === 'min') {\n        const s = feature.get('summary') ? feature.get('minScore') : score\n        fillRectCtx(leftPx, toY(s), w, getHeight(s), ctx, c)\n      } else {\n        fillRectCtx(leftPx, toY(score), w, getHeight(score), ctx, c)\n      }\n    }\n  }\n\n  // second pass: draw clipping\n  // avoid persisting the red fillstyle with save/restore\n  ctx.save()\n  if (hasClipping) {\n    ctx.fillStyle = clipColor\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + fudgeFactor\n      const score = feature.get('score')\n      if (score > niceMax) {\n        fillRectCtx(leftPx, offset, w, clipHeight, ctx)\n      } else if (score < niceMin && scaleOpts.scaleType !== 'log') {\n        fillRectCtx(leftPx, unadjustedHeight, w, clipHeight, ctx)\n      }\n    }\n  }\n  ctx.restore()\n\n  if (displayCrossHatches) {\n    ctx.lineWidth = 1\n    ctx.strokeStyle = 'rgba(200,200,200,0.5)'\n    ticks.values.forEach(tick => {\n      ctx.beginPath()\n      ctx.moveTo(0, Math.round(toY(tick)))\n      ctx.lineTo(width, Math.round(toY(tick)))\n      ctx.stroke()\n    })\n  }\n\n  return { reducedFeatures }\n}\n\nexport function drawLine(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    regions: Region[]\n    bpPerPx: number\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    displayCrossHatches: boolean\n    colorCallback: (f: Feature, score: number) => string\n    config: AnyConfigurationModel\n    offset?: number\n  },\n) {\n  const {\n    features,\n    regions,\n    bpPerPx,\n    scaleOpts,\n    height: unadjustedHeight,\n    ticks: { values },\n    displayCrossHatches,\n    colorCallback,\n    config,\n    offset = 0,\n  } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n\n  // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n  // wiggle display, and makes the height of the actual drawn area add\n  // \"padding\" to the top and bottom of the display\n  const height = unadjustedHeight - offset * 2\n  const clipColor = readConfObject(config, 'clipColor')\n  const scale = getScale({ ...scaleOpts, range: [0, height] })\n  const [niceMin, niceMax] = scale.domain()\n  const toY = (n: number) => clamp(height - (scale(n) || 0), 0, height) + offset\n\n  let lastVal\n\n  let prevLeftPx = -Infinity\n  const reducedFeatures = []\n  for (const feature of features.values()) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n    // create reduced features, avoiding multiple features per px\n    if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n      reducedFeatures.push(feature)\n      prevLeftPx = leftPx\n    }\n    const score = feature.get('score')\n    const lowClipping = score < niceMin\n    const highClipping = score > niceMax\n    const w = rightPx - leftPx + fudgeFactor\n\n    const c = colorCallback(feature, score)\n\n    ctx.beginPath()\n    ctx.strokeStyle = c\n    const startPos = typeof lastVal !== 'undefined' ? lastVal : score\n    if (!region.reversed) {\n      ctx.moveTo(leftPx, toY(startPos))\n      ctx.lineTo(leftPx, toY(score))\n      ctx.lineTo(rightPx, toY(score))\n    } else {\n      ctx.moveTo(rightPx, toY(startPos))\n      ctx.lineTo(rightPx, toY(score))\n      ctx.lineTo(leftPx, toY(score))\n    }\n    ctx.stroke()\n    lastVal = score\n\n    if (highClipping) {\n      ctx.fillStyle = clipColor\n      ctx.fillRect(leftPx, offset, w, clipHeight)\n    } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n      ctx.fillStyle = clipColor\n      ctx.fillRect(leftPx, height - clipHeight, w, height)\n    }\n  }\n\n  if (displayCrossHatches) {\n    ctx.lineWidth = 1\n    ctx.strokeStyle = 'rgba(200,200,200,0.5)'\n    values.forEach(tick => {\n      ctx.beginPath()\n      ctx.moveTo(0, Math.round(toY(tick)))\n      ctx.lineTo(width, Math.round(toY(tick)))\n      ctx.stroke()\n    })\n  }\n  return { reducedFeatures }\n}\n\nexport function drawDensity(\n  ctx: CanvasRenderingContext2D,\n  props: {\n    features: Map<string, Feature> | Feature[]\n    regions: Region[]\n    bpPerPx: number\n    scaleOpts: ScaleOpts\n    height: number\n    ticks: { values: number[] }\n    displayCrossHatches: boolean\n    config: AnyConfigurationModel\n  },\n) {\n  const { features, regions, bpPerPx, scaleOpts, height, config } = props\n  const [region] = regions\n  const pivot = readConfObject(config, 'bicolorPivot')\n  const pivotValue = readConfObject(config, 'bicolorPivotValue')\n  const negColor = readConfObject(config, 'negColor')\n  const posColor = readConfObject(config, 'posColor')\n  const color = readConfObject(config, 'color')\n  const clipColor = readConfObject(config, 'clipColor')\n  const crossing = pivot !== 'none' && scaleOpts.scaleType !== 'log'\n  const scale = getScale({\n    ...scaleOpts,\n    pivotValue: crossing ? pivotValue : undefined,\n    range: crossing ? [negColor, 'white', posColor] : ['white', posColor],\n  })\n\n  const scale2 = getScale({ ...scaleOpts, range: [0, height] })\n  let cb\n  if (color === '#f0f') {\n    cb = (_feature: Feature, score: number) => scale(score)\n  } else {\n    cb = (feature: Feature, score: number) =>\n      readConfObject(config, 'color', { feature, score })\n  }\n  const [niceMin, niceMax] = scale2.domain()\n\n  let prevLeftPx = -Infinity\n  let hasClipping = false\n  const reducedFeatures = []\n  for (const feature of features.values()) {\n    const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n    // create reduced features, avoiding multiple features per px\n    if (Math.floor(leftPx) !== Math.floor(prevLeftPx)) {\n      reducedFeatures.push(feature)\n      prevLeftPx = leftPx\n    }\n    const score = feature.get('score')\n    hasClipping = hasClipping || score > niceMax || score < niceMin\n    const w = rightPx - leftPx + fudgeFactor\n    ctx.fillStyle = cb(feature, score)\n    ctx.fillRect(leftPx, 0, w, height)\n  }\n\n  // second pass: draw clipping\n  // avoid persisting the red fillstyle with save/restore\n  ctx.save()\n  if (hasClipping) {\n    ctx.fillStyle = clipColor\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + fudgeFactor\n      const score = feature.get('score')\n      if (score > niceMax) {\n        fillRectCtx(leftPx, 0, w, clipHeight, ctx)\n      } else if (score < niceMin && scaleOpts.scaleType !== 'log') {\n        fillRectCtx(leftPx, 0, w, clipHeight, ctx)\n      }\n    }\n  }\n  ctx.restore()\n\n  return { reducedFeatures }\n}\n","import { drawDensity } from '../drawxy'\n\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nexport default class DensityRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    return drawDensity(ctx, props)\n  }\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { Feature } from '@jbrowse/core/util'\nimport { drawXY } from '../drawxy'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { features, config } = props\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const Color = await import('color').then(f => f.default)\n\n    return drawXY(ctx, {\n      ...props,\n      colorCallback:\n        readConfObject(config, 'color') === '#f0f'\n          ? (_: Feature, score: number) =>\n              score < pivotValue ? negColor : posColor\n          : (feature: Feature, _score: number) =>\n              readConfObject(config, 'color', { feature }),\n      offset: YSCALEBAR_LABEL_OFFSET,\n      features: [...features.values()],\n      Color,\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config XYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config LinePlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nimport { YSCALEBAR_LABEL_OFFSET } from '../util'\nimport { drawLine } from '../drawxy'\n\nexport default class LinePlotRenderer extends WiggleBaseRenderer {\n  async draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    return drawLine(ctx, {\n      ...props,\n      offset: YSCALEBAR_LABEL_OFFSET,\n      colorCallback: () => 'grey',\n    })\n  }\n}\n","import React, { useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { alpha, Portal } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport { YSCALEBAR_LABEL_OFFSET, round } from './util'\nimport { usePopper } from 'react-popper'\n\nconst useStyles = makeStyles()(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: YSCALEBAR_LABEL_OFFSET,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\ntype Coord = [number, number]\n\n// React.forwardRef component for the tooltip, the ref is used for measuring\n// the size of the tooltip\nexport type TooltipContentsComponent = React.ForwardRefExoticComponent<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  { feature: Feature; model: any } & React.RefAttributes<HTMLDivElement>\n>\n\nfunction Tooltip({\n  model,\n  height,\n  clientMouseCoord,\n  offsetMouseCoord,\n  clientRect,\n  TooltipContents,\n  useClientY,\n}: {\n  model: { featureUnderMouse: Feature }\n  useClientY?: boolean\n  height: number\n  clientMouseCoord: Coord\n  offsetMouseCoord: Coord\n  clientRect?: DOMRect\n  TooltipContents: TooltipContentsComponent\n}) {\n  const { featureUnderMouse } = model\n  const [width, setWidth] = useState(0)\n  const [anchorEl, setAnchorEl] = useState<HTMLDivElement | null>(null)\n  const { classes } = useStyles()\n\n  // must be memoized a la https://github.com/popperjs/react-popper/issues/391\n  const virtElement = useMemo(\n    () => ({\n      getBoundingClientRect: () => {\n        const x = clientMouseCoord[0] + width / 2 + 20\n        const y = useClientY ? clientMouseCoord[1] : clientRect?.top || 0\n        return {\n          top: y,\n          left: x,\n          bottom: y,\n          right: x,\n          width: 0,\n          height: 0,\n          x,\n          y,\n          toJSON() {},\n        }\n      },\n    }),\n    [clientRect?.top, clientMouseCoord, width, useClientY],\n  )\n  const { styles, attributes } = usePopper(virtElement, anchorEl)\n\n  return featureUnderMouse ? (\n    <>\n      <Portal>\n        <div\n          ref={setAnchorEl}\n          className={classes.tooltip}\n          // zIndex needed to go over widget drawer\n          style={{ ...styles.popper, zIndex: 100000 }}\n          {...attributes.popper}\n        >\n          <TooltipContents\n            ref={elt => setWidth(elt?.getBoundingClientRect().width || 0)}\n            model={model}\n            feature={featureUnderMouse}\n          />\n        </div>\n      </Portal>\n\n      <div\n        className={classes.hoverVertical}\n        style={{\n          left: offsetMouseCoord[0],\n          height: height - YSCALEBAR_LABEL_OFFSET * 2,\n        }}\n      />\n    </>\n  ) : null\n}\n\nexport default observer(Tooltip)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport Tooltip, { TooltipContentsComponent } from '../../Tooltip'\nimport { toP } from '../../util'\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\nconst TooltipContents = React.forwardRef<HTMLDivElement, { feature: Feature }>(\n  ({ feature }, ref) => {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const loc = [name, start === end ? en(start) : `${en(start)}..${en(end)}`]\n      .filter(f => !!f)\n      .join(':')\n\n    return feature.get('summary') !== undefined ? (\n      <div ref={ref}>\n        {loc}\n        <br />\n        Max: {toP(feature.get('maxScore'))}\n        <br />\n        Avg: {toP(feature.get('score'))}\n        <br />\n        Min: {toP(feature.get('minScore'))}\n      </div>\n    ) : (\n      <div ref={ref}>\n        {loc}\n        <br />\n        {`${toP(feature.get('score'))}`}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst WiggleTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n    TooltipContents?: TooltipContentsComponent\n  }) => {\n    return <Tooltip TooltipContents={TooltipContents} {...props} />\n  },\n)\nexport default WiggleTooltip\nexport { Tooltip }\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Axis, LEFT, RIGHT } from 'react-d3-axis-mod'\nimport { WiggleDisplayModel } from '../models/model'\n\nconst YScaleBar = observer(\n  ({\n    model,\n    orientation,\n  }: {\n    model: WiggleDisplayModel\n    orientation?: string\n  }) => {\n    const { ticks } = model\n\n    return ticks ? (\n      <Axis\n        {...ticks}\n        shadow={2}\n        format={(n: number) => n}\n        style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      />\n    ) : null\n  },\n)\nexport default YScaleBar\n","import React from 'react'\nimport {\n  measureText,\n  getContainingView,\n  getContainingTrack,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport {\n  BaseLinearDisplayComponent,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\nimport { WiggleDisplayModel } from '../models/model'\nimport YScaleBar from './YScaleBar'\n\ntype LGV = LinearGenomeViewModel\n\nconst LinearWiggleDisplay = observer((props: { model: WiggleDisplayModel }) => {\n  const { model } = props\n  const { stats, height, needsScalebar } = model\n\n  const { trackLabels } = getContainingView(model) as LGV\n  const track = getContainingTrack(model)\n  const left =\n    trackLabels === 'overlapping'\n      ? measureText(getConf(track, 'name'), 12.8) + 100\n      : 50\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      {stats && needsScalebar ? (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left,\n            pointerEvents: 'none',\n            height,\n            width: 50,\n          }}\n        >\n          <YScaleBar model={model} />\n        </svg>\n      ) : null}\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n\nexport { YScaleBar }\n","import React, { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport {\n  getEnv,\n  getSession,\n  getContainingView,\n  isSelectionContainer,\n  Feature,\n} from '@jbrowse/core/util'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { when } from 'mobx'\nimport { isAlive, types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\nimport {\n  getNiceDomain,\n  getScale,\n  getStats,\n  statsAutorun,\n  YSCALEBAR_LABEL_OFFSET,\n} from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport { YScaleBar } from '../components/WiggleDisplayComponent'\n\nconst SetMinMaxDlg = lazy(() => import('../components/SetMinMaxDialog'))\nconst SetColorDlg = lazy(() => import('../components/SetColorDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * #stateModel LinearWiggleDisplay\n * Extends `BaseLinearDisplay`\n */\nfunction stateModelFactory(\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) {\n  return types\n    .compose(\n      'LinearWiggleDisplay',\n      BaseLinearDisplay,\n      types.model({\n        /**\n         * #property\n         */\n        type: types.literal('LinearWiggleDisplay'),\n        /**\n         * #property\n         */\n        configuration: ConfigurationReference(configSchema),\n        /**\n         * #property\n         */\n        selectedRendering: types.optional(types.string, ''),\n        /**\n         * #property\n         */\n        resolution: types.optional(types.number, 1),\n        /**\n         * #property\n         */\n        fill: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        minSize: types.maybe(types.number),\n        /**\n         * #property\n         */\n        color: types.maybe(types.string),\n        /**\n         * #property\n         */\n        posColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        negColor: types.maybe(types.string),\n        /**\n         * #property\n         */\n        summaryScoreMode: types.maybe(types.string),\n        /**\n         * #property\n         */\n        rendererTypeNameState: types.maybe(types.string),\n        /**\n         * #property\n         */\n        scale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        autoscale: types.maybe(types.string),\n        /**\n         * #property\n         */\n        displayCrossHatches: types.maybe(types.boolean),\n        /**\n         * #property\n         */\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      statsReady: false,\n      message: undefined as undefined | string,\n      stats: { scoreMin: 0, scoreMax: 50 },\n      statsFetchInProgress: undefined as undefined | AbortController,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      updateStats(stats: { scoreMin: number; scoreMax: number }) {\n        const { scoreMin, scoreMax } = stats\n        const EPSILON = 0.000001\n        if (\n          Math.abs(self.stats.scoreMax - scoreMax) > EPSILON ||\n          Math.abs(self.stats.scoreMin - scoreMin) > EPSILON\n        ) {\n          self.stats = { scoreMin, scoreMax }\n        }\n        self.statsReady = true\n      },\n      /**\n       * #action\n       */\n      setColor(color?: string) {\n        self.color = color\n      },\n      /**\n       * #action\n       */\n      setPosColor(color?: string) {\n        self.posColor = color\n      },\n      /**\n       * #action\n       */\n      setNegColor(color?: string) {\n        self.negColor = color\n      },\n\n      /**\n       * #action\n       */\n      setLoading(aborter: AbortController) {\n        const { statsFetchInProgress: statsFetch } = self\n        if (statsFetch !== undefined && !statsFetch.signal.aborted) {\n          statsFetch.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n\n      /**\n       * #action\n       * this overrides the BaseLinearDisplayModel to avoid popping up a\n       * feature detail display, but still sets the feature selection on the\n       * model so listeners can detect a click\n       */\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n\n      /**\n       * #action\n       */\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      /**\n       * #action\n       */\n      setFill(fill: number) {\n        if (fill === 0) {\n          self.fill = true\n          self.minSize = 0\n        } else if (fill === 1) {\n          self.fill = false\n          self.minSize = 1\n        } else if (fill === 2) {\n          self.fill = false\n          self.minSize = 2\n        }\n      },\n\n      /**\n       * #action\n       */\n      toggleLogScale() {\n        if (self.scale !== 'log') {\n          self.scale = 'log'\n        } else {\n          self.scale = 'linear'\n        }\n      },\n\n      /**\n       * #action\n       */\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      /**\n       * #action\n       */\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      /**\n       * #action\n       */\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      /**\n       * #action\n       */\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      /**\n       * #action\n       */\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      /**\n       * #action\n       */\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      /**\n       * #action\n       */\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      /**\n       * #action\n       */\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get TooltipComponent() {\n        return Tooltip as unknown as React.FC\n      },\n\n      /**\n       * #getter\n       */\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeNameSimple() {\n        return self.rendererTypeNameState || getConf(self, 'defaultRendering')\n      },\n\n      /**\n       * #getter\n       */\n      get rendererTypeName() {\n        const name = this.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n\n      /**\n       * #getter\n       * subclasses can define these, as snpcoverage track does\n       */\n      get filters() {\n        return undefined\n      },\n\n      /**\n       * #getter\n       */\n      get scaleType() {\n        return self.scale || getConf(self, 'scaleType')\n      },\n\n      /**\n       * #getter\n       */\n      get maxScore() {\n        return self.constraints.max ?? getConf(self, 'maxScore')\n      },\n\n      /**\n       * #getter\n       */\n      get minScore() {\n        return self.constraints.min ?? getConf(self, 'minScore')\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n        const {\n          color,\n          displayCrossHatches,\n          fill,\n          minSize,\n          negColor,\n          posColor,\n          summaryScoreMode,\n          scaleType,\n        } = self\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(scaleType ? { scaleType } : {}),\n            ...(fill !== undefined ? { filled: fill } : {}),\n            ...(displayCrossHatches !== undefined\n              ? { displayCrossHatches }\n              : {}),\n            ...(summaryScoreMode !== undefined ? { summaryScoreMode } : {}),\n            ...(color !== undefined ? { color } : {}),\n            ...(negColor !== undefined ? { negColor } : {}),\n            ...(posColor !== undefined ? { posColor } : {}),\n            ...(minSize !== undefined ? { minSize } : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        /**\n         * #getter\n         */\n        get filled() {\n          const { fill, rendererConfig: conf } = self\n          return fill ?? readConfObject(conf, 'filled')\n        },\n        /**\n         * #getter\n         */\n        get summaryScoreModeSetting() {\n          const { summaryScoreMode, rendererConfig: conf } = self\n          return summaryScoreMode ?? readConfObject(conf, 'summaryScoreMode')\n        },\n        /**\n         * #getter\n         */\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n\n          const ret = getNiceDomain({\n            domain: [stats.scoreMin, stats.scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n\n        /**\n         * #getter\n         */\n        get needsScalebar() {\n          return (\n            self.rendererTypeName === 'XYPlotRenderer' ||\n            self.rendererTypeName === 'LinePlotRenderer'\n          )\n        },\n        /**\n         * #getter\n         */\n        get scaleOpts() {\n          return {\n            domain: this.domain,\n            stats: self.stats,\n            autoscaleType: this.autoscaleType,\n            scaleType: self.scaleType,\n            inverted: getConf(self, 'inverted'),\n          }\n        },\n\n        /**\n         * #getter\n         */\n        get canHaveFill() {\n          return self.rendererTypeName === 'XYPlotRenderer'\n        },\n\n        /**\n         * #getter\n         */\n        get autoscaleType() {\n          return self.autoscale ?? getConf(self, 'autoscale')\n        },\n\n        /**\n         * #getter\n         */\n        get displayCrossHatchesSetting() {\n          const { displayCrossHatches: hatches, rendererConfig: conf } = self\n          return hatches ?? readConfObject(conf, 'displayCrossHatches')\n        },\n      }\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get ticks() {\n        const { scaleType, domain, height } = self\n        const minimalTicks = getConf(self, 'minimalTicks')\n        const inverted = getConf(self, 'inverted')\n        const range = [height - YSCALEBAR_LABEL_OFFSET, YSCALEBAR_LABEL_OFFSET]\n        const scale = getScale({\n          scaleType,\n          domain,\n          range,\n          inverted,\n        })\n        const ticks = axisPropsFromTickScale(scale, 4)\n        return height < 100 || minimalTicks\n          ? { ...ticks, values: domain }\n          : ticks\n      },\n\n      /**\n       * #getter\n       */\n      get adapterCapabilities() {\n        const type = self.adapterTypeName\n        return pluginManager.getAdapterType(type).adapterCapabilities\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        /**\n         * #method\n         */\n        renderProps() {\n          const superProps = superRenderProps()\n          const { filters, ticks, height, resolution, scaleOpts } = self\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !self.statsReady,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n            displayCrossHatches: self.displayCrossHatchesSetting,\n            scaleOpts,\n            resolution,\n            height,\n            ticks,\n            filters,\n          }\n        },\n        /**\n         * #getter\n         */\n        get hasResolution() {\n          return self.adapterCapabilities.includes('hasResolution')\n        },\n\n        /**\n         * #getter\n         */\n        get hasGlobalStats() {\n          return self.adapterCapabilities.includes('hasGlobalStats')\n        },\n\n        /**\n         * #getter\n         */\n        get fillSetting() {\n          if (self.filled) {\n            return 0\n          } else if (!self.filled && self.minSize === 1) {\n            return 1\n          } else {\n            return 2\n          }\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        /**\n         * #method\n         */\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            ...(self.hasResolution\n              ? [\n                  {\n                    label: 'Resolution',\n                    subMenu: [\n                      {\n                        label: 'Finer resolution',\n                        onClick: () => self.setResolution(self.resolution * 5),\n                      },\n                      {\n                        label: 'Coarser resolution',\n                        onClick: () => self.setResolution(self.resolution / 5),\n                      },\n                    ],\n                  },\n                  {\n                    label: 'Summary score mode',\n                    subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => ({\n                      label: elt,\n                      type: 'radio',\n                      checked: self.summaryScoreModeSetting === elt,\n                      onClick: () => self.setSummaryScoreMode(elt),\n                    })),\n                  },\n                ]\n              : []),\n\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => self.setFill(idx),\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n            {\n              label:\n                self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n              onClick: () => self.toggleLogScale(),\n            },\n\n            ...(self.needsScalebar\n              ? [\n                  {\n                    type: 'checkbox',\n                    label: 'Draw cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => self.toggleCrossHatches(),\n                  },\n                ]\n              : []),\n\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: ['xyplot', 'density', 'line'].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n            {\n              label: 'Autoscale type',\n              subMenu: [\n                ['local', 'Local'],\n                ...(self.hasGlobalStats\n                  ? [\n                      ['global', 'Global'],\n                      ['globalsd', 'Global  3'],\n                    ]\n                  : []),\n                ['localsd', 'Local  3'],\n              ].map(([val, label]) => ({\n                label,\n                type: 'radio',\n                checked: self.autoscaleType === val,\n                onClick: () => self.setAutoscale(val),\n              })),\n            },\n            {\n              label: 'Set min/max score',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetMinMaxDlg,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n            {\n              label: 'Set color',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDlg,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { reload: superReload, renderSvg: superRenderSvg } = self\n\n      type ExportSvgOpts = Parameters<typeof superRenderSvg>[0]\n\n      return {\n        /**\n         * #action\n         * re-runs stats and refresh whole display on reload\n         */\n        async reload() {\n          self.setError()\n          const aborter = new AbortController()\n          self.setLoading(aborter)\n          try {\n            const stats = await getStats(self, {\n              signal: aborter.signal,\n              ...self.renderProps(),\n            })\n            if (isAlive(self)) {\n              self.updateStats(stats)\n              superReload()\n            }\n          } catch (e) {\n            self.setError(e)\n          }\n        },\n        afterAttach() {\n          statsAutorun(self)\n        },\n        /**\n         * #action\n         */\n        async renderSvg(opts: ExportSvgOpts) {\n          await when(() => self.statsReady && !!self.regionCannotBeRenderedText)\n          const { needsScalebar, stats } = self\n          const { offsetPx } = getContainingView(self) as LGV\n          return (\n            <>\n              <g id=\"snpcov\">{await superRenderSvg(opts)}</g>\n              {needsScalebar && stats ? (\n                <g transform={`translate(${Math.max(-offsetPx, 0)})`}>\n                  <YScaleBar\n                    model={self as WiggleDisplayModel}\n                    orientation=\"left\"\n                  />\n                </g>\n              ) : null}\n            </>\n          )\n        },\n      }\n    })\n}\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport ReactComponent from './components/WiggleDisplayComponent'\nimport Tooltip from './components/Tooltip'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    const stateModel = modelFactory(pluginManager, configSchema)\n    return new DisplayType({\n      name: 'LinearWiggleDisplay',\n      configSchema,\n      stateModel,\n      trackType: 'QuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n\nexport { ReactComponent, modelFactory, Tooltip }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config LinearWiggleDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema =\n    pluginManager.getRendererType('XYPlotRenderer').configSchema\n  const DensityRendererConfigSchema =\n    pluginManager.getRendererType('DensityRenderer').configSchema\n  const LinePlotRendererConfigSchema =\n    pluginManager.getRendererType('LinePlotRenderer').configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n\n      /**\n       * #slot\n       */\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util'\n\n// locals\nimport { Source, toP } from '../../util'\nimport Tooltip, { TooltipContentsComponent } from '../../Tooltip'\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\nconst TooltipContents = React.forwardRef<\n  HTMLDivElement,\n  { model: { sources: Source[] }; feature: Feature }\n>(({ model, feature }, ref) => {\n  const start = feature.get('start')\n  const end = feature.get('end')\n  const refName = feature.get('refName')\n  const coord = start === end ? en(start) : `${en(start)}..${en(end)}`\n  const sources = feature.get('sources') as Record<string, { score: number }>\n  const source = feature.get('source')\n  const summary = feature.get('summary')\n  const obj = Object.fromEntries(model.sources.map(ent => [ent.name, ent]))\n\n  return (\n    <div ref={ref}>\n      {[refName, coord].filter(f => !!f).join(':')}\n      <br />\n      {sources ? (\n        <table>\n          <thead>\n            <tr>\n              <th>color</th>\n              <th>source</th>\n              <th>score</th>\n            </tr>\n          </thead>\n          <tbody>\n            {Object.entries(sources).map(([source, data]) => (\n              <tr key={source}>\n                <td style={{ background: obj[source]?.color }}> </td>\n                <td>{source}</td>\n                <td>{toP(data.score)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      ) : (\n        <span>\n          {source}{' '}\n          {summary\n            ? `min:${toP(feature.get('minScore'))} avg:${toP(\n                feature.get('score'),\n              )} max:${toP(feature.get('maxScore'))}`\n            : toP(feature.get('score'))}\n        </span>\n      )}\n    </div>\n  )\n})\n\ntype Coord = [number, number]\n\nconst WiggleTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature; sources: Source[]; rowHeight: number }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n    TooltipContents?: TooltipContentsComponent\n  }) => {\n    return <Tooltip useClientY TooltipContents={TooltipContents} {...props} />\n  },\n)\nexport default WiggleTooltip\nexport { Tooltip }\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Axis, LEFT, RIGHT } from 'react-d3-axis-mod'\nimport { WiggleDisplayModel } from '../models/model'\n\nconst YScaleBar = observer(\n  ({\n    model,\n    orientation,\n  }: {\n    model: WiggleDisplayModel\n    orientation?: string\n  }) => {\n    const { ticks } = model\n    return ticks ? (\n      <Axis\n        {...ticks}\n        shadow={2}\n        format={(n: number) => n}\n        style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      />\n    ) : null\n  },\n)\nexport default YScaleBar\n","import React from 'react'\nimport {\n  measureText,\n  getContainingView,\n  getContainingTrack,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplayComponent,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { WiggleDisplayModel } from '../models/model'\nimport YScaleBar from './YScaleBar'\n\ntype LGV = LinearGenomeViewModel\n\nconst trackLabelFontSize = 12.8\n\nfunction getOffset(model: WiggleDisplayModel) {\n  const { prefersOffset } = model\n  const { trackLabels } = getContainingView(model) as LGV\n  const track = getContainingTrack(model)\n  const trackName = getConf(track, 'name')\n  return trackLabels === 'overlapping' && !prefersOffset\n    ? measureText(trackName, trackLabelFontSize) + 100\n    : 10\n}\n\nconst Wrapper = observer(\n  ({\n    children,\n    model,\n    exportSVG,\n  }: {\n    model: WiggleDisplayModel\n    children: React.ReactNode\n    exportSVG?: boolean\n  }) => {\n    if (exportSVG) {\n      return <>{children}</>\n    } else {\n      const { height } = model\n      return (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left: 0,\n            pointerEvents: 'none',\n            height,\n            width: getContainingView(model).width,\n          }}\n        >\n          {children}\n        </svg>\n      )\n    }\n  },\n)\n\nconst RectBg = (props: {\n  x: number\n  y: number\n  width: number\n  height: number\n  color?: string\n}) => {\n  const { color = 'rgb(255,255,255,0.8)' } = props\n  return <rect {...props} fill={color} />\n}\n\nconst ScoreLegend = observer(({ model }: { model: WiggleDisplayModel }) => {\n  const { ticks, scaleType } = model\n  const { width } = getContainingView(model) as LGV\n  const legend =\n    `[${ticks.values[0]}-${ticks.values[1]}]` +\n    (scaleType === 'log' ? ' (log scale)' : '')\n  const len = measureText(legend, 14)\n  const padding = 25\n  const xpos = width - len - padding\n  return (\n    <>\n      <RectBg y={0} x={xpos} width={len + 6} height={16} />\n      <text y={13} x={xpos}>\n        {legend}\n      </text>\n    </>\n  )\n})\n\nconst ColorLegend = observer(\n  ({\n    model,\n    rowHeight,\n    labelWidth,\n    exportSVG,\n  }: {\n    model: WiggleDisplayModel\n    rowHeight: number\n    labelWidth: number\n    exportSVG?: boolean\n  }) => {\n    const {\n      needsCustomLegend,\n      needsScalebar,\n      needsFullHeightScalebar,\n      rowHeightTooSmallForScalebar,\n      renderColorBoxes,\n      sources,\n    } = model\n    const svgFontSize = Math.min(rowHeight, 12)\n    const canDisplayLabel = rowHeight > 11\n    const colorBoxWidth = renderColorBoxes ? 15 : 0\n    const legendWidth = labelWidth + colorBoxWidth + 5\n    const svgOffset = exportSVG ? 10 : 0\n    const extraOffset =\n      svgOffset || (needsScalebar && !rowHeightTooSmallForScalebar ? 50 : 0)\n    return sources ? (\n      <>\n        {\n          /* 0.25 for hanging letters like g */\n          needsFullHeightScalebar ? (\n            <RectBg\n              y={0}\n              x={extraOffset}\n              width={legendWidth}\n              height={(sources.length + 0.25) * rowHeight}\n            />\n          ) : null\n        }\n        {sources.map((source, idx) => {\n          const boxHeight = Math.min(20, rowHeight)\n          return (\n            <React.Fragment key={source.name + '-' + idx}>\n              {!needsFullHeightScalebar ? (\n                <RectBg\n                  y={idx * rowHeight + 1}\n                  x={extraOffset}\n                  width={legendWidth}\n                  height={boxHeight}\n                />\n              ) : null}\n              {source.color ? (\n                <RectBg\n                  y={idx * rowHeight + 1}\n                  x={extraOffset}\n                  width={colorBoxWidth}\n                  height={needsCustomLegend ? rowHeight : boxHeight}\n                  color={source.color}\n                />\n              ) : null}\n              {canDisplayLabel ? (\n                <text\n                  y={idx * rowHeight + 13}\n                  x={extraOffset + colorBoxWidth + 2}\n                  fontSize={svgFontSize}\n                >\n                  {source.name}\n                </text>\n              ) : null}\n            </React.Fragment>\n          )\n        })}\n      </>\n    ) : null\n  },\n)\n\nexport const StatBars = observer(\n  (props: {\n    model: WiggleDisplayModel\n    orientation?: string\n    exportSVG?: boolean\n  }) => {\n    const { model, orientation, exportSVG } = props\n    const {\n      stats,\n      needsCustomLegend,\n      needsFullHeightScalebar,\n      rowHeightTooSmallForScalebar,\n      rowHeight,\n      sources,\n      ticks,\n    } = model\n    const svgFontSize = Math.min(rowHeight, 12)\n    const canDisplayLabel = rowHeight > 11\n    const { width: viewWidth } = getContainingView(model) as LGV\n    const minWidth = 20\n\n    const ready = stats && sources\n    if (!ready) {\n      return null\n    }\n\n    const labelWidth = Math.max(\n      ...(sources\n        .map(s => measureText(s.name, svgFontSize))\n        .map(width => (canDisplayLabel ? width : minWidth)) || [0]),\n    )\n\n    return (\n      <Wrapper {...props}>\n        {needsFullHeightScalebar ? (\n          <>\n            <g transform={`translate(${!exportSVG ? getOffset(model) : 0},0)`}>\n              <YScaleBar model={model} orientation={orientation} />\n            </g>\n            <g transform={`translate(${viewWidth - labelWidth - 100},0)`}>\n              <ColorLegend\n                exportSVG={exportSVG}\n                model={model}\n                rowHeight={12}\n                labelWidth={labelWidth}\n              />\n            </g>\n          </>\n        ) : (\n          <>\n            <ColorLegend\n              exportSVG={exportSVG}\n              model={model}\n              rowHeight={model.rowHeight}\n              labelWidth={labelWidth}\n            />\n\n            {rowHeightTooSmallForScalebar || needsCustomLegend ? (\n              <ScoreLegend {...props} />\n            ) : (\n              sources.map((_source, idx) => (\n                <g\n                  transform={`translate(0 ${rowHeight * idx})`}\n                  key={JSON.stringify(ticks) + '-' + idx}\n                >\n                  <YScaleBar model={model} orientation={orientation} />\n                </g>\n              ))\n            )}\n          </>\n        )}\n      </Wrapper>\n    )\n  },\n)\n\nconst LinearWiggleDisplay = observer((props: { model: WiggleDisplayModel }) => {\n  const { model } = props\n\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      <StatBars model={model} />\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n\nexport { YScaleBar }\n","import React, { lazy } from 'react'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\nimport { autorun, when } from 'mobx'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\nimport deepEqual from 'fast-deep-equal'\n\n// jbrowse imports\nimport {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport {\n  getSession,\n  getEnv,\n  getContainingView,\n  isSelectionContainer,\n  Feature,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { set1 as colors } from '@jbrowse/core/ui/colors'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// locals\nimport {\n  getNiceDomain,\n  getScale,\n  getStats,\n  statsAutorun,\n  YSCALEBAR_LABEL_OFFSET,\n} from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport { StatBars } from '../components/WiggleDisplayComponent'\n\nconst randomColor = () =>\n  '#000000'.replace(/0/g, () => (~~(Math.random() * 16)).toString(16))\n\n// lazt components\nconst SetMinMaxDlg = lazy(() => import('../components/SetMinMaxDialog'))\nconst SetColorDlg = lazy(() => import('../components/SetColorDialog'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'MultiXYPlotRenderer'],\n  ['multirowxy', 'MultiRowXYPlotRenderer'],\n  ['multirowdensity', 'MultiDensityRenderer'],\n  ['multiline', 'MultiLineRenderer'],\n  ['multirowline', 'MultiRowLineRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\ninterface Source {\n  name: string\n  color?: string\n  group?: string\n}\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'MultiLinearWiggleDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('MultiLinearWiggleDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        selectedRendering: types.optional(types.string, ''),\n        resolution: types.optional(types.number, 1),\n        fill: types.maybe(types.boolean),\n        minSize: types.maybe(types.number),\n        height: 200,\n        color: types.maybe(types.string),\n        posColor: types.maybe(types.string),\n        negColor: types.maybe(types.string),\n        summaryScoreMode: types.maybe(types.string),\n        rendererTypeNameState: types.maybe(types.string),\n        scale: types.maybe(types.string),\n        autoscale: types.maybe(types.string),\n        displayCrossHatches: types.maybe(types.boolean),\n        layout: types.optional(types.frozen<Source[]>(), []),\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      statsReady: false,\n      message: undefined as undefined | string,\n      stats: { scoreMin: 0, scoreMax: 50 },\n      statsRegion: undefined as string | undefined,\n      statsFetchInProgress: undefined as undefined | AbortController,\n      featureUnderMouseVolatile: undefined as Feature | undefined,\n      sourcesVolatile: undefined as Source[] | undefined,\n    }))\n    .actions(self => ({\n      setLayout(layout: Source[]) {\n        self.layout = layout\n      },\n      clearLayout() {\n        self.layout = []\n      },\n      updateStats(stats: { scoreMin: number; scoreMax: number }) {\n        const { scoreMin, scoreMax } = stats\n        const EPSILON = 0.000001\n        if (\n          Math.abs(self.stats.scoreMax - scoreMax) > EPSILON ||\n          Math.abs(self.stats.scoreMin - scoreMin) > EPSILON\n        ) {\n          self.stats = { scoreMin, scoreMax }\n          self.statsReady = true\n        }\n      },\n      setSources(sources: Source[]) {\n        if (!deepEqual(sources, self.sourcesVolatile)) {\n          self.sourcesVolatile = sources\n        }\n      },\n      setColor(color: string) {\n        self.color = color\n      },\n      setPosColor(color: string) {\n        self.posColor = color\n      },\n      setNegColor(color: string) {\n        self.negColor = color\n      },\n\n      setLoading(aborter: AbortController) {\n        const { statsFetchInProgress: statsFetch } = self\n        if (statsFetch !== undefined && !statsFetch.signal.aborted) {\n          statsFetch.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n\n      // this overrides the BaseLinearDisplayModel to avoid popping up a\n      // feature detail display, but still sets the feature selection on the\n      // model so listeners can detect a click\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n\n      setFeatureUnderMouse(f?: Feature) {\n        self.featureUnderMouseVolatile = f\n      },\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      setFill(fill: number) {\n        if (fill === 0) {\n          self.fill = true\n          self.minSize = 0\n        } else if (fill === 1) {\n          self.fill = false\n          self.minSize = 1\n        } else if (fill === 2) {\n          self.fill = false\n          self.minSize = 2\n        }\n      },\n\n      toggleLogScale() {\n        if (self.scale !== 'log') {\n          self.scale = 'log'\n        } else {\n          self.scale = 'linear'\n        }\n      },\n\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n    .views(self => ({\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n      get TooltipComponent() {\n        return Tooltip as unknown as React.FC\n      },\n\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n      get rendererTypeNameSimple() {\n        return self.rendererTypeNameState || getConf(self, 'defaultRendering')\n      },\n      get rendererTypeName() {\n        const name = this.rendererTypeNameSimple\n        const rendererType = rendererTypes.get(name)\n        if (!rendererType) {\n          throw new Error(`unknown renderer ${name}`)\n        }\n        return rendererType\n      },\n\n      // subclasses can define these, as snpcoverage track does\n      get filters() {\n        return undefined\n      },\n\n      get scaleType() {\n        return self.scale ?? (getConf(self, 'scaleType') as string)\n      },\n\n      get maxScore() {\n        return self.constraints.max ?? (getConf(self, 'maxScore') as number)\n      },\n\n      get minScore() {\n        return self.constraints.min ?? (getConf(self, 'minScore') as number)\n      },\n    }))\n    .views(self => ({\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n        const {\n          color,\n          displayCrossHatches,\n          fill,\n          minSize,\n          negColor,\n          posColor,\n          summaryScoreMode,\n          scaleType,\n        } = self\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            ...(scaleType ? { scaleType } : {}),\n            ...(fill !== undefined ? { filled: fill } : {}),\n            ...(displayCrossHatches !== undefined\n              ? { displayCrossHatches }\n              : {}),\n            ...(summaryScoreMode !== undefined ? { summaryScoreMode } : {}),\n            ...(color !== undefined ? { color } : {}),\n            ...(negColor !== undefined ? { negColor } : {}),\n            ...(posColor !== undefined ? { posColor } : {}),\n            ...(minSize !== undefined ? { minSize } : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => ({\n      // everything except density gets a numerical scalebar\n      get needsScalebar() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer'\n        )\n      },\n\n      get needsFullHeightScalebar() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiLineRenderer'\n        )\n      },\n\n      get isMultiRow() {\n        return (\n          self.rendererTypeName === 'MultiRowXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiDensityRenderer'\n        )\n      },\n\n      // can be used to give it a \"color scale\" like a R heatmap, not\n      // implemented like this yet but flag can be used for this\n      get needsCustomLegend() {\n        return self.rendererTypeName === 'MultiDensityRenderer'\n      },\n\n      get canHaveFill() {\n        return (\n          self.rendererTypeName === 'MultiXYPlotRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n\n      // the multirowxy and multiline don't need to use colors on the legend\n      // boxes since their track is drawn with the color. sort of a stylistic choice\n      get renderColorBoxes() {\n        return !(\n          self.rendererTypeName === 'MultiRowLineRenderer' ||\n          self.rendererTypeName === 'MultiRowXYPlotRenderer'\n        )\n      },\n\n      // positions multi-row below the tracklabel even if using overlap\n      // tracklabels for everything else\n      get prefersOffset() {\n        return this.isMultiRow\n      },\n\n      get sources() {\n        const sources = Object.fromEntries(\n          self.sourcesVolatile?.map(s => [s.name, s]) || [],\n        )\n        const iter = self.layout.length ? self.layout : self.sourcesVolatile\n        return iter\n          ?.map(s => ({\n            ...sources[s.name],\n            ...s,\n          }))\n          .map((s, i) => ({\n            ...s,\n            color:\n              s.color ||\n              (!this.isMultiRow ? colors[i] || randomColor() : 'blue'),\n          }))\n      },\n    }))\n\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        get filled(): boolean {\n          const { fill, rendererConfig } = self\n          return fill ?? readConfObject(rendererConfig, 'filled')\n        },\n        get summaryScoreModeSetting(): string {\n          const { summaryScoreMode: scoreMode, rendererConfig } = self\n          return scoreMode ?? readConfObject(rendererConfig, 'summaryScoreMode')\n        },\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n          const { scoreMin, scoreMax } = stats\n\n          const ret = getNiceDomain({\n            domain: [scoreMin, scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (!deepEqual(oldDomain, ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n\n        get scaleOpts() {\n          const { scaleType, stats } = self\n          return {\n            autoscaleType: this.autoscaleType,\n            domain: this.domain,\n            stats,\n            scaleType,\n            inverted: getConf(self, 'inverted'),\n          }\n        },\n\n        get autoscaleType() {\n          return self.autoscale ?? (getConf(self, 'autoscale') as string)\n        },\n\n        get displayCrossHatchesSetting() {\n          const { displayCrossHatches, rendererConfig } = self\n          return (\n            displayCrossHatches ??\n            (readConfObject(rendererConfig, 'displayCrossHatches') as boolean)\n          )\n        },\n        get rowHeight() {\n          const { sources, height, isMultiRow } = self\n          return isMultiRow ? height / (sources?.length || 1) : height\n        },\n\n        get rowHeightTooSmallForScalebar() {\n          return this.rowHeight < 70\n        },\n\n        get useMinimalTicks() {\n          return (\n            getConf(self, 'minimalTicks') || this.rowHeightTooSmallForScalebar\n          )\n        },\n      }\n    })\n    .views(self => ({\n      get ticks() {\n        const { scaleType, domain, isMultiRow, rowHeight, useMinimalTicks } =\n          self\n\n        const offset = isMultiRow ? 0 : YSCALEBAR_LABEL_OFFSET\n        const ticks = axisPropsFromTickScale(\n          getScale({\n            scaleType,\n            domain,\n            range: [rowHeight - offset, offset],\n            inverted: getConf(self, 'inverted') as boolean,\n          }),\n          4,\n        )\n        return useMinimalTicks ? { ...ticks, values: domain } : ticks\n      },\n\n      get colors() {\n        return [\n          'red',\n          'blue',\n          'green',\n          'orange',\n          'purple',\n          'cyan',\n          'pink',\n          'darkblue',\n          'darkred',\n          'pink',\n        ]\n      },\n\n      get adapterCapabilities() {\n        const { adapterTypeName } = self\n        return pluginManager.getAdapterType(adapterTypeName).adapterCapabilities\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          const superProps = superRenderProps()\n          const {\n            displayCrossHatches,\n            filters,\n            height,\n            resolution,\n            rpcDriverName,\n            scaleOpts,\n            sources,\n            statsReady,\n            ticks,\n            rendererConfig: config,\n          } = self\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !sources || !statsReady,\n            displayModel: self,\n            config,\n            displayCrossHatches,\n            filters,\n            height,\n            resolution,\n            rpcDriverName,\n            scaleOpts,\n            sources,\n            ticks,\n            onMouseMove: (_: unknown, f: Feature) =>\n              self.setFeatureUnderMouse(f),\n            onMouseLeave: () => self.setFeatureUnderMouse(undefined),\n          }\n        },\n\n        get hasResolution() {\n          return self.adapterCapabilities.includes('hasResolution')\n        },\n\n        get hasGlobalStats() {\n          return self.adapterCapabilities.includes('hasGlobalStats')\n        },\n\n        get fillSetting() {\n          if (self.filled) {\n            return 0\n          } else if (!self.filled && self.minSize === 1) {\n            return 1\n          } else {\n            return 2\n          }\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      const hasRenderings = getConf(self, 'defaultRendering')\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            ...(self.hasResolution\n              ? [\n                  {\n                    label: 'Resolution',\n                    subMenu: [\n                      {\n                        label: 'Finer resolution',\n                        onClick: () => self.setResolution(self.resolution * 5),\n                      },\n                      {\n                        label: 'Coarser resolution',\n                        onClick: () => self.setResolution(self.resolution / 5),\n                      },\n                    ],\n                  },\n                  {\n                    label: 'Summary score mode',\n                    subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => ({\n                      label: elt,\n                      type: 'radio',\n                      checked: self.summaryScoreModeSetting === elt,\n                      onClick: () => self.setSummaryScoreMode(elt),\n                    })),\n                  },\n                ]\n              : []),\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: 'Fill mode',\n                    subMenu: ['filled', 'no fill', 'no fill w/ emphasis'].map(\n                      (elt, idx) => ({\n                        label: elt,\n                        type: 'radio',\n                        checked: self.fillSetting === idx,\n                        onClick: () => self.setFill(idx),\n                      }),\n                    ),\n                  },\n                ]\n              : []),\n            {\n              label:\n                self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n              onClick: () => self.toggleLogScale(),\n            },\n            ...(self.needsScalebar\n              ? [\n                  {\n                    type: 'checkbox',\n                    label: 'Draw cross hatches',\n                    checked: self.displayCrossHatchesSetting,\n                    onClick: () => self.toggleCrossHatches(),\n                  },\n                ]\n              : []),\n            ...(hasRenderings\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: [\n                      'xyplot',\n                      'multirowxy',\n                      'multirowdensity',\n                      'multiline',\n                      'multirowline',\n                    ].map(key => ({\n                      label: key,\n                      type: 'radio',\n                      checked: self.rendererTypeNameSimple === key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n\n            {\n              label: 'Autoscale type',\n              subMenu: [\n                ['local', 'Local'],\n                ...(self.hasGlobalStats\n                  ? [\n                      ['global', 'Global'],\n                      ['globalsd', 'Global  3'],\n                    ]\n                  : []),\n                ['localsd', 'Local  3'],\n              ].map(([val, label]) => {\n                return {\n                  label,\n                  type: 'radio',\n                  checked: self.autoscaleType === val,\n                  onClick: () => self.setAutoscale(val),\n                }\n              }),\n            },\n            {\n              label: 'Set min/max score...',\n              onClick: () => {\n                const session = getSession(self)\n                session.queueDialog(handleClose => [\n                  SetMinMaxDlg,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n            {\n              label: 'Edit colors/arrangement...',\n              onClick: () => {\n                getSession(self).queueDialog(handleClose => [\n                  SetColorDlg,\n                  { model: self, handleClose },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { reload: superReload, renderSvg: superRenderSvg } = self\n\n      type ExportSvgOpts = Parameters<typeof superRenderSvg>[0]\n\n      return {\n        // re-runs stats and refresh whole display on reload\n        async reload() {\n          self.setError()\n          const aborter = new AbortController()\n          let stats\n          try {\n            self.setLoading(aborter)\n            stats = await getStats(self, {\n              signal: aborter.signal,\n              ...self.renderProps(),\n            })\n            if (isAlive(self)) {\n              self.updateStats(stats)\n              superReload()\n            }\n          } catch (e) {\n            self.setError(e)\n          }\n        },\n        afterAttach() {\n          statsAutorun(self)\n          addDisposer(\n            self,\n            autorun(async () => {\n              const { rpcManager } = getSession(self)\n              const { adapterConfig } = self\n              const sessionId = getRpcSessionId(self)\n              const sources = (await rpcManager.call(\n                sessionId,\n                'MultiWiggleGetSources',\n                {\n                  sessionId,\n                  adapterConfig,\n                },\n              )) as Source[]\n              if (isAlive(self)) {\n                self.setSources(sources)\n              }\n            }),\n          )\n        },\n        async renderSvg(opts: ExportSvgOpts) {\n          await when(() => self.statsReady && !!self.regionCannotBeRenderedText)\n          const { offsetPx } = getContainingView(self) as LGV\n          return (\n            <>\n              <g id=\"snpcov\">{await superRenderSvg(opts)}</g>\n              <g transform={`translate(${Math.max(-offsetPx, 0)})`}>\n                <StatBars model={self} orientation=\"left\" exportSVG />\n              </g>\n            </>\n          )\n        },\n      }\n    })\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport ReactComponent from './components/WiggleDisplayComponent'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'MultiLinearWiggleDisplay',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'MultiQuantitativeTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/**\n * #config MultiLinearWiggleDisplay\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const MultiXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiXYPlotRenderer',\n  ).configSchema\n  const MultiDensityRendererConfigSchema = pluginManager.getRendererType(\n    'MultiDensityRenderer',\n  ).configSchema\n  const MultiRowXYPlotRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowXYPlotRenderer',\n  ).configSchema\n  const MultiLineRendererConfigSchema =\n    pluginManager.getRendererType('MultiLineRenderer').configSchema\n  const MultiRowLineRendererConfigSchema = pluginManager.getRendererType(\n    'MultiRowLineRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'MultiLinearWiggleDisplay',\n    {\n      /**\n       * #slot\n       */\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n\n      /**\n       * #slot\n       */\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      /**\n       * #slot\n       */\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      /**\n       * #slot\n       */\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      /**\n       * #slot\n       */\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      /**\n       * #slot\n       */\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n\n      /**\n       * #slot\n       */\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      /**\n       * #slot\n       */\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', [\n          'multirowxy',\n          'xyplot',\n          'multirowdensity',\n          'multiline',\n          'multirowline',\n        ]),\n        defaultValue: 'multirowxy',\n      },\n\n      /**\n       * #slot\n       */\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        MultiXYPlotRenderer: MultiXYPlotRendererConfigSchema,\n        MultiDensityRenderer: MultiDensityRendererConfigSchema,\n        MultiRowXYPlotRenderer: MultiRowXYPlotRendererConfigSchema,\n        MultiLineRenderer: MultiLineRendererConfigSchema,\n        MultiRowLineRenderer: MultiRowLineRendererConfigSchema,\n      }),\n    },\n    {\n      /**\n       * #baseConfiguration\n       */\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { SimpleFeature, Feature } from '@jbrowse/core/util'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { Source } from './util'\n\nfunction WiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n  blockKey: string\n  sources: Source[]\n  displayModel: { isMultiRow: boolean }\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    sources,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n    displayModel,\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number, eventClientY: number) {\n    if (!ref.current) {\n      return\n    }\n    const rect = ref.current.getBoundingClientRect()\n    const offsetX = eventClientX - rect.left\n    const offsetY = eventClientY - rect.top\n    const source = sources[Math.floor((offsetY / height) * sources.length)]\n    if (!source) {\n      return\n    }\n    const px = region.reversed ? width - offsetX : offsetX\n    const mouseoverBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    if (displayModel.isMultiRow) {\n      for (const feature of features.values()) {\n        if (feature.get('source') !== source.name) {\n          continue\n        }\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featureUnderMouse = feature\n          break\n        }\n      }\n    } else {\n      const featuresUnderMouse = []\n      for (const feature of features.values()) {\n        if (\n          mouseoverBp <= feature.get('end') + bpPerPx &&\n          mouseoverBp >= feature.get('start')\n        ) {\n          featuresUnderMouse.push(feature)\n        }\n      }\n\n      if (featuresUnderMouse.length) {\n        const pos = Math.floor(mouseoverBp)\n        featureUnderMouse = new SimpleFeature({\n          uniqueId: 'mouseoverfeat',\n          sources: Object.fromEntries(\n            featuresUnderMouse\n              .map(f => f.toJSON())\n              .map(f => {\n                const { refName, start, end, source, ...rest } = f\n                return [source, rest]\n              }),\n          ),\n          ...region,\n          start: pos,\n          end: pos + 1,\n        })\n      }\n    }\n    return featureUnderMouse\n  }\n\n  return (\n    <div\n      ref={ref}\n      onMouseMove={event => {\n        const featureUnderMouse = getFeatureUnderMouse(\n          event.clientX,\n          event.clientY,\n        )\n        onMouseMove(event, featureUnderMouse)\n      }}\n      onClick={event => {\n        const featureUnderMouse = getFeatureUnderMouse(\n          event.clientX,\n          event.clientY,\n        )\n        onFeatureClick(event, featureUnderMouse)\n      }}\n      onMouseLeave={event => onMouseLeave(event)}\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n}\n\nexport default observer(WiggleRendering)\n","import { Feature } from '@jbrowse/core/util'\nimport { drawXY } from '../drawxy'\nimport { groupBy, YSCALEBAR_LABEL_OFFSET } from '../util'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-ignore\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { sources, features } = props\n    const groups = groupBy([...features.values()], f => f.get('source'))\n    const Color = await import('color').then(f => f.default)\n    let feats = [] as Feature[]\n    sources.forEach(source => {\n      const features = groups[source.name]\n      if (!features) {\n        return\n      }\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features,\n        offset: YSCALEBAR_LABEL_OFFSET,\n        colorCallback: () => source.color || 'blue',\n        Color,\n      })\n      feats = feats.concat(reducedFeatures)\n    })\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { Feature } from '@jbrowse/core/util'\nimport { groupBy } from '../util'\nimport { drawXY } from '../drawxy'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-ignore\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy([...features.values()], f => f.get('source'))\n    const height = props.height / Object.keys(groups).length\n    const width = (region.end - region.start) / bpPerPx\n    const Color = await import('color').then(f => f.default)\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const features = groups[source.name]\n      if (!features) {\n        return\n      }\n      const { reducedFeatures } = drawXY(ctx, {\n        ...props,\n        features,\n        height,\n        colorCallback: () => source.color || 'blue',\n        Color,\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { types } from 'mobx-state-tree'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowXYPlotRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowXYPlotRenderer',\n  {\n    /**\n     * #slot\n     */\n    filled: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    /**\n     * #slot\n     */\n    minSize: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiDensityRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiDensityRenderer',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { Feature } from '@jbrowse/core/util'\nimport { groupBy } from '../util'\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\nimport { drawDensity } from '../drawxy'\n\nexport default class MultiXYPlotRenderer extends WiggleBaseRenderer {\n  // @ts-ignore\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy([...features.values()], f => f.get('source'))\n    const height = props.height / Object.keys(groups).length\n    const width = (region.end - region.start) / bpPerPx\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const features = groups[source.name]\n      if (!features) {\n        return\n      }\n      const { reducedFeatures } = drawDensity(ctx, {\n        ...props,\n        features,\n        height,\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { Feature } from '@jbrowse/core/util'\nimport { drawLine } from '../drawxy'\nimport { groupBy } from '../util'\n\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiLineRenderer extends WiggleBaseRenderer {\n  // @ts-ignore\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { sources, features } = props\n    const groups = groupBy([...features.values()], f => f.get('source'))\n    let feats = [] as Feature[]\n    sources.forEach(source => {\n      const features = groups[source.name]\n      if (!features) {\n        return\n      }\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features,\n        colorCallback: () => source.color || 'blue',\n      })\n      feats = feats.concat(reducedFeatures)\n    })\n    return { reducedFeatures: feats }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n/**\n * #config MultiLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default configSchema\n","import { Feature } from '@jbrowse/core/util'\nimport { groupBy } from '../util'\nimport { drawLine } from '../drawxy'\nimport WiggleBaseRenderer, {\n  MultiRenderArgsDeserialized as MultiArgs,\n} from '../WiggleBaseRenderer'\n\nexport default class MultiRowLineRenderer extends WiggleBaseRenderer {\n  // @ts-ignore\n  async draw(ctx: CanvasRenderingContext2D, props: MultiArgs) {\n    const { bpPerPx, sources, regions, features } = props\n    const [region] = regions\n    const groups = groupBy([...features.values()], f => f.get('source'))\n    const height = props.height / Object.keys(groups).length\n    const width = (region.end - region.start) / bpPerPx\n    let feats = [] as Feature[]\n    ctx.save()\n    sources.forEach(source => {\n      const { reducedFeatures } = drawLine(ctx, {\n        ...props,\n        features: groups[source.name],\n        height,\n        colorCallback: () => source.color || 'blue',\n      })\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ctx.beginPath()\n      ctx.moveTo(0, height)\n      ctx.lineTo(width, height)\n      ctx.stroke()\n      ctx.translate(0, height)\n      feats = feats.concat(reducedFeatures)\n    })\n    ctx.restore()\n    return { reducedFeatures: feats }\n  }\n}\n","import { types } from 'mobx-state-tree'\n\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport baseWiggleRendererConfigSchema from '../configSchema'\n\n/**\n * #config MultiRowLineRenderer\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst configSchema = ConfigurationSchema(\n  'MultiRowLineRenderer',\n  {\n    /**\n     * #slot\n     */\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n    /**\n     * #slot\n     */\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'avg',\n    },\n  },\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: baseWiggleRendererConfigSchema,\n    explicitlyTyped: true,\n  },\n)\n\nexport default configSchema\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { getSession, isSessionWithAddTracks } from '@jbrowse/core/util'\nimport { HierarchicalTrackSelectorModel } from '@jbrowse/plugin-data-management'\n\nconst ConfirmDialog = lazy(() => import('./ConfirmDialog'))\n\nexport default function (pm: PluginManager) {\n  pm.addToExtensionPoint(\n    'TrackSelector-multiTrackMenuItems',\n    (items: unknown[], props: Record<string, unknown>) => {\n      const { session } = props\n      return [\n        ...items,\n        ...(isSessionWithAddTracks(session)\n          ? [\n              {\n                label: 'Create multi-wiggle track',\n                onClick: (model: HierarchicalTrackSelectorModel) => {\n                  const tracks = model.selection\n                  const trackIds = tracks.map(c => readConfObject(c, 'name'))\n                  function makeTrack(arg: { name: string }) {\n                    const subadapters = tracks\n                      .map(c => readConfObject(c, 'adapter'))\n                      .map((c, idx) => ({ ...c, source: trackIds[idx] }))\n                    const assemblyNames = [\n                      ...new Set(\n                        tracks\n                          .map(c => readConfObject(c, 'assemblyNames'))\n                          .flat(),\n                      ),\n                    ]\n                    const now = +Date.now()\n                    const trackId = `multitrack-${now}-sessionTrack`\n\n                    getSession(model).addTrackConf({\n                      type: 'MultiQuantitativeTrack',\n                      trackId,\n                      name: arg.name,\n                      assemblyNames,\n                      adapter: {\n                        type: 'MultiWiggleAdapter',\n                        subadapters,\n                      },\n                    })\n                    model.view.showTrack(trackId)\n                  }\n                  getSession(model).queueDialog(handleClose => [\n                    ConfirmDialog,\n                    {\n                      tracks,\n                      onClose: (arg: boolean, arg1?: { name: string }) => {\n                        if (arg && arg1) {\n                          makeTrack(arg1)\n                        }\n                        handleClose()\n                      },\n                    },\n                  ])\n                },\n              },\n            ]\n          : []),\n      ]\n    },\n  )\n}\n","import React, { useState } from 'react'\nimport { Button, Paper, TextField } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { getSession, isElectron } from '@jbrowse/core/util'\nimport { storeBlobLocation } from '@jbrowse/core/util/tracks'\nimport { AddTrackModel } from '@jbrowse/plugin-data-management'\n\nconst useStyles = makeStyles()(theme => ({\n  textbox: {\n    width: '100%',\n  },\n  paper: {\n    margin: theme.spacing(),\n    padding: theme.spacing(),\n  },\n  submit: {\n    marginTop: 25,\n    marginBottom: 100,\n    display: 'block',\n  },\n}))\n\nexport default function MultiWiggleWidget({ model }: { model: AddTrackModel }) {\n  const { classes } = useStyles()\n  const [val, setVal] = useState('')\n  const [trackName, setTrackName] = useState('MultiWiggle ' + Date.now())\n  return (\n    <Paper className={classes.paper}>\n      <ul>\n        <li>Enter list of URLs for bigwig files in the textbox</li>\n        <li>\n          Or, use the button below the text box to select files from your\n          computer\n        </li>\n      </ul>\n\n      <TextField\n        multiline\n        rows={10}\n        value={val}\n        onChange={event => setVal(event.target.value)}\n        placeholder={'Paste list of URLs here, or use file selector below'}\n        variant=\"outlined\"\n        className={classes.textbox}\n      />\n\n      <Button variant=\"outlined\" component=\"label\">\n        Choose Files from your computer\n        <input\n          type=\"file\"\n          hidden\n          multiple\n          onChange={({ target }) => {\n            const res = Array.from(target?.files || []).map(file => ({\n              type: 'BigWigAdapter',\n              bigWigLocation: isElectron\n                ? {\n                    localPath: (file as File & { path: string }).path,\n                    locationType: 'LocalPathLocation',\n                  }\n                : storeBlobLocation({ blob: file }),\n              source: file.name,\n            }))\n            setVal(JSON.stringify(res, null, 2))\n          }}\n        />\n      </Button>\n      <TextField\n        value={trackName}\n        onChange={event => setTrackName(event.target.value)}\n        helperText=\"Track name\"\n      />\n      <Button\n        variant=\"contained\"\n        className={classes.submit}\n        onClick={() => {\n          const session = getSession(model)\n\n          const trackId = [\n            `${trackName.toLowerCase().replace(/ /g, '_')}-${Date.now()}`,\n            `${session.adminMode ? '' : '-sessionTrack'}`,\n          ].join('')\n\n          // allow list of bigwigs in JSON format or line-by-line\n          let bigWigs\n          try {\n            bigWigs = JSON.parse(val)\n          } catch (e) {\n            bigWigs = val.split(/\\n|\\r\\n|\\r/)\n          }\n          const obj =\n            typeof bigWigs[0] === 'string'\n              ? { bigWigs }\n              : { subadapters: bigWigs }\n\n          session.addTrackConf({\n            trackId,\n            type: 'MultiQuantitativeTrack',\n            name: trackName,\n            assemblyNames: [model.assembly],\n            adapter: {\n              type: 'MultiWiggleAdapter',\n              ...obj,\n            },\n          })\n          model.view?.showTrack(trackId)\n\n          model.clearData()\n          session.hideWidget(model)\n        }}\n      >\n        Submit\n      </Button>\n\n      <p>Additional notes: </p>\n      <ul>\n        <li>\n          The list of bigwig files in the text box can be a list of URLs, or a\n          list of elements like{' '}\n          <code>{`[{\"type\":\"BigWigAdapter\",\"bigWigLocation\":{\"uri\":\"http://host/file.bw\"}, \"color\":\"green\",\"source\":\"name for subtrack\"}]`}</code>{' '}\n          to apply e.g. the color attribute to the view\n        </li>\n        <li>\n          Adding local files will update the textbox with JSON contents that are\n          ready to submit with the \"Submit\" button\n        </li>\n      </ul>\n    </Paper>\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AddTrackWorkflowType } from '@jbrowse/core/pluggableElementTypes'\nimport { types } from 'mobx-state-tree'\n\n// locals\nimport MultiWiggleWidget from './AddTrackWorkflow'\n\nexport default (pm: PluginManager) => {\n  pm.addAddTrackWorkflowType(\n    () =>\n      new AddTrackWorkflowType({\n        name: 'Multi-wiggle track',\n        ReactComponent: MultiWiggleWidget,\n        stateModel: types.model({}),\n      }),\n  )\n}\n","import RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded, Region } from '@jbrowse/core/util'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { FeatureStats } from '@jbrowse/core/util/stats'\n\nexport class WiggleGetGlobalStats extends RpcMethodType {\n  name = 'WiggleGetGlobalStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ): Promise<FeatureStats> {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-ignore\n    return dataAdapter.getGlobalStats(deserializedArgs)\n  }\n}\n\nexport class WiggleGetMultiRegionStats extends RpcMethodType {\n  name = 'WiggleGetMultiRegionStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getMultiRegionStats(regions, deserializedArgs)\n    }\n    throw new Error('Data adapter not found')\n  }\n}\n\nexport class MultiWiggleGetSources extends RpcMethodType {\n  name = 'MultiWiggleGetSources'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & {\n      signal?: AbortSignal\n      statusCallback?: (arg: string) => void\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const assemblyManager = pm.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters?.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const pm = this.pluginManager\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(pm, sessionId, adapterConfig)\n\n    // @ts-ignore\n    return dataAdapter.getSources(regions, deserializedArgs)\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  AdapterGuesser,\n  TrackTypeGuesser,\n  getFileName,\n} from '@jbrowse/core/util/tracks'\n\n// locals\nimport WiggleBaseRenderer from './WiggleBaseRenderer'\nimport WiggleRendering from './WiggleRendering'\nimport BigWigAdapterF from './BigWigAdapter'\nimport QuantitativeTrackF from './QuantitativeTrack'\nimport MultiQuantitativeTrackF from './MultiQuantitativeTrack'\nimport MultiWiggleAdapterF from './MultiWiggleAdapter'\nimport DensityRendererF from './DensityRenderer'\nimport XYPlotRendererF from './XYPlotRenderer'\nimport LinePlotRendererF from './LinePlotRenderer'\nimport LinearWiggleDisplayF from './LinearWiggleDisplay'\nimport MultiLinearWiggleDisplayF from './MultiLinearWiggleDisplay'\nimport MultiXYPlotRendererF from './MultiXYPlotRenderer'\nimport MultiRowXYPlotRendererF from './MultiRowXYPlotRenderer'\nimport MultiDensityRendererF from './MultiDensityRenderer'\nimport MultiLineRendererF from './MultiLineRenderer'\nimport MultiRowLineRendererF from './MultiRowLineRenderer'\nimport CreateMultiWiggleExtensionF from './CreateMultiWiggleExtension'\nimport MultiWiggleAddTrackWidgetF from './MultiWiggleAddTrackWidget'\n\nimport * as utils from './util'\n\nimport {\n  WiggleGetGlobalStats,\n  WiggleGetMultiRegionStats,\n  MultiWiggleGetSources,\n} from './WiggleRPC/rpcMethods'\n\nimport {\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  modelFactory as linearWiggleDisplayModelFactory,\n  Tooltip,\n} from './LinearWiggleDisplay'\nimport { TooltipContentsComponent } from './Tooltip'\nimport {\n  ReactComponent as XYPlotRendererReactComponent,\n  configSchema as xyPlotRendererConfigSchema,\n  XYPlotRenderer,\n} from './XYPlotRenderer'\n\nexport default class WigglePlugin extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pm: PluginManager) {\n    MultiWiggleAdapterF(pm)\n    BigWigAdapterF(pm)\n    QuantitativeTrackF(pm)\n    MultiQuantitativeTrackF(pm)\n    LinearWiggleDisplayF(pm)\n    MultiLinearWiggleDisplayF(pm)\n    LinePlotRendererF(pm)\n    XYPlotRendererF(pm)\n    DensityRendererF(pm)\n    MultiXYPlotRendererF(pm)\n    MultiRowXYPlotRendererF(pm)\n    MultiDensityRendererF(pm)\n    MultiLineRendererF(pm)\n    MultiRowLineRendererF(pm)\n    MultiWiggleAddTrackWidgetF(pm)\n    CreateMultiWiggleExtensionF(pm)\n\n    pm.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (cb: AdapterGuesser) => {\n        return (file: FileLocation, index?: FileLocation, hint?: string) => {\n          const regexGuess = /\\.(bw|bigwig)$/i\n          const adapterName = 'BigWigAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigWigLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !hint) {\n            return obj\n          } else if (hint === adapterName) {\n            return obj\n          }\n\n          return cb(file, index, hint)\n        }\n      },\n    )\n    pm.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BigWigAdapter') {\n            return 'QuantitativeTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pm.addRpcMethod(() => new WiggleGetGlobalStats(pm))\n    pm.addRpcMethod(() => new WiggleGetMultiRegionStats(pm))\n    pm.addRpcMethod(() => new MultiWiggleGetSources(pm))\n  }\n\n  exports = {\n    LinearWiggleDisplayReactComponent,\n    XYPlotRendererReactComponent,\n    XYPlotRenderer,\n    WiggleBaseRenderer,\n\n    xyPlotRendererConfigSchema,\n    utils,\n    linearWiggleDisplayModelFactory,\n  }\n}\n\nexport * from './util'\n\nexport {\n  LinearWiggleDisplayReactComponent,\n  Tooltip,\n  WiggleRendering,\n  WiggleBaseRenderer,\n  linearWiggleDisplayModelFactory,\n}\n\nexport type { TooltipContentsComponent }\n","import configSchema from './configSchema'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MultiWiggleAdapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        getAdapterClass: () =>\n          import('./MultiWiggleAdapter').then(r => r.default),\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BigWigAdapter',\n        configSchema,\n        adapterCapabilities: [\n          'hasResolution',\n          'hasLocalStats',\n          'hasGlobalStats',\n        ],\n        getAdapterClass: () => import('./BigWigAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'QuantitativeTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'QuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaF(pluginManager)\n    return new TrackType({\n      name: 'MultiQuantitativeTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'MultiQuantitativeTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from '../WiggleRendering'\nimport LinePlotRenderer from './LinePlotRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new LinePlotRenderer({\n        name: 'LinePlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import ReactComponent from '../WiggleRendering'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport XYPlotRenderer from './XYPlotRenderer'\nimport configSchema from './configSchema'\nexport { XYPlotRenderer, configSchema, ReactComponent }\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new XYPlotRenderer({\n        name: 'XYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import configSchema from './configSchema'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport DensityRenderer from './DensityRenderer'\nimport ReactComponent from '../WiggleRendering'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new DensityRenderer({\n        name: 'DensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiXYPlotRenderer from './MultiXYPlotRenderer'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new MultiXYPlotRenderer({\n        name: 'MultiXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiRowXYPlotRenderer from './MultiRowXYPlotRenderer'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowXYPlotRenderer({\n        name: 'MultiRowXYPlotRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchema from './configSchema'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiDensityRenderer from './MultiDensityRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new MultiDensityRenderer({\n        name: 'MultiDensityRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiLineRenderer from './MultiLineRenderer'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new MultiLineRenderer({\n        name: 'MultiLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from '../MultiWiggleRendering'\nimport MultiRowLineRenderer from './MultiRowLineRenderer'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new MultiRowLineRenderer({\n        name: 'MultiRowLineRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n"],"names":["configSchema","ConfigurationSchema","formatSubfeatures","obj","depth","parse","currentDepth","returnObj","subfeatures","map","sub","stateModelFactory","pluginManager","types","id","ElementId","type","featureData","formattedFields","unformattedFeatureData","view","pluggableMstType","track","trackId","trackType","actions","self","setFeatureData","clearFeatureData","undefined","setFormattedData","feat","setExtra","afterCreate","addDisposer","autorun","configuration","session","getSession","feature","clone","f","arg2","getConf","__jbrowsefmt","preProcessSnapshot","snap","finalizedFeatureData","rest","postProcessSnapshot","JSON","stringify","_","v","CoreGetRefNames","name","args","rpcDriver","pm","this","deserializeArguments","deserializedArgs","sessionId","adapterConfig","getAdapter","dataAdapter","isFeatureAdapter","getRefNames","RpcMethodType","CoreGetFileInfo","getHeader","CoreGetMetadata","getMetadata","CoreGetFeatures","feats","superDeserialized","SimpleFeature","rootModel","assemblyManager","renameRegionsIfNeeded","renamedArgs","signal","regions","opts","Error","ret","getFeaturesInMultipleRegions","pipe","toArray","toPromise","r","toJSON","CoreFreeResources","specification","deleteCount","freeAdapterResources","getRendererTypes","forEach","renderer","count","freeResources","_rpcDriver","CoreEstimateRegionStats","filters","estimateRegionsStats","CoreRender","superArgs","rendererType","RendererType","validateRendererType","getRendererType","serializeArgsInClient","checkAbortSignal","render","renderInWorker","result","serializedReturn","des","deserializeResultsInClient","CoreGetFeatureDetails","featureId","sess","sessions","getLayoutId","layout","cachedLayout","xref","getDataByID","ReactComponent","ServerSideRendererType","cytobandLocation","defaultValue","uri","explicitlyTyped","CytobandAdapter","loc","readConfObject","config","openLocation","readFile","data","split","filter","trim","line","refName","start","end","uniqueId","BaseAdapter","CorePlugin","Object","values","coreRpcMethods","RpcMethod","addRpcMethod","addAdapterType","AdapterType","cytobandConfigSchema","AdapterClass","DataAdapter","addWidgetType","WidgetType","heading","stateModel","lazy","Plugin","url","version","configurationSchema","_pluginManager","Entries","Accordion","AccordionActions","AccordionDetails","Alert","AlertTitle","Autocomplete","Avatar","AvatarGroup","Backdrop","Badge","Box","Breadcrumbs","Button","ButtonGroup","Card","CardActions","CardActionArea","CardContent","CardHeader","CardMedia","CircularProgress","Collapse","ClickAwayListener","Chip","Checkbox","Container","Dialog","DialogActions","DialogTitle","DialogContent","DialogContentText","Divider","Drawer","Fab","Fade","FilledInput","FormLabel","FormControl","FormControlLabel","FormHelperText","FormGroup","Grid","Grow","Icon","IconButton","Input","InputBase","InputLabel","InputAdornment","Link","LinearProgress","List","ListItem","ListItemAvatar","ListItemSecondaryAction","ListItemIcon","ListSubheader","ListItemText","Menu","MenuItem","MenuList","Modal","NativeSelect","OutlinedInput","Pagination","PaginationItem","Paper","Popover","Popper","Portal","Radio","RadioGroup","Rating","ScopedCssBaseline","Select","Skeleton","Slider","Snackbar","SnackbarContent","SpeedDial","SpeedDialAction","SpeedDialIcon","Stack","Step","StepButton","StepConnector","StepLabel","StepIcon","Stepper","SvgIcon","Switch","Tab","Table","TableBody","TableCell","TableContainer","TableFooter","TableHead","TablePagination","TableRow","TableSortLabel","Tabs","TextField","TextareaAutosize","ToggleButton","ToggleButtonGroup","Toolbar","Tooltip","Typography","LazyMUICore","fromEntries","entries","key","props","Suspense","fallback","MaterialPrefixMUI","MuiPrefixMUI","Attributes","FeatureDetails","BaseCard","DataGridEntries","DataGrid","then","module","default","GridActionsCellItem","GridAddIcon","GridArrowDownwardIcon","GridArrowUpwardIcon","GridAutoSizer","GridCellCheckboxForwardRef","GridCellCheckboxRenderer","GridCheckCircleIcon","GridCheckIcon","GridCloseIcon","GridColumnHeaderSeparator","GridColumnHeaderSortIcon","GridColumnIcon","GridColumnMenu","GridColumnMenuContainer","GridDragIcon","GridExpandMoreIcon","GridFilterAltIcon","GridFilterForm","GridFilterListIcon","GridFilterPanel","GridFooter","GridFooterContainer","GridHeader","GridHeaderCheckbox","GridKeyboardArrowRight","GridLoadIcon","GridLoadingOverlay","GridMenuIcon","GridMoreVertIcon","GridNoRowsOverlay","GridOverlay","GridPagination","GridPanel","GridPanelWrapper","GridPreferencesPanel","GridRemoveIcon","GridRoot","GridRowCount","GridSaveAltIcon","GridScrollArea","GridSearchIcon","GridSelectedRowCount","GridSeparatorIcon","GridTableRowsIcon","GridToolbar","GridToolbarColumnsButton","GridToolbarContainer","GridToolbarDensitySelector","GridToolbarExport","GridToolbarExportContainer","GridToolbarFilterButton","GridTripleDotsVerticalIcon","GridViewHeadlineIcon","GridViewStreamIcon","LazyDataGridComponents","libs","mobx","mst","react","React","ReactDom","mxreact","useGridApiContext","useGridApiRef","useGridRootProps","MUIUtils","makeStyles","useTheme","alpha","MUIStyles","useStyles","classes","PropTypes","pluggableElementTypes","ViewType","DisplayType","TrackType","pluggableElementTypeModels","CircularChordRendererType","BoxRendererType","FeatureRendererType","Configuration","mstTypes","coreUi","coreUtil","coreColor","coreLayouts","trackUtils","Base1DView","coreIo","coreMstReflection","rxjs","BaseAdapterExports","libsList","Array","from","keys","inLibsOnly","mod","reExportsList","length","join","inReExportsOnly","includes","BaseResult","label","renderingComponent","displayString","matchedAttribute","matchedObject","textSearchAdapter","relevance","score","locString","results","newScore","getLabel","getLocation","getTrackId","RefSequenceResult","typeModels","stringArray","stringArrayMap","numberMap","boolean","color","integer","number","string","text","fileLocation","FileLocation","frozen","fallbackDefaults","locationType","literalJSON","views","valueJSON","value","objectJSON","typeModelExtensions","add","val","push","removeAtIndex","idx","splice","setAtIndex","set","remove","delete","addToKey","ar","get","removeAtKeyIndex","setAtKeyIndex","JexlStringType","str","startsWith","isEmptyArray","thing","isArray","makeConfigurationSchemaModel","modelName","schemaDefinition","options","identifier","modelDefinition","explicitIdentifier","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","definition","slotName","slotDefinition","isType","isLateType","isConfigurationSchemaType","description","model","contextVariable","configSlotModelName","charAt","toUpperCase","slice","slot","volatile","isCallback","String","expr","getEnv","jest","console","warn","stringToJexlExpression","jexl","evalSync","newVal","reset","convertToCallback","convertToValue","funcResult","e","extend","m","defineProperty","ConfigSlot","completeModel","setSubschema","newSchema","isStateTreeNode","create","identifierDefault","modelDefault","defaultSnap","getSnapshot","newSnap","matchesDefault","inputSchemaDefinition","inputOptions","baseConfiguration","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","ConfigurationReference","confObject","slotPath","TypeError","isMapType","getType","appliedFunc","newPath","subConf","isConfigurationModel","getTypeNamesFromExplicitlyTypedUnion","maybeUnionType","resolveLateType","isUnionType","typeNames","getUnionSubTypes","typeName","getDefaultValue","isBareConfigurationSchemaType","isModelType","every","t","isOptionalType","getSubType","isArrayType","isConfigurationSlotType","EmptyConfig","getSubAdapter","idMaker","arg","capabilities","BaseFeatureDataAdapter","_opts","region","ObservableCreate","observer","hasDataForRefName","hasData","getFeatures","subscribe","complete","merge","getFeaturesInRegion","refNames","scoresToStats","blankStats","Promise","all","getRegionStats","scoreMax","a","reduce","b","Math","max","scoreMin","min","scoreSum","scoreSumSquares","featureCount","basesCovered","rectifyStats","lastTime","Date","now","statsFromInterval","expansionTime","sampleCenter","query","round","features","maybeRecordStats","featureDensity","interval","stats","statsSampleFeatures","refLen","currTime","Infinity","BaseSequenceAdapter","isSequenceAdapter","isRegionsAdapter","isRefNameAliasAdapter","isTextSearchAdapter","adapterConfigCacheKey","adapterCache","adapterConfigSnapshot","cacheKey","adapterType","dataAdapterType","getAdapterType","bind","getAdapterClass","CLASS","sessionIds","Set","cacheEntry","specKeys","size","stuff","adapterCapabilities","adapterMetadata","PluggableElementBase","AddTrackWorkflow","ConnectionType","displayName","configEditorComponent","viewType","InternetAccountType","_rpcDriverClassName","blobMap","getBlobMap","augmentLocationObjects","isAppRootModel","internetAccountPreAuthorization","account","findAppropriateInternetAccount","getPreAuthorizationInformation","serializedArgs","setBlobMap","isRemoteAbortSignal","deserializeAbortSignal","originalReturn","_args","isAuthNeededException","retryAccount","createEphemeralInternetAccount","URL","origin","RetryError","internetAccountId","isAlive","isUriLocation","serializeNewAuthArguments","TextSearchAdapterType","displayTypes","display","extendedName","HeadingComponent","BaseViewModel","minimized","width","menuItems","setDisplayName","setWidth","newWidth","setMinimized","flag","assemblyNames","tracks","pluggableConfigSchemaType","afterAttach","connect","addTrackConf","trackConf","addTrackConfs","trackConfs","setTrackConfs","cast","clear","BaseDisplay","rpcDriverName","rendererTypeName","error","RenderingComponent","getDisplayType","DisplayBlurb","parentTrack","getParent","isRoot","renderProps","getParentRenderProps","displayModel","DisplayMessageComponent","trackMenuItems","viewMenuActions","regionCannotBeRendered","setError","setRpcDriverName","reload","inWebWorker","sessionStorage","InternetAccount","authHeader","tokenType","domains","toggleContents","SelectorComponent","selectorLabel","handlesLocation","location","some","domain","tokenKey","getTokenFromUser","resolve","reject","storeToken","token","setItem","removeToken","removeItem","retrieveToken","getItem","validateToken","tokenPromise","getToken","authInfo","x","addAuthHeaderToInit","init","tokenInfoString","newHeaders","Headers","headers","append","authToken","validatedToken","internetAccountType","getFetcher","input","newInit","fetch","RemoteFileWithRangeCache","BaseInternetAccountConfig","createBaseTrackModel","baseTrackConfig","displays","rpcSessionId","d","flat","canConfigure","isSessionModelWithConfigEditing","adminMode","sessionTracks","find","activateConfigurationUI","getContainingView","editTrackConfiguration","hideTrack","showTrack","showDisplay","displayId","initialSnapshot","schema","conf","resolveIdentifier","getRoot","displayType","hideDisplay","transaction","replaceDisplay","oldId","newId","findIndex","displayChoices","compatibleDisplayTypes","getViewType","compatibleDisplays","shownId","displayConf","checked","onClick","createBaseTrackConfig","category","metadata","adapter","textSearching","indexingAttributes","indexingFeatureTypesToExclude","formatDetails","formatAbout","hideUris","s","getTrackType","has","addDisplayConf","LayoutSession","bpPerPx","update","assign","MultiLayout","GranularRectLayout","maxHeight","displayMode","pitchX","pitchY","subLayoutConstructorArgs","deepEqual","cachedLayoutIsValid","makeLayout","createSession","renderArgs","maxFeatureGlyphExpansion","bpExpansion","floor","ceil","rpcManager","freed","discardRange","json","PrecomputedLayout","deserializeLayoutInClient","getWorkerSession","getSublayout","serialized","serializeRegion","getExpandedRegion","rectangles","Boolean","maxHeightReached","createLayoutInWorker","FeatureRenderer","ComparativeServerSideRenderer","deserialized","blockKey","call","passes","requestRegions","requestRegion","featurePassesFilters","ServerSideRenderer","selectedFeatureId","deserializedFeatures","Map","j","iterMap","_renderArgs","featureObservable","supportsSVG","reactElement","ServerSideRenderedContent","ssrContainerNode","useRef","theme","html","jbrowseTheme","createJBrowseTheme","useEffect","domNode","current","unmountComponentAtNode","innerHTML","rIC","hydrate","timeout","ref","className","exportSVG","SerializableFilterChain","renderToString","height","canvasRecordedData","C2S","ctx","CanvasSequence","execute","getSvg","statusCallback","deserializeArgsInWorker","updateStatus","serializeResultsInWorker","freedRpc","filterChain","inputFilter","i","paper","overflowY","zIndex","drawer","outline","background","palette","resizeHandle","position","top","children","drawerPosition","drawerWidth","elevation","square","ResizeHandle","onDrag","resizeDrawer","vertical","style","left","formControl","margin","spacer","flexGrow","drawerSelect","secondary","contrastText","dropDownIcon","header","main","DrawerHeader","setToolbarHeight","visibleWidget","activeWidgets","useState","anchorEl","setAnchorEl","AppBar","getBoundingClientRect","disableGutters","icon","renderValue","widgetId","widget","variant","widgetType","getWidgetType","onChange","w","target","showWidget","notify","hideWidget","Delete","event","currentTarget","MoreVert","title","minimizeWidgetDrawer","Minimize","Close","open","onClose","option","selected","setDrawerPosition","DrawerComponent","evaluateExtensionPoint","toolbarHeight","LoadingEllipses","ErrorBoundary","FallbackComponent","ErrorMessage","root","buttonRoot","backgroundColor","primary","action","hoverOpacity","menuTitle","setOpen","handleClose","anchorOrigin","horizontal","onMenuItemClick","_event","callback","ResetComponent","onFactoryReset","resetButtonText","dialogOpen","setDialogOpen","componentStack","window","isBlobLocation","filename","marginLeft","spacing","setLocation","isLocalPathLocation","localPath","needToReload","getBlob","blobId","flexDirection","alignItems","fullWidth","component","hidden","file","files","isElectron","path","storeBlobLocation","blob","inputProps","ContentCopy","TrackSelector","Cable","dots","content","textAlign","animation","keyframes","message","snackbarMessage","setSnackbarMessage","popSnackbarMessage","snackbarMessages","latestMessage","timeoutId","setTimeout","clearTimeout","reason","level","severity","viewContainer","overflow","grow","paddingBottom","paddingTop","inputBase","inputRoot","light","inputFocused","borderColor","ViewMenu","IconButtonProps","IconProps","items","ArrowUpward","moveViewUp","ArrowDownward","moveViewDown","fontSize","ViewContainer","onMinimize","padWidth","useMeasure","parseInt","scrollRef","scrollIntoView","block","padding","arrow","setValue","category10","dark2","set1","set2","tableau10","ggplot2Colors6","ggplot2Colors5","ggplot2Colors4","ggplot2Colors3","moveTo","interRegionPaddingWidth","displayedRegions","minimumBlockWidth","len","bpSoFar","index","offset","lengthBetween","numBlocksWideEnough","targetBpPerPx","newBpPerPx","zoomTo","extraBp","bpToStart","scrollTo","pxToBp","px","offsetPx","blocks","staticBlocks","contentBlocks","bp","oob","coord","reversed","interRegionPaddingBp","currBlock","regionNumber","assemblyName","bpToPx","Region","volatileWidth","setDisplayedRegions","setBpPerPx","setVolatileWidth","displayedRegionsTotalPx","totalBp","maxOffset","minOffset","dynamicBlocks","calculateDynamicBlocks","calculateStaticBlocks","currBp","setFeatures","showAllRegions","zoomOut","zoomIn","oldBpPerPx","clamp","newOffsetPx","centerAt","centerPx","scroll","distance","oldOffsetPx","BlockSet","ElidedBlock","lastBlock","toRegion","func","thisarg","widthPx","ContentBlock","BaseBlock","isLeftEndOfDisplayedRegion","constructor","elidedBlockCount","otherBlock","InterRegionPaddingBlock","elision","displayedRegionLeftPx","windowLeftPx","windowRightPx","regionStart","regionEnd","displayedRegionRightPx","regionWidthPx","parentRegion","isRightEndOfDisplayedRegion","blockOffsetPx","intersection2","leftPx","rightPx","blockData","assembleLocStringFast","extra","modelWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","regionBpOffset","regionBlockCount","windowRightBlockNum","windowLeftBlockNum","blockNum","colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","contrastingTextColor","getLuminance","convertedColor","muiGetLuminance","emphasize","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","darken","lighten","hashCode","inDevelopment","process","inProduction","useDebounce","delay","debouncedValue","setDebouncedValue","handle","useDebouncedCallback","wait","argsRef","cleanup","findParentThat","node","predicate","hasParent","currentNode","springAnimate","fromValue","toValue","animationFrameId","onFinish","precision","tension","friction","mass","time","lastPosition","velocity","lastVelocity","numSteps","isVelocity","abs","isDisplacement","requestAnimationFrame","cancelAnimationFrame","findParentThatIs","isSessionModel","isViewModel","getContainingTrack","isTrackModel","getContainingDisplay","isDisplayModel","assembleLocString","toLocale","startString","endString","cb","n","assemblyNameString","rev","parseLocStringOneBased","isValidRefName","endsWith","replace","assemblyMatch","match","lastColonIdx","lastIndexOf","prefix","suffix","rangeMatch","singleMatch","separator","parseLocString","parsed","compareLocs","locA","locB","assemblyComp","localeCompare","refComp","startComp","endComp","compareLocStrings","num","oneEightyOverPi","PI","piOverOneEighty","radToDeg","radians","degToRad","degrees","polarToCartesian","rho","theta","cos","sin","cartesianToPolar","y","sqrt","atan","featureSpanPx","bpSpanPx","leftBp","rightBp","iterable","sizeHint","counter","item","findLastIndex","array","l","makeAbortableReaction","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","isAbortException","reaction","mobxReactionHandle","aborted","abort","AbortController","thisInProgress","renameRegionIfNeeded","refNameMap","newRef","originalRefName","getRefNameMapForAdapter","assemblyMaps","minmax","shorten","short","test","navigator","userAgent","revcom","seqString","reverse","complement","complementRegex","complementTable","S","T","N","K","Y","V","M","h","k","C","g","A","W","X","B","H","c","D","R","G","blobToDataURL","FileReader","onload","readAsDataURL","requestIdleCallback","widths","measureText","avg","total","code","charCodeAt","defaultStarts","defaultStops","defaultCodonTable","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","generateCodonTable","table","tempCodonTable","codon","aa","nucs","nuc","toLowerCase","n0","n1","n2","msg","fn","res","hash","objectHash","bytesForRegions","blocksForRange","blockResults","minv","blockPosition","maxv","supportedIndexingAdapters","getBpDisplayStr","parseFloat","toPrecision","toLocaleString","getTickDisplayStr","toFixed","getViewParams","staticblock","staticblock1","offsetPx1","layoutId","useLocalStorage","initialValue","localStorage","storedValue","setStoredValue","valueToStore","Function","getUriLink","href","baseUri","getStr","isObject","measureGridWidth","elements","element","getEnvMST","fetchers","globalRangeCache","HttpRangeFetcher","fetcher","chunkSize","maxFetchSize","minimumTTL","fetchBinaryRange","requestHeaders","range","rangeParse","exec","getRange","response","Response","buffer","status","requestDate","responseDate","errorMessage","statusText","hint","arrayBuffer","Buffer","RemoteFile","isNode","LocalFile","BlobFile","absoluteLocation","internetAccount","getInternetAccount","checkAuthNeededFetch","isRootModelWithInternetAccounts","getInternetAccountType","AuthNeededError","toString","addFunction","parent","log","log10","Number","char","pos","codePointAt","search","pad","padEnd","fill","padStart","repeat","replaceAll","substring","trimEnd","trimStart","tags","addBinaryOp","compilationCache","compiled","compile","createJexlInstance","minSizeToBotherWith","segmentsIntersect","x1","x2","y1","y2","LayoutRow","allFilled","widthLimit","rowState","bits","right","maxX","rectWidth","rect","initialize","oLeft","oRight","currLength","additionalLength","concat","leftTrimAmount","rightTrimAmount","trimAmount","desiredLength","hardRowLimit","bitmap","pTotalHeight","storedRec","addRectToBitmap","pLeft","pRight","pHeight","rectangle","originalHeight","maxTop","collides","maxY","row","isRangeClear","yEnd","autovivifyRow","setAllFilled","addRect","pY","pX","getItemAt","getTotalHeight","regionRectangles","containsNoTransferables","totalHeight","getRectangles","SubLayoutClass","subLayouts","layoutName","subLayout","sublayout","rbush","RBush","insert","minX","minY","_rect","_top","_data","_left","_right","_region","ThrowingLayout","PrecomputedMultiLayout","sublayoutJson","SceneGraph","absoluteCache","isNaN","dirty","nameOrSceneGraph","child","absolute","childLeft","childRight","childTop","childBottom","bottom","expand","newLeft","newRight","newTop","newBottom","diff","walkParents","walkChildren","xOffset","yOffset","_subtype","_subType","subType","unionType","_types","getPropertyType","propertyName","properties","_defaultValue","getEnumerationValues","maybeLate","left1","right1","left2","right2","doesIntersect2","isContainedWithin","Observable","catch","takeUntil","observeAbortSignal","isFeature","isSimpleFeatureSerialized","parentHandle","aliases","strand","p","parentId","calcStdFromSums","sum","sumSquares","variance","population","scoreMean","scoreStdDev","seed","summary","MAX_VALUE","MIN_VALUE","getTrackAssemblyNames","trackAssemblyNames","getRpcSessionId","thisNode","highestRpcSessionId","UNKNOWN","UNSUPPORTED","makeIndex","makeIndexType","typeA","typeB","getFileName","guessAdapter","adapterHint","_file","_index","_adapterHint","adapterGuesser","guessTrackType","_adapterName","trackTypeGuesser","generateUnsupportedTrackConf","trackName","trackUrl","categories","generateUnknownTrackConf","getTrackName","asm","assemblies","sequence","shortid","propTypes","ConfigSchema","MxPropTypes","Feature","NoAssemblyRegion","setRefName","newRefName","LocalPathLocation","BlobLocation","UriLocationRaw","UriLocation","postProcessor","preProcessor","getNextRefPos","mdRegex","RegExp","modificationRegex","parseCigar","cigar","cigarToMismatches","ops","seq","qual","roffset","soffset","mismatches","hasRefAndSeq","op","base","altbase","q","cliplen","mdToMismatches","mdstring","cigarMismatches","mismatchRecords","curr","skips","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","mismatch","getMismatches","cigarOps","positions","readPos","refPos","currPos","getModificationPositions","mm","fseq","fstrand","mods","basemod","matches","delta","temp","sort","getModificationTypes","mismatchLen","isInterbase","inc","bin","field","thisBin","SNPCoverageAdapter","subadapterConfig","sequenceConf","sequenceAdapter","subadapter","configure","fetchSequence","generateCoverageBins","bins","skipmap","next","snpinfo","skip","xs","colorBy","binMax","shouldFetchReferenceSequence","regionSeq","fstart","fend","lowqual","cov","delskips","noncov","getTagAlt","epos","methBins","l1","l2","bin1","colorSNPs","mstart","mlen","mend","interbase","refbase","getTag","fetchSizeLimit","cramLocation","craiLocation","bamLocation","indexType","htsgetBase","htsgetTrackId","hiddenFromGUI","clipColor","indicatorThreshold","drawArcs","drawInterbaseCounts","drawIndicators","SNPCoverageRenderer","displayCrossHatches","modificationTagMap","scaleOpts","unadjustedHeight","configTheme","cfg","ticks","YSCALEBAR_LABEL_OFFSET","viewScale","getScale","indicatorViewScale","scaleType","originY","getOrigin","toY","toHeight","indicatorToY","indicatorToHeight","bases","colorForBase","insertion","softclip","hardclip","meth","unmeth","coverage","fillStyle","fillRect","prevTotal","extraHorizontallyFlippedOffset","totalScore","interbaseEvents","accum","maxBase","indicatorComparatorScore","beginPath","lineTo","neg","strokeStyle","lineWidth","bezierCurveTo","stroke","tick","WiggleBaseRenderer","register","addRendererType","WiggleRendering","PileupLayoutSession","sortedBy","filterBy","showSoftClip","cw","getColorBaseMap","deletion","alignmentColoring","color_fwd_strand_not_proper","color_rev_strand_not_proper","color_fwd_strand","color_rev_strand","color_fwd_missing_mate","color_rev_missing_mate","color_fwd_diff_chr","color_rev_diff_chr","color_pair_lr","color_pair_rr","color_pair_rl","color_pair_ll","color_nostrand","color_interchrom","color_longinsert","color_shortinsert","PileupRenderer","charWidth","charHeight","heightPx","expansionBefore","expansionAfter","topPx","maxClippingSize","getOrientation","orientationType","LR","RR","RL","LL","orientationTypes","_config","flags","flipper","contrastForBase","canvasWidth","heightLim","letter","fillText","scores","Color","ml","probabilities","elt","modifications","probIndex","col","prob","hsl","regionSequence","leftPx2","flip","closePath","defaultColor","colorTagMap","tag","colorType","colorByInsertSize","colorByOrientation","colorByStranded","foundValue","drawRect","colorByPerBaseQuality","colorByPerBaseLettering","colorByModifications","colorByMethylation","minSubfeatureWidth","largeInsertionIndicatorScale","mismatchAlpha","drawSNPsMuted","drawIndels","pxPerBp","mbase","baseColor","contrastColor","txt","rwidth","insW","adjustPx","clearRect","minFeatWidth","getCharWidthHeight","getContrastText","layoutRecords","getContrastBaseMap","font","drawAlignmentRect","drawMismatches","drawSoftClipping","featureMap","featureArray","featuresInCenterLine","featuresOutsideCenter","innerArray","isCram","baseSortArray","baseMap","aMismatch","bMismatch","acode","bcode","sortFeature","layoutFeature","layoutFeats","renderToAbstractCanvas","makeImageData","onMouseMove","featureIdUnderMouse","contextMenuFeature","highlightOverlayCanvas","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","mouseMove","offsetX","offsetY","canvas","clientX","clientY","clientBp","featIdUnderMouse","getFeatureOverlapping","callMouseHandler","handlerName","featureHandler","canvasHandler","getContext","selectedRect","getFeatureByID","bottomPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","strokeRect","highlightedFeature","highlightedRect","PrerenderedCanvas","onMouseDown","onMouseEnter","onMouseOut","onMouseOver","onMouseUp","onMouseLeave","onContextMenu","onFocus","onBlur","noSpacing","pileupDisplay","snpCoverageDisplay","baseLinearDisplayConfigSchema","PileupDisplay","SNPCoverageDisplay","snpCovHeight","showCoverage","showPileup","userFeatureScreenDensity","scrollTop","toggleCoverage","togglePileup","setScrollTop","setSNPCoverageHeight","superTrackMenuItems","pileupDisplayConfig","searchFeatureByID","sortedByPosition","sortedByRefName","snpCoverageDisplayConfig","subMenu","setSNPCoverageDisplay","updateStatsLimit","setPileupDisplay","setHeight","displayHeight","resizeHeight","oldHeight","setConfig","setFilterBy","setColorBy","renderSvg","pileupHeight","when","ready","overrideHeight","transform","addDisplayType","configSchemaFactory","modelFactory","en","pct","toP","TooltipContents","reactRef","rn1","r1","info","entry","featureUnderMouse","getUniqueTagValues","colorScheme","getUniqueModificationValues","rendererTypes","linearWiggleDisplayModelFactory","flagInclude","flagExclude","readName","tagFilter","observable","updateModificationColorMap","uniqueModifications","colorPalette","newColor","superRenderProps","rendererConfig","configBlob","drawArcsSetting","drawInterbaseCountsSetting","drawIndicatorsSetting","modificationsReady","superProps","notReady","toggleDrawIndicators","toggleDrawInterbaseCounts","toggleDrawArcs","initialized","estimatedStatsReady","regionTooLarge","TooltipComponent","needsScalebar","contextMenuItems","autoscale","minScore","maxScore","inverted","multiTicks","renderers","LinearWiggleDisplayReactComponent","defaultRendering","maxFeatureScreenDensity","linearBasicDisplayConfigSchemaFactory","ColorByTagDlg","FilterByTagDlg","SortByTagDlg","SetFeatureHeightDlg","SetMaxHeightDlg","ModificationsDlg","BaseLinearDisplay","showSoftClipping","featureHeight","fadeLikelihood","trackMaxHeight","featureUnderMouseVolatile","currSortBpPerPx","setReady","setCurrSortBpPerPx","setMaxHeight","setFeatureHeight","setNoSpacing","setColorScheme","totalKeys","updateColorTagMap","uniqueTag","setFeatureUnderMouse","renderInClient","selectFeature","isSessionModelWithWidgets","featureWidget","addWidget","setSelection","clearSelected","copyFeatureToClipboard","copy","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","centerBp","superReload","featureHeightSetting","mismatchAlphaSetting","viewName","MenuOpenIcon","clearFeatureSelection","ContentCopyIcon","LinearPileupDisplayBlurb","onFeatureClick","onFeatureContextMenu","setContextMenuFeature","VisibilityIcon","SortIcon","disabled","queueDialog","PaletteIcon","doneCallback","FilterListIcon","BaseLinearDisplayComponent","addTrackType","linearAlignmentsDisplay","baseModel","baseModelFactory","PileupGetGlobalValueForTag","rpcDriverClassName","deArgs","featuresArray","uniqueValues","PileupGetVisibleModifications","AlignmentsPlugin","CramAdapterF","BamAdapterF","LinearPileupDisplayF","LinearSNPCoverageDisplayF","AlignmentsTrackF","SNPCoverageAdapterF","HtsgetBamAdapterF","PileupRendererF","SNPCoverageRendererF","LinearAlignmentsDisplayF","AlignmentsFeatureWidgetF","addToExtensionPoint","adapterName","fileName","indexName","alt","fr","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","getPlugin","exports","blockType","renderDelay","handler","arcsRendered","textStroke","caption","strokeWidth","tooltipWidth","textYCoord","pointerEvents","triggerRef","rx","ry","fillOpacity","textLength","thickness","MyProjectPlugin","ArcRenderer","ArcRendererReactComponent","ArcRendererConfigSchema","linearArcDisplayConfigSchemaFactory","LinearArcDisplayStateModelFactory","attributeName","authEndpoint","tokenEndpoint","needsPKCE","clientId","scopes","state","responseType","hasRefreshToken","fixup","buf","codeVerifier","codeVerifierPKCE","global","getGlobalObject","Uint8Array","crypto","getRandomValues","refreshTokenKey","storeRefreshToken","refreshToken","removeRefreshToken","retrieveRefreshToken","exchangeAuthorizationForAccessToken","redirectUri","grant_type","client_id","code_verifier","redirect_uri","params","URLSearchParams","method","body","ok","accessToken","refresh_token","access_token","exchangeRefreshForAccessToken","error_description","listener","refreshTokenPromise","addMessageChannel","finishOAuthWindow","addEventListener","deleteMessageChannel","removeEventListener","redirectUriWithInfo","fixedQueryString","redirectUrl","queryStringSearch","urlParams","pathname","useEndpointForAuthorization","response_type","scope","sha256","Base64","codeChallenge","code_challenge","code_challenge_method","token_access_type","eventName","require","ipcRenderer","invoke","eventFromDesktop","MessageEvent","decoded","jwtDecode","exp","getTime","newToken","validateWithHEAD","ExternalTokenEntryForm","setToken","maxWidth","required","HTTPBasicLoginForm","username","setUsername","password","setPassword","onSubmit","btoa","preventDefault","autoComplete","OAuthConfigSchema","dropboxErrorMessages","shared_link_not_found","shared_link_access_denied","unsupported_link_type","shared_link_is_directory","DropboxIcon","getDescriptiveErrorMessage","errorMessageParsed","messageTag","named","Authorization","GoogleDriveFile","source","statsPromise","metadataOnly","GoogleDriveIcon","urlId","driveUrl","searchParams","credentials","AuthenticationPlugin","OAuthInternetAccountModelFactory","ExternalTokenConfigSchema","ExternalTokenInternetAccountModelFactory","HTTPBasicConfigSchema","HTTPBasicInternetAccountModelFactory","DropboxOAuthConfigSchema","DropboxOAuthInternetAccountModelFactory","GoogleDriveOAuthConfigSchema","GoogleDriveOAuthInternetAccountModelFactory","addInternetAccountType","bigBedLocation","bedGzLocation","columnNames","scoreColumn","autoSql","bedLocation","colRef","colStart","colEnd","BedPlugin","bigBedAdapterConfigSchema","bedTabixAdapterConfigSchema","bedAdapterConfigSchema","TOP","BOTTOM","getPxFromCoordinate","yPos","trackConfigId","chunk","trackRefs","heightFromSpecificLevel","useNextFrame","variable","setNextFrameState","LEFT","RIGHT","parentRef","showIntraviewLinks","assembly","totalFeatures","getTrackFeatures","hasPaired","useMemo","layoutMatches","candidates","alreadySeen","unmapped","correctlyPaired","getBadlyPairedAlignments","getMatchedAlignmentFeatures","getMatchedFeaturesInLayout","mouseoverElt","setMouseoverElt","c1","f1","level1","c2","f2","level2","f1origref","f2origref","f1ref","getCanonicalRefName","f2ref","s1","s2","p1","p2","reversed1","reversed2","getTrack","Path","curveTo","feature1","feature2","alts","cur","bnd","parseBreakend","MatePosition","getMatchedBreakendFeatures","yoff","relevantAlt","feat1","feat2","findMatchingAlt","Join","MateDirection","headerBar","gridArea","InteractWithSquiggles","toggleInteract","interactToggled","LocationSearching","LocationDisabled","LinkViews","toggleLinkViews","linkViews","LinkOff","Sync","toggleIntraviewLinks","LeakAdd","LeakRemove","getMatchedTranslocationFeatures","chr2","CHR2","end2","END","STRANDS","myDirection","mateDirection","marginBottom","breakpointMarker","viewDivider","container","overlay","cursor","Overlay","getMatchedTracks","hasTranslocations","BreakpointSplitView","viewComponent","matchedTracks","intersect","a1","a2","ids","a12","getBlockFeatures","waitForAssembly","trackSelectorType","matchedTrackFeatures","calc","onAction","onSubviewAction","actionName","getPath","removeView","closeView","setMatchedTrackFeatures","BreakpointSplitViewType","endPos","startPos","mateRefName","featureRefName","topRegion","startMod","endMod","INFO","matePosition","mate","bottomRegion","topMarkedRegion","bottomMarkedRegion","hideHeader","load","BreakpointSplitViewModel","BreakpointSplitViewComponent","BreakpointSplitViewPlugin","addViewType","jbrequire","BreakpointSplitViewFactory","alignmentsFeatureDetailConfigSchema","alignmentsFeatureDetailStateModel","findCircleIntersectionX","cx","cy","resultArray","solution","findCircleIntersectionY","cartesianToTheta","twoPi","Slice","currentRadianOffset","radianWidth","offsetRadians","startRadians","endRadians","bpPerRadian","flipped","widthBp","freeze","radiusPx","totalRadians","elided","sliceIsVisible","r1start","r1length","r2start","r2length","visibleSection","visibleThetaMin","visibleThetaMax","hideVerticalResizeHandle","hideTrackSelectorButton","lockedFitToWindow","disableImportForm","scrollX","scrollY","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","staticSlices","slices","elidedRegions","pxPerRadian","calculateStaticSlices","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","circumferencePx","elidedBp","maximumRadiusPx","maxBpPerPx","minCircumferencePx","minBpPerPx","maxCircumferencePx","atMaxBpPerPx","atMinBpPerPx","tooSmallToLock","figureDimensions","figureWidth","figureHeight","visible","lastVisible","displayedRegion","visibleStaticSlices","newHeight","setModelViewWhenAdjust","resizeWidth","oldWidth","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","zoomInButton","zoomOutButton","secondCondition","previouslyEmpty","activateTrackSelector","selector","toggleTrack","supportedDisplays","toggleFitToWindowLock","tertiary","quaternary","strokeDasharray","strokeDashoffset","duration","radius","shown","setShown","patternTransform","patternUnits","dominantBaseline","textAnchor","strokeLinecap","filled","mainThreadRendering","renderReactionData","blockDefinitions","renderReactionEffect","cannotBeRenderedReason","isCompatibleWithRenderer","BaseChordDisplayModel","bezierRadiusRatio","onChordClick","origSlices","renamed","bezierRadius","ThisRendererType","selection","renderStarted","renderSuccess","renderError","setRefNameMap","fireImmediately","baseChordDisplayConfig","CircularViewPlugin","addView","isAbstractMenuManager","appendToSubMenu","DataUsageIcon","targetAssembly","queryAssembly","pafLocation","mcscanAnchorsLocation","bed1Location","bed2Location","mcscanSimpleAnchorsLocation","outLocation","deltaLocation","chainLocation","ComparativeAdaptersPlugin","PAFAdapterF","DeltaAdapterF","ChainAdapterF","MCScanAnchorsAdapterF","MCScanSimpleAnchorsAdapterF","MashMapAdapterF","fontFamily","callbackEditor","marginTop","border","callbackContainer","overflowX","textAreaFont","contents","setContents","shrink","htmlFor","helperText","multiline","InputProps","FromConfigAdapter","makeFeatures","fdata","makeFeature","bucket","FromConfigRegionsAdapter","currentRegion","FromConfigSequenceAdapter","RefNameAliasAdapter","refColumn","setTarget","newTarget","refNameColumn","LazyConfigurationEditorComponent","fromConfigAdapterConfigSchema","fromConfigRegionsAdapterConfigSchema","fromConfigSequenceAdapterConfigSchema","refNameAliasAdapterConfigSchema","ConfigurationEditorHeadingComponent","ConfigurationEditorConfigSchema","ConfigurationEditorStateModelFactory","isAbsoluteUrl","trackSource","trackData","indexTrackData","altAssemblyName","altTrackName","altTrackType","textIndexTrack","textIndexingConf","setAdapterHint","setTrackSource","setTextIndexingConf","setTextIndexTrack","setTrackData","setIndexTrackData","setAssembly","setTrackName","setTrackType","clearData","trackAdapter","isFtp","isRelativeTrackUrl","isRelativeIndexUrl","isRelativeUrl","trackHttp","indexHttp","wrongProtocol","protocol","unsupported","warningMessage","hasAnyOverlap","filterTracks","allAliases","generateHierarchy","trackConfigurations","collapsed","hierarchy","filterText","filterLower","passesFilter","unshift","currLevel","isOpenByDefault","stateTreeFactory","addToSelection","removeFromSelection","clearSelection","setView","toggleCategory","pathName","clearFilterText","setFilterText","newText","getRefSeqTrackConf","refseq","connectionTrackConfigurations","connection","hier","connectionInstances","conns","connectionHierarchy","expanded","hubTxtLocation","baseConnectionConfig","hubFileLocation","hubFileText","HubFile","fetchGenomesFile","genomesFileLocation","genomesFileText","GenomesFile","fetchTrackDbFile","trackDbFileLocation","TrackDbFile","generateTracks","trackDb","trackKeys","parentTrackKeys","parentTracks","currentTrackName","makeTrackConfig","bigDataLocation","bigDataIndexLocation","baseTrackType","bigWigLocation","vcfGzLocation","hicLocation","UCSCTrackHubConnection","BaseConnectionModelFactory","connectionName","fetchHubFile","hubFile","genomesFile","trackDbData","genomeName","genome","assemblyConf","trackDbFile","breakConnection","locstr","includeAsm","getBlockLabelKeysToHide","viewOffsetPx","blockLabelKeysToHide","sortedBlocks","alen","labelBounds","chooseGridPitch","scale","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","majorMagnitude","toExponential","majorPitch","majorPitchPx","minorPitch","makeTicks","emitMajor","emitMinor","gridPitch","iterPitch","minBase","Dotplot1DView","scaleFactor","setScaleFactor","DotplotHView","viewWidth","DotplotVView","viewHeight","loading","paddingLeft","backgroundImage","blockMessage","blockError","LoadingMessage","BlockMessage","messageText","BlockError","warnings","renderInProgress","ReactComponent2","ServerSideRenderedBlockContent","borderSize","borderX","borderY","renderBlockData","renderBlockEffect","setLoading","setRendered","abortController","setMessage","vview","hview","posColor","negColor","thresholdsPalette","thresholds","MismatchParser","lt","gt","drawCir","arc","DotplotRenderer","clampWithWarnX","clampWithWarnY","effect","drawCigar","db1","db2","hBpPerPx","vBpPerPx","hsnap","vsnap","mateRef","identity","b10","b20","e10","e20","b1","b2","e1","e2","currX","currY","flipInsDel","dimensions","drawDotplot","ComparativeRenderer","tryTrack","idsNotFound","ComparativeRender","rend","getRenderer","renameRegionsIfNeeeded","getLength","getLengthSansClipping","getClip","gatherOverlaps","groups","memo","group","intervals","stack","pop","mergeIntervals","clipPos","origStrand","readAssembly","trackAssembly","SAs","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","lengthOnRef","getLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","saRealStart","seqLength","CIGAR","totalLength","refLength","viewTrackConfigs","DotplotPlugin","tickSize","vtextRotation","htextRotation","cursorMode","volatileError","assemblyErrors","assembliesInitialized","hticks","vticks","highResolutionScaling","setCursorMode","setDrawCigar","clearView","setBorderX","setBorderY","setAssemblyNames","setViews","arr","getCoords","mousedown","mouseup","xmin","xmax","ymin","ymax","onDotplotView","d1","d2","rest1","rest2","viewSnapshot","beforeDestroy","removeTemporaryAssembly","axis","regionsSnapshot","vblocks","hblocks","by","bx","squareView","hpx","vpx","squareViewProportional","ratio","ReturnToImportFormDialog","FolderOpenIcon","TrackSelectorIcon","DotplotViewF","DotplotDisplayF","DotplotRendererF","LaunchDotplotViewF","pluggableElement","newStateModel","superContextMenuItems","AddIcon","DotplotReadVsRefMenuItem","TimelineIcon","GCContentPlugin","configSchemaF","GCContentAdapterF","LinearGCContentDisplayF","gffGzLocation","dontRedispatch","gffLocation","gff3TabixAdapterConfigSchema","gff3AdapterConfigSchema","LabeledRegionModel","RegionModel","setLabel","bookmarkedRegions","modelSelectedAssembly","importBookmarks","addBookmark","removeBookmark","clearAllBookmarks","updateBookmarkLabel","setSelectedAssembly","selectedAssembly","GridBookmarkConfigSchema","GridBookmarkStateModelFactory","superMenuItems","superRubberBandMenuItems","rubberBandMenuItems","activateBookmarkWidget","bookmarkWidget","widgets","bookmarkCurrentRegion","firstRegion","getSelectedRegions","leftOffset","rightOffset","BookmarksIcon","BookmarkIcon","gtfLocation","GtfPlugin","gtfAdapterConfigSchema","HicRenderer","resolution","getResolution","minBin","maxBin","abortBreakPoint","bin2","counts","rotate","setResolution","HicPlugin","hicAdapterConfigSchema","HicRendererReactComponent","hicRendererConfigSchema","linearHicdisplayConfigSchemaFactory","linearHicdisplayModelFactory","rootUrlTemplate","HttpMap","loadFile","meta","compress","track_names","hashHexCharacters","hash_bits","readMeta","getBucket","bucketIdent","hexToDirPath","hex","getHashHexCharacters","getCompress","substr","dirpath","crc32","JBrowse1TextSearchAdapter","httpMap","tracksNames","namesIndexLocation","searchType","queryString","getTrackNames","loadIndexFile","formatResults","exact","trackIndex","locstring","dataDirLocation","isTrack","deepUpdate","prop","src","prototype","nodeType","cloneNode","dest","copyFunc","empty","mixin","parseJB1Json","parsedConf","regularizeConf","parseJB1Conf","keyPath","operation","lineNumber","section","recordVal","parsedValue","existing","getValue","textLine","varName","isAlwaysArray","trackMetadata","sources","sourceDef","newSourceDef","typeMatch","sourceUrl","baseUrl","addBase","stores","names","refSeqs","nameUrl","trackConfig","trackClassName","store","regularizeClass","synthesizeTrackStoreConfig","histograms","mainConf","storeClass","urlTemplate","backendVersion","guessStoreClass","storeConf","useAsRefSeqStore","refseqs","dataRoot","baseConfig","include","baseConfigRoot","dataRootReg","dataRootLocation","baseProtocol","baseConfigLocation","newConfig","fetchedConfig","fetchConfigFile","mergeConfigs","createFinalConfig","defaults","configDefaults","configWithDefaults","loadIncludes","fillTemplates","finalConfig","validateConfig","parseJb1","aTracks","bTracks","mergeTrackConfigs","bT","aT","inputConfig","loadRecur","upstreamConf","newUpstreamConf","regularizeIncludes","loads","cacheBuster","includedData","format","subconfig","template","fillWith","fillTemplate","containerID","show_tracklist","show_nav","show_menu","show_overview","show_fullviewlink","update_browser_title","updateBrowserURL","datasets","_DEFAULT_EXAMPLES","volvox","modencode","yeast","highlightSearchedRegions","highResolutionMode","convertTrackConfig","jb1TrackConfig","jb2TrackConfig","Description","trackIdentifier","jb2Features","jb2Feature","seq_id","generateFromConfigTrackConfig","resolveUrlTemplate","baiUrlTemplate","csiUrlTemplate","craiUrlTemplate","tbiUrlTemplate","fastaLocation","faiUrlTemplate","faiLocation","gziUrlTemplate","gziLocation","twoBitLocation","fetchJb1","jb2Tracks","jb1Track","jb2Track","LegacyJBrowsePlugin","ncListAdapterConfigSchema","addTextSearchAdapterType","jbrowse1AdapterConfigSchema","JBrowse1TextSearchAdapterClass","addConnectionType","jbrowse1ConfigSchema","jbrowse1ModelFactory","Curves","StraightLines","LinearComparativeDisplay","defaultProps","middleComparativeHeight","param","setMiddleComparativeHeight","shownTracks","bpPerPxs","center","setNewView","trackIds","middle","baseConfigFactory","parentView","linearPileupDisplayConfigSchemaFactory","reg","regStart","regEnd","featStart","featEnd","mateStart","mateEnd","mateAsm","featAsm","featRef","rMateStart","rMateEnd","rFeatStart","rFeatEnd","view2","random","navToLocString","linearPileupDisplayStateModelFactory","navToSynteny","interstitialYPos","cond","generateMatches","tooltip","borderRadius","shape","common","typography","pxToRem","lineHeight","wordWrap","SyntenyTooltip","virtElement","usePopper","styles","attributes","popper","SanitizedHTML","MAX_COLOR_RANGE","colorMap","I","getId","unitMultiplier","drawMatchSimple","offsets","viewSnaps","hideTiny","drawCurves","ref1","ref2","v1","v2","length1","length2","px11","px12","px21","px22","x11","x12","x21","x22","mid","drawRef","clickMapRef","cigarClickMapRef","mouseoverRef","mouseoverId","setMouseoverId","clickId","setClickId","visibleCigarOp","setVisibleCigarOp","setCurrX","setCurrY","getResources","es","f1s","f1e","f2s","f2e","r2","parsedCIGARs","ctx1","ctx2","ctx3","imageSmoothingEnabled","resetTransform","cx1","cx2","f1flipped","rev1","rev2","continuingFlag","px1","px2","unitMultiplier2","isNotLast","getImageData","g1","g2","match1","cigarIdx","imageRendering","visibility","LinearSyntenyRenderer","realizedViews","serializedFeatures","_level","ComparativeServerSideRendererType","toggleCurves","CropFreeIcon","LinkOffIcon","LinkIcon","closeButton","ReadVsRefDialog","preFeature","windowSizeText","setWindowSize","primaryFeature","setPrimaryFeature","windowSize","done","SA","primaryAln","supplementaryAlignments","syntenyId","featSeq","configFeatureStore","seqTrackId","sequenceTrackConf","lgvRegions","addTemporaryAssembly","noAssemblyManager","showReverse","showTranslation","LinearComparativeViewF","LinearSyntenyViewF","LinearSyntenyRendererF","LinearComparativeDisplayF","LinearSyntenyDisplayF","stateModelF","LGVSyntenyDisplayF","LaunchLinearSyntenyViewF","SyntenyFeatureWidgetF","LinearReadVsRefMenuItem","CalendarIcon","contentBlock","minHeight","boxSizing","whiteSpace","elidedBlock","interRegionPaddingBlock","boundaryPaddingBlock","disabledBackground","boundary","transition","transitions","shortest","dragHandle","dragHandleIcon","verticalAlign","iconButton","TrackLabel","popupState","usePopupState","popupId","MinimizeIcon","getTrackActionMenuItems","priority","draggable","onDragStart","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","bindTrigger","CascadingMenu","bindPopover","trackLabel","renderingComponentContainer","trackLabelOffset","trackLabelOverlap","trackRenderingContainer","TrackContainerLabel","labelStyle","trackLabels","prefersOffset","horizontalScroll","draggingTrackId","moveTrack","dimmed","debouncedOnDragEnter","onScroll","evt","onDragEnter","onHorizontalScroll","rubberBand","rubberBandControl","rubberBandText","popover","mouseEvents","paddingRight","guide","VerticalGuide","coordX","placement","ControlComponent","startX","setStartX","currentX","setCurrentX","anchorPosition","setAnchorPosition","guideX","setGuideX","controlsRef","rubberBandRef","mouseDragging","setOffsets","mouseDown","stopPropagation","relativeX","mouseOut","globalMouseMove","globalMouseUp","computeOffsets","role","leftBpOffset","rightBpOffset","numOfBpSelected","transformOrigin","keepMounted","disableRestoreFocus","anchorReference","scaleBarContainer","scaleBarZoomContainer","scaleBar","majorTickLabel","justifyContent","refLabel","fontWeight","RenderedRefNameLabels","lastLeftBlock","RenderedScaleBarLabels","baseNumber","ScaleBar","other","offsetLeft","totalWidthPx","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","minorTick","divider","RenderedVerticalGuides","centerLineContainer","borderTop","borderBottom","centerLineText","trackHeights","startingPosition","tracksContainer","scheduled","prevX","setMouseDragging","onWheel","origEvent","normalizeWheel","ctrlKey","pixelY","pixelX","dataset","resizer","button","showGridlines","Gridlines","showCenterLine","SCALE_BAR_HEIGHT","SearchResultsDialog","importFormContainer","ImportForm","textSearchManager","rankSearchResults","isSearchDialogDisplayed","selectedAsm","setSelectedAsm","setOption","searchScope","assemblyError","displayError","r0","navToOption","getDisplayString","hasLocation","splitLast","allRefs","allRefNamesWithLowerCase","fetchResults","setSearchResults","handleSelectedRegion","AssemblySelector","RefNameAutocomplete","minWidth","onSelect","TextFieldProps","disableShrink","showAllRegionsInAssembly","optAssemblyName","formatSeqFasta","chunks","dialogContent","setSequence","regionsSelected","active","controller","chunkSeq","chunkRefName","chunkStart","chunkEnd","chunkLocstring","sequenceTooLarge","minRows","readOnly","startIcon","seqFastaFile","Blob","saveAs","GetApp","note","LinearGenomeView","hasDisplayedRegions","MiniControlsComponent","HeaderComponent","seqDialogDisplayed","GetSequenceDialog","setGetSequenceDialogOpen","hideNoTracksActive","HelpDialog","showHelp","loaded","setLoaded","isHelpDialogDisplayed","setHelpDialogDisplayed","currentSearch","setCurrentSearch","inputValue","setInputValue","searchOptions","setSearchOptions","debouncedSearch","coarseVisibleLocStrings","inputBoxVal","disableListWrap","disableClearable","freeSolo","includeInputInList","selectOnFocus","onInputChange","newInputValue","loadingText","onOpen","selectedOption","getOptionDisabled","filterOptions","filtered","searchQuery","toLocaleLowerCase","renderInput","endAdornment","marginRight","placeholder","getOptionLabel","assemblyRegions","searchResults","align","newRegion","handleClick","resultTrackId","dedupe","textSearchResults","refNameResults","allRefNames","lastIndex","Ruler","major","minor","HoverTooltip","overview","cytobandOffset","cytoband","cytobands","click","globalKeyDown","HEADER_OVERVIEW_HEIGHT","scaleBarBorder","scaleBarContig","scaleBarContigForward","backgroundRepeat","scaleBarContigReverse","scaleBarRefName","scaleBarLabel","scaleBarVisibleRegion","HEADER_BAR_HEIGHT","overviewSvg","Polygon","useOffset","multiplier","totalWidthPxWithoutBorders","polygonColor","first","last","topLeft","topRight","startPx","endPx","points","rightRoundedRect","gneg","gpos25","gpos50","gpos100","gpos75","gvar","stalk","acen","getCytobands","Cytobands","coords","lcap","rcap","firstCent","OverviewBox","showCytobands","refNameColor","getRefNameColor","tickLabels","offsetLabel","canDisplayCytobands","tickLabel","labelIdx","visibleRegions","overviewVisibleRegions","scaleBarColor","firstOverviewPx","lastOverviewPx","transparency","modWidth","displayBp","x0","SVGRuler","renderRuler","clipPath","SVGHeader","cytobandHeight","SVGRegionSeparators","SVGTracks","displayResults","renderToSvg","Wrapper","shift","headerHeight","renderToStaticMarkup","xmlns","xmlnsXlink","viewBox","headerRefName","SPACING","WIDGET_HEIGHT","ExportSvgDlg","offscreenCanvas","OffscreenCanvas","rasterizeLayers","setRasterizeLayers","setFilename","control","exportSvg","zoom","ZoomOut","Z","ZoomIn","slider","log2","onChangeCommitted","headerForm","flexWrap","panButton","toggleButton","buttonSpacer","HeaderButtons","PanControls","slide","ArrowBack","ArrowForward","RegionWidth","coarseTotalBp","Controls","hideHeaderOverview","SequenceSearchDialog","calculateVisibleLocStrings","isSingleAssemblyName","localStorageGetItem","MUIRegion","setting","showCytobandsSetting","afterDisplayedRegionsSetCallbacks","coarseDynamicBlocks","MiniControls","Header","scaleBarHeight","trackHeightsWithResizeHandles","includeAggregateIndexes","openTrackIds","updateScore","getScore","rewriteOnClicks","holdOnClick","apply","trackTypeActions","allActions","setShowCytobands","toggleHeader","toggleHeaderOverview","toggleNoTracksActive","toggleShowGridlines","horizontallyFlip","displayInitialSnapshot","movingId","targetId","oldIndex","newIndex","isViewContainer","setTrackLabels","toggleCenterLine","simView","afterDisplayedRegionsSet","factor","cancelLastAnimation","viewWidths","animate","cancelAnimation","canShowCytobands","anyCytobandsExist","isSessionWithAddTracks","PhotoCameraIcon","SyncAltIcon","LabelIcon","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","sret","roundedDynamicBlocks","visibleLocStrings","setCoarseDynamicBlocks","inputs","parsedLocStrings","isInteger","asmName","canonicalRefName","locations","navTo","navToMultiple","firstLocation","refNameMatched","previousIndex","startDisplayedRegion","endDisplayedRegion","ZoomInIcon","CompositeMap","submaps","submap","Symbol","iterator","ellipses","textOverflow","BlockMsg","buttonText","regionTooLargeReason","estimatedRegionStats","clientMouseCoord","popperElt","setPopperElt","linearBlocks","heightOverflowed","textShadow","RenderedBlocks","blockState","viewModel","clientRect","setClientRect","offsetMouseCoord","setOffsetMouseCoord","setClientMouseCoord","contextCoord","setContextCoord","mouseCoord","TransitionProps","onExit","killed","blockStatus","Refresh","reloadFlag","doReload","setStatus","isRetryException","freeResourcesInClient","optDisplay","regionAsm","hasName","viewParams","isJest","BlockState","userBpPerPxLimit","userByteSizeLimit","currBpPerPx","estimatedRegionStatsP","featureMaps","getByCoord","getByID","currentBytesRequested","bytes","currentFeatureScreenDensity","maxAllowableBytes","blockWatchDisposer","blocksPresent","addBlock","deleteBlock","setRegionStatsP","setRegionStats","clearRegionStats","setCurrBpPerPx","isSelectionContainer","setFeatureIdUnderMouse","bpLimitOrDensity","totalBytes","req","aborter","statsP","regionCannotBeRenderedText","renderings","rendering","clipid","dangerouslySetInnerHTML","__html","trackShowLabels","trackShowDescriptions","trackDisplayMode","showLabels","showDescriptions","toggleShowLabels","toggleShowDescriptions","setDisplayMode","superPropsOmit","mouseover","LinearGenomeViewPlugin","SearchBox","ZoomControls","FeatureTrackF","linearBareDisplayConfigSchemaFactory","LinearBareDisplayStateModelFactory","linearBasicDisplayModelFactory","linearGenomeViewStateModelFactory","LineStyleIcon","ScoreText","layoutRecord","anchorX","innerColor","scoreString","fontHeight","Lollipop","onFeatureMouseDown","onFeatureMouseEnter","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","anchorLocation","styleOuter","styleInner","Stick","LollipopRendering","layoutFeat","lollipopsRendered","getLayout","strokeColor","minStickLength","stickColor","stickWidth","FloatingLayout","layoutDirty","sorted","maxBottom","layoutEntries","currentItem","previouslyLayedOutItem","prevStart","prevTop","prevEnd","prevBottom","pairs","PrecomputedFloatingLayout","FloatingLayoutSession","LollipopRenderer","LollipopRendererReactComponent","lollipopRendererConfigSchema","linearLollipopDisplayConfigSchemaFactory","LinearLollipopDisplayStateModelFactory","aboutConfigSchema","aboutStateModel","helpConfigSchema","helpStateModel","importSessionConfigSchema","importSessionStateModel","sessionManagerConfigSchema","sessionManagerStateModel","appendToMenu","InfoIcon","HelpIcon","SPARQLAdapter","endpoint","queryTemplate","refNamesQueryTemplate","additionalQueryParams","configRefNames","encodeURIComponent","querySparql","resultsToRefNames","filledTemplate","resultsToFeatures","accept","rows","bindings","head","vars","fields","requiredField","seenFeatures","rawData","rd","parentUniqueId","pid","sf","found","subfeature","seenFeature","RdfPlugin","sparqlAdapterConfigSchema","SPARQLAdapterClass","chromSizesLocation","Translation","codonTable","frame","tilt","effectiveFrame","seqSliced","translated","normalizedCodon","aminoAcid","drop","startCodon","stopCodon","DNA","SequenceSVG","showForward","DivSequenceRenderer","metadataLocation","searchForward","searchReverse","caseInsensitive","createReferenceSeqTrackConfig","divSequenceRendererConfigSchema","toggleShowForward","toggleShowReverse","toggleShowTranslation","SequencePlugin","DivSequenceRendererF","TwoBitAdapterF","BgzipFastaAdapterF","ChromSizesAdapterF","IndexedFastaAdapterF","SequenceSearchAdapterF","ReferenceSequenceTrackF","LinearReferenceSequenceDisplayF","createExtensionPoints","MakeSpreadsheetColumnType","DataCellReactComponent","FilterModelType","compare","categoryName","hasFilter","textFilterControlAdornment","textFilterControl","FilterReactComponent","filterModel","operationChoices","setOperation","locStringIsInvalid","setLocString","Clear","OPERATIONS","OPERATION_PREDICATES","cellLocation","specifiedLocation","columnNumber","parsedLocString","spreadsheet","_sheet","cell","cellsWithDerived","extendedData","parsedCellText","_columnNumber","newDisplayedRegion","newViewId","locationLinkClick","cellA","cellB","contains","textInCell","stringToFind","indexOf","equals","setString","ColumnTextFilter","TextColumnType","NumberFilterModel","numberInCell","firstNumber","between","secondNumber","firstNumberIsInvalid","setFirstNumber","secondNumberIsInvalid","setSecondNumber","ColumnTypes","Text","LocString","LocRef","LocStart","LocEnd","allColumnTypes","AnyColumnType","AnyFilterModelType","columnType","CellModel","cells","isSelected","toggleSelect","unSelect","select","setExtendedData","columns","column","isDerived","isLoaded","RowModel","passingFiltersCount","sortedFilteredRows","selectedCount","selectedRows","selectedAndPassingFiltersCount","selectedFilteredRows","sortedRows","rowSortingComparisonFunction","sheet","filterControls","rowPassesFilters","unselectAll","ColumnDefinition","dataType","derivationFunctionText","rowSet","StaticRowSetModel","columnDisplayOrder","hasColumnNames","sortColumns","descending","switchDirection","defaultDataType","rowMenuPosition","hideRowSelection","dataTypeChoices","rowA","rowB","setRowMenuPosition","newPosition","setSortColumns","newSort","setColumnType","newTypeName","IMPORT_SIZE_LIMIT","fileTypes","fileTypeParsers","CSV","parseCsvBuffer","TSV","parseTsvBuffer","VCF","parseVcfBuffer","BED","parseBedBuffer","BEDPE","parseBedPEBuffer","parseSTARFusionBuffer","fileTypesRegexp","fileType","hasColumnNameLine","columnNameLineNumber","selectedAssemblyName","fileSource","isReadyToOpen","canCancel","readyToDisplay","requiresUnzip","setSelectedAssemblyName","setFileSource","newSource","toggleHasColumnNameLine","setColumnNameLineNumber","newnumber","setFileType","cancelButton","import","typeParser","unzip","filehandle","stat","displaySpreadsheet","RowFullTextFilter","rowFullText","columnFilters","AnyColumnFilter","setRowFullTextFilter","addBlankColumnFilter","removeColumnFilter","clearAllFilters","defaultRowMenuItems","DoneIcon","_view","rowNumber","hideViewControls","hideFilterControls","FilterControlsModel","mode","importWizard","ImportWizardModel","SpreadsheetModel","rowMenuItems","outputRows","setRowMenuItems","newItems","setImportMode","SpreadsheetViewPlugin","SpreadsheetViewModel","exts","ext","ViewComfyIcon","viewControls","viewsContainer","spreadsheetViewContainer","borderRight","circularViewOptions","ViewControls","direction","FolderOpen","CircularViewOptions","svInspector","circularViewOptionsBarHeight","onlyDisplayRelevantRegionsInCircularView","setOnlyDisplayRelevantRegionsInCircularView","dragHandleHeight","SpreadsheetViewReactComponent","CircularViewReactComponent","showCircularView","spreadsheetView","ret1","circularView","flexbox","makeAdHocFeature","columnsAlreadyUsedInLocations","loc1","loc2","otherData","makeAdHocSvFeature","columnTypes","columnDefinition","locationColumnNumbers","locStartColumnNumbers","locEndColumnNumbers","locRefColumnNumbers","makeAdHocSvFeatureFromTwoLocations","textOf","colno","makeAdHocSvFeatureFromTwoRefStartEndSets","getSerializedFeatureForRow","vcfFeature","adhocFeature","breakpointSplitViewSnapshotFromTableRow","svInspectorView","snapshotFromBreakendFeature","defaultOnChordClick","chordTrack","SpreadsheetViewType","CircularViewType","CircularModel","featuresAdapterConfigSnapshot","featuresRefNamesP","Adapter","featuresCircularTrackConfiguration","spreadsheetWidth","circularViewWidth","refSet","generatedTrackConf","OpenInNewIcon","canOpenBreakpointSplitViewFromTableRow","openBreakpointSplitViewFromTableRow","StateModelFactory","SvInspectorViewPlugin","SvInspectorViewTypeFactory","TableChartIcon","featureWidth","allowedWidthExpansion","totalWidth","measuredTextWidth","viewLeft","labelVisible","setLabelVisible","rstart","featureWidthBp","rootLayout","shouldShowName","shouldShowDescription","featureLayout","getSubRecord","GlyphComponent","FeatureLabel","OverlayRect","rectProps","screenWidth","leftWithinBlock","widthWithinBlock","handlers","mouseoverFeatureId","reverseFlip","color2","topLevel","isUTR","subfeatureId","subfeatureLayout","ProcessedTranscript","getSubparts","filterSubpart","confKey","makeSubpartsFilter","hasUTRs","isTranscript","subs","haveLeftUTR","haveRightUTR","subparts","codeStart","codeEnd","exons","makeUTRs","layOut","extraGlyphs","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","move","hasSubSub","Segments","validator","glyph","parentFeature","layoutParent","addChild","RenderedFeatureGlyph","detectRerender","labelsAllowed","expansion","getWidth","glyphWidth","textWidth","aboveLayout","RenderedFeatures","isFeatureDisplayed","featureDisplayHandler","useCallback","mouseUp","featureIdCurrentlyUnderMouse","color1","color3","labels","nameColor","descriptionColor","subParts","impliedUTRs","SvgFeatureRenderer","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","trackDbId","subTracks","getSubtracks","trackPath","members","subTrack","shortLabel","_source","trackDbUrl","bigDataUrl","bigDataIndex","longLabel","hub","connectionConf","mfetch","TrackHubRegistryPlugin","request","post_with_params","decodeURIComponentNoThrow","decodeURIComponent","term","tidx","TrixTextSearchAdapter","trixJs","ixFilePath","ixxFilePath","Trix","strs","formatted","record","labelFieldIdx","contextIdx","labelField","contextField","context","metaFilePath","trixAdapterConfigSchema","TrixTextSearchAdapterClass","VCFFeature","parser","_id","dataFromVariant","SAMPLES","REF","ALT","POS","CHROM","ID","_getSOTermAndDescription","SO_term","isTRA","soTerms","descriptions","_getSOAndDescFromAltDefs","soTerm","_getSOAndDescByExamination","prefixes","desc","new_descs","suffixes","pref","_altTypeToSO","modAlt","_makeDescriptionString","samples","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","vcfLocation","strokeColorSelected","strokeColorHover","bpToRadians","blockStart","blockEnd","Chord","svType","endPosition","endBlock","blocksForRefs","startBlock","SVTYPE","startXY","endXY","controlXY","hoverStrokeColor","blocksForRefsMemo","chords","trackStyleId","ChordRendererType","VariantsPlugin","VcfAdapterF","VcfTabixAdapterF","VariantFeatureWidgetF","ExtensionPointsF","LinearVariantDisplayF","StructuralVariantChordRendererF","BaseChordDisplayComponent","ChordVariantDisplayF","draw","reducedFeatures","getFeatureUnderMouse","eventClientX","subadapters","bigWigs","bicolorPivot","bicolorPivotValue","baseWiggleRendererConfigSchema","pivotValue","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","getNiceDomain","bounds","getScaleType","groupBy","acc","getStats","nd","autoscaleType","statsAutorun","statsRegion","wiggleStats","updateStats","fillRectCtx","fudgeFactor","drawXY","colorCallback","summaryScoreMode","minSize","niceMin","niceMax","getHeight","toOrigin","hasClipping","prevLeftPx","crossingOrigin","lastCol","lastMix","effectiveC","mix","save","restore","drawLine","lastVal","lowClipping","highClipping","drawDensity","pivot","crossing","_feature","DensityRenderer","XYPlotRenderer","_score","LinePlotRenderer","hoverVertical","useClientY","YScaleBar","orientation","Axis","shadow","orient","LinearWiggleDisplay","SetMinMaxDlg","SetColorDlg","selectedRendering","rendererTypeNameState","constraints","statsReady","statsFetchInProgress","EPSILON","setColor","setPosColor","setNegColor","statsFetch","setFill","toggleLogScale","setScaleType","setSummaryScoreMode","setAutoscale","setMaxScore","setRendererType","setMinScore","toggleCrossHatches","setCrossHatches","cross","adapterTypeName","rendererTypeNameSimple","oldDomain","summaryScoreModeSetting","canHaveFill","displayCrossHatchesSetting","hatches","minimalTicks","axisPropsFromTickScale","hasResolution","hasGlobalStats","fillSetting","hasRenderings","superRenderSvg","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","numStdDev","ent","getOffset","RectBg","ScoreLegend","legend","xpos","ColorLegend","rowHeight","labelWidth","needsCustomLegend","needsFullHeightScalebar","rowHeightTooSmallForScalebar","renderColorBoxes","svgFontSize","canDisplayLabel","colorBoxWidth","legendWidth","extraOffset","boxHeight","StatBars","sourcesVolatile","setLayout","clearLayout","setSources","isMultiRow","iter","scoreMode","useMinimalTicks","MultiXYPlotRendererConfigSchema","MultiDensityRendererConfigSchema","MultiRowXYPlotRendererConfigSchema","MultiLineRendererConfigSchema","MultiRowLineRendererConfigSchema","MultiXYPlotRenderer","MultiDensityRenderer","MultiRowXYPlotRenderer","MultiLineRenderer","MultiRowLineRenderer","eventClientY","mouseoverBp","featuresUnderMouse","translate","ConfirmDialog","arg1","makeTrack","textbox","submit","MultiWiggleWidget","setVal","multiple","WiggleGetGlobalStats","getGlobalStats","WiggleGetMultiRegionStats","getMultiRegionStats","MultiWiggleGetSources","getSources","WigglePlugin","XYPlotRendererReactComponent","xyPlotRendererConfigSchema","utils","BigWigAdapterF","QuantitativeTrackF","MultiQuantitativeTrackF","LinearWiggleDisplayF","MultiLinearWiggleDisplayF","LinePlotRendererF","XYPlotRendererF","DensityRendererF","MultiXYPlotRendererF","MultiRowXYPlotRendererF","MultiDensityRendererF","MultiLineRendererF","MultiRowLineRendererF","addAddTrackWorkflowType","AddTrackWorkflowType","MultiWiggleAddTrackWidgetF","CreateMultiWiggleExtensionF"],"sourceRoot":""}