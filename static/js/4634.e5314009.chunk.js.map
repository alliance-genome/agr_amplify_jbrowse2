{"version":3,"file":"static/js/4634.e5314009.chunk.js","mappings":"krBAEA,IAAIA,EAAqB,EAEnBC,EAA+C,IAAIC,QAQlD,SAASC,EACdC,EACAC,GAEA,IAAIC,EAAgBL,EAAeM,IAAIH,GAYvC,OAXKE,IACHN,GAAsB,EACtBC,EAAeO,IAAIJ,EAAQJ,GAC3BM,EAAgBN,EAChBI,EAAOK,iBAAiB,SAAS,WAC/B,IAAMC,EAAWT,EAAeM,IAAIH,QACnBO,IAAbD,GACFL,EAAS,cAAeK,EAE5B,KAEK,CAAEJ,cAAAA,EACX,CASO,SAASM,EACdC,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GAEY,kBAAxBA,EAAMP,aAEjB,CAIA,IAAMQ,EAA0D,IAAIC,IAQ7D,SAASC,EAAuB,GAEH,IADlCV,EAAa,EAAbA,cAEIW,EAA2BH,EAA0BP,IAAID,GAK7D,OAJKW,IACHA,EAA2B,IAAIC,gBAC/BJ,EAA0BN,IAAIF,EAAeW,IAExCA,EAAyBb,MAClC,C,0IC5DMe,GAAYC,EAAAA,EAAAA,KAAAA,CAAa,CAC7BC,gBAAiB,CACfC,SAAU,OAIRC,GAAmBC,EAAAA,EAAAA,WACvB,YAYO,IAXLC,EAAO,EAAPA,QACAC,EAAQ,EAARA,SACAC,EAAQ,EAARA,SACAC,EAAU,EAAVA,WAAW,EAAD,EACVC,MAAAA,OAAK,MAAG,EAAC,EAQDC,EAAYX,IAAZW,QACAC,EAAmCN,EAAnCM,cAAeC,EAAoBP,EAApBO,gBAIjBC,EAAS,IAAIC,gBAAgBC,OAAOC,SAASC,QAAQ9B,IAAI,UAC/D,EACkB,qBAAT+B,MACHC,EAAAA,EAAAA,iBAAgB,gBAAD,OACG,CACdJ,OAAOC,SAASI,KAAOL,OAAOC,SAASK,SACvCR,EACAJ,GACAa,KAAK,MACPf,IAEFgB,EAAAA,EAAAA,UAAShB,GAAS,eAVjBiB,EAAY,KAAEC,EAAe,KAY9BC,EAAYf,EAAcgB,SAASH,GAAgB,IACrDA,EACAjB,GAEJqB,EAAAA,EAAAA,YAAU,WACJF,GAAaA,IAAcnB,GAC7BD,EAASoB,EAEb,GAAG,CAACA,EAAWpB,EAAUC,IAEzB,IAAMsB,EAAQlB,EAAcmB,OAAS,GAAK,2BAC1C,OACE,SAAC,IAAS,CACRC,QAAM,EACNC,MAAM,WACNC,QAAQ,WACRC,WAAYL,GAAS,0BACrBM,MAAOT,GAAa,GACpBU,WAAY,CAAE,cAAe,qBAC7B9B,SAAU,SAAA+B,GAAK,OAAIZ,EAAgBY,EAAMC,OAAOH,MAAM,EACtDN,QAASA,EACTrB,WAAYA,EACZ+B,WAAYV,EACZW,UAAW9B,EAAQT,gBAAgB,SAElCU,EAAc8B,KAAI,SAAAC,GACjB,IAAMC,EAAW/B,EAAgBzB,IAAIuD,GAC/BE,EAAcD,GAAWE,EAAAA,EAAAA,SAAQF,EAAU,eAAiB,GAClE,OACE,SAAC,IAAQ,CAAYR,MAAOO,EAAK,SAC9BE,GAAeF,GADHA,EAInB,KAGN,IAGF,K,wXCjEMI,EAAmBC,EAAAA,cAAoB,CAC3CC,iBAAkB,KAClBC,eAAgB,OAGlB,SAASC,EAAkB,GAOvB,IANFC,EAAO,EAAPA,QACGC,GAAK,YAMAH,GAAmBI,EAAAA,EAAAA,YAAWP,GAA9BG,eACR,IAAKA,EACH,MAAM,IAAIK,MAAM,uCAElB,IAAMC,GAAcC,EAAAA,EAAAA,cAClB,SAACnB,GACCY,EAAeQ,QACR,OAAPN,QAAO,IAAPA,GAAAA,EAAUd,EACZ,GACA,CAACY,EAAgBE,IAGnB,OAAO,SAAC,KAAQ,kBAAKC,GAAK,IAAED,QAASI,IACvC,CAEA,SAASG,EAAiB,GAYtB,IAXFC,EAAK,EAALA,MACAC,EAAK,EAALA,MACAC,EAAO,EAAPA,QACGT,GAAK,YASAJ,EAAqBD,EAAAA,WAAiBD,GAAtCE,iBACFc,GAAaC,EAAAA,EAAAA,IAAc,CAC/BF,QAAAA,EACA5B,QAAS,UACTe,iBAAAA,IAEF,OACE,iCACE,UAAC,KAAQ,2BAAKgB,EAAAA,EAAAA,IAAUF,KAAiBG,EAAAA,EAAAA,IAAUH,IAAW,eAC5D,SAAC,IAAY,CAACI,QAASP,EAAOC,MAAOA,KACrC,SAAC,IAAY,SAEf,SAACO,GAAqB,kBAChBf,GAAK,IACTgB,aAAc,CAAEC,SAAU,MAAOC,WAAY,SAC7CC,gBAAiB,CAAEF,SAAU,MAAOC,WAAY,QAChDR,WAAYA,OAIpB,CAEA,SAASK,EAAsB,GAa3B,IAZFL,EAAU,EAAVA,WAIGV,GAHY,EAAfoB,gBACS,EAATC,UACO,EAAP/D,SACQ,aASAuC,GAAmBI,EAAAA,EAAAA,YAAWP,GAA9BG,eACFyB,GAAUC,EAAAA,EAAAA,UACd,iBAAO,CACL1B,eAAgBA,GAAkBa,EAClCd,iBAAkBc,EACnB,GACD,CAACb,EAAgBa,IAGnB,OACE,SAAChB,EAAiB8B,SAAQ,CAACzC,MAAOuC,EAAQ,UACxC,SAAC,KAAS,kBAAKtB,IAAWyB,EAAAA,EAAAA,IAASf,MAGzC,CAEA,SAASgB,EAAc,GASnB,IARFhB,EAAU,EAAVA,WAGGV,GAFY,EAAfoB,gBACS,EAATC,WACQ,aAMAxB,EAAmBF,EAAAA,WAAiBD,GAApCG,eACFyB,EAAU3B,EAAAA,SACd,iBAAO,CACLE,eAAgBA,GAAkBa,EAClCd,iBAAkBc,EACnB,GACD,CAACb,EAAgBa,IAGnB,OACE,SAAChB,EAAiB8B,SAAQ,CAACzC,MAAOuC,EAAQ,UACxC,SAAC,KAAI,kBAAKtB,IAAWyB,EAAAA,EAAAA,IAASf,MAGpC,CAEA,SAASiB,EAAc,GAAiC,IAA/BC,EAAI,EAAJA,KACvB,MAAI,YAAaA,GACR,SAAC,IAAqB,CAACC,KAAK,YACZ,aAAdD,EAAKC,MAAqC,UAAdD,EAAKC,MAExC,SAAC,IAAqB,CACpBA,KAAMD,EAAKC,KACXC,QAASF,EAAKE,QACd3C,SAAUyC,EAAKzC,WAId,IACT,CAEA,SAAS4C,EAAkB,GAOvB,IANFX,EAAe,EAAfA,gBACAC,EAAS,EAATA,UACGrB,GAAK,YAWR,IAAMgC,EAAUX,EAAUY,MACxB,SAAAC,GAAQ,MAAI,SAAUA,GAAYA,EAASC,IAAI,IAEjD,OACE,8BACGd,EAAUhC,KAAI,SAACuC,EAAMQ,GACpB,MAAO,YAAaR,GAClB,SAACtB,EAAgB,CAEfG,QAAO,kBAAamB,EAAKhD,OACzB2B,MAAOqB,EAAKhD,MACZ4B,MAAOwB,EACPZ,gBAAiBA,EACjBC,UAAWO,EAAKS,QAAQ,UAExB,SAACN,GAAiB,kBACZ/B,GAAK,IACToB,gBAAiBA,EACjBC,UAAWO,EAAKS,YAChB,kBAXcT,EAAKhD,MAAK,YAAIwD,IAahB,YAAdR,EAAKC,MACP,SAAC,IAAO,CAAwBS,UAAU,MAAI,kBAArBF,IACT,cAAdR,EAAKC,MACP,SAAC,IAAa,UACXD,EAAKhD,OAAK,oBADoBgD,EAAKhD,MAAK,YAAIwD,KAI/C,UAACtC,EAAiB,CAEhBC,QAAS,YAAa6B,GApCXW,EAoC8BX,EAAK7B,QAnC/C,SAACd,GACNmC,EAAgBnC,EAAOsD,EACzB,QAiCiEpG,EACzDgD,SAAUqD,QAAQZ,EAAKzC,UAAU,UAEhCyC,EAAKO,MACJ,SAAC,IAAY,WACX,SAACP,EAAKO,KAAI,MAEV,KAAM,KACV,SAAC,IAAY,CACXrB,QAASc,EAAKhD,MACd6D,UAAWb,EAAKc,SAChBlC,MAAOwB,IAAYJ,EAAKO,QAE1B,gBAAKQ,MAAO,CAAEC,SAAU,EAAG9F,SAAU,OACrC,SAAC6E,EAAa,CAACC,KAAMA,MAAQ,UAfrBA,EAAKhD,MAAK,YAAIwD,IAnChC,IAAqBG,CAqDjB,KAGN,CAcA,IAZA,SAA+BvC,GAK7B,OACE,SAAC0B,GAAa,kBAAK1B,GAAK,cACtB,SAAC+B,GAAiB,UAAK/B,MAG7B,C,6KC3NMrD,GAAYC,EAAAA,EAAAA,KAAAA,EAAa,SAAAiG,GAAK,MAAK,CACvCC,MAAO,CAAC,EACRC,UAAW,CAAC,EACZC,WAAY,CACVC,IAAK,EACLC,KAAM,EACNC,SAAU,WACVC,WAAY,SACZC,WAAY,UAEdC,UAAW,CACTC,QAASV,EAAMW,QAAQ,KAEzBC,aAAc,CACZC,YAAa,QACbC,YAAa,GAEhB,IAUKC,EAAqBjE,EAAAA,YACzB,SAACK,EAAO6D,GACN,IAAQ9E,EAAuCiB,EAAvCjB,MAAO+E,EAAgC9D,EAAhC8D,SAAUjF,EAAsBmB,EAAtBnB,QAAYkF,GAAK,OAAK/D,EAAK,GACpD,GAAsC7B,EAAAA,EAAAA,YAAkB,eAAjD6F,EAAW,KAAEC,EAAc,KAClC,GAAkC9F,EAAAA,EAAAA,UAAiC,MAAK,eAAjE+F,EAAS,KAAEC,EAAY,KAC9B,GAAkChG,EAAAA,EAAAA,UAAkC,MAAK,eAAlEiG,EAAS,KAAEC,EAAY,KAC9B,GAAwBlG,EAAAA,EAAAA,WAAS,GAAM,eAAhCmG,EAAI,KAAEC,EAAO,MAEpB/F,EAAAA,EAAAA,YAAU,WACJ8F,IACO,OAATF,QAAS,IAATA,GAAAA,EAAWE,OACXC,GAAQ,GAEZ,GAAG,CAACD,EAAMF,IAKV,IAAQ9G,EAAYX,EAAUqD,EAAO,CAAEA,MAAAA,IAA/B1C,QACFuF,GAAQ2B,EAAAA,EAAAA,KAGRC,GADuB,OAATP,QAAS,IAATA,OAAS,EAATA,EAAWQ,cACF,EAEvBC,OAAsBxI,IAAhB6H,EAA4BjF,EAAQiF,EAEhD,OACE,mCAASD,GAAK,IAAEF,IAAKA,EAAI,WACvB,gBAAKlB,MAAO,CAAEQ,SAAU,YAAa,UACnC,SAAC,IAAU,CACTU,IAAK,SAACe,GAAqB,OAAKT,EAAaS,EAAK,EAClDtC,UAAU,OACVzD,QAASA,EACTO,UAAW9B,EAAQ0F,WAAW,SAE7B2B,OAGL,SAAC,KAAS,CACRE,SAAU,SAAAD,GAAI,OAAIP,EAAaO,EAAK,EACpCxF,UAAW9B,EAAQyF,UACnB/D,WAAY,CACV2D,OAAM,QACJ8B,MAAAA,GACI5F,GAAuB,YAAZA,EACXgE,EAAMG,WAAWnE,GACjB,CAAC,IAGTvB,QAAS,CACPwF,MAAOxF,EAAQwF,MACfgC,KAAMxH,EAAQgG,UACdyB,QAASzH,EAAQmG,cAEnB1E,MAAO4F,EACPzH,SAAU,SAAA+B,GAAK,OAAIgF,EAAehF,EAAMC,OAAOH,MAAM,EACrDiG,UAAW,SAAA/F,GACS,UAAdA,EAAMgG,IACC,OAATb,QAAS,IAATA,GAAAA,EAAWE,OACY,WAAdrF,EAAMgG,MACfhB,OAAe9H,GACfoI,GAAQ,GAEZ,EACAW,OAAQ,WACNpB,EAASE,GAAe,IACxBC,OAAe9H,EACjB,OAIR,IAGF,K,oEC1DA,UArDqB,SAAH,GAAuC,IAAjCsC,EAAK,EAALA,MAClB0G,EAAgB,GAChBC,EAAG,UAAM3G,GACP4G,EAAU,oBACVjD,EAAMgD,EAAIE,QAAQD,GACxB,IAAa,IAATjD,EAAY,CACd,IAAMmD,EAAOH,EAAII,MAAM,EAAGpD,EAAMiD,EAAQ3G,QAKlC+G,EAAQF,EAAKE,MACjB,uDAEEA,IACFL,EAAG,oCAAgCK,EAAM,GAAE,kCAC3CN,EAAgBM,EAAM,IAIxB,IAAMC,EAASH,EAAKE,MAAM,uCACtBC,IACFN,EAAG,uDACHD,EAAgBO,EAAO,GAE3B,CACA,OACE,iBACE/C,MAAO,CACLY,QAAS,EACToC,OAAQ,EACRC,SAAU,OACVC,UAAW,IACXC,WAAY,OACZC,OAAQ,mBACR,UAEDX,EAAII,MAAM,EAAG,KACbL,GACC,gBACExC,MAAO,CACLmD,WAAY,YACZC,OAAQ,kBACRJ,OAAQ,IACR,SAEDK,KAAKC,UAAUD,KAAKE,MAAMf,GAAgB,KAAM,KAEjD,OAGV,C,iIC7CA,aAAe,GAQR,IAPLgB,EAAO,EAAPA,QACAC,EAAI,EAAJA,KACAC,EAAc,EAAdA,eAMA,SAASC,EAAkBC,GACV,UAAXA,GACFF,IAEFF,GACF,CAEA,OACE,UAAC,IAAM,CAACC,KAAMA,EAAMD,QAAS,kBAAMG,GAAmB,EAAC,WACrD,SAAC,IAAW,CAACE,GAAG,qBAAoB,oBACpC,SAAC,IAAa,WACZ,SAAC,IAAiB,CAACA,GAAG,2BAA0B,6FAKlD,UAAC,IAAa,YACZ,SAAC,IAAM,CAACzG,QAAS,kBAAMuG,GAAmB,EAAEG,MAAM,UAAS,qBAG3D,SAAC,IAAM,CACL1G,QAAS,kBAAMuG,EAAkB,QAAQ,EACzCG,MAAM,UACN5H,QAAQ,YAAW,qBAO5B,C,4SCnBD,SAAS6H,EAAwB1G,GAC/B,IAAQO,EAA8BP,EAA9BO,MAAOoG,EAAuB3G,EAAvB2G,SAAa5C,GAAK,OAAK/D,EAAK,GAC3C,OACE,SAAC4G,EAAA,EAAO,CAACrG,MAAOA,GAAS,GAAG,UAC1B,SAACsG,EAAA,GAAY,kBAAK9C,GAAK,aAAG4C,MAGhC,CAEA,SAASG,EAAQ1B,EAAa2B,GAC5B,MAAmB,kBAAR3B,GAAoBA,EAAI1G,OAASqI,EACpC,GAAN,OAAU3B,EAAI4B,UAAU,EAAGD,GAAI,UAE1B3B,CACT,CAEA,IC1CA,GD0CqBpI,EAAAA,EAAAA,WACnB,SAACgD,GAQC,IAAQpC,EAAwDoC,EAAxDpC,SAAU0B,EAA8CU,EAA9CV,KAAM2H,EAAwCjH,EAAxCiH,YAAaC,EAA2BlH,EAA3BkH,UAAWC,EAAgBnH,EAAhBmH,YAC1CC,GAAaxJ,IAAYyJ,EAAAA,EAAAA,IAAczJ,GAAY,MAAQ,OACjE,GAAkDO,EAAAA,EAAAA,UAChDP,GAAY,sBAAuBA,GAAYA,EAAS0J,kBACpD1J,EAAS0J,kBACTF,GACL,eAJMG,EAAiB,KAAEC,EAAoB,KAKxCC,GAAQC,EAAAA,EAAAA,IAAeR,GACzBA,EAAUS,iBAAiBnC,QAC3B,GAEJ,GAAoCrH,EAAAA,EAAAA,UAASsJ,EAAMjC,MAAM,EADxC,IACqD,eAA/DoC,EAAU,KAAEC,EAAa,KAChC,GAAsC1J,EAAAA,EAAAA,UAASsJ,EAAMjC,MAFpC,IAEoD,eAA9DsC,EAAW,KAAEC,EAAc,KAClC,GAAgC5J,EAAAA,EAAAA,UAA6B,MAAK,eAA3D6J,EAAQ,KAAEC,EAAW,KAEtBC,EAAeT,EAAMU,MACzB,SAAAC,GAAE,OAAIA,EAAGd,oBAAsBC,CAAiB,IAG5Cc,EAAyB,SAACzK,GAC9BuJ,GAAY,kBACPvJ,GAAQ,IACX0J,kBAAmBY,EACfA,EAAaZ,uBACbnL,IAER,EAIEyB,GACAsK,IACAb,EAAAA,EAAAA,IAAczJ,IACdA,EAAS0J,oBAAsBY,EAAaZ,mBAE5Ce,EAAuBzK,GAGzB,IAAI0K,GACF,SAACC,EAAA,GAAU,kBACLvI,GAAK,IACTmH,YAAakB,EACbzJ,MAAmB,OAAZsJ,QAAY,IAAZA,OAAY,EAAZA,EAAcM,iBAMzB,GAH0B,SAAtBjB,IACFe,GAAgB,SAACG,EAAA,GAAgB,UAAKzI,KAExB,OAAZkI,QAAY,IAAZA,GAAAA,EAAcQ,kBAAmB,CACnC,IAAQA,EAAsBR,EAAtBQ,kBACRJ,GACE,SAACI,GAAiB,kBAAK1I,GAAK,IAAEmH,YAAakB,IAE/C,CAEA,OACE,iCACE,SAACM,EAAA,EAAG,CAACC,QAAQ,OAAM,UACjB,SAACC,EAAA,EAAU,CAACC,QAAM,WAAExJ,OAEtB,SAACqJ,EAAA,EAAG,CAACC,QAAQ,OAAOG,cAAc,MAAK,UACrC,UAACJ,EAAA,EAAG,YACF,UAACK,EAAA,EAAiB,CAChBjK,MAAOwI,EACP0B,WAAS,EACT/L,SAAU,SAACgM,EAAQC,GACbA,GACF3B,EAAqB2B,IAEnB9B,EAAAA,EAAAA,IAAczJ,IAChByK,EAAuBzK,EAE3B,EACA,aAAW,+BAA8B,UAExC,IAAIF,gBAAgBC,OAAOC,SAASC,QAAQ9B,IAC3C,YACE,MACF,SAAC8K,EAAA,EAAY,CAAC9H,MAAM,OAAO,aAAW,aAAY,mBAIpD,SAAC8H,EAAA,EAAY,CAAC9H,MAAM,MAAM,aAAW,MAAK,iBAGzC6I,EAAWvI,KAAI,gBAAGiI,EAAiB,EAAjBA,kBAAmB8B,EAAc,EAAdA,eAAgB9J,EAAI,EAAJA,KAAI,OACxD,SAACoH,EAAuB,CAEtB3H,MAAOuI,EACP,aAAYhI,EACZiB,MAAOjB,EAAK,SAEe,kBAAnB8J,EACJtC,EAAQsC,EAAgB,GACxBA,GAAkBtC,EAAQxH,EAAM,IAP/BgI,EAQmB,IAE3BQ,EAAYpJ,QAEX,UAACmI,EAAA,EAAY,CACX9G,QAAS,SAAAd,GAAK,OAAIgJ,EAAYhJ,EAAMC,OAAsB,EAC1D/B,UAAU,EAAM,kBAGhB,SAACkM,EAAA,EAAiB,OAElB,SAGN,SAACC,EAAA,EAAI,CACHlD,KAAM5D,QAAQwF,GACdA,SAAUA,EACV7B,QAAS,kBAAM8B,EAAY,KAAK,EAChCjH,aAAc,CACZC,SAAU,SACVC,WAAY,UAEdC,gBAAiB,CACfF,SAAU,MACVC,WAAY,UACZ,SAEU,OAAX4G,QAAW,IAAXA,OAAW,EAAXA,EAAazI,KAAI,SAACkK,EAAMnH,GAAG,OAC1B,SAACoH,EAAA,EAAQ,CAEPzK,MAAOwK,EAAKjC,kBACZvH,QAAS,WACP,IAAM0J,EAAO7B,EAAWA,EAAWlJ,OAAS,GAC5CmJ,EAAc,GAAD,eACRD,EAAWpC,MAAM,EAAGoC,EAAWlJ,OAAS,IAAE,CAC7C6K,KAEFxB,EAAe,CACb0B,GAAI,eACD3B,EAAYtC,MAAM,EAAGpD,KAAI,OACzB0F,EAAYtC,MAAMpD,EAAM,MAE7BoF,EAAqB+B,EAAKjC,mBAC1BW,EAAY,KACd,EAAE,SAEDsB,EAAKjK,MAjBDiK,EAAKjC,kBAkBD,WAKlBgB,GACD,SAACoB,EAAA,EAAc,UAAEzC,MAGvB,G,kWEjLItK,GAAYC,EAAAA,EAAAA,KAAAA,CAAa,CAC7B+M,MAAO,CACLxG,SAAU,QACVyG,UAAW,OACXC,UAAW,SAEX/M,SAAU,GACVgN,UAAW,GACXC,SAAU,oBACVlE,UAAW,oBACX5C,IAAK,EACLC,KAAM,EAEN8G,QAAS,GAEXC,sBAAuB,CACrB1G,QAAS,EACToC,OAAQ,EACRuE,OAAQ,MAkBL,SAASC,EAAsBnK,GACpC,IAEI8B,EACA3C,EAIAgD,EAPI7E,EAAYX,IAAZW,QACAuE,EAAS7B,EAAT6B,KAOR,GAJI,YAAa7B,IACX8B,EAAsB9B,EAAtB8B,QAAS3C,EAAaa,EAAbb,UAGF,YAAT0C,EACFM,GAAO,SAAC,IAAc,CAACsE,MAAM,gBACxB,GAAa,aAAT5E,EACT,GAAIC,EAAS,CACX,IAAM2E,EAAQtH,EAAW,UAAY,YACrCgD,GAAO,SAAC,IAAY,CAACsE,MAAOA,GAC9B,MACEtE,GAAO,SAAC,IAAwB,CAACsE,MAAM,gBAEpC,GAAa,UAAT5E,EACT,GAAIC,EAAS,CACX,IAAM2E,EAAQtH,EAAW,UAAY,YACrCgD,GAAO,SAAC,IAAsB,CAACsE,MAAOA,GACxC,MACEtE,GAAO,SAAC,IAAwB,CAACsE,MAAM,WAG3C,OAAO,gBAAKrH,UAAW9B,EAAQ2M,sBAAsB,SAAE9H,GACzD,CA8FA,IAAMiI,EAAWzK,EAAAA,YACf,SAACK,EAAO6D,GACN,OAA8C1F,EAAAA,EAAAA,YAAuB,eAA9DkM,EAAe,KAAEC,EAAkB,KAC1C,GAA4CnM,EAAAA,EAAAA,YAAkB,eAAvDoM,EAAc,KAAEC,EAAiB,KACxC,GAA0CrM,EAAAA,EAAAA,WAAS,GAAM,eAAlDsM,EAAa,KAAEC,EAAgB,KACtC,GAAsDvM,EAAAA,EAAAA,YAAkB,eAAjEwM,EAAmB,KAAEC,EAAsB,KAClD,GAAgCzM,EAAAA,EAAAA,YAG5B,eAHGgF,EAAQ,KAAE0H,EAAW,KAItBC,GAAWC,EAAAA,EAAAA,QAA8B,MACvCzN,EAAYX,IAAZW,QAGN+D,EAMErB,EANFqB,UACAD,EAKEpB,EALFoB,gBACAgF,EAIEpG,EAJFoG,KACAD,EAGEnG,EAHFmG,QACA6B,EAEEhI,EAFFgI,SAAS,EAEPhI,EADFiD,IAAAA,OAAG,OAAQ,GAGbzE,EAAAA,EAAAA,YAAU,WACH4H,IACHkE,OAAmBnO,GACnBqO,OAAkBrO,GAEtB,GAAG,CAACiK,KAEJ5H,EAAAA,EAAAA,YAAU,WACR,IACIwM,EADEC,EAAsB7E,GAAQ5D,QAAQ6H,GAW5C,OATIY,IAAwBR,EAC1BO,EAAQE,YAAW,WACjBR,GAAiB,EACnB,GAAG,MACOO,GAAuBR,IACjCO,EAAQE,YAAW,WACjBR,GAAiB,EACnB,GAAG,MAEE,WACLS,aAAaH,EACf,CACF,GAAG,CAACP,EAAerE,EAAMiE,KAEzB7L,EAAAA,EAAAA,YAAU,WACR,GAAIwJ,EAAU,CACZ,IAAMoD,EAAQpD,EAAyBqD,wBACnClI,GAEAiI,EAAKnI,MAAQE,EAASF,KACtBmI,EAAKlI,KAAOkI,EAAK3G,QAAUtB,EAASD,MAKtC2H,EAAY,CAAE5H,IAAKmI,EAAKnI,IAAKC,KAAMkI,EAAKlI,KAAOkI,EAAK3G,OAExD,MAAYtB,GACV0H,EAAY,CAAC,EAEjB,GAAG,CAAC1H,EAAU6E,IAEd,IAAMhG,EAAUX,EAAUY,MACxB,SAAAC,GAAQ,MAAI,SAAUA,GAAYA,EAASC,IAAI,IAE3CmJ,EAAmC,CAAC,EAQ1C,IAAMC,GACJ,iCACE,SAAC,IAAQ,CAACC,cAAepF,IAASqE,EAAegB,OAAK,WACnDpK,EACEqK,MAAK,SAACC,EAAGC,GAAC,OAAMA,EAAEC,UAAY,IAAMF,EAAEE,UAAY,EAAE,IACpDxM,KAAI,SAAC6C,EAAUE,GACd,GAAsB,YAAlBF,EAASL,KACX,OAAO,SAAC,IAAO,CAAwBS,UAAU,MAAI,kBAArBF,IAElC,GAAsB,cAAlBF,EAASL,KACX,OACE,SAAC,IAAa,UACXK,EAAStD,OAAK,oBADgBsD,EAAStD,MAAK,YAAIwD,IAKvD,IAAID,EAAO,KACP2J,EAAgB,KACpB,GAAI5J,EAASC,KAAM,CACjB,IAAM4J,EAAO7J,EAASC,KACtBA,GACE,SAAC,IAAY,WACX,SAAC4J,EAAI,KAGX,CACI,YAAa7J,EACf4J,GAAgB,SAAC3B,EAAqB,CAACtI,KAAK,YAE1B,aAAlBK,EAASL,MACS,UAAlBK,EAASL,OAETiK,GACE,SAAC3B,EAAqB,CACpBtI,KAAMK,EAASL,KACfC,QAASI,EAASJ,QAClB3C,SAAU+C,EAAS/C,YAIzB,IA9CWoD,EA8CLxC,EACJ,YAAamC,GA/CJK,EAgDOL,EAASnC,QA/C5B,SAACd,GACNmC,EAAgBnC,EAAOsD,EACzB,QA8CcpG,EACN,OACE,UAAC,IAAW,CAEVwG,MAAO2I,EACPnO,SAAUiF,IAAQuI,EAClB5K,QAASA,EACTiM,YAAa,SAAAC,GACPA,EAAEC,gBAAkBC,SAASC,gBAC/BH,EAAEC,cAAcG,QAChBzB,EAAuBxI,IAErB,YAAaF,EACXqI,IAAmBnI,IACrBkI,EAAmB2B,EAAEC,eACrB1B,EAAkBpI,KAGpBkI,OAAmBnO,GACnBqO,OAAkBrO,GAEtB,EACA6I,UAAW,SAAAiH,GACT,GAAc,cAAVA,EAAEhH,KAAiC,WAAVgH,EAAEhH,IAC7BkB,GAAWA,EAAQ8F,EAAG,sBACjB,GAAc,YAAVA,EAAEhH,IACX2F,EA1JtB,SAA8BvJ,EAAuBiL,GACnD,OAAOC,EAAAA,EAAAA,eACLlL,EAAUmE,MAAM,EAAG8G,IACnB,SAAApK,GAAQ,MACY,YAAlBA,EAASL,MACS,cAAlBK,EAASL,OACRK,EAAS/C,QAAQ,GAExB,CAmJwBqN,CAAqBnL,EAAWe,SAE7B,GAAc,cAAV6J,EAAEhH,IAAqB,CAChC,IAAM0G,EA7K5B,SAA0BtK,EAAuBiL,GAC/C,IAAMlK,EAAMf,EACTmE,MAAM8G,EAAa,GACnBG,WACC,SAAAvK,GAAQ,MACY,YAAlBA,EAASL,MACS,cAAlBK,EAASL,OACRK,EAAS/C,QAAQ,IAExB,OAAa,IAATiD,EACKA,EAEFkK,EAAa,EAAIlK,CAC1B,CAgKgCsK,CAAiBrL,EAAWe,GACtCwI,EAAuBe,EACzB,KAAW,YAAazJ,IACR,eAAV+J,EAAEhH,KAAkC,UAAVgH,EAAEhH,MAC9BqF,EAAmB2B,EAAEC,eACrB1B,EAAkBpI,GAClBsI,GAAiB,IAGvB,EACAvL,SAAUqD,QAAQN,EAAS/C,UAAU,UAEpCgD,GACD,SAAC,IAAY,CACXrB,QAASoB,EAAStD,MAClB6D,UAAWP,EAASQ,SACpBlC,MAAOwB,IAAYE,EAASC,OAE7B2J,IA7CI5J,EAAStD,MAgDpB,MAEHyC,EAAUhC,KAAI,SAAC6C,EAAUE,GACxB,IAAIC,EAAU,KAgBd,MAfI,YAAaH,IACfG,GACE,SAAC+H,EAAQ,CAEPpC,SAAUqC,EACVjE,KAAMqE,GAAiBF,IAAmBnI,EAC1C+D,QAAS,WACPuE,GAAiB,GACjBJ,OAAmBnO,EACrB,EACAiF,gBAAiBA,EACjBC,UAAWa,EAASG,SARfH,EAAStD,QAYbyD,CACT,OAIJ,OAAOY,EACLsI,GAEA,SAAC,IAAI,CAACoB,GAAIvG,EAAMzD,MAAO,CAAExB,gBAAgB,SAAY0C,IAAKA,EAAI,UAC5D,SAAC,IAAK,CACJ+I,UAAW,EACX/I,IAAKiH,EACL1L,UAAW9B,EAAQqM,MACnBhH,OAAK,UAAOQ,GAAW,SAEtBoI,KAIT,IAiCF,IAtBA,SAAcvL,GACZ,IAAQoG,EAAwDpG,EAAxDoG,KAAMD,EAAkDnG,EAAlDmG,QAAS9E,EAAyCrB,EAAzCqB,UAAWD,EAA8BpB,EAA9BoB,gBAAoB2C,GAAK,OAAK/D,EAAK,GAErE,OACE,SAAC,MAAO,gBACN6M,mBAAoB,EACpBzG,KAAMA,EACND,QAASA,EACT2G,cAAe,CAAEC,WAAW,IACxBhJ,GAAK,cAET,SAACqG,EAAQ,CACPhE,KAAMA,EACND,QAASA,EACT9E,UAAWA,EACXD,gBAAiBA,EACjB6B,KAAG,MAIX,C,yJCnaMtG,GAAYC,EAAAA,EAAAA,KAAAA,CAAa,CAC7BoQ,iBAAkB,CAChBC,OAAQ,aACRxI,MAAO,QAETyI,eAAgB,CACdD,OAAQ,aACR/C,OAAQ,QAEViD,uBAAwB,CACtBF,OAAQ,aACRG,UAAW,WAEbC,yBAA0B,CACxBJ,OAAQ,aACRG,UAAW,aA0Ef,IAtEA,SAAsB,GAYlB,IA8BEhO,EAzCJkO,EAAM,EAANA,OAAO,EAAD,EACNrM,SAAAA,OAAQ,OAAQ,MAChBsM,QAAAA,OAAO,OAAQ,EACJC,EAAiB,EAA5BpO,UACGY,GAAK,YAQR,GAA0C7B,EAAAA,EAAAA,WAAS,GAAM,eAAlDsP,EAAa,KAAEC,EAAgB,KAChCC,GAAU5C,EAAAA,EAAAA,QAAO,GACvB,EAAwBpO,IAAhBW,EAAO,EAAPA,QAASsQ,EAAE,EAAFA,GAwCjB,OAtCApP,EAAAA,EAAAA,YAAU,WACR,SAASqP,EAAU5O,GACjBA,EAAM6O,iBACN,IAAMC,EAAM9M,EAAWhC,EAAM+O,QAAU/O,EAAMgP,QACvCC,EAAWH,EAAMJ,EAAQQ,QAC3BD,IACFZ,EAAOY,GACPP,EAAQQ,QAAUJ,EAEtB,CAEA,SAASK,IACPV,GAAiB,EACnB,CACA,OAAID,GACF9P,OAAO1B,iBAAiB,YAAa4R,GAAW,GAChDlQ,OAAO1B,iBAAiB,UAAWmS,GAAS,GACrC,WACLzQ,OAAO0Q,oBAAoB,YAAaR,GAAW,GACnDlQ,OAAO0Q,oBAAoB,UAAWD,GAAS,EACjD,GAEK,WAAO,CAChB,GAAG,CAACX,EAAeH,EAAQrM,IAKvB7B,EAFAmO,EACEtM,EACU3D,EAAQ6P,uBAER7P,EAAQ+P,yBAEbpM,EACG3D,EAAQ4P,eAER5P,EAAQ0P,kBAIpB,wBACE,eAAa,OACbsB,YAAa,SAAArP,GACXA,EAAM6O,iBACNH,EAAQQ,QAAUlN,EAAWhC,EAAM+O,QAAU/O,EAAMgP,QACnDP,GAAiB,EACnB,EACAa,KAAK,eACLnP,UAAWwO,EAAGxO,EAAWoO,IACrBxN,GAGV,C,ihCCtDMwO,GAAWC,EAAAA,EAAAA,KAEJC,EAAwB,CAEnC5N,QAAS,CAAE6N,KATI,WAUflM,UAAW,CAAEkM,KATD,WAUZC,SAAUJ,EAASK,QAAQC,aAAa,CAAErI,MAAO,CAAEkI,KATtC,aAUbI,WAAYP,EAASK,QAAQC,aAAa,CAAErI,MAAO,CAAEkI,KATtC,aAUfK,UAAW,OACXC,WAAY,OACZC,MAAO,CACLC,EAAGX,EAASK,QAAQC,aAAa,CAAErI,MAAO2I,EAAAA,IAC1CC,EAAGb,EAASK,QAAQC,aAAa,CAAErI,MAAO6I,EAAAA,IAC1CC,EAAGf,EAASK,QAAQC,aAAa,CAAErI,MAAO+I,EAAAA,IAC1CC,EAAGjB,EAASK,QAAQC,aAAa,CAAErI,MAAOiJ,EAAAA,MAIvC,SAASC,IACd,MAAO,CACLC,WAAY,CACVC,UAAW,CACTC,aAAc,CACZC,KAAM,UAGVC,aAAc,CACZF,aAAc,CACZG,gBAAgB,EAChBC,gBAAiB,CAAEC,QAAS,OAGhCC,eAAgB,CACdN,aAAc,CACZnK,OAAQ,UAGZ0K,eAAgB,CACdP,aAAc,CACZnK,OAAQ,QACRoK,KAAM,UAGVO,kBAAmB,CACjBR,aAAc,CACZnK,OAAQ,UAIZ4K,cAAe,CACbT,aAAc,CACZC,KAAM,UAGVS,aAAc,CACZV,aAAc,CACZnK,OAAQ,UAGZ8K,gBAAiB,CACfX,aAAc,CACZC,KAAM,UAGVW,cAAe,CACbZ,aAAc,CACZnK,OAAQ,UAGZgL,WAAY,CACVb,aAAc,CACZjR,QAAS,UAGb+R,YAAa,CACXd,aAAc,CACZrE,OAAO,IAGXoF,iBAAkB,CAChBf,aAAc,CACZnK,OAAQ,UAGZmL,OAAQ,CACNhB,aAAc,CACZC,KAAM,UAGVgB,SAAU,CACRjB,aAAc,CACZC,KAAM,UAGViB,YAAa,CACXlB,aAAc,CACZrE,OAAO,IAGXwF,YAAa,CACXnB,aAAc,CACZrE,OAAO,IAIXyF,aAAc,CACZpB,aAAc,CACZnK,OAAQ,QACR9G,QAAS,cAKnB,CAEO,SAASsS,IAA6D,IAA/BtC,EAAuB,uDAAG,CAAC,EACjEuC,EAAmBC,IAAU3C,EAAuBG,GAC1D,MAAO,CACLe,WAAY,CACVW,cAAe,CACbe,eAAgB,CACdC,eAAgB,CACd9K,MAAO2K,EAAiBxC,SAASD,QAIvCkB,UAAW,CACTyB,eAAgB,CACdE,cAAe,CACb/K,MAAO2K,EAAiBxC,SAASD,QAIvCmC,OAAQ,CACNQ,eAAgB,CACd7O,UAAW,CACTgP,gBAAiBL,EAAiBrC,WAAWJ,QAInD+C,QAAS,CACPJ,eAAgB,CACdxM,KAAM,CACJ2B,MAAO2K,EAAiBxC,SAASD,QAKvCgD,oBAAqB,CACnBL,eAAgB,CACdxM,KAAM,CACJ2M,gBAAiBL,EAAiBxC,SAASD,MAE7CiD,QAAS,CACPnL,MAAO2K,EAAiBxC,SAASiD,iBAM7C,CAEO,SAASC,EAAuBjD,GACrC,OAAO,QACLA,QAASH,EACT1L,WAAY,CAAE+O,SAAU,IACxBvO,QAAS,GACN6N,IApJE,CACLzB,WAAY,CACVC,UAAW,CACTC,aAAc,CACZC,KAAM,UAGVC,aAAc,CACZF,aAAc,CACZG,gBAAgB,EAChBC,gBAAiB,CAAEC,QAAS,OAGhCC,eAAgB,CACdN,aAAc,CACZnK,OAAQ,UAGZ0K,eAAgB,CACdP,aAAc,CACZnK,OAAQ,QACRoK,KAAM,UAGVO,kBAAmB,CACjBR,aAAc,CACZnK,OAAQ,UAIZ4K,cAAe,CACbT,aAAc,CACZC,KAAM,UAGVS,aAAc,CACZV,aAAc,CACZnK,OAAQ,UAGZ8K,gBAAiB,CACfX,aAAc,CACZC,KAAM,UAGVW,cAAe,CACbZ,aAAc,CACZnK,OAAQ,UAGZgL,WAAY,CACVb,aAAc,CACZjR,QAAS,UAGb+R,YAAa,CACXd,aAAc,CACZrE,OAAO,IAGXoF,iBAAkB,CAChBf,aAAc,CACZnK,OAAQ,UAGZmL,OAAQ,CACNhB,aAAc,CACZC,KAAM,UAGVgB,SAAU,CACRjB,aAAc,CACZC,KAAM,UAGViB,YAAa,CACXlB,aAAc,CACZrE,OAAO,IAGXwF,YAAa,CACXnB,aAAc,CACZrE,OAAO,IAIXyF,aAAc,CACZpB,aAAc,CACZnK,OAAQ,QACR9G,QAAS,eA6DbsS,EAA8BtC,IAGpC,CAEO,SAASmD,EAAmBnP,GAAuB,IAAD,UAwBvD,OAvBS,QAAT,EAAIA,SAAK,OAAS,QAAT,EAAL,EAAOgM,eAAO,OAAd,EAAgBD,WAClB/L,EAAQwO,IAAUxO,EAAO,CACvBgM,QAAS,CACPD,SAAUJ,EAASK,QAAQC,aACzB,UAAWjM,EAAMgM,QAAQD,SACpB/L,EAAMgM,QAAQD,SACf,CAAEnI,MAAO5D,EAAMgM,QAAQD,eAK1B,QAAT,EAAI/L,SAAK,OAAS,QAAT,EAAL,EAAOgM,eAAO,OAAd,EAAgBE,aAClBlM,EAAQwO,IAAUxO,EAAO,CACvBgM,QAAS,CACPE,WAAYP,EAASK,QAAQC,aAC3B,UAAWjM,EAAMgM,QAAQE,WACpBlM,EAAMgM,QAAQE,WACf,CAAEtI,MAAO5D,EAAMgM,QAAQE,kBAM5BN,EAAAA,EAAAA,GACL4C,IAAUS,EAA4B,QAAN,EAACjP,SAAK,aAAL,EAAOgM,SAAUhM,GAAS,CAAC,GAEhE,C,0BCrOA,SAASoP,EAAUpT,GACjB,MAAgB,UAAZA,EACK,CACLqT,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGM,UAAZzT,EACK,CACLqT,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,WAGH,CACLJ,SAAU,UACVC,QAAS,UACTC,MAAO,UACPC,SAAU,UACVC,KAAM,UAEV,CAEO,SAASC,EAAS,GAAyB,IAAvB1T,EAAO,EAAPA,QACzB,OACE,gBAAK2T,QAAQ,cAAa,UACxB,SAACzG,EAAI,CAAClN,QAASA,KAGrB,CAEO,SAAS4T,EAAS,GAAyB,IAAvB5T,EAAO,EAAPA,QACzB,OACE,iBAAK2T,QAAQ,cAAa,WACxB,SAACE,EAAI,CAAC7T,QAASA,KACf,SAACkN,EAAI,CAAClN,QAASA,MAGrB,CAEA,SAASkN,EAAK,GAAyB,IAC/B4G,EAASV,EADM,EAAPpT,SAEd,OACE,iCACE,iBACE8D,MAAO,CAAEiQ,KAAMD,EAAOT,UACtBW,EAAE,sMAEJ,iBACElQ,MAAO,CAAEiQ,KAAMD,EAAOR,SACtBU,EAAE,uLAEJ,iBACElQ,MAAO,CAAEiQ,KAAMD,EAAOP,OACtBS,EAAE,qLAEJ,iBACElQ,MAAO,CAAEiQ,KAAMD,EAAON,UACtBQ,EAAE,8KAEJ,iBACElQ,MAAO,CAAEiQ,KAAMD,EAAOL,MACtBO,EAAE,4IAIV,CAEA,SAASH,EAAK,GAAyB,IAC/BC,EAASV,EADM,EAAPpT,SAEd,OACE,eACE,aAAW,UACXiU,UAAU,6BACVnQ,MAAO,CAAEiQ,KAAMD,EAAOT,UAAW,WAEjC,iBAAMW,EAAE,8SACR,iBAAMA,EAAE,siBACR,iBAAMA,EAAE,qfACR,iBAAMA,EAAE,wZACR,iBAAMA,EAAE,mtBACR,iBAAMA,EAAE,4hBACR,iBAAMA,EAAE,6aAGd,C,uQC3DMlW,GAAYC,EAAAA,EAAAA,KAAAA,EAAa,SAAAiG,GAAK,MAAK,CACvCiC,KAAM,CACJiO,WAAY,SACZnK,QAAS,OACTsB,OAAQ,QACRzF,MAAO,QAETuO,QAAS,CACPC,OAAQ,IACR9P,SAAU,QACV+P,OAAQrQ,EAAMW,QAAQ,GACtBN,KAAML,EAAMW,QAAQ,IAEtB2P,SAAU,CACRF,OAAQ,IACR9P,SAAU,QACV+P,OAAQrQ,EAAMW,QAAQ,GACtB4P,MAAOvQ,EAAMW,QAAQ,IAEvB6P,qBAAsB,CACpBC,WAAY,OACZ1K,QAAS,OACT2K,iBAAkB,0CAClBrJ,OAAQ,SAEVsJ,QAAS,CACPC,QAAS,WAEX7D,WAAY,CACVhG,UAAW,OACX6J,QAAS,cAEXC,OAAQ,CACN9Q,SAAU,GAEZ+Q,KAAM,CACJ/Q,SAAU,GAEZG,UAAW,CACT0D,MAAO5D,EAAMgM,QAAQ/N,QAAQ+Q,cAE/BvO,UAAW,CACT,UAAW,CACTmO,gBAAiB5O,EAAMgM,QAAQ/N,QAAQ8S,QAG3CnQ,aAAc,CACZoQ,YAAahR,EAAMgM,QAAQpM,UAAUkM,KACrC8C,gBAAiB5O,EAAMgM,QAAQ/N,QAAQ8S,OAGzCE,YAAa,CACXvQ,QAASV,EAAMW,QAAQ,IAE1B,IAEKuQ,GAAO/W,EAAAA,EAAAA,WACX,YAAyE,IAC/DgX,EADA,EAAP/W,QACO+W,cACFC,GAAWC,EAAAA,EAAAA,gBAAeF,EAAe,YAC/C,OAAa,OAARC,QAAQ,IAARA,GAAAA,EAAUE,KAGN,gBAAKC,IAAKH,EAASE,IAAKE,IAAI,iBAF5B,SAAC5B,EAAQ,CAAC5T,QAAQ,SAI7B,IAaIyV,GAAatX,EAAAA,EAAAA,WACjB,YAMO,IALLC,EAAO,EAAPA,QAAQ,EAAD,EACPsX,cAAAA,OAAa,OAAG,mBAAO,EAKfjX,EAAYX,IAAZW,QACAkX,EAAmCvX,EAAnCuX,kBAAmBlV,EAAgBrC,EAAhBqC,KAAMmV,EAAUxX,EAAVwX,MAYjC,OACE,UAACC,EAAA,EAAO,WACLD,EAAMpV,KAAI,SAAAsV,GAAI,OACb,SAACC,EAAA,EAAY,CAEXC,UAAWF,EAAK/V,MAChByC,UAAWsT,EAAKtT,UAChBpE,QAASA,GAHJ0X,EAAK/V,MAIV,KAEJ,gBAAKQ,UAAW9B,EAAQqW,QACxB,SAAC/M,EAAA,EAAO,CAACrG,MAAM,iBAAiBuU,OAAK,YACnC,SAAClR,EAAA,EAAkB,CACjB7E,MAAOO,EACPwE,SAxBR,SAA0BiR,GACH,OAAjBP,QAAiB,IAAjBA,GAAAA,EAAmBjW,SAASwW,GAC9B9X,EAAQ+X,OAAO,6BAAD,OACiBD,EAAO,oDACpC,WAGF9X,EAAQgY,qBAAqBF,EAEjC,EAgBQlW,QAAQ,QACRvB,QAAS,CACPyF,UAAWzF,EAAQyF,UACnBO,UAAWhG,EAAQgG,UACnBG,aAAcnG,EAAQmG,kBAI3B8Q,GACD,gBAAKnV,UAAW9B,EAAQqW,QACxB,gBAAKhR,MAAO,CAAE8B,MAAO,IAAKoB,UAAW,IAAK,UACxC,SAACkO,EAAI,CAAC9W,QAASA,QAIvB,IAGIiY,GAAelY,EAAAA,EAAAA,WAAS,YAA2C,IAAD,EAAvCC,EAAO,EAAPA,QACvBK,EAAYX,IAAZW,QAEF6X,GADoBC,EAAAA,EAAAA,QAAOnY,GAAzBoY,cACwBC,qBAAqB,QAAQC,MAC7D,GAA0BpX,EAAAA,EAAAA,UAAqB,QAAb,EAACgX,EAAU,UAAE,aAAZ,EAAc7V,MAAK,eAA/CP,EAAK,KAAE+E,EAAQ,KACtB,OACE,UAAC0R,EAAA,EAAK,CAACpW,UAAW9B,EAAQwW,YAAY,WACpC,SAAC2B,EAAA,EAAU,uCACX,SAACC,EAAA,EAAW,CAAC/S,MAAO,CAAEgD,OAAQ,GAAI,UAChC,SAACgQ,EAAA,EAAM,CAAC5W,MAAOA,EAAO7B,SAAU,SAAA+B,GAAK,OAAI6E,EAAS7E,EAAMC,OAAOH,MAAM,EAAC,SACnEoW,EAAU9V,KAAI,gBAAGC,EAAI,EAAJA,KAAI,OACpB,SAACkK,EAAA,EAAQ,CAAYzK,MAAOO,EAAK,SAC9BA,GADYA,EAEJ,SAIjB,SAACoW,EAAA,EAAW,CAAC/S,MAAO,CAAEgD,OAAQ,GAAI,UAChC,SAACiQ,EAAA,EAAM,CACL7V,QAAS,kBAAM9C,EAAQ4Y,QAAQ9W,EAAO,CAAC,EAAE,EACzCF,QAAQ,YACR4H,MAAM,UAAS,6BAOzB,IAEMqP,GAAY9Y,EAAAA,EAAAA,WAChB,YAA0E,IAAvE+Y,EAAI,EAAJA,KAAM9Y,EAAO,EAAPA,QACCoY,GAAkBD,EAAAA,EAAAA,QAAOnY,GAAzBoY,cACFW,EAAWX,EAAcY,YAAYF,EAAKlU,MAChD,IAAKmU,EACH,MAAM,IAAI9V,MAAM,qBAAD,OAAsB6V,EAAKlU,OAE5C,IAAQqU,EAAmBF,EAAnBE,eACR,OACE,SAACC,EAAA,EAAa,CACZJ,KAAMA,EACN5P,QAAS,kBAAMlJ,EAAQmZ,WAAWL,EAAK,EACvCM,WAAY,kBAAMN,EAAKO,cAAcP,EAAKQ,UAAU,EAAC,UAEnDR,EAAKQ,YACL,SAAC,EAAAC,cAAa,CACZC,kBAAmB,gBAAGhY,EAAK,EAALA,MAAK,OAAO,SAACiY,EAAA,QAAY,CAACjY,MAAOA,GAAS,EAAC,UAEjE,SAAC,EAAAkY,SAAQ,CAACC,UAAU,SAACC,EAAA,EAAe,IAAI,UACtC,SAACX,EAAc,CACbY,MAAOf,EACP9Y,QAASA,EACT8Z,aAAc1B,EAAc0B,oBAS1C,IAyGF,GAtGY/Z,EAAAA,EAAAA,WACV,SAACgD,GASM,IAAD,EAeAgX,EAdI/Z,EAAY+C,EAAZ/C,QACAK,EAAYX,IAAZW,QAGNiZ,EAMEtZ,EANFsZ,UACAU,EAKEha,EALFga,cACAC,EAIEja,EAJFia,YACAC,EAGEla,EAHFka,cACAC,EAEEna,EAFFma,MACAC,EACEpa,EADFoa,eAGIC,EAAgBL,IAAkBV,EAcxC,MAXuB,UAAnBc,EACFL,EAAO,CAAC,aAENM,EAAa,mBAAeJ,EAAW,WAAO/a,GAEpB,SAAnBkb,IACTL,EAAO,CACLM,EAAa,mBAAeJ,EAAW,WAAO/a,EAAU,gBAK1D,iBACEiD,UAAW9B,EAAQwH,KACnBnC,MAAO,CACL4U,oBAAyB,QAAN,EAAEP,SAAI,aAAJ,EAAMQ,QAAO,SAAAC,GAAC,QAAMA,CAAC,IAAEvZ,KAAK,MACjD,UAEDoZ,GAAoC,SAAnBD,GAChB,SAACK,EAAA,EAAY,CAACza,QAASA,IACrB,KAEHA,EAAQ0a,iBACP,SAAC,EAAAhB,SAAQ,CAACC,UAAU,mBAAQ,UAC1B,SAAC3Z,EAAQ0a,iBAAe,UAAK1a,EAAQ2a,gBAErC,MACJ,iBAAKxY,UAAW9B,EAAQ+V,qBAAqB,WAC3C,gBAAKjU,UAAW9B,EAAQkW,QAAQ,UAC9B,SAACqE,EAAA,EAAM,CAACzY,UAAW9B,EAAQoW,OAAQvQ,SAAS,SAAQ,UAClD,SAACmR,GAAU,UAAKtU,SAGpB,iBAAKZ,UAAW9B,EAAQsS,WAAW,UAChCwH,EAAM1Y,OACL0Y,EAAM/X,KAAI,SAAA0W,GAAI,OACZ,SAACD,EAAS,CAERC,KAAMA,EACN9Y,QAASA,GAAQ,eAFJ8Y,EAAKvP,IAGlB,KAGJ,SAAC0O,GAAY,UAAKlV,KAIpB,gBAAK2C,MAAO,CAAEuH,OAAQ,aAIzBiN,EAAcpH,KAAO,GAAKwG,GACzB,SAAC3P,EAAA,EAAO,CAACrG,MAAM,qBAAoB,UACjC,SAACuX,EAAA,EAAG,CACF1Y,UACqB,UAAnBiY,EAA6B/Z,EAAQ6V,SAAW7V,EAAQ0V,QAE1DvM,MAAM,UACN,cAAY,kBACZ1G,QAAS,kBAAM9C,EAAQ8a,kBAAkB,EAAC,UAE1C,SAACC,EAAA,EAAU,QAGb,KAEHV,GAAoC,UAAnBD,GAChB,SAACK,EAAA,EAAY,CAACza,QAASA,IACrB,MAEJ,SAACgb,EAAA,EAAQ,CAAChb,QAASA,MAGzB,I,mFC/TIN,IAAYC,EAAAA,EAAAA,KAAAA,EAAa,SAAAiG,GAAK,MAAK,CACvCqV,YAAa,CACX/U,SAAU,WACViQ,MAAOvQ,EAAMW,QAAQ,GACrBP,IAAKJ,EAAMW,QAAQ,GACnBiD,MAAO5D,EAAMgM,QAAQsJ,KAAK,MAE7B,IAwDD,QAAenb,EAAAA,EAAAA,WAtDf,SAAkC,GAM9B,IALF8Z,EAAK,EAALA,MACAsB,EAAW,EAAXA,YAKQ9a,EAAYX,KAAZW,QACR,OACE,UAAC+a,GAAA,EAAM,CAACtO,SAAS,KAAK3D,MAAI,EAACD,QAASiS,EAAY,WAC9C,UAACE,GAAA,EAAW,gCAETF,GACC,SAACG,GAAA,EAAU,CACTnZ,UAAW9B,EAAQ4a,YACnBnY,QAAS,kBAAMqY,GAAa,EAC5BrI,KAAK,QAAO,UAEZ,SAACyI,GAAA,EAAS,MAEV,SAEN,SAACC,GAAA,EAAO,KAER,SAACC,GAAA,EAAa,WACZ,SAACjD,EAAA,EAAU,sGAKb,UAACkD,GAAA,EAAa,YACZ,SAAC/C,EAAA,EAAM,CACL7V,QAAS,WACP+W,EAAM8B,YACNR,GACF,EACAvZ,QAAQ,YACR4H,MAAM,UACNoS,WAAS,mBAIX,SAACjD,EAAA,EAAM,CACL7V,QAAS,kBAAMqY,GAAa,EAC5B3R,MAAM,YACN5H,QAAQ,YAAW,yBAO7B,I,oCCvEA,SAASia,GAAkB9Y,GASzB,IACEyE,EAOEzE,EAPFyE,MACAyF,EAMElK,EANFkK,OACA6O,EAKE/Y,EALF+Y,sBACApW,EAIE3C,EAJF2C,MACAqW,EAGEhZ,EAHFgZ,UACAC,EAEEjZ,EAFFiZ,SACAC,EACElZ,EADFkZ,aAEF,GAAwB/a,EAAAA,EAAAA,WAAS,GAAM,eAAhCgb,EAAI,KAAEC,EAAO,KAEdC,GAAgBtO,EAAAA,EAAAA,QAA0B,OAEhDvM,EAAAA,EAAAA,YAAU,WACR,GAAKwa,EAAL,CAGA,IAAMM,EAASD,EAAclL,QAC7B,GAAKmL,EAAL,CAGA,IAAMhY,EAAUgY,EAAOC,WAAW,MAC7BjY,KAGLkY,EAAAA,GAAAA,IAA2BR,EAAW1X,GACtC8X,GAAQ,GANR,CAJA,CAWF,GAAG,CAACJ,IAEJ,IACMS,EAAcR,EAAW,IAAMA,EAAW,GAC1CS,EAAM,4BAFWR,EAAe,eAAiB,IAEL,OAAGO,GAAW,OAC9DN,EAAO,QAAU,IAEnB,OACE,mBACE,cAAaO,EACb7V,IAAKwV,EACL5U,MAAOA,EAAQsU,EACf7O,OAAQA,EAAS6O,EACjBpW,OAAK,QAAI8B,MAAAA,EAAOyF,OAAAA,GAAWvH,IAGjC,CAUAmW,GAAkBhJ,aAAe,CAC/BkJ,eAAW7c,EACX4c,sBAAuB,EACvBpW,MAAO,CAAC,GAIV,U,wBCpEMhG,IAAYC,EAAAA,EAAAA,KAAAA,CAAa,CAC7B+c,WAAY,CACV5T,OAAQ,kBACR5C,SAAU,WACV2C,WAAY,QACZ8T,cAAe,OACf3G,OAAQ,OAuCZ,IAAejW,EAAAA,EAAAA,WAnCC,SAAH,GAYN,IAXL6c,EAAO,EAAPA,QACAC,EAAO,EAAPA,QACA9F,EAAa,EAAbA,cACA+F,EAAO,EAAPA,QAAQ,EAAD,EACP5J,QAAAA,OAAO,MAAG,IAAG,EAQL7S,EAAYX,KAAZW,QACR,GAA0Ba,EAAAA,EAAAA,WAAS,GAAM,eAAlC6b,EAAK,KAAEC,EAAQ,KAOtB,IANAzb,EAAAA,EAAAA,YAAU,WAGR,IAAM0b,EAAShP,YAAW,kBAAM+O,GAAS,EAAK,GAAE9J,GAChD,OAAO,kBAAMhF,aAAa+O,EAAO,CACnC,IACIH,GAAWC,EAAO,CACpB,IAAMG,GAAOjG,EAAAA,EAAAA,gBAAeF,EAAe,YAAa,CAAE+F,QAAAA,IAC1D,OACE,gBACE3a,UAAW9B,EAAQqc,WACnBhX,MAAO,CAAEO,KAAM2W,EAAS5W,IAAK6W,GAAU,SAEtCK,GAGP,CACA,OAAO,IACT,I,iFCRIC,IAAQ,EAINC,GAAO,IAAIC,OApCA,CACf,IACA,IACA,KACA,OACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,MACA,KACA,IACA,MACA,OACA,QACA,SACA,QACA,QACA,KACA,QACA,KACA,QACA,KACA,IACA,MAO+Bjb,KAAI,SAAAkb,GAAG,iBAAQA,EAAG,gBAAarc,KAAK,KAAM,KAK5D,SAASsc,GAAc,GAA6B,IAJ5CpV,EAIiBqV,EAAI,EAAJA,KAChC1b,GALeqG,EAKAqV,EAJdJ,GAAKK,KAAKtV,GAIYqV,EAAOE,KAAWF,IAoB/C,OAnBKL,KACHA,IAAQ,EAIRQ,KAAAA,QACE,2BACA,SAAChW,GAIsB,MAAjBA,EAAKiW,UACPjW,EAAKkW,aAAa,MAAO,uBACzBlW,EAAKkW,aAAa,SAAU,UAEhC,MAKF,gBAEEC,wBAAyB,CACvBC,OAAQJ,KAAAA,SAAmB7b,KAInC,C,gKCpEqBkc,EAAQ,8CAC3B,aAA2B,IAAD,EAAdC,EAAO,uDAAG,CAAC,EAGrB,IAHsB,eACtB,iBAEMA,EAAQC,SAAWD,EAAQC,QAAU,GACzC,MAAM,IAAIC,UAAU,6CAGtB,GAA8B,kBAAnBF,EAAQG,QAA0C,IAAnBH,EAAQG,OAChD,MAAM,IAAID,UAAU,4CASR,OALd,EAAKD,QAAUD,EAAQC,QACvB,EAAKE,OAASH,EAAQG,QAAUC,OAAOC,kBACvC,EAAKC,WAAaN,EAAQM,WAC1B,EAAKC,MAAQ,IAAIlf,IACjB,EAAKmf,SAAW,IAAInf,IACpB,EAAKof,MAAQ,EAAC,CAChB,CAoQC,OAlQD,sCACA,SAAeF,GACb,GAA+B,oBAApBG,KAAKJ,WAAhB,CAEC,IAE8B,EAF9B,UAEyBC,GAAK,IAA/B,2BAAiC,CAAC,IAAD,qBAArBxW,EAAG,KAAErD,EAAI,KACnBga,KAAKJ,WAAWvW,EAAKrD,EAAK7C,MAC5B,CAAC,+BAJD,CAKF,GAAC,8BAED,SAAiBkG,EAAKrD,GACpB,MAA2B,kBAAhBA,EAAKia,QAAuBja,EAAKia,QAAUC,KAAKC,QAC1B,oBAApBH,KAAKJ,YACdI,KAAKJ,WAAWvW,EAAKrD,EAAK7C,OAGrB6c,KAAKI,OAAO/W,GAIvB,GAAC,mCAED,SAAsBA,EAAKrD,GAEzB,IAAgB,IADAga,KAAKK,iBAAiBhX,EAAKrD,GAEzC,OAAOA,EAAK7C,KAEhB,GAAC,2BAED,SAAckG,EAAKrD,GACjB,OAAOA,EAAKia,OAASD,KAAKM,sBAAsBjX,EAAKrD,GAAQA,EAAK7C,KACpE,GAAC,mBAED,SAAMkG,EAAKwW,GACT,IAAM7Z,EAAO6Z,EAAM1f,IAAIkJ,GAEvB,OAAO2W,KAAKO,cAAclX,EAAKrD,EACjC,GAAC,kBAED,SAAKqD,EAAKlG,GACR6c,KAAKH,MAAMzf,IAAIiJ,EAAKlG,GACpB6c,KAAKD,QAEDC,KAAKD,OAASC,KAAKT,UACrBS,KAAKD,MAAQ,EACbC,KAAKQ,eAAeR,KAAKF,UACzBE,KAAKF,SAAWE,KAAKH,MACrBG,KAAKH,MAAQ,IAAIlf,IAErB,GAAC,2BAED,SAAc0I,EAAKrD,GACjBga,KAAKF,SAASM,OAAO/W,GACrB2W,KAAKS,KAAKpX,EAAKrD,EACjB,GAAC,+CAED,yHACqBga,KAAKF,UAAQ,yDACb,GADR9Z,EAAI,kBACQA,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,KACZ6c,KAAKH,MAAMa,IAAIrX,GAAK,CAAD,gBAC2B,IACjC,IADA2W,KAAKK,iBAAiBhX,EAAKlG,GACtB,iBACnB,OADmB,UACb6C,EAAI,yJAKGga,KAAKH,OAAK,2DAEsB,GAFxC7Z,EAAI,kBACQA,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,MAED,IADA6c,KAAKK,iBAAiBhX,EAAKlG,GACtB,iBACnB,OADmB,UACb6C,EAAI,uNAGf,iBAED,SAAIqD,GACF,GAAI2W,KAAKH,MAAMa,IAAIrX,GAAM,CACvB,IAAMrD,EAAOga,KAAKH,MAAM1f,IAAIkJ,GAE5B,OAAO2W,KAAKO,cAAclX,EAAKrD,EACjC,CAEA,GAAIga,KAAKF,SAASY,IAAIrX,GAAM,CAC1B,IAAMrD,EAAOga,KAAKF,SAAS3f,IAAIkJ,GAC/B,IAAyC,IAArC2W,KAAKK,iBAAiBhX,EAAKrD,GAE7B,OADAga,KAAKW,cAActX,EAAKrD,GACjBA,EAAK7C,KAEhB,CACF,GAAC,iBAED,SAAIkG,EAAKlG,GAAuC,IAAD,yDAAJ,CAAC,EAAC,IAA3Bsc,OAAAA,OAAM,MAAGO,KAAKP,OAAM,EAC9BQ,EACc,kBAAXR,GAAuBA,IAAWC,OAAOC,kBAC5CO,KAAKC,MAAQV,OACblf,EACFyf,KAAKH,MAAMa,IAAIrX,GACjB2W,KAAKH,MAAMzf,IAAIiJ,EAAK,CAClBlG,MAAAA,EACA8c,OAAAA,IAGFD,KAAKS,KAAKpX,EAAK,CAAElG,MAAAA,EAAO8c,OAAAA,GAE5B,GAAC,iBAED,SAAI5W,GACF,OAAI2W,KAAKH,MAAMa,IAAIrX,IACT2W,KAAKK,iBAAiBhX,EAAK2W,KAAKH,MAAM1f,IAAIkJ,MAGhD2W,KAAKF,SAASY,IAAIrX,KACZ2W,KAAKK,iBAAiBhX,EAAK2W,KAAKF,SAAS3f,IAAIkJ,GAIzD,GAAC,kBAED,SAAKA,GACH,OAAI2W,KAAKH,MAAMa,IAAIrX,GACV2W,KAAKY,MAAMvX,EAAK2W,KAAKH,OAG1BG,KAAKF,SAASY,IAAIrX,GACb2W,KAAKY,MAAMvX,EAAK2W,KAAKF,eAD9B,CAGF,GAAC,oBAED,SAAOzW,GACL,IAAMwX,EAAUb,KAAKH,MAAMO,OAAO/W,GAKlC,OAJIwX,GACFb,KAAKD,QAGAC,KAAKF,SAASM,OAAO/W,IAAQwX,CACtC,GAAC,mBAED,WACEb,KAAKH,MAAMiB,QACXd,KAAKF,SAASgB,QACdd,KAAKD,MAAQ,CACf,GAAC,oBAED,SAAOgB,GACL,KAAMA,GAAWA,EAAU,GACzB,MAAM,IAAIvB,UAAU,6CAGtB,IAAMwB,GAAK,OAAOhB,KAAKiB,qBACjBC,EAAcF,EAAMle,OAASie,EAC/BG,EAAc,GAChBlB,KAAKH,MAAQ,IAAIlf,IAAIqgB,GACrBhB,KAAKF,SAAW,IAAInf,IACpBqf,KAAKD,MAAQiB,EAAMle,SAEfoe,EAAc,GAChBlB,KAAKQ,eAAeQ,EAAMpX,MAAM,EAAGsX,IAGrClB,KAAKF,SAAW,IAAInf,IAAIqgB,EAAMpX,MAAMsX,IACpClB,KAAKH,MAAQ,IAAIlf,IACjBqf,KAAKD,MAAQ,GAGfC,KAAKT,QAAUwB,CACjB,GAAC,kCAED,yGACsBf,MAAI,wDACtB,OADsB,qBAAZ3W,EAAG,cACPA,EAAG,qMAEZ,oCAED,yGAC0B2W,MAAI,wDAC1B,OAD0B,qBAAd7c,EAAK,cACXA,EAAK,qMAEd,6BAED,uHACqB6c,KAAKH,OAAK,yDAEsB,GAFxC7Z,EAAI,kBACQA,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,MAED,IADA6c,KAAKK,iBAAiBhX,EAAKlG,GACtB,iBACnB,OADmB,UACb,CAACkG,EAAKlG,EAAMA,OAAM,yJAIT6c,KAAKF,UAAQ,2DACb,GADR9Z,EAAI,kBACQA,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,KACZ6c,KAAKH,MAAMa,IAAIrX,GAAK,CAAD,gBAC2B,IACjC,IADA2W,KAAKK,iBAAiBhX,EAAKlG,GACtB,iBACnB,OADmB,UACb,CAACkG,EAAKlG,EAAMA,OAAM,uNAI/B,+CAED,6GACM6d,GAAK,OAAOhB,KAAKH,OACZsB,EAAIH,EAAMle,OAAS,EAAE,KAAD,OAAEqe,GAAK,GAAC,iBAGc,GAF3Cnb,EAAOgb,EAAMG,GAAE,UACAnb,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,MAED,IADA6c,KAAKK,iBAAiBhX,EAAKlG,GACtB,gBACnB,OADmB,SACb,CAACkG,EAAKlG,EAAMA,OAAM,SALage,EAAC,uBAS1CH,GAAK,OAAOhB,KAAKF,UACRqB,EAAIH,EAAMle,OAAS,EAAE,KAAD,QAAEqe,GAAK,GAAC,iBAElB,GADXnb,EAAOgb,EAAMG,GAAE,UACAnb,EAAI,GAAlBqD,EAAG,KAAElG,EAAK,KACZ6c,KAAKH,MAAMa,IAAIrX,GAAK,CAAD,gBAC2B,IACjC,IADA2W,KAAKK,iBAAiBhX,EAAKlG,GACtB,iBACnB,OADmB,UACb,CAACkG,EAAKlG,EAAMA,OAAM,UANWge,EAAC,iEAU3C,8CAED,2GAC6BnB,KAAKiB,qBAAmB,wDACjD,OADiD,qBAAvC5X,EAAG,KAAElG,EAAK,cACd,CAACkG,EAAKlG,EAAMA,OAAM,qMAE3B,gBAED,WACE,IAAK6c,KAAKD,MACR,OAAOC,KAAKF,SAAS3L,KAGvB,IACsC,EADlCiN,EAAe,EAAC,UACFpB,KAAKF,SAASuB,QAAM,IAAtC,2BAAwC,CAAC,IAA9BhY,EAAG,QACP2W,KAAKH,MAAMa,IAAIrX,IAClB+X,GAEJ,CAAC,+BAED,OAAOE,KAAKC,IAAIvB,KAAKD,MAAQqB,EAAcpB,KAAKT,QAClD,GAAC,qBAED,WACE,OAAOS,KAAKwB,kBACd,GAAC,qBAED,SAAQC,GAAwC,IACI,EAD1BC,EAAY,uDAAG1B,KAAI,UAChBA,KAAKwB,oBAAkB,IAAlD,2BAAoD,CAAC,IAAD,qBAAxCnY,EAAG,KAAElG,EAAK,KACpBse,EAAiBE,KAAKD,EAAcve,EAAOkG,EAAK2W,KAClD,CAAC,+BACH,GAAC,WAED,WACE,OAAO5V,KAAKC,WAAU,OAAI2V,KAAKwB,oBACjC,KAAC,EAvR0B,EAuR1B,E,SAAA,GAvRmC7gB,KA0MlCihB,OAAOC,SA2EJD,OAAOE,Y,4QC9RRC,EAAU,qJACH,OADG,oCACPC,UAAI,qBADG,EACH,OADY1d,QAelB,SAAS2d,EAAiBjiB,GAC/B,GAAKA,EAAL,CAIA,KAAMA,aAAkBkiB,aACtB,MAAM,IAAI1C,UAAU,4BAGtB,GAAIxf,EAAOmiB,QACT,MAAMC,GAPR,CASF,CAEA,SAAS7N,EAAQ8N,GACf,OAAO,IAAIC,SAAQ,SAAAC,GAAO,OAAIjT,WAAWiT,EAASF,EAAG,GACvD,CAMO,SAAeG,EAAgB,GAAD,+BAOpC,8CAPM,WAA+BxiB,GAAoB,sFAKlDuU,EAAQ,GAAE,OAChB0N,EAAiBjiB,GAAO,4CACzB,sBAEM,SAASoiB,IACd,GAA4B,qBAAjBK,aACT,OAAO,IAAIA,aAAa,UAAW,cAErC,IAAMpS,EAAI,IAAI0R,EAAW,WAEzB,OADA1R,EAAE2R,KAAO,cACF3R,CACT,CAEO,SAASqS,EAAmB1iB,GACjC,OAAKA,GAGE2iB,EAAAA,EAAAA,GAAU3iB,EAAQ,SAFhB4iB,EAAAA,EAAAA,QAGX,CAMO,SAASC,EAAiBC,GAC/B,OACEA,aAAqBxe,QAED,eAAnBwe,EAAUpf,MAE0B,gBAAlCof,EAAyBd,QAMxBc,EAAUC,QAAQlZ,MAAM,6BAEhC,C,kJCvEWmZ,EACAC,EAKAC,E,qDAEJ,SAAStF,EAEdR,EACA1X,GAEI0X,EAAU+F,mBACA,IAAIC,EAAAA,eAAehG,EAAU+F,oBACrCE,QAAQ3d,GAEZA,EAAQ4d,UAAUlG,EAAgC,EAAG,EAEzD,CAEA,IAAMmG,EAC4C,oBAApBC,gBADxBD,EAEEE,IAGJF,GACFP,EAAe,SAACna,EAAOyF,GAAM,OAAK,IAAIkV,gBAAgB3a,EAAOyF,EAAO,EAEpE2U,EAAoBlhB,OAAOkhB,mBAAqBS,KAAKT,kBAErDC,EAAkBnhB,OAAO4hB,aAAeD,KAAKC,aACpCJ,GAETP,EAAe,WAGb,OAAOY,iBAAgB,uBACzB,EACAX,EAAiB,yCAAG,WAAOvF,GAAM,8IAEvB,IAAIpZ,MACR,kGACD,OAKwB,OAHrBuf,EAAUnG,EAAOoG,YAGjBC,EAAM,IAAIC,UAAW,kBACpB,IAAI1B,SAAQ,SAACC,EAAS0B,GAC3BF,EAAIG,OAAS,kBAAM3B,EAAQwB,EAAI,EAC/BA,EAAII,QAAUF,EACdF,EAAIvL,IAAMqL,CACZ,KAAE,2CACH,mDAfgB,KAiBjBb,EAAe,SAACna,EAAeyF,GAC7B,IAAM5I,EAAU,IAAI0d,EAAAA,eACpB,MAAO,CACLva,MAAAA,EACAyF,OAAAA,EACAqP,WAAU,WACR,OAAOjY,CACT,EAEJ,EACAud,EAAiB,yCAAG,WAAMvF,GAAM,4EACK,OAA7B0G,EAAM1G,EAAOC,WAAW,MAAK,kBAC5B,CACLrP,OAAQoP,EAAOpP,OACfzF,MAAO6U,EAAO7U,MACdsa,mBAAoBiB,EAAIC,SACxBC,yBAAyB,IAC1B,2CACF,mDARgB,GASjBpB,EAAkBqB,O,iKC7Eb,SAAeC,EAAuB,EAAD,sCA8D3C,8CA9DM,WACL3b,EACAyF,EACAmW,EAIAC,GAEuD,kGAEF,GAA7CC,EAAkDF,EAAlDE,UAAU,EAAwCF,EAAvCtH,sBAAuByH,OAAO,MAAG,EAAC,GAEjDD,EAAU,CAAD,mBACNA,EAAUE,gBAAgB,CAAD,gBACQ,OAA9BC,EAAU,IAAI1B,EAAAA,eAAgB,SACfsB,EAAGI,GAAQ,OAApB,OAANC,EAAM,4CAEPA,GAAM,IACTC,mBAAoBF,EAAQT,YAAQ,QAKH,GAF7BY,EAAQ,EACRvH,GAASsF,EAAAA,EAAAA,IAAa1B,KAAK4D,KAAKrc,EAAQoc,GAAQ3W,EAAS2W,GACzDb,EAAM1G,EAAOC,WAAW,MACrB,CAAD,sBACA,IAAIrZ,MAAM,sDAAqD,QAEhD,OAAvB8f,EAAIa,MAAMA,EAAOA,GAAM,UACFP,EAAGN,GAAI,QASR,GATdW,EAAM,gCAKPA,GAAM,wBAGElc,EAAK,KACJyF,IAEN,kBAAmBoP,GAAM,iBACF,OADE,KACfyH,EAAAA,cAAa,UACXzH,EAAO0H,cAAc,CACzBnf,KAAM,cACN,qGAEJyX,EAAOoG,YAAW,QAXhB,OAWgB,iBATxBjb,MAAK,KACLyF,OAAM,KACN+W,UAAS,2CAJbC,aAAa,EAAD,kFAmBmB,GAD7B5H,GAASsF,EAAAA,EAAAA,IAAa1B,KAAK4D,KAAKrc,EAAQ+b,GAAUtW,EAASsW,GAC3DR,EAAM1G,EAAOC,WAAW,MACrB,CAAD,sBACA,IAAIrZ,MAAM,sDAAqD,QAE5C,OAA3B8f,EAAIa,MAAML,EAASA,GAAQ,UACNF,EAAGN,GAAI,QACV,OADZW,EAAM,kCACAA,GAAM,oBAAmB9B,EAAAA,EAAAA,IAAkBvF,GAAO,QAAjC,OAAiC,oBAA1CN,UAAU,EAAD,kGAEhC,sB,2lBCjCM,SAASmI,EACd9kB,GAEA,OACE+kB,EAAAA,EAAAA,iBAAgB/kB,IAChB,eAAgBA,GAChB,YAAaA,GACb,UAAWA,CAEf,CA4EO,SAASglB,EAAehlB,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,eAAgBA,GAChB,kBAAmBA,CAEvB,CAMO,SAASilB,EACdjlB,GAEA,OAAOglB,EAAehlB,IAAU,sBAAuBA,CACzD,CAQO,SAASklB,EACdllB,GAEA,OAEEglB,EAAehlB,IAAU,iBAAkBA,IAAUA,EAAMmlB,gBAE/D,CAiCO,SAASC,EACdplB,GAEA,OAAOglB,EAAehlB,IAAU,YAAaA,CAC/C,CAMO,SAASqlB,EACdrlB,GAEA,OAAOglB,EAAehlB,IAAU,sBAAuBA,CACzD,CAOO,SAASslB,EACdtlB,GAEA,OAAOglB,EAAehlB,IAAU,mBAAoBA,CACtD,CAOO,SAASulB,EACdvlB,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,iBAAkBA,CAEtB,CAcO,SAASwlB,EAAYxlB,GAC1B,MACmB,kBAAVA,GACG,OAAVA,GACA,UAAWA,GACX,aAAcA,CAElB,CAMO,SAASylB,EAAazlB,GAC3B,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GAEnBA,EAAM2X,cAAc+N,OAExB,CASO,SAASC,EAAe3lB,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,kBAAmBA,GAEnBA,EAAM2X,cAAciO,SAExB,CAMO,SAASC,EAAiB7lB,GAC/B,MACmB,kBAAVA,GACG,OAAVA,GACA,cAAeA,GACf,cAAeA,CAEnB,CAuBO,SAASqL,EAAerL,GAC7B,MACmB,kBAAVA,GACG,OAAVA,GACA,sBAAuBA,GACvB,mCAAoCA,CAExC,CASO,SAAS8lB,EACd9lB,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,qBAAsBA,GACtB,mCAAoCA,CAExC,CAeO,SAAS+lB,EACd/lB,GAEA,MACmB,kBAAVA,GACG,OAAVA,GACA,eAAgBA,GAChB,oBAAqBA,CAEzB,CAoBO,SAASgL,EAAczJ,GAC5B,MAA2B,kBAAbA,GAAsC,OAAbA,GAAqB,QAASA,CACvE,CACO,IAAMykB,EAAe,0CAC1B,WAAmB1D,EAAwB2D,GAAc,IAAD,EAIA,OAJA,gBACtD,cAAM3D,IADWA,QAAAA,EAAe,EAAS2D,IAAAA,EAEzC,EAAKhjB,KAAO,kBAEZijB,OAAOC,gBAAe,UAAMH,EAAgBI,WAAU,CACxD,CAAC,iBANyB,EAMzB,OANkCviB,QASxBwiB,EAAU,0CACrB,WAAmB/D,EAAwBrX,GAA4B,IAAD,EAE5C,OAF4C,gBACpE,cAAMqX,IADWA,QAAAA,EAAe,EAASrX,kBAAAA,EAEzC,EAAKhI,KAAO,aAAY,CAC1B,CAAC,iBAJoB,EAIpB,OAJ6BY,QAOzB,SAASyiB,EACdjE,GAEA,OACEA,aAAqBxe,QAED,oBAAnBwe,EAAUpf,WAC8BnD,IAAtCuiB,EAA8B4D,IAErC,CAEO,SAASM,EAAiBlE,GAC/B,MAEqB,eAAnBA,EAAUpf,WACsCnD,IAA/CuiB,EAAyBpX,iBAE9B,C,4IC5ZO,SAASub,EACdC,GAEC,IAAD,yDADsC,CAAC,EAArC3S,EAAO,EAAPA,QAASvU,EAAM,EAANA,OAAQ0D,EAAI,EAAJA,KAEnB,OAAO,IAAI4e,SAAQ,SAACC,EAAS0B,GAC3B,IAKIkD,EALAC,GAAW,EAETC,GAAcC,EAAAA,EAAAA,MAASJ,GAIzBK,EAAgB,WAAO,EACvBhT,IACF4S,EAAY7X,YAAW,WAChB8X,IACHA,GAAW,EACXC,EAAYG,SACZvD,EAAO,IAAI3f,MAAM,yBAAD,OAA0BZ,GAAQ,iBAEtD,GAAG6Q,GACHgT,EAAgB,kBAAMJ,GAAa5X,aAAa4X,EAAU,GAIxDnnB,GACFA,EAAOK,iBAAiB,SAAS,WAC1B+mB,IACHA,GAAW,EAGXC,EAAYG,SACZD,IAEAtD,GAAO7B,EAAAA,EAAAA,OAEX,IAGFiF,EACGI,MAAK,WACCL,IACHA,GAAW,EACXG,IAEAhF,GAAQ,GAEZ,IACCmF,OAAM,SAAAC,GACAP,IACHA,GAAW,EACXG,IAEAtD,EAAO0D,GAEX,GACJ,GACF,CAOO,SAAeC,EAAW,kCAUhC,8CAVM,WACLV,GAAgB,wFACG,OAAnBzC,EAAc,+BAAG,CAAC,EAAC,SAEbwC,GAAK,WACT,IAAMle,EAAMme,IACZ,YAAe3mB,IAARwI,GAA6B,OAARA,CAC9B,GAAG0b,GAAK,gCAEDyC,KAAQ,2CAChB,wB,6YC1CKW,EAAe,WAKnB,cAAyC,oBAJzCC,eAAiB,IAAInnB,IAA4B,KAEjDonB,WAA0B,GAAE,2BAEbA,EAAU,yBAAVA,EAAU,gBACvB/H,KAAK+H,WAAaA,CACpB,CAkBC,OAlBA,2BAED,SAAIC,EAAkBrhB,GACpB,IAAKqZ,KAAK+H,WAAWplB,SAASqlB,GAC5B,MAAM,IAAI1jB,MAAM,iBAAD,OAAkB0jB,IAEnC,IAAIF,EAAiB9H,KAAK8H,eAAe3nB,IAAI6nB,GACxCF,IACHA,EAAiB,GACjB9H,KAAK8H,eAAe1nB,IAAI4nB,EAAOF,IAEjCA,EAAeG,KAAKthB,EACtB,GAAC,iBAED,WAAO,IAAD,OACJqZ,KAAK+H,WAAWG,SAAQ,SAAAC,GAAc,IAAD,EACD,QAAlC,IAAKL,eAAe3nB,IAAIgoB,UAAU,OAAlC,EAAoCD,SAAQ,SAAAvhB,GAAQ,OAAIA,GAAU,GACpE,GACF,KAAC,EAzBkB,GA0CfyhB,EAAU,WAGd,WACSC,EACAC,IAMN,oBAPMD,SAAAA,EAAgB,KAChBC,UAAAA,EAKD,KATRC,gBAAoD,CAAC,CAUlD,CAqBF,OArBG,2BAEJ,SAAI7kB,EAAc8kB,GAChBxI,KAAKuI,gBAAgB7kB,GAAQ8kB,CAC/B,GAAC,iBAED,SAAI9kB,GACF,OAAOA,KAAQsc,KAAKuI,eACtB,GAAC,iBAED,SAAI7kB,GACF,IAAKsc,KAAKU,IAAIhd,GACZ,MAAM,IAAIY,MAAM,GAAD,OACV0b,KAAKqI,SAAQ,aAAK3kB,EAAI,kFAG7B,OAAOsc,KAAKuI,gBAAgB7kB,EAC9B,GAAC,iBAED,WACE,OAAOijB,OAAO8B,OAAOzI,KAAKuI,gBAC5B,KAAC,EAhCa,GAuDKG,EAAa,WA0DhC,aAAiE,IAAD,OAApDC,EAA6C,uDAAG,IAAE,oBAzD9DC,QAAoB,GAAE,KAGtBC,MAAYC,EAAAA,EAAAA,KAAoB,KAEhCC,eAAiD,CAAC,EAAC,KAEnDC,yBAA+C,GAAE,KAEjDC,wBAA0B,IAAIpB,EAC5B,WACA,UACA,sBACA,UACA,QACA,aACA,OACA,SACA,aACA,mBACA,sBACD,KAEDqB,cAAgB,IAAId,EAAW,eAAgBe,EAAAA,SAAa,KAE5DC,aAAe,IAAIhB,EAAW,cAAeiB,EAAAA,GAAY,KAEzDC,uBAAyB,IAAIlB,EAC3B,wBACAmB,EAAAA,GACD,KAEDC,WAAa,IAAIpB,EAAW,YAAaqB,EAAAA,GAAU,KAEnDC,aAAe,IAAItB,EAAW,cAAeuB,EAAAA,GAAY,KAEzDC,gBAAkB,IAAIxB,EAAW,iBAAkByB,EAAAA,GAAe,KAElEtQ,UAAY,IAAI6O,EAAW,WAAY0B,EAAAA,GAAS,KAEhDC,YAAc,IAAI3B,EAAW,aAAc4B,EAAAA,GAAW,KAEtDC,WAAa,IAAI7B,EAAW,gBAAiB8B,EAAAA,GAAc,KAE3DC,gBAAkB,IAAI/B,EAAW,mBAAoBgC,EAAAA,GAAqB,KAE1EC,qBAAuB,IAAIjC,EACzB,sBACAkC,EAAAA,GACD,KAEDC,YAAa,EAAK,KAElBjf,eAAS,OAETkf,gBAA2C,IAAI7pB,IAAK,KAwMpD8pB,eAAiB,IAAI9pB,IAAK,KAE1B+pB,IAAMC,EAAAA,EAAS,KAEfC,KAAO,SAA4BF,GAIjC,OAHK,EAAKD,eAAe/J,IAAIgK,IAC3B,EAAKD,eAAerqB,IAAIsqB,EAAKA,EAAI,IAE5B,EAAKD,eAAetqB,IAAIuqB,EACjC,EAAC,KAQDG,UAAY,SACVH,GAGA,GAAmB,kBAARA,EAAkB,CAC3B,IAAMI,EAAO,EAAKJ,IAAIA,GACtB,IAAKI,EACH,MAAM,IAAItL,UAAU,+CAAD,OAC8BkL,EAAG,0IAGtD,OAAOI,CACT,CAEA,GAAmB,oBAARJ,EACT,OAAO,EAAKE,KAAKF,GAGnB,GAAIA,EAAIK,QACN,OAAO,EAAKF,UAAUH,EAAIK,SAG5B,MAAM,IAAIvL,UACR,gEAEJ,EA9OEQ,KAAKgL,UAAU,CAAEC,OAAQ,IAAIC,EAAAA,EAAcC,SAAU,CAAEC,QAAQ,KAG/DzC,EAAeT,SAAQ,SAAA+C,GACrB,EAAKD,UAAUC,EACjB,GACF,CAsZC,OAtZA,kDAED,WACE,IAAMI,EAAmD,CAAC,EAM1D,OALArL,KAAK4I,QAAQV,SAAQ,SAAA+C,GACfA,EAAOK,sBACTD,EAAqBJ,EAAOvnB,MAAQunB,EAAOK,oBAE/C,IACOD,CACT,GAAC,uBAED,SAAUT,GACR,GAAI5K,KAAKuK,WACP,MAAM,IAAIjmB,MAAM,kDAKlB,MACE,YAAasmB,GAAQ,cAAeA,EAChC,CAACA,EAAM,CAAC,GACR,CAACA,EAAKK,OAAQL,EAAKO,UAAS,eAH3BF,EAAM,YAAEE,OAAQ,MAAG,CAAC,EAAC,EAK5B,GAAInL,KAAK4I,QAAQjmB,SAASsoB,GACxB,MAAM,IAAI3mB,MAAM,4BAUlB,OAPA0b,KAAK+I,eAAekC,EAAOvnB,MAAQynB,EAC/B,eAAgBP,GAElB5K,KAAKgJ,yBAAyBf,KAAK2C,EAAKW,YAE1CN,EAAOO,QAAQxL,MACfA,KAAK4I,QAAQX,KAAKgD,GACXjL,IACT,GAAC,uBAED,SAAUtc,GACR,OAAOsc,KAAK4I,QAAQrc,MAAK,SAAAkf,GAAC,OAAIA,EAAE/nB,OAASA,CAAI,GAC/C,GAAC,uBAED,SAAUA,GACR,YAAgCnD,IAAzByf,KAAK0L,UAAUhoB,EACxB,GAAC,qCAED,WAOE,OAJIsc,KAAKiJ,0BACPjJ,KAAKiJ,wBAAwB0C,aACtB3L,KAAKiJ,yBAEPjJ,IACT,GAAC,0BAED,SAAa1U,GACX0U,KAAK1U,UAAYA,CACnB,GAAC,uBAED,WAAa,IAAD,OACV,GAAI0U,KAAKuK,WACP,MAAM,IAAIjmB,MAAM,sBAOlB,OAJA0b,KAAK4I,QAAQV,SAAQ,SAAA+C,GAAM,OAAIA,EAAOW,UAAU,EAAK,IAErD5L,KAAKuK,YAAa,EAEXvK,IACT,GAAC,kCAED,SACE6L,GAEA,OAAQA,GACN,IAAK,UACH,OAAO7L,KAAKoJ,aACd,IAAK,sBACH,OAAOpJ,KAAKsJ,uBACd,IAAK,aACH,OAAOtJ,KAAK4J,gBACd,IAAK,SACH,OAAO5J,KAAK+J,YACd,IAAK,WACH,OAAO/J,KAAKkJ,cACd,IAAK,UACH,OAAOlJ,KAAK0J,aACd,IAAK,QACH,OAAO1J,KAAKwJ,WACd,IAAK,OACH,OAAOxJ,KAAKzG,UACd,IAAK,aACH,OAAOyG,KAAKiK,WACd,IAAK,mBACH,OAAOjK,KAAKqK,qBACd,IAAK,qBACH,OAAOrK,KAAKmK,gBACd,QACE,MAAM,IAAI7lB,MAAM,yBAAD,OAA0BunB,EAAS,MAExD,GAAC,4BAED,SACEA,EACAC,GACC,IAAD,SACA,GAAgC,oBAArBA,EACT,MAAM,IAAIxnB,MACR,qEAGJ,IAAMynB,EAAa/L,KAAKtG,qBAAqBmS,GAuB7C,OArB4B,QAA5B,EAAA7L,KAAKiJ,+BAAuB,OAA5B,EAA8B+C,IAAIH,GAAW,WAC3C,IAAMI,EAAaH,EAAiB,GACpC,IAAKG,EAAWvoB,KACd,MAAM,IAAIY,MAAM,gBAAD,OAAiBunB,EAAS,kBAG3C,GAAIE,EAAWrL,IAAIuL,EAAWvoB,MAC5B,MAAM,IAAIY,MAAM,GAAD,OACVunB,EAAS,YAAII,EAAWvoB,KAAI,kDAInCqoB,EAAWC,IACTC,EAAWvoB,KACX,EAAKwoB,uBACH,8BACAD,GAGN,IAEOjM,IACT,GAAC,4BAED,SAAe6L,EAAsCxD,GACnD,OAAOrI,KAAKtG,qBAAqBmS,GAAW1rB,IAAIkoB,EAClD,GAAC,oCAED,SAAuBwD,GACrB,OAAO7L,KAAKtG,qBAAqBmS,GAAWlS,KAC9C,GAAC,4BAED,WACE,OAAOqG,KAAKmM,uBAAuB,aACrC,GAEA,8BACA,SACEN,EACAO,GAEC,IADDpR,EAAkB,uDAAGqR,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,MAE3BC,EAAiBtM,KAAKtG,qBAAqBmS,GAC9ClS,MAEAlW,KAAI,SAAA+kB,GAAC,OAAIA,EAAE4D,EAAU,IACrBxQ,QAAO,SAAA4M,GAAC,OAAI+D,EAAAA,EAAAA,QAAO/D,KAAMgE,EAAAA,EAAAA,aAAYhE,EAAE,IAI1C,OAA8B,IAA1B8D,EAAexpB,QACjB2pB,QAAQC,KAAK,uCAAD,OAC6Bb,EAAS,cAAMO,EAAS,OAE1DpR,GAEFqR,EAAAA,MAAAA,MAAAA,MAAAA,EAAAA,OAAK,OAAUC,GACxB,GAEA,uCACA,SACEK,GAEC,IADDP,EAAiC,uDAAG,eAE9BE,EAAiBtM,KAAKtG,qBAAqBiT,GAC9ChT,MAEAlW,KAAI,SAAA+kB,GAAC,OAAIA,EAAE4D,EAAU,IACrBxQ,QAAO,SAAA4M,GAAC,OAAIoE,EAAAA,EAAAA,+BAA8BpE,EAAE,IAK/C,OAH8B,IAA1B8D,EAAexpB,QACjBwpB,EAAerE,MAAK4E,EAAAA,EAAAA,qBAAoB,OAAQ,CAAC,IAE5CR,EAAAA,MAAAA,MAAAA,MAAAA,EAAAA,OAAK,OAAUC,GACxB,GAAC,6BA8CD,SAAgBjE,GACd,OAAOrI,KAAKkJ,cAAc/oB,IAAIkoB,EAChC,GAAC,8BAED,WACE,OAAOrI,KAAKkJ,cAAcvP,KAC5B,GAAC,4BAED,SAAe0O,GACb,OAAOrI,KAAKoJ,aAAajpB,IAAIkoB,EAC/B,GAAC,sCAED,SAAyBA,GACvB,OAAOrI,KAAKsJ,uBAAuBnpB,IAAIkoB,EACzC,GAAC,0BAED,SAAaA,GACX,OAAOrI,KAAKwJ,WAAWrpB,IAAIkoB,EAC7B,GAAC,4BAED,SAAeA,GACb,OAAOrI,KAAK0J,aAAavpB,IAAIkoB,EAC/B,GAAC,yBAED,SAAYA,GACV,OAAOrI,KAAKzG,UAAUpZ,IAAIkoB,EAC5B,GAAC,iCAED,SAAoBA,GAClB,OAAOrI,KAAKmK,gBAAgBhqB,IAAIkoB,EAClC,GAAC,2BAED,SAAcA,GACZ,OAAOrI,KAAK+J,YAAY5pB,IAAIkoB,EAC9B,GAAC,+BAED,SAAkBA,GAChB,OAAOrI,KAAK4J,gBAAgBzpB,IAAIkoB,EAClC,GAAC,8BAED,SAAiByE,GACf,OAAO9M,KAAKiK,WAAW9pB,IAAI2sB,EAC7B,GAAC,oCAED,SAAuBppB,GACrB,OAAOsc,KAAKqK,qBAAqBlqB,IAAIuD,EACvC,GAAC,6BAED,SAAgBghB,GACd,OAAO1E,KAAK+M,eAAe,WAAYrI,EACzC,GAAC,4BAED,SAAeA,GACb,OAAO1E,KAAK+M,eAAe,UAAWrI,EACxC,GAAC,sCAED,SAAyBA,GACvB,OAAO1E,KAAK+M,eAAe,sBAAuBrI,EACpD,GAAC,0BAED,SAAaA,GAAuC,IAAD,OAiBjD,OAAO1E,KAAK+M,eAAe,SAdV,WACf,IAAMC,EAAQtI,EAAG,GAWjB,OAViB,EAAKyH,uBAAuB,WACpCjE,SAAQ,SAAAlb,GAGbA,EAAQigB,YAAcD,EAAMtpB,MAC3BspB,EAAMtD,aAAa/mB,SAASqK,IAE7BggB,EAAME,eAAelgB,EAEzB,IACOggB,CACT,GAEF,GAAC,4BAED,SAAetI,GACb,OAAO1E,KAAK+M,eAAe,UAAWrI,EACxC,GAAC,yBAED,SAAYA,GAAiD,IAAD,OAiB1D,OAAO1E,KAAK+M,eAAe,QAhBV,WACf,IAAMI,EAAUzI,EAAG,GAanB,OAZiB,EAAKyH,uBAAuB,WACpCjE,SAAQ,SAAAlb,GAIZA,EAAQoN,WAAa+S,EAAQzpB,MAC5BsJ,EAAQoN,WAAa+S,EAAQC,cAC9BD,EAAQzD,aAAa/mB,SAASqK,IAE/BmgB,EAAQD,eAAelgB,EAE3B,IACOmgB,CACT,GAEF,GAAC,2BAED,SAAczI,GACZ,OAAO1E,KAAK+M,eAAe,SAAUrI,EACvC,GAAC,+BAED,SAAkBA,GAChB,OAAO1E,KAAK+M,eAAe,aAAcrI,EAC3C,GAAC,0BAED,SAAaA,GACX,OAAO1E,KAAK+M,eAAe,aAAcrI,EAC3C,GAAC,oCAED,SAAuBA,GACrB,OAAO1E,KAAK+M,eAAe,mBAAoBrI,EACjD,GAAC,qCAED,SAAwBA,GACtB,OAAO1E,KAAK+M,eAAe,qBAAsBrI,EACnD,GAAC,iCAED,SACE2I,EACA1mB,GAEA,IAAI2mB,EAAYtN,KAAKwK,gBAAgBrqB,IAAIktB,GACpCC,IACHA,EAAY,GACZtN,KAAKwK,gBAAgBpqB,IAAIitB,EAAoBC,IAE/CA,EAAUrF,KAAKthB,EACjB,GAAC,oCAED,SACE0mB,EACAE,EACAnpB,GAEA,IAAMkpB,EAAYtN,KAAKwK,gBAAgBrqB,IAAIktB,GACvCG,EAAcD,EAClB,GAAID,EAAW,CAAC,IACkB,EADnB,UACUA,GAAS,IAAhC,2BAAkC,CAAC,IAAxB3mB,EAAQ,QACjB,IACE6mB,EAAc7mB,EAAS6mB,EAAappB,EAGtC,CAFE,MAAOvB,GACP4pB,QAAQ5pB,MAAMA,EAChB,CACF,CAAC,+BACH,CACA,OAAO2qB,CACT,GAAC,kFAED,WACEH,EACAE,EACAnpB,GAA+B,oFAGL,GADpBkpB,EAAYtN,KAAKwK,gBAAgBrqB,IAAIktB,GACvCG,EAAcD,GACdD,EAAU,CAAD,0BACYA,GAAS,yDAAb,OAAR3mB,EAAQ,2BAEKA,EAAS6mB,EAAappB,GAAM,QAAhDopB,EAAW,yDAEXf,QAAQ5pB,MAAM,EAAD,IAAO,wKAInB2qB,GAAW,uEACnB,uDAnBA,MAmBA,EAxd+B,G,yGC1DjC,8CApEM,WACLliB,EACAmiB,EACAC,GAA4B,8FA2Dd,OA3Dc,SAGd,uCAENC,EAAsBriB,EAAUsiB,QAAQC,OAAOjS,QACnD,SAACoR,GAAU,QAAM1U,EAAAA,EAAAA,gBAAe0U,EAAO,kBAAoB,IAAIlqB,OAAS,CAAC,IACzEA,OAEIgrB,EAAoBnH,OAAOtF,KAAK0M,cAAcnS,QAAO,SAAAlY,GAAI,OAC7DA,EAAKf,SAAS,cAAc,IAC5BG,OAEejB,EAAkCyJ,EAA3CsiB,QAAiBvsB,EAA0BiK,EAA1BjK,QAAkB2sB,EAAQ1iB,EAAjB2iB,QAC1BJ,EAAgChsB,EAAhCgsB,OAAQK,EAAwBrsB,EAAxBqsB,WAAYtF,EAAY/mB,EAAZ+mB,QAGtBuF,EAAsB,CAC1BH,IAAAA,EACA,iBAAwB,OAAPpF,QAAO,IAAPA,OAAO,EAAPA,EAAS9lB,SAAU,EACpC,eAAuB,OAAP8lB,QAAO,IAAPA,OAAO,EAAPA,EAASnlB,KAAI,SAACgoB,GAAM,OAAKA,EAAE/nB,IAAI,IAAEpB,KAAK,KACtD,mBAAoB4rB,EAAWprB,OAC/B,eAAgB+qB,EAAO/qB,OACvB,wBAA+B,OAAPzB,QAAO,IAAPA,OAAO,EAAPA,EAAS+sB,cAActrB,SAAU,EACzD,cAAqB,OAAPzB,QAAO,IAAPA,OAAO,EAAPA,EAASma,MAAM1Y,SAAU,EACvC,uBAAwB6qB,EACxB,uBAAwBG,EAGxB,+BAA2C,OAAZJ,QAAY,IAAZA,OAAY,EAAZA,EAAcW,MAAM,KAAK,KAAM,OAG9D,QAAStsB,OAAOusB,OAAOhgB,OACvB,QAASvM,OAAOusB,OAAOzlB,MAGvB,QAAS9G,OAAOwsB,YAChB,QAASxsB,OAAOysB,WAEhBC,SAAUC,EAAAA,WACVC,UAAWzO,KAAKC,MAAQsN,GAAoB,IAC5CmB,KAAK,GAIPf,EAAO3F,SAAQ,SAAC8E,GACd,IAAM3jB,EAAG,sBAAkB2jB,EAAM/mB,MACjCkoB,EAAM9kB,GAAO8kB,EAAM9kB,GAAO,GAAK,CACjC,IAGO,OAAPhI,QAAO,IAAPA,GAAAA,EAAS+sB,cAAclG,SAAQ,SAAC8E,GAC9B,IAAM3jB,EAAG,6BAAyB2jB,EAAM/mB,MACxCkoB,EAAM9kB,GAAO8kB,EAAM9kB,GAAO,GAAK,CACjC,IAGMwlB,EAAKlI,OAAOtF,KAAK8M,GACpB1qB,KAAI,SAAA4F,GAAG,gBAAOA,EAAG,YAAI8kB,EAAM9kB,GAAI,IAC/B/G,KAAK,KAAI,UAENwsB,MAAM,GAAD,OA1DC,uCA0DM,YAAID,IAAK,0DAE3BpC,QAAQ5pB,MAAM,oCAAoC,EAAD,IAAI,2DAExD,sBA4CA,8CA1CM,WACLyI,EACAyjB,GAAwB,oFAEJ,eACdZ,EAAsB,CAC1B,eAAgB7iB,EAAUsiB,QAAQC,OAAO/qB,OACzCkrB,IAAK1iB,EAAU2iB,QACfQ,SAAUC,EAAAA,WACVC,SAAUzO,KAAKC,MAAQ4O,EACvBC,aAC2B,QAAzB,EAAA1jB,EAAUsiB,QAAQhF,eAAO,aAAzB,EAA2BnlB,KAAI,SAACwnB,GAAW,OAAKA,EAAOvnB,IAAI,MAAK,IAIhEurB,EACF,+EACFA,GACE,iFACFA,GACE,kFACFA,GACE,qFACFA,GAAe,wBAnBK,eAmB2B,iCAEzCC,EAAuB,CAAC,EACL,kGAERb,MAAM,OAAOnG,SAAQ,SAAC7e,EAAK8lB,GAC1CD,EAAO,YAAD,OAAaC,EAAQ,IAAOhB,EAAM9kB,EAC1C,IAEA6lB,EAAOE,QAAU9N,KAAK+N,MAAMlB,EAAMQ,UAElCM,GAAe,+CAA4C7kB,KAAKC,UAC9D6kB,GACD,OAEKI,EAAsB/e,SAASgf,cAAc,WAC/BC,UAAYP,EAEhC1e,SAASkf,qBAAqB,QAAQ,GAAGC,YAAYJ,GAAoB,6CAC1E,sBAEM,SAASK,EACdrkB,EACAyjB,EACAa,GAGEtkB,KACCgN,EAAAA,EAAAA,gBAAehN,EAAUsiB,QAAQxV,cAAe,sBAzH9C,SAAiC,EAAD,6BA2HnCyX,CAAkBvkB,EAAWyjB,EAAkBa,GArD5C,SAAgC,EAAD,2BAsDlCE,CAAiBxkB,EAAWyjB,GAEhC,C,uLC9GMgB,IAAoBC,EAAAA,EAAAA,OAAK,kBAAM,8BAA6B,IAE5DC,IAAkBD,EAAAA,EAAAA,OAAK,kBAAM,8BAA2B,IAAC,wJAQ5D,OAR4D,oCAG7DtsB,KAAO,uBAAsB,EAE7BwsB,QAAU,CACRD,gBAAAA,GACAF,kBAAAA,IACD,EAmE0C,OAnE1C,+BAED,SAAQtW,GACNA,EAAc0W,mBACZ,kBACE,IAAItG,EAAAA,EAAe,CACjBnmB,KAAM,yBACN0sB,aAAcC,GAAAA,EACdC,YAAYC,EAAAA,GAAAA,GAAiB9W,GAC7B7V,YAAa,iBACbyH,YAAa,kDACbqb,IAAK,+DACL,IAGNjN,EAAc+W,eAAc,WAC1B,OAAO,IAAIxG,EAAAA,EAAW,CACpBtmB,KAAM,kCACN+sB,QAAS,mBACTL,aAAcM,GAAAA,EACdJ,YAAYK,EAAAA,GAAAA,GAA2ClX,GACvDa,gBAAgB0V,EAAAA,EAAAA,OACd,kBACE,+DAEC,KAGT,IAEAvW,EAAc+W,eAAc,WAC1B,OAAO,IAAIxG,EAAAA,EAAW,CACpBtmB,KAAM,iBACN+sB,QAAS,cACTL,aAAcQ,GAAAA,EACdN,YAAYO,EAAAA,GAAAA,GAA0BpX,GACtCa,gBAAgB0V,EAAAA,EAAAA,OACd,kBAAM,iEAAoD,KAGhE,IAEAvW,EAAc+W,eAAc,WAC1B,OAAO,IAAIxG,EAAAA,EAAW,CACpBtmB,KAAM,sBACN+sB,QAAS,mBACTL,aAAcU,GAAAA,EACdR,WAAYS,GAAAA,EACZzW,gBAAgB0V,EAAAA,EAAAA,OACd,kBAAM,uDAA8D,KAG1E,IAEAvW,EAAc+W,eAAc,WAC1B,OAAO,IAAIxG,EAAAA,EAAW,CACpBtmB,KAAM,oBACN+sB,QAAS,eACTL,aAAcY,GAAAA,EACdV,YAAYW,EAAAA,GAAAA,GAA6BxX,GACzCa,gBAAgB0V,EAAAA,EAAAA,OACd,kBAAM,kEAA0D,KAGtE,GACF,GAAC,uBAED,SAAUkB,GAAgC,KAAC,EA3EkB,CAElCC,EAAAA,G,0PC8B7B,GAhCoB,CAClBC,GAAAA,GACAC,GAAAA,GACAC,EAAAA,GACAC,EAAAA,GACAC,EAAAA,EACAC,EAAAA,GACAC,EAAAA,GACAC,GACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,GACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,EAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,GAAAA,EACAC,EAAAA,G,0SCzCK,SAASC,GAAaC,GAC3B,IAAIC,EAAM,EAEV,OADWD,EAAIpwB,OAAS,GAEtB,KAAK,EACHqwB,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,KAAK,EACHA,EAAM,EACN,MACF,QACE,MAAM,IAAI7uB,MAAM,6BAEpB,OAAO4uB,EAAM,IAAIE,OAAOD,EAC1B,CAOO,SAAeE,GAAe,GAAD,gCASpC,cAFC,OAED,2BATO,WAA8BH,GAAW,wFAC6B,OAArEI,EAAcL,GAAaC,EAAIK,QAAQ,KAAM,KAAKA,QAAQ,KAAM,MAAK,SAC7C,6CAAmB,OAA9B,OAA8B,SAAzCC,EAAW,EAAXA,YAAW,SACO,qCAAc,OAET,OAFS,SAAhCC,EAAO,EAAPA,QACFC,EAAQF,EAAYF,GACpBK,EAAWF,EAAQC,GAAM,mBACxB,IAAIE,aAAcC,OAAOF,IAAS,6CAC1C,sBAOM,SAAeG,GAAa,GAAD,gCAUjC,gDAVM,WAA4BtqB,GAAW,0FACD,OAArCkqB,GAAQ,IAAIK,aAAcC,OAAOxqB,GAAI,SACjB,qCAAc,OAAzB,OAAyB,SAAhCyqB,EAAO,EAAPA,QAAO,SACiB,6CAAmB,OAGnB,OAHmB,SAA3CC,EAAa,EAAbA,cACFC,EAAWF,EAAQP,GACnBU,EAAUF,EAAcC,GACxBhiB,EAAMiiB,EAAQ1qB,QAAQ,KAAI,kBACzByI,EAAM,EACTiiB,EAAQxqB,MAAM,EAAGuI,GAAKohB,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KACzDa,EAAQb,QAAQ,MAAO,KAAKA,QAAQ,MAAO,MAAI,6CACpD,sBAQM,SAASc,GAAqBrrB,EAAyB/C,GAE5D,QAAa1F,IAATyI,EAGJ,IAAIsrB,EAAAA,EAAAA,aAAYruB,IAAQ,WACtB,IAAMsuB,EAAQvrB,EACRwrB,GAAYC,EAAAA,EAAAA,cAAazrB,GAC/B,IAAI0rB,EAAAA,EAAAA,iBAAgBF,GAElB,IAF+B,IAAD,eAGvBG,EAAAA,EAAAA,mBAAiB,kBAAMJ,EAAMpT,EAAE,IAGlCA,GAAK,EAFLoT,EAAMK,OAAOzT,EAAG,GAGjB,KALMA,EAAI,EAAGA,EAAIoT,EAAMzxB,QAAW,EAA5Bqe,GAQXoT,EAAMrM,SAAQ,SAAA2M,GACZR,GAAqBQ,EAAIL,EAC3B,GAAE,CAfoB,QAgBjB,IAAIM,EAAAA,EAAAA,WAAU7uB,IAAQ,WAC3B,IAAMxC,EAAMuF,EACNwrB,GAAYC,EAAAA,EAAAA,cAAahxB,GAC/B,IAAIixB,EAAAA,EAAAA,iBAAgBF,GAAY,CAAC,IAAD,WAEnBnrB,IACJsrB,EAAAA,EAAAA,mBAAiB,kBAAMlxB,EAAItD,IAAIkJ,EAAI,KACtC5F,EAAI2c,OAAO/W,EACZ,EAHH,IAAK,IAAMA,KAAO5F,EAAI4d,OAAS,EAApBhY,EAKb,CACA5F,EAAIykB,SAAQ,SAAA6M,GACVV,GAAqBU,EAAOP,EAC9B,GAAE,CAbyB,QActB,IAAIhI,EAAAA,EAAAA,aAAYvmB,GAAO,CAE5B,IAAQ+uB,GAAeC,EAAAA,EAAAA,oBAAmBjsB,GAAlCgsB,WAERrO,OAAOuO,QAAQF,GAAY9M,SAAQ,YAAqB,IAAD,eAAlBiN,EAAK,KAAEC,EAAK,KAE/Cf,GAAqBrrB,EAAKmsB,GAAQC,EACpC,GACF,CACF,CCnHA,SAASC,GAAYvyB,GACnB,OAAOf,OACJuzB,KACCC,MAAMC,KAAKzzB,OAAO0zB,OAAOC,gBAAgB,IAAIC,WAAoB,EAAT7yB,KACrDW,KAAI,SAAAuM,GAAC,OAAIuU,OAAOqR,aAAa5lB,EAAE,IAC/B1N,KAAK,KAETixB,QAAQ,QAAS,IACjBnoB,UAAU,EAAGtI,EAClB,CAEA,IAAM+yB,GAAO,yCAAG,WAAOtX,EAAcuX,GAAgB,4FACjC,8DAAuB,OAAhC,OAAHC,EAAG,yBACFA,EAAIF,QAAQtX,EAAMuX,GAAUE,YAAU,2CAC9C,gBAHY,wCAKPC,GAAO,yCAAG,WAAO1X,EAAcuX,GAAgB,gGACjC,8DAAuB,OAAhC,OAAHC,EAAG,gBACU,mCAA4B,OACN,OADnCG,EAAI,OACJxC,EAAQqC,EAAIE,QAAQ1X,EAAMuX,GAAS,kBAClCpC,EAAMsC,SAASE,IAAK,2CAC5B,gBALY,wCAOb,SAASC,GAAYxO,GACnB,IAEE,OADYvd,KAAKE,MAAMqd,GACZ5E,OAGb,CAFE,MAAO1S,GACP,OAAOsX,CACT,CACF,CAEO,SAAeyO,GAAqB,EAAD,qCA8BzC,gDA9BM,WACL/0B,EACAqlB,EACA2P,GAAe,wGAEIvC,GAAa1pB,KAAKC,UAAUhJ,IAAS,OACzB,OADzBi1B,EAAI,OACJR,EAAWT,GAAY,GAAE,SACAQ,GAAQS,EAAMR,GAAS,OAKvB,OALzBS,EAAgB,QAEhBC,EAAO,IAAIC,UACZC,OAAO,UAAWH,GACvBC,EAAKE,OAAO,aAAa,GAAD,OAAKxW,KAAKC,QAClCqW,EAAKE,OAAO,UAAWL,GAAQ,UAERvH,MAAM,GAAD,OAAIpI,EAAG,SAAS,CAC1CiQ,OAAQ,OACRC,KAAM,OACNC,KAAML,IACN,QAJY,IAARM,EAAQ,QAMAC,GAAG,CAAD,iCACID,EAASvY,OAAM,QAAxB,MAAHoJ,EAAG,OACH,IAAIrjB,MAAM6xB,GAAYxO,IAAK,yBAEhBmP,EAASE,OAAM,QAAxB,OAAJA,EAAI,yBACH,CACLA,KAAAA,EACAT,iBAAAA,EACAT,SAAAA,IACD,6CACF,sBAEM,SAAemB,GAAsB,EAAD,uCAmB1C,gDAnBM,WACLC,EACAC,EACArB,EACA91B,GAAoB,oFAGyB,OADvCo3B,EAAYD,EAAkB9I,MAAM,UAAU,GAC9C3H,EAAG,UAAMwQ,EAAO,sBAAcE,GAAS,SACtBtI,MAAMpI,EAAK,CAChC1mB,OAAAA,IACA,OAFY,IAAR82B,EAAQ,QAIAC,GAAG,CAAD,gCACID,EAASvY,OAAM,OAAxB,MAAHoJ,EAAG,OACH,IAAIrjB,MAAM6xB,GAAYxO,IAAK,yBAGhBmP,EAASE,OAAM,QAAxB,OAAJA,EAAI,yBACHf,GAAQe,EAAK31B,QAASy0B,IAAS,6CACvC,sB,gBClDK/0B,IAAYC,EAAAA,GAAAA,KAAAA,EAAa,SAAAiG,GAAK,MAAK,CACvCowB,SAAU,CACRC,UAAW,SACXC,YAAa,OAEfC,YAAa,CACX3hB,iBAAiB4hB,EAAAA,GAAAA,IACfxwB,EAAMgM,QAAQ/N,QAAQ+Q,aACtBhP,EAAMgM,QAAQtI,OAAO+sB,cAEvB,UAAW,CACT,uBAAwB,CACtB7hB,gBAAiB,iBAIvB8hB,eAAgB,CACdhwB,QAASV,EAAMW,QAAQ,IAEzB0U,YAAa,CACX/U,SAAU,WACViQ,MAAOvQ,EAAMW,QAAQ,GACrBP,IAAKJ,EAAMW,QAAQ,GACnBiD,MAAO5D,EAAMgM,QAAQsJ,KAAK,MAE7B,IAEKqb,GAA6B,mBAEnC,SAASC,GAAezzB,GAKtB,IAAQ1C,EAAYX,KAAZW,QACA6I,EAAkCnG,EAAlCmG,QAASC,EAAyBpG,EAAzBoG,KAAMstB,EAAmB1zB,EAAnB0zB,eACvB,GAA8Bv1B,EAAAA,EAAAA,UAASu1B,GAAe,eAA/CC,EAAO,KAAEC,EAAU,KAC1B,GAA4Cz1B,EAAAA,EAAAA,WAAS,GAAM,eAApD01B,EAAc,KAAEC,EAAiB,KAElC1b,EAAc,WAClBuR,aAAaoK,QAAQP,GAA4BG,GACjDxtB,EAAQwtB,EACV,EAEA,OACE,mCACE,WAACtb,GAAA,EAAM,CAAClS,QAASiS,EAAahS,KAAMA,EAAK,WACvC,WAACkS,GAAA,EAAW,uCAETF,GACC,UAACG,GAAA,EAAU,CAACnZ,UAAW9B,EAAQ4a,YAAanY,QAASqY,EAAY,UAC/D,UAACI,GAAA,EAAS,MAEV,SAEN,WAACE,GAAA,EAAa,YACZ,WAACsb,GAAA,EAAiB,mFAEhB,UAACzb,GAAA,EAAU,CAACxY,QAAS,kBAAM+zB,GAAkB,EAAK,EAAC,UACjD,UAACG,GAAA,EAAe,UAGpB,UAACve,GAAA,EAAW,CAACpT,UAAU,WAAU,UAC/B,WAAC4xB,GAAA,EAAU,CACTn1B,MAAO40B,EACPz2B,SAAU,SAAA+B,GACR,IAAM0F,EAAM1F,EAAMC,OAAOH,MACzB60B,EAAWjvB,EACb,EAAE,WAEF,UAACwvB,GAAA,EAAgB,CACfp1B,MAAM,QACNq1B,SAAS,UAACC,GAAA,EAAK,IACfz1B,MAAM,eAER,UAACu1B,GAAA,EAAgB,CACfp1B,MAAM,OACNq1B,SAAS,UAACC,GAAA,EAAK,IACfz1B,MAAM,yBAMhB,UAAC01B,GAAU,CACTluB,KAAMytB,EACN1tB,QAAS,WACP2tB,GAAkB,EACpB,MAIR,CACA,SAASQ,GAAWt0B,GAClB,IAAQ1C,EAAYX,KAAZW,QACA6I,EAAkBnG,EAAlBmG,QAASC,EAASpG,EAAToG,KAEXgS,EAAc,WAClBjS,GACF,EAEA,OACE,WAACkS,GAAA,EAAM,CAAClS,QAASiS,EAAahS,KAAMA,EAAK,WACvC,WAACkS,GAAA,EAAW,CAAC9R,GAAG,sBAAqB,oCAElCL,GACC,UAACoS,GAAA,EAAU,CAACnZ,UAAW9B,EAAQ4a,YAAanY,QAASqY,EAAY,UAC/D,UAACI,GAAA,EAAS,MAEV,SAEN,WAACE,GAAA,EAAa,YACZ,UAACsb,GAAA,EAAiB,ibASlB,UAACA,GAAA,EAAiB,mVAQlB,UAACA,GAAA,EAAiB,sEAM1B,CAEA,IAAMO,IAAcv3B,EAAAA,EAAAA,WAClB,YAMO,IALLob,EAAW,EAAXA,YACAnb,EAAO,EAAPA,QAKQK,EAAYX,KAAZW,QACR,GAAgCa,EAAAA,EAAAA,UAAS,IAAG,eAArCq2B,EAAQ,KAAEC,EAAW,KAC5B,GAA8Bt2B,EAAAA,EAAAA,UAAS,IAAG,eAAnCu2B,EAAO,KAAEC,EAAU,KAC1B,GAA8Bx2B,EAAAA,EAAAA,WAAS,GAAK,eAArCy2B,EAAO,KAAEC,EAAU,KAC1B,GAA0B12B,EAAAA,EAAAA,YAAmB,eAAtCM,EAAK,KAAEq2B,EAAQ,KACtB,GAAoD32B,EAAAA,EAAAA,WAAS,GAAM,eAA5D42B,EAAkB,KAAEC,EAAqB,KAE1C1S,EAAMrlB,EAAQg4B,SACdvB,EACJ/J,aAAauL,QAAQ1B,KAA+B,QAChD2B,GAAOC,EAAAA,EAAAA,aAAYn4B,GAwDzB,OAtDAuB,EAAAA,EAAAA,YAAU,WACR,IAAI62B,GAAY,EA0BhB,OAzBC,uBAAC,gGACuB,UAAnB3B,EAA0B,iBAGuB,OAHvB,SAE1BmB,GAAW,GACLS,EAAc,IAAIC,IAAI53B,OAAOC,SAAS43B,MAAK,SAC5BxD,GACnBmD,EACA7S,EACAgT,EAAYE,MACb,OAJK7U,EAAM,OAKP0U,KACGI,EAAS,IAAI/3B,gBAAgB43B,EAAYz3B,SACxC7B,IAAI,UAAU,SAAD,OAAW2kB,EAAOiS,KAAKI,YAC3CyC,EAAOz5B,IAAI,WAAY2kB,EAAO+Q,UAC9B4D,EAAYz3B,OAAS43B,EAAO7D,WAC5B6C,EAAYa,EAAYE,OACzB,kDAEDV,EAAS,EAAD,IAAG,QAEM,OAFN,UAEXD,GAAW,GAAM,4EApBtB,GAyBM,WACLQ,GAAY,CACd,CACF,GAAG,CAAC3B,EAAgBpR,EAAK6S,KAEzB32B,EAAAA,EAAAA,YAAU,WACR,IAAI62B,GAAY,EAgBhB,OAfC,uBAAC,sHAGqB3F,GAAa1pB,KAAKC,WAAUmvB,EAAAA,EAAAA,aAAYn4B,KAAU,OAA/Di1B,EAAI,OACJwC,EAAU,IAAIa,IAAI53B,OAAOC,SAAS43B,OAClCE,EAAa,IAAIh4B,gBAAgBg3B,EAAQ72B,SACpC7B,IAAI,UAAU,WAAD,OAAak2B,IACrCwC,EAAQ72B,OAAS63B,EAAW9D,WACvByD,GACHV,EAAWD,EAAQ9C,YACpB,kDAEDkD,EAAS,EAAD,IAAG,yDAZd,GAeM,WACLO,GAAY,CACd,CACF,GAAG,CAACp4B,KAGF,mCACE,WAACob,GAAA,EAAM,CACLtO,SAAS,KACT3D,MAAI,EACJD,QAASiS,EACT,cAAY,eAAc,WAE1B,WAACE,GAAA,EAAW,oCAETF,GACC,UAACG,GAAA,EAAU,CAACnZ,UAAW9B,EAAQ4a,YAAanY,QAASqY,EAAY,UAC/D,UAACI,GAAA,EAAS,MAEV,SAEN,UAACC,GAAA,EAAO,KAER,WAACC,GAAA,EAAa,YACZ,WAACsb,GAAA,EAAiB,wEAEhB,UAACzb,GAAA,EAAU,CAACxY,QAAS,kBAAMi1B,GAAsB,EAAK,EAAC,UACrD,UAACW,GAAA,EAAY,SAIG,UAAnBjC,EACCj1B,GACE,UAACgX,GAAA,EAAU,CAAChP,MAAM,QAAO,mBAAKhI,KAC5Bm2B,GACF,UAACnf,GAAA,EAAU,uCAEX,UAACmgB,GAAA,EAAS,CACRh3B,MAAM,MACNG,MAAOy1B,EACPp3B,WAAY,CACVy4B,UAAU,GAEZ72B,WAAY,CAAE,cAAe,kBAC7BH,QAAQ,SACR8D,MAAO,CAAE8B,MAAO,QAChB1E,QAAS,SAAAd,GACQA,EAAMC,OACdP,QACT,EACA,cAAY,qBAIhB,UAACi3B,GAAA,EAAS,CACRh3B,MAAM,MACNG,MAAO21B,EACPt3B,WAAY,CACVy4B,UAAU,GAEZh3B,QAAQ,SACR8D,MAAO,CAAE8B,MAAO,QAChB1E,QAAS,SAAAd,GACQA,EAAMC,OACdP,QACT,QAIN,WAACga,GAAA,EAAa,YACZ,UAAC/C,GAAA,EAAM,CACL7V,QAAS,WACP+1B,KAAKtB,GAAYE,EAAQ9C,YACzB30B,EAAQ+X,OAAO,sBAAuB,UACxC,EACAvO,MAAM,UACNsvB,WAAW,UAAC,MAAe,IAC3B52B,SAA6B,UAAnBu0B,GAA8BkB,EAAQ,oCAKlD,UAAChf,GAAA,EAAM,CAAC7V,QAASqY,EAAa3R,MAAM,UAAUoS,WAAS,4BAM3D,UAAC4a,GAAc,CACbrtB,KAAM2uB,EACN5uB,QAAS,WACP6uB,GAAsB,EACxB,EACAtB,eAAgBA,MAIxB,IAkCF,IA/BoB12B,EAAAA,EAAAA,WAClB,SAACgD,GACC,OAAwB7B,EAAAA,EAAAA,WAAS,GAAM,eAAhCiI,EAAI,KAAE4vB,EAAO,KAEZ/4B,EAAY+C,EAAZ/C,QACAK,EAAYX,KAAZW,QAMR,OACE,kBAAK8B,UAAW9B,EAAQ21B,SAAS,WAC/B,UAACrd,GAAA,EAAM,CACL,cAAY,eACZ7V,SAAO,uBAAE,4GAAYi2B,GAAQ,IAAK,2CAClCjmB,KAAK,QACLtJ,MAAM,UACNsvB,WAAW,UAACE,GAAA,EAAS,IACrB34B,QAAS,CAAEwH,KAAMxH,EAAQ81B,aAAc,mBAIxChtB,GACC,UAACmuB,GAAW,CAACnc,YAjBC,WAClB4d,GAAQ,EACV,EAe6C/4B,QAASA,IAC9C,OAGV,IC7UF,QAAeD,EAAAA,EAAAA,WA5Bf,SAAwB,GAAsD,IACpEkK,EAD6B,EAAbmO,cAChBnO,UAER,EAKIA,EAJFgvB,EAAiB,EAAjBA,kBACAC,EAAuB,EAAvBA,wBACAC,EAAwB,EAAxBA,yBACAC,EAAkB,EAAlBA,mBAGF,OACE,kCACGH,GACC,UAACrK,GAAe,CACd3kB,UAAWA,EACXf,QAAS,kBAAMkwB,GAAmB,EAAM,IAExC,KACHF,GACC,UAACxK,GAAiB,CAChBzkB,UAAWA,EACXf,QAAS,kBAAMiwB,GAAyB,EAAM,IAE9C,OAGV,IChBME,IAAUt5B,EAAAA,EAAAA,WACd,YAA0D,IAAvDqY,EAAa,EAAbA,cACD,GAAmBkhB,EAAAA,EAAAA,eAAc,WAAYC,EAAAA,aAAtCC,GAAkD,YAA1C,GACf,GAAsBF,EAAAA,EAAAA,eAAc,cAAeC,EAAAA,aAA5CE,GAAwD,YAA7C,GAClB,GAAqBH,EAAAA,EAAAA,eAAc,SAAUC,EAAAA,aAAtCG,GAAkD,YAAxC,GACjB,GAAyBJ,EAAAA,EAAAA,eAAc,UAAWC,EAAAA,aAAzCI,GAAqD,YAAzC,GACb1vB,EAAcmO,EAAdnO,UACR,EAA2BA,GAAa,CAAC,EAAjCzI,EAAK,EAALA,MAAO+qB,EAAO,EAAPA,QACTvsB,EAAmB,OAATiK,QAAS,IAATA,OAAS,EAATA,EAAWjK,QACrB45B,EAAmB55B,EAAQuJ,GAmCjC,IAjCAhI,EAAAA,EAAAA,YAAU,WACRo4B,EAAa,SAAD,OAAUC,IAEtBl5B,OAAOm5B,iBAAmB5vB,EAE1BvJ,OAAOo5B,eAAiB95B,CAC1B,GAAG,CAAC45B,EAAkB3vB,EAAWjK,EAAS25B,KAE1Cp4B,EAAAA,EAAAA,YAAU,WACR,GAAKgrB,GAAYiN,EAGjB,OAAOO,EAAAA,EAAAA,YAAWxN,EAAO,yCAAE,WAAMyN,GAAQ,uGAEdvM,MAAMgM,GAAW,gBAAqB,CAC3DnE,OAAQ,OACR2E,QAAS,CAAE,eAAgB,oBAC3BzE,KAAMzsB,KAAKC,UAAU,CACnBwwB,SAAAA,EACAE,WAAAA,EACAl5B,OAAQw5B,MAEV,OARY,IAARvE,EAAQ,QASAC,GAAG,CAAD,+BACQD,EAASvY,OAAM,OAAxB,MAAPwE,EAAO,OACP,IAAIze,MAAM,QAAD,OAASwyB,EAASyE,OAAM,aAAKxY,EAAO,MAAI,yDAGlD,OAAP1hB,QAAO,IAAPA,GAAAA,EAAS+X,OAAO,uBAAD,cAA4B,0DAE9C,mDAlBwB,GAmB3B,GAAG,CAACwU,EAASvsB,EAASw5B,EAAUC,EAAaC,IAEzCl4B,EACF,MAAMA,EAER,IAAKyI,EACH,MAAM,IAAIhH,MAAM,sBAElB,IAAKjD,EACH,MAAM,IAAIiD,MAAM,oBAGlB,IAAM2C,GAAQpD,EAAAA,EAAAA,SAAQyH,EAAUsiB,QAAS,SACzC,OACE,WAAC4N,GAAA,EAAa,CAACv0B,OAAOmP,EAAAA,EAAAA,oBAAmBnP,GAAO,WAC9C,UAACw0B,GAAA,GAAW,KACZ,UAAC,EAAAC,IAAG,CACFr6B,QAASA,EACTsX,eAAe,UAAC,GAAW,CAACtX,QAASA,MAEtCw5B,GAAW,UAAC,GAAc,CAACphB,cAAeA,IAAoB,OAGrE,IAGF,M,iHCzEMkiB,GAAe,IAAIjd,OACvB,+DAOIkd,GAAgB,CACpB,mBACA,mBACA,oBACA,iBACA,iBACA,mBACA,qBACA,mBACA,mBACA,mBACA,mBACA,iBACA,kBACA,iBACA,oBACA,qBACA,mBACA,qBACA,mBACA,oBACA,qBACA,qBACA,qBACA,qBACA,qBACA,oBACD,SAEcC,GAAe,EAAD,uCAiD7B,cAFC,OAED,2BAjDA,WACEl4B,EACAm4B,EACAxc,EACAtf,GAAoB,kFAEH,OAATo3B,EAAc9X,EAAd8X,UAAS,UACXnQ,EAAAA,EAAAA,OAAK,oBAAStjB,EAASo4B,UAAWp4B,EAASq4B,eAAe,GAAE,CAChEh8B,OAAAA,EACA0D,KAAM,wBACN,uBAEsBC,EAASs4B,WAAWta,KAC1CyV,EACA,mBAAkB,QAEhB0E,cAAAA,EACA97B,OAAAA,GACGsf,GAEL,CAAE/K,QAAS,MACZ,OAEqB,GAXhB2nB,EAAQ,OAWav4B,EAAnBq4B,eACY,CAAD,qBACX,IAAI13B,MAAM,0BAAD,OAA2BX,EAASD,KAAI,sBAAoB,OAgB5E,OAbKy4B,EAAaxV,OAAOyV,YACxBF,EAASz4B,KAAI,SAAAC,GAEX,OADA24B,GAAa34B,GACN,CAACC,EAAS24B,oBAAoB54B,GAAOA,EAC9C,KAII64B,EAAW5V,OAAOyV,YACtBzV,OAAOuO,QAAQiH,GAAY14B,KAAI,+BAAE+4B,EAAa,KAAa,MAAM,CAAN,KAEzDA,EACD,KACF,kBAEM,CACLC,WAAYN,EACZO,WAAYH,IACb,6CACF,sBAGD,SAASF,GAAaM,GACpB,IAAKA,EAAQ9yB,MAAM8xB,IACjB,MAAM,IAAIr3B,MAAM,iCAAD,OAAkCq4B,EAAO,KAE5D,CAuCe,SAASC,GACtBC,EACAC,GAEA,IAAMC,EAAe,IAAIC,KAAJ,CAAiD,CACpEnd,MAAO,IAAIR,GAAAA,EAAS,CAAEE,QAAS,MACzBvI,KAAI,SACRimB,EACAj9B,EACAk9B,GACC,OAAD,oHACkC,OAA1BC,EAA+BF,EAA/BE,YAAazZ,EAAkBuZ,EAAlBvZ,KAAMpE,EAAY2d,EAAZ3d,QAAO,kBAC3Buc,GACLnY,EACAyZ,GAAY,kBACP7d,GAAO,IAAE4d,eAAAA,IACdl9B,IACD,0CAPD,EAQF,IAEF,OAAOqsB,EAAAA,MAAAA,MACE,CACLjU,cAAeiU,EAAAA,MAAAA,cAAoBwQ,KAEpCO,UAAS,iBAAO,CACfv6B,WAAOtC,EACP88B,QAAQ,EACRC,cAAU/8B,EACVg9B,qBAAiBh9B,EACjBy7B,oBAAgBz7B,EAChBi9B,6BAAyBj9B,EACzBk9B,eAAWl9B,EACZ,IACAib,OAAM,SAAAkI,GAAI,MAAK,CACVga,kBAGF,OADAha,EAAKkH,SACIlH,EAAKsY,cAChB,EACIt4B,WACF,OAAOG,EAAAA,EAAAA,SAAQ6f,EAAM,OACvB,EAEIqY,cAGF,OADArY,EAAKkH,OACElH,EAAK6Z,eACd,EAEII,cACF,OAAO95B,EAAAA,EAAAA,SAAQ6f,EAAM,UACvB,EAEI9f,kBACF,OAAOC,EAAAA,EAAAA,SAAQ6f,EAAM,cACvB,EAEAka,QAAO,SAACl6B,GACN,OAAOsc,KAAK6d,WAAWl7B,SAASe,EAClC,EAEIm6B,iBACF,MAAM,CAAE7d,KAAKtc,MAAI,eAAKsc,KAAK2d,SAC7B,EAKIG,kBACF,OAAQpa,EAAKsY,eAETrV,OAAOtF,KAAKqC,EAAKsY,qBADjBz7B,CAEN,EAEIw9B,wBACF,OAAQra,EAAK8Z,wBAET7W,OAAOtF,KAAKqC,EAAK8Z,yBAA2B,CAAC,QAD7Cj9B,CAEN,EAEIy9B,+BACF,OAAOhe,KAAK8d,aAAe9d,KAAK+d,mBAAiB,OACzC,IAAIE,IAAI,GAAD,eAAKje,KAAK8d,cAAW,OAAK9d,KAAK+d,2BAC1Cx9B,CACN,EACI07B,iBAEF,OAAOiC,EAAAA,EAAAA,WAAexa,EAAM,GAAGuY,UACjC,EACIL,oBACF,IAAM7kB,GAAmBlT,EAAAA,EAAAA,SAAQ6f,EAAM,iBACvC,OAAyB,IAAlB3M,EAAOjU,OAAe84B,GAAgB7kB,CAC/C,EACD,IACAyE,OAAM,SAAAkI,GAAI,MAAK,CACVwY,eAAY,IAAD,EACb,OAAmB,QAAnB,EAAOxY,EAAKqY,eAAO,aAAZ,EAAct4B,KAAI,SAAA06B,GAAM,OAAIA,EAAOxB,OAAO,GACnD,EACD,IACAnhB,OAAM,SAAAkI,GAAI,MAAK,CACd4Y,oBAAmB,SAACK,GAClB,IAAKjZ,EAAKsY,iBAAmBtY,EAAK8Z,wBAChC,MAAM,IAAIl5B,MACR,4FAGJ,OACEof,EAAKsY,eAAeW,IAAYjZ,EAAK8Z,wBAAwBb,EAEjE,EACAyB,gBAAe,SAACzB,GACd,GAAKjZ,EAAKwY,SAAV,CAGA,IAAM11B,EAAMkd,EAAKwY,SAASrrB,WAAU,SAAAwtB,GAAC,OAAIA,IAAM1B,CAAO,IACtD,IAAa,IAATn2B,EAGJ,OAAOkd,EAAKkY,cAAcp1B,EAAMkd,EAAKkY,cAAc94B,OALnD,CAMF,EACAw7B,eAAc,SAAC3B,GACb,IAAKjZ,EAAKsY,eACR,MAAM,IAAI13B,MACR,8EAGJ,QAAS0b,KAAKsc,oBAAoBK,EACpC,EACD,IACA4B,SAAQ,SAAA7a,GAAI,MAAK,CAChB8a,UAAS,YAKI,IAJXC,EAA0B,EAA1BA,2BACAzC,EAAc,EAAdA,eACAwB,EAAuB,EAAvBA,wBACAC,EAAS,EAATA,UAEA/Z,EAAK2Z,QAAS,EACdrd,KAAK0e,WAAWD,GAChBze,KAAK2e,kBAAkB3C,EAAgBwB,GACvCxd,KAAK4e,aAAanB,EACpB,EACAvE,SAAQ,SAAC7oB,GACPoc,QAAQ5pB,MAAMwN,GACdqT,EAAK7gB,MAAQwN,CACf,EACAquB,WAAU,SAAC3C,GACTrY,EAAK6Z,gBAAkBxB,CACzB,EACA4C,kBAAiB,SAAChB,EAAyBkB,GACzCnb,EAAKsY,eAAiB2B,EACtBja,EAAK8Z,wBAA0BqB,CACjC,EACAD,aAAY,SAACnB,GACX/Z,EAAK+Z,UAAYA,CACnB,EACAqB,YAAW,SAACrT,GACV/H,EAAK4Z,SAAW7R,CAClB,EACAb,KAAI,WAAI,IAAD,OAOL,OANKlH,EAAK4Z,WACR5Z,EAAK4Z,SAAWtd,KAAK+e,UAAUrX,OAAM,SAAArX,GACnC,EAAKyuB,iBAAYv+B,GACjB,EAAK24B,SAAS7oB,EAChB,KAEKqT,EAAK4Z,QACd,EACMyB,QAAO,WAAI,IAAD,sJAKgB,OAJxBC,EAAOtb,EAAKtL,cACZ6mB,EAA+C,QAAtB,EAAGD,EAAKhD,sBAAc,aAAnB,EAAqBkD,QACjDC,EAAoC,QAAjB,EAAGH,EAAKvB,iBAAS,aAAd,EAAgByB,QACtCE,EAAsBJ,EAAKK,SAASH,QACpCI,EAAe5b,EAAKhgB,KAAI,SAER67B,GAAmBH,EAAqBtC,GAAG,OAKxB,OALnCf,EAAO,OACP0C,EAA6B1C,EAAQt4B,KAAI,SAAA46B,GAE7C,OADAhC,GAAagC,EAAE1B,UACR,kBAAK0B,GAAC,IAAEiB,aAAAA,GACjB,IACMtD,EAAiC,CAAC,EAAC,UAEvBwD,GAAkBP,EAA2BnC,GAAG,QAAzD,OAAH2C,EAAG,iBACeC,GAAaP,EAAqBrC,GAAG,QAAvDW,EAAS,OACfgC,EAAIvX,SAAQ,YAA2B,IAAxByU,EAAO,EAAPA,QAAgB,EAAPgB,QACdzV,SAAQ,SAAAnY,GACdssB,GAAatsB,GACbisB,EAAejsB,GAAK4sB,CACtB,GACF,IAEA8B,EAA2BvW,SAAQ,SAAAiW,GACjCnC,EAAemC,EAAOxB,SAAWwB,EAAOxB,OAC1C,IAEMa,EAA0B7W,OAAOyV,YACrCzV,OAAOuO,QAAQ8G,GAAgBv4B,KAAI,+BAAE4F,EAAG,KAAEN,EAAG,WAAM,CACjDM,EAAIs2B,cACJ52B,EACD,KAGH,EAAKy1B,UAAU,CACbC,2BAAAA,EACAzC,eAAAA,EACAwB,wBAAAA,EACAC,UAAAA,IACA,2CAvCY,EAwChB,EACD,IACAjiB,OAAM,SAAAkI,GAAI,MAAK,CACdkc,mBAAkB,SAACzC,EAAsB7d,GACKA,EAApCtf,OAAR,IAAgBk9B,EAA4B5d,EAA5B4d,eAAmB2C,GAAI,OAAKvgB,EAAO,IACnD,IAAKA,EAAQ8X,UACX,MAAM,IAAI9yB,MAAM,yBAElB,IAAMw7B,EA5Pd,SAAsB3C,GACpB,OAAO4C,KAAoB5C,EAC7B,CA0P0B6C,CAAa7C,GAC/B,OAAOJ,EAAa58B,IAClB2/B,EACA,CACE3C,YAAAA,EACAzZ,KAAMA,EACNpE,QAASugB,QAKXt/B,EACA28B,EAEJ,EAKM+C,wBAAuB,SAAC9C,EAAsB1Y,GAAoB,IAAD,iIAChEA,GAASA,EAAK2S,UAAS,sBACpB,IAAI9yB,MAAM,yBAAwB,uBAExB,EAAKs7B,mBAAmBzC,EAAa1Y,GAAK,OAAnD,OAAHhhB,EAAG,yBACFA,EAAIg5B,YAAU,0CALgD,EAMvE,EAKMyD,+BAA8B,SAClC/C,EACA1Y,GACC,IAAD,8IACkB,EAAKmb,mBAAmBzC,EAAa1Y,GAAK,OAAnD,OAAHhhB,EAAG,yBACFA,EAAIi5B,YAAU,0CAFrB,EAGF,EACD,GACL,CAAC,SAEc8C,GAAkB,EAAD,mDAS/B,OAT+B,2BAAhC,WACE39B,EACAi7B,EACA98B,GAAoB,gFAEuB,OAArCiG,EAAO62B,EAAGqD,eAAet+B,EAAOoE,MAAK,SACvBA,EAAKm6B,kBAAiB,OACM,OAD1CC,EAAK,OACLnB,EAAU,IAAImB,EAAMx+B,OAAQtB,EAAWu8B,GAAG,kBACzCoC,EAAQM,kBAAkB,CAAEx/B,OAAAA,KAAS,4CAC7C,+BAEc0/B,GAAa,EAAD,iDAO1B,OAP0B,2BAA3B,WAA4B79B,EAA+Bi7B,GAAiB,gFAC/B,OAArC72B,EAAO62B,EAAGqD,eAAet+B,EAAOoE,MAAK,SACvBA,EAAKm6B,kBAAiB,OAG1C,OAHMC,EAAK,OACLnB,EAAU,IAAImB,EAAMx+B,OAAQtB,EAAWu8B,GAE7C,kBACOoC,EAAQoB,WAAS,4CACzB,+BAEcf,GAAmB,EAAD,mDAShC,OATgC,2BAAjC,WACE19B,EACAi7B,EACA98B,GAAoB,gFAEuB,OAArCiG,EAAO62B,EAAGqD,eAAet+B,EAAOoE,MAAK,SACvBA,EAAKm6B,kBAAiB,OACM,OAD1CC,EAAK,OACLnB,EAAU,IAAImB,EAAMx+B,OAAQtB,EAAWu8B,GAAG,kBACzCoC,EAAQqB,WAAW,CAAEvgC,OAAAA,KAAS,4CACtC,sBC/QD,OA/IA,SAAgCg/B,EAAgBlC,GAE9C,OAAOzQ,EAAAA,MAAAA,MACE,CACL6B,WAAY7B,EAAAA,MAAAA,MAAYuQ,GAAgBoC,EAAMlC,MAE/CthB,OAAM,SAAAkI,GAAI,MAAK,CACdvjB,IAAG,SAACqgC,GACF,OAAO9c,EAAKwK,WAAW3hB,MAAK,SAAAk0B,GAAG,OAAIA,EAAI7C,QAAQ4C,EAAQ,GACzD,EAEIE,wBACF,OAAO1gB,KAAK2gB,aAAal9B,KAAI,SAAAg9B,GAAG,OAAIA,EAAI/8B,IAAI,GAC9C,EAEIi9B,mBAGF,OAIIzC,EAAAA,EAAAA,WAAexa,GAHNwK,EAAU,EAArBN,QAAWM,WAAU,IACrB7sB,QAFF,gBAEkE,CAAC,EAAC,GAAvDu/B,kBAAAA,OAAiB,MAAG,GAAE,MAAEC,oBAAAA,OAAmB,MAAG,GAAE,EAG7D,MAAM,GAAN,eACK3S,IAAU,OACV0S,IAAiB,OACjBC,GAEP,EAEI5E,iBAEF,OAAOiC,EAAAA,EAAAA,WAAexa,GAAMuY,UAC9B,EACD,IACAzgB,OAAM,SAAAkI,GAAI,MAAK,CAGRod,gBAAe,SAACxB,GAAuB,OAAD,mHACrCA,EAAa,CAAD,qBACT,IAAIh7B,MAAM,gDAA+C,OAE5B,GAAjCX,EAAW+f,EAAKvjB,IAAIm/B,GACV,CAAD,0CAEHrY,EAAAA,EAAAA,OAAK,kBAAMrgB,QAAQ8c,EAAKvjB,IAAIm/B,GAAc,GAAE,CAAE/qB,QAAS,MAAO,OACpE5Q,EAAW+f,EAAKvjB,IAAIm/B,GAAa,6DAMhC37B,EAAS,CAAD,8CACJpD,GAAS,yBAEZoD,EAASinB,OAAM,0BACf3D,EAAAA,EAAAA,OACJ,0BACErgB,SAAgB,QAAR,EAAAjD,SAAQ,aAAR,EAAUo4B,UAAWp4B,EAASq4B,mBAC5B,QAAT,EAACr4B,SAAQ,QAAR,EAAUd,MAAK,IACpB,YACGc,EAASd,MAAM,CAAD,sBACVc,EAASd,MAAK,iCAEfc,GAAQ,yDA1B2B,EA2B5C,EAEMs8B,wBAAuB,SAC3B9C,EACAmC,EACA7a,GACC,IAAD,kIACI6a,EAAa,CAAD,+BACI,EAAKwB,gBAAgBxB,GAAa,OAA3C,OAAHmB,EAAG,yBACC,OAAHA,QAAG,IAAHA,OAAG,EAAHA,EAAKR,wBAAwB9C,EAAa1Y,IAAK,gCAEjD,CAAC,GAAC,0CALT,EAMF,EACMyb,+BAA8B,SAClC/C,EACAmC,EACA7a,GACC,IAAD,kIACI6a,EAAa,CAAD,+BACI,EAAKwB,gBAAgBxB,GAAa,OAA3C,OAAHmB,EAAG,yBACC,OAAHA,QAAG,IAAHA,OAAG,EAAHA,EAAKP,+BAA+B/C,EAAa1Y,IAAK,gCAExD,CAAC,GAAC,0CALT,EAMF,EACA6Z,eAAc,SAAC3B,EAAiB2C,GAC9B,IAAM37B,EAAW+f,EAAKvjB,IAAIm/B,GAC1B,GAAI37B,EACF,OAAOA,EAAS26B,eAAe3B,GAEjC,MAAM,IAAIr4B,MAAM,sBAAD,OACSg7B,EAAY,oCAEtC,EACD,IACAf,SAAQ,SAAA7a,GAAI,MAAK,CAChBqd,YAAW,WAAI,IAAD,QACZC,EAAAA,EAAAA,aACEtd,GACAud,EAAAA,GAAAA,WAEE,kBAAMvd,EAAKid,YAAY,IACvB,SAAAO,GACExd,EAAKwK,WAAWhG,SAAQ,SAAAuY,GACjBA,EAAIroB,eACP,EAAK+oB,eAAeV,EAExB,IACAS,EAAgBhZ,SAAQ,SAAAkZ,IAKO,IAJD1d,EAAKwK,WAAWrd,WAC1C,SAAAlN,GAAQ,OACNA,EAASD,QAAS4U,EAAAA,EAAAA,gBAAe8oB,EAAgB,OAAO,KAG1D,EAAKC,YAAYD,EAErB,GACF,GACA,CAAEE,iBAAiB,EAAM59B,KAAM,+BAGrC,EACAy9B,eAAc,SAACV,GACb/c,EAAKwK,WAAWqT,OAAOd,EACzB,EAKAY,YAAW,SAACjpB,GACVsL,EAAKwK,WAAWjG,KAAK,CAAE7P,cAAAA,GACzB,EAEAopB,gBAAe,SAACh7B,EAAa4R,GAC3BsL,EAAKwK,WAAW1nB,IAAOi7B,EAAAA,EAAAA,MAAK,CAAErpB,cAAAA,GAChC,EACD,GACL,EClDA,OAlGA,SAA8BqB,GAC5B,OAAOoT,EAAAA,EAAAA,qBACL,eACA,CAKE8Q,QAAS,CACP13B,KAAM,cACNy7B,aAAc,GACdr2B,YAAa,yCAQfg0B,SAAU5lB,EAAc0B,aAAa,0BAClCiV,aAKHwL,cAAe,CACb31B,KAAM,cACNy7B,aAAc,GACdr2B,YACE,qIAGJ2wB,gBAAgBnP,EAAAA,EAAAA,qBACd,iBACA,CAOEqS,QAASzlB,EAAckoB,0BAA0B,YAEnD,CACEC,mBAAoB,SAAArI,GAGlB,OAAKA,EAAK2F,QAGH3F,EAFE,CAAE2F,QAAS,CAAEj5B,KAAM,uBAG9B,IAGJw3B,WAAW5Q,EAAAA,EAAAA,qBACT,WACA,CAMEqS,QAASzlB,EAAckoB,0BAA0B,YAEnD,CACEC,mBAAoB,SAAArI,GAGlB,OAAKA,EAAK2F,QAGH3F,EAFE,CAAE2F,QAAS,CAAEj5B,KAAM,mBAG9B,IAOJrC,YAAa,CACXqC,KAAM,SACNy7B,aAAc,GACdr2B,YACE,yHAGN,CAOEw2B,mBAAoB,QAG1B,EChGA,IAeA,IAfkChV,EAAAA,EAAAA,qBAChC,gBACA,CAIEiV,YAAa,CACX77B,KAAM,SACNoF,YACE,gGACFq2B,aAAc,IAGlB,CAAEK,iBAAiB,ICZrB,IAWA,IAXuClV,EAAAA,EAAAA,qBACrC,qBACA,CAAC,EACD,CAIEmV,kBAAmBC,GACnBF,iBAAiB,ICRrB,IAWA,IAXwClV,EAAAA,EAAAA,qBACtC,sBACA,CAAC,EACD,CAIEmV,kBAAmBC,GACnBF,iBAAiB,ICNrB,QAAelV,EAAAA,EAAAA,qBACb,aACA,CAIEqV,cAAe,CACbj8B,KAAM,SACNoF,YACE,mGACFq2B,aAAc,uBAKhBS,QAAS9V,EAAAA,MAAAA,SACPA,EAAAA,MAAAA,IACEA,EAAAA,MAAAA,MACE+V,GACAC,KAGJ,CACEC,oBAAqB,CAAEr8B,KAAM,uBAC7Bs8B,mBAAoB,CAAEt8B,KAAM,yBAIlC,CAEEs4B,QAAS,SAAC7a,GAAS,MAAM,CACvB8e,gBAAe,SAACC,EAAoBC,GAClChf,EAAKye,QAAQ/hC,IAAIqiC,EAAYC,EAC/B,EACD,I,4DCjBL,SAASC,GAAWliC,GAClB,MAAqB,oBAAVA,KAGPA,aAAiB6D,MAIvB,CAIO,SAAes+B,GAAY,EAAD,qCAsBhC,gDAtBM,WACLC,EACAC,EACAC,GAA0B,+FAGnB,IAAIzgB,SAAQ,SAAC0gB,EAAU/e,IAC5B,SAASgf,IACP3zB,YAAU,uBAAC,4GAEDuzB,EAAOlhB,KAAK,OAAQ,GAAI,CAC5BpN,QAAoB,EAAXuuB,EACTC,mBAAAA,IACA,OACFE,IAAO,+CAEPhf,EAAO,EAAD,IAAG,wDAEV6e,EACL,CACAG,EACF,KAAE,4CACH,sBASA,IACKC,GAAU,WAGd,WAAmBC,IAAwB,oBAAxBA,OAAAA,EAAqB,KAFxCC,aAAO,CAEoC,CA6B1C,OA7B2C,0EAE5C,8FAyBG,OAxBIpjB,KAAKojB,UACRpjB,KAAKojB,QAAUpjB,KAAKmjB,OACjBE,aACA5b,MAAK,SAAAob,GAeJ,OAdAD,GAAYC,EAAQ,EAAKM,OAAOG,YAAa,EAAKH,OAAOz/B,MAAMgkB,OAC7D,SAAA7kB,GACMggC,IACFpW,QAAQ5pB,MACN,0DAEF4pB,QAAQ5pB,MAAMA,GACdggC,EAAOU,UACPV,EAAOtH,OAAS,SAChBsH,EAAOhgC,MAAQA,EACf,EAAKugC,aAAU7iC,EAEnB,IAEKsiC,CACT,IACCnb,OAAM,SAAArX,GAEL,MADA,EAAK+yB,aAAU7iC,EACT8P,CACR,KACH,kBACM2P,KAAKojB,SAAO,gDACpB,kDA7B2C,MA6B3C,EAhCa,GAmCcI,GAAa,WAiBzC,WAAYvG,IAAiC,oBAhBpCv5B,UAAI,OAEL+/B,sBAAwB,EAAC,KAEzBC,kBAAoB,IAAI/iC,IAAqB,KAI7CgjC,gBAAU,OAElBL,YAAc,IAAK,KAEnBM,qBAAuB,IAAI,KAE3B/hC,YAAM,EAGJme,KAAKne,OAASo7B,EAAKp7B,MACrB,CAwIC,OAtID,kCACA,SAAuBpB,EAAmB22B,GAAgC,IAAD,OACvE,GAAI7B,MAAMsO,QAAQpjC,GAChB,OAAOA,EACJmb,OAAO+mB,IACPl/B,KAAI,SAAA+kB,GAAC,OAAI,EAAKsb,WAAWtb,EAAG4O,EAAU,IAE3C,GAAqB,kBAAV32B,GAAgC,OAAVA,EAAgB,CAE/C,GAAIA,aAAiByhB,YACnB,OAAOniB,EAAAA,GAAAA,IACLU,EACAuf,KAAK+jB,YAAYC,KAAKhkB,KAAMoX,IAIhC,IAAI5R,EAAAA,EAAAA,iBAAgB/kB,MAAWwjC,EAAAA,EAAAA,SAAQxjC,GACrC,MAAM,IAAI6D,MAAM,2CAKlB,OAAI7D,aAAiByjC,KACZzjC,EAGFkmB,OAAOyV,YACZzV,OAAOuO,QAAQz0B,GACZmb,QAAO,SAAAvL,GAAC,OAAIsyB,GAAWtyB,EAAE,GAAG,IAC5B5M,KAAI,+BAAE0gC,EAAC,KAAEC,EAAC,WAAM,CAACD,EAAG,EAAKL,WAAWM,EAAGhN,GAAW,IAEzD,CACA,OAAO32B,CACT,GAAC,kEAED,WAAkB22B,EAAmBiN,EAAsB/jC,GAAgB,sFACpD0f,KAAKskB,UAAUlN,GAAU,OAAlC,OACLzV,KACL0iB,EACA,CAAE/jC,SAAAA,GACF,CAAEiU,QAAS,IAASwuB,mBAAoB/iB,KAAKtc,OAC9C,gDACF,uDATA,IASA,8BAED,WAAkC,IAAD,OACzB6gC,EA7GV,WACE,IAAMC,EAA+B,qBAAXziC,OACpB0iC,EAAYD,GAAc,wBAAyBziC,OAAO2iC,UAChE,OAAIF,GAAcC,EACT1iC,OAAO2iC,UAAUH,oBAEnB,CACT,CAsGgCI,GAEtB7C,GACJxpB,EAAAA,EAAAA,gBAAe0H,KAAKne,OAAQ,iBAC5B+iC,EAAAA,EAAAA,OAAM,EAAGtjB,KAAKujB,IAAI,EAAGN,EAAsB,GAAI,GAEjD,OAAO,OAAI,IAAIhP,MAAMuM,IAAcr+B,KAAI,kBAAM,IAAIy/B,GAAW,EAAK,GACnE,GAAC,2BAED,WACE,IAAKljB,KAAK2jB,WAAY,CACpB,IAAMmB,EAAM9kB,KAAK+kB,mBAEjB,OADA/kB,KAAK2jB,WAAamB,EACXA,CACT,CACA,OAAO9kB,KAAK2jB,UACd,GAAC,gEAED,WAAgBvM,GAAiB,kFAWiB,GAV1C4N,EAAUhlB,KAAKilB,qBAEA1kC,KADjB2kC,EAAellB,KAAK0jB,kBAAkBvjC,IAAIi3B,MAEtC+N,GAAoBnlB,KAAKyjB,qBAAuB,GAAKuB,EAAQliC,OACnEkd,KAAK0jB,kBAAkBtjC,IAAIg3B,EAAW+N,GACtCnlB,KAAKyjB,qBAAuB0B,EAC5BD,EAAeC,GAIXtC,EAASmC,EAAQE,GAAcZ,YACzB,CAAD,qBACH,IAAIhgC,MAAM,qCAAoC,gCAE/Cu+B,GAAM,gDACd,mDAlBA,IAkBA,2DAED,WACEppB,EACA2d,EACAiN,EACApH,GAAoD,iHACxC,GAAZ3d,EAAO,+BAAG,CAAC,EAEN8X,EAAU,CAAD,qBACN,IAAI5X,UAAU,yBAAwB,OAE9B,OAAZjC,GAAO,EAAK,SACKyC,KAAKskB,UAAUlN,GAAU,OACgB,OADxDyL,EAAM,OACNuC,EAAY3rB,EAAc4rB,iBAAiBhB,GAAa,UACjCe,EAAUE,mBAAmBrI,EAAMjd,KAAKtc,MAAK,QAsC5B,OAtCxC6hC,EAAc,OACdC,EAA4BxlB,KAAK8jB,WAAWyB,EAAgBnO,GAG5DqO,EAAQ5C,EACXlhB,KAAK0iB,EAAcmB,GAA0B,QAC5CjxB,QAAS,IACT2oB,eAAgBD,EAAKC,eACrB6F,mBAAoB/iB,KAAKtc,MACtB4b,IAEJomB,SAAQ,WACPnoB,GAAO,CACT,IAKIooB,EAAU,IAAIrjB,SAAQ,SAACC,EAAS0B,GACpC2hB,EAAsBC,aAAY,WAEV,WAAlBhD,EAAOtH,OACTtX,EACE,IAAI3f,MAAM,2DAAD,OACoDu+B,EAAOhgC,SAG7D0a,GACTgF,GAAQ,EAEZ,GAAG,EAAKqhB,qBACV,IAAG8B,SAAQ,WACTI,cAAcF,EAChB,IAKMG,EAAUzjB,QAAQ0jB,KAAK,CAACP,EAAOE,IAAS,kBACvCP,EAAUa,kBAAkBF,EAAS9I,EAAMjd,KAAKtc,OAAK,iDAC7D,yDAvDA,MAuDA,EA3JwC,GCzFrCwiC,GAAe,qGAmBlB,OAnBkB,+BACnB,WACElmB,KAAKglB,QAAQ,GAAGmB,WAClB,GAAC,2DAED,WAAWC,EAAkBnJ,EAA+BxY,GAAa,oFAM7C,OALlByY,EAAuCzY,EAAvCyY,eAAgB6F,EAAuBte,EAAvBse,mBAClBsD,EAAO,kBAAcC,IAAAA,YACrBC,EAAW,SAACxjB,GACF,OAAdma,QAAc,IAAdA,GAAAA,EAAiBna,EACnB,EACA/C,KAAKwmB,GAAGH,EAASE,GAAS,+DAExBH,GAAS,kBACJnJ,GAAI,IAAEoJ,QAAAA,EAAStD,mBAAAA,IACpBte,GAAI,OAEqB,OALrBM,EAAM,OAKZ/E,KAAKymB,IAAIJ,EAASE,GAAS,kBACpBxhB,GAAM,gDACd,uDAhBA,MAgBA,EAnBkB,CAAS2hB,GAAAA,EAAAA,QAsBTnE,GAAkB,0CAKrC,WACEtF,EACO0J,GAIN,IAAD,EAEiD,OAFjD,gBACA,cAAM1J,IALC0J,wBAAAA,EAGN,EATHjjC,KAAO,qBAAoB,EAE3BkjC,wBAAkB,EAUhB,EAAKA,mBAAqB3J,EAAK2J,mBAAkB,CACnD,CAoCC,OApCA,2EAED,kGAiBE,OAbMC,EAAW7mB,KAAK4mB,qBAEhB/D,EAAS,IAAIqD,GAAgB,CAAElB,QAAS,CAAC6B,KAC9B,iCAAiC/nB,KAAK4lB,UAAUoC,YAI/Dra,QAAQsa,IACN,oIACAF,GAIJ,kBACO,IAAIvkB,SAAQ,SAACC,EAAuC0B,GAczD4e,EAAOmC,QAAQ,GAAG3kC,iBAAiB,WAblB,SAAXkmC,EAAYl2B,GACO,UAAnBA,EAAEmmB,KAAKzT,SACTR,EAAQsgB,GACRA,EAAOmC,QAAQ,GAAGvyB,oBAAoB,UAAW8zB,IACrB,mBAAnBl2B,EAAEmmB,KAAKzT,QAChB8f,EAAOmC,QAAQ,GAAGgC,YAAY,CAC5BjkB,QAAS,SACTlhB,OAAQ,EAAK8kC,0BAEa,UAAnBt2B,EAAEmmB,KAAKzT,SAChBkB,GAAOgjB,EAAAA,GAAAA,kBAAiB52B,EAAEmmB,KAAK3zB,OAEnC,GAEF,KAAE,gDACH,kDApCA,MAoCA,EAlDoC,CAAS2gC,ICpC1C0D,GAAW,wCASd,OATc,+BACf,WAAiB,GAAC,2DAElB,WACEC,EACAC,GAAkB,sFACL,OAAL,+BAAG,CAAC,EAAC,uBAEN7mC,GAAS,2CACjB,qDARiB,MAQjB,EATc,GAiBI+hC,GAAmB,0CAKtC,WAAYrF,GAAiC,IAAD,EAE2B,OAF3B,gBAC1C,cAAMA,IALRv5B,KAAO,sBAAqB,EAE5B2/B,gBAAU,EAIR,EAAKA,YAAU,uBAAG,4GAAkC,IAAI6D,IAAa,4CACvE,CAUC,OAVA,qEAED,WAAWpK,EAAmB1F,EAAmBgP,EAAkBnJ,GAAQ,mFACpE7F,EAAU,CAAD,qBACN,IAAI5X,UAAU,yBAAwB,OAEC,OAAzC4lB,EAAYtI,EAAGuI,iBAAiBe,GAAS,SAClBhB,EAAUE,mBAAmBrI,EAAMjd,KAAKtc,MAAK,OAAtD,OAAd6hC,EAAc,gBACCH,EAAU/hB,QAAQkiB,EAAgBvlB,KAAKtc,MAAK,OAArD,OAANqhB,EAAM,yBACLqgB,EAAUa,kBAAkBlhB,EAAQkY,EAAMjd,KAAKtc,OAAK,iDAC5D,yDAVA,MAUA,EAlBqC,CAAS8/B,ICE5B6D,GAAU,WAK7B,WACS5tB,EACA6tB,EACAC,GAEP,IADC,oBAHM9tB,cAAAA,EAA4B,KAC5B6tB,kBAAAA,EAAwC,KACxCC,sBAAAA,EAA4C,KALrDC,mBAAa,GAONF,EACH,MAAM,IAAIhjC,MAAM,qDAElB0b,KAAKwnB,cAAgB,IAAI7mC,GAC3B,CAoEC,OApEA,iCAED,SAAU8mC,GACR,IAIIC,EAJEvE,EAASnjB,KAAKwnB,cAAcrnC,IAAIsnC,GACtC,GAAItE,EACF,OAAOA,EAGT,IAAMthC,EAASme,KAAKsnB,kBAAkBnF,QAAQhiC,IAAI,sBAClD,GAAoB,wBAAhBsnC,EAAuC,CACzC,IAAME,EACJ3nB,KAAKunB,sBAAsBjF,oBAE7B,IAAKqF,EACH,MAAM,IAAIrjC,MAAM,yBAAD,OACYmjC,EAAW,wBAGxCC,EAAY,IAAIpF,IAAoB,kBAAKqF,GAAoB,IAAE9lC,OAAAA,IACjE,KAAO,IAAoB,uBAAhB4lC,EAeT,MAAM,IAAInjC,MAAM,yBAAD,OAA0BmjC,EAAW,uBAdpD,IAAME,EAAuB3nB,KAAKunB,sBAAsBhF,mBACxD,IAAKoF,EACH,MAAM,IAAIrjC,MAAM,yBAAD,OACYmjC,EAAW,wBAGxCC,EAAY,IAAInF,IAAmB,kBAC5BoF,GAAoB,IAAE9lC,OAAAA,IAC3B,CACE+mB,QAAS5I,KAAKvG,cAAcuP,yBAC5B4e,WAAY7lC,OAAOC,SAAS43B,MAKlC,CAEA,OADA5Z,KAAKwnB,cAAcpnC,IAAIqnC,EAAaC,GAC7BA,CACT,GAAC,uEAED,WACEG,EACAV,EACAlK,GAAgC,4EAIyB,OAFnDwK,EACJxK,EAAK6K,gBACLxvB,EAAAA,EAAAA,gBAAe0H,KAAKsnB,kBAAmB,iBAAgB,kBAElDtnB,KAAK+nB,UAAUN,IAAY,gDACnC,uDAZA,IAYA,2DAED,WAAWrQ,EAAmBiN,EAAsBpH,GAAQ,0FAAW,GAATxY,EAAI,+BAAG,CAAC,EAC/D2S,EAAU,CAAD,qBACN,IAAI9yB,MAAM,yBAAwB,uBAEd0b,KAAKgoB,iBAC/B5Q,EACAiN,EACApH,GACD,OAJkB,OAAbgL,EAAa,yBAKZA,EAActmB,KACnB3B,KAAKvG,cACL2d,EACAiN,EACApH,EACAxY,IACD,gDACF,uDAlBA,MAkBA,EAlF4B,GAAV4iB,GACZjX,aAAe8X,GCnBgD,IAgBnDC,GAAiB,WAKpC,WAAmB1uB,IAA+B,oBAA/BA,cAAAA,EAA4B,KAJ/C2uB,aAAe,IAAI/oB,GAAAA,EAAwC,CACzDE,QAAS,IAGuC,CA0FjD,OA1FkD,8CAEnD,SAAuB8oB,GAA2B,IAAD,OACzCvL,EAAK9c,KAAKvG,cAChB,OAAOuG,KAAKsoB,iBAAiBD,GAAa5kC,KAAI,SAAAu7B,GAC5C,IAAMc,GAAYxnB,EAAAA,EAAAA,gBAAe0mB,EAAM,uBACjCX,EAAI,EAAK+J,aAAajoC,IAAI2/B,GAChC,GAAIzB,EACF,OAAOA,EAEP,IACMtuB,EAAI,IAAIw4B,EADWzL,EAAG0L,yBAAyBxJ,EAAK/4B,MAAlDsiC,cACmBvJ,OAAMz+B,EAAWu8B,GAE5C,OADA,EAAKsL,aAAahoC,IAAI0/B,EAAW/vB,GAC1BA,CAEX,GACF,GAAC,8BAED,SAAiBs4B,GAA2B,IAAD,EAEzC,EAA4D,QAA5D,EADWroB,KAAKvG,cACmCnO,iBAAS,aAAZ,EAAcsiB,QAAtD6a,EAA2B,EAA3BA,4BAA6B5a,EAAM,EAANA,OAK7ByR,EAAiB+I,EAAjB/I,aAER,MAAM,GAAN,eACKtf,KAAK0oB,wBACNpJ,EACAmJ,KACD,OACEzoB,KAAK2oB,6BAA6BrJ,EAAczR,IAEvD,GAAC,qCAED,SACEyR,EACAsJ,GAEA,OAAOA,EAAMhtB,QAAO,SAAAitB,GAAC,aACe,QADf,GACnBvwB,EAAAA,EAAAA,gBAAeuwB,EAAG,wBAAgB,aAAlC,EAAoClmC,SAAS28B,EAAa,GAE9D,GAAC,0CAED,SACEA,EACAsJ,GAEA,OAAOA,EACJhtB,QAAO,SAAAojB,GAAI,aAKR,QALQ,GACV1mB,EAAAA,EAAAA,gBAAe0mB,EAAM,CACnB,gBACA,oBACA,yBACA,aAJF,EAIIr8B,SAAS28B,EAAa,IAE3B77B,KACC,SAAAu7B,GAAI,OAAIA,EAAK8J,cAAcC,iBAAiB,GAElD,GAEA,6DAKA,WACE9L,EACAoL,EACAW,GAA+C,8EAEU,OAAnDC,EAAWjpB,KAAKkpB,uBAAuBb,GAAY,SACnC/lB,QAAQ3I,IAAIsvB,EAASxlC,KAAI,SAAAsM,GAAC,OAAIA,EAAEo5B,YAAYlM,EAAK,KAAE,OAA5D,OAAPmM,EAAO,yBACNppB,KAAKqpB,YAAYD,EAAQE,OAAQN,IAAO,gDAChD,uDAbD,IAeA,yBAMA,SACEI,EACAJ,GAEA,OAAOA,EACLI,EAAQt5B,MAAK,SAACC,EAAGC,GAAC,OAAMA,EAAEu5B,WAAWC,cAAcz5B,EAAEw5B,WAAW,KAChEz5B,MAAK,SAAC25B,EAAIC,GAAE,OAAKD,EAAGE,WAAaD,EAAGC,UAAU,GAClD,KAAC,EA/FmC,GCEtC,IAAMC,GAAgBvd,EAAAA,MAAAA,MACb,gBAAiB,CACtBwd,SAAU,EACVC,WAAY,KAEb1M,UAAS,iBAAO,CACf2M,QAAS,GACTC,iBAAiB,EAClB,IACAxuB,OAAM,SAAAkI,GAAI,MAAK,CACVumB,cACF,OAAOvmB,EAAKmmB,QAAU,IAAMnmB,EAAKsmB,eACnC,EACIE,cACF,OAAOxmB,EAAKmmB,QAAUnmB,EAAKqmB,QAAQjnC,OAAS,IAAM4gB,EAAKsmB,eACzD,EACD,IACAzL,SAAQ,SAAA7a,GACP,IAAIymB,EACAC,EACAC,GAAoB,EAExB,MAAO,CAELC,iBAAgB,WACd5mB,EAAKsmB,iBAAkB,CACzB,EAEAO,mBAAkB,WAChB7mB,EAAKsmB,iBAAkB,CACzB,EACAQ,aAAY,SAACC,GACP/mB,EAAKsmB,kBAGLK,EAEFA,GAAoB,GAGtB3mB,EAAKqmB,QAAQnV,OAAOlR,EAAKmmB,QAAU,GACnCnmB,EAAKqmB,QAAQ9hB,KAAKwiB,GACd/mB,EAAKqmB,QAAQjnC,OApDE,IAqDjB4gB,EAAKqmB,QAAQW,QAEfhnB,EAAKmmB,QAAUnmB,EAAKqmB,QAAQjnC,OAAS,GACvC,EAEA6nC,cAAa,WACXP,GACF,EACAQ,WAAU,WAAI,IAAD,OAKX,KAJAT,EAAczmB,EAAKomB,YACfe,EAAAA,EAAAA,aAAYnnB,EAAMA,EAAKomB,aACvBtwB,EAAAA,EAAAA,QAAOkK,GAAMymB,aAGf,MAAM,IAAI7lC,MACR,8HAIJ8lC,GAAmBhP,EAAAA,EAAAA,YACjB+O,EAvEV,SAAkBW,GAAoD,IAChE17B,EADgDmF,EAAO,uDAAG,IAE9D,OAAO,WAAyB,IAAD,uBAApB0oB,EAAI,yBAAJA,EAAI,gBACb1tB,aAAaH,GACbA,EAAQE,YAAW,kBAAMw7B,EAAI,aAAI7N,EAAK,GAAE1oB,EAC1C,CACF,CAkEUw2B,EAAS,SAAC1P,GAAiB,OAAK,EAAKmP,aAAanP,EAAS,GAAE,MAEnC,IAAxB3X,EAAKqmB,QAAQjnC,QACfkd,KAAKwqB,cAAahR,EAAAA,EAAAA,aAAY2Q,GAElC,EACAa,KAAI,WACFtnB,EAAKmmB,UACLQ,GAAoB,GACpBY,EAAAA,EAAAA,eAAcd,EAAazmB,EAAKqmB,QAAQrmB,EAAKmmB,SAC/C,EACAqB,KAAI,WACFxnB,EAAKmmB,UACLQ,GAAoB,GACpBY,EAAAA,EAAAA,eAAcd,EAAazmB,EAAKqmB,QAAQrmB,EAAKmmB,SAC/C,EAEJ,IAEF,M,oIC9Fe,SAASjD,KACtB,OAAO,IAAIuE,OAAO,IAAIxR,IAAI,mBAC5B,C,2BCgBA,SAASyR,GAAWC,EAA8BC,GAChD,IAAK,IAAMC,KAAQF,EACbE,IAASD,SACJD,EAAIE,GACmB,kBAAdF,EAAIE,IACpBH,GAAWC,EAAIE,GAAkCD,GAGrD,OAAOD,CACT,CAMe,SAASG,GACtB/xB,EACAgyB,EACAC,GAEA,IAAMC,EAAetf,EAAAA,MAAAA,MACZ,aAAc,CACnBjU,eAAeyU,EAAAA,EAAAA,qBAAoB,QAAO,QAIxC+e,IAAKvE,GAAWjX,aAIhBjT,sBAAuB,CACrBlX,KAAM,SACNy7B,aAAc,GAKhBrI,SAAU,CACRpzB,KAAM,SACNy7B,aAAc,qCAGhBmK,gBAAgBhf,EAAAA,EAAAA,qBAAoB,iBAAkB,CAIpDif,cAAe,CACb7lC,KAAM,cACNy7B,aAAc,CAAC,OAAQ,aAAc,OAAQ,UAGjDqK,eAAelf,EAAAA,EAAAA,qBAAoB,gBAAiB,CAIlD1O,QAAS,CACPlY,KAAM,SACNoF,YAAa,2CACbq2B,aAAc,CAAC,EACfsK,gBAAiB,CAAC,YAKpBC,YAAa,CACXhmC,KAAM,SACNoF,YAAa,oDACbq2B,aAAc,CAAC,EACfsK,gBAAiB,CAAC,YAKpBE,MAAO,CACLjmC,KAAM,SACNy7B,aAAc,EACdr2B,YAAa,qCAGjB8gC,aAAatf,EAAAA,EAAAA,qBAAoB,cAAe,CAI9ChrB,OAAQ,CACNoE,KAAM,SACNoF,YAAa,+CACbq2B,aAAc,CAAC,EACfsK,gBAAiB,CAAC,WAKpBI,SAAU,CACRnmC,KAAM,UACNy7B,cAAc,KAMlB2K,iBAAkB,CAChBpmC,KAAM,UACNy7B,cAAc,GAKhBz6B,MAAO,CAAEhB,KAAM,SAAUy7B,aAAc,CAAC,GAIxCrpB,SAAU,CACRpS,KAAM,eACNy7B,aAAc,CAAEnpB,IAAK,GAAI+zB,aAAc,iBAEtC7yB,EAAc8yB,+BAEnB3jB,QAASyD,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,UACrB6B,WAAY7B,EAAAA,MAAAA,MAAYqf,GAGxB7d,OAAQxB,EAAAA,MAAAA,MAAY5S,EAAckoB,0BAA0B,UAC5D51B,iBAAkBsgB,EAAAA,MAAAA,MAChB5S,EAAckoB,0BAA0B,qBAE1C8G,4BAA6Bpc,EAAAA,MAAAA,MAC3B5S,EAAckoB,0BAA0B,wBAE1C6K,YAAangB,EAAAA,MAAAA,MACX5S,EAAckoB,0BAA0B,eAE1C8K,eAAgBpgB,EAAAA,MAAAA,SAAeA,EAAAA,MAAAA,OAAaof,GAAU,CACpD/nC,KAAK,kBAIR8X,OAAM,SAAAkI,GAAI,MAAK,CACV/hB,oBACF,OAAO+hB,EAAKwK,WAAWzqB,KAAI,SAAAE,GAAQ,OAAI2U,EAAAA,EAAAA,gBAAe3U,EAAU,OAAO,GACzE,EACIs4B,iBAEF,OAAOiC,EAAAA,EAAAA,WAAexa,GAAMuY,UAC9B,EACD,IACAsC,SAAQ,SAAA7a,GAAI,MAAK,CAChBgpB,YAAW,WACT,IAAMC,EAAO,GACbjpB,EAAK/hB,cAAcumB,SAAQ,SAAAoX,GACzB,IAAKA,EACH,MAAM,IAAIh7B,MAAM,kDAElB,GAAIqoC,EAAKhqC,SAAS28B,GAChB,MAAM,IAAIh7B,MAAM,4CAAD,OAC+Bg7B,IAG9CqN,EAAK1kB,KAAKqX,EAEd,GACF,EACAsN,gBAAe,SAACC,GACd,IAAQnpC,EAASmpC,EAATnpC,KACR,IAAKA,EACH,MAAM,IAAIY,MAAM,sCAElB,IAAMX,EAAW+f,EAAKwK,WAAW3hB,MAAK,SAAAk0B,GAAG,OAAIA,EAAI/8B,OAASA,CAAI,IAC9D,GAAIC,EACF,OAAOA,EAET,IAAMb,EAAS4gB,EAAKwK,WAAWjG,MAAK,kBAC/B4kB,GAAY,IACfxN,UAAS,QACPp5B,KAAM,yBACNkgB,QAAQ,GAAD,OAAKziB,EAAI,YAAIwc,KAAKC,QACrB0sB,EAAaxN,UAAY,CAAC,MAGlC,OAAO3b,EAAKwK,WAAWprB,EAAS,EAClC,EACAgqC,mBAAkB,SAACxN,GACjB,IAAMyN,EAAWrpB,EAAKwK,WAAW3hB,MAC/B,SAAA5I,GAAQ,OAAIA,EAASD,OAAS47B,CAAY,IAExCyN,GACFrpB,EAAKwK,WAAWqT,OAAOwL,EAE3B,EACAC,aAAY,SAACC,GACX,IAAQhnC,EAASgnC,EAAThnC,KACR,IAAKA,EACH,MAAM,IAAI3B,MAAM,sBAAD,OAAuB2B,IAExC,IAAM+mB,EAAQtJ,EAAKmK,OAAOthB,MAAK,SAAAic,GAAC,OAAIA,EAAErC,UAAY8mB,EAAU9mB,OAAO,IACnE,GAAI6G,EACF,OAAOA,EAET,IAAMlqB,EAAS4gB,EAAKmK,OAAO5F,KAAKglB,GAChC,OAAOvpB,EAAKmK,OAAO/qB,EAAS,EAC9B,EACAoqC,eAAc,SAAC/mB,EAAiBgnB,GAC9B,IAAQlnC,EAASknC,EAATlnC,KACR,IAAKA,EACH,MAAM,IAAI3B,MAAM,wBAAD,OAAyB2B,IAE1C,IAAM+mB,EAAQtJ,EAAKmK,OAAOthB,MAAK,SAAAic,GAAC,OAAIA,EAAErC,UAAYA,CAAO,IACzD,IAAK6G,EACH,MAAM,IAAI1oB,MAAM,gCAAD,OAAiC6hB,IAElD,OAAO6G,EAAMkgB,eAAeC,EAC9B,EACAC,kBAAiB,SAACC,GAChB,IAAQpnC,EAASonC,EAATpnC,KACR,IAAKA,EACH,MAAM,IAAI3B,MAAM,2BAAD,OAA4B2B,IAE7C,IAAMnD,EAAS4gB,EAAK8oB,YAAYvkB,KAAKolB,GACrC,OAAO3pB,EAAK8oB,YAAY1pC,EAAS,EACnC,EAEAwqC,qBAAoB,SAACl1B,GACnB,IAAM5R,EAAMkd,EAAK8oB,YAAY37B,WAC3B,SAAA08B,GAAI,OAAIA,EAAK3iC,KAAOwN,EAAcxN,EAAE,IAEtC,IAAa,IAATpE,EAGJ,OAAOkd,EAAK8oB,YAAY5X,OAAOpuB,EAAK,EACtC,EAEAgnC,gBAAe,SAACP,GACd,IAAQ9mB,EAAY8mB,EAAZ9mB,QACF3f,EAAMkd,EAAKmK,OAAOhd,WAAU,SAAA2X,GAAC,OAAIA,EAAErC,UAAYA,CAAO,IAC5D,IAAa,IAAT3f,EAIJ,OAAOkd,EAAKmK,OAAO+G,OAAOpuB,EAAK,EACjC,EACAinC,sBAAqB,SAACC,GACpB,IAAIC,EAQJ,KALEA,GADEzP,EAAAA,EAAAA,WAAexa,GAAMriB,QAAQqC,OAASgqC,EAAYhqC,MACvC81B,EAAAA,EAAAA,aAAYkU,IAEZE,EAAAA,GAAAA,MAAKF,IAGJhqC,KACd,MAAM,IAAIY,MAAM,oCAAD,OAAqCqpC,EAAWjqC,OAIjEggB,EAAK+oB,gBAAiBhL,EAAAA,EAAAA,MAAKkM,EAC7B,EACA3iB,UAAS,SAAC6iB,GACRnqB,EAAKkF,QAAQX,KAAK4lB,IAElBC,EAAAA,EAAAA,SAAapqB,GAAMqqB,mBAAkB,EACvC,EAEAC,aAAY,SAACH,GACXnqB,EAAKkF,SAAU6Y,EAAAA,EAAAA,MACb/d,EAAKkF,QAAQhN,QACX,SAAAqP,GAAM,OACJA,EAAOvE,MAAQmnB,EAAiBnnB,KAChCuE,EAAOgjB,SAAWJ,EAAiBI,QACnChjB,EAAOijB,SAAWL,EAAiBK,QACnCjjB,EAAOkjB,SAAWN,EAAiBM,MAAM,MAI/CjQ,EAAAA,EAAAA,WAAexa,GAAMqqB,mBAAkB,EACzC,EAEAK,uBAAsB,SAACvsC,GACrB,IAAQoE,EAASpE,EAAToE,KACR,IAAKA,EACH,MAAM,IAAI3B,MAAM,gCAAD,OAAiC2B,IAElD,IAAMnD,EAAS4gB,EAAK3X,iBAAiBkc,KAAKpmB,GAC1C,OAAO6hB,EAAK3X,iBAAiBjJ,EAAS,EACxC,EACAurC,0BAAyB,SAACxsC,GACxB,IAAM2E,EAAMkd,EAAK3X,iBAAiB8E,WAAU,SAAAd,GAAC,OAAIA,EAAEnF,KAAO/I,EAAO+I,EAAE,IACnE,IAAa,IAATpE,EAGJ,OAAOkd,EAAK3X,iBAAiB6oB,OAAOpuB,EAAK,EAC3C,EACD,IAEH,OAAO6lB,EAAAA,MAAAA,kBAAwBsf,EAAc,CAE3C2C,cAAa,SAACjT,GACZ,OAAO+P,GAAWmD,KAAMlT,GAAW,UACrC,GAEJ,CC3Re,SAASmT,GAItBC,GAOA,OAAOA,EAAKC,QAAO,WAGjB,OArDJ,SAAuBC,GACrB,MAAO,CACLnzB,MAAO,CACDmzB,uBACF,OAAOA,CACT,GAEFpQ,QAAS,CACPnlB,OAAM,SAAC2J,EAAiB6rB,EAA2BjkC,GAAuB,IAAD,OACvEqV,KAAK6uB,oBAAoB9rB,EAAS6rB,EAAOjkC,GAC3B,SAAVikC,GAA8B,YAAVA,GACtBt/B,YAAW,WACT,EAAKw/B,sBAAsB/rB,EAC7B,GAAG,IAEP,EAEA8rB,oBAAmB,SACjB9rB,EACA6rB,EACAjkC,GAEA,OAAOgkC,EAAiB1mB,KAAK,CAAClF,EAAS6rB,EAAOjkC,GAChD,EAEAokC,mBAAkB,WAChB,OAAOJ,EAAiBK,KAC1B,EAEAF,sBAAqB,SAAC/rB,GACpB,IAAMksB,EAAUN,EAAiBpiC,MAAK,SAAAsP,GAAC,OAAIA,EAAE,KAAOkH,CAAO,IACvDksB,GACFN,EAAiBpN,OAAO0N,EAE5B,GAGN,CAgBWC,CAFkBC,GAAAA,WAAAA,QAG3B,GACF,CDnCAptC,OAAOy3B,YAAcA,EAAAA,YAErBz3B,OAAOqtC,kBAAoBA,EAAAA,kB,uDEsBrBC,IAAcrf,EAAAA,EAAAA,OAAK,kBAAM,gGAAsC,IAkBtD,SAASsf,GACtB71B,GAEC,IADDiyB,EAAyB,uDAAGrf,EAAAA,MAAAA,SAEtBkjB,EAAiB,IACjBC,EAAenjB,EAAAA,MAAAA,MACZ,yBAA0B,CAI/BzhB,GAAIyhB,EAAAA,MAAAA,SAAeA,EAAAA,MAAAA,WAAkBia,OAIrC5iC,KAAM2oB,EAAAA,MAAAA,OAINtiB,OAAQ,EAIRuR,YAAa+Q,EAAAA,MAAAA,SACXA,EAAAA,MAAAA,WAAiBA,EAAAA,MAAAA,SAAe,SAAAxjB,GAAK,OAAIA,GAAS0mC,CAAc,IAChE,KAKF/zB,MAAO6Q,EAAAA,MAAAA,MAAY5S,EAAcg2B,iBAAiB,OAAQ,eAI1DC,QAASrjB,EAAAA,MAAAA,IACP5S,EAAcg2B,iBAAiB,SAAU,eAK3Cl0B,cAAe8Q,EAAAA,MAAAA,IACbA,EAAAA,MAAAA,cACE5S,EAAcg2B,iBAAiB,SAAU,gBAM7CE,oBAAqBtjB,EAAAA,MAAAA,MACnB5S,EAAcg2B,iBAAiB,aAAc,eAK/CrhB,cAAe/B,EAAAA,MAAAA,MACb5S,EAAckoB,0BAA0B,UAK1CiO,mBAAoBvjB,EAAAA,MAAAA,MAClB5S,EAAckoB,0BAA0B,eAK1Cf,kBAAmBvU,EAAAA,MAAAA,MAAYqf,GAI/B7K,oBAAqBxU,EAAAA,MAAAA,MAAYqf,GAIjCmE,eAAgBxjB,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,UAI5B1R,UAAW0R,EAAAA,MAAAA,SAAeA,EAAAA,MAAAA,SAAe,GAKzC5Q,eAAgB4Q,EAAAA,MAAAA,SACdA,EAAAA,MAAAA,OACA0B,aAAauL,QAAQ,mBAAqB,WAG7C8D,UAAS,WAAC,MAAgB,CAOzB16B,eAAWnC,EAOXuvC,UAAMvvC,EAENwvC,eAAgBZ,GAAAA,WAAAA,MACd,IAEH,IACA3zB,OAAM,SAAAkI,GAAI,MAAK,CAIV3H,sBACF,GAAI2H,EAAKqsB,eAAejtC,OAAQ,CAC9B,IAAMktC,EAAetsB,EAAKqsB,eAAe,GACzC,OAAOC,GAAgBA,EAAa,EACtC,CAEF,EAIIh0B,kBACF,GAAI0H,EAAKqsB,eAAejtC,OAAQ,CAC9B,IAAMktC,EAAetsB,EAAKqsB,eAAe,GACzC,OAAOC,GAAgBA,EAAa,EACtC,CAEF,EAII3W,eACF,OAAOx1B,EAAAA,EAAAA,UAAQq6B,EAAAA,EAAAA,WAAexa,GAAMkK,QAAS,WAC/C,EAIIqO,iBACF,OAAOiC,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQqO,UACtC,EAKI7jB,oBACF,OAAO8lB,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQxV,aACtC,EAII8V,iBACF,OAAOgQ,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQM,UACtC,EAIIvsB,oBACF,IAAQA,GAAkBu8B,EAAAA,EAAAA,WAAexa,GAAMkK,QAAvCjsB,cACFsuC,EAAuBvsB,EAAKkd,kBAAkBn9B,KAAI,SAAAE,GAAQ,OAC9D2U,EAAAA,EAAAA,gBAAe3U,EAAU,OAAO,IAElC,MAAM,GAAN,eAAWhC,IAAa,OAAKsuC,GAC/B,EAIIpiB,aACF,MAAM,GAAN,eAAWnK,EAAK0K,gBAAa,QAAK8P,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQC,QACjE,EAIIqiB,wBACF,OAAOhS,EAAAA,EAAAA,WAAexa,GAAMwsB,iBAC9B,EAII1D,kBACF,MAAM,GAAN,eACK9oB,EAAKksB,qBAAkB,QACvB1R,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQ4e,aAEpC,EAII2D,gBACF,OAAOjS,EAAAA,EAAAA,WAAexa,GAAMysB,SAC9B,EAIIC,oBACF,OAAOlS,EAAAA,EAAAA,WAAexa,GAAM0sB,aAC9B,EAIIC,yBACF,OAAOnS,EAAAA,EAAAA,WAAexa,GAAM2sB,kBAC9B,EAIIz3B,wBACF,OAAOslB,EAAAA,EAAAA,WAAexa,GAAM9K,iBAC9B,EAIImxB,cACF,OAAO7L,EAAAA,EAAAA,WAAexa,GAAMqmB,OAC9B,EAIIlxB,YACF,OAAOqlB,EAAAA,EAAAA,WAAexa,GAAM7K,KAC9B,EAIIjX,sBACF,OAAOs8B,EAAAA,EAAAA,WAAexa,GAAM9hB,eAC9B,EAIIqsB,cACF,OAAOiQ,EAAAA,EAAAA,WAAexa,GAAMuK,OAC9B,EAKAqiB,YAAW,WACT,MAAO,CAAErpC,OAAOpD,EAAAA,EAAAA,SAAQ6f,EAAM,SAChC,EAKIrI,oBACF,IAAI4oB,EAAAA,EAAAA,SAAQvgB,GAEV,OAAO6R,MAAMC,KAAK9R,EAAKnI,cAAckN,UACnC/E,EAAKnI,cAAcpH,KAAO,EAIhC,EAUAo8B,aAAY,SAACC,GACX,IAAMC,EAAwB,GAY9B,OAXAC,EAAAA,EAAAA,OAAKxS,EAAAA,EAAAA,WAAexa,IAAO,SAAA1a,GACzB,IAAIwjB,EAAAA,EAAAA,cAAYmkB,EAAAA,EAAAA,SAAQ3nC,IAAQ,CAC9B,IAAM4nC,GAAUC,EAAAA,EAAAA,YAAW7nC,GAC3B2d,OAAOuO,QAAQ0b,EAAQ5b,YAAY9M,SAAQ,YAAmB,IAAD,eAAhB7e,EAAG,KAAElG,EAAK,MAEjDuxB,EAAAA,EAAAA,iBAAgBvxB,IAAU6F,EAAKK,KAASmnC,GAC1CC,EAAKxoB,KAAK,CAAEjf,KAAAA,EAAMK,IAAAA,GAEtB,GACF,CACF,IACOonC,CACT,EACD,IACAlS,SAAQ,SAAA7a,GAAI,MAAK,CAIhBotB,WAAU,SAAClmC,GACT,IAAMpE,EAAMkd,EAAKlI,MAAM3K,WAAU,SAAAuzB,GAAC,OAAIA,EAAEx5B,KAAOA,CAAE,KAEpC,IAATpE,GAGAA,EAAM,GACRkd,EAAKlI,MAAMoZ,OAAOpuB,EAAM,EAAG,EAAGkd,EAAKlI,MAAMhV,GAAMkd,EAAKlI,MAAMhV,EAAM,GAEpE,EAIAuqC,aAAY,SAACnmC,GACX,IAAMpE,EAAMkd,EAAKlI,MAAM3K,WAAU,SAAAuzB,GAAC,OAAIA,EAAEx5B,KAAOA,CAAE,KAEpC,IAATpE,GAIAA,EAAMkd,EAAKlI,MAAM1Y,OAAS,GAC5B4gB,EAAKlI,MAAMoZ,OAAOpuB,EAAK,EAAGkd,EAAKlI,MAAMhV,EAAM,GAAIkd,EAAKlI,MAAMhV,GAE9D,EAIAwqC,kBAAiB,SAACC,GAChBvtB,EAAKjI,eAAiBw1B,EACtBljB,aAAaoK,QAAQ,iBAAkB8Y,EACzC,EAIAC,YAAW,SACTvqC,GAIA,MAA2BA,GAAS,kBAAM+c,EAAKqsB,eAAerF,OAAO,IAAC,eAA/DhkC,EAAS,KAAEtC,EAAK,KACvBsf,EAAKqsB,eAAe9nB,KAAK,CAACvhB,EAAWtC,GACvC,EAIA+sC,QAAO,SAAC3nC,GACNka,EAAKhgB,KAAO8F,CACd,EAKA63B,YAAW,SAACrC,GACV,IAAMyB,EAAM/c,EAAKkd,kBAAkBr0B,MAAK,SAAAsP,GAAC,OAAIA,EAAEnY,OAASs7B,EAAKt7B,IAAI,IACjE,GAAI+8B,EAEF,OADAhU,QAAQC,KAAK,YAAD,OAAasS,EAAKt7B,KAAI,0BAC3B+8B,EAET,IAAM39B,EAAS4gB,EAAKkd,kBAAkB3Y,KAAK+W,GAC3C,OAAOtb,EAAKkd,kBAAkB99B,EAAS,EACzC,EAMAsuC,qBAAoB,SAACpS,GACnB,IAAMyB,EAAM/c,EAAKkd,kBAAkBr0B,MAAK,SAAAsP,GAAC,OAAIA,EAAEnY,OAASs7B,EAAKt7B,IAAI,IACjE,GAAI+8B,EAEF,OADAhU,QAAQC,KAAK,YAAD,OAAasS,EAAKt7B,KAAI,0BAC3B+8B,EAET,IAAM39B,EAAS4gB,EAAKmd,oBAAoB5Y,KAAK+W,GAC7C,OAAOtb,EAAKmd,oBAAoB/9B,EAAS,EAC3C,EAIAuuC,iBAAgB,SAACpmB,GACf,GAAIvH,EAAKmsB,eAAetjC,MAAK,SAAAkf,GAAC,OAAIA,EAAE/nB,OAASunB,EAAOvnB,IAAI,IACtD,MAAM,IAAIY,MAAM,4CAElBof,EAAKmsB,eAAe5nB,KAAKgD,IACzB6iB,EAAAA,EAAAA,SAAapqB,GAAMqqB,mBAAkB,EACvC,EAIA5M,eAAc,SAAC7B,GACb,IAAMnQ,EAAQzL,EAAKkd,kBAAkB/vB,WACnC,SAAA4vB,GAAG,OAAIA,EAAI/8B,OAAS47B,CAAY,KAEnB,IAAXnQ,GACFzL,EAAKkd,kBAAkBhM,OAAOzF,EAAO,EAEzC,EAIAmiB,wBAAuB,SAAChS,GACtB,IAAMnQ,EAAQzL,EAAKmd,oBAAoBhwB,WACrC,SAAA4vB,GAAG,OAAIA,EAAI/8B,OAAS47B,CAAY,KAEnB,IAAXnQ,GACFzL,EAAKmd,oBAAoBjM,OAAOzF,EAAO,EAE3C,EAIAoiB,oBAAmB,SAAC1D,GAClBnqB,EAAKmsB,gBAAiBpO,EAAAA,EAAAA,MACpB/d,EAAKmsB,eAAej0B,QAClB,SAAAqP,GAAM,OACJA,EAAOvE,MAAQmnB,EAAiBnnB,KAChCuE,EAAOgjB,SAAWJ,EAAiBI,QACnChjB,EAAOijB,SAAWL,EAAiBK,QACnCjjB,EAAOkjB,SAAWN,EAAiBM,MAAM,MAG7BjQ,EAAAA,EAAAA,WAAexa,GACvBqqB,mBAAkB,EAC9B,EAIAyD,eAAc,SACZp5B,GAEC,IADDq5B,EAAe,uDAAG,CAAC,EAEXxrC,EAASmS,EAATnS,KACR,IAAKA,EACH,MAAM,IAAI3B,MAAM,4CAElB,IAAMZ,GAAO4U,EAAAA,EAAAA,gBAAeF,EAAe,QACrCs5B,EAAiBj4B,EAAck4B,kBAAkB1rC,GACvD,IAAKyrC,EACH,MAAM,IAAIptC,MAAM,2BAAD,OAA4B2B,IAE7C,IAAM2rC,GAAc,kBACfH,GAAe,IAClB/tC,KAAAA,EACAuC,KAAAA,EACAmS,cAAAA,IAEItV,EAAS4gB,EAAKisB,oBAAoB1nB,KAAK2pB,GAC7C,OAAOluB,EAAKisB,oBAAoB7sC,EAAS,EAC3C,EAKA+uC,gBAAe,SACbC,EACA9kB,EACAM,EACAykB,GACC,IAAD,OACAD,EAAU5pB,SAAQ,YAA8B,IAA3Blf,EAAI,EAAJA,KACfgpC,GAAe,EACnB,IAGE,IAAM/rC,EAAO,gBACPkU,GAAO83B,EAAAA,EAAAA,mBAAkBjpC,GAC/BskB,EAAUrF,MAAK,kBAAM9N,EAAK+3B,UAAUllB,EAAM7G,QAAQ,IAClD6rB,GAAe,EACVD,EAAqB9rC,KACxB8rC,EAAqB9rC,GAAQ,GAE/B8rC,EAAqB9rC,IAAS,CAE9B,CADA,MAAOksC,GACP,CAIF,GAAIzuB,EAAKgsB,QAAQhvB,IAAI1X,EAAK4B,IAAK,CAG7B,IAAM3E,EAAO,iCACbqnB,EAAUrF,MAAK,kBAAM,EAAKmqB,WAAWppC,EAAK,IAC1CgpC,GAAe,EACVD,EAAqB9rC,KACxB8rC,EAAqB9rC,GAAQ,GAE/B8rC,EAAqB9rC,IAAS,CAChC,CACA,IAAK+rC,EACH,MAAM,IAAI1tC,MAAM,uGAAD,OAC0F8F,KAAKC,WAC1GmvB,EAAAA,EAAAA,aAAYxwB,KAIpB,GACF,EAKAqpC,yBAAwB,SAACj6B,GAAuC,IAAD,OACvDk6B,EAA0C,GAC1CP,EAA+C,CAAC,EAChDruC,GAAO4U,EAAAA,EAAAA,gBAAeF,EAAe,QACrCm6B,EAAa7uB,EAAKisB,oBAAoBpjC,MAAK,SAAAs8B,GAAC,OAAIA,EAAEnlC,OAASA,CAAI,IACrE,GAAI6uC,EAAY,CACdA,EAAW1kB,OAAO3F,SAAQ,SAAC8E,GACzB,IAAM8kB,EAAYpuB,EAAK6sB,aAAavjB,GACpC,EAAK6kB,gBACHC,EACA9kB,EACAslB,EACAP,EAEJ,IAKA,MAAO,CAJuB,WAC5BO,EAA4BpqB,SAAQ,SAAAxD,GAAE,OAAIA,GAAI,IAC9C,EAAK8tB,gBAAgBp6B,EACvB,EAC+B25B,EACjC,CAEF,EAKAS,gBAAe,SAACp6B,GACd,IAAM1U,GAAO4U,EAAAA,EAAAA,gBAAeF,EAAe,QACrCm6B,EAAa7uB,EAAKisB,oBAAoBpjC,MAAK,SAAAs8B,GAAC,OAAIA,EAAEnlC,OAASA,CAAI,IACrEggB,EAAKisB,oBAAoBpO,OAAOgR,EAClC,EAKAE,iBAAgB,SAACr6B,GACf,IAAIs6B,EAKJ,GAJIhvB,EAAKysB,YACPuC,GACExU,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQ0f,qBAAqBl1B,KAEjDs6B,EAAa,CAChB,IAAQC,EAAiBv6B,EAAjBu6B,aACFnsC,EAAMkd,EAAKksB,mBAAmB/+B,WAClC,SAAAg4B,GAAC,OAAIA,EAAE8J,eAAiBA,CAAY,IAEtC,IAAa,IAATnsC,EACF,OAEF,OAAOkd,EAAKksB,mBAAmBhb,OAAOpuB,EAAK,EAC7C,CACA,OAAOksC,CACT,EAKAE,kBAAiB,SAACt3B,GAChB,GAAIA,IAAgBoI,EAAKpI,YACvB,OAAOoI,EAAKpI,YAEd,IAAIu3B,EAAiBv3B,EAKrB,OAJIu3B,EAAiBtD,IACnBsD,EAAiBtD,GAEnB7rB,EAAKpI,YAAcu3B,EACZA,CACT,EAKAC,aAAY,SAACxgC,GACiB,SAAxBoR,EAAKjI,iBACPnJ,IAAa,GAEf,IAAMygC,EAAiBrvB,EAAKpI,YAG5B,OADuBy3B,EADA/yB,KAAK4yB,kBAAkBG,EAAiBzgC,EAGjE,EAKA2H,QAAO,SAACoO,GAAsC,IAApB2qB,EAAY,uDAAG,CAAC,EAClCC,EAAiBx5B,EAAcy5B,eAAe,OAAQ7qB,GAC5D,IAAK4qB,EACH,MAAM,IAAI3uC,MAAM,qBAAD,OAAsB+jB,IAGvC,IAAMvlB,EAAS4gB,EAAKlI,MAAMyM,MAAK,kBAC1B+qB,GAAY,IACf/sC,KAAMoiB,KAER,OAAO3E,EAAKlI,MAAM1Y,EAAS,EAC7B,EAKA0X,WAAU,SAACL,GAAY,IACsB,EADvB,UACKuJ,EAAKnI,eAAa,IAA3C,2BAA6C,CAAC,IAAhC43B,GAA+B,kBAAzB,GACdA,EAAOh5B,MAAQg5B,EAAOh5B,KAAKvP,KAAOuP,EAAKvP,IACzCoV,KAAKoyB,WAAWe,EAEpB,CAAC,+BACDzvB,EAAKlI,MAAM+lB,OAAOpnB,EACpB,EAKAyyB,gBAAe,SAACC,GACd,OAAO3O,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQgf,gBAAgBC,EACtD,EAKAG,aAAY,SAACC,GACX,GAAIvpB,EAAKysB,UACP,OAAOjS,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQof,aAAaC,GAEnD,IAAQ9mB,EAAkB8mB,EAAlB9mB,QAASlgB,EAASgnC,EAAThnC,KACjB,IAAKA,EACH,MAAM,IAAI3B,MAAM,sBAAD,OAAuB2B,IAExC,IAAM+mB,EAAQtJ,EAAK0K,cAAc7hB,MAAK,SAACic,GAAM,OAAKA,EAAErC,UAAYA,CAAO,IACvE,GAAI6G,EACF,OAAOA,EAET,IAAMlqB,EAAS4gB,EAAK0K,cAAcnG,KAAKglB,GACvC,OAAOvpB,EAAK0K,cAActrB,EAAS,EACrC,EAKA0qC,gBAAe,SAACP,GACd,IAAMqF,EAA0C,GAE1CR,EAAYpuB,EAAK6sB,aAAatD,GAQpC,GAPAjtB,KAAK6xB,gBACHC,EACA7E,EACAqF,EALmD,CAAC,GAQtDA,EAA4BpqB,SAAQ,SAAAxD,GAAE,OAAIA,GAAI,IAC1ChB,EAAKysB,UACP,OAAOjS,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQ4f,gBAAgBP,GAEtD,IAAQ9mB,EAAY8mB,EAAZ9mB,QACF3f,EAAMkd,EAAK0K,cAAcvd,WAAU,SAAA2X,GAAC,OAAIA,EAAErC,UAAYA,CAAO,IACnE,OAAa,IAAT3f,EAGGkd,EAAK0K,cAAcwG,OAAOpuB,EAAK,QAHtC,CAIF,EAKA4mC,kBAAiB,SAACC,GAChB,GAAI3pB,EAAKysB,UACP,OAAOjS,EAAAA,EAAAA,WAAexa,GAAMkK,QAAQwf,kBAAkBC,GAExD,IAAQsF,EAAuBtF,EAAvBsF,aAAc1sC,EAASonC,EAATpnC,KACtB,IAAKA,EACH,MAAM,IAAI3B,MAAM,2BAAD,OAA4B2B,IAE7C,IAAMssC,EAAa7uB,EAAK0K,cAAc7hB,MACpC,SAACs8B,GAAM,OAAKA,EAAE8J,eAAiBA,CAAY,IAE7C,GAAIJ,EACF,OAAOA,EAET,IAAMzvC,EAAS4gB,EAAKksB,mBAAmB3nB,KAAKolB,GAC5C,OAAO3pB,EAAKksB,mBAAmB9sC,EAAS,EAC1C,EAKAswC,8BAA6B,SAAC9T,GAA0C,IAApB0T,EAAY,uDAAG,CAAC,EAClE,OAAOhzB,KAAKqzB,kBACV,mBACA/T,EACA0T,EAEJ,EAKAK,kBAAiB,SACfj5B,EACAklB,GAEC,IADD0T,EAAiB,uDAAG,CAAC,EAEfrvC,EAAW+f,EAAKwK,WAAW3hB,MAC/B,SAAA+mC,GAAC,OAAIh7B,EAAAA,EAAAA,gBAAeg7B,EAAG,UAAYhU,CAAY,IAEjD,IAAK37B,EACH,MAAM,IAAIW,MAAM,mCAAD,OACsBg7B,EAAY,+BAOnD,OAJA0T,EAAaO,gCAAiCj7B,EAAAA,EAAAA,gBAC5C3U,EACA,QAEKqc,KAAK/F,QAAQG,EAAU44B,EAChC,EAKAQ,uBAAsB,SACpBp5B,EACAq5B,GAEC,IADDT,EAA6C,uDAAG,CAAC,EAE3CU,GAAK,UAAQV,GAEnB,OADAU,EAAMC,kBAAmBna,EAAAA,EAAAA,aAAYia,EAAUE,kBACxC3zB,KAAK/F,QAAQG,EAAUs5B,EAChC,EAKAE,UAAS,SACPvrB,EACAzd,GAGC,IAFDooC,EAAY,uDAAG,CAAC,EAChB56B,EAAa,uDAAG,CAAEnS,KAAMoiB,GAElB4qB,EAAiBx5B,EAAcy5B,eAAe,SAAU7qB,GAC9D,IAAK4qB,EACH,MAAM,IAAI3uC,MAAM,uBAAD,OAAwB+jB,IAEzC,IAAMmO,GAAI,kBACLwc,GAAY,IACfpoC,GAAAA,EACA3E,KAAMoiB,EACNjQ,cAAAA,IAGF,OADAsL,EAAKgsB,QAAQtvC,IAAIwK,EAAI4rB,GACd9S,EAAKgsB,QAAQvvC,IAAIyK,EAC1B,EAKAipC,WAAU,SAACV,GACLzvB,EAAKnI,cAAcmF,IAAIyyB,EAAOvoC,KAChC8Y,EAAKnI,cAAc6E,OAAO+yB,EAAOvoC,IAEnC8Y,EAAKnI,cAAcnb,IAAI+yC,EAAOvoC,GAAIuoC,GAClCzvB,EAAK/I,WAAY,CACnB,EAKAm5B,UAAS,SAACX,GACR,OAAOzvB,EAAKnI,cAAcmF,IAAIyyB,EAAOvoC,GACvC,EAKAwnC,WAAU,SAACe,GACTzvB,EAAKnI,cAAc6E,OAAO+yB,EAAOvoC,GACnC,EAIAmpC,qBAAoB,WAClBrwB,EAAK/I,WAAY,CACnB,EAIAwB,iBAAgB,WACduH,EAAK/I,WAAY,CACnB,EAIAq5B,eAAc,WACZtwB,EAAKnI,cAAcuF,OACrB,EAQAmzB,aAAY,SAACxzC,GACXijB,EAAKhhB,UAAYjC,CACnB,EAMAyzC,eAAc,WACZxwB,EAAKhhB,eAAYnC,CACnB,EAKA4zC,iBAAgB,WACdzwB,EAAKisB,oBAAoB7sC,OAAS,CACpC,EAKAsxC,gBAAe,SAACC,GACd,OAAOnW,EAAAA,EAAAA,WAAexa,GAAM0wB,gBAAgBC,EAC9C,EAKAC,mBAAkB,SAACD,GACjB,OAAOnW,EAAAA,EAAAA,WAAexa,GAAM4wB,mBAAmBD,EACjD,EAKAh7B,qBAAoB,SAACk7B,GACnB,OAAOrW,EAAAA,EAAAA,WAAexa,GAAMrK,qBAAqBk7B,EACnD,EAKAC,wBAAuB,WACrB,OAAOtW,EAAAA,EAAAA,WAAexa,GAAM8wB,yBAC9B,EAIAC,gBAAe,SAACF,GACd,OAAOrW,EAAAA,EAAAA,WAAexa,GAAM+wB,gBAAgBF,EAC9C,EAKAG,kBAAiB,WACf,OAAOxW,EAAAA,EAAAA,WAAexa,GAAMgxB,mBAC9B,EAKAC,0BAAyB,WACvB,OAAOzW,EAAAA,EAAAA,WAAexa,GAAMixB,2BAC9B,EAKAC,oBAAmB,WACjB,OAAO1W,EAAAA,EAAAA,WAAexa,GAAMkxB,qBAC9B,EAKAC,WAAU,SAACR,GACT,OAAOnW,EAAAA,EAAAA,WAAexa,GAAMmxB,WAAWR,EACzC,EACD,IAEA9V,SAAQ,SAAA7a,GAAI,MAAK,CAOhBoxB,kBAAiB,SAAC18B,GAChB,KAAK28B,EAAAA,EAAAA,sBAAqB38B,GACxB,MAAM,IAAI9T,MACR,wDAGJ,IAAM0wC,EAAwBtxB,EACxBuxB,EAASD,EAAsBpB,UACnC,4BACA,eACA,CAAEtwC,OAAQ8U,IAEZ48B,EAAsBnB,WAAWoB,EACnC,EAKAC,uBAAsB,SAAC98B,GACrB,IAAQ+3B,EAA6BzsB,EAA7BysB,UAAW/hB,EAAkB1K,EAAlB0K,cACnB,IAAK+hB,IAAuD,IAA1C/hB,EAAc1kB,QAAQ0O,GACtC,MAAM,IAAI9T,MAAM,uDAElB0b,KAAK80B,kBAAkB18B,EACzB,EACD,IACAoD,OAAM,SAAAkI,GAAI,MAAK,CAIdyxB,wBAAuB,SAACtzC,GACtB,IAAQsuC,EAA6BzsB,EAA7BysB,UAAW/hB,EAAkB1K,EAAlB0K,cACbgnB,EACJjF,GAAa/hB,EAAc7hB,MAAK,SAAAic,GAAC,OAAIA,EAAErC,UAAYtkB,EAAOskB,OAAO,IAG7DkvB,EAC+B,4BAAnC/8B,EAAAA,EAAAA,gBAAezW,EAAQ,QACzB,MAAO,CACL,CACEmB,MAAO,cACPmB,QAAS,WACPuf,EAAKwtB,aAAY,SAAA10B,GAAW,MAAI,CAC9B6yB,GACA,CAAExtC,OAAAA,EAAQ2a,YAAAA,GACX,GACH,EACAjW,KAAM+uC,GAAAA,GAER,CACEtyC,MAAO,WACPO,UAAW6xC,EACXjxC,QAAS,kBAAMuf,EAAKwxB,uBAAuBrzC,EAAO,EAClD0E,KAAMgvC,GAAAA,GAER,CACEvyC,MAAO,eACPO,UAAW6xC,GAAWC,EACtBlxC,QAAS,kBAAMuf,EAAK8pB,gBAAgB3rC,EAAO,EAC3C0E,KAAMivC,GAAAA,GAER,CACExyC,MAAO,aACPO,SAAU8xC,EACVlxC,QAAS,WACP,IAAMo1B,EAAOgV,MAAM/U,EAAAA,EAAAA,aAAY33B,IACzBse,EAAMD,KAAKC,MACjBoZ,EAAKpT,SAAO,WAAQhG,GACpBoZ,EAAKkc,SAASvtB,SAAQ,SAAClb,GACrBA,EAAQqZ,WAAS,WAAQlG,EAC3B,IAIKuD,EAAKysB,YACR5W,EAAKpT,SAAW,gBAChBoT,EAAKmc,cAAWn1C,GAElBg5B,EAAK71B,MAAQ,UACbggB,EAAKspB,aAAazT,EACpB,EACAhzB,KAAMovC,GAAAA,GAGZ,EACD,IAEGC,EAAuBn8B,EAAcyS,uBACzC,qBACAsjB,GAGF,OAAOnjB,EAAAA,MAAAA,kBAAwBmiB,GAAmBoH,GAAuB,CAEvEC,aAAY,SAACxa,GACX,GAAIA,EAAU,CAEZ,MAAyCA,GAAY,CAAC,EAA9CsU,EAAmB,EAAnBA,oBAAwB9P,GAAI,aAIpC,IAAKtK,MAAMsO,QAAQ8L,GACjB,OAAO9P,CAEX,CACA,OAAOxE,CACT,GAEJ,CCh+Be,SAASya,GACtBr8B,GAEC,IADD02B,EAAS,wDAEH4F,EAAuBC,GAA4Bv8B,GACnDgyB,EAAU6D,GAAoB71B,EAAes8B,GAC7C9lB,EAAkBgmB,GACtBF,EACAt8B,GAEF,OAAO4S,EAAAA,MAAAA,MACE,OAAQ,CAKbuB,QAASsoB,GAAkBz8B,EAAegyB,EAASsK,GAInDhb,WAAY1O,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QAMxBhrB,QAASgrB,EAAAA,MAAAA,MAAYof,GAIrB7pC,gBAAiByqB,EAAAA,MAAAA,SAAe4D,EAAiB,CAAC,GAIlDhC,QAAS5B,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QAIrBtgB,iBAAkBsgB,EAAAA,MAAAA,MAChB5S,EAAcg2B,iBAAiB,mBAAoB,eAMrD1F,QAAS1d,EAAAA,MAAAA,SAAeud,GAAe,CAAEE,WAAY,iBAEtD1M,UAAS,SAAA1Z,GAAI,MAAK,CACjB4W,mBAAmB,EACnBC,yBAAyB,EACzB4b,gBAAgB,EAChBla,WAAY,IAAIoL,GACd5tB,EACAiK,EAAKkK,QAAQxV,cAAcwzB,IAC3B,CACErJ,mBAAoB,CAClBqE,mBAAAA,IAEFtE,oBAAqB,CAAC,IAG1B8T,sBAAuBjH,GAAAA,WAAAA,IAAe,CAAC,GACvCe,kBAAmB,IAAI/H,GAAkB1uB,GACzC5W,WAAOtC,EACR,IACAib,OAAM,SAAAkI,GAAI,MAAK,CACV0sB,oBACF,OAAO7a,MAAMC,KAAK9R,EAAK0yB,sBAAsB3tB,SAC/C,EACA4tB,eAAc,SAAC3yC,GACb,MAAM,cAAN,OAAqBA,EAAI,YAAIggB,EAAKqX,WACpC,EACIub,iBACF,MAAM,YAAN,OAAmB5yB,EAAKqX,WAC1B,EACIsV,yBACF,MAAM,oBAAN,OAA2B3sB,EAAKqX,WAClC,EACD,IACAvf,OAAM,SAAAkI,GAAI,MAAK,CACV9K,wBACF,OAAO8K,EAAK0sB,cAAc3sC,KAAI,SAAApC,GAAO,OAAIA,EAAQqC,IAAI,GACvD,EACIu3B,uBAAoB,IAAD,EACfvB,EAAc,IAAIC,IAAI53B,OAAOC,SAAS43B,MACtCC,EAAS,IAAI/3B,gBAAgB43B,EAAYz3B,QAC/C,OAAa,OAAN43B,QAAM,IAANA,GAAsB,QAAhB,EAANA,EAAQ15B,IAAI,kBAAU,WAAhB,EAAN,EAAwBkuB,MAAM,UAAU,EACjD,EACD,IAEAkQ,SAAQ,SAAA7a,GAAI,MAAK,CAChBgpB,YAAW,WAAI,IAAD,OACZn8B,SAASlQ,iBAAiB,WAAW,SAAAgQ,GACnC,IAAMkmC,EAAKlmC,EAAEmmC,SAAWnmC,EAAEomC,QACtB/yB,EAAKqmB,QAAQG,UAGZqM,GAAMlmC,EAAEqmC,UAAuB,SAAXrmC,EAAE2R,MAEtB3R,EAAEmmC,UAAYnmC,EAAEqmC,UAAuB,SAAXrmC,EAAE2R,OAE/B0B,EAAKqmB,QAAQmB,OAGbxnB,EAAKqmB,QAAQE,SAEXsM,IAAOlmC,EAAEqmC,UAAuB,SAAXrmC,EAAE2R,MACzB0B,EAAKqmB,QAAQiB,MAGnB,IAEArkB,OAAOuO,QAAQnH,cACZnS,QAAO,+BAAEvS,EAAG,KAAM,YAAMA,EAAIstC,WAAW,cAAc,IACrD/6B,QAAO,YAAK,OAAuD,KAA5D,YAAK,GAAUlS,QAAQga,EAAKqX,YAAc,YAAmB,IACpE7S,SAAQ,YAAiB,IAAD,eAAd7e,EAAG,KAAEN,EAAG,KACjB,IACE,IAAQ1H,EAAY+I,KAAKE,MAAMvB,GAAvB1H,QACRqiB,EAAK0yB,sBAAsBh2C,IAAIiJ,EAAKhI,EAGtC,CAFE,MAAOgP,GACPoc,QAAQ5pB,MAAM,0BAA2BwG,EAAKN,EAChD,CACF,KACFi4B,EAAAA,EAAAA,aACEtd,GACAkzB,EAAAA,GAAAA,UAAQ,WAAO,IAC6C,EAD9C,UACUlzB,EAAK0yB,sBAAsBlhB,WAAS,IAA1D,2BAA4D,CAAC,IAA/CnsB,GAA8C,kBAA3C,GACf,IACE,IAAMM,EAAMqa,EAAK2yB,eAAettC,EAAIrF,MACpCqqB,aAAaoK,QAAQ9uB,EAAKe,KAAKC,UAAU,CAAEhJ,QAAS0H,IAQtD,CAPE,MAAOsH,GAEQ,OAAXA,EAAE2R,MAA4B,SAAX3R,EAAE2R,MACvB60B,MACE,qFAGN,CACF,CAAC,+BACH,MAGF7V,EAAAA,EAAAA,aACEtd,GACAkzB,EAAAA,GAAAA,UAAQ,WACFlzB,EAAKriB,SAKPqiB,EAAKqmB,QAAQa,YAEjB,MAEF5J,EAAAA,EAAAA,aACEtd,GACAkzB,EAAAA,GAAAA,UACE,WACE,GAAIlzB,EAAKriB,QAAS,CAChB,IACMg6B,GAAW7B,EAAAA,EAAAA,aAAY9V,EAAKriB,UADhB,CAAEqC,KAAM,SAE1BozC,eAAe3e,QACb,UACA/tB,KAAKC,UAAU,CAAEhJ,QAASg6B,KAG5BtN,aAAaoK,QAAQ,YAAD,OACNzU,EAAKqX,YACjB3wB,KAAKC,UAAU,CACbhJ,SAAQ,kBACHg6B,GAAQ,IACX33B,KAAK,GAAD,OAAK23B,EAAS33B,KAAI,mBAIxBggB,EAAKyyB,gBAEPp0C,OAAOC,SAAS+0C,QAEpB,CACF,GACA,CAAE9T,MAAO,QAGbjC,EAAAA,EAAAA,aACEtd,GACAkzB,EAAAA,GAAAA,UAAQ,WACNlzB,EAAKkK,QAAQ7hB,iBAAiBmc,SAAQ,SAAA8uB,GACpC,EAAKC,0BAA0BD,EACjC,GACF,IAEJ,EACAnC,WAAU,SAACR,GACT,IAAM6C,EAAaxzB,EAAKriB,QAExB,GADAqiB,EAAKriB,SAAUogC,EAAAA,EAAAA,MAAK4S,GAChB3wB,EAAKriB,QAEP,IACEgzB,GAAqB3Q,EAAKriB,SAASsvC,EAAAA,EAAAA,SAAQjtB,EAAKriB,SAKlD,CAJE,MAAOwB,GAGP,MADA6gB,EAAKriB,QAAU61C,EACTr0C,CACR,CAEJ,EACAo0C,0BAAyB,SACvBE,GAEC,IADD1F,EAAe,uDAAG,CAAC,EAEb2F,EAAsB39B,EAAc49B,uBACxCF,EAAsBlxC,MAExB,IAAKmxC,EACH,MAAM,IAAI9yC,MAAM,iCAAD,OACoB6yC,EAAsBlxC,OAI3D,IAAMnD,EAAS4gB,EAAK3X,iBAAiBkc,MAAK,kBACrCwpB,GAAe,IAClBxrC,KAAMkxC,EAAsBlxC,KAC5BmS,cAAe++B,KAEjB,OAAOzzB,EAAK3X,iBAAiBjJ,EAAS,EACxC,EACAw0C,+BAA8B,SAC5B5rC,GAGC,IACG6rC,EAHJ9F,EAAe,uDAAG,CAAC,EACnB/qB,EAAW,uCAIX,IACE6wB,EAAU,IAAI5d,IAAIjT,GAAK8wB,MAEvB,CADA,MAAOnnC,GACP,CAGF,IAAMonC,EAAuB/rC,EAAkB2iB,MAAM,KAC/CjW,EAAgB,CACpBnS,KAAMwxC,EAAqB,GAC3B/rC,kBAAmBA,EACnBhI,KAAM+zC,EAAqB7tC,MAAM,GAAGtH,KAAK,KACzC+I,YAAa,GACbqsC,QAASH,EAAU,CAACA,GAAW,IAE3BH,EAAsB39B,EAAc49B,uBACxCj/B,EAAcnS,MAEV0xC,EAAkBP,EAAoB9mB,WAAWsnB,QAAO,kBACzDnG,GAAe,IAClBxrC,KAAMmS,EAAcnS,KACpBmS,cAAAA,KAGF,OADAsL,EAAK3X,iBAAiBkc,KAAK0vB,GACpBA,CACT,EACAld,mBAAkB,SAACod,GACjBn0B,EAAK4W,kBAAoBud,CAC3B,EACArd,yBAAwB,SAACqd,GACvBn0B,EAAK6W,wBAA0Bsd,CACjC,EACA9J,kBAAiB,SAAC8J,GAChBn0B,EAAKyyB,eAAiB0B,CACxB,EACAnD,kBAAiB,WACf,IAAQjI,EAAmB/oB,EAAKkK,QAAxB6e,eACFqL,GAAU,kBACXrL,GAAc,IACjB/oC,KAAK,GAAD,OAAK+oC,EAAe/oC,KAAI,aAAI,IAAIwc,MAAO63B,oBAG7C/3B,KAAK60B,WAAWiD,EAClB,EACAz+B,qBAAoB,SAACk7B,GACnB,GAAI7wB,EAAKriB,QAAS,CAChB,IAAMg6B,EAAWjxB,KAAKE,MAAMF,KAAKC,WAAUmvB,EAAAA,EAAAA,aAAY9V,EAAKriB,WAC5Dg6B,EAAS33B,KAAO6wC,EAChBv0B,KAAK60B,WAAWxZ,EAClB,CACF,EAEA+Y,gBAAe,SAAC/yC,GACd,IAAMgI,EAAMqa,EAAK2yB,eAAeh1C,EAAQqC,MACxCggB,EAAK0yB,sBAAsBh2C,IAAIiJ,EAAKhI,EACtC,EAEAizC,mBAAkB,SAACjzC,GACjB,IAAMgI,EAAMqa,EAAK2yB,eAAeh1C,EAAQqC,MACxCqqB,aAAaiqB,WAAW3uC,GACxBqa,EAAK0yB,sBAAsBh2B,OAAO/W,EACpC,EAEAmrC,wBAAuB,WACrB,GAAI9wB,EAAKriB,QAAS,CAChB,IAAMg6B,EAAWjxB,KAAKE,MAAMF,KAAKC,WAAUmvB,EAAAA,EAAAA,aAAY9V,EAAKriB,WACxD42C,EAAe,UAAMv0B,EAAKriB,QAAQqC,KAAI,WAC1C,GAAIggB,EAAK9K,kBAAkBjW,SAASs1C,GAAkB,CACpD,IAAIC,EAAwB,EAC5B,GACED,EAAe,UAAMv0B,EAAKriB,QAAQqC,KAAI,kBAAUw0C,EAAqB,KACrEA,GAAyB,QAClBx0B,EAAK9K,kBAAkBjW,SAASs1C,GAC3C,CACA5c,EAAS33B,KAAOu0C,EAChBj4B,KAAK60B,WAAWxZ,EAClB,CACF,EACAoZ,gBAAe,SAAC/wC,GACd,IAAMy0C,EAAUz0B,EAAK2yB,eAAe3yC,GAC9B00C,EAAqBrqB,aAAauL,QAAQ6e,GAChD,IAAKC,EACH,MAAM,IAAI9zC,MAAM,0BAAD,OACaZ,EAAI,qCAIlCsc,KAAK60B,WAAWzqC,KAAKE,MAAM8tC,GAAoB/2C,QACjD,EACAszC,0BAAyB,WACvB,GAAIjxB,EAAKriB,QAAS,CAChB,IAAMgI,EAAMqa,EAAK2yB,eAAe3yB,EAAKriB,QAAQqC,MAC7CggB,EAAK0yB,sBAAsBh2C,IAAIiJ,GAAKmwB,EAAAA,EAAAA,aAAY9V,EAAKriB,SACvD,CACF,EACAuzC,oBAAmB,WACjB,IAAMyD,EAAmBtqB,aAAauL,QAAQ5V,EAAK2sB,oBAC7CiI,EAAmBD,EACrBjuC,KAAKE,MAAM+tC,GAAkBh3C,QAC7B,CAAC,EACGqC,EAAS40C,EAAT50C,KACR40C,EAAiB50C,KAAI,UAAMA,EAAK6vB,QAAQ,aAAc,IAAG,aACzDvT,KAAK60B,WAAWyD,EAClB,EAEApf,SAAQ,SAACr2B,GACP6gB,EAAK7gB,MAAQA,CACf,EACA01C,+BAA8B,SAACv2C,GAE7B,IAAMw2C,EAAax2C,EAAS0J,kBAC5B,GAAI8sC,EAAY,CACd,IAAMC,EAAkB/0B,EAAK3X,iBAAiBQ,MAAK,SAAAyqC,GACjD,OAAOA,EAAQtrC,oBAAsB8sC,CACvC,IACA,GAAIC,EACF,OAAOA,CAEX,CAEA,IAC2C,EAD3C,UACsB/0B,EAAK3X,kBAAgB,IAA3C,2BAA6C,CAAC,IAAnCirC,EAAO,QAEhB,GADqBA,EAAQ0B,gBAAgB12C,GAE3C,OAAOg1C,CAEX,CAEA,+BACA,OAAOwB,EACHx4B,KAAKs3B,+BAA+BkB,EAAY,CAAC,EAAGx2C,EAASuW,KAC7D,IACN,EACD,IACA6kB,UAAS,SAAA1Z,GAAI,MAAK,CACjB7K,MAAM,CACJ,CACE7V,MAAO,OACPyC,UAAW,CACT,CACEzC,MAAO,cACPuD,KAAMoyC,GAAAA,EAENx0C,QAAS,SAAC9C,GACR,IAAMu3C,EAAe7qB,aAAauL,QAAQ5V,EAAK4yB,YAC3CsC,GACF7qB,aAAaoK,QAAQzU,EAAK2sB,mBAAoBuI,GAEhDv3C,EAAQqzC,mBACV,GAEF,CACE1xC,MAAO,uBACPuD,KAAMsyC,GAAAA,EACN10C,QAAS,SAAC9C,GACR,IAAM8xC,EAAS9xC,EAAQuyC,UACrB,sBACA,uBAEFvyC,EAAQwyC,WAAWV,EACrB,GAEF,CACEnwC,MAAO,iBACPuD,KAAMuyC,GAAAA,EACN30C,QAAS,SAAC9C,GACR,IAAM03C,EAAc,IAAIC,KACtB,CAAC5uC,KAAKC,UAAU,CAAEhJ,SAASm4B,EAAAA,EAAAA,aAAYn4B,IAAY,KAAM,IACzD,CAAE4E,KAAM,8BAEVgzC,EAAAA,GAAAA,QAAOF,EAAa,eACtB,GAEF,CACE/1C,MAAO,qBACPuD,KAAM2yC,GAAAA,EACN/0C,QAAS,SAAC9C,GACR,IAAM8xC,EAAS9xC,EAAQuyC,UACrB,iBACA,kBAEFvyC,EAAQwyC,WAAWV,EACrB,GAEF,CACEnwC,MAAO,eACPuD,KAAM4yC,GAAAA,EACNh1C,QAAS,SAAC9C,GACRqiB,EAAKixB,4BACLtzC,EAAQ+X,OAAO,kBAAD,OAAmB/X,EAAQqC,KAAI,KAAK,UACpD,GAEF,CACEV,MAAO,oBACPuD,KAAM6yC,GAAAA,EACNj1C,QAAS,SAAC9C,GACJA,EAAQmzC,yBACVnzC,EAAQmzC,yBAEZ,GAEF,CAAEvuC,KAAM,WACR,CACEjD,MAAO,gBACPuD,KAAM8yC,GAAAA,EACNl1C,QAAS,SAAC9C,GACR,GAA6B,IAAzBA,EAAQma,MAAM1Y,OAChBzB,EAAQ+X,OAAO,gDACV,GAAI/X,EAAQma,MAAM1Y,QAAU,EAAG,CACpC,IAAMqwC,EAAS9xC,EAAQuyC,UACrB,iBACA,iBACA,CAAEz5B,KAAM9Y,EAAQma,MAAM,GAAG5Q,KAE3BvJ,EAAQwyC,WAAWV,GACf9xC,EAAQma,MAAM1Y,OAAS,GACzBzB,EAAQ+X,OAAO,4LAInB,CACF,GAEF,CACEpW,MAAO,qBACPuD,KAAM+yC,GAAAA,GACNn1C,QAAS,SAAC9C,GACR,IAAM8xC,EAAS9xC,EAAQuyC,UACrB,sBACA,uBAEFvyC,EAAQwyC,WAAWV,EACrB,GAEF,CAAEltC,KAAM,WACR,CACEjD,MAAO,0BACPuD,KAAMgzC,GAAAA,EACNp1C,QAAS,WACPuf,EAAKmxB,gBAAWt0C,EAClB,MAGL,eACG4vC,EACA,CACE,CACEntC,MAAO,QACPyC,UAAW,CACT,CACEzC,MAAO,wBACPuD,KAAMgvC,GAAAA,EACNpxC,QAAS,WACPuf,EAAK+W,oBAAmB,EAC1B,GAEF,CACEz3B,MAAO,sBACPuD,KAAMgvC,GAAAA,EACNpxC,QAAS,WACPuf,EAAK8W,0BAAyB,EAChC,MAKR,IAAI,CACR,CACEx3B,MAAO,MACPyC,UAAW,IAEb,CACEzC,MAAO,QACPyC,UAAW,CACT,CACEzC,MAAO,OACPO,SAAUmgB,EAAKqmB,QAAQE,QACvB1jC,KAAMizC,GAAAA,EACNr1C,QAAS,WACPuf,EAAKqmB,QAAQiB,MACf,GAEF,CACEhoC,MAAO,OACPO,SAAUmgB,EAAKqmB,QAAQG,QACvB3jC,KAAMkzC,GAAAA,EACNt1C,QAAS,WACPuf,EAAKqmB,QAAQmB,MACf,GAEF,CAAEjlC,KAAM,WACR,CACEjD,MAAO,eACPuD,KAAMmzC,GAAAA,EACNv1C,QAAS,WACP,GAAIuf,EAAKriB,QAAS,CAChB,IAAM8xC,EAASzvB,EAAKriB,QAAQuyC,UAC1B,oBACA,qBAEFlwB,EAAKriB,QAAQwyC,WAAWV,EAC1B,CACF,OAKRhD,UAAAA,EACD,IACA5R,SAAQ,SAAA7a,GAAI,MAAK,CAChBi2B,SAAQ,SAACC,GACPl2B,EAAK7K,MAAQ+gC,CACf,EAMAC,WAAU,SAACC,GACT,OAAOp2B,EAAK7K,MAAMoP,KAAK,CAAEjlB,MAAO82C,EAAUr0C,UAAW,IACvD,EASAs0C,WAAU,SAACD,EAAkBvyC,GAM3B,OALAmc,EAAK7K,MAAM+b,QACRrtB,EAAW,EAAImc,EAAK7K,MAAM/V,OAAS,GAAKyE,EACzC,EACA,CAAEvE,MAAO82C,EAAUr0C,UAAW,KAEzBie,EAAK7K,MAAM/V,MACpB,EAOAk3C,aAAY,SAACF,EAAkBxzC,GAC7B,IAAMyS,EAAO2K,EAAK7K,MAAMtM,MAAK,SAAA0tC,GAAC,OAAIA,EAAEj3C,QAAU82C,CAAQ,IACtD,OAAK/gC,EAIEA,EAAKtT,UAAUwiB,KAAK3hB,IAHzBod,EAAK7K,MAAMoP,KAAK,CAAEjlB,MAAO82C,EAAUr0C,UAAW,CAACa,KACxC,EAGX,EAUA4zC,aAAY,SAACJ,EAAkBxzC,EAAoBiB,GACjD,IAAMwR,EAAO2K,EAAK7K,MAAMtM,MAAK,SAAA0tC,GAAC,OAAIA,EAAEj3C,QAAU82C,CAAQ,IACtD,IAAK/gC,EAEH,OADA2K,EAAK7K,MAAMoP,KAAK,CAAEjlB,MAAO82C,EAAUr0C,UAAW,CAACa,KACxC,EAET,IAAM6zC,EACJ5yC,EAAW,EAAIwR,EAAKtT,UAAU3C,OAASyE,EAAWA,EAEpD,OADAwR,EAAKtT,UAAUmvB,OAAOulB,EAAgB,EAAG7zC,GAClCyS,EAAKtT,UAAU3C,MACxB,EAQAs3C,gBAAe,SAACC,EAAoB/zC,GAClC,IAAIg0C,EAAU52B,EAAK7K,MAAMtM,MAAK,SAAA0tC,GAAC,OAAIA,EAAEj3C,QAAUq3C,EAAS,EAAE,IAC1D,IAAKC,EAAS,CACZ,IAAM9zC,EAAMwZ,KAAK65B,WAAWQ,EAAS,IACrCC,EAAU52B,EAAK7K,MAAMrS,EAAM,EAC7B,CACA,IAAiBC,EAAY6zC,EAAvB70C,UACA80C,EAAY,CAACF,EAAS,IAe5B,OAdAA,EAASzwC,MAAM,GAAGse,SAAQ,SAAA4xB,GACxBS,EAAUtyB,KAAK6xB,GACf,IAAIU,EAAK/zC,EAAQ8F,MAAK,SAAAkuC,GAAE,MAAI,UAAWA,GAAMA,EAAGz3C,QAAU82C,CAAQ,IAClE,IAAKU,EAAI,CACP,IAAMh0C,EAAMC,EAAQwhB,KAAK,CAAEjlB,MAAO82C,EAAUrzC,QAAS,KACrD+zC,EAAK/zC,EAAQD,EAAM,EACrB,CACA,KAAM,YAAag0C,GACjB,MAAM,IAAIl2C,MAAM,IAAD,OACTw1C,EAAQ,sBAAcS,EAAS,uBAGvC9zC,EAAU+zC,EAAG/zC,OACf,IACOA,EAAQwhB,KAAK3hB,EACtB,EAWAo0C,gBAAe,SACbL,EACA/zC,EACAiB,GAEA,IAAI+yC,EAAU52B,EAAK7K,MAAMtM,MAAK,SAAA0tC,GAAC,OAAIA,EAAEj3C,QAAUq3C,EAAS,EAAE,IAC1D,IAAKC,EAAS,CACZ,IAAM9zC,EAAMwZ,KAAK65B,WAAWQ,EAAS,IACrCC,EAAU52B,EAAK7K,MAAMrS,EAAM,EAC7B,CACA,IAAiBC,EAAY6zC,EAAvB70C,UACA80C,EAAY,CAACF,EAAS,IAgB5B,OAfAA,EAASzwC,MAAM,GAAGse,SAAQ,SAAA4xB,GACxBS,EAAUtyB,KAAK6xB,GACf,IAAIU,EAAK/zC,EAAQ8F,MAAK,SAAAkuC,GAAE,MAAI,UAAWA,GAAMA,EAAGz3C,QAAU82C,CAAQ,IAClE,IAAKU,EAAI,CACP,IAAMh0C,EAAMC,EAAQwhB,KAAK,CAAEjlB,MAAO82C,EAAUrzC,QAAS,KACrD+zC,EAAK/zC,EAAQD,EAAM,EACrB,CACA,KAAM,YAAag0C,GACjB,MAAM,IAAIl2C,MAAM,IAAD,OACTw1C,EAAQ,sBAAcS,EAAS,uBAGvC9zC,EAAU+zC,EAAG/zC,OACf,IACAA,EAAQmuB,OAAOrtB,EAAU,EAAGjB,GACrBG,EAAQ3D,MACjB,EACD,GACL,C,eC1tBe,SAAe63C,KAAY,gCAGzC,gDAHc,mFAEb54C,OAAOC,SAAWD,OAAOC,SAASK,SAAQ,4CAC3C,sB,2BCmBM,SAASu4C,GACdC,GAEA,YAC8Ct6C,IAA1Cs6C,EAA+B5M,aACY1tC,IAA1Cs6C,EAAkCn0B,UACQnmB,IAA1Cs6C,EAA+BC,cACgCv6C,IAAjEs6C,EAAwDn3C,IAE7D,CAaO,SAASq3C,GACdF,GAEA,YAC6Ct6C,IAA1Cs6C,EAA+B1M,aACW5tC,IAA1Cs6C,EAA+BG,MAEpC,CAMO,SAASC,GACdJ,GAEA,YAA+Ct6C,IAAvCs6C,EAA4B3M,MACtC,CAuBA,SAASgN,KAGP,MAEmB,kBAATx3B,MAAqBA,KAAKA,OAASA,MAAQA,MAChC,kBAAXy3B,EAAAA,GAAuBA,EAAAA,EAAOA,SAAWA,EAAAA,GAAUA,EAAAA,GAE3Dn7B,IAEJ,CAEA,SAASo7B,GAAcC,GACrB,OAAOz0C,QAAQ,sBAAuBy0C,EACxC,CAAC,IAEoBC,GAAY,WAM/B,aAMG,IALDC,EAAwB,uDAAG,GAC3Bte,EAGC,4DAVHue,YAAkC,GAAE,KAEpCC,cAAQ,OACRC,cAAQ,EASN17B,KAAKy7B,SAAe,OAAJxe,QAAI,IAAJA,OAAI,EAAJA,EAAMwe,SACtBz7B,KAAK07B,SAAe,OAAJze,QAAI,IAAJA,OAAI,EAAJA,EAAMye,SACtB17B,KAAKw7B,YAAcpxC,KAAKE,MAAMF,KAAKC,UAAUkxC,GAC/C,CA0HC,OA1HA,2EAED,WAAiBI,GAAiB,4EACM,GACjCP,GADCC,EAAeH,MACY,CAAD,wCACvBU,KAAcD,IAAU,UAIjB,OAAZN,QAAY,IAAZA,IAAAA,EAAcQ,cAAa,gCAEvBR,EAAaQ,cAAcF,GAAU,8CAGvC,IAAIr3C,MACR,yEACD,2CACF,mDAjBA,IAiBA,oEAED,WAAoBu2C,EAA0BjT,GAAkB,4EACb,GACtB,WADrBkU,EAAY,IAAIniB,IAAIkhB,EAAI3M,OAAQtG,IACxBmU,UAA+C,WAAvBD,EAAUC,SAAqB,sBAC7D,IAAIz3C,MAAM,uCAAD,OAC0Bw3C,EAAUC,SAAQ,MAC1D,UAEE/7B,KAAK07B,SAAS,CAAD,qBACV,IAAIp3C,MAAM,iCAAgC,gCAG3C0b,KAAK07B,SAASI,EAAUliB,OAAK,gDACrC,qDAdA,IAcA,oEAED,WAAoBihB,EAA0BjT,GAAkB,gFAIb,GAEtB,WALrBkU,EACJ,WAAYjB,EACR,IAAIlhB,IAAIkhB,EAAI1M,OAAQvG,GACpB,IAAIjO,IAAIkhB,EAAIG,OAAOziC,IAAKsiC,EAAIG,OAAOgB,UAE3BD,UAA+C,WAAvBD,EAAUC,SAAqB,sBAC7D,IAAIz3C,MAAM,uCAAD,OAC0Bw3C,EAAUC,SAAQ,MAC1D,uBAEgC,QAFhC,EAEmB/7B,KAAKy7B,gBAAQ,aAAb,OAAAz7B,KAAgB87B,EAAUliB,MAAK,OAAzC,GAAN3O,EAAM,OAIA,CAAD,qBACH,IAAI3mB,MAAM,8BAAD,OAA+Bw3C,IAAY,gCAErD7wB,GAAM,gDACd,qDArBA,IAqBA,oEAED,WACE4vB,EACAjT,GAAkB,oFAO+B,GAEtB,WAPrBkU,EACJ,QAASjB,EACL,IAAIlhB,IAAIkhB,EAAIn0B,IAAKkhB,GACjB,WAAYiT,EACZ,IAAIlhB,IAAIkhB,EAAI5M,OAAQrG,GACpB,IAAIjO,IAAIkhB,EAAIC,OAAOviC,IAAKsiC,EAAIC,OAAOkB,UAE3BD,UAA+C,WAAvBD,EAAUC,SAAqB,sBAC7D,IAAIz3C,MAAM,uCAAD,OAC0Bw3C,EAAUC,SAAQ,MAC1D,uBAEG/7B,KAAKi8B,WAAWH,EAAUliB,MAAK,OAKQ,GAJvCsiB,EAAarB,EAAIn3C,KACjBy4C,EAAO,uBAAmBD,GAC1Bb,EAAeH,KAEfjwB,EAAUowB,EAAqBc,GAGzB,CAAD,sBACH,IAAI73C,MAAM,iCAAD,OACoB43C,EAAU,aAAKb,EAAae,YAAY14C,KAAI,YAAIy4C,EAAO,kBACzF,iCAEIlxB,GAAM,iDACd,qDAhCA,IAgCA,iEAED,WAAiB4vB,EAAuBjT,GAAkB,gFAEpDlZ,EAAAA,aAAcusB,GAAsBJ,GAAI,gCAC3B76B,KAAKq8B,cAAcxB,EAAKjT,GAAW,OAEA,OAEA,QAAlD3c,EAAM,uBAJA,WACG8vB,GAAsBF,GAAK,CAAD,gCACpB76B,KAAKs8B,cAAczB,EAAKjT,GAAjC,YACGgT,GAAsBC,GAAK,CAAD,iCACpB76B,KAAKu8B,cAAc1B,EAAKjT,GAAjC,WACIlZ,EAAAA,aAAcusB,GAAsBJ,GAAI,uBAC5C,IAAIv2C,MAAM,2DAAD,OAC8C8F,KAAKC,UAC9DwwC,KAEH,cAEK,IAAIv2C,MAAM,oCAAD,OAAqC8F,KAAKC,UAAUwwC,KAAO,iCAErE5vB,EAAOF,SAAO,iDACtB,qDApBA,IAoBA,oCAED,SAAuBznB,GAErBA,EAAOk5C,eAAiB71B,OAAOyV,YAC7BzV,OAAOuO,QAAQvK,EAAAA,GAAWlnB,KAAI,YAA2B,IAAD,eACtD,MAAO,CADiC,KAAQ,KAElD,IAEJ,GAAC,2DAED,4GAA0B,OAAfmkC,EAAU,+BAAG,GAAE,kBACjBtlB,QAAQ3I,IACbqG,KAAKw7B,YAAY/3C,IAAG,yCAAC,WAAM8nB,GAAU,sFACrB,EAAKkxB,WAAWlxB,EAAYqc,GAAW,OAC3C,OAD2C,iBACrDrc,EAAU,mBADVN,OAAO,EAAD,GACNM,WAAU,kDACV,mDAHkB,MAIrB,gDACF,kDATA,MASA,EA1I8B,G,YClFjC,SAASmxB,GAAgB76C,EAAgB86C,GACvC,GAAsB,kBAAX96C,EACT,cAAkB8kB,OAAOtF,KAAKxf,GAAO,eAAE,CAAlC,IAAMwH,EAAG,KACe,kBAAhBxH,EAAOwH,GAChBqzC,GAAgB76C,EAAOwH,GAAMszC,GACZ,QAARtzC,IACTxH,EAAOm6C,QAAUW,EAAK/iB,KAE1B,CAEJ,CAGA,SAASgjB,GAAS,EAEhBtR,EACAuP,GACC,IAAD,IAHEziC,cAIF,YAJe,MAAG,CAAC,EAAC,GAICkzB,IAASuP,CAChC,CAAC,SAEcgC,KAAY,8CAQ1B,OAR0B,2BAA3B,yGACyB/tB,MAAM,iDAAgD,OAA/D,IAARgI,EAAQ,QACAC,GAAG,CAAD,qBACR,IAAIzyB,MAAM,QAAD,OACLwyB,EAASyE,OAAM,YAAIzE,EAASgmB,WAAU,sBAC/C,gCAEIhmB,EAASE,QAAM,4CACvB,+BAEc+lB,GAAa,GAAD,8CA8B1B,OA9B0B,2BAA3B,WAA4BC,GAAkC,4FACjCH,KAAc,OAAvB,OAAZI,EAAY,yBACXD,EAAeE,OAAM,SAAAzxB,GAC1B,OAAImvB,GAAsBnvB,GACjB7kB,QACLq2C,EAAar0B,QAAQrc,MACnB,SAAA4wC,GAAE,OACAvC,GAAsBnvB,KACpB,QAAS0xB,GAAM,QAAS1xB,GAAKA,EAAE/E,MAAQy2B,EAAGz2B,KACzC,WAAYy2B,GAAM,WAAY1xB,GAAKA,EAAEwiB,SAAWkP,EAAGlP,OAAQ,KAIlE8M,GAAsBtvB,GACjB7kB,QACLq2C,EAAar0B,QAAQrc,MACnB,SAAA4wC,GAAE,OACApC,GAAsBtvB,IAAM,WAAYA,GAAKA,EAAE0iB,SAAWgP,EAAGhP,MAAM,OAIvE8M,GAAsBxvB,IACjB7kB,QACLq2C,EAAar0B,QAAQrc,MACnB,SAAA4wC,GAAE,OAAIlC,GAAsBxvB,IAAMA,EAAEyiB,SAAWiP,EAAGjP,MAAM,IAKhE,KAAE,4CACH,sBAED,IA2WA,GA3WsB7hB,EAAAA,MAAAA,MACb,CACL0O,WAAY1O,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QACxBqB,aAAcrB,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QAC1ByJ,SAAUzJ,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QACtBwO,SAAUxO,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QACtB+wB,IAAK/wB,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QACjB+B,cAAe/B,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QAC3B1oB,SAAU0oB,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,QACtBwB,OAAQxB,EAAAA,MAAAA,MAAYA,EAAAA,MAAAA,UAErB+Q,UAAS,iBAAO,CAEfigB,cAAc,EAEdC,oBAAgB/8C,EAEhBg9C,kBAAkB,EAElB7a,oBAAgBniC,EAEhB8zC,qBAAiB9zC,EAEjBi9C,iBAAaj9C,EACbk9C,eAAgB,GAChB5N,eAAgB,GAChB6N,kBAAcn9C,EACdo9C,iBAAap9C,EACbq9C,IACE77C,OAAO87C,kBACP,IAAI97C,OAAO87C,iBAAiB,sBAC9BC,IACE/7C,OAAO87C,kBACP,IAAI97C,OAAO87C,iBAAiB,sBAC/B,IACAriC,OAAM,SAAAkI,GAAI,MAAK,CACVq6B,sBAAmB,IAAD,EACpB,QAA0B,QAAlB,EAACr6B,EAAKgK,oBAAY,QAAjB,EAAmBipB,WAAW,UACzC,EAEIqH,oBAAiB,IAAD,EAClB,QAA0B,QAAlB,EAACt6B,EAAKgK,oBAAY,QAAjB,EAAmBipB,WAAW,SACzC,EAEIsH,wBACF,QAASv6B,EAAK05B,GAChB,EAEIc,uBAAoB,IAAD,EACrB,QAA0B,QAAlB,EAACx6B,EAAKgK,oBAAY,QAAjB,EAAmBipB,WAAW,YACzC,EAEIwH,oBAAiB,IAAD,EAClB,QAA0B,QAAlB,EAACz6B,EAAKgK,oBAAY,QAAjB,EAAmBipB,WAAW,SACzC,EAEIyH,qBAAkB,IAAD,EACnB,QAA0B,QAAlB,EAAC16B,EAAKgK,oBAAY,QAAjB,EAAmBipB,WAAW,UACzC,EAEI0H,YACF,OAAOz3C,QAAQoZ,KAAKs+B,kBAAoB56B,EAAKi6B,YAC/C,EAEI96C,YACF,OAAO6gB,EAAKi6B,aAAej6B,EAAKg6B,YAClC,EAEIY,sBACF,OAAO13C,QACL8c,EAAKg6B,cACHh6B,EAAK2wB,iBACL3wB,EAAK25B,cACL35B,EAAK85B,YAEX,EACIe,qBACF,OAAO33C,QAAQ8c,EAAKi6B,aAAej6B,EAAKgf,eAC1C,EAEI8b,0BACF,OAAO96B,EAAK0K,cAAgBhkB,KAAKE,MAAMoZ,EAAK0K,eAAiB,EAC/D,EACD,IACAmQ,SAAQ,SAAA7a,GAAI,MAAK,CAEhB+6B,gBAAe,SAACp9C,GACdqiB,EAAKgK,aAAersB,CACtB,EACAq9C,eAAc,SAAC77C,GACb6gB,EAAKi6B,YAAc96C,CACrB,EACA87C,gBAAe,SAAC97C,GACd6gB,EAAKg6B,aAAe76C,CACtB,EACA+7C,kBAAiB,SAACh2B,GAChBlF,EAAK+5B,eAAiB70B,CACxB,EACAi2B,kBAAiB,SAACj2B,GAChBlF,EAAKmsB,eAAiBjnB,CACxB,EACAk2B,kBAAiB,SAACvlB,GAChB7V,EAAKgf,eAAiBnJ,CACxB,EAEAwlB,gBAAe,SAAClH,GACdn0B,EAAK25B,aAAexF,CACtB,EACAmH,kBAAiB,SAAC/hB,GAKhBvZ,EAAK45B,eAAiBrgB,CACxB,EACAgiB,0BAAyB,SAAC1lB,GACxB7V,EAAK2wB,gBAAkB9a,CACzB,EACD,IACAgF,SAAQ,SAAA7a,GAAI,MAAK,CACVm5B,aAAY,SAACh7C,GAA0C,OAAD,kHAKb,OALa,UAElDq9C,EAAe,IAAI5D,GAAaz5C,EAAO+mB,QAAS,CACpD6yB,SAAU,SAAA/0B,GAAG,OAAIy4B,OAAgCz4B,EAAI,KAE1C04B,uBAAuBr9C,QAAO,SACdm9C,EAAat0B,KAAK7oB,OAAOC,SAAS43B,MAAK,OAA9D6jB,EAAc,OACpB/5B,EAAKk7B,mBAAkB,OAAInB,IAAgB,gDAE3ChxB,QAAQ5pB,MAAM,EAAD,IACb6gB,EAAKg7B,eAAe,EAAD,IAAG,wDAVkC,EAY5D,EACMW,oBAAmB,SAAC9lB,GAAgD,OAAD,kHAK1B,OAL0B,UAE/D2lB,EAAe,IAAI5D,GAAa/hB,EAAKsW,gBAAkB,GAAI,CAC/D4L,SAAU,SAAA/0B,GAAG,OAAIy4B,OAAgCz4B,EAAI,KAE1C04B,uBAAuBr9C,QAAO,SACrBm9C,EAAat0B,KAAK7oB,OAAOC,SAAS43B,MAAK,OAAvDhR,EAAO,OACblF,EAAKm7B,mBAAkB,OAAIj2B,IAAS,gDAEpC6D,QAAQ5pB,MAAM,EAAD,IACb6gB,EAAKg7B,eAAe,EAAD,IAAG,wDAV+C,EAYzE,EAGMY,mBAAkB,SACtB/lB,EACAgmB,GACC,IAAD,gIAE6B,OAF7B,WAEkChmB,EAAxBsW,eAAAA,OAAc,MAAG,GAAE,WACSkN,GAAalN,GAAe,OAArC,aACE0P,EAAwB,iCAC7C,EAAKF,oBAAoB9lB,GAAK,OACpC7V,EAAKu7B,0BAA0B1lB,GAAK,wBAEpC7V,EAAKs7B,kBAAkB,CACrBzlB,KAAAA,EACAie,OAAQ,UACRgI,OAAQ3P,IACR,0DAGJpjB,QAAQ5pB,MAAM,EAAD,IACb6gB,EAAKg7B,eAAe,EAAD,IAAG,yDAhBxB,EAkBF,EAEMe,YAAW,WAAI,IAAD,wIACgB,OADhB,EACqB/7B,EAA/BqX,WAAAA,OAAU,MAAG,cAAa,YACf2kB,EAAAA,GAAAA,cAAa,CAC9BnnC,IAAKwiB,EACLuR,aAAc,gBACbqT,SAAS,QAAO,OAKnB,GARMphC,EAAI,OAIJ1c,EAASuI,KAAKE,MAAMiU,GACpBqhC,EAAY,IAAIjmB,IAAIoB,EAAYh5B,OAAOC,SAAS43B,MACtD8iB,GAAgB76C,EAAQ+9C,GAGpBA,EAAUC,WAAa99C,OAAOC,SAAS69C,SAAQ,iBACP,OAApCC,EAAgBj+C,EAAO+mB,SAAW,GAAE,UACPm0B,GAAa+C,GAAc,QAApC,UACA,CAAD,yCAChBp8B,EAAKs7B,kBAAkB,CAC5BzlB,KAAM13B,EACN21C,OAAQ,SACRgI,OAAQM,KACR,yBAGA,EAAKjD,aAAah7C,GAAO,QAC/B6hB,EAAKo7B,kBAAkBj9C,GAAO,2CAvBZ,EAwBpB,EAEMk+C,2BAA0B,WAAI,IAAD,oIAIjC,GAHMC,EAAalJ,eAAexd,QAAQ,WACpC2mB,EAASv8B,EAAKgK,aAAwB6F,QAAQ,SAAU,KAG1DysB,EAAW,CAAD,eAC4C,GAAlDE,EAAc91C,KAAKE,MAAM01C,GAAY3+C,SAAW,CAAC,EACnD4+C,IAAUC,EAAYt1C,GAAE,yCACnB,EAAK00C,mBAAmBY,IAAY,WAI3Cx8B,EAAKk6B,IAAI,CAAD,gBACiB,OAA3Bl6B,EAAKk6B,IAAI5W,YAAYiZ,GAAM,mBAEJ,IAAI39B,SACvB,SAACC,EAAS0B,GACJP,EAAKo6B,MACPp6B,EAAKo6B,IAAIqC,UAAY,SAAAC,GACnB79B,EAAQ69B,EAAI5pB,KACd,GAEFlnB,YAAW,kBAAM2U,GAAQ,GAAE,IAC7B,IACD,QATW,OAANc,EAAM,yBAUL,EAAKu6B,oBAAmB,kBAAKv6B,GAAM,IAAEna,GAAI07B,UAAY,gDAM1D,IAAIhiC,MAAM,mCAAkC,yDA/BjB,EAgCnC,EAEM+7C,mBAAkB,WAAI,IAAD,gIAC6B,MAAnC,oCAAmC,SACvBppB,GAAsB,GAAD,OAC/C2lB,GAASl5B,EAAKgf,eAAgB,WAFhB,qCAEuC,QACxDhf,EAAKgK,cAAgB,GACrBhK,EAAKoS,UAAY,IAClB,OAEmB,OANdwqB,EAAgB,YAMNl2C,KAAI,SAAaipB,GAAeitB,GAAiB,OAAvC,OAAuC,YAA3Dj/C,EAAO,KAAQiJ,MAAK,0BACpB,EAAKg1C,oBAAmB,kBAAKj+C,GAAO,IAAEuJ,GAAI07B,SAAY,2CATnC,EAU3B,EAEMia,wBAAuB,WAAI,IAAD,8HACV,OADU,KACdn2C,KAAI,SAEZipB,GAAe3P,EAAKgK,aAAa6F,QAAQ,WAAY,KAAI,OAFvC,OAEuC,YAF3DlyB,EAAO,KAAQiJ,MAAK,yBAIpB,EAAKg1C,oBAAmB,kBAAKj+C,GAAO,IAAEuJ,GAAI07B,SAAY,0CAL9B,EAMhC,EAEAka,kBAAiB,WACV98B,EAAKgK,eAGVhK,EAAK85B,YAAcpzC,KAAKE,MAAMoZ,EAAKgK,aAAa6F,QAAQ,QAAS,KACnE,EAEAktB,sBAAqB,WACnB,IAAQrD,EAA8D15B,EAA9D05B,IAAKvvB,EAAyDnK,EAAzDmK,OAAQlqB,EAAiD+f,EAAjD/f,SAA+ByqB,EAAkB1K,EAAvC86B,oBAC3BpB,IACF15B,EAAK85B,YAAc,CACjBpvB,cAAAA,EACA5S,MAAO,CACL,CACEvV,KAAM,mBACN4nB,OAAc,OAANA,QAAM,IAANA,OAAM,EAANA,EAAQQ,MAAM,KACtBD,cAAAA,EACAgvB,IAAAA,EACAz5C,SAAAA,KAKV,EAEM+8C,qBAAoB,WAAI,IAAD,8HAEuC,OAA5Dr/C,EAAU+I,KAAKE,MAAMoZ,EAAKgK,aAAa6F,QAAQ,QAAS,KAAI,SAC5D,EAAK+rB,oBAAmB,kBAAKj+C,EAAQA,SAAO,IAAEuJ,GAAI07B,SAAY,0CAHzC,EAI7B,EAEMoG,YAAW,WAAI,IAAD,gIAClB,IAGU3R,EAAerX,EAAfqX,YACF6d,EAAe7qB,aAAauL,QAAQ,YAAD,OAAayB,MAEpDhN,aAAaoK,QAAQ,oBAAD,OAAqB4C,GAAc6d,EAI3D,CAFE,MAAOvoC,GACPoc,QAAQ5pB,MAAM,oCAAqCwN,EACrD,CAAC,yBAIO,EAAKovC,cAAa,8BAGF,OAHE,yBAExBhzB,QAAQ5pB,MAAM,EAAD,IACb6gB,EAAKg7B,eAAe,EAAD,IAAG,4BAIxB1d,EAAAA,EAAAA,aACEtd,GACAkzB,EAAAA,GAAAA,UAAO,uBAAC,qGAUY,GAVZ,SAGFwH,EAQE16B,EARF06B,eACAF,EAOEx6B,EAPFw6B,iBACAF,EAMEt6B,EANFs6B,cACAD,EAKEr6B,EALFq6B,gBACAI,EAIEz6B,EAJFy6B,cACAF,EAGEv6B,EAHFu6B,kBACAvwB,EAEEhK,EAFFgK,aAEEhK,EADFgf,eAEkB,CAAD,gDAalB,GATGhf,EAAKk6B,MACPl6B,EAAKk6B,IAAIuC,UAAY,SAAAC,GACnB,IAAM/hB,EACJj0B,KAAKE,MAAMwsC,eAAexd,QAAQ,YAAc,MAC7Cj4B,SAAW,CAAC,EACbg9B,EAAEzzB,KAAOw1C,EAAI5pB,MAAQ9S,EAAKo6B,KAC5Bp6B,EAAKo6B,IAAI9W,YAAY3I,EAEzB,IAGE0f,EAAgB,CAAD,gCACX,EAAKsC,qBAAoB,mCACtBrC,EAAc,CAAD,gBACtB,EAAKwC,oBAAmB,4BACfvC,EAAkB,CAAD,gBAC1B,EAAKwC,wBAAuB,4BACnBvC,EAAiB,CAAD,iCACnB,EAAKqC,0BAAyB,oCAC3BpC,EAAc,CAAD,iCAChB,EAAKuC,uBAAsB,oCACxBtC,EAAe,CAAD,iCACjB,EAAK2B,6BAA4B,oCAC9BryB,EAAa,CAAD,sBAEf,IAAIppB,MAAM,+BAA8B,QAG9Cof,EAAKq7B,iBAAgB,GAAK,0DAG5BtyB,QAAQ5pB,MAAM,EAAD,IACb6gB,EAAKi7B,gBAAgB,EAAD,IAAG,4DAG5B,wDA3EiB,EA4EpB,EACD,I,kBC1ZGgC,IAAuB3wB,EAAAA,EAAAA,OAAK,kBAAM,+BAAgC,IAClE4wB,IAAsB5wB,EAAAA,EAAAA,OAAK,kBAAM,+BAA+B,IAChElV,IAAekV,EAAAA,EAAAA,OAAK,kBAAM,uCAAuC,IACjE6wB,IAAc7wB,EAAAA,EAAAA,OAAK,kBAAM,wDAAuB,IAEtD,SAAS8wB,KAgBP,OACE,6BACE,uKAICC,EAAAA,eACC,mCACE,uDACA,yBAxBM,CACZ,CAAC,+BAAgC,sBACjC,CAAC,wBAAyB,eAC1B,CAAC,6BAA8B,qBAC/B,CAAC,+BAAgC,cACjC,CAAC,mCAAoC,cACrC,CAAC,gCAAiC,uBAClC,CAAC,4CAA6C,uBAC9C,CAAC,sCAAuC,iBACxC,CAAC,qCAAsC,gBACvC,CAAC,iCAAkC,YACnC,CAAC,iCAAkC,YACnC,CAAC,sCAAuC,iBACxC,CAAC,6BAA8B,qBAYhBt9C,KAAI,YAAmB,IAAD,eAAhBu9C,EAAI,KAAEt9C,EAAI,KACrB,EAAyB3B,OAAOC,SAAxB43B,EAAI,EAAJA,KAAM33B,EAAM,EAANA,OACd,EAA4B0kB,OAAOyV,YACjC,IAAIt6B,gBAAgBG,IADH49B,GAAL,EAANh+B,QAAe,cAGjBqH,EAAO0wB,EAAKvL,MAAM,KAAK,GACvBwL,EAAS,IAAI/3B,gBACjB6kB,OAAOuO,SAAQ,kBACV2K,GAAI,IACPh+B,OAAQm/C,MAGZ,OACE,0BACE,eAAGpnB,KAAI,UAAK1wB,EAAI,YAAI2wB,GAAS,SAAEn2B,KADxBA,EAIb,UAIJ,mCACE,sDACA,0BACE,0BACE,eAAGk2B,KAAK,uCAAsC,yCAS5D,CAEO,SAASqnB,GAAO,GAInB,IAAD,IAHDlyB,iBAAAA,OAAgB,MAAG7O,KAAKC,MAAK,EAMvByK,EAAO,SAACs2B,GAAgC,OAClC,OAAVA,OAAiB3gD,EAAY2gD,CAAK,EAE9BC,EAAMvmB,EAAAA,YAEZ,GAAiBD,EAAAA,EAAAA,eAAc,SAAUwmB,GAAlCt/C,GAAsC,YAAhC,GACb,GAAkB84B,EAAAA,EAAAA,eAAc,UAAWwmB,GAApC9/C,GAAwC,YAAjC,GACd,GAAmBs5B,EAAAA,EAAAA,eAAc,WAAYwmB,GAAtCtmB,GAA0C,YAAlC,GACf,GAAgCF,EAAAA,EAAAA,eAAc,WAAYwmB,GAAI,eAAvDrrB,EAAQ,KAAEsrB,EAAW,KAC5B,GAAsBzmB,EAAAA,EAAAA,eAAc,MAAOwmB,GAAI,eAAxC/D,EAAG,KAAEiE,EAAM,KAClB,GAA0C1mB,EAAAA,EAAAA,eAAc,gBAAiBwmB,GAAI,eAAtE/yB,EAAa,KAAEkzB,EAAgB,KACtC,GAAgC3mB,EAAAA,EAAAA,eAAc,WAAYwmB,GAAI,eAAvDx9C,EAAQ,KAAE49C,EAAW,KAC5B,GAA4B5mB,EAAAA,EAAAA,eAAc,SAAUwmB,GAAI,eAAjDtzB,EAAM,KAAE2zB,EAAS,KAElBC,EAASC,GAAAA,OAAqB,CAClC3mB,WAAYnQ,EAAK/oB,GACjB6rB,aAAc9C,EAAKvpB,GACnBy0B,SAAUlL,EAAKkL,GACf+E,SAAUjQ,EAAKiQ,GACfuiB,IAAKxyB,EAAKwyB,GACVz5C,SAAUinB,EAAKjnB,GACfkqB,OAAQjD,EAAKiD,GACbO,cAAexD,EAAKwD,KAWtB,OARAxrB,EAAAA,EAAAA,YAAU,WACRy+C,OAAO9gD,GACPihD,OAAUjhD,GACVghD,OAAYhhD,GACZ6gD,OAAY7gD,GACZ+gD,OAAiB/gD,EACnB,GAAG,CAACghD,EAAaF,EAAQG,EAAWJ,EAAaE,KAG/C,UAACK,GAAQ,CACPF,OAAQA,EACR1yB,iBAAkBA,EAClBa,oBAAqBvuB,GAG3B,CAEA,IAAMugD,GAAiB,SAAH,GAMb,IALLH,EAAM,EAANA,OACAjlC,EAAW,EAAXA,YAKA,OACE,UAAC,EAAAzB,SAAQ,CAACC,UAAU,oBAAQ,UAC1B,UAAC2lC,GAAoB,CACnBkB,WAAS,uBAAE,yFAGT,OAFMxgD,EAAU+I,KAAKE,MAAMF,KAAKC,UAAUo3C,EAAOnE,eAAe/jB,OAEhE,SACMkoB,EAAOnC,oBAAmB,kBAAKj+C,GAAO,IAAEuJ,GAAI07B,SAAa,GAAK,OACpE9pB,IAAa,2CAEfslC,SAAU,WACRL,EAAO1C,iBAAgB,GACvBviC,GACF,EACAgjC,OAAQiC,EAAOnE,eAAekC,UAItC,EAEMuC,GAA0B,SAAH,GAAuC,IAAjCl/C,EAAK,EAALA,MACjC,OACE,mCACE,UAACi+C,GAAe,IACf,UAAGj+C,GAAQgH,MAAM,kCAChB,kBACE9C,MAAO,CACLgD,OAAQ,EACRpC,QAAS,EACTwC,OAAQ,kBACRD,WAAY,QACZ,6FAGQ,KACV,eAAG0vB,KAAK,+CAA8C,+BAElD,QAIN,UAAC,EAAA7e,SAAQ,CAACC,UAAU,UAAC,EAAAC,gBAAe,IAAI,UACtC,UAACH,GAAY,CAACjY,MAAOA,QAK/B,EAEA,SAASm/C,GAAc,GAMnB,IALFP,EAAM,EAANA,OACAjlC,EAAW,EAAXA,YAKA,OACE,UAAC,EAAAzB,SAAQ,CAACC,UAAU,oBAAQ,UAC1B,UAAC4lC,GAAmB,CAClBiB,WAAS,uBAAE,yFAC6D,OAAhExgD,EAAU+I,KAAKE,MAAMF,KAAKC,UAAUo3C,EAAOnE,eAAe/jB,OAAM,SAChEkoB,EAAO5E,aAAax7C,GAAQ,OAClCogD,EAAO3C,mBAAkB,kBAAKz9C,GAAO,IAAEuJ,GAAI07B,SAC3C9pB,IAAa,2CAEfslC,SAAU,WACRnH,KACAn+B,GACF,EACAgjC,OAAQiC,EAAOnE,eAAekC,UAItC,CAEA,IAAMmC,IAAWvgD,EAAAA,EAAAA,WACf,YAQO,IAPLqgD,EAAM,EAANA,OACA1yB,EAAgB,EAAhBA,iBACAa,EAAmB,EAAnBA,oBAMQ8tB,EAAuD+D,EAAvD/D,aAAcC,EAAyC8D,EAAzC9D,YAAaU,EAA4BoD,EAA5BpD,MAAOd,EAAqBkE,EAArBlE,iBAC1C,GAA+Bh7C,EAAAA,EAAAA,YAAyB,eAAjDu6B,EAAE,KAAEmlB,EAAgB,KAC3B,GAA0B1/C,EAAAA,EAAAA,YAAmB,eAAtCM,EAAK,KAAEq2B,EAAQ,MAGtBt2B,EAAAA,EAAAA,YAAU,WACR,IACE,IACE66C,EAOEgE,EAPFhE,eACA5N,EAME4R,EANF5R,eACAhV,EAKE4mB,EALF5mB,SACA6H,EAIE+e,EAJF/e,eACA2R,EAGEoN,EAHFpN,gBACAtZ,EAEE0mB,EAFF1mB,WACAyiB,EACEiE,EADFjE,YAGF,GAAIa,EAAO,CAIT,IAAM5kC,EAAgB,IAAIiP,EAAc,GAAD,eAClCw5B,GAAAA,KAAgB,SAAAC,GAAC,MAAK,CACvBl3B,OAAQ,IAAIk3B,EACZh3B,SAAU,CAAEC,QAAQ,GACrB,MAAE,OACAqyB,EAAeh6C,KAAI,gBAAW0+C,EAAC,EAATl3B,OAAWM,EAAU,EAAVA,WAAU,MAAQ,CACpDN,OAAQ,IAAIk3B,EACZ52B,WAAAA,EACAJ,SAAU,CAAEzE,IAAK6E,EAAW7E,KAC7B,MAAE,OACAmpB,EAAepsC,KAAI,gBAAW0+C,EAAC,EAATl3B,OAAWM,EAAU,EAAVA,WAAU,MAAQ,CACpDN,OAAQ,IAAIk3B,EACZ52B,WAAAA,EACAJ,SAAU,CAAEzE,IAAK6E,EAAW7E,KAC7B,OAEHjN,EAAc2oC,0BACd,IAAMtM,EAAYuM,GAAwB5oC,IAAiBohB,GAE3D,GAAI6H,EAAgB,CAAC,IAAD,IACZp3B,EAAYwqC,EAAU8B,OAC1B,CACEhqB,QAAS8U,EACTzU,QAASq0B,GACTvnB,WAAAA,GAEF,CAAEthB,cAAAA,IAGJ,GAAmB,OAAdipB,QAAc,IAAdA,GAA6B,QAAf,EAAdA,EAAgBtqB,qBAAa,OAAK,QAAL,EAA7B,EAA+BwzB,WAAG,QAAlC,EAAoC1J,cACvB52B,EAAUsiB,QAAQxV,cAA1BwzB,IACJ1J,cAAc9hC,IAAI,sBAGxB,IAAImiD,EAAqB,WAAO,EAKhC,IAAK,IAAD,IACE7E,GACFpyC,EAAUopC,oBAEVppC,EAAUjK,QAAS+X,OAAO,0BAAD,OACGskC,EAAY,sNAK/BrJ,IAAoBkJ,EAC7BjyC,EAAUupC,WAAWR,GACZmJ,EACT+E,EDgJT,SAAyB,EAQ9B9oC,GACC,IAPC+B,EAAK,EAALA,MAAM,EAAD,EACL4S,cAAAA,OAAa,MAAG,GAAE,EAOpB,8BAAO,2FACY,GAAT9iB,EAAcmO,EAAdnO,UACO,CAAD,qBACN,IAAIhH,MAAM,6BAA4B,OASyB,OATzB,SAI5CgH,EAAUupC,WAAW,CACnBnxC,KAAK,eAAD,QAAiB,IAAIwc,MAAO63B,oBAIlC3pB,EAAclG,SAAQ,SAAA8E,GAAK,OAAI1hB,EAAUjK,QAAQ2rC,aAAahgB,EAAM,IAAC,SAE/D1K,QAAQ3I,IACZ6B,EAAM/X,KAAI,SAAA0W,GAAI,OACZV,EAAc+oC,4BAA4B,cAAgBroC,EAAKlU,MAAK,kBAC/DkU,GAAI,IACP9Y,QAASiK,EAAUjK,UACnB,KAEL,yDAEDorB,QAAQ5pB,MAAM,EAAD,IACI,QAAjB,EAAAyI,EAAUjK,eAAO,OAAjB,EAAmB+X,OAAO,GAAD,cAAQ,yDAGvC,CCrLqCqpC,CAAgBjF,EAAa/jC,GACT,QAApC,EAAInO,EAAUsiB,QAAQ6e,sBAAc,OAAO,QAAP,EAAhC,EAAkCjxB,aAAK,OAAvC,EAAyC1Y,QAClDwI,EAAUopC,mBAgBd,CAdE,MAAOrkC,GAAI,IAAD,EACV/E,EAAUopC,oBACV,IACMgO,EADG,UAAMryC,GAEZkjB,QAAQ,qBAAsB,IAC9BA,QAAQ,OAAQ,IACF,QAAjB,EAAAjoB,EAAUjK,eAAO,OAAjB,EAAmB+X,OAAO,gCAAD,OAErBspC,EAAa5/C,OAAS,IAAI,UACnB4/C,EAAa94C,MAAM,EAAG,KAAK,0BAC9B84C,IAGRj2B,QAAQ5pB,MAAMwN,EAChB,CAGAsf,EAAYrkB,EAAWyjB,EAAkBa,GAEzCnW,EAAckpC,aAAar3C,GAC3BmO,EAAcmS,YACdq2B,EAAiBxoC,GACjB8oC,GACF,CACF,CAIF,CAHE,MAAOlyC,GACP6oB,EAAS7oB,GACToc,QAAQ5pB,MAAMwN,EAChB,CACF,GAAG,CACDoxC,EACAlE,EACAc,EACAX,EACA3uB,EACAa,IAGF,IAmBQ,EAnBFjI,EAAMg2B,GAAe96C,EAE3B,OAAI8kB,GACK,UAACo6B,GAAuB,CAACl/C,MAAO8kB,IAGrC85B,EAAOnE,eAC+B,YAAjCmE,EAAOnE,eAAe9F,QAC3B,UAACoK,GAAc,CACbH,OAAQA,EACRjlC,YAAa,kBAAMilC,EAAOzC,uBAAkBz+C,EAAU,KAGxD,UAACyhD,GAAa,CACZP,OAAQA,EACRjlC,YAAa,kBAAMilC,EAAOzC,uBAAkBz+C,EAAU,IAIxDu8B,EACkB,QAAb,EAACA,EAAGxxB,iBAAS,OAAZ,EAAcjK,SAKpB,UAAC,GAAO,CAACoY,cAAeqjB,KAJxB,UAAC,EAAA/hB,SAAQ,CAACC,UAAU,UAAC,EAAAC,gBAAe,IAAI,UACtC,UAAC4lC,GAAW,CAACv1C,UAAWwxB,EAAGxxB,UAAWb,eAAgBkwC,QAMrD,UAACiI,EAAA,EAAO,GACjB,IAGIC,GAAmC,SAACz+C,GACxC,OACE,UAAC,EAAA0+C,kBAAgB,QACfC,gBAAgB,gBAChBt4C,eAAgBkwC,IACZv2C,GAGV,EAYA,GAXsB,SAAH,GAA4D,IAAtD2qB,EAAgB,EAAhBA,iBACvB,OAEE,UAAC,EAAAnU,cAAa,CAACC,kBAAmBgoC,GAAiC,UACjE,UAAC,EAAAG,mBAAkB,CAAC9jB,QAAS+jB,EAAAA,EAAqB,UAChD,UAAChC,GAAM,CAAClyB,iBAAkBA,OAIlC,C","sources":["../../../packages/core/rpc/remoteAbortSignals.ts","../../../packages/core/ui/AssemblySelector.tsx","../../../packages/core/ui/CascadingMenu.tsx","../../../packages/core/ui/EditableTypography.tsx","../../../packages/core/ui/ErrorMessage.tsx","../../../packages/core/ui/FactoryResetDialog.tsx","../../../packages/core/ui/FileSelector/FileSelector.tsx","../../../packages/core/ui/FileSelector/index.ts","../../../packages/core/ui/Menu.tsx","../../../packages/core/ui/ResizeHandle.tsx","../../../packages/core/ui/theme.ts","../../../packages/core/ui/Logo.tsx","../../../packages/core/ui/App.tsx","../../../packages/core/ui/ReturnToImportFormDialog.tsx","../../../packages/core/ui/PrerenderedCanvas.tsx","../../../packages/core/ui/Tooltip.tsx","../../../packages/core/ui/SanitizedHTML.tsx","../../../packages/core/util/QuickLRU.js","../../../packages/core/util/aborting.ts","../../../packages/core/util/offscreenCanvasPonyfill.tsx","../../../packages/core/util/offscreenCanvasUtils.tsx","../../../packages/core/util/types/index.ts","../../../packages/core/util/when.ts","../../../packages/core/PluginManager.ts","../../../packages/core/util/analytics.ts","../../../plugins/data-management/src/index.ts","corePlugins.ts","util.ts","sessionSharing.ts","ShareButton.tsx","AdminComponent.tsx","JBrowse.tsx","../../../packages/core/assemblyManager/assembly.ts","../../../packages/core/assemblyManager/assemblyManager.ts","../../../packages/core/assemblyManager/assemblyConfigSchema.ts","../../../packages/core/rpc/baseRpcConfig.ts","../../../packages/core/rpc/webWorkerRpcConfig.ts","../../../packages/core/rpc/mainThreadRpcConfig.ts","../../../packages/core/rpc/configSchema.ts","../../../packages/core/rpc/BaseRpcDriver.ts","../../../packages/core/rpc/WebWorkerRpcDriver.ts","../../../packages/core/rpc/MainThreadRpcDriver.ts","../../../packages/core/rpc/RpcManager.ts","../../../packages/core/TextSearch/TextSearchManager.ts","../../../packages/core/util/TimeTraveller.ts","makeWorkerInstance.ts","jbrowseModel.ts","../../../packages/core/ui/SnackbarModel.ts","sessionModelFactory.ts","rootModel.ts","factoryReset.ts","../../../packages/core/PluginLoader.ts","SessionLoader.ts","Loader.tsx"],"sourcesContent":["/* ---------------- for the RPC client ----------------- */\n\nlet abortSignalCounter = 0\nexport type RemoteAbortSignal = { abortSignalId: number }\nconst abortSignalIds: WeakMap<AbortSignal, number> = new WeakMap() // map of abortsignal => numerical ID\n\n/**\n * assign an ID to the given abort signal and return a plain object representation\n * @param signal - the signal to serialize\n * @param callfunc - function used to call\n *  a remote method, will be called like callfunc('signalAbort', signalId)\n */\nexport function serializeAbortSignal(\n  signal: AbortSignal,\n  callfunc: (name: string, abortSignalId: number) => void,\n): RemoteAbortSignal {\n  let abortSignalId = abortSignalIds.get(signal)\n  if (!abortSignalId) {\n    abortSignalCounter += 1\n    abortSignalIds.set(signal, abortSignalCounter)\n    abortSignalId = abortSignalCounter\n    signal.addEventListener('abort', () => {\n      const signalId = abortSignalIds.get(signal)\n      if (signalId !== undefined) {\n        callfunc('signalAbort', signalId)\n      }\n    })\n  }\n  return { abortSignalId }\n}\n\n/* ---------------- for the RPC server ----------------- */\n\n/**\n * test whether a given object\n * @param thing - the thing to test\n * @returns true if the thing is a remote abort signal\n */\nexport function isRemoteAbortSignal(\n  thing: unknown,\n): thing is RemoteAbortSignal {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'abortSignalId' in thing &&\n    // @ts-ignore\n    typeof thing.abortSignalId === 'number'\n  )\n}\n\n// the server side keeps a set of surrogate abort controllers that can be\n// aborted based on ID\nconst surrogateAbortControllers: Map<number, AbortController> = new Map() // numerical ID => surrogate abort controller\n\n/**\n * deserialize the result of serializeAbortSignal into an AbortSignal\n *\n * @param signal -\n * @returns an abort signal that corresponds to the given ID\n */\nexport function deserializeAbortSignal({\n  abortSignalId,\n}: RemoteAbortSignal): AbortSignal {\n  let surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n  if (!surrogateAbortController) {\n    surrogateAbortController = new AbortController()\n    surrogateAbortControllers.set(abortSignalId, surrogateAbortController)\n  }\n  return surrogateAbortController.signal\n}\n\n/**\n * fire an abort signal from a remote abort signal ID\n *\n * @param abortSignalId -\n */\nexport function remoteAbort(props: { signalId: number }) {\n  const { signalId: abortSignalId } = props\n  const surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n\n  if (surrogateAbortController) {\n    surrogateAbortController.abort()\n  }\n}\n\nexport function remoteAbortRpcHandler() {\n  return {\n    signalAbort: remoteAbort,\n  }\n}\n","import React, { useState, useEffect } from 'react'\nimport { TextField, MenuItem, InputProps as IIP } from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\n// locals\nimport { getConf } from '../configuration'\nimport { useLocalStorage, AbstractSessionModel } from '../util'\n\nconst useStyles = makeStyles()({\n  importFormEntry: {\n    minWidth: 180,\n  },\n})\n\nconst AssemblySelector = observer(\n  ({\n    session,\n    onChange,\n    selected,\n    InputProps,\n    extra = 0,\n  }: {\n    session: AbstractSessionModel\n    onChange: (arg: string) => void\n    selected?: string\n    InputProps?: IIP\n    extra?: unknown\n  }) => {\n    const { classes } = useStyles()\n    const { assemblyNames, assemblyManager } = session\n\n    // constructs a localstorage key based on host/path/config to help\n    // remember. non-config assists usage with e.g. embedded apps\n    const config = new URLSearchParams(window.location.search).get('config')\n    const [lastSelected, setLastSelected] =\n      typeof jest === 'undefined'\n        ? useLocalStorage(\n            `lastAssembly-${[\n              window.location.host + window.location.pathname,\n              config,\n              extra,\n            ].join('-')}`,\n            selected,\n          )\n        : useState(selected)\n\n    const selection = assemblyNames.includes(lastSelected || '')\n      ? lastSelected\n      : selected\n\n    useEffect(() => {\n      if (selection && selection !== selected) {\n        onChange(selection)\n      }\n    }, [selection, onChange, selected])\n\n    const error = assemblyNames.length ? '' : 'No configured assemblies'\n    return (\n      <TextField\n        select\n        label=\"Assembly\"\n        variant=\"outlined\"\n        helperText={error || 'Select assembly to view'}\n        value={selection || ''}\n        inputProps={{ 'data-testid': 'assembly-selector' }}\n        onChange={event => setLastSelected(event.target.value)}\n        error={!!error}\n        InputProps={InputProps}\n        disabled={!!error}\n        className={classes.importFormEntry}\n      >\n        {assemblyNames.map(name => {\n          const assembly = assemblyManager.get(name)\n          const displayName = assembly ? getConf(assembly, 'displayName') : ''\n          return (\n            <MenuItem key={name} value={name}>\n              {displayName || name}\n            </MenuItem>\n          )\n        })}\n      </TextField>\n    )\n  },\n)\n\nexport default AssemblySelector\n","import React, { useContext, useMemo, useCallback } from 'react'\nimport {\n  Divider,\n  ListItemIcon,\n  ListItemText,\n  ListSubheader,\n  Menu,\n  MenuItem,\n  PopoverOrigin,\n} from '@mui/material'\nimport { MenuItem as JBMenuItem, MenuItemEndDecoration } from './Menu'\nimport {\n  bindHover,\n  bindFocus,\n  bindMenu,\n  usePopupState,\n  PopupState,\n} from 'material-ui-popup-state/hooks'\nimport HoverMenu from 'material-ui-popup-state/HoverMenu'\nimport ChevronRight from '@mui/icons-material/ChevronRight'\n\nconst CascadingContext = React.createContext({\n  parentPopupState: null,\n  rootPopupState: null,\n} as { parentPopupState: PopupState | null; rootPopupState: PopupState | null })\n\nfunction CascadingMenuItem({\n  onClick,\n  ...props\n}: {\n  onClick?: Function\n  disabled?: boolean\n  children: React.ReactNode\n}) {\n  const { rootPopupState } = useContext(CascadingContext)\n  if (!rootPopupState) {\n    throw new Error('must be used inside a CascadingMenu')\n  }\n  const handleClick = useCallback(\n    (event: React.MouseEvent) => {\n      rootPopupState.close()\n      onClick?.(event)\n    },\n    [rootPopupState, onClick],\n  )\n\n  return <MenuItem {...props} onClick={handleClick} />\n}\n\nfunction CascadingSubmenu({\n  title,\n  inset,\n  popupId,\n  ...props\n}: {\n  children: React.ReactNode\n  title: string\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n  inset: boolean\n  popupId: string\n}) {\n  const { parentPopupState } = React.useContext(CascadingContext)\n  const popupState = usePopupState({\n    popupId,\n    variant: 'popover',\n    parentPopupState,\n  })\n  return (\n    <>\n      <MenuItem {...bindHover(popupState)} {...bindFocus(popupState)}>\n        <ListItemText primary={title} inset={inset} />\n        <ChevronRight />\n      </MenuItem>\n      <CascadingSubmenuHover\n        {...props}\n        anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'left' }}\n        popupState={popupState}\n      />\n    </>\n  )\n}\n\nfunction CascadingSubmenuHover({\n  popupState,\n  onMenuItemClick,\n  menuItems,\n  classes,\n  ...props\n}: {\n  classes?: Record<string, string>\n  popupState: PopupState\n  anchorOrigin: PopoverOrigin\n  transformOrigin: PopoverOrigin\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n}) {\n  const { rootPopupState } = useContext(CascadingContext)\n  const context = useMemo(\n    () => ({\n      rootPopupState: rootPopupState || popupState,\n      parentPopupState: popupState,\n    }),\n    [rootPopupState, popupState],\n  )\n\n  return (\n    <CascadingContext.Provider value={context}>\n      <HoverMenu {...props} {...bindMenu(popupState)} />\n    </CascadingContext.Provider>\n  )\n}\n\nfunction CascadingMenu({\n  popupState,\n  onMenuItemClick,\n  menuItems,\n  ...props\n}: {\n  popupState: PopupState\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n}) {\n  const { rootPopupState } = React.useContext(CascadingContext)\n  const context = React.useMemo(\n    () => ({\n      rootPopupState: rootPopupState || popupState,\n      parentPopupState: popupState,\n    }),\n    [rootPopupState, popupState],\n  )\n\n  return (\n    <CascadingContext.Provider value={context}>\n      <Menu {...props} {...bindMenu(popupState)} />\n    </CascadingContext.Provider>\n  )\n}\n\nfunction EndDecoration({ item }: { item: JBMenuItem }) {\n  if ('subMenu' in item) {\n    return <MenuItemEndDecoration type=\"subMenu\" />\n  } else if (item.type === 'checkbox' || item.type === 'radio') {\n    return (\n      <MenuItemEndDecoration\n        type={item.type}\n        checked={item.checked}\n        disabled={item.disabled}\n      />\n    )\n  }\n  return null\n}\n\nfunction CascadingMenuList({\n  onMenuItemClick,\n  menuItems,\n  ...props\n}: {\n  menuItems: JBMenuItem[]\n  onMenuItemClick: Function\n}) {\n  function handleClick(callback: Function) {\n    return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n      onMenuItemClick(event, callback)\n    }\n  }\n\n  const hasIcon = menuItems.some(\n    menuItem => 'icon' in menuItem && menuItem.icon,\n  )\n  return (\n    <>\n      {menuItems.map((item, idx) => {\n        return 'subMenu' in item ? (\n          <CascadingSubmenu\n            key={`subMenu-${item.label}-${idx}`}\n            popupId={`subMenu-${item.label}`}\n            title={item.label}\n            inset={hasIcon}\n            onMenuItemClick={onMenuItemClick}\n            menuItems={item.subMenu}\n          >\n            <CascadingMenuList\n              {...props}\n              onMenuItemClick={onMenuItemClick}\n              menuItems={item.subMenu}\n            />\n          </CascadingSubmenu>\n        ) : item.type === 'divider' ? (\n          <Divider key={`divider-${idx}`} component=\"li\" />\n        ) : item.type === 'subHeader' ? (\n          <ListSubheader key={`subHeader-${item.label}-${idx}`}>\n            {item.label}\n          </ListSubheader>\n        ) : (\n          <CascadingMenuItem\n            key={`${item.label}-${idx}`}\n            onClick={'onClick' in item ? handleClick(item.onClick) : undefined}\n            disabled={Boolean(item.disabled)}\n          >\n            {item.icon ? (\n              <ListItemIcon>\n                <item.icon />\n              </ListItemIcon>\n            ) : null}{' '}\n            <ListItemText\n              primary={item.label}\n              secondary={item.subLabel}\n              inset={hasIcon && !item.icon}\n            />\n            <div style={{ flexGrow: 1, minWidth: 10 }} />\n            <EndDecoration item={item} />\n          </CascadingMenuItem>\n        )\n      })}\n    </>\n  )\n}\n\nfunction CascadingMenuChildren(props: {\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n  popupState: PopupState\n}) {\n  return (\n    <CascadingMenu {...props}>\n      <CascadingMenuList {...props} />\n    </CascadingMenu>\n  )\n}\n\nexport default CascadingMenuChildren\n","import React, { useEffect, useState } from 'react'\nimport { InputBase, Typography, TypographyProps, useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n\ntype Variant = TypographyProps['variant']\n\ntype EditableTypographyClassKey =\n  | 'input'\n  | 'inputBase'\n  | 'inputRoot'\n  | 'inputFocused'\n\nconst useStyles = makeStyles()(theme => ({\n  input: {},\n  inputBase: {},\n  typography: {\n    top: 6,\n    left: 2,\n    position: 'absolute',\n    whiteSpace: 'nowrap',\n    visibility: 'hidden',\n  },\n  inputRoot: {\n    padding: theme.spacing(0.5),\n  },\n  inputFocused: {\n    borderStyle: 'solid',\n    borderWidth: 2,\n  },\n}))\n\ninterface Props {\n  value: string\n  setValue: (value: string) => void\n  variant: Variant\n  classes?: Partial<Record<EditableTypographyClassKey, string>>\n}\n\n// using forwardRef so that MUI Tooltip can wrap this component\nconst EditableTypography = React.forwardRef<HTMLDivElement, Props>(\n  (props, ref) => {\n    const { value, setValue, variant, ...other } = props\n    const [editedValue, setEditedValue] = useState<string>()\n    const [sizerNode, setSizerNode] = useState<HTMLSpanElement | null>(null)\n    const [inputNode, setInputNode] = useState<HTMLInputElement | null>(null)\n    const [blur, setBlur] = useState(false)\n\n    useEffect(() => {\n      if (blur) {\n        inputNode?.blur()\n        setBlur(false)\n      }\n    }, [blur, inputNode])\n\n    // possibly tss-react does not understand the passing of props to\n    // useStyles, but it appears to work\n    // @ts-ignore\n    const { classes } = useStyles(props, { props })\n    const theme = useTheme()\n\n    const clientWidth = sizerNode?.clientWidth\n    const width = clientWidth || 0\n\n    const val = editedValue === undefined ? value : editedValue\n\n    return (\n      <div {...other} ref={ref}>\n        <div style={{ position: 'relative' }}>\n          <Typography\n            ref={(node: HTMLSpanElement) => setSizerNode(node)}\n            component=\"span\"\n            variant={variant}\n            className={classes.typography}\n          >\n            {val}\n          </Typography>\n        </div>\n        <InputBase\n          inputRef={node => setInputNode(node)}\n          className={classes.inputBase}\n          inputProps={{\n            style: {\n              width,\n              ...(variant && variant !== 'inherit'\n                ? theme.typography[variant]\n                : {}),\n            },\n          }}\n          classes={{\n            input: classes.input,\n            root: classes.inputRoot,\n            focused: classes.inputFocused,\n          }}\n          value={val}\n          onChange={event => setEditedValue(event.target.value)}\n          onKeyDown={event => {\n            if (event.key === 'Enter') {\n              inputNode?.blur()\n            } else if (event.key === 'Escape') {\n              setEditedValue(undefined)\n              setBlur(true)\n            }\n          }}\n          onBlur={() => {\n            setValue(editedValue || '')\n            setEditedValue(undefined)\n          }}\n        />\n      </div>\n    )\n  },\n)\n\nexport default EditableTypography\n","import React from 'react'\n\nconst ErrorMessage = ({ error }: { error: unknown }) => {\n  let snapshotError = ''\n  let str = `${error}`\n  const findStr = 'is not assignable'\n  const idx = str.indexOf(findStr)\n  if (idx !== -1) {\n    const trim = str.slice(0, idx + findStr.length)\n    // best effort to make a better error message than the default\n    // mobx-state-tree\n\n    // case 1. element has a path\n    const match = trim.match(\n      /.*at path \"(.*)\" snapshot `(.*)` is not assignable/m,\n    )\n    if (match) {\n      str = `Failed to load element at ${match[1]}...Failed element had snapshot`\n      snapshotError = match[2]\n    }\n\n    // case 2. element has no path\n    const match2 = trim.match(/.*snapshot `(.*)` is not assignable/)\n    if (match2) {\n      str = `Failed to load element...Failed element had snapshot`\n      snapshotError = match2[1]\n    }\n  }\n  return (\n    <div\n      style={{\n        padding: 4,\n        margin: 4,\n        overflow: 'auto',\n        maxHeight: 200,\n        background: '#f88',\n        border: '1px solid black',\n      }}\n    >\n      {str.slice(0, 10000)}\n      {snapshotError ? (\n        <pre\n          style={{\n            background: 'lightgrey',\n            border: '1px solid black',\n            margin: 20,\n          }}\n        >\n          {JSON.stringify(JSON.parse(snapshotError), null, 2)}\n        </pre>\n      ) : null}\n    </div>\n  )\n}\n\nexport default ErrorMessage\n","import Button from '@mui/material/Button'\nimport Dialog from '@mui/material/Dialog'\nimport DialogTitle from '@mui/material/DialogTitle'\nimport DialogContent from '@mui/material/DialogContent'\nimport DialogContentText from '@mui/material/DialogContentText'\nimport DialogActions from '@mui/material/DialogActions'\nimport React from 'react'\n\nexport default ({\n  onClose,\n  open,\n  onFactoryReset,\n}: {\n  onClose: Function\n  open: boolean\n  onFactoryReset: Function\n}) => {\n  function handleDialogClose(action?: string) {\n    if (action === 'reset') {\n      onFactoryReset()\n    }\n    onClose()\n  }\n\n  return (\n    <Dialog open={open} onClose={() => handleDialogClose()}>\n      <DialogTitle id=\"alert-dialog-title\">Reset</DialogTitle>\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          Are you sure you want to reset? This will restore the default\n          configuration.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => handleDialogClose()} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => handleDialogClose('reset')}\n          color=\"primary\"\n          variant=\"contained\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Box,\n  FormHelperText,\n  InputLabel,\n  Menu,\n  MenuItem,\n  Tooltip,\n  ToggleButtonGroup,\n  ToggleButton,\n  ToggleButtonProps,\n} from '@mui/material'\n\n// locals\nimport {\n  FileLocation,\n  UriLocation,\n  AbstractRootModel,\n  isUriLocation,\n  isAppRootModel,\n} from '../../util/types'\nimport LocalFileChooser from './LocalFileChooser'\nimport UrlChooser from './UrlChooser'\n\n// icons\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown'\n\nfunction ToggleButtonWithTooltip(props: ToggleButtonProps) {\n  const { title, children, ...other } = props\n  return (\n    <Tooltip title={title || ''}>\n      <ToggleButton {...other}>{children}</ToggleButton>\n    </Tooltip>\n  )\n}\n\nfunction shorten(str: string, len: number) {\n  if (typeof str === 'string' && str.length > len) {\n    return `${str.substring(0, len)}`\n  }\n  return str\n}\n\nconst FileSelector = observer(\n  (props: {\n    location?: FileLocation\n    setLocation: (param: FileLocation) => void\n    setName?: (str: string) => void\n    name?: string\n    description?: string\n    rootModel?: AbstractRootModel\n  }) => {\n    const { location, name, description, rootModel, setLocation } = props\n    const fileOrUrl = !location || isUriLocation(location) ? 'url' : 'file'\n    const [toggleButtonValue, setToggleButtonValue] = useState(\n      location && 'internetAccountId' in location && location.internetAccountId\n        ? location.internetAccountId\n        : fileOrUrl,\n    )\n    const accts = isAppRootModel(rootModel)\n      ? rootModel.internetAccounts.slice()\n      : []\n    const numShown = 2\n    const [shownAccts, setShownAccts] = useState(accts.slice(0, numShown))\n    const [hiddenAccts, setHiddenAccts] = useState(accts.slice(numShown))\n    const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null)\n\n    const selectedAcct = accts.find(\n      ia => ia.internetAccountId === toggleButtonValue,\n    )\n\n    const setLocationWithAccount = (location: UriLocation) => {\n      setLocation({\n        ...location,\n        internetAccountId: selectedAcct\n          ? selectedAcct.internetAccountId\n          : undefined,\n      })\n    }\n\n    // if you swap account selection after inputting url\n    if (\n      location &&\n      selectedAcct &&\n      isUriLocation(location) &&\n      location.internetAccountId !== selectedAcct.internetAccountId\n    ) {\n      setLocationWithAccount(location)\n    }\n\n    let locationInput = (\n      <UrlChooser\n        {...props}\n        setLocation={setLocationWithAccount}\n        label={selectedAcct?.selectorLabel}\n      />\n    )\n    if (toggleButtonValue === 'file') {\n      locationInput = <LocalFileChooser {...props} />\n    }\n    if (selectedAcct?.SelectorComponent) {\n      const { SelectorComponent } = selectedAcct\n      locationInput = (\n        <SelectorComponent {...props} setLocation={setLocationWithAccount} />\n      )\n    }\n\n    return (\n      <>\n        <Box display=\"flex\">\n          <InputLabel shrink>{name}</InputLabel>\n        </Box>\n        <Box display=\"flex\" flexDirection=\"row\">\n          <Box>\n            <ToggleButtonGroup\n              value={toggleButtonValue}\n              exclusive\n              onChange={(_event, newState) => {\n                if (newState) {\n                  setToggleButtonValue(newState)\n                }\n                if (isUriLocation(location)) {\n                  setLocationWithAccount(location)\n                }\n              }}\n              aria-label=\"file, url, or account picker\"\n            >\n              {new URLSearchParams(window.location.search).get(\n                'adminKey',\n              ) ? null : (\n                <ToggleButton value=\"file\" aria-label=\"local file\">\n                  File\n                </ToggleButton>\n              )}\n              <ToggleButton value=\"url\" aria-label=\"url\">\n                URL\n              </ToggleButton>\n              {shownAccts.map(({ internetAccountId, toggleContents, name }) => (\n                <ToggleButtonWithTooltip\n                  key={internetAccountId}\n                  value={internetAccountId}\n                  aria-label={name}\n                  title={name}\n                >\n                  {typeof toggleContents === 'string'\n                    ? shorten(toggleContents, 5)\n                    : toggleContents || shorten(name, 5)}\n                </ToggleButtonWithTooltip>\n              ))}\n              {hiddenAccts.length ? (\n                // @ts-ignore\n                <ToggleButton\n                  onClick={event => setAnchorEl(event.target as HTMLElement)}\n                  selected={false}\n                >\n                  More\n                  <ArrowDropDownIcon />\n                </ToggleButton>\n              ) : null}\n            </ToggleButtonGroup>\n\n            <Menu\n              open={Boolean(anchorEl)}\n              anchorEl={anchorEl}\n              onClose={() => setAnchorEl(null)}\n              anchorOrigin={{\n                vertical: 'bottom',\n                horizontal: 'center',\n              }}\n              transformOrigin={{\n                vertical: 'top',\n                horizontal: 'center',\n              }}\n            >\n              {hiddenAccts?.map((acct, idx) => (\n                <MenuItem\n                  key={acct.internetAccountId}\n                  value={acct.internetAccountId}\n                  onClick={() => {\n                    const prev = shownAccts[shownAccts.length - 1]\n                    setShownAccts([\n                      ...shownAccts.slice(0, shownAccts.length - 1),\n                      acct,\n                    ])\n                    setHiddenAccts([\n                      prev,\n                      ...hiddenAccts.slice(0, idx),\n                      ...hiddenAccts.slice(idx + 1),\n                    ])\n                    setToggleButtonValue(acct.internetAccountId)\n                    setAnchorEl(null)\n                  }}\n                >\n                  {acct.name}\n                </MenuItem>\n              ))}\n            </Menu>\n          </Box>\n        </Box>\n        {locationInput}\n        <FormHelperText>{description}</FormHelperText>\n      </>\n    )\n  },\n)\n\nexport default FileSelector\n","import FileSelector from './FileSelector'\n\nexport default FileSelector\n","import React, { useEffect, useRef, useState } from 'react'\nimport {\n  Divider,\n  Grow,\n  ListItemIcon,\n  ListItemText,\n  ListSubheader,\n  MenuProps as MUIMenuProps,\n  MenuItem as MUIMenuItem,\n  MenuItemProps,\n  MenuList,\n  Paper,\n  Popover,\n  PopoverProps,\n  SvgIconProps,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n// icons\nimport ArrowRightIcon from '@mui/icons-material/ArrowRight'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport RadioButtonCheckedIcon from '@mui/icons-material/RadioButtonChecked'\nimport RadioButtonUncheckedIcon from '@mui/icons-material/RadioButtonUnchecked'\n\n// other\nimport { findLastIndex } from '../util'\n\nconst useStyles = makeStyles()({\n  paper: {\n    position: 'fixed',\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    // So we see the popover when it's empty.\n    minWidth: 16,\n    minHeight: 16,\n    maxWidth: 'calc(100% - 32px)',\n    maxHeight: 'calc(100% - 32px)',\n    top: 0,\n    left: 0,\n    // We disable the focus ring for mouse, touch and keyboard users.\n    outline: 0,\n  },\n  menuItemEndDecoration: {\n    padding: 0,\n    margin: 0,\n    height: 16,\n  },\n})\n\ninterface MenuItemEndDecorationSubMenuProps {\n  type: 'subMenu'\n}\n\ninterface MenuItemEndDecorationSelectorProps {\n  type: 'checkbox' | 'radio'\n  checked: boolean\n  disabled?: boolean\n}\n\ntype MenuItemEndDecorationProps =\n  | MenuItemEndDecorationSubMenuProps\n  | MenuItemEndDecorationSelectorProps\n\nexport function MenuItemEndDecoration(props: MenuItemEndDecorationProps) {\n  const { classes } = useStyles()\n  const { type } = props\n  let checked\n  let disabled\n  if ('checked' in props) {\n    ;({ checked, disabled } = props)\n  }\n  let icon\n  if (type === 'subMenu') {\n    icon = <ArrowRightIcon color=\"action\" />\n  } else if (type === 'checkbox') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <CheckBoxIcon color={color} />\n    } else {\n      icon = <CheckBoxOutlineBlankIcon color=\"action\" />\n    }\n  } else if (type === 'radio') {\n    if (checked) {\n      const color = disabled ? 'inherit' : 'secondary'\n      icon = <RadioButtonCheckedIcon color={color} />\n    } else {\n      icon = <RadioButtonUncheckedIcon color=\"action\" />\n    }\n  }\n  return <div className={classes.menuItemEndDecoration}>{icon}</div>\n}\n\nexport interface MenuDivider {\n  priority?: number\n  type: 'divider'\n}\n\nexport interface MenuSubHeader {\n  type: 'subHeader'\n  priority?: number\n  label: string\n}\n\nexport interface BaseMenuItem {\n  label: string\n  priority?: number\n  subLabel?: string\n  icon?: React.ComponentType<SvgIconProps>\n  disabled?: boolean\n}\n\nexport interface NormalMenuItem extends BaseMenuItem {\n  type?: 'normal'\n  onClick: Function\n}\n\nexport interface CheckboxMenuItem extends BaseMenuItem {\n  type: 'checkbox'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface RadioMenuItem extends BaseMenuItem {\n  type: 'radio'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface SubMenuItem extends BaseMenuItem {\n  type?: 'subMenu'\n  subMenu: MenuItem[]\n}\n\nexport type MenuItem =\n  | MenuDivider\n  | MenuSubHeader\n  | NormalMenuItem\n  | CheckboxMenuItem\n  | RadioMenuItem\n  | SubMenuItem\n\ntype AnchorElProp = MUIMenuProps['anchorEl']\ntype OpenProp = MUIMenuProps['open']\ntype OnCloseProp = MUIMenuProps['onClose']\n\ninterface MenuPageProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n  anchorEl?: AnchorElProp\n  open: OpenProp\n  onClose: OnCloseProp\n  top?: boolean\n}\n\ntype MenuItemStyleProp = MenuItemProps['style']\n\nfunction findNextValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  const idx = menuItems\n    .slice(currentIdx + 1)\n    .findIndex(\n      menuItem =>\n        menuItem.type !== 'divider' &&\n        menuItem.type !== 'subHeader' &&\n        !menuItem.disabled,\n    )\n  if (idx === -1) {\n    return idx\n  }\n  return currentIdx + 1 + idx\n}\n\nfunction findPreviousValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  return findLastIndex(\n    menuItems.slice(0, currentIdx),\n    menuItem =>\n      menuItem.type !== 'divider' &&\n      menuItem.type !== 'subHeader' &&\n      !menuItem.disabled,\n  )\n}\n\nconst MenuPage = React.forwardRef<HTMLDivElement, MenuPageProps>(\n  (props, ref) => {\n    const [subMenuAnchorEl, setSubMenuAnchorEl] = useState<HTMLElement>()\n    const [openSubMenuIdx, setOpenSubMenuIdx] = useState<number>()\n    const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n    const [selectedMenuItemIdx, setSelectedMenuItemIdx] = useState<number>()\n    const [position, setPosition] = useState<{\n      top?: number\n      left?: number\n    }>()\n    const paperRef = useRef<HTMLDivElement | null>(null)\n    const { classes } = useStyles()\n\n    const {\n      menuItems,\n      onMenuItemClick,\n      open,\n      onClose,\n      anchorEl,\n      top = false,\n    } = props\n\n    useEffect(() => {\n      if (!open) {\n        setSubMenuAnchorEl(undefined)\n        setOpenSubMenuIdx(undefined)\n      }\n    }, [open])\n\n    useEffect(() => {\n      const shouldSubMenuBeOpen = open && Boolean(subMenuAnchorEl)\n      let timer: ReturnType<typeof setTimeout>\n      if (shouldSubMenuBeOpen && !isSubMenuOpen) {\n        timer = setTimeout(() => {\n          setIsSubMenuOpen(true)\n        }, 300)\n      } else if (!shouldSubMenuBeOpen && isSubMenuOpen) {\n        timer = setTimeout(() => {\n          setIsSubMenuOpen(false)\n        }, 300)\n      }\n      return () => {\n        clearTimeout(timer)\n      }\n    }, [isSubMenuOpen, open, subMenuAnchorEl])\n\n    useEffect(() => {\n      if (anchorEl) {\n        const rect = (anchorEl as HTMLElement).getBoundingClientRect()\n        if (position) {\n          if (\n            rect.top !== position.top ||\n            rect.left + rect.width !== position.left\n          ) {\n            setPosition({ top: rect.top, left: rect.left + rect.width })\n          }\n        } else {\n          setPosition({ top: rect.top, left: rect.left + rect.width })\n        }\n      } else if (!position) {\n        setPosition({})\n      }\n    }, [position, anchorEl])\n\n    const hasIcon = menuItems.some(\n      menuItem => 'icon' in menuItem && menuItem.icon,\n    )\n    const menuItemStyle: MenuItemStyleProp = {}\n\n    function handleClick(callback: Function) {\n      return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n        onMenuItemClick(event, callback)\n      }\n    }\n\n    const ListContents = (\n      <>\n        <MenuList autoFocusItem={open && !isSubMenuOpen} dense>\n          {menuItems\n            .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n            .map((menuItem, idx) => {\n              if (menuItem.type === 'divider') {\n                return <Divider key={`divider-${idx}`} component=\"li\" />\n              }\n              if (menuItem.type === 'subHeader') {\n                return (\n                  <ListSubheader key={`subHeader-${menuItem.label}-${idx}`}>\n                    {menuItem.label}\n                  </ListSubheader>\n                )\n              }\n              let icon = null\n              let endDecoration = null\n              if (menuItem.icon) {\n                const Icon = menuItem.icon\n                icon = (\n                  <ListItemIcon>\n                    <Icon />\n                  </ListItemIcon>\n                )\n              }\n              if ('subMenu' in menuItem) {\n                endDecoration = <MenuItemEndDecoration type=\"subMenu\" />\n              } else if (\n                menuItem.type === 'checkbox' ||\n                menuItem.type === 'radio'\n              ) {\n                endDecoration = (\n                  <MenuItemEndDecoration\n                    type={menuItem.type}\n                    checked={menuItem.checked}\n                    disabled={menuItem.disabled}\n                  />\n                )\n              }\n              const onClick =\n                'onClick' in menuItem\n                  ? handleClick(menuItem.onClick)\n                  : undefined\n              return (\n                <MUIMenuItem\n                  key={menuItem.label}\n                  style={menuItemStyle}\n                  selected={idx === selectedMenuItemIdx}\n                  onClick={onClick}\n                  onMouseMove={e => {\n                    if (e.currentTarget !== document.activeElement) {\n                      e.currentTarget.focus()\n                      setSelectedMenuItemIdx(idx)\n                    }\n                    if ('subMenu' in menuItem) {\n                      if (openSubMenuIdx !== idx) {\n                        setSubMenuAnchorEl(e.currentTarget)\n                        setOpenSubMenuIdx(idx)\n                      }\n                    } else {\n                      setSubMenuAnchorEl(undefined)\n                      setOpenSubMenuIdx(undefined)\n                    }\n                  }}\n                  onKeyDown={e => {\n                    if (e.key === 'ArrowLeft' || e.key === 'Escape') {\n                      onClose && onClose(e, 'escapeKeyDown')\n                    } else if (e.key === 'ArrowUp') {\n                      setSelectedMenuItemIdx(\n                        findPreviousValidIdx(menuItems, idx),\n                      )\n                    } else if (e.key === 'ArrowDown') {\n                      const a = findNextValidIdx(menuItems, idx)\n                      setSelectedMenuItemIdx(a)\n                    } else if ('subMenu' in menuItem) {\n                      if (e.key === 'ArrowRight' || e.key === 'Enter') {\n                        setSubMenuAnchorEl(e.currentTarget)\n                        setOpenSubMenuIdx(idx)\n                        setIsSubMenuOpen(true)\n                      }\n                    }\n                  }}\n                  disabled={Boolean(menuItem.disabled)}\n                >\n                  {icon}\n                  <ListItemText\n                    primary={menuItem.label}\n                    secondary={menuItem.subLabel}\n                    inset={hasIcon && !menuItem.icon}\n                  />\n                  {endDecoration}\n                </MUIMenuItem>\n              )\n            })}\n        </MenuList>\n        {menuItems.map((menuItem, idx) => {\n          let subMenu = null\n          if ('subMenu' in menuItem) {\n            subMenu = (\n              <MenuPage\n                key={menuItem.label}\n                anchorEl={subMenuAnchorEl}\n                open={isSubMenuOpen && openSubMenuIdx === idx}\n                onClose={() => {\n                  setIsSubMenuOpen(false)\n                  setSubMenuAnchorEl(undefined)\n                }}\n                onMenuItemClick={onMenuItemClick}\n                menuItems={menuItem.subMenu}\n              />\n            )\n          }\n          return subMenu\n        })}\n      </>\n    )\n\n    return top ? (\n      ListContents\n    ) : (\n      <Grow in={open} style={{ transformOrigin: `0 0 0` }} ref={ref}>\n        <Paper\n          elevation={8}\n          ref={paperRef}\n          className={classes.paper}\n          style={{ ...position }}\n        >\n          {ListContents}\n        </Paper>\n      </Grow>\n    )\n  },\n)\n\ninterface MenuProps extends PopoverProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n}\n\nfunction Menu(props: MenuProps) {\n  const { open, onClose, menuItems, onMenuItemClick, ...other } = props\n\n  return (\n    <Popover\n      transitionDuration={0}\n      open={open}\n      onClose={onClose}\n      BackdropProps={{ invisible: true }}\n      {...other}\n    >\n      <MenuPage\n        open={open}\n        onClose={onClose}\n        menuItems={menuItems}\n        onMenuItemClick={onMenuItemClick}\n        top\n      />\n    </Popover>\n  )\n}\n\nexport default Menu\n","import React, { useEffect, useState, useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()({\n  horizontalHandle: {\n    cursor: 'row-resize',\n    width: '100%',\n  },\n  verticalHandle: {\n    cursor: 'col-resize',\n    height: '100%',\n  },\n  flexbox_verticalHandle: {\n    cursor: 'col-resize',\n    alignSelf: 'stretch', // the height: 100% is actually unable to function inside flexbox\n  },\n  flexbox_horizontalHandle: {\n    cursor: 'row-resize',\n    alignSelf: 'stretch', // similar to above\n  },\n})\n\nfunction ResizeHandle({\n  onDrag,\n  vertical = false,\n  flexbox = false,\n  className: originalClassName,\n  ...props\n}: {\n  onDrag: (arg: number) => number\n  vertical?: boolean\n  flexbox?: boolean\n  className?: string\n  [props: string]: unknown\n}) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  const prevPos = useRef(0)\n  const { classes, cx } = useStyles()\n\n  useEffect(() => {\n    function mouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const pos = vertical ? event.clientX : event.clientY\n      const distance = pos - prevPos.current\n      if (distance) {\n        onDrag(distance)\n        prevPos.current = pos\n      }\n    }\n\n    function mouseUp() {\n      setMouseDragging(false)\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', mouseMove, true)\n      window.addEventListener('mouseup', mouseUp, true)\n      return () => {\n        window.removeEventListener('mousemove', mouseMove, true)\n        window.removeEventListener('mouseup', mouseUp, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, onDrag, vertical])\n\n  let className\n  if (flexbox) {\n    if (vertical) {\n      className = classes.flexbox_verticalHandle\n    } else {\n      className = classes.flexbox_horizontalHandle\n    }\n  } else if (vertical) {\n    className = classes.verticalHandle\n  } else {\n    className = classes.horizontalHandle\n  }\n\n  return (\n    <div\n      data-resizer=\"true\"\n      onMouseDown={event => {\n        event.preventDefault()\n        prevPos.current = vertical ? event.clientX : event.clientY\n        setMouseDragging(true)\n      }}\n      role=\"presentation\"\n      className={cx(className, originalClassName)}\n      {...props}\n    />\n  )\n}\n\nexport default ResizeHandle\n","import { blue, green, red, amber } from '@mui/material/colors'\nimport { createTheme, ThemeOptions } from '@mui/material/styles'\nimport type {\n  PaletteAugmentColorOptions,\n  PaletteOptions,\n} from '@mui/material/styles/createPalette'\nimport deepmerge from 'deepmerge'\n\ndeclare module '@mui/material/styles/createPalette' {\n  interface Palette {\n    tertiary: Palette['primary']\n    quaternary: Palette['primary']\n    bases: {\n      A: Palette['primary']\n      C: Palette['primary']\n      G: Palette['primary']\n      T: Palette['primary']\n    }\n  }\n  interface PaletteOptions {\n    tertiary?: PaletteOptions['primary']\n    quaternary?: PaletteOptions['primary']\n    bases?: {\n      A?: PaletteOptions['primary']\n      C?: PaletteOptions['primary']\n      G?: PaletteOptions['primary']\n      T?: PaletteOptions['primary']\n    }\n  }\n}\n\nconst midnight = '#0D233F'\nconst grape = '#721E63'\nconst forest = '#135560'\nconst mandarin = '#FFB11D'\n\nconst refTheme = createTheme()\n\nexport const jbrowseDefaultPalette = {\n  // type: 'dark',\n  primary: { main: midnight },\n  secondary: { main: grape },\n  tertiary: refTheme.palette.augmentColor({ color: { main: forest } }),\n  quaternary: refTheme.palette.augmentColor({ color: { main: mandarin } }),\n  stopCodon: '#e22',\n  startCodon: '#3e3',\n  bases: {\n    A: refTheme.palette.augmentColor({ color: green }),\n    C: refTheme.palette.augmentColor({ color: blue }),\n    G: refTheme.palette.augmentColor({ color: amber }),\n    T: refTheme.palette.augmentColor({ color: red }),\n  },\n}\n\nexport function createJBrowseDefaultProps(/* palette: PaletteOptions = {} */) {\n  return {\n    components: {\n      MuiButton: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiAccordion: {\n        defaultProps: {\n          disableGutters: true,\n          TransitionProps: { timeout: 150 },\n        },\n      },\n      MuiFilledInput: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiFormControl: {\n        defaultProps: {\n          margin: 'dense' as const,\n          size: 'small' as const,\n        },\n      },\n      MuiFormHelperText: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n\n      MuiIconButton: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiInputBase: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiAutocomplete: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiInputLabel: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiToolbar: {\n        defaultProps: {\n          variant: 'dense' as const,\n        },\n      },\n      MuiListItem: {\n        defaultProps: {\n          dense: true,\n        },\n      },\n      MuiOutlinedInput: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiFab: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiTable: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiMenuList: {\n        defaultProps: {\n          dense: true,\n        },\n      },\n      MuiMenuItem: {\n        defaultProps: {\n          dense: true,\n        },\n      },\n\n      MuiTextField: {\n        defaultProps: {\n          margin: 'dense' as const,\n          variant: 'standard' as const,\n        },\n      },\n    },\n  }\n}\n\nexport function createJBrowseDefaultOverrides(palette: PaletteOptions = {}) {\n  const generatedPalette = deepmerge(jbrowseDefaultPalette, palette)\n  return {\n    components: {\n      MuiIconButton: {\n        styleOverrides: {\n          colorSecondary: {\n            color: generatedPalette.tertiary.main,\n          },\n        },\n      },\n      MuiButton: {\n        styleOverrides: {\n          textSecondary: {\n            color: generatedPalette.tertiary.main,\n          },\n        },\n      },\n      MuiFab: {\n        styleOverrides: {\n          secondary: {\n            backgroundColor: generatedPalette.quaternary.main,\n          },\n        },\n      },\n      MuiLink: {\n        styleOverrides: {\n          root: {\n            color: generatedPalette.tertiary.main,\n          },\n        },\n      },\n\n      MuiAccordionSummary: {\n        styleOverrides: {\n          root: {\n            backgroundColor: generatedPalette.tertiary.main,\n          },\n          content: {\n            color: generatedPalette.tertiary.contrastText,\n          },\n        },\n      },\n    },\n  }\n}\n\nexport function createJBrowseBaseTheme(palette?: PaletteOptions): ThemeOptions {\n  return {\n    palette: jbrowseDefaultPalette,\n    typography: { fontSize: 12 },\n    spacing: 4,\n    ...deepmerge(\n      createJBrowseDefaultProps(),\n      createJBrowseDefaultOverrides(palette),\n    ),\n  }\n}\n\nexport function createJBrowseTheme(theme?: ThemeOptions) {\n  if (theme?.palette?.tertiary) {\n    theme = deepmerge(theme, {\n      palette: {\n        tertiary: refTheme.palette.augmentColor(\n          'color' in theme.palette.tertiary\n            ? (theme.palette.tertiary as PaletteAugmentColorOptions)\n            : { color: theme.palette.tertiary },\n        ),\n      },\n    })\n  }\n  if (theme?.palette?.quaternary) {\n    theme = deepmerge(theme, {\n      palette: {\n        quaternary: refTheme.palette.augmentColor(\n          'color' in theme.palette.quaternary\n            ? (theme.palette.quaternary as PaletteAugmentColorOptions)\n            : { color: theme.palette.quaternary },\n        ),\n      },\n    })\n  }\n\n  return createTheme(\n    deepmerge(createJBrowseBaseTheme(theme?.palette), theme || {}),\n  )\n}\n","import React from 'react'\n\ntype LogoVariant = 'color' | 'black' | 'white'\n\ninterface LogoProps {\n  variant?: LogoVariant\n}\n\nfunction getColors(variant?: LogoVariant) {\n  if (variant === 'black') {\n    return {\n      midnight: '#808080',\n      forrest: '#666666',\n      grape: '#4d4d4d',\n      mandarin: '#333333',\n      gray: '#1a1a1a',\n    }\n  }\n  if (variant === 'white') {\n    return {\n      midnight: '#ffffff',\n      forrest: '#e6e6e6',\n      grape: '#cccccc',\n      mandarin: '#b3b3b3',\n      gray: '#999999',\n    }\n  }\n  return {\n    midnight: '#0d233f',\n    forrest: '#135560',\n    grape: '#721e63',\n    mandarin: '#ffb11d',\n    gray: '#dadada',\n  }\n}\n\nexport function Logomark({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 175 175\">\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nexport function LogoFull({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 641 175\">\n      <Text variant={variant} />\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nfunction Icon({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <>\n      <path\n        style={{ fill: colors.midnight }}\n        d=\"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z\"\n      />\n      <path\n        style={{ fill: colors.forrest }}\n        d=\"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z\"\n      />\n      <path\n        style={{ fill: colors.grape }}\n        d=\"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z\"\n      />\n      <path\n        style={{ fill: colors.mandarin }}\n        d=\"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z\"\n      />\n      <path\n        style={{ fill: colors.gray }}\n        d=\"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z\"\n      />\n    </>\n  )\n}\n\nfunction Text({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <g\n      aria-label=\"JBrowse\"\n      transform=\"translate(213.084 144.241)\"\n      style={{ fill: colors.midnight }}\n    >\n      <path d=\"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z\" />\n      <path d=\"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z\" />\n      <path d=\"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z\" />\n      <path d=\"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z\" />\n      <path d=\"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z\" />\n      <path d=\"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z\" />\n      <path d=\"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z\" />\n    </g>\n  )\n}\n","import React, { useState, Suspense } from 'react'\nimport {\n  AppBar,\n  Button,\n  Fab,\n  FormControl,\n  MenuItem,\n  Paper,\n  Select,\n  Toolbar,\n  Tooltip,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport LaunchIcon from '@mui/icons-material/Launch'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\n\n// locals\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\nimport {\n  AbstractViewModel,\n  NotificationLevel,\n  SessionWithDrawerWidgets,\n  SnackAction,\n} from '../util'\n\n// ui elements\nimport DrawerWidget from './DrawerWidget'\nimport DropDownMenu from './DropDownMenu'\nimport ErrorMessage from './ErrorMessage'\nimport LoadingEllipses from './LoadingEllipses'\nimport EditableTypography from './EditableTypography'\nimport Snackbar from './Snackbar'\nimport ViewContainer from './ViewContainer'\nimport { LogoFull } from './Logo'\nimport { MenuItem as JBMenuItem } from './Menu'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    fontFamily: 'Roboto',\n    display: 'grid',\n    height: '100vh',\n    width: '100%',\n  },\n  fabLeft: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n  fabRight: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n  },\n  menuBarAndComponents: {\n    gridColumn: 'main',\n    display: 'grid',\n    gridTemplateRows: '[menubar] min-content [components] auto',\n    height: '100vh',\n  },\n  menuBar: {\n    gridRow: 'menubar',\n  },\n  components: {\n    overflowY: 'auto',\n    gridRow: 'components',\n  },\n  appBar: {\n    flexGrow: 1,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  inputBase: {\n    color: theme.palette.primary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.secondary.main,\n    backgroundColor: theme.palette.primary.light,\n  },\n\n  selectPaper: {\n    padding: theme.spacing(4),\n  },\n}))\n\nconst Logo = observer(\n  ({ session }: { session: { configuration: AnyConfigurationModel } }) => {\n    const { configuration } = session\n    const logoPath = readConfObject(configuration, 'logoPath')\n    if (!logoPath?.uri) {\n      return <LogoFull variant=\"white\" />\n    } else {\n      return <img src={logoPath.uri} alt=\"Custom logo\" />\n    }\n  },\n)\n\ntype SnackbarMessage = [string, NotificationLevel, SnackAction]\n\ntype AppSession = SessionWithDrawerWidgets & {\n  savedSessionNames: string[]\n  menus: { label: string; menuItems: JBMenuItem[] }[]\n  renameCurrentSession: (arg: string) => void\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nconst AppToolbar = observer(\n  ({\n    session,\n    HeaderButtons = <div />,\n  }: {\n    HeaderButtons?: React.ReactElement\n    session: AppSession\n  }) => {\n    const { classes } = useStyles()\n    const { savedSessionNames, name, menus } = session\n\n    function handleNameChange(newName: string) {\n      if (savedSessionNames?.includes(newName)) {\n        session.notify(\n          `Cannot rename session to \"${newName}\", a saved session with that name already exists`,\n          'warning',\n        )\n      } else {\n        session.renameCurrentSession(newName)\n      }\n    }\n    return (\n      <Toolbar>\n        {menus.map(menu => (\n          <DropDownMenu\n            key={menu.label}\n            menuTitle={menu.label}\n            menuItems={menu.menuItems}\n            session={session}\n          />\n        ))}\n        <div className={classes.grow} />\n        <Tooltip title=\"Rename Session\" arrow>\n          <EditableTypography\n            value={name}\n            setValue={handleNameChange}\n            variant=\"body1\"\n            classes={{\n              inputBase: classes.inputBase,\n              inputRoot: classes.inputRoot,\n              inputFocused: classes.inputFocused,\n            }}\n          />\n        </Tooltip>\n        {HeaderButtons}\n        <div className={classes.grow} />\n        <div style={{ width: 150, maxHeight: 48 }}>\n          <Logo session={session} />\n        </div>\n      </Toolbar>\n    )\n  },\n)\n\nconst ViewLauncher = observer(({ session }: { session: AppSession }) => {\n  const { classes } = useStyles()\n  const { pluginManager } = getEnv(session)\n  const viewTypes = pluginManager.getElementTypeRecord('view').all()\n  const [value, setValue] = useState(viewTypes[0]?.name)\n  return (\n    <Paper className={classes.selectPaper}>\n      <Typography>Select a view to launch</Typography>\n      <FormControl style={{ margin: 2 }}>\n        <Select value={value} onChange={event => setValue(event.target.value)}>\n          {viewTypes.map(({ name }: { name: string }) => (\n            <MenuItem key={name} value={name}>\n              {name}\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n      <FormControl style={{ margin: 2 }}>\n        <Button\n          onClick={() => session.addView(value, {})}\n          variant=\"contained\"\n          color=\"primary\"\n        >\n          Launch view\n        </Button>\n      </FormControl>\n    </Paper>\n  )\n})\n\nconst ViewPanel = observer(\n  ({ view, session }: { view: AbstractViewModel; session: AppSession }) => {\n    const { pluginManager } = getEnv(session)\n    const viewType = pluginManager.getViewType(view.type)\n    if (!viewType) {\n      throw new Error(`unknown view type ${view.type}`)\n    }\n    const { ReactComponent } = viewType\n    return (\n      <ViewContainer\n        view={view}\n        onClose={() => session.removeView(view)}\n        onMinimize={() => view.setMinimized(!view.minimized)}\n      >\n        {!view.minimized ? (\n          <ErrorBoundary\n            FallbackComponent={({ error }) => <ErrorMessage error={error} />}\n          >\n            <Suspense fallback={<LoadingEllipses />}>\n              <ReactComponent\n                model={view}\n                session={session}\n                getTrackType={pluginManager.getTrackType}\n              />\n            </Suspense>\n          </ErrorBoundary>\n        ) : (\n          false\n        )}\n      </ViewContainer>\n    )\n  },\n)\n\nconst App = observer(\n  (props: {\n    HeaderButtons?: React.ReactElement\n    session: SessionWithDrawerWidgets & {\n      savedSessionNames: string[]\n      menus: { label: string; menuItems: JBMenuItem[] }[]\n      renameCurrentSession: (arg: string) => void\n      snackbarMessages: SnackbarMessage[]\n      popSnackbarMessage: () => unknown\n    }\n  }) => {\n    const { session } = props\n    const { classes } = useStyles()\n\n    const {\n      minimized,\n      visibleWidget,\n      drawerWidth,\n      activeWidgets,\n      views,\n      drawerPosition,\n    } = session\n\n    const drawerVisible = visibleWidget && !minimized\n\n    let grid\n    if (drawerPosition === 'right') {\n      grid = [\n        `[main] 1fr`,\n        drawerVisible ? `[drawer] ${drawerWidth}px` : undefined,\n      ]\n    } else if (drawerPosition === 'left') {\n      grid = [\n        drawerVisible ? `[drawer] ${drawerWidth}px` : undefined,\n        `[main] 1fr`,\n      ]\n    }\n    return (\n      <div\n        className={classes.root}\n        style={{\n          gridTemplateColumns: grid?.filter(f => !!f).join(' '),\n        }}\n      >\n        {drawerVisible && drawerPosition === 'left' ? (\n          <DrawerWidget session={session} />\n        ) : null}\n\n        {session.DialogComponent ? (\n          <Suspense fallback={<div />}>\n            <session.DialogComponent {...session.DialogProps} />\n          </Suspense>\n        ) : null}\n        <div className={classes.menuBarAndComponents}>\n          <div className={classes.menuBar}>\n            <AppBar className={classes.appBar} position=\"static\">\n              <AppToolbar {...props} />\n            </AppBar>\n          </div>\n          <div className={classes.components}>\n            {views.length ? (\n              views.map(view => (\n                <ViewPanel\n                  key={`view-${view.id}`}\n                  view={view}\n                  session={session}\n                />\n              ))\n            ) : (\n              <ViewLauncher {...props} />\n            )}\n\n            {/* blank space at the bottom of screen allows scroll */}\n            <div style={{ height: 300 }} />\n          </div>\n        </div>\n\n        {activeWidgets.size > 0 && minimized ? (\n          <Tooltip title=\"Open drawer widget\">\n            <Fab\n              className={\n                drawerPosition === 'right' ? classes.fabRight : classes.fabLeft\n              }\n              color=\"primary\"\n              data-testid=\"drawer-maximize\"\n              onClick={() => session.showWidgetDrawer()}\n            >\n              <LaunchIcon />\n            </Fab>\n          </Tooltip>\n        ) : null}\n\n        {drawerVisible && drawerPosition === 'right' ? (\n          <DrawerWidget session={session} />\n        ) : null}\n\n        <Snackbar session={session} />\n      </div>\n    )\n  },\n)\n\nexport default App\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n  Typography,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport CloseIcon from '@mui/icons-material/Close'\n\nconst useStyles = makeStyles()(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction ReturnToImportFormDialog({\n  model,\n  handleClose,\n}: {\n  model: { clearView: Function }\n  handleClose: () => void\n}) {\n  const { classes } = useStyles()\n  return (\n    <Dialog maxWidth=\"xl\" open onClose={handleClose}>\n      <DialogTitle>\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            className={classes.closeButton}\n            onClick={() => handleClose()}\n            size=\"large\"\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        <Typography>\n          Are you sure you want to return to the import form? This will lose\n          your current view\n        </Typography>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            model.clearView()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          onClick={() => handleClose()}\n          color=\"secondary\"\n          variant=\"contained\"\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(ReturnToImportFormDialog)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport ReactPropTypes from 'prop-types'\nimport React, { useState, useRef, useEffect } from 'react'\nimport { drawImageOntoCanvasContext } from '../util/offscreenCanvasPonyfill'\n\nfunction PrerenderedCanvas(props: {\n  width: number\n  height: number\n  highResolutionScaling: number\n  style: any\n  imageData: any\n  showSoftClip?: boolean\n  blockKey?: string\n}) {\n  const {\n    width,\n    height,\n    highResolutionScaling,\n    style,\n    imageData,\n    blockKey,\n    showSoftClip,\n  } = props\n  const [done, setDone] = useState(false)\n\n  const featureCanvas = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    if (!imageData) {\n      return\n    }\n    const canvas = featureCanvas.current\n    if (!canvas) {\n      return\n    }\n    const context = canvas.getContext('2d')\n    if (!context) {\n      return\n    }\n    drawImageOntoCanvasContext(imageData, context)\n    setDone(true)\n  }, [imageData])\n\n  const softClipString = showSoftClip ? '_softclipped' : ''\n  const blockKeyStr = blockKey ? '_' + blockKey : ''\n  const testId = `prerendered_canvas${softClipString}${blockKeyStr}${\n    done ? '_done' : ''\n  }`\n  return (\n    <canvas\n      data-testid={testId}\n      ref={featureCanvas}\n      width={width * highResolutionScaling}\n      height={height * highResolutionScaling}\n      style={{ width, height, ...style }}\n    />\n  )\n}\n\nPrerenderedCanvas.propTypes = {\n  height: ReactPropTypes.number.isRequired,\n  width: ReactPropTypes.number.isRequired,\n  highResolutionScaling: ReactPropTypes.number,\n  style: ReactPropTypes.objectOf(ReactPropTypes.any),\n  imageData: ReactPropTypes.any,\n  // config: ReactPropTypes.objectOf(ReactPropTypes.any),\n}\nPrerenderedCanvas.defaultProps = {\n  imageData: undefined,\n  highResolutionScaling: 1,\n  style: {},\n  // config: {},\n}\n\nexport default PrerenderedCanvas\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { Feature } from '../util/simpleFeature'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nconst useStyles = makeStyles()({\n  hoverLabel: {\n    border: '1px solid black',\n    position: 'absolute',\n    background: '#fffa',\n    pointerEvents: 'none',\n    zIndex: 10000,\n  },\n})\n\nconst Tooltip = ({\n  offsetX,\n  offsetY,\n  configuration,\n  feature,\n  timeout = 300,\n}: {\n  offsetX: number\n  offsetY: number\n  configuration: AnyConfigurationModel\n  feature?: Feature\n  timeout?: number\n}) => {\n  const { classes } = useStyles()\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    // only show the loading message after short timeout to prevent excessive\n    // flickering\n    const handle = setTimeout(() => setShown(true), timeout)\n    return () => clearTimeout(handle)\n  })\n  if (feature && shown) {\n    const text = readConfObject(configuration, 'mouseover', { feature })\n    return (\n      <div\n        className={classes.hoverLabel}\n        style={{ left: offsetX, top: offsetY }}\n      >\n        {text}\n      </div>\n    )\n  }\n  return null\n}\n\nexport default observer(Tooltip)\n","import React from 'react'\nimport escapeHTML from 'escape-html'\nimport dompurify from 'dompurify'\n\n// source https://github.com/sindresorhus/html-tags/blob/master/html-tags.json\n// with some random uncommon ones removed. note: we just use this to run the content\n// through dompurify without escaping if we see an htmlTag from this list\n// otherwise we escape angle brackets and things prematurely because it might be\n// something like <TRA> in VCF. Ref #657\nconst htmlTags = [\n  'a',\n  'b',\n  'br',\n  'code',\n  'div',\n  'em',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'i',\n  'img',\n  'li',\n  'p',\n  'pre',\n  'span',\n  'small',\n  'strong',\n  'table',\n  'tbody',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'tr',\n  'u',\n  'ul',\n]\n\nlet added = false\n\n// adapted from is-html\n// https://github.com/sindresorhus/is-html/blob/master/index.js\nconst full = new RegExp(htmlTags.map(tag => `<${tag}\\\\b[^>]*>`).join('|'), 'i')\nexport function isHTML(str: string) {\n  return full.test(str)\n}\n\nexport default function SanitizedHTML({ html }: { html: string }) {\n  const value = isHTML(html) ? html : escapeHTML(html)\n  if (!added) {\n    added = true\n    // see https://github.com/cure53/DOMPurify/issues/317\n    // only have to add this once, and can't do it globally because dompurify\n    // not yet initialized at global scope\n    dompurify.addHook(\n      'afterSanitizeAttributes',\n      (node: {\n        tagName: string\n        setAttribute: (arg0: string, arg1: string) => void\n      }) => {\n        if (node.tagName === 'A') {\n          node.setAttribute('rel', 'noopener noreferrer')\n          node.setAttribute('target', '_blank')\n        }\n      },\n    )\n  }\n\n  return (\n    <div\n      // eslint-disable-next-line react/no-danger\n      dangerouslySetInnerHTML={{\n        __html: dompurify.sanitize(value),\n      }}\n    />\n  )\n}\n","// vendored from quick-lru@6.1.1, didn't like being compiled as a 'pure-esm' nodejs dependency\n// the license is reproduced below https://github.com/sindresorhus/quick-lru/blob/main/license\n// MIT License\n\n// Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nexport default class QuickLRU extends Map {\n  constructor(options = {}) {\n    super()\n\n    if (!(options.maxSize && options.maxSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    if (typeof options.maxAge === 'number' && options.maxAge === 0) {\n      throw new TypeError('`maxAge` must be a number greater than 0')\n    }\n\n    // TODO: Use private class fields when ESLint supports them.\n    this.maxSize = options.maxSize\n    this.maxAge = options.maxAge || Number.POSITIVE_INFINITY\n    this.onEviction = options.onEviction\n    this.cache = new Map()\n    this.oldCache = new Map()\n    this._size = 0\n  }\n\n  // TODO: Use private class methods when targeting Node.js 16.\n  _emitEvictions(cache) {\n    if (typeof this.onEviction !== 'function') {\n      return\n    }\n\n    for (const [key, item] of cache) {\n      this.onEviction(key, item.value)\n    }\n  }\n\n  _deleteIfExpired(key, item) {\n    if (typeof item.expiry === 'number' && item.expiry <= Date.now()) {\n      if (typeof this.onEviction === 'function') {\n        this.onEviction(key, item.value)\n      }\n\n      return this.delete(key)\n    }\n\n    return false\n  }\n\n  _getOrDeleteIfExpired(key, item) {\n    const deleted = this._deleteIfExpired(key, item)\n    if (deleted === false) {\n      return item.value\n    }\n  }\n\n  _getItemValue(key, item) {\n    return item.expiry ? this._getOrDeleteIfExpired(key, item) : item.value\n  }\n\n  _peek(key, cache) {\n    const item = cache.get(key)\n\n    return this._getItemValue(key, item)\n  }\n\n  _set(key, value) {\n    this.cache.set(key, value)\n    this._size++\n\n    if (this._size >= this.maxSize) {\n      this._size = 0\n      this._emitEvictions(this.oldCache)\n      this.oldCache = this.cache\n      this.cache = new Map()\n    }\n  }\n\n  _moveToRecent(key, item) {\n    this.oldCache.delete(key)\n    this._set(key, item)\n  }\n\n  *_entriesAscending() {\n    for (const item of this.oldCache) {\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield item\n        }\n      }\n    }\n\n    for (const item of this.cache) {\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield item\n      }\n    }\n  }\n\n  get(key) {\n    if (this.cache.has(key)) {\n      const item = this.cache.get(key)\n\n      return this._getItemValue(key, item)\n    }\n\n    if (this.oldCache.has(key)) {\n      const item = this.oldCache.get(key)\n      if (this._deleteIfExpired(key, item) === false) {\n        this._moveToRecent(key, item)\n        return item.value\n      }\n    }\n  }\n\n  set(key, value, { maxAge = this.maxAge } = {}) {\n    const expiry =\n      typeof maxAge === 'number' && maxAge !== Number.POSITIVE_INFINITY\n        ? Date.now() + maxAge\n        : undefined\n    if (this.cache.has(key)) {\n      this.cache.set(key, {\n        value,\n        expiry,\n      })\n    } else {\n      this._set(key, { value, expiry })\n    }\n  }\n\n  has(key) {\n    if (this.cache.has(key)) {\n      return !this._deleteIfExpired(key, this.cache.get(key))\n    }\n\n    if (this.oldCache.has(key)) {\n      return !this._deleteIfExpired(key, this.oldCache.get(key))\n    }\n\n    return false\n  }\n\n  peek(key) {\n    if (this.cache.has(key)) {\n      return this._peek(key, this.cache)\n    }\n\n    if (this.oldCache.has(key)) {\n      return this._peek(key, this.oldCache)\n    }\n  }\n\n  delete(key) {\n    const deleted = this.cache.delete(key)\n    if (deleted) {\n      this._size--\n    }\n\n    return this.oldCache.delete(key) || deleted\n  }\n\n  clear() {\n    this.cache.clear()\n    this.oldCache.clear()\n    this._size = 0\n  }\n\n  resize(newSize) {\n    if (!(newSize && newSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    const items = [...this._entriesAscending()]\n    const removeCount = items.length - newSize\n    if (removeCount < 0) {\n      this.cache = new Map(items)\n      this.oldCache = new Map()\n      this._size = items.length\n    } else {\n      if (removeCount > 0) {\n        this._emitEvictions(items.slice(0, removeCount))\n      }\n\n      this.oldCache = new Map(items.slice(removeCount))\n      this.cache = new Map()\n      this._size = 0\n    }\n\n    this.maxSize = newSize\n  }\n\n  *keys() {\n    for (const [key] of this) {\n      yield key\n    }\n  }\n\n  *values() {\n    for (const [, value] of this) {\n      yield value\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this.cache) {\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield [key, value.value]\n      }\n    }\n\n    for (const item of this.oldCache) {\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield [key, value.value]\n        }\n      }\n    }\n  }\n\n  *entriesDescending() {\n    let items = [...this.cache]\n    for (let i = items.length - 1; i >= 0; --i) {\n      const item = items[i]\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield [key, value.value]\n      }\n    }\n\n    items = [...this.oldCache]\n    for (let i = items.length - 1; i >= 0; --i) {\n      const item = items[i]\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield [key, value.value]\n        }\n      }\n    }\n  }\n\n  *entriesAscending() {\n    for (const [key, value] of this._entriesAscending()) {\n      yield [key, value.value]\n    }\n  }\n\n  get size() {\n    if (!this._size) {\n      return this.oldCache.size\n    }\n\n    let oldCacheSize = 0\n    for (const key of this.oldCache.keys()) {\n      if (!this.cache.has(key)) {\n        oldCacheSize++\n      }\n    }\n\n    return Math.min(this._size + oldCacheSize, this.maxSize)\n  }\n\n  entries() {\n    return this.entriesAscending()\n  }\n\n  forEach(callbackFunction, thisArgument = this) {\n    for (const [key, value] of this.entriesAscending()) {\n      callbackFunction.call(thisArgument, value, key, this)\n    }\n  }\n\n  get [Symbol.toStringTag]() {\n    return JSON.stringify([...this.entriesAscending()])\n  }\n}\n","import { Observable, fromEvent } from 'rxjs'\n\nclass AbortError extends Error {\n  public code: string | undefined\n}\n\n/**\n * properly check if the given AbortSignal is aborted.\n * per the standard, if the signal reads as aborted,\n * this function throws either a DOMException AbortError, or a regular error\n * with a `code` attribute set to `ERR_ABORTED`.\n *\n * for convenience, passing `undefined` is a no-op\n *\n * @param signal -\n * @returns nothing\n */\nexport function checkAbortSignal(signal?: AbortSignal): void {\n  if (!signal) {\n    return\n  }\n\n  if (!(signal instanceof AbortSignal)) {\n    throw new TypeError('must pass an AbortSignal')\n  }\n\n  if (signal.aborted) {\n    throw makeAbortError()\n  }\n}\n\nfunction timeout(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n/**\n * Skips to the next tick, then runs `checkAbortSignal`.\n * Await this to inside an otherwise synchronous loop to\n * provide a place to break when an abort signal is received.\n */\nexport async function abortBreakPoint(signal?: AbortSignal) {\n  // it was observed that an actual timeout is needed to get the aborting (wrap\n  // hicrenderer in a try catch, console.error the error, and rethrow the error\n  // to see). using await Promise.resolve() did not appear to allow aborting to\n  // occur\n  await timeout(1)\n  checkAbortSignal(signal)\n}\n\nexport function makeAbortError() {\n  if (typeof DOMException !== 'undefined') {\n    return new DOMException('aborted', 'AbortError')\n  }\n  const e = new AbortError('aborted')\n  e.code = 'ERR_ABORTED'\n  return e\n}\n\nexport function observeAbortSignal(signal?: AbortSignal): Observable<Event> {\n  if (!signal) {\n    return Observable.create()\n  }\n  return fromEvent(signal, 'abort')\n}\n\n/**\n * check if the given exception was caused by an operation being intentionally aborted\n * @param exception -\n */\nexport function isAbortException(exception: unknown): boolean {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AbortError' ||\n      // standard-ish non-DOM abort exception\n      (exception as AbortError).code === 'ERR_ABORTED' ||\n      // message contains aborted for bubbling through RPC\n      // things we have seen that we want to catch here\n      // Error: aborted\n      // AbortError: aborted\n      // AbortError: The user aborted a request.\n      !!exception.message.match(/\\b(aborted|AbortError)\\b/i))\n  )\n}\n","// This file is a ponyfill for the HTML5 OffscreenCanvas API.\n\nimport isNode from 'detect-node'\n\nimport { CanvasSequence } from 'canvas-sequencer'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AbstractCanvas = any\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AbstractImageBitmap = any\n\nexport let createCanvas: (width: number, height: number) => AbstractCanvas\nexport let createImageBitmap: (\n  canvas: AbstractCanvas,\n) => Promise<AbstractImageBitmap>\n\n/** the JS class (constructor) for offscreen-generated image bitmap data */\nexport let ImageBitmapType: Function\n\nexport function drawImageOntoCanvasContext(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  imageData: any,\n  context: CanvasRenderingContext2D,\n) {\n  if (imageData.serializedCommands) {\n    const seq = new CanvasSequence(imageData.serializedCommands)\n    seq.execute(context)\n  } else {\n    context.drawImage(imageData as CanvasImageSource, 0, 0)\n  }\n}\n\nconst weHave = {\n  realOffscreenCanvas: typeof OffscreenCanvas === 'function',\n  node: isNode,\n}\n\nif (weHave.realOffscreenCanvas) {\n  createCanvas = (width, height) => new OffscreenCanvas(width, height)\n  // eslint-disable-next-line no-restricted-globals\n  createImageBitmap = window.createImageBitmap || self.createImageBitmap\n  // eslint-disable-next-line no-restricted-globals\n  ImageBitmapType = window.ImageBitmap || self.ImageBitmap\n} else if (weHave.node) {\n  // use node-canvas if we are running in node (i.e. automated tests)\n  createCanvas = (...args) => {\n    // @ts-ignore\n    // eslint-disable-next-line no-undef\n    return nodeCreateCanvas(...args)\n  }\n  createImageBitmap = async (canvas, ...otherargs) => {\n    if (otherargs.length) {\n      throw new Error(\n        'only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill',\n      )\n    }\n    const dataUri = canvas.toDataURL()\n    // @ts-ignore\n    // eslint-disable-next-line no-undef\n    const img = new nodeImage()\n    return new Promise((resolve, reject) => {\n      img.onload = () => resolve(img)\n      img.onerror = reject\n      img.src = dataUri\n    })\n  }\n} else {\n  createCanvas = (width: number, height: number) => {\n    const context = new CanvasSequence()\n    return {\n      width,\n      height,\n      getContext() {\n        return context\n      },\n    }\n  }\n  createImageBitmap = async canvas => {\n    const ctx = canvas.getContext('2d')\n    return {\n      height: canvas.height,\n      width: canvas.width,\n      serializedCommands: ctx.toJSON(),\n      containsNoTransferables: true,\n    }\n  }\n  ImageBitmapType = String\n}\n","import React from 'react'\nimport { CanvasSequence } from 'canvas-sequencer'\n\n// locals\nimport { createCanvas, createImageBitmap } from './offscreenCanvasPonyfill'\nimport { blobToDataURL } from './index'\n\nexport type RenderReturn = Record<string, unknown>\n\nexport async function renderToAbstractCanvas(\n  width: number,\n  height: number,\n  opts: {\n    exportSVG?: { rasterizeLayers?: boolean }\n    highResolutionScaling: number\n  },\n  cb: (\n    ctx: CanvasRenderingContext2D,\n  ) => Promise<RenderReturn | void> | RenderReturn | void,\n) {\n  const { exportSVG, highResolutionScaling: scaling = 1 } = opts\n\n  if (exportSVG) {\n    if (!exportSVG.rasterizeLayers) {\n      const fakeCtx = new CanvasSequence()\n      const result = await cb(fakeCtx)\n      return {\n        ...result,\n        canvasRecordedData: fakeCtx.toJSON(),\n      }\n    } else {\n      const scale = 4\n      const canvas = createCanvas(Math.ceil(width * scale), height * scale)\n      const ctx = canvas.getContext('2d')\n      if (!ctx) {\n        throw new Error('2d canvas rendering not supported on this platform')\n      }\n      ctx.scale(scale, scale)\n      const result = await cb(ctx)\n\n      // two methods needed for converting canvas to PNG, one for webworker\n      // offscreen canvas, one for main thread\n      return {\n        ...result,\n        reactElement: (\n          <image\n            width={width}\n            height={height}\n            xlinkHref={\n              'convertToBlob' in canvas\n                ? await blobToDataURL(\n                    await canvas.convertToBlob({\n                      type: 'image/png',\n                    }),\n                  )\n                : canvas.toDataURL()\n            }\n          />\n        ),\n      }\n    }\n  } else {\n    const canvas = createCanvas(Math.ceil(width * scaling), height * scaling)\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('2d canvas rendering not supported on this platform')\n    }\n    ctx.scale(scaling, scaling)\n    const result = await cb(ctx)\n    return { ...result, imageData: await createImageBitmap(canvas) }\n  }\n}\n","import React from 'react'\nimport {\n  isStateTreeNode,\n  Instance,\n  SnapshotIn,\n  IAnyStateTreeNode,\n  IStateTreeNode,\n  IType,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\n\nimport assemblyManager from '../../assemblyManager'\nimport TextSearchManager from '../../TextSearch/TextSearchManager'\nimport { MenuItem } from '../../ui'\nimport {\n  NoAssemblyRegion as MUNoAssemblyRegion,\n  Region as MUIRegion,\n  LocalPathLocation as MULocalPathLocation,\n  UriLocation as MUUriLocation,\n  BlobLocation as MUBlobLocation,\n} from './mst'\nimport RpcManager from '../../rpc/RpcManager'\nimport { Feature } from '../simpleFeature'\nimport { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\n\nexport * from './util'\n\n/** abstract type for a model that contains multiple views */\nexport interface AbstractViewContainer\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  extends IStateTreeNode<IType<any, unknown, any>> {\n  views: AbstractViewModel[]\n  removeView(view: AbstractViewModel): void\n  addView(\n    typeName: string,\n    initialState?: Record<string, unknown>,\n  ): AbstractViewModel\n}\nexport function isViewContainer(\n  thing: unknown,\n): thing is AbstractViewContainer {\n  return (\n    isStateTreeNode(thing) &&\n    'removeView' in thing &&\n    'addView' in thing &&\n    'views' in thing\n  )\n}\n\nexport type NotificationLevel = 'error' | 'info' | 'warning' | 'success'\nexport interface SnackAction {\n  name: string\n  onClick: () => void\n}\n\nexport type AssemblyManager = Instance<ReturnType<typeof assemblyManager>>\nexport type { TextSearchManager }\nexport interface BasePlugin {\n  version?: string\n  name: string\n  url?: string\n}\n\nexport interface JBrowsePlugin {\n  name: string\n  authors: string[]\n  description: string\n  location: string\n  url?: string\n  umdUrl?: string\n  esmUrl?: string\n  cjsUrl?: string\n  license: string\n  image?: string\n}\n\nexport type DialogComponentType =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.LazyExoticComponent<React.FC<any>>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  | React.FC<any>\n\n/** minimum interface that all session state models must implement */\nexport interface AbstractSessionModel extends AbstractViewContainer {\n  drawerPosition?: string\n  setSelection(feature: Feature): void\n  clearSelection(): void\n  configuration: AnyConfigurationModel\n  rpcManager: RpcManager\n  assemblyNames: string[]\n  assemblies: AnyConfigurationModel[]\n  selection?: unknown\n  duplicateCurrentSession?(): void\n  notify(message: string, level?: NotificationLevel, action?: SnackAction): void\n  assemblyManager: AssemblyManager\n  version: string\n  getTrackActionMenuItems?: Function\n  addAssembly?: Function\n  removeAssembly?: Function\n  textSearchManager?: TextSearchManager\n  connections: AnyConfigurationModel[]\n  deleteConnection?: Function\n  sessionConnections?: AnyConfigurationModel[]\n  connectionInstances?: {\n    name: string\n    connectionId: string\n    tracks: AnyConfigurationModel[]\n  }[]\n  makeConnection?: Function\n  adminMode?: boolean\n  showWidget?: Function\n  addWidget?: Function\n\n  DialogComponent?: DialogComponentType\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  DialogProps: any\n  queueDialog<T extends DialogComponentType>(\n    callback: (doneCallback: () => void) => [T, React.ComponentProps<T>],\n  ): void\n  name: string\n  id?: string\n  tracks: AnyConfigurationModel[]\n}\nexport function isSessionModel(thing: unknown): thing is AbstractSessionModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'rpcManager' in thing &&\n    'configuration' in thing\n  )\n}\n\n/** abstract interface for a session allows editing configurations */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  editConfiguration(configuration: AnyConfigurationModel): void\n}\nexport function isSessionModelWithConfigEditing(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return isSessionModel(thing) && 'editConfiguration' in thing\n}\n\n/** abstract interface for a session allows adding tracks */\nexport interface SessionWithConfigEditing extends AbstractSessionModel {\n  addTrackConf(\n    configuration: AnyConfigurationModel | SnapshotIn<AnyConfigurationModel>,\n  ): void\n}\nexport function isSessionWithAddTracks(\n  thing: unknown,\n): thing is SessionWithConfigEditing {\n  return (\n    // @ts-ignore\n    isSessionModel(thing) && 'addTrackConf' in thing && !thing.disableAddTracks\n  )\n}\n\nexport interface Widget {\n  type: string\n  id: string\n}\n\n/** abstract interface for a session that manages widgets */\nexport interface SessionWithWidgets extends AbstractSessionModel {\n  minimized: boolean\n  visibleWidget?: Widget\n  widgets: Map<string, Widget>\n  activeWidgets: Map<string, Widget>\n  addWidget(\n    typeName: string,\n    id: string,\n    initialState?: Record<string, unknown>,\n    configuration?: { type: string },\n  ): Widget\n  showWidget(widget: unknown): void\n  hideWidget(widget: unknown): void\n}\n\n/* only some sessions with widgets use a drawer widget */\nexport interface SessionWithDrawerWidgets extends SessionWithWidgets {\n  drawerWidth: number\n  resizeDrawer(arg: number): number\n  minimizeWidgetDrawer(): void\n  showWidgetDrawer: () => void\n  drawerPosition: string\n  setDrawerPosition(arg: string): void\n}\n\nexport function isSessionModelWithWidgets(\n  thing: unknown,\n): thing is SessionWithWidgets {\n  return isSessionModel(thing) && 'widgets' in thing\n}\n\ninterface SessionWithConnections {\n  addConnectionConf: (arg: AnyConfigurationModel) => void\n}\n\nexport function isSessionModelWithConnections(\n  thing: unknown,\n): thing is SessionWithConnections {\n  return isSessionModel(thing) && 'addConnectionConf' in thing\n}\n\nexport interface SessionWithSessionPlugins extends AbstractSessionModel {\n  sessionPlugins: JBrowsePlugin[]\n  addSessionPlugin: Function\n  removeSessionPlugin: Function\n}\nexport function isSessionWithSessionPlugins(\n  thing: unknown,\n): thing is SessionWithSessionPlugins {\n  return isSessionModel(thing) && 'sessionPlugins' in thing\n}\n\n/** abstract interface for a session that manages a global selection */\nexport interface SelectionContainer extends AbstractSessionModel {\n  selection?: unknown\n  setSelection(thing: unknown): void\n}\nexport function isSelectionContainer(\n  thing: unknown,\n): thing is SelectionContainer {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'selection' in thing &&\n    'setSelection' in thing\n  )\n}\n\n/** minimum interface that all view state models must implement */\nexport interface AbstractViewModel {\n  id: string\n  type: string\n  width: number\n  minimized: boolean\n  setWidth(width: number): void\n  setMinimized(flag: boolean): void\n  displayName: string | undefined\n  setDisplayName: (arg: string) => void\n  menuItems: () => MenuItem[]\n}\nexport function isViewModel(thing: unknown): thing is AbstractViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'width' in thing &&\n    'setWidth' in thing\n  )\n}\n\nexport interface AbstractTrackModel {\n  displays: AbstractDisplayModel[]\n}\n\nexport function isTrackModel(thing: unknown): thing is AbstractTrackModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-ignore\n    thing.configuration.trackId\n  )\n}\n\nexport interface AbstractDisplayModel {\n  id: string\n  parentTrack: AbstractTrackModel\n  renderDelay: number\n  rendererType: any // eslint-disable-line @typescript-eslint/no-explicit-any\n  cannotBeRenderedReason?: string\n}\nexport function isDisplayModel(thing: unknown): thing is AbstractDisplayModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'configuration' in thing &&\n    // @ts-ignore\n    thing.configuration.displayId\n  )\n}\n\nexport interface TrackViewModel extends AbstractViewModel {\n  showTrack(trackId: string): void\n  hideTrack(trackId: string): void\n}\nexport function isTrackViewModel(thing: unknown): thing is TrackViewModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'showTrack' in thing &&\n    'hideTrack' in thing\n  )\n}\n\n/** minimum interface for the root MST model of a JBrowse app */\nexport interface AbstractRootModel {\n  jbrowse: IAnyStateTreeNode\n  session?: AbstractSessionModel\n  setDefaultSession?(): void\n  adminMode?: boolean\n  error?: unknown\n}\n\n/** root model with more included for the heavier JBrowse web and desktop app */\nexport interface AppRootModel extends AbstractRootModel {\n  isAssemblyEditing: boolean\n  isDefaultSessionEditing: boolean\n  setAssemblyEditing: (arg: boolean) => boolean\n  setDefaultSessionEditing: (arg: boolean) => boolean\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isAppRootModel(thing: unknown): thing is AppRootModel {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isAssemblyEditing' in thing &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\nexport interface RootModelWithInternetAccounts extends AbstractRootModel {\n  internetAccounts: BaseInternetAccountModel[]\n  findAppropriateInternetAccount(\n    location: UriLocation,\n  ): BaseInternetAccountModel | undefined\n}\n\nexport function isRootModelWithInternetAccounts(\n  thing: unknown,\n): thing is RootModelWithInternetAccounts {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'internetAccounts' in thing &&\n    'findAppropriateInternetAccount' in thing\n  )\n}\n\n/** a root model that manages global menus */\nexport interface AbstractMenuManager {\n  appendMenu(menuName: string): void\n  insertMenu(menuName: string, position: number): number\n  insertInMenu(menuName: string, menuItem: MenuItem, position: number): number\n  appendToMenu(menuName: string, menuItem: MenuItem): number\n  appendToSubMenu(menuPath: string[], menuItem: MenuItem): number\n  insertInSubMenu(\n    menuPath: string[],\n    menuItem: MenuItem,\n    position: number,\n  ): number\n}\nexport function isAbstractMenuManager(\n  thing: unknown,\n): thing is AbstractMenuManager {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'appendMenu' in thing &&\n    'appendToSubMenu' in thing\n  )\n}\n\n// Empty interfaces required by mobx-state-tree\n// See https://mobx-state-tree.js.org/tips/typescript#using-a-mst-type-at-design-time\n/* eslint-disable @typescript-eslint/no-empty-interface */\n\nexport interface NoAssemblyRegion\n  extends SnapshotIn<typeof MUNoAssemblyRegion> {}\n\nexport interface Region extends SnapshotIn<typeof MUIRegion> {}\n\nexport interface AugmentedRegion extends Region {\n  originalRefName?: string\n}\n\nexport interface LocalPathLocation\n  extends SnapshotIn<typeof MULocalPathLocation> {}\n\nexport interface UriLocation extends SnapshotIn<typeof MUUriLocation> {}\n\nexport function isUriLocation(location: unknown): location is UriLocation {\n  return typeof location === 'object' && location !== null && 'uri' in location\n}\nexport class AuthNeededError extends Error {\n  constructor(public message: string, public url: string) {\n    super(message)\n    this.name = 'AuthNeededError'\n\n    Object.setPrototypeOf(this, AuthNeededError.prototype)\n  }\n}\n\nexport class RetryError extends Error {\n  constructor(public message: string, public internetAccountId: string) {\n    super(message)\n    this.name = 'RetryError'\n  }\n}\n\nexport function isAuthNeededException(\n  exception: unknown,\n): exception is AuthNeededError {\n  return (\n    exception instanceof Error &&\n    // DOMException\n    (exception.name === 'AuthNeededError' ||\n      (exception as AuthNeededError).url !== undefined)\n  )\n}\n\nexport function isRetryException(exception: Error): boolean {\n  return (\n    // DOMException\n    exception.name === 'RetryError' ||\n    (exception as RetryError).internetAccountId !== undefined\n  )\n}\n\nexport interface BlobLocation extends SnapshotIn<typeof MUBlobLocation> {}\n\nexport type FileLocation = LocalPathLocation | UriLocation | BlobLocation\n\n// These types are slightly different than the MST models representing a\n// location because a blob cannot be stored in a MST, so this is the\n// pre-processed file location\nexport type PreUriLocation = { uri: string }\nexport type PreLocalPathLocation = { localPath: string }\nexport type PreBlobLocation = { blob: File }\nexport type PreFileLocation =\n  | PreUriLocation\n  | PreLocalPathLocation\n  | PreBlobLocation\n","import { when as mobxWhen, IWhenOptions } from 'mobx'\nimport { makeAbortError } from './aborting'\n\ninterface WhenOpts extends IWhenOptions {\n  signal?: AbortSignal\n}\n\n/**\n * Wrapper for mobx `when` that adds timeout and aborting support.\n */\nexport function when(\n  getter: () => boolean,\n  { timeout, signal, name }: WhenOpts = {},\n) {\n  return new Promise((resolve, reject) => {\n    let finished = false\n\n    const whenPromise = mobxWhen(getter)\n\n    // set up timeout\n    let timeoutId: ReturnType<typeof setTimeout> | undefined\n    let finishTimeout = () => {}\n    if (timeout) {\n      timeoutId = setTimeout(() => {\n        if (!finished) {\n          finished = true\n          whenPromise.cancel()\n          reject(new Error(`timed out waiting for ${name || 'whenPresent'}`))\n        }\n      }, timeout)\n      finishTimeout = () => timeoutId && clearTimeout(timeoutId)\n    }\n\n    // set up aborting\n    if (signal) {\n      signal.addEventListener('abort', () => {\n        if (!finished) {\n          finished = true\n\n          // mobx when supports a cancel method\n          whenPromise.cancel()\n          finishTimeout()\n\n          reject(makeAbortError())\n        }\n      })\n    }\n\n    whenPromise\n      .then(() => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          resolve(true)\n        }\n      })\n      .catch(err => {\n        if (!finished) {\n          finished = true\n          finishTimeout()\n\n          reject(err)\n        }\n      })\n  })\n}\n\n/**\n * Wrapper for mobx `when` that makes a promise for the return value\n * of the given function at the point in time when it becomes not\n * undefined and not null.\n */\nexport async function whenPresent<FUNCTION extends () => unknown>(\n  getter: FUNCTION,\n  opts: WhenOpts = {},\n): Promise<NonNullable<ReturnType<FUNCTION>>> {\n  await when(() => {\n    const val = getter()\n    return val !== undefined && val !== null\n  }, opts)\n\n  return getter() as NonNullable<ReturnType<FUNCTION>>\n}\n","import {\n  isModelType,\n  isType,\n  types,\n  IAnyType,\n  IAnyModelType,\n} from 'mobx-state-tree'\n\n// Pluggable elements\nimport PluggableElementBase from './pluggableElementTypes/PluggableElementBase'\nimport RendererType from './pluggableElementTypes/renderers/RendererType'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport TrackType from './pluggableElementTypes/TrackType'\nimport DisplayType from './pluggableElementTypes/DisplayType'\nimport ViewType from './pluggableElementTypes/ViewType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport ConnectionType from './pluggableElementTypes/ConnectionType'\nimport RpcMethodType from './pluggableElementTypes/RpcMethodType'\nimport InternetAccountType from './pluggableElementTypes/InternetAccountType'\nimport TextSearchAdapterType from './pluggableElementTypes/TextSearchAdapterType'\nimport AddTrackWorkflowType from './pluggableElementTypes/AddTrackWorkflowType'\n\nimport {\n  ConfigurationSchema,\n  isBareConfigurationSchemaType,\n} from './configuration'\n\nimport Plugin from './Plugin'\nimport ReExports from './ReExports'\n\nimport {\n  PluggableElementType,\n  PluggableElementMember,\n} from './pluggableElementTypes'\nimport { AbstractRootModel } from './util'\nimport CorePlugin from './CorePlugin'\nimport createJexlInstance from './util/jexl'\nimport { PluginDefinition } from './PluginLoader'\n\n/** little helper class that keeps groups of callbacks that are\nthen run in a specified order by group */\nclass PhasedScheduler<PhaseName extends string> {\n  phaseCallbacks = new Map<PhaseName, Function[]>()\n\n  phaseOrder: PhaseName[] = []\n\n  constructor(...phaseOrder: PhaseName[]) {\n    this.phaseOrder = phaseOrder\n  }\n\n  add(phase: PhaseName, callback: Function) {\n    if (!this.phaseOrder.includes(phase)) {\n      throw new Error(`unknown phase ${phase}`)\n    }\n    let phaseCallbacks = this.phaseCallbacks.get(phase)\n    if (!phaseCallbacks) {\n      phaseCallbacks = []\n      this.phaseCallbacks.set(phase, phaseCallbacks)\n    }\n    phaseCallbacks.push(callback)\n  }\n\n  run() {\n    this.phaseOrder.forEach(phaseName => {\n      this.phaseCallbacks.get(phaseName)?.forEach(callback => callback())\n    })\n  }\n}\n\ntype PluggableElementTypeGroup =\n  | 'renderer'\n  | 'adapter'\n  | 'display'\n  | 'track'\n  | 'connection'\n  | 'view'\n  | 'widget'\n  | 'rpc method'\n  | 'internet account'\n  | 'text search adapter'\n  | 'add track workflow'\n\n/** internal class that holds the info for a certain element type */\nclass TypeRecord<ElementClass extends PluggableElementBase> {\n  registeredTypes: { [name: string]: ElementClass } = {}\n\n  constructor(\n    public typeName: string,\n    public baseClass: // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    | { new (...args: any[]): ElementClass }\n      // covers abstract class case\n      | (Function & {\n          prototype: ElementClass\n        }),\n  ) {}\n\n  add(name: string, t: ElementClass) {\n    this.registeredTypes[name] = t\n  }\n\n  has(name: string) {\n    return name in this.registeredTypes\n  }\n\n  get(name: string) {\n    if (!this.has(name)) {\n      throw new Error(\n        `${this.typeName} '${name}' not found, perhaps its plugin is not loaded or its plugin has not added it.`,\n      )\n    }\n    return this.registeredTypes[name]\n  }\n\n  all() {\n    return Object.values(this.registeredTypes)\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyFunction = (...args: any) => any\n\n/**\n * free-form string-to-unknown mapping of metadata related to the instance\n * of this plugin. `isCore` is typically set to `Boolean(true)` if the plugin was\n * loaded as part of the \"core\" set of plugins for this application.\n * Can also use this metadata to stash other things about why the plugin is\n * loaded, such as where it came from, what plugin depends on it, etc.\n */\nexport type PluginMetadata = Record<string, unknown>\n\nexport interface PluginLoadRecord {\n  metadata?: PluginMetadata\n  plugin: Plugin\n}\nexport interface RuntimePluginLoadRecord extends PluginLoadRecord {\n  definition: PluginDefinition\n}\n\nexport default class PluginManager {\n  plugins: Plugin[] = []\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl: any = createJexlInstance()\n\n  pluginMetadata: Record<string, PluginMetadata> = {}\n\n  runtimePluginDefinitions: PluginDefinition[] = []\n\n  elementCreationSchedule = new PhasedScheduler<PluggableElementTypeGroup>(\n    'renderer',\n    'adapter',\n    'text search adapter',\n    'display',\n    'track',\n    'connection',\n    'view',\n    'widget',\n    'rpc method',\n    'internet account',\n    'add track workflow',\n  ) as PhasedScheduler<PluggableElementTypeGroup> | undefined\n\n  rendererTypes = new TypeRecord('RendererType', RendererType)\n\n  adapterTypes = new TypeRecord('AdapterType', AdapterType)\n\n  textSearchAdapterTypes = new TypeRecord(\n    'TextSearchAdapterType',\n    TextSearchAdapterType,\n  )\n\n  trackTypes = new TypeRecord('TrackType', TrackType)\n\n  displayTypes = new TypeRecord('DisplayType', DisplayType)\n\n  connectionTypes = new TypeRecord('ConnectionType', ConnectionType)\n\n  viewTypes = new TypeRecord('ViewType', ViewType)\n\n  widgetTypes = new TypeRecord('WidgetType', WidgetType)\n\n  rpcMethods = new TypeRecord('RpcMethodType', RpcMethodType)\n\n  addTrackWidgets = new TypeRecord('AddTrackWorkflow', AddTrackWorkflowType)\n\n  internetAccountTypes = new TypeRecord(\n    'InternetAccountType',\n    InternetAccountType,\n  )\n\n  configured = false\n\n  rootModel?: AbstractRootModel\n\n  extensionPoints: Map<string, Function[]> = new Map()\n\n  constructor(initialPlugins: (Plugin | PluginLoadRecord)[] = []) {\n    // add the core plugin\n    this.addPlugin({ plugin: new CorePlugin(), metadata: { isCore: true } })\n\n    // add all the initial plugins\n    initialPlugins.forEach(plugin => {\n      this.addPlugin(plugin)\n    })\n  }\n\n  pluginConfigurationSchemas() {\n    const configurationSchemas: { [key: string]: unknown } = {}\n    this.plugins.forEach(plugin => {\n      if (plugin.configurationSchema) {\n        configurationSchemas[plugin.name] = plugin.configurationSchema\n      }\n    })\n    return configurationSchemas\n  }\n\n  addPlugin(load: Plugin | PluginLoadRecord | RuntimePluginLoadRecord) {\n    if (this.configured) {\n      throw new Error('JBrowse already configured, cannot add plugins')\n    }\n\n    // check for availability of 'install' and 'configure' as a proxy for being\n    // an 'instanceof Plugin'\n    const [plugin, metadata = {}] =\n      'install' in load && 'configure' in load\n        ? [load, {}]\n        : [load.plugin, load.metadata]\n\n    if (this.plugins.includes(plugin)) {\n      throw new Error('plugin already installed')\n    }\n\n    this.pluginMetadata[plugin.name] = metadata\n    if ('definition' in load) {\n      // @ts-ignore\n      this.runtimePluginDefinitions.push(load.definition as PluginDefinition)\n    }\n    plugin.install(this)\n    this.plugins.push(plugin)\n    return this\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find(p => p.name === name)\n  }\n\n  hasPlugin(name: string) {\n    return this.getPlugin(name) !== undefined\n  }\n\n  createPluggableElements() {\n    // run the creation callbacks for each element type in order.\n    // see elementCreationSchedule above for the creation order\n    if (this.elementCreationSchedule) {\n      this.elementCreationSchedule.run()\n      delete this.elementCreationSchedule\n    }\n    return this\n  }\n\n  setRootModel(rootModel: AbstractRootModel) {\n    this.rootModel = rootModel\n  }\n\n  configure() {\n    if (this.configured) {\n      throw new Error('already configured')\n    }\n\n    this.plugins.forEach(plugin => plugin.configure(this))\n\n    this.configured = true\n\n    return this\n  }\n\n  getElementTypeRecord(\n    groupName: PluggableElementTypeGroup,\n  ): TypeRecord<PluggableElementBase> {\n    switch (groupName) {\n      case 'adapter':\n        return this.adapterTypes\n      case 'text search adapter':\n        return this.textSearchAdapterTypes\n      case 'connection':\n        return this.connectionTypes\n      case 'widget':\n        return this.widgetTypes\n      case 'renderer':\n        return this.rendererTypes\n      case 'display':\n        return this.displayTypes\n      case 'track':\n        return this.trackTypes\n      case 'view':\n        return this.viewTypes\n      case 'rpc method':\n        return this.rpcMethods\n      case 'internet account':\n        return this.internetAccountTypes\n      case 'add track workflow':\n        return this.addTrackWidgets\n      default:\n        throw new Error(`invalid element type '${groupName}'`)\n    }\n  }\n\n  addElementType(\n    groupName: PluggableElementTypeGroup,\n    creationCallback: (pluginManager: PluginManager) => PluggableElementType,\n  ) {\n    if (typeof creationCallback !== 'function') {\n      throw new Error(\n        'must provide a callback function that returns the new type object',\n      )\n    }\n    const typeRecord = this.getElementTypeRecord(groupName)\n\n    this.elementCreationSchedule?.add(groupName, () => {\n      const newElement = creationCallback(this)\n      if (!newElement.name) {\n        throw new Error(`cannot add a ${groupName} with no name`)\n      }\n\n      if (typeRecord.has(newElement.name)) {\n        throw new Error(\n          `${groupName} ${newElement.name} already registered, cannot register it again`,\n        )\n      }\n\n      typeRecord.add(\n        newElement.name,\n        this.evaluateExtensionPoint(\n          'Core-extendPluggableElement',\n          newElement,\n        ) as PluggableElementType,\n      )\n    })\n\n    return this\n  }\n\n  getElementType(groupName: PluggableElementTypeGroup, typeName: string) {\n    return this.getElementTypeRecord(groupName).get(typeName)\n  }\n\n  getElementTypesInGroup(groupName: PluggableElementTypeGroup) {\n    return this.getElementTypeRecord(groupName).all()\n  }\n\n  getRpcElements() {\n    return this.getElementTypesInGroup('rpc method') as RpcMethodType[]\n  }\n\n  /** get a MST type for the union of all specified pluggable MST types */\n  pluggableMstType(\n    groupName: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember,\n    fallback: IAnyType = types.maybe(types.null),\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(groupName)\n      .all()\n      // @ts-ignore\n      .map(t => t[fieldName])\n      .filter(t => isType(t) && isModelType(t)) as IAnyType[]\n\n    // try to smooth over the case when no types are registered, mostly\n    // encountered in tests\n    if (pluggableTypes.length === 0) {\n      console.warn(\n        `No pluggable types found matching ('${groupName}','${fieldName}')`,\n      )\n      return fallback\n    }\n    return types.union(...pluggableTypes)\n  }\n\n  /** get a MST type for the union of all specified pluggable config schemas */\n  pluggableConfigSchemaType(\n    typeGroup: PluggableElementTypeGroup,\n    fieldName: PluggableElementMember = 'configSchema',\n  ) {\n    const pluggableTypes = this.getElementTypeRecord(typeGroup)\n      .all()\n      // @ts-ignore\n      .map(t => t[fieldName])\n      .filter(t => isBareConfigurationSchemaType(t)) as IAnyType[]\n\n    if (pluggableTypes.length === 0) {\n      pluggableTypes.push(ConfigurationSchema('Null', {}))\n    }\n    return types.union(...pluggableTypes) as IAnyModelType\n  }\n\n  jbrequireCache = new Map()\n\n  lib = ReExports\n\n  load = <FTYPE extends AnyFunction>(lib: FTYPE): ReturnType<FTYPE> => {\n    if (!this.jbrequireCache.has(lib)) {\n      this.jbrequireCache.set(lib, lib(this))\n    }\n    return this.jbrequireCache.get(lib)\n  }\n\n  /**\n   * Get the re-exported version of the given package name.\n   * Throws an error if the package is not re-exported by the plugin manager.\n   *\n   * @returns the library's default export\n   */\n  jbrequire = (\n    lib: keyof typeof ReExports | AnyFunction | { default: AnyFunction },\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ): any => {\n    if (typeof lib === 'string') {\n      const pack = this.lib[lib]\n      if (!pack) {\n        throw new TypeError(\n          `No jbrequire re-export defined for package '${lib}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`,\n        )\n      }\n      return pack\n    }\n\n    if (typeof lib === 'function') {\n      return this.load(lib)\n    }\n\n    if (lib.default) {\n      return this.jbrequire(lib.default)\n    }\n\n    throw new TypeError(\n      'lib passed to jbrequire must be either a string or a function',\n    )\n  }\n\n  getRendererType(typeName: string): RendererType {\n    return this.rendererTypes.get(typeName)\n  }\n\n  getRendererTypes(): RendererType[] {\n    return this.rendererTypes.all()\n  }\n\n  getAdapterType(typeName: string): AdapterType {\n    return this.adapterTypes.get(typeName)\n  }\n\n  getTextSearchAdapterType(typeName: string): TextSearchAdapterType {\n    return this.textSearchAdapterTypes.get(typeName)\n  }\n\n  getTrackType(typeName: string): TrackType {\n    return this.trackTypes.get(typeName)\n  }\n\n  getDisplayType(typeName: string): DisplayType {\n    return this.displayTypes.get(typeName)\n  }\n\n  getViewType(typeName: string): ViewType {\n    return this.viewTypes.get(typeName)\n  }\n\n  getAddTrackWorkflow(typeName: string): AddTrackWorkflowType {\n    return this.addTrackWidgets.get(typeName)\n  }\n\n  getWidgetType(typeName: string): WidgetType {\n    return this.widgetTypes.get(typeName)\n  }\n\n  getConnectionType(typeName: string): ConnectionType {\n    return this.connectionTypes.get(typeName)\n  }\n\n  getRpcMethodType(methodName: string): RpcMethodType {\n    return this.rpcMethods.get(methodName)\n  }\n\n  getInternetAccountType(name: string): InternetAccountType {\n    return this.internetAccountTypes.get(name)\n  }\n\n  addRendererType(cb: (pm: PluginManager) => RendererType) {\n    return this.addElementType('renderer', cb)\n  }\n\n  addAdapterType(cb: (pm: PluginManager) => AdapterType) {\n    return this.addElementType('adapter', cb)\n  }\n\n  addTextSearchAdapterType(cb: (pm: PluginManager) => TextSearchAdapterType) {\n    return this.addElementType('text search adapter', cb)\n  }\n\n  addTrackType(cb: (pm: PluginManager) => TrackType) {\n    // Goes through the already-created displays and registers the ones that\n    // specify this track type\n    const callback = () => {\n      const track = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      displays.forEach(display => {\n        // track may have already added the displayType in its cb\n        if (\n          display.trackType === track.name &&\n          !track.displayTypes.includes(display)\n        ) {\n          track.addDisplayType(display)\n        }\n      })\n      return track\n    }\n    return this.addElementType('track', callback)\n  }\n\n  addDisplayType(cb: (pluginManager: PluginManager) => DisplayType) {\n    return this.addElementType('display', cb)\n  }\n\n  addViewType(cb: (pluginManager: PluginManager) => ViewType) {\n    const callback = () => {\n      const newView = cb(this)\n      const displays = this.getElementTypesInGroup('display') as DisplayType[]\n      displays.forEach(display => {\n        // view may have already added the displayType in its callback\n        // see ViewType for description of extendedName\n        if (\n          (display.viewType === newView.name ||\n            display.viewType === newView.extendedName) &&\n          !newView.displayTypes.includes(display)\n        ) {\n          newView.addDisplayType(display)\n        }\n      })\n      return newView\n    }\n    return this.addElementType('view', callback)\n  }\n\n  addWidgetType(cb: (pm: PluginManager) => WidgetType) {\n    return this.addElementType('widget', cb)\n  }\n\n  addConnectionType(cb: (pm: PluginManager) => ConnectionType) {\n    return this.addElementType('connection', cb)\n  }\n\n  addRpcMethod(cb: (pm: PluginManager) => RpcMethodType) {\n    return this.addElementType('rpc method', cb)\n  }\n\n  addInternetAccountType(cb: (pm: PluginManager) => InternetAccountType) {\n    return this.addElementType('internet account', cb)\n  }\n\n  addAddTrackWorkflowType(cb: (pm: PluginManager) => AddTrackWorkflowType) {\n    return this.addElementType('add track workflow', cb)\n  }\n\n  addToExtensionPoint<T>(\n    extensionPointName: string,\n    callback: (extendee: T, props: Record<string, unknown>) => T,\n  ) {\n    let callbacks = this.extensionPoints.get(extensionPointName)\n    if (!callbacks) {\n      callbacks = []\n      this.extensionPoints.set(extensionPointName, callbacks)\n    }\n    callbacks.push(callback)\n  }\n\n  evaluateExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n\n  async evaluateAsyncExtensionPoint(\n    extensionPointName: string,\n    extendee: unknown,\n    props?: Record<string, unknown>,\n  ) {\n    const callbacks = this.extensionPoints.get(extensionPointName)\n    let accumulator = extendee\n    if (callbacks) {\n      for (const callback of callbacks) {\n        try {\n          accumulator = await callback(accumulator, props)\n        } catch (error) {\n          console.error(error)\n        }\n      }\n    }\n    return accumulator\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { readConfObject } from '../configuration'\nimport { isElectron } from '../util'\n\ninterface AnalyticsObj {\n  [key: string]: any\n}\n\ninterface Track {\n  [key: string]: any\n}\n\nexport async function writeAWSAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n  sessionQuery?: string | null,\n) {\n  try {\n    const url = 'https://analytics.jbrowse.org/api/v1'\n\n    const multiAssemblyTracks = rootModel.jbrowse.tracks.filter(\n      (track: any) => (readConfObject(track, 'assemblyNames') || []).length > 1,\n    ).length\n\n    const savedSessionCount = Object.keys(localStorage).filter(name =>\n      name.includes('localSaved-'),\n    ).length\n\n    const { jbrowse: config, session, version: ver } = rootModel\n    const { tracks, assemblies, plugins } = config\n\n    // stats to be recorded in db\n    const stats: AnalyticsObj = {\n      ver,\n      'plugins-count': plugins?.length || 0,\n      'plugin-names': plugins?.map((p: any) => p.name).join(','),\n      'assemblies-count': assemblies.length,\n      'tracks-count': tracks.length,\n      'session-tracks-count': session?.sessionTracks.length || 0,\n      'open-views': session?.views.length || 0,\n      'synteny-tracks-count': multiAssemblyTracks,\n      'saved-sessions-count': savedSessionCount,\n\n      // field if existing session param in query before autogenerated param\n      'existing-session-param-type': sessionQuery?.split('-')[0] || 'none',\n\n      // screen geometry\n      'scn-h': window.screen.height,\n      'scn-w': window.screen.width,\n\n      // window geometry\n      'win-h': window.innerHeight,\n      'win-w': window.innerWidth,\n\n      electron: isElectron,\n      loadTime: (Date.now() - initialTimeStamp) / 1000,\n      jb2: true,\n    }\n\n    // stringifies the track type counts, gets processed in lambda\n    tracks.forEach((track: Track) => {\n      const key = `track-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // stringifies the session track type counts, gets processed in lambda\n    session?.sessionTracks.forEach((track: Track) => {\n      const key = `sessionTrack-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // put stats into a query string for get request\n    const qs = Object.keys(stats)\n      .map(key => `${key}=${stats[key]}`)\n      .join('&')\n\n    await fetch(`${url}?${qs}`)\n  } catch (e) {\n    console.error('Failed to write analytics to AWS.', e)\n  }\n}\n\nexport async function writeGAAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n) {\n  const jbrowseUser = 'UA-7115575-5'\n  const stats: AnalyticsObj = {\n    'tracks-count': rootModel.jbrowse.tracks.length, // this is all possible tracks\n    ver: rootModel.version,\n    electron: isElectron,\n    loadTime: Date.now() - initialTimestamp,\n    pluginNames:\n      rootModel.jbrowse.plugins?.map((plugin: any) => plugin.name) || '',\n  }\n\n  // create script\n  let analyticsScript =\n    \"(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\"\n  analyticsScript +=\n    '(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),'\n  analyticsScript +=\n    'm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)'\n  analyticsScript +=\n    \"})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\"\n  analyticsScript += `ga('create', '${jbrowseUser}', 'auto', 'jbrowseTracker');`\n\n  const gaData: AnalyticsObj = {}\n  const googleDimensions = 'tracks-count ver electron loadTime pluginNames'\n\n  googleDimensions.split(/\\s+/).forEach((key, index) => {\n    gaData[`dimension${index + 1}`] = stats[key]\n  })\n\n  gaData.metric1 = Math.round(stats.loadTime)\n\n  analyticsScript += `ga('jbrowseTracker.send', 'pageview',${JSON.stringify(\n    gaData,\n  )});`\n\n  const analyticsScriptNode = document.createElement('script')\n  analyticsScriptNode.innerHTML = analyticsScript\n\n  document.getElementsByTagName('head')[0].appendChild(analyticsScriptNode)\n}\n\nexport function doAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n  initialSessionQuery: string | null | undefined,\n) {\n  if (\n    rootModel &&\n    !readConfObject(rootModel.jbrowse.configuration, 'disableAnalytics')\n  ) {\n    writeAWSAnalytics(rootModel, initialTimestamp, initialSessionQuery)\n    writeGAAnalytics(rootModel, initialTimestamp)\n  }\n}\n","import { lazy } from 'react'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as ucscConfigSchema,\n  modelFactory as ucscModelFactory,\n} from './ucsc-trackhub'\nimport {\n  stateModelFactory as AddTrackStateModelFactory,\n  configSchema as AddTrackConfigSchema,\n} from './AddTrackWidget'\nimport { AddTrackModel } from './AddTrackWidget/model'\nimport {\n  stateModel as AddConnectionStateModel,\n  configSchema as AddConnectionConfigSchema,\n} from './AddConnectionWidget'\nimport {\n  stateModelFactory as HierarchicalTrackSelectorStateModelFactory,\n  configSchema as HierarchicalTrackSelectorConfigSchema,\n  HierarchicalTrackSelectorModel,\n} from './HierarchicalTrackSelectorWidget'\nimport {\n  stateModelFactory as PluginStoreStateModelFactory,\n  configSchema as PluginStoreConfigSchema,\n} from './PluginStoreWidget'\n\nconst SetDefaultSession = lazy(() => import('./SetDefaultSession'))\n\nconst AssemblyManager = lazy(() => import('./AssemblyManager'))\n\nexport default class extends Plugin {\n  name = 'DataManagementPlugin'\n\n  exports = {\n    AssemblyManager,\n    SetDefaultSession,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'UCSCTrackHubConnection',\n          configSchema: ucscConfigSchema,\n          stateModel: ucscModelFactory(pluginManager),\n          displayName: 'UCSC Track Hub',\n          description: 'A track or assembly hub in the Track Hub format',\n          url: '//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro',\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HierarchicalTrackSelectorWidget',\n        heading: 'Available tracks',\n        configSchema: HierarchicalTrackSelectorConfigSchema,\n        stateModel: HierarchicalTrackSelectorStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () =>\n            import(\n              './HierarchicalTrackSelectorWidget/components/HierarchicalTrackSelector'\n            ),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddTrackWidget',\n        heading: 'Add a track',\n        configSchema: AddTrackConfigSchema,\n        stateModel: AddTrackStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./AddTrackWidget/components/AddTrackWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AddConnectionWidget',\n        heading: 'Add a connection',\n        configSchema: AddConnectionConfigSchema,\n        stateModel: AddConnectionStateModel,\n        ReactComponent: lazy(\n          () => import('./AddConnectionWidget/components/AddConnectionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'PluginStoreWidget',\n        heading: 'Plugin store',\n        configSchema: PluginStoreConfigSchema,\n        stateModel: PluginStoreStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./PluginStoreWidget/components/PluginStoreWidget'),\n        ),\n      })\n    })\n  }\n\n  configure(_pluginManager: PluginManager) {}\n}\n\nexport { AssemblyManager, SetDefaultSession }\nexport type { HierarchicalTrackSelectorModel, AddTrackModel }\n","import Alignments from '@jbrowse/plugin-alignments'\nimport Authentication from '@jbrowse/plugin-authentication'\nimport Bed from '@jbrowse/plugin-bed'\nimport BreakpointSplitView from '@jbrowse/plugin-breakpoint-split-view'\nimport CircularView from '@jbrowse/plugin-circular-view'\nimport Config from '@jbrowse/plugin-config'\nimport ComparativeAdapters from '@jbrowse/plugin-comparative-adapters'\nimport DataManagement from '@jbrowse/plugin-data-management'\nimport DotplotView from '@jbrowse/plugin-dotplot-view'\nimport GtfPlugin from '@jbrowse/plugin-gtf'\nimport Gff3 from '@jbrowse/plugin-gff3'\nimport LegacyJBrowse from '@jbrowse/plugin-legacy-jbrowse'\nimport LinearGenomeView from '@jbrowse/plugin-linear-genome-view'\nimport LinearComparativeView from '@jbrowse/plugin-linear-comparative-view'\nimport Lollipop from '@jbrowse/plugin-lollipop'\nimport Arc from '@jbrowse/plugin-arc'\nimport Menus from '@jbrowse/plugin-menus'\nimport RDF from '@jbrowse/plugin-rdf'\nimport Sequence from '@jbrowse/plugin-sequence'\nimport SVG from '@jbrowse/plugin-svg'\nimport TrackHubRegistry from '@jbrowse/plugin-trackhub-registry'\nimport Variants from '@jbrowse/plugin-variants'\nimport Wiggle from '@jbrowse/plugin-wiggle'\nimport GCContent from '@jbrowse/plugin-gccontent'\nimport SpreadsheetViewPlugin from '@jbrowse/plugin-spreadsheet-view'\nimport SvInspectorPlugin from '@jbrowse/plugin-sv-inspector'\nimport HicPlugin from '@jbrowse/plugin-hic'\nimport TrixPlugin from '@jbrowse/plugin-trix'\nimport GridBookmarkPlugin from '@jbrowse/plugin-grid-bookmark'\n\nconst corePlugins = [\n  SVG,\n  LinearGenomeView,\n  Alignments,\n  Authentication,\n  Bed,\n  CircularView,\n  Config,\n  DataManagement,\n  DotplotView,\n  GtfPlugin,\n  Gff3,\n  LegacyJBrowse,\n  LinearComparativeView,\n  Lollipop,\n  Arc,\n  Menus,\n  RDF,\n  Sequence,\n  TrackHubRegistry,\n  Variants,\n  Wiggle,\n  GCContent,\n  SpreadsheetViewPlugin,\n  SvInspectorPlugin,\n  BreakpointSplitView,\n  HicPlugin,\n  TrixPlugin,\n  GridBookmarkPlugin,\n  ComparativeAdapters,\n]\n\nexport default corePlugins\n","import {\n  getPropertyMembers,\n  getChildType,\n  isArrayType,\n  isModelType,\n  isReferenceType,\n  isValidReference,\n  isMapType,\n  types,\n  IAnyType,\n  IAnyStateTreeNode,\n  Instance,\n} from 'mobx-state-tree'\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nexport function b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport async function fromUrlSafeB64(b64: string) {\n  const originalB64 = b64PadSuffix(b64.replace(/-/g, '+').replace(/_/g, '/'))\n  const { toByteArray } = await import('base64-js')\n  const { inflate } = await import('pako')\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes)\n  return new TextDecoder().decode(inflated)\n}\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport async function toUrlSafeB64(str: string) {\n  const bytes = new TextEncoder().encode(str)\n  const { deflate } = await import('pako')\n  const { fromByteArray } = await import('base64-js')\n  const deflated = deflate(bytes)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replace(/\\+/g, '-').replace(/\\//g, '_')\n    : encoded.replace(/\\+/g, '-').replace(/\\//g, '_')\n}\n\ntype MSTArray = Instance<ReturnType<typeof types.array>>\ntype MSTMap = Instance<ReturnType<typeof types.map>>\n\n// attempts to remove undefined references from the given MST model. can only actually\n// remove them from arrays and maps. throws MST undefined ref error if it encounters\n// undefined refs in model properties\nexport function filterSessionInPlace(node: IAnyStateTreeNode, type: IAnyType) {\n  // makes it work with session sharing\n  if (node === undefined) {\n    return\n  }\n  if (isArrayType(type)) {\n    const array = node as MSTArray\n    const childType = getChildType(node)\n    if (isReferenceType(childType)) {\n      // filter array elements\n      for (let i = 0; i < array.length; ) {\n        if (!isValidReference(() => array[i])) {\n          array.splice(i, 1)\n        } else {\n          i += 1\n        }\n      }\n    }\n    array.forEach(el => {\n      filterSessionInPlace(el, childType)\n    })\n  } else if (isMapType(type)) {\n    const map = node as MSTMap\n    const childType = getChildType(map)\n    if (isReferenceType(childType)) {\n      // filter the map members\n      for (const key in map.keys()) {\n        if (!isValidReference(() => map.get(key))) {\n          map.delete(key)\n        }\n      }\n    }\n    map.forEach(child => {\n      filterSessionInPlace(child, childType)\n    })\n  } else if (isModelType(type)) {\n    // iterate over children\n    const { properties } = getPropertyMembers(node)\n\n    Object.entries(properties).forEach(([pname, ptype]) => {\n      // @ts-ignore\n      filterSessionInPlace(node[pname], ptype)\n    })\n  }\n}\n","import { toUrlSafeB64 } from './util'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      Array.from(window.crypto.getRandomValues(new Uint8Array(length * 2)))\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replace(/[+/]/g, '')\n    .substring(0, length)\n}\n\nconst encrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  const Utf8 = await import('crypto-js/enc-utf8')\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${sessionId}`\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n","import React, { useState, useEffect } from 'react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport copy from 'copy-to-clipboard'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Divider,\n  IconButton,\n  FormControl,\n  FormControlLabel,\n  Radio,\n  RadioGroup,\n  TextField,\n  Typography,\n} from '@mui/material'\n\nimport { alpha } from '@mui/material/styles'\nimport { makeStyles } from 'tss-react/mui'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\n\n// icons\nimport ShareIcon from '@mui/icons-material/Share'\nimport HelpOutlineIcon from '@mui/icons-material/HelpOutline'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport CloseIcon from '@mui/icons-material/Close'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\n\n// locals\nimport { toUrlSafeB64 } from './util'\nimport { shareSessionToDynamo } from './sessionSharing'\n\nconst useStyles = makeStyles()(theme => ({\n  shareDiv: {\n    textAlign: 'center',\n    paddingLeft: '2px',\n  },\n  shareButton: {\n    backgroundColor: alpha(\n      theme.palette.primary.contrastText,\n      theme.palette.action.hoverOpacity,\n    ),\n    '&:hover': {\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nconst SHARE_URL_LOCALSTORAGE_KEY = 'jbrowse-shareURL'\n\nfunction SettingsDialog(props: {\n  open: boolean\n  onClose: Function\n  currentSetting: string\n}) {\n  const { classes } = useStyles()\n  const { onClose, open, currentSetting } = props\n  const [setting, setSetting] = useState(currentSetting)\n  const [infoDialogOpen, setInfoDialogOpen] = useState(false)\n\n  const handleClose = () => {\n    localStorage.setItem(SHARE_URL_LOCALSTORAGE_KEY, setting)\n    onClose(setting)\n  }\n\n  return (\n    <>\n      <Dialog onClose={handleClose} open={open}>\n        <DialogTitle>\n          Configure session sharing\n          {handleClose ? (\n            <IconButton className={classes.closeButton} onClick={handleClose}>\n              <CloseIcon />\n            </IconButton>\n          ) : null}\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Select between generating long or short URLs for the session sharing\n            <IconButton onClick={() => setInfoDialogOpen(true)}>\n              <HelpOutlineIcon />\n            </IconButton>\n          </DialogContentText>\n          <FormControl component=\"fieldset\">\n            <RadioGroup\n              value={setting}\n              onChange={event => {\n                const val = event.target.value\n                setSetting(val)\n              }}\n            >\n              <FormControlLabel\n                value=\"short\"\n                control={<Radio />}\n                label=\"Short URL\"\n              />\n              <FormControlLabel\n                value=\"long\"\n                control={<Radio />}\n                label=\"Long URL\"\n              />\n            </RadioGroup>\n          </FormControl>\n        </DialogContent>\n      </Dialog>\n      <InfoDialog\n        open={infoDialogOpen}\n        onClose={() => {\n          setInfoDialogOpen(false)\n        }}\n      />\n    </>\n  )\n}\nfunction InfoDialog(props: { open: boolean; onClose: Function }) {\n  const { classes } = useStyles()\n  const { onClose, open } = props\n\n  const handleClose = () => {\n    onClose()\n  }\n\n  return (\n    <Dialog onClose={handleClose} open={open}>\n      <DialogTitle id=\"simple-dialog-title\">\n        Info about session URLs\n        {onClose ? (\n          <IconButton className={classes.closeButton} onClick={handleClose}>\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Because everything about the JBrowse session is encoded in the URL\n          (e.g. state of the tracks, views, features selected, etc.) the\n          sessions can get very long. Therefore, we created a URL shortener,\n          both as a convenience and because long URLs can break some programs.\n          Note that both the long and short URLs encode the same data, but due\n          to long URLs causing problems with some programs, we recommend sharing\n          short URLs.\n        </DialogContentText>\n        <DialogContentText>\n          We generate the short URLs in a secure manner which involves\n          encrypting the session on the client side with a random password\n          string and uploading them to a central database. Then the random\n          password is added to the URL but is not uploaded to the central\n          database, making these short URLs effectively &quot;end-to-end\n          encrypted&quot;\n        </DialogContentText>\n        <DialogContentText>\n          Only users with a share link can read the session.\n        </DialogContentText>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst ShareDialog = observer(\n  ({\n    handleClose,\n    session,\n  }: {\n    handleClose: () => void\n    session: AbstractSessionModel & { shareURL: string }\n  }) => {\n    const { classes } = useStyles()\n    const [shortUrl, setShortUrl] = useState('')\n    const [longUrl, setLongUrl] = useState('')\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState<unknown>()\n    const [settingsDialogOpen, setSettingsDialogOpen] = useState(false)\n\n    const url = session.shareURL\n    const currentSetting =\n      localStorage.getItem(SHARE_URL_LOCALSTORAGE_KEY) || 'short'\n    const snap = getSnapshot(session)\n\n    useEffect(() => {\n      let cancelled = false\n      ;(async () => {\n        if (currentSetting === 'short') {\n          try {\n            setLoading(true)\n            const locationUrl = new URL(window.location.href)\n            const result = await shareSessionToDynamo(\n              snap,\n              url,\n              locationUrl.href,\n            )\n            if (!cancelled) {\n              const params = new URLSearchParams(locationUrl.search)\n              params.set('session', `share-${result.json.sessionId}`)\n              params.set('password', result.password)\n              locationUrl.search = params.toString()\n              setShortUrl(locationUrl.href)\n            }\n          } catch (e) {\n            setError(e)\n          } finally {\n            setLoading(false)\n          }\n        }\n      })()\n\n      return () => {\n        cancelled = true\n      }\n    }, [currentSetting, url, snap])\n\n    useEffect(() => {\n      let cancelled = false\n      ;(async () => {\n        try {\n          // generate long URL\n          const sess = await toUrlSafeB64(JSON.stringify(getSnapshot(session)))\n          const longUrl = new URL(window.location.href)\n          const longParams = new URLSearchParams(longUrl.search)\n          longParams.set('session', `encoded-${sess}`)\n          longUrl.search = longParams.toString()\n          if (!cancelled) {\n            setLongUrl(longUrl.toString())\n          }\n        } catch (e) {\n          setError(e)\n        }\n      })()\n      return () => {\n        cancelled = true\n      }\n    }, [session])\n\n    return (\n      <>\n        <Dialog\n          maxWidth=\"xl\"\n          open\n          onClose={handleClose}\n          data-testid=\"share-dialog\"\n        >\n          <DialogTitle>\n            JBrowse Shareable Link\n            {handleClose ? (\n              <IconButton className={classes.closeButton} onClick={handleClose}>\n                <CloseIcon />\n              </IconButton>\n            ) : null}\n          </DialogTitle>\n          <Divider />\n\n          <DialogContent>\n            <DialogContentText>\n              Copy the URL below to share your current JBrowse session.\n              <IconButton onClick={() => setSettingsDialogOpen(true)}>\n                <SettingsIcon />\n              </IconButton>\n            </DialogContentText>\n\n            {currentSetting === 'short' ? (\n              error ? (\n                <Typography color=\"error\">{`${error}`}</Typography>\n              ) : loading ? (\n                <Typography>Generating short URL...</Typography>\n              ) : (\n                <TextField\n                  label=\"URL\"\n                  value={shortUrl}\n                  InputProps={{\n                    readOnly: true,\n                  }}\n                  inputProps={{ 'data-testid': 'share-url-text' }}\n                  variant=\"filled\"\n                  style={{ width: '100%' }}\n                  onClick={event => {\n                    const target = event.target as HTMLTextAreaElement\n                    target.select()\n                  }}\n                  data-testid=\"share-url-field\"\n                />\n              )\n            ) : (\n              <TextField\n                label=\"URL\"\n                value={longUrl}\n                InputProps={{\n                  readOnly: true,\n                }}\n                variant=\"filled\"\n                style={{ width: '100%' }}\n                onClick={event => {\n                  const target = event.target as HTMLTextAreaElement\n                  target.select()\n                }}\n              />\n            )}\n          </DialogContent>\n          <DialogActions>\n            <Button\n              onClick={() => {\n                copy(shortUrl || longUrl.toString())\n                session.notify('Copied to clipboard', 'success')\n              }}\n              color=\"primary\"\n              startIcon={<ContentCopyIcon />}\n              disabled={currentSetting === 'short' && loading}\n            >\n              Copy URL to Clipboard\n            </Button>\n\n            <Button onClick={handleClose} color=\"primary\" autoFocus>\n              Close\n            </Button>\n          </DialogActions>\n        </Dialog>\n\n        <SettingsDialog\n          open={settingsDialogOpen}\n          onClose={() => {\n            setSettingsDialogOpen(false)\n          }}\n          currentSetting={currentSetting}\n        />\n      </>\n    )\n  },\n)\n\nconst ShareButton = observer(\n  (props: { session: AbstractSessionModel & { shareURL: string } }) => {\n    const [open, setOpen] = useState(false)\n\n    const { session } = props\n    const { classes } = useStyles()\n\n    const handleClose = () => {\n      setOpen(false)\n    }\n\n    return (\n      <div className={classes.shareDiv}>\n        <Button\n          data-testid=\"share_button\"\n          onClick={async () => setOpen(true)}\n          size=\"small\"\n          color=\"inherit\"\n          startIcon={<ShareIcon />}\n          classes={{ root: classes.shareButton }}\n        >\n          Share\n        </Button>\n        {open ? (\n          <ShareDialog handleClose={handleClose} session={session} />\n        ) : null}\n      </div>\n    )\n  },\n)\n\nexport default ShareButton\n","import React from 'react'\nimport type PluginManager from '@jbrowse/core/PluginManager'\nimport { AppRootModel } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\nimport {\n  AssemblyManager,\n  SetDefaultSession,\n} from '@jbrowse/plugin-data-management'\n\nfunction AdminComponent({ pluginManager }: { pluginManager: PluginManager }) {\n  const { rootModel } = pluginManager\n\n  const {\n    isAssemblyEditing,\n    isDefaultSessionEditing,\n    setDefaultSessionEditing,\n    setAssemblyEditing,\n  } = rootModel as AppRootModel\n\n  return (\n    <>\n      {isAssemblyEditing ? (\n        <AssemblyManager\n          rootModel={rootModel}\n          onClose={() => setAssemblyEditing(false)}\n        />\n      ) : null}\n      {isDefaultSessionEditing ? (\n        <SetDefaultSession\n          rootModel={rootModel}\n          onClose={() => setDefaultSessionEditing(false)}\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(AdminComponent)\n","import React, { useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { onSnapshot } from 'mobx-state-tree'\nimport { useQueryParam, StringParam } from 'use-query-params'\nimport { CssBaseline } from '@mui/material'\nimport { ThemeProvider } from '@mui/material/styles'\n\n// core\nimport { getConf } from '@jbrowse/core/configuration'\nimport { App, createJBrowseTheme } from '@jbrowse/core/ui'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport ShareButton from './ShareButton'\nimport AdminComponent from './AdminComponent'\nimport { SessionModel } from './sessionModelFactory'\n\nimport './JBrowse.css'\n\nconst JBrowse = observer(\n  ({ pluginManager }: { pluginManager: PluginManager }) => {\n    const [adminKey] = useQueryParam('adminKey', StringParam)\n    const [adminServer] = useQueryParam('adminServer', StringParam)\n    const [configPath] = useQueryParam('config', StringParam)\n    const [, setSessionId] = useQueryParam('session', StringParam)\n    const { rootModel } = pluginManager\n    const { error, jbrowse } = rootModel || {}\n    const session = rootModel?.session as SessionModel\n    const currentSessionId = session.id\n\n    useEffect(() => {\n      setSessionId(`local-${currentSessionId}`)\n      // @ts-ignore\n      window.JBrowseRootModel = rootModel\n      // @ts-ignore\n      window.JBrowseSession = session\n    }, [currentSessionId, rootModel, session, setSessionId])\n\n    useEffect(() => {\n      if (!jbrowse || !adminKey) {\n        return\n      }\n      return onSnapshot(jbrowse, async snapshot => {\n        try {\n          const response = await fetch(adminServer || `/updateConfig`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              adminKey,\n              configPath,\n              config: snapshot,\n            }),\n          })\n          if (!response.ok) {\n            const message = await response.text()\n            throw new Error(`HTTP ${response.status} (${message})`)\n          }\n        } catch (e) {\n          session?.notify(`Admin server error: ${e}`)\n        }\n      })\n    }, [jbrowse, session, adminKey, adminServer, configPath])\n\n    if (error) {\n      throw error\n    }\n    if (!rootModel) {\n      throw new Error('No rootModel found')\n    }\n    if (!session) {\n      throw new Error('No session found')\n    }\n\n    const theme = getConf(rootModel.jbrowse, 'theme')\n    return (\n      <ThemeProvider theme={createJBrowseTheme(theme)}>\n        <CssBaseline />\n        <App\n          session={session}\n          HeaderButtons={<ShareButton session={session} />}\n        />\n        {adminKey ? <AdminComponent pluginManager={pluginManager} /> : null}\n      </ThemeProvider>\n    )\n  },\n)\n\nexport default JBrowse\n","import { getParent, types, Instance, IAnyType } from 'mobx-state-tree'\nimport jsonStableStringify from 'json-stable-stringify'\nimport AbortablePromiseCache from 'abortable-promise-cache'\n\n// locals\nimport { getConf, AnyConfigurationModel } from '../configuration'\nimport {\n  BaseRefNameAliasAdapter,\n  RegionsAdapter,\n} from '../data_adapters/BaseAdapter'\nimport PluginManager from '../PluginManager'\nimport { when, Region, Feature } from '../util'\nimport QuickLRU from '../util/QuickLRU'\n\nconst refNameRegex = new RegExp(\n  '[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*',\n)\n\n// Based on the UCSC Genome Browser chromosome color palette:\n// https://github.com/ucscGenomeBrowser/kent/blob/a50ed53aff81d6fb3e34e6913ce18578292bc24e/src/hg/inc/chromColors.h\n// Some colors darkened to have at least a 3:1 contrast ratio on a white\n// background\nconst refNameColors = [\n  'rgb(153, 102, 0)',\n  'rgb(102, 102, 0)',\n  'rgb(153, 153, 30)',\n  'rgb(204, 0, 0)',\n  'rgb(255, 0, 0)',\n  'rgb(255, 0, 204)',\n  'rgb(165, 132, 132)', // originally 'rgb(255, 204, 204)'\n  'rgb(204, 122, 0)', // originally rgb(255, 153, 0)'\n  'rgb(178, 142, 0)', // originally 'rgb(255, 204, 0)'\n  'rgb(153, 153, 0)', // originally 'rgb(255, 255, 0)'\n  'rgb(122, 153, 0)', // originally 'rgb(204, 255, 0)'\n  'rgb(0, 165, 0)', // originally 'rgb(0, 255, 0)'\n  'rgb(53, 128, 0)',\n  'rgb(0, 0, 204)',\n  'rgb(96, 145, 242)', // originally 'rgb(102, 153, 255)'\n  'rgb(107, 142, 178)', // originally 'rgb(153, 204, 255)'\n  'rgb(0, 165, 165)', // originally 'rgb(0, 255, 255)'\n  'rgb(122, 153, 153)', // originally 'rgb(204, 255, 255)'\n  'rgb(153, 0, 204)',\n  'rgb(204, 51, 255)',\n  'rgb(173, 130, 216)', // originally 'rgb(204, 153, 255)'\n  'rgb(102, 102, 102)',\n  'rgb(145, 145, 145)', // originally 'rgb(153, 153, 153)'\n  'rgb(142, 142, 142)', // originally 'rgb(204, 204, 204)'\n  'rgb(142, 142, 107)', // originally 'rgb(204, 204, 153)'\n  'rgb(96, 163, 48)', // originally 'rgb(121, 204, 61)'\n]\n\nasync function loadRefNameMap(\n  assembly: Assembly,\n  adapterConfig: unknown,\n  options: BaseOptions,\n  signal?: AbortSignal,\n) {\n  const { sessionId } = options\n  await when(() => !!(assembly.regions && assembly.refNameAliases), {\n    signal,\n    name: 'when assembly ready',\n  })\n\n  const refNames = (await assembly.rpcManager.call(\n    sessionId,\n    'CoreGetRefNames',\n    {\n      adapterConfig,\n      signal,\n      ...options,\n    },\n    { timeout: 1000000 },\n  )) as string[]\n\n  const { refNameAliases } = assembly\n  if (!refNameAliases) {\n    throw new Error(`error loading assembly ${assembly.name}'s refNameAliases`)\n  }\n\n  const refNameMap = Object.fromEntries(\n    refNames.map(name => {\n      checkRefName(name)\n      return [assembly.getCanonicalRefName(name), name]\n    }),\n  )\n\n  // make the reversed map too\n  const reversed = Object.fromEntries(\n    Object.entries(refNameMap).map(([canonicalName, adapterName]) => [\n      adapterName,\n      canonicalName,\n    ]),\n  )\n\n  return {\n    forwardMap: refNameMap,\n    reverseMap: reversed,\n  }\n}\n\n// Valid refName pattern from https://samtools.github.io/hts-specs/SAMv1.pdf\nfunction checkRefName(refName: string) {\n  if (!refName.match(refNameRegex)) {\n    throw new Error(`Encountered invalid refName: \"${refName}\"`)\n  }\n}\n\nfunction getAdapterId(adapterConf: unknown) {\n  return jsonStableStringify(adapterConf)\n}\n\ntype RefNameAliases = Record<string, string>\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  sessionId: string\n  statusCallback?: Function\n}\n\ninterface CacheData {\n  adapterConf: unknown\n  self: Assembly\n  sessionId: string\n  options: BaseOptions\n}\n\nexport interface RefNameMap {\n  forwardMap: RefNameAliases\n  reverseMap: RefNameAliases\n}\n\nexport interface BasicRegion {\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n}\n\nexport interface Loading {\n  adapterRegionsWithAssembly: Region[]\n  refNameAliases: RefNameAliases\n  lowerCaseRefNameAliases: RefNameAliases\n  cytobands: Feature[]\n}\nexport default function assemblyFactory(\n  assemblyConfigType: IAnyType,\n  pm: PluginManager,\n) {\n  const adapterLoads = new AbortablePromiseCache<CacheData, RefNameMap>({\n    cache: new QuickLRU({ maxSize: 1000 }),\n    async fill(\n      args: CacheData,\n      signal?: AbortSignal,\n      statusCallback?: Function,\n    ) {\n      const { adapterConf, self, options } = args\n      return loadRefNameMap(\n        self,\n        adapterConf,\n        { ...options, statusCallback },\n        signal,\n      )\n    },\n  })\n  return types\n    .model({\n      configuration: types.safeReference(assemblyConfigType),\n    })\n    .volatile(() => ({\n      error: undefined as unknown,\n      loaded: false,\n      loadingP: undefined as Promise<void> | undefined,\n      volatileRegions: undefined as BasicRegion[] | undefined,\n      refNameAliases: undefined as RefNameAliases | undefined,\n      lowerCaseRefNameAliases: undefined as RefNameAliases | undefined,\n      cytobands: undefined as Feature[] | undefined,\n    }))\n    .views(self => ({\n      get initialized() {\n        // @ts-ignore\n        self.load()\n        return !!self.refNameAliases\n      },\n      get name(): string {\n        return getConf(self, 'name')\n      },\n\n      get regions() {\n        // @ts-ignore\n        self.load()\n        return self.volatileRegions\n      },\n\n      get aliases(): string[] {\n        return getConf(self, 'aliases')\n      },\n\n      get displayName(): string | undefined {\n        return getConf(self, 'displayName')\n      },\n\n      hasName(name: string) {\n        return this.allAliases.includes(name)\n      },\n\n      get allAliases() {\n        return [this.name, ...this.aliases]\n      },\n\n      // note: lowerCaseRefNameAliases not included here: this allows the list\n      // of refnames to be just the \"normal casing\", but things like\n      // getCanonicalRefName can resolve a lower-case name if needed\n      get allRefNames() {\n        return !self.refNameAliases\n          ? undefined\n          : Object.keys(self.refNameAliases)\n      },\n\n      get lowerCaseRefNames() {\n        return !self.lowerCaseRefNameAliases\n          ? undefined\n          : Object.keys(self.lowerCaseRefNameAliases || {})\n      },\n\n      get allRefNamesWithLowerCase() {\n        return this.allRefNames && this.lowerCaseRefNames\n          ? [...new Set([...this.allRefNames, ...this.lowerCaseRefNames])]\n          : undefined\n      },\n      get rpcManager() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self, 2).rpcManager\n      },\n      get refNameColors() {\n        const colors: string[] = getConf(self, 'refNameColors')\n        return colors.length === 0 ? refNameColors : colors\n      },\n    }))\n    .views(self => ({\n      get refNames() {\n        return self.regions?.map(region => region.refName)\n      },\n    }))\n    .views(self => ({\n      getCanonicalRefName(refName: string) {\n        if (!self.refNameAliases || !self.lowerCaseRefNameAliases) {\n          throw new Error(\n            'aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called',\n          )\n        }\n        return (\n          self.refNameAliases[refName] || self.lowerCaseRefNameAliases[refName]\n        )\n      },\n      getRefNameColor(refName: string) {\n        if (!self.refNames) {\n          return undefined\n        }\n        const idx = self.refNames.findIndex(r => r === refName)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.refNameColors[idx % self.refNameColors.length]\n      },\n      isValidRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'isValidRefName cannot be called yet, the assembly has not finished loading',\n          )\n        }\n        return !!this.getCanonicalRefName(refName)\n      },\n    }))\n    .actions(self => ({\n      setLoaded({\n        adapterRegionsWithAssembly,\n        refNameAliases,\n        lowerCaseRefNameAliases,\n        cytobands,\n      }: Loading) {\n        self.loaded = true\n        this.setRegions(adapterRegionsWithAssembly)\n        this.setRefNameAliases(refNameAliases, lowerCaseRefNameAliases)\n        this.setCytobands(cytobands)\n      },\n      setError(e: unknown) {\n        console.error(e)\n        self.error = e\n      },\n      setRegions(regions: Region[]) {\n        self.volatileRegions = regions\n      },\n      setRefNameAliases(aliases: RefNameAliases, lcAliases: RefNameAliases) {\n        self.refNameAliases = aliases\n        self.lowerCaseRefNameAliases = lcAliases\n      },\n      setCytobands(cytobands: Feature[]) {\n        self.cytobands = cytobands\n      },\n      setLoadingP(p?: Promise<void>) {\n        self.loadingP = p\n      },\n      load() {\n        if (!self.loadingP) {\n          self.loadingP = this.loadPre().catch(e => {\n            this.setLoadingP(undefined)\n            this.setError(e)\n          })\n        }\n        return self.loadingP\n      },\n      async loadPre() {\n        const conf = self.configuration\n        const refNameAliasesAdapterConf = conf.refNameAliases?.adapter\n        const cytobandAdapterConf = conf.cytobands?.adapter\n        const sequenceAdapterConf = conf.sequence.adapter\n        const assemblyName = self.name\n\n        const regions = await getAssemblyRegions(sequenceAdapterConf, pm)\n        const adapterRegionsWithAssembly = regions.map(r => {\n          checkRefName(r.refName)\n          return { ...r, assemblyName }\n        })\n        const refNameAliases: RefNameAliases = {}\n\n        const ret = await getRefNameAliases(refNameAliasesAdapterConf, pm)\n        const cytobands = await getCytobands(cytobandAdapterConf, pm)\n        ret.forEach(({ refName, aliases }) => {\n          aliases.forEach(a => {\n            checkRefName(a)\n            refNameAliases[a] = refName\n          })\n        })\n        // add identity to the refNameAliases list\n        adapterRegionsWithAssembly.forEach(region => {\n          refNameAliases[region.refName] = region.refName\n        })\n\n        const lowerCaseRefNameAliases = Object.fromEntries(\n          Object.entries(refNameAliases).map(([key, val]) => [\n            key.toLowerCase(),\n            val,\n          ]),\n        )\n\n        this.setLoaded({\n          adapterRegionsWithAssembly,\n          refNameAliases,\n          lowerCaseRefNameAliases,\n          cytobands,\n        })\n      },\n    }))\n    .views(self => ({\n      getAdapterMapEntry(adapterConf: unknown, options: BaseOptions) {\n        const { signal, statusCallback, ...rest } = options\n        if (!options.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const adapterId = getAdapterId(adapterConf)\n        return adapterLoads.get(\n          adapterId,\n          {\n            adapterConf,\n            self: self as Assembly,\n            options: rest,\n          } as CacheData,\n\n          // signal intentionally not passed here, fixes issues like #2221.\n          // alternative fix #2540 was proposed but non-working currently\n          undefined,\n          statusCallback,\n        )\n      },\n\n      /**\n       * get Map of `canonical-name -> adapter-specific-name`\n       */\n      async getRefNameMapForAdapter(adapterConf: unknown, opts: BaseOptions) {\n        if (!opts || !opts.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.forwardMap\n      },\n\n      /**\n       * get Map of `adapter-specific-name -> canonical-name`\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        opts: BaseOptions,\n      ) {\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.reverseMap\n      },\n    }))\n}\n\nasync function getRefNameAliases(\n  config: AnyConfigurationModel,\n  pm: PluginManager,\n  signal?: AbortSignal,\n) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm) as BaseRefNameAliasAdapter\n  return adapter.getRefNameAliases({ signal })\n}\n\nasync function getCytobands(config: AnyConfigurationModel, pm: PluginManager) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm)\n\n  // @ts-ignore\n  return adapter.getData()\n}\n\nasync function getAssemblyRegions(\n  config: AnyConfigurationModel,\n  pm: PluginManager,\n  signal?: AbortSignal,\n) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm) as RegionsAdapter\n  return adapter.getRegions({ signal })\n}\n\nexport type AssemblyModel = ReturnType<typeof assemblyFactory>\nexport type Assembly = Instance<AssemblyModel>\n","import {\n  addDisposer,\n  cast,\n  getParent,\n  types,\n  Instance,\n  IAnyType,\n} from 'mobx-state-tree'\nimport { when } from '../util'\nimport { reaction } from 'mobx'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\nimport assemblyFactory, { Assembly } from './assembly'\nimport PluginManager from '../PluginManager'\n\nfunction assemblyManagerFactory(conf: IAnyType, pm: PluginManager) {\n  type Conf = Instance<typeof conf> | string\n  return types\n    .model({\n      assemblies: types.array(assemblyFactory(conf, pm)),\n    })\n    .views(self => ({\n      get(asmName: string) {\n        return self.assemblies.find(asm => asm.hasName(asmName))\n      },\n\n      get assemblyNamesList() {\n        return this.assemblyList.map(asm => asm.name)\n      },\n\n      get assemblyList() {\n        // name is the explicit identifier and can be accessed without getConf,\n        // hence the union with {name:string}\n        const {\n          jbrowse: { assemblies },\n          session: { sessionAssemblies = [], temporaryAssemblies = [] } = {},\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        } = getParent<any>(self)\n        return [\n          ...assemblies,\n          ...sessionAssemblies,\n          ...temporaryAssemblies,\n        ] as AnyConfigurationModel[]\n      },\n\n      get rpcManager() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .views(self => ({\n      // use this method instead of assemblyManager.get(assemblyName)\n      // get an assembly with regions loaded\n      async waitForAssembly(assemblyName: string) {\n        if (!assemblyName) {\n          throw new Error('no assembly name supplied to waitForAssembly')\n        }\n        let assembly = self.get(assemblyName)\n        if (!assembly) {\n          try {\n            await when(() => Boolean(self.get(assemblyName)), { timeout: 1000 })\n            assembly = self.get(assemblyName)\n          } catch (e) {\n            // ignore\n          }\n        }\n\n        if (!assembly) {\n          return undefined\n        }\n        await assembly.load()\n        await when(\n          () =>\n            Boolean(assembly?.regions && assembly.refNameAliases) ||\n            !!assembly?.error,\n        )\n        if (assembly.error) {\n          throw assembly.error\n        }\n        return assembly\n      },\n\n      async getRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string | undefined,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string | undefined,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getReverseRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n      isValidRefName(refName: string, assemblyName: string) {\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.isValidRefName(refName)\n        }\n        throw new Error(\n          `isValidRefName for ${assemblyName} failed, assembly does not exist`,\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          reaction(\n            // have to slice it to be properly reacted to\n            () => self.assemblyList,\n            assemblyConfigs => {\n              self.assemblies.forEach(asm => {\n                if (!asm.configuration) {\n                  this.removeAssembly(asm)\n                }\n              })\n              assemblyConfigs.forEach(assemblyConfig => {\n                const existingAssemblyIdx = self.assemblies.findIndex(\n                  assembly =>\n                    assembly.name === readConfObject(assemblyConfig, 'name'),\n                )\n                if (existingAssemblyIdx === -1) {\n                  this.addAssembly(assemblyConfig)\n                }\n              })\n            },\n            { fireImmediately: true, name: 'assemblyManagerAfterAttach' },\n          ),\n        )\n      },\n      removeAssembly(asm: Assembly) {\n        self.assemblies.remove(asm)\n      },\n\n      // this can take an active instance of an assembly, in which case it is\n      // referred to, or it can take an identifier e.g. assembly name, which is\n      // used as a reference. snapshots cannot be used\n      addAssembly(configuration: Conf) {\n        self.assemblies.push({ configuration })\n      },\n\n      replaceAssembly(idx: number, configuration: Conf) {\n        self.assemblies[idx] = cast({ configuration })\n      },\n    }))\n}\n\nexport default assemblyManagerFactory\n","import { ConfigurationSchema } from '../configuration'\nimport PluginManager from '../PluginManager'\n\n/**\n * #config BaseAssembly\n * This corresponds to the assemblies section of the config\n */\nfunction assemblyConfigSchema(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseAssembly',\n    {\n      /**\n       * #slot\n       * aliases are \"reference name aliases\" e.g. aliases for hg38 might be \"GRCh38\"\n       */\n      aliases: {\n        type: 'stringArray',\n        defaultValue: [],\n        description: 'Other possible names for the assembly',\n      },\n\n      /**\n       * #slot\n       * sequence refers to a reference sequence track that has an adapter containing,\n       * importantly, a sequence adapter such as IndexedFastaAdapter\n       */\n      sequence: pluginManager.getTrackType('ReferenceSequenceTrack')\n        .configSchema,\n\n      /**\n       * #slot\n       */\n      refNameColors: {\n        type: 'stringArray',\n        defaultValue: [],\n        description:\n          'Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence.',\n      },\n\n      refNameAliases: ConfigurationSchema(\n        'RefNameAliases',\n        {\n          /**\n           * #slot refNameAliases.adapter\n           * refNameAliases help resolve e.g. chr1 and 1 as the same entity\n           * the data for refNameAliases are fetched from an adapter, that is\n           * commonly a tsv like chromAliases.txt from UCSC or similar\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow refNameAliases to be unspecified\n            // @ts-ignore\n            if (!snap.adapter) {\n              return { adapter: { type: 'RefNameAliasAdapter' } }\n            }\n            return snap\n          },\n        },\n      ),\n      cytobands: ConfigurationSchema(\n        'Cytoband',\n        {\n          /**\n           * #slot cytobands.adapter\n           * cytoband data is fetched from an adapter, and can be displayed by a\n           * view type as ideograms\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow cytoBand to be unspecified\n            // @ts-ignore\n            if (!snap.adapter) {\n              return { adapter: { type: 'CytobandAdapter' } }\n            }\n            return snap\n          },\n        },\n      ),\n\n      /**\n       * #slot\n       */\n      displayName: {\n        type: 'string',\n        defaultValue: '',\n        description:\n          'A human readable display name for the assembly e.g. \"Homo sapiens (hg38)\" while the assembly name may just be \"hg38\"',\n      },\n    },\n    {\n      /**\n       * #identifier name\n       * the name acts as a unique identifier in the config, so it cannot be duplicated.\n       * it usually a short human readable \"id\" like hg38, but you can also optionally\n       * customize the assembly \"displayName\" config slot\n       */\n      explicitIdentifier: 'name',\n    },\n  )\n}\n\nexport default assemblyConfigSchema\n","import { ConfigurationSchema } from '../configuration'\n\n/**\n * #config BaseRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseRpcDriverConfigSchema = ConfigurationSchema(\n  'BaseRpcDriver',\n  {\n    /**\n     * #slot\n     */\n    workerCount: {\n      type: 'number',\n      description:\n        'The number of workers to use. If 0 (the default) JBrowse will decide how many workers to use.',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BaseRpcDriverConfigSchema\n","import { ConfigurationSchema } from '../configuration'\nimport BaseRpcDriverConfigSchema from './baseRpcConfig'\n\n/**\n * #config WebWorkerRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WebWorkerRpcDriverConfigSchema = ConfigurationSchema(\n  'WebWorkerRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default WebWorkerRpcDriverConfigSchema\n","import { ConfigurationSchema } from '../configuration'\nimport BaseRpcDriverConfigSchema from './baseRpcConfig'\n\n/**\n * #config MainThreadRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MainThreadRpcDriverConfigSchema = ConfigurationSchema(\n  'MainThreadRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default MainThreadRpcDriverConfigSchema\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\nimport WebWorkerRpcDriverConfigSchema from './webWorkerRpcConfig'\nimport MainThreadRpcDriverConfigSchema from './mainThreadRpcConfig'\n\n/**\n * #config RpcOptions\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'RpcOptions',\n  {\n    /**\n     * #slot\n     */\n    defaultDriver: {\n      type: 'string',\n      description:\n        'the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend',\n      defaultValue: 'MainThreadRpcDriver',\n    },\n    /**\n     * #slot\n     */\n    drivers: types.optional(\n      types.map(\n        types.union(\n          MainThreadRpcDriverConfigSchema,\n          WebWorkerRpcDriverConfigSchema,\n        ),\n      ),\n      {\n        MainThreadRpcDriver: { type: 'MainThreadRpcDriver' },\n        WebWorkerRpcDriver: { type: 'WebWorkerRpcDriver' },\n      },\n    ),\n  },\n  {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    actions: (self: any) => ({\n      addDriverConfig(configName: string, configSnapshot: { type: string }) {\n        self.drivers.set(configName, configSnapshot)\n      },\n    }),\n  },\n)\n","import { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport { clamp } from '../util'\nimport { serializeAbortSignal } from './remoteAbortSignals'\nimport PluginManager from '../PluginManager'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nexport interface WorkerHandle {\n  status?: string\n  error?: Error\n  on?: (channel: string, callback: (message: string) => void) => void\n  off?: (channel: string, callback: (message: string) => void) => void\n  destroy(): void\n  call(\n    functionName: string,\n    args?: unknown,\n    options?: {\n      statusCallback?(message: string): void\n      timeout?: number\n      rpcDriverClassName: string\n    },\n  ): Promise<unknown>\n}\n\nexport interface RpcDriverConstructorArgs {\n  config: AnyConfigurationModel\n}\n\nfunction isClonable(thing: unknown): boolean {\n  if (typeof thing === 'function') {\n    return false\n  }\n  if (thing instanceof Error) {\n    return false\n  }\n  return true\n}\n\n// watches the given worker object, returns a promise that will be rejected if\n// the worker times out\nexport async function watchWorker(\n  worker: WorkerHandle,\n  pingTime: number,\n  rpcDriverClassName: string,\n) {\n  // after first ping succeeds, apply wait for timeout\n  return new Promise((_resolve, reject) => {\n    function delay() {\n      setTimeout(async () => {\n        try {\n          await worker.call('ping', [], {\n            timeout: pingTime * 2,\n            rpcDriverClassName,\n          })\n          delay()\n        } catch (e) {\n          reject(e)\n        }\n      }, pingTime)\n    }\n    delay()\n  })\n}\n\nfunction detectHardwareConcurrency() {\n  const mainThread = typeof window !== 'undefined'\n  const canDetect = mainThread && 'hardwareConcurrency' in window.navigator\n  if (mainThread && canDetect) {\n    return window.navigator.hardwareConcurrency\n  }\n  return 1\n}\nclass LazyWorker {\n  workerP?: Promise<WorkerHandle> | undefined\n\n  constructor(public driver: BaseRpcDriver) {}\n\n  async getWorker() {\n    if (!this.workerP) {\n      this.workerP = this.driver\n        .makeWorker()\n        .then(worker => {\n          watchWorker(worker, this.driver.maxPingTime, this.driver.name).catch(\n            error => {\n              if (worker) {\n                console.error(\n                  'worker did not respond, killing and generating new one',\n                )\n                console.error(error)\n                worker.destroy()\n                worker.status = 'killed'\n                worker.error = error\n                this.workerP = undefined\n              }\n            },\n          )\n          return worker\n        })\n        .catch(e => {\n          this.workerP = undefined\n          throw e\n        })\n    }\n    return this.workerP\n  }\n}\n\nexport default abstract class BaseRpcDriver {\n  abstract name: string\n\n  private lastWorkerAssignment = -1\n\n  private workerAssignments = new Map<string, number>() // sessionId -> worker number\n\n  abstract makeWorker(): Promise<WorkerHandle>\n\n  private workerPool?: LazyWorker[]\n\n  maxPingTime = 30000\n\n  workerCheckFrequency = 5000\n\n  config: AnyConfigurationModel\n\n  constructor(args: RpcDriverConstructorArgs) {\n    this.config = args.config\n  }\n\n  // filter the given object and just remove any non-clonable things from it\n  filterArgs<THING_TYPE>(thing: THING_TYPE, sessionId: string): THING_TYPE {\n    if (Array.isArray(thing)) {\n      return thing\n        .filter(isClonable)\n        .map(t => this.filterArgs(t, sessionId)) as unknown as THING_TYPE\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      // AbortSignals are specially handled\n      if (thing instanceof AbortSignal) {\n        return serializeAbortSignal(\n          thing,\n          this.remoteAbort.bind(this, sessionId),\n        ) as unknown as THING_TYPE\n      }\n\n      if (isStateTreeNode(thing) && !isAlive(thing)) {\n        throw new Error('dead state tree node passed to RPC call')\n      }\n\n      // special case, don't try to iterate the file's subelements as the\n      // object entries below would\n      if (thing instanceof File) {\n        return thing\n      }\n\n      return Object.fromEntries(\n        Object.entries(thing)\n          .filter(e => isClonable(e[1]))\n          .map(([k, v]) => [k, this.filterArgs(v, sessionId)]),\n      ) as THING_TYPE\n    }\n    return thing\n  }\n\n  async remoteAbort(sessionId: string, functionName: string, signalId: number) {\n    const worker = await this.getWorker(sessionId)\n    worker.call(\n      functionName,\n      { signalId },\n      { timeout: 1000000, rpcDriverClassName: this.name },\n    )\n  }\n\n  createWorkerPool(): LazyWorker[] {\n    const hardwareConcurrency = detectHardwareConcurrency()\n\n    const workerCount =\n      readConfObject(this.config, 'workerCount') ||\n      clamp(1, Math.max(1, hardwareConcurrency - 1), 5)\n\n    return [...new Array(workerCount)].map(() => new LazyWorker(this))\n  }\n\n  getWorkerPool() {\n    if (!this.workerPool) {\n      const res = this.createWorkerPool()\n      this.workerPool = res\n      return res // making this several steps makes TS happy\n    }\n    return this.workerPool\n  }\n\n  async getWorker(sessionId: string): Promise<WorkerHandle> {\n    const workers = this.getWorkerPool()\n    let workerNumber = this.workerAssignments.get(sessionId)\n    if (workerNumber === undefined) {\n      const workerAssignment = (this.lastWorkerAssignment + 1) % workers.length\n      this.workerAssignments.set(sessionId, workerAssignment)\n      this.lastWorkerAssignment = workerAssignment\n      workerNumber = workerAssignment\n    }\n\n    // console.log(`${sessionId} -> worker ${workerNumber}`)\n    const worker = workers[workerNumber].getWorker()\n    if (!worker) {\n      throw new Error('no web workers registered for RPC')\n    }\n    return worker\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: { statusCallback?: (message: string) => void },\n    options = {},\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    let done = false\n    const worker = await this.getWorker(sessionId)\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const filteredAndSerializedArgs = this.filterArgs(serializedArgs, sessionId)\n\n    // now actually call the worker\n    const callP = worker\n      .call(functionName, filteredAndSerializedArgs, {\n        timeout: 5 * 60 * 1000, // 5 minutes\n        statusCallback: args.statusCallback,\n        rpcDriverClassName: this.name,\n        ...options,\n      })\n      .finally(() => {\n        done = true\n      })\n\n    // check every 5 seconds to see if the worker has been killed, and\n    // reject the killedP promise if it has\n    let killedCheckInterval: ReturnType<typeof setInterval>\n    const killedP = new Promise((resolve, reject) => {\n      killedCheckInterval = setInterval(() => {\n        // must've been killed\n        if (worker.status === 'killed') {\n          reject(\n            new Error(\n              `operation timed out, worker process stopped responding, ${worker.error}`,\n            ),\n          )\n        } else if (done) {\n          resolve(true)\n        }\n      }, this.workerCheckFrequency)\n    }).finally(() => {\n      clearInterval(killedCheckInterval)\n    })\n\n    // the result is a race between the actual result promise, and the \"killed\"\n    // promise. the killed promise will only actually win if the worker was\n    // killed before the call could return\n    const resultP = Promise.race([callP, killedP])\n    return rpcMethod.deserializeReturn(resultP, args, this.name)\n  }\n}\n","import Rpc from 'librpc-web-mod'\nimport shortid from 'shortid'\nimport { deserializeError } from 'serialize-error'\n\n// locals\nimport BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport { PluginDefinition } from '../PluginLoader'\n\ninterface WebWorkerRpcDriverConstructorArgs extends RpcDriverConstructorArgs {\n  makeWorkerInstance: () => Worker\n}\n\ninterface Options {\n  statusCallback?: (arg0: string) => void\n  rpcDriverClassName: string\n}\n\nclass WebWorkerHandle extends Rpc.Client {\n  destroy(): void {\n    this.workers[0].terminate()\n  }\n\n  async call(funcName: string, args: Record<string, unknown>, opts: Options) {\n    const { statusCallback, rpcDriverClassName } = opts\n    const channel = `message-${shortid.generate()}`\n    const listener = (message: string) => {\n      statusCallback?.(message)\n    }\n    this.on(channel, listener)\n    const result = await super.call(\n      funcName,\n      { ...args, channel, rpcDriverClassName },\n      opts,\n    )\n    this.off(channel, listener)\n    return result\n  }\n}\n\nexport default class WebWorkerRpcDriver extends BaseRpcDriver {\n  name = 'WebWorkerRpcDriver'\n\n  makeWorkerInstance: () => Worker\n\n  constructor(\n    args: WebWorkerRpcDriverConstructorArgs,\n    public workerBootConfiguration: {\n      plugins: PluginDefinition[]\n      windowHref: string\n    },\n  ) {\n    super(args)\n    this.makeWorkerInstance = args.makeWorkerInstance\n  }\n\n  async makeWorker() {\n    // note that we are making a Rpc.Client connection with a worker pool of\n    // one for each worker, because we want to do our own state-group-aware\n    // load balancing rather than using librpc's builtin round-robin\n    const instance = this.makeWorkerInstance()\n\n    const worker = new WebWorkerHandle({ workers: [instance] })\n    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n    if (isSafari) {\n      // xref https://github.com/GMOD/jbrowse-components/issues/3245\n      // eslint-disable-next-line no-console\n      console.log(\n        'console logging the webworker handle avoids the track going into an infinite loading state, this is a hacky workaround for safari',\n        instance,\n      )\n    }\n\n    // send the worker its boot configuration using info from the pluginManager\n    return new Promise((resolve: (w: WebWorkerHandle) => void, reject) => {\n      const listener = (e: MessageEvent) => {\n        if (e.data.message === 'ready') {\n          resolve(worker)\n          worker.workers[0].removeEventListener('message', listener)\n        } else if (e.data.message === 'readyForConfig') {\n          worker.workers[0].postMessage({\n            message: 'config',\n            config: this.workerBootConfiguration,\n          })\n        } else if (e.data.message === 'error') {\n          reject(deserializeError(e.data.error))\n        }\n      }\n      worker.workers[0].addEventListener('message', listener)\n    })\n  }\n}\n","import BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\n\nclass DummyHandle {\n  destroy(): void {}\n\n  async call(\n    _functionName: string,\n    _filteredArgs?: {},\n    _options = {},\n  ): Promise<unknown> {\n    return undefined\n  }\n}\n\n/**\n * Stub RPC driver class that runs RPC functions in-band in the main thread.\n *\n * @param rpcFuncs - object containing runnable rpc functions\n */\nexport default class MainThreadRpcDriver extends BaseRpcDriver {\n  name = 'MainThreadRpcDriver'\n\n  makeWorker: () => Promise<DummyHandle>\n\n  constructor(args: RpcDriverConstructorArgs) {\n    super(args)\n    this.makeWorker = async (): Promise<DummyHandle> => new DummyHandle()\n  }\n\n  async call(pm: PluginManager, sessionId: string, funcName: string, args: {}) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const rpcMethod = pm.getRpcMethodType(funcName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const result = await rpcMethod.execute(serializedArgs, this.name)\n    return rpcMethod.deserializeReturn(result, args, this.name)\n  }\n}\n","import PluginManager from '../PluginManager'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\nimport rpcConfigSchema from './configSchema'\nimport WebWorkerRpcDriver from './WebWorkerRpcDriver'\nimport MainThreadRpcDriver from './MainThreadRpcDriver'\n\ntype DriverClass = WebWorkerRpcDriver | MainThreadRpcDriver\ntype BackendConfigurations = {\n  WebWorkerRpcDriver?: Omit<\n    ConstructorParameters<typeof WebWorkerRpcDriver>[0],\n    'config'\n  >\n  MainThreadRpcDriver?: Omit<\n    ConstructorParameters<typeof MainThreadRpcDriver>[0],\n    'config'\n  >\n}\nconst DriverClasses = {\n  WebWorkerRpcDriver,\n  MainThreadRpcDriver,\n}\n\nexport default class RpcManager {\n  static configSchema = rpcConfigSchema\n\n  driverObjects: Map<string, DriverClass>\n\n  constructor(\n    public pluginManager: PluginManager,\n    public mainConfiguration: AnyConfigurationModel,\n    public backendConfigurations: BackendConfigurations,\n  ) {\n    if (!mainConfiguration) {\n      throw new Error('RpcManager requires at least a main configuration')\n    }\n    this.driverObjects = new Map()\n  }\n\n  getDriver(backendName: keyof typeof DriverClasses) {\n    const driver = this.driverObjects.get(backendName)\n    if (driver) {\n      return driver\n    }\n    let newDriver\n    const config = this.mainConfiguration.drivers.get('WebWorkerRpcDriver')\n    if (backendName === 'MainThreadRpcDriver') {\n      const backendConfiguration =\n        this.backendConfigurations.MainThreadRpcDriver\n\n      if (!backendConfiguration) {\n        throw new Error(\n          `requested RPC driver \"${backendName}\" is missing config`,\n        )\n      }\n      newDriver = new MainThreadRpcDriver({ ...backendConfiguration, config })\n    } else if (backendName === 'WebWorkerRpcDriver') {\n      const backendConfiguration = this.backendConfigurations.WebWorkerRpcDriver\n      if (!backendConfiguration) {\n        throw new Error(\n          `requested RPC driver \"${backendName}\" is missing config`,\n        )\n      }\n      newDriver = new WebWorkerRpcDriver(\n        { ...backendConfiguration, config },\n        {\n          plugins: this.pluginManager.runtimePluginDefinitions,\n          windowHref: window.location.href,\n        },\n      )\n    } else {\n      throw new Error(`requested RPC driver \"${backendName}\" is not installed`)\n    }\n    this.driverObjects.set(backendName, newDriver)\n    return newDriver\n  }\n\n  async getDriverForCall(\n    _sessionId: string,\n    _functionName: string,\n    args: { rpcDriverName?: string },\n  ) {\n    const backendName =\n      args.rpcDriverName ||\n      readConfObject(this.mainConfiguration, 'defaultDriver')\n\n    return this.getDriver(backendName)\n  }\n\n  async call(sessionId: string, functionName: string, args: {}, opts = {}) {\n    if (!sessionId) {\n      throw new Error('sessionId is required')\n    }\n    const driverForCall = await this.getDriverForCall(\n      sessionId,\n      functionName,\n      args,\n    )\n    return driverForCall.call(\n      this.pluginManager,\n      sessionId,\n      functionName,\n      args,\n      opts,\n    )\n  }\n}\n","import BaseResult from './BaseResults'\nimport PluginManager from '../PluginManager'\nimport QuickLRU from '../util/QuickLRU'\nimport { SearchType, BaseTextSearchAdapter } from '../data_adapters/BaseAdapter'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nexport interface BaseArgs {\n  queryString: string\n  searchType?: SearchType\n  signal?: AbortSignal\n  limit?: number\n  pageNumber?: number\n}\n\nexport interface SearchScope {\n  includeAggregateIndexes: boolean\n  assemblyName: string\n  tracks?: Array<string>\n}\n\nexport default class TextSearchManager {\n  adapterCache = new QuickLRU<string, BaseTextSearchAdapter>({\n    maxSize: 15,\n  })\n\n  constructor(public pluginManager: PluginManager) {}\n\n  loadTextSearchAdapters(searchScope: SearchScope) {\n    const pm = this.pluginManager\n    return this.relevantAdapters(searchScope).map(conf => {\n      const adapterId = readConfObject(conf, 'textSearchAdapterId')\n      const r = this.adapterCache.get(adapterId)\n      if (r) {\n        return r\n      } else {\n        const { AdapterClass } = pm.getTextSearchAdapterType(conf.type)\n        const a = new AdapterClass(conf, undefined, pm) as BaseTextSearchAdapter\n        this.adapterCache.set(adapterId, a)\n        return a\n      }\n    })\n  }\n\n  relevantAdapters(searchScope: SearchScope) {\n    const pm = this.pluginManager\n    const { aggregateTextSearchAdapters, tracks } = pm.rootModel?.jbrowse as {\n      tracks: AnyConfigurationModel[]\n      aggregateTextSearchAdapters: AnyConfigurationModel[]\n    }\n\n    const { assemblyName } = searchScope\n\n    return [\n      ...this.getAdaptersWithAssembly(\n        assemblyName,\n        aggregateTextSearchAdapters,\n      ),\n      ...this.getTrackAdaptersWithAssembly(assemblyName, tracks),\n    ]\n  }\n\n  getAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ): AnyConfigurationModel[] {\n    return confs.filter(c =>\n      readConfObject(c, 'assemblyNames')?.includes(assemblyName),\n    )\n  }\n\n  getTrackAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ) {\n    return confs\n      .filter(conf =>\n        readConfObject(conf, [\n          'textSearching',\n          'textSearchAdapter',\n          'assemblyNames',\n        ])?.includes(assemblyName),\n      )\n      .map(\n        conf => conf.textSearching.textSearchAdapter as AnyConfigurationModel,\n      )\n  }\n\n  /**\n   * Returns list of relevant results given a search query and options\n   * @param args - search options/arguments include: search query\n   * limit of results to return, searchType...prefix | full | exact\", etc.\n   */\n  async search(\n    args: BaseArgs,\n    searchScope: SearchScope,\n    rankFn: (results: BaseResult[]) => BaseResult[],\n  ) {\n    const adapters = this.loadTextSearchAdapters(searchScope)\n    const results = await Promise.all(adapters.map(a => a.searchIndex(args)))\n    return this.sortResults(results.flat(), rankFn)\n  }\n\n  /**\n   * Returns array of revelevant and sorted results\n   * @param results - array of results from all text search adapters\n   * @param rankFn - function that updates results scores\n   * based on more relevance\n   */\n  sortResults(\n    results: BaseResult[],\n    rankFn: (results: BaseResult[]) => BaseResult[],\n  ) {\n    return rankFn(\n      results.sort((a, b) => -b.getLabel().localeCompare(a.getLabel())),\n    ).sort((r1, r2) => r1.getScore() - r2.getScore())\n  }\n}\n","// adapted from https://github.com/mobxjs/mobx-state-tree/blob/master/packages/mst-middlewares/src/time-traveller.ts\nimport {\n  types,\n  resolvePath,\n  getEnv,\n  onSnapshot,\n  getSnapshot,\n  applySnapshot,\n  IDisposer,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\n\nconst MAX_HISTORY_LENGTH = 20\n\nfunction debounce(func: (...args: unknown[]) => void, timeout = 300) {\n  let timer: ReturnType<typeof setTimeout>\n  return (...args: unknown[]) => {\n    clearTimeout(timer)\n    timer = setTimeout(() => func(...args), timeout)\n  }\n}\n\nconst TimeTraveller = types\n  .model('TimeTraveller', {\n    undoIdx: -1,\n    targetPath: '',\n  })\n  .volatile(() => ({\n    history: [] as unknown[],\n    notTrackingUndo: false,\n  }))\n  .views(self => ({\n    get canUndo() {\n      return self.undoIdx > 0 && !self.notTrackingUndo\n    },\n    get canRedo() {\n      return self.undoIdx < self.history.length - 1 && !self.notTrackingUndo\n    },\n  }))\n  .actions(self => {\n    let targetStore: IAnyStateTreeNode\n    let snapshotDisposer: IDisposer\n    let skipNextUndoState = false\n\n    return {\n      // allows user code to (temporarily) stop tracking undo states\n      stopTrackingUndo() {\n        self.notTrackingUndo = true\n      },\n      // allows user code to resume tracking undo states\n      resumeTrackingUndo() {\n        self.notTrackingUndo = false\n      },\n      addUndoState(todos: unknown) {\n        if (self.notTrackingUndo) {\n          return\n        }\n        if (skipNextUndoState) {\n          // skip recording if this state was caused by undo / redo\n          skipNextUndoState = false\n          return\n        }\n        self.history.splice(self.undoIdx + 1)\n        self.history.push(todos)\n        if (self.history.length > MAX_HISTORY_LENGTH) {\n          self.history.shift()\n        }\n        self.undoIdx = self.history.length - 1\n      },\n\n      beforeDestroy() {\n        snapshotDisposer()\n      },\n      initialize() {\n        targetStore = self.targetPath\n          ? resolvePath(self, self.targetPath)\n          : getEnv(self).targetStore\n\n        if (!targetStore) {\n          throw new Error(\n            'Failed to find target store for TimeTraveller. Please provide `targetPath` property, or a `targetStore` in the environment',\n          )\n        }\n\n        snapshotDisposer = onSnapshot(\n          targetStore,\n          debounce((snapshot: unknown) => this.addUndoState(snapshot), 300),\n        )\n        if (self.history.length === 0) {\n          this.addUndoState(getSnapshot(targetStore))\n        }\n      },\n      undo() {\n        self.undoIdx--\n        skipNextUndoState = true\n        applySnapshot(targetStore, self.history[self.undoIdx])\n      },\n      redo() {\n        self.undoIdx++\n        skipNextUndoState = true\n        applySnapshot(targetStore, self.history[self.undoIdx])\n      },\n    }\n  })\n\nexport default TimeTraveller\n","// this is in a separate module here so it can be mocked out by jest. the\n// import.meta.url is not well recognized by jest and we use MainThreadRpc in\n// tests anyways right now\n//\n// note: this uses webpack 5 native worker modules\n//\n// see https://github.com/cmdcolin/cra-webpack5-web-worker-example for simple example\n// and docs https://webpack.js.org/guides/web-workers/\n//\n// also note: the craco config for webpack publicPath: 'auto' is needed for\n// these workers\nexport default function makeWorkerInstance() {\n  return new Worker(new URL('./rpc.worker.ts', import.meta.url))\n}\n","import {\n  ConfigurationSchema,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport {\n  getParent,\n  getRoot,\n  getSnapshot,\n  resolveIdentifier,\n  types,\n  cast,\n} from 'mobx-state-tree'\nimport { toJS } from 'mobx'\nimport { SessionStateModel } from './sessionModelFactory'\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport clone from 'clone'\n\n// poke some things for testing (this stuff will eventually be removed)\n// @ts-ignore\nwindow.getSnapshot = getSnapshot\n// @ts-ignore\nwindow.resolveIdentifier = resolveIdentifier\n\nfunction removeAttr(obj: Record<string, unknown>, attr: string) {\n  for (const prop in obj) {\n    if (prop === attr) {\n      delete obj[prop]\n    } else if (typeof obj[prop] === 'object') {\n      removeAttr(obj[prop] as Record<string, unknown>, attr)\n    }\n  }\n  return obj\n}\n\n/**\n * #config JBrowseWebConfiguration\n * configuration here appears as a \"configuration\" object on the root of config.json\n */\nexport default function JBrowseWeb(\n  pluginManager: PluginManager,\n  Session: SessionStateModel,\n  assemblyConfigSchemasType: AnyConfigurationSchemaType,\n) {\n  const JBrowseModel = types\n    .model('JBrowseWeb', {\n      configuration: ConfigurationSchema('Root', {\n        /**\n         * #slot\n         */\n        rpc: RpcManager.configSchema,\n        /**\n         * #slot\n         */\n        highResolutionScaling: {\n          type: 'number',\n          defaultValue: 2,\n        },\n        /**\n         * #slot\n         */\n        shareURL: {\n          type: 'string',\n          defaultValue: 'https://share.jbrowse.org/api/v1/',\n        },\n\n        featureDetails: ConfigurationSchema('FeatureDetails', {\n          /**\n           * #slot featureDetails.sequenceTypes\n           */\n          sequenceTypes: {\n            type: 'stringArray',\n            defaultValue: ['mRNA', 'transcript', 'gene', 'CDS'],\n          },\n        }),\n        formatDetails: ConfigurationSchema('FormatDetails', {\n          /**\n           * #slot formatDetails.feature\n           */\n          feature: {\n            type: 'frozen',\n            description: 'adds extra fields to the feature details',\n            defaultValue: {},\n            contextVariable: ['feature'],\n          },\n          /**\n           * #slot formatDetails.subfeatures\n           */\n          subfeatures: {\n            type: 'frozen',\n            description: 'adds extra fields to the subfeatures of a feature',\n            defaultValue: {},\n            contextVariable: ['feature'],\n          },\n          /**\n           * #slot formatDetails.depth\n           */\n          depth: {\n            type: 'number',\n            defaultValue: 2,\n            description: 'depth to iterate on subfeatures',\n          },\n        }),\n        formatAbout: ConfigurationSchema('FormatAbout', {\n          /**\n           * #slot formatAbout.conf\n           */\n          config: {\n            type: 'frozen',\n            description: 'formats configuration object in about dialog',\n            defaultValue: {},\n            contextVariable: ['config'],\n          },\n          /**\n           * #slot formatAbout.hideUris\n           */\n          hideUris: {\n            type: 'boolean',\n            defaultValue: false,\n          },\n        }),\n        /**\n         * #slot\n         */\n        disableAnalytics: {\n          type: 'boolean',\n          defaultValue: false,\n        },\n        /**\n         * #slot\n         */\n        theme: { type: 'frozen', defaultValue: {} },\n        /**\n         * #slot\n         */\n        logoPath: {\n          type: 'fileLocation',\n          defaultValue: { uri: '', locationType: 'UriLocation' },\n        },\n        ...pluginManager.pluginConfigurationSchemas(),\n      }),\n      plugins: types.array(types.frozen<PluginDefinition>()),\n      assemblies: types.array(assemblyConfigSchemasType),\n      // track configuration is an array of track config schemas. multiple\n      // instances of a track can exist that use the same configuration\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n      internetAccounts: types.array(\n        pluginManager.pluggableConfigSchemaType('internet account'),\n      ),\n      aggregateTextSearchAdapters: types.array(\n        pluginManager.pluggableConfigSchemaType('text search adapter'),\n      ),\n      connections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n      defaultSession: types.optional(types.frozen(Session), {\n        name: `New session`,\n      }),\n    })\n\n    .views(self => ({\n      get assemblyNames() {\n        return self.assemblies.map(assembly => readConfObject(assembly, 'name'))\n      },\n      get rpcManager() {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        const seen = [] as string[]\n        self.assemblyNames.forEach(assemblyName => {\n          if (!assemblyName) {\n            throw new Error('Encountered an assembly with no \"name\" defined')\n          }\n          if (seen.includes(assemblyName)) {\n            throw new Error(\n              `Found two assemblies with the same name: ${assemblyName}`,\n            )\n          } else {\n            seen.push(assemblyName)\n          }\n        })\n      },\n      addAssemblyConf(assemblyConf: AnyConfigurationModel) {\n        const { name } = assemblyConf\n        if (!name) {\n          throw new Error('Can\\'t add assembly with no \"name\"')\n        }\n        const assembly = self.assemblies.find(asm => asm.name === name)\n        if (assembly) {\n          return assembly\n        }\n        const length = self.assemblies.push({\n          ...assemblyConf,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${name}-${Date.now()}`,\n            ...(assemblyConf.sequence || {}),\n          },\n        })\n        return self.assemblies[length - 1]\n      },\n      removeAssemblyConf(assemblyName: string) {\n        const toRemove = self.assemblies.find(\n          assembly => assembly.name === assemblyName,\n        )\n        if (toRemove) {\n          self.assemblies.remove(toRemove)\n        }\n      },\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        const { type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const track = self.tracks.find(t => t.trackId === trackConf.trackId)\n        if (track) {\n          return track\n        }\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      addDisplayConf(trackId: string, displayConf: AnyConfigurationModel) {\n        const { type } = displayConf\n        if (!type) {\n          throw new Error(`unknown display type ${type}`)\n        }\n        const track = self.tracks.find(t => t.trackId === trackId)\n        if (!track) {\n          throw new Error(`could not find track with id ${trackId}`)\n        }\n        return track.addDisplayConf(displayConf)\n      },\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connections.push(connectionConf)\n        return self.connections[length - 1]\n      },\n\n      deleteConnectionConf(configuration: AnyConfigurationModel) {\n        const idx = self.connections.findIndex(\n          conn => conn.id === configuration.id,\n        )\n        if (idx === -1) {\n          return undefined\n        }\n        return self.connections.splice(idx, 1)\n      },\n\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const { trackId } = trackConf\n        const idx = self.tracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n\n        return self.tracks.splice(idx, 1)\n      },\n      setDefaultSessionConf(sessionConf: AnyConfigurationModel) {\n        let newDefault\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if (getParent<any>(self).session.name === sessionConf.name) {\n          newDefault = getSnapshot(sessionConf)\n        } else {\n          newDefault = toJS(sessionConf)\n        }\n\n        if (!newDefault.name) {\n          throw new Error(`unable to set default session to ${newDefault.name}`)\n        }\n\n        // @ts-ignore complains about name missing, but above line checks this\n        self.defaultSession = cast(newDefault)\n      },\n      addPlugin(pluginDefinition: PluginDefinition) {\n        self.plugins.push(pluginDefinition)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getRoot<any>(self).setPluginsUpdated(true)\n      },\n\n      removePlugin(pluginDefinition: PluginDefinition) {\n        self.plugins = cast(\n          self.plugins.filter(\n            plugin =>\n              plugin.url !== pluginDefinition.url ||\n              plugin.umdUrl !== pluginDefinition.umdUrl ||\n              plugin.cjsUrl !== pluginDefinition.cjsUrl ||\n              plugin.esmUrl !== pluginDefinition.esmUrl,\n          ),\n        )\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self).setPluginsUpdated(true)\n      },\n\n      addInternetAccountConf(config: AnyConfigurationModel) {\n        const { type } = config\n        if (!type) {\n          throw new Error(`unknown internetAccount type ${type}`)\n        }\n        const length = self.internetAccounts.push(config)\n        return self.internetAccounts[length - 1]\n      },\n      deleteInternetAccountConf(config: AnyConfigurationModel) {\n        const idx = self.internetAccounts.findIndex(a => a.id === config.id)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.internetAccounts.splice(idx, 1)\n      },\n    }))\n\n  return types.snapshotProcessor(JBrowseModel, {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    postProcessor(snapshot: { [key: string]: any }) {\n      return removeAttr(clone(snapshot), 'baseUri')\n    },\n  })\n}\n","import { IModelType, ModelProperties } from 'mobx-state-tree'\nimport { IObservableArray, observable } from 'mobx'\nimport { NotificationLevel, SnackAction } from '../util/types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction makeExtension(snackbarMessages: IObservableArray<any>) {\n  return {\n    views: {\n      get snackbarMessages() {\n        return snackbarMessages\n      },\n    },\n    actions: {\n      notify(message: string, level?: NotificationLevel, action?: SnackAction) {\n        this.pushSnackbarMessage(message, level, action)\n        if (level === 'info' || level === 'success') {\n          setTimeout(() => {\n            this.removeSnackbarMessage(message)\n          }, 5000)\n        }\n      },\n\n      pushSnackbarMessage(\n        message: string,\n        level?: NotificationLevel,\n        action?: SnackAction,\n      ) {\n        return snackbarMessages.push([message, level, action])\n      },\n\n      popSnackbarMessage() {\n        return snackbarMessages.pop()\n      },\n\n      removeSnackbarMessage(message: string) {\n        const element = snackbarMessages.find(f => f[0] === message)\n        if (element) {\n          snackbarMessages.remove(element)\n        }\n      },\n    },\n  }\n}\n\nexport default function addSnackbarToModel<\n  PROPS extends ModelProperties,\n  OTHERS,\n>(\n  tree: IModelType<PROPS, OTHERS>,\n): IModelType<\n  PROPS,\n  OTHERS &\n    ReturnType<typeof makeExtension>['actions'] &\n    ReturnType<typeof makeExtension>['views']\n> {\n  return tree.extend(() => {\n    const snackbarMessages = observable.array()\n\n    return makeExtension(snackbarMessages)\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { lazy } from 'react'\nimport clone from 'clone'\nimport shortid from 'shortid'\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport {\n  readConfObject,\n  getConf,\n  isConfigurationModel,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  Region,\n  AbstractSessionModel,\n  TrackViewModel,\n  JBrowsePlugin,\n  DialogComponentType,\n} from '@jbrowse/core/util/types'\n\nimport addSnackbarToModel from '@jbrowse/core/ui/SnackbarModel'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observable } from 'mobx'\nimport {\n  getMembers,\n  getParent,\n  getRoot,\n  getSnapshot,\n  getType,\n  isAlive,\n  isModelType,\n  isReferenceType,\n  types,\n  walk,\n  cast,\n  IAnyStateTreeNode,\n  Instance,\n  SnapshotIn,\n  SnapshotOut,\n} from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\n\n// icons\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport CopyIcon from '@mui/icons-material/FileCopy'\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport InfoIcon from '@mui/icons-material/Info'\n\nconst AboutDialog = lazy(() => import('@jbrowse/core/ui/AboutDialog'))\n\nexport declare interface ReferringNode {\n  node: IAnyStateTreeNode\n  key: string\n}\n\nexport declare interface ReactProps {\n  [key: string]: any\n}\n\ntype AnyConfiguration =\n  | AnyConfigurationModel\n  | SnapshotOut<AnyConfigurationModel>\n\n/**\n * #stateModel JBrowseWebSessionModel\n */\nexport default function sessionModelFactory(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType = types.frozen(),\n) {\n  const minDrawerWidth = 128\n  const sessionModel = types\n    .model('JBrowseWebSessionModel', {\n      /**\n       * #property\n       */\n      id: types.optional(types.identifier, shortid()),\n      /**\n       * #property\n       */\n      name: types.string,\n      /**\n       * #property\n       */\n      margin: 0,\n      /**\n       * #property\n       */\n      drawerWidth: types.optional(\n        types.refinement(types.integer, width => width >= minDrawerWidth),\n        384,\n      ),\n      /**\n       * #property\n       */\n      views: types.array(pluginManager.pluggableMstType('view', 'stateModel')),\n      /**\n       * #property\n       */\n      widgets: types.map(\n        pluginManager.pluggableMstType('widget', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      activeWidgets: types.map(\n        types.safeReference(\n          pluginManager.pluggableMstType('widget', 'stateModel'),\n        ),\n      ),\n      /**\n       * #property\n       */\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType('connection', 'stateModel'),\n      ),\n      /**\n       * #property\n       */\n      sessionTracks: types.array(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n      /**\n       * #property\n       */\n      sessionConnections: types.array(\n        pluginManager.pluggableConfigSchemaType('connection'),\n      ),\n      /**\n       * #property\n       */\n      sessionAssemblies: types.array(assemblyConfigSchemasType),\n      /**\n       * #property\n       */\n      temporaryAssemblies: types.array(assemblyConfigSchemasType),\n      /**\n       * #property\n       */\n      sessionPlugins: types.array(types.frozen()),\n      /**\n       * #property\n       */\n      minimized: types.optional(types.boolean, false),\n\n      /**\n       * #property\n       */\n      drawerPosition: types.optional(\n        types.string,\n        localStorage.getItem('drawerPosition') || 'right',\n      ),\n    })\n    .volatile((/* self */) => ({\n      /**\n       * !volatile\n       * this is the globally \"selected\" object. can be anything.\n       * code that wants to deal with this should examine it to see what\n       * kind of thing it is.\n       */\n      selection: undefined,\n      /**\n       * !volatile\n       * this is the current \"task\" that is being performed in the UI.\n       * this is usually an object of the form\n       * `{ taskName: \"configure\", target: thing_being_configured }`\n       */\n      task: undefined,\n\n      queueOfDialogs: observable.array(\n        [] as [DialogComponentType, ReactProps][],\n      ),\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get DialogComponent() {\n        if (self.queueOfDialogs.length) {\n          const firstInQueue = self.queueOfDialogs[0]\n          return firstInQueue && firstInQueue[0]\n        }\n        return undefined\n      },\n      /**\n       * #getter\n       */\n      get DialogProps() {\n        if (self.queueOfDialogs.length) {\n          const firstInQueue = self.queueOfDialogs[0]\n          return firstInQueue && firstInQueue[1]\n        }\n        return undefined\n      },\n      /**\n       * #getter\n       */\n      get shareURL() {\n        return getConf(getParent<any>(self).jbrowse, 'shareURL')\n      },\n      /**\n       * #getter\n       */\n      get rpcManager() {\n        return getParent<any>(self).jbrowse.rpcManager as RpcManager\n      },\n\n      /**\n       * #getter\n       */\n      get configuration(): AnyConfigurationModel {\n        return getParent<any>(self).jbrowse.configuration\n      },\n      /**\n       * #getter\n       */\n      get assemblies(): AnyConfigurationModel[] {\n        return getParent<any>(self).jbrowse.assemblies\n      },\n      /**\n       * #getter\n       */\n      get assemblyNames(): string[] {\n        const { assemblyNames } = getParent<any>(self).jbrowse\n        const sessionAssemblyNames = self.sessionAssemblies.map(assembly =>\n          readConfObject(assembly, 'name'),\n        )\n        return [...assemblyNames, ...sessionAssemblyNames]\n      },\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return [...self.sessionTracks, ...getParent<any>(self).jbrowse.tracks]\n      },\n      /**\n       * #getter\n       */\n      get textSearchManager(): TextSearchManager {\n        return getParent<any>(self).textSearchManager\n      },\n      /**\n       * #getter\n       */\n      get connections(): AnyConfigurationModel[] {\n        return [\n          ...self.sessionConnections,\n          ...getParent<any>(self).jbrowse.connections,\n        ]\n      },\n      /**\n       * #getter\n       */\n      get adminMode(): boolean {\n        return getParent<any>(self).adminMode\n      },\n      /**\n       * #getter\n       */\n      get savedSessions() {\n        return getParent<any>(self).savedSessions\n      },\n      /**\n       * #getter\n       */\n      get previousAutosaveId() {\n        return getParent<any>(self).previousAutosaveId\n      },\n      /**\n       * #getter\n       */\n      get savedSessionNames() {\n        return getParent<any>(self).savedSessionNames\n      },\n      /**\n       * #getter\n       */\n      get history() {\n        return getParent<any>(self).history\n      },\n      /**\n       * #getter\n       */\n      get menus() {\n        return getParent<any>(self).menus\n      },\n      /**\n       * #getter\n       */\n      get assemblyManager() {\n        return getParent<any>(self).assemblyManager\n      },\n      /**\n       * #getter\n       */\n      get version() {\n        return getParent<any>(self).version\n      },\n\n      /**\n       * #method\n       */\n      renderProps() {\n        return { theme: getConf(self, 'theme') }\n      },\n\n      /**\n       * #getter\n       */\n      get visibleWidget() {\n        if (isAlive(self)) {\n          // returns most recently added item in active widgets\n          return Array.from(self.activeWidgets.values())[\n            self.activeWidgets.size - 1\n          ]\n        }\n        return undefined\n      },\n      /**\n       * #method\n       * See if any MST nodes currently have a types.reference to this object.\n       *\n       * @param object - object\n       * @returns An array where the first element is the node referring\n       * to the object and the second element is they property name the node is\n       * using to refer to the object\n       */\n      getReferring(object: IAnyStateTreeNode) {\n        const refs: ReferringNode[] = []\n        walk(getParent<any>(self), node => {\n          if (isModelType(getType(node))) {\n            const members = getMembers(node)\n            Object.entries(members.properties).forEach(([key, value]) => {\n              // @ts-ignore\n              if (isReferenceType(value) && node[key] === object) {\n                refs.push({ node, key })\n              }\n            })\n          }\n        })\n        return refs\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveViewUp(id: string) {\n        const idx = self.views.findIndex(v => v.id === id)\n\n        if (idx === -1) {\n          return\n        }\n        if (idx > 0) {\n          self.views.splice(idx - 1, 2, self.views[idx], self.views[idx - 1])\n        }\n      },\n      /**\n       * #action\n       */\n      moveViewDown(id: string) {\n        const idx = self.views.findIndex(v => v.id === id)\n\n        if (idx === -1) {\n          return\n        }\n\n        if (idx < self.views.length - 1) {\n          self.views.splice(idx, 2, self.views[idx + 1], self.views[idx])\n        }\n      },\n      /**\n       * #action\n       */\n      setDrawerPosition(arg: string) {\n        self.drawerPosition = arg\n        localStorage.setItem('drawerPosition', arg)\n      },\n      /**\n       * #action\n       */\n      queueDialog(\n        callback: (\n          doneCallback: () => void,\n        ) => [DialogComponentType, ReactProps],\n      ) {\n        const [component, props] = callback(() => self.queueOfDialogs.shift())\n        self.queueOfDialogs.push([component, props])\n      },\n      /**\n       * #action\n       */\n      setName(str: string) {\n        self.name = str\n      },\n\n      /**\n       * #action\n       */\n      addAssembly(conf: AnyConfiguration) {\n        const asm = self.sessionAssemblies.find(f => f.name === conf.name)\n        if (asm) {\n          console.warn(`Assembly ${conf.name} was already existing`)\n          return asm\n        }\n        const length = self.sessionAssemblies.push(conf)\n        return self.sessionAssemblies[length - 1]\n      },\n\n      /**\n       * #action\n       * used for read vs ref type assemblies.\n       */\n      addTemporaryAssembly(conf: AnyConfiguration) {\n        const asm = self.sessionAssemblies.find(f => f.name === conf.name)\n        if (asm) {\n          console.warn(`Assembly ${conf.name} was already existing`)\n          return asm\n        }\n        const length = self.temporaryAssemblies.push(conf)\n        return self.temporaryAssemblies[length - 1]\n      },\n      /**\n       * #action\n       */\n      addSessionPlugin(plugin: JBrowsePlugin) {\n        if (self.sessionPlugins.find(p => p.name === plugin.name)) {\n          throw new Error('session plugin cannot be installed twice')\n        }\n        self.sessionPlugins.push(plugin)\n        getRoot<any>(self).setPluginsUpdated(true)\n      },\n      /**\n       * #action\n       */\n      removeAssembly(assemblyName: string) {\n        const index = self.sessionAssemblies.findIndex(\n          asm => asm.name === assemblyName,\n        )\n        if (index !== -1) {\n          self.sessionAssemblies.splice(index, 1)\n        }\n      },\n      /**\n       * #action\n       */\n      removeTemporaryAssembly(assemblyName: string) {\n        const index = self.temporaryAssemblies.findIndex(\n          asm => asm.name === assemblyName,\n        )\n        if (index !== -1) {\n          self.temporaryAssemblies.splice(index, 1)\n        }\n      },\n      /**\n       * #action\n       */\n      removeSessionPlugin(pluginDefinition: PluginDefinition) {\n        self.sessionPlugins = cast(\n          self.sessionPlugins.filter(\n            plugin =>\n              plugin.url !== pluginDefinition.url ||\n              plugin.umdUrl !== pluginDefinition.umdUrl ||\n              plugin.cjsUrl !== pluginDefinition.cjsUrl ||\n              plugin.esmUrl !== pluginDefinition.esmUrl,\n          ),\n        )\n        const rootModel = getParent<any>(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      /**\n       * #action\n       */\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const { type } = configuration\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const connectionData = {\n          ...initialSnapshot,\n          name,\n          type,\n          configuration,\n        }\n        const length = self.connectionInstances.push(connectionData)\n        return self.connectionInstances[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      removeReferring(\n        referring: any,\n        track: any,\n        callbacks: Function[],\n        dereferenceTypeCount: Record<string, number>,\n      ) {\n        referring.forEach(({ node }: ReferringNode) => {\n          let dereferenced = false\n          try {\n            // If a view is referring to the track config, remove the track\n            // from the view\n            const type = 'open track(s)'\n            const view = getContainingView(node) as TrackViewModel\n            callbacks.push(() => view.hideTrack(track.trackId))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          } catch (err1) {\n            // ignore\n          }\n\n          // @ts-ignore\n          if (self.widgets.has(node.id)) {\n            // If a configuration editor widget has the track config\n            // open, close the widget\n            const type = 'configuration editor widget(s)'\n            callbacks.push(() => this.hideWidget(node))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          }\n          if (!dereferenced) {\n            throw new Error(\n              `Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(\n                getSnapshot(node),\n              )}`,\n            )\n          }\n        })\n      },\n\n      /**\n       * #action\n       */\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (connection) {\n          connection.tracks.forEach((track: any) => {\n            const referring = self.getReferring(track)\n            this.removeReferring(\n              referring,\n              track,\n              callbacksToDereferenceTrack,\n              dereferenceTypeCount,\n            )\n          })\n          const safelyBreakConnection = () => {\n            callbacksToDereferenceTrack.forEach(cb => cb())\n            this.breakConnection(configuration)\n          }\n          return [safelyBreakConnection, dereferenceTypeCount]\n        }\n        return undefined\n      },\n\n      /**\n       * #action\n       */\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        self.connectionInstances.remove(connection)\n      },\n\n      /**\n       * #action\n       */\n      deleteConnection(configuration: AnyConfigurationModel) {\n        let deletedConn\n        if (self.adminMode) {\n          deletedConn =\n            getParent<any>(self).jbrowse.deleteConnectionConf(configuration)\n        }\n        if (!deletedConn) {\n          const { connectionId } = configuration\n          const idx = self.sessionConnections.findIndex(\n            c => c.connectionId === connectionId,\n          )\n          if (idx === -1) {\n            return undefined\n          }\n          return self.sessionConnections.splice(idx, 1)\n        }\n        return deletedConn\n      },\n\n      /**\n       * #action\n       */\n      updateDrawerWidth(drawerWidth: number) {\n        if (drawerWidth === self.drawerWidth) {\n          return self.drawerWidth\n        }\n        let newDrawerWidth = drawerWidth\n        if (newDrawerWidth < minDrawerWidth) {\n          newDrawerWidth = minDrawerWidth\n        }\n        self.drawerWidth = newDrawerWidth\n        return newDrawerWidth\n      },\n\n      /**\n       * #action\n       */\n      resizeDrawer(distance: number) {\n        if (self.drawerPosition === 'left') {\n          distance *= -1\n        }\n        const oldDrawerWidth = self.drawerWidth\n        const newDrawerWidth = this.updateDrawerWidth(oldDrawerWidth - distance)\n        const actualDistance = oldDrawerWidth - newDrawerWidth\n        return actualDistance\n      },\n\n      /**\n       * #action\n       */\n      addView(typeName: string, initialState = {}) {\n        const typeDefinition = pluginManager.getElementType('view', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown view type ${typeName}`)\n        }\n\n        const length = self.views.push({\n          ...initialState,\n          type: typeName,\n        })\n        return self.views[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: any) {\n        for (const [, widget] of self.activeWidgets) {\n          if (widget.view && widget.view.id === view.id) {\n            this.hideWidget(widget)\n          }\n        }\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       */\n      addAssemblyConf(assemblyConf: AnyConfiguration) {\n        return getParent<any>(self).jbrowse.addAssemblyConf(assemblyConf)\n      },\n\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfiguration) {\n        if (self.adminMode) {\n          return getParent<any>(self).jbrowse.addTrackConf(trackConf)\n        }\n        const { trackId, type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const track = self.sessionTracks.find((t: any) => t.trackId === trackId)\n        if (track) {\n          return track\n        }\n        const length = self.sessionTracks.push(trackConf)\n        return self.sessionTracks[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const referring = self.getReferring(trackConf)\n        this.removeReferring(\n          referring,\n          trackConf,\n          callbacksToDereferenceTrack,\n          dereferenceTypeCount,\n        )\n        callbacksToDereferenceTrack.forEach(cb => cb())\n        if (self.adminMode) {\n          return getParent<any>(self).jbrowse.deleteTrackConf(trackConf)\n        }\n        const { trackId } = trackConf\n        const idx = self.sessionTracks.findIndex(t => t.trackId === trackId)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.sessionTracks.splice(idx, 1)\n      },\n\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: any) {\n        if (self.adminMode) {\n          return getParent<any>(self).jbrowse.addConnectionConf(connectionConf)\n        }\n        const { connectionId, type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const connection = self.sessionTracks.find(\n          (c: any) => c.connectionId === connectionId,\n        )\n        if (connection) {\n          return connection\n        }\n        const length = self.sessionConnections.push(connectionConf)\n        return self.sessionConnections[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      addLinearGenomeViewOfAssembly(assemblyName: string, initialState = {}) {\n        return this.addViewOfAssembly(\n          'LinearGenomeView',\n          assemblyName,\n          initialState,\n        )\n      },\n\n      /**\n       * #action\n       */\n      addViewOfAssembly(\n        viewType: any,\n        assemblyName: string,\n        initialState: any = {},\n      ) {\n        const assembly = self.assemblies.find(\n          s => readConfObject(s, 'name') === assemblyName,\n        )\n        if (!assembly) {\n          throw new Error(\n            `Could not add view of assembly \"${assemblyName}\", assembly name not found`,\n          )\n        }\n        initialState.displayRegionsFromAssemblyName = readConfObject(\n          assembly,\n          'name',\n        )\n        return this.addView(viewType, initialState)\n      },\n\n      /**\n       * #action\n       */\n      addViewFromAnotherView(\n        viewType: string,\n        otherView: any,\n        initialState: { displayedRegions?: Region[] } = {},\n      ) {\n        const state = { ...initialState }\n        state.displayedRegions = getSnapshot(otherView.displayedRegions)\n        return this.addView(viewType, state)\n      },\n\n      /**\n       * #action\n       */\n      addWidget(\n        typeName: string,\n        id: string,\n        initialState = {},\n        configuration = { type: typeName },\n      ) {\n        const typeDefinition = pluginManager.getElementType('widget', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown widget type ${typeName}`)\n        }\n        const data = {\n          ...initialState,\n          id,\n          type: typeName,\n          configuration,\n        }\n        self.widgets.set(id, data)\n        return self.widgets.get(id)\n      },\n\n      /**\n       * #action\n       */\n      showWidget(widget: any) {\n        if (self.activeWidgets.has(widget.id)) {\n          self.activeWidgets.delete(widget.id)\n        }\n        self.activeWidgets.set(widget.id, widget)\n        self.minimized = false\n      },\n\n      /**\n       * #action\n       */\n      hasWidget(widget: any) {\n        return self.activeWidgets.has(widget.id)\n      },\n\n      /**\n       * #action\n       */\n      hideWidget(widget: any) {\n        self.activeWidgets.delete(widget.id)\n      },\n      /**\n       * #action\n       */\n      minimizeWidgetDrawer() {\n        self.minimized = true\n      },\n      /**\n       * #action\n       */\n      showWidgetDrawer() {\n        self.minimized = false\n      },\n      /**\n       * #action\n       */\n      hideAllWidgets() {\n        self.activeWidgets.clear()\n      },\n\n      /**\n       * #action\n       * set the global selection, i.e. the globally-selected object.\n       * can be a feature, a view, just about anything\n       * @param thing -\n       */\n      setSelection(thing: any) {\n        self.selection = thing\n      },\n\n      /**\n       * #action\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n\n      /**\n       * #action\n       */\n      clearConnections() {\n        self.connectionInstances.length = 0\n      },\n\n      /**\n       * #action\n       */\n      addSavedSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return getParent<any>(self).addSavedSession(sessionSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      removeSavedSession(sessionSnapshot: any) {\n        return getParent<any>(self).removeSavedSession(sessionSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      renameCurrentSession(sessionName: string) {\n        return getParent<any>(self).renameCurrentSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      duplicateCurrentSession() {\n        return getParent<any>(self).duplicateCurrentSession()\n      },\n      /**\n       * #action\n       */\n      activateSession(sessionName: any) {\n        return getParent<any>(self).activateSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        return getParent<any>(self).setDefaultSession()\n      },\n\n      /**\n       * #action\n       */\n      saveSessionToLocalStorage() {\n        return getParent<any>(self).saveSessionToLocalStorage()\n      },\n\n      /**\n       * #action\n       */\n      loadAutosaveSession() {\n        return getParent<any>(self).loadAutosaveSession()\n      },\n\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return getParent<any>(self).setSession(sessionSnapshot)\n      },\n    }))\n\n    .actions(self => ({\n      /**\n       * #action\n       * opens a configuration editor to configure the given thing,\n       * and sets the current task to be configuring it\n       * @param configuration -\n       */\n      editConfiguration(configuration: AnyConfigurationModel) {\n        if (!isConfigurationModel(configuration)) {\n          throw new Error(\n            'must pass a configuration model to editConfiguration',\n          )\n        }\n        const editableConfigSession = self\n        const editor = editableConfigSession.addWidget(\n          'ConfigurationEditorWidget',\n          'configEditor',\n          { target: configuration },\n        )\n        editableConfigSession.showWidget(editor)\n      },\n\n      /**\n       * #action\n       */\n      editTrackConfiguration(configuration: AnyConfigurationModel) {\n        const { adminMode, sessionTracks } = self\n        if (!adminMode && sessionTracks.indexOf(configuration) === -1) {\n          throw new Error(\"Can't edit the configuration of a non-session track\")\n        }\n        this.editConfiguration(configuration)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getTrackActionMenuItems(config: AnyConfigurationModel) {\n        const { adminMode, sessionTracks } = self\n        const canEdit =\n          adminMode || sessionTracks.find(t => t.trackId === config.trackId)\n\n        // disable if it is a reference sequence track\n        const isRefSeq =\n          readConfObject(config, 'type') === 'ReferenceSequenceTrack'\n        return [\n          {\n            label: 'About track',\n            onClick: () => {\n              self.queueDialog(handleClose => [\n                AboutDialog,\n                { config, handleClose },\n              ])\n            },\n            icon: InfoIcon,\n          },\n          {\n            label: 'Settings',\n            disabled: !canEdit,\n            onClick: () => self.editTrackConfiguration(config),\n            icon: SettingsIcon,\n          },\n          {\n            label: 'Delete track',\n            disabled: !canEdit || isRefSeq,\n            onClick: () => self.deleteTrackConf(config),\n            icon: DeleteIcon,\n          },\n          {\n            label: 'Copy track',\n            disabled: isRefSeq,\n            onClick: () => {\n              const snap = clone(getSnapshot(config)) as any\n              const now = Date.now()\n              snap.trackId += `-${now}`\n              snap.displays.forEach((display: { displayId: string }) => {\n                display.displayId += `-${now}`\n              })\n              // the -sessionTrack suffix to trackId is used as metadata for\n              // the track selector to store the track in a special category,\n              // and default category is also cleared\n              if (!self.adminMode) {\n                snap.trackId += '-sessionTrack'\n                snap.category = undefined\n              }\n              snap.name += ' (copy)'\n              self.addTrackConf(snap)\n            },\n            icon: CopyIcon,\n          },\n        ]\n      },\n    }))\n\n  const extendedSessionModel = pluginManager.evaluateExtensionPoint(\n    'Core-extendSession',\n    sessionModel,\n  ) as typeof sessionModel\n\n  return types.snapshotProcessor(addSnackbarToModel(extendedSessionModel), {\n    // @ts-ignore\n    preProcessor(snapshot) {\n      if (snapshot) {\n        // @ts-ignore\n        const { connectionInstances, ...rest } = snapshot || {}\n        // connectionInstances schema changed from object to an array, so any\n        // old connectionInstances as object is in snapshot, filter it out\n        // https://github.com/GMOD/jbrowse-components/issues/1903\n        if (!Array.isArray(connectionInstances)) {\n          return rest\n        }\n      }\n      return snapshot\n    },\n  })\n}\n\nexport type SessionStateModel = ReturnType<typeof sessionModelFactory>\nexport type SessionModel = Instance<SessionStateModel>\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction z(x: Instance<SessionStateModel>): AbstractSessionModel {\n  // this function's sole purpose is to get typescript to check\n  // that the session model implements all of AbstractSessionModel\n  return x\n}\n","import {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getType,\n  types,\n  IAnyStateTreeNode,\n  SnapshotIn,\n} from 'mobx-state-tree'\n\nimport { saveAs } from 'file-saver'\nimport { observable, autorun } from 'mobx'\nimport assemblyManagerFactory from '@jbrowse/core/assemblyManager'\nimport assemblyConfigSchemaFactory from '@jbrowse/core/assemblyManager/assemblyConfigSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport TimeTraveller from '@jbrowse/core/util/TimeTraveller'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { AbstractSessionModel, SessionWithWidgets } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport AppsIcon from '@mui/icons-material/Apps'\nimport FileCopyIcon from '@mui/icons-material/FileCopy'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport GetAppIcon from '@mui/icons-material/GetApp'\nimport PublishIcon from '@mui/icons-material/Publish'\nimport ExtensionIcon from '@mui/icons-material/Extension'\nimport StorageIcon from '@mui/icons-material/Storage'\nimport SaveIcon from '@mui/icons-material/Save'\nimport UndoIcon from '@mui/icons-material/Undo'\nimport RedoIcon from '@mui/icons-material/Redo'\nimport { Cable } from '@jbrowse/core/ui/Icons'\n\n// other\nimport makeWorkerInstance from './makeWorkerInstance'\nimport corePlugins from './corePlugins'\nimport jbrowseWebFactory from './jbrowseModel'\nimport sessionModelFactory from './sessionModelFactory'\nimport { filterSessionInPlace } from './util'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\n\ninterface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\n\n/**\n * #stateModel JBrowseWebRootModel\n * note that many properties of the root model are available through the session, which\n * may be preferable since using getSession() is better relied on than getRoot()\n */\nexport default function RootModel(\n  pluginManager: PluginManager,\n  adminMode = false,\n) {\n  const assemblyConfigSchema = assemblyConfigSchemaFactory(pluginManager)\n  const Session = sessionModelFactory(pluginManager, assemblyConfigSchema)\n  const AssemblyManager = assemblyManagerFactory(\n    assemblyConfigSchema,\n    pluginManager,\n  )\n  return types\n    .model('Root', {\n      /**\n       * #property\n       * `jbrowse` is a mapping of the config.json into the in-memory state tree\n       */\n      jbrowse: jbrowseWebFactory(pluginManager, Session, assemblyConfigSchema),\n      /**\n       * #property\n       */\n      configPath: types.maybe(types.string),\n      /**\n       * #property\n       * `session` encompasses the currently active state of the app, including\n       * views open, tracks open in those views, etc.\n       */\n      session: types.maybe(Session),\n      /**\n       * #property\n       */\n      assemblyManager: types.optional(AssemblyManager, {}),\n      /**\n       * #property\n       */\n      version: types.maybe(types.string),\n      /**\n       * #property\n       */\n      internetAccounts: types.array(\n        pluginManager.pluggableMstType('internet account', 'stateModel'),\n      ),\n      /**\n       * #property\n       * used for undo/redo\n       */\n      history: types.optional(TimeTraveller, { targetPath: '../session' }),\n    })\n    .volatile(self => ({\n      isAssemblyEditing: false,\n      isDefaultSessionEditing: false,\n      pluginsUpdated: false,\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          WebWorkerRpcDriver: {\n            makeWorkerInstance,\n          },\n          MainThreadRpcDriver: {},\n        },\n      ),\n      savedSessionsVolatile: observable.map({}),\n      textSearchManager: new TextSearchManager(pluginManager),\n      error: undefined as unknown,\n    }))\n    .views(self => ({\n      get savedSessions() {\n        return Array.from(self.savedSessionsVolatile.values())\n      },\n      localStorageId(name: string) {\n        return `localSaved-${name}-${self.configPath}`\n      },\n      get autosaveId() {\n        return `autosave-${self.configPath}`\n      },\n      get previousAutosaveId() {\n        return `previousAutosave-${self.configPath}`\n      },\n    }))\n    .views(self => ({\n      get savedSessionNames() {\n        return self.savedSessions.map(session => session.name)\n      },\n      get currentSessionId() {\n        const locationUrl = new URL(window.location.href)\n        const params = new URLSearchParams(locationUrl.search)\n        return params?.get('session')?.split('local-')[1]\n      },\n    }))\n\n    .actions(self => ({\n      afterCreate() {\n        document.addEventListener('keydown', e => {\n          const cm = e.ctrlKey || e.metaKey\n          if (self.history.canRedo) {\n            if (\n              // ctrl+shift+z or cmd+shift+z\n              (cm && e.shiftKey && e.code === 'KeyZ') ||\n              // ctrl+y\n              (e.ctrlKey && !e.shiftKey && e.code === 'KeyY')\n            ) {\n              self.history.redo()\n            }\n          }\n          if (self.history.canUndo) {\n            // ctrl+z or cmd+z\n            if (cm && !e.shiftKey && e.code === 'KeyZ') {\n              self.history.undo()\n            }\n          }\n        })\n\n        Object.entries(localStorage)\n          .filter(([key, _val]) => key.startsWith('localSaved-'))\n          .filter(([key]) => key.indexOf(self.configPath || 'undefined') !== -1)\n          .forEach(([key, val]) => {\n            try {\n              const { session } = JSON.parse(val)\n              self.savedSessionsVolatile.set(key, session)\n            } catch (e) {\n              console.error('bad session encountered', key, val)\n            }\n          })\n        addDisposer(\n          self,\n          autorun(() => {\n            for (const [, val] of self.savedSessionsVolatile.entries()) {\n              try {\n                const key = self.localStorageId(val.name)\n                localStorage.setItem(key, JSON.stringify({ session: val }))\n              } catch (e) {\n                // @ts-ignore\n                if (e.code === '22' || e.code === '1024') {\n                  alert(\n                    'Local storage is full! Please use the \"Open sessions\" panel to remove old sessions',\n                  )\n                }\n              }\n            }\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(() => {\n            if (self.session) {\n              // we use a specific initialization routine after session is\n              // created to get it to start tracking itself sort of related\n              // issue here\n              // https://github.com/mobxjs/mobx-state-tree/issues/1089#issuecomment-441207911\n              self.history.initialize()\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.session) {\n                const noSession = { name: 'empty' }\n                const snapshot = getSnapshot(self.session) || noSession\n                sessionStorage.setItem(\n                  'current',\n                  JSON.stringify({ session: snapshot }),\n                )\n\n                localStorage.setItem(\n                  `autosave-${self.configPath}`,\n                  JSON.stringify({\n                    session: {\n                      ...snapshot,\n                      name: `${snapshot.name}-autosaved`,\n                    },\n                  }),\n                )\n                if (self.pluginsUpdated) {\n                  // reload app to get a fresh plugin manager\n                  window.location.reload()\n                }\n              }\n            },\n            { delay: 400 },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.jbrowse.internetAccounts.forEach(account => {\n              this.initializeInternetAccount(account)\n            })\n          }),\n        )\n      },\n      setSession(sessionSnapshot?: SnapshotIn<typeof Session>) {\n        const oldSession = self.session\n        self.session = cast(sessionSnapshot)\n        if (self.session) {\n          // validate all references in the session snapshot\n          try {\n            filterSessionInPlace(self.session, getType(self.session))\n          } catch (error) {\n            // throws error if session filtering failed\n            self.session = oldSession\n            throw error\n          }\n        }\n      },\n      initializeInternetAccount(\n        internetAccountConfig: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const internetAccountType = pluginManager.getInternetAccountType(\n          internetAccountConfig.type,\n        )\n        if (!internetAccountType) {\n          throw new Error(\n            `unknown internet account type ${internetAccountConfig.type}`,\n          )\n        }\n\n        const length = self.internetAccounts.push({\n          ...initialSnapshot,\n          type: internetAccountConfig.type,\n          configuration: internetAccountConfig,\n        })\n        return self.internetAccounts[length - 1]\n      },\n      createEphemeralInternetAccount(\n        internetAccountId: string,\n        initialSnapshot = {},\n        url: string,\n      ) {\n        let hostUri\n\n        try {\n          hostUri = new URL(url).origin\n        } catch (e) {\n          // ignore\n        }\n        // id of a custom new internaccount is `${type}-${name}`\n        const internetAccountSplit = internetAccountId.split('-')\n        const configuration = {\n          type: internetAccountSplit[0],\n          internetAccountId: internetAccountId,\n          name: internetAccountSplit.slice(1).join('-'),\n          description: '',\n          domains: hostUri ? [hostUri] : [],\n        }\n        const internetAccountType = pluginManager.getInternetAccountType(\n          configuration.type,\n        )\n        const internetAccount = internetAccountType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.internetAccounts.push(internetAccount)\n        return internetAccount\n      },\n      setAssemblyEditing(flag: boolean) {\n        self.isAssemblyEditing = flag\n      },\n      setDefaultSessionEditing(flag: boolean) {\n        self.isDefaultSessionEditing = flag\n      },\n      setPluginsUpdated(flag: boolean) {\n        self.pluginsUpdated = flag\n      },\n      setDefaultSession() {\n        const { defaultSession } = self.jbrowse\n        const newSession = {\n          ...defaultSession,\n          name: `${defaultSession.name} ${new Date().toLocaleString()}`,\n        }\n\n        this.setSession(newSession)\n      },\n      renameCurrentSession(sessionName: string) {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          snapshot.name = sessionName\n          this.setSession(snapshot)\n        }\n      },\n\n      addSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        self.savedSessionsVolatile.set(key, session)\n      },\n\n      removeSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        localStorage.removeItem(key)\n        self.savedSessionsVolatile.delete(key)\n      },\n\n      duplicateCurrentSession() {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          let newSnapshotName = `${self.session.name} (copy)`\n          if (self.savedSessionNames.includes(newSnapshotName)) {\n            let newSnapshotCopyNumber = 2\n            do {\n              newSnapshotName = `${self.session.name} (copy ${newSnapshotCopyNumber})`\n              newSnapshotCopyNumber += 1\n            } while (self.savedSessionNames.includes(newSnapshotName))\n          }\n          snapshot.name = newSnapshotName\n          this.setSession(snapshot)\n        }\n      },\n      activateSession(name: string) {\n        const localId = self.localStorageId(name)\n        const newSessionSnapshot = localStorage.getItem(localId)\n        if (!newSessionSnapshot) {\n          throw new Error(\n            `Can't activate session ${name}, it is not in the savedSessions`,\n          )\n        }\n\n        this.setSession(JSON.parse(newSessionSnapshot).session)\n      },\n      saveSessionToLocalStorage() {\n        if (self.session) {\n          const key = self.localStorageId(self.session.name)\n          self.savedSessionsVolatile.set(key, getSnapshot(self.session))\n        }\n      },\n      loadAutosaveSession() {\n        const previousAutosave = localStorage.getItem(self.previousAutosaveId)\n        const autosavedSession = previousAutosave\n          ? JSON.parse(previousAutosave).session\n          : {}\n        const { name } = autosavedSession\n        autosavedSession.name = `${name.replace('-autosaved', '')}-restored`\n        this.setSession(autosavedSession)\n      },\n\n      setError(error?: unknown) {\n        self.error = error\n      },\n      findAppropriateInternetAccount(location: UriLocation) {\n        // find the existing account selected from menu\n        const selectedId = location.internetAccountId\n        if (selectedId) {\n          const selectedAccount = self.internetAccounts.find(account => {\n            return account.internetAccountId === selectedId\n          })\n          if (selectedAccount) {\n            return selectedAccount\n          }\n        }\n\n        // if no existing account or not found, try to find working account\n        for (const account of self.internetAccounts) {\n          const handleResult = account.handlesLocation(location)\n          if (handleResult) {\n            return account\n          }\n        }\n\n        // if still no existing account, create ephemeral config to use\n        return selectedId\n          ? this.createEphemeralInternetAccount(selectedId, {}, location.uri)\n          : null\n      },\n    }))\n    .volatile(self => ({\n      menus: [\n        {\n          label: 'File',\n          menuItems: [\n            {\n              label: 'New session',\n              icon: AddIcon,\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              onClick: (session: any) => {\n                const lastAutosave = localStorage.getItem(self.autosaveId)\n                if (lastAutosave) {\n                  localStorage.setItem(self.previousAutosaveId, lastAutosave)\n                }\n                session.setDefaultSession()\n              },\n            },\n            {\n              label: 'Import session',\n              icon: PublishIcon,\n              onClick: (session: SessionWithWidgets) => {\n                const widget = session.addWidget(\n                  'ImportSessionWidget',\n                  'importSessionWidget',\n                )\n                session.showWidget(widget)\n              },\n            },\n            {\n              label: 'Export session',\n              icon: GetAppIcon,\n              onClick: (session: IAnyStateTreeNode) => {\n                const sessionBlob = new Blob(\n                  [JSON.stringify({ session: getSnapshot(session) }, null, 2)],\n                  { type: 'text/plain;charset=utf-8' },\n                )\n                saveAs(sessionBlob, 'session.json')\n              },\n            },\n            {\n              label: 'Open session',\n              icon: FolderOpenIcon,\n              onClick: (session: SessionWithWidgets) => {\n                const widget = session.addWidget(\n                  'SessionManager',\n                  'sessionManager',\n                )\n                session.showWidget(widget)\n              },\n            },\n            {\n              label: 'Save session',\n              icon: SaveIcon,\n              onClick: (session: SessionWithWidgets) => {\n                self.saveSessionToLocalStorage()\n                session.notify(`Saved session \"${session.name}\"`, 'success')\n              },\n            },\n            {\n              label: 'Duplicate session',\n              icon: FileCopyIcon,\n              onClick: (session: AbstractSessionModel) => {\n                if (session.duplicateCurrentSession) {\n                  session.duplicateCurrentSession()\n                }\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Open track...',\n              icon: StorageIcon,\n              onClick: (session: SessionWithWidgets) => {\n                if (session.views.length === 0) {\n                  session.notify('Please open a view to add a track first')\n                } else if (session.views.length >= 1) {\n                  const widget = session.addWidget(\n                    'AddTrackWidget',\n                    'addTrackWidget',\n                    { view: session.views[0].id },\n                  )\n                  session.showWidget(widget)\n                  if (session.views.length > 1) {\n                    session.notify(\n                      `This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right`,\n                    )\n                  }\n                }\n              },\n            },\n            {\n              label: 'Open connection...',\n              icon: Cable,\n              onClick: (session: SessionWithWidgets) => {\n                const widget = session.addWidget(\n                  'AddConnectionWidget',\n                  'addConnectionWidget',\n                )\n                session.showWidget(widget)\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Return to splash screen',\n              icon: AppsIcon,\n              onClick: () => {\n                self.setSession(undefined)\n              },\n            },\n          ],\n        },\n        ...(adminMode\n          ? [\n              {\n                label: 'Admin',\n                menuItems: [\n                  {\n                    label: 'Open assembly manager',\n                    icon: SettingsIcon,\n                    onClick: () => {\n                      self.setAssemblyEditing(true)\n                    },\n                  },\n                  {\n                    label: 'Set default session',\n                    icon: SettingsIcon,\n                    onClick: () => {\n                      self.setDefaultSessionEditing(true)\n                    },\n                  },\n                ],\n              },\n            ]\n          : []),\n        {\n          label: 'Add',\n          menuItems: [],\n        },\n        {\n          label: 'Tools',\n          menuItems: [\n            {\n              label: 'Undo',\n              disabled: self.history.canUndo,\n              icon: UndoIcon,\n              onClick: () => {\n                self.history.undo()\n              },\n            },\n            {\n              label: 'Redo',\n              disabled: self.history.canRedo,\n              icon: RedoIcon,\n              onClick: () => {\n                self.history.redo()\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Plugin store',\n              icon: ExtensionIcon,\n              onClick: () => {\n                if (self.session) {\n                  const widget = self.session.addWidget(\n                    'PluginStoreWidget',\n                    'pluginStoreWidget',\n                  )\n                  self.session.showWidget(widget)\n                }\n              },\n            },\n          ],\n        },\n      ] as Menu[],\n      adminMode,\n    }))\n    .actions(self => ({\n      setMenus(newMenus: Menu[]) {\n        self.menus = newMenus\n      },\n      /**\n       * Add a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @returns The new length of the top-level menus array\n       */\n      appendMenu(menuName: string) {\n        return self.menus.push({ label: menuName, menuItems: [] })\n      },\n      /**\n       * Insert a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @param position - Position to insert menu. If negative, counts from th\n       * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n       * second-to-last one.\n       * @returns The new length of the top-level menus array\n       */\n      insertMenu(menuName: string, position: number) {\n        self.menus.splice(\n          (position < 0 ? self.menus.length : 0) + position,\n          0,\n          { label: menuName, menuItems: [] },\n        )\n        return self.menus.length\n      },\n      /**\n       * Add a menu item to a top-level menu\n       * @param menuName - Name of the top-level menu to append to.\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the menu\n       */\n      appendToMenu(menuName: string, menuItem: MenuItem) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        return menu.menuItems.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a top-level menu\n       * @param menuName - Name of the top-level menu to insert into\n       * @param menuItem - Menu item to insert\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the menu\n       */\n      insertInMenu(menuName: string, menuItem: MenuItem, position: number) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        const insertPosition =\n          position < 0 ? menu.menuItems.length + position : position\n        menu.menuItems.splice(insertPosition, 0, menuItem)\n        return menu.menuItems.length\n      },\n      /**\n       * Add a menu item to a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the sub-menu\n       */\n      appendToSubMenu(menuPath: string[], menuItem: MenuItem) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        return subMenu.push(menuItem)\n      },\n      /**\n       * Insert a menu item into a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to insert.\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the sub-menu\n       */\n      insertInSubMenu(\n        menuPath: string[],\n        menuItem: MenuItem,\n        position: number,\n      ) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        subMenu.splice(position, 0, menuItem)\n        return subMenu.length\n      },\n    }))\n}\n\nexport function createTestSession(snapshot = {}, adminMode = false) {\n  const pluginManager = new PluginManager(corePlugins.map(P => new P()))\n  pluginManager.createPluggableElements()\n\n  const root = RootModel(pluginManager, adminMode).create(\n    {\n      jbrowse: {\n        configuration: { rpc: { defaultDriver: 'MainThreadRpcDriver' } },\n      },\n      assemblyManager: {},\n    },\n    { pluginManager },\n  )\n  root.setSession({\n    name: 'testSession',\n    ...snapshot,\n  })\n\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const session = root.session!\n  session.views.map(view => view.setWidth(800))\n  pluginManager.setRootModel(root)\n  pluginManager.configure()\n  return session\n}\n","export default async function factoryReset() {\n  // @ts-ignore\n  window.location = window.location.pathname\n}\n","import domLoadScript from 'load-script2'\n\nimport { PluginConstructor } from './Plugin'\nimport ReExports from './ReExports'\nimport { isElectron } from './util'\n\nexport interface UMDLocPluginDefinition {\n  umdLoc: { uri: string; baseUri?: string }\n  name: string\n}\nexport interface UMDUrlPluginDefinition {\n  umdUrl: string\n  name: string\n}\n\nexport interface LegacyUMDPluginDefinition {\n  url: string\n  name: string\n}\n\ntype UMDPluginDefinition = UMDLocPluginDefinition | UMDUrlPluginDefinition\n\nexport function isUMDPluginDefinition(\n  def: PluginDefinition,\n): def is UMDPluginDefinition | LegacyUMDPluginDefinition {\n  return (\n    ((def as UMDUrlPluginDefinition).umdUrl !== undefined ||\n      (def as LegacyUMDPluginDefinition).url !== undefined ||\n      (def as UMDLocPluginDefinition).umdLoc !== undefined) &&\n    (def as LegacyUMDPluginDefinition | UMDPluginDefinition).name !== undefined\n  )\n}\n\nexport interface ESMLocPluginDefinition {\n  esmLoc: { uri: string; baseUri?: string }\n}\nexport interface ESMUrlPluginDefinition {\n  esmUrl: string\n}\n\nexport type ESMPluginDefinition =\n  | ESMLocPluginDefinition\n  | ESMUrlPluginDefinition\n\nexport function isESMPluginDefinition(\n  def: PluginDefinition,\n): def is ESMPluginDefinition {\n  return (\n    (def as ESMUrlPluginDefinition).esmUrl !== undefined ||\n    (def as ESMLocPluginDefinition).esmLoc !== undefined\n  )\n}\n\nexport interface CJSPluginDefinition {\n  cjsUrl: string\n}\n\nexport function isCJSPluginDefinition(\n  def: PluginDefinition,\n): def is CJSPluginDefinition {\n  return (def as CJSPluginDefinition).cjsUrl !== undefined\n}\n\nexport interface PluginDefinition\n  extends Partial<UMDUrlPluginDefinition>,\n    Partial<UMDLocPluginDefinition>,\n    Partial<LegacyUMDPluginDefinition>,\n    Partial<ESMLocPluginDefinition>,\n    Partial<ESMUrlPluginDefinition>,\n    Partial<CJSPluginDefinition> {}\n\nexport interface PluginRecord {\n  plugin: PluginConstructor\n  definition: PluginDefinition\n}\n\nexport interface LoadedPlugin {\n  default: PluginConstructor\n}\n\nexport function getWindowPath(windowHref: string) {\n  return window.location.href + windowHref\n}\n\nfunction getGlobalObject(): Window {\n  // Based on window-or-global\n  // https://github.com/purposeindustries/window-or-global/blob/322abc71de0010c9e5d9d0729df40959e1ef8775/lib/index.js\n  return (\n    // eslint-disable-next-line no-restricted-globals\n    (typeof self === 'object' && self.self === self && self) ||\n    (typeof global === 'object' && global.global === global && global) ||\n    // @ts-ignore\n    this\n  )\n}\n\nfunction isInWebWorker(globalObject: ReturnType<typeof getGlobalObject>) {\n  return Boolean('WorkerGlobalScope' in globalObject)\n}\n\nexport default class PluginLoader {\n  definitions: PluginDefinition[] = []\n\n  fetchESM?: (url: string) => Promise<unknown>\n  fetchCJS?: (url: string) => Promise<LoadedPlugin>\n\n  constructor(\n    defs: PluginDefinition[] = [],\n    args?: {\n      fetchESM?: (url: string) => Promise<unknown>\n      fetchCJS?: (url: string) => Promise<LoadedPlugin>\n    },\n  ) {\n    this.fetchESM = args?.fetchESM\n    this.fetchCJS = args?.fetchCJS\n    this.definitions = JSON.parse(JSON.stringify(defs))\n  }\n\n  async loadScript(scriptUrl: string): Promise<void> {\n    const globalObject = getGlobalObject()\n    if (!isInWebWorker(globalObject)) {\n      return domLoadScript(scriptUrl)\n    }\n\n    // @ts-ignore\n    if (globalObject?.importScripts) {\n      // @ts-ignore\n      await globalObject.importScripts(scriptUrl)\n      return\n    }\n    throw new Error(\n      'cannot figure out how to load external JS scripts in this environment',\n    )\n  }\n\n  async loadCJSPlugin(def: CJSPluginDefinition, windowHref: string) {\n    const parsedUrl = new URL(def.cjsUrl, windowHref)\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `Cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    if (!this.fetchCJS) {\n      throw new Error('No fetchCJS callback provided')\n    }\n\n    return this.fetchCJS(parsedUrl.href)\n  }\n\n  async loadESMPlugin(def: ESMPluginDefinition, windowHref: string) {\n    const parsedUrl =\n      'esmUrl' in def\n        ? new URL(def.esmUrl, windowHref)\n        : new URL(def.esmLoc.uri, def.esmLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    const plugin = (await this.fetchESM?.(parsedUrl.href)) as\n      | LoadedPlugin\n      | undefined\n\n    if (!plugin) {\n      throw new Error(`Could not load ESM plugin: ${parsedUrl}`)\n    }\n    return plugin\n  }\n\n  async loadUMDPlugin(\n    def: UMDPluginDefinition | LegacyUMDPluginDefinition,\n    windowHref: string,\n  ) {\n    const parsedUrl =\n      'url' in def\n        ? new URL(def.url, windowHref)\n        : 'umdUrl' in def\n        ? new URL(def.umdUrl, windowHref)\n        : new URL(def.umdLoc.uri, def.umdLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    await this.loadScript(parsedUrl.href)\n    const moduleName = def.name\n    const umdName = `JBrowsePlugin${moduleName}`\n    const globalObject = getGlobalObject()\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const plugin = (globalObject as any)[umdName] as\n      | { default: PluginConstructor }\n      | undefined\n    if (!plugin) {\n      throw new Error(\n        `Failed to load UMD bundle for ${moduleName}, ${globalObject.constructor.name}.${umdName} is undefined`,\n      )\n    }\n    return plugin\n  }\n\n  async loadPlugin(def: PluginDefinition, windowHref: string) {\n    let plugin: LoadedPlugin\n    if (isElectron && isCJSPluginDefinition(def)) {\n      plugin = await this.loadCJSPlugin(def, windowHref)\n    } else if (isESMPluginDefinition(def)) {\n      plugin = await this.loadESMPlugin(def, windowHref)\n    } else if (isUMDPluginDefinition(def)) {\n      plugin = await this.loadUMDPlugin(def, windowHref)\n    } else if (!isElectron && isCJSPluginDefinition(def)) {\n      throw new Error(\n        `CommonJS plugin found, but not in a NodeJS environment: ${JSON.stringify(\n          def,\n        )}`,\n      )\n    } else {\n      throw new Error(`Could not determine plugin type: ${JSON.stringify(def)}`)\n    }\n    return plugin.default\n  }\n\n  installGlobalReExports(target: WindowOrWorkerGlobalScope) {\n    // @ts-ignore\n    target.JBrowseExports = Object.fromEntries(\n      Object.entries(ReExports).map(([moduleName, module]) => {\n        return [moduleName, module]\n      }),\n    )\n  }\n\n  async load(windowHref = '') {\n    return Promise.all(\n      this.definitions.map(async definition => ({\n        plugin: await this.loadPlugin(definition, windowHref),\n        definition,\n      })),\n    )\n  }\n}\n","import { types, addDisposer, Instance, SnapshotOut } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport PluginLoader, {\n  PluginDefinition,\n  PluginRecord,\n  isUMDPluginDefinition,\n  isCJSPluginDefinition,\n  isESMPluginDefinition,\n} from '@jbrowse/core/PluginLoader'\nimport { fromUrlSafeB64 } from './util'\nimport { readSessionFromDynamo } from './sessionSharing'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport shortid from 'shortid'\n\ntype Config = SnapshotOut<AnyConfigurationModel>\n\nfunction addRelativeUris(config: Config, base: URL) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        addRelativeUris(config[key], base)\n      } else if (key === 'uri') {\n        config.baseUri = base.href\n      }\n    }\n  }\n}\n\n// raw readConf alternative for before conf is initialized\nfunction readConf(\n  { configuration = {} }: { configuration?: Config },\n  attr: string,\n  def: string,\n) {\n  return configuration[attr] || def\n}\n\nasync function fetchPlugins() {\n  const response = await fetch('https://jbrowse.org/plugin-store/plugins.json')\n  if (!response.ok) {\n    throw new Error(\n      `HTTP ${response.status} ${response.statusText} fetching plugins`,\n    )\n  }\n  return response.json() as Promise<{ plugins: PluginDefinition[] }>\n}\n\nasync function checkPlugins(pluginsToCheck: PluginDefinition[]) {\n  const storePlugins = await fetchPlugins()\n  return pluginsToCheck.every(p => {\n    if (isUMDPluginDefinition(p)) {\n      return Boolean(\n        storePlugins.plugins.find(\n          pp =>\n            isUMDPluginDefinition(p) &&\n            (('url' in pp && 'url' in p && p.url === pp.url) ||\n              ('umdUrl' in pp && 'umdUrl' in p && p.umdUrl === pp.umdUrl)),\n        ),\n      )\n    }\n    if (isESMPluginDefinition(p)) {\n      return Boolean(\n        storePlugins.plugins.find(\n          pp =>\n            isESMPluginDefinition(p) && 'esmUrl' in p && p.esmUrl === pp.esmUrl,\n        ),\n      )\n    }\n    if (isCJSPluginDefinition(p)) {\n      return Boolean(\n        storePlugins.plugins.find(\n          pp => isCJSPluginDefinition(p) && p.cjsUrl === pp.cjsUrl,\n        ),\n      )\n    }\n    return false\n  })\n}\n\nconst SessionLoader = types\n  .model({\n    configPath: types.maybe(types.string),\n    sessionQuery: types.maybe(types.string),\n    password: types.maybe(types.string),\n    adminKey: types.maybe(types.string),\n    loc: types.maybe(types.string),\n    sessionTracks: types.maybe(types.string),\n    assembly: types.maybe(types.string),\n    tracks: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    blankSession: false as any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    sessionTriaged: undefined as any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    shareWarningOpen: false as any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    configSnapshot: undefined as any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    sessionSnapshot: undefined as any,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    sessionSpec: undefined as any,\n    runtimePlugins: [] as PluginRecord[],\n    sessionPlugins: [] as PluginRecord[],\n    sessionError: undefined as unknown,\n    configError: undefined as unknown,\n    bc1:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_request_session'),\n    bc2:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_respond_session'),\n  }))\n  .views(self => ({\n    get isSharedSession() {\n      return !!self.sessionQuery?.startsWith('share-')\n    },\n\n    get isSpecSession() {\n      return !!self.sessionQuery?.startsWith('spec-')\n    },\n\n    get isJb1StyleSession() {\n      return !!self.loc\n    },\n\n    get isEncodedSession() {\n      return !!self.sessionQuery?.startsWith('encoded-')\n    },\n\n    get isJsonSession() {\n      return !!self.sessionQuery?.startsWith('json-')\n    },\n\n    get isLocalSession() {\n      return !!self.sessionQuery?.startsWith('local-')\n    },\n\n    get ready() {\n      return Boolean(this.isSessionLoaded && !self.configError)\n    },\n\n    get error() {\n      return self.configError || self.sessionError\n    },\n\n    get isSessionLoaded() {\n      return Boolean(\n        self.sessionError ||\n          self.sessionSnapshot ||\n          self.blankSession ||\n          self.sessionSpec,\n      )\n    },\n    get isConfigLoaded() {\n      return Boolean(self.configError || self.configSnapshot)\n    },\n\n    get sessionTracksParsed() {\n      return self.sessionTracks ? JSON.parse(self.sessionTracks) : []\n    },\n  }))\n  .actions(self => ({\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    setSessionQuery(session?: any) {\n      self.sessionQuery = session\n    },\n    setConfigError(error: unknown) {\n      self.configError = error\n    },\n    setSessionError(error: unknown) {\n      self.sessionError = error\n    },\n    setRuntimePlugins(plugins: PluginRecord[]) {\n      self.runtimePlugins = plugins\n    },\n    setSessionPlugins(plugins: PluginRecord[]) {\n      self.sessionPlugins = plugins\n    },\n    setConfigSnapshot(snap: unknown) {\n      self.configSnapshot = snap\n    },\n\n    setBlankSession(flag: boolean) {\n      self.blankSession = flag\n    },\n    setSessionTriaged(args?: {\n      snap: unknown\n      origin: string\n      reason: { url?: string }[]\n    }) {\n      self.sessionTriaged = args\n    },\n    setSessionSnapshotSuccess(snap: unknown) {\n      self.sessionSnapshot = snap\n    },\n  }))\n  .actions(self => ({\n    async fetchPlugins(config: { plugins: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(config.plugins, {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        })\n        pluginLoader.installGlobalReExports(window)\n        const runtimePlugins = await pluginLoader.load(window.location.href)\n        self.setRuntimePlugins([...runtimePlugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n    async fetchSessionPlugins(snap: { sessionPlugins?: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(snap.sessionPlugins || [], {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        })\n        pluginLoader.installGlobalReExports(window)\n        const plugins = await pluginLoader.load(window.location.href)\n        self.setSessionPlugins([...plugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    // passed\n    async setSessionSnapshot(\n      snap: { sessionPlugins?: PluginDefinition[]; id: string },\n      userAcceptedConfirmation?: boolean,\n    ) {\n      try {\n        const { sessionPlugins = [] } = snap\n        const sessionPluginsAllowed = await checkPlugins(sessionPlugins)\n        if (sessionPluginsAllowed || userAcceptedConfirmation) {\n          await this.fetchSessionPlugins(snap)\n          self.setSessionSnapshotSuccess(snap)\n        } else {\n          self.setSessionTriaged({\n            snap,\n            origin: 'session',\n            reason: sessionPlugins,\n          })\n        }\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    async fetchConfig() {\n      const { configPath = 'config.json' } = self\n      const text = await openLocation({\n        uri: configPath,\n        locationType: 'UriLocation',\n      }).readFile('utf8')\n      const config = JSON.parse(text)\n      const configUri = new URL(configPath, window.location.href)\n      addRelativeUris(config, configUri)\n\n      // cross origin config check\n      if (configUri.hostname !== window.location.hostname) {\n        const configPlugins = config.plugins || []\n        const configPluginsAllowed = await checkPlugins(configPlugins)\n        if (!configPluginsAllowed) {\n          return self.setSessionTriaged({\n            snap: config,\n            origin: 'config',\n            reason: configPlugins,\n          })\n        }\n      }\n      await this.fetchPlugins(config)\n      self.setConfigSnapshot(config)\n    },\n\n    async fetchSessionStorageSession() {\n      const sessionStr = sessionStorage.getItem('current')\n      const query = (self.sessionQuery as string).replace('local-', '')\n\n      // check if\n      if (sessionStr) {\n        const sessionSnap = JSON.parse(sessionStr).session || {}\n        if (query === sessionSnap.id) {\n          return this.setSessionSnapshot(sessionSnap)\n        }\n      }\n\n      if (self.bc1) {\n        self.bc1.postMessage(query)\n        try {\n          const result = await new Promise<Record<string, unknown>>(\n            (resolve, reject) => {\n              if (self.bc2) {\n                self.bc2.onmessage = msg => {\n                  resolve(msg.data)\n                }\n              }\n              setTimeout(() => reject(), 1000)\n            },\n          )\n          return this.setSessionSnapshot({ ...result, id: shortid() })\n        } catch (e) {\n          // the broadcast channels did not find the session in another tab\n          // clear session param, so just ignore\n        }\n      }\n      throw new Error('Local storage session not found')\n    },\n\n    async fetchSharedSession() {\n      const defaultURL = 'https://share.jbrowse.org/api/v1/'\n      const decryptedSession = await readSessionFromDynamo(\n        `${readConf(self.configSnapshot, 'shareURL', defaultURL)}load`,\n        self.sessionQuery || '',\n        self.password || '',\n      )\n\n      const session = JSON.parse(await fromUrlSafeB64(decryptedSession))\n      await this.setSessionSnapshot({ ...session, id: shortid() })\n    },\n\n    async decodeEncodedUrlSession() {\n      const session = JSON.parse(\n        // @ts-ignore\n        await fromUrlSafeB64(self.sessionQuery.replace('encoded-', '')),\n      )\n      await this.setSessionSnapshot({ ...session, id: shortid() })\n    },\n\n    decodeSessionSpec() {\n      if (!self.sessionQuery) {\n        return\n      }\n      self.sessionSpec = JSON.parse(self.sessionQuery.replace('spec-', ''))\n    },\n\n    decodeJb1StyleSession() {\n      const { loc, tracks, assembly, sessionTracksParsed: sessionTracks } = self\n      if (loc) {\n        self.sessionSpec = {\n          sessionTracks,\n          views: [\n            {\n              type: 'LinearGenomeView',\n              tracks: tracks?.split(','),\n              sessionTracks,\n              loc,\n              assembly,\n            },\n          ],\n        }\n      }\n    },\n\n    async decodeJsonUrlSession() {\n      // @ts-ignore\n      const session = JSON.parse(self.sessionQuery.replace('json-', ''))\n      await this.setSessionSnapshot({ ...session.session, id: shortid() })\n    },\n\n    async afterCreate() {\n      try {\n        // rename the current autosave from previously loaded jbrowse session\n        // into previousAutosave on load\n        const { configPath } = self\n        const lastAutosave = localStorage.getItem(`autosave-${configPath}`)\n        if (lastAutosave) {\n          localStorage.setItem(`previousAutosave-${configPath}`, lastAutosave)\n        }\n      } catch (e) {\n        console.error('failed to create previousAutosave', e)\n      }\n\n      try {\n        // fetch config\n        await this.fetchConfig()\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n        return\n      }\n\n      addDisposer(\n        self,\n        autorun(async () => {\n          try {\n            const {\n              isLocalSession,\n              isEncodedSession,\n              isSpecSession,\n              isSharedSession,\n              isJsonSession,\n              isJb1StyleSession,\n              sessionQuery,\n              configSnapshot,\n            } = self\n            if (!configSnapshot) {\n              return\n            }\n\n            if (self.bc1) {\n              self.bc1.onmessage = msg => {\n                const r =\n                  JSON.parse(sessionStorage.getItem('current') || '{}')\n                    .session || {}\n                if (r.id === msg.data && self.bc2) {\n                  self.bc2.postMessage(r)\n                }\n              }\n            }\n\n            if (isSharedSession) {\n              await this.fetchSharedSession()\n            } else if (isSpecSession) {\n              this.decodeSessionSpec()\n            } else if (isJb1StyleSession) {\n              this.decodeJb1StyleSession()\n            } else if (isEncodedSession) {\n              await this.decodeEncodedUrlSession()\n            } else if (isJsonSession) {\n              await this.decodeJsonUrlSession()\n            } else if (isLocalSession) {\n              await this.fetchSessionStorageSession()\n            } else if (sessionQuery) {\n              // if there was a sessionQuery and we don't recognize it\n              throw new Error('unrecognized session format')\n            } else {\n              // placeholder for session loaded, but none found\n              self.setBlankSession(true)\n            }\n          } catch (e) {\n            console.error(e)\n            self.setSessionError(e)\n          }\n        }),\n      )\n    },\n  }))\n\nexport type SessionLoaderModel = Instance<typeof SessionLoader>\n\nexport default SessionLoader\n\ninterface ViewSpec {\n  type: string\n  tracks?: string[]\n  assembly: string\n  loc: string\n}\n\n// use extension point named e.g. LaunchView-LinearGenomeView to initialize an\n// LGV session\nexport function loadSessionSpec(\n  {\n    views,\n    sessionTracks = [],\n  }: {\n    views: ViewSpec[]\n    sessionTracks: unknown[]\n  },\n  pluginManager: PluginManager,\n) {\n  return async () => {\n    const { rootModel } = pluginManager\n    if (!rootModel) {\n      throw new Error('rootModel not initialized')\n    }\n    try {\n      // @ts-ignore\n      rootModel.setSession({\n        name: `New session ${new Date().toLocaleString()}`,\n      })\n\n      // @ts-ignore\n      sessionTracks.forEach(track => rootModel.session.addTrackConf(track))\n\n      await Promise.all(\n        views.map(view =>\n          pluginManager.evaluateAsyncExtensionPoint('LaunchView-' + view.type, {\n            ...view,\n            session: rootModel.session,\n          }),\n        ),\n      )\n    } catch (e) {\n      console.error(e)\n      rootModel.session?.notify(`${e}`)\n    }\n  }\n}\n","import React, { lazy, useEffect, useState, Suspense } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { observer } from 'mobx-react'\nimport { inDevelopment } from '@jbrowse/core/util'\nimport { ErrorBoundary, FallbackProps } from 'react-error-boundary'\nimport {\n  StringParam,\n  QueryParamProvider,\n  useQueryParam,\n} from 'use-query-params'\nimport { WindowHistoryAdapter } from 'use-query-params/adapters/window'\nimport { LoadingEllipses, FatalErrorDialog } from '@jbrowse/core/ui'\nimport '@fontsource/roboto'\nimport 'requestidlecallback-polyfill'\nimport shortid from 'shortid'\nimport { doAnalytics } from '@jbrowse/core/util/analytics'\n\n// locals\nimport Loading from './Loading'\nimport corePlugins from './corePlugins'\nimport JBrowse from './JBrowse'\nimport JBrowseRootModelFactory from './rootModel'\nimport packageJSON from '../package.json'\nimport factoryReset from './factoryReset'\nimport SessionLoader, {\n  SessionLoaderModel,\n  loadSessionSpec,\n} from './SessionLoader'\n\n// lazy components\nconst SessionWarningDialog = lazy(() => import('./SessionWarningDialog'))\nconst ConfigWarningDialog = lazy(() => import('./ConfigWarningDialog'))\nconst ErrorMessage = lazy(() => import('@jbrowse/core/ui/ErrorMessage'))\nconst StartScreen = lazy(() => import('./StartScreen'))\n\nfunction NoConfigMessage() {\n  const links = [\n    ['test_data/volvox/config.json', 'Volvox sample data'],\n    ['test_data/config.json', 'Human basic'],\n    ['test_data/config_demo.json', 'Human sample data'],\n    ['test_data/tomato/config.json', 'Tomato SVs'],\n    ['test_data/breakpoint/config.json', 'Breakpoint'],\n    ['test_data/config_dotplot.json', 'Grape/Peach dotplot'],\n    ['test_data/config_synteny_grape_peach.json', 'Grape/Peach synteny'],\n    ['test_data/yeast_synteny/config.json', 'Yeast synteny'],\n    ['test_data/config_many_contigs.json', 'Many contigs'],\n    ['test_data/config_honeybee.json', 'Honeybee'],\n    ['test_data/config_wormbase.json', 'Wormbase'],\n    ['test_data/config_human_dotplot.json', 'Human dotplot'],\n    ['test_data/wgbs/config.json', 'WGBS methylation'],\n  ]\n  return (\n    <div>\n      <h4>\n        Configuration not found. You may have arrived here if you requested a\n        config that does not exist or you have not set up your JBrowse yet.\n      </h4>\n      {inDevelopment ? (\n        <>\n          <div>Sample JBrowse configs:</div>\n          <ul>\n            {links.map(([link, name]) => {\n              const { href, search } = window.location\n              const { config, ...rest } = Object.fromEntries(\n                new URLSearchParams(search),\n              )\n              const root = href.split('?')[0]\n              const params = new URLSearchParams(\n                Object.entries({\n                  ...rest,\n                  config: link,\n                }),\n              )\n              return (\n                <li key={name}>\n                  <a href={`${root}?${params}`}>{name}</a>\n                </li>\n              )\n            })}\n          </ul>\n        </>\n      ) : (\n        <>\n          <div>Sample JBrowse config:</div>\n          <ul>\n            <li>\n              <a href=\"?config=test_data/volvox/config.json\">\n                Volvox sample data\n              </a>\n            </li>\n          </ul>\n        </>\n      )}\n    </div>\n  )\n}\n\nexport function Loader({\n  initialTimestamp = Date.now(),\n}: {\n  initialTimestamp?: number\n}) {\n  // return value if defined, else convert null to undefined for use with\n  // types.maybe\n  const load = (param: string | null | undefined) =>\n    param === null ? undefined : param\n\n  const Str = StringParam\n\n  const [config] = useQueryParam('config', Str)\n  const [session] = useQueryParam('session', Str)\n  const [adminKey] = useQueryParam('adminKey', Str)\n  const [password, setPassword] = useQueryParam('password', Str)\n  const [loc, setLoc] = useQueryParam('loc', Str)\n  const [sessionTracks, setSessionTracks] = useQueryParam('sessionTracks', Str)\n  const [assembly, setAssembly] = useQueryParam('assembly', Str)\n  const [tracks, setTracks] = useQueryParam('tracks', Str)\n\n  const loader = SessionLoader.create({\n    configPath: load(config),\n    sessionQuery: load(session),\n    password: load(password),\n    adminKey: load(adminKey),\n    loc: load(loc),\n    assembly: load(assembly),\n    tracks: load(tracks),\n    sessionTracks: load(sessionTracks),\n  })\n\n  useEffect(() => {\n    setLoc(undefined)\n    setTracks(undefined)\n    setAssembly(undefined)\n    setPassword(undefined)\n    setSessionTracks(undefined)\n  }, [setAssembly, setLoc, setTracks, setPassword, setSessionTracks])\n\n  return (\n    <Renderer\n      loader={loader}\n      initialTimestamp={initialTimestamp}\n      initialSessionQuery={session}\n    />\n  )\n}\n\nconst SessionTriaged = ({\n  loader,\n  handleClose,\n}: {\n  loader: SessionLoaderModel\n  handleClose: Function\n}) => {\n  return (\n    <Suspense fallback={<div />}>\n      <SessionWarningDialog\n        onConfirm={async () => {\n          const session = JSON.parse(JSON.stringify(loader.sessionTriaged.snap))\n\n          // second param true says we passed user confirmation\n          await loader.setSessionSnapshot({ ...session, id: shortid() }, true)\n          handleClose()\n        }}\n        onCancel={() => {\n          loader.setBlankSession(true)\n          handleClose()\n        }}\n        reason={loader.sessionTriaged.reason}\n      />\n    </Suspense>\n  )\n}\n\nconst StartScreenErrorMessage = ({ error }: { error: unknown }) => {\n  return (\n    <>\n      <NoConfigMessage />\n      {`${error}`.match(/HTTP 404 fetching config.json/) ? (\n        <div\n          style={{\n            margin: 8,\n            padding: 8,\n            border: '1px solid black',\n            background: '#9f9',\n          }}\n        >\n          No config.json found. If you want to learn how to complete your setup,\n          visit our{' '}\n          <a href=\"https://jbrowse.org/jb2/docs/quickstart_web/\">\n            quick start guide\n          </a>\n          .\n        </div>\n      ) : (\n        <Suspense fallback={<LoadingEllipses />}>\n          <ErrorMessage error={error} />\n        </Suspense>\n      )}\n    </>\n  )\n}\n\nfunction ConfigTriaged({\n  loader,\n  handleClose,\n}: {\n  loader: SessionLoaderModel\n  handleClose: Function\n}) {\n  return (\n    <Suspense fallback={<div />}>\n      <ConfigWarningDialog\n        onConfirm={async () => {\n          const session = JSON.parse(JSON.stringify(loader.sessionTriaged.snap))\n          await loader.fetchPlugins(session)\n          loader.setConfigSnapshot({ ...session, id: shortid() })\n          handleClose()\n        }}\n        onCancel={() => {\n          factoryReset()\n          handleClose()\n        }}\n        reason={loader.sessionTriaged.reason}\n      />\n    </Suspense>\n  )\n}\n\nconst Renderer = observer(\n  ({\n    loader,\n    initialTimestamp,\n    initialSessionQuery,\n  }: {\n    loader: SessionLoaderModel\n    initialTimestamp: number\n    initialSessionQuery?: string | null\n  }) => {\n    const { sessionError, configError, ready, shareWarningOpen } = loader\n    const [pm, setPluginManager] = useState<PluginManager>()\n    const [error, setError] = useState<unknown>()\n\n    // only create the pluginManager/rootModel \"on mount\"\n    useEffect(() => {\n      try {\n        const {\n          runtimePlugins,\n          sessionPlugins,\n          adminKey,\n          configSnapshot,\n          sessionSnapshot,\n          configPath,\n          sessionSpec,\n        } = loader\n\n        if (ready) {\n          // it is ready when a session has loaded and when there is no config\n          // error Assuming that the query changes self.sessionError or\n          // self.sessionSnapshot or self.blankSession\n          const pluginManager = new PluginManager([\n            ...corePlugins.map(P => ({\n              plugin: new P(),\n              metadata: { isCore: true },\n            })),\n            ...runtimePlugins.map(({ plugin: P, definition }) => ({\n              plugin: new P(),\n              definition,\n              metadata: { url: definition.url },\n            })),\n            ...sessionPlugins.map(({ plugin: P, definition }) => ({\n              plugin: new P(),\n              definition,\n              metadata: { url: definition.url },\n            })),\n          ])\n          pluginManager.createPluggableElements()\n          const RootModel = JBrowseRootModelFactory(pluginManager, !!adminKey)\n\n          if (configSnapshot) {\n            const rootModel = RootModel.create(\n              {\n                jbrowse: configSnapshot,\n                version: packageJSON.version,\n                configPath,\n              },\n              { pluginManager },\n            )\n\n            if (!configSnapshot?.configuration?.rpc?.defaultDriver) {\n              const { rpc } = rootModel.jbrowse.configuration\n              rpc.defaultDriver.set('WebWorkerRpcDriver')\n            }\n\n            let afterInitializedCb = () => {}\n\n            // in order: saves the previous autosave for recovery, tries to\n            // load the local session if session in query, or loads the default\n            // session\n            try {\n              if (sessionError) {\n                rootModel.setDefaultSession()\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                rootModel.session!.notify(\n                  `Error loading session: ${sessionError}. If you\n                received this URL from another user, request that they send you\n                a session generated with the \"Share\" button instead of copying\n                and pasting their URL`,\n                )\n              } else if (sessionSnapshot && !shareWarningOpen) {\n                rootModel.setSession(sessionSnapshot)\n              } else if (sessionSpec) {\n                afterInitializedCb = loadSessionSpec(sessionSpec, pluginManager)\n              } else if (rootModel.jbrowse.defaultSession?.views?.length) {\n                rootModel.setDefaultSession()\n              }\n            } catch (e) {\n              rootModel.setDefaultSession()\n              const str = `${e}`\n              const errorMessage = str\n                .replace('[mobx-state-tree] ', '')\n                .replace(/\\(.+/, '')\n              rootModel.session?.notify(\n                `Session could not be loaded. ${\n                  errorMessage.length > 1000\n                    ? `${errorMessage.slice(0, 1000)}...see more in console`\n                    : errorMessage\n                }`,\n              )\n              console.error(e)\n            }\n\n            // send analytics\n            doAnalytics(rootModel, initialTimestamp, initialSessionQuery)\n\n            pluginManager.setRootModel(rootModel)\n            pluginManager.configure()\n            setPluginManager(pluginManager)\n            afterInitializedCb()\n          }\n        }\n      } catch (e) {\n        setError(e)\n        console.error(e)\n      }\n    }, [\n      loader,\n      shareWarningOpen,\n      ready,\n      sessionError,\n      initialTimestamp,\n      initialSessionQuery,\n    ])\n\n    const err = configError || error\n\n    if (err) {\n      return <StartScreenErrorMessage error={err} />\n    }\n\n    if (loader.sessionTriaged) {\n      return loader.sessionTriaged.origin === 'session' ? (\n        <SessionTriaged\n          loader={loader}\n          handleClose={() => loader.setSessionTriaged(undefined)}\n        />\n      ) : (\n        <ConfigTriaged\n          loader={loader}\n          handleClose={() => loader.setSessionTriaged(undefined)}\n        />\n      )\n    }\n    if (pm) {\n      return !pm.rootModel?.session ? (\n        <Suspense fallback={<LoadingEllipses />}>\n          <StartScreen rootModel={pm.rootModel} onFactoryReset={factoryReset} />\n        </Suspense>\n      ) : (\n        <JBrowse pluginManager={pm} />\n      )\n    }\n    return <Loading />\n  },\n)\n\nconst PlatformSpecificFatalErrorDialog = (props: FallbackProps) => {\n  return (\n    <FatalErrorDialog\n      resetButtonText=\"Reset Session\"\n      onFactoryReset={factoryReset}\n      {...props}\n    />\n  )\n}\nconst LoaderWrapper = ({ initialTimestamp }: { initialTimestamp: number }) => {\n  return (\n    // @ts-ignore\n    <ErrorBoundary FallbackComponent={PlatformSpecificFatalErrorDialog}>\n      <QueryParamProvider adapter={WindowHistoryAdapter}>\n        <Loader initialTimestamp={initialTimestamp} />\n      </QueryParamProvider>\n    </ErrorBoundary>\n  )\n}\n\nexport default LoaderWrapper\n"],"names":["abortSignalCounter","abortSignalIds","WeakMap","serializeAbortSignal","signal","callfunc","abortSignalId","get","set","addEventListener","signalId","undefined","isRemoteAbortSignal","thing","surrogateAbortControllers","Map","deserializeAbortSignal","surrogateAbortController","AbortController","useStyles","makeStyles","importFormEntry","minWidth","AssemblySelector","observer","session","onChange","selected","InputProps","extra","classes","assemblyNames","assemblyManager","config","URLSearchParams","window","location","search","jest","useLocalStorage","host","pathname","join","useState","lastSelected","setLastSelected","selection","includes","useEffect","error","length","select","label","variant","helperText","value","inputProps","event","target","disabled","className","map","name","assembly","displayName","getConf","CascadingContext","React","parentPopupState","rootPopupState","CascadingMenuItem","onClick","props","useContext","Error","handleClick","useCallback","close","CascadingSubmenu","title","inset","popupId","popupState","usePopupState","bindHover","bindFocus","primary","CascadingSubmenuHover","anchorOrigin","vertical","horizontal","transformOrigin","onMenuItemClick","menuItems","context","useMemo","Provider","bindMenu","CascadingMenu","EndDecoration","item","type","checked","CascadingMenuList","hasIcon","some","menuItem","icon","idx","subMenu","component","callback","Boolean","secondary","subLabel","style","flexGrow","theme","input","inputBase","typography","top","left","position","whiteSpace","visibility","inputRoot","padding","spacing","inputFocused","borderStyle","borderWidth","EditableTypography","ref","setValue","other","editedValue","setEditedValue","sizerNode","setSizerNode","inputNode","setInputNode","blur","setBlur","useTheme","width","clientWidth","val","node","inputRef","root","focused","onKeyDown","key","onBlur","snapshotError","str","findStr","indexOf","trim","slice","match","match2","margin","overflow","maxHeight","background","border","JSON","stringify","parse","onClose","open","onFactoryReset","handleDialogClose","action","id","color","ToggleButtonWithTooltip","children","Tooltip","ToggleButton","shorten","len","substring","description","rootModel","setLocation","fileOrUrl","isUriLocation","internetAccountId","toggleButtonValue","setToggleButtonValue","accts","isAppRootModel","internetAccounts","shownAccts","setShownAccts","hiddenAccts","setHiddenAccts","anchorEl","setAnchorEl","selectedAcct","find","ia","setLocationWithAccount","locationInput","UrlChooser","selectorLabel","LocalFileChooser","SelectorComponent","Box","display","InputLabel","shrink","flexDirection","ToggleButtonGroup","exclusive","_event","newState","toggleContents","ArrowDropDown","Menu","acct","MenuItem","prev","FormHelperText","paper","overflowY","overflowX","minHeight","maxWidth","outline","menuItemEndDecoration","height","MenuItemEndDecoration","MenuPage","subMenuAnchorEl","setSubMenuAnchorEl","openSubMenuIdx","setOpenSubMenuIdx","isSubMenuOpen","setIsSubMenuOpen","selectedMenuItemIdx","setSelectedMenuItemIdx","setPosition","paperRef","useRef","timer","shouldSubMenuBeOpen","setTimeout","clearTimeout","rect","getBoundingClientRect","menuItemStyle","ListContents","autoFocusItem","dense","sort","a","b","priority","endDecoration","Icon","onMouseMove","e","currentTarget","document","activeElement","focus","currentIdx","findLastIndex","findPreviousValidIdx","findIndex","findNextValidIdx","in","elevation","transitionDuration","BackdropProps","invisible","horizontalHandle","cursor","verticalHandle","flexbox_verticalHandle","alignSelf","flexbox_horizontalHandle","onDrag","flexbox","originalClassName","mouseDragging","setMouseDragging","prevPos","cx","mouseMove","preventDefault","pos","clientX","clientY","distance","current","mouseUp","removeEventListener","onMouseDown","role","refTheme","createTheme","jbrowseDefaultPalette","main","tertiary","palette","augmentColor","quaternary","stopCodon","startCodon","bases","A","green","C","blue","G","amber","T","red","createJBrowseDefaultProps","components","MuiButton","defaultProps","size","MuiAccordion","disableGutters","TransitionProps","timeout","MuiFilledInput","MuiFormControl","MuiFormHelperText","MuiIconButton","MuiInputBase","MuiAutocomplete","MuiInputLabel","MuiToolbar","MuiListItem","MuiOutlinedInput","MuiFab","MuiTable","MuiMenuList","MuiMenuItem","MuiTextField","createJBrowseDefaultOverrides","generatedPalette","deepmerge","styleOverrides","colorSecondary","textSecondary","backgroundColor","MuiLink","MuiAccordionSummary","content","contrastText","createJBrowseBaseTheme","fontSize","createJBrowseTheme","getColors","midnight","forrest","grape","mandarin","gray","Logomark","viewBox","LogoFull","Text","colors","fill","d","transform","fontFamily","fabLeft","zIndex","bottom","fabRight","right","menuBarAndComponents","gridColumn","gridTemplateRows","menuBar","gridRow","appBar","grow","light","borderColor","selectPaper","Logo","configuration","logoPath","readConfObject","uri","src","alt","AppToolbar","HeaderButtons","savedSessionNames","menus","Toolbar","menu","DropDownMenu","menuTitle","arrow","newName","notify","renameCurrentSession","ViewLauncher","viewTypes","getEnv","pluginManager","getElementTypeRecord","all","Paper","Typography","FormControl","Select","Button","addView","ViewPanel","view","viewType","getViewType","ReactComponent","ViewContainer","removeView","onMinimize","setMinimized","minimized","ErrorBoundary","FallbackComponent","ErrorMessage","Suspense","fallback","LoadingEllipses","model","getTrackType","grid","visibleWidget","drawerWidth","activeWidgets","views","drawerPosition","drawerVisible","gridTemplateColumns","filter","f","DrawerWidget","DialogComponent","DialogProps","AppBar","Fab","showWidgetDrawer","Launch","Snackbar","closeButton","grey","handleClose","Dialog","DialogTitle","IconButton","Close","Divider","DialogContent","DialogActions","clearView","autoFocus","PrerenderedCanvas","highResolutionScaling","imageData","blockKey","showSoftClip","done","setDone","featureCanvas","canvas","getContext","drawImageOntoCanvasContext","blockKeyStr","testId","hoverLabel","pointerEvents","offsetX","offsetY","feature","shown","setShown","handle","text","added","full","RegExp","tag","SanitizedHTML","html","test","escapeHTML","dompurify","tagName","setAttribute","dangerouslySetInnerHTML","__html","QuickLRU","options","maxSize","TypeError","maxAge","Number","POSITIVE_INFINITY","onEviction","cache","oldCache","_size","this","expiry","Date","now","delete","_deleteIfExpired","_getOrDeleteIfExpired","_getItemValue","_emitEvictions","_set","has","_moveToRecent","_peek","deleted","clear","newSize","items","_entriesAscending","removeCount","i","oldCacheSize","keys","Math","min","entriesAscending","callbackFunction","thisArgument","call","Symbol","iterator","toStringTag","AbortError","code","checkAbortSignal","AbortSignal","aborted","makeAbortError","ms","Promise","resolve","abortBreakPoint","DOMException","observeAbortSignal","fromEvent","Observable","isAbortException","exception","message","createCanvas","createImageBitmap","ImageBitmapType","serializedCommands","CanvasSequence","execute","drawImage","weHave","OffscreenCanvas","isNode","self","ImageBitmap","nodeCreateCanvas","dataUri","toDataURL","img","nodeImage","reject","onload","onerror","ctx","toJSON","containsNoTransferables","String","renderToAbstractCanvas","opts","cb","exportSVG","scaling","rasterizeLayers","fakeCtx","result","canvasRecordedData","scale","ceil","blobToDataURL","convertToBlob","xlinkHref","reactElement","isViewContainer","isStateTreeNode","isSessionModel","isSessionModelWithConfigEditing","isSessionWithAddTracks","disableAddTracks","isSessionModelWithWidgets","isSessionModelWithConnections","isSessionWithSessionPlugins","isSelectionContainer","isViewModel","isTrackModel","trackId","isDisplayModel","displayId","isTrackViewModel","isRootModelWithInternetAccounts","isAbstractMenuManager","AuthNeededError","url","Object","setPrototypeOf","prototype","RetryError","isAuthNeededException","isRetryException","when","getter","timeoutId","finished","whenPromise","mobxWhen","finishTimeout","cancel","then","catch","err","whenPresent","PhasedScheduler","phaseCallbacks","phaseOrder","phase","push","forEach","phaseName","TypeRecord","typeName","baseClass","registeredTypes","t","values","PluginManager","initialPlugins","plugins","jexl","createJexlInstance","pluginMetadata","runtimePluginDefinitions","elementCreationSchedule","rendererTypes","RendererType","adapterTypes","AdapterType","textSearchAdapterTypes","TextSearchAdapterType","trackTypes","TrackType","displayTypes","DisplayType","connectionTypes","ConnectionType","ViewType","widgetTypes","WidgetType","rpcMethods","RpcMethodType","addTrackWidgets","AddTrackWorkflowType","internetAccountTypes","InternetAccountType","configured","extensionPoints","jbrequireCache","lib","ReExports","load","jbrequire","pack","default","addPlugin","plugin","CorePlugin","metadata","isCore","configurationSchemas","configurationSchema","definition","install","p","getPlugin","run","configure","groupName","creationCallback","typeRecord","add","newElement","evaluateExtensionPoint","getElementTypesInGroup","fieldName","types","pluggableTypes","isType","isModelType","console","warn","typeGroup","isBareConfigurationSchemaType","ConfigurationSchema","methodName","addElementType","track","trackType","addDisplayType","newView","extendedName","extensionPointName","callbacks","extendee","accumulator","initialTimeStamp","sessionQuery","multiAssemblyTracks","jbrowse","tracks","savedSessionCount","localStorage","ver","version","assemblies","stats","sessionTracks","split","screen","innerHeight","innerWidth","electron","isElectron","loadTime","jb2","qs","fetch","initialTimestamp","pluginNames","analyticsScript","gaData","index","metric1","round","analyticsScriptNode","createElement","innerHTML","getElementsByTagName","appendChild","doAnalytics","initialSessionQuery","writeAWSAnalytics","writeGAAnalytics","SetDefaultSession","lazy","AssemblyManager","exports","addConnectionType","configSchema","ucscConfigSchema","stateModel","ucscModelFactory","addWidgetType","heading","HierarchicalTrackSelectorConfigSchema","HierarchicalTrackSelectorStateModelFactory","AddTrackConfigSchema","AddTrackStateModelFactory","AddConnectionConfigSchema","AddConnectionStateModel","PluginStoreConfigSchema","PluginStoreStateModelFactory","_pluginManager","Plugin","SVG","LinearGenomeView","Alignments","Authentication","Bed","CircularView","Config","DataManagement","DotplotView","GtfPlugin","Gff3","LegacyJBrowse","LinearComparativeView","Lollipop","Arc","Menus","RDF","Sequence","TrackHubRegistry","Variants","Wiggle","GCContent","SpreadsheetViewPlugin","SvInspectorPlugin","BreakpointSplitView","HicPlugin","TrixPlugin","GridBookmarkPlugin","ComparativeAdapters","b64PadSuffix","b64","num","repeat","fromUrlSafeB64","originalB64","replace","toByteArray","inflate","bytes","inflated","TextDecoder","decode","toUrlSafeB64","TextEncoder","encode","deflate","fromByteArray","deflated","encoded","filterSessionInPlace","isArrayType","array","childType","getChildType","isReferenceType","isValidReference","splice","el","isMapType","child","properties","getPropertyMembers","entries","pname","ptype","generateUID","btoa","Array","from","crypto","getRandomValues","Uint8Array","fromCharCode","encrypt","password","AES","toString","decrypt","Utf8","getErrorMsg","shareSessionToDynamo","referer","sess","encryptedSession","data","FormData","append","method","mode","body","response","ok","json","readSessionFromDynamo","baseUrl","sessionQueryParam","sessionId","shareDiv","textAlign","paddingLeft","shareButton","alpha","hoverOpacity","loadingMessage","SHARE_URL_LOCALSTORAGE_KEY","SettingsDialog","currentSetting","setting","setSetting","infoDialogOpen","setInfoDialogOpen","setItem","DialogContentText","HelpOutline","RadioGroup","FormControlLabel","control","Radio","InfoDialog","ShareDialog","shortUrl","setShortUrl","longUrl","setLongUrl","loading","setLoading","setError","settingsDialogOpen","setSettingsDialogOpen","shareURL","getItem","snap","getSnapshot","cancelled","locationUrl","URL","href","params","longParams","Settings","TextField","readOnly","copy","startIcon","setOpen","Share","isAssemblyEditing","isDefaultSessionEditing","setDefaultSessionEditing","setAssemblyEditing","JBrowse","useQueryParam","StringParam","adminKey","adminServer","configPath","setSessionId","currentSessionId","JBrowseRootModel","JBrowseSession","onSnapshot","snapshot","headers","status","ThemeProvider","CssBaseline","App","refNameRegex","refNameColors","loadRefNameMap","adapterConfig","regions","refNameAliases","rpcManager","refNames","refNameMap","fromEntries","checkRefName","getCanonicalRefName","reversed","canonicalName","forwardMap","reverseMap","refName","assemblyFactory","assemblyConfigType","pm","adapterLoads","AbortablePromiseCache","args","statusCallback","adapterConf","volatile","loaded","loadingP","volatileRegions","lowerCaseRefNameAliases","cytobands","initialized","aliases","hasName","allAliases","allRefNames","lowerCaseRefNames","allRefNamesWithLowerCase","Set","getParent","region","getRefNameColor","r","isValidRefName","actions","setLoaded","adapterRegionsWithAssembly","setRegions","setRefNameAliases","setCytobands","lcAliases","setLoadingP","loadPre","conf","refNameAliasesAdapterConf","adapter","cytobandAdapterConf","sequenceAdapterConf","sequence","assemblyName","getAssemblyRegions","getRefNameAliases","ret","getCytobands","toLowerCase","getAdapterMapEntry","rest","adapterId","jsonStableStringify","getAdapterId","getRefNameMapForAdapter","getReverseRefNameMapForAdapter","getAdapterType","getAdapterClass","CLASS","getData","getRegions","asmName","asm","assemblyNamesList","assemblyList","sessionAssemblies","temporaryAssemblies","waitForAssembly","afterAttach","addDisposer","reaction","assemblyConfigs","removeAssembly","assemblyConfig","addAssembly","fireImmediately","remove","replaceAssembly","cast","defaultValue","pluggableConfigSchemaType","preProcessSnapshot","explicitIdentifier","workerCount","explicitlyTyped","baseConfiguration","BaseRpcDriverConfigSchema","defaultDriver","drivers","MainThreadRpcDriverConfigSchema","WebWorkerRpcDriverConfigSchema","MainThreadRpcDriver","WebWorkerRpcDriver","addDriverConfig","configName","configSnapshot","isClonable","watchWorker","worker","pingTime","rpcDriverClassName","_resolve","delay","LazyWorker","driver","workerP","makeWorker","maxPingTime","destroy","BaseRpcDriver","lastWorkerAssignment","workerAssignments","workerPool","workerCheckFrequency","isArray","filterArgs","remoteAbort","bind","isAlive","File","k","v","functionName","getWorker","hardwareConcurrency","mainThread","canDetect","navigator","detectHardwareConcurrency","clamp","max","res","createWorkerPool","workers","getWorkerPool","workerNumber","workerAssignment","rpcMethod","getRpcMethodType","serializeArguments","serializedArgs","filteredAndSerializedArgs","callP","finally","killedP","killedCheckInterval","setInterval","clearInterval","resultP","race","deserializeReturn","WebWorkerHandle","terminate","funcName","channel","shortid","listener","on","off","Rpc","workerBootConfiguration","makeWorkerInstance","instance","userAgent","log","postMessage","deserializeError","DummyHandle","_functionName","_filteredArgs","RpcManager","mainConfiguration","backendConfigurations","driverObjects","backendName","newDriver","backendConfiguration","windowHref","_sessionId","rpcDriverName","getDriver","getDriverForCall","driverForCall","rpcConfigSchema","TextSearchManager","adapterCache","searchScope","relevantAdapters","AdapterClass","getTextSearchAdapterType","aggregateTextSearchAdapters","getAdaptersWithAssembly","getTrackAdaptersWithAssembly","confs","c","textSearching","textSearchAdapter","rankFn","adapters","loadTextSearchAdapters","searchIndex","results","sortResults","flat","getLabel","localeCompare","r1","r2","getScore","TimeTraveller","undoIdx","targetPath","history","notTrackingUndo","canUndo","canRedo","targetStore","snapshotDisposer","skipNextUndoState","stopTrackingUndo","resumeTrackingUndo","addUndoState","todos","shift","beforeDestroy","initialize","resolvePath","func","debounce","undo","applySnapshot","redo","Worker","removeAttr","obj","attr","prop","JBrowseWeb","Session","assemblyConfigSchemasType","JBrowseModel","rpc","featureDetails","sequenceTypes","formatDetails","contextVariable","subfeatures","depth","formatAbout","hideUris","disableAnalytics","locationType","pluginConfigurationSchemas","connections","defaultSession","afterCreate","seen","addAssemblyConf","assemblyConf","removeAssemblyConf","toRemove","addTrackConf","trackConf","addDisplayConf","displayConf","addConnectionConf","connectionConf","deleteConnectionConf","conn","deleteTrackConf","setDefaultSessionConf","sessionConf","newDefault","toJS","pluginDefinition","getRoot","setPluginsUpdated","removePlugin","umdUrl","cjsUrl","esmUrl","addInternetAccountConf","deleteInternetAccountConf","postProcessor","clone","addSnackbarToModel","tree","extend","snackbarMessages","level","pushSnackbarMessage","removeSnackbarMessage","popSnackbarMessage","pop","element","makeExtension","observable","resolveIdentifier","AboutDialog","sessionModelFactory","minDrawerWidth","sessionModel","pluggableMstType","widgets","connectionInstances","sessionConnections","sessionPlugins","task","queueOfDialogs","firstInQueue","sessionAssemblyNames","textSearchManager","adminMode","savedSessions","previousAutosaveId","renderProps","getReferring","object","refs","walk","getType","members","getMembers","moveViewUp","moveViewDown","setDrawerPosition","arg","queueDialog","setName","addTemporaryAssembly","addSessionPlugin","removeTemporaryAssembly","removeSessionPlugin","makeConnection","initialSnapshot","connectionType","getConnectionType","connectionData","removeReferring","referring","dereferenceTypeCount","dereferenced","getContainingView","hideTrack","err1","hideWidget","prepareToBreakConnection","callbacksToDereferenceTrack","connection","breakConnection","deleteConnection","deletedConn","connectionId","updateDrawerWidth","newDrawerWidth","resizeDrawer","oldDrawerWidth","initialState","typeDefinition","getElementType","widget","addLinearGenomeViewOfAssembly","addViewOfAssembly","s","displayRegionsFromAssemblyName","addViewFromAnotherView","otherView","state","displayedRegions","addWidget","showWidget","hasWidget","minimizeWidgetDrawer","hideAllWidgets","setSelection","clearSelection","clearConnections","addSavedSession","sessionSnapshot","removeSavedSession","sessionName","duplicateCurrentSession","activateSession","setDefaultSession","saveSessionToLocalStorage","loadAutosaveSession","setSession","editConfiguration","isConfigurationModel","editableConfigSession","editor","editTrackConfiguration","getTrackActionMenuItems","canEdit","isRefSeq","InfoIcon","SettingsIcon","DeleteIcon","displays","category","CopyIcon","extendedSessionModel","preProcessor","RootModel","assemblyConfigSchema","assemblyConfigSchemaFactory","assemblyManagerFactory","jbrowseWebFactory","pluginsUpdated","savedSessionsVolatile","localStorageId","autosaveId","cm","ctrlKey","metaKey","shiftKey","startsWith","autorun","alert","sessionStorage","reload","account","initializeInternetAccount","oldSession","internetAccountConfig","internetAccountType","getInternetAccountType","createEphemeralInternetAccount","hostUri","origin","internetAccountSplit","domains","internetAccount","create","flag","newSession","toLocaleString","removeItem","newSnapshotName","newSnapshotCopyNumber","localId","newSessionSnapshot","previousAutosave","autosavedSession","findAppropriateInternetAccount","selectedId","selectedAccount","handlesLocation","AddIcon","lastAutosave","PublishIcon","GetAppIcon","sessionBlob","Blob","saveAs","FolderOpenIcon","SaveIcon","FileCopyIcon","StorageIcon","Cable","AppsIcon","UndoIcon","RedoIcon","ExtensionIcon","setMenus","newMenus","appendMenu","menuName","insertMenu","appendToMenu","m","insertInMenu","insertPosition","appendToSubMenu","menuPath","topMenu","pathSoFar","sm","mi","insertInSubMenu","factoryReset","isUMDPluginDefinition","def","umdLoc","isESMPluginDefinition","esmLoc","isCJSPluginDefinition","getGlobalObject","global","isInWebWorker","globalObject","PluginLoader","defs","definitions","fetchESM","fetchCJS","scriptUrl","domLoadScript","importScripts","parsedUrl","protocol","baseUri","loadScript","moduleName","umdName","constructor","loadCJSPlugin","loadESMPlugin","loadUMDPlugin","JBrowseExports","loadPlugin","addRelativeUris","base","readConf","fetchPlugins","statusText","checkPlugins","pluginsToCheck","storePlugins","every","pp","loc","blankSession","sessionTriaged","shareWarningOpen","sessionSpec","runtimePlugins","sessionError","configError","bc1","BroadcastChannel","bc2","isSharedSession","isSpecSession","isJb1StyleSession","isEncodedSession","isJsonSession","isLocalSession","ready","isSessionLoaded","isConfigLoaded","sessionTracksParsed","setSessionQuery","setConfigError","setSessionError","setRuntimePlugins","setSessionPlugins","setConfigSnapshot","setBlankSession","setSessionTriaged","setSessionSnapshotSuccess","pluginLoader","import","installGlobalReExports","fetchSessionPlugins","setSessionSnapshot","userAcceptedConfirmation","reason","fetchConfig","openLocation","readFile","configUri","hostname","configPlugins","fetchSessionStorageSession","sessionStr","query","sessionSnap","onmessage","msg","fetchSharedSession","decryptedSession","decodeEncodedUrlSession","decodeSessionSpec","decodeJb1StyleSession","decodeJsonUrlSession","SessionWarningDialog","ConfigWarningDialog","StartScreen","NoConfigMessage","inDevelopment","link","Loader","param","Str","setPassword","setLoc","setSessionTracks","setAssembly","setTracks","loader","SessionLoader","Renderer","SessionTriaged","onConfirm","onCancel","StartScreenErrorMessage","ConfigTriaged","setPluginManager","corePlugins","P","createPluggableElements","JBrowseRootModelFactory","packageJSON","afterInitializedCb","evaluateAsyncExtensionPoint","loadSessionSpec","errorMessage","setRootModel","Loading","PlatformSpecificFatalErrorDialog","FatalErrorDialog","resetButtonText","QueryParamProvider","WindowHistoryAdapter"],"sourceRoot":""}