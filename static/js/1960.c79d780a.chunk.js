"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[1960],{35352:function(e,n,t){t.d(n,{Z:function(){return f},x:function(){return s}});var r=t(68079),i=t(96234),o=t(96902),c=t(91188),a=t(54896),u=t(29938),l=(0,c.ZL)()((function(e){return{resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.divider,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}}}));function s(){var e=(0,o.useRef)(null),n=(0,o.useState)(0),t=(0,i.Z)(n,2),r=t[0],c=t[1];return(0,o.useEffect)((function(){var n=setInterval((function(){var n,t=null===(n=e.current)||void 0===n?void 0:n.querySelector(".MuiDataGrid-virtualScroller");t&&c(t.scrollLeft)}),100);return function(){clearInterval(n)}}),[]),{ref:e,scrollLeft:r}}function d(e){var n=e.left,t=e.scrollLeft,r=e.idx,i=e.onDrag,c=l().classes,s=(0,o.useCallback)((function(e){i(e,r)}),[r,i]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.Z,{onDrag:s,vertical:!0,className:c.hiddenTick,style:{left:n-t-2.5}}),(0,u.jsx)("div",{style:{left:n-t},className:c.tick})]})}function f(e){var n=e.widths,t=e.setWidths,i=e.checkbox,c=e.scrollLeft,a=void 0===c?0:c,s=l().classes,f=[];n.reduce((function(e,n,t){return f[t]=e+n}),i?52:0);var h=(0,o.useCallback)((function(e,i){var o=(0,r.Z)(n);o[i]=Math.max(o[i]+e,50),t(o)}),[n,t]);return(0,u.jsx)("div",{className:s.resizeBar,children:f.map((function(e,n){return(0,u.jsx)(d,{left:n===f.length-1?e-3:e,onDrag:h,idx:n,scrollLeft:a},n)}))})}},71960:function(e,n,t){t.r(n),t.d(n,{default:function(){return _}});var r=t(33028),i=t(96902),o=t(52809),c=t(46186),a=t(4782),u=t(68079),l=t(56666),s=t(96234),d=t(25322),f=t(75717),h=t(63680),m=t(4514),p=t(16151),v=t(41590),x=t(35352),j=t(97531),g=t(99836),Z=t(90386),b=t(71186),k=t(54417),w=t(66519),C=t(5738),S=t(30570),y=t(38238),M=t(35920),T=t(29938);function L(e){var n=e.setFilterText,t=e.setUseShoppingCart,r=e.setHideSparse,o=e.hideSparse,a=e.useShoppingCart,u=e.filterText,l=e.model,f=(0,i.useState)(null),h=(0,s.Z)(f,2),m=h[0],p=h[1];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(k.ZP,{container:!0,spacing:4,alignItems:"center",children:[(0,T.jsx)(k.ZP,{item:!0,children:(0,T.jsx)(w.Z,{label:"Search...",value:u,onChange:function(e){return n(e.target.value)},InputProps:{endAdornment:(0,T.jsx)(C.Z,{position:"end",children:(0,T.jsx)(d.Z,{onClick:function(){return n("")},children:(0,T.jsx)(S.Z,{})})})}})}),(0,T.jsx)(k.ZP,{item:!0,children:(0,T.jsx)(d.Z,{onClick:function(e){return p(e.currentTarget)},children:(0,T.jsx)(y.Z,{})})}),(0,T.jsx)(k.ZP,{item:!0,children:(0,T.jsx)(M.Z,{model:l})})]}),(0,T.jsx)(c.Menu,{anchorEl:m,open:!!m,onClose:function(){return p(null)},onMenuItemClick:function(e,n){n(),p(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:function(){return t(!a)},type:"checkbox",checked:a},{label:"Hide sparse metadata columns",onClick:function(){return r(!o)},checked:o,type:"checkbox"}]})]})}var E=t(13655),H=t(35388),O=t(50543),W=t(33266),I=t(91188),z=t(21630),D=t(51467),N=(0,I.ZL)()((function(e){return{facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}}}));function F(e){var n=e.column,t=e.vals,r=e.width,o=e.dispatch,c=e.filters,a=N().classes,u=(0,i.useState)(!0),l=(0,s.Z)(u,2),f=l[0],h=l[1];return(0,T.jsxs)(E.Z,{className:a.facet,style:{width:r},children:[(0,T.jsxs)("div",{style:{display:"flex"},children:[(0,T.jsx)(H.Z,{children:n.field}),(0,T.jsx)(O.Z,{title:"Clear selection on this facet filter",children:(0,T.jsx)(d.Z,{onClick:function(){o({key:n.field,val:[]})},size:"small",children:(0,T.jsx)(S.Z,{})})}),(0,T.jsx)(O.Z,{title:"Minimize/expand this facet filter",children:(0,T.jsx)(d.Z,{onClick:function(){return h(!f)},size:"small",children:f?(0,T.jsx)(z.Z,{}):(0,T.jsx)(D.Z,{})})})]}),f?(0,T.jsx)(W.Z,{multiple:!0,native:!0,className:a.select,value:c[n.field],onChange:function(e){for(var t=e.target.options,r=[],i=t.length,c=0;c<i;c++)t[c].selected&&r.push(t[c].value);o({key:n.field,val:r})},children:t.sort((function(e,n){return e[0].localeCompare(n[0])})).map((function(e){var n=(0,s.Z)(e,2),t=n[0],r=n[1];return(0,T.jsxs)("option",{value:t,children:[t," (",r,")"]},t)}))}):null]},n.field)}function G(e){var n=e.rows,t=e.columns,r=e.dispatch,i=e.filters,o=e.width,c=t.slice(1),a=c.map((function(){return new Map}));return n.forEach((function(e){c.forEach((function(n,t){var r=a[t],i="".concat(e[n.field]||""),o=r.get(i);i&&(void 0!==o?r.set(i,o+1):r.set(i,1))}))})),(0,T.jsx)("div",{children:c.map((function(e,n){return(0,T.jsx)(F,{vals:Array.from(a[n]),column:e,width:o,dispatch:r,filters:i},e.field)}))})}var B=["category","adapter","description"],P=.75,R=(0,a.observer)((function(e){var n,t=e.model,o=t.assemblyNames,a=t.view,k=t.selection,w=(0,j.getEnv)(t).pluginManager,C=(0,x.x)(),S=C.ref,y=C.scrollLeft,M=(0,i.useState)(""),E=(0,s.Z)(M,2),H=E[0],O=E[1],W=(0,i.useState)(),I=(0,s.Z)(W,2),z=I[0],D=I[1],N=(0,i.useState)(!1),F=(0,s.Z)(N,2),R=F[0],_=F[1],A=(0,i.useState)(!0),U=(0,s.Z)(A,2),V=U[0],q=U[1],X=(0,i.useState)(400),Y=(0,s.Z)(X,2),J=Y[0],K=Y[1],Q=o[0],$=(0,j.getSession)(t),ee=(0,j.useDebounce)(H,400),ne=(0,i.useReducer)((function(e,n){return(0,r.Z)((0,r.Z)({},e),{},(0,l.Z)({},n.key,n.val))}),{}),te=(0,s.Z)(ne,2),re=te[0],ie=te[1],oe=(0,i.useMemo)((function(){return t.trackConfigurations(Q).filter((function(e){return(0,b.wB)(ee,e,$)})).map((function(e){var n,t,i=(0,g.readConfObject)(e,"metadata");return(0,r.Z)({id:e.trackId,conf:e,name:(0,p.getTrackName)(e,$),category:null===(n=(0,g.readConfObject)(e,"category"))||void 0===n?void 0:n.join(", "),adapter:null===(t=(0,g.readConfObject)(e,"adapter"))||void 0===t?void 0:t.type,description:(0,g.readConfObject)(e,"description"),metadata:i},i)}))}),[Q,t,ee,$]),ce=(0,i.useMemo)((function(){return B.filter((function(e){return!V||oe.map((function(n){return n[e]})).filter((function(e){return!!e})).length>5}))}),[V,oe]),ae=(0,i.useMemo)((function(){return(0,u.Z)(new Set(oe.map((function(e){return n=e.metadata,Object.entries(n).map((function(e){var n=(0,s.Z)(e,2),t=n[0];return"string"===typeof n[1]?t:""})).filter((function(e){return!!e}));var n})).flat())).filter((function(e){return!V||oe.map((function(n){return n.metadata[e]})).filter((function(e){return!!e})).length>5}))}),[V,oe]),ue=(0,i.useMemo)((function(){return["name"].concat((0,u.Z)(ce),(0,u.Z)(ae))}),[ce,ae]),le=(0,i.useState)((0,r.Z)((0,r.Z)({name:(0,j.measureGridWidth)(oe.map((function(e){return e.name})),{maxWidth:500,stripHTML:!0})+15},Object.fromEntries(ce.map((function(e){return[e,(0,j.measureGridWidth)(oe.map((function(n){return n[e]})),{maxWidth:400,stripHTML:!0})]})))),Object.fromEntries(ae.map((function(e){return[e,(0,j.measureGridWidth)(oe.map((function(n){return n.metadata[e]})),{maxWidth:400,stripHTML:!0})]}))))),se=(0,s.Z)(le,2),de=se[0],fe=se[1],he=(0,i.useState)(Object.fromEntries(ue.map((function(e){return[e,!0]})))),me=(0,s.Z)(he,2),pe=me[0],ve=me[1];(0,i.useEffect)((function(){ve((function(e){return(0,r.Z)((0,r.Z)({},Object.fromEntries(ue.map((function(e){return[e,!0]})))),e)}))}),[ue]),(0,i.useEffect)((function(){fe((function(e){return(0,r.Z)((0,r.Z)({name:e.name},Object.fromEntries(ce.filter((function(e){return pe[e]})).map((function(e){return[e,(0,j.measureGridWidth)(oe.map((function(n){return n[e]})),{stripHTML:!0,maxWidth:400})]})))),Object.fromEntries(ae.filter((function(e){return pe[e]})).map((function(e){return[e,(0,j.measureGridWidth)(oe.map((function(n){return n.metadata[e]})),{stripHTML:!0,maxWidth:400})]}))))}))}),[ae,pe,ce,V,oe]);var xe=(0,j.useDebounce)(de,400),je=[{field:"name",hideable:!1,renderCell:function(e){var n=e.value,t=e.id,r=e.row;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(c.SanitizedHTML,{html:n}),(0,T.jsx)(d.Z,{onClick:function(e){return D({target:e.currentTarget,id:t,conf:r.conf})},children:(0,T.jsx)(Z.Z,{})})]})},width:xe.name||100}].concat((0,u.Z)(ce.map((function(e){return{field:e,width:xe[e]||100,renderCell:function(e){var n=e.value;return n?(0,T.jsx)(c.SanitizedHTML,{html:n}):""}}}))),(0,u.Z)(ae.map((function(e){return{field:e,width:xe[e]||100,renderCell:function(e){var n=e.value;return n?(0,T.jsx)(c.SanitizedHTML,{html:n}):""}}})))),ge=a.tracks.map((function(e){return e.configuration.trackId})),Ze=Object.entries(re).filter((function(e){return e[1].length>0}));return(0,T.jsxs)(T.Fragment,{children:[z?(0,T.jsx)(v.Z,{anchorEl:null===z||void 0===z?void 0:z.target,menuItems:(null===(n=$.getTrackActionMenuItems)||void 0===n?void 0:n.call($,z.conf))||[],onMenuItemClick:function(e,n){n(),D(void 0)},open:!!z,onClose:function(){return D(void 0)}}):null,(0,T.jsx)(L,{setHideSparse:q,setFilterText:O,setUseShoppingCart:_,hideSparse:V,filterText:H,useShoppingCart:R,model:t}),(0,T.jsxs)("div",{ref:S,style:{display:"flex",overflow:"hidden",height:window.innerHeight*P,width:window.innerWidth*P},children:[(0,T.jsxs)("div",{style:{height:window.innerHeight*P,width:window.innerWidth*P-J},children:[(0,T.jsx)(x.Z,{checkbox:!0,widths:Object.values(de),setWidths:function(e){return fe(Object.fromEntries(Object.entries(de).map((function(n,t){return[n[0],e[t]]}))))},scrollLeft:y}),(0,T.jsx)(m._,{rows:oe.filter((function(e){return Ze.every((function(n){var t=(0,s.Z)(n,2),r=t[0];return t[1].includes(e[r])}))})),columnVisibilityModel:pe,onColumnVisibilityModelChange:function(e){return ve(e)},headerHeight:35,checkboxSelection:!0,disableSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onSelectionModelChange:function(e){if(R){var n=(0,h.getRoot)(t),r=w.pluggableConfigSchemaType("track"),i=e.map((function(e){return(0,h.resolveIdentifier)(r,n,e)}));t.setSelection(i)}else{var o=ge,c=e;(0,f.transaction)((function(){o.filter((function(e){return!c.includes(e)})).map((function(e){return a.hideTrack(e)})),c.filter((function(e){return!o.includes(e)})).map((function(e){return a.showTrack(e)}))}))}},selectionModel:R?k.map((function(e){return e.trackId})):ge,columns:je,rowHeight:25})]}),(0,T.jsx)(c.ResizeHandle,{vertical:!0,onDrag:function(e){return K(J-e)},style:{background:"grey",width:5}}),(0,T.jsx)("div",{style:{width:J,overflowY:"auto",overflowX:"hidden"},children:(0,T.jsx)(G,{width:J-10,rows:oe,columns:je,dispatch:ie,filters:re})})]})]})}));var _=(0,a.observer)((function(e){var n=e.handleClose;return(0,T.jsx)(c.Dialog,{open:!0,onClose:n,maxWidth:"xl",title:"Faceted track selector",children:(0,T.jsx)(o.Z,{children:(0,T.jsx)(R,(0,r.Z)({},e))})})}))}}]);
//# sourceMappingURL=1960.c79d780a.chunk.js.map