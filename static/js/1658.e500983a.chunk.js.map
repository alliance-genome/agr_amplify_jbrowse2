{"version":3,"file":"static/js/1658.e500983a.chunk.js","mappings":"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","sources":["../../../plugins/gccontent/src/GCContentAdapter/GCContentAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { firstValueFrom } from 'rxjs'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, Region } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\n\nexport default class extends BaseFeatureDataAdapter {\n  private windowSize = 1000\n\n  private windowDelta = 1000\n\n  private gcMode = 'content'\n\n  public static capabilities = ['hasLocalStats']\n\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const hw = this.windowSize === 1 ? 1 : this.windowSize / 2 // Half the window size\n      const f = this.windowSize === 1\n\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await firstValueFrom(ret.pipe(toArray()))\n      const residues = feats[0]?.get('seq') || ''\n\n      for (let i = hw; i < residues.length - hw; i += this.windowDelta) {\n        const r = f ? residues[i] : residues.slice(i - hw, i + hw)\n        let nc = 0\n        let ng = 0\n        let len = 0\n        for (let j = 0; j < r.length; j++) {\n          if (r[j] === 'c' || r[j] === 'C') {\n            nc++\n          } else if (r[j] === 'g' || r[j] === 'G') {\n            ng++\n          }\n          if (r[j] !== 'N') {\n            len++\n          }\n        }\n        const pos = queryStart\n        let score\n        if (this.gcMode === 'content') {\n          score = (ng + nc) / (len || 1)\n        } else if (this.gcMode === 'skew') {\n          score = (ng - nc) / (ng + nc || 1)\n        }\n\n        observer.next(\n          new SimpleFeature({\n            uniqueId: `${this.id}_${pos + i}`,\n            start: pos + i,\n            end: pos + i + this.windowDelta,\n            score,\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */) {}\n}\n"],"names":["_default","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","windowSize","windowDelta","gcMode","_createClass","key","value","_configure","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$getSubAdapter","adapter","wrap","_context","prev","next","this","getSubAdapter","getConf","sent","Error","abrupt","dataAdapter","stop","_getRefNames","_callee2","_context2","configure","getRefNames","query","opts","_this2","ObservableCreate","_ref","_callee3","observer","_feats$","sequenceAdapter","hw","f","queryStart","queryEnd","ret","feats","residues","i","r","nc","ng","len","j","pos","score","_context3","start","end","Math","max","complete","getFeatures","_objectSpread","firstValueFrom","pipe","toArray","get","slice","SimpleFeature","uniqueId","id","_x","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}