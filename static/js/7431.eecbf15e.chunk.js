(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[7431],{77431:function(e,t,r){"use strict";r.d(t,{$:function(){return ve},S5:function(){return ge}});var n=r(96234),a=r(41361),i=r(33028),s=r(34795),o=r(9249),u=r(87371),c=r(45754),h=r(86906),f=r(77162),l=r.n(f),d=r(62821),p=r.n(d),v=function(){function e(t,r){(0,o.Z)(this,e),this.blockPosition=t,this.dataPosition=r}return(0,u.Z)(e,[{key:"toString",value:function(){return"".concat(this.blockPosition,":").concat(this.dataPosition)}},{key:"compareTo",value:function(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}],[{key:"min",value:function(){for(var e,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(;!e;t+=1)e=n[t];for(;t<n.length;t+=1)e.compareTo(n[t])>0&&(e=n[t]);return e}}]),e}();function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)throw new Error("big-endian virtual file offsets not implemented");return new v(1099511627776*e[t+7]+4294967296*e[t+6]+16777216*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}var y=function(){function e(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;(0,o.Z)(this,e),this.minv=t,this.maxv=r,this.bin=n,this._fetchedSize=a}return(0,u.Z)(e,[{key:"toUniqueString",value:function(){return"".concat(this.minv,"..").concat(this.maxv," (bin ").concat(this.bin,", fetchedSize ").concat(this.fetchedSize(),")")}},{key:"toString",value:function(){return this.toUniqueString()}},{key:"compareTo",value:function(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}},{key:"fetchedSize",value:function(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}]),e}(),m=function(){function e(t){var r=t.filehandle,n=t.renameRefSeq,a=void 0===n?function(e){return e}:n;(0,o.Z)(this,e),this.filehandle=r,this.renameRefSeq=a}return(0,u.Z)(e,[{key:"_findFirstData",value:function(e,t){var r=e.firstDataLine;e.firstDataLine=r?r.compareTo(t)>0?t:r:t}},{key:"parse",value:function(){var e=(0,s.Z)(l().mark((function e(){var t,r=this,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.setupP||(this.setupP=this._parse(t).catch((function(e){throw r.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,this.parse(r);case 3:if(e.t1=t,e.t0=e.sent.indices[e.t1],e.t0){e.next=7;break}e.t0={};case 7:return e.abrupt("return",!!e.t0.binIndex);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function k(e){return new Promise((function(t){return setTimeout(t,e)}))}function x(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw new Error("integer overflow");return e.toNumber()}function g(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var t=new Error("aborted");throw t.code="ERR_ABORTED",t}}function w(e){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)(l().mark((function e(t){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:g(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"aborted"in e?{signal:e}:e}function S(e,t){var r=[],n=null;return 0===e.length?e:(e.sort((function(e,t){var r=e.minv.blockPosition-t.minv.blockPosition;return 0!==r?r:e.minv.dataPosition-t.minv.dataPosition})),e.forEach((function(e){var a,i;(!t||e.maxv.compareTo(t)>0)&&(null===n?(r.push(e),n=e):(a=n,(i=e).minv.blockPosition-a.maxv.blockPosition<65e3&&i.maxv.blockPosition-a.minv.blockPosition<5e6?e.maxv.compareTo(n.maxv)>0&&(n.maxv=e.maxv):(r.push(e),n=e)))})),r)}function I(e,t){return e-e%t}function A(e,t){return e-e%t+t}var C=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,u.Z)(r,[{key:"parsePseudoBin",value:function(e,t){return{lineCount:x(p().fromBytesLE(Array.prototype.slice.call(e,t+16,t+24),!0))}}},{key:"lineCount",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n,a,i,s=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.parse(r);case 3:if(n=e.sent,a=n.indices[t]){e.next=7;break}return e.abrupt("return",-1);case 7:return i=a.stats||{},e.abrupt("return",void 0===i.lineCount?-1:i.lineCount);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchBai",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baiP||(this.baiP=this.filehandle.readFile(t).catch((function(t){throw e.baiP=void 0,t}))),this.baiP}},{key:"_parse",value:function(){var e=(0,s.Z)(l().mark((function e(){var t,r,n,a,i,s,o,u,c,h,f,d,p,v,m,k,x,g;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={bai:!0,maxBlockSize:65536},e.next=3,this.fetchBai();case 3:if(21578050===(r=e.sent).readUInt32LE(0)){e.next=6;break}throw new Error("Not a BAI file");case 6:t.refCount=r.readInt32LE(4),5,n=37449,t.indices=new Array(t.refCount),a=8,i=0;case 12:if(!(i<t.refCount)){e.next=47;break}s=r.readInt32LE(a),o=void 0,a+=4,u={},c=0;case 18:if(!(c<s)){e.next=39;break}if(h=r.readUInt32LE(a),a+=4,h!==n+1){e.next=27;break}a+=4,o=this.parsePseudoBin(r,a),a+=32,e.next=36;break;case 27:if(!(h>n+1)){e.next=31;break}throw new Error("bai index contains too many bins, please use CSI");case 31:for(f=r.readInt32LE(a),a+=4,d=new Array(f),p=0;p<f;p+=1)v=b(r,a),m=b(r,a+8),a+=16,this._findFirstData(t,v),d[p]=new y(v,m,h);u[h]=d;case 36:c+=1,e.next=18;break;case 39:for(k=r.readInt32LE(a),a+=4,x=new Array(k),g=0;g<k;g+=1)x[g]=b(r,a),a+=8,this._findFirstData(t,x[g]);t.indices[i]={binIndex:u,linearIndex:x,stats:o};case 44:i+=1,e.next=12;break;case 47:return e.abrupt("return",t);case 48:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,n){var a,s,o,u,c,h,f,d,p,v,b,y,m,k,x,g=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:{},s=16384,o=void 0!==r,e.next=5,this.parse(a);case 5:if(u=e.sent,c=u.indices[t]){e.next=9;break}return e.abrupt("return",[]);case 9:if(h=c.linearIndex,f=void 0===h?[]:h,d=c.stats,f.length){e.next=12;break}return e.abrupt("return",[]);case 12:if(p=void 0!==n?A(n,s):(f.length-1)*s,v=void 0!==r?I(r,s):0,b=new Array(o?(p-v)/s:f.length-1),y=f[f.length-1].blockPosition,!(p>(f.length-1)*s)){e.next=18;break}throw new Error("query outside of range of linear index");case 18:for(m=f[v/s].blockPosition,k=v/s,x=0;k<p/s;k++,x++)b[x]={score:f[k+1].blockPosition-m,start:k*s,end:k*s+s},m=f[k+1].blockPosition;return e.abrupt("return",b.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{score:e.score*d.lineCount/y})})));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){return[[0,0],[1+(e>>26),1+((t-=1)>>26)],[9+(e>>23),9+(t>>23)],[73+(e>>20),73+(t>>20)],[585+(e>>17),585+(t>>17)],[4681+(e>>14),4681+(t>>14)]]}},{key:"blocksForRange",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,i){var s,o,u,c,h,f,d,p,v,b,m,k,x,g,w,_,E,I,A,C=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=C.length>3&&void 0!==C[3]?C[3]:{},r<0&&(r=0),e.next=4,this.parse(s);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(u=o.indices[t]){e.next=10;break}return e.abrupt("return",[]);case 10:c=this.reg2bins(r,i),h=[],f=(0,a.Z)(c);try{for(f.s();!(d=f.n()).done;)for(p=(0,n.Z)(d.value,2),v=p[0],b=p[1],m=v;m<=b;m++)if(u.binIndex[m])for(k=u.binIndex[m],x=0;x<k.length;++x)h.push(new y(k[x].minv,k[x].maxv,m))}catch(l){f.e(l)}finally{f.f()}for(g=u.linearIndex.length,w=null,_=Math.min(r>>14,g-1),E=Math.min(i>>14,g-1),I=_;I<=E;++I)(A=u.linearIndex[I])&&(!w||A.compareTo(w)<0)&&(w=A);return e.abrupt("return",S(h,w));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(m),T=r(42098);function L(e,t){return Math.floor(e/Math.pow(2,t))}var P=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).maxBinNumber=0,n.depth=0,n.minShift=0,n}return(0,u.Z)(r,[{key:"lineCount",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parse();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",-1);case 5:if(r.indices[t]){e.next=8;break}return e.abrupt("return",-1);case 8:if(!(n=r.indices[t].stats)){e.next=11;break}return e.abrupt("return",n.lineCount);case 11:return e.abrupt("return",-1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,s.Z)(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"parseAuxData",value:function(e,t,r){if(r<30)return{};var n={};if(n.formatFlags=e.readInt32LE(t),n.coordinateType=65536&n.formatFlags?"zero-based-half-open":"1-based-closed",n.format={0:"generic",1:"SAM",2:"VCF"}[15&n.formatFlags],!n.format)throw new Error("invalid Tabix preset format flags ".concat(n.formatFlags));n.columnNumbers={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},n.metaValue=e.readInt32LE(t+16),n.metaChar=n.metaValue?String.fromCharCode(n.metaValue):"",n.skipLines=e.readInt32LE(t+20);var a=e.readInt32LE(t+24);return Object.assign(n,this._parseNameBytes(e.subarray(t+28,t+28+a))),n}},{key:"_parseNameBytes",value:function(e){for(var t=0,r=0,n=[],a={},i=0;i<e.length;i+=1)if(!e[i]){if(r<i){var s=e.toString("utf8",r,i);s=this.renameRefSeq(s),n[t]=s,a[s]=t}r=i+1,t+=1}return{refNameToId:a,refIdToName:n}}},{key:"_parse",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n,a,i,s,o,u,c,h,f,d,p,v,m,k,x,g;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={csi:!0,maxBlockSize:65536},e.next=3,this.filehandle.readFile(t);case 3:return n=e.sent,e.next=6,(0,T.unzip)(n);case 6:if(21582659!==(a=e.sent).readUInt32LE(0)){e.next=11;break}r.csiVersion=1,e.next=16;break;case 11:if(38359875!==a.readUInt32LE(0)){e.next=15;break}r.csiVersion=2,e.next=16;break;case 15:throw new Error("Not a CSI file");case 16:this.minShift=a.readInt32LE(4),this.depth=a.readInt32LE(8),this.maxBinNumber=((1<<3*(this.depth+1))-1)/7,(i=a.readInt32LE(12))&&Object.assign(r,this.parseAuxData(a,16,i)),r.refCount=a.readInt32LE(16+i),r.indices=new Array(r.refCount),s=16+i+4,o=0;case 25:if(!(o<r.refCount)){e.next=37;break}return e.next=28,w(t.signal);case 28:for(u=a.readInt32LE(s),s+=4,c={},h=void 0,f=0;f<u;f+=1)if((d=a.readUInt32LE(s))>this.maxBinNumber)h=this.parsePseudoBin(a,s+4),s+=48;else{for(p=b(a,s+4),this._findFirstData(r,p),v=a.readInt32LE(s+12),s+=16,m=new Array(v),k=0;k<v;k+=1)x=b(a,s),g=b(a,s+8),s+=16,m[k]=new y(x,g,d);c[d]=m}r.indices[o]={binIndex:c,stats:h};case 34:o+=1,e.next=25;break;case 37:return e.abrupt("return",r);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parsePseudoBin",value:function(e,t){return{lineCount:x(p().fromBytesLE(Array.prototype.slice.call(e,t+28,t+36),!0))}}},{key:"blocksForRange",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,i){var s,o,u,c,h,f,d,p,b,m,k,x,g,w=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=w.length>3&&void 0!==w[3]?w[3]:{},r<0&&(r=0),e.next=4,this.parse(s);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(u=o.indices[t]){e.next=10;break}return e.abrupt("return",[]);case 10:c=this.reg2bins(r,i),h=[],f=(0,a.Z)(c);try{for(f.s();!(d=f.n()).done;)for(p=(0,n.Z)(d.value,2),b=p[0],m=p[1],k=b;k<=m;k++)if(u.binIndex[k])for(x=u.binIndex[k],g=0;g<x.length;++g)h.push(new y(x[g].minv,x[g].maxv,k))}catch(l){f.e(l)}finally{f.f()}return e.abrupt("return",S(h,new v(0,0)));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){(e-=1)<1&&(e=1),t>Math.pow(2,50)&&(t=Math.pow(2,34)),t-=1;for(var r,n=0,a=0,i=this.minShift+3*this.depth,s=[];n<=this.depth;i-=3,a+=(r=3*n,1*Math.pow(2,r)),n+=1){var o=a+L(e,i),u=a+L(t,i);if(u-o+s.length>this.maxBinNumber)throw new Error("query ".concat(e,"-").concat(t," is too large for current binning scheme (shift ").concat(this.minShift,", depth ").concat(this.depth,"), try a smaller query or a coarser index binning scheme"));s.push([o,u])}return s}}]),r}(m),Z=r(68079),R=r(98288),B=r(30249),F=r(61418),z=r(69621),U=r(10326),M=r.n(U),O=r(28502),q=r.n(O),D=r(2877),j=r(89410),N=r.n(j),H=r(91480),G=r.n(H),V=1,X=2,Q=4,Y=8,J=16,K=32,W=64,$=128,ee=256,te=512,re=1024,ne=2048,ae="=ACMGRSVTWYHKDBN".split(""),ie="MIDNSHP=X???????".split(""),se=function(){function e(t){(0,o.Z)(this,e),this.data={},this._tagList=[],this._allTagsParsed=!1;var r=t.bytes,n=t.fileOffset,a=r.byteArray,i=r.start;this.data={},this.bytes=r,this._id=n,this._refID=a.readInt32LE(i+4),this.data.start=a.readInt32LE(i+8),this.flags=(4294901760&a.readInt32LE(i+16))>>16}return(0,u.Z)(e,[{key:"get",value:function(e){return this[e]?(this.data[e]||(this.data[e]=this[e]()),this.data[e]):this._get(e.toLowerCase())}},{key:"end",value:function(){return this.get("start")+this.get("length_on_ref")}},{key:"seq_id",value:function(){return this._refID}},{key:"_get",value:function(e){return e in this.data||(this.data[e]=this._parseTag(e)),this.data[e]}},{key:"_tags",value:function(){var e=this;this._parseAllTags();var t=["seq"];this.isSegmentUnmapped()||t.push("start","end","strand","score","qual","MQ","CIGAR","length_on_ref","template_length"),this.isPaired()&&t.push("next_segment_position","pair_orientation"),t=t.concat(this._tagList||[]),Object.keys(this.data).forEach((function(e){"_"!==e[0]&&"next_seq_id"!==e&&t.push(e)}));var r={};return t.filter((function(t){if(t in e.data&&void 0===e.data[t]||"CG"===t||"cg"===t)return!1;var n=t.toLowerCase(),a=r[n];return r[n]=!0,!a}))}},{key:"parent",value:function(){}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"id",value:function(){return this._id}},{key:"mq",value:function(){var e=(65280&this.get("_bin_mq_nl"))>>8;return 255===e?void 0:e}},{key:"score",value:function(){return this.get("mq")}},{key:"qual",value:function(){var e;return null===(e=this.qualRaw())||void 0===e?void 0:e.join(" ")}},{key:"qualRaw",value:function(){if(!this.isSegmentUnmapped()){var e=this.bytes,t=e.start,r=e.byteArray,n=t+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes"),a=this.get("seq_length");return r.subarray(n,n+a)}}},{key:"strand",value:function(){return this.isReverseComplemented()?-1:1}},{key:"multi_segment_next_segment_strand",value:function(){if(!this.isMateUnmapped())return this.isMateReverseComplemented()?-1:1}},{key:"name",value:function(){return this.get("_read_name")}},{key:"_read_name",value:function(){var e=this.get("_l_read_name"),t=this.bytes,r=t.byteArray,n=t.start;return r.toString("ascii",n+36,n+36+e-1)}},{key:"_parseTag",value:function(e){if(!this._allTagsParsed){for(var t,r=this.bytes,n=r.byteArray,a=r.start,i=this._tagOffset||a+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes")+this.get("seq_length"),s=this.bytes.end;i<s&&t!==e;){var o=String.fromCharCode(n[i],n[i+1]);t=o.toLowerCase();var u=String.fromCharCode(n[i+2]);i+=3;var c=void 0;switch(u){case"A":c=String.fromCharCode(n[i]),i+=1;break;case"i":c=n.readInt32LE(i),i+=4;break;case"I":c=n.readUInt32LE(i),i+=4;break;case"c":c=n.readInt8(i),i+=1;break;case"C":c=n.readUInt8(i),i+=1;break;case"s":c=n.readInt16LE(i),i+=2;break;case"S":c=n.readUInt16LE(i),i+=2;break;case"f":c=n.readFloatLE(i),i+=4;break;case"Z":case"H":for(c="";i<=s;){var h=n[i++];if(0===h)break;c+=String.fromCharCode(h)}break;case"B":c="";var f=n[i++],l=String.fromCharCode(f),d=n.readInt32LE(i);if(i+=4,"i"===l)if("CG"===o)for(var p=0;p<d;p++){var v=n.readInt32LE(i);c+=(v>>4)+ie[15&v],i+=4}else for(var b=0;b<d;b++)c+=n.readInt32LE(i),b+1<d&&(c+=","),i+=4;if("I"===l)if("CG"===o)for(var y=0;y<d;y++){var m=n.readUInt32LE(i);c+=(m>>4)+ie[15&m],i+=4}else for(var k=0;k<d;k++)c+=n.readUInt32LE(i),k+1<d&&(c+=","),i+=4;if("s"===l)for(var x=0;x<d;x++)c+=n.readInt16LE(i),x+1<d&&(c+=","),i+=2;if("S"===l)for(var g=0;g<d;g++)c+=n.readUInt16LE(i),g+1<d&&(c+=","),i+=2;if("c"===l)for(var w=0;w<d;w++)c+=n.readInt8(i),w+1<d&&(c+=","),i+=1;if("C"===l)for(var _=0;_<d;_++)c+=n.readUInt8(i),_+1<d&&(c+=","),i+=1;if("f"===l)for(var E=0;E<d;E++)c+=n.readFloatLE(i),E+1<d&&(c+=","),i+=4;break;default:console.warn("Unknown BAM tag type '".concat(u,"', tags may be incomplete")),c=void 0,i=s}if(this._tagOffset=i,this._tagList.push(o),t===e)return c;this.data[t]=c}this._allTagsParsed=!0}}},{key:"_parseAllTags",value:function(){this._parseTag("")}},{key:"_parseCigar",value:function(e){return e.match(/\d+\D/g).map((function(e){return[e.match(/\D/)[0].toUpperCase(),parseInt(e,10)]}))}},{key:"isPaired",value:function(){return!!(this.flags&V)}},{key:"isProperlyPaired",value:function(){return!!(this.flags&X)}},{key:"isSegmentUnmapped",value:function(){return!!(this.flags&Q)}},{key:"isMateUnmapped",value:function(){return!!(this.flags&Y)}},{key:"isReverseComplemented",value:function(){return!!(this.flags&J)}},{key:"isMateReverseComplemented",value:function(){return!!(this.flags&K)}},{key:"isRead1",value:function(){return!!(this.flags&W)}},{key:"isRead2",value:function(){return!!(this.flags&$)}},{key:"isSecondary",value:function(){return!!(this.flags&ee)}},{key:"isFailedQc",value:function(){return!!(this.flags&te)}},{key:"isDuplicate",value:function(){return!!(this.flags&re)}},{key:"isSupplementary",value:function(){return!!(this.flags&ne)}},{key:"cigar",value:function(){if(!this.isSegmentUnmapped()){var e=this.bytes,t=e.byteArray,r=e.start,n=this.get("_n_cigar_op"),a=r+36+this.get("_l_read_name"),i=this.get("seq_length"),s="",o=0,u=t.readInt32LE(a),c=u>>4,h=ie[15&u];if("S"===h&&c===i)return a+=4,c=(u=t.readInt32LE(a))>>4,"N"!==(h=ie[15&u])&&console.warn("CG tag with no N tag"),this.data.length_on_ref=c,this.get("CG");for(var f=0;f<n;++f)s+=(c=(u=t.readInt32LE(a))>>4)+(h=ie[15&u]),"H"!==h&&"S"!==h&&"I"!==h&&(o+=c),a+=4;return this.data.length_on_ref=o,s}}},{key:"_flags",value:function(){}},{key:"length_on_ref",value:function(){return this.data.length_on_ref||this.get("cigar"),this.data.length_on_ref}},{key:"_n_cigar_op",value:function(){return 65535&this.get("_flag_nc")}},{key:"_l_read_name",value:function(){return 255&this.get("_bin_mq_nl")}},{key:"_seq_bytes",value:function(){return this.get("seq_length")+1>>1}},{key:"getReadBases",value:function(){return this.seq()}},{key:"seq",value:function(){for(var e=this.bytes,t=e.byteArray,r=e.start+36+this.get("_l_read_name")+4*this.get("_n_cigar_op"),n=this.get("_seq_bytes"),a=this.get("seq_length"),i="",s=0,o=0;o<n;++o){var u=t[r+o];i+=ae[(240&u)>>4],++s<a&&(i+=ae[15&u],s++)}return i}},{key:"getPairOrientation",value:function(){if(!this.isSegmentUnmapped()&&!this.isMateUnmapped()&&this._refID===this._next_refid()){var e=this.isReverseComplemented()?"R":"F",t=this.isMateReverseComplemented()?"R":"F",r=" ",n=" ";this.isRead1()?(r="1",n="2"):this.isRead2()&&(r="2",n="1");var a=[];return this.template_length()>0?(a[0]=e,a[1]=r,a[2]=t,a[3]=n):(a[2]=e,a[3]=r,a[0]=t,a[1]=n),a.join("")}return null}},{key:"_bin_mq_nl",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+12)}},{key:"_flag_nc",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+16)}},{key:"seq_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+20)}},{key:"_next_refid",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+24)}},{key:"_next_pos",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+28)}},{key:"template_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+32)}},{key:"toJSON",value:function(){var e=this,t={};return Object.keys(this).forEach((function(r){"_"!==r.charAt(0)&&"bytes"!==r&&(t[r]=e[r])})),t}}]),e}(),oe=r(46840);function ue(e){var t=e.split(/\r?\n/),r=[];return t.forEach((function(e){var t=e.split(/\t/),a=(0,oe.Z)(t),i=a[0],s=a.slice(1).map((function(e){var t=e.split(":",2),r=(0,n.Z)(t,2);return{tag:r[0],value:r[1]}}));i&&r.push({tag:i.substr(1),data:s})})),r}var ce=r(49882).Buffer,he=21840194,fe=65536;function le(e){var t;return(t=[]).concat.apply(t,(0,Z.Z)(e))}function de(e){return pe.apply(this,arguments)}function pe(){return(pe=(0,s.Z)(l().mark((function e(t){var r,n,a,i,s,o,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=!1,a=!1,e.prev=3,s=(0,z.Z)(t);case 5:return e.next=7,s.next();case 7:if(!(n=!(o=e.sent).done)){e.next=13;break}u=o.value,r.push(u);case 10:n=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),a=!0,i=e.t0;case 19:if(e.prev=19,e.prev=20,!n||null==s.return){e.next=24;break}return e.next=24,s.return();case 24:if(e.prev=24,!a){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var ve=function(){function e(t){var r=this,n=t.bamFilehandle,a=t.bamPath,u=t.bamUrl,c=t.baiPath,h=t.baiFilehandle,f=t.baiUrl,d=t.csiPath,p=t.csiFilehandle,v=t.csiUrl,b=t.fetchSizeLimit,y=t.chunkSizeLimit,m=t.yieldThreadTime,k=void 0===m?100:m,x=t.renameRefSeqs,g=void 0===x?function(e){return e}:x;if((0,o.Z)(this,e),this.featureCache=new(N())({cache:new(G())({maxSize:50}),fill:function(){var e=(0,s.Z)(l().mark((function e(t,n){var a,s,o,u,c,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.chunk,s=t.opts,e.next=3,r._readChunk({chunk:a,opts:(0,i.Z)((0,i.Z)({},s),{},{signal:n})});case 3:return o=e.sent,u=o.data,c=o.cpositions,h=o.dpositions,e.next=9,r.readBamFeatures(u,c,h,a);case 9:return f=e.sent,e.abrupt("return",f);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),this.renameRefSeq=g,n)this.bam=n;else if(a)this.bam=new D.LocalFile(a);else{if(!u)throw new Error("unable to initialize bam");this.bam=new D.RemoteFile(u)}if(p)this.index=new P({filehandle:p});else if(d)this.index=new P({filehandle:new D.LocalFile(d)});else if(v)this.index=new P({filehandle:new D.RemoteFile(v)});else if(h)this.index=new C({filehandle:h});else if(c)this.index=new C({filehandle:new D.LocalFile(c)});else if(f)this.index=new C({filehandle:new D.RemoteFile(f)});else if(a)this.index=new C({filehandle:new D.LocalFile("".concat(a,".bai"))});else{if(!u)throw new Error("unable to infer index format");this.index=new C({filehandle:new D.RemoteFile("".concat(u,".bai"))})}this.fetchSizeLimit=b||5e8,this.chunkSizeLimit=y||3e8,this.yieldThreadTime=k}return(0,u.Z)(e,[{key:"getHeader",value:function(){var e=(0,s.Z)(l().mark((function e(){var t,r,n,a,i,s,o,u,c,h,f,d,p=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},r=E(t),e.next=4,this.index.parse(r);case 4:if(n=e.sent,!(a=n.firstDataLine?n.firstDataLine.blockPosition+65535:void 0)){e.next=17;break}return e.next=9,this.bam.read(ce.alloc(a+fe),0,a+fe,0,r);case 9:if(s=e.sent,o=s.bytesRead,i=s.buffer,o){e.next=14;break}throw new Error("Error reading header");case 14:i=o<a?i.subarray(0,o):i.subarray(0,a),e.next=20;break;case 17:return e.next=19,this.bam.readFile(r);case 19:i=e.sent;case 20:return e.next=22,(0,T.unzip)(i);case 22:if((u=e.sent).readInt32LE(0)===he){e.next=25;break}throw new Error("Not a BAM file");case 25:return c=u.readInt32LE(4),this.header=u.toString("utf8",8,8+c),e.next=29,this._readRefSeqs(c+8,65535,r);case 29:return h=e.sent,f=h.chrToIndex,d=h.indexToChr,this.chrToIndex=f,this.indexToChr=d,e.abrupt("return",ue(this.header));case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeaderText",value:function(){var e=(0,s.Z)(l().mark((function e(){var t,r=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getHeader(t);case 3:return e.abrupt("return",this.header);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_readRefSeqs",value:function(){var e=(0,s.Z)(l().mark((function e(t,r){var n,a,i,s,o,u,c,h,f,d,p,v,b,y,m=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>2&&void 0!==m[2]?m[2]:{},!(t>r)){e.next=3;break}return e.abrupt("return",this._readRefSeqs(t,2*r,n));case 3:return a=r+fe,e.next=6,this.bam.read(ce.alloc(a),0,r,0,n);case 6:if(i=e.sent,s=i.bytesRead,o=i.buffer,s){e.next=11;break}throw new Error("Error reading refseqs from header");case 11:return e.next=13,(0,T.unzip)(o.subarray(0,Math.min(s,r)));case 13:u=e.sent,c=u.readInt32LE(t),h=t+4,f={},d=[],p=0;case 19:if(!(p<c)){e.next=32;break}if(v=u.readInt32LE(h),b=this.renameRefSeq(u.toString("utf8",h+4,h+4+v-1)),y=u.readInt32LE(h+v+4),f[b]=p,d.push({refName:b,length:y}),!((h=h+8+v)>u.length)){e.next=29;break}return console.warn("BAM header is very big.  Re-fetching ".concat(r," bytes.")),e.abrupt("return",this._readRefSeqs(t,2*r,n));case 29:p+=1,e.next=19;break;case 32:return e.abrupt("return",{chrToIndex:f,indexToChr:d});case 33:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getRecordsForRange",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,n){var a,i=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>3&&void 0!==i[3]?i[3]:{viewAsPairs:!1,pairAcrossChr:!1,maxInsertSize:2e5},e.t0=le,e.next=4,de(this.streamRecordsForRange(t,r,n,a));case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"streamRecordsForRange",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,R.Z)(l().mark((function i(){var s,o,u,c,h,f;return l().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=a.signal,(o=n.chrToIndex&&n.chrToIndex[e])>=0){i.next=6;break}u=[],i.next=11;break;case 6:return i.next=8,(0,B.Z)(n.index.blocksForRange(o,t-1,r,a));case 8:if(u=i.sent){i.next=11;break}throw new Error("Error in index fetch");case 11:c=0;case 12:if(!(c<u.length)){i.next=21;break}return i.next=15,(0,B.Z)(w(s));case 15:if(!((h=u[c].fetchedSize())>n.chunkSizeLimit)){i.next=18;break}throw new Error("Too many BAM features. BAM chunk size ".concat(h," bytes exceeds chunkSizeLimit of ").concat(n.chunkSizeLimit));case 18:c+=1,i.next=12;break;case 21:if(!((f=u.map((function(e){return e.fetchedSize()})).reduce((function(e,t){return e+t}),0))>n.fetchSizeLimit)){i.next=24;break}throw new Error("data size of ".concat(f.toLocaleString()," bytes exceeded fetch size limit of ").concat(n.fetchSizeLimit.toLocaleString()," bytes"));case 24:return i.delegateYield((0,F.Z)((0,z.Z)(n._fetchChunkFeatures(u,o,t,r,a)),B.Z),"t0",25);case 25:case"end":return i.stop()}}),i)})))()}},{key:"_fetchChunkFeatures",value:function(e,t,r,n,a){var i=this;return(0,R.Z)(l().mark((function s(){var o,u,c,h,f,d,p,v,b,y;return l().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:o=a.viewAsPairs,u=void 0!==o&&o,c=[],h=!1,f=0;case 4:if(!(f<e.length)){s.next=31;break}return d=e[f],s.next=8,(0,B.Z)(i.featureCache.get(d.toString(),{chunk:d,opts:a},a.signal));case 8:p=s.sent,v=[],b=0;case 11:if(!(b<p.length)){s.next=23;break}if((y=p[b]).seq_id()!==t){s.next=20;break}if(!(y.get("start")>=n)){s.next=19;break}return h=!0,s.abrupt("break",23);case 19:y.get("end")>=r&&v.push(y);case 20:b+=1,s.next=11;break;case 23:return c.push(v),s.next=26,v;case 26:if(!h){s.next=28;break}return s.abrupt("break",31);case 28:f++,s.next=4;break;case 31:if(g(a.signal),!u){s.next=35;break}return s.next=35,i.fetchPairs(t,c,a);case 35:case"end":return s.stop()}}),s)})))()}},{key:"fetchPairs",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,a){var i,o,u,c,h,f,d,p,v,b,y=this;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.pairAcrossChr,o=void 0!==i&&i,u=a.maxInsertSize,c=void 0===u?2e5:u,h={},f={},r.map((function(e){for(var t={},r=0;r<e.length;r++){var a=e[r].name(),i=e[r].id();t[a]||(t[a]=0),t[a]++,f[i]=1}q()(t).forEach((function(e){var t=(0,n.Z)(e,2),r=t[0];1===t[1]&&(h[r]=!0)}))})),d=[],r.map((function(e){for(var r=0;r<e.length;r++){var n=e[r],i=n.name(),s=n.get("start"),u=n._next_pos(),f=n._next_refid();h[i]&&(o||f===t&&Math.abs(s-u)<c)&&d.push(y.index.blocksForRange(f,u,u+1,a))}})),e.t0=le,e.next=9,Promise.all(d);case 9:if(e.t1=e.sent,p=(0,e.t0)(e.t1).sort().filter((function(e,t,r){return!t||e.toString()!==r[t-1].toString()})),!((v=p.map((function(e){return e.fetchedSize()})).reduce((function(e,t){return e+t}),0))>this.fetchSizeLimit)){e.next=14;break}throw new Error("data size of ".concat(v.toLocaleString()," bytes exceeded fetch size limit of ").concat(this.fetchSizeLimit.toLocaleString()," bytes"));case 14:return b=p.map(function(){var e=(0,s.Z)(l().mark((function e(t){var r,n,i,s,o,u,c,d,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y._readChunk({chunk:t,opts:a});case 2:return r=e.sent,n=r.data,i=r.cpositions,s=r.dpositions,o=r.chunk,e.next=9,y.readBamFeatures(n,i,s,o);case 9:for(u=e.sent,c=[],d=0;d<u.length;d+=1)p=u[d],h[p.get("name")]&&!f[p.id()]&&c.push(p);return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t2=le,e.next=18,Promise.all(b);case 18:return e.t3=e.sent,e.abrupt("return",(0,e.t2)(e.t3));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_readChunk",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n,a,i,s,o,u,c,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.chunk,n=t.opts,a=r.fetchedSize(),e.next=4,this.bam.read(ce.alloc(a),0,a,r.minv.blockPosition,n);case 4:return i=e.sent,s=i.buffer,o=i.bytesRead,e.next=9,(0,T.unzipChunkSlice)(s.subarray(0,Math.min(o,a)),r);case 9:return u=e.sent,c=u.buffer,h=u.cpositions,f=u.dpositions,e.abrupt("return",{data:c,cpositions:h,dpositions:f,chunk:r});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBamFeatures",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,n,a){var i,s,o,u,c,h,f;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,s=[],o=0,u=+Date.now();case 4:if(!(i+4<t.length)){e.next=18;break}if(c=t.readInt32LE(i),h=i+4+c-1,n){for(;i+a.minv.dataPosition>=n[o++];);o--}if(!(h<t.length)){e.next=15;break}if(f=new se({bytes:{byteArray:t,start:i,end:h},fileOffset:r?256*r[o]+(i-n[o])+a.minv.dataPosition+1:M().signed(t.slice(i,h))}),s.push(f),!(this.yieldThreadTime&&+Date.now()-u>this.yieldThreadTime)){e.next=15;break}return e.next=14,k(1);case 14:u=+Date.now();case 15:i=h+1,e.next=4;break;case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.hasRefSeq(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lineCount",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.lineCount(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,n){var a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.index.parse();case 2:return a=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.indexCov(a,r,n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"blocksForRange",value:function(){var e=(0,s.Z)(l().mark((function e(t,r,n,a){var i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.index.parse();case 2:return i=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.blocksForRange(i,r,n,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()}]),e}(),be=r(59740),ye=(r(84856),r(49882).Buffer),me=["referer"];function ke(e,t){return xe.apply(this,arguments)}function xe(){return xe=(0,s.Z)(l().mark((function e(t,r){var n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=(0,s.Z)(l().mark((function e(t){var n,a,s,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url,a=t.headers,!n.startsWith("data:")){e.next=5;break}return e.abrupt("return",ye.from(n.split(",")[1],"base64"));case 5:return a.referer,s=(0,be.Z)(a,me),e.next=8,fetch(n,(0,i.Z)((0,i.Z)({},r),{},{headers:(0,i.Z)((0,i.Z)({},r.headers),s)}));case 8:if((o=e.sent).ok){e.next=11;break}throw new Error("Failed to fetch ".concat(o.statusText));case 11:return e.t0=ye,e.next=14,o.arrayBuffer();case 14:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return n=e.sent,e.t0=ye,e.next=6,Promise.all(n.map((function(e){return(0,T.unzip)(e)})));case 6:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 8:case"end":return e.stop()}}),e)}))),xe.apply(this,arguments)}var ge=function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,{bamFilehandle:"?",baiFilehandle:"?"})).baseUrl=e.baseUrl,n.trackId=e.trackId,n}return(0,u.Z)(r,[{key:"streamRecordsForRange",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{viewAsPairs:!1,pairAcrossChr:!1,maxInsertSize:2e5};return(0,R.Z)(l().mark((function s(){var o,u,c,h,f,d,p;return l().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o="".concat(n.baseUrl,"/").concat(n.trackId),u="".concat(o,"?referenceName=").concat(e,"&start=").concat(t,"&end=").concat(r,"&format=BAM"),c=n.chrToIndex&&n.chrToIndex[e],s.next=5,(0,B.Z)(fetch(u,(0,i.Z)({},a)));case 5:if((h=s.sent).ok){s.next=8;break}throw new Error(h.statusText);case 8:return s.next=10,(0,B.Z)(h.json());case 10:return f=s.sent,s.next=13,(0,B.Z)(ke(f.htsget.urls.slice(1),a));case 13:return d=s.sent,p={buffer:d,chunk:{minv:{dataPosition:0}},toString:function(){return"".concat(e,"_").concat(t,"_").concat(r)}},s.delegateYield((0,F.Z)((0,z.Z)(n._fetchChunkFeatures([p],c,t,r,a)),B.Z),"t0",16);case 16:case"end":return s.stop()}}),s)})))()}},{key:"_readChunk",value:function(){var e=(0,s.Z)(l().mark((function e(t){var r,n,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.chunk,n=r.buffer,a=r.chunk,e.abrupt("return",{data:n,cpositions:null,dpositions:null,chunk:a});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=(0,s.Z)(l().mark((function e(){var t,r,n,a,i,s,o,u,c,h,f=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:{},r="".concat(this.baseUrl,"/").concat(this.trackId,"?referenceName=na&class=header"),e.next=4,fetch(r,t);case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("Failed to fetch ".concat(n.statusText));case 7:return e.next=9,n.json();case 9:return a=e.sent,e.next=12,ke(a.htsget.urls,t);case 12:if((i=e.sent).readInt32LE(0)===he){e.next=15;break}throw new Error("Not a BAM file");case 15:return s=i.readInt32LE(4),o=i.toString("utf8",8,8+s),u=ue(o),c=[],h={},u.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var r=e.value;h[r]=t,c[t]=r}}))})),this.chrToIndex=h,this.indexToChr=c,e.abrupt("return",u);case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(ve)},91480:function(e,t,r){"use strict";var n=r(77162),a=r(51068).default,i=r(93041).default,s=r(50085).default,o=r(15198).default,u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(s(this,t),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}return o(t,[{key:"_set",value:function(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:n.mark((function e(){var t,r,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i(this),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return s=a(r.value,1),o=s[0],e.next=7,o;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"values",value:n.mark((function e(){var t,r,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i(this),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return s=a(r.value,2),o=s[1],e.next=7,o;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:e,value:n.mark((function e(){var t,r,s,o,u,c,h,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=i(this.cache),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return s=r.value,e.next=7,s;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:o=i(this.oldCache),e.prev=18,o.s();case 20:if((u=o.n()).done){e.next=28;break}if(c=u.value,h=a(c,1),f=h[0],this.cache.has(f)){e.next=26;break}return e.next=26,c;case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(18),o.e(e.t1);case 33:return e.prev=33,o.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[1,11,14,17],[18,30,33,36]])}))},{key:"size",get:function(){var e,t=0,r=i(this.oldCache.keys());try{for(r.s();!(e=r.n()).done;){var n=e.value;this.cache.has(n)||t++}}catch(a){r.e(a)}finally{r.f()}return this._size+t}}]),t}(Symbol.iterator);e.exports=u},28313:function(e,t,r){"use strict";var n=r(50085).default,a=r(15198).default,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(28909),o=i(r(32984)),u=i(r(77088)),c=function(){function e(t){var r=t.fill,a=t.cache;if(n(this,e),"function"!==typeof r)throw new TypeError("must pass a fill function");if("object"!==typeof a)throw new TypeError("must pass a cache object");if("function"!==typeof a.get||"function"!==typeof a.set||"function"!==typeof a.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=a,this.fillCallback=r}return a(e,[{key:"evict",value:function(e,t){this.cache.get(e)===t&&this.cache.delete(e)}},{key:"fill",value:function(e,t,r,n){var a=this,i=new o.default,s=new u.default;s.addCallback(n);var c={aborter:i,promise:this.fillCallback(t,i.signal,(function(e){s.callback(e)})),settled:!1,statusReporter:s,get aborted(){return this.aborter.signal.aborted}};c.aborter.addSignal(r),c.aborter.signal.addEventListener("abort",(function(){c.settled||a.evict(e,c)})),c.promise.then((function(){c.settled=!0}),(function(){c.settled=!0,a.evict(e,c)})).catch((function(e){throw console.error(e),e})),this.cache.set(e,c)}},{key:"has",value:function(e){return this.cache.has(e)}},{key:"get",value:function(t,r,n,a){if(!n&&r instanceof s.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");var i=this.cache.get(t);return i?i.aborted&&!i.settled?(this.evict(t,i),this.get(t,r,n,a)):i.settled?i.promise:(i.aborter.addSignal(n),i.statusReporter.addCallback(a),e.checkSinglePromise(i.promise,n)):(this.fill(t,r,n,a),e.checkSinglePromise(this.cache.get(t).promise,n))}},{key:"delete",value:function(e){var t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}},{key:"clear",value:function(){for(var e=this.cache.keys(),t=0,r=e.next();!r.done;r=e.next())this.delete(r.value),t+=1;return t}}],[{key:"isAbortException",value:function(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}},{key:"checkSinglePromise",value:function(e,t){function r(){if(t&&t.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then((function(e){return r(),e}),(function(e){throw r(),e}))}}]),e}();t.default=c},32984:function(e,t,r){"use strict";var n=r(15198).default,a=r(50085).default;Object.defineProperty(t,"__esModule",{value:!0});var i=r(28909),s=n((function e(){a(this,e)})),o=function(){function e(){a(this,e),this.signals=new Set,this.abortController=new i.AbortController}return n(e,[{key:"addSignal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s;if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(t),t.aborted?this.handleAborted(t):"function"===typeof t.addEventListener&&t.addEventListener("abort",(function(){e.handleAborted(t)}))}},{key:"handleAborted",value:function(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}},{key:"signal",get:function(){return this.abortController.signal}},{key:"abort",value:function(){this.abortController.abort()}}]),e}();t.default=o},77088:function(e,t,r){"use strict";var n=r(50085).default,a=r(15198).default;Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){n(this,e),this.callbacks=new Set}return a(e,[{key:"addCallback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.callbacks.add(e),e(this.currentMessage)}},{key:"callback",value:function(e){this.currentMessage=e,this.callbacks.forEach((function(t){t(e)}))}}]),e}();t.default=i},28909:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortSignal=t.AbortController=void 0;var n=r(82741),a=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r.g)return r.g;throw new Error("unable to locate global object")},i="undefined"===typeof a().AbortController?n.AbortController:a().AbortController;t.AbortController=i;var s="undefined"===typeof a().AbortController?n.AbortSignal:a().AbortSignal;t.AbortSignal=s},89410:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(28313));t.default=a.default},84856:function(){!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,a="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!==typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function v(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function b(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"===typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&a&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=b(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=b(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,r=p(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(x)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=c(e),t=h(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},l.prototype.delete=function(e){delete this.map[c(e)]},l.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},l.prototype.set=function(e,t){this.map[c(e)]=h(t)},l.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},n&&(l.prototype[Symbol.iterator]=l.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function k(e,t){var r=(t=t||{}).body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=function(e){var t=e.toUpperCase();return m.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function x(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(a))}})),t}function g(e){var t=new l;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var a=r.join(":").trim();t.append(n,a)}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},y.call(k.prototype),y.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];w.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(S){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function E(e,r){return new Promise((function(n,i){var s=new k(e,r);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function u(){o.abort()}o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:g(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new w(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},o.open(s.method,s.url,!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),s.headers.forEach((function(e,t){o.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),o.onreadystatechange=function(){4===o.readyState&&s.signal.removeEventListener("abort",u)}),o.send("undefined"===typeof s._bodyInit?null:s._bodyInit)}))}E.polyfill=!0,e.fetch||(e.fetch=E,e.Headers=l,e.Request=k,e.Response=w),t.Headers=l,t.Request=k,t.Response=w,t.fetch=E,Object.defineProperty(t,"__esModule",{value:!0})}({})}("undefined"!==typeof self?self:this)},8365:function(e,t,r){"use strict";function n(e){this.wrapped=e}r.d(t,{Z:function(){return n}})},61418:function(e,t,r){"use strict";function n(e,t){var r={},n=!1;function a(r,a){return n=!0,a=new Promise((function(t){t(e[r](a))})),{done:!1,value:t(a)}}return r["undefined"!==typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},r.next=function(e){return n?(n=!1,e):a("next",e)},"function"===typeof e.throw&&(r.throw=function(e){if(n)throw n=!1,e;return a("throw",e)}),"function"===typeof e.return&&(r.return=function(e){return n?(n=!1,e):a("return",e)}),r}r.d(t,{Z:function(){return n}})},69621:function(e,t,r){"use strict";function n(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new a(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function a(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return a=function(e){this.s=e,this.n=e.next},a.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new a(e)}r.d(t,{Z:function(){return n}})},30249:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(8365);function a(e){return new n.Z(e)}},98288:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(8365);function a(e){var t,r;function a(t,r){try{var s=e[t](r),o=s.value,u=o instanceof n.Z;Promise.resolve(u?o.wrapped:o).then((function(e){u?a("return"===t?"return":"next",e):i(s.done?"return":"normal",e)}),(function(e){a("throw",e)}))}catch(c){i("throw",c)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise((function(i,s){var o={key:e,arg:n,resolve:i,reject:s,next:null};r?r=r.next=o:(t=r=o,a(e,n))}))},"function"!==typeof e.return&&(this.return=void 0)}function i(e){return function(){return new a(e.apply(this,arguments))}}a.prototype["function"===typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)}}}]);
//# sourceMappingURL=7431.eecbf15e.chunk.js.map