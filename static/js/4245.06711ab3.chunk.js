"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4245],{43663:(e,t,a)=>{a.d(t,{Z:()=>w});var r=a(66204),n=a(80846),o=a(88196),s=a(92368),l=a(31211),i=a(25086);function c(e,t){const a=e.get("tags");return a?a[t]:e.get(t)}function u(e,t){const a=e.get("ALT");if(a)return new Map(a?.map((e=>(0,i.I)(e))).filter(l.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var f=a(10574);const[d,,g]=[0,1,2,3],m=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:i,showIntraviewLinks:u}=e,m=(0,s.Z)(),h=(0,l.getSession)(e),p=(0,o.getSnapshot)(e),{assemblyManager:k}=h,v=k.get(i[0].assemblyNames[0]);(0,f.Go)(p);const w=e.getTrackFeatures(t),y=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(w)),[w]),S=(0,r.useMemo)((()=>{const a=e.getMatchedFeaturesInLayout(t,y?function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.get("flags"),n=r.id(),o=4&e,s=2&e;if(!a.has(n)&&!s&&!o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(w):function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.id(),n=4&r.get("flags"),o=!!c(r,"SA");if(!a.has(e)&&!n&&o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(w));return y||a.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),a}),[w,t,y,e]),[E,T]=(0,r.useState)();let b=0;if(a.current){const e=a.current.getBoundingClientRect();b=e.top}return v?r.createElement("g",{stroke:m.palette.text.disabled,fill:"none","data-testid":S.length?`${t}-loaded`:t},S.map((e=>{const a=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:l,level:c}=e[o],{layout:m,feature:p,level:k}=e[o+1];if(!s||!m)return console.warn("received null layout for a overlay feature"),null;if(!u&&c===k)return null;const S=v.getCanonicalRefName(l.get("refName")),N=v.getCanonicalRefName(p.get("refName"));if(!S||!N)throw new Error(`unable to find ref for ${S||N}`);const M=l.get("strand"),O=p.get("strand"),x=s[-1===M?d:g],L=-1===O,R=y?m[L?d:g]:m[L?g:d],$=(0,f.mu)(i[c],S,x),I=(0,f.mu)(i[k],N,R),W=i[c].pxToBp($).reversed,C=i[k].pxToBp(I).reversed,F=i.map((e=>e.getTrack(t))),B=(0,f.cO)(t,c,i,F,s,n)-b,P=(0,f.cO)(t,k,i,F,m,n)-b,A=["M",$,B,"C",$+200*l.get("strand")*(W?-1:1),B,I-200*p.get("strand")*(C?-1:1)*(y?-1:1),P,I,P].join(" "),J=`${l.id()}-${p.id()}`;a.push(r.createElement("path",{d:A,key:J,"data-testid":"r1",strokeWidth:E===J?5:1,onClick:()=>{const e=h.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(w.get(l.id())||{toJSON:()=>{}}).toJSON(),feature2:(w.get(p.id())||{toJSON:()=>{}}).toJSON()}});h.showWidget?.(e)},onMouseOver:()=>T(J),onMouseOut:()=>T(void 0)}))}return a}))):null})),[h]=[0,1,2,3],p=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,c=(0,l.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,a=new Set;for(const r of e.values()){if(!a.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const a=`${r.get("refName")}:${r.get("start")+1}`,n=(0,i.I)(e);if(n){const e=t.get(a);e?e.push(r):t.set(n.MatePosition||"none",[r])}}))}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(g))),[g,t,e]),[p,k]=(0,r.useState)(),v=(0,o.getSnapshot)(e);(0,f.Go)(v);const w=d.get(s[0].assemblyNames[0]);if(!w)return null;let y=0;if(a.current){const e=a.current.getBoundingClientRect();y=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const a=[];for(let o=0;o<e.length-1;o+=1){const{layout:l,feature:i,level:d}=e[o],{layout:m,feature:v,level:S}=e[o+1],E=i.id(),T=u(i,v);if(!l||!m)return null;const b=i.get("refName"),N=v.get("refName"),M=w.getCanonicalRefName(b),O=w.getCanonicalRefName(N);if(!M||!O)throw new Error(`unable to find ref for ${M||O}`);const x=(0,f.mu)(s[d],M,l[h]),L=(0,f.mu)(s[S],O,m[h]),R=s[d].pxToBp(x).reversed,$=s[S].pxToBp(L).reversed,I=s.map((e=>e.getTrack(t))),W=(0,f.cO)(t,d,s,I,l,n)-y,C=(0,f.cO)(t,S,s,I,m,n)-y;if(T){const e=["M",x-20*("left"===T.Join?-1:1)*(R?-1:1),W,"L",x,W,"L",L,C,"L",L-20*("left"===T.MateDirection?1:-1)*($?-1:1),C].join(" ");a.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:E===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:g.get(E)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>k(E),onMouseOut:()=>k(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return a})))})),[k]=[0,1,2,3],v=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,i=(0,l.getSession)(e),{assemblyManager:c}=i,u=e.getTrackFeatures(t),d=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],a=new Set;for(const r of e.values())a.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),a.add(r.id());return t}(u))),[u,t,e]),[g,m]=(0,r.useState)(),h=(0,o.getSnapshot)(e);if((0,f.Go)(h),!c.get(s[0].assemblyNames[0]))return null;let p=0;if(a.current){const e=a.current.getBoundingClientRect();p=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":d.length?`${t}-loaded`:t},d.map((e=>{const a=[];for(const{layout:o,feature:l,level:c}of e){const e=0===c?1:0,d=l.id();if(!o)return null;const h=l.get("INFO"),v=h.CHR2[0],w=h.END[0],[y,S]=h.STRANDS[0].split(""),E=(0,f.mu)(s[e],v,w);if(E){const h=[E,0,E+1,0],v=(0,f.mu)(s[c],l.get("refName"),o[k]),w=E,T=s[c].pxToBp(v).reversed,b=s[e].pxToBp(w).reversed,N=s.map((e=>e.getTrack(t))),M=(0,f.cO)(t,c,s,N,o,n)-p,O=(0,f.cO)(t,e,s,N,h,n)-p,x=["M",v-20*("+"===y?1:-1)*(T?-1:1),M,"L",v,M,"L",w,O,"L",w-20*("+"===S?1:-1)*(b?-1:1),O].join(" ");a.push(r.createElement("path",{d:x,key:JSON.stringify(x),strokeWidth:d===g?10:5,onClick:()=>{const e=i.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(d)||{toJSON:()=>{}}).toJSON()});i.showWidget?.(e)},onMouseOver:()=>m(d),onMouseOut:()=>m(void 0)}))}}return a})))})),w=(0,n.observer)((function(e){const{model:t,trackId:a}=e,n=t.getMatchedTracks(a);return"AlignmentsTrack"===n[0]?.type?r.createElement(m,e):"VariantTrack"===n[0]?.type?t.hasTranslocations(a)?r.createElement(v,e):r.createElement(p,e):null}))},64245:(e,t,a)=>{a.d(t,{renderToSvg:()=>h});var r=a(66204),n=a(99247),o=a(31211),s=a(34599),l=a(43902),i=a(88196),c=a(78432),u=a(92368);function f({width:e,height:t,shift:a}){const n=(0,u.Z)();return r.createElement("rect",{width:e+2*a,height:t,fill:(0,o.stripAlpha)(n.palette.background.default)})}var d=a(43663),g=a(5930);function m(e,t,a=0){const r={};let n=t;for(const o of e.tracks)r[o.configuration.trackId]=n+a,n+=o.displays[0].height+t;return r}async function h(e,t){const{textHeight:a=18,headerHeight:u=30,rulerHeight:h=30,fontSize:p=13,trackLabels:k="offset",Wrapper:v=(({children:e})=>r.createElement(r.Fragment,null,e)),themeName:w="default"}=t,{createRootFn:y}=(0,i.getRoot)(e),S=(0,o.getSession)(e),E=S.allThemes?.()[w],{width:T,views:b}=e,N=u+h,M=b.map((e=>(0,c.hY)(e.tracks,a,k)+N)),O=(0,o.sum)(M)+100,x=await Promise.all(b.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,n.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:E})}})))})))),L=function(e,t,a){return(0,o.max)(e.flatMap((e=>e.tracks.map((e=>(0,o.measureText)((0,g.getTrackName)(e.configuration,a),t))))),0)}(b,p,S)+40,R="left"===k?L:0,$="offset"===k?a:0,I=[m(b[0],$,p+N),m(b[1],$,p+M[0]+N)],W=T+R,C=(0,l.createJBrowseTheme)(E);return(0,o.renderToStaticMarkup)(r.createElement(s.Z,{theme:C},r.createElement(v,null,r.createElement("svg",{width:T,height:O,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,W+100,O].toString()},r.createElement(f,{width:W,height:O,shift:50}),r.createElement("g",{transform:`translate(50 ${p})`},r.createElement("g",{transform:`translate(${R})`},r.createElement("text",{x:0,fontSize:p,fill:C.palette.text.primary},b[0].assemblyNames.join(", ")),r.createElement(c.Uc,{model:x[0].view,fontSize:p})),r.createElement(c.Ge,{textHeight:a,trackLabels:k,fontSize:p,model:x[0].view,displayResults:x[0].data,offset:N,trackLabelOffset:R})),r.createElement("g",{transform:`translate(50 ${p+M[0]})`},r.createElement("g",{transform:`translate(${R})`},r.createElement("text",{x:0,fontSize:p,fill:C.palette.text.primary},b[1].assemblyNames.join(", ")),r.createElement(c.Uc,{model:x[1].view,fontSize:p})),r.createElement(c.Ge,{textHeight:a,trackLabels:k,fontSize:p,model:x[1].view,displayResults:x[1].data,offset:N,trackLabelOffset:R})),r.createElement("defs",null,r.createElement("clipPath",{id:"clip-bsv"},r.createElement("rect",{x:0,y:0,width:T,height:O}))),r.createElement("g",{transform:`translate(${R+50})`,clipPath:"url(#clip-bsv)"},e.matchedTracks.map((t=>r.createElement(d.Z,{parentRef:{current:null},key:t.configuration.trackId,model:e,trackId:t.configuration.trackId,getTrackYPosOverride:(e,t)=>I[t][e]}))))))),y)}}}]);
//# sourceMappingURL=4245.06711ab3.chunk.js.map