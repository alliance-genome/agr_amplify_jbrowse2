{"version":3,"file":"static/js/2796.1092ab6a.chunk.js","mappings":"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","sources":["../../../packages/core/util/QuickLRU.js","../../../plugins/sequence/src/BgzipFastaAdapter/BgzipFastaAdapter.ts","../../../plugins/sequence/src/IndexedFastaAdapter/IndexedFastaAdapter.ts"],"sourcesContent":["/* eslint-disable no-underscore-dangle */\n/**\n * Heavily based on [quick-lru](https://www.npmjs.com/package/quick-lru)\n * (quick-lru didn't work for us because the export wouldn't compile in Webpack\n * properly)\n */\nclass QuickLRU {\n  constructor(options = {}) {\n    if (!(options.maxSize && options.maxSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    this.maxSize = options.maxSize\n    this.cache = new Map()\n    this.oldCache = new Map()\n    this._size = 0\n  }\n\n  _set(key, value) {\n    this.cache.set(key, value)\n    this._size += 1\n\n    if (this._size >= this.maxSize) {\n      this._size = 0\n      this.oldCache = this.cache\n      this.cache = new Map()\n    }\n  }\n\n  get(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      const value = this.oldCache.get(key)\n      this.oldCache.delete(key)\n      this._set(key, value)\n      return value\n    }\n\n    return undefined\n  }\n\n  set(key, value) {\n    if (this.cache.has(key)) {\n      this.cache.set(key, value)\n    } else {\n      this._set(key, value)\n    }\n\n    return this\n  }\n\n  has(key) {\n    return this.cache.has(key) || this.oldCache.has(key)\n  }\n\n  peek(key) {\n    if (this.cache.has(key)) {\n      return this.cache.get(key)\n    }\n\n    if (this.oldCache.has(key)) {\n      return this.oldCache.get(key)\n    }\n\n    return undefined\n  }\n\n  delete(key) {\n    const deleted = this.cache.delete(key)\n    if (deleted) {\n      this._size -= 1\n    }\n\n    return this.oldCache.delete(key) || deleted\n  }\n\n  clear() {\n    this.cache.clear()\n    this.oldCache.clear()\n    this._size = 0\n  }\n\n  *keys() {\n    for (const [key] of this) {\n      yield key\n    }\n  }\n\n  *values() {\n    for (const [, value] of this) {\n      yield value\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this.cache) {\n      yield item\n    }\n\n    for (const item of this.oldCache) {\n      const [key] = item\n      if (!this.cache.has(key)) {\n        yield item\n      }\n    }\n  }\n\n  get size() {\n    let oldCacheSize = 0\n    for (const key of this.oldCache.keys()) {\n      if (!this.cache.has(key)) {\n        oldCacheSize += 1\n      }\n    }\n\n    return this._size + oldCacheSize\n  }\n}\n\nexport default QuickLRU\n","import { BgzipIndexedFasta } from '@gmod/indexedfasta'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport IndexedFasta from '../IndexedFastaAdapter/IndexedFastaAdapter'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nexport default class extends IndexedFasta {\n  public constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const fastaLocation = readConfObject(config, 'fastaLocation')\n    const faiLocation = readConfObject(config, 'faiLocation')\n    const gziLocation = readConfObject(config, 'gziLocation')\n    if (!fastaLocation) {\n      throw new Error('must provide fastaLocation')\n    }\n    if (!faiLocation) {\n      throw new Error('must provide faiLocation')\n    }\n    if (!gziLocation) {\n      throw new Error('must provide gziLocation')\n    }\n    const fastaOpts = {\n      fasta: openLocation(fastaLocation as FileLocation, this.pluginManager),\n      fai: openLocation(faiLocation as FileLocation, this.pluginManager),\n      gzi: openLocation(gziLocation as FileLocation, this.pluginManager),\n    }\n\n    this.fasta = new BgzipIndexedFasta(fastaOpts)\n  }\n}\n","import { IndexedFasta } from '@gmod/indexedfasta'\nimport {\n  BaseSequenceAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { FileLocation, NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport AbortablePromiseCache from 'abortable-promise-cache'\nimport LRU from '@jbrowse/core/util/QuickLRU'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nexport default class extends BaseSequenceAdapter {\n  protected fasta: IndexedFasta\n\n  private seqCache = new AbortablePromiseCache({\n    cache: new LRU({ maxSize: 200 }),\n    fill: async (\n      args: { refName: string; start: number; end: number },\n      signal?: AbortSignal,\n    ) => {\n      const { refName, start, end } = args\n      return this.fasta.getSequence(refName, start, end, { ...args, signal })\n    },\n  })\n\n  public constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const fastaLocation = readConfObject(config, 'fastaLocation')\n    const faiLocation = readConfObject(config, 'faiLocation')\n    const fastaOpts = {\n      fasta: openLocation(fastaLocation as FileLocation, this.pluginManager),\n      fai: openLocation(faiLocation as FileLocation, this.pluginManager),\n    }\n\n    this.fasta = new IndexedFasta(fastaOpts)\n  }\n\n  public getRefNames(opts?: BaseOptions) {\n    return this.fasta.getSequenceNames(opts)\n  }\n\n  public async getRegions(opts?: BaseOptions) {\n    const seqSizes = await this.fasta.getSequenceSizes(opts)\n    return Object.keys(seqSizes).map(refName => ({\n      refName,\n      start: 0,\n      end: seqSizes[refName],\n    }))\n  }\n\n  public getFeatures(region: NoAssemblyRegion, opts?: BaseOptions) {\n    const { refName, start, end } = region\n    return ObservableCreate<Feature>(async observer => {\n      const size = await this.fasta.getSequenceSize(refName, opts)\n      const regionEnd = size !== undefined ? Math.min(size, end) : end\n      const chunks = []\n      const chunkSize = 128000\n\n      const s = start - (start % chunkSize)\n      const e = end + (chunkSize - (end % chunkSize))\n      for (let chunkStart = s; chunkStart < e; chunkStart += chunkSize) {\n        const r = {\n          refName,\n          start: chunkStart,\n          end: chunkStart + chunkSize,\n        }\n        chunks.push(this.seqCache.get(JSON.stringify(r), r, opts?.signal))\n      }\n      const seq = (await Promise.all(chunks))\n        .join('')\n        .slice(start - s)\n        .slice(0, end - start)\n      if (seq) {\n        observer.next(\n          new SimpleFeature({\n            id: `${refName} ${start}-${regionEnd}`,\n            data: { refName, start, end: regionEnd, seq },\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */): void {}\n}\n"],"names":["QuickLRU","options","maxSize","TypeError","this","cache","Map","oldCache","_size","key","value","set","has","get","delete","_set","deleted","clear","item","oldCacheSize","keys","Symbol","iterator","config","getSubAdapter","pluginManager","fastaLocation","readConfObject","faiLocation","gziLocation","Error","fastaOpts","fasta","openLocation","fai","gzi","BgzipIndexedFasta","IndexedFasta","seqCache","AbortablePromiseCache","LRU","fill","args","signal","refName","start","end","getSequence","opts","getSequenceNames","getSequenceSizes","seqSizes","Object","map","region","ObservableCreate","observer","getSequenceSize","size","regionEnd","undefined","Math","min","chunks","e","chunkSize","chunkStart","s","r","push","JSON","stringify","Promise","all","seq","join","slice","next","SimpleFeature","id","data","complete","BaseSequenceAdapter"],"sourceRoot":""}