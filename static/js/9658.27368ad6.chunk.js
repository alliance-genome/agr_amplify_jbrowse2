"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9658],{73187:(e,t,a)=>{a.d(t,{xx:()=>n,C4:()=>d,Ww:()=>m,OX:()=>h});var i=a(99546);function r({feature:e,ctx:t,offsets:a,cb:r,height:n,drawCurves:s,oobLimit:l,viewWidth:f,hideTiny:c}){const{p11:h,p12:m,p21:d,p22:g}=e,w=h.offsetPx-a[0],p=m.offsetPx-a[0],b=d.offsetPx-a[1],u=g.offsetPx-a[1],v=Math.abs(p-w),x=Math.abs(u-b),y=n,M=(y-0)/2,P=Math.min(b,u),k=Math.max(b,u);(0,i.doesIntersect2)(P,k,-l,f+l)&&(v<=1&&x<=1?c||(t.beginPath(),t.moveTo(w,0),s?t.bezierCurveTo(w,M,b,M,b,y):t.lineTo(b,y),t.stroke()):(o(t,w,p,0,u,b,y,M,s),r(t)))}function o(e,t,a,i,r,o,n,s,l){l?function(e,t,a,i,r,o,n,s){const l=Math.abs(t-a),f=Math.abs(t-a);if(l<5&&f<5&&a<t&&Math.abs(t-r)>100){const e=t;t=a,a=e}e.beginPath(),e.moveTo(t,i),e.lineTo(a,i),e.bezierCurveTo(a,s,r,s,r,n),e.lineTo(o,n),e.bezierCurveTo(o,s,t,s,t,i),e.closePath(),e.fill()}(e,t,a,i,r,o,n,s):function(e,t,a,i,r,o,n){e.beginPath(),e.moveTo(t,i),e.lineTo(a,i),e.lineTo(r,n),e.lineTo(o,n),e.closePath(),e.fill()}(e,t,a,i,r,o,n)}const n=16581375;function s(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const l={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},f=3,c=1600;function h(e,t,a,i){return Math.floor((255*e*255+255*t+a-1)/i)}function m(e,t,a){const h=(0,i.getContainingView)(e),m=h.drawCurves,d=h.drawCIGAR,g=h.middleComparativeHeight,w=h.width,p=h.views.map((e=>e.bpPerPx));a&&(a.imageSmoothingEnabled=!1),t.beginPath();const b=e.featPositions,u=h.views.map((e=>e.offsetPx)),v=Math.floor(n/b.length);t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:a,p21:i,p22:r}of b){const o=e.offsetPx-u[0],n=a.offsetPx-u[0],s=i.offsetPx-u[1],l=r.offsetPx-u[1],h=Math.abs(n-o),d=Math.abs(l-s),p=0,b=g,v=(b-p)/2;h<=f&&d<=f&&s<w+c&&s>-c&&(t.moveTo(o,p),m?t.bezierCurveTo(o,v,s,v,s,b):t.lineTo(s,b))}t.stroke(),t.fillStyle=l.M,t.strokeStyle=l.M;for(const{p11:e,p12:r,p21:v,p22:x,f:y,cigar:M}of b){const b=e.offsetPx-u[0],P=r.offsetPx-u[0],k=v.offsetPx-u[1],T=x.offsetPx-u[1],S=Math.abs(P-b),C=Math.abs(T-k),E=Math.min(k,T),z=Math.max(k,T),$=0,R=g,L=(R-$)/2;if(!(S<=f&&C<=f)&&(0,i.doesIntersect2)(E,z,-c,h.width+c)){const e=y.get("strand"),i=-1===e?P:b,r=i<(-1===e?b:P)?1:-1,f=(k<T?1:-1)*e;let c=i,h=-1===e?T:k;if(M?.length&&d){let e=!1,i=0,d=0;const g=Math.floor(n/M.length);for(let n=0;n<M.length;n+=2){const b=n*g+1,u=+M[n],v=M[n+1];e||(i=c,d=h);const x=u/p[0],y=u/p[1];if("M"===v||"="===v||"X"===v?(c+=x*r,h+=y*f):"D"===v||"N"===v?c+=x*r:"I"===v&&(h+=y*f),!(Math.max(i,d,c,h)<0||Math.min(i,d,c,h)>w)){const r=n<M.length-2;Math.abs(c-i)<=1&&Math.abs(h-d)<=1&&r?e=!0:(e=!1,t.fillStyle=l[e&&x>1||y>1?v:"M"],o(t,i,c,$,h,d,R,L,m),a&&(a.fillStyle=s(b),o(a,i,c,$,h,d,R,L,m)))}}}else o(t,b,P,$,T,k,R,L,m)}}const x=e.clickMapCanvas?.getContext("2d");if(x){x.imageSmoothingEnabled=!1,x.clearRect(0,0,w,g);for(let e=0;e<b.length;e++){const t=b[e],a=e*v+1;x.fillStyle=s(a),r({cb:e=>e.fill(),feature:t,ctx:x,drawCurves:m,offsets:u,oobLimit:c,viewWidth:h.width,hideTiny:!0,height:g})}}}function d(e){const{clickId:t,mouseoverId:a}=e,o=(0,i.getContainingView)(e),n=o.drawCurves,s=o.middleComparativeHeight,l=o.width,f=e.mouseoverCanvas?.getContext("2d"),h=o.views.map((e=>e.offsetPx));if(!f)return;f.resetTransform(),f.scale(1,1),f.clearRect(0,0,l,s);const m=e.featMap[a||""];m&&(f.fillStyle="rgb(0,0,0,0.1)",r({cb:e=>e.fill(),feature:m,ctx:f,oobLimit:c,viewWidth:o.width,drawCurves:n,offsets:h,height:s}));const d=e.featMap[t||""];d&&(f.strokeStyle="rgb(0, 0, 0, 0.9)",r({cb:e=>e.stroke(),feature:d,ctx:f,oobLimit:c,viewWidth:o.width,drawCurves:n,offsets:h,height:s}))}},69658:(e,t,a)=>{a.d(t,{renderToSvg:()=>w});var i=a(7552),r=a(48407),o=a(36422),n=a(42489),s=a(99546),l=a(91468),f=a(49823),c=a(68666),h=a(48231);function m({width:e,height:t,shift:a}){const r=(0,h.A)();return i.createElement("rect",{width:e+2*a,height:t,fill:(0,s.stripAlpha)(r.palette.background.default)})}var d=a(73187);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},g.apply(this,arguments)}async function w(e,t){await(0,n.when)((()=>e.initialized));const{textHeight:a=18,headerHeight:h=30,rulerHeight:w=30,fontSize:p=13,trackLabels:b="offset",Wrapper:u=(({children:e})=>e),themeName:v="default"}=t,x=(0,s.getSession)(e),y=x.allThemes?.()[v],{width:M,views:P,middleComparativeHeight:k,tracks:T}=e,S=h+w,{createRootFn:C}=(0,o.getRoot)(e),E=P.map((e=>(0,c.mJ)(e.tracks,a,b)+S)),z=(0,s.sum)(E)+k+100,$=await Promise.all(P.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,n.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:y})}})))})))),R=await Promise.all(T.map((async e=>{const a=e.displays[0];await(0,n.when)((()=>void 0===a.ready||a.ready));const i=await(0,s.renderToAbstractCanvas)(M,k,{exportSVG:t},(e=>(0,d.Ww)(a,e)));if("imageData"in i)throw new Error("found a canvas in svg export, probably a bug");return"canvasRecordedData"in i?{html:await(0,s.getSerializedSvg)({...i,width:M,height:k})}:i}))),L=(0,s.max)(P.flatMap((e=>e.tracks.map((e=>(0,s.measureText)((0,l.getTrackName)(e.configuration,x),p))))),0)+40,H="left"===b?L:0,j=M+H,I=(0,f.createJBrowseTheme)(y);return(0,s.renderToStaticMarkup)(i.createElement(r.A,{theme:I},i.createElement(u,null,i.createElement("svg",{width:M,height:z,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,j+100,z].toString()},i.createElement(m,{width:j,height:z,shift:50}),i.createElement("g",{transform:`translate(50 ${p})`},i.createElement("g",{transform:`translate(${H})`},i.createElement("text",g({x:0,fontSize:p},(0,s.getFillProps)(I.palette.text.primary)),P[0].assemblyNames.join(", ")),i.createElement(c.$m,{model:$[0].view,fontSize:p})),i.createElement(c.zh,{textHeight:a,trackLabels:b,fontSize:p,model:$[0].view,displayResults:$[0].data,offset:S,trackLabelOffset:H})),i.createElement("defs",null,i.createElement("clipPath",{id:"synclip"},i.createElement("rect",{x:0,y:0,width:M,height:k}))),i.createElement("g",{transform:`translate(${50+H} ${p+E[0]})`,clipPath:"url(#synclip)"},R.map(((e,t)=>i.createElement(s.ReactRendering,{key:t,rendering:e})))),i.createElement("g",{transform:`translate(50 ${p+E[0]+k})`},i.createElement("g",{transform:`translate(${H})`},i.createElement("text",g({x:0,fontSize:p},(0,s.getFillProps)(I.palette.text.primary)),P[1].assemblyNames.join(", ")),i.createElement(c.$m,{model:$[1].view,fontSize:p})),i.createElement(c.zh,{textHeight:a,trackLabels:b,fontSize:p,model:$[1].view,displayResults:$[1].data,offset:S,trackLabelOffset:H}))))),C)}}}]);
//# sourceMappingURL=9658.27368ad6.chunk.js.map