"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6809],{56809:function(e,t,r){r.r(t),r.d(t,{default:function(){return g}});var n=r(32723),a=r(34795),u=r(9249),s=r(87371),i=r(45754),c=r(13820),o=r(40730),l=r(82972),f=r(32145),h=r(93824),p=r(95950),d=r(68538),v=r(16959);function m(e){return 31===e[0]&&139===e[1]&&8===e[2]}var g=function(e){(0,i.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;(0,u.Z)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).bedFeatures=void 0,e.intervalTrees={},e}return(0,s.Z)(r,[{key:"loadDataP",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,u,s,i,c,l,h,p,d,g,b,k,y,w,Z,x,S,C,T,_=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=_.length>0&&void 0!==_[0]?_[0]:{},r=this.pluginManager,a=this.getConf("bedLocation"),e.next=5,(0,f.openLocation)(a,r).readFile(t);case 5:if(!m(u=e.sent)){e.next=12;break}return e.next=9,(0,v.unzip)(u);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=u;case 13:if(!((s=e.t0).length>536870888)){e.next=16;break}throw new Error("Data exceeds maximum string length (512MB)");case 16:for(i=new TextDecoder("utf8",{fatal:!0}).decode(s),c=i.split(/\n|\r\n|\r/).filter((function(e){return!!e})),l=[],h=0;h<c.length&&c[h].startsWith("#");h++)l.push(c[h]);for(p=l.join("\n"),d={};h<c.length;h++)g=c[h],b=g.indexOf("\t"),k=g.slice(0,b),d[k]||(d[k]=[]),d[k].push(g);return y=this.getConf("autoSql"),w=new o.Z({autoSql:y}),Z=this.getConf("columnNames"),x=this.getConf("scoreColumn"),S=this.getConf("colRef"),C=this.getConf("colStart"),T=this.getConf("colEnd"),e.abrupt("return",{header:p,features:d,parser:w,columnNames:Z,scoreColumn:x,colRef:S,colStart:C,colEnd:T});case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r=this,a=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},this.bedFeatures||(this.bedFeatures=this.loadDataP(t).catch((function(e){throw r.bedFeatures=void 0,e}))),e.abrupt("return",this.bedFeatures);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,u=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},e.next=3,this.loadData(t);case 3:return r=e.sent,a=r.features,e.abrupt("return",Object.keys(a));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,u=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},e.next=3,this.loadData(t);case 3:return r=e.sent,a=r.header,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNames",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,a,u,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:if(t=e.sent,r=t.header,!(a=t.columnNames).length){e.next=7;break}return e.abrupt("return",a);case 7:return u=r.split(/\n|\r\n|\r/).filter((function(e){return!!e})),s=u[u.length-1],e.abrupt("return",null!==s&&void 0!==s&&s.includes("\t")?s.slice(1).split("\t").map((function(e){return e.trim()})):void 0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadFeatureIntervalTreeHelper",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,u,s,i,c,o,l,f,h,v,m,g,b=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:if(r=e.sent,a=r.colRef,u=r.colStart,s=r.colEnd,i=r.features,c=r.parser,o=r.scoreColumn,l=i[t]){e.next=12;break}return e.abrupt("return",void 0);case 12:return e.next=14,this.getNames();case 14:for(f=e.sent,h=new d.ZP,v=l.map((function(e,r){var n="".concat(b.id,"-").concat(t,"-").concat(r);return(0,p.P)(e,a,u,s,o,c,n,f)})),m=0;m<v.length;m++)g=v[m],h.insert([g.get("start"),g.get("end")],g);return e.abrupt("return",h);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFeatureIntervalTree",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch((function(e){throw r.intervalTrees[t]=void 0,e}))),e.abrupt("return",this.intervalTrees[t]);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,h.ObservableCreate)(function(){var r=(0,a.Z)((0,n.Z)().mark((function r(a){var u,s,i,c;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=e.start,s=e.end,i=e.refName,r.next=3,t.loadFeatureIntervalTree(i);case 3:null===(c=r.sent)||void 0===c||c.search([u,s]).forEach((function(e){return a.next(e)})),a.complete();case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),r.signal)}},{key:"freeResources",value:function(){}}]),r}(l.BaseFeatureDataAdapter);g.capabilities=["getFeatures","getRefNames"]},95950:function(e,t,r){r.d(t,{P:function(){return s},d:function(){return u}});var n=r(33028),a=r(42054);function u(e){var t=e.children(),r=e.get("thickStart"),n=e.get("thickEnd");if(!r&&!n)return e;var u=t?t.filter((function(e){return"block"===e.get("type")})).sort((function(e,t){return e.get("start")-t.get("start")})):[],s=[];u.forEach((function(t){var a=t.get("start"),u=t.get("end");if(r>=u){var i=e.get("strand")>0?"five":"three";s.push({type:"".concat(i,"_prime_UTR"),start:a,end:u})}else if(r>a&&r<u&&n>=u){var c=e.get("strand")>0?"five":"three";s.push({type:"".concat(c,"_prime_UTR"),start:a,end:r},{type:"CDS",start:r,end:u})}else if(r<=a&&n>=u)s.push({type:"CDS",start:a,end:u});else if(r>a&&r<u&&n<u){var o=e.get("strand")>0?"five":"three",l=e.get("strand")>0?"three":"five";s.push({type:"".concat(o,"_prime_UTR"),start:a,end:r},{type:"CDS",start:r,end:n},{type:"".concat(l,"_prime_UTR"),start:n,end:u})}else if(r<=a&&n>a&&n<u){var f=e.get("strand")>0?"three":"five";s.push({type:"CDS",start:a,end:n},{type:"".concat(f,"_prime_UTR"),start:n,end:u})}else if(n<=a){var h=e.get("strand")>0?"three":"five";s.push({type:"".concat(h,"_prime_UTR"),start:a,end:u})}}));var i=Object.fromEntries(e.tags().map((function(t){return[t,e.get(t)]})));return i.subfeatures=s,i.type="mRNA",i.uniqueId=e.id(),delete i.chromStarts,delete i.chromStart,delete i.chromEnd,delete i.chrom,delete i.blockStarts,delete i.blockSizes,delete i.blockCount,delete i.thickStart,delete i.thickEnd,new a.SimpleFeature({data:i,id:e.id()})}function s(e,t,r,s,i,c,o,l){var f=e.split("\t"),h=f[t],p=+f[r],d=r===s?1:0,v=+f[s]+d,m=l?function(e,t){return Object.fromEntries(t.split("\t").map((function(t,r){return[e[r],t]})))}(l,e):c.parseLine(e,{uniqueId:o}),g=m.blockCount,b=m.blockSizes,k=m.blockStarts,y=m.chromStarts;if(g){var w=y||k||[],Z=b,x=p;m.subfeatures=[];for(var S=0;S<g;S+=1){var C=(w[S]||0)+x,T=C+(Z[S]||0);m.subfeatures.push({uniqueId:"".concat(o,"-").concat(S),start:C,end:T,type:"block"})}}i&&(m.score=+m[i]),delete m.chrom,delete m.chromStart,delete m.chromEnd;var _=new a.SimpleFeature((0,n.Z)((0,n.Z)({},m),{},{start:p,end:v,refName:h,uniqueId:o}));return _.get("thickStart")?u(_):_}}}]);
//# sourceMappingURL=6809.538bdd2d.chunk.js.map