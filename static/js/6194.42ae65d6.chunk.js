"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[6194],{25866:(e,t,a)=>{a.d(t,{Z:()=>w});var r=a(66204),n=a(80846),o=a(88196),s=a(92368),l=a(90872),i=a(25086);function c(e,t){const a=e.get("tags");return a?a[t]:e.get(t)}function u(e,t){const a=e.get("ALT");if(a)return new Map(a?.map((e=>(0,i.I)(e))).filter(l.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var f=a(71416);const[d,,g]=[0,1,2,3],m=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:i,showIntraviewLinks:u}=e,m=(0,s.Z)(),h=(0,l.getSession)(e),p=(0,o.getSnapshot)(e),{assemblyManager:v}=h,k=v.get(i[0].assemblyNames[0]);(0,f.Go)(p);const w=e.getTrackFeatures(t),y=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(w)),[w]),S=(0,r.useMemo)((()=>{const a=e.getMatchedFeaturesInLayout(t,y?function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.get("flags"),n=r.id(),o=4&e,s=2&e;if(!a.has(n)&&!s&&!o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(w):function(e){const t=new Map,a=new Set;for(const r of e.values()){const e=r.id(),n=4&r.get("flags"),o=!!c(r,"SA");if(!a.has(e)&&!n&&o){const e=r.get("name");let a=t.get(e);a||(a=[],t.set(e,a)),a.push(r)}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(w));return y||a.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),a}),[w,t,y,e]),[E,T]=(0,r.useState)();let b=0;if(a.current){const e=a.current.getBoundingClientRect();b=e.top}return k?r.createElement("g",{stroke:m.palette.text.disabled,fill:"none","data-testid":S.length?`${t}-loaded`:t},S.map((e=>{const a=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:l,level:c}=e[o],{layout:m,feature:p,level:v}=e[o+1];if(!s||!m)return console.warn("received null layout for a overlay feature"),null;if(!u&&c===v)return null;const S=k.getCanonicalRefName(l.get("refName")),N=k.getCanonicalRefName(p.get("refName"));if(!S||!N)throw new Error(`unable to find ref for ${S||N}`);const M=l.get("strand"),O=p.get("strand"),x=s[-1===M?d:g],L=-1===O,R=y?m[L?d:g]:m[L?g:d],$=(0,f.mu)(i[c],S,x),I=(0,f.mu)(i[v],N,R),W=i[c].pxToBp($).reversed,C=i[v].pxToBp(I).reversed,B=i.map((e=>e.getTrack(t))),F=(0,f.cO)(t,c,i,B,s,n)-b,P=(0,f.cO)(t,v,i,B,m,n)-b,A=["M",$,F,"C",$+200*l.get("strand")*(W?-1:1),F,I-200*p.get("strand")*(C?-1:1)*(y?-1:1),P,I,P].join(" "),J=`${l.id()}-${p.id()}`;a.push(r.createElement("path",{d:A,key:J,"data-testid":"r1",strokeWidth:E===J?5:1,onClick:()=>{const e=h.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(w.get(l.id())||{toJSON:()=>{}}).toJSON(),feature2:(w.get(p.id())||{toJSON:()=>{}}).toJSON()}});h.showWidget?.(e)},onMouseOver:()=>T(J),onMouseOut:()=>T(void 0)}))}return a}))):null})),[h]=[0,1,2,3],p=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,c=(0,l.getSession)(e),{assemblyManager:d}=c,g=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,a=new Set;for(const r of e.values()){if(!a.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const a=`${r.get("refName")}:${r.get("start")+1}`,n=(0,i.I)(e);if(n){const e=t.get(a);e?e.push(r):t.set(n.MatePosition||"none",[r])}}))}a.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(g))),[g,t,e]),[p,v]=(0,r.useState)(),k=(0,o.getSnapshot)(e);(0,f.Go)(k);const w=d.get(s[0].assemblyNames[0]);if(!w)return null;let y=0;if(a.current){const e=a.current.getBoundingClientRect();y=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const a=[];for(let o=0;o<e.length-1;o+=1){const{layout:l,feature:i,level:d}=e[o],{layout:m,feature:k,level:S}=e[o+1],E=i.id(),T=u(i,k);if(!l||!m)return null;const b=i.get("refName"),N=k.get("refName"),M=w.getCanonicalRefName(b),O=w.getCanonicalRefName(N);if(!M||!O)throw new Error(`unable to find ref for ${M||O}`);const x=(0,f.mu)(s[d],M,l[h]),L=(0,f.mu)(s[S],O,m[h]),R=s[d].pxToBp(x).reversed,$=s[S].pxToBp(L).reversed,I=s.map((e=>e.getTrack(t))),W=(0,f.cO)(t,d,s,I,l,n)-y,C=(0,f.cO)(t,S,s,I,m,n)-y;if(T){const e=["M",x-20*("left"===T.Join?-1:1)*(R?-1:1),W,"L",x,W,"L",L,C,"L",L-20*("left"===T.MateDirection?1:-1)*($?-1:1),C].join(" ");a.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:E===p?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:g.get(E)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>v(E),onMouseOut:()=>v(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return a})))})),[v]=[0,1,2,3],k=(0,n.observer)((function({model:e,trackId:t,parentRef:a,getTrackYPosOverride:n}){const{views:s}=e,i=(0,l.getSession)(e),{assemblyManager:c}=i,u=e.getTrackFeatures(t),d=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],a=new Set;for(const r of e.values())a.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),a.add(r.id());return t}(u))),[u,t,e]),[g,m]=(0,r.useState)(),h=(0,o.getSnapshot)(e);if((0,f.Go)(h),!c.get(s[0].assemblyNames[0]))return null;let p=0;if(a.current){const e=a.current.getBoundingClientRect();p=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":d.length?`${t}-loaded`:t},d.map((e=>{const a=[];for(const{layout:o,feature:l,level:c}of e){const e=0===c?1:0,d=l.id();if(!o)return null;const h=l.get("INFO"),k=h.CHR2[0],w=h.END[0],[y,S]=h.STRANDS[0].split(""),E=(0,f.mu)(s[e],k,w);if(E){const h=[E,0,E+1,0],k=(0,f.mu)(s[c],l.get("refName"),o[v]),w=E,T=s[c].pxToBp(k).reversed,b=s[e].pxToBp(w).reversed,N=s.map((e=>e.getTrack(t))),M=(0,f.cO)(t,c,s,N,o,n)-p,O=(0,f.cO)(t,e,s,N,h,n)-p,x=["M",k-20*("+"===y?1:-1)*(T?-1:1),M,"L",k,M,"L",w,O,"L",w-20*("+"===S?1:-1)*(b?-1:1),O].join(" ");a.push(r.createElement("path",{d:x,key:JSON.stringify(x),strokeWidth:d===g?10:5,onClick:()=>{const e=i.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(d)||{toJSON:()=>{}}).toJSON()});i.showWidget?.(e)},onMouseOver:()=>m(d),onMouseOut:()=>m(void 0)}))}}return a})))})),w=(0,n.observer)((function(e){const{model:t,trackId:a}=e,n=t.getMatchedTracks(a);return"AlignmentsTrack"===n[0]?.type?r.createElement(m,e):"VariantTrack"===n[0]?.type?t.hasTranslocations(a)?r.createElement(k,e):r.createElement(p,e):null}))},76194:(e,t,a)=>{a.d(t,{renderToSvg:()=>h});var r=a(66204),n=a(9721),o=a(99247),s=a(90872),l=a(34599),i=a(35421),c=a(4592),u=a(92368);function f({width:e,height:t,shift:a}){const n=(0,u.Z)();return r.createElement("rect",{width:e+2*a,height:t,fill:(0,s.stripAlpha)(n.palette.background.default)})}var d=a(99512),g=a(25866);function m(e,t,a=0){const r={};let n=t;for(const o of e.tracks)r[o.configuration.trackId]=n+a,n+=o.displays[0].height+t;return r}async function h(e,t){const{textHeight:a=18,headerHeight:u=30,rulerHeight:h=30,fontSize:p=13,trackLabels:v="offset",Wrapper:k=(({children:e})=>r.createElement(r.Fragment,null,e)),themeName:w="default"}=t,y=(0,s.getSession)(e),S=y.allThemes?.()[w],{width:E,views:T}=e,b=u+h,N=T.map((e=>(0,c.hY)(e.tracks,a,v)+b)),M=(0,s.sum)(N)+100,O=await Promise.all(T.map((async e=>({view:e,data:await Promise.all(e.tracks.map((async e=>{const a=e.displays[0];return await(0,o.when)((()=>void 0===a.ready||a.ready)),{track:e,result:await a.renderSvg({...t,theme:S})}})))})))),x=function(e,t,a){return(0,s.max)(e.flatMap((e=>e.tracks.map((e=>(0,s.measureText)((0,d.getTrackName)(e.configuration,a),t))))),0)}(T,p,y)+40,L="left"===v?x:0,R="offset"===v?a:0,$=[m(T[0],R,p+b),m(T[1],R,p+N[0]+b)],I=E+L,W=(0,i.createJBrowseTheme)(S);return(0,n.uS)(r.createElement(l.Z,{theme:W},r.createElement(k,null,r.createElement("svg",{width:E,height:M,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,I+100,M].toString()},r.createElement(f,{width:I,height:M,shift:50}),r.createElement("g",{transform:`translate(50 ${p})`},r.createElement("g",{transform:`translate(${L})`},r.createElement("text",{x:0,fontSize:p,fill:W.palette.text.primary},T[0].assemblyNames.join(", ")),r.createElement(c.Uc,{model:O[0].view,fontSize:p})),r.createElement(c.Ge,{textHeight:a,trackLabels:v,fontSize:p,model:O[0].view,displayResults:O[0].data,offset:b,trackLabelOffset:L})),r.createElement("g",{transform:`translate(50 ${p+N[0]})`},r.createElement("g",{transform:`translate(${L})`},r.createElement("text",{x:0,fontSize:p,fill:W.palette.text.primary},T[1].assemblyNames.join(", ")),r.createElement(c.Uc,{model:O[1].view,fontSize:p})),r.createElement(c.Ge,{textHeight:a,trackLabels:v,fontSize:p,model:O[1].view,displayResults:O[1].data,offset:b,trackLabelOffset:L})),r.createElement("defs",null,r.createElement("clipPath",{id:"clip-bsv"},r.createElement("rect",{x:0,y:0,width:E,height:M}))),r.createElement("g",{transform:`translate(${L+50})`,clipPath:"url(#clip-bsv)"},e.matchedTracks.map((t=>r.createElement(g.Z,{parentRef:{current:null},key:t.configuration.trackId,model:e,trackId:t.configuration.trackId,getTrackYPosOverride:(e,t)=>$[t][e]}))))))))}}}]);
//# sourceMappingURL=6194.42ae65d6.chunk.js.map