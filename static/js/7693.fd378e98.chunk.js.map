{"version":3,"file":"static/js/7693.fd378e98.chunk.js","mappings":"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","sources":["../../../packages/core/BaseFeatureWidget/SequenceFeatureDetails.tsx","../../../packages/core/BaseFeatureWidget/index.ts","../../../packages/core/BaseFeatureWidget/util.tsx","../../../packages/core/rpc/coreRpcMethods.ts","../../../packages/core/data_adapters/CytobandAdapter.ts","../../../packages/core/CorePlugin.ts","../../../packages/core/Plugin.ts","../../../packages/core/ReExports/modules.ts","../../../packages/core/ReExports/list.ts","../../../packages/core/ReExports/index.ts","../../../packages/core/TextSearch/BaseResults.ts","../../../packages/core/configuration/configurationSlot.ts","../../../packages/core/configuration/configurationSchema.ts","../../../packages/core/configuration/util.ts","../../../packages/core/data_adapters/BaseAdapter.ts","../../../packages/core/data_adapters/dataAdapterCache.ts","../../../packages/core/pluggableElementTypes/AdapterType.ts","../../../packages/core/pluggableElementTypes/ConnectionType.ts","../../../packages/core/pluggableElementTypes/DisplayType.ts","../../../packages/core/pluggableElementTypes/InternetAccountType.ts","../../../packages/core/pluggableElementTypes/PluggableElementBase.ts","../../../packages/core/pluggableElementTypes/RpcMethodType.ts","../../../packages/core/pluggableElementTypes/TextSearchAdapterType.ts","../../../packages/core/pluggableElementTypes/TrackType.ts","../../../packages/core/pluggableElementTypes/ViewType.ts","../../../packages/core/pluggableElementTypes/WidgetType.ts","../../../packages/core/pluggableElementTypes/models/BaseViewModel.ts","../../../packages/core/pluggableElementTypes/models/baseConnectionConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseConnectionModelFactory.js","../../../packages/core/pluggableElementTypes/models/BaseDisplayModel.tsx","../../../packages/core/pluggableElementTypes/models/InternetAccountModel.ts","../../../packages/core/pluggableElementTypes/models/baseInternetAccountConfig.ts","../../../packages/core/pluggableElementTypes/models/BaseTrackModel.ts","../../../packages/core/pluggableElementTypes/models/baseTrackConfig.ts","../../../packages/core/pluggableElementTypes/renderers/BoxRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/CircularChordRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/FeatureRendererType.ts","../../../packages/core/pluggableElementTypes/renderers/RendererType.ts","../../../packages/core/pluggableElementTypes/renderers/ServerSideRenderedContent.tsx","../../../packages/core/pluggableElementTypes/renderers/ServerSideRendererType.tsx","../../../packages/core/pluggableElementTypes/renderers/util/serializableFilterChain.ts","../../../packages/core/ui/Drawer.tsx","../../../packages/core/ui/DrawerWidget.tsx","../../../packages/core/ui/DropDownMenu.tsx","../../../packages/core/ui/FatalErrorDialog.tsx","../../../packages/core/ui/FileSelector/LocalFileChooser.tsx","../../../packages/core/ui/FileSelector/UrlChooser.tsx","../../../packages/core/ui/Icons.tsx","../../../packages/core/ui/Snackbar.tsx","../../../packages/core/ui/ViewContainer.tsx","../../../packages/core/util/Base1DViewModel.ts","../../../packages/core/util/blockTypes.ts","../../../packages/core/util/calculateDynamicBlocks.ts","../../../packages/core/util/calculateStaticBlocks.ts","../../../packages/core/util/color/cssColorsLevel4.ts","../../../packages/core/util/color/index.ts","../../../packages/core/util/idMaker.ts","../../../packages/core/util/index.ts","../../../packages/core/util/io/RemoteFileWithRangeCache.ts","../../../packages/core/util/io/index.ts","../../../packages/core/util/jexl.ts","../../../packages/core/util/jexlStrings.ts","../../../packages/core/util/layouts/GranularRectLayout.ts","../../../packages/core/util/layouts/MultiLayout.ts","../../../packages/core/util/layouts/PrecomputedLayout.ts","../../../packages/core/util/layouts/PrecomputedMultiLayout.js","../../../packages/core/util/layouts/SceneGraph.ts","../../../packages/core/util/mst-reflection.js","../../../packages/core/util/range.ts","../../../packages/core/util/rxjs.ts","../../../packages/core/util/simpleFeature.ts","../../../packages/core/util/stats.ts","../../../packages/core/util/tracks.ts","../../../packages/core/util/types/mst.ts","../../../plugins/alignments/src/BamAdapter/MismatchParser.ts","../../../plugins/alignments/src/SNPCoverageAdapter/SNPCoverageAdapter.ts","../../../plugins/alignments/src/CramAdapter/configSchema.ts","../../../plugins/alignments/src/CramAdapter/index.ts","../../../plugins/alignments/src/BamAdapter/configSchema.ts","../../../plugins/alignments/src/BamAdapter/index.ts","../../../plugins/alignments/src/HtsgetBamAdapter/configSchema.ts","../../../plugins/alignments/src/HtsgetBamAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageAdapter/configSchema.ts","../../../plugins/alignments/src/SNPCoverageAdapter/index.ts","../../../plugins/alignments/src/SNPCoverageRenderer/configSchema.js","../../../plugins/alignments/src/SNPCoverageRenderer/SNPCoverageRenderer.ts","../../../plugins/alignments/src/SNPCoverageRenderer/index.ts","../../../plugins/alignments/src/PileupRenderer/PileupLayoutSession.ts","../../../plugins/alignments/src/PileupRenderer/PileupRenderer.tsx","../../../plugins/alignments/src/PileupRenderer/sortUtil.ts","../../../plugins/alignments/src/PileupRenderer/components/PileupRendering.tsx","../../../plugins/alignments/src/PileupRenderer/configSchema.ts","../../../plugins/alignments/src/PileupRenderer/index.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearAlignmentsDisplay/models/model.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/components/AlignmentsDisplay.tsx","../../../plugins/alignments/src/LinearAlignmentsDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/components/Tooltip.tsx","../../../plugins/alignments/src/shared.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/model.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/index.ts","../../../plugins/alignments/src/LinearSNPCoverageDisplay/models/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/configSchema.ts","../../../plugins/alignments/src/LinearPileupDisplay/components/LinearPileupDisplayBlurb.tsx","../../../plugins/alignments/src/LinearPileupDisplay/model.ts","../../../plugins/alignments/src/LinearPileupDisplay/index.ts","../../../plugins/alignments/src/AlignmentsTrack/index.ts","../../../plugins/alignments/src/AlignmentsFeatureDetail/index.ts","../../../plugins/alignments/src/PileupRPC/rpcMethods.ts","../../../plugins/alignments/src/index.ts","../../../plugins/alignments/src/util.ts","../../../plugins/arc/src/LinearArcDisplay/model.tsx","../../../plugins/arc/src/ArcRenderer/ArcRendering.tsx","../../../plugins/arc/src/ArcRenderer/configSchema.tsx","../../../plugins/arc/src/ArcRenderer/ArcRenderer.tsx","../../../plugins/arc/src/index.ts","../../../plugins/arc/src/LinearArcDisplay/configSchema.tsx","../../../plugins/authentication/src/OAuthModel/configSchema.ts","../../../plugins/authentication/src/OAuthModel/model.tsx","../../../plugins/authentication/src/ExternalTokenModel/configSchema.ts","../../../plugins/authentication/src/ExternalTokenModel/ExternalTokenEntryForm.tsx","../../../plugins/authentication/src/ExternalTokenModel/model.tsx","../../../plugins/authentication/src/HTTPBasicModel/configSchema.ts","../../../plugins/authentication/src/HTTPBasicModel/HTTPBasicLoginForm.tsx","../../../plugins/authentication/src/HTTPBasicModel/model.tsx","../../../plugins/authentication/src/DropboxOAuthModel/configSchema.ts","../../../plugins/authentication/src/DropboxOAuthModel/model.tsx","../../../plugins/authentication/src/GoogleDriveOAuthModel/configSchema.ts","../../../plugins/authentication/src/GoogleDriveOAuthModel/model.tsx","../../../plugins/authentication/src/index.ts","../../../plugins/bed/src/BigBedAdapter/configSchema.ts","../../../plugins/bed/src/BedTabixAdapter/configSchema.ts","../../../plugins/bed/src/BedAdapter/configSchema.ts","../../../plugins/bed/src/index.ts","../../../plugins/breakpoint-split-view/src/BreakpointAlignmentsFeatureDetail/index.js","../../../plugins/breakpoint-split-view/src/util.ts","../../../plugins/breakpoint-split-view/src/components/AlignmentConnections.tsx","../../../plugins/breakpoint-split-view/src/components/Breakends.tsx","../../../plugins/breakpoint-split-view/src/components/Header.tsx","../../../plugins/breakpoint-split-view/src/components/Translocations.tsx","../../../plugins/breakpoint-split-view/src/components/BreakpointSplitView.tsx","../../../plugins/breakpoint-split-view/src/model.ts","../../../plugins/breakpoint-split-view/src/BreakpointSplitView.ts","../../../plugins/breakpoint-split-view/src/index.ts","../../../plugins/circular-view/src/CircularView/models/viewportVisibleRegion.ts","../../../plugins/circular-view/src/CircularView/models/slices.ts","../../../plugins/circular-view/src/CircularView/models/CircularView.ts","../../../plugins/circular-view/src/BaseChordDisplay/components/Loading.tsx","../../../plugins/circular-view/src/BaseChordDisplay/components/DisplayError.js","../../../plugins/circular-view/src/BaseChordDisplay/components/RpcRenderedSvgGroup.js","../../../plugins/circular-view/src/BaseChordDisplay/components/BaseChordDisplay.tsx","../../../plugins/circular-view/src/BaseChordDisplay/models/renderReaction.js","../../../plugins/circular-view/src/BaseChordDisplay/models/BaseChordDisplayModel.ts","../../../plugins/circular-view/src/BaseChordDisplay/models/baseChordDisplayConfig.ts","../../../plugins/circular-view/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/PAFAdapter.ts","../../../plugins/comparative-adapters/src/PAFAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/util.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/MCScanAnchorsAdapter.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/MCScanSimpleAnchorsAdapter.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/MashMapAdapter.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/DeltaAdapter.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/ChainAdapter/ChainAdapter.ts","../../../plugins/comparative-adapters/src/ChainAdapter/configSchema.ts","../../../plugins/comparative-adapters/src/index.ts","../../../plugins/comparative-adapters/src/PAFAdapter/index.ts","../../../plugins/comparative-adapters/src/DeltaAdapter/index.ts","../../../plugins/comparative-adapters/src/ChainAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MCScanSimpleAnchorsAdapter/index.ts","../../../plugins/comparative-adapters/src/MashMapAdapter/index.ts","../../../plugins/config/src/ConfigurationEditorWidget/components/JsonEditor.js","../../../plugins/config/src/ConfigurationEditorWidget/model.js","../../../plugins/config/src/ConfigurationEditorWidget/index.js","../../../plugins/config/src/FromConfigAdapter/FromConfigAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigRegionsAdapter.ts","../../../plugins/config/src/FromConfigAdapter/FromConfigSequenceAdapter.ts","../../../plugins/config/src/FromConfigAdapter/configSchema.ts","../../../plugins/config/src/RefNameAliasAdapter/RefNameAliasAdapter.ts","../../../plugins/config/src/RefNameAliasAdapter/configSchema.ts","../../../plugins/config/src/index.ts","../../../plugins/data-management/src/AddConnectionWidget/model.js","../../../plugins/data-management/src/AddConnectionWidget/index.js","../../../plugins/data-management/src/AddTrackWidget/model.ts","../../../plugins/data-management/src/AddTrackWidget/index.js","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/model.ts","../../../plugins/data-management/src/HierarchicalTrackSelectorWidget/index.ts","../../../plugins/data-management/src/PluginStoreWidget/components/InstalledPlugin.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/InstalledPluginsList.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/PluginCard.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/CustomPluginForm.tsx","../../../plugins/data-management/src/PluginStoreWidget/components/PluginStoreWidget.tsx","../../../plugins/data-management/src/PluginStoreWidget/model.ts","../../../plugins/data-management/src/PluginStoreWidget/index.js","../../../plugins/data-management/src/ucsc-trackhub/configSchema.js","../../../plugins/data-management/src/ucsc-trackhub/ucscAssemblies.js","../../../plugins/data-management/src/ucsc-trackhub/ucscTrackHub.js","../../../plugins/data-management/src/ucsc-trackhub/model.js","../../../plugins/dotplot-view/src/DotplotView/components/util.ts","../../../plugins/dotplot-view/src/DotplotView/model.ts","../../../plugins/dotplot-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/components/DotplotDisplay.tsx","../../../plugins/dotplot-view/src/DotplotDisplay/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/components/DotplotRendering.tsx","../../../plugins/dotplot-view/src/DotplotRenderer/configSchema.ts","../../../plugins/dotplot-view/src/DotplotRenderer/DotplotRenderer.ts","../../../plugins/dotplot-view/src/LaunchDotplotView.ts","../../../plugins/dotplot-view/src/DotplotRenderer/ComparativeRenderRpc.ts","../../../plugins/dotplot-view/src/util.ts","../../../plugins/dotplot-view/src/DotplotReadVsRef.ts","../../../plugins/dotplot-view/src/index.ts","../../../plugins/dotplot-view/src/DotplotView/index.ts","../../../plugins/dotplot-view/src/DotplotRenderer/index.ts","../../../plugins/gff3/src/Gff3TabixAdapter/configSchema.ts","../../../plugins/gff3/src/Gff3Adapter/configSchema.ts","../../../plugins/gff3/src/index.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/AssemblySelector.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/DeleteBookmark.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/utils.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/DownloadBookmarks.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/ImportBookmarks.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/ClearBookmarks.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/components/GridBookmarkWidget.tsx","../../../plugins/grid-bookmark/src/GridBookmarkWidget/model.ts","../../../plugins/grid-bookmark/src/GridBookmarkWidget/index.js","../../../plugins/grid-bookmark/src/index.ts","../../../plugins/gtf/src/GtfAdapter/configSchema.ts","../../../plugins/gtf/src/index.ts","../../../plugins/hic/src/HicRenderer/components/HicRendering.tsx","../../../plugins/hic/src/HicRenderer/configSchema.ts","../../../plugins/hic/src/HicRenderer/HicRenderer.tsx","../../../plugins/hic/src/LinearHicDisplay/configSchema.ts","../../../plugins/hic/src/LinearHicDisplay/model.ts","../../../plugins/hic/src/HicAdapter/configSchema.ts","../../../plugins/hic/src/index.ts","../../../plugins/legacy-jbrowse/src/NCListAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/HttpMap.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/JBrowse1TextSearchAdapter.ts","../../../plugins/legacy-jbrowse/src/JBrowse1TextSeachAdapter/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/configSchema.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/util.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigParse.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ConfigLoad.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/jb1ToJb2.ts","../../../plugins/legacy-jbrowse/src/JBrowse1Connection/model.js","../../../plugins/legacy-jbrowse/src/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/components/Icons.tsx","../../../plugins/linear-comparative-view/src/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/components/LinearComparativeDisplay.tsx","../../../plugins/linear-comparative-view/src/LinearComparativeDisplay/index.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/model.ts","../../../plugins/linear-comparative-view/src/LinearComparativeView/index.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyDisplay/index.ts","../../../plugins/linear-comparative-view/src/util.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/components/LinearSyntenyRendering.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/configSchema.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/LinearSyntenyRenderer.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/model.ts","../../../plugins/linear-comparative-view/src/LinearSyntenyView/index.ts","../../../plugins/linear-comparative-view/src/LaunchLinearSyntenyView.ts","../../../plugins/linear-comparative-view/src/ReadVsRef.tsx","../../../plugins/linear-comparative-view/src/index.tsx","../../../plugins/linear-comparative-view/src/LinearSyntenyRenderer/index.ts","../../../plugins/linear-comparative-view/src/SyntenyTrack/index.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Block.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ZoomControls.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Header.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackLabel.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TrackContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/VerticalGuides.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/CenterLine.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/TracksContainer.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ImportForm.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/MiniControls.tsx","../../../packages/core/util/formatFastaStrings.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SequenceDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeView.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewRubberBand.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/OverviewScaleBar.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/RefNameAutocomplete.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchBox.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/SearchResultsDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/util.ts","../../../plugins/linear-genome-view/src/LinearGenomeView/components/Ruler.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/LinearGenomeViewSvg.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/components/ExportSvgDialog.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/index.tsx","../../../plugins/linear-genome-view/src/LinearGenomeView/util.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/baseLinearDisplayConfigSchema.ts","../../../packages/core/util/compositeMap.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/Tooltip.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/LinearBlocks.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/BaseLinearDisplay.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/components/ServerSideRenderedBlockContent.tsx","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/serverSideRenderedBlock.ts","../../../plugins/linear-genome-view/src/BaseLinearDisplay/models/BaseLinearDisplayModel.tsx","../../../plugins/linear-genome-view/src/LinearBareDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/model.ts","../../../plugins/linear-genome-view/src/LinearBasicDisplay/configSchema.ts","../../../plugins/linear-genome-view/src/index.ts","../../../plugins/linear-genome-view/src/LinearBareDisplay/configSchema.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/model.ts","../../../plugins/lollipop/src/LollipopRenderer/components/Lollipop.js","../../../plugins/lollipop/src/LollipopRenderer/components/Stick.js","../../../plugins/lollipop/src/LollipopRenderer/components/LollipopRendering.js","../../../plugins/lollipop/src/LollipopRenderer/configSchema.ts","../../../plugins/lollipop/src/LollipopRenderer/Layout.ts","../../../plugins/lollipop/src/LollipopRenderer/LollipopRenderer.js","../../../plugins/lollipop/src/index.ts","../../../plugins/lollipop/src/LinearLollipopDisplay/configSchema.ts","../../../plugins/menus/src/AboutWidget/index.js","../../../plugins/menus/src/HelpWidget/index.js","../../../plugins/menus/src/ImportSessionWidget/index.ts","../../../plugins/menus/src/SessionManager/index.js","../../../plugins/menus/src/index.ts","../../../plugins/rdf/src/SPARQLAdapter/SPARQLAdapter.ts","../../../plugins/rdf/src/SPARQLAdapter/configSchema.ts","../../../plugins/rdf/src/index.ts","../../../plugins/sequence/src/BgzipFastaAdapter/configSchema.ts","../../../plugins/sequence/src/ChromSizesAdapter/configSchema.ts","../../../plugins/sequence/src/DivSequenceRenderer/components/DivSequenceRendering.tsx","../../../plugins/sequence/src/DivSequenceRenderer/configSchema.ts","../../../plugins/sequence/src/IndexedFastaAdapter/configSchema.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/configSchema.ts","../../../plugins/sequence/src/TwoBitAdapter/configSchema.ts","../../../plugins/sequence/src/GCContentAdapter/configSchema.ts","../../../plugins/sequence/src/GCContentAdapter/index.ts","../../../plugins/sequence/src/index.ts","../../../plugins/sequence/src/referenceSeqTrackConfig.ts","../../../plugins/sequence/src/LinearReferenceSequenceDisplay/model.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/MakeSpreadsheetColumnType.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocString.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Text.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocRef.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/Number.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/index.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocStart.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ColumnDataTypes/LocEnd.js","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Row.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/StaticRowSet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/Spreadsheet.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/ImportWizard.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/FilterControls.ts","../../../plugins/spreadsheet-view/src/SpreadsheetView/models/SpreadsheetView.ts","../../../plugins/spreadsheet-view/src/index.ts","../../../plugins/sv-inspector/src/SvInspectorView/components/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/models/adhocFeatureUtils.js","../../../plugins/sv-inspector/src/SvInspectorView/models/breakpointSplitViewFromTableRow.js","../../../plugins/sv-inspector/src/SvInspectorView/models/SvInspectorView.js","../../../plugins/sv-inspector/src/SvInspectorView/SvInspectorViewType.js","../../../plugins/sv-inspector/src/index.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureLabel.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/FeatureGlyph.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgOverlay.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Arrow.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Box.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Segments.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/ProcessedTranscript.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/Subfeatures.tsx","../../../plugins/svg/src/SvgFeatureRenderer/components/util.ts","../../../plugins/svg/src/SvgFeatureRenderer/components/SvgFeatureRendering.tsx","../../../plugins/svg/src/SvgFeatureRenderer/configSchema.ts","../../../plugins/svg/src/index.ts","../../../plugins/trackhub-registry/src/trackhub-registry/configSchema.js","../../../plugins/trackhub-registry/src/trackhub-registry/tracks.js","../../../plugins/trackhub-registry/src/trackhub-registry/model.js","../../../plugins/trackhub-registry/src/index.ts","../../../plugins/trix/src/TrixTextSearchAdapter/TrixTextSearchAdapter.ts","../../../plugins/trix/src/TrixTextSearchAdapter/configSchema.ts","../../../plugins/trix/src/index.ts","../../../plugins/variants/src/VcfTabixAdapter/VcfFeature.ts","../../../plugins/variants/src/ChordVariantDisplay/models/ChordVariantDisplay.js","../../../plugins/variants/src/ChordVariantDisplay/index.ts","../../../plugins/variants/src/LinearVariantDisplay/model.ts","../../../plugins/variants/src/StructuralVariantChordRenderer/ReactComponent.js","../../../plugins/variants/src/StructuralVariantChordRenderer/index.js","../../../plugins/variants/src/VariantFeatureWidget/index.ts","../../../plugins/variants/src/VcfTabixAdapter/configSchema.ts","../../../plugins/variants/src/VcfAdapter/configSchema.ts","../../../plugins/variants/src/index.ts","../../../plugins/variants/src/LinearVariantDisplay/configSchema.ts","../../../plugins/wiggle/src/WiggleBaseRenderer.tsx","../../../plugins/wiggle/src/WiggleRendering.tsx","../../../plugins/wiggle/src/BigWigAdapter/configSchema.ts","../../../plugins/wiggle/src/util.ts","../../../plugins/wiggle/src/configSchema.ts","../../../plugins/wiggle/src/DensityRenderer/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/components/Tooltip.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/YScaleBar.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/components/WiggleDisplayComponent.tsx","../../../plugins/wiggle/src/LinearWiggleDisplay/models/model.tsx","../../../plugins/wiggle/src/XYPlotRenderer/XYPlotRenderer.ts","../../../plugins/wiggle/src/XYPlotRenderer/index.ts","../../../plugins/wiggle/src/LinePlotRenderer/LinePlotRenderer.js","../../../plugins/wiggle/src/LinePlotRenderer/index.js","../../../plugins/wiggle/src/WiggleRPC/rpcMethods.ts","../../../plugins/wiggle/src/index.ts","../../../plugins/wiggle/src/LinearWiggleDisplay/models/configSchema.ts"],"sourcesContent":["import React, { useRef, useState, useEffect } from 'react'\nimport {\n  Button,\n  Select,\n  MenuItem,\n  Typography,\n  Tooltip,\n  makeStyles,\n} from '@material-ui/core'\nimport { useInView } from 'react-intersection-observer'\nimport copy from 'copy-to-clipboard'\nimport {\n  defaultCodonTable,\n  generateCodonTable,\n  revcom,\n  getSession,\n} from '../util'\nimport { BaseProps } from './types'\nimport { getConf } from '../configuration'\nimport { Feature, SimpleFeatureSerialized } from '../util/simpleFeature'\nimport {\n  Feat,\n  ParentFeat,\n  SeqState,\n  calculateUTRs,\n  stitch,\n  dedupe,\n  revlist,\n} from './util'\n\ninterface CoordFeat extends SimpleFeatureSerialized {\n  refName: string\n  start: number\n  end: number\n}\n\nconst useStyles = makeStyles(theme => ({\n  button: {\n    margin: theme.spacing(1),\n  },\n}))\n\n// note that these are currently put into the style section instead of being\n// defined in classes to aid copy and paste to an external document e.g. word\nconst proteinColor = 'rgb(220,160,220)'\nconst intronColor = undefined\nconst cdsColor = 'rgb(220,220,180)'\nconst updownstreamColor = 'rgba(250,200,200)'\nconst utrColor = 'rgb(200,240,240)'\n\nfunction GeneCDS({ cds, sequence }: { cds: Feat[]; sequence: string }) {\n  return <span style={{ background: cdsColor }}>{stitch(cds, sequence)}</span>\n}\n\nfunction GeneProtein({\n  cds,\n  sequence,\n  codonTable,\n}: {\n  cds: Feat[]\n  sequence: string\n  codonTable: { [key: string]: string }\n}) {\n  const str = stitch(cds, sequence)\n  let protein = ''\n  for (let i = 0; i < str.length; i += 3) {\n    // use & symbol for undefined codon, or partial slice\n    protein += codonTable[str.slice(i, i + 3)] || '&'\n  }\n\n  return <span style={{ background: proteinColor }}>{protein}</span>\n}\n\nfunction GenecDNA({\n  utr,\n  cds,\n  exons,\n  sequence,\n  upstream,\n  downstream,\n  includeIntrons,\n  collapseIntron,\n}: {\n  utr: Feat[]\n  cds: Feat[]\n  exons: Feat[]\n  sequence: string\n  upstream?: string\n  downstream?: string\n  includeIntrons?: boolean\n  collapseIntron?: boolean\n}) {\n  const chunks = cds.length\n    ? [...cds, ...utr].sort((a, b) => a.start - b.start)\n    : exons\n  return (\n    <>\n      {upstream ? (\n        <span style={{ background: updownstreamColor }}>{upstream}</span>\n      ) : null}\n\n      {chunks\n        .filter(f => f.start !== f.end)\n        .map((chunk, index) => {\n          const intron = sequence.slice(chunk.end, chunks[index + 1]?.start)\n          return (\n            <React.Fragment key={JSON.stringify(chunk)}>\n              <span\n                style={{\n                  background: chunk.type === 'CDS' ? cdsColor : utrColor,\n                }}\n              >\n                {sequence.slice(chunk.start, chunk.end)}\n              </span>\n              {includeIntrons && index < chunks.length - 1 ? (\n                <span style={{ background: intronColor }}>\n                  {collapseIntron && intron.length > 20\n                    ? `${intron.slice(0, 10)}...${intron.slice(-10)}`\n                    : intron}\n                </span>\n              ) : null}\n            </React.Fragment>\n          )\n        })}\n\n      {downstream ? (\n        <span style={{ background: updownstreamColor }}>{downstream}</span>\n      ) : null}\n    </>\n  )\n}\n\nexport const SequencePanel = React.forwardRef<\n  HTMLDivElement,\n  {\n    sequence: SeqState\n    feature: ParentFeat\n    mode: string\n  }\n>(\n  (\n    {\n      feature,\n      mode,\n      sequence: { seq: sequence, upstream = '', downstream = '' },\n    },\n    ref,\n  ) => {\n    const { subfeatures } = feature\n    const codonTable = generateCodonTable(defaultCodonTable)\n\n    if (!subfeatures) {\n      return null\n    }\n\n    const children = subfeatures\n      .sort((a, b) => a.start - b.start)\n      .map(sub => ({\n        ...sub,\n        start: sub.start - feature.start,\n        end: sub.end - feature.start,\n      }))\n\n    // we filter duplicate entries in cds and exon lists duplicate entries may be\n    // rare but was seen in Gencode v36 track NCList, likely a bug on GFF3 or\n    // probably worth ignoring here (produces broken protein translations if\n    // included)\n    //\n    // position 1:224,800,006..225,203,064 gene ENSG00000185842.15 first\n    // transcript ENST00000445597.6\n    //\n    // http://localhost:3000/?config=test_data%2Fconfig.json&session=share-FUl7G1isvF&password=HXh5Y\n\n    let cds = dedupe(children.filter(sub => sub.type === 'CDS'))\n    let utr = dedupe(children.filter(sub => sub.type.match(/utr/i)))\n    let exons = dedupe(children.filter(sub => sub.type === 'exon'))\n\n    if (!utr.length && cds.length && exons.length) {\n      utr = calculateUTRs(cds, exons)\n    }\n\n    if (feature.strand === -1) {\n      // doing this in a single assignment is needed because downstream and\n      // upstream are swapped so this avoids a temp variable\n      ;[sequence, upstream, downstream] = [\n        revcom(sequence),\n        revcom(downstream),\n        revcom(upstream),\n      ]\n      cds = revlist(cds, sequence.length)\n      exons = revlist(exons, sequence.length)\n      utr = revlist(utr, sequence.length)\n    }\n\n    return (\n      <div ref={ref} data-testid=\"sequence_panel\">\n        <div\n          style={{\n            fontFamily: 'monospace',\n            wordWrap: 'break-word',\n            maxWidth: 600,\n          }}\n        >\n          {`>${feature.name || feature.id || 'unknown'}-${mode}\\n`}\n          {mode === 'cds' ? (\n            <GeneCDS cds={cds} sequence={sequence} />\n          ) : mode === 'cdna' ? (\n            <GenecDNA exons={exons} cds={cds} utr={utr} sequence={sequence} />\n          ) : mode === 'protein' ? (\n            <GeneProtein\n              cds={cds}\n              codonTable={codonTable}\n              sequence={sequence}\n            />\n          ) : mode === 'gene' ? (\n            <GenecDNA\n              exons={exons}\n              cds={cds}\n              utr={utr}\n              sequence={sequence}\n              includeIntrons\n            />\n          ) : mode === 'gene_collapsed_intron' ? (\n            <GenecDNA\n              exons={exons}\n              cds={cds}\n              sequence={sequence}\n              utr={utr}\n              includeIntrons\n              collapseIntron\n            />\n          ) : mode === 'gene_updownstream' ? (\n            <GenecDNA\n              exons={exons}\n              cds={cds}\n              sequence={sequence}\n              utr={utr}\n              upstream={upstream}\n              downstream={downstream}\n              includeIntrons\n            />\n          ) : mode === 'gene_updownstream_collapsed_intron' ? (\n            <GenecDNA\n              exons={exons}\n              cds={cds}\n              sequence={sequence}\n              utr={utr}\n              upstream={upstream}\n              downstream={downstream}\n              includeIntrons\n              collapseIntron\n            />\n          ) : (\n            <div>Unknown type</div>\n          )}\n        </div>\n      </div>\n    )\n  },\n)\n\n// display the stitched-together sequence of a gene's CDS, cDNA, or protein\n// sequence. this is a best effort and weird genomic phenomena could lead these\n// to not be 100% accurate\nexport default function SequenceFeatureDetails({ model, feature }: BaseProps) {\n  const classes = useStyles()\n  const parentFeature = feature as unknown as ParentFeat\n  const hasCDS = parentFeature.subfeatures?.find(sub => sub.type === 'CDS')\n  const seqPanelRef = useRef<HTMLDivElement>(null)\n\n  const { ref, inView } = useInView()\n  const [sequence, setSequence] = useState<SeqState>()\n  const [error, setError] = useState<unknown>()\n  const [mode, setMode] = useState(hasCDS ? 'cds' : 'cdna')\n  const [copied, setCopied] = useState(false)\n  const [copiedHtml, setCopiedHtml] = useState(false)\n\n  useEffect(() => {\n    let finished = false\n    if (!model || !inView) {\n      return () => {}\n    }\n    const { assemblyManager, rpcManager } = getSession(model)\n    const [assemblyName] = model.view?.assemblyNames || []\n    async function fetchSeq(start: number, end: number, refName: string) {\n      const assembly = await assemblyManager.waitForAssembly(assemblyName)\n      if (!assembly) {\n        throw new Error('assembly not found')\n      }\n      const sessionId = 'getSequence'\n      const feats = await rpcManager.call(sessionId, 'CoreGetFeatures', {\n        adapterConfig: getConf(assembly, ['sequence', 'adapter']),\n        sessionId,\n        regions: [\n          {\n            start,\n            end,\n            refName: assembly.getCanonicalRefName(refName),\n          },\n        ],\n      })\n\n      const [feat] = feats as Feature[]\n      if (!feat) {\n        throw new Error(\n          `sequence not found for feature with refName:${refName}`,\n        )\n      }\n      return feat.get('seq') as string\n    }\n    ;(async () => {\n      try {\n        const { start, end, refName } = feature as CoordFeat\n        const seq = await fetchSeq(start, end, refName)\n        const up = await fetchSeq(Math.max(0, start - 500), start, refName)\n        const down = await fetchSeq(end, end + 500, refName)\n        if (!finished) {\n          setSequence({ seq, upstream: up, downstream: down })\n        }\n      } catch (e) {\n        setError(e)\n      }\n    })()\n\n    return () => {\n      finished = true\n    }\n  }, [feature, inView, model])\n\n  const loading = !sequence\n\n  return (\n    <div ref={ref}>\n      <Select\n        value={mode}\n        onChange={event => setMode(event.target.value as string)}\n      >\n        {hasCDS ? <MenuItem value=\"cds\">CDS</MenuItem> : null}\n        {hasCDS ? <MenuItem value=\"protein\">Protein</MenuItem> : null}\n        <MenuItem value=\"gene\">Gene w/ introns</MenuItem>\n        <MenuItem value=\"gene_collapsed_intron\">\n          Gene w/ 10bp of intron\n        </MenuItem>\n        <MenuItem value=\"gene_updownstream\">\n          Gene w/ 500bp up+down stream\n        </MenuItem>\n        <MenuItem value=\"gene_updownstream_collapsed_intron\">\n          Gene w/ 500bp up+down stream w/ 10bp intron\n        </MenuItem>\n        <MenuItem value=\"cdna\">cDNA</MenuItem>\n      </Select>\n      <Button\n        className={classes.button}\n        type=\"button\"\n        variant=\"contained\"\n        onClick={() => {\n          const ref = seqPanelRef.current\n          if (ref) {\n            copy(ref.textContent || '', { format: 'text/plain' })\n            setCopied(true)\n            setTimeout(() => setCopied(false), 1000)\n          }\n        }}\n      >\n        {copied ? 'Copied to clipboard!' : 'Copy as plaintext'}\n      </Button>\n      <Tooltip title=\"Note that 'Copy as HTML' can retain the colors but cannot be pasted into some programs like notepad that only expect plain text\">\n        <Button\n          className={classes.button}\n          type=\"button\"\n          variant=\"contained\"\n          onClick={() => {\n            const ref = seqPanelRef.current\n            if (ref) {\n              copy(ref.innerHTML, { format: 'text/html' })\n              setCopiedHtml(true)\n              setTimeout(() => setCopiedHtml(false), 1000)\n            }\n          }}\n        >\n          {copiedHtml ? 'Copied to clipboard!' : 'Copy as HTML'}\n        </Button>\n      </Tooltip>\n      <div data-testid=\"feature_sequence\">\n        {error ? (\n          <Typography color=\"error\">{`${error}`}</Typography>\n        ) : loading ? (\n          <div>Loading gene sequence...</div>\n        ) : sequence ? (\n          <SequencePanel\n            ref={seqPanelRef}\n            feature={parentFeature}\n            mode={mode}\n            sequence={sequence}\n          />\n        ) : (\n          <div>No sequence found</div>\n        )}\n      </div>\n    </div>\n  )\n}\n","import { types, addDisposer } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport PluginManager from '../PluginManager'\nimport { getConf, ConfigurationSchema } from '../configuration'\nimport clone from 'clone'\nimport { ElementId } from '../util/types/mst'\n\nconst configSchema = ConfigurationSchema('BaseFeatureWidget', {})\n\ninterface Feat {\n  subfeatures?: Record<string, unknown>[]\n}\n\nfunction formatSubfeatures(\n  obj: Feat,\n  depth: number,\n  parse: (obj: Record<string, unknown>) => void,\n  currentDepth = 0,\n  returnObj = {} as Record<string, unknown>,\n) {\n  if (depth <= currentDepth) {\n    return returnObj\n  }\n  returnObj.subfeatures = obj.subfeatures?.map(sub => {\n    formatSubfeatures(sub, depth, parse, currentDepth + 1, returnObj)\n    return parse(sub)\n  })\n  return returnObj\n}\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .model('BaseFeatureWidget', {\n      id: ElementId,\n      type: types.literal('BaseFeatureWidget'),\n      featureData: types.frozen(),\n      formattedFields: types.frozen(),\n      unformattedFeatureData: types.frozen(),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      track: types.safeReference(\n        pluginManager.pluggableMstType('track', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({}))\n    .actions(self => ({\n      setFeatureData(featureData: Record<string, unknown>) {\n        self.unformattedFeatureData = featureData\n      },\n      clearFeatureData() {\n        self.featureData = undefined\n      },\n      setFormattedData(feat: Record<string, unknown>) {\n        self.featureData = feat\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const { unformattedFeatureData, track } = self\n            if (unformattedFeatureData) {\n              const feature = clone(unformattedFeatureData)\n\n              if (track) {\n                // eslint-disable-next-line no-underscore-dangle\n                feature.__jbrowsefmt = getConf(\n                  track,\n                  ['formatDetails', 'feature'],\n                  { feature },\n                )\n\n                const depth = getConf(track, ['formatDetails', 'depth'])\n\n                formatSubfeatures(feature, depth, subfeature => {\n                  // eslint-disable-next-line no-underscore-dangle\n                  subfeature.__jbrowsefmt = getConf(\n                    track,\n                    ['formatDetails', 'subfeatures'],\n                    { feature: subfeature },\n                  )\n                })\n              }\n\n              self.setFormattedData(feature)\n            }\n          }),\n        )\n      },\n    }))\n    .preProcessSnapshot(snap => {\n      // @ts-ignore\n      const { featureData, finalizedFeatureData, ...rest } = snap\n      return {\n        unformattedFeatureData: featureData,\n        featureData: finalizedFeatureData,\n        ...rest,\n      }\n    })\n    .postProcessSnapshot(snap => {\n      const { unformattedFeatureData, featureData, ...rest } = snap\n      // finalizedFeatureData avoids running formatter twice if loading from\n      // snapshot\n      return {\n        // replacing undefined with null helps with allowing fields to be\n        // hidden, setting null is not allowed by jexl so we set it to\n        // undefined to hide. see config guide. this replacement happens both\n        // here and when displaying the featureData in base feature widget\n        finalizedFeatureData: JSON.parse(\n          JSON.stringify(featureData, (_, v) =>\n            typeof v === 'undefined' ? null : v,\n          ),\n        ),\n        ...rest,\n      }\n    })\n}\n\nexport { configSchema, stateModelFactory }\n","export interface Feat {\n  start: number\n  end: number\n  type: string\n  name?: string\n  id?: string\n}\nexport interface ParentFeat extends Feat {\n  strand?: number\n  subfeatures?: Feat[]\n}\nexport interface SeqState {\n  seq: string\n  upstream: string\n  downstream: string\n}\nexport function stitch(subfeats: Feat[], sequence: string) {\n  return subfeats.map(sub => sequence.slice(sub.start, sub.end)).join('')\n}\n\n// filter items if they have the same \"ID\" or location\nfunction getItemId(feat: Feat) {\n  return `${feat.start}-${feat.end}`\n}\n\n// filters if successive elements share same start/end\nexport function dedupe(list: Feat[]) {\n  return list.filter(\n    (item, pos, ary) => !pos || getItemId(item) !== getItemId(ary[pos - 1]),\n  )\n}\n\nexport function revlist(list: Feat[], seqlen: number) {\n  return list\n    .map(sub => ({\n      ...sub,\n      start: seqlen - sub.end,\n      end: seqlen - sub.start,\n    }))\n    .sort((a, b) => a.start - b.start)\n}\n\n// calculates UTRs using impliedUTRs logic\nexport function calculateUTRs(cds: Feat[], exons: Feat[]) {\n  const firstCds = cds[0]\n  const lastCds = cds[cds.length - 1]\n  const firstCdsIdx = exons.findIndex(\n    exon => exon.end >= firstCds.start && exon.start <= firstCds.start,\n  )\n  const lastCdsIdx = exons.findIndex(\n    exon => exon.end >= lastCds.end && exon.start <= lastCds.end,\n  )\n  const lastCdsExon = exons[lastCdsIdx]\n  const firstCdsExon = exons[firstCdsIdx]\n\n  const fiveUTRs = [\n    ...exons.slice(0, firstCdsIdx),\n    { start: firstCdsExon.start, end: firstCds.start },\n  ].map(elt => ({ ...elt, type: 'five_prime_UTR' }))\n\n  const threeUTRs = [\n    { start: lastCds.end, end: lastCdsExon.end },\n    ...exons.slice(lastCdsIdx + 1),\n  ].map(elt => ({ ...elt, type: 'three_prime_UTR' }))\n\n  return [...fiveUTRs, ...threeUTRs]\n}\n\nexport function ellipses(slug: string) {\n  return slug.length > 20 ? `${slug.slice(0, 20)}...` : slug\n}\n","import { toArray } from 'rxjs/operators'\nimport {\n  freeAdapterResources,\n  getAdapter,\n} from '../data_adapters/dataAdapterCache'\nimport RpcMethodType from '../pluggableElementTypes/RpcMethodType'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport { RemoteAbortSignal } from './remoteAbortSignals'\nimport {\n  BaseFeatureDataAdapter,\n  isFeatureAdapter,\n} from '../data_adapters/BaseAdapter'\nimport {\n  checkAbortSignal,\n  renameRegionsIfNeeded,\n  getLayoutId,\n  Region,\n} from '../util'\nimport SimpleFeature, { SimpleFeatureSerialized } from '../util/simpleFeature'\n\nexport class CoreGetRefNames extends RpcMethodType {\n  name = 'CoreGetRefNames'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getRefNames(deserializedArgs)\n    }\n    return []\n  }\n}\nexport class CoreGetFileInfo extends RpcMethodType {\n  name = 'CoreGetInfo'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getHeader(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetMetadata extends RpcMethodType {\n  name = 'CoreGetMetadata'\n\n  async execute(\n    args: {\n      sessionId: string\n      signal: RemoteAbortSignal\n      adapterConfig: {}\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { sessionId, adapterConfig } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    return isFeatureAdapter(dataAdapter)\n      ? dataAdapter.getMetadata(deserializedArgs)\n      : null\n  }\n}\n\nexport class CoreGetFeatures extends RpcMethodType {\n  name = 'CoreGetFeatures'\n\n  async deserializeReturn(\n    feats: SimpleFeatureSerialized[],\n    args: unknown,\n    rpcDriverClassName: string,\n  ) {\n    const superDeserialized = (await super.deserializeReturn(\n      feats,\n      args,\n      rpcDriverClassName,\n    )) as SimpleFeatureSerialized[]\n    return superDeserialized.map(feat => new SimpleFeature(feat))\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n\n    const renamedArgs = assemblyManager\n      ? await renameRegionsIfNeeded(assemblyManager, args)\n      : args\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriverClassName,\n    )) as RenderArgs\n\n    return superArgs\n  }\n\n  async execute(\n    args: {\n      sessionId: string\n      regions: Region[]\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      opts?: any\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { signal, sessionId, adapterConfig, regions, opts } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    if (!isFeatureAdapter(dataAdapter)) {\n      return []\n    }\n    const ret = dataAdapter.getFeaturesInMultipleRegions(regions, {\n      ...opts,\n      signal,\n    })\n    const r = await ret.pipe(toArray()).toPromise()\n    return r.map(f => f.toJSON())\n  }\n}\n\n/**\n * free up any resources (e.g. cached adapter objects)\n * that are only associated with the given track ID.\n *\n * returns number of objects deleted\n */\nexport class CoreFreeResources extends RpcMethodType {\n  name = 'CoreFreeResources'\n\n  async execute(specification: {}) {\n    let deleteCount = 0\n\n    deleteCount += freeAdapterResources(specification)\n\n    // pass the freeResources hint along to all the renderers as well\n    this.pluginManager.getRendererTypes().forEach(renderer => {\n      const count = renderer.freeResources(/* specification */)\n      if (count) {\n        deleteCount += count\n      }\n    })\n\n    return deleteCount\n  }\n  async serializeArguments(args: {}, _rpcDriverClassName: string): Promise<{}> {\n    return args\n  }\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  assemblyName: string\n  regions: Region[]\n  adapterConfig: {}\n  rendererType: string\n}\n\nexport class CoreEstimateRegionStats extends RpcMethodType {\n  name = 'CoreEstimateRegionStats'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n    rpcDriverClassName: string,\n  ) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters && args.filters.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      regions: Region[]\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.estimateRegionsStats(regions, deserializedArgs)\n    }\n    throw new Error('Data adapter not found')\n  }\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreRender extends RpcMethodType {\n  name = 'CoreRender'\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n    const renamedArgs = assemblyManager\n      ? await renameRegionsIfNeeded(assemblyManager, args)\n      : args\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriverClassName,\n    )) as RenderArgs\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriverClassName: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriverClassName !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(\n        args,\n        rpcDriverClassName,\n      )\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    const result =\n      rpcDriverClassName === 'MainThreadRpcDriver'\n        ? await RendererType.render(deserializedArgs)\n        : await RendererType.renderInWorker(deserializedArgs)\n\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriverClassName: string,\n  ): Promise<unknown> {\n    const superDeserialized = await super.deserializeReturn(\n      serializedReturn,\n      args,\n      rpcDriverClassName,\n    )\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return superDeserialized\n    }\n\n    const { rendererType } = args\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n    return RendererType.deserializeResultsInClient(\n      superDeserialized as ResultsSerialized,\n      args,\n    )\n  }\n}\n\n/**\n * fetches features from an adapter and call a renderer with them\n */\nexport class CoreGetFeatureDetails extends RpcMethodType {\n  name = 'CoreGetFeatureDetails'\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n\n    const renamedArgs = assemblyManager\n      ? await renameRegionsIfNeeded(assemblyManager, args)\n      : args\n\n    const superArgs = (await super.serializeArguments(\n      renamedArgs,\n      rpcDriverClassName,\n    )) as RenderArgs\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return superArgs\n    }\n\n    const { rendererType } = args\n\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    return RendererType.serializeArgsInClient(superArgs)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriverClassName: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriverClassName !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(\n        args,\n        rpcDriverClassName,\n      )\n    }\n    const { rendererType, featureId } = deserializedArgs\n    const RendererType = validateRendererType(\n      rendererType,\n      this.pluginManager.getRendererType(rendererType),\n    )\n\n    // @ts-ignore\n    const sess = RendererType.sessions[getLayoutId(args)]\n    const { layout } = sess.cachedLayout\n    const xref = layout.getDataByID(featureId)\n\n    return { feature: xref.toJSON() }\n  }\n}\n\nfunction validateRendererType<T>(rendererType: string, RendererType: T) {\n  if (!RendererType) {\n    throw new Error(`renderer \"${rendererType}\" not found`)\n  }\n  // @ts-ignore\n  if (!RendererType.ReactComponent) {\n    throw new Error(\n      `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n    )\n  }\n\n  if (!(RendererType instanceof ServerSideRendererType)) {\n    throw new Error(\n      'CoreRender requires a renderer that is a subclass of ServerSideRendererType',\n    )\n  }\n  return RendererType\n}\n","import SimpleFeature from '../util/simpleFeature'\nimport { ConfigurationSchema, readConfObject } from '../configuration'\nimport { openLocation } from '../util/io'\nimport { BaseAdapter } from './BaseAdapter'\n\nconst configSchema = ConfigurationSchema(\n  'CytobandAdapter',\n  {\n    cytobandLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/cytoband.txt.gz' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n\nclass CytobandAdapter extends BaseAdapter {\n  async getData() {\n    const loc = readConfObject(this.config, 'cytobandLocation')\n    if (loc.uri === '' || loc.uri === '/path/to/cytoband.txt.gz') {\n      return []\n    }\n    const data = await openLocation(loc).readFile('utf8')\n    return data\n      .split('\\n')\n      .filter(f => !!f.trim())\n      .map(line => {\n        const [refName, start, end, name, type] = line.split('\\t')\n        return new SimpleFeature({\n          uniqueId: line,\n          refName,\n          start: +start,\n          end: +end,\n          name,\n          type,\n        })\n      })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n\nexport { configSchema, CytobandAdapter as DataAdapter }\n","import { lazy } from 'react'\nimport { configSchema, stateModelFactory } from './BaseFeatureWidget'\nimport Plugin from './Plugin'\nimport PluginManager from './PluginManager'\nimport * as coreRpcMethods from './rpc/coreRpcMethods'\nimport AdapterType from './pluggableElementTypes/AdapterType'\nimport WidgetType from './pluggableElementTypes/WidgetType'\nimport {\n  configSchema as cytobandConfigSchema,\n  DataAdapter,\n} from './data_adapters/CytobandAdapter'\n\n// the core plugin, which registers types that ALL JBrowse applications are\n// expected to need.\nexport default class CorePlugin extends Plugin {\n  name = 'CorePlugin'\n\n  install(pluginManager: PluginManager) {\n    // register all our core rpc methods\n    Object.values(coreRpcMethods).forEach(RpcMethod => {\n      pluginManager.addRpcMethod(() => new RpcMethod(pluginManager))\n    })\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'CytobandAdapter',\n          configSchema: cytobandConfigSchema,\n          AdapterClass: DataAdapter,\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'BaseFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./BaseFeatureWidget/BaseFeatureDetail'),\n        ),\n      })\n    })\n  }\n}\n","import PluginManager from './PluginManager'\nimport { AnyConfigurationSchemaType } from './configuration/configurationSchema'\n\n/**\n * base class for a JBrowse plugin\n */\nexport default abstract class Plugin {\n  abstract name: string\n\n  url?: string\n\n  version?: string\n\n  install(_pluginManager: PluginManager): void {}\n\n  configure(_pluginManager: PluginManager): void {}\n\n  configurationSchema: AnyConfigurationSchemaType | undefined = undefined\n}\n\nexport type PluginConstructor = new (...args: unknown[]) => Plugin\n","// this is all the stuff that the pluginManager re-exports for plugins to use\nimport React from 'react'\nimport * as ReactDom from 'react-dom'\nimport * as mobx from 'mobx'\nimport * as mst from 'mobx-state-tree'\nimport * as mxreact from 'mobx-react'\nimport PropTypes from 'prop-types'\n\nimport * as MUIStyles from '@material-ui/core/styles'\n\n// @material-ui components\nimport * as MUICore from '@material-ui/core'\nimport * as MUIUtils from '@material-ui/core/utils'\nimport MUISvgIcon from '@material-ui/core/SvgIcon'\nimport * as MUILab from '@material-ui/lab'\nimport * as MUIDataGrid from '@mui/x-data-grid'\nimport MUIBox from '@material-ui/core/Box'\nimport MUIButton from '@material-ui/core/Button'\nimport MUIButtonGroup from '@material-ui/core/ButtonGroup'\nimport MUICard from '@material-ui/core/Card'\nimport MUICardContent from '@material-ui/core/CardContent'\nimport MUICheckbox from '@material-ui/core/Checkbox'\nimport MUIContainer from '@material-ui/core/Container'\nimport MUIDialog from '@material-ui/core/Dialog'\nimport MUIFormLabel from '@material-ui/core/FormLabel'\nimport MUIFormControl from '@material-ui/core/FormControl'\nimport MUIFormControlLabel from '@material-ui/core/FormControlLabel'\nimport MUIFormGroup from '@material-ui/core/FormGroup'\nimport MUIGrid from '@material-ui/core/Grid'\nimport MUIIcon from '@material-ui/core/Icon'\nimport MUIIconButton from '@material-ui/core/IconButton'\nimport MUIInputAdornment from '@material-ui/core/InputAdornment'\nimport MUILinearProgress from '@material-ui/core/LinearProgress'\nimport MUIListItemIcon from '@material-ui/core/ListItemIcon'\nimport MUIListItemText from '@material-ui/core/ListItemText'\nimport MUIMenu from '@material-ui/core/Menu'\nimport MUIMenuItem from '@material-ui/core/MenuItem'\nimport MUIRadio from '@material-ui/core/Radio'\nimport MUIRadioGroup from '@material-ui/core/RadioGroup'\nimport MUISelect from '@material-ui/core/Select'\nimport MUISnackbar from '@material-ui/core/Snackbar'\nimport MUISnackbarContent from '@material-ui/core/SnackbarContent'\nimport MUITextField from '@material-ui/core/TextField'\nimport MUITooltip from '@material-ui/core/Tooltip'\nimport MUITypography from '@material-ui/core/Typography'\n\n// material-ui lab\nimport ToggleButton from '@material-ui/lab/ToggleButton'\nimport ToggleButtonGroup from '@material-ui/lab/ToggleButtonGroup'\n\nimport * as BaseAdapterExports from '../data_adapters/BaseAdapter'\n\nimport * as BaseFeatureDetail from '../BaseFeatureWidget/BaseFeatureDetail'\n\nimport Base1DView from '../util/Base1DViewModel'\nimport * as pluggableElementTypes from '../pluggableElementTypes'\nimport ViewType from '../pluggableElementTypes/ViewType'\nimport AdapterType from '../pluggableElementTypes/AdapterType'\nimport DisplayType from '../pluggableElementTypes/DisplayType'\nimport TrackType from '../pluggableElementTypes/TrackType'\nimport WidgetType from '../pluggableElementTypes/WidgetType'\n\nimport * as pluggableElementTypeModels from '../pluggableElementTypes/models'\nimport * as ServerSideRendererType from '../pluggableElementTypes/renderers/ServerSideRendererType'\nimport CircularChordRendererType from '../pluggableElementTypes/renderers/CircularChordRendererType'\nimport * as BoxRendererType from '../pluggableElementTypes/renderers/BoxRendererType'\nimport * as FeatureRendererType from '../pluggableElementTypes/renderers/FeatureRendererType'\nimport * as RendererType from '../pluggableElementTypes/renderers/RendererType'\n\nimport * as Configuration from '../configuration'\nimport Plugin from '../Plugin'\nimport * as coreUi from '../ui'\nimport * as coreUtil from '../util'\nimport * as coreColor from '../util/color'\nimport * as coreLayouts from '../util/layouts'\nimport * as trackUtils from '../util/tracks'\nimport * as coreIo from '../util/io'\nimport * as coreMstReflection from '../util/mst-reflection'\nimport * as rxjs from '../util/rxjs'\nimport * as MUIColors from './material-ui-colors'\nimport * as mstTypes from '../util/types/mst'\n\nimport ReExportsList from './list'\n\nconst libs = {\n  mobx,\n  'mobx-state-tree': mst,\n  react: React,\n  'react-dom': ReactDom,\n  'mobx-react': mxreact,\n  'prop-types': PropTypes,\n\n  // material-ui 1st-level components\n  '@material-ui/core': MUICore,\n  // special case so plugins can easily use @material-ui/icons; don't remove\n  '@material-ui/core/SvgIcon': MUISvgIcon,\n  '@material-ui/core/utils': MUIUtils,\n  // end special case\n  '@material-ui/lab': MUILab,\n  '@mui/x-data-grid': MUIDataGrid,\n  '@material-ui/data-grid': MUIDataGrid,\n\n  // material-ui subcomponents, should get rid of these\n  '@material-ui/core/colors': MUIColors,\n  '@material-ui/core/styles': MUIStyles,\n  '@material-ui/core/Box': MUIBox,\n  '@material-ui/core/Button': MUIButton,\n  '@material-ui/core/ButtonGroup': MUIButtonGroup,\n  '@material-ui/core/Card': MUICard,\n  '@material-ui/core/CardContent': MUICardContent,\n  '@material-ui/core/Container': MUIContainer,\n  '@material-ui/core/Checkbox': MUICheckbox,\n  '@material-ui/core/Dialog': MUIDialog,\n  '@material-ui/core/FormGroup': MUIFormGroup,\n  '@material-ui/core/FormLabel': MUIFormLabel,\n  '@material-ui/core/FormControl': MUIFormControl,\n  '@material-ui/core/FormControlLabel': MUIFormControlLabel,\n  '@material-ui/core/Grid': MUIGrid,\n  '@material-ui/core/Icon': MUIIcon,\n  '@material-ui/core/IconButton': MUIIconButton,\n  '@material-ui/core/InputAdornment': MUIInputAdornment,\n  '@material-ui/core/LinearProgress': MUILinearProgress,\n  '@material-ui/core/ListItemIcon': MUIListItemIcon,\n  '@material-ui/core/ListItemText': MUIListItemText,\n  '@material-ui/core/Menu': MUIMenu,\n  '@material-ui/core/MenuItem': MUIMenuItem,\n  '@material-ui/core/RadioGroup': MUIRadioGroup,\n  '@material-ui/core/Radio': MUIRadio,\n  '@material-ui/core/Select': MUISelect,\n  '@material-ui/core/Snackbar': MUISnackbar,\n  '@material-ui/core/SnackbarContent': MUISnackbarContent,\n  '@material-ui/core/TextField': MUITextField,\n  '@material-ui/core/Tooltip': MUITooltip,\n  '@material-ui/core/Typography': MUITypography,\n\n  // @material-ui lab\n  '@material-ui/lab/ToggleButton': ToggleButton,\n  '@material-ui/lab/ToggleButtonGroup': ToggleButtonGroup,\n\n  '@jbrowse/core/Plugin': Plugin,\n  '@jbrowse/core/pluggableElementTypes': pluggableElementTypes,\n  '@jbrowse/core/pluggableElementTypes/ViewType': ViewType,\n  '@jbrowse/core/pluggableElementTypes/AdapterType': AdapterType,\n  '@jbrowse/core/pluggableElementTypes/DisplayType': DisplayType,\n  '@jbrowse/core/pluggableElementTypes/TrackType': TrackType,\n  '@jbrowse/core/pluggableElementTypes/WidgetType': WidgetType,\n\n  '@jbrowse/core/pluggableElementTypes/models': pluggableElementTypeModels,\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType':\n    ServerSideRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType':\n    CircularChordRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType':\n    BoxRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType':\n    FeatureRendererType,\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType': RendererType,\n  '@jbrowse/core/configuration': Configuration,\n  '@jbrowse/core/util/types/mst': mstTypes,\n  '@jbrowse/core/ui': coreUi,\n  '@jbrowse/core/util': coreUtil,\n  '@jbrowse/core/util/color': coreColor,\n  '@jbrowse/core/util/layouts': coreLayouts,\n  '@jbrowse/core/util/tracks': trackUtils,\n  '@jbrowse/core/util/Base1DViewModel': Base1DView,\n  '@jbrowse/core/util/io': coreIo,\n  '@jbrowse/core/util/mst-reflection': coreMstReflection,\n  '@jbrowse/core/util/rxjs': rxjs,\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail': BaseFeatureDetail,\n\n  '@jbrowse/core/data_adapters/BaseAdapter': BaseAdapterExports,\n}\n\n// make sure that all the items in the ReExports/list array (used by build systems and such)\n// are included here. it's OK if there are some additional ones that are not in the list\nReExportsList.forEach(name => {\n  if (!(name in libs)) {\n    throw new Error(`ReExports/modules is missing ${name}`)\n  }\n})\n\nexport default libs\n","export default [\n  'mobx',\n  'mobx-state-tree',\n  'react',\n  'react-dom',\n  'mobx-react',\n  'prop-types',\n\n  '@material-ui/core',\n  '@material-ui/core/SvgIcon',\n  '@material-ui/core/utils',\n  '@material-ui/lab',\n  '@mui/x-data-grid',\n\n  '@jbrowse/core/Plugin',\n  '@jbrowse/core/pluggableElementTypes',\n  '@jbrowse/core/pluggableElementTypes/ViewType',\n  '@jbrowse/core/pluggableElementTypes/AdapterType',\n  '@jbrowse/core/pluggableElementTypes/DisplayType',\n  '@jbrowse/core/pluggableElementTypes/TrackType',\n  '@jbrowse/core/pluggableElementTypes/WidgetType',\n\n  '@jbrowse/core/pluggableElementTypes/models',\n  '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType',\n  '@jbrowse/core/pluggableElementTypes/renderers/RendererType',\n  '@jbrowse/core/configuration',\n  '@jbrowse/core/util/types/mst',\n  '@jbrowse/core/ui',\n  '@jbrowse/core/util',\n  '@jbrowse/core/util/color',\n  '@jbrowse/core/util/layouts',\n  '@jbrowse/core/util/tracks',\n  '@jbrowse/core/util/Base1DViewModel',\n  '@jbrowse/core/util/io',\n  '@jbrowse/core/util/mst-reflection',\n  '@jbrowse/core/util/rxjs',\n  '@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail',\n\n  '@jbrowse/core/data_adapters/BaseAdapter',\n]\n","import modules from './modules'\n\nexport default modules\n","import React from 'react'\nimport TextSearchAdapterType from '../pluggableElementTypes/TextSearchAdapterType'\nimport { SearchType } from '../data_adapters/BaseAdapter'\n\nexport interface BaseResultArgs {\n  label: string\n\n  displayString?: string\n\n  renderingComponent?: React.ReactElement\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  locString?: string\n\n  refName?: string\n\n  trackId?: string\n\n  score?: number\n}\nexport default class BaseResult {\n  label: string\n\n  renderingComponent?: React.ReactElement\n\n  displayString?: string\n\n  matchedAttribute?: string\n\n  matchedObject?: object\n\n  textSearchAdapter?: TextSearchAdapterType\n\n  relevance?: SearchType\n\n  trackId?: string\n\n  score: number\n\n  locString?: string\n\n  constructor(args: BaseResultArgs) {\n    this.label = args.label\n    this.locString = args.locString\n    this.renderingComponent = args.renderingComponent\n    this.displayString = args.displayString\n    this.matchedAttribute = args.matchedAttribute\n    this.matchedObject = args.matchedObject\n    this.textSearchAdapter = args.textSearchAdapter\n    this.relevance = args.relevance\n    this.trackId = args.trackId\n    this.score = args.score || 1\n  }\n\n  getLabel() {\n    return this.label\n  }\n\n  getDisplayString() {\n    return this.displayString || this.label\n  }\n\n  getRenderingComponent() {\n    return this.renderingComponent\n  }\n\n  getTrackId() {\n    return this.trackId\n  }\n\n  getScore() {\n    return this.score\n  }\n\n  updateScore(newScore: number) {\n    this.score = newScore\n    return this.score\n  }\n\n  getId() {\n    return `${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`\n  }\n\n  getLocation() {\n    return this.locString || this.label\n  }\n}\n\nexport class RefSequenceResult extends BaseResult {\n  refName: string\n\n  constructor(args: BaseResultArgs) {\n    super(args)\n    this.refName = args.refName ?? ''\n  }\n\n  getLocation() {\n    return this.refName\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, IAnyModelType, IAnyComplexType, getEnv } from 'mobx-state-tree'\nimport { stringToJexlExpression } from '../util/jexlStrings'\nimport { FileLocation } from '../util/types/mst'\n\nfunction isValidColorString(/* str */) {\n  // TODO: check all the crazy cases for whether it's a valid HTML/CSS color string\n  return true\n}\nconst typeModels: { [typeName: string]: any } = {\n  stringArray: types.array(types.string),\n  stringArrayMap: types.map(types.array(types.string)),\n  numberMap: types.map(types.number),\n  boolean: types.boolean,\n  color: types.refinement('Color', types.string, isValidColorString),\n  integer: types.integer,\n  number: types.number,\n  string: types.string,\n  text: types.string,\n  fileLocation: FileLocation,\n  frozen: types.frozen(),\n}\n\n// default values we use if the defaultValue is malformed or does not work\nconst fallbackDefaults: { [typeName: string]: any } = {\n  stringArray: [],\n  stringArrayMap: {},\n  numberMap: {},\n  boolean: true,\n  color: 'black',\n  integer: 1,\n  number: 1,\n  string: '',\n  text: '',\n  fileLocation: { uri: '/path/to/resource.txt', locationType: 'UriLocation' },\n  frozen: {},\n}\n\nconst literalJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return self.value\n    },\n  },\n})\n\nconst objectJSON = (self: { value: any }) => ({\n  views: {\n    get valueJSON() {\n      return JSON.stringify(self.value)\n    },\n  },\n})\n\n// custom actions for modifying the value models\nconst typeModelExtensions: { [typeName: string]: (self: any) => any } = {\n  fileLocation: objectJSON,\n  number: literalJSON,\n  integer: literalJSON,\n  boolean: literalJSON,\n  frozen: objectJSON,\n  // special actions for working with stringArray slots\n  stringArray: (self: { value: string[] }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(val: string) {\n        self.value.push(val)\n      },\n      removeAtIndex(idx: number) {\n        self.value.splice(idx, 1)\n      },\n      setAtIndex(idx: number, val: string) {\n        self.value[idx] = val\n      },\n    },\n  }),\n  stringArrayMap: (self: { value: Map<string, string[]> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: any) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n      addToKey(key: string, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.push(val)\n      },\n      removeAtKeyIndex(key: string, idx: number) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar.splice(idx, 1)\n      },\n      setAtKeyIndex(key: string, idx: number, val: string) {\n        const ar = self.value.get(key)\n        if (!ar) {\n          throw new Error(`${key} not found`)\n        }\n        ar[idx] = val\n      },\n    },\n  }),\n  numberMap: (self: { value: Map<string, number> }) => ({\n    views: {\n      get valueJSON() {\n        return JSON.stringify(self.value)\n      },\n    },\n    actions: {\n      add(key: string, val: number) {\n        self.value.set(key, val)\n      },\n      remove(key: string) {\n        self.value.delete(key)\n      },\n    },\n  }),\n}\n\n// const FunctionStringType = types.refinement(\n//   'FunctionString',\n//   types.string,\n//   str => functionRegexp.test(str),\n// )\n\nconst JexlStringType = types.refinement('JexlString', types.string, str =>\n  str.startsWith('jexl:'),\n)\n\nexport interface ConfigSlotDefinition {\n  description?: string\n  /** custom base MST model for the slot's value */\n  model?: IAnyModelType | IAnyComplexType\n  /** name of the type of slot, e.g. \"string\", \"number\", \"stringArray\" */\n  type: string\n  /** default value of the slot */\n  defaultValue: any\n  /** parameter names of the function callback */\n  contextVariable?: string[]\n}\n\n/**\n * builds a MST model for a configuration slot\n *\n * @param slotName -\n * @param  definition -\n */\nexport default function ConfigSlot(\n  slotName: string,\n  {\n    description = '',\n    model,\n    type,\n    defaultValue,\n    contextVariable = [],\n  }: ConfigSlotDefinition,\n) {\n  if (!type) {\n    throw new Error('type name required')\n  }\n  if (!model) {\n    model = typeModels[type]\n  }\n  if (!model) {\n    throw new Error(\n      `no builtin config slot type \"${type}\", and no 'model' param provided`,\n    )\n  }\n\n  if (defaultValue === undefined) {\n    throw new Error(\"no 'defaultValue' provided\")\n  }\n\n  // if the `type` is something like `color`, then the model name\n  // here will be `ColorConfigSlot`\n  const configSlotModelName = `${slotName\n    .charAt(0)\n    .toUpperCase()}${slotName.slice(1)}ConfigSlot`\n  let slot = types\n    .model(configSlotModelName, {\n      name: types.literal(slotName),\n      description: types.literal(description),\n      type: types.literal(type),\n      value: types.optional(types.union(JexlStringType, model), defaultValue),\n    })\n    .volatile(() => ({\n      contextVariable,\n    }))\n    .views(self => ({\n      get isCallback() {\n        return String(self.value).startsWith('jexl:')\n      },\n    }))\n    .views(self => ({\n      get expr() {\n        if (self.isCallback) {\n          // compile as jexl function\n          const { pluginManager } = getEnv(self)\n          if (!pluginManager && typeof jest === 'undefined') {\n            console.warn(\n              'no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)',\n            )\n          }\n          return stringToJexlExpression(String(self.value), pluginManager?.jexl)\n        }\n        return { evalSync: () => self.value }\n      },\n\n      // JS representation of the value of this slot, suitable\n      // for embedding in either JSON or a JS function string.\n      // many of the data types override this in typeModelExtensions\n      get valueJSON(): any[] | Record<string, any> | string | undefined {\n        if (self.isCallback) {\n          return undefined\n        }\n        function json(value: { toJSON: Function } | any) {\n          if (value && value.toJSON) {\n            return value.toJSON()\n          }\n          return `\"${value}\"`\n        }\n        return json(self.value)\n      },\n    }))\n    .preProcessSnapshot(val =>\n      typeof val === 'object' && val.name === slotName\n        ? val\n        : {\n            name: slotName,\n            description,\n            type,\n            value: val,\n          },\n    )\n    .postProcessSnapshot(snap => {\n      if (typeof snap.value === 'object') {\n        return JSON.stringify(snap.value) !== JSON.stringify(defaultValue)\n          ? snap.value\n          : undefined\n      }\n      return snap.value !== defaultValue ? snap.value : undefined\n    })\n    .actions(self => ({\n      set(newVal: any) {\n        self.value = newVal\n      },\n      reset() {\n        self.value = defaultValue\n      },\n      convertToCallback() {\n        if (self.isCallback) {\n          return\n        }\n        self.value = `jexl:${self.valueJSON || \"''\"}`\n      },\n      convertToValue() {\n        if (!self.isCallback) {\n          return\n        }\n        // try calling it with no arguments\n        try {\n          const funcResult = self.expr.evalSync()\n          if (funcResult !== undefined) {\n            self.value = funcResult\n            return\n          }\n        } catch (e) {\n          /* ignore */\n        }\n        self.value = defaultValue\n        // if it is still a callback (happens if the defaultValue is a callback),\n        // then use the last-resort fallback default\n\n        // if defaultValue has jexl: string, run this part\n        if (self.isCallback) {\n          if (!(type in fallbackDefaults)) {\n            throw new Error(`no fallbackDefault defined for type ${type}`)\n          }\n          self.value = fallbackDefaults[type]\n        }\n      },\n    }))\n\n  // if there are any type-specific extensions (views or actions)\n  //  to the slot, add those in\n  if (typeModelExtensions[type]) {\n    slot = slot.extend(typeModelExtensions[type])\n  }\n\n  const completeModel = types.optional(slot, {\n    name: slotName,\n    type,\n    description,\n    value: defaultValue,\n  })\n  const m = completeModel\n  Object.defineProperty(m, 'isJBrowseConfigurationSlot', { value: true })\n  return m\n}\n","import {\n  types,\n  isStateTreeNode,\n  isType,\n  isLateType,\n  getSnapshot,\n  Instance,\n  IAnyType,\n  SnapshotOut,\n} from 'mobx-state-tree'\n\nimport { ElementId } from '../util/types/mst'\n\nimport ConfigSlot, { ConfigSlotDefinition } from './configurationSlot'\nimport { isConfigurationSchemaType } from './util'\n\nfunction isEmptyObject(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    !Array.isArray(thing) &&\n    thing !== null &&\n    Object.keys(thing).length === 0\n  )\n}\n\nfunction isEmptyArray(thing: unknown) {\n  return Array.isArray(thing) && thing.length === 0\n}\n\nexport interface ConfigurationSchemaDefinition {\n  [n: string]:\n    | ConfigSlotDefinition\n    | ConfigurationSchemaDefinition\n    | string\n    | number\n    | IAnyType\n}\n\ninterface ConfigurationSchemaOptions {\n  explicitlyTyped?: boolean\n  explicitIdentifier?: string\n  implicitIdentifier?: string | boolean\n  baseConfiguration?: AnyConfigurationSchemaType\n\n  actions?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  views?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  extend?: (self: unknown) => any // eslint-disable-line @typescript-eslint/no-explicit-any\n  preProcessSnapshot?: (snapshot: {}) => {}\n}\n\nfunction preprocessConfigurationSchemaArguments(\n  modelName: string,\n  inputSchemaDefinition: ConfigurationSchemaDefinition,\n  inputOptions: ConfigurationSchemaOptions = {},\n) {\n  if (typeof modelName !== 'string') {\n    throw new Error(\n      'first arg must be string name of the model that this config schema goes with',\n    )\n  }\n\n  // if we have a base configuration schema that we are\n  // extending, grab the slot definitions from that\n  let schemaDefinition = inputSchemaDefinition\n  let options = inputOptions\n  if (\n    inputOptions.baseConfiguration &&\n    inputOptions.baseConfiguration.jbrowseSchemaDefinition\n  ) {\n    schemaDefinition = {\n      ...inputOptions.baseConfiguration.jbrowseSchemaDefinition,\n      ...schemaDefinition,\n    }\n    options = {\n      ...(inputOptions.baseConfiguration.jbrowseSchemaOptions || {}),\n      ...inputOptions,\n    }\n    delete options.baseConfiguration\n  }\n  return { schemaDefinition, options }\n}\n\nfunction makeConfigurationSchemaModel<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions,\n>(modelName: string, schemaDefinition: DEFINITION, options: OPTIONS) {\n  // now assemble the MST model of the configuration schema\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const modelDefinition: Record<string, any> = {}\n  let identifier\n\n  if (options.explicitlyTyped) {\n    modelDefinition.type = types.optional(types.literal(modelName), modelName)\n  }\n\n  if (options.explicitIdentifier && options.implicitIdentifier) {\n    throw new Error(\n      `Cannot have both explicit and implicit identifiers in ${modelName}`,\n    )\n  }\n  if (options.explicitIdentifier) {\n    if (typeof options.explicitIdentifier === 'string') {\n      modelDefinition[options.explicitIdentifier] = types.identifier\n      identifier = options.explicitIdentifier\n    } else {\n      modelDefinition.id = types.identifier\n      identifier = 'id'\n    }\n  } else if (options.implicitIdentifier) {\n    if (typeof options.implicitIdentifier === 'string') {\n      modelDefinition[options.implicitIdentifier] = ElementId\n      identifier = options.implicitIdentifier\n    } else {\n      modelDefinition.id = ElementId\n      identifier = 'id'\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const volatileConstants: Record<string, any> = {\n    isJBrowseConfigurationSchema: true,\n    jbrowseSchema: {\n      modelName,\n      definition: schemaDefinition,\n      options,\n    },\n  }\n  Object.entries(schemaDefinition).forEach(([slotName, slotDefinition]) => {\n    if (\n      (isType(slotDefinition) && isLateType(slotDefinition)) ||\n      isConfigurationSchemaType(slotDefinition)\n    ) {\n      // this is either an MST late() type (which we assume to be a sub-configuration),\n      // or an actual sub-configuration\n      modelDefinition[slotName] = slotDefinition\n    } else if (\n      typeof slotDefinition === 'string' ||\n      typeof slotDefinition === 'number'\n    ) {\n      volatileConstants[slotName] = slotDefinition\n    } else if (typeof slotDefinition === 'object') {\n      // this is a slot definition\n      if (!slotDefinition.type) {\n        throw new Error(`no type set for config slot ${modelName}.${slotName}`)\n      }\n      try {\n        modelDefinition[slotName] = ConfigSlot(\n          slotName,\n          slotDefinition as ConfigSlotDefinition,\n        )\n      } catch (e) {\n        throw new Error(\n          `invalid config slot definition for ${modelName}.${slotName}: ${e}`,\n        )\n      }\n    } else {\n      throw new Error(\n        `invalid configuration schema definition, \"${slotName}\" must be either a valid configuration slot definition, a constant, or a nested configuration schema`,\n      )\n    }\n  })\n\n  let completeModel = types\n    .model(`${modelName}ConfigurationSchema`, modelDefinition)\n    .actions(self => ({\n      setSubschema(slotName: string, data: unknown) {\n        if (!isConfigurationSchemaType(modelDefinition[slotName])) {\n          throw new Error(`${slotName} is not a subschema, cannot replace`)\n        }\n        const newSchema = isStateTreeNode(data)\n          ? data\n          : modelDefinition[slotName].create(data)\n        self[slotName] = newSchema\n        return newSchema\n      },\n    }))\n\n  if (Object.keys(volatileConstants).length) {\n    completeModel = completeModel.volatile((/* self */) => volatileConstants)\n  }\n  if (options.actions) {\n    completeModel = completeModel.actions(options.actions)\n  }\n  if (options.views) {\n    completeModel = completeModel.views(options.views)\n  }\n  if (options.extend) {\n    completeModel = completeModel.extend(options.extend)\n  }\n\n  const identifierDefault = identifier ? { [identifier]: 'placeholderId' } : {}\n  const modelDefault = options.explicitlyTyped\n    ? { type: modelName, ...identifierDefault }\n    : identifierDefault\n\n  const defaultSnap = getSnapshot(completeModel.create(modelDefault))\n  completeModel = completeModel.postProcessSnapshot(snap => {\n    const newSnap: SnapshotOut<typeof completeModel> = {}\n    let matchesDefault = true\n    // let keyCount = 0\n    for (const [key, value] of Object.entries(snap)) {\n      if (matchesDefault) {\n        if (typeof defaultSnap[key] === 'object' && typeof value === 'object') {\n          if (JSON.stringify(defaultSnap[key]) !== JSON.stringify(value)) {\n            matchesDefault = false\n          }\n        } else if (defaultSnap[key] !== value) {\n          matchesDefault = false\n        }\n      }\n      if (\n        value !== undefined &&\n        volatileConstants[key] === undefined &&\n        !isEmptyObject(value) &&\n        !isEmptyArray(value)\n      ) {\n        // keyCount += 1\n        newSnap[key] = value\n      }\n    }\n    if (matchesDefault) {\n      return {}\n    }\n    return newSnap\n  })\n\n  if (options.preProcessSnapshot) {\n    completeModel = completeModel.preProcessSnapshot(options.preProcessSnapshot)\n  }\n\n  return types.optional(completeModel, modelDefault)\n}\n\nexport interface AnyConfigurationSchemaType\n  extends ReturnType<typeof makeConfigurationSchemaModel> {\n  isJBrowseConfigurationSchema: boolean\n  jbrowseSchemaDefinition: ConfigurationSchemaDefinition\n  jbrowseSchemaOptions: ConfigurationSchemaOptions\n  type: string\n}\n\nexport type AnyConfigurationModel = Instance<AnyConfigurationSchemaType>\n\nexport type ConfigurationModel<SCHEMA extends AnyConfigurationSchemaType> =\n  Instance<SCHEMA>\n\nexport function ConfigurationSchema<\n  DEFINITION extends ConfigurationSchemaDefinition,\n  OPTIONS extends ConfigurationSchemaOptions,\n>(\n  modelName: string,\n  inputSchemaDefinition: DEFINITION,\n  inputOptions?: OPTIONS,\n) {\n  const { schemaDefinition, options } = preprocessConfigurationSchemaArguments(\n    modelName,\n    inputSchemaDefinition,\n    inputOptions,\n  )\n  const schemaType = makeConfigurationSchemaModel(\n    modelName,\n    schemaDefinition,\n    options,\n  ) as AnyConfigurationSchemaType\n  // saving a couple of jbrowse-specific things in the type object. hope nobody gets mad.\n  schemaType.isJBrowseConfigurationSchema = true\n  schemaType.jbrowseSchemaDefinition = schemaDefinition\n  schemaType.jbrowseSchemaOptions = options\n  return schemaType\n}\n\nexport function ConfigurationReference(schemaType: IAnyType) {\n  return types.union(types.reference(schemaType), schemaType)\n}\n","import {\n  isStateTreeNode,\n  getSnapshot,\n  getType,\n  isMapType,\n  isType,\n  isUnionType,\n  isOptionalType,\n  isArrayType,\n  isModelType,\n  isLateType,\n} from 'mobx-state-tree'\n\nimport {\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n} from './configurationSchema'\nimport {\n  getUnionSubTypes,\n  getDefaultValue,\n  getSubType,\n  resolveLateType,\n} from '../util/mst-reflection'\n\n/**\n * given a configuration model (an instance of a ConfigurationSchema),\n * read the configuration variable at the given path\n *\n * @param model - instance of ConfigurationSchema\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *  will be sent to each of the slotNames\n */\nexport function readConfObject(\n  confObject: AnyConfigurationModel,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): any {\n  if (!confObject) {\n    throw new TypeError('must provide conf object to read')\n  }\n  if (!slotPath) {\n    return JSON.parse(JSON.stringify(getSnapshot(confObject)))\n  }\n  if (typeof slotPath === 'string') {\n    let slot = confObject[slotPath]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !slot &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      slot = confObject.get(slotPath)\n    }\n    if (!slot) {\n      return undefined\n      // if we want to be very strict about config slots, we could uncomment the below\n      // instead of returning undefine\n      //\n      // const modelType = getType(model)\n      // const schemaType = model.configuration && getType(model.configuration)\n      // throw new Error(\n      //   `no slot \"${slotName}\" found in ${modelType.name} configuration (${\n      //     schemaType.name\n      //   })`,\n      // )\n    }\n\n    if (slot.expr) {\n      const appliedFunc = slot.expr.evalSync(args)\n      if (isStateTreeNode(appliedFunc)) {\n        return JSON.parse(JSON.stringify(getSnapshot(appliedFunc)))\n      }\n      return appliedFunc\n    }\n    if (isStateTreeNode(slot)) {\n      return JSON.parse(JSON.stringify(getSnapshot(slot)))\n    }\n    return slot\n  }\n\n  const slotName = slotPath[0]\n  if (slotPath.length > 1) {\n    const newPath = slotPath.slice(1)\n    let subConf = confObject[slotName]\n    // check for the subconf being a map if we don't find it immediately\n    if (\n      !subConf &&\n      isStateTreeNode(confObject) &&\n      isMapType(getType(confObject))\n    ) {\n      subConf = confObject.get(slotName)\n    }\n    return subConf ? readConfObject(subConf, newPath, args) : undefined\n  }\n  return readConfObject(confObject, slotName, args)\n}\n\n/**\n * helper method for readConfObject, reads the config from a mst model\n *\n * @param model - object containing a 'configuration' member\n * @param slotPaths - array of paths to read\n * @param args - extra arguments e.g. for a feature callback,\n *   will be sent to each of the slotNames\n */\nexport function getConf(\n  model: unknown,\n  slotPath: string[] | string | undefined = undefined,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  args: Record<string, any> = {},\n) {\n  if (!model) {\n    throw new TypeError('must provide a model object')\n  }\n  const { configuration } = model as { configuration: unknown }\n  if (isConfigurationModel(configuration)) {\n    return readConfObject(configuration, slotPath, args)\n  }\n  throw new TypeError('cannot getConf on this model, it has no configuration')\n}\n\n/**\n * given a union of explicitly typed configuration schema types,\n * extract an array of the type names contained in the union\n *\n * @param unionType -\n * @returns Array of type names contained in the union\n */\nexport function getTypeNamesFromExplicitlyTypedUnion(maybeUnionType: unknown) {\n  if (isType(maybeUnionType)) {\n    maybeUnionType = resolveLateType(maybeUnionType)\n    // @ts-ignore\n    if (isUnionType(maybeUnionType)) {\n      const typeNames: string[] = []\n      getUnionSubTypes(maybeUnionType).forEach(type => {\n        type = resolveLateType(type)\n        let typeName = getTypeNamesFromExplicitlyTypedUnion(type)\n        if (!typeName.length) {\n          const def = getDefaultValue(type)\n          typeName = [def.type]\n        }\n        if (!typeName[0]) {\n          // debugger\n          throw new Error(`invalid config schema type ${type}`)\n        }\n        typeNames.push(...typeName)\n      })\n      return typeNames\n    }\n  }\n  return []\n}\n\nexport function isBareConfigurationSchemaType(\n  thing: unknown,\n): thing is AnyConfigurationSchemaType {\n  if (isType(thing)) {\n    if (\n      isModelType(thing) &&\n      ('isJBrowseConfigurationSchema' in thing ||\n        thing.name.includes('ConfigurationSchema'))\n    ) {\n      return true\n    }\n    // if it's a late type, assume its a config schema\n    if (isLateType(thing)) {\n      return true\n    }\n  }\n  return false\n}\n\nexport function isConfigurationSchemaType(thing: unknown): boolean {\n  if (!isType(thing)) {\n    return false\n  }\n\n  // written as a series of if-statements instead of a big logical OR\n  // because this construction gives much better debugging backtraces.\n\n  // also, note that the order of these statements matters, because\n  // for example some union types are also optional types\n\n  if (isBareConfigurationSchemaType(thing)) {\n    return true\n  }\n\n  if (isUnionType(thing)) {\n    return getUnionSubTypes(thing).every(\n      t => isConfigurationSchemaType(t) || t.name === 'undefined',\n    )\n  }\n\n  if (isOptionalType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isArrayType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  if (isMapType(thing) && isConfigurationSchemaType(getSubType(thing))) {\n    return true\n  }\n\n  return false\n}\n\nexport function isConfigurationModel(\n  thing: unknown,\n): thing is AnyConfigurationModel {\n  return isStateTreeNode(thing) && isConfigurationSchemaType(getType(thing))\n}\n\nexport function isConfigurationSlotType(thing: unknown) {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'isJBrowseConfigurationSlot' in thing\n  )\n}\n","import { Observable, merge } from 'rxjs'\nimport { toArray } from 'rxjs/operators'\nimport { isStateTreeNode, getSnapshot } from 'mobx-state-tree'\nimport { ObservableCreate } from '../util/rxjs'\nimport { checkAbortSignal } from '../util'\nimport { Feature } from '../util/simpleFeature'\nimport {\n  readConfObject,\n  AnyConfigurationModel,\n  ConfigurationSchema,\n} from '../configuration'\nimport { getSubAdapterType } from './dataAdapterCache'\nimport { AugmentedRegion as Region, NoAssemblyRegion } from '../util/types'\nimport { blankStats, rectifyStats, scoresToStats } from '../util/stats'\nimport BaseResult from '../TextSearch/BaseResults'\nimport idMaker from '../util/idMaker'\nimport PluginManager from '../PluginManager'\n\nexport interface BaseOptions {\n  signal?: AbortSignal\n  bpPerPx?: number\n  sessionId?: string\n  statusCallback?: (message: string) => void\n  headers?: Record<string, string>\n  [key: string]: unknown\n}\n\nexport type SearchType = 'full' | 'prefix' | 'exact'\n\nexport interface BaseArgs {\n  searchType?: SearchType\n  queryString: string\n  signal?: AbortSignal\n  limit?: number\n  pageNumber?: number\n}\n// see\n// https://www.typescriptlang.org/docs/handbook/2/classes.html#abstract-construct-signatures\n// for why this is the abstract construct signature\nexport interface AnyAdapter {\n  new (\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager | undefined,\n  ): AnyDataAdapter\n}\n\nexport type AnyDataAdapter =\n  | BaseAdapter\n  | BaseFeatureDataAdapter\n  | BaseRefNameAliasAdapter\n  | BaseTextSearchAdapter\n  | RegionsAdapter\n  | BaseSequenceAdapter\n\nexport interface SequenceAdapter\n  extends BaseFeatureDataAdapter,\n    RegionsAdapter {}\n\nexport abstract class BaseAdapter {\n  public id: string\n\n  static capabilities = [] as string[]\n\n  constructor(\n    public config: AnyConfigurationModel = ConfigurationSchema(\n      'empty',\n      {},\n    ).create(),\n    public getSubAdapter?: getSubAdapterType,\n    public pluginManager?: PluginManager,\n  ) {\n    // note: we use switch on jest here for more simple feature IDs\n    // in test environment\n    if (typeof jest === 'undefined') {\n      const data = isStateTreeNode(config) ? getSnapshot(config) : config\n      this.id = `${idMaker(data)}`\n    } else {\n      this.id = 'test'\n    }\n  }\n\n  /**\n   * Called to provide a hint that data tied to a certain region will not be\n   * needed for the forseeable future and can be purged from caches, etc\n   * @param region - Region\n   */\n  public abstract freeResources(region: Region): void\n}\n\nexport interface Stats {\n  featureDensity?: number\n  fetchSizeLimit?: number\n  bytes?: number\n}\n\n/**\n * Base class for feature adapters to extend. Defines some methods that\n * subclasses must implement.\n */\nexport abstract class BaseFeatureDataAdapter extends BaseAdapter {\n  /**\n   * Get all reference sequence names used in the data source\n   *\n   * NOTE: If an adapter is unable to determine the reference sequence names,\n   * the array will be empty\n   * @param opts - Feature adapter options\n   */\n  public abstract getRefNames(opts?: BaseOptions): Promise<string[]>\n  // public abstract async getRefNames(opts?: BaseOptions): Promise<string[]>\n  //   await this.setup()\n  //   const { refNames } = this.metadata\n  //   return refNames\n  // }\n  //\n  getConf(arg: string | string[]) {\n    return readConfObject(this.config, arg)\n  }\n\n  /**\n   * Get features from the data source that overlap a region\n   * @param region - Region\n   * @param options - Feature adapter options\n   * @returns Observable of Feature objects in the region\n   */\n  public abstract getFeatures(\n    region: Region,\n    opts?: BaseOptions,\n  ): Observable<Feature>\n  // public abstract getFeatures(\n  //   region: Region,\n  //   opts: BaseOptions,\n  // ): Observable<Feature> {\n  //   return ObservableCreate(observer => {\n  //     const records = getRecords(assembly, refName, start, end)\n  //     records.forEach(record => {\n  //       observer.next(this.recordToFeature(record))\n  //     })\n  //     observer.complete()\n  //   })\n  // }\n\n  /**\n   * Return \"header info\" that is fetched from the data file, or other info\n   * that would not simply be in the config of the file. The return value can\n   * be `{tag:string, data: any}[]` e.g. list of tags with their values which\n   * is how VCF,BAM,CRAM return values for getInfo or it can be a nested JSON\n   * object\n   */\n  public async getHeader(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Return info that is primarily used for interpreting the data that is there,\n   * primarily in reference to being used for augmenting feature details panels\n   */\n  public async getMetadata(_opts?: BaseOptions): Promise<unknown> {\n    return null\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   */\n  public getFeaturesInRegion(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const hasData = await this.hasDataForRefName(region.refName, opts)\n      checkAbortSignal(opts.signal)\n      if (!hasData) {\n        observer.complete()\n      } else {\n        this.getFeatures(region, opts).subscribe(observer)\n      }\n    })\n  }\n\n  /**\n   * Checks if the store has data for the given assembly and reference\n   * sequence, and then gets the features in the region if it does.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters\n   * that are frequently called on multiple regions simultaneously may\n   * want to implement a more efficient custom version of this method.\n   *\n   * Currently this just calls getFeatureInRegion for each region. Adapters that\n   * are frequently called on multiple regions simultaneously may want to\n   * implement a more efficient custom version of this method.\n   * @param regions - Regions\n   * @param opts - Feature adapter options\n   * @returns Observable of Feature objects in the regions\n   */\n  public getFeaturesInMultipleRegions(\n    regions: Region[],\n    opts: BaseOptions = {},\n  ) {\n    return merge(\n      ...regions.map(region => {\n        return this.getFeaturesInRegion(region, opts)\n      }),\n    )\n  }\n\n  /**\n   * Check if the store has data for the given reference name.\n   * @param refName - Name of the reference sequence\n   * @returns Whether data source has data for the given reference name\n   */\n  public async hasDataForRefName(refName: string, opts: BaseOptions = {}) {\n    const refNames = await this.getRefNames(opts)\n    return refNames.includes(refName)\n  }\n\n  public async getRegionStats(region: Region, opts?: BaseOptions) {\n    const feats = this.getFeatures(region, opts)\n    return scoresToStats(region, feats)\n  }\n\n  public async getMultiRegionStats(regions: Region[] = [], opts?: BaseOptions) {\n    if (!regions.length) {\n      return blankStats()\n    }\n    const feats = await Promise.all(\n      regions.map(region => this.getRegionStats(region, opts)),\n    )\n\n    const scoreMax = feats.map(a => a.scoreMax).reduce((a, b) => Math.max(a, b))\n    const scoreMin = feats.map(a => a.scoreMin).reduce((a, b) => Math.min(a, b))\n    const scoreSum = feats.reduce((a, b) => a + b.scoreSum, 0)\n    const scoreSumSquares = feats.reduce((a, b) => a + b.scoreSumSquares, 0)\n    const featureCount = feats.reduce((a, b) => a + b.featureCount, 0)\n    const basesCovered = feats.reduce((a, b) => a + b.basesCovered, 0)\n\n    return rectifyStats({\n      scoreMin,\n      scoreMax,\n      featureCount,\n      basesCovered,\n      scoreSumSquares,\n      scoreSum,\n    })\n  }\n\n  public async estimateRegionsStats(regions: Region[], opts?: BaseOptions) {\n    if (!regions.length) {\n      throw new Error('No regions to estimate stats for')\n    }\n    const region = regions[0]\n    let lastTime = +Date.now()\n    const statsFromInterval = async (length: number, expansionTime: number) => {\n      const { start, end } = region\n      const sampleCenter = start * 0.75 + end * 0.25\n      const query = {\n        ...region,\n        start: Math.max(0, Math.round(sampleCenter - length / 2)),\n        end: Math.min(Math.round(sampleCenter + length / 2), end),\n      }\n\n      const features = await this.getFeatures(query, opts)\n        .pipe(toArray())\n        .toPromise()\n\n      return maybeRecordStats(\n        length,\n        { featureDensity: features.length / length },\n        features.length,\n        expansionTime,\n      )\n    }\n\n    const maybeRecordStats = async (\n      interval: number,\n      stats: Stats,\n      statsSampleFeatures: number,\n      expansionTime: number,\n    ): Promise<Stats> => {\n      const refLen = region.end - region.start\n      if (statsSampleFeatures >= 70 || interval * 2 > refLen) {\n        return stats\n      } else if (expansionTime <= 5000) {\n        const currTime = +Date.now()\n        expansionTime += currTime - lastTime\n        lastTime = currTime\n        return statsFromInterval(interval * 2, expansionTime)\n      } else {\n        console.warn(\n          \"Stats estimation reached timeout, or didn't get enough features\",\n        )\n        return { featureDensity: Infinity }\n      }\n    }\n\n    return statsFromInterval(1000, 0)\n  }\n}\n\nexport interface RegionsAdapter extends BaseAdapter {\n  getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n\nexport abstract class BaseSequenceAdapter\n  extends BaseFeatureDataAdapter\n  implements RegionsAdapter\n{\n  async estimateRegionsStats() {\n    return { featureDensity: 0 }\n  }\n\n  abstract getRegions(opts: BaseOptions): Promise<NoAssemblyRegion[]>\n}\n\nexport function isSequenceAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseSequenceAdapter {\n  return 'getRegions' in thing && 'getFeatures' in thing\n}\n\nexport function isRegionsAdapter(\n  thing: AnyDataAdapter,\n): thing is RegionsAdapter {\n  return 'getRegions' in thing\n}\n\nexport function isFeatureAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseFeatureDataAdapter {\n  return 'getFeatures' in thing\n}\n\nexport interface Alias {\n  refName: string\n  aliases: string[]\n}\nexport interface BaseRefNameAliasAdapter extends BaseAdapter {\n  getRefNameAliases(opts: BaseOptions): Promise<Alias[]>\n}\nexport function isRefNameAliasAdapter(\n  thing: object,\n): thing is BaseRefNameAliasAdapter {\n  return 'getRefNameAliases' in thing\n}\nexport interface BaseTextSearchAdapter extends BaseAdapter {\n  searchIndex(args: BaseArgs): Promise<BaseResult[]>\n}\nexport function isTextSearchAdapter(\n  thing: AnyDataAdapter,\n): thing is BaseTextSearchAdapter {\n  return 'searchIndex' in thing\n}\n","import { SnapshotIn } from 'mobx-state-tree'\nimport PluginManager from '../PluginManager'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyDataAdapter } from './BaseAdapter'\nimport { Region } from '../util/types'\nimport idMaker from '../util/idMaker'\n\nfunction adapterConfigCacheKey(\n  adapterConfig: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  return `${idMaker(adapterConfig)}`\n}\n\ninterface AdapterCacheEntry {\n  dataAdapter: AnyDataAdapter\n  sessionIds: Set<string>\n}\n\nlet adapterCache: Record<string, AdapterCacheEntry> = {}\n\n/**\n * instantiate a data adapter, or return an already-instantiated one if we have one with the same\n * configuration\n *\n * @param pluginManager -\n * @param sessionId - session ID of the associated worker session.\n *   used for reference counting\n * @param adapterConfigSnapshot - plain-JS configuration snapshot for the adapter\n */\nexport async function getAdapter(\n  pluginManager: PluginManager,\n  sessionId: string,\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) {\n  // cache the adapter object\n  const cacheKey = adapterConfigCacheKey(adapterConfigSnapshot)\n  if (!adapterCache[cacheKey]) {\n    const adapterType = (adapterConfigSnapshot || {}).type\n    if (!adapterType) {\n      throw new Error(\n        'could not determine adapter type from adapter config snapshot',\n      )\n    }\n    const dataAdapterType = pluginManager.getAdapterType(adapterType)\n    if (!dataAdapterType) {\n      throw new Error(`unknown data adapter type ${adapterType}`)\n    }\n\n    // instantiate the data adapter's config schema so it gets its defaults,\n    // callbacks, etc\n    const adapterConfig = dataAdapterType.configSchema.create(\n      adapterConfigSnapshot,\n      { pluginManager },\n    )\n\n    const getSubAdapter = getAdapter.bind(null, pluginManager, sessionId)\n\n    // instantiate the adapter itself with its config schema, and a bound\n    // func that it can use to get any inner adapters\n    // (such as sequence adapters or wrapped subadapters) that it needs\n    //\n    const { AdapterClass, getAdapterClass } = dataAdapterType\n\n    // @ts-ignore\n    const CLASS = AdapterClass || (await getAdapterClass())\n    if (!CLASS) {\n      throw new Error('Failed to get adapter')\n    }\n\n    const dataAdapter = new CLASS(adapterConfig, getSubAdapter, pluginManager)\n\n    // store it in our cache\n    adapterCache[cacheKey] = {\n      dataAdapter,\n      sessionIds: new Set([sessionId]),\n    }\n  }\n\n  const cacheEntry = adapterCache[cacheKey]\n  cacheEntry.sessionIds.add(sessionId)\n\n  return cacheEntry\n}\n\n/**\n * this is a callback that is passed to adapters that\n * allows them to get any sub-adapters that they need\n * internally, staying with the same worker session ID\n */\nexport type getSubAdapterType = (\n  adapterConfigSnapshot: SnapshotIn<AnyConfigurationSchemaType>,\n) => ReturnType<typeof getAdapter>\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function freeAdapterResources(specification: Record<string, any>) {\n  let deleteCount = 0\n\n  const specKeys = Object.keys(specification)\n\n  // if we don't specify a range, delete any adapters that are\n  // only associated with that session\n  if (specKeys.length === 1 && specKeys[0] === 'sessionId') {\n    const { sessionId } = specification\n    Object.entries(adapterCache).forEach(([cacheKey, cacheEntry]) => {\n      cacheEntry.sessionIds.delete(sessionId)\n      if (cacheEntry.sessionIds.size === 0) {\n        deleteCount += 1\n        delete adapterCache[cacheKey]\n      }\n    })\n  } else {\n    // otherwise call freeResources on all the cached data adapters\n    Object.values(adapterCache).forEach(cacheEntry => {\n      if (!cacheEntry.dataAdapter.freeResources) {\n        console.warn(cacheEntry.dataAdapter, 'does not implement freeResources')\n      } else {\n        const regions =\n          specification.regions ||\n          (specification.region ? [specification.region] : [])\n        regions.forEach((region: Region) => {\n          if (region.refName !== undefined) {\n            cacheEntry.dataAdapter.freeResources(region)\n          }\n        })\n      }\n    })\n  }\n\n  return deleteCount\n}\n\nexport function clearAdapterCache() {\n  adapterCache = {}\n}\n","/* eslint curly:error */\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport type AdapterMetadata = {\n  category: string | null\n  hiddenFromGUI: boolean | null\n  displayName: string | null\n  description: string | null\n}\n\nexport default class AdapterType extends PluggableElementBase {\n  AdapterClass?: AnyAdapter\n\n  getAdapterClass: () => Promise<AnyAdapter>\n\n  configSchema: AnyConfigurationSchemaType\n\n  adapterCapabilities: string[]\n\n  adapterMetadata?: AdapterMetadata\n\n  constructor(\n    stuff: {\n      name: string\n      configSchema: AnyConfigurationSchemaType\n      adapterCapabilities?: string[]\n      adapterMetadata?: AdapterMetadata\n    } & (\n      | { AdapterClass: AnyAdapter }\n      | { getAdapterClass: () => Promise<AnyAdapter> }\n    ),\n  ) {\n    super(stuff)\n    if ('AdapterClass' in stuff) {\n      this.AdapterClass = stuff.AdapterClass\n      this.getAdapterClass = async () => stuff.AdapterClass\n    } else if ('getAdapterClass' in stuff) {\n      this.getAdapterClass = stuff.getAdapterClass\n    } else {\n      throw new Error(\n        `no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`,\n      )\n    }\n    this.configSchema = stuff.configSchema\n    this.adapterCapabilities = stuff.adapterCapabilities || []\n\n    this.adapterMetadata = stuff.adapterMetadata\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../util'\n\nexport default class ConnectionType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayName: string\n\n  description: string\n\n  url: string\n\n  configEditorComponent?: AnyReactComponentType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n    displayName: string\n    description: string\n    configEditorComponent?: AnyReactComponentType\n    url: string\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.displayName = stuff.displayName\n    this.description = stuff.description\n    this.url = stuff.url\n    this.configEditorComponent = stuff.configEditorComponent\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for connection ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema defined for connection ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyReactComponentType } from '../util'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class DisplayType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  ReactComponent: AnyReactComponentType\n\n  trackType: string\n\n  viewType: string\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    trackType: string\n    viewType: string\n    configSchema: AnyConfigurationSchemaType\n    ReactComponent: AnyReactComponentType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    this.ReactComponent = stuff.ReactComponent\n    this.trackType = stuff.trackType\n    this.viewType = stuff.viewType\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for display ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for display ${this.name}`)\n    }\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent provided for display ${this.name}`)\n    }\n    if (!this.trackType) {\n      throw new Error(`no trackType provided for display ${this.name}`)\n    }\n    if (!this.viewType) {\n      throw new Error(`no viewType provided for display ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class InternetAccountType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(\n        `no stateModel defined for internet account type ${this.name}`,\n      )\n    }\n    if (!this.configSchema) {\n      throw new Error(\n        `no configSchema provided for internet account type ${this.name}`,\n      )\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n}\n","export default abstract class PluggableElementBase {\n  name = ''\n\n  constructor(args: { name: string }) {\n    this.name = args.name\n  }\n}\n","import PluginManager from '../PluginManager'\nimport PluggableElementBase from './PluggableElementBase'\nimport { setBlobMap, getBlobMap } from '../util/tracks'\nimport { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport {\n  isAppRootModel,\n  isUriLocation,\n  isAuthNeededException,\n  RetryError,\n  UriLocation,\n} from '../util/types'\n\nimport {\n  deserializeAbortSignal,\n  isRemoteAbortSignal,\n  RemoteAbortSignal,\n} from '../rpc/remoteAbortSignals'\n\nexport type RpcMethodConstructor = new (pm: PluginManager) => RpcMethodType\n\nexport default abstract class RpcMethodType extends PluggableElementBase {\n  name = 'UNKNOWN'\n\n  constructor(public pluginManager: PluginManager) {\n    super({ name: '' })\n  }\n\n  async serializeArguments(args: {}, _rpcDriverClassName: string): Promise<{}> {\n    const blobMap = getBlobMap()\n    await this.augmentLocationObjects(args)\n    return { ...args, blobMap }\n  }\n\n  async serializeNewAuthArguments(loc: UriLocation) {\n    const rootModel = this.pluginManager.rootModel\n\n    // args dont need auth or already have auth\n    if (!isAppRootModel(rootModel) || loc.internetAccountPreAuthorization) {\n      return loc\n    }\n\n    const account = rootModel?.findAppropriateInternetAccount(loc)\n\n    if (account) {\n      loc.internetAccountPreAuthorization =\n        await account.getPreAuthorizationInformation(loc)\n    }\n    return loc\n  }\n\n  async deserializeArguments<\n    SERIALIZED extends {\n      signal?: RemoteAbortSignal\n      blobMap?: Record<string, File>\n    },\n  >(serializedArgs: SERIALIZED, _rpcDriverClassName: string) {\n    if (serializedArgs.blobMap) {\n      setBlobMap(serializedArgs.blobMap)\n    }\n    const { signal } = serializedArgs\n    if (signal && isRemoteAbortSignal(signal)) {\n      return { ...serializedArgs, signal: deserializeAbortSignal(signal) }\n    }\n\n    return { ...serializedArgs, signal: undefined }\n  }\n\n  abstract execute(\n    serializedArgs: unknown,\n    rpcDriverClassName: string,\n  ): Promise<unknown>\n\n  async serializeReturn(\n    originalReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ) {\n    return originalReturn\n  }\n\n  async deserializeReturn(\n    serializedReturn: unknown,\n    _args: unknown,\n    _rpcDriverClassName: string,\n  ): Promise<unknown> {\n    let r\n    const { rootModel } = this.pluginManager\n    try {\n      r = await serializedReturn\n    } catch (error) {\n      if (isAuthNeededException(error)) {\n        // @ts-ignore\n        const retryAccount = rootModel?.createEphemeralInternetAccount(\n          `HTTPBasicInternetAccount-${new URL(error.url).origin}`,\n          {},\n          error.url,\n        )\n        throw new RetryError(\n          'Retrying with created internet account',\n          retryAccount.internetAccountId,\n        )\n      }\n      throw error\n    }\n    return r\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async augmentLocationObjects(thing: any): Promise<any> {\n    if (isStateTreeNode(thing) && !isAlive(thing)) {\n      return thing\n    }\n\n    if (isUriLocation(thing)) {\n      await this.serializeNewAuthArguments(thing)\n    }\n    if (Array.isArray(thing)) {\n      for (const val of thing) {\n        await this.augmentLocationObjects(val)\n      }\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      for (const value of Object.values(thing)) {\n        if (Array.isArray(value)) {\n          for (const val of value) {\n            await this.augmentLocationObjects(val)\n          }\n        } else if (typeof value === 'object' && value !== null) {\n          await this.augmentLocationObjects(value)\n        }\n      }\n    }\n  }\n}\n","import PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport { AnyAdapter } from '../data_adapters/BaseAdapter'\n\nexport default class TextSearchAdapterType extends PluggableElementBase {\n  AdapterClass: AnyAdapter\n\n  configSchema: AnyConfigurationSchemaType\n\n  description?: string\n\n  constructor(stuff: {\n    name: string\n    description?: string\n    configSchema: AnyConfigurationSchemaType\n    AdapterClass: AnyAdapter\n  }) {\n    super(stuff)\n    this.description = stuff.description\n    this.configSchema = stuff.configSchema\n    this.AdapterClass = stuff.AdapterClass\n    if (!this.AdapterClass) {\n      throw new Error(`no AdapterClass defined for adapter type ${this.name}`)\n    }\n  }\n}\n","import { IAnyModelType } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { getDefaultValue } from '../util/mst-reflection'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\nimport DisplayType from './DisplayType'\n\nexport default class TrackType extends PluggableElementBase {\n  stateModel: IAnyModelType\n\n  configSchema: AnyConfigurationSchemaType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    stateModel: IAnyModelType\n    configSchema: AnyConfigurationSchemaType\n  }) {\n    super(stuff)\n    this.stateModel = stuff.stateModel\n    this.configSchema = stuff.configSchema\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for track ${this.name}`)\n    }\n    if (!this.configSchema) {\n      throw new Error(`no configSchema provided for track ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      const name = this.configSchema ? this.configSchema.name : 'UNKNOWN'\n      throw new Error(`${name} is not explicitlyTyped`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport DisplayType from './DisplayType'\n\ntype BasicView = React.ComponentType<{\n  // TODO: can we use AbstractViewModel here?\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  model: any\n  session?: IAnyStateTreeNode\n}>\ntype ViewReactComponent = React.LazyExoticComponent<BasicView> | BasicView\n\nexport default class ViewType extends PluggableElementBase {\n  ReactComponent: ViewReactComponent\n\n  stateModel: IAnyModelType\n\n  displayTypes: DisplayType[] = []\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: ViewReactComponent\n    stateModel: IAnyModelType\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.stateModel = stuff.stateModel\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for view ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for view ${this.name}`)\n    }\n  }\n\n  addDisplayType(display: DisplayType) {\n    this.displayTypes.push(display)\n  }\n}\n","import React, { ComponentType, LazyExoticComponent } from 'react'\nimport { IAnyModelType, IAnyStateTreeNode } from 'mobx-state-tree'\nimport PluggableElementBase from './PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../configuration/configurationSchema'\n\nexport default class WidgetType extends PluggableElementBase {\n  heading?: string\n\n  configSchema: AnyConfigurationSchemaType\n\n  HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n\n  stateModel: IAnyModelType\n\n  constructor(stuff: {\n    name: string\n    heading?: string\n    HeadingComponent?: ComponentType<{ model: IAnyStateTreeNode }>\n    configSchema: AnyConfigurationSchemaType\n    stateModel: IAnyModelType\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ReactComponent: LazyExoticComponent<React.FC<any>> | React.FC<any>\n  }) {\n    super(stuff)\n    this.heading = stuff.heading\n    this.HeadingComponent = stuff.HeadingComponent\n    this.configSchema = stuff.configSchema\n    this.stateModel = stuff.stateModel\n    this.ReactComponent = stuff.ReactComponent\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for widget ${this.name}`)\n    }\n    if (!this.stateModel) {\n      throw new Error(`no stateModel defined for widget ${this.name}`)\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport { ElementId } from '../../util/types/mst'\nimport { MenuItem } from '../../ui'\n\nconst BaseViewModel = types\n  .model('BaseView', {\n    id: ElementId,\n    displayName: types.maybe(types.string),\n  })\n  .volatile((/* self */) => ({\n    width: 800,\n  }))\n  .views((/* self */) => ({\n    menuItems(): MenuItem[] {\n      return []\n    },\n  }))\n  .actions(self => ({\n    setDisplayName(name: string) {\n      self.displayName = name\n    },\n    setWidth(newWidth: number) {\n      self.width = newWidth\n    },\n  }))\n\nexport default BaseViewModel\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface IBaseViewModel extends Instance<typeof BaseViewModel> {}\n","import { ConfigurationSchema } from '../../configuration'\n\nexport default ConfigurationSchema(\n  'BaseConnection',\n  {\n    name: {\n      type: 'string',\n      defaultValue: 'nameOfConnection',\n      description: 'a unique name for this connection',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'optional list of names of assemblies in this connection',\n    },\n  },\n  { explicitlyTyped: true, explicitIdentifier: 'connectionId' },\n)\n","import { types } from 'mobx-state-tree'\n\nexport default pluginManager => {\n  return types\n    .model('Connection', {\n      name: types.identifier,\n      tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n    })\n    .actions(self => ({\n      afterAttach() {\n        if (!self.tracks.length) {\n          self.connect(self.configuration)\n        }\n      },\n      addTrackConf(trackConf) {\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      addTrackConfs(trackConfs) {\n        const length = self.tracks.push(...trackConfs)\n        return self.tracks.slice(length - 1 - trackConfs.length, length - 1)\n      },\n      setTrackConfs(trackConfs) {\n        self.tracks = trackConfs\n        return self.tracks\n      },\n      clear() {},\n    }))\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getParent, Instance, types, isRoot, getEnv } from 'mobx-state-tree'\nimport React from 'react'\nimport { getConf } from '../../configuration'\nimport { MenuItem } from '../../ui'\nimport { getParentRenderProps } from '../../util/tracks'\nimport { ElementId } from '../../util/types/mst'\n\nexport const BaseDisplay = types\n  .model('BaseDisplay', {\n    id: ElementId,\n    type: types.string,\n    rpcDriverName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    rendererTypeName: '',\n    error: undefined as unknown,\n  }))\n  .views(self => ({\n    get RenderingComponent(): React.FC<{\n      model: typeof self\n      onHorizontalScroll?: Function\n      blockState?: Record<string, any>\n    }> {\n      const { pluginManager } = getEnv(self)\n      const displayType = pluginManager.getDisplayType(self.type)\n      return displayType.ReactComponent as React.FC<{\n        model: typeof self\n        onHorizontalScroll?: Function\n        blockState?: Record<string, any>\n      }>\n    },\n\n    get DisplayBlurb(): React.FC<{ model: typeof self }> | null {\n      return null\n    },\n\n    get adapterConfig() {\n      return getConf(this.parentTrack, 'adapter')\n    },\n\n    get parentTrack() {\n      let track = getParent(self)\n      while (!(track.configuration && getConf(track, 'trackId'))) {\n        if (isRoot(track)) {\n          throw new Error(`No parent track found for ${self.type} ${self.id}`)\n        }\n        track = getParent(track)\n      }\n      return track\n    },\n\n    /**\n     * the react props that are passed to the Renderer when data\n     * is rendered in this display\n     */\n    renderProps() {\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this display's\n     * renderer\n     */\n    get rendererType() {\n      const { pluginManager } = getEnv(self)\n      const RendererType = pluginManager.getRendererType(self.rendererTypeName)\n      if (!RendererType) {\n        throw new Error(`renderer \"${self.rendererTypeName}\" not found`)\n      }\n      if (!RendererType.ReactComponent) {\n        throw new Error(\n          `renderer ${self.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      }\n      return RendererType\n    },\n\n    /**\n     * if a display-level message should be displayed instead,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n\n    trackMenuItems(): MenuItem[] {\n      return []\n    },\n\n    get viewMenuActions(): MenuItem[] {\n      return []\n    },\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(/* region */) {\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    setError(error?: unknown) {\n      self.error = error\n    },\n    setRpcDriverName(rpcDriverName: string) {\n      self.rpcDriverName = rpcDriverName\n    },\n    // base display reload does nothing, see specialized displays for details\n    reload() {},\n  }))\n\nexport type BaseDisplayStateModel = typeof BaseDisplay\nexport type BaseDisplayModel = Instance<BaseDisplayStateModel>\n","import React from 'react'\nimport { Instance, types } from 'mobx-state-tree'\nimport { getConf } from '../../configuration'\nimport { RemoteFileWithRangeCache } from '../../util/io'\nimport { ElementId } from '../../util/types/mst'\nimport { UriLocation, AnyReactComponentType } from '../../util/types'\n\nconst inWebWorker = typeof sessionStorage === 'undefined'\n\nexport const InternetAccount = types\n  .model('InternetAccount', {\n    id: ElementId,\n    type: types.string,\n  })\n  .views(self => ({\n    get name(): string {\n      return getConf(self, 'name')\n    },\n    get description(): string {\n      return getConf(self, 'description')\n    },\n    get internetAccountId(): string {\n      return getConf(self, 'internetAccountId')\n    },\n    get authHeader(): string {\n      return getConf(self, 'authHeader')\n    },\n    get tokenType(): string {\n      return getConf(self, 'tokenType')\n    },\n    get domains(): string[] {\n      return getConf(self, 'domains')\n    },\n    /**\n     * Can use this to customize what is displayed in fileSelector's toggle box\n     */\n    get toggleContents(): React.ReactNode {\n      return null\n    },\n    /**\n     * Can use this to customize what the fileSelector. It takes a prop called\n     * `setLocation` that should be used to set a UriLocation\n     */\n    get SelectorComponent(): AnyReactComponentType | undefined {\n      return undefined\n    },\n    /**\n     * Can use this to add a label to the UrlChooser. Has no effect if a custom\n     * SelectorComponent is supplied\n     */\n    get selectorLabel(): string | undefined {\n      return undefined\n    },\n  }))\n  .views(self => ({\n    /**\n     * Determine whether this internetAccount provides credentials for a URL\n     * @param location  - UriLocation of resource\n     * @returns true or false\n     */\n    handlesLocation(location: UriLocation): boolean {\n      return self.domains.some((domain: string) =>\n        location?.uri.includes(domain),\n      )\n    },\n    /**\n     * The key used to store this internetAccount's token in sessionStorage\n     */\n    get tokenKey() {\n      return `${self.internetAccountId}-token`\n    },\n  }))\n  .actions(self => ({\n    /**\n     * Must be implemented by a model extending or composing this one. Pass the\n     * user's token to `resolve`.\n     * @param resolve - Pass the token to this function\n     * @param reject - If there is an error getting the token, call this function\n     */\n    getTokenFromUser(\n      resolve: (token: string) => void,\n      reject: (error: Error) => void,\n    ): void {\n      throw new Error('getTokenFromUser must be implemented by extending model')\n    },\n    storeToken(token: string) {\n      sessionStorage.setItem(self.tokenKey, token)\n    },\n    removeToken() {\n      sessionStorage.removeItem(self.tokenKey)\n    },\n    retrieveToken() {\n      return sessionStorage.getItem(self.tokenKey)\n    },\n    /**\n     * This can be used by an internetAccount to validate a token works before\n     * it is used. This is run when preAuthorizationInformation is requested, so\n     * it can be used to check that a token is valid before sending it to a\n     * worker thread. It expects the token to be returned so that this action\n     * can also be used to generate a new token (e.g. by using a refresh token)\n     * if the original one was invalid. Should throw an error if a token is\n     * invalid.\n     * @param token - Auth token\n     * @param location - UriLocation of the resource\n     * @returns - Valid auth token\n     */\n    async validateToken(token: string, location: UriLocation) {\n      return token\n    },\n  }))\n  .actions(self => {\n    let tokenPromise: Promise<string> | undefined = undefined\n    return {\n      /**\n       * Try to get the token from the location pre-auth, from local storage,\n       * or from a previously cached promise. If token is not available, uses\n       * `getTokenFromUser`.\n       * @param location - UriLocation of the resource\n       * @returns A promise for the token\n       */\n      async getToken(location?: UriLocation): Promise<string> {\n        if (tokenPromise) {\n          return tokenPromise\n        }\n        let token = location?.internetAccountPreAuthorization?.authInfo?.token\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        if (inWebWorker) {\n          throw new Error(\n            'Did not get internet account pre-authorization info in worker',\n          )\n        }\n        token = self.retrieveToken()\n        if (token) {\n          tokenPromise = Promise.resolve(token)\n          return tokenPromise\n        }\n        tokenPromise = new Promise((r, x) => {\n          function resolve(token: string) {\n            self.storeToken(token)\n            r(token)\n          }\n          function reject(error: Error) {\n            self.removeToken()\n            x(error)\n          }\n          self.getTokenFromUser(resolve, reject)\n        })\n        return tokenPromise\n      },\n    }\n  })\n  .actions(self => ({\n    addAuthHeaderToInit(init: RequestInit = {}, token: string) {\n      const tokenInfoString = self.tokenType\n        ? `${self.tokenType} ${token}`\n        : token\n      const newHeaders = new Headers(init.headers || {})\n      newHeaders.append(self.authHeader, tokenInfoString)\n      return { ...init, headers: newHeaders }\n    },\n    /**\n     * Gets the token and returns it along with the information needed to\n     * create a new internetAccount.\n     * @param location - UriLocation of the resource\n     * @returns\n     */\n    async getPreAuthorizationInformation(location: UriLocation) {\n      const authToken = await self.getToken(location)\n      let validatedToken: string\n      try {\n        validatedToken = await self.validateToken(authToken, location)\n      } catch (error) {\n        self.removeToken()\n        throw error\n      }\n      return {\n        internetAccountType: self.type,\n        authInfo: { token: validatedToken, configuration: getConf(self) },\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * Get a fetch method that will add any needed authentication headers to\n     * the request before sending it. If location is provided, it will be\n     * checked to see if it includes a token in it pre-auth information.\n     * @param location - UriLocation of the resource\n     * @returns A function that can be used to fetch\n     */\n    getFetcher(\n      location?: UriLocation,\n    ): (input: RequestInfo, init?: RequestInit) => Promise<Response> {\n      return async (\n        input: RequestInfo,\n        init?: RequestInit,\n      ): Promise<Response> => {\n        const authToken = await self.getToken(location)\n        const newInit = self.addAuthHeaderToInit(init, authToken)\n        return fetch(input, newInit)\n      }\n    },\n  }))\n  .actions(self => ({\n    /**\n     * Gets a filehandle that uses a fetch that adds auth headers\n     * @param location - UriLocation of the resource\n     * @returns A filehandle\n     */\n    openLocation(location: UriLocation) {\n      return new RemoteFileWithRangeCache(location.uri, {\n        fetch: self.getFetcher(location),\n      })\n    },\n  }))\n\nexport type BaseInternetAccountStateModel = typeof InternetAccount\nexport type BaseInternetAccountModel = Instance<BaseInternetAccountStateModel>\n","import { ConfigurationSchema } from '../../configuration'\nimport { Instance } from 'mobx-state-tree'\n\nexport const BaseInternetAccountConfig = ConfigurationSchema(\n  'InternetAccount',\n  {\n    name: {\n      description: 'descriptive name of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    description: {\n      description: 'a description of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    authHeader: {\n      description: 'request header for credentials',\n      type: 'string',\n      defaultValue: 'Authorization',\n    },\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: '',\n    },\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitIdentifier: 'internetAccountId', explicitlyTyped: true },\n)\n\nexport type BaseInternetAccountConfigModel = typeof BaseInternetAccountConfig\nexport type BaseInternetAccountConfig = Instance<BaseInternetAccountConfigModel>\n","import { transaction } from 'mobx'\nimport {\n  getEnv,\n  getRoot,\n  resolveIdentifier,\n  types,\n  Instance,\n} from 'mobx-state-tree'\nimport {\n  getConf,\n  AnyConfigurationModel,\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '../../configuration'\nimport PluginManager from '../../PluginManager'\nimport { MenuItem } from '../../ui'\nimport { getContainingView, getSession } from '../../util'\nimport { isSessionModelWithConfigEditing } from '../../util/types'\nimport { ElementId } from '../../util/types/mst'\n\n// these MST models only exist for tracks that are *shown*.\n// they should contain only UI state for the track, and have\n// a reference to a track configuration (stored under\n// session.configuration.assemblies.get(assemblyName).tracks).\n\n// note that multiple displayed tracks could use the same configuration.\nexport function createBaseTrackModel(\n  pluginManager: PluginManager,\n  trackType: string,\n  baseTrackConfig: AnyConfigurationSchemaType,\n) {\n  return types\n    .model(trackType, {\n      id: ElementId,\n      type: types.literal(trackType),\n      configuration: ConfigurationReference(baseTrackConfig),\n      displays: types.array(\n        pluginManager.pluggableMstType('display', 'stateModel'),\n      ),\n    })\n    .views(self => ({\n      get rpcSessionId() {\n        return self.configuration.trackId\n      },\n\n      get name() {\n        return getConf(self, 'name')\n      },\n\n      get textSearchAdapter() {\n        return getConf(self, 'textSearchAdapter')\n      },\n\n      /**\n       * the PluggableElementType for the currently defined adapter\n       */\n      get adapterType() {\n        const adapterConfig = getConf(self, 'adapter')\n        const { pluginManager: pm } = getEnv(self)\n        if (!adapterConfig) {\n          throw new Error(`no adapter configuration provided for ${self.type}`)\n        }\n        const adapterType = pm.getAdapterType(adapterConfig.type)\n        if (!adapterType) {\n          throw new Error(`unknown adapter type ${adapterConfig.type}`)\n        }\n        return adapterType\n      },\n\n      get viewMenuActions(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.viewMenuActions)\n        })\n        return menuItems\n      },\n      get canConfigure() {\n        const session = getSession(self)\n        return (\n          isSessionModelWithConfigEditing(session) &&\n          // @ts-ignore\n          (session.adminMode ||\n            // @ts-ignore\n            session.sessionTracks.find(track => {\n              return track.trackId === self.configuration.trackId\n            }))\n        )\n      },\n    }))\n    .actions(self => ({\n      activateConfigurationUI() {\n        const session = getSession(self)\n        const view = getContainingView(self)\n        if (isSessionModelWithConfigEditing(session)) {\n          // @ts-ignore\n          const trackConf = session.editTrackConfiguration(self.configuration)\n          if (trackConf && trackConf !== self.configuration) {\n            // @ts-ignore\n            view.hideTrack(self.configuration)\n            // @ts-ignore\n            view.showTrack(trackConf)\n          }\n        }\n      },\n      showDisplay(displayId: string, initialSnapshot = {}) {\n        const displayTypeConfigSchema =\n          pluginManager.pluggableConfigSchemaType('display')\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        const display = displayType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.displays.push(display)\n      },\n\n      hideDisplay(displayId: string) {\n        const displayTypeConfigSchema =\n          pluginManager.pluggableConfigSchemaType('display')\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          displayId,\n        )\n        // if we have any displays with that configuration, turn them off\n        const shownDisplays = self.displays.filter(\n          d => d.configuration === configuration,\n        )\n        transaction(() => shownDisplays.forEach(d => self.displays.remove(d)))\n        return shownDisplays.length\n      },\n      replaceDisplay(\n        oldDisplayId: string,\n        newDisplayId: string,\n        initialSnapshot = {},\n      ) {\n        const displayIdx = self.displays.findIndex(\n          d => d.configuration.displayId === oldDisplayId,\n        )\n        if (displayIdx === -1) {\n          throw new Error(\n            `could not find display id ${oldDisplayId} to replace`,\n          )\n        }\n        const displayTypeConfigSchema =\n          pluginManager.pluggableConfigSchemaType('display')\n        const configuration = resolveIdentifier(\n          displayTypeConfigSchema,\n          getRoot(self),\n          newDisplayId,\n        )\n        const displayType = pluginManager.getDisplayType(configuration.type)\n        if (!displayType) {\n          throw new Error(`unknown display type ${configuration.type}`)\n        }\n        self.displays.splice(displayIdx, 1, {\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n      },\n    }))\n    .views(self => ({\n      trackMenuItems(): MenuItem[] {\n        const menuItems: MenuItem[] = []\n        self.displays.forEach(display => {\n          menuItems.push(...display.trackMenuItems())\n        })\n        const displayChoices: MenuItem[] = []\n        const view = getContainingView(self)\n        const viewType = pluginManager.getViewType(view.type)\n        const compatibleDisplayTypes = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const compatibleDisplays = self.configuration.displays.filter(\n          (displayConf: AnyConfigurationModel) =>\n            compatibleDisplayTypes.includes(displayConf.type),\n        )\n        const shownId = self.displays[0].configuration.displayId\n        if (compatibleDisplays.length > 1) {\n          displayChoices.push(\n            { type: 'divider' },\n            { type: 'subHeader', label: 'Display types' },\n          )\n          compatibleDisplays.forEach((displayConf: AnyConfigurationModel) => {\n            displayChoices.push({\n              type: 'radio',\n              label: displayConf.type,\n              checked: displayConf.displayId === shownId,\n              onClick: () =>\n                self.replaceDisplay(shownId, displayConf.displayId),\n            })\n          })\n        }\n        return [...menuItems, ...displayChoices]\n      },\n    }))\n}\n\nexport type BaseTrackStateModel = ReturnType<typeof createBaseTrackModel>\nexport type BaseTrackModel = Instance<BaseTrackStateModel>\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types, Instance } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../../configuration'\nimport PluginManager from '../../PluginManager'\n\nexport function createBaseTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseTrack',\n    {\n      name: {\n        description: 'descriptive name of the track',\n        type: 'string',\n        defaultValue: 'Track',\n      },\n      assemblyNames: {\n        description: 'name of the assembly (or assemblies) track belongs to',\n        type: 'stringArray',\n        defaultValue: ['assemblyName'],\n      },\n      description: {\n        description: 'a description of the track',\n        type: 'string',\n        defaultValue: '',\n      },\n      category: {\n        description: 'the category and sub-categories of a track',\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      textSearching: ConfigurationSchema('textSearching', {\n        indexingAttributes: {\n          type: 'stringArray',\n          description:\n            'list of which feature attributes to index for text searching',\n          defaultValue: ['Name', 'ID'],\n        },\n        indexingFeatureTypesToExclude: {\n          type: 'stringArray',\n          description: 'list of feature types to exclude in text search index',\n          defaultValue: ['CDS', 'exon'],\n        },\n        textSearchAdapter: pluginManager.pluggableConfigSchemaType(\n          'text search adapter',\n        ),\n      }),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n\n      formatDetails: ConfigurationSchema('FormatDetails', {\n        feature: {\n          type: 'frozen',\n          description: 'adds extra fields to the feature details',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        subfeatures: {\n          type: 'frozen',\n          description: 'adds extra fields to the subfeatures of a feature',\n          defaultValue: {},\n          contextVariable: ['feature'],\n        },\n        depth: {\n          type: 'number',\n          defaultValue: 2,\n          description: 'depth to iterate on subfeatures',\n        },\n      }),\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n\nexport type BaseTrackConfigModel = ReturnType<typeof createBaseTrackConfig>\nexport type BaseTrackConfig = Instance<BaseTrackConfigModel>\n","import deepEqual from 'fast-deep-equal'\nimport GranularRectLayout from '../../util/layouts/GranularRectLayout'\nimport MultiLayout from '../../util/layouts/MultiLayout'\nimport PrecomputedLayout from '../../util/layouts/PrecomputedLayout'\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized as FeatureRenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults as FeatureRenderResults,\n  ResultsSerialized as FeatureResultsSerialized,\n  ResultsDeserialized as FeatureResultsDeserialized,\n} from './FeatureRendererType'\nimport { getLayoutId, Region, Feature } from '../../util'\nimport { SerializedLayout, BaseLayout } from '../../util/layouts/BaseLayout'\nimport { readConfObject, AnyConfigurationModel } from '../../configuration'\nimport SerializableFilterChain from './util/serializableFilterChain'\nimport RpcManager from '../../rpc/RpcManager'\n\nexport interface LayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n}\n\nexport type MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\nexport interface CachedLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport class LayoutSession implements LayoutSessionProps {\n  config: AnyConfigurationModel\n\n  bpPerPx: number\n\n  filters: SerializableFilterChain\n\n  constructor(args: LayoutSessionProps) {\n    this.config = args.config\n    this.bpPerPx = args.bpPerPx\n    this.filters = args.filters\n    this.update(args)\n  }\n\n  update(props: LayoutSessionProps) {\n    Object.assign(this, props)\n  }\n\n  makeLayout() {\n    return new MultiLayout(GranularRectLayout, {\n      maxHeight: readConfObject(this.config, 'maxHeight'),\n      displayMode: readConfObject(this.config, 'displayMode'),\n      pitchX: this.bpPerPx,\n      pitchY: readConfObject(this.config, 'noSpacing') ? 1 : 3,\n    })\n  }\n\n  /**\n   * @param layout -\n   * @returns true if the given layout is a valid one to use for this session\n   */\n  cachedLayoutIsValid(cachedLayout: CachedLayout) {\n    return (\n      cachedLayout &&\n      cachedLayout.layout.subLayoutConstructorArgs.pitchX === this.bpPerPx &&\n      deepEqual(readConfObject(this.config), cachedLayout.config) &&\n      deepEqual(this.filters, cachedLayout.filters)\n    )\n  }\n\n  cachedLayout: CachedLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\nexport interface RenderArgs extends FeatureRenderArgs {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderArgsSerialized extends FeatureRenderArgsSerialized {\n  bpPerPx: number\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  layoutId: string\n}\n\nexport interface RenderResults extends FeatureRenderResults {\n  layout: BaseLayout<Feature>\n}\n\nexport interface ResultsSerialized extends FeatureResultsSerialized {\n  maxHeightReached: boolean\n  layout: SerializedLayout\n}\n\nexport interface ResultsDeserialized extends FeatureResultsDeserialized {\n  maxHeightReached: boolean\n  layout: PrecomputedLayout<string>\n}\n\nexport default class BoxRendererType extends FeatureRendererType {\n  sessions: { [key: string]: LayoutSession } = {}\n\n  getWorkerSession(\n    props: LayoutSessionProps & { sessionId: string; layoutId: string },\n  ) {\n    const key = getLayoutId(props)\n    if (!this.sessions[key]) {\n      this.sessions[key] = this.createSession(props)\n    }\n    const session = this.sessions[key]\n    session.update(props)\n    return session\n  }\n\n  // expands region for glyphs to use\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    if (!region) {\n      return region\n    }\n    const { bpPerPx, config } = renderArgs\n    const maxFeatureGlyphExpansion =\n      config === undefined\n        ? 0\n        : readConfObject(config, 'maxFeatureGlyphExpansion')\n    if (!maxFeatureGlyphExpansion) {\n      return region\n    }\n    const bpExpansion = Math.round(maxFeatureGlyphExpansion * bpPerPx)\n    return {\n      ...region,\n      start: Math.floor(Math.max(region.start - bpExpansion, 0)),\n      end: Math.ceil(region.end + bpExpansion),\n    }\n  }\n\n  createSession(props: LayoutSessionProps) {\n    return new LayoutSession(props)\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const { regions } = args\n    const key = getLayoutId(args)\n    let freed = 0\n    const session = this.sessions[key]\n    if (!regions && session) {\n      delete this.sessions[key]\n      freed = 1\n    }\n    if (session && regions) {\n      session.layout.discardRange(\n        regions[0].refName,\n        regions[0].start,\n        regions[0].end,\n      )\n    }\n    return freed + (await super.freeResourcesInClient(rpcManager, args))\n  }\n\n  deserializeLayoutInClient(json: SerializedLayout) {\n    return new PrecomputedLayout(json)\n  }\n\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const layout = this.deserializeLayoutInClient(result.layout)\n    const deserialized = super.deserializeResultsInClient(\n      { ...result, layout } as FeatureResultsSerialized,\n      args,\n    ) as ResultsDeserialized\n\n    // // debugging aid: check if there are features in `features` that are not in the layout\n    // const featureIds1 = iterMap(deserialized.features.values(), f =>\n    //   f.id(),\n    // ).sort()\n    // const featureIds2 = Object.keys(\n    //   deserialized.layout.toJSON().rectangles,\n    // ).sort()\n    // if (\n    //   featureIds1.length > featureIds2.length &&\n    //   !deserialized.layout.maxHeightReached\n    // )\n    //   debugger\n\n    return deserialized\n  }\n\n  createLayoutInWorker(args: RenderArgsDeserialized) {\n    const { regions } = args\n    const session = this.getWorkerSession(args)\n    const subLayout = session.layout.getSublayout(regions[0].refName)\n    return subLayout\n  }\n\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(\n      results,\n      args,\n    ) as ResultsSerialized\n\n    const [region] = args.regions\n    serialized.layout = results.layout.serializeRegion(\n      this.getExpandedRegion(region, args),\n    )\n    if (serialized.layout.rectangles) {\n      serialized.features = serialized.features.filter(f => {\n        return Boolean(serialized.layout.rectangles[f.uniqueId])\n      })\n    }\n\n    serialized.maxHeightReached = serialized.layout.maxHeightReached\n    return serialized\n  }\n\n  /**\n   * gets layout and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const layout =\n      (props.layout as undefined | BaseLayout<unknown>) ||\n      this.createLayoutInWorker(props)\n    const result = await super.render({ ...props, layout })\n    return { ...result, layout }\n  }\n}\n","import FeatureRenderer from './FeatureRendererType'\n\nexport default class CircularChordRendererType extends FeatureRenderer {}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { filter, toArray } from 'rxjs/operators'\nimport { Feature } from '../../util/simpleFeature'\nimport { Region } from '../../util/types'\nimport ServerSideRenderer, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from './ServerSideRendererType'\nimport RpcManager from '../../rpc/RpcManager'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: {}\n  blockKey: string\n}\n\nexport type { RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  blockKey: string\n}\n\nexport default class ComparativeServerSideRenderer extends ServerSideRenderer {\n  /**\n   * directly modifies the render arguments to prepare\n   * them to be serialized and sent to the worker.\n   *\n   * the base class replaces the `displayModel` param\n   * (which on the client is a MST model) with a stub\n   * that only contains the `selectedFeature`, since\n   * this is the only part of the track model that most\n   * renderers read.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n\n  async renameRegionsIfNeeded(args: RenderArgs) {\n    return args\n  }\n\n  serializeArgsInClient(args: RenderArgs) {\n    const deserializedArgs = {\n      ...args,\n      displayModel: {},\n    }\n\n    return super.serializeArgsInClient(deserializedArgs)\n  }\n\n  // deserialize some of the results that came back from the worker\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserialized = super.deserializeResultsInClient(result, args)\n    return { ...deserialized, blockKey: args.blockKey }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then\n   * calls `render` with the RPC manager.\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    return rpcManager.call(\n      args.sessionId,\n      'ComparativeRender',\n      args,\n    ) as Promise<ResultsSerialized>\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    return renderArgs.filters\n      ? renderArgs.filters.passes(feature, renderArgs)\n      : true\n  }\n\n  async getFeatures(renderArgs: any) {\n    const { sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    let regions = [] as Region[]\n\n    // @ts-ignore this is instantiated by the getFeatures call\n    regions = renderArgs.regions\n\n    if (!regions || regions.length === 0) {\n      console.warn('no regions supplied to comparative renderer')\n      return []\n    }\n\n    const requestRegions = regions.map(r => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.floor(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    // note that getFeaturesInMultipleRegions does not do glyph expansion\n    return (dataAdapter as BaseFeatureDataAdapter)\n      .getFeaturesInMultipleRegions(requestRegions, renderArgs)\n      .pipe(\n        filter(f => this.featurePassesFilters(renderArgs, f)),\n        toArray(),\n      )\n      .toPromise()\n  }\n}\n","import { toArray } from 'rxjs/operators'\nimport { checkAbortSignal, iterMap } from '../../util'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '../../util/simpleFeature'\nimport { AugmentedRegion as Region } from '../../util/types'\nimport { getAdapter } from '../../data_adapters/dataAdapterCache'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized as ServerSideRenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults as ServerSideRenderResults,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n  ResultsSerialized as ServerSideResultsSerialized,\n} from './ServerSideRendererType'\nimport { BaseFeatureDataAdapter } from '../../data_adapters/BaseAdapter'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsSerialized extends ServerSideRenderArgsSerialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  displayModel: { id: string; selectedFeatureId?: string }\n  regions: Region[]\n  blockKey: string\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderResults extends ServerSideRenderResults {\n  features: Map<string, Feature>\n}\n\nexport interface ResultsSerialized extends ServerSideResultsSerialized {\n  features: SimpleFeatureSerialized[]\n}\n\nexport interface ResultsDeserialized extends ServerSideResultsDeserialized {\n  features: Map<string, Feature>\n  blockKey: string\n}\n\nexport default class FeatureRendererType extends ServerSideRendererType {\n  /**\n   * replaces the `displayModel` param (which on the client is a MST model) with\n   * a stub that only contains the `selectedFeature`, since this is the only\n   * part of the track model that most renderers read. also serializes the\n   * config and regions to JSON from MST objects.\n   *\n   * @param args - the arguments passed to render\n   */\n  serializeArgsInClient(args: RenderArgs) {\n    const { displayModel, regions } = args\n    const serializedArgs = {\n      ...args,\n      displayModel: displayModel && {\n        id: displayModel.id,\n        selectedFeatureId: displayModel.selectedFeatureId,\n      },\n      regions: JSON.parse(JSON.stringify(regions)),\n    }\n    return super.serializeArgsInClient(serializedArgs)\n  }\n\n  /**\n   * Adds feature deserialization to base server-side result deserialization\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    result: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const deserializedFeatures = new Map<string, SimpleFeature>()\n    result.features.forEach(j => {\n      const f = SimpleFeature.fromJSON(j)\n      deserializedFeatures.set(String(f.id()), f)\n    })\n    const deserialized = super.deserializeResultsInClient(\n      {\n        ...result,\n        features: deserializedFeatures,\n      } as ServerSideResultsSerialized,\n      args,\n    )\n    return {\n      ...deserialized,\n      blockKey: args.blockKey,\n      features: deserializedFeatures,\n    }\n  }\n\n  /**\n   * Adds feature serialization to base server-side result serialization\n   *\n   * @param result - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    result: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const serialized = super.serializeResultsInWorker(result, args)\n    const { features } = result\n    return {\n      ...serialized,\n      features: iterMap(features.values(), f => f.toJSON(), features.size),\n    }\n  }\n\n  /**\n   * will expand if soft clipping or feature glyphs are shown\n   *\n   * @param region - rendering region\n   * @param _renderArgs - render args, unused, may be used in deriving classes\n   */\n  getExpandedRegion(region: Region, _renderArgs: RenderArgsDeserialized) {\n    return region\n  }\n\n  /**\n   * use the dataAdapter to fetch the features to be rendered\n   *\n   * @param renderArgs -\n   * @returns Map of features as `{ id => feature, ... }`\n   */\n  async getFeatures(\n    renderArgs: RenderArgsDeserialized,\n  ): Promise<Map<string, Feature>> {\n    const { signal, regions, sessionId, adapterConfig } = renderArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const features = new Map()\n\n    if (!regions || regions.length === 0) {\n      return features\n    }\n\n    const requestRegions = regions.map((r: Region) => {\n      // make sure the requested region's start and end are integers, if\n      // there is a region specification.\n      const requestRegion = { ...r }\n      if (requestRegion.start) {\n        requestRegion.start = Math.floor(requestRegion.start)\n      }\n      if (requestRegion.end) {\n        requestRegion.end = Math.ceil(requestRegion.end)\n      }\n      return requestRegion\n    })\n\n    const region = requestRegions[0]\n\n    const featureObservable =\n      requestRegions.length === 1\n        ? (dataAdapter as BaseFeatureDataAdapter).getFeatures(\n            this.getExpandedRegion(region, renderArgs),\n            // @ts-ignore\n            renderArgs,\n          )\n        : // @ts-ignore\n          (dataAdapter as BaseFeatureDataAdapter).getFeaturesInMultipleRegions(\n            requestRegions,\n            renderArgs,\n          )\n\n    const feats = await featureObservable.pipe(toArray()).toPromise()\n    checkAbortSignal(signal)\n    return new Map(\n      feats\n        .filter(feat => this.featurePassesFilters(renderArgs, feat))\n        .map(feat => [feat.id(), feat]),\n    )\n  }\n\n  /**\n   * @param renderArgs -\n   * @param feature -\n   * @returns true if this feature passes all configured filters\n   */\n  featurePassesFilters(renderArgs: RenderArgsDeserialized, feature: Feature) {\n    if (!renderArgs.filters) {\n      return true\n    }\n    return renderArgs.filters.passes(feature, renderArgs)\n  }\n\n  /**\n   * gets features and renders\n   *\n   * @param props - render args\n   */\n  async render(props: RenderArgsDeserialized): Promise<RenderResults> {\n    const features =\n      (props.features as undefined | Map<string, Feature>) ||\n      (await this.getFeatures(props))\n    const result = await super.render({ ...props, features })\n    return { ...result, features }\n  }\n}\n\nexport class NewFeatureRendererType extends ServerSideRendererType {}\n","import React, { ReactElement } from 'react'\nimport { getDefaultValue } from '../../util/mst-reflection'\nimport PluggableElementBase from '../PluggableElementBase'\nimport { AnyConfigurationSchemaType } from '../../configuration/configurationSchema'\nimport { AnyReactComponentType } from '../../util'\nimport PluginManager from '../../PluginManager'\n\nexport type RenderProps = Record<string, unknown>\n\nexport interface RenderResults {\n  reactElement?: ReactElement\n  html?: string\n}\n\nexport default class RendererType extends PluggableElementBase {\n  ReactComponent: AnyReactComponentType\n\n  supportsSVG = false\n\n  configSchema: AnyConfigurationSchemaType\n\n  pluginManager: PluginManager\n\n  constructor(stuff: {\n    name: string\n    ReactComponent: AnyReactComponentType\n    configSchema: AnyConfigurationSchemaType\n    pluginManager: PluginManager\n  }) {\n    super(stuff)\n    this.ReactComponent = stuff.ReactComponent\n    this.configSchema = stuff.configSchema\n    this.pluginManager = stuff.pluginManager\n\n    if (!this.ReactComponent) {\n      throw new Error(`no ReactComponent defined for renderer ${this.name}`)\n    }\n    if (!getDefaultValue(this.configSchema).type) {\n      throw new Error(\n        `${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`,\n      )\n    }\n    if (!this.pluginManager) {\n      throw new Error(`no plugin manager defined for renderer ${this.name}`)\n    }\n  }\n\n  async render(props: RenderProps): Promise<RenderResults> {\n    return {\n      reactElement: React.createElement(this.ReactComponent, props, null),\n    }\n  }\n\n  /**\n   * frees resources associated with the given range, session, etc.\n   * optionally returns the number of data items deleted\n   */\n  freeResources(/* specification: {} */): number {\n    return 0\n  }\n}\n","import { ThemeProvider } from '@material-ui/core/styles'\nimport React, { useEffect, useRef } from 'react'\nimport { hydrate, unmountComponentAtNode } from 'react-dom'\nimport { createJBrowseTheme } from '../../ui'\nimport { rIC } from '../../util'\nimport { ResultsSerialized, RenderArgs } from './ServerSideRendererType'\n\ninterface ServerSideRenderedContentProps extends ResultsSerialized, RenderArgs {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  RenderingComponent: React.ComponentType<any>\n}\n\nexport default function ServerSideRenderedContent(\n  props: ServerSideRenderedContentProps,\n) {\n  const ssrContainerNode = useRef<HTMLDivElement>(null)\n\n  const { theme, html, RenderingComponent, ...rest } = props\n\n  const jbrowseTheme = createJBrowseTheme(theme)\n\n  useEffect(() => {\n    const domNode = ssrContainerNode.current\n    function doHydrate() {\n      if (domNode) {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n        domNode.innerHTML = html\n\n        // defer main-thread rendering and hydration for when\n        // we have some free time. helps keep the framerate up.\n        //\n        // note: the timeout param to rIC below helps when you are doing\n        // a long continuous scroll, it forces it to evaluate because\n        // otherwise the continuous scroll would never give it time to do\n        // so\n        rIC(\n          () => {\n            hydrate(\n              <ThemeProvider theme={jbrowseTheme}>\n                <RenderingComponent {...rest} />\n              </ThemeProvider>,\n              domNode,\n            )\n          },\n          { timeout: 300 },\n        )\n      }\n    }\n\n    doHydrate()\n\n    return () => {\n      if (domNode) {\n        unmountComponentAtNode(domNode)\n      }\n    }\n  }, [html, jbrowseTheme, rest, RenderingComponent])\n\n  return (\n    <div\n      ref={ssrContainerNode}\n      data-html-size={html.length}\n      className=\"ssr-container\"\n    />\n  )\n}\n","import React from 'react'\nimport { ThemeOptions } from '@material-ui/core'\nimport { ThemeProvider } from '@material-ui/core/styles'\nimport { CanvasSequence } from 'canvas-sequencer'\nimport { renderToString } from 'react-dom/server'\n\nimport {\n  SnapshotOrInstance,\n  SnapshotIn,\n  getSnapshot,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport { checkAbortSignal, updateStatus } from '../../util'\nimport RendererType, { RenderProps, RenderResults } from './RendererType'\nimport SerializableFilterChain, {\n  SerializedFilterChain,\n} from './util/serializableFilterChain'\nimport { AnyConfigurationModel } from '../../configuration/configurationSchema'\nimport RpcManager from '../../rpc/RpcManager'\nimport { createJBrowseTheme } from '../../ui'\nimport ServerSideRenderedContent from './ServerSideRenderedContent'\n\ninterface BaseRenderArgs extends RenderProps {\n  sessionId: string\n  // Note that signal serialization happens after serializeArgsInClient and\n  // deserialization happens before deserializeArgsInWorker\n  signal?: AbortSignal\n  theme: ThemeOptions\n  exportSVG: { rasterizeLayers?: boolean }\n}\n\nexport interface RenderArgs extends BaseRenderArgs {\n  config: SnapshotOrInstance<AnyConfigurationModel>\n  filters: SerializableFilterChain\n}\n\nexport interface RenderArgsSerialized extends BaseRenderArgs {\n  statusCallback?: (arg: string) => void\n  config: SnapshotIn<AnyConfigurationModel>\n  filters: SerializedFilterChain\n}\nexport interface RenderArgsDeserialized extends BaseRenderArgs {\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n}\n\nexport type { RenderResults }\n\nexport interface ResultsSerialized extends Omit<RenderResults, 'reactElement'> {\n  html: string\n}\n\nexport interface ResultsSerializedSvgExport extends ResultsSerialized {\n  canvasRecordedData: unknown\n  width: number\n  height: number\n  reactElement: unknown\n}\n\nfunction isSvgExport(\n  elt: ResultsSerialized,\n): elt is ResultsSerializedSvgExport {\n  return 'canvasRecordedData' in elt\n}\n\nexport type ResultsDeserialized = RenderResults\n\nexport default class ServerSideRenderer extends RendererType {\n  /**\n   * directly modifies the render arguments to prepare them to be serialized and\n   * sent to the worker.\n   *\n   * @param args - the arguments passed to render\n   * @returns the same object\n   */\n  serializeArgsInClient(args: RenderArgs): RenderArgsSerialized {\n    return {\n      ...args,\n      config: isStateTreeNode(args.config)\n        ? getSnapshot(args.config)\n        : args.config,\n      filters: args.filters && args.filters.toJSON().filters,\n    }\n  }\n\n  /**\n   * Deserialize the render results from the worker in the client. Includes\n   * hydrating of the React HTML string, and not hydrating the result if SVG is\n   * being rendered\n   *\n   * @param results - the results of the render\n   * @param args - the arguments passed to render\n   */\n  deserializeResultsInClient(\n    results: ResultsSerialized,\n    args: RenderArgs,\n  ): ResultsDeserialized {\n    const { html, ...rest } = results\n\n    // if we are rendering svg, we skip hydration\n    if (args.exportSVG) {\n      // only return the results if the renderer explicitly has\n      // this.supportsSVG support to avoid garbage being rendered in SVG\n      // document\n      return {\n        ...results,\n        html: this.supportsSVG\n          ? results.html\n          : '<text y=\"12\" fill=\"black\">SVG export not supported for this track</text>',\n      }\n    }\n\n    // hydrate results using ServerSideRenderedContent\n    return {\n      ...rest,\n      reactElement: (\n        <ServerSideRenderedContent\n          {...args}\n          {...results}\n          RenderingComponent={this.ReactComponent}\n        />\n      ),\n    }\n  }\n\n  /**\n   * modifies the passed arguments object to inflate arguments as necessary.\n   * called in the worker process.\n   *\n   * @param args - the converted arguments to modify\n   */\n  deserializeArgsInWorker(args: RenderArgsSerialized): RenderArgsDeserialized {\n    const deserialized = { ...args } as unknown as RenderArgsDeserialized\n    deserialized.config = this.configSchema.create(args.config || {}, {\n      pluginManager: this.pluginManager,\n    })\n    deserialized.filters = new SerializableFilterChain({\n      filters: args.filters,\n    })\n\n    return deserialized\n  }\n\n  /**\n   * Serialize results of the render to send them to the client. Includes\n   * rendering React to an HTML string.\n   *\n   * @param results - object containing the results of calling the `render`\n   * method\n   * @param args - deserialized render args\n   */\n  serializeResultsInWorker(\n    results: RenderResults,\n    args: RenderArgsDeserialized,\n  ): ResultsSerialized {\n    const html = renderToString(\n      <ThemeProvider theme={createJBrowseTheme(args.theme)}>\n        {results.reactElement}\n      </ThemeProvider>,\n    )\n    delete results.reactElement\n    return { ...results, html }\n  }\n\n  /**\n   * Render method called on the client. Serializes args, then calls\n   * \"CoreRender\" with the RPC manager.\n   *\n   * @param rpcManager - RPC mananger\n   * @param args - render args\n   */\n  async renderInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const results = (await rpcManager.call(\n      args.sessionId,\n      'CoreRender',\n      args,\n    )) as ResultsSerialized\n\n    if (isSvgExport(results)) {\n      const { width, height, canvasRecordedData } = results\n\n      const C2S = await import('canvas2svg')\n      const ctx = new C2S.default(width, height)\n      const seq = new CanvasSequence(canvasRecordedData)\n      seq.execute(ctx)\n      const str = ctx.getSvg()\n      // innerHTML strips the outer <svg> element from returned data, we add\n      // our own <svg> element in the view's SVG export\n      results.html = str.innerHTML\n      delete results.reactElement\n    }\n    return results\n  }\n\n  /**\n   * Render method called on the worker. `render` is called here in server-side\n   * rendering\n   *\n   * @param args - serialized render args\n   */\n  async renderInWorker(args: RenderArgsSerialized): Promise<ResultsSerialized> {\n    const { signal, statusCallback = () => {} } = args\n    const deserializedArgs = this.deserializeArgsInWorker(args)\n\n    const results = await updateStatus('Rendering plot', statusCallback, () =>\n      this.render(deserializedArgs),\n    )\n    checkAbortSignal(signal)\n\n    // serialize the results for passing back to the main thread.\n    // these will be transmitted to the main process, and will come out\n    // as the result of renderRegionWithWorker.\n    return updateStatus('Serializing results', statusCallback, () =>\n      this.serializeResultsInWorker(results, deserializedArgs),\n    )\n  }\n\n  async freeResourcesInClient(rpcManager: RpcManager, args: RenderArgs) {\n    const serializedArgs = this.serializeArgsInClient(args)\n\n    const freed = this.freeResources()\n    const freedRpc = (await rpcManager.call(\n      args.sessionId,\n      'CoreFreeResources',\n      serializedArgs,\n    )) as number\n    return freed + freedRpc\n  }\n}\n","import { stringToJexlExpression } from '../../../util/jexlStrings'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype FilterExpression = (...args: Record<string, any>[] | any[]) => boolean\n\ninterface Filter {\n  string: string\n  expr: FilterExpression\n}\n\nexport type SerializedFilterChain = string[]\n\nexport default class SerializableFilterChain {\n  filterChain: Filter[]\n\n  constructor({ filters = [] }: { filters: SerializedFilterChain }) {\n    this.filterChain = filters.map(inputFilter => {\n      if (typeof inputFilter === 'string') {\n        const expr = stringToJexlExpression(inputFilter) as FilterExpression\n        return { expr, string: inputFilter }\n      }\n      throw new Error(`invalid inputFilter string \"${inputFilter}\"`)\n    })\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  passes(...args: any[]) {\n    for (let i = 0; i < this.filterChain.length; i += 1) {\n      if (\n        // @ts-ignore\n        !this.filterChain[i].expr.evalSync({ feature: args[0] })\n      ) {\n        return false\n      }\n    }\n    return true\n  }\n\n  toJSON() {\n    return { filters: this.filterChain.map(f => f.string) }\n  }\n\n  static fromJSON(json: { filters: SerializedFilterChain }) {\n    return new SerializableFilterChain(json)\n  }\n}\n","import React from 'react'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport ResizeHandle from './ResizeHandle'\nimport { SessionWithDrawerWidgets } from '../util/types'\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    overflowY: 'auto',\n    height: '100%',\n    zIndex: theme.zIndex.drawer,\n    outline: 'none',\n    background: theme.palette.background.default,\n  },\n  resizeHandle: {\n    width: 4,\n    position: 'fixed',\n    top: 0,\n    zIndex: theme.zIndex.drawer + 1,\n  },\n}))\n\nfunction Drawer({\n  children,\n  session,\n}: {\n  children: React.ReactNode\n  session: SessionWithDrawerWidgets\n}) {\n  const { drawerPosition, drawerWidth } = session\n  const classes = useStyles()\n\n  return (\n    <Paper className={classes.paper} elevation={16} square>\n      {drawerPosition === 'right' ? (\n        <ResizeHandle\n          onDrag={session.resizeDrawer}\n          className={classes.resizeHandle}\n          vertical\n        />\n      ) : null}\n      {children}\n      {drawerPosition === 'left' ? (\n        <ResizeHandle\n          onDrag={session.resizeDrawer}\n          className={classes.resizeHandle}\n          style={{ left: drawerWidth }}\n          vertical\n        />\n      ) : null}\n    </Paper>\n  )\n}\n\nexport default observer(Drawer)\n","import React, { Suspense, useState } from 'react'\nimport {\n  AppBar,\n  IconButton,\n  ListItemSecondaryAction,\n  Menu,\n  MenuItem,\n  Select,\n  Toolbar,\n  Tooltip,\n  Typography,\n  makeStyles,\n  alpha,\n} from '@material-ui/core'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { SessionWithDrawerWidgets } from '../util/types'\n\n// icons\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport CloseIcon from '@material-ui/icons/Close'\nimport MinimizeIcon from '@material-ui/icons/Minimize'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\n\n// locals\nimport Drawer from './Drawer'\n\nconst useStyles = makeStyles(theme => ({\n  drawerActions: {\n    float: 'right',\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n  drawerToolbar: {\n    paddingLeft: theme.spacing(2),\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n  drawerSelect: {\n    color: theme.palette.secondary.contrastText,\n  },\n  drawerLoading: {\n    margin: theme.spacing(2),\n  },\n  dropDownIcon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  header: {\n    background: theme.palette.secondary.main,\n  },\n}))\n\nconst DrawerHeader = observer(\n  ({\n    session,\n    setToolbarHeight,\n  }: {\n    session: SessionWithDrawerWidgets\n    setToolbarHeight: (arg: number) => void\n  }) => {\n    const { pluginManager } = getEnv(session)\n    const { visibleWidget, activeWidgets, drawerPosition } = session\n    const classes = useStyles()\n\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n\n    return (\n      <AppBar\n        position=\"sticky\"\n        className={classes.header}\n        ref={(ref: HTMLDivElement) =>\n          setToolbarHeight(ref?.getBoundingClientRect().height || 0)\n        }\n      >\n        <Toolbar disableGutters className={classes.drawerToolbar}>\n          <Select\n            value={visibleWidget?.id}\n            data-testid=\"widget-drawer-selects\"\n            className={classes.drawerSelect}\n            classes={{ icon: classes.dropDownIcon }}\n            renderValue={widgetId => {\n              const widget = session.activeWidgets.get(widgetId as string)\n              if (!widget) {\n                return (\n                  <Typography variant=\"h6\" color=\"inherit\">\n                    Unknown widget\n                  </Typography>\n                )\n              }\n              const widgetType = pluginManager.getWidgetType(widget.type)\n              const { HeadingComponent, heading } = widgetType\n              return HeadingComponent ? (\n                <HeadingComponent model={widget} />\n              ) : (\n                <Typography variant=\"h6\" color=\"inherit\">\n                  {heading}\n                </Typography>\n              )\n            }}\n            onChange={e => {\n              const w = session.activeWidgets.get(e.target.value as string)\n              if (!w) {\n                session.notify('Widget not found ' + e.target.value, 'warning')\n              }\n              session.showWidget(w)\n            }}\n          >\n            {Array.from(activeWidgets.values()).map(widget => {\n              const widgetType = pluginManager.getWidgetType(widget.type)\n              const { HeadingComponent, heading } = widgetType\n              return (\n                <MenuItem\n                  data-testid={`widget-drawer-selects-item-${widget.type}`}\n                  key={widget.id}\n                  value={widget.id}\n                >\n                  {HeadingComponent ? (\n                    <HeadingComponent model={widget} />\n                  ) : (\n                    <Typography variant=\"h6\" color=\"inherit\">\n                      {heading}\n                    </Typography>\n                  )}\n                  <ListItemSecondaryAction>\n                    <IconButton\n                      data-testid={`${widget.type}-drawer-delete`}\n                      color=\"inherit\"\n                      aria-label=\"Delete\"\n                      onClick={() => {\n                        session.hideWidget(widget)\n                      }}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </ListItemSecondaryAction>\n                </MenuItem>\n              )\n            })}\n          </Select>\n          <div className={classes.spacer} />\n          <div>\n            <IconButton\n              data-testid=\"drawer-close\"\n              color=\"inherit\"\n              onClick={event => setAnchorEl(event.currentTarget)}\n            >\n              <MoreVertIcon />\n            </IconButton>\n            <Tooltip title=\"Minimize drawer\">\n              <IconButton\n                data-testid=\"drawer-minimize\"\n                color=\"inherit\"\n                onClick={() => {\n                  session.notify(\n                    `Drawer minimized, click button on ${drawerPosition} side of screen to re-open`,\n                    'info',\n                  )\n                  session.minimizeWidgetDrawer()\n                }}\n              >\n                <MinimizeIcon />\n              </IconButton>\n            </Tooltip>\n            <Tooltip title=\"Close drawer\">\n              <IconButton\n                data-testid=\"drawer-close\"\n                color=\"inherit\"\n                onClick={() => {\n                  session.hideWidget(visibleWidget)\n                }}\n              >\n                <CloseIcon />\n              </IconButton>\n            </Tooltip>\n          </div>\n        </Toolbar>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onClose={() => setAnchorEl(null)}\n        >\n          {['left', 'right'].map(option => (\n            <MenuItem\n              key={option}\n              selected={drawerPosition === 'option'}\n              onClick={() => {\n                session.setDrawerPosition(option)\n                setAnchorEl(null)\n              }}\n            >\n              {option}\n            </MenuItem>\n          ))}\n        </Menu>\n      </AppBar>\n    )\n  },\n)\n\nconst DrawerWidget = observer(\n  ({ session }: { session: SessionWithDrawerWidgets }) => {\n    const { visibleWidget } = session\n    const { pluginManager } = getEnv(session)\n    const DrawerComponent = visibleWidget\n      ? pluginManager.getWidgetType(visibleWidget.type).ReactComponent\n      : null\n\n    // we track the toolbar height because components that use virtualized\n    // height want to be able to fill the contained, minus the toolbar height\n    // (the position static/sticky is included in AutoSizer estimates)\n    const [toolbarHeight, setToolbarHeight] = useState(0)\n\n    return (\n      <Drawer session={session}>\n        <DrawerHeader session={session} setToolbarHeight={setToolbarHeight} />\n        <Suspense fallback={<div>Loading...</div>}>\n          <DrawerComponent\n            model={visibleWidget}\n            session={session}\n            toolbarHeight={toolbarHeight}\n          />\n        </Suspense>\n      </Drawer>\n    )\n  },\n)\n\nexport default DrawerWidget\n","import React, { useRef, useState } from 'react'\nimport { Button } from '@material-ui/core'\nimport { alpha, makeStyles } from '@material-ui/core/styles'\nimport ArrowDropDown from '@material-ui/icons/ArrowDropDown'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport Menu, { MenuItem } from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n  },\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nfunction DropDownMenu({\n  menuTitle,\n  session,\n  menuItems,\n}: {\n  menuTitle: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  session: any\n  menuItems: MenuItem[]\n}) {\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const classes = useStyles()\n\n  function handleToggle() {\n    setOpen(!open)\n  }\n\n  function handleMenuItemClick(_event: unknown, callback: Function) {\n    callback(session)\n    handleClose()\n  }\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  return (\n    <div className={classes.root}>\n      <Button\n        ref={anchorEl}\n        onClick={handleToggle}\n        color=\"inherit\"\n        data-testid=\"dropDownMenuButton\"\n        classes={{ root: classes.buttonRoot }}\n      >\n        {menuTitle}\n        <ArrowDropDown />\n      </Button>\n      <Menu\n        anchorEl={anchorEl.current}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        onMenuItemClick={handleMenuItemClick}\n        open={open}\n        onClose={handleClose}\n        menuItems={menuItems}\n      />\n    </div>\n  )\n}\n\nDropDownMenu.propTypes = {\n  menuTitle: PropTypes.string.isRequired,\n  menuItems: MobxPropTypes.arrayOrObservableArray.isRequired,\n  session: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(DropDownMenu)\n","import Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport PropTypes from 'prop-types'\nimport React, { useState } from 'react'\nimport FactoryResetDialog from './FactoryResetDialog'\n\nconst ResetComponent = ({\n  onFactoryReset,\n  resetButtonText,\n}: {\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  return (\n    <>\n      <Button\n        data-testid=\"fatal-error\"\n        color=\"primary\"\n        variant=\"contained\"\n        onClick={() => setDialogOpen(true)}\n      >\n        {resetButtonText}\n      </Button>\n      <FactoryResetDialog\n        onClose={() => setDialogOpen(false)}\n        open={dialogOpen}\n        onFactoryReset={onFactoryReset}\n      />\n    </>\n  )\n}\nResetComponent.propTypes = {\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string.isRequired,\n}\n\nconst FatalErrorDialog = ({\n  componentStack,\n  error,\n  onFactoryReset,\n  resetButtonText,\n}: {\n  componentStack: string\n  error: Error\n  onFactoryReset: Function\n  resetButtonText: string\n}) => {\n  return (\n    <Dialog open>\n      <DialogTitle style={{ backgroundColor: '#e88' }}>Fatal error</DialogTitle>\n      <DialogContent>\n        <pre>\n          {error.toString()}\n          {componentStack}\n        </pre>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          color=\"secondary\"\n          variant=\"contained\"\n          onClick={() => window.location.reload()}\n        >\n          Refresh\n        </Button>\n        <ResetComponent\n          onFactoryReset={onFactoryReset}\n          resetButtonText={resetButtonText}\n        />\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nFatalErrorDialog.propTypes = {\n  componentStack: PropTypes.string,\n  error: PropTypes.shape({}),\n  onFactoryReset: PropTypes.func.isRequired,\n  resetButtonText: PropTypes.string,\n}\n\nFatalErrorDialog.defaultProps = {\n  error: { message: 'No error message provided' },\n  componentStack: '',\n  resetButtonText: 'Factory Reset',\n}\n\nexport default FatalErrorDialog\n","import React from 'react'\nimport {\n  Box,\n  Button,\n  Typography,\n  FormControl,\n  makeStyles,\n} from '@material-ui/core'\nimport { isElectron } from '../../util'\nimport { LocalPathLocation, FileLocation, BlobLocation } from '../../util/types'\nimport { getBlob, storeBlobLocation } from '../../util/tracks'\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nconst useStyles = makeStyles(theme => ({\n  filename: {\n    marginLeft: theme.spacing(1),\n  },\n}))\n\nfunction LocalFileChooser(props: {\n  location?: FileLocation\n  setLocation: Function\n}) {\n  const classes = useStyles()\n  const { location, setLocation } = props\n\n  const filename =\n    location &&\n    ((isBlobLocation(location) && location.name) ||\n      (isLocalPathLocation(location) && location.localPath))\n\n  const needToReload =\n    location && isBlobLocation(location) && !getBlob(location.blobId)\n\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\">\n      <Box>\n        <FormControl fullWidth>\n          <Button variant=\"outlined\" component=\"label\">\n            Choose File\n            <input\n              type=\"file\"\n              hidden\n              onChange={({ target }) => {\n                const file = target && target.files && target.files[0]\n                if (file) {\n                  if (isElectron) {\n                    setLocation({\n                      localPath: (file as File & { path: string }).path,\n                      locationType: 'LocalPathLocation',\n                    })\n                  } else {\n                    setLocation(storeBlobLocation({ blob: file }))\n                  }\n                }\n              }}\n            />\n          </Button>\n        </FormControl>\n      </Box>\n      <Box>\n        <Typography\n          component=\"span\"\n          className={classes.filename}\n          color={filename ? 'initial' : 'textSecondary'}\n        >\n          {filename || 'No file chosen'}\n        </Typography>\n        {needToReload ? (\n          <Typography color=\"error\">(need to reload)</Typography>\n        ) : null}\n      </Box>\n    </Box>\n  )\n}\n\nexport default LocalFileChooser\n","import React from 'react'\nimport { TextField } from '@material-ui/core'\nimport { observer } from 'mobx-react'\nimport { FileLocation, isUriLocation } from '../../util/types'\n\nfunction UrlChooser(props: {\n  location?: FileLocation\n  setLocation: Function\n  label?: string\n}) {\n  const { location, setLocation, label } = props\n\n  return (\n    <>\n      <TextField\n        fullWidth\n        variant=\"outlined\"\n        inputProps={{ 'data-testid': 'urlInput' }}\n        defaultValue={location && isUriLocation(location) ? location.uri : ''}\n        label={label || 'Enter URL'}\n        onChange={event => {\n          setLocation({\n            uri: event.target.value.trim(),\n            locationType: 'UriLocation',\n          })\n        }}\n      />\n    </>\n  )\n}\n\nexport default observer(UrlChooser)\n","import SvgIcon, { SvgIconProps } from '@material-ui/core/SvgIcon'\nimport React from 'react'\n\n// Icons below come from https://material.io/resources/icons/?icon=line_style&style=baseline\nexport function ContentCopy(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\" />\n    </SvgIcon>\n  )\n}\n\n// https://materialdesignicons.com/ text-search icon\nexport function Indexing(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentCut(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentPaste(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n\n//  content-save-edit from https://materialdesignicons.com/\nexport function SaveAs(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M10,19L10.14,18.86C8.9,18.5 8,17.36 8,16A3,3 0 0,1 11,13C12.36,13 13.5,13.9 13.86,15.14L20,9V7L16,3H4C2.89,3 2,3.9 2,5V19A2,2 0 0,0 4,21H10V19M4,5H14V9H4V5M20.04,12.13C19.9,12.13 19.76,12.19 19.65,12.3L18.65,13.3L20.7,15.35L21.7,14.35C21.92,14.14 21.92,13.79 21.7,13.58L20.42,12.3C20.31,12.19 20.18,12.13 20.04,12.13M18.07,13.88L12,19.94V22H14.06L20.12,15.93L18.07,13.88Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  content-save from https://materialdesignicons.com/\nexport function Save(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  dna from https://materialdesignicons.com/\nexport function DNA(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function Cable(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z\" />\n    </SvgIcon>\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { Button, IconButton, Snackbar } from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport Alert from '@material-ui/lab/Alert'\nimport { observer } from 'mobx-react'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AbstractSessionModel, NotificationLevel, SnackAction } from '../util'\n\ntype SnackbarMessage = [string, NotificationLevel, SnackAction]\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nfunction MessageSnackbar({\n  session,\n}: {\n  session: SnackbarSession & IAnyStateTreeNode\n}) {\n  const [open, setOpen] = useState(false)\n  const [snackbarMessage, setSnackbarMessage] = useState<SnackbarMessage>()\n\n  const { popSnackbarMessage, snackbarMessages } = session\n\n  const latestMessage = snackbarMessages.length\n    ? snackbarMessages[snackbarMessages.length - 1]\n    : null\n\n  useEffect(() => {\n    let timeoutId: ReturnType<typeof setTimeout>\n\n    if (snackbarMessage) {\n      if (!latestMessage) {\n        setSnackbarMessage(undefined)\n      } else if (snackbarMessage[0] !== latestMessage[0]) {\n        setOpen(false)\n        timeoutId = setTimeout(() => {\n          setSnackbarMessage(latestMessage)\n          setOpen(true)\n        }, 100)\n      }\n    } else if (latestMessage) {\n      setSnackbarMessage(latestMessage)\n      setOpen(true)\n    }\n\n    return () => {\n      clearTimeout(timeoutId)\n    }\n  }, [latestMessage, snackbarMessage])\n\n  const handleClose = (_event: unknown, reason?: string) => {\n    if (reason === 'clickaway') {\n      return\n    }\n    popSnackbarMessage()\n    setOpen(false)\n  }\n  const [message, level, action] = snackbarMessage || []\n  return (\n    <Snackbar open={open && !!message} onClose={handleClose}>\n      <Alert\n        onClose={handleClose}\n        action={\n          action ? (\n            <>\n              <Button\n                color=\"inherit\"\n                onClick={e => {\n                  action.onClick()\n                  handleClose(e)\n                }}\n              >\n                {action.name}\n              </Button>\n              <IconButton\n                aria-label=\"close\"\n                color=\"inherit\"\n                onClick={handleClose}\n              >\n                <CloseIcon />\n              </IconButton>\n            </>\n          ) : null\n        }\n        severity={level || 'warning'}\n      >\n        {message}\n      </Alert>\n    </Snackbar>\n  )\n}\n\nexport default observer(MessageSnackbar)\n","import React, { useEffect, useRef, useState } from 'react'\nimport {\n  SvgIconProps,\n  IconButton,\n  IconButtonProps as IconButtonPropsType,\n  Paper,\n  Tooltip,\n  makeStyles,\n  useTheme,\n  alpha,\n} from '@material-ui/core'\n\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport useMeasure from 'react-use-measure'\n\n// icons\nimport CloseIcon from '@material-ui/icons/Close'\nimport MenuIcon from '@material-ui/icons/Menu'\n\n// locals\nimport { IBaseViewModel } from '../pluggableElementTypes/models'\nimport EditableTypography from './EditableTypography'\nimport Menu from './Menu'\n\nconst useStyles = makeStyles(theme => ({\n  viewContainer: {\n    overflow: 'hidden',\n    background: theme.palette.secondary.main,\n    margin: theme.spacing(0.5),\n  },\n  icon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  iconRoot: {\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.secondary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n\n  input: {\n    paddingBottom: 0,\n    paddingTop: 2,\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\n\nconst ViewMenu = observer(\n  ({\n    model,\n    IconButtonProps,\n    IconProps,\n  }: {\n    model: IBaseViewModel\n    IconButtonProps: IconButtonPropsType\n    IconProps: SvgIconProps\n  }) => {\n    const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n    const { menuItems } = model\n\n    // <=1.3.3 didn't use a function\n    const items = typeof menuItems === 'function' ? menuItems() : menuItems\n\n    return items?.length ? (\n      <>\n        <IconButton\n          {...IconButtonProps}\n          aria-label=\"more\"\n          aria-controls=\"view-menu\"\n          aria-haspopup=\"true\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n          data-testid=\"view_menu_icon\"\n        >\n          <MenuIcon {...IconProps} />\n        </IconButton>\n        <Menu\n          anchorEl={anchorEl}\n          open={Boolean(anchorEl)}\n          onMenuItemClick={(_event, callback) => {\n            callback()\n            setAnchorEl(undefined)\n          }}\n          onClose={() => {\n            setAnchorEl(undefined)\n          }}\n          menuItems={model.menuItems()}\n        />\n      </>\n    ) : null\n  },\n)\nconst ViewContainer = observer(\n  ({\n    view,\n    onClose,\n    style,\n    children,\n  }: {\n    view: IBaseViewModel\n    onClose: () => void\n    style?: React.CSSProperties\n    children: React.ReactNode\n  }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n    const padWidth = theme.spacing(1)\n\n    const [ref, { width }] = useMeasure()\n\n    useEffect(() => {\n      if (width && isAlive(view)) {\n        view.setWidth(width - padWidth * 2)\n      }\n    }, [padWidth, view, width])\n\n    const scrollRef = useRef<HTMLDivElement>(null)\n    // scroll the view into view when first mounted\n    // note that this effect will run only once, because of\n    // the empty array second param\n    useEffect(() => {\n      scrollRef.current?.scrollIntoView?.({ block: 'center' })\n    }, [])\n\n    return (\n      <Paper\n        ref={ref}\n        elevation={12}\n        className={classes.viewContainer}\n        style={{ ...style, padding: `0px ${padWidth}px ${padWidth}px` }}\n      >\n        <div ref={scrollRef} style={{ display: 'flex' }}>\n          <ViewMenu\n            model={view}\n            IconButtonProps={{\n              classes: { root: classes.iconRoot },\n              edge: 'start',\n            }}\n            IconProps={{ className: classes.icon }}\n          />\n          <div className={classes.grow} />\n          <Tooltip title=\"Rename view\" arrow>\n            <EditableTypography\n              value={\n                view.displayName ||\n                // @ts-ignore\n                (view.assemblyNames\n                  ? // @ts-ignore\n                    view.assemblyNames.join(',')\n                  : 'Untitled view')\n              }\n              setValue={val => {\n                view.setDisplayName(val)\n              }}\n              variant=\"body2\"\n              classes={{\n                input: classes.input,\n                inputBase: classes.inputBase,\n                inputRoot: classes.inputRoot,\n                inputFocused: classes.inputFocused,\n              }}\n            />\n          </Tooltip>\n          <div className={classes.grow} />\n          <IconButton\n            data-testid=\"close_view\"\n            classes={{ root: classes.iconRoot }}\n            edge=\"end\"\n            onClick={onClose}\n          >\n            <CloseIcon className={classes.icon} />\n          </IconButton>\n        </div>\n        <Paper>{children}</Paper>\n      </Paper>\n    )\n  },\n)\n\nexport default ViewContainer\n","import { types, cast, getSnapshot, Instance } from 'mobx-state-tree'\nimport { clamp, viewBpToPx } from './index'\nimport { Feature } from './simpleFeature'\nimport { Region, ElementId } from './types/mst'\nimport { Region as IRegion } from './types'\nimport calculateDynamicBlocks from './calculateDynamicBlocks'\nimport calculateStaticBlocks from './calculateStaticBlocks'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n}\n\nconst Base1DView = types\n  .model('Base1DView', {\n    id: ElementId,\n    displayedRegions: types.array(Region),\n    bpPerPx: 0,\n    offsetPx: 0,\n    interRegionPaddingWidth: types.optional(types.number, 0),\n    minimumBlockWidth: types.optional(types.number, 0),\n  })\n  .volatile(() => ({\n    features: undefined as undefined | Feature[],\n    volatileWidth: 0,\n  }))\n  .actions(self => ({\n    setDisplayedRegions(regions: IRegion[]) {\n      self.displayedRegions = cast(regions)\n    },\n    setBpPerPx(val: number) {\n      self.bpPerPx = val\n    },\n    setVolatileWidth(width: number) {\n      self.volatileWidth = width\n    },\n  }))\n  .views(self => ({\n    get width() {\n      return self.volatileWidth\n    },\n    get assemblyNames() {\n      return [\n        ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n      ]\n    },\n\n    get displayedRegionsTotalPx() {\n      return this.totalBp / self.bpPerPx\n    },\n\n    get maxOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const leftPadding = 10\n      return this.displayedRegionsTotalPx - leftPadding\n    },\n\n    get minOffset() {\n      // objectively determined to keep the linear genome on the main screen\n      const rightPadding = 30\n      return -this.width + rightPadding\n    },\n    get totalBp() {\n      return self.displayedRegions\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n\n    pxToBp(px: number) {\n      let bpSoFar = 0\n      const bp = (self.offsetPx + px) * self.bpPerPx\n      const n = self.displayedRegions.length\n      if (bp < 0) {\n        const region = self.displayedRegions[0]\n        const offset = bp\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          offset,\n          index: 0,\n        }\n      }\n\n      const interRegionPaddingBp = self.interRegionPaddingWidth * self.bpPerPx\n      const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n\n      for (let index = 0; index < self.displayedRegions.length; index += 1) {\n        const region = self.displayedRegions[index]\n        const len = region.end - region.start\n        const offset = bp - bpSoFar\n        if (len + bpSoFar > bp && bpSoFar <= bp) {\n          return {\n            ...getSnapshot(region),\n            oob: false,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index,\n          }\n        }\n\n        // add the interRegionPaddingWidth if the boundary is in the screen\n        // e.g. offset>0 && offset<width\n        if (\n          region.end - region.start > minimumBlockBp &&\n          offset / self.bpPerPx > 0 &&\n          offset / self.bpPerPx < this.width\n        ) {\n          bpSoFar += len + interRegionPaddingBp\n        } else {\n          bpSoFar += len\n        }\n      }\n\n      if (bp >= bpSoFar) {\n        const region = self.displayedRegions[n - 1]\n        const len = region.end - region.start\n        const offset = bp - bpSoFar + len\n        return {\n          ...getSnapshot(region),\n          oob: true,\n          offset,\n          coord: region.reversed\n            ? Math.floor(region.end - offset) + 1\n            : Math.floor(region.start + offset) + 1,\n          index: n - 1,\n        }\n      }\n      return {\n        coord: 0,\n        index: 0,\n        start: 0,\n        refName: '',\n        oob: true,\n        assemblyName: '',\n        offset: 0,\n        reversed: false,\n      }\n    },\n  }))\n  .views(self => ({\n    get dynamicBlocks() {\n      return calculateDynamicBlocks(self)\n    },\n    get staticBlocks() {\n      return calculateStaticBlocks(self)\n    },\n    get currBp() {\n      return this.dynamicBlocks\n        .map(a => a.end - a.start)\n        .reduce((a, b) => a + b, 0)\n    },\n\n    /**\n     * calculates the Px at which coord is found.\n     *\n     * @param refName - string, refName of region\n     * @param coord - number, bp to be translated to Px\n     * @param regionNumber - number, index of displayedRegion in displayedRegions array\n     */\n    bpToPx({\n      refName,\n      coord,\n      regionNumber,\n    }: {\n      refName: string\n      coord: number\n      regionNumber?: number\n    }) {\n      return viewBpToPx({ refName, coord, regionNumber, self })?.offsetPx\n    },\n  }))\n  .actions(self => ({\n    setFeatures(features: Feature[]) {\n      self.features = features\n    },\n\n    zoomToDisplayedRegions(\n      leftPx: BpOffset | undefined,\n      rightPx: BpOffset | undefined,\n    ) {\n      if (leftPx === undefined || rightPx === undefined) {\n        return\n      }\n\n      const singleRefSeq =\n        leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n      // zooming into one displayed Region\n      if (\n        (singleRefSeq && rightPx.offset < leftPx.offset) ||\n        leftPx.index > rightPx.index\n      ) {\n        ;[leftPx, rightPx] = [rightPx, leftPx]\n      }\n      const startOffset = {\n        start: leftPx.start,\n        end: leftPx.end,\n        index: leftPx.index,\n        offset: leftPx.offset,\n      }\n      const endOffset = {\n        start: rightPx.start,\n        end: rightPx.end,\n        index: rightPx.index,\n        offset: rightPx.offset,\n      }\n      if (startOffset && endOffset) {\n        this.moveTo(startOffset, endOffset)\n      } else {\n        throw new Error('regions not found')\n      }\n    },\n\n    // this makes a zoomed out view that shows all displayedRegions\n    // that makes the overview bar square with the scale bar\n    showAllRegions() {\n      self.bpPerPx = self.totalBp / self.width\n      self.offsetPx = 0\n    },\n    /**\n     * offset is the base-pair-offset in the displayed region, index is the index of the\n     * displayed region in the linear genome view\n     *\n     * @param start - object as `{start, end, offset, index}`\n     * @param end - object as `{start, end, offset, index}`\n     */\n    moveTo(start: BpOffset, end: BpOffset) {\n      // find locations in the modellist\n      let bpSoFar = 0\n\n      if (start.index === end.index) {\n        bpSoFar += end.offset - start.offset\n      } else {\n        const s = self.displayedRegions[start.index]\n        bpSoFar += s.end - s.start - start.offset\n        if (end.index - start.index >= 2) {\n          for (let i = start.index + 1; i < end.index; i += 1) {\n            bpSoFar +=\n              self.displayedRegions[i].end - self.displayedRegions[i].start\n          }\n        }\n        bpSoFar += end.offset\n      }\n      this.zoomTo(\n        bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index)),\n      )\n\n      let bpToStart = 0\n      for (let i = 0; i < self.displayedRegions.length; i += 1) {\n        const region = self.displayedRegions[i]\n        if (start.index === i) {\n          bpToStart += start.offset\n          break\n        } else {\n          bpToStart += region.end - region.start\n        }\n      }\n      self.offsetPx =\n        Math.round(bpToStart / self.bpPerPx) +\n        self.interRegionPaddingWidth * start.index\n    },\n\n    zoomOut() {\n      this.zoomTo(self.bpPerPx * 2)\n    },\n\n    zoomIn() {\n      this.zoomTo(self.bpPerPx / 2)\n    },\n\n    zoomTo(newBpPerPx: number, offset = self.width / 2) {\n      const bpPerPx = newBpPerPx\n      if (bpPerPx === self.bpPerPx) {\n        return\n      }\n      const oldBpPerPx = self.bpPerPx\n      self.bpPerPx = bpPerPx\n\n      // tweak the offset so that the center of the view remains at the same coordinate\n      self.offsetPx = clamp(\n        Math.round(((self.offsetPx + offset) * oldBpPerPx) / bpPerPx - offset),\n        self.minOffset,\n        self.maxOffset,\n      )\n    },\n\n    scrollTo(offsetPx: number) {\n      const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n      self.offsetPx = newOffsetPx\n      return newOffsetPx\n    },\n    centerAt(bp: number, refName: string, regionIndex: number) {\n      const centerPx = self.bpToPx({\n        refName,\n        coord: bp,\n        regionNumber: regionIndex,\n      })\n      if (centerPx) {\n        this.scrollTo(Math.round(centerPx - self.width / 2))\n      }\n    },\n\n    scroll(distance: number) {\n      const oldOffsetPx = self.offsetPx\n      // the scroll is clamped to keep the linear genome on the main screen\n      const newOffsetPx = clamp(\n        self.offsetPx + distance,\n        self.minOffset,\n        self.maxOffset,\n      )\n      self.offsetPx = newOffsetPx\n      return newOffsetPx - oldOffsetPx\n    },\n  }))\n\nexport type Base1DViewStateModel = typeof Base1DView\nexport type Base1DViewModel = Instance<Base1DViewStateModel>\n\nexport default Base1DView\n","type Func<T> = (value: BaseBlock, index: number, array: BaseBlock[]) => T\n\nexport class BlockSet {\n  constructor(public blocks: BaseBlock[] = []) {}\n\n  push(block: BaseBlock) {\n    if (block instanceof ElidedBlock) {\n      if (this.blocks.length) {\n        const lastBlock = this.blocks[this.blocks.length - 1]\n        if (lastBlock instanceof ElidedBlock) {\n          lastBlock.push(block)\n          return\n        }\n      }\n    }\n\n    this.blocks.push(block)\n  }\n\n  getBlocks() {\n    return this.blocks\n  }\n\n  getRegions() {\n    return this.blocks.map(block => block.toRegion())\n  }\n\n  map<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.map(func, thisarg)\n  }\n\n  forEach<T, U = this>(func: Func<T>, thisarg?: U) {\n    return this.blocks.forEach(func, thisarg)\n  }\n\n  get length() {\n    return this.blocks.length\n  }\n\n  get totalWidthPx() {\n    return this.blocks.length\n      ? this.blocks.map(blocks => blocks.widthPx).reduce((a, b) => a + b)\n      : 0\n  }\n\n  get totalWidthPxWithoutBorders() {\n    return this.blocks.length\n      ? this.blocks\n          .filter(block => block.variant !== 'boundary')\n          .map(blocks => blocks.widthPx)\n          .reduce((a, b) => a + b)\n      : 0\n  }\n\n  get offsetPx() {\n    return this.blocks.length ? this.blocks[0].offsetPx : 0\n  }\n\n  get contentBlocks() {\n    return this.blocks.filter(block => block instanceof ContentBlock)\n  }\n\n  get totalBp() {\n    return this.contentBlocks\n      .map(block => block.end - block.start)\n      .reduce((a, b) => a + b, 0)\n  }\n}\n\nexport class BaseBlock {\n  public regionNumber?: number\n\n  public reversed?: boolean\n\n  public refName: string\n\n  public start: number\n\n  public end: number\n\n  public assemblyName: string\n\n  public key: string\n\n  public offsetPx: number\n\n  public widthPx = 0\n\n  public variant?: string\n\n  public isLeftEndOfDisplayedRegion?: boolean\n\n  /**\n   * a block that should be shown as filled with data\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: any) {\n    Object.assign(this, data)\n    this.assemblyName = data.assemblyName\n    this.refName = data.refName\n    this.start = data.start\n    this.end = data.end\n    this.key = data.key\n    this.offsetPx = data.offsetPx\n  }\n\n  /**\n   * rename the reference sequence of this block and return a new one\n   *\n   * @param refName -\n   * @returns either a new block with a renamed reference sequence,\n   * or the same block, if the ref name is not actually different\n   */\n  renameReference(refName: string) {\n    if (this.refName && refName !== this.refName) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return new (this.constructor as any)({ ...this, refName })\n    }\n    return this\n  }\n\n  toRegion() {\n    return {\n      refName: this.refName,\n      start: this.start,\n      end: this.end,\n      assemblyName: this.assemblyName,\n      reversed: this.reversed,\n    }\n  }\n}\n\nexport class ContentBlock extends BaseBlock {}\n\n/**\n * marker block representing one or more blocks that are\n * too small to be shown at the current zoom level\n */\nexport class ElidedBlock extends BaseBlock {\n  public widthPx: number\n\n  public elidedBlockCount = 0\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(data: Record<string, any>) {\n    super(data)\n    this.widthPx = data.widthPx\n  }\n\n  push(otherBlock: ElidedBlock) {\n    this.elidedBlockCount += 1\n\n    if (otherBlock) {\n      this.refName = ''\n      this.start = 0\n      this.end = 0\n      this.widthPx += otherBlock.widthPx\n    }\n  }\n}\n\n/**\n * marker block that sits between two different displayed regions\n * and provides a thick border between them\n */\nexport class InterRegionPaddingBlock extends BaseBlock {}\n","import { intersection2 } from './range'\nimport { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Base1DViewModel } from './calculateStaticBlocks'\n\n/**\n * returns a BlockSet of which the `blocks` attribute is an array of 'dynamic\n * blocks', which are blocks representing only the regions that are visible in\n * the view right now. these are mostly used by tracks for which static blocks\n * are not feasible.\n *\n * each block is a plain JS object like:\n *   `{ refName, start, end, offsetPx, reversed? }`\n *\n * start and end are in bp, and start is always less than end, but if reversed\n * is true, startBp will be on the right side of the visible region.\n *\n * offsetPx is the number of pixels from the left edge of the view to the left\n * edge of the region\n *\n * NOTE: start, end, and offsetPx may all be fractional!\n *\n * @returns BlockSet of `{ refName, startBp, end, offset, reversed? }`\n */\nexport default function calculateDynamicBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    width,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  if (!width) {\n    throw new Error('view has no width, cannot calculate displayed blocks')\n  }\n  const blocks = new BlockSet()\n  let displayedRegionLeftPx = 0\n  const windowLeftPx = offsetPx\n  const windowRightPx = windowLeftPx + width\n  displayedRegions.forEach((region, regionNumber) => {\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const displayedRegionRightPx =\n      displayedRegionLeftPx + (regionEnd - regionStart) / bpPerPx\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    if (\n      displayedRegionLeftPx < windowRightPx &&\n      displayedRegionRightPx > windowLeftPx\n    ) {\n      // this displayed region overlaps the view, so make a record for it\n      const [leftPx, rightPx] = intersection2(\n        windowLeftPx,\n        windowRightPx,\n        displayedRegionLeftPx,\n        displayedRegionRightPx,\n      )\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      let blockOffsetPx: number\n      if (reversed) {\n        start = Math.max(\n          regionStart,\n          regionEnd - (rightPx - displayedRegionLeftPx) * bpPerPx,\n        )\n        end = regionEnd - (leftPx - displayedRegionLeftPx) * bpPerPx\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n        blockOffsetPx = displayedRegionLeftPx + (regionEnd - end) / bpPerPx\n      } else {\n        start = (leftPx - displayedRegionLeftPx) * bpPerPx + regionStart\n        end = Math.min(\n          regionEnd,\n          (rightPx - displayedRegionLeftPx) * bpPerPx + regionStart,\n        )\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n        blockOffsetPx = displayedRegionLeftPx + (start - regionStart) / bpPerPx\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: blockOffsetPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && blocks.length === 0 && isLeftEndOfDisplayedRegion) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: -offsetPx,\n            offsetPx: blockData.offsetPx + offsetPx,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n          displayedRegionLeftPx += interRegionPaddingWidth\n        }\n\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          blockOffsetPx = blockData.offsetPx + blockData.widthPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width - blockOffsetPx + offsetPx,\n              offsetPx: blockOffsetPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    displayedRegionLeftPx += (regionEnd - regionStart) / bpPerPx\n  })\n  return blocks\n}\n","import { assembleLocString } from '.'\nimport {\n  BlockSet,\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from './blockTypes'\nimport { Region } from './types'\n\nexport interface Base1DViewModel {\n  offsetPx: number\n  width: number\n  displayedRegions: Region[]\n  bpPerPx: number\n  minimumBlockWidth: number\n  interRegionPaddingWidth: number\n}\n\nexport default function calculateStaticBlocks(\n  model: Base1DViewModel,\n  padding = true,\n  elision = true,\n  extra = 0,\n\n  // on the main thread, window.innerWidth is used because this reduces\n  // recalculating the blocks, otherwise, model.width for cases such as\n  // off-main-thread. also this is not a ternary because our window.innerWidth\n  // might be undefined on off-main-thread, so instead use || model.width\n  width = (typeof window !== 'undefined' && window.innerWidth) || model.width,\n) {\n  const {\n    offsetPx,\n    displayedRegions,\n    bpPerPx,\n    minimumBlockWidth,\n    interRegionPaddingWidth,\n  } = model\n\n  const windowLeftBp = offsetPx * bpPerPx\n  const windowRightBp = (offsetPx + width) * bpPerPx\n  const blockSizePx = width\n  const blockSizeBp = Math.ceil(blockSizePx * bpPerPx)\n  // for each displayed region\n  let regionBpOffset = 0\n  const blocks = new BlockSet()\n  displayedRegions.forEach((region, regionNumber) => {\n    // find the block numbers of the left and right window sides,\n    // clamp those to the region range, and then make blocks for that range\n    const {\n      assemblyName,\n      refName,\n      start: regionStart,\n      end: regionEnd,\n      reversed,\n    } = region\n    const regionBlockCount = Math.ceil((regionEnd - regionStart) / blockSizeBp)\n\n    let windowRightBlockNum =\n      Math.floor((windowRightBp - regionBpOffset) / blockSizeBp) + extra\n    if (windowRightBlockNum >= regionBlockCount) {\n      windowRightBlockNum = regionBlockCount - 1\n    }\n\n    let windowLeftBlockNum =\n      Math.floor((windowLeftBp - regionBpOffset) / blockSizeBp) - extra\n    if (windowLeftBlockNum < 0) {\n      windowLeftBlockNum = 0\n    }\n\n    const regionWidthPx = (regionEnd - regionStart) / bpPerPx\n\n    for (\n      let blockNum = windowLeftBlockNum;\n      blockNum <= windowRightBlockNum;\n      blockNum += 1\n    ) {\n      let start: number\n      let end: number\n      let isLeftEndOfDisplayedRegion: boolean\n      let isRightEndOfDisplayedRegion: boolean\n      if (reversed) {\n        start = Math.max(regionStart, regionEnd - (blockNum + 1) * blockSizeBp)\n        end = regionEnd - blockNum * blockSizeBp\n        isLeftEndOfDisplayedRegion = end === regionEnd\n        isRightEndOfDisplayedRegion = start === regionStart\n      } else {\n        start = regionStart + blockNum * blockSizeBp\n        end = Math.min(regionEnd, regionStart + (blockNum + 1) * blockSizeBp)\n        isLeftEndOfDisplayedRegion = start === regionStart\n        isRightEndOfDisplayedRegion = end === regionEnd\n      }\n      const widthPx = (end - start) / bpPerPx\n      const blockData = {\n        assemblyName,\n        refName,\n        start,\n        end,\n        reversed,\n        offsetPx: (regionBpOffset + blockNum * blockSizeBp) / bpPerPx,\n        parentRegion: region,\n        regionNumber,\n        widthPx,\n        isLeftEndOfDisplayedRegion,\n        isRightEndOfDisplayedRegion,\n        key: '',\n      }\n      blockData.key = `${assembleLocString(blockData)}-${regionNumber}${\n        reversed ? '-reversed' : ''\n      }`\n\n      if (padding && regionNumber === 0 && blockNum === 0) {\n        blocks.push(\n          new InterRegionPaddingBlock({\n            key: `${blockData.key}-beforeFirstRegion`,\n            widthPx: width,\n            offsetPx: blockData.offsetPx - width,\n            variant: 'boundary',\n          }),\n        )\n      }\n\n      if (elision && regionWidthPx < minimumBlockWidth) {\n        blocks.push(new ElidedBlock(blockData))\n      } else {\n        blocks.push(new ContentBlock(blockData))\n      }\n\n      if (padding) {\n        // insert a inter-region padding block if we are crossing a displayed region\n        if (\n          regionWidthPx >= minimumBlockWidth &&\n          blockData.isRightEndOfDisplayedRegion &&\n          regionNumber < displayedRegions.length - 1\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-rightpad`,\n              widthPx: interRegionPaddingWidth,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n            }),\n          )\n        }\n        if (\n          regionNumber === displayedRegions.length - 1 &&\n          blockData.isRightEndOfDisplayedRegion\n        ) {\n          regionBpOffset += interRegionPaddingWidth * bpPerPx\n          blocks.push(\n            new InterRegionPaddingBlock({\n              key: `${blockData.key}-afterLastRegion`,\n              widthPx: width,\n              offsetPx: blockData.offsetPx + blockData.widthPx,\n              variant: 'boundary',\n            }),\n          )\n        }\n      }\n    }\n    regionBpOffset += regionEnd - regionStart\n  })\n  return blocks\n}\n","// from https://www.w3.org/TR/css-color-4/#named-colors\n\nconst colors: Record<string, string> = {\n  aliceblue: '#F0F8FF',\n  antiquewhite: '#FAEBD7',\n  aqua: '#00FFFF',\n  aquamarine: '#7FFFD4',\n  azure: '#F0FFFF',\n  beige: '#F5F5DC',\n  bisque: '#FFE4C4',\n  black: '#000000',\n  blanchedalmond: '#FFEBCD',\n  blue: '#0000FF',\n  blueviolet: '#8A2BE2',\n  brown: '#A52A2A',\n  burlywood: '#DEB887',\n  cadetblue: '#5F9EA0',\n  chartreuse: '#7FFF00',\n  chocolate: '#D2691E',\n  coral: '#FF7F50',\n  cornflowerblue: '#6495ED',\n  cornsilk: '#FFF8DC',\n  crimson: '#DC143C',\n  cyan: '#00FFFF',\n  darkblue: '#00008B',\n  darkcyan: '#008B8B',\n  darkgoldenrod: '#B8860B',\n  darkgray: '#A9A9A9',\n  darkgreen: '#006400',\n  darkgrey: '#A9A9A9',\n  darkkhaki: '#BDB76B',\n  darkmagenta: '#8B008B',\n  darkolivegreen: '#556B2F',\n  darkorange: '#FF8C00',\n  darkorchid: '#9932CC',\n  darkred: '#8B0000',\n  darksalmon: '#E9967A',\n  darkseagreen: '#8FBC8F',\n  darkslateblue: '#483D8B',\n  darkslategray: '#2F4F4F',\n  darkslategrey: '#2F4F4F',\n  darkturquoise: '#00CED1',\n  darkviolet: '#9400D3',\n  deeppink: '#FF1493',\n  deepskyblue: '#00BFFF',\n  dimgray: '#696969',\n  dimgrey: '#696969',\n  dodgerblue: '#1E90FF',\n  firebrick: '#B22222',\n  floralwhite: '#FFFAF0',\n  forestgreen: '#228B22',\n  fuchsia: '#FF00FF',\n  gainsboro: '#DCDCDC',\n  ghostwhite: '#F8F8FF',\n  gold: '#FFD700',\n  goldenrod: '#DAA520',\n  gray: '#808080',\n  green: '#008000',\n  greenyellow: '#ADFF2F',\n  grey: '#808080',\n  honeydew: '#F0FFF0',\n  hotpink: '#FF69B4',\n  indianred: '#CD5C5C',\n  indigo: '#4B0082',\n  ivory: '#FFFFF0',\n  khaki: '#F0E68C',\n  lavender: '#E6E6FA',\n  lavenderblush: '#FFF0F5',\n  lawngreen: '#7CFC00',\n  lemonchiffon: '#FFFACD',\n  lightblue: '#ADD8E6',\n  lightcoral: '#F08080',\n  lightcyan: '#E0FFFF',\n  lightgoldenrodyellow: '#FAFAD2',\n  lightgray: '#D3D3D3',\n  lightgreen: '#90EE90',\n  lightgrey: '#D3D3D3',\n  lightpink: '#FFB6C1',\n  lightsalmon: '#FFA07A',\n  lightseagreen: '#20B2AA',\n  lightskyblue: '#87CEFA',\n  lightslategray: '#778899',\n  lightslategrey: '#778899',\n  lightsteelblue: '#B0C4DE',\n  lightyellow: '#FFFFE0',\n  lime: '#00FF00',\n  limegreen: '#32CD32',\n  linen: '#FAF0E6',\n  magenta: '#FF00FF',\n  maroon: '#800000',\n  mediumaquamarine: '#66CDAA',\n  mediumblue: '#0000CD',\n  mediumorchid: '#BA55D3',\n  mediumpurple: '#9370DB',\n  mediumseagreen: '#3CB371',\n  mediumslateblue: '#7B68EE',\n  mediumspringgreen: '#00FA9A',\n  mediumturquoise: '#48D1CC',\n  mediumvioletred: '#C71585',\n  midnightblue: '#191970',\n  mintcream: '#F5FFFA',\n  mistyrose: '#FFE4E1',\n  moccasin: '#FFE4B5',\n  navajowhite: '#FFDEAD',\n  navy: '#000080',\n  oldlace: '#FDF5E6',\n  olive: '#808000',\n  olivedrab: '#6B8E23',\n  orange: '#FFA500',\n  orangered: '#FF4500',\n  orchid: '#DA70D6',\n  palegoldenrod: '#EEE8AA',\n  palegreen: '#98FB98',\n  paleturquoise: '#AFEEEE',\n  palevioletred: '#DB7093',\n  papayawhip: '#FFEFD5',\n  peachpuff: '#FFDAB9',\n  peru: '#CD853F',\n  pink: '#FFC0CB',\n  plum: '#DDA0DD',\n  powderblue: '#B0E0E6',\n  purple: '#800080',\n  rebeccapurple: '#663399',\n  red: '#FF0000',\n  rosybrown: '#BC8F8F',\n  royalblue: '#4169E1',\n  saddlebrown: '#8B4513',\n  salmon: '#FA8072',\n  sandybrown: '#F4A460',\n  seagreen: '#2E8B57',\n  seashell: '#FFF5EE',\n  sienna: '#A0522D',\n  silver: '#C0C0C0',\n  skyblue: '#87CEEB',\n  slateblue: '#6A5ACD',\n  slategray: '#708090',\n  slategrey: '#708090',\n  snow: '#FFFAFA',\n  springgreen: '#00FF7F',\n  steelblue: '#4682B4',\n  tan: '#D2B48C',\n  teal: '#008080',\n  thistle: '#D8BFD8',\n  tomato: '#FF6347',\n  turquoise: '#40E0D0',\n  violet: '#EE82EE',\n  wheat: '#F5DEB3',\n  white: '#FFFFFF',\n  whitesmoke: '#F5F5F5',\n  yellow: '#FFFF00',\n  yellowgreen: '#9ACD32',\n}\n\nexport function namedColorToHex(name: string): string | undefined {\n  return colors[name]\n}\n\nexport function isNamedColor(name: string): boolean {\n  return !!colors[name]\n}\n","import {\n  darken,\n  emphasize as muiEmphasize,\n  getContrastRatio,\n  getLuminance as muiGetLuminance,\n  lighten,\n} from '@material-ui/core/styles/colorManipulator'\nimport { namedColorToHex, isNamedColor } from './cssColorsLevel4'\n\nexport { namedColorToHex, isNamedColor }\n\n/**\n * Algorithmically pick a contrasting text color that will\n * be visible on top of the given background color. Either\n * black or white.\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns 'black' or 'white'\n */\nexport function contrastingTextColor(color: string): string {\n  const luminance = getLuminance(color)\n  return luminance > 0.5 ? 'black' : 'white'\n}\n\n/**\n * The relative brightness of any point in a color space,\n * normalized to 0 for darkest black and 1 for lightest white.\n * Uses MUI's `getLuminance`, but adds support for named colors\n *\n * Formula: https://www.w3.org/TR/WCAG20-TECHS/G17.html#G17-tests\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n *  hsl(), hsla(), or named color\n * @returns The relative brightness of the color in the range 0 - 1\n */\nfunction getLuminance(color: string): number {\n  const convertedColor = namedColorToHex(color)\n  return muiGetLuminance(convertedColor || color)\n}\n\n/**\n * Darken or lighten a color, depending on its luminance.\n * Light colors are darkened, dark colors are lightened.\n * Uses MUI's `emphasize`, but adds support for named colors\n *\n * @param color - CSS color, i.e. one of: #nnn, #nnnnnn, rgb(), rgba(),\n * hsl(), hsla(), or named color\n * @param coefficient - multiplier in the range 0 - 1, defaults to 0.15\n * @returns A CSS color string. Hex input values are returned as rgb\n */\nexport function emphasize(color: string, coefficient = 0.15): string {\n  const convertedColor = namedColorToHex(color)\n  return muiEmphasize(convertedColor || color, coefficient)\n}\n\nexport function makeContrasting(\n  foreground: string,\n  background = 'white',\n  minContrastRatio = 3,\n) {\n  let convertedForeground = namedColorToHex(foreground) || foreground\n  const convertedBackground = namedColorToHex(background) || background\n  const backgroundLuminance = getLuminance(convertedBackground)\n  let contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  const originalColor = convertedForeground\n  let coefficient = 0.05\n  while (contrastRatio < minContrastRatio) {\n    convertedForeground =\n      backgroundLuminance > 0.5\n        ? darken(originalColor, coefficient)\n        : lighten(originalColor, coefficient)\n    coefficient += 0.05\n    contrastRatio = getContrastRatio(convertedForeground, convertedBackground)\n  }\n  return convertedForeground\n}\n","import { hashCode } from './'\n\n// generates a short \"id fingerprint\" from the config passed to the base\n// feature adapter by recursively enumerating props, but if config is too big\n// does not process entire config (FromConfigAdapter for example can be large)\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport default function idMaker(args: any, id = '') {\n  const keys = Object.keys(args)\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i]\n    if (id.length > 5000) {\n      break\n    }\n    if (typeof args[key] === 'object' && args[key]) {\n      id += idMaker(args[key], id)\n    } else {\n      id += `${key}-${args[key]};`\n    }\n  }\n  return hashCode(id)\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useRef, useState } from 'react'\nimport {\n  addDisposer,\n  getParent,\n  getSnapshot,\n  isAlive,\n  isStateTreeNode,\n  hasParent,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\nimport { reaction, IReactionPublic, IReactionOptions } from 'mobx'\nimport fromEntries from 'object.fromentries'\nimport merge from 'deepmerge'\nimport SimpleFeature, { Feature, isFeature } from './simpleFeature'\nimport {\n  isSessionModel,\n  isDisplayModel,\n  isViewModel,\n  isTrackModel,\n  AssemblyManager,\n  Region,\n  TypeTestedByPredicate,\n} from './types'\nimport { isAbortException, checkAbortSignal } from './aborting'\n\nexport type { Feature }\nexport * from './types'\nexport * from './aborting'\nexport * from './when'\nexport * from './range'\nexport { SimpleFeature, isFeature }\n\nexport * from './offscreenCanvasPonyfill'\nexport * from './offscreenCanvasUtils'\n\nif (!Object.fromEntries) {\n  // @ts-ignore\n  fromEntries.shim()\n}\n\nexport const inDevelopment =\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_ENV === 'development'\nexport const inProduction = !inDevelopment\n\nexport function useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handle = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handle)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// https://stackoverflow.com/questions/56283920/how-to-debounce-a-callback-in-functional-component-using-hooks\nexport function useDebouncedCallback<A extends any[]>(\n  callback: (...args: A) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<A>()\n  const timeout = useRef<ReturnType<typeof setTimeout>>()\n\n  function cleanup() {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }\n\n  // make sure our timeout gets cleared if our consuming component gets unmounted\n  useEffect(() => cleanup, [])\n\n  return function debouncedCallback(...args: A) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    cleanup()\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/** find the first node in the hierarchy that matches the given predicate */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  if (!hasParent(node)) {\n    throw new Error('node does not have parent')\n  }\n  let currentNode: IAnyStateTreeNode | undefined = getParent(node)\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) {\n      return currentNode\n    }\n    if (hasParent(currentNode)) {\n      currentNode = getParent(currentNode)\n    } else {\n      break\n    }\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 170,\n  friction = 26,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = Date.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const endOfAnimation = isVelocity && isDisplacement\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() =>\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        }),\n      )\n    }\n  }\n\n  return [\n    () => update({ lastPosition: fromValue }),\n    () => cancelAnimationFrame(animationFrameId),\n  ]\n}\n\n/** find the first node in the hierarchy that matches the given 'is' typescript type guard predicate */\nexport function findParentThatIs<\n  PREDICATE extends (thing: IAnyStateTreeNode) => boolean,\n>(\n  node: IAnyStateTreeNode,\n  predicate: PREDICATE,\n): TypeTestedByPredicate<PREDICATE> & IAnyStateTreeNode {\n  return findParentThat(node, predicate) as TypeTestedByPredicate<PREDICATE> &\n    IAnyStateTreeNode\n}\n\n/** get the current JBrowse session model, starting at any node in the state tree */\nexport function getSession(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isSessionModel)\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingView(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isViewModel)\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/** get the state model of the view in the state tree that contains the given node */\nexport function getContainingTrack(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isTrackModel)\n  } catch (e) {\n    throw new Error('no containing track found')\n  }\n}\n\nexport function getContainingDisplay(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isDisplayModel)\n  } catch (e) {\n    throw new Error('no containing display found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * //  '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * //  'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * //  'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * //  'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * //  'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString): string {\n  const { assemblyName, refName, start, end, reversed } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString\n  if (start !== undefined) {\n    startString = `:${(start + 1).toLocaleString('en-US')}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString\n  if (end !== undefined) {\n    endString =\n      start !== undefined && start + 1 === end\n        ? ''\n        : `..${end.toLocaleString('en-US')}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  let rev = ''\n  if (reversed) {\n    rev = '[rev]'\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}${rev}`\n}\n\nexport interface ParsedLocString {\n  assemblyName?: string\n  refName: string\n  start?: number\n  end?: number\n  reversed?: boolean\n}\n\nexport function parseLocStringOneBased(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n): ParsedLocString {\n  if (!locString) {\n    throw new Error('no location string provided, could not parse')\n  }\n  let reversed = false\n  if (locString.endsWith('[rev]')) {\n    reversed = true\n    locString = locString.replace(/\\[rev\\]$/, '')\n  }\n  // remove any whitespace\n  locString = locString.replace(/\\s/, '')\n  // refNames can have colons, ref https://samtools.github.io/hts-specs/SAMv1.pdf Appendix A\n  const assemblyMatch = locString.match(/(\\{(.+)\\})?(.+)/)\n  if (!assemblyMatch) {\n    throw new Error(`invalid location string: \"${locString}\"`)\n  }\n  const [, , assemblyName, location] = assemblyMatch\n  if (!assemblyName && location.startsWith('{}')) {\n    throw new Error(`no assembly name was provided in location \"${location}\"`)\n  }\n  const lastColonIdx = location.lastIndexOf(':')\n  if (lastColonIdx === -1) {\n    if (isValidRefName(location, assemblyName)) {\n      return { assemblyName, refName: location, reversed }\n    }\n    throw new Error(`Unknown reference sequence \"${location}\"`)\n  }\n  const prefix = location.slice(0, lastColonIdx)\n  const suffix = location.slice(lastColonIdx + 1)\n  if (\n    isValidRefName(prefix, assemblyName) &&\n    isValidRefName(location, assemblyName)\n  ) {\n    throw new Error(`ambiguous location string: \"${locString}\"`)\n  } else if (isValidRefName(prefix, assemblyName)) {\n    if (suffix) {\n      // see if it's a range\n      const rangeMatch = suffix.match(\n        /^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)(-?(\\d+|\\d{1,3}(,\\d{3})*))$/,\n      )\n      // see if it's a single point\n      const singleMatch = suffix.match(/^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)?$/)\n      if (rangeMatch) {\n        const [, start, , , , end] = rangeMatch\n        if (start !== undefined && end !== undefined) {\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +end.replace(/,/g, ''),\n            reversed,\n          }\n        }\n      } else if (singleMatch) {\n        const [, start, , , separator] = singleMatch\n        if (start !== undefined) {\n          if (separator) {\n            // indefinite end\n            return {\n              assemblyName,\n              refName: prefix,\n              start: +start.replace(/,/g, ''),\n              reversed,\n            }\n          }\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replace(/,/g, ''),\n            end: +start.replace(/,/g, ''),\n            reversed,\n          }\n        }\n      } else {\n        throw new Error(\n          `could not parse range \"${suffix}\" on location \"${locString}\"`,\n        )\n      }\n    } else {\n      return { assemblyName, refName: prefix, reversed }\n    }\n  } else if (isValidRefName(location, assemblyName)) {\n    return { assemblyName, refName: location, reversed }\n  }\n  throw new Error(`unknown reference sequence name in location \"${locString}\"`)\n}\n\n/**\n * Parse a 1-based location string into an interbase genomic location\n * @param locString - Location string\n * @param isValidRefName - Function that checks if a refName exists in the set\n * of all known refNames, or in the set of refNames for an assembly if\n * assemblyName is given\n * @example\n * ```ts\n * parseLocString('chr1:1..100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1-100', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString(`{hg19}chr1:1..100`, isValidRefName)\n * //  { assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1', isValidRefName)\n * //  { refName: 'chr1' }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1', isValidRefName)\n * //  { refName: 'chr1', start: 0, end: 1 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1..', isValidRefName)\n * //  { refName: 'chr1', start: 0}\n * ```\n */\nexport function parseLocString(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const parsed = parseLocStringOneBased(locString, isValidRefName)\n  if (typeof parsed.start === 'number') {\n    parsed.start -= 1\n  }\n  return parsed\n}\n\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) {\n    return assemblyComp\n  }\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) {\n    return refComp\n  }\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) {\n      return startComp\n    }\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) {\n      return endComp\n    }\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number): number {\n  if (num < min) {\n    return min\n  }\n  if (num > max) {\n    return max\n  }\n  return num\n}\n\nfunction roundToNearestPointOne(num: number): number {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  {\n    reversed,\n    end = 0,\n    start = 0,\n  }: { start?: number; end?: number; reversed?: boolean },\n  bpPerPx: number,\n) {\n  return roundToNearestPointOne((reversed ? end - bp : bp - start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180.0 / Math.PI\nconst piOverOneEighty = Math.PI / 180.0\nexport function radToDeg(radians: number) {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number) {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number): [number, number] {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number): [number, number] {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta]\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? [end, start] : [start, end]\n}\n\nexport const objectFromEntries = Object.fromEntries.bind(Object)\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iterable: Iterable<T>,\n  func: (item: T) => U,\n  sizeHint?: number,\n): U[] {\n  const results = sizeHint ? new Array(sizeHint) : []\n  let counter = 0\n  for (const item of iterable) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\ninterface Assembly {\n  name: string\n  [key: string]: any\n}\ninterface Track {\n  trackId: string\n  [key: string]: any\n}\ninterface Config {\n  savedSessions: unknown[]\n  assemblies: Assembly[]\n  tracks: Track[]\n  defaultSession?: {}\n}\n// similar to electron.js\nexport function mergeConfigs(A: Config, B: Config) {\n  const merged = merge(A, B)\n  if (B.defaultSession) {\n    merged.defaultSession = B.defaultSession\n  } else if (A.defaultSession) {\n    merged.defaultSession = A.defaultSession\n  }\n  return merged\n}\n\n// https://stackoverflow.com/a/53187807\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise.\n * @param array - The source array to search in\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true. If such an\n * element is found, findLastIndex immediately returns that element index.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: Array<T>,\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): number {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(signal), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    signal: AbortSignal,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  reactionOptions: IReactionOptions,\n  startedFunction: (aborter: AbortController) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: unknown) => void,\n) {\n  let inProgress: AbortController | undefined\n\n  function handleError(error: unknown) {\n    if (!isAbortException(error)) {\n      if (isAlive(self)) {\n        errorFunction(error)\n      } else {\n        console.error(error)\n      }\n    }\n  }\n\n  const reactionDisposer = reaction(\n    () => {\n      try {\n        return dataFunction(self)\n      } catch (e) {\n        handleError(e)\n        return undefined\n      }\n    },\n    async (data, mobxReactionHandle) => {\n      if (inProgress && !inProgress.signal.aborted) {\n        inProgress.abort()\n      }\n\n      if (!isAlive(self)) {\n        return\n      }\n      inProgress = new AbortController()\n\n      const thisInProgress = inProgress\n      startedFunction(thisInProgress)\n      try {\n        const result = await asyncReactionFunction(\n          data,\n          thisInProgress.signal,\n          self,\n          mobxReactionHandle,\n        )\n        checkAbortSignal(thisInProgress.signal)\n        if (isAlive(self)) {\n          successFunction(result)\n        }\n      } catch (e) {\n        if (thisInProgress && !thisInProgress.signal.aborted) {\n          thisInProgress.abort()\n        }\n        handleError(e)\n      }\n    },\n    reactionOptions,\n  )\n\n  addDisposer(self, reactionDisposer)\n  addDisposer(self, () => {\n    if (inProgress && !inProgress.signal.aborted) {\n      inProgress.abort()\n    }\n  })\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string>,\n  region: Region,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n\n  if (region && refNameMap && refNameMap[region.refName]) {\n    // clone the region so we don't modify it\n    if (isStateTreeNode(region)) {\n      region = { ...getSnapshot(region) }\n    } else {\n      region = { ...region }\n    }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return { ...region, refName: newRef, originalRefName: region.refName }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    signal?: AbortSignal\n    adapterConfig: unknown\n    sessionId: string\n    statusCallback?: Function\n  },\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { regions = [], adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n\n  const assemblyNames = regions.map(region => region.assemblyName)\n  const assemblyMaps = Object.fromEntries(\n    await Promise.all(\n      assemblyNames.map(async assemblyName => {\n        return [\n          assemblyName,\n          await assemblyManager.getRefNameMapForAdapter(\n            adapterConfig,\n            assemblyName,\n            args,\n          ),\n        ]\n      }),\n    ),\n  )\n\n  return {\n    ...args,\n    regions: regions.map((region, i) =>\n      // note: uses assemblyNames defined above since region could be dead now\n      renameRegionIfNeeded(assemblyMaps[assemblyNames[i]], region),\n    ),\n  }\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)]\n}\n\nexport function stringify({\n  refName,\n  coord,\n  oob,\n}: {\n  coord: number\n  refName: string\n  oob?: boolean\n}) {\n  return `${refName}:${coord.toLocaleString('en-US')}${\n    oob ? ' (out of bounds)' : ''\n  }`\n}\n\n// this is recommended in a later comment in https://github.com/electron/electron/issues/2288\n// for detecting electron in a renderer process, which is the one that has node enabled for us\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nexport const isElectron = /electron/i.test(\n  typeof navigator !== 'undefined' ? navigator.userAgent : '',\n)\n\nexport function revcom(seqString: string) {\n  return complement(seqString).split('').reverse().join('')\n}\n\nexport const complement = (() => {\n  const complementRegex = /[ACGT]/gi\n\n  // from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n  // generated with:\n  // perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\n  const complementTable = {\n    S: 'S',\n    w: 'w',\n    T: 'A',\n    r: 'y',\n    a: 't',\n    N: 'N',\n    K: 'M',\n    x: 'x',\n    d: 'h',\n    Y: 'R',\n    V: 'B',\n    y: 'r',\n    M: 'K',\n    h: 'd',\n    k: 'm',\n    C: 'G',\n    g: 'c',\n    t: 'a',\n    A: 'T',\n    n: 'n',\n    W: 'W',\n    X: 'X',\n    m: 'k',\n    v: 'b',\n    B: 'V',\n    s: 's',\n    H: 'D',\n    c: 'g',\n    D: 'H',\n    b: 'v',\n    R: 'Y',\n    G: 'C',\n  } as { [key: string]: string }\n\n  return (seqString: string) => {\n    return seqString.replace(complementRegex, m => complementTable[m] || '')\n  }\n})()\n\nexport function blobToDataURL(blob: Blob): Promise<string> {\n  const a = new FileReader()\n  return new Promise((resolve, reject) => {\n    a.onload = e => {\n      if (e.target) {\n        resolve(e.target.result as string)\n      } else {\n        reject(new Error('unknown result reading blob from canvas'))\n      }\n    }\n    a.readAsDataURL(blob)\n  })\n}\n\n// requires immediate execution in jest environment, because (hypothesis) it\n// otherwise listens for prerendered_canvas but reads empty pixels, and doesn't\n// get the contents of the canvas\nexport const rIC =\n  typeof jest === 'undefined'\n    ? // @ts-ignore\n      typeof window !== 'undefined' && window.requestIdleCallback\n      ? // @ts-ignore\n        window.requestIdleCallback\n      : (cb: Function) => setTimeout(() => cb(), 1)\n    : (cb: Function) => cb()\n\n// xref https://gist.github.com/tophtucker/62f93a4658387bb61e4510c37e2e97cf\nexport function measureText(str: unknown, fontSize = 10) {\n  // prettier-ignore\n  const widths = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2796875,0.2765625,0.3546875,0.5546875,0.5546875,0.8890625,0.665625,0.190625,0.3328125,0.3328125,0.3890625,0.5828125,0.2765625,0.3328125,0.2765625,0.3015625,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.2765625,0.2765625,0.584375,0.5828125,0.584375,0.5546875,1.0140625,0.665625,0.665625,0.721875,0.721875,0.665625,0.609375,0.7765625,0.721875,0.2765625,0.5,0.665625,0.5546875,0.8328125,0.721875,0.7765625,0.665625,0.7765625,0.721875,0.665625,0.609375,0.721875,0.665625,0.94375,0.665625,0.665625,0.609375,0.2765625,0.3546875,0.2765625,0.4765625,0.5546875,0.3328125,0.5546875,0.5546875,0.5,0.5546875,0.5546875,0.2765625,0.5546875,0.5546875,0.221875,0.240625,0.5,0.221875,0.8328125,0.5546875,0.5546875,0.5546875,0.5546875,0.3328125,0.5,0.2765625,0.5546875,0.5,0.721875,0.5,0.5,0.5,0.3546875,0.259375,0.353125,0.5890625]\n  const avg = 0.5279276315789471\n  return (\n    String(str)\n      .split('')\n      .map(c =>\n        c.charCodeAt(0) < widths.length ? widths[c.charCodeAt(0)] : avg,\n      )\n      .reduce((cur, acc) => acc + cur, 0) * fontSize\n  )\n}\n\nexport const defaultStarts = ['ATG']\nexport const defaultStops = ['TAA', 'TAG', 'TGA']\nexport const defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n *  take CodonTable above and generate larger codon table that includes\n *  all permutations of upper and lower case nucleotides\n */\nexport function generateCodonTable(table: any) {\n  const tempCodonTable: { [key: string]: string } = {}\n  Object.keys(table).forEach(codon => {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i][0] = nuc.toUpperCase()\n      nucs[i][1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0][i]\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1][j]\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2][k]\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  })\n  return tempCodonTable\n}\n\n// call statusCallback with current status and clear when finished\nexport async function updateStatus<U>(\n  msg: string,\n  cb: (arg: string) => void,\n  fn: () => U,\n) {\n  cb(msg)\n  const res = await fn()\n  cb('')\n  return res\n}\n\nexport function hashCode(str: string) {\n  let hash = 0\n  if (str.length === 0) {\n    return hash\n  }\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\nexport function objectHash(obj: Record<string, any>) {\n  return `${hashCode(JSON.stringify(obj))}`\n}\n\ninterface VirtualOffset {\n  blockPosition: number\n}\ninterface Block {\n  minv: VirtualOffset\n  maxv: VirtualOffset\n}\n\nexport async function bytesForRegions(\n  regions: Region[],\n  index: {\n    blocksForRange: (\n      ref: string,\n      start: number,\n      end: number,\n    ) => Promise<Block[]>\n  },\n) {\n  const blockResults = await Promise.all(\n    regions.map(r => index.blocksForRange(r.refName, r.start, r.end)),\n  )\n\n  return blockResults\n    .flat()\n    .map(block => ({\n      start: block.minv.blockPosition,\n      end: block.maxv.blockPosition + 65535,\n    }))\n    .reduce((a, b) => a + b.end - b.start, 0)\n}\n\nexport type ViewSnap = {\n  bpPerPx: number\n  interRegionPaddingWidth: number\n  minimumBlockWidth: number\n  width: number\n  displayedRegions: {\n    start: number\n    end: number\n    refName: string\n    reversed: boolean\n  }[]\n}\nexport function viewBpToPx({\n  refName,\n  coord,\n  regionNumber,\n  self,\n}: {\n  refName: string\n  coord: number\n  regionNumber?: number\n  self: ViewSnap\n}) {\n  let offsetBp = 0\n\n  const interRegionPaddingBp = self.interRegionPaddingWidth * self.bpPerPx\n  const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n  const index = self.displayedRegions.findIndex((region, idx) => {\n    const len = region.end - region.start\n    if (\n      refName === region.refName &&\n      coord >= region.start &&\n      coord <= region.end\n    ) {\n      if (regionNumber ? regionNumber === idx : true) {\n        offsetBp += region.reversed ? region.end - coord : coord - region.start\n        return true\n      }\n    }\n\n    // add the interRegionPaddingWidth if the boundary is in the screen\n    // e.g. offset>=0 && offset<width\n    if (\n      len > minimumBlockBp &&\n      offsetBp / self.bpPerPx >= 0 &&\n      offsetBp / self.bpPerPx < self.width\n    ) {\n      offsetBp += len + interRegionPaddingBp\n    } else {\n      offsetBp += len\n    }\n    return false\n  })\n  const found = self.displayedRegions[index]\n  if (found) {\n    return {\n      index,\n      offsetPx: Math.round(offsetBp / self.bpPerPx),\n    }\n  }\n\n  return undefined\n}\n\n// supported adapter types by text indexer\n//  ensure that this matches the method found in @jbrowse/text-indexing/util\nexport function supportedIndexingAdapters(type: string) {\n  return [\n    'Gff3TabixAdapter',\n    'VcfTabixAdapter',\n    'Gff3Adapter',\n    'VcfAdapter',\n  ].includes(type)\n}\n\nexport function getBpDisplayStr(totalBp: number) {\n  let str\n  if (Math.floor(totalBp / 1_000_000) > 0) {\n    str = `${parseFloat((totalBp / 1_000_000).toPrecision(3))}Mbp`\n  } else if (Math.floor(totalBp / 1_000) > 0) {\n    str = `${parseFloat((totalBp / 1_000).toPrecision(3))}Kbp`\n  } else {\n    str = `${toLocale(Math.floor(totalBp))}bp`\n  }\n  return str\n}\n\nexport function toLocale(n: number) {\n  return n.toLocaleString('en-US')\n}\n\nexport function getTickDisplayStr(totalBp: number, bpPerPx: number) {\n  let str\n  if (Math.floor(bpPerPx / 1_000) > 0) {\n    str = `${toLocale(parseFloat((totalBp / 1_000_000).toFixed(2)))}M`\n  } else {\n    str = `${toLocale(Math.floor(totalBp))}`\n  }\n  return str\n}\n\nexport function getViewParams(model: IAnyStateTreeNode, exportSVG?: boolean) {\n  // @ts-ignore\n  const { dynamicBlocks, staticBlocks, offsetPx } = getContainingView(model)\n  const b = dynamicBlocks?.contentBlocks[0] || {}\n  const staticblock = staticBlocks?.contentBlocks[0] || {}\n  const staticblock1 = staticBlocks?.contentBlocks[1] || {}\n  return {\n    offsetPx: exportSVG ? 0 : offsetPx - staticblock.offsetPx,\n    offsetPx1: exportSVG ? 0 : offsetPx - staticblock1.offsetPx,\n    start: b.start,\n    end: b.end,\n  }\n}\n\nexport function getLayoutId({\n  sessionId,\n  layoutId,\n}: {\n  sessionId: string\n  layoutId: string\n}) {\n  return sessionId + '-' + layoutId\n}\n","import { HttpRangeFetcher } from 'http-range-fetcher'\nimport { Buffer } from 'buffer'\nimport { RemoteFile, PolyfilledResponse } from 'generic-filehandle'\n\ntype BinaryRangeFetch = (\n  url: string,\n  start: number,\n  end: number,\n  options?: { headers?: HeadersInit; signal?: AbortSignal },\n) => Promise<BinaryRangeResponse>\n\ninterface BinaryRangeResponse {\n  headers: Record<string, string>\n  requestDate: Date\n  responseDate: Date\n  buffer: Buffer\n}\n\nconst fetchers: Record<string, BinaryRangeFetch> = {}\n\nfunction binaryRangeFetch(\n  url: string,\n  start: number,\n  end: number,\n  options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n): Promise<BinaryRangeResponse> {\n  const fetcher = fetchers[url]\n  if (!fetcher) {\n    throw new Error(`fetch not registered for ${url}`)\n  }\n  return fetcher(url, start, end, options)\n}\n\nconst globalRangeCache = new HttpRangeFetcher({\n  fetch: binaryRangeFetch,\n  size: 500 * 1024 ** 2, // 500MiB\n  chunkSize: 128 * 124, // 128KiB\n  maxFetchSize: 100 * 1024 ** 2, // 100MiB\n  minimumTTL: 24 * 60 * 60 * 1000, // 1 day\n})\n\nexport function clearCache() {\n  globalRangeCache.reset()\n}\n\nexport class RemoteFileWithRangeCache extends RemoteFile {\n  public async fetch(\n    url: RequestInfo,\n    init?: RequestInit,\n  ): Promise<PolyfilledResponse> {\n    if (!fetchers[String(url)]) {\n      fetchers[String(url)] = this.fetchBinaryRange.bind(this)\n    }\n    // if it is a range request, route it through the range cache\n    const requestHeaders = init && init.headers\n    let range\n    if (requestHeaders) {\n      if (requestHeaders instanceof Headers) {\n        range = requestHeaders.get('range')\n      } else if (Array.isArray(requestHeaders)) {\n        ;[, range] = requestHeaders.find(([key]) => key === 'range') || [\n          undefined,\n          undefined,\n        ]\n      } else {\n        range = requestHeaders.range\n      }\n    }\n    if (range) {\n      const rangeParse = /bytes=(\\d+)-(\\d+)/.exec(range)\n      if (rangeParse) {\n        const [, start, end] = rangeParse\n        const s = parseInt(start, 10)\n        const e = parseInt(end, 10)\n        const response = await (globalRangeCache.getRange(url, s, e - s + 1, {\n          signal: init && init.signal,\n        }) as Promise<BinaryRangeResponse>)\n        const { headers } = response\n        return new Response(response.buffer, { status: 206, headers })\n      }\n    }\n    return super.fetch(url, init)\n  }\n\n  public async fetchBinaryRange(\n    url: string,\n    start: number,\n    end: number,\n    options: { headers?: HeadersInit; signal?: AbortSignal } = {},\n  ): Promise<BinaryRangeResponse> {\n    const requestDate = new Date()\n    const requestHeaders = {\n      ...options.headers,\n      range: `bytes=${start}-${end}`,\n    }\n    const res = await super.fetch(url, {\n      ...options,\n      headers: requestHeaders,\n    })\n    const responseDate = new Date()\n    if (res.status !== 206) {\n      const errorMessage = `HTTP ${res.status} (${res.statusText}) when fetching ${url} bytes ${start}-${end}`\n      const hint = ' (should be 206 for range requests)'\n      throw new Error(`${errorMessage}${res.status === 200 ? hint : ''}`)\n    }\n\n    // translate the Headers object into a regular key -> value object.\n    // will miss duplicate headers of course\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const headers: Record<string, any> = {}\n    for (const [k, v] of res.headers.entries()) {\n      headers[k] = v\n    }\n\n    // return the response headers, and the data buffer\n    const arrayBuffer = await res.arrayBuffer()\n    return {\n      headers,\n      requestDate,\n      responseDate,\n      buffer: Buffer.from(arrayBuffer),\n    }\n  }\n}\n","import {\n  BlobFile,\n  GenericFilehandle,\n  LocalFile,\n  Fetcher,\n} from 'generic-filehandle'\nimport isNode from 'detect-node'\n\n// locals\nimport { RemoteFileWithRangeCache } from './RemoteFileWithRangeCache'\nimport {\n  FileLocation,\n  LocalPathLocation,\n  BlobLocation,\n  isAppRootModel,\n  isUriLocation,\n  AuthNeededError,\n  UriLocation,\n} from '../types'\nimport { BaseInternetAccountModel } from '../../pluggableElementTypes/models'\nimport { getBlob } from '../tracks'\nimport PluginManager from '../../PluginManager'\nimport { isElectron } from '../'\n\nexport { RemoteFileWithRangeCache }\n\nfunction isLocalPathLocation(\n  location: FileLocation,\n): location is LocalPathLocation {\n  return 'localPath' in location\n}\n\nfunction isBlobLocation(location: FileLocation): location is BlobLocation {\n  return 'blobId' in location\n}\n\nexport function openLocation(\n  location: FileLocation,\n  pluginManager?: PluginManager,\n): GenericFilehandle {\n  if (!location) {\n    throw new Error('must provide a location to openLocation')\n  }\n  if (isLocalPathLocation(location)) {\n    if (!location.localPath) {\n      throw new Error('No local path provided')\n    }\n\n    if (isNode || isElectron) {\n      return new LocalFile(location.localPath)\n    } else {\n      throw new Error(\"can't use local files in the browser\")\n    }\n  }\n  if (isBlobLocation(location)) {\n    // special case where blob is not directly stored on the model, use a getter\n    const blob = getBlob(location.blobId)\n    if (!blob) {\n      throw new Error(\n        `file (\"${location.name}\") was opened locally from a previous session. To restore it, go to track settings and reopen the file`,\n      )\n    }\n    return new BlobFile(blob)\n  }\n  if (isUriLocation(location)) {\n    // Check for empty string\n    if (!location.uri) {\n      throw new Error('No URI provided')\n    }\n    // Resolve any relative URLs to absolute URLs\n    const absoluteLocation = location.baseUri\n      ? { ...location, uri: new URL(location.uri, location.baseUri).href }\n      : location\n    // If there is a plugin manager, we can try internet accounts\n    if (pluginManager) {\n      const internetAccount = getInternetAccount(location, pluginManager)\n      // If an internetAccount was found, use it to open the location\n      if (internetAccount) {\n        return internetAccount.openLocation(absoluteLocation)\n      }\n    }\n    // Otherwise fall back on usual open\n    return new RemoteFileWithRangeCache(absoluteLocation.uri, {\n      fetch: checkAuthNeededFetch,\n    })\n  }\n  throw new Error('invalid fileLocation')\n}\n\nexport function getFetcher(\n  location: FileLocation,\n  pluginManager: PluginManager,\n): Fetcher {\n  if (!isUriLocation(location)) {\n    throw new Error(`Not a valid UriLocation: ${JSON.stringify(location)}`)\n  }\n  const internetAccount = getInternetAccount(location, pluginManager)\n  if (internetAccount) {\n    return internetAccount.getFetcher(location)\n  }\n  return checkAuthNeededFetch\n}\n\nfunction getInternetAccount(\n  location: UriLocation,\n  pluginManager: PluginManager,\n): BaseInternetAccountModel | undefined {\n  const { rootModel } = pluginManager\n  // If there is an appRootModel, use it to find the internetAccount\n  if (rootModel && isAppRootModel(rootModel)) {\n    return rootModel.findAppropriateInternetAccount(location)\n  }\n  // If there is no appRootModel, but there is pre-auth, create a temporary\n  // internetAccount. This is typical in a worker.\n  if (location.internetAccountPreAuthorization) {\n    if (!location.internetAccountPreAuthorization.authInfo.token) {\n      throw new Error(\n        'Failed to obtain token from internet account. Try reloading the page',\n      )\n    }\n    const internetAccountType = pluginManager.getInternetAccountType(\n      location.internetAccountPreAuthorization.internetAccountType,\n    )\n    return internetAccountType.stateModel.create({\n      type: location.internetAccountPreAuthorization.internetAccountType,\n      configuration:\n        location.internetAccountPreAuthorization.authInfo.configuration,\n    })\n  }\n  return\n}\n\n// This fetch throws a special error if the response is \"401\" and includes a\n// \"WWW-Authenticate: Basic\" header. This is so downstream code can retry if\n// needed with HTTP Basic authentication included\nasync function checkAuthNeededFetch(\n  url: RequestInfo,\n  opts?: RequestInit,\n): Promise<Response> {\n  const response = await fetch(url, opts)\n  if (response.status === 401) {\n    const authHeaders = response.headers.get('WWW-Authenticate')\n    if (authHeaders && authHeaders.includes('Basic')) {\n      throw new AuthNeededError(\n        'Accessing HTTPBasic resource without authentication',\n        url.toString(),\n      )\n    }\n  }\n  return response\n}\n","import jexl from 'jexl'\nimport { Feature } from './simpleFeature'\n\ntype JexlWithAddFunction = typeof jexl & {\n  addFunction(name: string, func: Function): void\n}\ntype JexlNonBuildable = Omit<typeof jexl, 'Jexl'>\n\nexport default function (/* config?: any*/): JexlNonBuildable {\n  const j = new jexl.Jexl() as JexlWithAddFunction\n  // someday will make sure all of configs callbacks are added in, including\n  // ones passed in\n\n  // below are core functions\n  j.addFunction('get', (feature: Feature, data: string) => feature.get(data))\n  j.addFunction('parent', (feature: Feature) => feature.parent())\n\n  j.addFunction('id', (feature: Feature) => feature.id())\n\n  // let user cast a jexl type into a javascript type\n  j.addFunction('cast', (arg: unknown) => arg)\n\n  // logging\n  j.addFunction('log', (thing: unknown) => {\n    console.log(thing) // eslint-disable-line no-console\n    return thing\n  })\n\n  // math\n  // addfunction added in jexl 2.3 but types/jexl still on 2.2\n  j.addFunction('max', Math.max)\n  j.addFunction('min', Math.min)\n  j.addFunction('sqrt', Math.sqrt)\n  j.addFunction('ceil', Math.ceil)\n  j.addFunction('floor', Math.floor)\n  j.addFunction('round', Math.round)\n  j.addFunction('abs', Math.abs)\n  j.addFunction('log10', Math.log10)\n  j.addFunction('parseInt', Number.parseInt)\n  j.addFunction('parseFloat', Number.parseFloat)\n\n  // string\n  j.addFunction('split', (s: string, char: string) => s.split(char))\n  j.addFunction('charAt', (s: string, index: number) => s.charAt(index))\n  j.addFunction('charCodeAt', (s: string, index: number) => s.charCodeAt(index))\n  j.addFunction('codePointAt', (s: string, pos: number) => s.codePointAt(pos))\n  j.addFunction('startsWith', (s: string, search: string, len?: number) =>\n    s.startsWith(search, len),\n  )\n  j.addFunction('endsWith', (s: string, search: string, len?: number) =>\n    s.endsWith(search, len),\n  )\n  j.addFunction('padEnd', (s: string, len: number, pad?: string) =>\n    s.padEnd(len, pad),\n  )\n  j.addFunction('padStart', (s: string, len: number, fill?: string) =>\n    s.padStart(len, fill),\n  )\n  j.addFunction('repeat', (s: string, count: number) => s.repeat(count))\n  j.addFunction('replace', (s: string, match: string, sub: string) =>\n    s.replace(match, sub),\n  )\n  j.addFunction('replaceAll', (s: string, match: string, sub: string) =>\n    s.replaceAll(match, sub),\n  )\n  j.addFunction('slice', (s: string, start: number, end?: number) =>\n    s.slice(start, end),\n  )\n  j.addFunction('startsWith', (s: string, search: string, pos?: number) =>\n    s.startsWith(search, pos),\n  )\n  j.addFunction('substring', (s: string, start: number, end?: number) =>\n    s.substring(start, end),\n  )\n  j.addFunction('toLowerCase', (s: string) => s.toLowerCase())\n  j.addFunction('toUpperCase', (s: string) => s.toUpperCase())\n  j.addFunction('trim', (s: string) => s.trim())\n  j.addFunction('trimEnd', (s: string) => s.trimEnd())\n  j.addFunction('trimStart', (s: string) => s.trimStart())\n\n  j.addFunction('getTag', (feature: Feature, s: string) => {\n    const tags = feature.get('tags')\n    return tags ? tags[s] : feature.get(s)\n  })\n\n  j.addBinaryOp('&', 15, (a: number, b: number) => a & b)\n\n  return j\n}\n","import createJexlInstance from './jexl'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst compilationCache: Record<string, any> = {}\n\n// revert function strings back to main, create a different file for jexlStrings.ts\n// pass the jexl property of the pluginManager as a param\n\n/**\n * compile a jexlExpression to a string\n *\n * @param str - string of code like `jexl:...`\n * @param options -\n */\nexport function stringToJexlExpression(\n  str: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  jexl?: any,\n) {\n  const cacheKey = `nosig|${str}`\n  if (!compilationCache[cacheKey]) {\n    const match = str.startsWith('jexl:')\n    if (!match) {\n      throw new Error('string does not appear to be in jexl format')\n    }\n    const code = str.split('jexl:')[1]\n    const compiled = jexl\n      ? jexl.compile(`${code}`)\n      : createJexlInstance().compile(`${code}`)\n    compilationCache[cacheKey] = compiled\n  }\n\n  return compilationCache[cacheKey]\n}\n","import { objectFromEntries } from '../index'\nimport {\n  RectTuple,\n  SerializedLayout,\n  Rectangle,\n  BaseLayout,\n} from './BaseLayout'\n\n/**\n * Rectangle-layout manager that lays out rectangles using bitmaps at\n * resolution that, for efficiency, may be somewhat lower than that of\n * the coordinate system for the rectangles being laid out.  `pitchX`\n * and `pitchY` are the ratios of input scale resolution to internal\n * bitmap resolution.\n */\n\n// minimum excess size of the array at which we garbage collect\nconst minSizeToBotherWith = 10000\nconst maxFeaturePitchWidth = 20000\n\nfunction segmentsIntersect(\n  x1: number,\n  x2: number,\n  y1: number,\n  y2: number,\n): boolean {\n  return x2 >= y1 && y2 >= x1\n}\n\ninterface RowState<T> {\n  min: number\n  max: number\n  offset: number\n  bits: (Record<string, T> | string | undefined)[]\n}\n// a single row in the layout\nclass LayoutRow<T> {\n  private padding: number\n\n  private allFilled?: Record<string, T> | string\n\n  private widthLimit: number\n\n  private rowState?: RowState<T>\n\n  constructor() {\n    this.padding = 1\n    this.widthLimit = 1000000\n\n    // this.rowState.offset is the offset of the bits array relative to the genomic coordinates\n    //      (modified by pitchX, but we don't know that in this class)\n    // this.rowState.bits is the array of items in the layout row, indexed by (x - this.offset)\n    // this.rowState.min is the leftmost edge of all the rectangles we have in the layout\n    // this.rowState.max is the rightmost edge of all the rectangles we have in the layout\n  }\n\n  // log(msg: string): void {\n  //   // if (this.rowNumber === 0)\n  //   // eslint-disable-next-line no-console\n  //   console.log(`r${this.rowNumber}: ${msg}`)\n  // }\n\n  setAllFilled(data: Record<string, T> | string): void {\n    this.allFilled = data\n  }\n\n  getItemAt(x: number): Record<string, T> | string | undefined {\n    if (this.allFilled) {\n      return this.allFilled\n    }\n    if (!this.rowState) {\n      return undefined\n    }\n\n    if (this.rowState.min === undefined) {\n      return undefined\n    }\n    if (x < this.rowState.min) {\n      return undefined\n    }\n    if (x >= this.rowState.max) {\n      return undefined\n    }\n    const offset = x - this.rowState.offset\n    // if (offset < 0)\n    //     debugger\n    // if (offset >= this.rowState.bits.length)\n    //     debugger\n    return this.rowState.bits[offset]\n  }\n\n  isRangeClear(left: number, right: number): boolean {\n    if (this.allFilled) {\n      return false\n    }\n\n    if (!this.rowState) {\n      return true\n    }\n\n    const { min, max } = this.rowState\n\n    if (right <= min || left >= max) {\n      return true\n    }\n\n    // TODO: check right and middle before looping\n    const maxX = Math.min(max, right)\n    let x = Math.max(min, left)\n    for (; x < right && x < maxX; x += 1) {\n      if (this.getItemAt(x)) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  initialize(left: number, right: number): RowState<T> {\n    // NOTE: this.rowState.min, this.rowState.max, and this.rowState.offset are interbase coordinates\n    const rectWidth = right - left\n    return {\n      offset: left - rectWidth,\n      min: left,\n      max: right,\n      bits: new Array(3 * rectWidth),\n    }\n    // this.log(`initialize ${this.rowState.min} - ${this.rowState.max} (${this.rowState.bits.length})`)\n  }\n\n  addRect(rect: Rectangle<T>, data: Record<string, T> | string): void {\n    const left = rect.l\n    const right = rect.r + this.padding // only padding on the right\n    if (!this.rowState) {\n      this.rowState = this.initialize(left, right)\n    }\n\n    // or check if we need to expand to the left and/or to the right\n    let oLeft = left - this.rowState.offset\n    let oRight = right - this.rowState.offset\n    const currLength = this.rowState.bits.length\n\n    // expand rightward if necessary\n    if (oRight >= this.rowState.bits.length) {\n      const additionalLength = oRight + 1\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n        this.rowState = this.initialize(left, right)\n      } else if (additionalLength > 0) {\n        this.rowState.bits = this.rowState.bits.concat(\n          new Array(additionalLength),\n        )\n      }\n    }\n\n    // expand leftward if necessary\n    if (left < this.rowState.offset) {\n      // use math.min to avoid negative lengths\n      const additionalLength = Math.min(\n        currLength - oLeft,\n        this.rowState.offset,\n      )\n      if (this.rowState.bits.length + additionalLength > this.widthLimit) {\n        console.warn(\n          'Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks.',\n        )\n\n        this.rowState = this.initialize(left, right)\n      } else {\n        this.rowState.bits = new Array(additionalLength).concat(\n          this.rowState.bits,\n        )\n        this.rowState.offset -= additionalLength\n      }\n    }\n    oRight = right - this.rowState.offset\n    oLeft = left - this.rowState.offset\n    const w = oRight - oLeft\n\n    if (w > maxFeaturePitchWidth) {\n      console.warn(\n        `Layout X pitch set too low, feature spans ${w} bits in a single row.`,\n        rect,\n        data,\n      )\n    }\n\n    for (let x = oLeft; x < oRight; x += 1) {\n      this.rowState.bits[x] = data\n    }\n\n    if (left < this.rowState.min) {\n      this.rowState.min = left\n    }\n    if (right > this.rowState.max) {\n      this.rowState.max = right\n    }\n  }\n\n  /**\n   *  Given a range of interbase coordinates, deletes all data dealing with that range\n   */\n  discardRange(left: number, right: number): void {\n    if (this.allFilled) {\n      return\n    } // allFilled is irrevocable currently\n\n    // if we have no data, do nothing\n    if (!this.rowState) {\n      return\n    }\n\n    // if doesn't overlap at all, do nothing\n    if (right <= this.rowState.min || left >= this.rowState.max) {\n      return\n    }\n\n    // if completely encloses range, discard everything\n    if (left <= this.rowState.min && right >= this.rowState.max) {\n      this.rowState = undefined\n      return\n    }\n\n    // if overlaps left edge, adjust the min\n    if (right > this.rowState.min && left <= this.rowState.min) {\n      this.rowState.min = right\n    }\n\n    // if overlaps right edge, adjust the max\n    if (left < this.rowState.max && right >= this.rowState.max) {\n      this.rowState.max = left\n    }\n\n    // now trim the left, right, or both sides of the array\n    if (\n      this.rowState.offset < this.rowState.min - minSizeToBotherWith &&\n      this.rowState.bits.length >\n        this.rowState.max + minSizeToBotherWith - this.rowState.offset\n    ) {\n      // trim both sides\n      const leftTrimAmount = this.rowState.min - this.rowState.offset\n      const rightTrimAmount =\n        this.rowState.bits.length -\n        1 -\n        (this.rowState.max - this.rowState.offset)\n      // if (rightTrimAmount <= 0) debugger\n      // if (leftTrimAmount <= 0) debugger\n      // this.log(`trim both sides, ${leftTrimAmount} from left, ${rightTrimAmount} from right`)\n      this.rowState.bits = this.rowState.bits.slice(\n        leftTrimAmount,\n        this.rowState.bits.length - rightTrimAmount,\n      )\n      this.rowState.offset += leftTrimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (this.rowState.offset < this.rowState.min - minSizeToBotherWith) {\n      // trim left side\n      const desiredOffset =\n        this.rowState.min - Math.floor(minSizeToBotherWith / 2)\n      const trimAmount = desiredOffset - this.rowState.offset\n      // this.log(`trim left side by ${trimAmount}`)\n      this.rowState.bits.splice(0, trimAmount)\n      this.rowState.offset += trimAmount\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    } else if (\n      this.rowState.bits.length >\n      this.rowState.max - this.rowState.offset + minSizeToBotherWith\n    ) {\n      // trim right side\n      const desiredLength =\n        this.rowState.max -\n        this.rowState.offset +\n        1 +\n        Math.floor(minSizeToBotherWith / 2)\n      // this.log(`trim right side by ${this.rowState.bits.length-desiredLength}`)\n      // if (desiredLength > this.rowState.bits.length) debugger\n      this.rowState.bits.length = desiredLength\n      // if (this.rowState.offset > this.rowState.min) debugger\n      // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n    }\n\n    // if (this.rowState.offset > this.rowState.min) debugger\n    // if (this.rowState.bits.length <= this.rowState.max - this.rowState.offset) debugger\n\n    // if range now enclosed in the new bounds, loop through and clear the bits\n    const oLeft = Math.max(this.rowState.min, left) - this.rowState.offset\n    // if (oLeft < 0) debugger\n    // if (oLeft >= this.rowState.bits.length) debugger\n    // if (oRight < 0) debugger\n    // if (oRight >= this.rowState.bits.length) debugger\n\n    const oRight = Math.min(right, this.rowState.max) - this.rowState.offset\n    for (let x = oLeft; x >= 0 && x < oRight; x += 1) {\n      this.rowState.bits[x] = undefined\n    }\n  }\n}\n\nexport default class GranularRectLayout<T> implements BaseLayout<T> {\n  private pitchX: number\n\n  private pitchY: number\n\n  private hardRowLimit: number\n\n  private bitmap: LayoutRow<T>[]\n\n  private rectangles: Map<string, Rectangle<T>>\n\n  public maxHeightReached: boolean\n\n  private maxHeight: number\n\n  private displayMode: string\n\n  private pTotalHeight: number\n\n  /*\n   *\n   * pitchX - layout grid pitch in the X direction\n   * pitchY - layout grid pitch in the Y direction\n   * maxHeight - maximum layout height, default Infinity (no max)\n   */\n  constructor({\n    pitchX = 10,\n    pitchY = 10,\n    maxHeight = 10000,\n    hardRowLimit = 10000,\n    displayMode = 'normal',\n  }: {\n    pitchX?: number\n    pitchY?: number\n    maxHeight?: number\n    displayMode?: string\n    hardRowLimit?: number\n  } = {}) {\n    this.pitchX = pitchX\n    this.pitchY = pitchY\n    this.hardRowLimit = hardRowLimit\n    this.maxHeightReached = false\n    this.displayMode = displayMode\n\n    // reduce the pitchY to try and pack the features tighter\n    if (this.displayMode === 'compact') {\n      this.pitchY = Math.round(this.pitchY / 4) || 1\n      this.pitchX = Math.round(this.pitchX / 4) || 1\n    }\n\n    this.bitmap = []\n    this.rectangles = new Map()\n    this.maxHeight = Math.ceil(maxHeight / this.pitchY)\n    this.pTotalHeight = 0 // total height, in units of bitmap squares (px/pitchY)\n  }\n\n  /**\n   * @returns top position for the rect, or Null if laying\n   *  out the rect would exceed maxHeight\n   */\n  addRect(\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data?: T,\n  ): number | null {\n    // if we have already laid it out, return its layout\n    const storedRec = this.rectangles.get(id)\n    if (storedRec) {\n      if (storedRec.top === null) {\n        return null\n      }\n\n      // add it to the bitmap again, since that bitmap range may have been\n      // discarded\n      this.addRectToBitmap(storedRec)\n      return storedRec.top * this.pitchY\n    }\n\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const pHeight = Math.ceil(height / this.pitchY)\n\n    const rectangle: Rectangle<T> = {\n      id,\n      l: pLeft,\n      r: pRight,\n      top: null,\n      h: pHeight,\n      originalHeight: height,\n      data,\n    }\n\n    const maxTop = this.maxHeight - pHeight\n    let top = 0\n    if (this.displayMode !== 'collapse') {\n      for (; top <= maxTop; top += 1) {\n        if (!this.collides(rectangle, top)) {\n          break\n        }\n      }\n\n      if (top > maxTop) {\n        rectangle.top = null\n        this.rectangles.set(id, rectangle)\n        this.maxHeightReached = true\n        return null\n      }\n    }\n    rectangle.top = top\n    this.addRectToBitmap(rectangle)\n    this.rectangles.set(id, rectangle)\n    this.pTotalHeight = Math.max(this.pTotalHeight || 0, top + pHeight)\n    return top * this.pitchY\n  }\n\n  collides(rect: Rectangle<T>, top: number): boolean {\n    const { bitmap } = this\n\n    const maxY = top + rect.h\n    for (let y = top; y < maxY; y += 1) {\n      const row = bitmap[y]\n      if (row && !row.isRangeClear(rect.l, rect.r)) {\n        return true\n      }\n    }\n\n    return false\n  }\n\n  /**\n   * make a subarray if it does not exist\n   */\n  private autovivifyRow(bitmap: LayoutRow<T>[], y: number): LayoutRow<T> {\n    let row = bitmap[y]\n    if (!row) {\n      if (y > this.hardRowLimit) {\n        throw new Error(\n          `layout hard limit (${\n            this.hardRowLimit * this.pitchY\n          }px) exceeded, aborting layout`,\n        )\n      }\n      row = new LayoutRow()\n      bitmap[y] = row\n    }\n    return row\n  }\n\n  addRectToBitmap(rect: Rectangle<T>): void {\n    if (rect.top === null) {\n      return\n    }\n\n    const data = rect.id\n    const yEnd = rect.top + rect.h\n    if (rect.r - rect.l > maxFeaturePitchWidth) {\n      // the rect is very big in relation to the view size, just pretend, for\n      // the purposes of layout, that it extends infinitely.  this will cause\n      // weird layout if a user scrolls manually for a very, very long time\n      // along the genome at the same zoom level.  but most users will not do\n      // that.  hopefully.\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).setAllFilled(data)\n      }\n    } else {\n      for (let y = rect.top; y < yEnd; y += 1) {\n        this.autovivifyRow(this.bitmap, y).addRect(rect, data)\n      }\n    }\n  }\n\n  /**\n   *  Given a range of X coordinates, deletes all data dealing with\n   *  the features.\n   */\n  discardRange(left: number, right: number): void {\n    // console.log( 'discard', left, right );\n    const pLeft = Math.floor(left / this.pitchX)\n    const pRight = Math.floor(right / this.pitchX)\n    const { bitmap } = this\n    for (let y = 0; y < bitmap.length; y += 1) {\n      const row = bitmap[y]\n      if (row) {\n        row.discardRange(pLeft, pRight)\n      }\n    }\n  }\n\n  hasSeen(id: string): boolean {\n    return this.rectangles.has(id)\n  }\n\n  getByCoord(x: number, y: number): Record<string, T> | string | undefined {\n    const pY = Math.floor(y / this.pitchY)\n    const row = this.bitmap[pY]\n    if (!row) {\n      return undefined\n    }\n    const pX = Math.floor(x / this.pitchX)\n    return row.getItemAt(pX)\n  }\n\n  getByID(id: string): RectTuple | undefined {\n    const r = this.rectangles.get(id)\n    if (r) {\n      const t = (r.top as number) * this.pitchY\n      return [r.l * this.pitchX, t, r.r * this.pitchX, t + r.originalHeight]\n    }\n\n    return undefined\n  }\n\n  getDataByID(id: string): unknown {\n    return this.rectangles.get(id)?.data\n  }\n\n  cleanup(): void {}\n\n  getTotalHeight(): number {\n    return this.pTotalHeight * this.pitchY\n  }\n\n  get totalHeight() {\n    return this.getTotalHeight()\n  }\n\n  getRectangles(): Map<string, RectTuple> {\n    return new Map(\n      Array.from(this.rectangles.entries()).map(([id, rect]) => {\n        const { l, r, originalHeight, top } = rect\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        return [id, [l * this.pitchX, t, r * this.pitchX, b]] // left, top, right, bottom\n      }),\n    )\n  }\n\n  serializeRegion(region: { start: number; end: number }): SerializedLayout {\n    const regionRectangles: { [key: string]: RectTuple } = {}\n    let maxHeightReached = false\n    for (const [id, rect] of this.rectangles.entries()) {\n      const { l, r, originalHeight, top } = rect\n      if (rect.top === null) {\n        maxHeightReached = true\n      } else {\n        const t = (top || 0) * this.pitchY\n        const b = t + originalHeight\n        const y1 = l * this.pitchX\n        const y2 = r * this.pitchX\n        const x1 = region.start\n        const x2 = region.end\n        // add +/- pitchX to avoid resolution causing errors\n        if (segmentsIntersect(x1, x2, y1 - this.pitchX, y2 + this.pitchX)) {\n          regionRectangles[id] = [y1, t, y2, b]\n        }\n      }\n    }\n    return {\n      rectangles: regionRectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached,\n    }\n  }\n\n  toJSON(): SerializedLayout {\n    const rectangles = objectFromEntries(this.getRectangles())\n    return {\n      rectangles,\n      containsNoTransferables: true,\n      totalHeight: this.getTotalHeight(),\n      maxHeightReached: this.maxHeightReached,\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLayout, SerializedLayout } from './BaseLayout'\n\nexport default class MultiLayout<SUB_LAYOUT_CLASS extends BaseLayout<T>, T> {\n  subLayouts: Map<string, SUB_LAYOUT_CLASS> = new Map()\n\n  subLayoutConstructorArgs: Record<string, any> = {}\n\n  /**\n   * layout class that just keeps a number of named sub-layouts.\n   * basically just a fancier\n   * `{ layout1: new GranularRectLayout(), layout2: new GranularRectLayout() ...}`\n   */\n  constructor(\n    public SubLayoutClass: new (...args: any[]) => SUB_LAYOUT_CLASS,\n    layoutArgs: Record<string, any> = {},\n  ) {\n    this.subLayouts = new Map()\n    this.subLayoutConstructorArgs = layoutArgs\n  }\n\n  getDataByID(id: string): unknown {\n    for (const layout of this.subLayouts.values()) {\n      // @ts-ignore\n      const r = layout.getDataByID(id)\n      if (r) {\n        return r\n      }\n    }\n    return undefined\n  }\n\n  getSublayout(layoutName: string): SUB_LAYOUT_CLASS {\n    let subLayout = this.subLayouts.get(layoutName)\n    if (subLayout === undefined) {\n      subLayout = new this.SubLayoutClass(this.subLayoutConstructorArgs)\n      this.subLayouts.set(layoutName, subLayout)\n      return subLayout\n    }\n\n    return subLayout\n  }\n\n  addRect(\n    layoutName: string,\n    id: string,\n    left: number,\n    right: number,\n    height: number,\n    data: Record<string, T> = {},\n  ) {\n    return this.getSublayout(layoutName).addRect(id, left, right, height, data)\n  }\n\n  discardRange(layoutName: string, left: number, right: number) {\n    const layout = this.subLayouts.get(layoutName)\n    return layout && layout.discardRange(left, right)\n  }\n\n  toJSON() {\n    const data: Record<string, SerializedLayout> = {}\n    for (const [layoutName, sublayout] of this.subLayouts.entries()) {\n      data[layoutName] = sublayout.toJSON()\n    }\n    return data\n  }\n}\n","import { objectFromEntries } from '..'\nimport {\n  RectTuple,\n  SerializedLayout,\n  BaseLayout,\n  Rectangle,\n} from './BaseLayout'\nimport RBush from 'rbush'\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\nexport default class PrecomputedLayout<T> implements BaseLayout<T> {\n  private rectangles: Map<string, RectTuple>\n\n  private totalHeight: number\n\n  public maxHeightReached: boolean\n\n  private rbush: RBush<Layout>\n\n  constructor({ rectangles, totalHeight, maxHeightReached }: SerializedLayout) {\n    this.rectangles = new Map(Object.entries(rectangles))\n    // rectangles is of the form \"featureId\": [leftPx, topPx, rightPx, bottomPx]\n    this.totalHeight = totalHeight\n    this.maxHeightReached = maxHeightReached\n    this.rbush = new RBush()\n    for (const [key, layout] of Object.entries(rectangles)) {\n      this.rbush.insert({\n        minX: layout[0],\n        minY: layout[1],\n        maxX: layout[2],\n        maxY: layout[3],\n        name: key,\n      })\n    }\n  }\n\n  addRect(id: string) {\n    const rect = this.rectangles.get(id)\n    if (!rect) {\n      throw new Error(`id ${id} not found in precomputed feature layout`)\n    }\n    // left, top, right, bottom\n    return rect[1]\n  }\n\n  /**\n   * returns a Map of `feature id -> rectangle`\n   */\n  getRectangles(): Map<string, RectTuple> {\n    return this.rectangles\n  }\n\n  getTotalHeight(): number {\n    return this.totalHeight\n  }\n\n  collides(_rect: Rectangle<T>, _top: number): boolean {\n    throw new Error('Method not implemented.')\n  }\n\n  getByCoord(x: number, y: number) {\n    const rect = { minX: x, minY: y, maxX: x + 1, maxY: y + 1 }\n    return this.rbush.collides(rect)\n      ? this.rbush.search(rect)[0].name\n      : undefined\n  }\n\n  getByID(id: string) {\n    return this.rectangles.get(id)\n  }\n\n  addRectToBitmap(_rect: Rectangle<T>, _data: Record<string, T>): void {\n    throw new Error('Method not implemented.')\n  }\n\n  discardRange(_left: number, _right: number): void {\n    throw new Error('Method not implemented.')\n  }\n\n  serializeRegion(_region: { start: number; end: number }): SerializedLayout {\n    throw new Error('Method not implemented.')\n  }\n\n  toJSON(): SerializedLayout {\n    return {\n      rectangles: objectFromEntries(this.rectangles),\n      totalHeight: this.totalHeight,\n      maxHeightReached: false,\n      containsNoTransferables: true,\n    }\n  }\n}\n","import MultiLayout from './MultiLayout'\nimport PrecomputedLayout from './PrecomputedLayout'\n\nclass ThrowingLayout {\n  constructor() {\n    throw new Error('invalid layout name')\n  }\n}\n\nexport default class PrecomputedMultiLayout extends MultiLayout {\n  constructor(json) {\n    // use ThrowingLayout because there is not supposed to be any creation\n    // of new layouts in a precomputed layout\n    super(ThrowingLayout)\n    Object.entries(json).forEach(([layoutName, sublayoutJson]) => {\n      this.subLayouts.set(layoutName, new PrecomputedLayout(sublayoutJson))\n    })\n  }\n}\n","import { inDevelopment } from '..'\n\ninterface AbsoluteCache {\n  dirty: boolean\n  left?: number\n  right?: number\n  top?: number\n  bottom?: number\n  width?: number\n  height?: number\n}\n\nexport default class SceneGraph {\n  private children: Map<string, SceneGraph>\n\n  private absoluteCache: AbsoluteCache\n\n  public parent?: SceneGraph\n\n  /**\n   * note: all coordinates are inter-base or inter-pixel coordinates\n   */\n  constructor(\n    public name: string,\n    public left: number,\n    public top: number,\n    public width: number,\n    public height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    public data?: Record<string, any>,\n  ) {\n    if (\n      inDevelopment &&\n      (typeof name !== 'string' ||\n        typeof left !== 'number' ||\n        Number.isNaN(left) ||\n        typeof top !== 'number' ||\n        Number.isNaN(top) ||\n        typeof width !== 'number' ||\n        Number.isNaN(width) ||\n        typeof height !== 'number' ||\n        Number.isNaN(height))\n    ) {\n      throw new TypeError('invalid SceneGraph arguments')\n    }\n    this.children = new Map()\n    this.absoluteCache = { dirty: true }\n  }\n\n  addChild(\n    nameOrSceneGraph: string | SceneGraph,\n    left: number,\n    top: number,\n    width: number,\n    height: number,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    data?: Record<string, any>,\n  ): SceneGraph {\n    let child: SceneGraph\n    if (nameOrSceneGraph instanceof SceneGraph) {\n      child = nameOrSceneGraph\n    } else {\n      child = new SceneGraph(nameOrSceneGraph, left, top, width, height, data)\n    }\n\n    if (!(child instanceof SceneGraph)) {\n      throw new TypeError(\n        'argument to addChild must be an array or a SceneGraph',\n      )\n    }\n\n    if (this.children.has(child.name)) {\n      throw new Error(`child named \"${child.name}\" already exists`)\n    }\n\n    // update the bounds to match the child\n    child.parent = this\n    const {\n      left: childLeft,\n      right: childRight,\n      top: childTop,\n      bottom: childBottom,\n    } = child.absolute\n    if (\n      childLeft !== undefined &&\n      childRight !== undefined &&\n      childTop !== undefined &&\n      childBottom !== undefined\n    ) {\n      this.expand(childLeft, childRight, childTop, childBottom)\n      this.children.set(child.name, child)\n    }\n    return child\n  }\n\n  getSubRecord(name: string): SceneGraph | undefined {\n    return this.children.get(name)\n  }\n\n  /**\n   * if the record does not already cover the given\n   * absolute extents, extend it to cover them\n   *\n   * @param left -\n   * @param right -\n   * @param top -\n   * @param bottom -\n   */\n  expand(\n    newLeft: number,\n    newRight: number,\n    newTop: number,\n    newBottom: number,\n  ): void {\n    const { left, right, top, bottom } = this.absolute\n    if (left !== undefined && newLeft < left) {\n      const diff = left - newLeft\n      this.width += diff\n      this.left -= diff\n    }\n    if (right !== undefined && newRight > right) {\n      this.width += newRight - right\n    }\n    if (top !== undefined && newTop < top) {\n      const diff = top - newTop\n      this.height += diff\n      this.top -= diff\n    }\n    if (bottom !== undefined && newBottom > bottom) {\n      this.height += newBottom - bottom\n    }\n    if (this.parent) {\n      this.parent.expand(newLeft, newRight, newTop, newBottom)\n    }\n    this.absoluteCache.dirty = true\n  }\n\n  get bottom(): number {\n    return this.top + this.height\n  }\n\n  get right(): number {\n    return this.left + this.width\n  }\n\n  walkParents(callback: Function): void {\n    if (this.parent) {\n      callback(this.parent)\n      this.parent.walkParents(callback)\n    }\n  }\n\n  walkChildren(callback: Function): void {\n    for (const sub of this.children.values()) {\n      callback(sub)\n      sub.walkChildren(callback)\n    }\n  }\n\n  get absolute(): AbsoluteCache {\n    if (this.absoluteCache.dirty) {\n      let xOffset = 0\n      let yOffset = 0\n      this.walkParents((node: SceneGraph) => {\n        xOffset += node.left\n        yOffset += node.top\n      })\n      this.absoluteCache = {\n        dirty: false,\n        left: this.left + xOffset,\n        right: this.right + xOffset,\n        top: this.top + yOffset,\n        bottom: this.bottom + yOffset,\n        width: this.width,\n        height: this.height,\n      }\n    }\n    return this.absoluteCache\n  }\n\n  move(x: number, y: number): void {\n    this.left += x\n    this.top += y\n\n    this.absoluteCache.dirty = true\n    this.walkChildren((c: SceneGraph) => {\n      c.absoluteCache.dirty = true\n    })\n    const { left, right, top, bottom } = this.absolute\n    if (\n      left !== undefined &&\n      right !== undefined &&\n      top !== undefined &&\n      bottom !== undefined\n    ) {\n      this.expand(left, right, top, bottom)\n    }\n  }\n}\n","/* eslint-disable no-underscore-dangle */\nimport {\n  isOptionalType,\n  isUnionType,\n  isArrayType,\n  isMapType,\n  isLateType,\n} from 'mobx-state-tree'\n\n/**\n * get the inner type of an MST optional, array, or late type object\n *\n * @param {IModelType} type\n * @returns {IModelType}\n */\nexport function getSubType(type) {\n  let t\n  if (isOptionalType(type)) {\n    t = type._subtype || type.type\n  } else if (isArrayType(type) || isMapType(type)) {\n    t = type._subtype || type._subType || type.subType\n  } else if (typeof type.getSubType === 'function') {\n    return type.getSubType()\n  } else {\n    throw new TypeError('unsupported mst type')\n  }\n  if (!t) {\n    // debugger\n    throw new Error('failed to get subtype')\n  }\n  return t\n}\n\n/**\n * get the array of\n * @param {MST Union Type obj} unionType\n * @returns {Array<IModelType>}\n */\nexport function getUnionSubTypes(unionType) {\n  if (!isUnionType(unionType)) {\n    throw new TypeError('not an MST union type')\n  }\n  const t =\n    unionType._types ||\n    unionType.types ||\n    getSubType(unionType)._types ||\n    getSubType(unionType).types\n  if (!t) {\n    // debugger\n    throw new Error('failed to extract subtypes from mst union')\n  }\n  return t\n}\n\n/**\n * get the type of one of the properties of the given MST model type\n *\n * @param {IModelType} type\n * @param {string} propertyName\n * @returns {IModelType}\n */\nexport function getPropertyType(type, propertyName) {\n  const propertyType = type.properties[propertyName]\n  return propertyType\n}\n\n/**\n * get the base type from inside an MST optional type\n * @param {*} type\n */\nexport function getDefaultValue(type) {\n  if (!isOptionalType(type)) {\n    throw new TypeError('type must be an optional type')\n  }\n  return type._defaultValue || type.defaultValue\n}\n\n/** get the string values of an MST enumeration type */\nexport function getEnumerationValues(type) {\n  const subtypes = getUnionSubTypes(type)\n  // the subtypes should all be literals with a value member\n  return subtypes.map(t => t.value)\n}\n\nexport function resolveLateType(maybeLate) {\n  if (\n    !isUnionType(maybeLate) &&\n    !isArrayType(maybeLate) &&\n    isLateType(maybeLate)\n  ) {\n    return maybeLate.getSubType()\n  }\n  return maybeLate\n}\n","/**\n * fast low-level intersection of 2 coordinate ranges. assumes interbase coordinates.\n *\n * assumes `left <= right` for both ranges\n *\n * @returns array of [left, right], or [] if the ranges do not intersect. the choice of [] is because it allows destructuring array assignment without check for undefined return\n */\nexport function intersection2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  // this code is verbose because \"if\" statements are faster than Math.min and Math.max\n  if (right1 > left2 && left1 < right2 && right2 - left2 && right1 - left1) {\n    if (left1 > left2) {\n      if (right1 < right2) {\n        // 1     |-------|\n        //     |------------|\n        return [left1, right1]\n      }\n      // 2         |----|\n      //      |------|\n      return [left1, right2]\n    }\n    if (right1 < right2) {\n      // 3  |-----|\n      //       |------|\n      return [left2, right1]\n    }\n    // 4     |------------|\n    //         |-------|\n    return [left2, right2]\n  }\n  return []\n}\n\n/**\n * Return whether 2 interbase coordinate ranges intersect.\n *\n * @param left1 -\n * @param right1 -\n * @param left2 -\n * @param right2 -\n *\n * @returns true if the two ranges intersect\n */\nexport function doesIntersect2(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return right1 > left2 && left1 < right2\n}\n\n/**\n * Return whether the first region is completely contained within the second region\n *\n * @param left1 - candidate inner region left\n * @param right1 - candidate inner region right\n * @param left2 - candidate outer region left\n * @param right2 - candidate outer region right\n */\nexport function isContainedWithin(\n  left1: number,\n  right1: number,\n  left2: number,\n  right2: number,\n) {\n  return left2 <= left1 && right2 >= right1\n}\n","import { Observable, Observer } from 'rxjs'\nimport { takeUntil } from 'rxjs/operators'\nimport { observeAbortSignal } from '.'\n\n/**\n * Wrapper for rxjs Observable.create with improved error handling and\n * aborting support\n * @param func - observer function, could be async\n */\nexport function ObservableCreate<T>(\n  func: (arg: Observer<T>) => void | Promise<void>,\n  signal?: AbortSignal,\n): Observable<T> {\n  return Observable.create((observer: Observer<T>) => {\n    try {\n      const ret = func(observer)\n      // catch async errors\n      if (ret && ret.catch) {\n        ret.catch(error => observer.error(error))\n      }\n    } catch (error) {\n      // catch sync errors\n      observer.error(error)\n    }\n  }).pipe(takeUntil(observeAbortSignal(signal)))\n}\n","/**\n * Abstract feature object\n */\nexport interface Feature {\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  get(name: 'refName'): string\n  get(name: 'start'): number\n  get(name: 'end'): number\n  get(name: 'subfeatures'): Feature[] | undefined\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(name: string): any\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  set(name: string, val: any): void\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  tags(): string[]\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  id(): string\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  parent(): Feature | undefined\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  children(): Feature[] | undefined\n\n  /*\n   * Convert to JSON\n   */\n  toJSON(): SimpleFeatureSerialized\n}\n\nexport function isFeature(thing: unknown): thing is Feature {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    typeof (thing as Feature).get === 'function' &&\n    typeof (thing as Feature).id === 'function'\n  )\n}\n\nexport interface SimpleFeatureArgs {\n  /** key-value data, must include 'start' and 'end' */\n  data: {}\n  /** optional parent feature */\n  parent?: Feature\n  /** unique identifier. can also be in data.uniqueId */\n  id: string | number // thing that can be stringified easily\n}\n\n// subfeatures do not have to have uniqueId\ninterface SimpleFeatureSerializedNoId {\n  [key: string]: unknown\n  parentId?: string\n  subfeatures?: SimpleFeatureSerializedNoId[]\n}\n\n// base serialized feature has to have a uniqueId\nexport interface SimpleFeatureSerialized extends SimpleFeatureSerializedNoId {\n  subfeatures?: SimpleFeatureSerializedNoId[]\n  uniqueId: string\n}\n\nfunction isSimpleFeatureSerialized(\n  args: SimpleFeatureSerialized | SimpleFeatureArgs,\n): args is SimpleFeatureSerialized {\n  return 'uniqueId' in args && typeof args.data !== 'object'\n}\n\n/**\n * Simple implementation of a feature object.\n */\nexport default class SimpleFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private data: Record<string, any>\n\n  private subfeatures?: SimpleFeature[]\n\n  private parentHandle?: Feature\n\n  private uniqueId: string\n\n  /**\n   * @param args - SimpleFeature args\n   *\n   * Note: args.data.subfeatures can be an array of these same args,\n   * which will be inflated to more instances of this class.\n   */\n  public constructor(args: SimpleFeatureArgs | SimpleFeatureSerialized) {\n    if (isSimpleFeatureSerialized(args)) {\n      this.data = args\n    } else {\n      this.data = args.data || {}\n      // load handle from args.parent (not args.data.parent)\n      // this reason is because if args is an object, it likely isn't properly loaded with\n      // parent as a Feature reference (probably a raw parent ID or something instead)\n      this.parentHandle = args.parent\n    }\n\n    // the feature id comes from\n    // args.id, args.data.uniqueId, or args.uniqueId due to this initialization\n    const id = isSimpleFeatureSerialized(args) ? args.uniqueId : args.id\n    if (id === undefined || id === null) {\n      throw new Error(\n        'SimpleFeature requires a unique `id` or `data.uniqueId` attribute',\n      )\n    }\n    this.uniqueId = String(id)\n\n    if (!(this.data.aliases || this.data.end - this.data.start >= 0)) {\n      throw new Error(\n        `invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`,\n      )\n    }\n\n    if (this.data.subfeatures) {\n      this.subfeatures = this.data.subfeatures?.map(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (f: any, i: number) =>\n          typeof f.get !== 'function'\n            ? new SimpleFeature({\n                id: f.uniqueId || `${id}-${i}`,\n                data: {\n                  strand: this.data.strand,\n                  ...f,\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                } as Record<string, any>,\n                parent: this,\n              })\n            : f,\n      )\n    }\n  }\n\n  /**\n   * Get a piece of data about the feature.  All features must have\n   * 'start' and 'end', but everything else is optional.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public get(name: string): any {\n    return name === 'subfeatures'\n      ? this.subfeatures\n      : name === 'parent'\n      ? this.parent()\n      : this.data[name]\n  }\n\n  /**\n   * Set an item of data.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public set(name: string, val: any): void {\n    this.data[name] = val\n  }\n\n  /**\n   * Get an array listing which data keys are present in this feature.\n   */\n  public tags(): string[] {\n    return Object.keys(this.data)\n  }\n\n  /**\n   * Get the unique ID of this feature.\n   */\n  public id(): string {\n    return this.uniqueId\n  }\n\n  /**\n   * Get this feature's parent feature, or undefined if none.\n   */\n  public parent(): Feature | undefined {\n    return this.parentHandle\n  }\n\n  /**\n   * Get an array of child features, or undefined if none.\n   */\n  public children(): Feature[] | undefined {\n    return this.get('subfeatures')\n  }\n\n  public toJSON(): SimpleFeatureSerialized {\n    const d = { ...this.data, uniqueId: this.id() } as SimpleFeatureSerialized\n    const p = this.parent()\n    if (p) {\n      d.parentId = p.id()\n    }\n    const c = this.children()\n    if (c) {\n      d.subfeatures = c.map(child => child.toJSON())\n    }\n    return d\n  }\n\n  public static fromJSON(json: SimpleFeatureSerialized) {\n    return new SimpleFeature({ ...json })\n  }\n}\n","import { Observable } from 'rxjs'\nimport { reduce } from 'rxjs/operators'\nimport { NoAssemblyRegion } from './types'\nimport { Feature } from './simpleFeature'\n\nexport interface UnrectifiedFeatureStats {\n  scoreMin: number\n  scoreMax: number\n  scoreSum: number\n  scoreSumSquares: number\n  featureCount: number\n  basesCovered: number\n}\nexport interface FeatureStats extends UnrectifiedFeatureStats {\n  featureDensity: number\n  scoreMean: number\n  scoreStdDev: number\n}\n\n/*\n * calculate standard deviation using the 'shortcut method' that accepts\n * the sum and the sum squares of the elements\n *\n * @param sum - sum(i, 1..n)\n * @param sumSquares - sum(i^2, 1..n)\n * @param n - number of elements\n * @param population - boolean: use population instead of sample correction\n * @return the estimated std deviation\n */\n\nexport function calcStdFromSums(\n  sum: number,\n  sumSquares: number,\n  n: number,\n  population = false,\n): number {\n  if (n === 0) {\n    return 0\n  }\n  let variance\n  if (population) {\n    variance = sumSquares / n - (sum * sum) / (n * n)\n  } else {\n    // sample correction is n-1\n    variance = sumSquares - (sum * sum) / n\n    if (n > 1) {\n      variance /= n - 1\n    }\n  }\n\n  return variance < 0 ? 0 : Math.sqrt(variance)\n}\n\n/*\n * @param stats - a summary stats object with scoreSum, featureCount, scoreSumSquares, and basesCovered\n * @return - a summary stats object with scoreMean, scoreStdDev, and featureDensity added\n */\nexport function rectifyStats(s: UnrectifiedFeatureStats): FeatureStats {\n  return {\n    ...s,\n    scoreMean: (s.scoreSum || 0) / (s.featureCount || s.basesCovered || 1),\n    scoreStdDev: calcStdFromSums(\n      s.scoreSum,\n      s.scoreSumSquares,\n      s.featureCount || s.basesCovered,\n    ),\n    featureDensity: (s.featureCount || 1) / s.basesCovered,\n  }\n}\n\n/*\n * calculates per-base scores for variable width features over a region\n * @param region - object contains start, end\n * @param features - list of features with start, end, score\n * @return array of numeric scores\n */\nexport function calcPerBaseStats(\n  region: NoAssemblyRegion,\n  features: Feature[],\n): number[] {\n  const { start, end } = region\n  const scores = []\n  const feats = features.sort((a, b) => a.get('start') - b.get('start'))\n  let pos = start\n  let currentFeat = 0\n  let i = 0\n\n  while (pos < end) {\n    while (currentFeat < feats.length && pos >= feats[currentFeat].get('end')) {\n      currentFeat += 1\n    }\n    const f = feats[currentFeat]\n    if (!f) {\n      scores[i] = 0\n    } else if (pos >= f.get('start') && pos < f.get('end')) {\n      scores[i] = f.get('score')\n    } else {\n      scores[i] = 0\n    }\n    i += 1\n    pos += 1\n  }\n  return scores\n}\n\n/*\n * transform a list of scores to summary statistics\n * @param region - object with start, end\n * @param feats - array of features which are possibly summary features\n * @return - object with scoreMax, scoreMin, scoreSum, scoreSumSquares, etc\n */\nexport async function scoresToStats(\n  region: NoAssemblyRegion,\n  features: Observable<Feature>,\n): Promise<FeatureStats> {\n  const { start, end } = region\n\n  const { scoreMin, scoreMax, scoreSum, scoreSumSquares, featureCount } =\n    await features\n      .pipe(\n        reduce(\n          (\n            seed: {\n              scoreMin: number\n              scoreMax: number\n              scoreSum: number\n              scoreSumSquares: number\n              featureCount: number\n            },\n            f: Feature,\n          ) => {\n            const score = f.get('score')\n            seed.scoreMax = Math.max(\n              seed.scoreMax,\n              f.get('summary') ? f.get('maxScore') : score,\n            )\n            seed.scoreMin = Math.min(\n              seed.scoreMin,\n              f.get('summary') ? f.get('minScore') : score,\n            )\n            seed.scoreSum += score\n            seed.scoreSumSquares += score * score\n            seed.featureCount += 1\n\n            return seed\n          },\n          {\n            scoreMin: Number.MAX_VALUE,\n            scoreMax: Number.MIN_VALUE,\n            scoreSum: 0,\n            scoreSumSquares: 0,\n            featureCount: 0,\n          },\n        ),\n      )\n      .toPromise()\n\n  return rectifyStats({\n    scoreMax,\n    scoreMin,\n    scoreSum,\n    scoreSumSquares,\n    featureCount,\n    basesCovered: end - start + 1,\n  })\n}\n\nexport function blankStats(): FeatureStats {\n  return {\n    scoreMin: 0,\n    scoreMax: 0,\n    scoreMean: 0,\n    scoreStdDev: 0,\n    scoreSum: 0,\n    scoreSumSquares: 0,\n    featureCount: 0,\n    featureDensity: 0,\n    basesCovered: 0,\n  }\n}\n","import { getParent, isRoot, IAnyStateTreeNode, getEnv } from 'mobx-state-tree'\nimport { getSession, objectHash } from './index'\nimport { PreFileLocation, FileLocation } from './types'\nimport { AnyConfigurationModel } from '../configuration/configurationSchema'\nimport { readConfObject } from '../configuration'\n\n/* utility functions for use by track models and so forth */\n\nexport function getTrackAssemblyNames(\n  track: IAnyStateTreeNode & { configuration: AnyConfigurationModel },\n) {\n  const trackConf = track.configuration\n  const trackAssemblyNames = readConfObject(trackConf, 'assemblyNames')\n  if (!trackAssemblyNames) {\n    // Check if it's an assembly sequence track\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parent = getParent<any>(track.configuration)\n    if ('sequence' in parent) {\n      return [readConfObject(parent, 'name')]\n    }\n  }\n  return trackAssemblyNames as string[]\n}\n\n/** return the rpcSessionId of the highest parent node in the tree that has an rpcSessionId */\n\nexport function getRpcSessionId(thisNode: IAnyStateTreeNode) {\n  interface NodeWithRpcSessionId extends IAnyStateTreeNode {\n    rpcSessionId: string\n  }\n  let highestRpcSessionId\n  for (let node = thisNode; !isRoot(node); node = getParent(node)) {\n    if ('rpcSessionId' in node) {\n      highestRpcSessionId = (node as NodeWithRpcSessionId).rpcSessionId\n    }\n  }\n  if (!highestRpcSessionId) {\n    throw new Error(\n      'getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute',\n    )\n  }\n  return highestRpcSessionId\n}\n\n/**\n * given an MST node, get the renderprops of the first parent container that has\n * renderProps\n * @param node -\n * @returns renderprops, or empty object if none found\n */\nexport function getParentRenderProps(node: IAnyStateTreeNode) {\n  for (\n    let currentNode = getParent(node);\n    !isRoot(currentNode);\n    currentNode = getParent(currentNode)\n  ) {\n    if ('renderProps' in currentNode) {\n      return currentNode.renderProps()\n    }\n  }\n\n  return {}\n}\n\nexport const UNKNOWN = 'UNKNOWN'\nexport const UNSUPPORTED = 'UNSUPPORTED'\n\nlet blobMap: { [key: string]: File } = {}\n\n// get a specific blob\nexport function getBlob(id: string) {\n  return blobMap[id]\n}\n\n// used to export entire context to webworker\nexport function getBlobMap() {\n  return blobMap\n}\n\n// used in new contexts like webworkers\nexport function setBlobMap(map: { [key: string]: File }) {\n  blobMap = map\n}\n\n// blob files are stored in a global map\nexport function storeBlobLocation(location: PreFileLocation) {\n  if (location && 'blob' in location) {\n    // possibly we should be more clear about when this is not undefined, and\n    // also allow mix of blob and url for index and file\n    // @ts-ignore\n    const blobId = `b${+Date.now()}`\n    blobMap[blobId] = location.blob\n    return { name: location?.blob.name, blobId, locationType: 'BlobLocation' }\n  }\n  return location\n}\n\n/**\n * creates a new location from the provided location including the appropriate suffix and location type\n * @param location - the FileLocation\n * @param suffix - the file suffix (e.g. .bam)\n * @returns the constructed location object from the provided prameters\n */\nexport function makeIndex(location: FileLocation, suffix: string) {\n  if ('uri' in location) {\n    return { uri: location.uri + suffix, locationType: 'UriLocation' }\n  }\n\n  if ('localPath' in location) {\n    return {\n      localPath: location.localPath + suffix,\n      locationType: 'LocalPathLocation',\n    }\n  }\n\n  return location\n}\n\n/**\n * constructs a potential index file (with suffix) from the provided file name\n * @param name - the name of the index file\n * @param typeA - one option of a potential two file suffix (e.g. CSI, BAI)\n * @param typeB - the second option of a potential two file suffix (e.g. CSI, BAI)\n * @returns a likely name of the index file for a given filename\n */\nexport function makeIndexType(\n  name: string | undefined,\n  typeA: string,\n  typeB: string,\n) {\n  return name?.toUpperCase().endsWith(typeA) ? typeA : typeB\n}\n\nexport interface AdapterConfig {\n  type: string\n  [key: string]: unknown\n}\n\nexport type AdapterGuesser = (\n  file: FileLocation,\n  index?: FileLocation,\n  adapterHint?: string,\n) => AdapterConfig | undefined\n\nexport type TrackTypeGuesser = (adapterName: string) => string | undefined\n\nexport function getFileName(track: FileLocation) {\n  const uri = 'uri' in track ? track.uri : undefined\n  const localPath = 'localPath' in track ? track.localPath : undefined\n  const blob = 'blobId' in track ? track : undefined\n  return (\n    blob?.name ||\n    uri?.slice(uri.lastIndexOf('/') + 1) ||\n    localPath?.slice(localPath.lastIndexOf('/') + 1) ||\n    ''\n  )\n}\n\nexport function guessAdapter(\n  file: FileLocation,\n  index: FileLocation | undefined,\n  adapterHint?: string,\n  model?: IAnyStateTreeNode,\n) {\n  if (model) {\n    const { pluginManager } = getEnv(model)\n    const adapterGuesser = pluginManager.evaluateExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (\n        _file: FileLocation,\n        _index?: FileLocation,\n        _adapterHint?: string,\n      ): AdapterConfig | undefined => {\n        return undefined\n      },\n    ) as AdapterGuesser\n\n    const adapter = adapterGuesser(file, index, adapterHint)\n\n    if (adapter) {\n      return adapter\n    }\n  }\n\n  return {\n    type: UNKNOWN,\n  }\n}\n\nexport function guessTrackType(\n  adapterType: string,\n  model?: IAnyStateTreeNode,\n): string {\n  if (model) {\n    // @ts-ignore\n    const session = getSession(model)\n\n    const trackTypeGuesser = getEnv(\n      session,\n    ).pluginManager.evaluateExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (_adapterName: string): AdapterConfig | undefined => {\n        return undefined\n      },\n    ) as TrackTypeGuesser\n\n    const trackType = trackTypeGuesser(adapterType)\n\n    if (trackType) {\n      return trackType\n    }\n  }\n  return 'FeatureTrack'\n}\n\nexport function generateUnsupportedTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unsupported)`,\n    description: `Support not yet implemented for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n\nexport function generateUnknownTrackConf(\n  trackName: string,\n  trackUrl: string,\n  categories: string[] | undefined,\n) {\n  const conf = {\n    type: 'FeatureTrack',\n    name: `${trackName} (Unknown)`,\n    description: `Could not determine track type for \"${trackUrl}\"`,\n    category: categories,\n    trackId: '',\n  }\n  conf.trackId = objectHash(conf)\n  return conf\n}\n","import shortid from 'shortid'\nimport { types } from 'mobx-state-tree'\nimport propTypes from 'prop-types'\nimport { PropTypes as MxPropTypes } from 'mobx-react'\n\nexport const ElementId = types.optional(types.identifier, shortid.generate)\n\n// PropTypes that are useful when working with instances of these in react components\nexport const PropTypes = {\n  Region: propTypes.shape({\n    refName: propTypes.string.isRequired,\n    start: propTypes.number.isRequired,\n    end: propTypes.number.isRequired,\n  }),\n  ConfigSchema: MxPropTypes.objectOrObservableObject,\n  Feature: propTypes.shape({\n    get: propTypes.func.isRequired,\n    id: propTypes.func.isRequired,\n  }),\n}\n\nexport const NoAssemblyRegion = types\n  .model('NoAssemblyRegion', {\n    refName: types.string,\n    start: types.number,\n    end: types.number,\n    reversed: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setRefName(newRefName: string): void {\n      self.refName = newRefName\n    },\n  }))\n\nexport const Region = types.compose(\n  'Region',\n  NoAssemblyRegion,\n  types.model({\n    assemblyName: types.string,\n  }),\n)\n\nexport const LocalPathLocation = types.model('LocalPathLocation', {\n  locationType: types.literal('LocalPathLocation'),\n  localPath: types.string,\n})\n\n// like how blobId is used to get a blob map\nexport const BlobLocation = types.model('BlobLocation', {\n  locationType: types.literal('BlobLocation'),\n  name: types.string,\n  blobId: types.string,\n})\n\nexport const UriLocationRaw = types.model('UriLocation', {\n  locationType: types.literal('UriLocation'),\n  uri: types.string,\n  baseUri: types.maybe(types.string),\n\n  internetAccountId: types.maybe(types.string),\n\n  // auths information (such as tokens) needed for using this resource.\n  // if provided, these must be completely sufficient for using it\n  internetAccountPreAuthorization: types.maybe(\n    types.model('InternetAccountPreAuthorization', {\n      internetAccountType: types.string,\n      authInfo: types.frozen(),\n    }),\n  ),\n})\n\nexport const UriLocation = types.snapshotProcessor(UriLocationRaw, {\n  postProcessor: snap => {\n    const { baseUri, ...rest } = snap\n    if (!baseUri) {\n      return rest\n    }\n    return snap\n  },\n})\n\nexport const FileLocation = types.snapshotProcessor(\n  types.union(LocalPathLocation, UriLocation, BlobLocation),\n  {\n    // @ts-ignore\n    preProcessor(snapshot) {\n      if (!snapshot) {\n        return undefined\n      }\n\n      // @ts-ignore\n      const { locationType, ...rest } = snapshot\n      if (!locationType) {\n        // @ts-ignore\n        const { uri, localPath, blob } = rest\n        let locationType = ''\n        if (uri !== undefined) {\n          locationType = 'UriLocation'\n        } else if (localPath !== undefined) {\n          locationType = 'LocalPathLocation'\n        } else if (blob !== undefined) {\n          locationType = 'BlobLocation'\n        }\n\n        return { ...rest, locationType }\n      }\n      return snapshot\n    },\n  },\n)\n","import { revcom } from '@jbrowse/core/util'\nexport interface Mismatch {\n  qual?: number\n  start: number\n  length: number\n  type: string\n  base: string\n  altbase?: string\n  seq?: string\n  cliplen?: number\n}\nconst mdRegex = new RegExp(/(\\d+|\\^[a-z]+|[a-z])/gi)\nconst modificationRegex = new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/)\nexport function parseCigar(cigar: string) {\n  return (cigar || '').split(/([MIDNSHPX=])/)\n}\nexport function cigarToMismatches(\n  ops: string[],\n  seq: string,\n  ref?: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let roffset = 0 // reference offset\n  let soffset = 0 // seq offset\n  const mismatches: Mismatch[] = []\n  const hasRefAndSeq = ref && seq\n  for (let i = 0; i < ops.length; i += 2) {\n    const len = +ops[i]\n    const op = ops[i + 1]\n\n    if (op === 'M' || op === '=' || op === 'E') {\n      if (hasRefAndSeq) {\n        for (let j = 0; j < len; j++) {\n          if (\n            // @ts-ignore in the full yarn build of the repo, this says that object is possibly undefined for some reason, ignored\n            seq[soffset + j].toUpperCase() !== ref[roffset + j].toUpperCase()\n          ) {\n            mismatches.push({\n              start: roffset + j,\n              type: 'mismatch',\n              base: seq[soffset + j],\n              altbase: ref[roffset + j],\n              length: 1,\n            })\n          }\n        }\n      }\n      soffset += len\n    }\n    if (op === 'I') {\n      mismatches.push({\n        start: roffset,\n        type: 'insertion',\n        base: `${len}`,\n        length: 0,\n      })\n      soffset += len\n    } else if (op === 'D') {\n      mismatches.push({\n        start: roffset,\n        type: 'deletion',\n        base: '*',\n        length: len,\n      })\n    } else if (op === 'N') {\n      mismatches.push({\n        start: roffset,\n        type: 'skip',\n        base: 'N',\n        length: len,\n      })\n    } else if (op === 'X') {\n      const r = seq.slice(soffset, soffset + len)\n      const q = qual?.slice(soffset, soffset + len) || []\n\n      for (let j = 0; j < len; j++) {\n        mismatches.push({\n          start: roffset + j,\n          type: 'mismatch',\n          base: r[j],\n          qual: q[j],\n          length: 1,\n        })\n      }\n      soffset += len\n    } else if (op === 'H') {\n      mismatches.push({\n        start: roffset,\n        type: 'hardclip',\n        base: `H${len}`,\n        cliplen: len,\n        length: 1,\n      })\n    } else if (op === 'S') {\n      mismatches.push({\n        start: roffset,\n        type: 'softclip',\n        base: `S${len}`,\n        cliplen: len,\n        length: 1,\n      })\n      soffset += len\n    }\n\n    if (op !== 'I' && op !== 'S' && op !== 'H') {\n      roffset += len\n    }\n  }\n  return mismatches\n}\n\n/**\n * parse a SAM MD tag to find mismatching bases of the template versus the reference\n * @returns array of mismatches and their positions\n */\nexport function mdToMismatches(\n  mdstring: string,\n  ops: string[],\n  cigarMismatches: Mismatch[],\n  seq: string,\n  qual?: Buffer,\n): Mismatch[] {\n  const mismatchRecords: Mismatch[] = []\n  let curr: Mismatch = { start: 0, base: '', length: 0, type: 'mismatch' }\n  const skips = cigarMismatches.filter(cigar => cigar.type === 'skip')\n  let lastCigar = 0\n  let lastTemplateOffset = 0\n  let lastRefOffset = 0\n  let lastSkipPos = 0\n\n  // convert a position on the reference sequence to a position\n  // on the template sequence, taking into account hard and soft\n  // clipping of reads\n\n  function nextRecord(): void {\n    mismatchRecords.push(curr)\n\n    // get a new mismatch record ready\n    curr = {\n      start: curr.start + curr.length,\n      length: 0,\n      base: '',\n      type: 'mismatch',\n    }\n  }\n\n  function getTemplateCoordLocal(refCoord: number): number {\n    let templateOffset = lastTemplateOffset\n    let refOffset = lastRefOffset\n    for (\n      let i = lastCigar;\n      i < ops.length && refOffset <= refCoord;\n      i += 2, lastCigar = i\n    ) {\n      const len = +ops[i]\n      const op = ops[i + 1]\n\n      if (op === 'S' || op === 'I') {\n        templateOffset += len\n      } else if (op === 'D' || op === 'P' || op === 'N') {\n        refOffset += len\n      } else if (op !== 'H') {\n        templateOffset += len\n        refOffset += len\n      }\n    }\n    lastTemplateOffset = templateOffset\n    lastRefOffset = refOffset\n\n    return templateOffset - (refOffset - refCoord)\n  }\n\n  // now actually parse the MD string\n  const md = mdstring.match(mdRegex) || []\n  for (let i = 0; i < md.length; i++) {\n    const token = md[i]\n    const num = +token\n    if (!Number.isNaN(num)) {\n      curr.start += num\n    } else if (token.startsWith('^')) {\n      curr.start += token.length - 1\n    } else {\n      // mismatch\n      for (let j = 0; j < token.length; j += 1) {\n        curr.length = 1\n\n        while (lastSkipPos < skips.length) {\n          const mismatch = skips[lastSkipPos]\n          if (curr.start >= mismatch.start) {\n            curr.start += mismatch.length\n            lastSkipPos++\n          } else {\n            break\n          }\n        }\n        const s = getTemplateCoordLocal(curr.start)\n        curr.base = seq[s] || 'X'\n        const qualScore = qual?.[s]\n        if (qualScore) {\n          curr.qual = qualScore\n        }\n        curr.altbase = token\n        nextRecord()\n      }\n    }\n  }\n  return mismatchRecords\n}\n\nexport function getMismatches(\n  cigar: string,\n  md: string,\n  seq: string,\n  ref?: string,\n  qual?: Buffer,\n): Mismatch[] {\n  let mismatches: Mismatch[] = []\n  const ops = parseCigar(cigar)\n\n  // parse the CIGAR tag if it has one\n  if (cigar) {\n    mismatches = mismatches.concat(cigarToMismatches(ops, seq, ref, qual))\n  }\n\n  // now let's look for CRAM or MD mismatches\n  if (md) {\n    mismatches = mismatches.concat(\n      mdToMismatches(md, ops, mismatches, seq, qual),\n    )\n  }\n\n  return mismatches\n}\n// get relative reference sequence positions for positions given relative to\n// the read sequence\nexport function* getNextRefPos(cigarOps: string[], positions: number[]) {\n  let readPos = 0\n  let refPos = 0\n  let currPos = 0\n\n  for (let i = 0; i < cigarOps.length && currPos < positions.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op === 'S' || op === 'I') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          currPos++\n        }\n      }\n      readPos += len\n    } else if (op === 'D' || op === 'N') {\n      refPos += len\n    } else if (op === 'M' || op === 'X' || op === '=') {\n      for (let i = 0; i < len && currPos < positions.length; i++) {\n        if (positions[currPos] === readPos + i) {\n          yield refPos + i\n          currPos++\n        }\n      }\n      readPos += len\n      refPos += len\n    }\n  }\n}\nexport function getModificationPositions(\n  mm: string,\n  fseq: string,\n  fstrand: number,\n) {\n  const seq = fstrand === -1 ? revcom(fseq) : fseq\n  const mods = mm.split(';').filter(mod => !!mod)\n  const result = []\n  for (let i = 0; i < mods.length; i++) {\n    const mod = mods[i]\n    const [basemod, ...skips] = mod.split(',')\n\n    // regexes based on parse_mm.pl from hts-specs\n    const matches = basemod.match(modificationRegex)\n    if (!matches) {\n      throw new Error('bad format for MM tag')\n    }\n    const [, base, strand, typestr] = matches\n\n    // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n    // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n    const types = typestr.split(/(\\d+|.)/).filter(f => !!f)\n\n    if (strand === '-') {\n      console.warn('unsupported negative strand modifications')\n      // make sure to return a somewhat matching type even in this case\n      result.push({ type: 'unsupported', positions: [] as number[] })\n    }\n\n    // this logic also based on parse_mm.pl from hts-specs is that in the\n    // sequence of the read, if we have a modification type e.g. C+m;2 and a\n    // sequence ACGTACGTAC we skip the two instances of C and go to the last\n    // C\n    for (let j = 0; j < types.length; j++) {\n      const type = types[j]\n      let i = 0\n      const positions = []\n      for (let k = 0; k < skips.length; k++) {\n        let delta = +skips[k]\n        do {\n          if (base === 'N' || base === seq[i]) {\n            delta--\n          }\n          i++\n        } while (delta >= 0 && i < seq.length)\n\n        const temp = i - 1\n        positions.push(fstrand === -1 ? seq.length - 1 - temp : temp)\n      }\n      if (fstrand === -1) {\n        positions.sort((a, b) => a - b)\n      }\n      result.push({\n        type,\n        positions,\n      })\n    }\n  }\n  return result\n}\n\nexport function getModificationTypes(mm: string) {\n  const mods = mm.split(';')\n  return mods\n    .filter(mod => !!mod)\n    .map(mod => {\n      const [basemod] = mod.split(',')\n\n      const matches = basemod.match(modificationRegex)\n      if (!matches) {\n        throw new Error('bad format for MM tag')\n      }\n      const [, , , typestr] = matches\n\n      // can be a multi e.g. C+mh for both meth (m) and hydroxymeth (h) so\n      // split, and they can also be chemical codes (ChEBI) e.g. C+16061\n      return typestr.split(/(\\d+|.)/).filter(f => !!f)\n    })\n    .flat()\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { toArray } from 'rxjs/operators'\nimport {\n  getTag,\n  getTagAlt,\n  fetchSequence,\n  shouldFetchReferenceSequence,\n} from '../util'\nimport {\n  parseCigar,\n  getNextRefPos,\n  getModificationPositions,\n  Mismatch,\n} from '../BamAdapter/MismatchParser'\n\nfunction mismatchLen(mismatch: Mismatch) {\n  return !isInterbase(mismatch.type) ? mismatch.length : 1\n}\n\nfunction isInterbase(type: string) {\n  return type === 'softclip' || type === 'hardclip' || type === 'insertion'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction inc(bin: any, strand: number, type: string, field: string) {\n  let thisBin = bin[type][field]\n  if (thisBin === undefined) {\n    thisBin = bin[type][field] = {\n      total: 0,\n      '-1': 0,\n      '0': 0,\n      '1': 0,\n    }\n  }\n  thisBin.total++\n  thisBin[strand]++\n}\n\nexport default class SNPCoverageAdapter extends BaseFeatureDataAdapter {\n  protected async configure() {\n    const subadapterConfig = this.getConf('subadapter')\n    const sequenceConf = this.getConf(['subadapter', 'sequenceAdapter'])\n    const dataAdapter = await this.getSubAdapter?.(subadapterConfig)\n\n    const sequenceAdapter = sequenceConf\n      ? await this.getSubAdapter?.(sequenceConf)\n      : undefined\n\n    if (!dataAdapter) {\n      throw new Error('Failed to get subadapter')\n    }\n\n    return {\n      subadapter: dataAdapter.dataAdapter as BaseFeatureDataAdapter,\n      sequenceAdapter: sequenceAdapter?.dataAdapter as\n        | BaseFeatureDataAdapter\n        | undefined,\n    }\n  }\n\n  async fetchSequence(region: Region) {\n    const { sequenceAdapter } = await this.configure()\n    if (!sequenceAdapter) {\n      return undefined\n    }\n\n    return fetchSequence(region, sequenceAdapter)\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { subadapter } = await this.configure()\n      const feats = await subadapter\n        .getFeatures(region, opts)\n        .pipe(toArray())\n        .toPromise()\n\n      const { bins, skipmap } = await this.generateCoverageBins(\n        feats,\n        region,\n        opts,\n      )\n\n      bins.forEach((bin, index) => {\n        observer.next(\n          new SimpleFeature({\n            id: `${this.id}-${region.start + index}`,\n            data: {\n              score: bin.total,\n              snpinfo: bin,\n              start: region.start + index,\n              end: region.start + index + 1,\n              refName: region.refName,\n            },\n          }),\n        )\n      })\n\n      // make fake features from the coverage\n      Object.entries(skipmap).forEach(([key, skip]) => {\n        observer.next(\n          new SimpleFeature({\n            id: key,\n            data: {\n              type: 'skip',\n              start: skip.start,\n              end: skip.end,\n              strand: skip.strand,\n              score: skip.score,\n              xs: skip.xs,\n            },\n          }),\n        )\n      })\n\n      observer.complete()\n    }, opts.signal)\n  }\n\n  async estimateRegionsStats(regions: Region[], opts?: BaseOptions) {\n    const { subadapter } = await this.configure()\n    return subadapter.estimateRegionsStats(regions, opts)\n  }\n\n  async getRefNames(opts: BaseOptions = {}) {\n    const { subadapter } = await this.configure()\n    return subadapter.getRefNames(opts)\n  }\n\n  freeResources(/* { region } */): void {}\n\n  async generateCoverageBins(\n    features: Feature[],\n    region: Region,\n    opts: { bpPerPx?: number; colorBy?: { type: string; tag?: string } },\n  ) {\n    const { colorBy } = opts\n    const binMax = Math.ceil(region.end - region.start)\n\n    const skipmap = {} as {\n      [key: string]: {\n        score: number\n        feature: unknown\n        start: number\n        end: number\n        strand: number\n        xs: string\n      }\n    }\n\n    // bins contain:\n    // - cov feature if they contribute to coverage\n    // - noncov are insertions/clip features that don't contribute to coverage\n    // - delskips deletions or introns that don't contribute to coverage\n    type BinType = { total: number; strands: { [key: string]: number } }\n\n    const regionSeq =\n      features.length && shouldFetchReferenceSequence(opts.colorBy?.type)\n        ? await this.fetchSequence(region)\n        : undefined\n\n    const bins = [] as {\n      refbase?: string\n      total: number\n      all: number\n      ref: number\n      '-1': 0\n      '0': 0\n      '1': 0\n      lowqual: BinType\n      cov: BinType\n      delskips: BinType\n      noncov: BinType\n    }[]\n\n    for (let i = 0; i < features.length; i++) {\n      const feature = features[i]\n      const fstart = feature.get('start')\n      const fend = feature.get('end')\n      const fstrand = feature.get('strand') as -1 | 0 | 1\n\n      for (let j = fstart; j < fend + 1; j++) {\n        const i = j - region.start\n        if (i >= 0 && i < binMax) {\n          if (bins[i] === undefined) {\n            bins[i] = {\n              total: 0,\n              all: 0,\n              ref: 0,\n              '-1': 0,\n              '0': 0,\n              '1': 0,\n              lowqual: {} as BinType,\n              cov: {} as BinType,\n              delskips: {} as BinType,\n              noncov: {} as BinType,\n            }\n          }\n          if (j !== fend) {\n            bins[i].total++\n            bins[i].all++\n            bins[i].ref++\n            bins[i][fstrand]++\n          }\n        }\n      }\n\n      if (colorBy?.type === 'modifications') {\n        const seq = feature.get('seq') as string\n        const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n        const ops = parseCigar(feature.get('CIGAR'))\n        const fend = feature.get('end')\n\n        getModificationPositions(mm, seq, fstrand).forEach(\n          ({ type, positions }) => {\n            const mod = `mod_${type}`\n            for (const pos of getNextRefPos(ops, positions)) {\n              const epos = pos + fstart - region.start\n              if (epos >= 0 && epos < bins.length && pos + fstart < fend) {\n                const bin = bins[epos]\n                if (bin) {\n                  inc(bin, fstrand, 'cov', mod)\n                } else {\n                  console.warn(\n                    'Undefined position in modifications snpcoverage encountered',\n                  )\n                }\n              }\n            }\n          },\n        )\n      }\n\n      // methylation based coloring takes into account both reference\n      // sequence CpG detection and reads\n      else if (colorBy?.type === 'methylation') {\n        if (!regionSeq) {\n          throw new Error(\n            'no region sequence detected, need sequenceAdapter configuration',\n          )\n        }\n        const seq = feature.get('seq')\n        const mm = getTagAlt(feature, 'MM', 'Mm') || ''\n        const methBins = new Array(region.end - region.start).fill(0)\n        const ops = parseCigar(feature.get('CIGAR'))\n\n        getModificationPositions(mm, seq, fstrand).forEach(\n          ({ type, positions }) => {\n            // we are processing methylation\n            if (type === 'm') {\n              for (const pos of getNextRefPos(ops, positions)) {\n                const epos = pos + fstart - region.start\n                if (epos >= 0 && epos < methBins.length) {\n                  methBins[epos] = 1\n                }\n              }\n            }\n          },\n        )\n\n        for (let j = fstart; j < fend; j++) {\n          const i = j - region.start\n          if (i >= 0 && i < bins.length - 1) {\n            const l1 = regionSeq[i].toLowerCase()\n            const l2 = regionSeq[i + 1].toLowerCase()\n            const bin = bins[i]\n            const bin1 = bins[i + 1]\n\n            // color\n            if (l1 === 'c' && l2 === 'g') {\n              if (methBins[i] || methBins[i + 1]) {\n                inc(bin, fstrand, 'cov', 'meth')\n                inc(bin1, fstrand, 'cov', 'meth')\n                bins[i].ref--\n                bins[i][fstrand]--\n                bins[i + 1].ref--\n                bins[i + 1][fstrand]--\n              } else {\n                inc(bin, fstrand, 'cov', 'unmeth')\n                inc(bin1, fstrand, 'cov', 'unmeth')\n                bins[i].ref--\n                bins[i][fstrand]--\n                bins[i + 1].ref--\n                bins[i + 1][fstrand]--\n              }\n            }\n          }\n        }\n      }\n\n      // normal SNP based coloring\n      const mismatches = (feature.get('mismatches') as Mismatch[]) || []\n      const colorSNPs =\n        colorBy?.type !== 'modifications' && colorBy?.type !== 'methylation'\n\n      for (let i = 0; i < mismatches.length; i++) {\n        const mismatch = mismatches[i]\n        const mstart = fstart + mismatch.start\n        const mlen = mismatchLen(mismatch)\n        const mend = mstart + mlen\n        for (let j = mstart; j < mstart + mlen; j++) {\n          const epos = j - region.start\n          if (epos >= 0 && epos < bins.length) {\n            const bin = bins[epos]\n            const { base, type } = mismatch\n            const interbase = isInterbase(type)\n            if (!interbase) {\n              bin.ref--\n              bin[fstrand]--\n            } else {\n              inc(bin, fstrand, 'noncov', type)\n            }\n\n            if (type === 'deletion' || type === 'skip') {\n              inc(bin, fstrand, 'delskips', type)\n              bin.total--\n            } else if (!interbase && colorSNPs) {\n              inc(bin, fstrand, 'cov', base)\n              bin.refbase = mismatch.altbase\n            }\n          }\n        }\n\n        if (mismatch.type === 'skip') {\n          const hash = `${mstart}_${mend}_${fstrand}`\n          if (skipmap[hash] === undefined) {\n            skipmap[hash] = {\n              feature: feature,\n              start: mstart,\n              end: mend,\n              strand: fstrand,\n              xs: getTag(feature, 'XS') || getTag(feature, 'TS'),\n              score: 0,\n            }\n          }\n          skipmap[hash].score++\n        }\n      }\n    }\n\n    return { bins, skipmap }\n  }\n}\n\nconst { capabilities } = SNPCoverageAdapter\nexport { capabilities }\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default (pluginManager: PluginManager) => {\n  return types.late(() =>\n    ConfigurationSchema(\n      'CramAdapter',\n      {\n        fetchSizeLimit: {\n          type: 'number',\n          defaultValue: 3_000_000,\n        },\n        cramLocation: {\n          type: 'fileLocation',\n          defaultValue: {\n            uri: '/path/to/my.cram',\n            locationType: 'UriLocation',\n          },\n        },\n        craiLocation: {\n          type: 'fileLocation',\n          defaultValue: {\n            uri: '/path/to/my.cram.crai',\n            locationType: 'UriLocation',\n          },\n        },\n        sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\n// locals\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'CramAdapter',\n        configSchema: pluginManager.load(configSchemaF),\n        getAdapterClass: () => import('./CramAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'BamAdapter',\n    {\n      bamLocation: {\n        type: 'fileLocation',\n        defaultValue: { uri: '/path/to/my.bam', locationType: 'UriLocation' },\n      },\n      index: ConfigurationSchema('BamIndex', {\n        indexType: {\n          model: types.enumeration('IndexType', ['BAI', 'CSI']),\n          type: 'stringEnum',\n          defaultValue: 'BAI',\n        },\n        location: {\n          type: 'fileLocation',\n          defaultValue: {\n            uri: '/path/to/my.bam.bai',\n            locationType: 'UriLocation',\n          },\n        },\n      }),\n      fetchSizeLimit: {\n        type: 'number',\n        defaultValue: 5_000_000,\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'BamAdapter',\n        configSchema,\n        getAdapterClass: () => import('./BamAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default types.late(() =>\n  ConfigurationSchema(\n    'HtsgetBamAdapter',\n    {\n      htsgetBase: {\n        type: 'string',\n        defaultValue: '',\n      },\n      htsgetTrackId: {\n        type: 'string',\n        defaultValue: '',\n      },\n      sequenceAdapter: {\n        type: 'frozen',\n        defaultValue: null,\n      },\n    },\n    { explicitlyTyped: true },\n  ),\n)\n","import configSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'HtsgetBamAdapter',\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        configSchema,\n        getAdapterClass: () =>\n          import('./HtsgetBamAdapter').then(r => r.default),\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport default (pluginManager: PluginManager) =>\n  types.late(() =>\n    ConfigurationSchema(\n      'SNPCoverageAdapter',\n      {\n        subadapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      },\n      { explicitlyTyped: true },\n    ),\n  )\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport configSchemaFactory from './configSchema'\nimport { capabilities } from './SNPCoverageAdapter'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'SNPCoverageAdapter',\n        adapterMetadata: {\n          category: null,\n          displayName: null,\n          hiddenFromGUI: true,\n          description: null,\n        },\n        getAdapterClass: () =>\n          import('./SNPCoverageAdapter').then(r => r.default),\n        configSchema: configSchemaFactory(pluginManager),\n        adapterCapabilities: capabilities,\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    indicatorThreshold: {\n      type: 'number',\n      description:\n        'the proportion of reads containing a insertion/clip indicator',\n      defaultValue: 0.4,\n    },\n    drawArcs: {\n      type: 'boolean',\n      description: 'Draw sashimi-style arcs for intron features',\n      defaultValue: true,\n    },\n    drawInterbaseCounts: {\n      type: 'boolean',\n      description:\n        'draw count \"upsidedown histogram\" of the interbase events that don\\'t contribute to the coverage count so are not drawn in the normal histogram',\n      defaultValue: true,\n    },\n    drawIndicators: {\n      type: 'boolean',\n      description:\n        'draw a triangular indicator where an event has been detected',\n      defaultValue: true,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { featureSpanPx, bpSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { RenderArgsDeserialized as FeatureRenderArgsDeserialized } from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport {\n  getOrigin,\n  getScale,\n  ScaleOpts,\n  WiggleBaseRenderer,\n  YSCALEBAR_LABEL_OFFSET,\n} from '@jbrowse/plugin-wiggle'\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  ticks: { values: number[] }\n  displayCrossHatches: boolean\n  modificationTagMap?: Record<string, string>\n}\n\ntype Counts = {\n  [key: string]: { total: number; strands: { [key: string]: number } }\n}\n\ninterface SNPInfo {\n  cov: Counts\n  noncov: Counts\n  total: number\n}\n\nexport default class SNPCoverageRenderer extends WiggleBaseRenderer {\n  // note: the snps are drawn on linear scale even if the data is drawn in log\n  // scape hence the two different scales being used\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      displayCrossHatches,\n      modificationTagMap = {},\n      scaleOpts,\n      height: unadjustedHeight,\n      theme: configTheme,\n      config: cfg,\n      ticks,\n    } = props\n    const theme = createJBrowseTheme(configTheme)\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const { domain } = scaleOpts\n    if (!domain) {\n      return\n    }\n    const opts = { ...scaleOpts, range: [0, height] }\n    const viewScale = getScale(opts)\n\n    // clipping and insertion indicators, uses a smaller height/2 scale\n    const indicatorViewScale = getScale({\n      ...opts,\n      range: [0, height / 2],\n      scaleType: 'linear',\n    })\n    const originY = getOrigin(scaleOpts.scaleType)\n\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold')\n    const drawInterbaseCounts = readConfObject(cfg, 'drawInterbaseCounts')\n    const drawArcs = readConfObject(cfg, 'drawArcs')\n    const drawIndicators = readConfObject(cfg, 'drawIndicators')\n\n    // get the y coordinate that we are plotting at, this can be log scale\n    const toY = (n: number) => height - (viewScale(n) || 0) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    const indicatorToY = (n: number) =>\n      height - (indicatorViewScale(n) || 0) + offset\n    const indicatorToHeight = (n: number) =>\n      indicatorToY(getOrigin('linear')) - indicatorToY(n)\n\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      total: 'lightgrey',\n      insertion: 'purple',\n      softclip: 'blue',\n      hardclip: 'red',\n      meth: 'red',\n      unmeth: 'blue',\n      ref: 'lightgrey',\n    }\n\n    const feats = [...features.values()]\n    const coverage = feats.filter(f => f.get('type') !== 'skip')\n    const skips = feats.filter(f => f.get('type') === 'skip')\n\n    // Use two pass rendering, which helps in visualizing the SNPs at higher\n    // bpPerPx First pass: draw the gray background\n    ctx.fillStyle = colorForBase.total\n    for (let i = 0; i < coverage.length; i++) {\n      const feature = coverage[i]\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3\n      const score = feature.get('score') as number\n      ctx.fillRect(leftPx, toY(score), w, toHeight(score))\n    }\n\n    // Keep track of previous total which we will use it to draw the interbase\n    // indicator (if there is a sudden clip, there will be no read coverage but\n    // there will be \"clip\" coverage) at that position beyond the read. if the\n    // clip is right at a block boundary then prevTotal will not be available,\n    // so this is a best attempt to plot interbase indicator at the \"cliffs\"\n    let prevTotal = 0\n\n    // extraHorizontallyFlippedOffset is used to draw interbase items, which\n    // are located to the left when forward and right when reversed\n    const extraHorizontallyFlippedOffset = region.reversed ? 1 / bpPerPx : 0\n\n    // Second pass: draw the SNP data, and add a minimum feature width of 1px\n    // which can be wider than the actual bpPerPx This reduces overdrawing of\n    // the grey background over the SNPs\n\n    for (let i = 0; i < coverage.length; i++) {\n      const feature = coverage[i]\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n\n      const score = feature.get('score') as number\n      const snpinfo = feature.get('snpinfo') as SNPInfo\n      const w = Math.max(rightPx - leftPx + 0.3, 1)\n      const totalScore = snpinfo.total\n      const keys = Object.keys(snpinfo.cov).sort()\n\n      let curr = 0\n      for (let i = 0; i < keys.length; i++) {\n        const base = keys[i]\n        const { total } = snpinfo.cov[base]\n        ctx.fillStyle =\n          colorForBase[base] ||\n          modificationTagMap[base.replace('mod_', '')] ||\n          '#888'\n\n        const height = toHeight(score)\n        const bottom = toY(score) + height\n        ctx.fillRect(\n          leftPx,\n          bottom - ((total + curr) / score) * height,\n          w,\n          (total / score) * height,\n        )\n        curr += total\n      }\n\n      const interbaseEvents = Object.keys(snpinfo.noncov)\n      const indicatorHeight = 4.5\n      if (drawInterbaseCounts) {\n        let curr = 0\n        for (let i = 0; i < interbaseEvents.length; i++) {\n          const base = interbaseEvents[i]\n          const { total } = snpinfo.noncov[base]\n          ctx.fillStyle = colorForBase[base]\n          ctx.fillRect(\n            leftPx - 0.6 + extraHorizontallyFlippedOffset,\n            indicatorHeight + indicatorToHeight(curr),\n            1.2,\n            indicatorToHeight(total),\n          )\n          curr += total\n        }\n      }\n\n      if (drawIndicators) {\n        let accum = 0\n        let max = 0\n        let maxBase = ''\n        for (let i = 0; i < interbaseEvents.length; i++) {\n          const base = interbaseEvents[i]\n          const { total } = snpinfo.noncov[base]\n          accum += total\n          if (total > max) {\n            max = total\n            maxBase = base\n          }\n        }\n\n        // avoid drawing a bunch of indicators if coverage is very low e.g.\n        // less than 7, uses the prev total in the case of the \"cliff\"\n        const indicatorComparatorScore = Math.max(totalScore, prevTotal)\n        if (\n          accum > indicatorComparatorScore * indicatorThreshold &&\n          indicatorComparatorScore > 7\n        ) {\n          ctx.fillStyle = colorForBase[maxBase]\n          ctx.beginPath()\n          const l = leftPx + extraHorizontallyFlippedOffset\n          ctx.moveTo(l - 3.5, 0)\n          ctx.lineTo(l + 3.5, 0)\n          ctx.lineTo(l, indicatorHeight)\n          ctx.fill()\n        }\n      }\n      prevTotal = totalScore\n    }\n\n    if (drawArcs) {\n      for (let i = 0; i < skips.length; i++) {\n        const f = skips[i]\n        const [left, right] = bpSpanPx(\n          f.get('start'),\n          f.get('end'),\n          region,\n          bpPerPx,\n        )\n\n        ctx.beginPath()\n        const str = f.get('strand') as number\n        const xs = f.get('xs') as string\n        const pos = 'rgba(255,200,200,0.7)'\n        const neg = 'rgba(200,200,255,0.7)'\n        const neutral = 'rgba(200,200,200,0.7)'\n\n        if (xs === '+') {\n          ctx.strokeStyle = pos\n        } else if (xs === '-') {\n          ctx.strokeStyle = neg\n        } else if (str === 1) {\n          ctx.strokeStyle = pos\n        } else if (str === -1) {\n          ctx.strokeStyle = neg\n        } else {\n          ctx.strokeStyle = neutral\n        }\n\n        ctx.lineWidth = Math.log(f.get('score') + 1)\n        ctx.moveTo(left, height - offset * 2)\n        ctx.bezierCurveTo(left, 0, right, 0, right, height - offset * 2)\n        ctx.stroke()\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(140,140,140,0.8)'\n      ticks.values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport SNPCoverageRenderer from './SNPCoverageRenderer'\n\nimport { WiggleRendering } from '@jbrowse/plugin-wiggle'\n\nexport const configSchema = ConfigurationSchema(\n  'SNPCoverageRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new SNPCoverageRenderer({\n        name: 'SNPCoverageRenderer',\n        ReactComponent: WiggleRendering,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import deepEqual from 'fast-deep-equal'\nimport { LayoutSession } from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport GranularRectLayout from '@jbrowse/core/util/layouts/GranularRectLayout'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport interface PileupLayoutSessionProps {\n  config: AnyConfigurationModel\n  bpPerPx: number\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: unknown\n}\n\ntype MyMultiLayout = MultiLayout<GranularRectLayout<unknown>, unknown>\ninterface CachedPileupLayout {\n  layout: MyMultiLayout\n  config: AnyConfigurationModel\n  filters: SerializableFilterChain\n  filterBy: unknown\n  sortedBy: unknown\n  showSoftClip: boolean\n}\n// Sorting and revealing soft clip changes the layout of Pileup renderer\n// Adds extra conditions to see if cached layout is valid\nexport class PileupLayoutSession extends LayoutSession {\n  sortedBy: unknown\n  filterBy: unknown\n\n  showSoftClip = false\n\n  constructor(args: PileupLayoutSessionProps) {\n    super(args)\n    this.config = args.config\n  }\n\n  cachedLayoutIsValid(cachedLayout: CachedPileupLayout) {\n    return (\n      super.cachedLayoutIsValid(cachedLayout) &&\n      this.showSoftClip === cachedLayout.showSoftClip &&\n      deepEqual(this.sortedBy, cachedLayout.sortedBy) &&\n      deepEqual(this.filterBy, cachedLayout.filterBy)\n    )\n  }\n\n  cachedLayout: CachedPileupLayout | undefined\n\n  get layout(): MyMultiLayout {\n    if (!this.cachedLayout || !this.cachedLayoutIsValid(this.cachedLayout)) {\n      this.cachedLayout = {\n        layout: this.makeLayout(),\n        config: readConfObject(this.config),\n        filters: this.filters,\n        filterBy: this.filterBy,\n        sortedBy: this.sortedBy,\n        showSoftClip: this.showSoftClip,\n      }\n    }\n    return this.cachedLayout.layout\n  }\n}\n","import Color from 'color'\nimport BoxRendererType, {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as BoxRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport { Theme } from '@material-ui/core'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport {\n  bpSpanPx,\n  iterMap,\n  measureText,\n  Region,\n  Feature,\n} from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { BaseLayout } from '@jbrowse/core/util/layouts/BaseLayout'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\n\n// locals\nimport {\n  Mismatch,\n  parseCigar,\n  getModificationPositions,\n  getNextRefPos,\n} from '../BamAdapter/MismatchParser'\nimport { sortFeature } from './sortUtil'\nimport {\n  getTagAlt,\n  orientationTypes,\n  fetchSequence,\n  shouldFetchReferenceSequence,\n} from '../util'\nimport {\n  PileupLayoutSession,\n  PileupLayoutSessionProps,\n} from './PileupLayoutSession'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\n\nfunction fillRect(\n  ctx: CanvasRenderingContext2D,\n  l: number,\n  t: number,\n  w: number,\n  h: number,\n  cw: number,\n  color?: string,\n) {\n  if (l + w < 0 || l > cw) {\n    return\n  } else {\n    if (color) {\n      ctx.fillStyle = color\n    }\n    ctx.fillRect(l, t, w, h)\n  }\n}\n\nfunction getColorBaseMap(theme: Theme) {\n  return {\n    A: theme.palette.bases.A.main,\n    C: theme.palette.bases.C.main,\n    G: theme.palette.bases.G.main,\n    T: theme.palette.bases.T.main,\n    deletion: '#808080', // gray\n  }\n}\n\nfunction getContrastBaseMap(theme: Theme) {\n  return Object.fromEntries(\n    Object.entries(getColorBaseMap(theme)).map(([key, value]) => [\n      key,\n      theme.palette.getContrastText(value),\n    ]),\n  )\n}\n\nexport interface RenderArgsDeserialized extends BoxRenderArgsDeserialized {\n  colorBy?: { type: string; tag?: string }\n  colorTagMap?: Record<string, string>\n  modificationTagMap?: Record<string, string>\n  sortedBy?: {\n    type: string\n    pos: number\n    refName: string\n    assemblyName: string\n    tag?: string\n  }\n  showSoftClip: boolean\n  highResolutionScaling: number\n}\n\nexport interface RenderArgsDeserializedWithFeaturesAndLayout\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n  layout: BaseLayout<Feature>\n  regionSequence?: string\n}\n\ninterface LayoutRecord {\n  feature: Feature\n  leftPx: number\n  rightPx: number\n  topPx: number\n  heightPx: number\n}\n\nconst alignmentColoring: { [key: string]: string } = {\n  color_fwd_strand_not_proper: '#ECC8C8',\n  color_rev_strand_not_proper: '#BEBED8',\n  color_fwd_strand: '#EC8B8B',\n  color_rev_strand: '#8F8FD8',\n  color_fwd_missing_mate: '#D11919',\n  color_rev_missing_mate: '#1919D1',\n  color_fwd_diff_chr: '#000',\n  color_rev_diff_chr: '#969696',\n  color_pair_lr: '#c8c8c8',\n  color_pair_rr: 'navy',\n  color_pair_rl: 'teal',\n  color_pair_ll: 'green',\n  color_nostrand: '#c8c8c8',\n  color_interchrom: 'orange',\n  color_longinsert: 'red',\n  color_shortinsert: 'pink',\n}\n\ninterface LayoutFeature {\n  heightPx: number\n  topPx: number\n  feature: Feature\n}\n\nfunction shouldDrawSNPs(type?: string) {\n  return !['methylation', 'modifications'].includes(type || '')\n}\n\nfunction shouldDrawIndels(type?: string) {\n  return true\n}\n\nexport default class PileupRenderer extends BoxRendererType {\n  supportsSVG = true\n\n  // get width and height of chars the height is an approximation: width\n  // letter M is approximately the height\n  getCharWidthHeight(ctx: CanvasRenderingContext2D) {\n    const charWidth = measureText('A')\n    const charHeight = measureText('M')\n    return { charWidth, charHeight }\n  }\n\n  layoutFeature({\n    feature,\n    layout,\n    bpPerPx,\n    region,\n    showSoftClip,\n    heightPx,\n    displayMode,\n  }: {\n    feature: Feature\n    layout: BaseLayout<Feature>\n    bpPerPx: number\n    region: Region\n    showSoftClip?: boolean\n    heightPx: number\n    displayMode: string\n  }): LayoutRecord | null {\n    let expansionBefore = 0\n    let expansionAfter = 0\n\n    // Expand the start and end of feature when softclipping enabled\n    if (showSoftClip) {\n      const mismatches = feature.get('mismatches') as Mismatch[]\n      const seq = feature.get('seq') as string\n      if (seq) {\n        for (let i = 0; i < mismatches.length; i += 1) {\n          const { type, start, cliplen = 0 } = mismatches[i]\n          if (type === 'softclip') {\n            start === 0\n              ? (expansionBefore = cliplen)\n              : (expansionAfter = cliplen)\n          }\n        }\n      }\n    }\n\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      region,\n      bpPerPx,\n    )\n\n    if (displayMode === 'compact') {\n      heightPx /= 3\n    }\n    if (feature.get('refName') !== region.refName) {\n      throw new Error(\n        `feature ${feature.id()} is not on the current region's reference sequence ${\n          region.refName\n        }`,\n      )\n    }\n    const topPx = layout.addRect(\n      feature.id(),\n      feature.get('start') - expansionBefore,\n      feature.get('end') + expansionAfter,\n      heightPx,\n      feature,\n    )\n    if (topPx === null) {\n      return null\n    }\n\n    return {\n      feature,\n      leftPx,\n      rightPx,\n      topPx: displayMode === 'collapse' ? 0 : topPx,\n      heightPx,\n    }\n  }\n\n  // expands region for clipping to use. possible improvement: use average read\n  // size to set the heuristic maxClippingSize expansion (e.g. short reads\n  // don't have to expand a softclipping size a lot, but long reads might)\n  getExpandedRegion(region: Region, renderArgs: RenderArgsDeserialized) {\n    const { config, showSoftClip } = renderArgs\n\n    const maxClippingSize = readConfObject(config, 'maxClippingSize')\n    const { start, end } = region\n    const len = end - start\n    const bpExpansion = Math.max(\n      len,\n      showSoftClip ? Math.round(maxClippingSize) : 0,\n    )\n\n    return {\n      ...region,\n      start: Math.floor(Math.max(start - bpExpansion, 0)),\n      end: Math.ceil(end + bpExpansion),\n    }\n  }\n\n  colorByOrientation(feature: Feature, config: AnyConfigurationModel) {\n    return alignmentColoring[\n      this.getOrientation(feature, config) || 'color_nostrand'\n    ]\n  }\n\n  getOrientation(feature: Feature, config: AnyConfigurationModel) {\n    const orientationType = readConfObject(config, 'orientationType') as\n      | 'fr'\n      | 'ff'\n      | 'rf'\n    const type = orientationTypes[orientationType]\n    const orientation = type[feature.get('pair_orientation') as string]\n    const map: { [key: string]: string } = {\n      LR: 'color_pair_lr',\n      RR: 'color_pair_rr',\n      RL: 'color_pair_rl',\n      LL: 'color_pair_ll',\n    }\n    return map[orientation]\n  }\n\n  colorByInsertSize(feature: Feature, _config: AnyConfigurationModel) {\n    return feature.get('is_paired') &&\n      feature.get('seq_id') !== feature.get('next_seq_id')\n      ? '#555'\n      : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`\n  }\n\n  colorByStranded(feature: Feature, _config: AnyConfigurationModel) {\n    const flags = feature.get('flags')\n    const strand = feature.get('strand')\n    // is paired\n    if (flags & 1) {\n      const revflag = flags & 64\n      const flipper = revflag ? -1 : 1\n      // proper pairing\n      if (flags & 2) {\n        return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand'\n      }\n      if (feature.get('multi_segment_next_segment_unmapped')) {\n        return strand * flipper === 1\n          ? 'color_rev_missing_mate'\n          : 'color_fwd_missing_mate'\n      }\n      if (feature.get('seq_id') === feature.get('next_seq_id')) {\n        return strand * flipper === 1\n          ? 'color_rev_strand_not_proper'\n          : 'color_fwd_strand_not_proper'\n      }\n      // should only leave aberrant chr\n      return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr'\n    }\n    return strand === 1 ? 'color_fwd_strand' : 'color_rev_strand'\n  }\n\n  colorByPerBaseLettering({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    colorForBase,\n    contrastForBase,\n    charWidth,\n    charHeight,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    colorForBase: Record<string, string>\n    contrastForBase: Record<string, string>\n    charWidth: number\n    charHeight: number\n    canvasWidth: number\n  }) {\n    const heightLim = charHeight - 2\n    const { feature, topPx, heightPx } = feat\n    const seq = feature.get('seq') as string\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const w = 1 / bpPerPx\n    const start = feature.get('start')\n    let soffset = 0 // sequence offset\n    let roffset = 0 // reference offset\n\n    for (let i = 0; i < cigarOps.length; i += 2) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        soffset += len\n      } else if (op === 'D' || op === 'N') {\n        roffset += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const letter = seq[soffset + m]\n          const r = start + roffset + m\n          const [leftPx] = bpSpanPx(r, r + 1, region, bpPerPx)\n          fillRect(\n            ctx,\n            leftPx,\n            topPx,\n            w + 0.5,\n            heightPx,\n            canvasWidth,\n            colorForBase[letter],\n          )\n\n          if (w >= charWidth && heightPx >= heightLim) {\n            // normal SNP coloring\n            ctx.fillStyle = contrastForBase[letter]\n\n            ctx.fillText(\n              letter,\n              leftPx + (w - charWidth) / 2 + 1,\n              topPx + heightPx,\n            )\n          }\n        }\n        soffset += len\n        roffset += len\n      }\n    }\n  }\n  colorByPerBaseQuality({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const qual: string = feature.get('qual') || ''\n    const scores = qual.split(' ').map(val => +val)\n    const cigarOps = parseCigar(feature.get('CIGAR'))\n    const width = 1 / bpPerPx\n    const start = feature.get('start')\n    let soffset = 0 // sequence offset\n    let roffset = 0 // reference offset\n\n    for (let i = 0; i < cigarOps.length; i += 2) {\n      const len = +cigarOps[i]\n      const op = cigarOps[i + 1]\n      if (op === 'S' || op === 'I') {\n        soffset += len\n      } else if (op === 'D' || op === 'N') {\n        roffset += len\n      } else if (op === 'M' || op === 'X' || op === '=') {\n        for (let m = 0; m < len; m++) {\n          const score = scores[soffset + m]\n          const [leftPx] = bpSpanPx(\n            start + roffset + m,\n            start + roffset + m + 1,\n            region,\n            bpPerPx,\n          )\n          fillRect(\n            ctx,\n            leftPx,\n            topPx,\n            width + 0.5,\n            heightPx,\n            canvasWidth,\n            `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`,\n          )\n        }\n        soffset += len\n        roffset += len\n      }\n    }\n  }\n\n  // ML stores probabilities as array of numerics and MP is scaled phred scores\n  // https://github.com/samtools/hts-specs/pull/418/files#diff-e765c6479316309f56b636f88189cdde8c40b854c7bdcce9ee7fe87a4e76febcR596\n  //\n  // if we have ML or Ml, it is an 8bit probability, divide by 255\n  //\n  // if we have MP or Mp it is phred scaled ASCII, which can go up to 90 but\n  // has very high likelihood basecalls at that point, we really only care\n  // about low qual calls <20 approx\n  //\n  colorByModifications({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    renderArgs,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const { modificationTagMap = {} } = renderArgs\n\n    const mm = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n\n    const ml = (getTagAlt(feature, 'ML', 'Ml') as number[] | string) || []\n\n    const probabilities = ml\n      ? (typeof ml === 'string' ? ml.split(',').map(e => +e) : ml).map(\n          e => e / 255,\n        )\n      : (getTagAlt(feature, 'MP', 'Mp') as string)\n          .split('')\n          .map(s => s.charCodeAt(0) - 33)\n          .map(elt => Math.min(1, elt / 50))\n\n    const cigar = feature.get('CIGAR')\n    const start = feature.get('start')\n    const seq = feature.get('seq')\n    const strand = feature.get('strand')\n    const cigarOps = parseCigar(cigar)\n\n    const modifications = getModificationPositions(mm, seq, strand)\n\n    // probIndex applies across multiple modifications e.g.\n    let probIndex = 0\n    for (let i = 0; i < modifications.length; i++) {\n      const { type, positions } = modifications[i]\n      const col = modificationTagMap[type] || 'black'\n      const base = Color(col)\n      for (const readPos of getNextRefPos(cigarOps, positions)) {\n        const r = start + readPos\n        const [leftPx, rightPx] = bpSpanPx(r, r + 1, region, bpPerPx)\n\n        // give it a little boost of 0.1 to not make them fully\n        // invisible to avoid confusion\n        const prob = probabilities[probIndex]\n\n        fillRect(\n          ctx,\n          leftPx,\n          topPx,\n          rightPx - leftPx + 0.5,\n          heightPx,\n          canvasWidth,\n          prob && prob !== 1\n            ? base\n                .alpha(prob + 0.1)\n                .hsl()\n                .string()\n            : col,\n        )\n        probIndex++\n      }\n    }\n  }\n\n  // Color by methylation is slightly modified version of color by\n  // modifications that focuses on CpG sites, with non-methylated CpG colored\n  // blue\n  colorByMethylation({\n    ctx,\n    feat,\n    region,\n    bpPerPx,\n    renderArgs,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    region: Region\n    bpPerPx: number\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    canvasWidth: number\n  }) {\n    const { regionSequence } = renderArgs\n    const { feature, topPx, heightPx } = feat\n\n    const mm: string = getTagAlt(feature, 'MM', 'Mm') || ''\n\n    if (!regionSequence) {\n      throw new Error('region sequence required for methylation')\n    }\n\n    const cigar = feature.get('CIGAR')\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n    const seq = feature.get('seq')\n    const strand = feature.get('strand')\n    const cigarOps = parseCigar(cigar)\n\n    const methBins = new Array(region.end - region.start).fill(0)\n    const modifications = getModificationPositions(mm, seq, strand)\n    for (let i = 0; i < modifications.length; i++) {\n      const { type, positions } = modifications[i]\n      if (type === 'm' && positions) {\n        for (const pos of getNextRefPos(cigarOps, positions)) {\n          const epos = pos + fstart - region.start\n          if (epos >= 0 && epos < methBins.length) {\n            methBins[epos] = 1\n          }\n        }\n      }\n    }\n\n    for (let j = fstart; j < fend; j++) {\n      const i = j - region.start\n      if (i >= 0 && i < methBins.length) {\n        const l1 = regionSequence[i].toLowerCase()\n        const l2 = regionSequence[i + 1].toLowerCase()\n\n        // if we are zoomed out, display just a block over the cpg\n        if (bpPerPx > 2) {\n          if (l1 === 'c' && l2 === 'g') {\n            const s = region.start + i\n            const [leftPx, rightPx] = bpSpanPx(s, s + 2, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx,\n              topPx,\n              rightPx - leftPx + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i] || methBins[i + 1] ? 'red' : 'blue',\n            )\n          }\n        }\n        // if we are zoomed in, color the c inside the cpg\n        else {\n          // color\n          if (l1 === 'c' && l2 === 'g') {\n            const s = region.start + i\n            const [leftPx, rightPx] = bpSpanPx(s, s + 1, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx,\n              topPx,\n              rightPx - leftPx + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i] ? 'red' : 'blue',\n            )\n\n            const [leftPx2, rightPx2] = bpSpanPx(s + 1, s + 2, region, bpPerPx)\n            fillRect(\n              ctx,\n              leftPx2,\n              topPx,\n              rightPx2 - leftPx2 + 0.5,\n              heightPx,\n              canvasWidth,\n              methBins[i + 1] ? 'red' : 'blue',\n            )\n          }\n        }\n      }\n    }\n  }\n\n  drawRect(\n    ctx: CanvasRenderingContext2D,\n    feat: LayoutFeature,\n    props: RenderArgsDeserialized,\n  ) {\n    const { regions, bpPerPx } = props\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const [leftPx, rightPx] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n    const flip = region.reversed ? -1 : 1\n    const strand = feature.get('strand') * flip\n    if (bpPerPx < 10) {\n      if (strand === -1) {\n        ctx.beginPath()\n        ctx.moveTo(leftPx - 5, topPx + heightPx / 2)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx)\n        ctx.lineTo(leftPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      } else {\n        ctx.beginPath()\n        ctx.moveTo(leftPx, topPx)\n        ctx.lineTo(leftPx, topPx + heightPx)\n        ctx.lineTo(rightPx, topPx + heightPx)\n        ctx.lineTo(rightPx + 5, topPx + heightPx / 2)\n        ctx.lineTo(rightPx, topPx)\n        ctx.closePath()\n        ctx.fill()\n      }\n    } else {\n      ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx)\n    }\n  }\n\n  drawAlignmentRect({\n    ctx,\n    feat,\n    renderArgs,\n    colorForBase,\n    contrastForBase,\n    charWidth,\n    charHeight,\n    defaultColor,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    colorForBase: Record<string, string>\n    contrastForBase: Record<string, string>\n    charWidth: number\n    charHeight: number\n    defaultColor: boolean\n    canvasWidth: number\n  }) {\n    const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = renderArgs\n\n    const { tag = '', type: colorType = '' } = colorBy || {}\n    const { feature } = feat\n    const region = regions[0]\n\n    // first pass for simple color changes that change the color of the\n    // alignment\n    switch (colorType) {\n      case 'insertSize':\n        ctx.fillStyle = this.colorByInsertSize(feature, config)\n        break\n      case 'strand':\n        ctx.fillStyle = feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B'\n        break\n      case 'mappingQuality':\n        ctx.fillStyle = `hsl(${feature.get('mq')},50%,50%)`\n        break\n\n      case 'pairOrientation':\n        ctx.fillStyle = this.colorByOrientation(feature, config)\n        break\n      case 'stranded':\n        ctx.fillStyle = alignmentColoring[this.colorByStranded(feature, config)]\n        break\n      case 'xs':\n      case 'tag': {\n        const tags = feature.get('tags')\n        const val = tags ? tags[tag] : feature.get(tag)\n\n        // special for for XS/TS tag\n        if (tag === 'XS' || tag === 'TS') {\n          const map: { [key: string]: string | undefined } = {\n            '-': 'color_rev_strand',\n            '+': 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // lower case 'ts' from minimap2 is flipped from xs\n        if (tag === 'ts') {\n          const map: { [key: string]: string } = {\n            '-':\n              feature.get('strand') === -1\n                ? 'color_fwd_strand'\n                : 'color_rev_strand',\n            '+':\n              feature.get('strand') === -1\n                ? 'color_rev_strand'\n                : 'color_fwd_strand',\n          }\n          ctx.fillStyle = alignmentColoring[map[val] || 'color_nostrand']\n        }\n\n        // tag is not one of the autofilled tags, has color-value pairs from\n        // fetchValues\n        else {\n          const foundValue = colorTagMap[val]\n          ctx.fillStyle = foundValue || alignmentColoring['color_nostrand']\n        }\n        break\n      }\n      case 'insertSizeAndPairOrientation':\n        break\n\n      case 'modifications':\n      case 'methylation':\n        // this coloring is similar to igv.js, and is helpful to color negative\n        // strand reads differently because their c-g will be flipped (e.g. g-c\n        // read right to left)\n        if (feature.get('flags') & 16) {\n          ctx.fillStyle = '#c8dcc8'\n        } else {\n          ctx.fillStyle = '#c8c8c8'\n        }\n        break\n\n      case 'normal':\n      default:\n        if (defaultColor) {\n          // avoid a readConfObject call here\n          ctx.fillStyle = '#c8c8c8'\n        } else {\n          ctx.fillStyle = readConfObject(config, 'color', { feature })\n        }\n        break\n    }\n\n    this.drawRect(ctx, feat, renderArgs)\n\n    // second pass for color types that render per-base things that go over the\n    // existing drawing\n    switch (colorType) {\n      case 'perBaseQuality':\n        this.colorByPerBaseQuality({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          canvasWidth,\n        })\n        break\n\n      case 'perBaseLettering':\n        this.colorByPerBaseLettering({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          colorForBase,\n          contrastForBase,\n          charWidth,\n          charHeight,\n          canvasWidth,\n        })\n        break\n\n      case 'modifications':\n        this.colorByModifications({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          renderArgs,\n          canvasWidth,\n        })\n        break\n\n      case 'methylation':\n        this.colorByMethylation({\n          ctx,\n          feat,\n          region,\n          bpPerPx,\n          renderArgs,\n          canvasWidth,\n        })\n        break\n    }\n  }\n\n  drawMismatches({\n    ctx,\n    feat,\n    renderArgs,\n    minSubfeatureWidth,\n    largeInsertionIndicatorScale,\n    mismatchAlpha,\n    charWidth,\n    charHeight,\n    colorForBase,\n    contrastForBase,\n    canvasWidth,\n    drawSNPs = true,\n    drawIndels = true,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    colorForBase: { [key: string]: string }\n    contrastForBase: { [key: string]: string }\n    mismatchAlpha?: boolean\n    drawSNPs?: boolean\n    drawIndels?: boolean\n    minSubfeatureWidth: number\n    largeInsertionIndicatorScale: number\n    charWidth: number\n    charHeight: number\n    canvasWidth: number\n  }) {\n    const { bpPerPx, regions } = renderArgs\n    const { heightPx, topPx, feature } = feat\n    const [region] = regions\n    const start = feature.get('start')\n\n    const pxPerBp = Math.min(1 / bpPerPx, 2)\n    const w = Math.max(minSubfeatureWidth, pxPerBp)\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const heightLim = charHeight - 2\n\n    // extraHorizontallyFlippedOffset is used to draw interbase items, which\n    // are located to the left when forward and right when reversed\n    const extraHorizontallyFlippedOffset = region.reversed\n      ? 1 / bpPerPx + 1\n      : -1\n\n    // two pass rendering: first pass, draw all the mismatches except wide\n    // insertion markers\n    for (let i = 0; i < mismatches.length; i += 1) {\n      const mismatch = mismatches[i]\n      const mstart = start + mismatch.start\n      const mlen = mismatch.length\n      const mbase = mismatch.base\n      const [leftPx, rightPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx)\n      const widthPx = Math.max(minSubfeatureWidth, Math.abs(leftPx - rightPx))\n      if (mismatch.type === 'mismatch' && drawSNPs) {\n        const baseColor = colorForBase[mismatch.base] || '#888'\n\n        fillRect(\n          ctx,\n          leftPx,\n          topPx,\n          widthPx,\n          heightPx,\n          canvasWidth,\n          !mismatchAlpha\n            ? baseColor\n            : mismatch.qual !== undefined\n            ? Color(baseColor)\n                .alpha(Math.min(1, mismatch.qual / 50))\n                .hsl()\n                .string()\n            : baseColor,\n        )\n\n        if (widthPx >= charWidth && heightPx >= heightLim) {\n          // normal SNP coloring\n          const contrastColor = contrastForBase[mismatch.base] || 'black'\n          ctx.fillStyle = !mismatchAlpha\n            ? contrastColor\n            : mismatch.qual !== undefined\n            ? Color(contrastColor)\n                .alpha(Math.min(1, mismatch.qual / 50))\n                .hsl()\n                .string()\n            : contrastColor\n          ctx.fillText(\n            mbase,\n            leftPx + (widthPx - charWidth) / 2 + 1,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'deletion' && drawIndels) {\n        fillRect(\n          ctx,\n          leftPx,\n          topPx,\n          widthPx,\n          heightPx,\n          canvasWidth,\n          colorForBase.deletion,\n        )\n        const txt = `${mismatch.length}`\n        const rwidth = measureText(txt, 10)\n        if (widthPx >= rwidth && heightPx >= heightLim) {\n          ctx.fillStyle = contrastForBase.deletion\n          ctx.fillText(\n            txt,\n            (leftPx + rightPx) / 2 - rwidth / 2,\n            topPx + heightPx,\n          )\n        }\n      } else if (mismatch.type === 'insertion' && drawIndels) {\n        ctx.fillStyle = 'purple'\n        const pos = leftPx + extraHorizontallyFlippedOffset\n        const len = +mismatch.base || mismatch.length\n        const insW = Math.max(\n          minSubfeatureWidth / 2,\n          Math.min(1.2, 1 / bpPerPx),\n        )\n        if (len < 10) {\n          fillRect(ctx, pos, topPx, insW, heightPx, canvasWidth, 'purple')\n          if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n            fillRect(ctx, pos - insW, topPx, insW * 3, 1, canvasWidth)\n            fillRect(\n              ctx,\n              pos - insW,\n              topPx + heightPx - 1,\n              insW * 3,\n              1,\n              canvasWidth,\n            )\n            ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx)\n          }\n        }\n      } else if (mismatch.type === 'hardclip' || mismatch.type === 'softclip') {\n        const pos = leftPx + extraHorizontallyFlippedOffset\n        fillRect(\n          ctx,\n          pos,\n          topPx,\n          w,\n          heightPx,\n          canvasWidth,\n          mismatch.type === 'hardclip' ? 'red' : 'blue',\n        )\n        if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n          fillRect(ctx, pos - w, topPx, w * 3, 1, canvasWidth)\n          fillRect(ctx, pos - w, topPx + heightPx - 1, w * 3, 1, canvasWidth)\n          ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx)\n        }\n      } else if (mismatch.type === 'skip') {\n        // fix to avoid bad rendering note that this was also related to chrome\n        // bug https://bugs.chromium.org/p/chromium/issues/detail?id=1131528\n        // also affected firefox ref #1236 #2750\n        if (leftPx + widthPx > 0) {\n          // make small exons more visible when zoomed far out\n          const adjustPx = widthPx - (bpPerPx > 10 ? 1.5 : 0)\n          ctx.clearRect(leftPx, topPx, adjustPx, heightPx)\n          fillRect(\n            ctx,\n            Math.max(0, leftPx),\n            topPx + heightPx / 2 - 1,\n            adjustPx + (leftPx < 0 ? leftPx : 0),\n            2,\n            canvasWidth,\n            '#333',\n          )\n        }\n      }\n    }\n\n    // second pass, draw wide insertion markers on top\n    if (drawIndels) {\n      for (let i = 0; i < mismatches.length; i += 1) {\n        const mismatch = mismatches[i]\n        const mstart = start + mismatch.start\n        const mlen = mismatch.length\n        const [leftPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx)\n        const len = +mismatch.base || mismatch.length\n        const txt = `${len}`\n        if (mismatch.type === 'insertion' && len >= 10) {\n          if (bpPerPx > largeInsertionIndicatorScale) {\n            fillRect(ctx, leftPx - 1, topPx, 2, heightPx, canvasWidth, 'purple')\n          } else if (heightPx > charHeight) {\n            const rwidth = measureText(txt)\n            const padding = 5\n            fillRect(\n              ctx,\n              leftPx - rwidth / 2 - padding,\n              topPx,\n              rwidth + 2 * padding,\n              heightPx,\n              canvasWidth,\n              'purple',\n            )\n            ctx.fillStyle = 'white'\n            ctx.fillText(txt, leftPx - rwidth / 2, topPx + heightPx)\n          } else {\n            const padding = 2\n            fillRect(\n              ctx,\n              leftPx - padding,\n              topPx,\n              2 * padding,\n              heightPx,\n              canvasWidth,\n              'purple',\n            )\n          }\n        }\n      }\n    }\n  }\n\n  drawSoftClipping({\n    ctx,\n    feat,\n    renderArgs,\n    config,\n    theme,\n    canvasWidth,\n  }: {\n    ctx: CanvasRenderingContext2D\n    feat: LayoutFeature\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n    config: AnyConfigurationModel\n    theme: Theme\n    canvasWidth: number\n  }) {\n    const { feature, topPx, heightPx } = feat\n    const { regions, bpPerPx } = renderArgs\n    const [region] = regions\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth')\n    const mismatches: Mismatch[] = feature.get('mismatches')\n    const seq = feature.get('seq')\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const colorForBase: { [key: string]: string } = {\n      A: theme.palette.bases.A.main,\n      C: theme.palette.bases.C.main,\n      G: theme.palette.bases.G.main,\n      T: theme.palette.bases.T.main,\n      deletion: '#808080', // gray\n    }\n\n    // Display all bases softclipped off in lightened colors\n    if (seq) {\n      mismatches\n        .filter(mismatch => mismatch.type === 'softclip')\n        .forEach(mismatch => {\n          const softClipLength = mismatch.cliplen || 0\n          const s = feature.get('start')\n          const softClipStart =\n            mismatch.start === 0 ? s - softClipLength : s + mismatch.start\n\n          for (let k = 0; k < softClipLength; k += 1) {\n            const base = seq.charAt(k + mismatch.start)\n\n            // If softclip length+start is longer than sequence, no need to\n            // continue showing base\n            if (!base) {\n              return\n            }\n\n            const [softClipLeftPx, softClipRightPx] = bpSpanPx(\n              softClipStart + k,\n              softClipStart + k + 1,\n              region,\n              bpPerPx,\n            )\n            const softClipWidthPx = Math.max(\n              minFeatWidth,\n              Math.abs(softClipLeftPx - softClipRightPx),\n            )\n\n            // Black accounts for IUPAC ambiguity code bases such as N that\n            // show in soft clipping\n            const baseColor = colorForBase[base] || '#000000'\n            ctx.fillStyle = baseColor\n            fillRect(\n              ctx,\n              softClipLeftPx,\n              topPx,\n              softClipWidthPx,\n              heightPx,\n              canvasWidth,\n            )\n\n            if (softClipWidthPx >= charWidth && heightPx >= charHeight - 5) {\n              ctx.fillStyle = theme.palette.getContrastText(baseColor)\n              ctx.fillText(\n                base,\n                softClipLeftPx + (softClipWidthPx - charWidth) / 2 + 1,\n                topPx + heightPx,\n              )\n            }\n          }\n        })\n    }\n  }\n\n  makeImageData({\n    ctx,\n    layoutRecords,\n    canvasWidth,\n    renderArgs,\n  }: {\n    ctx: CanvasRenderingContext2D\n    canvasWidth: number\n    layoutRecords: (LayoutFeature | null)[]\n    renderArgs: RenderArgsDeserializedWithFeaturesAndLayout\n  }) {\n    const {\n      layout,\n      config,\n      showSoftClip,\n      colorBy,\n      theme: configTheme,\n    } = renderArgs\n    const mismatchAlpha = readConfObject(config, 'mismatchAlpha')\n    const minSubfeatureWidth = readConfObject(config, 'minSubfeatureWidth')\n    const largeInsertionIndicatorScale = readConfObject(\n      config,\n      'largeInsertionIndicatorScale',\n    )\n    const defaultColor = readConfObject(config, 'color') === '#f0f'\n\n    const theme = createJBrowseTheme(configTheme)\n    const colorForBase = getColorBaseMap(theme)\n    const contrastForBase = getContrastBaseMap(theme)\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n    ctx.font = 'bold 10px Courier New,monospace'\n\n    const { charWidth, charHeight } = this.getCharWidthHeight(ctx)\n    const drawSNPs = shouldDrawSNPs(colorBy?.type)\n    const drawIndels = shouldDrawIndels(colorBy?.type)\n    for (let i = 0; i < layoutRecords.length; i++) {\n      const feat = layoutRecords[i]\n      if (feat === null) {\n        continue\n      }\n\n      this.drawAlignmentRect({\n        ctx,\n        feat,\n        renderArgs,\n        defaultColor,\n        colorForBase,\n        contrastForBase,\n        charWidth,\n        charHeight,\n        canvasWidth,\n      })\n      this.drawMismatches({\n        ctx,\n        feat,\n        renderArgs,\n        mismatchAlpha,\n        drawSNPs,\n        drawIndels,\n        largeInsertionIndicatorScale,\n        minSubfeatureWidth,\n        charWidth,\n        charHeight,\n        colorForBase,\n        contrastForBase,\n        canvasWidth,\n      })\n      if (showSoftClip) {\n        this.drawSoftClipping({\n          ctx,\n          feat,\n          renderArgs,\n          config,\n          theme,\n          canvasWidth,\n        })\n      }\n    }\n  }\n\n  // we perform a full layout before render as a separate method because the\n  // layout determines the height of the canvas that we use to render\n  layoutFeats(props: RenderArgsDeserializedWithFeaturesAndLayout) {\n    const {\n      layout,\n      features,\n      sortedBy,\n      config,\n      bpPerPx,\n      showSoftClip,\n      regions,\n    } = props\n    const [region] = regions\n    if (!layout) {\n      throw new Error(`layout required`)\n    }\n    if (!layout.addRect) {\n      throw new Error('invalid layout object')\n    }\n\n    const featureMap =\n      sortedBy?.type && region.start === sortedBy.pos\n        ? sortFeature(features, sortedBy)\n        : features\n\n    const heightPx = readConfObject(config, 'height')\n    const displayMode = readConfObject(config, 'displayMode')\n    return iterMap(\n      featureMap.values(),\n      feature =>\n        this.layoutFeature({\n          feature,\n          layout,\n          bpPerPx,\n          region,\n          showSoftClip,\n          heightPx,\n          displayMode,\n        }),\n      featureMap.size,\n    )\n  }\n\n  async fetchSequence(renderProps: RenderArgsDeserialized) {\n    const { sessionId, regions, adapterConfig } = renderProps\n    const { sequenceAdapter } = adapterConfig\n    if (!sequenceAdapter) {\n      return undefined\n    }\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      sequenceAdapter,\n    )\n    const [region] = regions\n    return fetchSequence(region, dataAdapter as BaseFeatureDataAdapter)\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const layout = this.createLayoutInWorker(renderProps)\n    const { regions, bpPerPx } = renderProps\n\n    const layoutRecords = this.layoutFeats({\n      ...renderProps,\n      features,\n      layout,\n    })\n    const [region] = regions\n\n    // only need reference sequence if there are features and only for some\n    // cases\n    const regionSequence =\n      features.size && shouldFetchReferenceSequence(renderProps.colorBy?.type)\n        ? await this.fetchSequence(renderProps)\n        : undefined\n    const { end, start } = region\n\n    const width = (end - start) / bpPerPx\n    const height = Math.max(layout.getTotalHeight(), 1)\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) =>\n        this.makeImageData({\n          ctx,\n          layoutRecords,\n          canvasWidth: width,\n          renderArgs: {\n            ...renderProps,\n            layout,\n            features,\n            regionSequence,\n          },\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      layout,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features: new Map(),\n      layout,\n      height,\n      width,\n      maxHeightReached: layout.maxHeightReached,\n    }\n  }\n\n  createSession(args: PileupLayoutSessionProps) {\n    return new PileupLayoutSession(args)\n  }\n}\n\nexport type {\n  RenderArgs,\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { Mismatch } from '../BamAdapter/MismatchParser'\n\ninterface SortObject {\n  pos: number\n  type: string\n  tag?: string\n}\nexport const sortFeature = (\n  features: Map<string, Feature>,\n  sortedBy: SortObject,\n) => {\n  const featureArray = Array.from(features.values())\n  const featuresInCenterLine: Feature[] = []\n  const featuresOutsideCenter: Feature[] = []\n  const { pos, type } = sortedBy\n\n  // only sort on features that intersect center line, append those outside post-sort\n  featureArray.forEach(innerArray => {\n    const feature = innerArray\n    const start = feature.get('start')\n    const end = feature.get('end')\n    if (doesIntersect2(pos - 1, pos, start, end)) {\n      featuresInCenterLine.push(innerArray)\n    } else {\n      featuresOutsideCenter.push(innerArray)\n    }\n  })\n\n  const isCram = featureArray.length ? featureArray[0].get('tags') : false\n  switch (type) {\n    case 'Start location': {\n      featuresInCenterLine.sort((a, b) => a.get('start') - b.get('start'))\n      break\n    }\n\n    case 'tag': {\n      const tag = sortedBy.tag as string\n      const getTag = (f: Feature, t: string) => {\n        return isCram ? f.get('tags')[t] : f.get(t)\n      }\n      const isString =\n        featuresInCenterLine[0] &&\n        typeof getTag(featuresInCenterLine[0], tag) === 'string'\n      if (isString) {\n        featuresInCenterLine.sort((a, b) =>\n          getTag(b, tag).localeCompare(getTag(a, tag)),\n        )\n      } else {\n        featuresInCenterLine.sort(\n          (a, b) => (getTag(b, tag) || 0) - (getTag(a, tag) || 0),\n        )\n      }\n      break\n    }\n\n    // first sort all mismatches, then all reference bases at the end\n    case 'Base pair': {\n      const baseSortArray: [string, Mismatch][] = []\n      featuresInCenterLine.forEach(feature => {\n        const mismatches: Mismatch[] = feature.get('mismatches')\n        mismatches.forEach(mismatch => {\n          const start = feature.get('start')\n          const offset = start + mismatch.start + 1\n          const consuming =\n            mismatch.type === 'insertion' || mismatch.type === 'softclip'\n          const len = consuming ? 0 : mismatch.length\n          if (pos >= offset && pos < offset + len) {\n            baseSortArray.push([feature.id(), mismatch])\n          }\n        })\n      })\n\n      const baseMap = new Map(baseSortArray)\n      featuresInCenterLine.sort((a, b) => {\n        const aMismatch = baseMap.get(a.id())\n        const bMismatch = baseMap.get(b.id())\n        const acode = bMismatch && bMismatch.base.toUpperCase()\n        const bcode = aMismatch && aMismatch.base.toUpperCase()\n        if (acode === bcode && acode === '*') {\n          // @ts-ignore\n          return aMismatch.length - bMismatch.length\n        }\n        return (\n          (acode ? acode.charCodeAt(0) : 0) - (bcode ? bcode.charCodeAt(0) : 0)\n        )\n      })\n\n      break\n    }\n\n    // sorts positive strands then negative strands\n    case 'Read strand': {\n      featuresInCenterLine.sort((a, b) =>\n        a.get('strand') <= b.get('strand') ? 1 : -1,\n      )\n      break\n    }\n  }\n\n  const sortedMap = new Map(\n    featuresInCenterLine\n      .concat(featuresOutsideCenter)\n      .map(feature => [feature.id(), feature]),\n  )\n\n  return sortedMap\n}\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport React, { MouseEvent, useRef, useState, useEffect } from 'react'\nimport type { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst canvasPadding = 100\nfunction PileupRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n  sortedBy?: { type: string; pos: number; refName: string }\n  colorBy?: { type: string; tag?: string }\n  onMouseMove?: (event: React.MouseEvent, featureId: string | undefined) => void\n}) {\n  const {\n    onMouseMove,\n    blockKey,\n    displayModel,\n    width,\n    height,\n    regions,\n    bpPerPx,\n    sortedBy,\n    colorBy,\n  } = props\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const [region] = regions\n  const highlightOverlayCanvas = useRef<HTMLCanvasElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  useEffect(() => {\n    const canvas = highlightOverlayCanvas.current\n    if (!canvas) {\n      return\n    }\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n    const selectedRect = selectedFeatureId\n      ? displayModel.getFeatureByID?.(blockKey, selectedFeatureId)\n      : undefined\n    if (selectedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = selectedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.shadowColor = '#222266'\n      ctx.shadowBlur = 10\n      ctx.lineJoin = 'bevel'\n      ctx.lineWidth = 2\n      ctx.strokeStyle = '#00b8ff'\n      ctx.strokeRect(\n        leftPx - 2,\n        rectTop - 2,\n        rightPx - leftPx + 4,\n        rectHeight + 4,\n      )\n      ctx.clearRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n    const highlightedFeature = featureIdUnderMouse || contextMenuFeature?.id()\n    const highlightedRect = highlightedFeature\n      ? displayModel.getFeatureByID?.(blockKey, highlightedFeature)\n      : undefined\n    if (highlightedRect) {\n      const [leftBp, topPx, rightBp, bottomPx] = highlightedRect\n      const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n      const rectTop = Math.round(topPx)\n      const rectHeight = Math.round(bottomPx - topPx)\n      ctx.fillStyle = '#0003'\n      ctx.fillRect(leftPx, rectTop, rightPx - leftPx, rectHeight)\n    }\n  }, [\n    bpPerPx,\n    region,\n    blockKey,\n    selectedFeatureId,\n    displayModel,\n    featureIdUnderMouse,\n    contextMenuFeature,\n  ])\n\n  function onMouseDown(event: MouseEvent) {\n    setMouseIsDown(true)\n    setMovedDuringLastMouseDown(false)\n    callMouseHandler('MouseDown', event)\n  }\n\n  function onMouseEnter(event: MouseEvent) {\n    callMouseHandler('MouseEnter', event)\n  }\n\n  function onMouseOut(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onMouseOver(event: MouseEvent) {\n    callMouseHandler('MouseOver', event)\n  }\n\n  function onMouseUp(event: MouseEvent) {\n    setMouseIsDown(false)\n    callMouseHandler('MouseUp', event)\n  }\n\n  function onClick(event: MouseEvent) {\n    if (!movedDuringLastMouseDown) {\n      callMouseHandler('Click', event)\n    }\n  }\n\n  function onMouseLeave(event: MouseEvent) {\n    callMouseHandler('MouseOut', event)\n    callMouseHandler('MouseLeave', event)\n  }\n\n  function onContextMenu(event: MouseEvent) {\n    callMouseHandler('ContextMenu', event)\n  }\n\n  function mouseMove(event: MouseEvent) {\n    if (mouseIsDown) {\n      setMovedDuringLastMouseDown(true)\n    }\n    let offsetX = 0\n    let offsetY = 0\n    const canvas = highlightOverlayCanvas.current\n    if (canvas) {\n      const { left, top } = canvas.getBoundingClientRect()\n      offsetX = left\n      offsetY = top\n    }\n    offsetX = event.clientX - offsetX\n    offsetY = event.clientY - offsetY\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n\n    const featIdUnderMouse = displayModel.getFeatureOverlapping(\n      blockKey,\n      clientBp,\n      offsetY,\n    )\n\n    if (onMouseMove) {\n      onMouseMove(event, featIdUnderMouse)\n    }\n  }\n\n  function callMouseHandler(handlerName: string, event: MouseEvent) {\n    // @ts-ignore\n    // eslint-disable-next-line react/destructuring-assignment\n    const featureHandler = props[`onFeature${handlerName}`]\n    // @ts-ignore\n    // eslint-disable-next-line react/destructuring-assignment\n    const canvasHandler = props[`on${handlerName}`]\n    if (featureHandler && featureIdUnderMouse) {\n      featureHandler(event, featureIdUnderMouse)\n    } else if (canvasHandler) {\n      canvasHandler(event, featureIdUnderMouse)\n    }\n  }\n\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      data-testid={`pileup-${\n        sortedBy || colorBy\n          ? `${sortedBy?.type || ''}${colorBy?.type || ''}${colorBy?.tag || ''}`\n          : 'normal'\n      }`}\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n      <canvas\n        data-testid=\"pileup_overlay_canvas\"\n        width={canvasWidth}\n        height={height + canvasPadding}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n        className=\"highlightOverlayCanvas\"\n        ref={highlightOverlayCanvas}\n        onMouseDown={event => onMouseDown(event)}\n        onMouseEnter={event => onMouseEnter(event)}\n        onMouseOut={event => onMouseOut(event)}\n        onMouseOver={event => onMouseOver(event)}\n        onMouseUp={event => onMouseUp(event)}\n        onMouseLeave={event => onMouseLeave(event)}\n        onMouseMove={event => mouseMove(event)}\n        onClick={event => onClick(event)}\n        onContextMenu={event => onContextMenu(event)}\n        onFocus={() => {}}\n        onBlur={() => {}}\n      />\n    </div>\n  )\n}\n\nexport default observer(PileupRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'PileupRenderer',\n  {\n    // default magenta here is used to detect the user has not customized this\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a pileup alignment',\n      defaultValue: '#f0f',\n      contextVariable: ['feature'],\n    },\n    orientationType: {\n      type: 'stringEnum',\n      model: types.enumeration('orientationType', ['fr', 'rf', 'ff']),\n      defaultValue: 'fr',\n      description:\n        'read sequencer orienation. fr is normal \"reads pointing at each other ---> <--- while some other sequencers can use other options',\n    },\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    minSubfeatureWidth: {\n      type: 'number',\n      description:\n        'the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1',\n      defaultValue: 0.7,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a pileup rendering',\n      defaultValue: 1200,\n    },\n    maxClippingSize: {\n      type: 'integer',\n      description: 'the max clip size to be used in a pileup rendering',\n      defaultValue: 10000,\n    },\n    height: {\n      type: 'number',\n      description: 'the height of each feature in a pileup alignment',\n      defaultValue: 7,\n      contextVariable: ['feature'],\n    },\n    noSpacing: {\n      type: 'boolean',\n      description: 'remove spacing between features',\n      defaultValue: false,\n    },\n    largeInsertionIndicatorScale: {\n      type: 'number',\n      description:\n        'scale at which to draw the large insertion indicators (bp/pixel)',\n      defaultValue: 10,\n    },\n    mismatchAlpha: {\n      type: 'boolean',\n      defaultValue: false,\n      description: 'Fade low quality mismatches',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport PileupRenderer from './PileupRenderer'\nimport ReactComponent from './components/PileupRendering'\nimport configSchema from './configSchema'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addRendererType(\n    () =>\n      new PileupRenderer({\n        name: 'PileupRenderer',\n        ReactComponent,\n        configSchema,\n        pluginManager,\n      }),\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst configModelFactory = (pluginManager: PluginManager) => {\n  const PileupDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearPileupDisplay',\n  ).configSchema\n  const SNPCoverageDisplayConfigSchema = pluginManager.getDisplayType(\n    'LinearSNPCoverageDisplay',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearAlignmentsDisplay',\n    {\n      pileupDisplay: PileupDisplayConfigSchema,\n      snpCoverageDisplay: SNPCoverageDisplayConfigSchema,\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type AlignmentsConfigModel = ReturnType<typeof configModelFactory>\nexport default configModelFactory\n","import React from 'react'\nimport {\n  ConfigurationReference,\n  AnyConfigurationModel,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, getSnapshot, Instance, types } from 'mobx-state-tree'\nimport { getContainingTrack } from '@jbrowse/core/util'\nimport deepEqual from 'fast-deep-equal'\nimport { AlignmentsConfigModel } from './configSchema'\n\nconst minDisplayHeight = 20\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AlignmentsConfigModel,\n) => {\n  return types\n    .compose(\n      'LinearAlignmentsDisplay',\n      BaseDisplay,\n      types.model({\n        PileupDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearPileupDisplay').stateModel,\n        ),\n        SNPCoverageDisplay: types.maybe(\n          pluginManager.getDisplayType('LinearSNPCoverageDisplay').stateModel,\n        ),\n        snpCovHeight: 45,\n        type: types.literal('LinearAlignmentsDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 250,\n        showCoverage: true,\n        showPileup: true,\n        userFeatureScreenDensity: types.maybe(types.number),\n      }),\n    )\n    .volatile(() => ({\n      scrollTop: 0,\n    }))\n    .actions(self => ({\n      toggleCoverage() {\n        self.showCoverage = !self.showCoverage\n      },\n      togglePileup() {\n        self.showPileup = !self.showPileup\n      },\n      setScrollTop(scrollTop: number) {\n        self.scrollTop = scrollTop\n      },\n      setSNPCoverageHeight(n: number) {\n        self.snpCovHeight = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        get pileupDisplayConfig() {\n          const conf = getConf(self, 'pileupDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearPileupDisplay',\n            name: `${getConf(track, 'name')} pileup`,\n            displayId: `${self.configuration.displayId}_pileup_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        getFeatureByID(blockKey: string, id: string) {\n          return self.PileupDisplay.getFeatureByID(blockKey, id)\n        },\n        searchFeatureByID(id: string) {\n          return self.PileupDisplay.searchFeatureByID(id)\n        },\n\n        get features() {\n          return self.PileupDisplay.features\n        },\n\n        get DisplayBlurb() {\n          return self.PileupDisplay?.DisplayBlurb\n        },\n\n        get sortedBy() {\n          return self.PileupDisplay.sortedBy\n        },\n        get sortedByPosition() {\n          return self.PileupDisplay.sortedByPosition\n        },\n        get sortedByRefName() {\n          return self.PileupDisplay.sortedByRefName\n        },\n\n        get snpCoverageDisplayConfig() {\n          const conf = getConf(self, 'snpCoverageDisplay')\n          const track = getContainingTrack(self)\n          return {\n            ...conf,\n            type: 'LinearSNPCoverageDisplay',\n            name: `${getConf(track, 'name')} snp coverage`,\n            displayId: `${self.configuration.displayId}_snpcoverage_xyz`, // xyz to avoid someone accidentally naming the displayId similar to this\n          }\n        },\n\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              type: 'subMenu',\n              label: 'Pileup settings',\n              subMenu: self.PileupDisplay.trackMenuItems(),\n            },\n            {\n              type: 'subMenu',\n              label: 'SNPCoverage settings',\n              subMenu: self.SNPCoverageDisplay.trackMenuItems(),\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => ({\n      setSNPCoverageDisplay(displayConfig: AnyConfigurationModel) {\n        self.SNPCoverageDisplay = {\n          type: 'LinearSNPCoverageDisplay',\n          configuration: displayConfig,\n          height: self.snpCovHeight,\n        }\n      },\n      setUserFeatureScreenDensity(limit: number) {\n        self.PileupDisplay.setUserFeatureScreenDensity(limit)\n        self.SNPCoverageDisplay.setUserFeatureScreenDensity(limit)\n      },\n      setPileupDisplay(displayConfig: AnyConfigurationModel) {\n        self.PileupDisplay = {\n          type: 'LinearPileupDisplay',\n          configuration: displayConfig,\n        }\n      },\n      setHeight(displayHeight: number) {\n        if (displayHeight > minDisplayHeight) {\n          self.height = displayHeight\n        } else {\n          self.height = minDisplayHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance: number) {\n        const oldHeight = self.height\n        const newHeight = this.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (!self.SNPCoverageDisplay) {\n              self.setSNPCoverageDisplay(self.snpCoverageDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.snpCoverageDisplayConfig,\n                getSnapshot(self.SNPCoverageDisplay.configuration),\n              )\n            ) {\n              self.SNPCoverageDisplay.setHeight(self.snpCovHeight)\n              self.SNPCoverageDisplay.setConfig(self.snpCoverageDisplayConfig)\n            }\n\n            if (!self.PileupDisplay) {\n              self.setPileupDisplay(self.pileupDisplayConfig)\n            } else if (\n              !deepEqual(\n                self.pileupDisplayConfig,\n                getSnapshot(self.PileupDisplay.configuration),\n              )\n            ) {\n              self.PileupDisplay.setConfig(self.pileupDisplayConfig)\n            }\n\n            // propagate the filterBy setting from pileupdisplay to snpcoverage\n            // note: the snpcoverage display is not able to control filterBy\n            // itself\n            if (\n              self.PileupDisplay.filterBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.filterBy),\n                getSnapshot(self.SNPCoverageDisplay.filterBy),\n              )\n            ) {\n              self.SNPCoverageDisplay.setFilterBy(\n                getSnapshot(self.PileupDisplay.filterBy),\n              )\n            }\n            if (\n              self.PileupDisplay.colorBy &&\n              !deepEqual(\n                getSnapshot(self.PileupDisplay.colorBy),\n                self.SNPCoverageDisplay.colorBy\n                  ? getSnapshot(self.SNPCoverageDisplay.colorBy)\n                  : {},\n              )\n            ) {\n              self.SNPCoverageDisplay.setColorBy(\n                getSnapshot(self.PileupDisplay.colorBy),\n              )\n            }\n          }),\n        )\n        addDisposer(\n          self,\n          autorun(() => {\n            self.setSNPCoverageHeight(self.SNPCoverageDisplay.height)\n          }),\n        )\n      },\n      async renderSvg(opts: { rasterizeLayers?: boolean }) {\n        const pileupHeight = self.height - self.SNPCoverageDisplay.height\n        await when(() => self.PileupDisplay.ready)\n        return (\n          <>\n            <g>{await self.SNPCoverageDisplay.renderSvg(opts)}</g>\n            <g transform={`translate(0 ${self.SNPCoverageDisplay.height})`}>\n              {await self.PileupDisplay.renderSvg({\n                ...opts,\n                overrideHeight: pileupHeight,\n              })}\n            </g>\n          </>\n        )\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type AlignmentsDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type AlignmentsDisplayModel = Instance<AlignmentsDisplayStateModel>\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { makeStyles } from '@material-ui/core'\nimport { AlignmentsDisplayModel } from '../models/model'\n\nconst useStyles = makeStyles(() => ({\n  resizeHandle: {\n    height: 2,\n    position: 'absolute',\n    zIndex: 2,\n  },\n}))\n\nfunction AlignmentsDisplay({ model }: { model: AlignmentsDisplayModel }) {\n  const { PileupDisplay, SNPCoverageDisplay, showPileup, showCoverage } = model\n  const classes = useStyles()\n  const top = SNPCoverageDisplay.height\n  return (\n    <div\n      data-testid={`display-${getConf(model, 'displayId')}`}\n      style={{ position: 'relative' }}\n    >\n      {showCoverage ? (\n        <>\n          <div data-testid=\"Blockset-snpcoverage\">\n            <SNPCoverageDisplay.RenderingComponent model={SNPCoverageDisplay} />\n          </div>\n          <ResizeHandle\n            onDrag={delta => {\n              SNPCoverageDisplay.setHeight(SNPCoverageDisplay.height + delta)\n              return delta\n            }}\n            className={classes.resizeHandle}\n            style={{\n              top,\n            }}\n          />\n        </>\n      ) : null}\n\n      {showPileup ? (\n        <div\n          data-testid=\"Blockset-pileup\"\n          style={{\n            position: 'absolute',\n            top: showCoverage ? SNPCoverageDisplay.height : 0,\n          }}\n        >\n          <PileupDisplay.RenderingComponent model={PileupDisplay} />\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nexport default observer(AlignmentsDisplay)\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport ReactComponent from './components/AlignmentsDisplay'\n\nexport default function (pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearAlignmentsDisplay',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent,\n    })\n  })\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Tooltip } from '@jbrowse/plugin-wiggle'\n\ntype Count = {\n  [key: string]: {\n    total: number\n    '-1': number\n    '0': number\n    '1': number\n  }\n}\n\ntype SNPInfo = {\n  cov: Count\n  lowqual: Count\n  noncov: Count\n  delskips: Count\n  refbase: string\n  total: number\n  ref: number\n  all: number\n  '-1': number\n  '0': number\n  '1': number\n}\n\nconst en = (n: number) => n.toLocaleString('en-US')\nconst toP = (s = 0) => +(+s).toFixed(1)\nconst pct = (n: number, total: number) => `${toP((n / (total || 1)) * 100)}%`\n\nconst TooltipContents = React.forwardRef(\n  ({ feature }: { feature: Feature }, reactRef: any) => {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const {\n      refbase,\n      all,\n      total,\n      ref,\n      '-1': rn1,\n      '1': r1,\n      '0': r0,\n      ...info\n    } = feature.get('snpinfo') as SNPInfo\n    const loc = [name, start === end ? en(start) : `${en(start)}..${en(end)}`]\n      .filter(f => !!f)\n      .join(':')\n\n    return (\n      <div ref={reactRef}>\n        <table>\n          <caption>{loc}</caption>\n          <thead>\n            <tr>\n              <th>Base</th>\n              <th>Count</th>\n              <th>% of Total</th>\n              <th>Strands</th>\n              <th>Source</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <td>Total</td>\n              <td>{all}</td>\n            </tr>\n            <tr>\n              <td>REF {refbase ? `(${refbase.toUpperCase()})` : ''}</td>\n              <td>{ref}</td>\n              <td>{pct(ref, all)}</td>\n              <td>\n                {rn1 ? `${rn1}(-)` : ''}\n                {r1 ? `${r1}(+)` : ''}\n              </td>\n              <td />\n            </tr>\n\n            {Object.entries(info as unknown as Record<string, Count>).map(\n              ([key, entry]) =>\n                Object.entries(entry).map(([base, score]) => (\n                  <tr key={base}>\n                    <td>{base.toUpperCase()}</td>\n                    <td>{score.total}</td>\n                    <td>\n                      {base === 'total' || base === 'skip'\n                        ? '---'\n                        : pct(score.total, all)}\n                    </td>\n                    <td>\n                      {score['-1'] ? `${score['-1']}(-)` : ''}\n                      {score['1'] ? `${score['1']}(+)` : ''}\n                    </td>\n                    <td>{key}</td>\n                  </tr>\n                )),\n            )}\n          </tbody>\n        </table>\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst SNPCoverageTooltip = observer(\n  (props: {\n    model: any\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n  }) => {\n    const { model } = props\n    const { featureUnderMouse: feat } = model\n    return feat && feat.get('type') === 'skip' ? null : (\n      <Tooltip TooltipContents={TooltipContents} {...props} />\n    )\n  },\n)\n\nexport default SNPCoverageTooltip\n","import { BlockSet } from '@jbrowse/core/util/blockTypes'\n\nimport { getSession } from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\nexport async function getUniqueTagValues(\n  self: IAnyStateTreeNode & { adapterConfig: AnyConfigurationModel },\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const { adapterConfig } = self\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    getRpcSessionId(self),\n    'PileupGetGlobalValueForTag',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n\nexport async function getUniqueModificationValues(\n  self: IAnyStateTreeNode & {\n    parentTrack: IAnyStateTreeNode & { configuration: AnyConfigurationModel }\n  },\n  adapterConfig: AnyConfigurationModel,\n  colorScheme: { type: string; tag?: string },\n  blocks: BlockSet,\n  opts?: {\n    headers?: Record<string, string>\n    signal?: AbortSignal\n    filters?: string[]\n  },\n) {\n  const { rpcManager } = getSession(self)\n  const sessionId = getRpcSessionId(self)\n  const values = await rpcManager.call(\n    sessionId,\n    'PileupGetVisibleModifications',\n    {\n      adapterConfig,\n      tag: colorScheme.tag,\n      sessionId,\n      regions: blocks.contentBlocks,\n      ...opts,\n    },\n  )\n  return values as string[]\n}\n","import { addDisposer, types, cast, getEnv, getSnapshot } from 'mobx-state-tree'\nimport { observable, autorun } from 'mobx'\nimport {\n  getConf,\n  readConfObject,\n  AnyConfigurationSchemaType,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { linearWiggleDisplayModelFactory } from '@jbrowse/plugin-wiggle'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getContainingView } from '@jbrowse/core/util'\nimport Tooltip from '../components/Tooltip'\nimport { getUniqueModificationValues } from '../../shared'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\n\n// using a map because it preserves order\nconst rendererTypes = new Map([['snpcoverage', 'SNPCoverageRenderer']])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'LinearSNPCoverageDisplay',\n      linearWiggleDisplayModelFactory(pluginManager, configSchema),\n      types.model({\n        type: types.literal('LinearSNPCoverageDisplay'),\n        drawInterbaseCounts: types.maybe(types.boolean),\n        drawIndicators: types.maybe(types.boolean),\n        drawArcs: types.maybe(types.boolean),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1540),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n          }),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      modificationTagMap: observable.map({}),\n    }))\n    .actions(self => ({\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n      setColorBy(colorBy?: { type: string; tag?: string }) {\n        self.colorBy = cast(colorBy)\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        let i = 0\n\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const newColor = colorPalette[i++]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get rendererConfig() {\n          const configBlob =\n            getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n          return self.rendererType.configSchema.create(\n            {\n              ...configBlob,\n              drawInterbaseCounts:\n                self.drawInterbaseCounts === undefined\n                  ? configBlob.drawInterbaseCounts\n                  : self.drawInterbaseCounts,\n              drawIndicators:\n                self.drawIndicators === undefined\n                  ? configBlob.drawIndicators\n                  : self.drawIndicators,\n              drawArcs:\n                self.drawArcs === undefined\n                  ? configBlob.drawArcs\n                  : self.drawArcs,\n            },\n            getEnv(self),\n          )\n        },\n        get drawArcsSetting() {\n          return self.drawArcs !== undefined\n            ? self.drawArcs\n            : readConfObject(this.rendererConfig, 'drawArcs')\n        },\n        get drawInterbaseCountsSetting() {\n          return self.drawInterbaseCounts !== undefined\n            ? self.drawInterbaseCounts\n            : readConfObject(this.rendererConfig, 'drawInterbaseCounts')\n        },\n        get drawIndicatorsSetting() {\n          return self.drawIndicators !== undefined\n            ? self.drawIndicators\n            : readConfObject(this.rendererConfig, 'drawIndicators')\n        },\n\n        get modificationsReady() {\n          return self.colorBy?.type === 'modifications'\n            ? Object.keys(JSON.parse(JSON.stringify(self.modificationTagMap)))\n                .length > 0\n            : true\n        },\n\n        renderProps() {\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !this.modificationsReady,\n            modificationTagMap: JSON.parse(\n              JSON.stringify(self.modificationTagMap),\n            ),\n\n            // must use getSnapshot because otherwise changes to e.g. just the\n            // colorBy.type are not read\n            colorBy: self.colorBy ? getSnapshot(self.colorBy) : undefined,\n            filterBy: self.filterBy ? getSnapshot(self.filterBy) : undefined,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      toggleDrawIndicators() {\n        self.drawIndicators = !self.drawIndicatorsSetting\n      },\n      toggleDrawInterbaseCounts() {\n        self.drawInterbaseCounts = !self.drawInterbaseCountsSetting\n      },\n      toggleDrawArcs() {\n        self.drawArcs = !self.drawArcsSetting\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { colorBy } = self\n                const { staticBlocks } = getContainingView(self) as LGV\n                if (colorBy?.type === 'modifications') {\n                  const vals = await getUniqueModificationValues(\n                    self,\n                    getConf(self.parentTrack, 'adapter'),\n                    colorBy,\n                    staticBlocks,\n                  )\n                  self.updateModificationColorMap(vals)\n                }\n              } catch (error) {\n                console.error(error)\n                self.setError(error)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n      },\n    }))\n\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        get TooltipComponent() {\n          return Tooltip\n        },\n\n        get adapterConfig() {\n          const subadapter = getConf(self.parentTrack, 'adapter')\n          return {\n            type: 'SNPCoverageAdapter',\n            subadapter,\n          }\n        },\n\n        get rendererTypeName() {\n          return rendererTypes.get('snpcoverage')\n        },\n\n        get needsScalebar() {\n          return true\n        },\n\n        contextMenuItems() {\n          return []\n        },\n\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Draw insertion/clipping indicators',\n              type: 'checkbox',\n              checked: self.drawIndicatorsSetting,\n              onClick: () => {\n                self.toggleDrawIndicators()\n              },\n            },\n            {\n              label: 'Draw insertion/clipping counts',\n              type: 'checkbox',\n              checked: self.drawInterbaseCountsSetting,\n              onClick: () => {\n                self.toggleDrawInterbaseCounts()\n              },\n            },\n            {\n              label: 'Draw arcs',\n              type: 'checkbox',\n              checked: self.drawArcsSetting,\n              onClick: () => {\n                self.toggleDrawArcs()\n              },\n            },\n          ]\n        },\n      }\n    })\n\nexport type SNPCoverageDisplayModel = ReturnType<typeof stateModelFactory>\n\nexport default stateModelFactory\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaFactory from './models/configSchema'\nimport modelFactory from './models/model'\nimport { LinearWiggleDisplayReactComponent } from '@jbrowse/plugin-wiggle'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearSNPCoverageDisplay',\n      configSchema,\n      stateModel: modelFactory(pluginManager, configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: LinearWiggleDisplayReactComponent,\n    })\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function SNPCoverageConfigFactory(pluginManager: PluginManager) {\n  const SNPCoverageRendererConfigSchema = pluginManager.getRendererType(\n    'SNPCoverageRenderer',\n  ).configSchema\n\n  return ConfigurationSchema(\n    'LinearSNPCoverageDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', ['local']),\n        description:\n          'performs local autoscaling (no other options for SNP Coverage available)',\n      },\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      multiTicks: {\n        type: 'boolean',\n        description: 'Display multiple values for the ticks',\n        defaultValue: false,\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        SNPCoverageRenderer: SNPCoverageRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nfunction PileupConfigFactory(pluginManager: PluginManager) {\n  const PileupRendererConfigSchema =\n    pluginManager.getRendererType('PileupRenderer').configSchema\n\n  // modify config schema to take in a sub coverage display\n  return ConfigurationSchema(\n    'LinearPileupDisplay',\n    {\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['pileup']),\n        defaultValue: 'pileup',\n      },\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        PileupRenderer: PileupRendererConfigSchema,\n      }),\n      renderer: '',\n      maxFeatureScreenDensity: {\n        type: 'number',\n        description: 'maximum features per pixel that is displayed in the view',\n        defaultValue: 5,\n      },\n      colorScheme: {\n        type: 'stringEnum',\n        model: types.enumeration('colorScheme', [\n          'strand',\n          'normal',\n          'insertSize',\n          'insertSizeAndOrientation',\n          'mappingQuality',\n          'tag',\n        ]),\n        description: 'color scheme to use',\n        defaultValue: 'normal',\n      },\n    },\n    {\n      baseConfiguration: linearBasicDisplayConfigSchemaFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport type LinearPileupDisplayConfigModel = ReturnType<\n  typeof PileupConfigFactory\n>\nexport type LinearPileupDisplayConfig = Instance<LinearPileupDisplayConfigModel>\nexport default PileupConfigFactory\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport Typography from '@material-ui/core/Typography'\n\nexport interface LinearPileupDisplayBlurbProps {\n  model: {\n    sortedBy?: {\n      pos: number\n      refName: number\n      type: string\n    }\n  }\n}\n\nfunction LinearPileupDisplayBlurb(props: LinearPileupDisplayBlurbProps) {\n  const { model } = props\n  const { sortedBy } = model\n  return sortedBy ? (\n    <div\n      data-testid={`blurb-${model.sortedBy}`}\n      style={{ backgroundColor: 'white' }}\n    >\n      <Typography color=\"secondary\" variant=\"caption\">\n        {model.sortedBy\n          ? `Sorted by ${sortedBy.type.toLowerCase()} at ${sortedBy.refName}:${\n              sortedBy.pos\n            }`\n          : null}\n      </Typography>\n    </div>\n  ) : null\n}\nexport default observer(LinearPileupDisplayBlurb)\n","import { lazy } from 'react'\nimport { autorun, observable } from 'mobx'\nimport { cast, types, addDisposer, getEnv, Instance } from 'mobx-state-tree'\nimport copy from 'copy-to-clipboard'\nimport {\n  AnyConfigurationModel,\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  getContainingView,\n  SimpleFeature,\n  Feature,\n} from '@jbrowse/core/util'\n\nimport {\n  LinearGenomeViewModel,\n  BaseLinearDisplay,\n} from '@jbrowse/plugin-linear-genome-view'\n\n// icons\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\nimport SortIcon from '@material-ui/icons/Sort'\nimport PaletteIcon from '@material-ui/icons/Palette'\nimport FilterListIcon from '@material-ui/icons/ClearAll'\n\n// locals\nimport { LinearPileupDisplayConfigModel } from './configSchema'\nimport LinearPileupDisplayBlurb from './components/LinearPileupDisplayBlurb'\nimport { getUniqueTagValues, getUniqueModificationValues } from '../shared'\n\n// async\nconst ColorByTagDlg = lazy(() => import('./components/ColorByTag'))\nconst FilterByTagDlg = lazy(() => import('./components/FilterByTag'))\nconst SortByTagDlg = lazy(() => import('./components/SortByTag'))\nconst SetFeatureHeightDlg = lazy(() => import('./components/SetFeatureHeight'))\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\nconst ModificationsDlg = lazy(() => import('./components/ColorByModifications'))\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['pileup', 'PileupRenderer'],\n  ['svg', 'SvgFeatureRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (configSchema: LinearPileupDisplayConfigModel) =>\n  types\n    .compose(\n      'LinearPileupDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearPileupDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showSoftClipping: false,\n        featureHeight: types.maybe(types.number),\n        noSpacing: types.maybe(types.boolean),\n        fadeLikelihood: types.maybe(types.boolean),\n        trackMaxHeight: types.maybe(types.number),\n        mismatchAlpha: types.maybe(types.boolean),\n        sortedBy: types.maybe(\n          types.model({\n            type: types.string,\n            pos: types.number,\n            tag: types.maybe(types.string),\n            refName: types.string,\n            assemblyName: types.string,\n          }),\n        ),\n        colorBy: types.maybe(\n          types.model({\n            type: types.string,\n            tag: types.maybe(types.string),\n            extra: types.frozen(),\n          }),\n        ),\n        filterBy: types.optional(\n          types.model({\n            flagInclude: types.optional(types.number, 0),\n            flagExclude: types.optional(types.number, 1540),\n            readName: types.maybe(types.string),\n            tagFilter: types.maybe(\n              types.model({ tag: types.string, value: types.string }),\n            ),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      colorTagMap: observable.map<string, string>({}),\n      modificationTagMap: observable.map<string, string>({}),\n      featureUnderMouseVolatile: undefined as undefined | Feature,\n      ready: false,\n    }))\n    .actions(self => ({\n      setReady(flag: boolean) {\n        self.ready = flag\n      },\n      setMaxHeight(n: number) {\n        self.trackMaxHeight = n\n      },\n      setFeatureHeight(n: number) {\n        self.featureHeight = n\n      },\n      setNoSpacing(flag: boolean) {\n        self.noSpacing = flag\n      },\n\n      setColorScheme(colorScheme: { type: string; tag?: string }) {\n        self.colorTagMap = observable.map({}) // clear existing mapping\n        self.colorBy = cast(colorScheme)\n        self.ready = false\n      },\n\n      updateModificationColorMap(uniqueModifications: string[]) {\n        const colorPalette = ['red', 'blue', 'green', 'orange', 'purple']\n        uniqueModifications.forEach(value => {\n          if (!self.modificationTagMap.has(value)) {\n            const totalKeys = [...self.modificationTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.modificationTagMap.set(value, newColor)\n          }\n        })\n      },\n\n      updateColorTagMap(uniqueTag: string[]) {\n        // pale color scheme\n        // https://cran.r-project.org/web/packages/khroma/vignettes/tol.html\n        // e.g. \"tol_light\"\n        const colorPalette = [\n          '#BBCCEE',\n          'pink',\n          '#CCDDAA',\n          '#EEEEBB',\n          '#FFCCCC',\n          'lightblue',\n          'lightgreen',\n          'tan',\n          '#CCEEFF',\n          'lightsalmon',\n        ]\n\n        uniqueTag.forEach(value => {\n          if (!self.colorTagMap.has(value)) {\n            const totalKeys = [...self.colorTagMap.keys()].length\n            const newColor = colorPalette[totalKeys]\n            self.colorTagMap.set(value, newColor)\n          }\n        })\n      },\n      setFeatureUnderMouse(feat?: Feature) {\n        self.featureUnderMouseVolatile = feat\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const { rpcManager } = getSession(self)\n                const view = getContainingView(self) as LGV\n                const {\n                  sortedBy,\n                  colorBy,\n                  parentTrack,\n                  adapterConfig,\n                  rendererType,\n                } = self\n                const { staticBlocks, bpPerPx } = view\n\n                // continually generate the vc pairing, set and rerender if any\n                // new values seen\n                if (colorBy?.tag) {\n                  const uniqueTagSet = await getUniqueTagValues(\n                    self,\n                    colorBy,\n                    staticBlocks,\n                  )\n                  self.updateColorTagMap(uniqueTagSet)\n                }\n\n                if (colorBy?.type === 'modifications') {\n                  const adapter = getConf(parentTrack, ['adapter'])\n                  self.updateModificationColorMap(\n                    await getUniqueModificationValues(\n                      self,\n                      adapter,\n                      colorBy,\n                      staticBlocks,\n                    ),\n                  )\n                }\n\n                if (sortedBy) {\n                  const { pos, refName, assemblyName } = sortedBy\n\n                  // render just the sorted region first\n                  await self.rendererType.renderInClient(rpcManager, {\n                    assemblyName,\n                    regions: [\n                      {\n                        start: pos,\n                        end: pos + 1,\n                        refName,\n                        assemblyName,\n                      },\n                    ],\n                    adapterConfig: adapterConfig,\n                    rendererType: rendererType.name,\n                    sessionId: getRpcSessionId(self),\n                    layoutId: view.id,\n                    timeout: 1000000,\n                    ...self.renderProps(),\n                  })\n                  self.setReady(true)\n                  self.setCurrBpPerPx(bpPerPx)\n                } else {\n                  self.setReady(true)\n                }\n              } catch (e) {\n                console.error(e)\n                self.setError(e)\n              }\n            },\n            { delay: 1000 },\n          ),\n        )\n\n        // autorun synchronizes featureUnderMouse with featureIdUnderMouse\n        addDisposer(\n          self,\n          autorun(async () => {\n            const session = getSession(self)\n            try {\n              const featureId = self.featureIdUnderMouse\n              if (self.featureUnderMouse?.id() !== featureId) {\n                if (!featureId) {\n                  self.setFeatureUnderMouse(undefined)\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const view = getContainingView(self)\n                  const { feature } = (await session.rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId,\n                      sessionId,\n                      layoutId: view.id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: unknown }\n\n                  // check featureIdUnderMouse is still the same as the\n                  // feature.id that was returned e.g. that the user hasn't\n                  // moused over to a new position during the async operation\n                  // above\n                  // @ts-ignore\n                  if (self.featureIdUnderMouse === feature.uniqueId) {\n                    // @ts-ignore\n                    self.setFeatureUnderMouse(new SimpleFeature(feature))\n                  }\n                }\n              }\n            } catch (e) {\n              console.error(e)\n              session.notify(`${e}`, 'error')\n            }\n          }),\n        )\n      },\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const featureWidget = session.addWidget(\n            'AlignmentsFeatureWidget',\n            'alignmentFeature',\n            { featureData: feature.toJSON(), view: getContainingView(self) },\n          )\n          session.showWidget(featureWidget)\n        }\n        session.setSelection(feature)\n      },\n\n      clearSelected() {\n        self.sortedBy = undefined\n      },\n\n      // uses copy-to-clipboard and generates notification\n      copyFeatureToClipboard(feature: Feature) {\n        const { uniqueId, ...rest } = feature.toJSON()\n        const session = getSession(self)\n        copy(JSON.stringify(rest, null, 4))\n        session.notify('Copied to clipboard', 'success')\n      },\n\n      toggleSoftClipping() {\n        self.showSoftClipping = !self.showSoftClipping\n      },\n      toggleMismatchAlpha() {\n        self.mismatchAlpha = !self.mismatchAlpha\n      },\n\n      setConfig(configuration: AnyConfigurationModel) {\n        self.configuration = configuration\n      },\n\n      setSortedBy(type: string, tag?: string) {\n        const { centerLineInfo } = getContainingView(self) as LGV\n        if (!centerLineInfo) {\n          return\n        }\n        const { refName, assemblyName, offset } = centerLineInfo\n        const centerBp = Math.round(offset) + 1\n        const centerRefName = refName\n\n        if (centerBp < 0) {\n          return\n        }\n\n        self.sortedBy = {\n          type,\n          pos: centerBp,\n          refName: centerRefName,\n          assemblyName,\n          tag,\n        }\n        self.ready = false\n      },\n      setFilterBy(filter: {\n        flagInclude: number\n        flagExclude: number\n        readName?: string\n        tagFilter?: { tag: string; value: string }\n      }) {\n        self.filterBy = cast(filter)\n      },\n    }))\n    .actions(self => {\n      // resets the sort object and refresh whole display on reload\n      const superReload = self.reload\n\n      return {\n        reload() {\n          self.clearSelected()\n          superReload()\n        },\n      }\n    })\n\n    .views(self => ({\n      get maxHeight() {\n        const conf = getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.trackMaxHeight !== undefined\n          ? self.trackMaxHeight\n          : conf.maxHeight\n      },\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            height: self.featureHeight,\n            noSpacing: self.noSpacing,\n            maxHeight: this.maxHeight,\n            mismatchAlpha: self.mismatchAlpha,\n          },\n          getEnv(self),\n        )\n      },\n      get featureHeightSetting() {\n        return (\n          self.featureHeight || readConfObject(this.rendererConfig, 'height')\n        )\n      },\n      get mismatchAlphaSetting() {\n        return self.mismatchAlpha !== undefined\n          ? self.mismatchAlpha\n          : readConfObject(this.rendererConfig, 'mismatchAlpha')\n      },\n      get featureUnderMouse() {\n        return self.featureUnderMouseVolatile\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n\n      return {\n        get rendererTypeName() {\n          const viewName = getConf(self, 'defaultRendering')\n          const rendererType = rendererTypes.get(viewName)\n          if (!rendererType) {\n            throw new Error(`unknown alignments view name ${viewName}`)\n          }\n          return rendererType\n        },\n\n        contextMenuItems() {\n          const feat = self.contextMenuFeature\n          const contextMenuItems = feat\n            ? [\n                {\n                  label: 'Open feature details',\n                  icon: MenuOpenIcon,\n                  onClick: () => {\n                    self.clearFeatureSelection()\n                    if (feat) {\n                      self.selectFeature(feat)\n                    }\n                  },\n                },\n                {\n                  label: 'Copy info to clipboard',\n                  icon: ContentCopyIcon,\n                  onClick: () => {\n                    if (feat) {\n                      self.copyFeatureToClipboard(feat)\n                    }\n                  },\n                },\n              ]\n            : []\n          return contextMenuItems\n        },\n\n        get DisplayBlurb() {\n          return LinearPileupDisplayBlurb\n        },\n\n        renderProps() {\n          const view = getContainingView(self) as LGV\n          const {\n            colorTagMap,\n            modificationTagMap,\n            sortedBy,\n            colorBy,\n            filterBy,\n            rpcDriverName,\n            currBpPerPx,\n            ready,\n          } = self\n\n          const superProps = superRenderProps()\n\n          return {\n            ...superProps,\n            notReady:\n              superProps.notReady ||\n              !ready ||\n              (sortedBy && currBpPerPx !== view.bpPerPx),\n            rpcDriverName,\n            displayModel: self,\n            sortedBy,\n            colorBy,\n            filterBy: JSON.parse(JSON.stringify(filterBy)),\n            colorTagMap: JSON.parse(JSON.stringify(colorTagMap)),\n            modificationTagMap: JSON.parse(JSON.stringify(modificationTagMap)),\n            showSoftClip: self.showSoftClipping,\n            config: self.rendererConfig,\n            async onFeatureClick(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: unknown }\n\n                  if (feature) {\n                    // @ts-ignore\n                    self.selectFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n\n            onClick() {\n              self.clearFeatureSelection()\n            },\n            // similar to click but opens a menu with further options\n            async onFeatureContextMenu(_: unknown, featureId?: string) {\n              const session = getSession(self)\n              const { rpcManager } = session\n              try {\n                const f = featureId || self.featureIdUnderMouse\n                if (!f) {\n                  self.clearFeatureSelection()\n                } else {\n                  const sessionId = getRpcSessionId(self)\n                  const { feature } = (await rpcManager.call(\n                    sessionId,\n                    'CoreGetFeatureDetails',\n                    {\n                      featureId: f,\n                      sessionId,\n                      layoutId: getContainingView(self).id,\n                      rendererType: 'PileupRenderer',\n                    },\n                  )) as { feature: unknown }\n\n                  if (feature) {\n                    // @ts-ignore\n                    self.setContextMenuFeature(new SimpleFeature(feature))\n                  }\n                }\n              } catch (e) {\n                console.error(e)\n                session.notify(`${e}`)\n              }\n            },\n          }\n        },\n\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show soft clipping',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showSoftClipping,\n              onClick: () => {\n                self.toggleSoftClipping()\n                // if toggling from off to on, will break sort for this track\n                // so clear it\n                if (self.showSoftClipping) {\n                  self.clearSelected()\n                }\n              },\n            },\n            {\n              label: 'Sort by',\n              icon: SortIcon,\n              disabled: self.showSoftClipping,\n              subMenu: [\n                ...['Start location', 'Read strand', 'Base pair'].map(\n                  option => ({\n                    label: option,\n                    onClick: () => self.setSortedBy(option),\n                  }),\n                ),\n                {\n                  label: 'Sort by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(handleClose => [\n                      SortByTagDlg,\n                      { model: self, handleClose },\n                    ])\n                  },\n                },\n                {\n                  label: 'Clear sort',\n                  onClick: () => self.clearSelected(),\n                },\n              ],\n            },\n            {\n              label: 'Color scheme',\n              icon: PaletteIcon,\n              subMenu: [\n                {\n                  label: 'Normal',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'normal' })\n                  },\n                },\n                {\n                  label: 'Mapping quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'mappingQuality' })\n                  },\n                },\n                {\n                  label: 'Strand',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'strand' })\n                  },\n                },\n                {\n                  label: 'Pair orientation',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'pairOrientation' })\n                  },\n                },\n                {\n                  label: 'Per-base quality',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'perBaseQuality' })\n                  },\n                },\n                {\n                  label: 'Per-base lettering',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'perBaseLettering' })\n                  },\n                },\n                {\n                  label: 'Modifications or methylation',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      ModificationsDlg,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n                {\n                  label: 'Insert size',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'insertSize' })\n                  },\n                },\n                {\n                  label: 'Stranded paired-end',\n                  onClick: () => {\n                    self.setColorScheme({ type: 'reverseTemplate' })\n                  },\n                },\n                {\n                  label: 'Color by tag...',\n                  onClick: () => {\n                    getSession(self).queueDialog(doneCallback => [\n                      ColorByTagDlg,\n                      { model: self, handleClose: doneCallback },\n                    ])\n                  },\n                },\n              ],\n            },\n            {\n              label: 'Filter by',\n              icon: FilterListIcon,\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  FilterByTagDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set feature height',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetFeatureHeightDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetMaxHeightDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Fade mismatches by quality',\n              type: 'checkbox',\n              checked: self.mismatchAlphaSetting,\n              onClick: () => {\n                self.toggleMismatchAlpha()\n              },\n            },\n          ]\n        },\n      }\n    })\n\nexport type LinearPileupDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearPileupDisplayModel = Instance<LinearPileupDisplayStateModel>\n\nexport default stateModelFactory\n","import configSchemaFactory from './configSchema'\nimport modelFactory from './model'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearPileupDisplay',\n      configSchema,\n      stateModel: modelFactory(configSchema),\n      trackType: 'AlignmentsTrack',\n      viewType: 'LinearGenomeView',\n      ReactComponent: BaseLinearDisplayComponent,\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nfunction configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'AlignmentsTrack',\n    {},\n    { baseConfiguration: createBaseTrackConfig(pluginManager) },\n  )\n}\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addTrackType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    const track = new TrackType({\n      name: 'AlignmentsTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'AlignmentsTrack',\n        configSchema,\n      ),\n    })\n    const linearAlignmentsDisplay = pluginManager.getDisplayType(\n      'LinearAlignmentsDisplay',\n    )\n    // Add LinearAlignmentsDisplay here so that it has priority over the other\n    // linear displays (defaults to order the displays are added, but we have\n    // to add the Pileup and SNPCoverage displays first).\n    track.addDisplayType(linearAlignmentsDisplay)\n    return track\n  })\n}\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nconst configSchema = ConfigurationSchema('AlignmentsFeatureWidget', {})\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('AlignmentsFeatureWidget', {\n      type: types.literal('AlignmentsFeatureWidget'),\n    }),\n  )\n}\n\nexport default function register(pluginManager: PluginManager) {\n  pluginManager.addWidgetType(\n    () =>\n      new WidgetType({\n        name: 'AlignmentsFeatureWidget',\n        heading: 'Feature details',\n        configSchema,\n        stateModel: stateModelFactory(pluginManager),\n        ReactComponent: lazy(() => import('./AlignmentsFeatureDetail')),\n      }),\n  )\n}\n\nexport { configSchema }\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { toArray } from 'rxjs/operators'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getTagAlt } from '../util'\nimport { getModificationTypes } from '../BamAdapter/MismatchParser'\n\nexport class PileupGetGlobalValueForTag extends RpcMethodType {\n  name = 'PileupGetGlobalValueForTag'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n    rpcDriverClassName: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions, tag } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const tags = feature.get('tags')\n      const val = tags ? tags[tag] : feature.get(tag)\n      if (val !== undefined) {\n        uniqueValues.add(`${val}`)\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n\nexport class PileupGetVisibleModifications extends RpcMethodType {\n  name = 'PileupGetVisibleModifications'\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n    rpcDriverClassName: string,\n  ) {\n    const { rootModel } = this.pluginManager\n    const assemblyManager = rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      throw new Error('no assembly manager available')\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, args)\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      regions: Region[]\n      sessionId: string\n      tag: string\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId, regions } = deserializedArgs\n    const dataAdapter = (\n      await getAdapter(this.pluginManager, sessionId, adapterConfig)\n    ).dataAdapter as BaseFeatureDataAdapter\n\n    const features = dataAdapter.getFeaturesInMultipleRegions(regions)\n    const featuresArray = await features.pipe(toArray()).toPromise()\n    const uniqueValues = new Set<string>()\n    featuresArray.forEach(feature => {\n      const val = (getTagAlt(feature, 'MM', 'Mm') as string) || ''\n      if (val !== undefined) {\n        getModificationTypes(val).forEach(t => uniqueValues.add(t))\n      }\n    })\n    return [...uniqueValues]\n  }\n}\n","import { FileLocation } from '@jbrowse/core/util/types'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport * as MismatchParser from './BamAdapter/MismatchParser'\nimport { LinearPileupDisplayModel } from './LinearPileupDisplay/model'\n\nimport BamAdapterF from './CramAdapter'\nimport CramAdapterF from './BamAdapter'\nimport HtsgetBamAdapterF from './HtsgetBamAdapter'\nimport SNPCoverageAdapterF from './SNPCoverageAdapter'\nimport SNPCoverageRendererF from './SNPCoverageRenderer'\nimport PileupRendererF from './PileupRenderer'\nimport LinearAlignmentsDisplayF from './LinearAlignmentsDisplay'\nimport LinearSNPCoverageDisplayF from './LinearSNPCoverageDisplay'\nimport LinearPileupDisplayF from './LinearPileupDisplay'\nimport AlignmentsTrackF from './AlignmentsTrack'\nimport AlignmentsFeatureWidgetF from './AlignmentsFeatureDetail'\n\nimport {\n  PileupGetGlobalValueForTag,\n  PileupGetVisibleModifications,\n} from './PileupRPC/rpcMethods'\nimport {\n  makeIndex,\n  makeIndexType,\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport { MismatchParser }\nexport type { LinearPileupDisplayModel }\n\nexport default class AlignmentsPlugin extends Plugin {\n  name = 'AlignmentsPlugin'\n\n  install(pluginManager: PluginManager) {\n    ;[\n      CramAdapterF,\n      BamAdapterF,\n      LinearPileupDisplayF,\n      LinearSNPCoverageDisplayF,\n      AlignmentsTrackF,\n      SNPCoverageAdapterF,\n      HtsgetBamAdapterF,\n      PileupRendererF,\n      SNPCoverageRendererF,\n      LinearAlignmentsDisplayF,\n      AlignmentsFeatureWidgetF,\n    ].map(f => f(pluginManager))\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.cram$/i\n          const adapterName = 'CramAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            cramLocation: file,\n            craiLocation: index || makeIndex(file, '.crai'),\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bam$/i\n          const adapterName = 'BamAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n\n          const obj = {\n            type: adapterName,\n            bamLocation: file,\n            index: {\n              location: index || makeIndex(file, '.bai'),\n              indexType: makeIndexType(indexName, 'CSI', 'BAI'),\n            },\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BamAdapter' || adapterName === 'CramAdapter') {\n            return 'AlignmentsTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addRpcMethod(\n      () => new PileupGetGlobalValueForTag(pluginManager),\n    )\n    pluginManager.addRpcMethod(\n      () => new PileupGetVisibleModifications(pluginManager),\n    )\n  }\n}\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { toArray } from 'rxjs/operators'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AugmentedRegion } from '@jbrowse/core/util'\n// get tag from BAM or CRAM feature, where CRAM uses feature.get('tags') and\n// BAM does not\nexport function getTag(feature: Feature, tag: string) {\n  const tags = feature.get('tags')\n  return tags ? tags[tag] : feature.get(tag)\n}\n\n// use fallback alt tag, used in situations where upper case/lower case tags\n// exist e.g. Mm/MM for base modifications\nexport function getTagAlt(feature: Feature, tag: string, alt: string) {\n  return getTag(feature, tag) || getTag(feature, alt)\n}\n\n// orientation definitions from igv.js, see also\n// https://software.broadinstitute.org/software/igv/interpreting_pair_orientations\nexport const orientationTypes = {\n  fr: {\n    F1R2: 'LR',\n    F2R1: 'LR',\n\n    F1F2: 'LL',\n    F2F1: 'LL',\n\n    R1R2: 'RR',\n    R2R1: 'RR',\n\n    R1F2: 'RL',\n    R2F1: 'RL',\n  } as { [key: string]: string },\n\n  rf: {\n    R1F2: 'LR',\n    R2F1: 'LR',\n\n    R1R2: 'LL',\n    R2R1: 'LL',\n\n    F1F2: 'RR',\n    F2F1: 'RR',\n\n    F1R2: 'RL',\n    F2R1: 'RL',\n  } as { [key: string]: string },\n\n  ff: {\n    F2F1: 'LR',\n    R1R2: 'LR',\n\n    F2R1: 'LL',\n    R1F2: 'LL',\n\n    R2F1: 'RR',\n    F1R2: 'RR',\n\n    R2R1: 'RL',\n    F1F2: 'RL',\n  } as { [key: string]: string },\n}\n\nexport function getColorWGBS(strand: number, base: string) {\n  if (strand === 1) {\n    if (base === 'C') {\n      return '#f00'\n    }\n    if (base === 'T') {\n      return '#00f'\n    }\n  } else if (strand === -1) {\n    if (base === 'G') {\n      return '#f00'\n    }\n    if (base === 'A') {\n      return '#00f'\n    }\n  }\n  return '#888'\n}\n\nexport async function fetchSequence(\n  region: AugmentedRegion,\n  adapter: BaseFeatureDataAdapter,\n) {\n  const { end, originalRefName, refName } = region\n\n  const feats = await adapter\n    .getFeatures({\n      ...region,\n      refName: originalRefName || refName,\n      end: end + 1,\n    })\n    .pipe(toArray())\n    .toPromise()\n  return feats[0]?.get('seq')\n}\n\n// has to check underlying C-G (aka CpG) on the reference sequence\nexport function shouldFetchReferenceSequence(type?: string) {\n  return type === 'methylation'\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\n\nexport function stateModelFactory(\n  configSchema: AnyConfigurationSchemaType,\n  pluginManager: PluginManager,\n) {\n  const LGVPlugin = pluginManager.getPlugin(\n    'LinearGenomeViewPlugin',\n  ) as import('@jbrowse/plugin-linear-genome-view').default\n  // @ts-ignore\n  const { BaseLinearDisplay } = LGVPlugin.exports\n  return types\n    .compose(\n      'LinearArcDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearArcDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'staticBlocks'\n        },\n        get renderDelay() {\n          return 500\n        },\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import React from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { bpSpanPx, measureText } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { Tooltip } from 'react-svg-tooltip'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction ArcRendering(props: any) {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const onClick = (event: any, id: any) => {\n    const { onFeatureClick: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, id)\n  }\n\n  const {\n    features,\n    config,\n    regions,\n    blockKey,\n    bpPerPx,\n    displayModel: { selectedFeatureId },\n  } = props\n  const [region] = regions\n  const arcsRendered = []\n\n  for (const feature of features.values()) {\n    const [left, right] = bpSpanPx(\n      feature.get('start'),\n      feature.get('end'),\n      region,\n      bpPerPx,\n    )\n\n    const featureId = feature.id()\n    const id = blockKey + '-' + featureId\n    let stroke = readConfObject(config, 'color', { feature })\n    let textStroke = 'black'\n    if (\n      selectedFeatureId &&\n      String(selectedFeatureId) === String(feature.id())\n    ) {\n      stroke = textStroke = 'red'\n    }\n    const label = readConfObject(config, 'label', { feature })\n    const caption = readConfObject(config, 'caption', { feature })\n    const strokeWidth = readConfObject(config, 'thickness', { feature }) || 1\n    const height = readConfObject(config, 'height', { feature }) || 100\n    const ref = React.createRef<SVGPathElement>()\n    const tooltipWidth = 20 + measureText(caption?.toString())\n\n    const t = 0.5\n    // formula: https://en.wikipedia.org/wiki/B%C3%A9zier_curve#Cubic_B%C3%A9zier_curves\n    const textYCoord =\n      (1 - t) * (1 - t) * (1 - t) * 0 +\n      3 * ((1 - t) * (1 - t)) * (t * height) +\n      3 * (1 - t) * (t * t) * height +\n      t * t * t * 0\n\n    arcsRendered.push(\n      <g key={id} onClick={e => onClick(e, featureId)}>\n        <path\n          id={id}\n          d={`M ${left} 0 C ${left} ${height}, ${right} ${height}, ${right} 0`}\n          stroke={stroke}\n          strokeWidth={strokeWidth}\n          fill=\"transparent\"\n          onClick={e => onClick(e, featureId)}\n          ref={ref}\n          pointerEvents=\"stroke\"\n        />\n        <Tooltip triggerRef={ref}>\n          <rect\n            x={12}\n            y={0}\n            width={tooltipWidth}\n            height={20}\n            rx={5}\n            ry={5}\n            fill=\"black\"\n            fillOpacity=\"50%\"\n          />\n          <text\n            x={22}\n            y={14}\n            fontSize={10}\n            fill=\"white\"\n            textLength={tooltipWidth - 20}\n          >\n            {caption}\n          </text>\n        </Tooltip>\n        <text\n          x={left + (right - left) / 2}\n          y={textYCoord + 3}\n          style={{ stroke: 'white', strokeWidth: '0.6em' }}\n        >\n          {label}\n        </text>\n        <text\n          x={left + (right - left) / 2}\n          y={textYCoord + 3}\n          style={{ stroke: textStroke }}\n        >\n          {label}\n        </text>\n      </g>,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = 500\n\n  return (\n    <svg\n      className=\"ArcRendering\"\n      width={width}\n      height={height}\n      style={{\n        outline: 'none',\n        position: 'relative',\n      }}\n    >\n      {arcsRendered}\n    </svg>\n  )\n}\n\nexport default observer(ArcRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'ArcRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of the arcs',\n      defaultValue: 'darkblue',\n      contextVariable: ['feature'],\n    },\n    thickness: {\n      type: 'number',\n      description: 'the thickness of the arcs',\n      defaultValue: `jexl:logThickness(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    label: {\n      type: 'string',\n      description: 'the label to appear at the apex of the arcs',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n    height: {\n      type: 'number',\n      description: 'the height of the arcs',\n      defaultValue: `jexl:log10(get(feature,'end')-get(feature,'start'))*50`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the caption to appear when hovering over any point on the arcs',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\n\nexport default class extends FeatureRendererType {}\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  configSchemaFactory as linearArcDisplayConfigSchemaFactory,\n  stateModelFactory as LinearArcDisplayStateModelFactory,\n} from './LinearArcDisplay'\nimport ArcRenderer, {\n  configSchema as ArcRendererConfigSchema,\n  ReactComponent as ArcRendererReactComponent,\n} from './ArcRenderer'\n\nexport default class MyProjectPlugin extends Plugin {\n  name = 'ArcRenderer'\n  install(pluginManager: PluginManager) {\n    const LGVPlugin = pluginManager.getPlugin(\n      'LinearGenomeViewPlugin',\n    ) as import('@jbrowse/plugin-linear-genome-view').default\n    // @ts-ignore\n    const { BaseLinearDisplayComponent } = LGVPlugin.exports\n\n    pluginManager.addRendererType(\n      () =>\n        // @ts-ignore error \"expected 0 arguments, but got 1\"?\n        new ArcRenderer({\n          name: 'ArcRenderer',\n          ReactComponent: ArcRendererReactComponent,\n          configSchema: ArcRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearArcDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearArcDisplay',\n        configSchema,\n        stateModel: LinearArcDisplayStateModelFactory(\n          configSchema,\n          pluginManager,\n        ),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.jexl.addFunction(\n      'logThickness',\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (feature: any, attributeName: string) => {\n        return Math.log(feature.get(attributeName) + 1)\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  const LGVPlugin = pluginManager.getPlugin(\n    'LinearGenomeViewPlugin',\n  ) as import('@jbrowse/plugin-linear-genome-view').default\n  // @ts-ignore\n  const { baseLinearDisplayConfigSchema } = LGVPlugin.exports\n  return ConfigurationSchema(\n    'LinearArcDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'ArcRenderer' },\n      ),\n    },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst OAuthConfigSchema = ConfigurationSchema(\n  'OAuthInternetAccount',\n  {\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Bearer',\n    },\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: '',\n    },\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: false,\n    },\n    clientId: {\n      description: 'id for the OAuth application',\n      type: 'string',\n      defaultValue: '',\n    },\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: '',\n    },\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'code',\n    },\n    hasRefreshToken: {\n      description: 'true if the endpoint can supply a refresh token',\n      type: 'boolean',\n      defaultValue: false,\n    },\n  },\n  {\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type OAuthInternetAccountConfigModel = typeof OAuthConfigSchema\nexport type OAuthInternetAccountConfig =\n  Instance<OAuthInternetAccountConfigModel>\nexport default OAuthConfigSchema\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { isElectron } from '@jbrowse/core/util'\nimport sha256 from 'crypto-js/sha256'\nimport Base64 from 'crypto-js/enc-base64'\nimport { Instance, types } from 'mobx-state-tree'\n\n// locals\nimport { OAuthInternetAccountConfigModel } from './configSchema'\n\ninterface OAuthData {\n  client_id: string\n  redirect_uri: string\n  response_type: 'token' | 'code'\n  scope?: string\n  code_challenge?: string\n  code_challenge_method?: string\n  token_access_type?: string\n}\n\nfunction fixup(buf: string) {\n  return buf.replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=/g, '')\n}\n\nfunction getGlobalObject(): Window {\n  // Based on window-or-global\n  // https://github.com/purposeindustries/window-or-global/blob/322abc71de0010c9e5d9d0729df40959e1ef8775/lib/index.js\n  return (\n    // eslint-disable-next-line no-restricted-globals\n    (typeof self === 'object' && self.self === self && self) ||\n    (typeof global === 'object' && global.global === global && global) ||\n    // @ts-ignore\n    this\n  )\n}\n\nconst stateModelFactory = (configSchema: OAuthInternetAccountConfigModel) => {\n  return types\n    .compose(\n      'OAuthInternetAccount',\n      InternetAccount,\n      types.model('OAuthModel', {\n        type: types.literal('OAuthInternetAccount'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(() => {\n      let codeVerifier: string | undefined = undefined\n      return {\n        get codeVerifierPKCE() {\n          if (codeVerifier) {\n            return codeVerifier\n          }\n          const global = getGlobalObject()\n          const array = new Uint8Array(32)\n          global.crypto.getRandomValues(array)\n          codeVerifier = fixup(Buffer.from(array).toString('base64'))\n          return codeVerifier\n        },\n      }\n    })\n    .views(self => ({\n      get authEndpoint(): string {\n        return getConf(self, 'authEndpoint')\n      },\n      get tokenEndpoint(): string {\n        return getConf(self, 'tokenEndpoint')\n      },\n      get needsPKCE(): boolean {\n        return getConf(self, 'needsPKCE')\n      },\n      get clientId(): string {\n        return getConf(self, 'clientId')\n      },\n      get scopes(): string {\n        return getConf(self, 'scopes')\n      },\n      get responseType(): 'token' | 'code' {\n        return getConf(self, 'responseType')\n      },\n      get hasRefreshToken(): boolean {\n        return getConf(self, 'hasRefreshToken')\n      },\n      get refreshTokenKey() {\n        return `${self.internetAccountId}-refreshToken`\n      },\n    }))\n    .actions(self => ({\n      storeRefreshToken(refreshToken: string) {\n        localStorage.setItem(self.refreshTokenKey, refreshToken)\n      },\n      removeRefreshToken() {\n        localStorage.removeItem(self.refreshTokenKey)\n      },\n      retrieveRefreshToken() {\n        return localStorage.getItem(self.refreshTokenKey)\n      },\n      async exchangeAuthorizationForAccessToken(\n        token: string,\n        redirectUri: string,\n      ): Promise<string> {\n        const data = {\n          code: token,\n          grant_type: 'authorization_code',\n          client_id: self.clientId,\n          code_verifier: self.codeVerifierPKCE,\n          redirect_uri: redirectUri,\n        }\n\n        const params = new URLSearchParams(Object.entries(data))\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Failed to obtain token from endpoint: ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n\n        const accessToken = await response.json()\n        if (accessToken.refresh_token) {\n          this.storeRefreshToken(accessToken.refresh_token)\n        }\n        return accessToken.access_token\n      },\n      async exchangeRefreshForAccessToken(\n        refreshToken: string,\n      ): Promise<string> {\n        const data = {\n          grant_type: 'refresh_token',\n          refresh_token: refreshToken,\n          client_id: self.clientId,\n        }\n\n        const params = new URLSearchParams(Object.entries(data))\n\n        const response = await fetch(self.tokenEndpoint, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n          body: params.toString(),\n        })\n\n        if (!response.ok) {\n          self.removeToken()\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Network response failure  ${response.status} (${\n              response.statusText\n            }) ${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n\n        const accessToken = await response.json()\n        return accessToken.access_token\n      },\n    }))\n    .actions(self => {\n      let listener: (event: MessageEvent) => void\n      return {\n        // used to listen to child window for auth code/token\n        addMessageChannel(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          listener = event => {\n            this.finishOAuthWindow(event, resolve, reject)\n          }\n          window.addEventListener('message', listener)\n        },\n        deleteMessageChannel() {\n          window.removeEventListener('message', listener)\n        },\n        async finishOAuthWindow(\n          event: MessageEvent,\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          if (\n            event.data.name !== `JBrowseAuthWindow-${self.internetAccountId}`\n          ) {\n            return this.deleteMessageChannel()\n          }\n          const redirectUriWithInfo = event.data.redirectUri\n          const fixedQueryString = redirectUriWithInfo.replace('#', '?')\n          const redirectUrl = new URL(fixedQueryString)\n          const queryStringSearch = redirectUrl.search\n          const urlParams = new URLSearchParams(queryStringSearch)\n          if (urlParams.has('access_token')) {\n            const token = urlParams.get('access_token')\n            if (!token) {\n              return reject(new Error('Error with token endpoint'))\n            }\n            self.storeToken(token)\n            return resolve(token)\n          }\n          if (urlParams.has('code')) {\n            const code = urlParams.get('code')\n            if (!code) {\n              return reject(new Error('Error with authorization endpoint'))\n            }\n            try {\n              const token = await self.exchangeAuthorizationForAccessToken(\n                code,\n                redirectUrl.origin + redirectUrl.pathname,\n              )\n              self.storeToken(token)\n              return resolve(token)\n            } catch (error) {\n              if (error instanceof Error) {\n                return reject(error)\n              } else {\n                return reject(new Error(String(error)))\n              }\n            }\n          }\n          if (redirectUriWithInfo.includes('access_denied')) {\n            return reject(new Error('OAuth flow was cancelled'))\n          }\n          if (redirectUriWithInfo.includes('error')) {\n            return reject(new Error('Oauth flow error: ' + queryStringSearch))\n          }\n          this.deleteMessageChannel()\n        },\n        // opens external OAuth flow, popup for web and new browser window for desktop\n        async useEndpointForAuthorization(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ) {\n          const redirectUri = isElectron\n            ? 'http://localhost/auth'\n            : window.location.origin + window.location.pathname\n          const data: OAuthData = {\n            client_id: self.clientId,\n            redirect_uri: redirectUri,\n            response_type: self.responseType || 'code',\n          }\n\n          if (self.scopes) {\n            data.scope = self.scopes\n          }\n\n          if (self.needsPKCE) {\n            const { codeVerifierPKCE } = self\n            const codeChallenge = fixup(\n              Base64.stringify(sha256(codeVerifierPKCE)),\n            )\n            data.code_challenge = codeChallenge\n            data.code_challenge_method = 'S256'\n          }\n\n          if (self.hasRefreshToken) {\n            data.token_access_type = 'offline'\n          }\n\n          const params = new URLSearchParams(Object.entries(data))\n\n          const url = new URL(self.authEndpoint)\n          url.search = params.toString()\n\n          const eventName = `JBrowseAuthWindow-${self.internetAccountId}`\n          if (isElectron) {\n            const { ipcRenderer } = window.require('electron')\n            const redirectUri = await ipcRenderer.invoke('openAuthWindow', {\n              internetAccountId: self.internetAccountId,\n              data,\n              url: url.toString(),\n            })\n\n            const eventFromDesktop = new MessageEvent('message', {\n              data: { name: eventName, redirectUri: redirectUri },\n            })\n            this.finishOAuthWindow(eventFromDesktop, resolve, reject)\n          } else {\n            const options = `width=500,height=600,left=0,top=0`\n            window.open(url, eventName, options)\n          }\n        },\n        async getTokenFromUser(\n          resolve: (token: string) => void,\n          reject: (error: Error) => void,\n        ): Promise<void> {\n          const refreshToken =\n            self.hasRefreshToken && self.retrieveRefreshToken()\n          if (refreshToken) {\n            resolve(await self.exchangeRefreshForAccessToken(refreshToken))\n          }\n          this.addMessageChannel(resolve, reject)\n          this.useEndpointForAuthorization(resolve, reject)\n        },\n      }\n    })\n}\n\nexport default stateModelFactory\nexport type OAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type OAuthModel = Instance<OAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst ExternalTokenConfigSchema = ConfigurationSchema(\n  'ExternalTokenInternetAccount',\n  {\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type ExternalTokenInternetAccountConfigModel =\n  typeof ExternalTokenConfigSchema\n\nexport type ExternalTokenInternetAccountConfig =\n  Instance<ExternalTokenInternetAccountConfigModel>\nexport default ExternalTokenConfigSchema\n","import React, { useState } from 'react'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport TextField from '@material-ui/core/TextField'\n\nexport const ExternalTokenEntryForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (token?: string) => void\n}) => {\n  const [token, setToken] = useState('')\n\n  return (\n    <>\n      <Dialog open maxWidth=\"xl\" data-testid=\"externalToken-form\">\n        <DialogTitle>Enter Token for {internetAccountId}</DialogTitle>\n        <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n          <TextField\n            required\n            label=\"Enter Token\"\n            variant=\"outlined\"\n            inputProps={{ 'data-testid': 'entry-externalToken' }}\n            onChange={event => {\n              setToken(event.target.value)\n            }}\n            margin=\"dense\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            disabled={!token}\n            onClick={() => {\n              if (token) {\n                handleClose(token)\n              }\n            }}\n          >\n            Add\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { ExternalTokenInternetAccountConfigModel } from './configSchema'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\nimport { ExternalTokenEntryForm } from './ExternalTokenEntryForm'\n\nconst stateModelFactory = (\n  configSchema: ExternalTokenInternetAccountConfigModel,\n) => {\n  return types\n    .compose(\n      'ExternalTokenInternetAccount',\n      InternetAccount,\n      types.model({\n        type: types.literal('ExternalTokenInternetAccount'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        const { session } = getRoot(self)\n        session.queueDialog((doneCallback: () => void) => [\n          ExternalTokenEntryForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Token could not be validated  ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type ExternalTokenStateModel = ReturnType<typeof stateModelFactory>\nexport type ExternalTokenModel = Instance<ExternalTokenStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport { BaseInternetAccountConfig } from '@jbrowse/core/pluggableElementTypes/models'\n\nconst HTTPBasicConfigSchema = ConfigurationSchema(\n  'HTTPBasicInternetAccount',\n  {\n    tokenType: {\n      description: 'a custom name for a token to include in the header',\n      type: 'string',\n      defaultValue: 'Basic',\n    },\n    validateWithHEAD: {\n      description: 'validate the token with a HEAD request before using it',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  {\n    baseConfiguration: BaseInternetAccountConfig,\n    explicitlyTyped: true,\n  },\n)\n\nexport type HTTPBasicInternetAccountConfigModel = typeof HTTPBasicConfigSchema\n\nexport type HTTPBasicInternetAccountConfig =\n  Instance<HTTPBasicInternetAccountConfigModel>\nexport default HTTPBasicConfigSchema\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogActions,\n  TextField,\n} from '@material-ui/core'\n\nexport const HTTPBasicLoginForm = ({\n  internetAccountId,\n  handleClose,\n}: {\n  internetAccountId: string\n  handleClose: (arg?: string) => void\n}) => {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n\n  function onSubmit(event: React.FormEvent<HTMLFormElement>) {\n    if (username && password) {\n      handleClose(btoa(`${username}:${password}`))\n    } else {\n      handleClose()\n    }\n    event.preventDefault()\n  }\n\n  return (\n    <>\n      <Dialog open maxWidth=\"xl\" data-testid=\"login-httpbasic\">\n        <DialogTitle>Log In for {internetAccountId}</DialogTitle>\n        <form onSubmit={onSubmit}>\n          <DialogContent style={{ display: 'flex', flexDirection: 'column' }}>\n            <TextField\n              required\n              label=\"Username\"\n              variant=\"outlined\"\n              inputProps={{ 'data-testid': 'login-httpbasic-username' }}\n              onChange={event => {\n                setUsername(event.target.value)\n              }}\n              margin=\"dense\"\n            />\n            <TextField\n              required\n              label=\"Password\"\n              type=\"password\"\n              autoComplete=\"current-password\"\n              variant=\"outlined\"\n              inputProps={{ 'data-testid': 'login-httpbasic-password' }}\n              onChange={event => {\n                setPassword(event.target.value)\n              }}\n              margin=\"dense\"\n            />\n          </DialogContent>\n          <DialogActions>\n            <Button variant=\"contained\" color=\"primary\" type=\"submit\">\n              Submit\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"default\"\n              type=\"submit\"\n              onClick={() => {\n                handleClose()\n              }}\n            >\n              Cancel\n            </Button>\n          </DialogActions>\n        </form>\n      </Dialog>\n    </>\n  )\n}\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { InternetAccount } from '@jbrowse/core/pluggableElementTypes/models'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { HTTPBasicInternetAccountConfigModel } from './configSchema'\nimport { Instance, types, getRoot } from 'mobx-state-tree'\n\nimport { HTTPBasicLoginForm } from './HTTPBasicLoginForm'\n\nconst stateModelFactory = (\n  configSchema: HTTPBasicInternetAccountConfigModel,\n) => {\n  return types\n    .compose(\n      'HTTPBasicInternetAccount',\n      InternetAccount,\n      types.model({\n        type: types.literal('HTTPBasicInternetAccount'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get validateWithHEAD(): boolean {\n        return getConf(self, 'validateWithHEAD')\n      },\n    }))\n    .actions(self => ({\n      getTokenFromUser(\n        resolve: (token: string) => void,\n        reject: (error: Error) => void,\n      ) {\n        const { session } = getRoot(self)\n        session.queueDialog((doneCallback: () => void) => [\n          HTTPBasicLoginForm,\n          {\n            internetAccountId: self.internetAccountId,\n            handleClose: (token: string) => {\n              if (token) {\n                resolve(token)\n              } else {\n                reject(new Error('user cancelled entry'))\n              }\n              doneCallback()\n            },\n          },\n        ])\n      },\n      async validateToken(token: string, location: UriLocation) {\n        if (!self.validateWithHEAD) {\n          return token\n        }\n        const newInit = self.addAuthHeaderToInit({ method: 'HEAD' }, token)\n        const response = await fetch(location.uri, newInit)\n        if (!response.ok) {\n          let errorMessage\n          try {\n            errorMessage = await response.text()\n          } catch (error) {\n            errorMessage = ''\n          }\n          throw new Error(\n            `Error validating token  ${response.status} (${\n              response.statusText\n            })${errorMessage ? ` (${errorMessage})` : ''}`,\n          )\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type HTTPBasicStateModel = ReturnType<typeof stateModelFactory>\nexport type HTTPBasicModel = Instance<HTTPBasicStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\nconst DropboxOAuthConfigSchema = ConfigurationSchema(\n  'DropboxOAuthInternetAccount',\n  {\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://www.dropbox.com/oauth2/authorize',\n    },\n    tokenEndpoint: {\n      description: 'the token endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://api.dropbox.com/oauth2/token',\n    },\n    needsPKCE: {\n      description: 'boolean to indicate if the endpoint needs a PKCE code',\n      type: 'boolean',\n      defaultValue: true,\n    },\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: [\n        'addtodropbox.com',\n        'db.tt',\n        'dropbox.com',\n        'dropboxapi.com',\n        'dropboxbusiness.com',\n        'dropbox.tech',\n        'getdropbox.com',\n      ],\n    },\n    hasRefreshToken: {\n      description: 'true if the endpoint can supply a refresh token',\n      type: 'boolean',\n      defaultValue: true,\n    },\n  },\n  { baseConfiguration: OAuthConfigSchema, explicitlyTyped: true },\n)\n\nexport type DropboxOAuthInternetAccountConfigModel =\n  typeof DropboxOAuthConfigSchema\n\nexport type DropboxOAuthInternetAccountConfig =\n  Instance<DropboxOAuthInternetAccountConfigModel>\nexport default DropboxOAuthConfigSchema\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { SvgIconProps, SvgIcon } from '@material-ui/core'\nimport { Instance, types } from 'mobx-state-tree'\nimport { DropboxOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\n\ninterface DropboxError {\n  error_summary: string\n  error: {\n    '.tag': string\n  }\n}\n\n/** Error messages from https://www.dropbox.com/developers/documentation/http/documentation#sharing-get_shared_link_file */\nconst dropboxErrorMessages: Record<string, string | undefined> = {\n  shared_link_not_found: \"The shared link wasn't found.\",\n  shared_link_access_denied:\n    'The caller is not allowed to access this shared link.',\n  unsupported_link_type:\n    'This type of link is not supported; use files/export instead.',\n  shared_link_is_directory: 'Directories cannot be retrieved by this endpoint.',\n}\n\nexport function DropboxIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z\" />\n    </SvgIcon>\n  )\n}\n\nasync function getDescriptiveErrorMessage(response: Response) {\n  let errorMessage\n  try {\n    errorMessage = await response.text()\n  } catch (error) {\n    errorMessage = ''\n  }\n  if (errorMessage) {\n    let errorMessageParsed: DropboxError | undefined\n    try {\n      errorMessageParsed = JSON.parse(errorMessage)\n    } catch (error) {\n      errorMessageParsed = undefined\n    }\n    if (errorMessageParsed) {\n      const messageTag = errorMessageParsed.error['.tag']\n      errorMessage = dropboxErrorMessages[messageTag] || messageTag\n    }\n  }\n  return `Network response failure  ${response.status} (${\n    response.statusText\n  })${errorMessage ? ` (${errorMessage})` : ''}`\n}\n\nconst stateModelFactory = (\n  configSchema: DropboxOAuthInternetAccountConfigModel,\n) => {\n  return types\n    .compose(\n      'DropboxOAuthInternetAccount',\n      baseModel(OAuthConfigSchema),\n      types.model({\n        type: types.literal('DropboxOAuthInternetAccount'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(() => ({\n      get toggleContents() {\n        return <DropboxIcon />\n      },\n      get selectorLabel() {\n        return 'Enter Dropbox share link'\n      },\n    }))\n    .actions(self => ({\n      getFetcher(\n        location?: UriLocation,\n      ): (input: RequestInfo, init?: RequestInit) => Promise<Response> {\n        return async (\n          input: RequestInfo,\n          init?: RequestInit,\n        ): Promise<Response> => {\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'POST' },\n            authToken,\n          )\n          newInit.headers.append(\n            'Dropbox-API-Arg',\n            JSON.stringify({ url: input }),\n          )\n          const response = await fetch(\n            'https://content.dropboxapi.com/2/sharing/get_shared_link_file',\n            newInit,\n          )\n          if (!response.ok) {\n            const message = await getDescriptiveErrorMessage(response)\n            throw new Error(message)\n          }\n          return response\n        }\n      },\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const response = await fetch(\n          'https://api.dropboxapi.com/2/sharing/get_shared_link_metadata',\n          {\n            method: 'POST',\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n              url: location.uri,\n            }),\n          },\n        )\n        if (!response.ok) {\n          const refreshToken =\n            self.hasRefreshToken && self.retrieveRefreshToken()\n          if (refreshToken) {\n            self.removeRefreshToken()\n            const newToken = await self.exchangeRefreshForAccessToken(\n              refreshToken,\n            )\n            return this.validateToken(newToken, location)\n          }\n          const message = await getDescriptiveErrorMessage(response)\n          throw new Error(`Token could not be validated. ${message}`)\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type DropboxOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type DropboxOAuthModel = Instance<DropboxOAuthStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport OAuthConfigSchema from '../OAuthModel/configSchema'\n\nconst GoogleDriveOAuthConfigSchema = ConfigurationSchema(\n  'GoogleDriveOAuthInternetAccount',\n  {\n    authEndpoint: {\n      description: 'the authorization code endpoint of the internet account',\n      type: 'string',\n      defaultValue: 'https://accounts.google.com/o/oauth2/v2/auth',\n    },\n    scopes: {\n      description: 'optional scopes for the authorization call',\n      type: 'string',\n      defaultValue: 'https://www.googleapis.com/auth/drive.readonly',\n    },\n    domains: {\n      description:\n        'array of valid domains the url can contain to use this account',\n      type: 'stringArray',\n      defaultValue: ['drive.google.com\"'],\n    },\n    responseType: {\n      description: 'the type of response from the authorization endpoint',\n      type: 'string',\n      defaultValue: 'token',\n    },\n  },\n  { baseConfiguration: OAuthConfigSchema, explicitlyTyped: true },\n)\n\nexport type GoogleDriveOAuthInternetAccountConfigModel =\n  typeof GoogleDriveOAuthConfigSchema\n\nexport type GoogleDriveOAuthInternetAccountConfig =\n  Instance<GoogleDriveOAuthInternetAccountConfigModel>\nexport default GoogleDriveOAuthConfigSchema\n","import React from 'react'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { Instance, types } from 'mobx-state-tree'\nimport { RemoteFileWithRangeCache } from '@jbrowse/core/util/io'\nimport { UriLocation } from '@jbrowse/core/util/types'\nimport { SvgIconProps, SvgIcon } from '@material-ui/core'\nimport {\n  FilehandleOptions,\n  Stats,\n  PolyfilledResponse,\n} from 'generic-filehandle'\nimport { GoogleDriveOAuthInternetAccountConfigModel } from './configSchema'\nimport baseModel from '../OAuthModel/model'\nimport { configSchema as OAuthConfigSchema } from '../OAuthModel'\n\ninterface RequestInitWithMetadata extends RequestInit {\n  metadataOnly?: boolean\n}\n\ninterface GoogleDriveFilehandleOptions extends FilehandleOptions {\n  fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse>\n}\n\ninterface GoogleDriveError {\n  error: {\n    errors: {\n      domain: string\n      reason: string\n      message: string\n      locationType?: string\n      location?: string\n    }[]\n    code: number\n    message: string\n  }\n}\n\nclass GoogleDriveFile extends RemoteFileWithRangeCache {\n  private statsPromise: Promise<{ size: number }>\n  constructor(source: string, opts: GoogleDriveFilehandleOptions) {\n    super(source, opts)\n    this.statsPromise = this.fetch(source, {\n      metadataOnly: true,\n    }).then((response: Response) => response.json())\n  }\n\n  async fetch(\n    input: RequestInfo,\n    opts?: RequestInitWithMetadata,\n  ): Promise<PolyfilledResponse> {\n    return super.fetch(input, opts)\n  }\n\n  async stat(): Promise<Stats> {\n    return this.statsPromise\n  }\n}\n\nfunction GoogleDriveIcon(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z\" />\n    </SvgIcon>\n  )\n}\n\nasync function getDescriptiveErrorMessage(response: Response) {\n  let errorMessage\n  try {\n    errorMessage = await response.text()\n  } catch (error) {\n    errorMessage = ''\n  }\n  if (errorMessage) {\n    let errorMessageParsed: GoogleDriveError | undefined\n    try {\n      errorMessageParsed = JSON.parse(errorMessage)\n    } catch (error) {\n      errorMessageParsed = undefined\n    }\n    if (errorMessageParsed) {\n      errorMessage = errorMessageParsed.error.message\n    }\n  }\n  return `Network response failure  ${response.status} (${\n    response.statusText\n  })${errorMessage ? ` (${errorMessage})` : ''}`\n}\n\nconst stateModelFactory = (\n  configSchema: GoogleDriveOAuthInternetAccountConfigModel,\n) => {\n  return types\n    .compose(\n      'GoogleDriveOAuthInternetAccount',\n      baseModel(OAuthConfigSchema),\n      types.model({\n        type: types.literal('GoogleDriveOAuthInternetAccount'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(() => ({\n      get toggleContents() {\n        return <GoogleDriveIcon />\n      },\n      get selectorLabel() {\n        return 'Enter Google Drive share link'\n      },\n    }))\n    .actions(self => ({\n      getFetcher(\n        location?: UriLocation,\n      ): (input: RequestInfo, init?: RequestInit) => Promise<Response> {\n        return async (\n          input: RequestInfo,\n          init?: RequestInitWithMetadata,\n        ): Promise<Response> => {\n          const urlId = String(input).match(/[-\\w]{25,}/)\n          const driveUrl = new URL(\n            `https://www.googleapis.com/drive/v3/files/${urlId}`,\n          )\n          const searchParams = new URLSearchParams()\n          if (init?.metadataOnly) {\n            searchParams.append('fields', 'size')\n          } else {\n            searchParams.append('alt', 'media')\n          }\n          driveUrl.search = searchParams.toString()\n          const authToken = await self.getToken(location)\n          const newInit = self.addAuthHeaderToInit(\n            { ...init, method: 'GET', credentials: 'same-origin' },\n            authToken,\n          )\n          const response = await fetch(driveUrl.toString(), newInit)\n          if (!response.ok) {\n            const message = await getDescriptiveErrorMessage(response)\n            throw new Error(message)\n          }\n          return response\n        }\n      },\n      openLocation(location: UriLocation) {\n        return new GoogleDriveFile(location.uri, {\n          fetch: this.getFetcher(location),\n        })\n      },\n      async validateToken(\n        token: string,\n        location: UriLocation,\n      ): Promise<string> {\n        const urlId = location.uri.match(/[-\\w]{25,}/)\n        const response = await fetch(\n          `https://www.googleapis.com/drive/v3/files/${urlId}`,\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n              'Content-Type': 'application/x-www-form-urlencoded',\n            },\n          },\n        )\n        if (!response.ok) {\n          const message = await getDescriptiveErrorMessage(response)\n          throw new Error(`Token could not be validated. ${message}`)\n        }\n        return token\n      },\n    }))\n}\n\nexport default stateModelFactory\nexport type GoogleDriveOAuthStateModel = ReturnType<typeof stateModelFactory>\nexport type GoogleDriveOAuthModel = Instance<GoogleDriveOAuthStateModel>\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport InternetAccountType from '@jbrowse/core/pluggableElementTypes/InternetAccountType'\nimport {\n  configSchema as OAuthConfigSchema,\n  modelFactory as OAuthInternetAccountModelFactory,\n} from './OAuthModel'\nimport {\n  configSchema as ExternalTokenConfigSchema,\n  modelFactory as ExternalTokenInternetAccountModelFactory,\n} from './ExternalTokenModel'\nimport {\n  configSchema as HTTPBasicConfigSchema,\n  modelFactory as HTTPBasicInternetAccountModelFactory,\n} from './HTTPBasicModel'\nimport {\n  configSchema as DropboxOAuthConfigSchema,\n  modelFactory as DropboxOAuthInternetAccountModelFactory,\n} from './DropboxOAuthModel'\nimport {\n  configSchema as GoogleDriveOAuthConfigSchema,\n  modelFactory as GoogleDriveOAuthInternetAccountModelFactory,\n} from './GoogleDriveOAuthModel'\n\nexport default class AuthenticationPlugin extends Plugin {\n  name = 'AuthenticationPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'OAuthInternetAccount',\n        configSchema: OAuthConfigSchema,\n        stateModel: OAuthInternetAccountModelFactory(OAuthConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'ExternalTokenInternetAccount',\n        configSchema: ExternalTokenConfigSchema,\n        stateModel: ExternalTokenInternetAccountModelFactory(\n          ExternalTokenConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'HTTPBasicInternetAccount',\n        configSchema: HTTPBasicConfigSchema,\n        stateModel: HTTPBasicInternetAccountModelFactory(HTTPBasicConfigSchema),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'DropboxOAuthInternetAccount',\n        configSchema: DropboxOAuthConfigSchema,\n        stateModel: DropboxOAuthInternetAccountModelFactory(\n          DropboxOAuthConfigSchema,\n        ),\n      })\n    })\n    pluginManager.addInternetAccountType(() => {\n      return new InternetAccountType({\n        name: 'GoogleDriveOAuthInternetAccount',\n        configSchema: GoogleDriveOAuthConfigSchema,\n        stateModel: GoogleDriveOAuthInternetAccountModelFactory(\n          GoogleDriveOAuthConfigSchema,\n        ),\n      })\n    })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigBedAdapter',\n  {\n    bigBedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bb', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'BedTabixAdapter',\n  {\n    bedGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n\n    index: ConfigurationSchema('TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.bed.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BedAdapter',\n  {\n    bedLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.bed.gz', locationType: 'UriLocation' },\n    },\n\n    columnNames: {\n      type: 'stringArray',\n      description: 'List of column names',\n      defaultValue: [],\n    },\n\n    scoreColumn: {\n      type: 'string',\n      description: 'The column to use as a \"score\" attribute',\n      defaultValue: '',\n    },\n\n    autoSql: {\n      type: 'string',\n      description: 'The autoSql definition for the data fields in the file',\n      defaultValue: '',\n    },\n    colRef: {\n      type: 'number',\n      description: 'The column to use as a \"refName\" attribute',\n      defaultValue: 0,\n    },\n    colStart: {\n      type: 'number',\n      description: 'The column to use as a \"start\" attribute',\n      defaultValue: 1,\n    },\n    colEnd: {\n      type: 'number',\n      description: 'The column to use as a \"end\" attribute',\n      defaultValue: 2,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema as bigBedAdapterConfigSchema } from './BigBedAdapter'\nimport { configSchema as bedTabixAdapterConfigSchema } from './BedTabixAdapter'\nimport { configSchema as bedAdapterConfigSchema } from './BedAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  getFileName,\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class BedPlugin extends Plugin {\n  name = 'BedPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigBedAdapter',\n          configSchema: bigBedAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BigBedAdapter/BigBedAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(bb|bigbed)$/i\n          const adapterName = 'BigBedAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigBedLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedTabixAdapter',\n          configSchema: bedTabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BedTabixAdapter/BedTabixAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BedAdapter',\n          configSchema: bedAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./BedAdapter/BedAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed\\.b?gz$/i\n          const adapterName = 'BedTabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedGzLocation: file,\n              index: {\n                location: index || makeIndex(file, '.tbi'),\n                indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n              },\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.bed$/i\n          const adapterName = 'BedAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bedLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nconst configSchema = ConfigurationSchema('BreakpointAlignmentsWidget', {})\n\nconst stateModel = types\n  .model('BreakpointAlignmentsWidget', {\n    id: ElementId,\n    type: types.literal('BreakpointAlignmentsWidget'),\n    featureData: types.frozen(),\n  })\n  .actions(self => ({\n    setFeatureData(data) {\n      self.featureData = data\n    },\n    clearFeatureData() {\n      self.featureData = undefined\n    },\n  }))\n\nexport { configSchema, stateModel }\n","import { useState, useEffect } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '@jbrowse/plugin-linear-genome-view'\nimport { clamp } from '@jbrowse/core/util'\nimport { LayoutRecord } from './model'\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nfunction cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: Instance<LinearGenomeViewStateModel>[],\n  trackConfigId: string,\n  level: number,\n) {\n  const track = views[level].trackRefs[trackConfigId]\n  return track?.getBoundingClientRect().top || 0\n}\n\nexport function getPxFromCoordinate(\n  view: Instance<LinearGenomeViewStateModel>,\n  refName: string,\n  coord: number,\n) {\n  return ((view.bpToPx({ refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n}\n\n// get's the yposition of a layout record in a track\nexport function yPos(\n  trackConfigId: string,\n  level: number,\n  views: Instance<LinearGenomeViewStateModel>[],\n  tracks: {\n    displays: [\n      {\n        height: number\n        scrollTop: number\n        SNPCoverageDisplay?: { height: number }\n        showCoverage?: boolean\n      },\n    ]\n  }[], // basic track requirements\n  c: LayoutRecord,\n) {\n  const display = tracks[level].displays[0]\n  const min = 0\n  const max = display.height\n  let offset = 0\n  const { showCoverage, SNPCoverageDisplay } = display\n  if (SNPCoverageDisplay && showCoverage) {\n    offset = SNPCoverageDisplay.height\n  }\n  return (\n    clamp(c[TOP] - display.scrollTop + cheight(c) / 2 + offset, min, max) +\n    heightFromSpecificLevel(views, trackConfigId, level) +\n    display.scrollTop\n  )\n}\n\n// we combo a useEffect and useState combo to force rerender on snap\n// changing. the setup of this being a useEffect+useState makes it\n// re-render once the useEffect is called, which is generally the\n// \"next frame\". If we removed the below use\nexport const useNextFrame = (variable: unknown) => {\n  const [, setNextFrameState] = useState<unknown>()\n  useEffect(() => {\n    setNextFrameState(variable)\n  }, [variable])\n}\n","import React, { useMemo, useState } from 'react'\nimport Path from 'svg-path-generator'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { getSession, Feature } from '@jbrowse/core/util'\n\n// locals\nimport { yPos, useNextFrame, getPxFromCoordinate } from '../util'\nimport { BreakpointViewModel } from '../model'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\n// this finds candidate alignment features, aimed at plotting split reads\n// from BAM/CRAM files\nfunction getBadlyPairedAlignments(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  // this finds candidate features that share the same name\n  for (const feature of features.values()) {\n    const flags = feature.get('flags')\n    const id = feature.id()\n    const unmapped = flags & 4\n    const correctlyPaired = flags & 2\n\n    if (!alreadySeen.has(id) && !correctlyPaired && !unmapped) {\n      const n = feature.get('name')\n      if (!candidates[n]) {\n        candidates[n] = []\n      }\n      candidates[n].push(feature)\n    }\n    alreadySeen.add(feature.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\n// this finds candidate alignment features, aimed at plotting split reads\n// from BAM/CRAM files\nfunction getMatchedAlignmentFeatures(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  // this finds candidate features that share the same name\n  for (const feature of features.values()) {\n    const id = feature.id()\n    const unmapped = feature.get('flags') & 4\n    if (!alreadySeen.has(id) && !unmapped) {\n      const n = feature.get('name')\n      if (!candidates[n]) {\n        candidates[n] = []\n      }\n      candidates[n].push(feature)\n    }\n    alreadySeen.add(feature.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\nfunction hasPairedReads(features: Map<string, Feature>) {\n  return [...features.values()].find(f => f.get('flags') & 64)\n}\n\nconst AlignmentConnections = observer(\n  ({\n    model,\n    trackId,\n    parentRef,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views, showIntraviewLinks } = model\n\n    const session = getSession(model)\n    const snap = getSnapshot(model)\n    const { assemblyManager } = session\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    useNextFrame(snap)\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const hasPaired = useMemo(\n      () => hasPairedReads(totalFeatures),\n      [totalFeatures],\n    )\n\n    const layoutMatches = useMemo(() => {\n      const features = hasPaired\n        ? getBadlyPairedAlignments(totalFeatures)\n        : getMatchedAlignmentFeatures(totalFeatures)\n      const layoutMatches = model.getMatchedFeaturesInLayout(trackId, features)\n      if (!hasPaired) {\n        layoutMatches.forEach(m => {\n          m.sort((a, b) => a.feature.get('clipPos') - b.feature.get('clipPos'))\n        })\n      }\n      return layoutMatches\n    }, [totalFeatures, trackId, hasPaired, model])\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n\n    let yOffset = 0\n    if (parentRef.current) {\n      const rect = parentRef.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n\n    if (!assembly) {\n      console.warn('Unable to read assembly')\n      return null\n    }\n\n    return (\n      <g\n        stroke=\"#333\"\n        fill=\"none\"\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom, just in series\n          // following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n\n            if (!c1 || !c2) {\n              console.warn('received null layout for a overlay feature')\n              return null\n            }\n\n            // disable rendering connections in a single level\n            if (!showIntraviewLinks && level1 === level2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n\n            const s1 = f1.get('strand')\n            const s2 = f2.get('strand')\n            const p1 = hasPaired\n              ? c1[s1 === -1 ? LEFT : RIGHT]\n              : c1[s1 === -1 ? LEFT : RIGHT]\n            const p2 = hasPaired\n              ? c2[s2 === -1 ? LEFT : RIGHT]\n              : c2[s2 === -1 ? RIGHT : LEFT]\n            const x1 = getPxFromCoordinate(views[level1], f1ref, p1)\n            const x2 = getPxFromCoordinate(views[level2], f2ref, p2)\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackId))\n\n            const y1 = yPos(trackId, level1, views, tracks, c1) - yOffset\n            const y2 = yPos(trackId, level2, views, tracks, c2) - yOffset\n\n            // possible todo: use totalCurveHeight to possibly make alternative\n            // squiggle if the S is too small\n            const path = Path()\n              .moveTo(x1, y1)\n              .curveTo(\n                x1 + 200 * f1.get('strand') * (reversed1 ? -1 : 1),\n                y1,\n                x2 -\n                  200 *\n                    f2.get('strand') *\n                    (reversed2 ? -1 : 1) *\n                    (hasPaired ? -1 : 1),\n                y2,\n                x2,\n                y2,\n              )\n              .end()\n            const id = `${f1.id()}-${f2.id()}`\n            ret.push(\n              <path\n                d={path}\n                key={id}\n                data-testid=\"r1\"\n                strokeWidth={mouseoverElt === id ? 5 : 1}\n                onClick={() => {\n                  const featureWidget = session.addWidget?.(\n                    'BreakpointAlignmentsWidget',\n                    'breakpointAlignments',\n                    {\n                      featureData: {\n                        feature1: (\n                          totalFeatures.get(f1.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                        feature2: (\n                          totalFeatures.get(f2.id()) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    },\n                  )\n                  session.showWidget?.(featureWidget)\n                }}\n                onMouseOver={() => setMouseoverElt(id)}\n                onMouseOut={() => setMouseoverElt(undefined)}\n              />,\n            )\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default AlignmentConnections\n","import React, { useState, useMemo } from 'react'\nimport Path from 'svg-path-generator'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { parseBreakend, Breakend } from '@gmod/vcf'\n\n// locals\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\nfunction findMatchingAlt(feat1: Feature, feat2: Feature) {\n  const alts = feat1.get('ALT') as string[] | undefined\n  if (alts) {\n    return Object.fromEntries(\n      alts\n        ?.map(alt => parseBreakend(alt))\n        .filter((f): f is Breakend => !!f)\n        .map(bnd => [bnd.MatePosition, bnd]),\n    )[`${feat2.get('refName')}:${feat2.get('start') + 1}`]\n  }\n  return undefined\n}\n\n// Returns paired BND features across multiple views by inspecting\n// the ALT field to get exact coordinate matches\nfunction getMatchedBreakendFeatures(features: Map<string, Feature>) {\n  const candidates: Record<string, Feature[]> = {}\n  const alreadySeen = new Set<string>()\n\n  for (const f of features.values()) {\n    if (!alreadySeen.has(f.id())) {\n      if (f.get('type') === 'breakend') {\n        const alts = f.get('ALT') as string[] | undefined\n        alts?.forEach(a => {\n          const cur = `${f.get('refName')}:${f.get('start') + 1}`\n          const bnd = parseBreakend(a)\n          if (bnd) {\n            if (!candidates[cur]) {\n              candidates[bnd.MatePosition] = [f]\n            } else {\n              candidates[cur].push(f)\n            }\n          }\n        })\n      }\n    }\n    alreadySeen.add(f.id())\n  }\n\n  return Object.values(candidates).filter(v => v.length > 1)\n}\n\nconst Breakends = observer(\n  ({\n    model,\n    trackId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const { assemblyManager } = session\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const layoutMatches = useMemo(\n      () =>\n        model.getMatchedFeaturesInLayout(\n          trackId,\n          getMatchedBreakendFeatures(totalFeatures),\n        ),\n      [totalFeatures, trackId, model],\n    )\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n\n    if (!assembly) {\n      return null\n    }\n\n    let yoff = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yoff = rect.top\n    }\n\n    return (\n      <g\n        stroke=\"green\"\n        strokeWidth={5}\n        fill=\"none\"\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          const ret = []\n          // we follow a path in the list of chunks, not from top to bottom, just\n          // in series following x1,y1 -> x2,y2\n          for (let i = 0; i < chunk.length - 1; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const { layout: c2, feature: f2, level: level2 } = chunk[i + 1]\n            const id = f1.id()\n\n            const relevantAlt = findMatchingAlt(f1, f2)\n            if (!c1 || !c2) {\n              return null\n            }\n            const f1origref = f1.get('refName')\n            const f2origref = f2.get('refName')\n            const f1ref = assembly.getCanonicalRefName(f1origref)\n            const f2ref = assembly.getCanonicalRefName(f2origref)\n            if (!f1ref || !f2ref) {\n              throw new Error(`unable to find ref for ${f1ref || f2ref}`)\n            }\n            const x1 = getPxFromCoordinate(views[level1], f1ref, c1[LEFT])\n            const x2 = getPxFromCoordinate(views[level2], f2ref, c2[LEFT])\n            const reversed1 = views[level1].pxToBp(x1).reversed\n            const reversed2 = views[level2].pxToBp(x2).reversed\n\n            const tracks = views.map(v => v.getTrack(trackId))\n            const y1 = yPos(trackId, level1, views, tracks, c1) - yoff\n            const y2 = yPos(trackId, level2, views, tracks, c2) - yoff\n            if (!relevantAlt) {\n              console.warn(\n                'the relevant ALT allele was not found, cannot render',\n              )\n            } else {\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 *\n                      (relevantAlt.Join === 'left' ? -1 : 1) *\n                      (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (relevantAlt.MateDirection === 'left' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: totalFeatures.get(id)?.toJSON(),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Breakends\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { IconButton, makeStyles } from '@material-ui/core'\n\n// icons\nimport LocationSearching from '@material-ui/icons/LocationSearching'\nimport LocationDisabled from '@material-ui/icons/LocationDisabled'\nimport LeakAdd from '@material-ui/icons/LeakAdd'\nimport LeakRemove from '@material-ui/icons/LeakRemove'\nimport LinkIcon from '@material-ui/icons/Link'\nimport LinkOffIcon from '@material-ui/icons/LinkOff'\n\nimport { BreakpointViewModel } from '../model'\n\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    gridArea: '1/1/auto/span 2',\n    display: 'flex',\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n}))\n\nconst InteractWithSquiggles = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    return (\n      <IconButton\n        onClick={() => model.toggleInteract()}\n        title=\"Toggle interacting with the overlay\"\n      >\n        {model.interactToggled ? <LocationSearching /> : <LocationDisabled />}\n      </IconButton>\n    )\n  },\n)\n\nconst LinkViews = observer(({ model }: { model: BreakpointViewModel }) => {\n  return (\n    <IconButton\n      onClick={() => model.toggleLinkViews()}\n      title=\"Toggle linked scrolls and behavior across views\"\n    >\n      {model.linkViews ? (\n        <LinkIcon color=\"secondary\" />\n      ) : (\n        <LinkOffIcon color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Sync = observer(({ model }: { model: BreakpointViewModel }) => {\n  return (\n    <IconButton\n      onClick={model.toggleIntraviewLinks}\n      title=\"Toggle rendering intraview links\"\n    >\n      {model.showIntraviewLinks ? (\n        <LeakAdd color=\"secondary\" />\n      ) : (\n        <LeakRemove color=\"secondary\" />\n      )}\n    </IconButton>\n  )\n})\n\nconst Header = observer(({ model }: { model: BreakpointViewModel }) => {\n  const classes = useStyles()\n\n  return (\n    <div className={classes.headerBar}>\n      <LinkViews model={model} />\n      <InteractWithSquiggles model={model} />\n      <Sync model={model} />\n\n      <div className={classes.spacer} />\n    </div>\n  )\n})\n\nexport default Header\n","import React, { useState, useMemo } from 'react'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport { getSnapshot } from 'mobx-state-tree'\nimport Path from 'svg-path-generator'\n\n// locals\nimport { yPos, getPxFromCoordinate, useNextFrame } from '../util'\nimport { BreakpointViewModel, LayoutRecord } from '../model'\n\nconst [LEFT] = [0, 1, 2, 3]\n\n// Getting \"matched\" TRA means just return all TRA\nfunction getMatchedTranslocationFeatures(features: Map<string, Feature>) {\n  const feats: Feature[][] = []\n  const alreadySeen = new Set<string>()\n\n  for (const f of features.values()) {\n    if (!alreadySeen.has(f.id())) {\n      if (f.get('ALT')[0] === '<TRA>') {\n        feats.push([f])\n      }\n    }\n    alreadySeen.add(f.id())\n  }\n\n  return feats\n}\n\nconst Translocations = observer(\n  ({\n    model,\n    trackId,\n    parentRef: ref,\n  }: {\n    model: BreakpointViewModel\n    trackId: string\n    parentRef: React.RefObject<SVGSVGElement>\n  }) => {\n    const { views } = model\n    const session = getSession(model)\n    const { assemblyManager } = session\n    const totalFeatures = model.getTrackFeatures(trackId)\n    const layoutMatches = useMemo(\n      () =>\n        model.getMatchedFeaturesInLayout(\n          trackId,\n          getMatchedTranslocationFeatures(totalFeatures),\n        ),\n\n      [totalFeatures, trackId, model],\n    )\n\n    const [mouseoverElt, setMouseoverElt] = useState<string>()\n    const snap = getSnapshot(model)\n    useNextFrame(snap)\n\n    const assembly = assemblyManager.get(views[0].assemblyNames[0])\n    if (!assembly) {\n      console.warn('Unable to read assembly')\n      return null\n    }\n\n    let yOffset = 0\n    if (ref.current) {\n      const rect = ref.current.getBoundingClientRect()\n      yOffset = rect.top\n    }\n\n    // we hardcode the TRA to go to the \"other view\" and if there is none, we\n    // just return null here note: would need to do processing of the INFO\n    // CHR2/END and see which view could contain those coordinates to really\n    // do it properly\n    if (views.length < 2) {\n      return null\n    }\n    return (\n      <g\n        fill=\"none\"\n        stroke=\"green\"\n        strokeWidth={5}\n        data-testid={layoutMatches.length ? `${trackId}-loaded` : trackId}\n      >\n        {layoutMatches.map(chunk => {\n          // we follow a path in the list of chunks, not from top to bottom,\n          // just in series following x1,y1 -> x2,y2\n          const ret = []\n          for (let i = 0; i < chunk.length; i += 1) {\n            const { layout: c1, feature: f1, level: level1 } = chunk[i]\n            const level2 = level1 === 0 ? 1 : 0\n            const id = f1.id()\n            if (!c1) {\n              return null\n            }\n\n            const info = f1.get('INFO')\n            const chr2 = info.CHR2[0]\n            const end2 = info.END[0]\n            const [myDirection, mateDirection] = info.STRANDS[0].split('')\n\n            const r = getPxFromCoordinate(views[level2], chr2, end2)\n            if (r) {\n              const c2: LayoutRecord = [r, 0, r + 1, 0]\n\n              const x1 = getPxFromCoordinate(\n                views[level1],\n                f1.get('refName'),\n                c1[LEFT],\n              )\n              const x2 = r\n              const reversed1 = views[level1].pxToBp(x1).reversed\n              const reversed2 = views[level2].pxToBp(x2).reversed\n\n              const tracks = views.map(v => v.getTrack(trackId))\n              const y1 = yPos(trackId, level1, views, tracks, c1) - yOffset\n              const y2 = yPos(trackId, level2, views, tracks, c2) - yOffset\n\n              const path = Path()\n                .moveTo(\n                  x1 -\n                    20 * (myDirection === '+' ? 1 : -1) * (reversed1 ? -1 : 1),\n                  y1,\n                )\n                .lineTo(x1, y1)\n                .lineTo(x2, y2)\n                .lineTo(\n                  x2 -\n                    20 *\n                      (mateDirection === '+' ? 1 : -1) *\n                      (reversed2 ? -1 : 1),\n                  y2,\n                )\n                .end()\n              ret.push(\n                <path\n                  d={path}\n                  key={JSON.stringify(path)}\n                  strokeWidth={id === mouseoverElt ? 10 : 5}\n                  onClick={() => {\n                    const featureWidget = session.addWidget?.(\n                      'VariantFeatureWidget',\n                      'variantFeature',\n                      {\n                        featureData: (\n                          totalFeatures.get(id) || { toJSON: () => {} }\n                        ).toJSON(),\n                      },\n                    )\n                    session.showWidget?.(featureWidget)\n                  }}\n                  onMouseOver={() => setMouseoverElt(id)}\n                  onMouseOut={() => setMouseoverElt(undefined)}\n                />,\n              )\n            }\n          }\n          return ret\n        })}\n      </g>\n    )\n  },\n)\n\nexport default Translocations\n","import React, { useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\nimport { makeStyles } from '@material-ui/core'\n\n// locals\nimport { BreakpointViewModel } from '../model'\nimport AlignmentConnections from './AlignmentConnections'\nimport Breakends from './Breakends'\nimport Header from './Header'\nimport Translocations from './Translocations'\n\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      position: 'relative',\n      marginBottom: theme.spacing(1),\n      overflow: 'hidden',\n    },\n    breakpointMarker: {\n      position: 'absolute',\n      top: 0,\n      height: '100%',\n      width: 3,\n      background: 'magenta',\n    },\n    viewDivider: {\n      background: theme.palette.secondary.main,\n      height: 3,\n    },\n    container: {\n      display: 'grid',\n    },\n    overlay: {\n      display: 'flex',\n      width: '100%',\n      gridArea: '1/1',\n      '& path': {\n        cursor: 'crosshair',\n        fill: 'none',\n      },\n    },\n    content: {\n      gridArea: '1/1',\n    },\n  }\n})\n\nconst Overlay = observer(\n  (props: {\n    parentRef: React.RefObject<SVGSVGElement>\n    model: BreakpointViewModel\n    trackId: string\n  }) => {\n    const { model, trackId } = props\n    const tracks = model.getMatchedTracks(trackId)\n    if (\n      tracks[0]?.type === 'PileupTrack' ||\n      tracks[0]?.type === 'AlignmentsTrack'\n    ) {\n      return <AlignmentConnections {...props} />\n    }\n    if (tracks[0]?.type === 'VariantTrack') {\n      return model.hasTranslocations(trackId) ? (\n        <Translocations {...props} />\n      ) : (\n        <Breakends {...props} />\n      )\n    }\n    return null\n  },\n)\n\nconst BreakpointSplitView = observer(\n  ({ model }: { model: BreakpointViewModel }) => {\n    const classes = useStyles()\n    const { views } = model\n    const { pluginManager } = getEnv(model)\n    const ref = useRef(null)\n\n    return (\n      <div>\n        <Header model={model} />\n        <div className={classes.container}>\n          <div className={classes.content}>\n            <div style={{ position: 'relative' }}>\n              {views.map((view, idx) => {\n                const { ReactComponent } = pluginManager.getViewType(view.type)\n                const viewComponent = (\n                  <ReactComponent key={view.id} model={view} />\n                )\n                if (idx === views.length - 1) {\n                  return viewComponent\n                }\n                return [\n                  viewComponent,\n                  <div\n                    key={`${view.id}-divider`}\n                    className={classes.viewDivider}\n                  />,\n                ]\n              })}\n            </div>\n          </div>\n          <div className={classes.overlay}>\n            <svg\n              ref={ref}\n              style={{\n                width: '100%',\n                zIndex: 10,\n                pointerEvents: model.interactToggled ? undefined : 'none',\n              }}\n            >\n              {model.matchedTracks.map(track => {\n                // note: we must pass ref down, because the child component\n                // needs to getBoundingClientRect on the this components SVG,\n                // and we cannot rely on using getBoundingClientRect in this\n                // component to make sure this works because if it gets\n                // shifted around by another element, this will not re-render\n                // necessarily\n                return (\n                  <Overlay\n                    parentRef={ref}\n                    key={track.configuration.trackId}\n                    model={model}\n                    trackId={track.configuration.trackId}\n                  />\n                )\n              })}\n            </svg>\n          </div>\n        </div>\n      </div>\n    )\n  },\n)\n\nexport default BreakpointSplitView\n","import {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  types,\n  getParent,\n  onAction,\n  addDisposer,\n  getPath,\n  Instance,\n} from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession, Feature } from '@jbrowse/core/util'\nimport { AnyConfigurationModel, getConf } from '@jbrowse/core/configuration'\nimport { autorun } from 'mobx'\n\n// https://stackoverflow.com/a/49186706/2129219 the array-intersection package\n// on npm has a large kb size, and we are just intersecting open track ids so\n// simple is better\nfunction intersect<T>(\n  cb: (l: T) => string,\n  a1: T[] = [],\n  a2: T[] = [],\n  ...rest: T[][]\n): T[] {\n  const ids = a2.map(elt => cb(elt))\n  const a12 = a1.filter(value => ids.includes(cb(value)))\n  return rest.length === 0 ? a12 : intersect(cb, a12, ...rest)\n}\n\nexport interface Breakend {\n  MateDirection: string\n  Join: string\n  Replacement: string\n  MatePosition: string\n}\n\nexport type LayoutRecord = [number, number, number, number]\n\nasync function getBlockFeatures(\n  model: BreakpointViewModel,\n  track: { configuration: AnyConfigurationModel },\n) {\n  const { views } = model\n  const { rpcManager, assemblyManager } = getSession(model)\n  const assemblyName = model.views[0].assemblyNames[0]\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  if (!assembly) {\n    return undefined // throw new Error(`assembly not found: \"${assemblyName}\"`)\n  }\n  const sessionId = track.configuration.trackId\n  return Promise.all(\n    views.map(async view =>\n      (\n        (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n          adapterConfig: getConf(track, ['adapter']),\n          sessionId,\n          regions: view.staticBlocks.contentBlocks,\n        })) as Feature[][]\n      ).flat(),\n    ),\n  )\n}\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const minHeight = 40\n  const defaultHeight = 400\n  const model = types\n    .model('BreakpointSplitView', {\n      type: types.literal('BreakpointSplitView'),\n      height: types.optional(\n        types.refinement(\n          'viewHeight',\n          types.number,\n          (n: number) => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n      trackSelectorType: 'hierarchical',\n      showIntraviewLinks: true,\n      linkViews: false,\n      interactToggled: false,\n      views: types.array(\n        pluginManager.getViewType('LinearGenomeView')\n          .stateModel as LinearGenomeViewStateModel,\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n      matchedTrackFeatures: {} as { [key: string]: Feature[][] },\n    }))\n    .views(self => ({\n      // Find all track ids that match across multiple views\n      get matchedTracks() {\n        return intersect(\n          elt => elt.configuration.trackId as string,\n          ...self.views.map(view => view.tracks),\n        )\n      },\n\n      menuItems() {\n        self.views\n          .map((view, idx) => [idx, view.menuItems?.()])\n          .filter(f => !!f[1])\n          .map(f => ({ label: `View ${f[0]} Menu`, subMenu: f[1] }))\n      },\n\n      // Get tracks with a given trackId across multiple views\n      getMatchedTracks(trackConfigId: string) {\n        return self.views\n          .map(view => view.getTrack(trackConfigId))\n          .filter(f => !!f)\n      },\n\n      // Translocation features are handled differently\n      // since they do not have a mate e.g. they are one sided\n      hasTranslocations(trackConfigId: string) {\n        return [...this.getTrackFeatures(trackConfigId).values()].find(\n          f => f.get('type') === 'translocation',\n        )\n      },\n\n      // Get a composite map of featureId->feature map for a track across\n      // multiple views\n      getTrackFeatures(trackConfigId: string) {\n        return new Map(\n          self.matchedTrackFeatures[trackConfigId]\n            ?.flat()\n            .map(f => [f.id(), f]),\n        )\n      },\n\n      getMatchedFeaturesInLayout(trackConfigId: string, features: Feature[][]) {\n        // use reverse to search the second track first\n        const tracks = this.getMatchedTracks(trackConfigId)\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const calc = (track: any, feat: Feature) => {\n          return track.displays[0].searchFeatureByID(feat.id())\n        }\n\n        return features.map(c =>\n          c\n            .map(feature => {\n              const level = tracks.findIndex(track => calc(track, feature))\n              if (level !== -1) {\n                const layout = calc(tracks[level], feature)\n                return {\n                  feature,\n                  layout,\n                  level,\n                }\n              }\n              return undefined\n            })\n            .filter(\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              (f): f is { feature: Feature; layout: any; level: number } => !!f,\n            ),\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(\n            self,\n            ({\n              name,\n              path,\n              args,\n            }: {\n              name: string\n              path?: string\n              args?: unknown[]\n            }) => {\n              if (self.linkViews) {\n                const actions = [\n                  'horizontalScroll',\n                  'zoomTo',\n                  'setScaleFactor',\n                  'showTrack',\n                  'toggleTrack',\n                  'hideTrack',\n                  'setTrackLabels',\n                  'toggleCenterLine',\n                ]\n                if (actions.includes(name) && path) {\n                  this.onSubviewAction(name, path, args)\n                }\n              }\n            },\n          ),\n        )\n      },\n\n      onSubviewAction(actionName: string, path: string, args?: unknown[]) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args?.[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n        self.views.forEach(v => v.setWidth(newWidth))\n      },\n\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      toggleInteract() {\n        self.interactToggled = !self.interactToggled\n      },\n      toggleIntraviewLinks() {\n        self.showIntraviewLinks = !self.showIntraviewLinks\n      },\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n      setMatchedTrackFeatures(obj: { [key: string]: Feature[][] }) {\n        self.matchedTrackFeatures = obj\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(async () => {\n            const res = Object.fromEntries(\n              await Promise.all(\n                self.matchedTracks.map(async track => [\n                  track.configuration.trackId,\n                  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                  await getBlockFeatures(self as any, track),\n                ]),\n              ),\n            )\n            self.setMatchedTrackFeatures(res)\n          }),\n        )\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n\nexport type BreakpointView = ReturnType<typeof stateModelFactory>\nexport type BreakpointViewStateModel = BreakpointView['stateModel']\nexport type BreakpointViewModel = Instance<BreakpointViewStateModel>\n","import { getSession, Feature } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { parseBreakend } from '@gmod/vcf'\n\n// locals\nimport BreakpointSplitViewComponent from './components/BreakpointSplitView'\nimport BreakpointSplitViewModel from './model'\n\nclass BreakpointSplitViewType extends ViewType {\n  snapshotFromBreakendFeature(feature: Feature, view: LinearGenomeViewModel) {\n    const alt = feature.get('ALT')?.[0]\n    const bnd = alt ? parseBreakend(alt) : undefined\n    const startPos = feature.get('start')\n    let endPos\n    const bpPerPx = 10\n\n    // TODO: Figure this out for multiple assembly names\n    const { assemblyName } = view.displayedRegions[0]\n    const { assemblyManager } = getSession(view)\n    const assembly = assemblyManager.get(assemblyName)\n\n    if (!assembly) {\n      throw new Error(`assembly ${assemblyName} not found`)\n    }\n    if (!assembly.regions) {\n      throw new Error(`assembly ${assemblyName} regions not loaded`)\n    }\n    const { getCanonicalRefName } = assembly as Assembly\n    const featureRefName = getCanonicalRefName(feature.get('refName'))\n    const topRegion = assembly.regions.find(f => f.refName === featureRefName)\n\n    let mateRefName: string | undefined\n    let startMod = 0\n    let endMod = 0\n\n    // a VCF breakend feature\n    if (alt === '<TRA>') {\n      const INFO = feature.get('INFO')\n      endPos = INFO.END[0] - 1\n      mateRefName = getCanonicalRefName(INFO.CHR2[0])\n    } else if (bnd) {\n      const matePosition = bnd.MatePosition.split(':')\n      endPos = +matePosition[1] - 1\n      mateRefName = getCanonicalRefName(matePosition[0])\n      if (bnd.Join === 'left') {\n        startMod = -1\n      }\n      if (bnd.MateDirection === 'left') {\n        endMod = -1\n      }\n    } else if (feature.get('mate')) {\n      // a generic 'mate' feature\n      const mate = feature.get('mate')\n      mateRefName = getCanonicalRefName(mate.refName)\n      endPos = mate.start\n    }\n\n    if (!mateRefName) {\n      console.warn(\n        `unable to resolve mate refName ${mateRefName} in reference genome`,\n      )\n      return {}\n    }\n\n    const bottomRegion = assembly.regions.find(f => f.refName === mateRefName)\n\n    if (!topRegion || !bottomRegion) {\n      console.warn(\n        `unable to find the refName for the top or bottom of the breakpoint view`,\n      )\n      return {}\n    }\n\n    const topMarkedRegion = [{ ...topRegion }, { ...topRegion }]\n    const bottomMarkedRegion = [{ ...bottomRegion }, { ...bottomRegion }]\n    topMarkedRegion[0].end = startPos + startMod\n    topMarkedRegion[1].start = startPos + startMod\n    bottomMarkedRegion[0].end = endPos + endMod\n    bottomMarkedRegion[1].start = endPos + endMod\n    const snapshot = {\n      type: 'BreakpointSplitView',\n      views: [\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: topMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (topRegion.start + feature.get('start')) / bpPerPx,\n        },\n        {\n          type: 'LinearGenomeView',\n          displayedRegions: bottomMarkedRegion,\n          hideHeader: true,\n          bpPerPx,\n          offsetPx: (bottomRegion.start + endPos) / bpPerPx,\n        },\n      ],\n      displayName: `${\n        feature.get('name') || feature.get('id') || 'breakend'\n      } split detail`,\n    }\n    return snapshot\n  }\n}\n\nexport default (pluginManager: PluginManager) => {\n  const { load } = pluginManager\n\n  const { stateModel } = load(BreakpointSplitViewModel)\n\n  return new BreakpointSplitViewType({\n    name: 'BreakpointSplitView',\n    stateModel,\n    ReactComponent: BreakpointSplitViewComponent,\n  })\n}\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  configSchema as alignmentsFeatureDetailConfigSchema,\n  stateModel as alignmentsFeatureDetailStateModel,\n} from './BreakpointAlignmentsFeatureDetail'\nimport BreakpointSplitViewFactory from './BreakpointSplitView'\n\nexport default class BreakpointSplitViewPlugin extends Plugin {\n  name = 'BreakpointSplitViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(BreakpointSplitViewFactory),\n    )\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'BreakpointAlignmentsWidget',\n          heading: 'Breakpoint feature details',\n          configSchema: alignmentsFeatureDetailConfigSchema,\n          stateModel: alignmentsFeatureDetailStateModel,\n          ReactComponent: lazy(\n            () =>\n              import(\n                './BreakpointAlignmentsFeatureDetail/BreakpointAlignmentsFeatureDetail'\n              ),\n          ),\n        }),\n    )\n  }\n\n  configure() {}\n}\n","function findCircleIntersectionX(\n  y: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(y - cy)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([cx, y])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([cx - solution, y])\n  resultArray.push([cx + solution, y])\n}\n\nfunction findCircleIntersectionY(\n  x: number,\n  cx: number,\n  cy: number,\n  r: number,\n  resultArray: [number, number][],\n) {\n  const d = Math.abs(x - cx)\n  if (d > r) {\n    return\n  }\n  if (d === r) {\n    resultArray.push([x, cy])\n  }\n  const solution = Math.sqrt(r * r - d * d)\n  resultArray.push([x, cy - solution])\n  resultArray.push([x, cy + solution])\n}\n\nfunction cartesianToTheta(x: number, y: number) {\n  let theta = (Math.atan(y / x) + 2 * Math.PI) % (2 * Math.PI)\n  if (x < 0) {\n    if (y <= 0) {\n      theta += Math.PI\n    } else {\n      theta -= Math.PI\n    }\n  }\n  return theta\n}\n\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  if (rho === 0) {\n    return [0, 0]\n  }\n  const theta = cartesianToTheta(x, y)\n  return [rho, theta]\n}\n\nconst twoPi = 2 * Math.PI\nexport function thetaRangesOverlap(\n  r1start: number,\n  r1length: number,\n  r2start: number,\n  r2length: number,\n) {\n  if (r1length <= 0 || r2length <= 0) {\n    return false\n  }\n  if (r1length + 0.0001 >= twoPi || r2length + 0.0001 >= twoPi) {\n    return true\n  }\n\n  // put both range starts between 2 and 4\n  r1start = (((r1start % twoPi) + twoPi) % twoPi) + twoPi\n  r2start = (((r2start % twoPi) + twoPi) % twoPi) + twoPi\n\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move r2 2 to the left and check\n  r2start -= twoPi\n  if (r1start < r2start + r2length && r1start + r1length > r2start) {\n    return true\n  }\n\n  // move it 2 to the right and check\n  r2start += twoPi + twoPi\n  return r1start < r2start + r2length && r1start + r1length > r2start\n}\n\n// return which arc range has any part of the circle visible in the viewport\nexport function viewportVisibleSection(\n  viewSides: [number, number, number, number],\n  circleCenter: [number, number],\n  circleRadius: number,\n) {\n  let [viewL, viewR, viewT, viewB] = viewSides\n  const [cx, cy] = circleCenter\n\n  // transform coordinate system to center of circle\n  viewL -= cx\n  viewR -= cx\n  viewT -= cy\n  viewB -= cy\n\n  const centerIsInsideViewport =\n    viewL < 0 && viewR > 0 && viewT < 0 && viewB > 0\n\n  if (centerIsInsideViewport) {\n    const vertices = [\n      [viewL, viewT],\n      [viewR, viewT],\n      [viewL, viewB],\n      [viewR, viewB],\n    ]\n    let maxRho = -Infinity\n    for (let i = 0; i < vertices.length; i += 1) {\n      const [x, y] = vertices[i]\n      const rho = Math.sqrt(x * x + y * y)\n      if (rho > maxRho) {\n        maxRho = rho\n      }\n    }\n    return {\n      rho: [0, Math.min(circleRadius, maxRho)],\n      theta: [0, 2 * Math.PI],\n    }\n  }\n  // const viewportCompletelyContainsCircle =\n  //   circleCenter[0] - viewL >= circleRadius &&\n  //   viewR - circleCenter[0] >= circleRadius &&\n  //   circleCenter[1] - viewT >= circleRadius &&\n  //   viewB - circleCenter[1] >= circleRadius\n\n  // if (viewportCompletelyContainsCircle) {\n  //   return [0, 2 * Math.PI]\n  // }\n\n  // const distToCenterSquared = ([x, y]) => {\n  //   const [cx, cy] = circleCenter\n  //   const sq = n => n * n\n  //   return sq(x - cx) + sq(y - cy)\n  // }\n  // const circleRadiusSquared = circleRadius * circleRadius\n\n  // const tlInside = distToCenterSquared([viewL, viewT]) <= circleRadiusSquared\n  // const trInside = distToCenterSquared([viewR, viewT]) <= circleRadiusSquared\n  // const blInside = distToCenterSquared([viewL, viewB]) <= circleRadiusSquared\n  // const brInside = distToCenterSquared([viewR, viewB]) <= circleRadiusSquared\n\n  // const noIntersection = !tlInside && !trInside && !blInside && !brInside\n  // if (noIntersection) return undefined\n\n  // const circleCompletelyContainsViewport =\n  //   tlInside && trInside && blInside && brInside\n  // if (circleCompletelyContainsViewport) {\n  //   // viewport is in the circle, but the center is not in it, so take max\n  //   // and min of thetas to the center\n  //   const thetas = [\n  //     Math.atan(viewT / viewL),\n  //     Math.atan(viewT / viewR),\n  //     Math.atan(viewB / viewL),\n  //     Math.atan(viewB / viewR),\n  //   ]\n\n  //   return [Math.min(...thetas), Math.max(...thetas)]\n  // }\n\n  // if we get here, the viewport is partly in, partly out of the circle\n\n  // const viewLIntersects = Math.abs(viewL - circleCenter[0]) <= circleRadius\n  // const viewRIntersects = Math.abs(viewR - circleCenter[0]) <= circleRadius\n  // const viewTIntersects = Math.abs(viewT - circleCenter[1]) <= circleRadius\n  // const viewBIntersects = Math.abs(viewB - circleCenter[1]) <= circleRadius\n\n  // const numIntersectingSides =\n  //   Number(viewLIntersects) +\n  //   Number(viewRIntersects) +\n  //   Number(viewTIntersects) +\n  //   Number(viewBIntersects)\n\n  // if (numIntersectingSides === 4) return [0, 2 * Math.PI]\n  // if (numIntersectingSides === 3) {\n  //   // TODO calculate the thetas of the\n  // } else if (numIntersectingSides === 2) {\n  //   // TODO calculate the thetas of the 2 intersection points\n  // } else if (numIntersectingSides === 1) {\n  //   // TODO calculate the thetas of the 1-2 intersection points of the line, and the angle between\n  // }\n\n  // make a list of vertices-of-interest that lie inside both shapes to examine\n  // to determine the range covered by their intersection\n\n  // transform coordinates to have the circle as the origin and find the intersections\n  // of the circle and the view rectangle\n  const vertices: [number, number][] = [\n    [viewL, viewT],\n    [viewR, viewT],\n    [viewL, viewB],\n    [viewR, viewB],\n  ]\n  findCircleIntersectionY(viewL, 0, 0, circleRadius, vertices)\n  findCircleIntersectionY(viewR, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewT, 0, 0, circleRadius, vertices)\n  findCircleIntersectionX(viewB, 0, 0, circleRadius, vertices)\n\n  // for each edge, also look at the closest point to center if it is inside the circle\n  if (-viewL < circleRadius) {\n    vertices.push([viewL, 0])\n  }\n  if (viewR < circleRadius) {\n    vertices.push([viewR, 0])\n  }\n  if (-viewT < circleRadius) {\n    vertices.push([0, viewT])\n  }\n  if (viewB < circleRadius) {\n    vertices.push([0, viewB])\n  }\n\n  // const verticesOriginal = vertices.map(([x, y]) => [x + cx, y + cy])\n\n  // now convert them all to polar and take the max and min of rho and theta\n\n  // const viewportCenterTheta = cartesianToTheta(viewR + viewL, viewT + viewB)\n  const reflect = viewL >= 0 ? -1 : 1\n  // viewportCenterTheta < Math.PI / 2 || viewportCenterTheta > 1.5 * Math.PI\n  //   ? -1\n  //   : 1\n  let rhoMin = Infinity\n  let rhoMax = -Infinity\n  let thetaMin = Infinity\n  let thetaMax = -Infinity\n  for (let i = 0; i < vertices.length; i += 1) {\n    // ignore vertex if outside the viewport\n    const [vx, vy] = vertices[i]\n    if (vx >= viewL && vx <= viewR && vy >= viewT && vy <= viewB) {\n      const [rho, theta] = cartesianToPolar(vx * reflect, vy * reflect)\n      // ignore vertex if outside the circle\n      if (rho <= circleRadius + 0.001) {\n        // ignore theta if rho is 0\n        if (theta < thetaMin && rho > 0.0001) {\n          thetaMin = theta\n        }\n        if (theta > thetaMax && rho > 0.0001) {\n          thetaMax = theta\n        }\n        if (rho < rhoMin) {\n          rhoMin = rho\n        }\n        if (rho > rhoMax) {\n          rhoMax = rho\n        }\n      }\n    }\n  }\n\n  if (reflect === -1) {\n    thetaMin += Math.PI\n    thetaMax += Math.PI\n  }\n\n  if (thetaMin > 2 * Math.PI && thetaMax > 2 * Math.PI) {\n    thetaMin -= 2 * Math.PI\n    thetaMax -= 2 * Math.PI\n  }\n\n  return {\n    rho: [rhoMin, Math.min(circleRadius, rhoMax)],\n    theta: [thetaMin, thetaMax],\n  }\n}\n","import {\n  polarToCartesian,\n  assembleLocString,\n  objectFromEntries,\n  Region,\n} from '@jbrowse/core/util'\nimport { thetaRangesOverlap } from './viewportVisibleRegion'\n\nexport class Slice {\n  key: string\n\n  offsetRadians: number\n\n  startRadians: number\n\n  endRadians: number\n\n  bpPerRadian: number\n\n  flipped: boolean\n\n  constructor(\n    view: { bpPerRadian: number },\n    public region: Region & { widthBp: number; elided: boolean },\n    currentRadianOffset: number,\n    public radianWidth: number,\n  ) {\n    const { bpPerRadian } = view\n    this.key = assembleLocString(region)\n    this.offsetRadians = currentRadianOffset\n    this.bpPerRadian = bpPerRadian\n    this.flipped = false\n\n    this.startRadians = this.offsetRadians\n    this.endRadians = region.widthBp / this.bpPerRadian + this.offsetRadians\n    Object.freeze(this)\n  }\n\n  bpToXY(bp: number, radiusPx: number) {\n    let offsetBp\n    if (this.region.elided) {\n      offsetBp = this.region.widthBp / 2\n    } else if (this.flipped) {\n      offsetBp = this.region.end - bp\n    } else {\n      offsetBp = bp - this.region.start\n    }\n    const totalRadians = offsetBp / this.bpPerRadian + this.offsetRadians\n    return polarToCartesian(radiusPx, totalRadians)\n  }\n\n  toJSON() {\n    return objectFromEntries(Object.entries(this))\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction calculateStaticSlices(self: any) {\n  const slices = []\n  let currentRadianOffset = 0\n  for (const region of self.elidedRegions) {\n    const radianWidth =\n      region.widthBp / self.bpPerRadian + self.spacingPx / self.pxPerRadian\n    slices.push(new Slice(self, region, currentRadianOffset, radianWidth))\n    currentRadianOffset += radianWidth\n  }\n  return slices\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction sliceIsVisible(self: any, slice: Slice) {\n  const {\n    // rho: visibleRhoRange,\n    theta: [visibleThetaMin, visibleThetaMax],\n  } = self.visibleSection\n\n  return thetaRangesOverlap(\n    slice.offsetRadians + self.offsetRadians,\n    slice.radianWidth,\n    visibleThetaMin,\n    visibleThetaMax - visibleThetaMin,\n  )\n}\n\nexport { calculateStaticSlices, sliceIsVisible }\n","import { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  SnapshotOrInstance,\n  Instance,\n  types,\n  getParent,\n  resolveIdentifier,\n  getRoot,\n  cast,\n} from 'mobx-state-tree'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport { transaction } from 'mobx'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  getSession,\n  clamp,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { calculateStaticSlices, sliceIsVisible } from './slices'\n\nimport { viewportVisibleSection } from './viewportVisibleRegion'\n\nexport default function CircularView(pluginManager: PluginManager) {\n  const minHeight = 40\n  const minWidth = 100\n  const defaultHeight = 400\n  return types.compose(\n    BaseViewModel,\n    types\n      .model('CircularView', {\n        type: types.literal('CircularView'),\n        offsetRadians: -Math.PI / 2,\n        bpPerPx: 2000000,\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n\n        hideVerticalResizeHandle: false,\n        hideTrackSelectorButton: false,\n        lockedFitToWindow: true,\n        disableImportForm: false,\n\n        height: types.optional(\n          types.refinement('trackHeight', types.number, n => n >= minHeight),\n          defaultHeight,\n        ),\n        minimumRadiusPx: 25,\n        spacingPx: 10,\n        paddingPx: 80,\n        lockedPaddingPx: 100,\n        minVisibleWidth: 6,\n        minimumBlockWidth: 20,\n        displayedRegions: types.array(Region),\n        scrollX: 0,\n        scrollY: 0,\n        trackSelectorType: 'hierarchical',\n      })\n      .volatile(() => ({\n        width: 0,\n      }))\n      .views(self => ({\n        get staticSlices() {\n          return calculateStaticSlices(self)\n        },\n        get visibleStaticSlices() {\n          return this.staticSlices.filter(sliceIsVisible.bind(this, self))\n        },\n        get visibleSection() {\n          return viewportVisibleSection(\n            [\n              self.scrollX,\n              self.scrollX + self.width,\n              self.scrollY,\n              self.scrollY + self.height,\n            ],\n            this.centerXY,\n            this.radiusPx,\n          )\n        },\n        get circumferencePx() {\n          let elidedBp = 0\n          for (const r of this.elidedRegions) {\n            elidedBp += r.widthBp\n          }\n          return (\n            elidedBp / self.bpPerPx + self.spacingPx * this.elidedRegions.length\n          )\n        },\n        get radiusPx() {\n          return this.circumferencePx / (2 * Math.PI)\n        },\n        get bpPerRadian() {\n          return self.bpPerPx * this.radiusPx\n        },\n        get pxPerRadian() {\n          return this.radiusPx\n        },\n        get centerXY(): [number, number] {\n          return [\n            this.radiusPx + self.paddingPx,\n            this.radiusPx + self.paddingPx,\n          ]\n        },\n        get totalBp() {\n          let total = 0\n          for (const region of self.displayedRegions) {\n            total += region.end - region.start\n          }\n          return total\n        },\n        get maximumRadiusPx() {\n          return self.lockedFitToWindow\n            ? Math.min(self.width, self.height) / 2 - self.lockedPaddingPx\n            : 1000000\n        },\n        get maxBpPerPx() {\n          const minCircumferencePx = 2 * Math.PI * self.minimumRadiusPx\n          return this.totalBp / minCircumferencePx\n        },\n        get minBpPerPx() {\n          // min depends on window dimensions, clamp between old min(0.01) and max\n          const maxCircumferencePx = 2 * Math.PI * this.maximumRadiusPx\n          return clamp(\n            this.totalBp / maxCircumferencePx,\n            0.0000000001,\n            this.maxBpPerPx,\n          )\n        },\n        get atMaxBpPerPx() {\n          return self.bpPerPx >= this.maxBpPerPx\n        },\n        get atMinBpPerPx() {\n          return self.bpPerPx <= this.minBpPerPx\n        },\n        get tooSmallToLock() {\n          return this.minBpPerPx <= 0.0000000001\n        },\n        get figureDimensions() {\n          return [\n            this.radiusPx * 2 + 2 * self.paddingPx,\n            this.radiusPx * 2 + 2 * self.paddingPx,\n          ]\n        },\n        get figureWidth() {\n          return this.figureDimensions[0]\n        },\n        get figureHeight() {\n          return this.figureDimensions[1]\n        },\n        // this is displayedRegions, post-processed to\n        // elide regions that are too small to see reasonably\n        get elidedRegions() {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const visible: any[] = []\n          self.displayedRegions.forEach(region => {\n            const widthBp = region.end - region.start\n            const widthPx = widthBp / self.bpPerPx\n            if (widthPx < self.minVisibleWidth) {\n              // too small to see, collapse into a single elision region\n              const lastVisible = visible[visible.length - 1]\n              if (lastVisible && lastVisible.elided) {\n                lastVisible.regions.push({ ...region })\n                lastVisible.widthBp += widthBp\n              } else {\n                visible.push({\n                  elided: true,\n                  widthBp,\n                  regions: [{ ...region }],\n                })\n              }\n            } else {\n              // big enough to see, display it\n              visible.push({ ...region, widthBp })\n            }\n          })\n\n          // remove any single-region elisions\n          for (let i = 0; i < visible.length; i += 1) {\n            const v = visible[i]\n            if (v.elided && v.regions.length === 1) {\n              delete v.elided\n              visible[i] = { ...v, ...v.regions[0] }\n            }\n          }\n          return visible\n        },\n\n        get assemblyNames() {\n          const assemblyNames: string[] = []\n          self.displayedRegions.forEach(displayedRegion => {\n            if (!assemblyNames.includes(displayedRegion.assemblyName)) {\n              assemblyNames.push(displayedRegion.assemblyName)\n            }\n          })\n          return assemblyNames\n        },\n        get initialized() {\n          const { assemblyManager } = getSession(self)\n          return this.assemblyNames.every(\n            a => assemblyManager.get(a)?.initialized,\n          )\n        },\n      }))\n      .volatile(() => ({\n        error: undefined as Error | undefined,\n      }))\n      .actions(self => ({\n        // toggle action with a flag stating which mode it's in\n        setWidth(newWidth: number) {\n          self.width = Math.max(newWidth, minWidth)\n          return self.width\n        },\n        setHeight(newHeight: number) {\n          self.height = Math.max(newHeight, minHeight)\n          return self.height\n        },\n        resizeHeight(distance: number) {\n          const oldHeight = self.height\n          const newHeight = this.setHeight(self.height + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newHeight - oldHeight\n        },\n        resizeWidth(distance: number) {\n          const oldWidth = self.width\n          const newWidth = this.setWidth(self.width + distance)\n          this.setModelViewWhenAdjust(!self.tooSmallToLock)\n          return newWidth - oldWidth\n        },\n        rotateClockwiseButton() {\n          this.rotateClockwise(Math.PI / 6)\n        },\n\n        rotateCounterClockwiseButton() {\n          this.rotateCounterClockwise(Math.PI / 6)\n        },\n\n        rotateClockwise(distance = 0.17) {\n          self.offsetRadians += distance\n        },\n\n        rotateCounterClockwise(distance = 0.17) {\n          self.offsetRadians -= distance\n        },\n\n        zoomInButton() {\n          this.setBpPerPx(self.bpPerPx / 1.4)\n        },\n\n        zoomOutButton() {\n          this.setBpPerPx(self.bpPerPx * 1.4)\n        },\n\n        setBpPerPx(newVal: number) {\n          self.bpPerPx = clamp(newVal, self.minBpPerPx, self.maxBpPerPx)\n        },\n\n        setModelViewWhenAdjust(secondCondition: boolean) {\n          if (self.lockedFitToWindow && secondCondition) {\n            this.setBpPerPx(self.minBpPerPx)\n          }\n        },\n\n        closeView() {\n          getParent(self, 2).removeView(self)\n        },\n\n        setDisplayedRegions(regions: SnapshotOrInstance<typeof Region>[]) {\n          const previouslyEmpty = self.displayedRegions.length === 0\n          self.displayedRegions = cast(regions)\n\n          if (previouslyEmpty) {\n            this.setBpPerPx(self.minBpPerPx)\n          } else {\n            this.setBpPerPx(self.bpPerPx)\n          }\n        },\n\n        activateTrackSelector() {\n          if (self.trackSelectorType === 'hierarchical') {\n            const session = getSession(self)\n            if (isSessionModelWithWidgets(session)) {\n              const selector = session.addWidget(\n                'HierarchicalTrackSelectorWidget',\n                'hierarchicalTrackSelector',\n                { view: self },\n              )\n              session.showWidget(selector)\n              return selector\n            }\n          }\n          throw new Error(\n            `invalid track selector type ${self.trackSelectorType}`,\n          )\n        },\n\n        toggleTrack(trackId: string) {\n          // if we have any tracks with that configuration, turn them off\n          const hiddenCount = this.hideTrack(trackId)\n          // if none had that configuration, turn one on\n          if (!hiddenCount) {\n            this.showTrack(trackId)\n          }\n        },\n\n        setError(error: Error) {\n          console.error(error)\n          self.error = error\n        },\n\n        showTrack(trackId: string, initialSnapshot = {}) {\n          const trackConfigSchema =\n            pluginManager.pluggableConfigSchemaType('track')\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          const trackType = pluginManager.getTrackType(configuration.type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(\n            displayType => displayType.name,\n          )\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        addTrackConf(\n          configuration: AnyConfigurationModel,\n          initialSnapshot = {},\n        ) {\n          const { type } = configuration\n          const name = readConfObject(configuration, 'name')\n          const trackType = pluginManager.getTrackType(type)\n          if (!trackType) {\n            throw new Error(`unknown track type ${configuration.type}`)\n          }\n          const viewType = pluginManager.getViewType(self.type)\n          const supportedDisplays = viewType.displayTypes.map(\n            displayType => displayType.name,\n          )\n          const displayConf = configuration.displays.find(\n            (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n          )\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            name,\n            type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          })\n          self.tracks.push(track)\n        },\n\n        hideTrack(trackId: string) {\n          const trackConfigSchema =\n            pluginManager.pluggableConfigSchemaType('track')\n          const configuration = resolveIdentifier(\n            trackConfigSchema,\n            getRoot(self),\n            trackId,\n          )\n          // if we have any tracks with that configuration, turn them off\n          const shownTracks = self.tracks.filter(\n            t => t.configuration === configuration,\n          )\n          transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n          return shownTracks.length\n        },\n\n        toggleFitToWindowLock() {\n          self.lockedFitToWindow = !self.lockedFitToWindow\n          // when going unlocked -> locked and circle is cut off, set to the locked minBpPerPx\n          this.setModelViewWhenAdjust(self.atMinBpPerPx)\n          return self.lockedFitToWindow\n        },\n      })),\n  )\n}\n\nexport type CircularViewStateModel = ReturnType<typeof CircularView>\nexport type CircularViewModel = Instance<CircularViewStateModel>\n\n/*\nPLANS\n\n- tracks\n- ruler tick marks\n- set viewport scroll from state snapshot\n\n*/\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib } = pluginManager\n  const React = lib.react\n  const { useState, useEffect } = React\n  const { makeStyles } = lib['@material-ui/core/styles']\n  const { observer } = lib['mobx-react']\n\n  const useStyles = makeStyles(theme => {\n    const offset = 2\n    const duration = 1.4\n    return {\n      path: {\n        strokeDasharray: 187,\n        strokeDashoffset: 50,\n        animation: `$dash ${duration}s ease-in-out infinite, $colors ${\n          duration * 4\n        }s ease-in-out infinite`,\n      },\n      '@keyframes colors': {\n        '0%': {\n          stroke: theme.palette.primary.light,\n        },\n        '25%': {\n          stroke: theme.palette.secondary.light,\n        },\n        '50%': {\n          stroke: theme.palette.tertiary.light,\n        },\n        '75%': {\n          stroke: theme.palette.quaternary.light,\n        },\n        '100%': {\n          stroke: theme.palette.primary.light,\n        },\n      },\n      '@keyframes dash': {\n        '0%': {\n          strokeDashoffset: offset,\n        },\n        '50%': {\n          strokeDashoffset: offset / 4,\n          transform: 'rotate(135deg)',\n        },\n        '100%': {\n          strokeDashoffset: offset,\n          transform: 'rotate(720deg)',\n        },\n      },\n    }\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const Loading = observer(\n    ({\n      model: {\n        renderProps: { radius },\n      },\n    }: {\n      model: { renderProps: { radius: number } }\n    }) => {\n      const classes = useStyles()\n\n      // only show the loading message after 400ms to prevent excessive flickering\n      const [shown, setShown] = useState(false)\n      useEffect(() => {\n        const timeout = setTimeout(() => setShown(true), 400)\n        return () => clearTimeout(timeout)\n      })\n\n      return !shown ? null : (\n        <g>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,255,255,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"#f1f1f1\" />\n          <circle cx=\"0\" cy=\"0\" r={radius} fill=\"url(#diagonalHatch)\" />\n          <text\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            Loading&hellip;\n          </text>\n          <circle\n            className={classes.path}\n            fill=\"none\"\n            strokeWidth=\"4\"\n            strokeLinecap=\"round\"\n            cx=\"0\"\n            cy=\"0\"\n            r=\"60\"\n          />\n        </g>\n      )\n    },\n  )\n\n  return Loading\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const { observer } = jbrequire('mobx-react')\n\n  const useStyles = makeStyles({\n    errorMessage: {},\n    errorBackground: {},\n    errorText: {},\n  })\n\n  // 'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n  const DisplayError = observer(\n    ({\n      model: {\n        renderProps: { radius },\n        error,\n      },\n    }) => {\n      const classes = useStyles()\n      return (\n        <g className={classes.errorMessage}>\n          <defs>\n            <pattern\n              id=\"diagonalHatch\"\n              width=\"10\"\n              height=\"10\"\n              patternTransform=\"rotate(45 0 0)\"\n              patternUnits=\"userSpaceOnUse\"\n            >\n              <line\n                x1=\"0\"\n                y1=\"0\"\n                x2=\"0\"\n                y2=\"10\"\n                style={{ stroke: 'rgba(255,0,0,0.5)', strokeWidth: 10 }}\n              />\n            </pattern>\n          </defs>\n          <circle\n            className={classes.errorBackground}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"#ffb4b4\"\n          />\n          <circle\n            className={classes.errorPattern}\n            cx=\"0\"\n            cy=\"0\"\n            r={radius}\n            fill=\"url(#diagonalHatch)\"\n          />\n          <text\n            className={classes.errorText}\n            x=\"0\"\n            y=\"0\"\n            transform=\"rotate(90 0 0)\"\n            dominantBaseline=\"middle\"\n            textAnchor=\"middle\"\n          >\n            {String(error)}\n          </text>\n        </g>\n      )\n    },\n  )\n\n  return DisplayError\n}\n","export default ({ jbrequire }) => {\n  const React = jbrequire('react')\n  const { isAlive } = jbrequire('mobx-state-tree')\n  const { useEffect, useRef } = React\n  const { observer, PropTypes: MobxPropTypes } = jbrequire('mobx-react')\n  const { unmountComponentAtNode, hydrate } = jbrequire('react-dom')\n  const { rIC } = jbrequire('@jbrowse/core/util')\n\n  function RpcRenderedSvgGroup({ model }) {\n    const { data, html, filled, renderingComponent } = model\n\n    const ssrContainerNode = useRef(null)\n\n    useEffect(() => {\n      const domNode = ssrContainerNode.current\n      function doHydrate() {\n        if (domNode && filled) {\n          if (domNode && domNode.innerHTML) {\n            domNode.style.display = 'none'\n            unmountComponentAtNode(domNode)\n          }\n\n          // setting outline:none fixes react \"focusable\" element issue. see\n          // https://github.com/GMOD/jbrowse-components/issues/2160\n          domNode.style.outline = 'none'\n          domNode.innerHTML = html\n          // use requestIdleCallback to defer main-thread rendering\n          // and hydration for when we have some free time. helps\n          // keep the framerate up.\n          rIC(() => {\n            if (!isAlive(model)) {\n              return\n            }\n            const mainThreadRendering = React.createElement(\n              renderingComponent,\n              { ...data, ...model.renderProps() },\n              null,\n            )\n            rIC(() => {\n              if (!isAlive(model)) {\n                return\n              }\n              hydrate(mainThreadRendering, domNode)\n            })\n          })\n        }\n      }\n      doHydrate()\n      return () => {\n        if (domNode) {\n          unmountComponentAtNode(domNode)\n        }\n      }\n    })\n\n    return <g ref={ssrContainerNode} />\n  }\n\n  RpcRenderedSvgGroup.propTypes = {\n    model: MobxPropTypes.observableObject.isRequired,\n  }\n\n  return observer(RpcRenderedSvgGroup)\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ChordDisplayLoadingFactory from './Loading'\nimport ChordDisplayErrorFactory from './DisplayError'\nimport RpcRenderedSvgGroupF from './RpcRenderedSvgGroup'\n\nexport default ({ lib, load }: PluginManager) => {\n  const React = lib.react\n  const { observer, PropTypes: MobxPropTypes } = lib['mobx-react']\n\n  const Loading = load(ChordDisplayLoadingFactory)\n  const DisplayError = load(ChordDisplayErrorFactory)\n  const RpcRenderedSvgGroup = load(RpcRenderedSvgGroupF)\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  function BaseChordDisplay({ display }: any) {\n    if (display.error) {\n      return <DisplayError model={display} />\n    }\n    if (!display.filled) {\n      return <Loading model={display} />\n    }\n    return <RpcRenderedSvgGroup model={display} />\n  }\n  BaseChordDisplay.propTypes = {\n    display: MobxPropTypes.observableObject.isRequired,\n  }\n  return observer(BaseChordDisplay)\n}\n","export default ({ jbrequire }) => {\n  const { getRpcSessionId } = jbrequire('@jbrowse/core/util/tracks')\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getSession } = jbrequire('@jbrowse/core/util')\n\n  function renderReactionData(self) {\n    const view = getContainingView(self)\n    const { rendererType } = self\n    const { rpcManager } = getSession(view)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: self.renderProps(),\n      renderArgs: {\n        assemblyName: view.displayedRegions[0]?.assemblyName,\n        adapterConfig: JSON.parse(JSON.stringify(self.adapterConfig)),\n        rendererType: rendererType.name,\n        regions: JSON.parse(JSON.stringify(view.displayedRegions)),\n        blockDefinitions: self.blockDefinitions,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000,\n      },\n    }\n  }\n\n  async function renderReactionEffect(props, signal, self) {\n    if (!props) {\n      throw new Error('cannot render with no props')\n    }\n\n    const {\n      rendererType,\n      rpcManager,\n      cannotBeRenderedReason,\n      renderArgs,\n      renderProps,\n    } = props\n\n    if (cannotBeRenderedReason) {\n      return { message: cannotBeRenderedReason }\n    }\n\n    // don't try to render 0 or NaN radius or no regions\n    if (\n      !props.renderProps.radius ||\n      !props.renderArgs.regions ||\n      !props.renderArgs.regions.length\n    ) {\n      return { message: 'Skipping render' }\n    }\n\n    // check renderertype compatibility\n    if (!self.isCompatibleWithRenderer(rendererType)) {\n      throw new Error(\n        `renderer ${rendererType.name} is not compatible with this display type`,\n      )\n    }\n\n    const { html, ...data } = await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      ...renderProps,\n      signal,\n    })\n\n    return { html, data, renderingComponent: rendererType.ReactComponent }\n  }\n\n  return { renderReactionData, renderReactionEffect }\n}\n","import { getConf } from '@jbrowse/core/configuration'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport CircularChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport RendererType from '@jbrowse/core/pluggableElementTypes/renderers/RendererType'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n  AnyReactComponentType,\n} from '@jbrowse/core/util'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n  getTrackAssemblyNames,\n} from '@jbrowse/core/util/tracks'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getParent, isAlive, types, getEnv } from 'mobx-state-tree'\nimport React from 'react'\nimport renderReactionFactory from './renderReaction'\nimport { CircularViewModel } from '../../CircularView/models/CircularView'\n\nexport const BaseChordDisplayModel = types\n  .compose(\n    'BaseChordDisplay',\n    BaseDisplay,\n    types.model({\n      bezierRadiusRatio: 0.1,\n      assemblyName: types.maybe(types.string),\n    }),\n  )\n  .volatile(() => {\n    return {\n      // NOTE: all this volatile stuff has to be filled in at once\n      // so that it stays consistent\n      filled: false,\n      reactElement: undefined as React.ReactElement | undefined,\n      data: undefined,\n      message: '',\n      renderingComponent: undefined as undefined | AnyReactComponentType,\n      refNameMap: undefined as Record<string, string> | undefined,\n    }\n  })\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const track = self\n    return {\n      onChordClick(feature: Feature) {\n        getConf(self, 'onChordClick', { feature, track, pluginManager })\n      },\n    }\n  })\n  .views(self => ({\n    get blockDefinitions() {\n      const origSlices = (getContainingView(self) as CircularViewModel)\n        .staticSlices\n      if (!self.refNameMap) {\n        return origSlices\n      }\n\n      const slices = JSON.parse(JSON.stringify(origSlices))\n\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      slices.forEach((slice: any) => {\n        const regions = slice.region.elided\n          ? slice.region.regions\n          : [slice.region]\n        regions.forEach((region: Region) => {\n          const renamed = self.refNameMap?.[region.refName]\n          if (renamed && region.refName !== renamed) {\n            region.refName = renamed\n          }\n        })\n      })\n      return slices\n    },\n\n    renderProps() {\n      const view = getContainingView(self) as CircularViewModel\n      return {\n        ...getParentRenderProps(self),\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n        radius: view.radiusPx,\n        blockDefinitions: this.blockDefinitions,\n        onChordClick: self.onChordClick,\n      }\n    },\n\n    /**\n     * the pluggable element type object for this diplay's\n     * renderer\n     */\n    get rendererType() {\n      const display = self\n      const { pluginManager } = getEnv(self)\n      const ThisRendererType = pluginManager.getRendererType(\n        self.rendererTypeName,\n      )\n      if (!ThisRendererType) {\n        throw new Error(`renderer \"${display.rendererTypeName}\" not found`)\n      }\n      if (!ThisRendererType.ReactComponent) {\n        throw new Error(\n          `renderer ${display.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`,\n        )\n      }\n      return ThisRendererType\n    },\n\n    isCompatibleWithRenderer(renderer: RendererType) {\n      return !!(renderer instanceof CircularChordRendererType)\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (!isAlive(self)) {\n        return undefined\n      }\n      const session = getSession(self)\n      if (!session) {\n        return undefined\n      }\n      const { selection } = session\n      // does it quack like a feature?\n      if (isFeature(selection)) {\n        return selection.id()\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    renderStarted() {\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.error = undefined\n      self.renderingComponent = undefined\n    },\n    renderSuccess({\n      message,\n      data,\n      reactElement,\n      renderingComponent,\n    }: {\n      message: string\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      data: any\n      reactElement: React.ReactElement\n      renderingComponent: AnyReactComponentType\n    }) {\n      if (message) {\n        self.filled = false\n        self.message = message\n        self.reactElement = undefined\n        self.data = undefined\n        self.error = undefined\n        self.renderingComponent = undefined\n      } else {\n        self.filled = true\n        self.message = ''\n        self.reactElement = reactElement\n        self.data = data\n        self.error = undefined\n        self.renderingComponent = renderingComponent\n      }\n    },\n    renderError(error: unknown) {\n      console.error(error)\n      // the rendering failed for some reason\n      self.filled = false\n      self.message = ''\n      self.reactElement = undefined\n      self.data = undefined\n      self.error = error\n      self.renderingComponent = undefined\n    },\n\n    setRefNameMap(refNameMap: Record<string, string>) {\n      self.refNameMap = refNameMap\n    },\n  }))\n  .actions(self => {\n    const { pluginManager } = getEnv(self)\n    const { renderReactionData, renderReactionEffect } =\n      pluginManager.jbrequire(renderReactionFactory)\n    return {\n      afterAttach() {\n        makeAbortableReaction(\n          self,\n          renderReactionData,\n          renderReactionEffect,\n          {\n            name: `${self.type} ${self.id} rendering`,\n            // delay: self.renderDelay || 300,\n            fireImmediately: true,\n          },\n          self.renderStarted,\n          self.renderSuccess,\n          self.renderError,\n        )\n        makeAbortableReaction(\n          self,\n          () => ({\n            assemblyNames: getTrackAssemblyNames(self.parentTrack) as string[],\n            adapter: getConf(getParent(self, 2), 'adapter'),\n            assemblyManager: getSession(self).assemblyManager,\n          }),\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          async ({ assemblyNames, adapter, assemblyManager }: any, signal) => {\n            return assemblyManager.getRefNameMapForAdapter(\n              adapter,\n              assemblyNames[0],\n              { signal, sessionId: getRpcSessionId(self) },\n            )\n          },\n          {\n            name: `${self.type} ${self.id} getting refNames`,\n            fireImmediately: true,\n          },\n          () => {},\n          refNameMap => {\n            self.setRefNameMap(refNameMap)\n          },\n          error => {\n            console.error(error)\n            self.setError(error)\n          },\n        )\n      },\n    }\n  })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nconst baseChordDisplayConfig = ConfigurationSchema(\n  'BaseChordDisplay',\n  {\n    onChordClick: {\n      type: 'boolean',\n      description:\n        'callback that should be run when a chord in the track is clicked',\n      defaultValue: false,\n      contextVariable: ['feature', 'track', 'pluginManager'],\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n\nexport { baseChordDisplayConfig }\n","import { lazy } from 'react'\nimport { when } from 'mobx'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport DataUsageIcon from '@material-ui/icons/DataUsage'\nimport stateModelFactory, {\n  CircularViewModel,\n} from './CircularView/models/CircularView'\n\ntype CGV = CircularViewModel\n\nexport default class CircularViewPlugin extends Plugin {\n  name = 'CircularViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          ReactComponent: lazy(\n            () => import('./CircularView/components/CircularView'),\n          ),\n          stateModel: stateModelFactory(pluginManager),\n          name: 'CircularView',\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-CircularView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        loc,\n        tracks = [],\n      }: {\n        session: AbstractSessionModel\n        assembly?: string\n        loc: string\n        tracks?: string[]\n      }) => {\n        const { assemblyManager } = session\n        const view = session.addView('CircularView', {}) as CGV\n\n        await when(() => view.initialized)\n\n        if (!assembly) {\n          throw new Error(\n            'No assembly provided when launching circular genome view',\n          )\n        }\n\n        const asm = await assemblyManager.waitForAssembly(assembly)\n        if (!asm) {\n          throw new Error(\n            `Assembly \"${assembly}\" not found when launching circular genome view`,\n          )\n        }\n\n        view.setDisplayedRegions(asm.regions || [])\n\n        tracks.forEach(track => view.showTrack(track))\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Circular view',\n        icon: DataUsageIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('CircularView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  BaseChordDisplayModel,\n  baseChordDisplayConfig,\n  BaseChordDisplayComponentFactory,\n} from './BaseChordDisplay'\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature } from '@jbrowse/core/util'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { unzip } from '@gmod/bgzf-filehandle'\n\nexport interface PAFRecord {\n  qname: string\n  qstart: number\n  qend: number\n  tname: string\n  tstart: number\n  tend: number\n  strand: number\n  extra: {\n    blockLen?: number\n    mappingQual: number\n    numMatches?: number\n    meanScore?: number\n  }\n}\n\nfunction isGzip(buf: Buffer) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\nfunction zip(a: number[], b: number[]) {\n  return a.map((e, i) => [e, b[i]] as [number, number])\n}\n\n// based on \"weighted mean\" method from dotPlotly\n// https://github.com/tpoorten/dotPlotly\n// License for dotPlotly reproduced here\n//\n// MIT License\n\n// Copyright (c) 2017 Tom Poorten\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all\n// copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nfunction getWeightedMeans(ret: PAFRecord[]) {\n  // in the weighted mean longer alignments factor in more\n  // heavily of all the fragments of a query vs the reference that it mapped\n  // to\n  //\n  // this uses a combined key query+'-'+ref to iteratively map all the\n  // alignments that match a particular ref from a particular query (so 1d\n  // array of what could be a 2d map)\n  //\n  // the result is a single number that says e.g. chr5 from human mapped to\n  // chr5 on mouse with 0.8 quality, and that0.8 is then attached to all the\n  // pieces of chr5 on human that mapped to chr5 on mouse. if chr5 on human\n  // also more weakly mapped to chr6 on mouse, then it would have another\n  // value e.g. 0.6. this can show strong and weak levels of synteny,\n  // especially in polyploidy situations\n  const scoreMap: { [key: string]: { quals: number[]; len: number[] } } = {}\n  for (let i = 0; i < ret.length; i++) {\n    const entry = ret[i]\n    const query = entry.qname\n    const target = entry.tname\n    const key = query + '-' + target\n    if (!scoreMap[key]) {\n      scoreMap[key] = { quals: [], len: [] }\n    }\n    scoreMap[key].quals.push(entry.extra.mappingQual)\n    scoreMap[key].len.push(entry.extra.blockLen || 1)\n  }\n\n  const meanScoreMap = Object.fromEntries(\n    Object.entries(scoreMap).map(([key, val]) => {\n      const vals = zip(val.quals, val.len)\n      return [key, weightedMean(vals)]\n    }),\n  )\n  for (let i = 0; i < ret.length; i++) {\n    const entry = ret[i]\n    const query = entry.qname\n    const target = entry.tname\n    const key = query + '-' + target\n    entry.extra.meanScore = meanScoreMap[key]\n  }\n\n  let min = 10000\n  let max = 0\n  for (let i = 0; i < ret.length; i++) {\n    const entry = ret[i]\n    min = Math.min(entry.extra.meanScore || 0, min)\n    max = Math.max(entry.extra.meanScore || 0, max)\n  }\n  for (let i = 0; i < ret.length; i++) {\n    const entry = ret[i]\n    const b = entry.extra.meanScore || 0\n    entry.extra.meanScore = (b - min) / (max - min)\n  }\n\n  return ret\n}\n\n// https://gist.github.com/stekhn/a12ed417e91f90ecec14bcfa4c2ae16a\nfunction weightedMean(tuples: [number, number][]) {\n  const [valueSum, weightSum] = tuples.reduce(\n    ([valueSum, weightSum], [value, weight]) => [\n      valueSum + value * weight,\n      weightSum + weight,\n    ],\n    [0, 0],\n  )\n  return valueSum / weightSum\n}\n\nexport default class PAFAdapter extends BaseFeatureDataAdapter {\n  private setupP?: Promise<PAFRecord[]>\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  async setupPre(opts?: BaseOptions) {\n    const pafLocation = openLocation(\n      this.getConf('pafLocation'),\n      this.pluginManager,\n    )\n    const buffer = (await pafLocation.readFile(opts)) as Buffer\n    const buf = isGzip(buffer) ? await unzip(buffer) : buffer\n    // 512MB  max chrome string length is 512MB\n    if (buf.length > 536_870_888) {\n      throw new Error('Data exceeds maximum string length (512MB)')\n    }\n    const text = new TextDecoder('utf8', { fatal: true }).decode(buf)\n\n    return text\n      .split('\\n')\n      .filter(line => !!line)\n      .map(line => {\n        const [\n          qname,\n          ,\n          qstart,\n          qend,\n          strand,\n          tname,\n          ,\n          tstart,\n          tend,\n          numMatches,\n          blockLen,\n          mappingQual,\n          ...fields\n        ] = line.split('\\t')\n\n        const rest = Object.fromEntries(\n          fields.map(field => {\n            const r = field.indexOf(':')\n            const fieldName = field.slice(0, r)\n            const fieldValue = field.slice(r + 3)\n            return [fieldName, fieldValue]\n          }),\n        )\n\n        return {\n          tname,\n          tstart: +tstart,\n          tend: +tend,\n          qname,\n          qstart: +qstart,\n          qend: +qend,\n          strand: strand === '-' ? -1 : 1,\n          extra: {\n            numMatches: +numMatches,\n            blockLen: +blockLen,\n            mappingQual: +mappingQual,\n            ...rest,\n          },\n        } as PAFRecord\n      })\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseAdapter filters it out)\n    return true\n  }\n\n  getAssemblyNames() {\n    let assemblyNames = this.getConf('assemblyNames') as string[]\n    if (assemblyNames.length === 0) {\n      const query = this.getConf('queryAssembly') as string\n      const target = this.getConf('targetAssembly') as string\n      assemblyNames = [query, target]\n    }\n    return assemblyNames\n  }\n\n  async getRefNames(opts: BaseOptions = {}) {\n    // @ts-ignore\n    const r1 = opts.regions?.[0].assemblyName\n    const feats = await this.setup(opts)\n\n    const idx = this.getAssemblyNames().indexOf(r1)\n    if (idx !== -1) {\n      const set = new Set<string>()\n      for (let i = 0; i < feats.length; i++) {\n        set.add(idx === 0 ? feats[i].qname : feats[i].tname)\n      }\n      return Array.from(set)\n    }\n    console.warn('Unable to do ref renaming on adapter')\n    return []\n  }\n\n  getFeatures(\n    region: Region,\n    opts: BaseOptions & { config?: AnyConfigurationModel } = {},\n  ) {\n    return ObservableCreate<Feature>(async observer => {\n      let pafRecords = await this.setup(opts)\n      const { config } = opts\n      if (config && readConfObject(config, 'colorBy') === 'meanQueryIdentity') {\n        pafRecords = getWeightedMeans(pafRecords)\n      }\n      const assemblyNames = this.getAssemblyNames()\n      const { assemblyName } = region\n\n      // The index of the assembly name in the region list corresponds to the\n      // adapter in the subadapters list\n      const index = assemblyNames.indexOf(assemblyName)\n      if (index !== -1) {\n        for (let i = 0; i < pafRecords.length; i++) {\n          const r = pafRecords[i]\n          let start = 0\n          let end = 0\n          let refName = ''\n          let mateName = ''\n          let mateStart = 0\n          let mateEnd = 0\n          if (index === 0) {\n            start = r.qstart\n            end = r.qend\n            refName = r.qname\n            mateName = r.tname\n            mateStart = r.tstart\n            mateEnd = r.tend\n          } else {\n            start = r.tstart\n            end = r.tend\n            refName = r.tname\n            mateName = r.qname\n            mateStart = r.qstart\n            mateEnd = r.qend\n          }\n          const { extra, strand } = r\n\n          if (\n            refName === region.refName &&\n            doesIntersect2(region.start, region.end, start, end)\n          ) {\n            observer.next(\n              new SimpleFeature({\n                uniqueId: `${i}`,\n                start,\n                end,\n                refName,\n                strand,\n                assemblyName,\n                syntenyId: i,\n                mate: { start: mateStart, end: mateEnd, refName: mateName },\n                ...extra,\n              }),\n            )\n          }\n        }\n      }\n\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'PAFAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    pafLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.paf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { BaseOptions } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { GenericFilehandle } from 'generic-filehandle'\nimport { unzip } from '@gmod/bgzf-filehandle'\n\nexport function isGzip(buf: Buffer) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\nexport function parseBed(text: string) {\n  return new Map(\n    text\n      .split('\\n')\n      .filter(f => !!f || f.startsWith('#'))\n      .map(line => {\n        const [refName, start, end, name, score, strand] = line.split('\\t')\n        return [\n          name,\n          {\n            refName,\n            start: +start,\n            end: +end,\n            score: +score,\n            name,\n            strand: strand === '-' ? -1 : 1,\n          },\n        ]\n      }),\n  )\n}\n\nexport async function readFile(file: GenericFilehandle, opts?: BaseOptions) {\n  const buffer = (await file.readFile(opts)) as Buffer\n  return new TextDecoder('utf8', { fatal: true }).decode(\n    isGzip(buffer) ? await unzip(buffer) : buffer,\n  )\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { doesIntersect2 } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readFile, parseBed } from '../util'\n\ninterface BareFeature {\n  refName: string\n  start: number\n  end: number\n  score: number\n  name: string\n}\n\ntype Row = [BareFeature, BareFeature, number, number]\n\nexport default class MCScanAnchorsAdapter extends BaseFeatureDataAdapter {\n  private setupP?: Promise<{\n    assemblyNames: string[]\n    feats: Row[]\n  }>\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  async setup(opts: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n  async setupPre(opts: BaseOptions) {\n    const assemblyNames = this.getConf('assemblyNames') as string[]\n\n    const pm = this.pluginManager\n    const bed1 = openLocation(this.getConf('bed1Location'), pm)\n    const bed2 = openLocation(this.getConf('bed2Location'), pm)\n    const mcscan = openLocation(this.getConf('mcscanAnchorsLocation'), pm)\n    const [bed1text, bed2text, mcscantext] = await Promise.all(\n      [bed1, bed2, mcscan].map(r => readFile(r, opts)),\n    )\n\n    const bed1Map = parseBed(bed1text)\n    const bed2Map = parseBed(bed2text)\n    const feats = mcscantext\n      .split('\\n')\n      .filter(f => !!f && f !== '###')\n      .map((line, index) => {\n        const [name1, name2, score] = line.split('\\t')\n        const r1 = bed1Map.get(name1)\n        const r2 = bed2Map.get(name2)\n        if (!r1 || !r2) {\n          throw new Error(`feature not found, ${name1} ${name2} ${r1} ${r2}`)\n        }\n        return [r1, r2, +score, index] as Row\n      })\n\n    return {\n      assemblyNames,\n      feats,\n    }\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseFeatureDataAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { assemblyNames, feats } = await this.setup(opts)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        feats.forEach(f => {\n          const [r1, r2, score, rowNum] = f\n          const [f1, f2] = index === 1 ? [r2, r1] : [r1, r2]\n          if (\n            f1.refName === region.refName &&\n            doesIntersect2(region.start, region.end, f1.start, f1.end)\n          ) {\n            observer.next(\n              new SimpleFeature({\n                ...f1,\n                uniqueId: `${index}-${rowNum}`,\n                syntenyId: rowNum,\n                score,\n                mate: f2 as BareFeature,\n              }),\n            )\n          }\n        })\n      }\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'MCScanAnchorsAdapter',\n  {\n    mcscanAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors',\n        locationType: 'UriLocation',\n      },\n    },\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { doesIntersect2 } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { readFile, parseBed } from '../util'\n\ninterface BareFeature {\n  refName: string\n  start: number\n  end: number\n  score: number\n  name: string\n}\n\ntype Row = [\n  BareFeature,\n  BareFeature,\n  BareFeature,\n  BareFeature,\n  number,\n  number,\n  number,\n]\n\nexport default class MCScanAnchorsAdapter extends BaseFeatureDataAdapter {\n  private setupP?: Promise<{\n    assemblyNames: string[]\n    feats: Row[]\n  }>\n\n  public static capabilities = ['getFeatures', 'getRefNames']\n\n  async setup(opts: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n  async setupPre(opts: BaseOptions) {\n    const assemblyNames = this.getConf('assemblyNames') as string[]\n    const pm = this.pluginManager\n    const bed1 = openLocation(this.getConf('bed1Location'), pm)\n    const bed2 = openLocation(this.getConf('bed2Location'), pm)\n    const mcscan = openLocation(this.getConf('mcscanSimpleAnchorsLocation'), pm)\n    const [bed1text, bed2text, mcscantext] = await Promise.all(\n      [bed1, bed2, mcscan].map(r => readFile(r, opts)),\n    )\n    const bed1Map = parseBed(bed1text)\n    const bed2Map = parseBed(bed2text)\n    const feats = mcscantext\n      .split('\\n')\n      .filter(f => !!f && f !== '###')\n      .map((line, index) => {\n        const [n11, n12, n21, n22, score, strand] = line.split('\\t')\n        const r11 = bed1Map.get(n11)\n        const r12 = bed1Map.get(n12)\n        const r21 = bed2Map.get(n21)\n        const r22 = bed2Map.get(n22)\n        if (!r11 || !r12 || !r21 || !r22) {\n          throw new Error(\n            `feature not found, ${n11} ${n12} ${n21} ${n22} ${r11} ${r12} ${r21} ${r22}`,\n          )\n        }\n        return [\n          r11,\n          r12,\n          r21,\n          r22,\n          +score,\n          strand === '-' ? -1 : 1,\n          index,\n        ] as Row\n      })\n\n    return {\n      assemblyNames,\n      feats,\n    }\n  }\n\n  async hasDataForRefName() {\n    // determining this properly is basically a call to getFeatures\n    // so is not really that important, and has to be true or else\n    // getFeatures is never called (BaseFeatureDataAdapter filters it out)\n    return true\n  }\n\n  async getRefNames() {\n    // we cannot determine this accurately\n    return []\n  }\n\n  getFeatures(region: Region, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { assemblyNames, feats } = await this.setup(opts)\n\n      // The index of the assembly name in the region list corresponds to\n      // the adapter in the subadapters list\n      const index = assemblyNames.indexOf(region.assemblyName)\n      if (index !== -1) {\n        feats.forEach(f => {\n          const [f11, f12, f21, f22, score, strand, rowNum] = f\n          let r1 = {\n            refName: f11.refName,\n            start: Math.min(f11.start, f12.start),\n            end: Math.max(f11.end, f12.end),\n          }\n          let r2 = {\n            refName: f21.refName,\n            start: Math.min(f21.start, f22.start),\n            end: Math.max(f21.end, f22.end),\n          }\n          if (index === 1) {\n            ;[r2, r1] = [r1, r2]\n          }\n          if (\n            r1.refName === region.refName &&\n            doesIntersect2(r1.start, r1.end, region.start, region.end)\n          ) {\n            observer.next(\n              new SimpleFeature({\n                ...r1,\n                uniqueId: `${rowNum}`,\n                syntenyId: rowNum,\n                score,\n                strand,\n                mate: r2 as BareFeature,\n              }),\n            )\n          }\n        })\n      }\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'MCScanSimpleAnchorsAdapter',\n  {\n    mcscanSimpleAnchorsLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mcscan.anchors.simple',\n        locationType: 'UriLocation',\n      },\n    },\n    bed1Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n    bed2Location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/file.bed',\n        locationType: 'UriLocation',\n      },\n    },\n\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { BaseOptions } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport PAFAdapter from '../PAFAdapter/PAFAdapter'\n\nfunction isGzip(buf: Buffer) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\nexport default class MashMapAdapter extends PAFAdapter {\n  async setupPre(opts?: BaseOptions) {\n    const outLoc = openLocation(this.getConf('outLocation'), this.pluginManager)\n    const buffer = (await outLoc.readFile(opts)) as Buffer\n    const buf = isGzip(buffer) ? await unzip(buffer) : buffer\n    // 512MB  max chrome string length is 512MB\n    if (buf.length > 536_870_888) {\n      throw new Error('Data exceeds maximum string length (512MB)')\n    }\n    const text = new TextDecoder('utf8', { fatal: true }).decode(buf)\n\n    // mashmap produces PAF-like data that is space separated instead of tab\n    return text\n      .split('\\n')\n      .filter(line => !!line)\n      .map(line => {\n        const fields = line.split(' ')\n        if (fields.length < 9) {\n          // xref https://github.com/marbl/MashMap/issues/38\n          throw new Error('improperly formatted line: ' + line)\n        }\n        const [qname, , qstart, qend, strand, tname, , tstart, tend, mq] =\n          fields\n\n        return {\n          tname,\n          tstart: +tstart,\n          tend: +tend,\n          qname,\n          qstart: +qstart,\n          qend: +qend,\n          strand: strand === '-' ? -1 : 1,\n          extra: {\n            mappingQual: +mq,\n          },\n        }\n      })\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'MashMapAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    outLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/mashmap.out',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { BaseOptions } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport PAFAdapter from '../PAFAdapter/PAFAdapter'\n\nfunction isGzip(buf: Buffer) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\n/* paf2delta from paftools.js in the minimap2 repository, license reproduced below\n *\n * The MIT License\n *\n * Copyright (c) 2018-     Dana-Farber Cancer Institute\n *               2017-2018 Broad Institute, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS\n * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN\n * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nfunction paf_delta2paf(lines: string[]) {\n  let rname = ''\n  let qname = ''\n  let qs = 0\n  let qe = 0\n  let rs = 0\n  let re = 0\n  let strand = 0\n  let NM = 0\n  let cigar = [] as number[]\n  let x = 0\n  let y = 0\n  let seen_gt = false\n\n  const records = []\n  const regex = new RegExp(/^>(\\S+)\\s+(\\S+)\\s+(\\d+)\\s+(\\d+)/)\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i]\n    const m = regex.exec(line)\n    if (m !== null) {\n      rname = m[1]\n      qname = m[2]\n      seen_gt = true\n      continue\n    }\n    if (!seen_gt) {\n      continue\n    }\n    const t = line.split(' ')\n    if (t.length === 7) {\n      const t0 = +t[0]\n      const t1 = +t[1]\n      const t2 = +t[2]\n      const t3 = +t[3]\n      const t4 = +t[4]\n      strand = (t0 < t1 && t2 < t3) || (t0 > t1 && t2 > t3) ? 1 : -1\n      rs = +(t0 < t1 ? t0 : t1) - 1\n      re = +(t1 > t0 ? t1 : t0)\n      qs = +(t2 < t3 ? t2 : t3) - 1\n      qe = +(t3 > t2 ? t3 : t2)\n      x = y = 0\n      NM = t4\n      cigar = []\n    } else if (t.length === 1) {\n      const d = +t[0]\n      if (d === 0) {\n        let blen = 0\n        const cigar_str = []\n\n        if (re - rs - x !== qe - qs - y) {\n          throw new Error(`inconsistent alignment on line ${i}`)\n        }\n        cigar.push((re - rs - x) << 4)\n        for (let i = 0; i < cigar.length; ++i) {\n          const rlen = cigar[i] >> 4\n          blen += rlen\n          cigar_str.push(rlen + 'MID'.charAt(cigar[i] & 0xf))\n        }\n\n        records.push({\n          qname,\n          qstart: qs,\n          qend: qe,\n          tname: rname,\n          tstart: rs,\n          tend: re,\n          strand,\n          extra: {\n            numMatches: blen - NM,\n            blockLen: blen,\n            mappingQual: 0,\n            NM,\n            cg: cigar_str.join(''),\n          },\n        })\n      } else if (d > 0) {\n        const l = d - 1\n        x += l + 1\n        y += l\n        if (l > 0) {\n          cigar.push(l << 4)\n        }\n        if (cigar.length > 0 && (cigar[cigar.length - 1] & 0xf) === 2) {\n          cigar[cigar.length - 1] += 1 << 4\n        } else {\n          cigar.push((1 << 4) | 2)\n        } // deletion\n      } else {\n        const l = -d - 1\n        x += l\n        y += l + 1\n        if (l > 0) {\n          cigar.push(l << 4)\n        }\n        if (cigar.length > 0 && (cigar[cigar.length - 1] & 0xf) === 1) {\n          cigar[cigar.length - 1] += 1 << 4\n        } else {\n          cigar.push((1 << 4) | 1)\n        } // insertion\n      }\n    }\n  }\n  return records\n}\n\nexport default class DeltaAdapter extends PAFAdapter {\n  async setupPre(opts?: BaseOptions) {\n    const loc = openLocation(this.getConf('deltaLocation'), this.pluginManager)\n    const buffer = (await loc.readFile(opts)) as Buffer\n    const buf = isGzip(buffer) ? await unzip(buffer) : buffer\n    // 512MB  max chrome string length is 512MB\n    if (buf.length > 536_870_888) {\n      throw new Error('Data exceeds maximum string length (512MB)')\n    }\n    const text = new TextDecoder('utf8', { fatal: true }).decode(buf)\n\n    return paf_delta2paf(text.split('\\n').filter(line => !!line))\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'DeltaAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second',\n    },\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the target assembly name',\n    },\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames: the query assembly name',\n    },\n    deltaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.delta', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { BaseOptions } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { unzip } from '@gmod/bgzf-filehandle'\nimport PAFAdapter from '../PAFAdapter/PAFAdapter'\n\nfunction isGzip(buf: Buffer) {\n  return buf[0] === 31 && buf[1] === 139 && buf[2] === 8\n}\n\n/* adapted from chain2paf by Andrea Guarracino, license reproduced below\n *\n * MIT License\n *\n * Copyright (c) 2021 Andrea Guarracino\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nfunction generate_record(\n  qname: string,\n  qstart: number,\n  qend: number,\n  qstrand: string,\n  tname: string,\n  tstart: number,\n  tend: number,\n  cigar: string,\n  numMatches: number,\n) {\n  return {\n    qname,\n    qstart,\n    qend,\n    tname,\n    tstart,\n    tend,\n    strand: qstrand === '-' ? -1 : 1,\n    extra: {\n      numMatches,\n      blockLen: Math.max(qend - qstart, tend - tstart),\n      mappingQual: 0,\n      cg: cigar,\n    },\n  }\n}\n\nfunction paf_chain2paf(lines: string[]) {\n  let t_name = ''\n  let t_start = 0\n  let t_end = 0\n  let q_name = ''\n  let q_size = ''\n  let q_strand = ''\n  let q_start = 0\n  let q_end = 0\n  let num_matches = 0\n  let cigar = ''\n  const records = []\n  for (let i = 0; i < lines.length; i++) {\n    const l = lines[i]\n    const l_tab = l.replace(/ /g, '\\t') // There are CHAIN files with space-separated fields\n    const l_vec = l_tab.split('\\t')\n\n    if (l_vec[0] === 'chain') {\n      // Emit previous PAF row, if available\n      if (cigar) {\n        records.push(\n          generate_record(\n            q_name,\n            q_start,\n            q_end,\n            q_strand,\n            t_name,\n            t_start,\n            t_end,\n            cigar,\n            num_matches,\n          ),\n        )\n      }\n\n      // Save query/target information\n      // score -- chain score\n      // tName -- chromosome (reference sequence)\n      // tSize -- chromosome size (reference sequence)\n      // tStrand -- strand (reference sequence)\n      // tStart -- alignment start position (reference sequence)\n      // tEnd -- alignment end position (reference sequence)\n      // qName -- chromosome (query sequence)\n      // qSize -- chromosome size (query sequence)\n      // qStrand -- strand (query sequence)\n      // qStart -- alignment start position (query sequence)\n      // qEnd -- alignment end position (query sequence)\n      // id -- chain ID\n      t_name = l_vec[2]\n      t_start = +l_vec[5]\n      t_end = +l_vec[6]\n      q_name = l_vec[7]\n      q_size = l_vec[8]\n      q_strand = l_vec[9]\n      q_start = +l_vec[10]\n      q_end = +l_vec[11]\n      if (q_strand === '-') {\n        const tmp = q_start\n        q_start = +q_size - q_end\n        q_end = +q_size - tmp\n      }\n\n      // Initialize PAF fields\n      num_matches = 0\n      cigar = ''\n    } else {\n      // size -- the size of the ungapped alignment\n      //\n      // dt -- the difference between the end of this block and the beginning\n      //    of the next block (reference sequence)\n      //\n      // dq -- the difference between the end of this block and the beginning\n      //    of the next block (query sequence)\n      const size_ungapped_alignment = +l_vec[0] || 0\n      const diff_in_target = l_vec.length > 1 ? +l_vec[1] : 0\n      const diff_in_query = l_vec.length > 2 ? +l_vec[2] : 0\n\n      if (size_ungapped_alignment !== 0) {\n        num_matches += +size_ungapped_alignment\n        cigar += size_ungapped_alignment + 'M'\n      }\n      if (diff_in_query !== 0) {\n        cigar += diff_in_query + 'I'\n      }\n      if (diff_in_target !== 0) {\n        cigar += diff_in_target + 'D'\n      }\n    }\n  }\n\n  // Emit last PAF row, if available\n  if (cigar) {\n    generate_record(\n      q_name,\n      q_start,\n      q_end,\n      q_strand,\n      t_name,\n      t_start,\n      t_end,\n      cigar,\n      num_matches,\n    )\n  }\n  return records\n}\n\nexport default class ChainAdapter extends PAFAdapter {\n  async setupPre(opts?: BaseOptions) {\n    const loc = openLocation(this.getConf('chainLocation'), this.pluginManager)\n    const buffer = (await loc.readFile(opts)) as Buffer\n    const buf = isGzip(buffer) ? await unzip(buffer) : buffer\n    // 512MB  max chrome string length is 512MB\n    if (buf.length > 536_870_888) {\n      throw new Error('Data exceeds maximum string length (512MB)')\n    }\n    const text = new TextDecoder('utf8', { fatal: true }).decode(buf)\n    return paf_chain2paf(text.split('\\n').filter(line => !!line))\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'ChainAdapter',\n  {\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Target is the first value in the array, query is the second',\n    },\n    targetAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the target assembly',\n    },\n    queryAssembly: {\n      type: 'string',\n      defaultValue: '',\n      description: 'Alternative to assemblyNames array: the query assembly',\n    },\n    chainLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/file.chain', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\n\nimport PAFAdapterF from './PAFAdapter'\nimport MCScanAnchorsAdapterF from './MCScanAnchorsAdapter'\nimport MCScanSimpleAnchorsAdapterF from './MCScanSimpleAnchorsAdapter'\nimport MashMapAdapterF from './MashMapAdapter'\nimport DeltaAdapterF from './DeltaAdapter'\nimport ChainAdapterF from './ChainAdapter'\n\nimport {\n  getFileName,\n  AdapterGuesser,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class ComparativeAdaptersPlugin extends Plugin {\n  name = 'ComparativeAdaptersPlugin'\n\n  install(pluginManager: PluginManager) {\n    PAFAdapterF(pluginManager)\n    DeltaAdapterF(pluginManager)\n    ChainAdapterF(pluginManager)\n    MCScanAnchorsAdapterF(pluginManager)\n    MCScanSimpleAnchorsAdapterF(pluginManager)\n    MashMapAdapterF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.paf/i\n          const adapterName = 'PAFAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              pafLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'PAFAdapter') {\n            return 'SyntenyTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './PAFAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'PAFAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './DeltaAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'DeltaAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './ChainAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'ChainAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './MCScanAnchorsAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanAnchorsAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './MCScanSimpleAnchorsAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MCScanSimpleAnchorsAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\n\nimport AdapterClass from './MashMapAdapter'\nimport configSchema from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addAdapterType(\n    () =>\n      new AdapterType({\n        name: 'MashMapAdapter',\n        configSchema,\n        adapterMetadata: {\n          category: null,\n          hiddenFromGUI: true,\n          displayName: null,\n          description: null,\n        },\n        AdapterClass,\n      }),\n  )\n}\n","import React, { lazy, useEffect, useState } from 'react'\nimport { useDebounce } from '@jbrowse/core/util'\nimport {\n  FormControl,\n  FormHelperText,\n  InputLabel,\n  makeStyles,\n} from '@material-ui/core'\nimport { observer, PropTypes } from 'mobx-react'\nconst useStyles = makeStyles({\n  error: {\n    color: 'red',\n    fontSize: '0.8em',\n  },\n})\n\nconst CodeEditor = lazy(() => import('./CodeEditor'))\n\nfunction JsonEditor({ slot }) {\n  const classes = useStyles()\n  const [contents, setContents] = useState(\n    JSON.stringify(slot.value, null, '  '),\n  )\n  const [error, setError] = useState()\n  const debouncedJson = useDebounce(contents, 400)\n\n  useEffect(() => {\n    try {\n      slot.set(JSON.parse(debouncedJson))\n      setError(undefined)\n    } catch (e) {\n      setError(e.message)\n    }\n  }, [debouncedJson, slot])\n\n  return (\n    <>\n      {error ? <p className={classes.error}>{error}</p> : null}\n      <FormControl error={error}>\n        <InputLabel shrink htmlFor=\"callback-editor\">\n          {slot.name}\n        </InputLabel>\n        <React.Suspense fallback={<div />}>\n          <CodeEditor contents={contents} setContents={setContents} />\n        </React.Suspense>\n        <FormHelperText>{slot.description}</FormHelperText>\n      </FormControl>\n    </>\n  )\n}\n\nJsonEditor.propTypes = {\n  slot: PropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(JsonEditor)\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default pluginManager =>\n  types\n    .model('ConfigurationEditorWidget', {\n      id: ElementId,\n      type: types.literal('ConfigurationEditorWidget'),\n      // If you add different types of targets, don't forget to account for that\n      // in the key of ./components/ConfigurationEditor.js\n      target: types.safeReference(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .actions(self => ({\n      setTarget(newTarget) {\n        self.target = newTarget\n      },\n    }))\n","import { observer } from 'mobx-react'\nimport { isStateTreeNode, getType } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('ConfigurationEditorWidget', {})\nexport const HeadingComponent = observer(({ model }) => {\n  if (model?.target) {\n    if (model.target.type) {\n      return `${model.target.type} settings`\n    }\n    if (isStateTreeNode(model.target)) {\n      const type = getType(model.target)\n      if (type?.name) {\n        return `${type.name.replace('ConfigurationSchema', '')} settings`\n      }\n    }\n  }\n  return 'Settings'\n})\n","import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SimpleFeature, {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\n\nexport default class FromConfigAdapter extends BaseFeatureDataAdapter {\n  protected features: Map<string, Feature[]>\n\n  constructor(\n    conf: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(conf, getSubAdapter, pluginManager)\n    const feats = readConfObject(conf, 'features') as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(feats || [])\n  }\n\n  static makeFeatures(fdata: SimpleFeatureSerialized[]) {\n    const features = new Map<string, Feature[]>()\n    for (let i = 0; i < fdata.length; i += 1) {\n      if (fdata[i]) {\n        const f = this.makeFeature(fdata[i])\n        const refName = f.get('refName') as string\n        let bucket = features.get(refName)\n        if (!bucket) {\n          bucket = []\n          features.set(refName, bucket)\n        }\n\n        bucket.push(f)\n      }\n    }\n\n    // sort the features on each reference sequence by start coordinate\n    for (const refFeatures of features.values()) {\n      refFeatures.sort((a, b) => a.get('start') - b.get('start'))\n    }\n\n    return features\n  }\n\n  static makeFeature(data: SimpleFeatureSerialized) {\n    return new SimpleFeature(data)\n  }\n\n  async getRefNames() {\n    return [...this.features.keys()]\n  }\n\n  async getRefNameAliases() {\n    return Array.from(this.features.values()).map(featureArray => ({\n      refName: featureArray[0].get('refName'),\n      aliases: featureArray[0].get('aliases'),\n    }))\n  }\n\n  getFeatures(region: NoAssemblyRegion) {\n    const { refName, start, end } = region\n\n    return ObservableCreate<Feature>(async observer => {\n      const features = this.features.get(refName) || []\n      for (let i = 0; i < features.length; i++) {\n        const f = features[i]\n\n        if (f.get('end') > start && f.get('start') < end) {\n          observer.next(f)\n        }\n      }\n      observer.complete()\n    })\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import {\n  BaseAdapter,\n  RegionsAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport {\n  Feature,\n  SimpleFeatureSerialized,\n} from '@jbrowse/core/util/simpleFeature'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { ConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { configSchema as FromConfigAdapterConfigSchema } from './configSchema'\nimport FromConfigAdapter from './FromConfigAdapter'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\n/**\n * Adapter that just returns the features defined in its `features` configuration\n * key, like:\n *   `\"features\": [ { \"refName\": \"ctgA\", \"start\":1, \"end\":20 }, ... ]`\n */\nexport default class FromConfigRegionsAdapter\n  extends BaseAdapter\n  implements RegionsAdapter\n{\n  private features: Map<string, Feature[]>\n\n  constructor(\n    config: ConfigurationModel<typeof FromConfigAdapterConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const features = readConfObject(\n      config,\n      'features',\n    ) as SimpleFeatureSerialized[]\n    this.features = FromConfigAdapter.makeFeatures(features || [])\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    // sort the regions by refName\n    regions.sort((a, b) => a.refName.localeCompare(b.refName))\n\n    return regions\n  }\n\n  freeResources(/* { region } */): void {}\n}\n","import SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { toArray } from 'rxjs/operators'\nimport FromConfigAdapter from './FromConfigAdapter'\n\nexport default class FromConfigSequenceAdapter extends FromConfigAdapter {\n  /**\n   * Fetch features for a certain region\n   * @param region - Region\n   * @returns Observable of Feature objects in the region\n   */\n  getFeatures(region: NoAssemblyRegion) {\n    // TODO: restore commented version below once TSDX supports Rollup v2\n    // xref: https://github.com/rollup/rollup/blob/master/CHANGELOG.md#bug-fixes-45\n    // return ObservableCreate<Feature>(async observer => {\n    //   const feats = await super.getFeatures(region).pipe(toArray()).toPromise()\n    const superGetFeatures = super.getFeatures\n    return ObservableCreate<Feature>(async observer => {\n      const feats = await superGetFeatures\n        .call(this, region)\n        .pipe(toArray())\n        .toPromise()\n      const feat = feats[0]\n      observer.next(\n        new SimpleFeature({\n          ...feat.toJSON(),\n          uniqueId: `${feat.id()}:${region.start}-${region.end}`,\n          end: region.end,\n          start: region.start,\n          seq: feat\n            .get('seq')\n            .slice(\n              Math.max(region.start - feat.get('start'), 0),\n              Math.max(region.end - feat.get('start'), 0),\n            ),\n        }),\n      )\n\n      observer.complete()\n    })\n  }\n\n  /**\n   * Get refName, start, and end for all features after collapsing any overlaps\n   */\n  async getRegions() {\n    const regions = []\n\n    // recall: features are stored in this object sorted by start coordinate\n    for (const [refName, features] of this.features) {\n      let currentRegion\n      for (const feature of features) {\n        if (\n          currentRegion &&\n          currentRegion.end >= feature.get('start') &&\n          currentRegion.start <= feature.get('end')\n        ) {\n          currentRegion.end = feature.get('end')\n        } else {\n          if (currentRegion) {\n            regions.push(currentRegion)\n          }\n          currentRegion = {\n            refName,\n            start: feature.get('start'),\n            end: feature.get('end'),\n          }\n        }\n      }\n      if (currentRegion) {\n        regions.push(currentRegion)\n      }\n    }\n\n    return regions\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the forseeable future and can be purged\n   * from caches, etc\n   */\n  freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const configSchema = ConfigurationSchema(\n  'FromConfigAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport const regionsConfigSchema = ConfigurationSchema(\n  'FromConfigRegionsAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n\nexport const sequenceConfigSchema = ConfigurationSchema(\n  'FromConfigSequenceAdapter',\n  {\n    features: {\n      type: 'frozen',\n      defaultValue: [],\n    },\n    featureClass: {\n      type: 'string',\n      defaultValue: 'SimpleFeature',\n    },\n  },\n  { explicitlyTyped: true, implicitIdentifier: 'adapterId' },\n)\n","import {\n  BaseRefNameAliasAdapter,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { readConfObject } from '@jbrowse/core/configuration'\n\nexport default class RefNameAliasAdapter\n  extends BaseAdapter\n  implements BaseRefNameAliasAdapter\n{\n  async getRefNameAliases() {\n    const loc = readConfObject(this.config, 'location')\n    if (loc.uri === '' || loc.uri === '/path/to/my/aliases.txt') {\n      return []\n    }\n    const results = await openLocation(loc).readFile('utf8')\n    const refColumn = readConfObject(this.config, 'refNameColumn')\n    return results\n      .trim()\n      .split('\\n')\n      .filter(f => !!f && !f.startsWith('#'))\n      .map(row => {\n        const aliases = row.split('\\t')\n        const [refName] = aliases.splice(refColumn, 1)\n        return { refName, aliases: aliases.filter(f => !!f.trim()) }\n      })\n  }\n\n  async freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'RefNameAliasAdapter',\n  {\n    location: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/aliases.txt',\n        locationType: 'UriLocation',\n      },\n    },\n    refNameColumn: {\n      type: 'number',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { lazy } from 'react'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as ConfigurationEditorConfigSchema,\n  HeadingComponent as ConfigurationEditorHeadingComponent,\n  stateModelFactory as ConfigurationEditorStateModelFactory,\n} from './ConfigurationEditorWidget'\nimport {\n  AdapterClass as FromConfigAdapterClass,\n  RegionsAdapterClass as FromConfigRegionsAdapterClass,\n  SequenceAdapterClass as FromConfigSequenceAdapterClass,\n  configSchema as fromConfigAdapterConfigSchema,\n  regionsConfigSchema as fromConfigRegionsAdapterConfigSchema,\n  sequenceConfigSchema as fromConfigSequenceAdapterConfigSchema,\n} from './FromConfigAdapter'\nimport {\n  AdapterClass as RefNameAliasAdapterClass,\n  configSchema as refNameAliasAdapterConfigSchema,\n} from './RefNameAliasAdapter'\n\nconst ConfigurationEditorComponent = lazy(\n  () => import('./ConfigurationEditorWidget/components/ConfigurationEditor'),\n)\n\nexport default class extends Plugin {\n  name = 'ConfigurationPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigAdapter',\n          configSchema: fromConfigAdapterConfigSchema,\n          AdapterClass: FromConfigAdapterClass,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigRegionsAdapter',\n          configSchema: fromConfigRegionsAdapterConfigSchema,\n          AdapterClass: FromConfigRegionsAdapterClass,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'FromConfigSequenceAdapter',\n          configSchema: fromConfigSequenceAdapterConfigSchema,\n          AdapterClass: FromConfigSequenceAdapterClass,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'RefNameAliasAdapter',\n          configSchema: refNameAliasAdapterConfigSchema,\n          AdapterClass: RefNameAliasAdapterClass,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n        }),\n    )\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ConfigurationEditorWidget',\n        HeadingComponent: ConfigurationEditorHeadingComponent,\n        configSchema: ConfigurationEditorConfigSchema,\n        stateModel: ConfigurationEditorStateModelFactory(pluginManager),\n        ReactComponent: ConfigurationEditorComponent,\n      })\n    })\n  }\n}\n\nexport { default as JsonEditor } from './ConfigurationEditorWidget/components/JsonEditor'\n\nexport { ConfigurationEditorComponent as ConfigurationEditor }\n","import { types } from 'mobx-state-tree'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default types.model('AddConnectionModel', {\n  id: ElementId,\n  type: types.literal('AddConnectionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModel } from './model'\nexport const configSchema = ConfigurationSchema('AddConnectionWidget', {})\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  guessAdapter,\n  guessTrackType,\n  UNSUPPORTED,\n  getFileName,\n} from '@jbrowse/core/util/tracks'\n\nfunction isAbsoluteUrl(url = '') {\n  try {\n    new URL(url)\n    return true\n  } catch (error) {\n    return url.startsWith('/')\n  }\n}\ninterface IndexingAttr {\n  attributes: string[]\n  exclude: string[]\n}\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('AddTrackModel', {\n      id: ElementId,\n      type: types.literal('AddTrackWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .volatile(() => ({\n      trackSource: 'fromFile',\n      trackData: undefined as FileLocation | undefined,\n      indexTrackData: undefined as FileLocation | undefined,\n\n      // alts\n      altAssemblyName: '',\n      altTrackName: '',\n      altTrackType: '',\n\n      adapterHint: '',\n      textIndexTrack: true,\n      textIndexingConf: undefined as IndexingAttr | undefined,\n    }))\n    .actions(self => ({\n      setAdapterHint(obj: string) {\n        self.adapterHint = obj\n      },\n      setTrackSource(str: string) {\n        self.trackSource = str\n      },\n      setTextIndexingConf(conf: IndexingAttr) {\n        self.textIndexingConf = conf\n      },\n      setTextIndexTrack(flag: boolean) {\n        self.textIndexTrack = flag\n      },\n      setTrackData(obj: FileLocation) {\n        self.trackData = obj\n      },\n      setIndexTrackData(obj: FileLocation) {\n        self.indexTrackData = obj\n      },\n      setAssembly(str: string) {\n        self.altAssemblyName = str\n      },\n      setTrackName(str: string) {\n        self.altTrackName = str\n      },\n      setTrackType(str: string) {\n        self.altTrackType = str\n      },\n\n      clearData() {\n        self.trackSource = ''\n        self.altTrackName = ''\n        self.altTrackType = ''\n        self.altAssemblyName = ''\n        self.adapterHint = ''\n        self.indexTrackData = undefined\n        self.trackData = undefined\n        self.textIndexingConf = undefined\n        self.textIndexTrack = true\n      },\n    }))\n    .views(self => ({\n      get trackAdapter() {\n        const { trackData, indexTrackData, adapterHint } = self\n\n        return trackData\n          ? guessAdapter(trackData, indexTrackData, adapterHint, self)\n          : undefined\n      },\n\n      get trackName() {\n        return (\n          self.altTrackName ||\n          (self.trackData ? getFileName(self.trackData) : '')\n        )\n      },\n\n      get isFtp() {\n        const { trackData: track, indexTrackData: index } = self\n        return !!(\n          // @ts-ignore\n          (index?.uri?.startsWith('ftp://') || track?.uri?.startsWith('ftp://'))\n        )\n      },\n\n      get isRelativeTrackUrl() {\n        // @ts-ignore\n        const uri = self.trackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      get isRelativeIndexUrl() {\n        // @ts-ignore\n        const uri = self.indexTrackData?.uri\n        return uri ? !isAbsoluteUrl(uri) : false\n      },\n      get isRelativeUrl() {\n        return this.isRelativeIndexUrl || this.isRelativeTrackUrl\n      },\n\n      get trackHttp() {\n        // @ts-ignore\n        return self.trackData?.uri?.startsWith('http://')\n      },\n      get indexHttp() {\n        // @ts-ignore\n        return self.indexTrackData?.uri?.startsWith('http://')\n      },\n\n      get wrongProtocol() {\n        return (\n          window.location.protocol === 'https:' &&\n          (this.trackHttp || this.indexHttp)\n        )\n      },\n\n      get unsupported() {\n        return this.trackAdapter?.type === UNSUPPORTED\n      },\n\n      get assembly() {\n        return self.altAssemblyName || self.view.assemblyNames?.[0]\n      },\n\n      get trackType() {\n        return (\n          self.altTrackType ||\n          (this.trackAdapter\n            ? guessTrackType(this.trackAdapter.type, self)\n            : '')\n        )\n      },\n    }))\n    .views(self => ({\n      get warningMessage() {\n        if (self.isFtp) {\n          return `Warning: JBrowse cannot access files using the ftp protocol`\n        } else if (self.isRelativeUrl) {\n          return `Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.`\n        } else if (self.wrongProtocol) {\n          return `Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol`\n        }\n        return ''\n      },\n    }))\n}\n\nexport type AddTrackStateModel = ReturnType<typeof f>\nexport type AddTrackModel = Instance<AddTrackStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('AddTrackWidget', {})\n","import { types, getParent, Instance } from 'mobx-state-tree'\nimport {\n  AnyConfigurationModel,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractView } from 'react'\n\nfunction hasAnyOverlap<T>(a1: T[] = [], a2: T[] = []) {\n  return !!a1.find(value => a2.includes(value))\n}\n\nfunction passesFilter(filter: string, config: AnyConfigurationModel) {\n  const categories = readConfObject(config, 'category') as string[] | undefined\n  const filterLower = filter.toLowerCase()\n  return (\n    getTrackName(config).toLowerCase().includes(filterLower) ||\n    categories?.filter(c => c.toLowerCase().includes(filterLower)).length\n  )\n}\n\nfunction getTrackName(config: AnyConfigurationModel) {\n  if (!config.trackId) {\n    throw new Error('not a track')\n  }\n  return (\n    readConfObject(config, 'name') ||\n    `Reference sequence (${readConfObject(getParent(config), 'name')})`\n  )\n}\n\nexport type TreeNode = {\n  name: string\n  id: string\n  conf?: AnyConfigurationModel\n  checked?: boolean\n  isOpenByDefault?: boolean\n  children: TreeNode[]\n}\n\nexport function generateHierarchy(\n  model: HierarchicalTrackSelectorModel,\n  trackConfigurations: AnyConfigurationModel[],\n  collapsed: { get: (arg: string) => boolean | undefined },\n) {\n  const hierarchy = { children: [] as TreeNode[] } as TreeNode\n  const { filterText, view } = model\n\n  trackConfigurations\n    .filter(conf => passesFilter(filterText, conf))\n    .forEach(conf => {\n      // copy the categories since this array can be mutated downstream\n      const categories = [...(readConfObject(conf, 'category') || [])]\n\n      // silly thing where if trackId ends with sessionTrack, then push it to\n      // a category that starts with a space to force sort to the top...\n      // double whammy hackyness\n      if (conf.trackId.endsWith('sessionTrack')) {\n        categories.unshift(' Session tracks')\n      }\n\n      let currLevel = hierarchy\n\n      // find existing category to put track into or create it\n      for (let i = 0; i < categories.length; i++) {\n        const category = categories[i]\n        const ret = currLevel.children.find(c => c.name === category)\n        const id = categories.slice(0, i + 1).join(',')\n        if (!ret) {\n          const n = {\n            children: [],\n            name: category,\n            id,\n            isOpenByDefault: !collapsed.get(id),\n          }\n          currLevel.children.push(n)\n          currLevel = n\n        } else {\n          currLevel = ret\n        }\n      }\n      const tracks = view.tracks as { configuration: AnyConfigurationModel }[]\n\n      // using splice here tries to group leaf nodes above hierarchical nodes\n      currLevel.children.splice(\n        currLevel.children.findIndex(elt => elt.children.length),\n        0,\n        {\n          id: conf.trackId,\n          name: getTrackName(conf),\n          conf,\n          checked: !!tracks.find(f => f.configuration === conf),\n          children: [],\n        },\n      )\n    })\n\n  return hierarchy.children\n}\n\nexport default function stateTreeFactory(pluginManager: PluginManager) {\n  return types\n    .model('HierarchicalTrackSelectorWidget', {\n      id: ElementId,\n      type: types.literal('HierarchicalTrackSelectorWidget'),\n      collapsed: types.map(types.boolean),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      setView(view: AbstractView) {\n        self.view = view\n      },\n      toggleCategory(pathName: string) {\n        self.collapsed.set(pathName, !self.collapsed.get(pathName))\n      },\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n    .views(self => ({\n      getRefSeqTrackConf(assemblyName: string) {\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        const trackConf = assembly?.configuration.sequence\n        const viewType = pluginManager.getViewType(self.view.type)\n        if (!trackConf) {\n          return undefined\n        }\n        for (const display of trackConf.displays) {\n          if (viewType.displayTypes.find(d => d.name === display.type)) {\n            return trackConf\n          }\n        }\n      },\n    }))\n    .views(self => ({\n      trackConfigurations(assemblyName: string) {\n        if (!self.view) {\n          return []\n        }\n        const { tracks, assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n        if (!assembly) {\n          return []\n        }\n        const refseq = self.getRefSeqTrackConf(assemblyName)\n        // filter out tracks that don't match the current assembly (check all\n        // assembly aliases) and display types\n        return (refseq ? [refseq] : []).concat([\n          ...tracks\n            .filter(c => {\n              const trackConfAssemblies = readConfObject(c, 'assemblyNames')\n              const { allAliases } = assembly\n              return hasAnyOverlap(allAliases, trackConfAssemblies)\n            })\n            .filter(c => {\n              const { displayTypes } = pluginManager.getViewType(self.view.type)\n              const compatibleDisplays = displayTypes.map(d => d.name)\n              const trackDisplays = c.displays.map(\n                (d: { type: string }) => d.type,\n              )\n              return hasAnyOverlap(compatibleDisplays, trackDisplays)\n            }),\n        ])\n      },\n\n      get assemblyNames(): string[] {\n        return self.view?.assemblyNames || []\n      },\n\n      connectionTrackConfigurations(\n        assemblyName: string,\n        connection: { tracks: AnyConfigurationModel[] },\n      ) {\n        if (!self.view) {\n          return []\n        }\n        const trackConfigurations = connection.tracks\n        const { assemblyManager } = getSession(self)\n        const assembly = assemblyManager.get(assemblyName)\n\n        if (!(assembly && assembly.initialized)) {\n          return []\n        }\n\n        // filter out tracks that don't match the current display types\n        return trackConfigurations\n          .filter(c => {\n            const trackConfAssemblies = readConfObject(c, 'assemblyNames')\n            const { allAliases } = assembly\n            return hasAnyOverlap(allAliases, trackConfAssemblies)\n          })\n          .filter(c => {\n            const { displayTypes } = pluginManager.getViewType(self.view.type)\n            const compatibleDisplays = displayTypes.map(d => d.name)\n            const trackDisplays = c.displays.map(\n              (d: { type: string }) => d.type,\n            )\n            return hasAnyOverlap(compatibleDisplays, trackDisplays)\n          })\n      },\n    }))\n    .views(self => ({\n      hierarchy(assemblyName: string) {\n        const hier = generateHierarchy(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          self.trackConfigurations(assemblyName),\n          self.collapsed,\n        )\n\n        const session = getSession(self)\n        const { connections, connectionInstances } = session\n        const conns =\n          connectionInstances\n            ?.filter(c => {\n              const names = getConf(c, 'assemblyNames')\n              return names.length === 0 ? true : names.includes(assemblyName)\n            })\n            .map((conn, index) => {\n              const c = connections[index]\n              return {\n                id: c.connectionId,\n                name: readConfObject(c, 'name'),\n                children: this.connectionHierarchy(assemblyName, conn),\n                state: {\n                  expanded: true,\n                },\n              }\n            }) || []\n\n        return {\n          name: 'Root',\n          id: 'Root',\n          children: [\n            { name: 'Tracks', id: 'Tracks', children: hier },\n            ...conns,\n          ],\n        }\n      },\n\n      connectionHierarchy(\n        assemblyName: string,\n        connection: { tracks: AnyConfigurationModel[] },\n      ) {\n        return generateHierarchy(\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          self as any,\n          self.connectionTrackConfigurations(assemblyName, connection),\n          self.collapsed,\n        )\n      },\n    }))\n}\n\nexport type HierarchicalTrackSelectorStateModel = ReturnType<\n  typeof stateTreeFactory\n>\nexport type HierarchicalTrackSelectorModel =\n  Instance<HierarchicalTrackSelectorStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema(\n  'HierarchicalTrackSelectorWidget',\n  {},\n)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogActions,\n  DialogContent,\n  IconButton,\n  ListItem,\n  Tooltip,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\nimport CloseIcon from '@material-ui/icons/Close'\nimport LockIcon from '@material-ui/icons/Lock'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  BasePlugin,\n  isSessionWithSessionPlugins,\n} from '@jbrowse/core/util/types'\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n  lockedPluginTooltip: {\n    marginRight: '0.5rem',\n  },\n}))\n\nfunction LockedPlugin() {\n  const classes = useStyles()\n  return (\n    <Tooltip\n      className={classes.lockedPluginTooltip}\n      title=\"This plugin was installed by an administrator, you cannot remove it.\"\n    >\n      <LockIcon />\n    </Tooltip>\n  )\n}\n\nfunction PluginDialog({\n  onClose,\n  plugin,\n}: {\n  plugin: string\n  onClose: (s?: string) => void\n}) {\n  const classes = useStyles()\n  return (\n    <Dialog open onClose={() => onClose()}>\n      <DialogTitle>\n        <IconButton\n          className={classes.closeDialog}\n          aria-label=\"close-dialog\"\n          onClick={() => onClose()}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography>\n          Please confirm that you want to remove {plugin}. Note: if any\n          resources in this session still use this plugin, it may cause your\n          session to crash\n        </Typography>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              // avoid showing runtime plugin warning\n              window.setTimeout(() => {\n                onClose(plugin)\n              }, 500)\n            }}\n          >\n            Confirm\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            onClick={() => {\n              onClose()\n            }}\n          >\n            Cancel\n          </Button>\n        </DialogActions>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nfunction InstalledPlugin({\n  plugin,\n  model,\n  pluginManager,\n}: {\n  plugin: BasePlugin\n  model: PluginStoreModel\n  pluginManager: PluginManager\n}) {\n  const [dialogPlugin, setDialogPlugin] = useState<string>()\n\n  const session = getSession(model)\n  const { sessionPlugins } = session as unknown as {\n    sessionPlugins: BasePlugin[]\n  }\n  const isSessionPlugin = sessionPlugins?.some(\n    p => pluginManager.pluginMetadata[plugin.name].url === p.url,\n  )\n\n  const rootModel = getParent(model, 3)\n  const { jbrowse, adminMode } = rootModel\n\n  return (\n    <>\n      {dialogPlugin ? (\n        <PluginDialog\n          plugin={dialogPlugin}\n          onClose={name => {\n            if (name) {\n              const pluginMetadata = pluginManager.pluginMetadata[plugin.name]\n\n              if (adminMode) {\n                jbrowse.removePlugin(pluginMetadata)\n              } else if (isSessionWithSessionPlugins(session)) {\n                session.removeSessionPlugin(pluginMetadata)\n              }\n            }\n            setDialogPlugin(undefined)\n          }}\n        />\n      ) : null}\n      <ListItem key={plugin.name}>\n        {adminMode || isSessionPlugin ? (\n          <IconButton\n            aria-label=\"removePlugin\"\n            data-testid={`removePlugin-${plugin.name}`}\n            onClick={() => setDialogPlugin(plugin.name)}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : (\n          <LockedPlugin />\n        )}\n        <Typography>{plugin.name}</Typography>\n      </ListItem>\n    </>\n  )\n}\n\nexport default observer(InstalledPlugin)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { List, Typography } from '@material-ui/core'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { PluginStoreModel } from '../model'\nimport InstalledPlugin from './InstalledPlugin'\n\nfunction InstalledPluginsList({\n  pluginManager,\n  model,\n}: {\n  pluginManager: PluginManager\n  model: PluginStoreModel\n}) {\n  const { plugins } = pluginManager as PluginManager\n\n  const corePlugins = plugins\n    .filter(p => pluginManager.pluginMetadata[p.name]?.isCore)\n    .map(p => p.name)\n\n  const externalPlugins = plugins.filter(\n    plugin => !corePlugins.includes(plugin.name),\n  )\n\n  return (\n    <List>\n      {externalPlugins.length ? (\n        externalPlugins\n          .filter(plugin =>\n            plugin.name.toLowerCase().includes(model.filterText.toLowerCase()),\n          )\n          .map(plugin => (\n            <InstalledPlugin\n              key={plugin.name}\n              plugin={plugin}\n              model={model}\n              pluginManager={pluginManager}\n            />\n          ))\n      ) : (\n        <Typography>No plugins currently installed</Typography>\n      )}\n    </List>\n  )\n}\n\nexport default observer(InstalledPluginsList)\n","import React, { useState } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { observer } from 'mobx-react'\nimport { getEnv, getParent } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  JBrowsePlugin,\n  isSessionWithSessionPlugins,\n} from '@jbrowse/core/util/types'\nimport {\n  Card,\n  CardActions,\n  CardContent,\n  Button,\n  Link,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\n// icons\nimport PersonIcon from '@material-ui/icons/Person'\nimport AddIcon from '@material-ui/icons/Add'\nimport CheckIcon from '@material-ui/icons/Check'\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  card: {\n    margin: '1em',\n  },\n  icon: {\n    marginLeft: '0.5em',\n    marginRight: '0.5em',\n  },\n  bold: {\n    fontWeight: 600,\n  },\n  dataField: {\n    display: 'flex',\n    alignItems: 'center',\n    margin: '0.4em 0em',\n  },\n}))\n\nfunction PluginCard({\n  plugin,\n  model,\n  adminMode,\n}: {\n  plugin: JBrowsePlugin\n  model: PluginStoreModel\n  adminMode: boolean\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(model) as { pluginManager: PluginManager }\n  const isInstalled = Boolean(\n    pluginManager.runtimePluginDefinitions.find(\n      pluginDefinition => pluginDefinition.url === plugin.url,\n    ),\n  )\n  const [tempDisabled, setTempDisabled] = useState(false)\n  const disableButton = isInstalled || tempDisabled\n\n  const rootModel = getParent(model, 3)\n  const { jbrowse } = rootModel\n\n  return (\n    <Card variant=\"outlined\" key={plugin.name} className={classes.card}>\n      <CardContent>\n        <div className={classes.dataField}>\n          <Typography variant=\"h5\">\n            <Link\n              href={`${plugin.location}#readme`}\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              {plugin.name}\n            </Link>\n          </Typography>\n        </div>\n        <div className={classes.dataField}>\n          <PersonIcon style={{ marginRight: '0.5em' }} />\n          <Typography>{plugin.authors.join(', ')}</Typography>\n        </div>\n        <Typography className={classes.bold}>Description:</Typography>\n        <Typography>{plugin.description}</Typography>\n      </CardContent>\n      <CardActions>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          disabled={disableButton}\n          startIcon={isInstalled ? <CheckIcon /> : <AddIcon />}\n          onClick={() => {\n            if (adminMode) {\n              jbrowse.addPlugin({ name: plugin.name, url: plugin.url })\n            } else if (isSessionWithSessionPlugins(session)) {\n              session.addSessionPlugin(plugin)\n            }\n            setTempDisabled(true)\n          }}\n        >\n          {isInstalled ? 'Installed' : 'Install'}\n        </Button>\n      </CardActions>\n    </Card>\n  )\n}\n\nexport default observer(PluginCard)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getRoot } from 'mobx-state-tree'\nimport clsx from 'clsx'\n\nimport {\n  Button,\n  Collapse,\n  Dialog,\n  DialogActions,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  TextField,\n  makeStyles,\n} from '@material-ui/core'\n\n// icons\nimport IconButton from '@material-ui/core/IconButton'\nimport CloseIcon from '@material-ui/icons/Close'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\n\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\n\n// locals\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  },\n  dialogContent: {\n    display: 'flex',\n    flexDirection: 'column',\n  },\n  expand: {\n    transform: 'rotate(0deg)',\n    marginLeft: 'auto',\n    transition: theme.transitions.create('transform', {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  expandOpen: {\n    transform: 'rotate(180deg)',\n  },\n}))\n\nfunction CustomPluginForm({\n  open,\n  onClose,\n  model,\n}: {\n  open: boolean\n  onClose(): void\n  model: PluginStoreModel\n}) {\n  const classes = useStyles()\n  const [umdPluginName, setUMDPluginName] = useState('')\n  const [umdPluginUrl, setUMDPluginUrl] = useState('')\n  const [esmPluginUrl, setESMPluginUrl] = useState('')\n  const [cjsPluginUrl, setCJSPluginUrl] = useState('')\n  const [advancedOptionsOpen, setAdvancedOptionsOpen] = useState(false)\n\n  function handleChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\n    const { name, value } = event.target\n    if (name === 'umdName') {\n      setUMDPluginName(value)\n    }\n    if (name === 'umdUrl') {\n      setUMDPluginUrl(value)\n    }\n    if (name === 'esmUrl') {\n      setESMPluginUrl(value)\n    }\n    if (name === 'cjsUrl') {\n      setCJSPluginUrl(value)\n    }\n  }\n\n  function handleOpenAdvancedOptions() {\n    setAdvancedOptionsOpen(!advancedOptionsOpen)\n  }\n\n  const rootModel = getRoot(model)\n  const { jbrowse } = rootModel\n\n  const ready = Boolean(\n    (umdPluginName && umdPluginUrl) || esmPluginUrl || cjsPluginUrl,\n  )\n\n  function handleSubmit() {\n    if (!ready) {\n      return\n    }\n    const pluginDefinition: PluginDefinition = {}\n    if (umdPluginName && umdPluginUrl) {\n      pluginDefinition.name = umdPluginName\n      pluginDefinition.umdUrl = umdPluginUrl\n    }\n    if (esmPluginUrl) {\n      pluginDefinition.esmUrl = esmPluginUrl\n    }\n    if (cjsPluginUrl) {\n      pluginDefinition.cjsUrl = cjsPluginUrl\n    }\n    jbrowse.addPlugin(pluginDefinition)\n  }\n\n  function handleClose() {\n    setUMDPluginName('')\n    setUMDPluginUrl('')\n    setESMPluginUrl('')\n    setCJSPluginUrl('')\n    onClose()\n  }\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <DialogTitle>\n        Add custom plugin\n        <IconButton\n          size=\"medium\"\n          className={classes.closeButton}\n          onClick={() => onClose()}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <form onSubmit={handleSubmit}>\n        <DialogContent className={classes.dialogContent}>\n          <DialogContentText>\n            Enter the name of the plugin and its URL. The name should match what\n            is defined in the plugin&apos;s build.\n          </DialogContentText>\n          <TextField\n            id=\"umd-name-input\"\n            name=\"umdName\"\n            label=\"Plugin name\"\n            variant=\"outlined\"\n            value={umdPluginName}\n            onChange={handleChange}\n          />\n          <TextField\n            id=\"umd-url-input\"\n            name=\"umdUrl\"\n            label=\"Plugin URL\"\n            variant=\"outlined\"\n            value={umdPluginUrl}\n            onChange={handleChange}\n          />\n          <DialogContentText onClick={handleOpenAdvancedOptions}>\n            <IconButton\n              className={clsx(classes.expand, {\n                [classes.expandOpen]: advancedOptionsOpen,\n              })}\n              aria-expanded={advancedOptionsOpen}\n              aria-label=\"show more\"\n            >\n              <ExpandMoreIcon />\n            </IconButton>\n            Advanced options\n          </DialogContentText>\n          <Collapse in={advancedOptionsOpen}>\n            <div className={classes.dialogContent}>\n              <DialogContentText>\n                The above fields assume that the plugin is built in UMD format.\n                If your plugin is in another format, or you have additional\n                builds you want to add (such as a CJS build for using NodeJS\n                APIs in desktop), you can enter the URLs for those builds below.\n              </DialogContentText>\n              <TextField\n                id=\"esm-url-input\"\n                name=\"esmUrl\"\n                label=\"ESM build URL\"\n                variant=\"outlined\"\n                value={esmPluginUrl}\n                onChange={handleChange}\n              />\n              <TextField\n                id=\"cjs-url-input\"\n                name=\"cjsUrl\"\n                label=\"CJS build URL\"\n                variant=\"outlined\"\n                value={cjsPluginUrl}\n                onChange={handleChange}\n              />\n            </div>\n          </Collapse>\n        </DialogContent>\n        <DialogActions>\n          <Button variant=\"contained\" onClick={handleClose}>\n            Cancel\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={handleSubmit}\n            disabled={!ready}\n          >\n            Submit\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  )\n}\n\nexport default observer(CustomPluginForm)\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getEnv } from 'mobx-state-tree'\n\nimport {\n  Accordion,\n  AccordionSummary,\n  TextField,\n  InputAdornment,\n  Button,\n  IconButton,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\n\nimport { JBrowsePlugin } from '@jbrowse/core/util/types'\nimport { getSession, isElectron } from '@jbrowse/core/util'\n\n// icons\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport InfoOutlinedIcon from '@material-ui/icons/InfoOutlined'\n\n// locals\nimport InstalledPluginsList from './InstalledPluginsList'\nimport PluginCard from './PluginCard'\nimport CustomPluginForm from './CustomPluginForm'\nimport { PluginStoreModel } from '../model'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    margin: theme.spacing(1),\n  },\n  expandIcon: {\n    color: '#fff',\n  },\n  adminBadge: {\n    margin: '0.5em',\n    borderRadius: 3,\n    // this is the quaternary color in JB2 palette\n    backgroundColor: '#FFB11D',\n    padding: '1em',\n    display: 'flex',\n    alignContent: 'center',\n  },\n  customPluginButton: {\n    margin: '0.5em',\n    display: 'flex',\n    justifyContent: 'center',\n  },\n}))\n\nfunction PluginStoreWidget({ model }: { model: PluginStoreModel }) {\n  const classes = useStyles()\n  const [pluginArray, setPluginArray] = useState<JBrowsePlugin[]>()\n  const [error, setError] = useState<unknown>()\n  const [customPluginFormOpen, setCustomPluginFormOpen] = useState(false)\n  const { adminMode } = getSession(model)\n  const { pluginManager } = getEnv(model)\n\n  useEffect(() => {\n    const controller = new AbortController()\n    const { signal } = controller\n\n    ;(async () => {\n      try {\n        const response = await fetch(\n          'https://jbrowse.org/plugin-store/plugins.json',\n          { signal },\n        )\n        if (!response.ok) {\n          const err = await response.text()\n          throw new Error(\n            `Failed to fetch plugin data: ${response.status} ${response.statusText} ${err}`,\n          )\n        }\n        const array = await response.json()\n        if (!signal.aborted) {\n          setPluginArray(array.plugins)\n        }\n      } catch (e) {\n        console.error(e)\n        setError(e)\n      }\n    })()\n\n    return () => {\n      controller.abort()\n    }\n  }, [])\n\n  return (\n    <div className={classes.root}>\n      {adminMode && (\n        <>\n          {!isElectron && (\n            <div className={classes.adminBadge}>\n              <InfoOutlinedIcon style={{ marginRight: '0.3em' }} />\n              <Typography>\n                You are using the <code>admin-server</code>. Any changes you\n                make will be saved to your configuration file. You also have the\n                ability to add custom plugins that are not in the store.\n              </Typography>\n            </div>\n          )}\n          <div className={classes.customPluginButton}>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => setCustomPluginFormOpen(true)}\n            >\n              Add custom plugin\n            </Button>\n          </div>\n          <CustomPluginForm\n            open={customPluginFormOpen}\n            onClose={() => setCustomPluginFormOpen(false)}\n            model={model}\n          />\n        </>\n      )}\n      <TextField\n        label=\"Filter plugins\"\n        value={model.filterText}\n        onChange={event => model.setFilterText(event.target.value)}\n        fullWidth\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">\n              <IconButton\n                color=\"secondary\"\n                onClick={() => model.clearFilterText()}\n              >\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n      <Accordion defaultExpanded>\n        <AccordionSummary\n          expandIcon={<ExpandMoreIcon className={classes.expandIcon} />}\n        >\n          <Typography variant=\"h5\">Installed plugins</Typography>\n        </AccordionSummary>\n        <div style={{ margin: '1em' }}>\n          <InstalledPluginsList pluginManager={pluginManager} model={model} />\n        </div>\n      </Accordion>\n      <Accordion defaultExpanded>\n        <AccordionSummary\n          expandIcon={<ExpandMoreIcon className={classes.expandIcon} />}\n        >\n          <Typography variant=\"h5\">Available plugins</Typography>\n        </AccordionSummary>\n        {error ? (\n          <Typography color=\"error\">{`${error}`}</Typography>\n        ) : pluginArray ? (\n          pluginArray\n            .filter(plugin => {\n              // If pugin only has cjsUrl, don't display outside desktop\n              if (\n                !isElectron &&\n                !(plugin.esmUrl || plugin.url || plugin.umdUrl)\n              ) {\n                return false\n              }\n              return plugin.name\n                .toLowerCase()\n                .includes(model.filterText.toLowerCase())\n            })\n            .map(plugin => (\n              <PluginCard\n                key={(plugin as JBrowsePlugin).name}\n                plugin={plugin}\n                model={model}\n                adminMode={!!adminMode}\n              />\n            ))\n        ) : (\n          <Typography>Loading...</Typography>\n        )}\n      </Accordion>\n    </div>\n  )\n}\n\nexport default observer(PluginStoreWidget)\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('PluginStoreModel', {\n      id: ElementId,\n      type: types.literal('PluginStoreWidget'),\n      filterText: '',\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      clearFilterText() {\n        self.filterText = ''\n      },\n      setFilterText(newText: string) {\n        self.filterText = newText\n      },\n    }))\n}\n\nexport type PluginStoreStateModel = ReturnType<typeof f>\nexport type PluginStoreModel = Instance<PluginStoreStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/PluginStoreWidget'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('PluginStoreWidget', {})\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'UCSCTrackHubConnection',\n  {\n    hubTxtLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/path/to/hub.txt',\n        locationType: 'UriLocation',\n      },\n      description: 'location of the hub file (usually called hub.txt)',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'optional list of genomes to import from this track hub, if empty all genomes will be imported',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","// These are the assemblies for which there is a sequence file located at\n// http://hgdownload.soe.ucsc.edu/goldenPath/${assemblyName}/bigZips/${assemblyName}.2bit\n// This list was generated by `getUcscAssemblies.js`\n\nexport default `ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9`.split(/\\r?\\n/)\n","import { objectHash } from '@jbrowse/core/util'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport {\n  generateUnsupportedTrackConf,\n  generateUnknownTrackConf,\n} from '@jbrowse/core/util/tracks'\nimport ucscAssemblies from './ucscAssemblies'\n\nexport { ucscAssemblies }\n\nexport async function fetchHubFile(hubFileLocation) {\n  try {\n    const hubFileText = await openLocation(hubFileLocation).readFile('utf8')\n    const { HubFile } = await import('@gmod/ucsc-hub')\n    return new HubFile(hubFileText)\n  } catch (error) {\n    throw new Error(`Not a valid hub.txt file, got error: '${error}'`)\n  }\n}\n\nexport async function fetchGenomesFile(genomesFileLocation) {\n  const genomesFileText = await openLocation(genomesFileLocation).readFile(\n    'utf8',\n  )\n  const { GenomesFile } = await import('@gmod/ucsc-hub')\n  return new GenomesFile(genomesFileText)\n}\n\nexport async function fetchTrackDbFile(trackDbFileLocation) {\n  const text = await openLocation(trackDbFileLocation).readFile('utf8')\n  const { TrackDbFile } = await import('@gmod/ucsc-hub')\n  return new TrackDbFile(text)\n}\n\nexport function generateTracks(\n  trackDb,\n  trackDbFileLocation,\n  assemblyName,\n  sequenceAdapter,\n) {\n  const tracks = []\n\n  trackDb.forEach((track, trackName) => {\n    const trackKeys = Array.from(track.keys())\n    const parentTrackKeys = [\n      'superTrack',\n      'compositeTrack',\n      'container',\n      'view',\n    ]\n    if (trackKeys.some(key => parentTrackKeys.includes(key))) {\n      return\n    }\n    const parentTracks = []\n    let currentTrackName = trackName\n    do {\n      currentTrackName = trackDb.get(currentTrackName).get('parent')\n      if (currentTrackName) {\n        ;[currentTrackName] = currentTrackName.split(' ')\n        parentTracks.push(trackDb.get(currentTrackName))\n      }\n    } while (currentTrackName)\n    parentTracks.reverse()\n    const categories = parentTracks.map(parentTrack =>\n      parentTrack.get('shortLabel'),\n    )\n    const res = makeTrackConfig(\n      track,\n      categories,\n      trackDbFileLocation,\n      trackDb,\n      sequenceAdapter,\n    )\n    res.trackId = `ucsc-trackhub-${objectHash(res)}`\n    res.assemblyNames = [assemblyName]\n    tracks.push(res)\n  })\n\n  return tracks\n}\n\nfunction makeTrackConfig(\n  track,\n  categories,\n  trackDbFileLocation,\n  trackDb,\n  sequenceAdapter,\n) {\n  let trackType = track.get('type')\n  if (!trackType) {\n    trackType = trackDb.get(track.get('parent')).get('type')\n  }\n  let baseTrackType = trackType.split(' ')[0]\n  if (\n    baseTrackType === 'bam' &&\n    track.get('bigDataUrl').toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  let bigDataLocation\n  if (trackDbFileLocation.uri) {\n    bigDataLocation = {\n      uri: new URL(track.get('bigDataUrl'), trackDbFileLocation.uri).href,\n      locationType: 'UriLocation',\n    }\n  } else {\n    bigDataLocation = {\n      localPath: track.get('bigDataUrl'),\n      locationType: 'LocalPathLocation',\n    }\n  }\n  let bigDataIndexLocation\n\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.bai`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bed5FloatScore':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedGraph':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bedRnaElements':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigBarChart':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigBed':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigGenePred':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigChain':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigInteract':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigMaf':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigPsl':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n        renderer: {\n          type: 'SvgFeatureRenderer',\n        },\n      }\n    case 'bigWig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'coloredExon':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.crai`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.crai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          cramLocation: bigDataLocation,\n          craiLocation: bigDataIndexLocation,\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'narrowPeak':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'bigNarrowPeak':\n      return {\n        type: 'FeatureTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'peptideMapping':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'vcfTabix':\n      if (trackDbFileLocation.uri) {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              uri: new URL(track.get('bigDataIndex'), trackDbFileLocation.uri)\n                .href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(\n                `${track.get('bigDataUrl')}.tbi`,\n                trackDbFileLocation.uri,\n              ).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.get('bigDataIndex')\n          ? {\n              localPath: track.get('bigDataIndex'),\n              locationType: 'LocalPathLocation',\n            }\n          : {\n              localPath: `${track.get('bigDataUrl')}.tbi`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'VariantTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'VcfTabixAdapter',\n          vcfGzLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'wigMaf':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n    case 'hic':\n      return {\n        type: 'HicTrack',\n        name: track.get('shortLabel'),\n        description: track.get('longLabel'),\n        category: categories,\n        adapter: {\n          type: 'HicAdapter',\n          hicLocation: bigDataLocation,\n        },\n      }\n    case 'halSnake':\n      return generateUnsupportedTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n\n    default:\n      return generateUnknownTrackConf(\n        track.get('shortLabel'),\n        baseTrackType,\n        categories,\n      )\n  }\n}\n","import { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  ConfigurationReference,\n  readConfObject,\n  getConf,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport {\n  fetchGenomesFile,\n  fetchHubFile,\n  fetchTrackDbFile,\n  generateTracks,\n} from './ucscTrackHub'\n\nexport default function UCSCTrackHubConnection(pluginManager) {\n  return types.compose(\n    'UCSCTrackHubConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('UCSCTrackHubConnection'),\n      })\n      .actions(self => ({\n        connect() {\n          const connectionName = getConf(self, 'name')\n          const hubFileLocation = getConf(self, 'hubTxtLocation')\n          const session = getSession(self)\n          fetchHubFile(hubFileLocation)\n            .then(hubFile => {\n              const genomesFileLocation = hubFileLocation.uri\n                ? {\n                    uri: new URL(\n                      hubFile.get('genomesFile'),\n                      hubFileLocation.uri,\n                    ).href,\n                    locationType: 'UriLocation',\n                  }\n                : {\n                    localPath: hubFile.get('genomesFile'),\n                    locationType: 'LocalPathLocation',\n                  }\n              return Promise.all([\n                hubFile,\n                fetchGenomesFile(genomesFileLocation),\n              ])\n            })\n            .then(([hubFile, genomesFile]) => {\n              const trackDbData = []\n              for (const [genomeName, genome] of genomesFile) {\n                const assemblyNames = getConf(self, 'assemblyNames')\n                if (\n                  assemblyNames.length > 0 &&\n                  !assemblyNames.includes(genomeName)\n                ) {\n                  break\n                }\n                const assemblyConf = session.assemblies.find(\n                  assembly => readConfObject(assembly, 'name') === genomeName,\n                )\n                if (!assemblyConf) {\n                  throw new Error(\n                    `Cannot find assembly for \"${genomeName}\" from the genomes file for connection \"${connectionName}\"`,\n                  )\n                }\n                const trackDbFileLocation = hubFileLocation.uri\n                  ? {\n                      uri: new URL(\n                        genome.get('trackDb'),\n                        new URL(\n                          hubFile.get('genomesFile'),\n                          hubFileLocation.uri,\n                        ),\n                      ).href,\n                      locationType: 'UriLocation',\n                    }\n                  : {\n                      localPath: genome.get('trackDb'),\n                      locationType: 'LocalPathLocation',\n                    }\n                trackDbData.push(\n                  Promise.all([\n                    trackDbFileLocation,\n                    fetchTrackDbFile(trackDbFileLocation),\n                    genomeName,\n                    assemblyConf,\n                  ]),\n                )\n              }\n              return Promise.all([...trackDbData])\n            })\n            .then(trackDbData => {\n              for (const [\n                trackDbFileLocation,\n                trackDbFile,\n                genomeName,\n                assemblyConf,\n              ] of trackDbData) {\n                const sequenceAdapter = readConfObject(assemblyConf, [\n                  'sequence',\n                  'adapter',\n                ])\n                const tracks = generateTracks(\n                  trackDbFile,\n                  trackDbFileLocation,\n                  genomeName,\n                  sequenceAdapter,\n                )\n                self.addTrackConfs(tracks)\n              }\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the UCSC Track Hub \"${self.name}\". Please make sure you have entered a valid hub.txt file. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Dotplot1DViewModel } from '../model'\n\nexport function locstr(\n  px: number,\n  view: Dotplot1DViewModel,\n  includeAsm = true,\n) {\n  const { assemblyName, refName, start, offset, oob } = view.pxToBp(px)\n  const coord = Math.floor(start + offset)\n  return oob\n    ? 'out of bounds'\n    : `${\n        includeAsm ? '{' + assemblyName + '}' : ''\n      }${refName}:${coord.toLocaleString('en-US')}`\n}\n\nexport function getBlockLabelKeysToHide(\n  blocks: BaseBlock[],\n  length: number,\n  viewOffsetPx: number,\n) {\n  const blockLabelKeysToHide: string[] = []\n  const sortedBlocks = blocks.slice(0).sort((a, b) => {\n    const alen = a.end - a.start\n    const blen = b.end - b.start\n    return blen - alen\n  })\n  const positions = new Array(Math.round(length))\n  sortedBlocks.forEach(({ key, offsetPx }) => {\n    const y = Math.round(length - offsetPx + viewOffsetPx)\n    const labelBounds = [Math.max(y - 12, 0), y]\n    if (y === 0 || positions.slice(...labelBounds).some(Boolean)) {\n      blockLabelKeysToHide.push(key)\n    } else {\n      positions.fill(true, ...labelBounds)\n    }\n  })\n  return blockLabelKeysToHide\n}\n/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  regions: BaseBlock[],\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const ticks = []\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  for (let i = 0; i < regions.length; i++) {\n    const region = regions[i]\n    const { start, end, refName } = region\n    let index = 0\n\n    const minBase = start\n    const maxBase = end\n    for (\n      let base = Math.ceil(minBase / iterPitch) * iterPitch;\n      base < maxBase;\n      base += iterPitch\n    ) {\n      if (emitMinor && base % gridPitch.majorPitch) {\n        ticks.push({ type: 'minor', base: base - 1, index, refName })\n        index += 1\n      } else if (\n        emitMajor &&\n        Math.abs(base - region.start) > gridPitch.minorPitch\n      ) {\n        ticks.push({ type: 'major', base: base - 1, index, refName })\n        index += 1\n      }\n    }\n  }\n  return ticks\n}\n","import {\n  Instance,\n  SnapshotIn,\n  cast,\n  types,\n  getParent,\n  getSnapshot,\n  addDisposer,\n  resolveIdentifier,\n  getRoot,\n} from 'mobx-state-tree'\n\nimport { makeTicks } from './components/util'\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport { observable, autorun, transaction } from 'mobx'\nimport { BaseTrackStateModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport {\n  getSession,\n  isSessionModelWithWidgets,\n  minmax,\n  measureText,\n} from '@jbrowse/core/util'\nimport { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\n\ntype Coord = [number, number]\n\n// Used in the renderer\n// ref https://mobx-state-tree.js.org/concepts/volatiles on volatile state used here\nexport const Dotplot1DView = Base1DView.extend(self => {\n  const scaleFactor = observable.box(1)\n  return {\n    views: {\n      get dynamicBlocks() {\n        return calculateDynamicBlocks(self, false, false)\n      },\n      get scaleFactor() {\n        return scaleFactor.get()\n      },\n    },\n    actions: {\n      setScaleFactor(n: number) {\n        scaleFactor.set(n)\n      },\n    },\n  }\n})\n\nexport type Dotplot1DViewModel = Instance<typeof Dotplot1DView>\n\nconst DotplotHView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewWidth\n    },\n  },\n}))\n\nconst DotplotVView = Dotplot1DView.extend(self => ({\n  views: {\n    get width() {\n      return getParent(self).viewHeight\n    },\n  },\n}))\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseViewModel,\n      types.model('DotplotView', {\n        id: ElementId,\n        type: types.literal('DotplotView'),\n        headerHeight: 0,\n        height: 600,\n        borderSize: 20,\n        tickSize: 5,\n        vtextRotation: 0,\n        htextRotation: -90,\n        fontSize: 15,\n        trackSelectorType: 'hierarchical',\n        assemblyNames: types.array(types.string),\n        hview: types.optional(DotplotHView, {}),\n        vview: types.optional(DotplotVView, {}),\n\n        tracks: types.array(\n          pluginManager.pluggableMstType(\n            'track',\n            'stateModel',\n          ) as BaseTrackStateModel,\n        ),\n\n        // this represents tracks specific to this view specifically used for\n        // read vs ref dotplots where this track would not really apply\n        // elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n\n        // this represents assemblies in the specialized read vs ref dotplot\n        // view\n        viewAssemblyConfigs: types.array(types.frozen()),\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      volatileError: undefined as Error | undefined,\n      borderX: 100,\n      borderY: 100,\n    }))\n    .views(self => ({\n      get width(): number {\n        if (!self.volatileWidth) {\n          throw new Error('width not initialized')\n        }\n        return self.volatileWidth\n      },\n    }))\n    .views(self => ({\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        return self.assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n      get assembliesInitialized() {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        return assemblyNames.every(\n          n => assemblyManager.get(n)?.initialized ?? true,\n        )\n      },\n    }))\n    .views(self => ({\n      get initialized() {\n        return (\n          self.volatileWidth !== undefined &&\n          self.hview.displayedRegions.length > 0 &&\n          self.vview.displayedRegions.length > 0 &&\n          self.assembliesInitialized\n        )\n      },\n\n      get hticks() {\n        const { hview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = hview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n\n      get vticks() {\n        const { vview } = self\n        const { dynamicBlocks, staticBlocks, bpPerPx } = vview\n        return dynamicBlocks.contentBlocks.length > 5\n          ? []\n          : makeTicks(staticBlocks.contentBlocks, bpPerPx)\n      },\n\n      get loading() {\n        return self.assemblyNames.length > 0 && !this.initialized\n      },\n      get viewWidth() {\n        return self.width - self.borderX\n      },\n      get viewHeight() {\n        return self.height - self.borderY\n      },\n      get views() {\n        return [self.hview, self.vview]\n      },\n\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n    }))\n    .actions(self => ({\n      clearView() {\n        self.hview.setDisplayedRegions([])\n        self.vview.setDisplayedRegions([])\n        self.assemblyNames = cast([])\n      },\n      setBorderX(n: number) {\n        self.borderX = n\n      },\n      setBorderY(n: number) {\n        self.borderY = n\n      },\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n        return self.volatileWidth\n      },\n      setHeight(newHeight: number) {\n        self.height = newHeight\n        return self.height\n      },\n\n      setError(e: Error) {\n        self.volatileError = e\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      zoomOutButton() {\n        self.hview.zoomOut()\n        self.vview.zoomOut()\n      },\n      zoomInButton() {\n        self.hview.zoomIn()\n        self.vview.zoomIn()\n      },\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          const session: any = getSession(self)\n          const selector = session.addWidget(\n            'HierarchicalTrackSelectorWidget',\n            'hierarchicalTrackSelector',\n            { view: self },\n          )\n          session.showWidget(selector)\n          return selector\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const trackConfigSchema =\n          pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => {\n            if (\n              viewType.displayTypes.find(\n                displayType => displayType.name === d.type,\n              )\n            ) {\n              return true\n            }\n            return false\n          },\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        const track = trackType.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n          displays: [{ type: displayConf.type, configuration: displayConf }],\n        })\n        self.tracks.push(track)\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema =\n          pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n      setAssemblyNames(target: string, query: string) {\n        self.assemblyNames = cast([target, query])\n      },\n      setViews(arr: SnapshotIn<Base1DViewModel>[]) {\n        self.hview = cast(arr[0])\n        self.vview = cast(arr[1])\n      },\n\n      getCoords(mousedown: Coord, mouseup: Coord) {\n        const [xmin, xmax] = minmax(mouseup[0], mousedown[0])\n        const [ymin, ymax] = minmax(mouseup[1], mousedown[1])\n        return Math.abs(xmax - xmin) > 3 && Math.abs(ymax - ymin) > 3\n          ? [\n              self.hview.pxToBp(xmin),\n              self.hview.pxToBp(xmax),\n              self.vview.pxToBp(self.viewHeight - ymin),\n              self.vview.pxToBp(self.viewHeight - ymax),\n            ]\n          : undefined\n      },\n\n      zoomIn(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          self.hview.moveTo(x1, x2)\n          self.vview.moveTo(y2, y1)\n        }\n      },\n      onDotplotView(mousedown: Coord, mouseup: Coord) {\n        const result = this.getCoords(mousedown, mouseup)\n        if (result) {\n          const [x1, x2, y1, y2] = result\n          const session = getSession(self)\n\n          const d1 = Dotplot1DView.create({\n            ...getSnapshot(self.hview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          const d2 = Dotplot1DView.create({\n            ...getSnapshot(self.vview),\n            minimumBlockWidth: 0,\n            interRegionPaddingWidth: 0,\n          })\n          d1.setVolatileWidth(self.hview.width)\n          d2.setVolatileWidth(self.vview.width)\n          d1.moveTo(x1, x2)\n          d2.moveTo(y2, y1)\n          d1.zoomTo(d1.bpPerPx / (self.width / self.hview.width), 0)\n          d2.zoomTo(d2.bpPerPx / (self.width / self.vview.width), 0)\n\n          // add the specific evidence tracks to the LGVs in the split view\n          // note: scales the bpPerPx by scaling proportional of the dotplot\n          // width to the eventual lgv width\n          const tracks = self.tracks\n            .map(track => {\n              const trackConf = track.configuration\n              return trackConf.displays.find(\n                (display: { type: string }) =>\n                  display.type === 'LinearSyntenyDisplay',\n              )\n            })\n            .filter(f => !!f)\n            .map(displayConf => {\n              const trackConf = getParent(displayConf, 2)\n              return {\n                type: getParent(displayConf, 2).type,\n                configuration: trackConf,\n                displays: [\n                  { type: displayConf.type, configuration: displayConf },\n                ],\n              }\n            })\n          const viewSnapshot = {\n            type: 'LinearSyntenyView',\n            views: [\n              {\n                type: 'LinearGenomeView',\n                ...getSnapshot(d1),\n                tracks: [],\n                hideHeader: true,\n              },\n              {\n                type: 'LinearGenomeView',\n                ...getSnapshot(d2),\n                tracks: [],\n                hideHeader: true,\n              },\n            ],\n            tracks,\n          }\n\n          session.addView('LinearSyntenyView', viewSnapshot)\n        }\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            function initializer() {\n              const session = getSession(self)\n              if (self.volatileWidth === undefined) {\n                return\n              }\n\n              if (self.initialized) {\n                return\n              }\n              const axis = [self.viewWidth, self.viewHeight]\n              const views = [self.hview, self.vview]\n              self.assemblyNames.forEach((name, index) => {\n                const assembly = session.assemblyManager.get(name)\n                if (assembly) {\n                  if (assembly.error) {\n                    self.setError(assembly.error)\n                  }\n                  const { regions } = assembly\n                  if (regions && regions.length) {\n                    const regionsSnapshot = regions\n                    if (regionsSnapshot) {\n                      transaction(() => {\n                        const view = views[index]\n                        view.setDisplayedRegions(regionsSnapshot)\n                        view.setBpPerPx(view.totalBp / axis[index])\n                      })\n                    }\n                  }\n                }\n              })\n            },\n            { delay: 1000 },\n          ),\n        )\n        addDisposer(\n          self,\n          autorun(function borderSetter() {\n            // make sure we have a width on the view before trying to load\n            const { vview, hview } = self\n            if (self.volatileWidth === undefined) {\n              return\n            }\n            const padding = 10\n            const vblocks = vview.dynamicBlocks.contentBlocks\n            const hblocks = hview.dynamicBlocks.contentBlocks\n            const len = (a: string) => measureText(a.slice(0, 30))\n            const by = hblocks.reduce((a, b) => Math.max(a, len(b.refName)), 0)\n            const bx = vblocks.reduce((a, b) => Math.max(a, len(b.refName)), 0)\n            // these are set via autorun to avoid dependency cycle\n            self.setBorderY(Math.max(by + padding, 100))\n            self.setBorderX(Math.max(bx + padding, 100))\n          }),\n        )\n      },\n      squareView() {\n        const { hview, vview } = self\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n      squareViewProportional() {\n        const { hview, vview } = self\n        const ratio = hview.width / vview.width\n        const avg = (hview.bpPerPx + vview.bpPerPx) / 2\n        const hpx = hview.pxToBp(hview.width / 2)\n        const vpx = vview.pxToBp(vview.width / 2)\n        hview.setBpPerPx(avg / ratio)\n        hview.centerAt(hpx.coord, hpx.refName, hpx.index)\n        vview.setBpPerPx(avg)\n        vview.centerAt(vpx.coord, vpx.refName, vpx.index)\n      },\n    }))\n    .views(self => ({\n      menuItems() {\n        const session = getSession(self)\n        return [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Square view - same bp per pixel',\n            onClick: () => self.squareView(),\n          },\n          {\n            label: 'Rectangular view - same total bp',\n            onClick: () => self.squareView(),\n          },\n          ...(isSessionModelWithWidgets(session)\n            ? [\n                {\n                  label: 'Open track selector',\n                  onClick: self.activateTrackSelector,\n                  icon: TrackSelectorIcon,\n                },\n              ]\n            : []),\n        ]\n      },\n      get error() {\n        return self.volatileError || self.assemblyErrors\n      },\n    }))\n}\n\nexport type DotplotViewStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotViewModel = Instance<DotplotViewStateModel>\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Typography, LinearProgress } from '@material-ui/core'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    textAlign: 'center',\n  },\n\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  }, [])\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      <Typography>Loading &hellip;</Typography>\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return (\n    <div className={classes.blockMessage}>\n      <Typography>{messageText}</Typography>\n    </div>\n  )\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return (\n    <div className={classes.blockError}>\n      <Typography>{error.message}</Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ({ model, style }: { model: any; style: any }) => {\n    if (model.error) {\n      return <BlockError error={model.error} data-testid=\"reload_button\" />\n    }\n    if (model.message) {\n      return <BlockMessage messageText={model.message} />\n    }\n    if (!model.filled) {\n      return <LoadingMessage />\n    }\n    return <div style={style}>{model.reactElement}</div>\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { DotplotDisplayModel } from '..'\nimport { DotplotViewModel } from '../../DotplotView/model'\n\nconst DotplotDisplay: React.FC<{\n  model: DotplotDisplayModel\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  const { offsetX = 0, offsetY = 0 } = model.data || {}\n  const view = getContainingView(model) as DotplotViewModel\n  const top = view.vview.offsetPx - offsetY\n  const left = -(view.hview.offsetPx - offsetX)\n  return (\n    <div style={{ position: 'relative' }}>\n      <model.ReactComponent2\n        {...props}\n        style={{\n          position: 'absolute',\n          top,\n          left,\n        }}\n      />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(DotplotDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport clone from 'clone'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport React from 'react'\n\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport { DotplotViewModel } from '../DotplotView/model'\n\nimport ReactComponent from './components/DotplotDisplay'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'DotplotDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'DotplotView',\n      ReactComponent,\n    })\n  })\n}\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'DotplotDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'DotplotRenderer' },\n      ),\n    },\n    { explicitIdentifier: 'displayId', explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'DotplotDisplay',\n      BaseDisplay,\n      types\n        .model({\n          type: types.literal('DotplotDisplay'),\n          configuration: ConfigurationReference(configSchema),\n        })\n        .volatile(() => ({\n          renderInProgress: undefined as AbortController | undefined,\n          filled: false,\n          data: undefined as any,\n          reactElement: undefined as React.ReactElement | undefined,\n          message: undefined as string | undefined,\n          renderingComponent: undefined as any,\n          ReactComponent2:\n            ServerSideRenderedBlockContent as unknown as React.FC<any>,\n        })),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: self.configuration.renderer,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            () => renderBlockData(self as any),\n            (blockData): any => {\n              return blockData ? renderBlockEffect(blockData) : undefined\n            },\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args?: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          if (args === undefined) {\n            return\n          }\n          const { data, reactElement, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\n\nfunction renderBlockData(self: DotplotDisplayModel) {\n  const { rpcManager } = getSession(self)\n  const { rendererType } = self\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as DotplotViewModel\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n  getSnapshot(parent)\n\n  if (parent.initialized) {\n    const { viewWidth, viewHeight, borderSize, borderX, borderY } = parent\n    return {\n      rendererType,\n      rpcManager,\n      renderProps: {\n        ...self.renderProps(),\n        view: clone(getSnapshot(parent)),\n        width: viewWidth,\n        height: viewHeight,\n        borderSize,\n        borderX,\n        borderY,\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId: getRpcSessionId(self),\n        timeout: 1000000, // 10000,\n      },\n    }\n  }\n  return undefined\n}\n\nasync function renderBlockEffect(\n  props: ReturnType<typeof renderBlockData> | undefined,\n) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n\n  return { reactElement, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type DotplotDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type DotplotDisplayModel = Instance<DotplotDisplayStateModel>\n","import { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { DotplotRenderArgsDeserialized } from '../DotplotRenderer'\n\nfunction DotplotRendering(props: DotplotRenderArgsDeserialized) {\n  return <PrerenderedCanvas {...props} />\n}\n\nexport default observer(DotplotRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'DotplotRenderer',\n  {\n    color: {\n      type: 'color',\n      description:\n        'the color of each feature in a synteny, used with colorBy:default',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    posColor: {\n      type: 'color',\n      description: 'the color for forward alignments, used with colorBy:strand',\n      defaultValue: 'blue',\n    },\n    negColor: {\n      type: 'color',\n      description: 'the color for reverse alignments, used with colorBy:strand',\n      defaultValue: 'red',\n    },\n    lineWidth: {\n      type: 'number',\n      description: 'width of the lines to be drawn',\n      defaultValue: 2.5, // 2.5 is similar to D-GENIES\n    },\n    colorBy: {\n      type: 'stringEnum',\n      model: types.enumeration('colorBy', [\n        'identity',\n        'meanQueryIdentity',\n        'mappingQuality',\n        'strand',\n        'default',\n      ]),\n      description: `Color by options:<br/>\n<ul>\n  <li>\"identity\" - the identity of the particular hit, similar to D-GENIES, use the other config slots 'thresholds' and 'thresholdsPalette' to define colors for this setting</li>\n  <li>\"meanQueryIdentity\" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>\"mappingQuality\" - uses mapping quality from PAF, some adapters don't have this setting</li>\n  <li>\"strand\" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>\"default\" - uses the 'color' config slot</li>\n</ul>`,\n      defaultValue: 'default',\n    },\n    thresholdsPalette: {\n      type: 'stringArray',\n      defaultValue: ['#094b09', '#2ebd40', '#d5670b', '#ffd84b'],\n      description: 'threshold colors, used with colorBy:identity',\n    },\n    thresholds: {\n      type: 'stringArray',\n      defaultValue: ['0.75', '0.5', '0.25', '0'],\n      description: 'threshold breakpoints, used with colorBy:identity',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  readConfObject,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport {\n  createCanvas,\n  createImageBitmap,\n} from '@jbrowse/core/util/offscreenCanvasPonyfill'\nimport { viewBpToPx, renameRegionsIfNeeded, Region } from '@jbrowse/core/util'\nimport { getSnapshot } from 'mobx-state-tree'\nimport ComparativeServerSideRendererType, {\n  RenderArgsDeserialized as ComparativeRenderArgsDeserialized,\n  RenderArgs as ComparativeRenderArgs,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Dotplot1DView, Dotplot1DViewModel } from '../DotplotView/model'\n\nconst { parseCigar } = MismatchParser\n\nexport interface DotplotRenderArgsDeserialized\n  extends ComparativeRenderArgsDeserialized {\n  height: number\n  width: number\n  highResolutionScaling: number\n  view: {\n    hview: Dotplot1DViewModel\n    vview: Dotplot1DViewModel\n  }\n}\n\ninterface DotplotRenderArgs extends ComparativeRenderArgs {\n  adapterConfig: AnyConfigurationModel\n  sessionId: string\n  view: {\n    hview: { displayedRegions: Region[] }\n    vview: { displayedRegions: Region[] }\n  }\n}\n\nfunction drawCir(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  fill = true,\n  r = 1,\n) {\n  ctx.beginPath()\n  ctx.arc(x, y, r / 2, 0, 2 * Math.PI)\n  fill ? ctx.fill() : ctx.stroke()\n}\nexport default class DotplotRenderer extends ComparativeServerSideRendererType {\n  async renameRegionsIfNeeded(args: DotplotRenderArgs) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n\n    if (!assemblyManager) {\n      throw new Error('No assembly manager provided')\n    }\n\n    args.view.hview.displayedRegions = (\n      await renameRegionsIfNeeded(assemblyManager, {\n        sessionId: args.sessionId,\n        regions: args.view.hview.displayedRegions,\n        adapterConfig: args.adapterConfig,\n      })\n    ).regions\n    args.view.vview.displayedRegions = (\n      await renameRegionsIfNeeded(assemblyManager, {\n        sessionId: args.sessionId,\n        regions: args.view.vview.displayedRegions,\n        adapterConfig: args.adapterConfig,\n      })\n    ).regions\n    return args\n  }\n  async makeImageData(\n    props: DotplotRenderArgsDeserialized & { views: Dotplot1DViewModel[] },\n  ) {\n    const { highResolutionScaling = 1, width, height, config, views } = props\n\n    const canvas = createCanvas(\n      Math.ceil(width * highResolutionScaling),\n      height * highResolutionScaling,\n    )\n    const ctx = canvas.getContext('2d') as CanvasRenderingContext2D\n    const color = readConfObject(config, 'color')\n    const isCallback = config.color.isCallback\n    const posColor = readConfObject(config, 'posColor')\n    const negColor = readConfObject(config, 'negColor')\n    const colorBy = readConfObject(config, 'colorBy')\n    const lineWidth = readConfObject(config, 'lineWidth')\n    ctx.lineWidth = lineWidth\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    const [hview, vview] = views\n    const db1 = hview.dynamicBlocks.contentBlocks[0].offsetPx\n    const db2 = vview.dynamicBlocks.contentBlocks[0].offsetPx\n    const unableToDraw = [] as string[]\n\n    // we operate on snapshots of these attributes of the hview/vview because\n    // it is significantly faster than accessing the mobx objects\n    const { bpPerPx: hBpPerPx } = hview\n    const { bpPerPx: vBpPerPx } = vview\n\n    const hvsnap = {\n      ...getSnapshot(hview),\n      width: hview.width,\n    }\n    const vvsnap = {\n      ...getSnapshot(vview),\n      width: vview.width,\n    }\n    hview.features?.forEach(feature => {\n      let start = feature.get('start')\n      let end = feature.get('end')\n      const strand = feature.get('strand') || 1\n      const refName = feature.get('refName')\n      const mate = feature.get('mate')\n      const mateRef = mate.refName\n      if (strand === -1) {\n        ;[end, start] = [start, end]\n      }\n\n      let r\n      if (colorBy === 'identity') {\n        const numMatches = feature.get('numMatches')\n        const blockLen = feature.get('blockLen')\n        const identity = numMatches / blockLen\n        const thresholds = readConfObject(config, 'thresholds')\n        const palette = readConfObject(config, 'thresholdsPalette')\n        for (let i = 0; i < thresholds.length; i++) {\n          if (identity > +thresholds[i]) {\n            r = palette[i]\n            break\n          }\n        }\n      } else if (colorBy === 'meanQueryIdentity') {\n        const identity = feature.get('meanScore')\n        r = `hsl(${identity * 200},100%,40%)`\n      } else if (colorBy === 'mappingQuality') {\n        const mq = feature.get('mappingQual')\n        r = `hsl(${mq},100%,40%)`\n      } else if (colorBy === 'strand') {\n        r = strand === -1 ? negColor : posColor\n      } else if (colorBy === 'default') {\n        r = isCallback ? readConfObject(config, 'color', { feature }) : color\n      }\n      ctx.fillStyle = r\n      ctx.strokeStyle = r\n\n      const b10 = viewBpToPx({\n        self: hvsnap,\n        refName,\n        coord: start,\n      })?.offsetPx\n      const b20 = viewBpToPx({\n        self: hvsnap,\n        refName,\n        coord: end,\n      })?.offsetPx\n      const e10 = viewBpToPx({\n        self: vvsnap,\n        refName: mateRef,\n        coord: mate.start,\n      })?.offsetPx\n      const e20 = viewBpToPx({\n        self: vvsnap,\n        refName: mateRef,\n        coord: mate.end,\n      })?.offsetPx\n      if (\n        b10 !== undefined &&\n        b20 !== undefined &&\n        e10 !== undefined &&\n        e20 !== undefined\n      ) {\n        const b1 = b10 - db1\n        const b2 = b20 - db1\n        const e1 = e10 - db2\n        const e2 = e20 - db2\n        if (Math.abs(b1 - b2) <= 4 && Math.abs(e1 - e2) <= 4) {\n          drawCir(ctx, b1, height - e1, true, lineWidth)\n        } else {\n          let currX = b1\n          let currY = e1\n          const cigar = feature.get('cg') || feature.get('CIGAR')\n\n          if (cigar) {\n            const cigarOps = parseCigar(cigar)\n\n            ctx.beginPath()\n            ctx.moveTo(currX, height - currY)\n            for (let i = 0; i < cigarOps.length; i += 2) {\n              const val = +cigarOps[i]\n              const op = cigarOps[i + 1]\n              if (op === 'M' || op === '=' || op === 'X') {\n                currX += (val / hBpPerPx) * strand\n                currY += val / vBpPerPx\n              } else if (op === 'D' || op === 'N') {\n                currX += (val / hBpPerPx) * strand\n              } else if (op === 'I') {\n                currY += val / vBpPerPx\n              }\n              ctx.lineTo(currX, height - currY)\n            }\n            ctx.stroke()\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(b1, height - e1)\n            ctx.lineTo(b2, height - e2)\n            ctx.stroke()\n          }\n        }\n      } else {\n        if (unableToDraw.length <= 5) {\n          unableToDraw.push(\n            `feature at ${refName}:${start}-${end} ${mateRef}:${mate.start}-${mate.end} not plotted, fell outside of range ${b10} ${b20} ${e10} ${e20}`,\n          )\n        }\n      }\n    })\n    if (unableToDraw.length) {\n      console.warn(\n        (unableToDraw.length > 5\n          ? 'Many features fell outside the boundaries of the contigs.....sample of features: '\n          : 'Some features fell outside the boundaries of the contigs: ') +\n          unableToDraw.slice(0, 5).join('\\n'),\n      )\n    }\n    return createImageBitmap(canvas)\n  }\n\n  async render(renderProps: DotplotRenderArgsDeserialized) {\n    const {\n      width,\n      height,\n      view: { hview, vview },\n    } = renderProps\n    const dimensions = [width, height]\n    const realizedViews = [hview, vview].map((snap, idx) => {\n      const view = Dotplot1DView.create(snap)\n      view.setVolatileWidth(dimensions[idx])\n      return view\n    })\n    const target = realizedViews[0]\n    const feats = await this.getFeatures({\n      ...renderProps,\n      regions: target.dynamicBlocks.contentBlocks,\n    })\n    target.setFeatures(feats)\n    const imageData = await this.makeImageData({\n      ...renderProps,\n      views: realizedViews,\n    })\n\n    const results = await super.render({\n      ...renderProps,\n      height,\n      width,\n      imageData,\n    })\n\n    return {\n      ...results,\n      imageData,\n      height,\n      width,\n      offsetX: realizedViews[0].dynamicBlocks.blocks[0].offsetPx,\n      offsetY: realizedViews[1].dynamicBlocks.blocks[0].offsetPx,\n    }\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { DotplotViewModel } from './DotplotView/model'\nimport { transaction } from 'mobx'\n\nexport default function LaunchDotplotView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-DotplotView',\n    // @ts-ignore\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const model = session.addView('DotplotView', {}) as DotplotViewModel\n        const assemblyNames = views.map(view => view.assembly)\n\n        transaction(() => {\n          model.setViews([\n            { bpPerPx: 0.1, offsetPx: 0 },\n            { bpPerPx: 0.1, offsetPx: 0 },\n          ])\n          model.setAssemblyNames(assemblyNames[0], assemblyNames[1])\n        })\n\n        // http://localhost:3000/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{\"views\":[{\"type\":\"DotplotView\",\"views\":[{\"assembly\":\"volvox\"},{\"assembly\":\"volvox\"}],\"tracks\":[\"volvox_fake_synteny\"]}]}\n\n        const idsNotFound = [] as string[]\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notify(`${e}`, 'error')\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","import { checkAbortSignal } from '@jbrowse/core/util'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport ComparativeRenderer, {\n  RenderArgs as ComparativeRenderArgs,\n  RenderArgsSerialized as ComparativeRenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\n\ninterface RenderArgs extends ComparativeRenderArgs {\n  adapterConfig: {}\n  rendererType: string\n}\n\ninterface RenderArgsSerialized extends ComparativeRenderArgsSerialized {\n  adapterConfig: {}\n  rendererType: string\n}\n\n/**\n * call a synteny renderer with the given args\n * param views: a set of views that each contain a set of regions\n * used instead of passing regions directly as in render()\n */\nexport default class ComparativeRender extends RpcMethodType {\n  name = 'ComparativeRender'\n\n  async renameRegionsIfNeeeded(\n    args: RenderArgs,\n    renderer: ComparativeRenderer,\n  ) {\n    return renderer.renameRegionsIfNeeded(args)\n  }\n\n  async serializeArguments(args: RenderArgs, rpcDriverClassName: string) {\n    const { rendererType } = args\n    const renderer = this.pluginManager.getRendererType(\n      rendererType,\n    ) as ComparativeRenderer\n\n    const result = await this.renameRegionsIfNeeeded(\n      (await super.serializeArguments(args, rpcDriverClassName)) as RenderArgs,\n      renderer,\n    )\n\n    return rpcDriverClassName === 'MainThreadRpcDriver'\n      ? result\n      : renderer.serializeArgsInClient(result)\n  }\n\n  async execute(\n    args: RenderArgsSerialized & { signal?: RemoteAbortSignal },\n    rpcDriverClassName: string,\n  ) {\n    let deserializedArgs = args\n    if (rpcDriverClassName !== 'MainThreadRpcDriver') {\n      deserializedArgs = await this.deserializeArguments(\n        args,\n        rpcDriverClassName,\n      )\n    }\n    const { sessionId, rendererType, signal } = deserializedArgs\n    if (!sessionId) {\n      throw new Error('must pass a unique session id')\n    }\n\n    checkAbortSignal(signal)\n\n    const RendererType = this.pluginManager.getRendererType(\n      rendererType,\n    ) as ComparativeRenderer\n\n    if (!RendererType) {\n      throw new Error(`renderer \"${rendererType}\" not found`)\n    }\n    if (!RendererType.ReactComponent) {\n      throw new Error(\n        `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n      )\n    }\n\n    const result =\n      rpcDriverClassName === 'MainThreadRpcDriver'\n        ? await RendererType.render(deserializedArgs)\n        : await RendererType.renderInWorker(deserializedArgs)\n    checkAbortSignal(signal)\n    return result\n  }\n\n  async deserializeReturn(\n    serializedReturn: RenderResults | ResultsSerialized,\n    args: RenderArgs,\n    rpcDriverClassName: string,\n  ): Promise<unknown> {\n    const superDeserialized = await super.deserializeReturn(\n      serializedReturn,\n      args,\n      rpcDriverClassName,\n    )\n    if (rpcDriverClassName === 'MainThreadRpcDriver') {\n      return superDeserialized\n    }\n\n    const { rendererType } = args\n    const RendererType = this.pluginManager.getRendererType(\n      rendererType,\n    ) as ComparativeRenderer\n    if (!RendererType) {\n      throw new Error(`renderer \"${rendererType}\" not found`)\n    }\n    if (!RendererType.ReactComponent) {\n      throw new Error(\n        `renderer ${rendererType} has no ReactComponent, it may not be completely implemented yet`,\n      )\n    }\n\n    return RendererType.deserializeResultsInClient(\n      superDeserialized as ResultsSerialized,\n      args,\n    )\n  }\n}\n","import { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nconst { parseCigar } = MismatchParser\n\nexport function getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nexport function getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nexport function getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\nexport function getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\ninterface Interval {\n  start: number\n  end: number\n}\n\n// source https://gist.github.com/vrachieru/5649bce26004d8a4682b\nexport function mergeIntervals<T extends Interval>(intervals: T[], w = 5000) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = []\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0])\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n    top = stack[stack.length - 1]\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i].start - w) {\n      stack.push(intervals[i])\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i].end) {\n      top.end = Math.max(top.end, intervals[i].end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n\nexport interface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\nexport function gatherOverlaps(regions: BasicFeature[]) {\n  const groups = regions.reduce((memo, x) => {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName].push(x)\n    return memo\n  }, {} as { [key: string]: BasicFeature[] })\n\n  return Object.values(groups)\n    .map(group => mergeIntervals(group.sort((a, b) => a.start - b.start)))\n    .flat()\n}\n\nexport interface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  seqLength: number\n}\n","import {\n  getClip,\n  getTag,\n  getLengthOnRef,\n  getLength,\n  getLengthSansClipping,\n  gatherOverlaps,\n  ReducedFeature,\n} from './util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\nexport function onClick(feature: Feature, self: LinearPileupDisplayModel) {\n  const session = getSession(self)\n  try {\n    const cigar = feature.get('CIGAR')\n    const clipPos = getClip(cigar, 1)\n    const flags = feature.get('flags')\n    const origStrand = feature.get('strand')\n    const readName = feature.get('name')\n    const readAssembly = `${readName}_assembly_${Date.now()}`\n    const { parentTrack } = self\n    const [trackAssembly] = getConf(parentTrack, 'assemblyNames')\n    const assemblyNames = [trackAssembly, readAssembly]\n    const trackId = `track-${Date.now()}`\n    const trackName = `${readName}_vs_${trackAssembly}`\n    const SA: string = getTag(feature, 'SA') || ''\n    const SAs = SA.split(';')\n      .filter(aln => !!aln)\n      .map((aln, index) => {\n        const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n        const saLengthOnRef = getLengthOnRef(saCigar)\n        const saLength = getLength(saCigar)\n        const saLengthSansClipping = getLengthSansClipping(saCigar)\n        const saStrandNormalized = saStrand === '-' ? -1 : 1\n        const saClipPos = getClip(saCigar, saStrandNormalized * origStrand)\n        const saRealStart = +saStart - 1\n        return {\n          refName: saRef,\n          start: saRealStart,\n          end: saRealStart + saLengthOnRef,\n          seqLength: saLength,\n          clipPos: saClipPos,\n          CIGAR: saCigar,\n          assemblyName: trackAssembly,\n          strand: origStrand * saStrandNormalized,\n          uniqueId: `${feature.id()}_SA${index}`,\n          mate: {\n            start: saClipPos,\n            end: saClipPos + saLengthSansClipping,\n            refName: readName,\n          },\n        }\n      })\n\n    const feat = feature.toJSON()\n    feat.strand = 1\n    feat.mate = {\n      refName: readName,\n      start: clipPos,\n      end: clipPos + getLengthSansClipping(cigar),\n    }\n\n    // if secondary alignment or supplementary, calculate length from SA[0]'s\n    // CIGAR which is the primary alignments. otherwise it is the primary\n    // alignment just use seq.length if primary alignment\n    const totalLength = getLength(flags & 2048 ? SAs[0].CIGAR : cigar)\n\n    const features = [feat, ...SAs] as ReducedFeature[]\n\n    features.sort((a, b) => a.clipPos - b.clipPos)\n\n    const refLength = features.reduce((a, f) => a + f.end - f.start, 0)\n\n    session.addView('DotplotView', {\n      type: 'DotplotView',\n      hview: {\n        offsetPx: 0,\n        bpPerPx: refLength / 800,\n        displayedRegions: gatherOverlaps(\n          features.map((f, index) => {\n            const { start, end, refName } = f\n            return {\n              start,\n              end,\n              refName,\n              index,\n              assemblyName: trackAssembly,\n            }\n          }),\n        ),\n      },\n      vview: {\n        offsetPx: 0,\n        bpPerPx: totalLength / 400,\n        minimumBlockWidth: 0,\n        interRegionPaddingWidth: 0,\n        displayedRegions: [\n          {\n            assemblyName: readAssembly,\n            start: 0,\n            end: totalLength,\n            refName: readName,\n          },\n        ],\n      },\n      viewTrackConfigs: [\n        {\n          type: 'SyntenyTrack',\n          assemblyNames,\n          adapter: {\n            type: 'FromConfigAdapter',\n            features,\n          },\n          trackId,\n          name: trackName,\n        },\n      ],\n      viewAssemblyConfigs: [\n        {\n          name: readAssembly,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${readName}_${Date.now()}`,\n            adapter: {\n              type: 'FromConfigSequenceAdapter',\n              features: [feature.toJSON()],\n            },\n          },\n        },\n      ],\n      assemblyNames,\n      tracks: [\n        {\n          configuration: trackId,\n          type: 'SyntenyTrack',\n          displays: [\n            {\n              type: 'DotplotDisplay',\n              configuration: `${trackId}-DotplotDisplay`,\n            },\n          ],\n        },\n      ],\n      displayName: `${readName} vs ${trackAssembly}`,\n    })\n  } catch (e) {\n    console.error(e)\n    session.notify(`${e}`, 'error')\n  }\n}\n","import Plugin from '@jbrowse/core/Plugin'\n\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport DotplotViewF from './DotplotView'\nimport DotplotDisplayF from './DotplotDisplay'\nimport DotplotRendererF from './DotplotRenderer'\nimport LaunchDotplotViewF from './LaunchDotplotView'\n\nimport AddIcon from '@material-ui/icons/Add'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport TimelineIcon from '@material-ui/icons/Timeline'\n\nimport ComparativeRender from './DotplotRenderer/ComparativeRenderRpc'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\nimport { LinearPileupDisplayModel } from '@jbrowse/plugin-alignments'\n\nimport { onClick } from './DotplotReadVsRef'\n\nexport default class DotplotPlugin extends Plugin {\n  name = 'DotplotPlugin'\n\n  install(pluginManager: PluginManager) {\n    DotplotViewF(pluginManager)\n    DotplotDisplayF(pluginManager)\n    DotplotRendererF(pluginManager)\n    LaunchDotplotViewF(pluginManager)\n\n    // install our comparative rendering rpc callback\n    pluginManager.addRpcMethod(() => new ComparativeRender(pluginManager))\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (pluggableElement.name === 'LinearPileupDisplay') {\n          const { stateModel } = pluggableElement as ViewType\n          const newStateModel = stateModel.extend(\n            (self: LinearPileupDisplayModel) => {\n              const superContextMenuItems = self.contextMenuItems\n              return {\n                views: {\n                  contextMenuItems() {\n                    const feature = self.contextMenuFeature\n                    if (!feature) {\n                      return superContextMenuItems()\n                    }\n                    const newMenuItems = [\n                      ...superContextMenuItems(),\n                      {\n                        label: 'Dotplot of read vs ref',\n                        icon: AddIcon,\n                        onClick: () => onClick(feature, self),\n                      },\n                    ]\n\n                    return newMenuItems\n                  },\n                },\n              }\n            },\n          )\n\n          ;(pluggableElement as ViewType).stateModel = newStateModel\n        }\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Dotplot view',\n        icon: TimelineIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('DotplotView', {})\n        },\n      })\n    }\n  }\n}\n","import { lazy } from 'react'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n// locals\nimport stateModelFactory from './model'\n\nexport default function (pluginManager: PluginManager) {\n  pluginManager.addViewType(() => {\n    return new ViewType({\n      name: 'DotplotView',\n      stateModel: stateModelFactory(pluginManager),\n      ReactComponent: lazy(() => import('./components/DotplotView')),\n    })\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport ReactComponent from './components/DotplotRendering'\nimport configSchema from './configSchema'\nimport DotplotRenderer from './DotplotRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new DotplotRenderer({\n        name: 'DotplotRenderer',\n        configSchema: configSchema,\n        ReactComponent: ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'Gff3TabixAdapter',\n  {\n    gffGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff.gz', locationType: 'UriLocation' },\n    },\n    index: ConfigurationSchema('Gff3TabixIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.gff.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n    dontRedispatch: {\n      type: 'stringArray',\n      defaultValue: ['chromosome', 'region'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'Gff3Adapter',\n  {\n    gffLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gff', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gff3TabixAdapterConfigSchema } from './Gff3TabixAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n  getFileName,\n} from '@jbrowse/core/util/tracks'\nimport { configSchema as gff3AdapterConfigSchema } from './Gff3Adapter'\n\nexport default class extends Plugin {\n  name = 'GFF3Plugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3TabixAdapter',\n          configSchema: gff3TabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./Gff3TabixAdapter/Gff3TabixAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gff3?\\.b?gz$/i\n          const adapterName = 'Gff3TabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              bamLocation: file,\n              gffGzLocation: file,\n              index: {\n                location: index || makeIndex(file, '.tbi'),\n                indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n              },\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'Gff3Adapter',\n          configSchema: gff3AdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./Gff3Adapter/Gff3Adapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gff3?$/i\n          const adapterName = 'Gff3Adapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            gffLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  Typography,\n  makeStyles,\n  Select,\n  MenuItem,\n  FormControl,\n} from '@material-ui/core'\n\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    margin: 5,\n  },\n  selectText: {\n    marginRight: 8,\n    marginTop: 10,\n  },\n  flexItem: {\n    marginRight: 8,\n  },\n}))\n\nfunction AssemblySelector({ model }: { model: GridBookmarkModel }) {\n  const classes = useStyles()\n  const { assemblies, selectedAssembly, setSelectedAssembly } = model\n  const noAssemblies = assemblies.length === 0 ? true : false\n\n  const determineCurrentValue = (selectedAssembly: string) => {\n    if (selectedAssembly === 'all') {\n      return 'all'\n    } else {\n      if (assemblies.includes(selectedAssembly)) {\n        return selectedAssembly\n      }\n    }\n\n    return 'none'\n  }\n\n  return (\n    <div className={classes.container}>\n      <Typography className={classes.selectText}>Select assembly:</Typography>\n      <FormControl className={classes.flexItem} disabled={noAssemblies}>\n        <Select\n          value={determineCurrentValue(selectedAssembly)}\n          onChange={event => setSelectedAssembly(event.target.value as string)}\n        >\n          <MenuItem value=\"none\" key=\"no-assembly\">\n            none\n          </MenuItem>\n          <MenuItem value=\"all\" key=\"all-assemblies\">\n            all\n          </MenuItem>\n          {assemblies.map(assembly => (\n            <MenuItem value={assembly} key={assembly}>\n              {assembly}\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n    </div>\n  )\n}\n\nexport default observer(AssemblySelector)\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport { assembleLocString } from '@jbrowse/core/util'\n\nimport {\n  IconButton,\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n}))\n\nfunction DeleteBookmarkDialog({\n  rowNumber,\n  model,\n  onClose,\n}: {\n  rowNumber: number | undefined\n  model: GridBookmarkModel\n  onClose: () => void\n}) {\n  const classes = useStyles()\n\n  const { removeBookmark } = model\n\n  return (\n    <Dialog open={rowNumber !== undefined} onClose={onClose}>\n      <DialogTitle>\n        Delete bookmark\n        <IconButton\n          className={classes.closeDialog}\n          aria-label=\"close-dialog\"\n          onClick={onClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        <Typography>\n          Remove{' '}\n          <code>\n            {rowNumber !== undefined\n              ? assembleLocString(model.bookmarkedRegions[rowNumber])\n              : ''}\n          </code>{' '}\n          ?\n        </Typography>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => {\n            onClose()\n          }}\n        >\n          Cancel\n        </Button>\n\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={() => {\n            if (rowNumber !== undefined) {\n              removeBookmark(rowNumber)\n              onClose()\n            }\n          }}\n        >\n          Confirm\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(DeleteBookmarkDialog)\n","import { saveAs } from 'file-saver'\n\nimport {\n  getSession,\n  parseLocString,\n  when,\n  assembleLocString,\n} from '@jbrowse/core/util'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { AbstractViewModel } from '@jbrowse/core/util/types'\n\nimport { GridBookmarkModel } from './model'\nimport { NavigableViewModel, LabeledRegion } from './types'\n\nexport async function navToBookmark(\n  locString: string,\n  views: AbstractViewModel[],\n  model: GridBookmarkModel,\n) {\n  const { selectedAssembly } = model\n  const lgv = views.find(\n    view =>\n      view.type === 'LinearGenomeView' &&\n      // @ts-ignore\n      view.assemblyNames[0] === selectedAssembly,\n  ) as NavigableViewModel\n\n  if (lgv) {\n    lgv.navToLocString(locString)\n  } else {\n    const session = getSession(model)\n    const { assemblyManager } = session\n    const assembly = await assemblyManager.waitForAssembly(selectedAssembly)\n    if (assembly) {\n      try {\n        const loc = parseLocString(locString, refName =>\n          session.assemblyManager.isValidRefName(refName, selectedAssembly),\n        )\n        const { refName } = loc\n        const { regions } = assembly\n        const canonicalRefName = assembly.getCanonicalRefName(refName)\n\n        let newDisplayedRegion\n        if (regions) {\n          newDisplayedRegion = regions.find(\n            region => region.refName === canonicalRefName,\n          )\n        }\n\n        const view = session.addView('LinearGenomeView', {\n          displayName: selectedAssembly,\n        }) as LinearGenomeViewModel\n        await when(() => view.initialized)\n\n        view.setDisplayedRegions([\n          JSON.parse(JSON.stringify(newDisplayedRegion)),\n        ])\n        view.navToLocString(locString)\n      } catch (e) {\n        session.notify(`${e}`, 'error')\n      }\n    }\n  }\n}\n\nexport function downloadBookmarkFile(\n  bookmarkedRegions: LabeledRegion[],\n  fileFormat: string,\n  model: GridBookmarkModel,\n) {\n  const { selectedAssembly } = model\n  const fileHeader =\n    fileFormat === 'TSV'\n      ? 'chrom\\tstart\\tend\\tlabel\\tassembly_name\\tcoord_range\\n'\n      : ''\n\n  const fileContents = bookmarkedRegions\n    .map(b => {\n      const { label } = b\n      const labelVal = label === '' ? '.' : label\n      const locString = assembleLocString(b)\n\n      if (fileFormat === 'BED') {\n        if (b.assemblyName === selectedAssembly || selectedAssembly === 'all') {\n          // the \"name\" column (column 4) in a BED has a max of 255 characters\n          // according to the new spec: https://github.com/samtools/hts-specs/pull/570\n          return `${b.refName}\\t${b.start}\\t${b.end}\\t${labelVal.slice(\n            0,\n            255,\n          )}\\n`\n        }\n        return ''\n      } else {\n        return `${b.refName}\\t${b.start + 1}\\t${b.end}\\t${labelVal}\\t${\n          b.assemblyName\n        }\\t${locString}\\n`\n      }\n    })\n    .reduce((a, b) => a + b, fileHeader)\n\n  const blob = new Blob([fileContents || ''], {\n    type:\n      fileFormat === 'BED'\n        ? 'text/x-bed;charset=utf-8'\n        : 'text/tab-separated-values;charset=utf-8',\n  })\n\n  let fileName\n  if (fileFormat === 'BED') {\n    fileName = `jbrowse_bookmarks_${selectedAssembly}.bed`\n  } else {\n    fileName = 'jbrowse_bookmarks.tsv'\n  }\n\n  saveAs(blob, fileName)\n}\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  IconButton,\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  MenuItem,\n  Select,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport GetAppIcon from '@material-ui/icons/GetApp'\n\nimport { GridBookmarkModel } from '../model'\nimport { downloadBookmarkFile } from '../utils'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n  flexItem: {\n    margin: 5,\n  },\n  flexContainer: {\n    display: 'flex',\n    justifyContent: 'space-evenly',\n    width: 200,\n  },\n}))\n\nfunction DownloadBookmarks({ model }: { model: GridBookmarkModel }) {\n  const classes = useStyles()\n  const [dialogOpen, setDialogOpen] = useState(false)\n  const [fileType, setFileType] = useState('BED')\n  const { bookmarkedRegions } = model\n\n  return (\n    <>\n      <Button startIcon={<GetAppIcon />} onClick={() => setDialogOpen(true)}>\n        Download\n      </Button>\n      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)}>\n        <DialogTitle>\n          <IconButton\n            className={classes.closeDialog}\n            aria-label=\"close-dialog\"\n            onClick={() => setDialogOpen(false)}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent>\n          <Typography>Format to download</Typography>\n          <Select\n            className={classes.flexItem}\n            data-testid=\"selectFileType\"\n            value={fileType}\n            onChange={event => setFileType(event.target.value as string)}\n          >\n            <MenuItem value=\"BED\">BED</MenuItem>\n            <MenuItem value=\"TSV\">TSV</MenuItem>\n          </Select>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            onClick={() => setDialogOpen(false)}\n          >\n            Cancel\n          </Button>\n          <Button\n            className={classes.flexItem}\n            data-testid=\"dialogDownload\"\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<GetAppIcon />}\n            onClick={() => {\n              downloadBookmarkFile(bookmarkedRegions, fileType, model)\n              setDialogOpen(false)\n            }}\n          >\n            Download\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n}\n\nexport default observer(DownloadBookmarks)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSession } from '@jbrowse/core/util'\nimport AssemblySelector from '@jbrowse/core/ui/AssemblySelector'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { FileSelector } from '@jbrowse/core/ui'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport {\n  IconButton,\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  makeStyles,\n  Typography,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport ImportIcon from '@material-ui/icons/Publish'\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n  flexItem: {\n    margin: 5,\n  },\n}))\n\nfunction ImportBookmarks({\n  model,\n  assemblyName,\n}: {\n  model: GridBookmarkModel\n  assemblyName: string\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { assemblyNames } = session\n  const [dialogOpen, setDialogOpen] = useState(false)\n  const [location, setLocation] = useState<FileLocation>()\n  const [error, setError] = useState<unknown>()\n  const [selectedAsm, setSelectedAsm] = useState(\n    assemblyName || assemblyNames[0],\n  )\n\n  return (\n    <>\n      <Button startIcon={<ImportIcon />} onClick={() => setDialogOpen(true)}>\n        Import\n      </Button>\n      <Dialog\n        open={dialogOpen}\n        onClose={() => setDialogOpen(false)}\n        maxWidth=\"xl\"\n      >\n        <DialogTitle>\n          Import bookmarks\n          <IconButton\n            className={classes.closeDialog}\n            aria-label=\"close-dialog\"\n            onClick={() => setDialogOpen(false)}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent>\n          <Typography>\n            Choose a BED format file to import. The first 4 columns will be used\n          </Typography>\n\n          <FileSelector\n            location={location}\n            setLocation={setLocation}\n            name=\"File\"\n          />\n          <Typography>Select assembly that your data belongs to</Typography>\n          <AssemblySelector\n            onChange={val => setSelectedAsm(val)}\n            session={session}\n            selected={selectedAsm}\n          />\n          {error ? (\n            <Typography color=\"error\" variant=\"h6\">{`${error}`}</Typography>\n          ) : null}\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            onClick={() => setDialogOpen(false)}\n          >\n            Cancel\n          </Button>\n          <Button\n            className={classes.flexItem}\n            data-testid=\"dialogImport\"\n            variant=\"contained\"\n            color=\"primary\"\n            disabled={!location}\n            startIcon={<ImportIcon />}\n            onClick={async () => {\n              try {\n                if (!location) {\n                  return\n                }\n                const data = await openLocation(location).readFile('utf8')\n                const regions = data\n                  .split('\\n')\n                  .filter(f => !!f.trim())\n                  .filter(\n                    f =>\n                      !f.startsWith('#') &&\n                      !f.startsWith('track') &&\n                      !f.startsWith('browser'),\n                  )\n                  .map(line => {\n                    const [refName, start, end, name] = line.split('\\t')\n                    return {\n                      assemblyName: selectedAsm,\n                      refName,\n                      start: +start,\n                      end: +end,\n                      label: name === '.' ? undefined : name,\n                    }\n                  })\n                model.importBookmarks(regions)\n                setDialogOpen(false)\n              } catch (e) {\n                console.error(e)\n                setError(e)\n              }\n            }}\n          >\n            Import\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n}\n\nexport default observer(ImportBookmarks)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  Button,\n  IconButton,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport ClearAllIcon from '@material-ui/icons/ClearAll'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { GridBookmarkModel } from '../model'\n\nconst useStyles = makeStyles(() => ({\n  closeDialog: {\n    position: 'absolute',\n    right: 0,\n    top: 0,\n  },\n  dialogContainer: {\n    margin: 15,\n  },\n}))\n\nfunction ClearBookmarks({ model }: { model: GridBookmarkModel }) {\n  const classes = useStyles()\n  const [dialogOpen, setDialogOpen] = useState(false)\n\n  const { clearAllBookmarks } = model\n\n  return (\n    <>\n      <Button\n        startIcon={<ClearAllIcon />}\n        aria-label=\"clear bookmarks\"\n        onClick={() => setDialogOpen(true)}\n      >\n        Clear\n      </Button>\n      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)}>\n        <DialogTitle>\n          Clear bookmarks\n          <IconButton\n            className={classes.closeDialog}\n            aria-label=\"close-dialog\"\n            onClick={() => setDialogOpen(false)}\n          >\n            <CloseIcon />\n          </IconButton>\n        </DialogTitle>\n        <DialogContent>\n          <Typography>\n            Clear all bookmarks? Note this will clear bookmarks for all\n            assemblies\n          </Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            variant=\"contained\"\n            color=\"secondary\"\n            onClick={() => {\n              setDialogOpen(false)\n            }}\n          >\n            Cancel\n          </Button>\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => {\n              clearAllBookmarks()\n              setDialogOpen(false)\n            }}\n          >\n            Confirm\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  )\n}\n\nexport default observer(ClearBookmarks)\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Link,\n  IconButton,\n  Typography,\n  Button,\n  makeStyles,\n} from '@material-ui/core'\nimport { DataGrid, GridCellParams } from '@mui/x-data-grid'\nimport { getSession, assembleLocString, measureText } from '@jbrowse/core/util'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport ViewCompactIcon from '@material-ui/icons/ViewCompact'\n\nimport AssemblySelector from './AssemblySelector'\nimport DeleteBookmarkDialog from './DeleteBookmark'\nimport DownloadBookmarks from './DownloadBookmarks'\nimport ImportBookmarks from './ImportBookmarks'\nimport ClearBookmarks from './ClearBookmarks'\nimport { GridBookmarkModel } from '../model'\nimport { navToBookmark } from '../utils'\n\nconst useStyles = makeStyles(() => ({\n  link: {\n    cursor: 'pointer',\n  },\n}))\n\n// creates a coarse measurement of column width, similar to code in\n// BaseFeatureDetails\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst measure = (row: any, col: string) =>\n  Math.min(Math.max(measureText(String(row[col]), 14) + 20, 80), 1000)\n\nconst BookmarkGrid = observer(\n  ({ compact, model }: { model: GridBookmarkModel; compact: boolean }) => {\n    const classes = useStyles()\n    const [dialogRowNumber, setDialogRowNumber] = useState<number>()\n    const { bookmarkedRegions, selectedAssembly } = model\n    const { views } = getSession(model)\n\n    const bookmarkRows = bookmarkedRegions\n      .toJS()\n      .filter(\n        region =>\n          selectedAssembly === 'all' ||\n          region.assemblyName === selectedAssembly,\n      )\n      .map((region, index) => {\n        const { assemblyName, ...rest } = region\n        return {\n          ...region,\n          id: index,\n          delete: index,\n          locString: assembleLocString(\n            selectedAssembly === 'all' ? region : rest,\n          ),\n        }\n      })\n\n    const columns = [\n      {\n        field: 'locString',\n        headerName: 'bookmark link',\n        width: Math.max(...bookmarkRows.map(row => measure(row, 'locString'))),\n        renderCell: (params: GridCellParams) => {\n          const { value } = params\n          return (\n            <Link\n              className={classes.link}\n              onClick={(event: React.MouseEvent) => {\n                navToBookmark(value as string, views, model)\n                event.preventDefault()\n              }}\n            >\n              {value}\n            </Link>\n          )\n        },\n      },\n      {\n        field: 'label',\n        width: Math.max(\n          100,\n          Math.max(...bookmarkRows.map(row => measure(row, 'label'))),\n        ),\n        editable: true,\n      },\n      {\n        field: 'delete',\n        width: 30,\n        renderCell: (params: GridCellParams) => {\n          const { value } = params\n          return (\n            <IconButton\n              data-testid=\"deleteBookmark\"\n              aria-label=\"delete\"\n              onClick={() => {\n                if (value !== null && value !== undefined) {\n                  setDialogRowNumber(+value)\n                }\n              }}\n            >\n              <DeleteIcon />\n            </IconButton>\n          )\n        },\n      },\n    ]\n\n    return (\n      <>\n        <DataGrid\n          rows={bookmarkRows}\n          rowHeight={compact ? 25 : undefined}\n          headerHeight={compact ? 25 : undefined}\n          columns={columns}\n          onCellEditCommit={args => {\n            const { value, id } = args\n            model.updateBookmarkLabel(id as number, value as string)\n          }}\n          disableSelectionOnClick\n        />\n\n        <DeleteBookmarkDialog\n          rowNumber={dialogRowNumber}\n          model={model}\n          onClose={() => setDialogRowNumber(undefined)}\n        />\n      </>\n    )\n  },\n)\n\nfunction GridBookmarkWidget({ model }: { model: GridBookmarkModel }) {\n  const { selectedAssembly } = model\n  const [compact, setCompact] = useState(false)\n\n  return (\n    <>\n      <AssemblySelector model={model} />\n      <DownloadBookmarks model={model} />\n      <ImportBookmarks model={model} assemblyName={selectedAssembly} />\n      <ClearBookmarks model={model} />\n      <Button\n        startIcon={<ViewCompactIcon />}\n        onClick={() => setCompact(!compact)}\n      >\n        Compact\n      </Button>\n      <div style={{ margin: 12 }}>\n        <Typography>\n          Note: you can double click the <code>label</code> field to add your\n          own custom notes\n        </Typography>\n      </div>\n      <div style={{ height: 750, width: '100%' }}>\n        <BookmarkGrid model={model} compact={compact} />\n      </div>\n    </>\n  )\n}\n\nexport default observer(GridBookmarkWidget)\n","import { types, cast, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Region as RegionModel, ElementId } from '@jbrowse/core/util/types/mst'\n\nconst LabeledRegionModel = types\n  .compose(\n    RegionModel,\n    types.model('Label', { label: types.optional(types.string, '') }),\n  )\n  .actions(self => ({\n    setLabel(label: string) {\n      self.label = label\n    },\n  }))\n\nexport default function f(pluginManager: PluginManager) {\n  return types\n    .model('GridBookmarkModel', {\n      id: ElementId,\n      type: types.literal('GridBookmarkWidget'),\n      view: types.safeReference(\n        pluginManager.pluggableMstType('view', 'stateModel'),\n      ),\n      bookmarkedRegions: types.array(LabeledRegionModel),\n      modelSelectedAssembly: '',\n    })\n    .actions(self => ({\n      importBookmarks(regions: Region[]) {\n        self.bookmarkedRegions = cast(self.bookmarkedRegions.concat(regions))\n      },\n      addBookmark(region: Region) {\n        self.bookmarkedRegions.push(region)\n      },\n      removeBookmark(index: number) {\n        self.bookmarkedRegions.splice(index, 1)\n      },\n      clearAllBookmarks() {\n        self.bookmarkedRegions.clear()\n      },\n      updateBookmarkLabel(index: number, label: string) {\n        self.bookmarkedRegions[index]?.setLabel(label)\n      },\n      setSelectedAssembly(assembly: string) {\n        self.modelSelectedAssembly = assembly\n      },\n    }))\n    .views(self => ({\n      get selectedAssembly() {\n        return (\n          self.modelSelectedAssembly ||\n          (self.bookmarkedRegions.length\n            ? self.bookmarkedRegions[0].assemblyName\n            : '')\n        )\n      },\n      get assemblies() {\n        return [\n          ...new Set(self.bookmarkedRegions.map(region => region.assemblyName)),\n        ]\n      },\n    }))\n}\n\nexport type GridBookmarkStateModel = ReturnType<typeof f>\nexport type GridBookmarkModel = Instance<GridBookmarkStateModel>\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport { default as ReactComponent } from './components/GridBookmarkWidget'\nexport { default as stateModelFactory } from './model'\nexport const configSchema = ConfigurationSchema('GridBookmarkWidget', {})\n","import { lazy } from 'react'\n\nimport BookmarkIcon from '@material-ui/icons/Bookmark'\nimport BookmarksIcon from '@material-ui/icons/Bookmarks'\n\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\n\nimport {\n  stateModelFactory as GridBookmarkStateModelFactory,\n  configSchema as GridBookmarkConfigSchema,\n} from './GridBookmarkWidget'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\n\nexport default class extends Plugin {\n  name = 'GridBookmarkPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'GridBookmarkWidget',\n        heading: 'Bookmarked regions',\n        configSchema: GridBookmarkConfigSchema,\n        stateModel: GridBookmarkStateModelFactory(pluginManager),\n        ReactComponent: lazy(\n          () => import('./GridBookmarkWidget/components/GridBookmarkWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (pluggableElement.name === 'LinearGenomeView') {\n          const { stateModel } = pluggableElement as ViewType\n          const newStateModel = stateModel.extend(\n            (self: LinearGenomeViewModel) => {\n              const superMenuItems = self.menuItems\n              const superRubberBandMenuItems = self.rubberBandMenuItems\n              return {\n                actions: {\n                  activateBookmarkWidget() {\n                    const session = getSession(self)\n                    if (isSessionModelWithWidgets(session)) {\n                      let bookmarkWidget = session.widgets.get('GridBookmark')\n                      if (!bookmarkWidget) {\n                        bookmarkWidget = session.addWidget(\n                          'GridBookmarkWidget',\n                          'GridBookmark',\n                          { view: self },\n                        )\n                      }\n\n                      session.showWidget(bookmarkWidget)\n                      return bookmarkWidget\n                    }\n\n                    throw new Error('Could not open bookmark widget')\n                  },\n\n                  bookmarkCurrentRegion() {\n                    const selectedRegions = self.getSelectedRegions(\n                      self.leftOffset,\n                      self.rightOffset,\n                    )\n                    const firstRegion = selectedRegions[0]\n                    const session = getSession(self)\n                    if (isSessionModelWithWidgets(session)) {\n                      const { widgets } = session\n                      let bookmarkWidget = widgets.get('GridBookmark')\n                      if (!bookmarkWidget) {\n                        this.activateBookmarkWidget()\n                        bookmarkWidget = widgets.get('GridBookmark')\n                      }\n                      // @ts-ignore\n                      bookmarkWidget.addBookmark(firstRegion)\n                    }\n                  },\n                },\n                views: {\n                  menuItems() {\n                    const newMenuItems = [\n                      ...superMenuItems(),\n                      { type: 'divider' },\n                      {\n                        label: 'Open bookmark widget',\n                        icon: BookmarksIcon,\n                        // @ts-ignore\n                        onClick: self.activateBookmarkWidget,\n                      },\n                      {\n                        label: 'Bookmark current region',\n                        icon: BookmarkIcon,\n                        // @ts-ignore\n                        onClick: self.bookmarkCurrentRegion,\n                      },\n                    ]\n\n                    return newMenuItems\n                  },\n\n                  rubberBandMenuItems() {\n                    const newRubberBandMenuItems = [\n                      ...superRubberBandMenuItems(),\n                      {\n                        label: 'Bookmark region',\n                        icon: BookmarkIcon,\n                        onClick: () => {\n                          const { leftOffset, rightOffset } = self\n                          const selectedRegions = self.getSelectedRegions(\n                            leftOffset,\n                            rightOffset,\n                          )\n                          const firstRegion = selectedRegions[0]\n                          const session = getSession(self)\n                          if (isSessionModelWithWidgets(session)) {\n                            const { widgets } = session\n                            let bookmarkWidget = widgets.get('GridBookmark')\n                            if (!bookmarkWidget) {\n                              // @ts-ignore\n                              self.activateBookmarkWidget()\n                              bookmarkWidget = widgets.get('GridBookmark')\n                            }\n                            // @ts-ignore\n                            bookmarkWidget.addBookmark(firstRegion)\n                          }\n                        },\n                      },\n                    ]\n\n                    return newRubberBandMenuItems\n                  },\n                },\n              }\n            },\n          )\n\n          ;(pluggableElement as ViewType).stateModel = newStateModel\n        }\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(_pluginManager: PluginManager) {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'GtfAdapter',\n  {\n    gtfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.gtf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport { configSchema as gtfAdapterConfigSchema } from './GtfAdapter'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class GtfPlugin extends Plugin {\n  name = 'GTFPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'GtfAdapter',\n          configSchema: gtfAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./GtfAdapter/GtfAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.gtf(\\.gz)?$/i\n          const adapterName = 'GtfAdapter'\n          const fileName = getFileName(file)\n\n          const obj = {\n            type: adapterName,\n            gtfLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { Region } from '@jbrowse/core/util/types'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { BaseLinearDisplayModel } from '@jbrowse/plugin-linear-genome-view'\n\nfunction HicRendering(props: {\n  blockKey: string\n  displayModel: BaseLinearDisplayModel\n  width: number\n  height: number\n  regions: Region[]\n  bpPerPx: number\n}) {\n  const { width, height } = props\n  const canvasWidth = Math.ceil(width)\n  // need to call this in render so we get the right observer behavior\n  return (\n    <div\n      className=\"PileupRendering\"\n      style={{ position: 'relative', width: canvasWidth, height }}\n    >\n      <PrerenderedCanvas\n        {...props}\n        style={{ position: 'absolute', left: 0, top: 0 }}\n      />\n    </div>\n  )\n}\n\nexport default observer(HicRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicRenderer',\n  {\n    baseColor: {\n      type: 'color',\n      description: 'base color to be used in the hic alignment',\n      defaultValue: '#f00',\n    },\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a hic alignment',\n      defaultValue: `jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))`,\n      contextVariable: ['count', 'maxScore', 'baseColor'],\n    },\n\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a hic rendering',\n      defaultValue: 600,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import Color from 'color'\nimport ServerSideRendererType, {\n  RenderArgs as ServerSideRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as ServerSideRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized as ServerSideResultsSerialized,\n  ResultsDeserialized as ServerSideResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType'\nimport { Region } from '@jbrowse/core/util/types'\nimport { abortBreakPoint } from '@jbrowse/core/util'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { toArray } from 'rxjs/operators'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface HicFeature {\n  bin1: number\n  bin2: number\n  counts: number\n}\n\ninterface HicDataAdapter extends BaseFeatureDataAdapter {\n  getResolution: (bp: number) => Promise<number>\n}\n\nexport interface RenderArgs extends ServerSideRenderArgs {\n  regions: Region[]\n}\n\nexport interface RenderArgsDeserialized\n  extends ServerSideRenderArgsDeserialized {\n  regions: Region[]\n  dataAdapter: HicDataAdapter\n  bpPerPx: number\n  highResolutionScaling: number\n  resolution: number\n  adapterConfig: AnyConfigurationModel\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: HicFeature[]\n}\n\nexport type { RenderArgsSerialized, RenderResults }\n\nexport type ResultsSerialized = ServerSideResultsSerialized\n\nexport type ResultsDeserialized = ServerSideResultsDeserialized\n\nexport default class HicRenderer extends ServerSideRendererType {\n  supportsSVG = true\n\n  async makeImageData(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      config,\n      bpPerPx,\n      signal,\n      resolution,\n      sessionId,\n      adapterConfig,\n    } = props\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const res = await (dataAdapter as HicDataAdapter).getResolution(\n      bpPerPx / resolution,\n    )\n    const w = res / (bpPerPx * Math.sqrt(2))\n    const baseColor = Color(readConfObject(config, 'baseColor'))\n    if (features.length) {\n      const offset = features[0].bin1\n      let maxScore = 0\n      let minBin = 0\n      let maxBin = 0\n      await abortBreakPoint(signal)\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        maxScore = Math.max(counts, maxScore)\n        minBin = Math.min(Math.min(bin1, bin2), minBin)\n        maxBin = Math.max(Math.max(bin1, bin2), maxBin)\n      }\n      await abortBreakPoint(signal)\n      ctx.rotate(-Math.PI / 4)\n      let start = Date.now()\n      for (let i = 0; i < features.length; i++) {\n        const { bin1, bin2, counts } = features[i]\n        ctx.fillStyle = readConfObject(config, 'color', {\n          count: counts,\n          maxScore,\n          baseColor,\n        })\n        ctx.fillRect((bin1 - offset) * w, (bin2 - offset) * w, w, w)\n        if (+Date.now() - start > 400) {\n          await abortBreakPoint(signal)\n          start = +Date.now()\n        }\n      }\n    }\n  }\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const { config, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const height = readConfObject(config, 'maxHeight')\n    const features = await this.getFeatures(renderProps)\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) => {\n        return this.makeImageData(ctx, {\n          ...renderProps,\n          features,\n        })\n      },\n    )\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      region: renderProps.regions[0],\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      height,\n      width,\n    }\n  }\n\n  async getFeatures(args: RenderArgsDeserialized) {\n    const { regions, sessionId, adapterConfig } = args\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n    const features = await (dataAdapter as BaseFeatureDataAdapter)\n      .getFeatures(regions[0], args)\n      .pipe(toArray())\n      .toPromise()\n    // cast to any to avoid return-type conflict, because the\n    // types of features returned by our getFeatures are quite\n    // different from the base interface\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return features as any\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nconst HicTrackConfigFactory = (pluginManager: PluginManager) => {\n  const HicRendererConfigSchema =\n    pluginManager.getRendererType('HicRenderer').configSchema\n\n  return ConfigurationSchema(\n    'LinearHicDisplay',\n    { renderer: HicRendererConfigSchema },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport type HicTrackConfigModel = ReturnType<typeof HicTrackConfigFactory>\nexport type HicTrackConfig = Instance<HicTrackConfigModel>\nexport default HicTrackConfigFactory\n","import { ConfigurationReference, getConf } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\nimport { types, getEnv } from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\n\nexport default (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearHicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearHicDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        resolution: types.optional(types.number, 1),\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        get rendererTypeName() {\n          return 'HicRenderer'\n        },\n\n        renderProps() {\n          const config = self.rendererType.configSchema.create(\n            getConf(self, 'renderer') || {},\n            getEnv(self),\n          )\n\n          return {\n            ...superRenderProps(),\n            config,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            resolution: self.resolution,\n          }\n        },\n      }\n    })\n    .actions(self => ({\n      setResolution(n: number) {\n        self.resolution = n\n      },\n    }))\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Resolution',\n              subMenu: [\n                {\n                  label: 'Finer resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution * 2)\n                  },\n                },\n                {\n                  label: 'Coarser resolution',\n                  onClick: () => {\n                    self.setResolution(self.resolution / 2)\n                  },\n                },\n              ],\n            },\n          ]\n        },\n      }\n    })\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'HicAdapter',\n  {\n    hicLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.hic', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport Color from 'color'\nimport HicRenderer, {\n  configSchema as hicRendererConfigSchema,\n  ReactComponent as HicRendererReactComponent,\n} from './HicRenderer'\nimport {\n  configSchemaFactory as linearHicdisplayConfigSchemaFactory,\n  modelFactory as linearHicdisplayModelFactory,\n} from './LinearHicDisplay'\nimport hicAdapterConfigSchema from './HicAdapter/configSchema'\nimport {\n  AdapterGuesser,\n  getFileName,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class HicPlugin extends Plugin {\n  name = 'HicPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'HicAdapter',\n          configSchema: hicAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./HicAdapter/HicAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.hic/i\n          const adapterName = 'HicAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            hicLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'HicAdapter') {\n            return 'HicTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n    pluginManager.addRendererType(\n      () =>\n        new HicRenderer({\n          name: 'HicRenderer',\n          ReactComponent: HicRendererReactComponent,\n          configSchema: hicRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'HicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'HicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'HicTrack',\n          configSchema,\n        ),\n      })\n    })\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearHicdisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearHicDisplay',\n        configSchema,\n        stateModel: linearHicdisplayModelFactory(configSchema),\n        trackType: 'HicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    pluginManager.jexl.addFunction('alpha', (color: Color, value: number) =>\n      color.alpha(value),\n    )\n    pluginManager.jexl.addFunction('hsl', (color: Color) => color.hsl())\n    pluginManager.jexl.addFunction('colorString', (color: Color) =>\n      color.string(),\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'NCListAdapter',\n  {\n    rootUrlTemplate: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my/{refseq}/trackData.json',\n        locationType: 'UriLocation',\n      },\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of refNames used by the NCList used for aliasing',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/*\n * Helper class allows reading names index generated in JBrowse1\n * Adapted from https://github.com/GMOD/jbrowse/blob/master/src/JBrowse/Store/Hash.js\n */\nimport crc32 from 'buffer-crc32'\n\nexport default class HttpMap {\n  url: string\n\n  constructor(args: { url: string }) {\n    // make sure url has a trailing slash\n    this.url = /\\/$/.test(args.url) ? args.url : `${args.url}/`\n  }\n\n  /**\n   * loads meta.json file from names directory and reads number of hash_bits used\n   */\n  async readMeta() {\n    const meta = await this.loadFile('meta.json')\n    const { compress, track_names: tracks } = meta\n    const hashHexCharacters = Math.ceil(meta.hash_bits / 4)\n    return { hashHexCharacters, compress, tracks }\n  }\n\n  async getHashHexCharacters() {\n    const meta = await this.readMeta()\n    return meta.hashHexCharacters\n  }\n\n  async getCompress() {\n    const meta = await this.readMeta()\n    return meta.compress\n  }\n\n  async getTrackNames() {\n    const meta = await this.readMeta()\n    return meta.tracks\n  }\n\n  /**\n   * Returns contents of a bucket given a key\n   * @param key - string\n   */\n  async get(key: string) {\n    const bucket = await this.getBucket(key)\n    return bucket[key]\n  }\n\n  /**\n   * Returns a bucket given a key\n   * @param key - string\n   */\n  async getBucket(key: string) {\n    const bucketIdent = this.hash(key)\n    const hexToDirPath = await this.hexToDirPath(bucketIdent)\n    return this.loadFile(hexToDirPath)\n  }\n\n  /**\n   * Loads a file using the url and provided id.\n   * Returns response object with contents of the file\n   * @param id - string\n   */\n  async loadFile(id: string) {\n    const response = await fetch(`${this.url}${id}`)\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status} ${response.statusText}`)\n    }\n    return response.json()\n  }\n\n  /**\n   * Returns the corresponding path of the file given a hex string\n   * @param hex - hex string\n   */\n  async hexToDirPath(hex: string) {\n    // zero-pad the hex string to be 8 chars if necessary\n    const hashHexCharacters = await this.getHashHexCharacters()\n    if (hashHexCharacters) {\n      const compress = await this.getCompress()\n      while (hex.length < 8) {\n        hex = `0${hex}`\n      }\n      hex = hex.substr(8 - hashHexCharacters)\n      const dirpath = []\n      for (let i = 0; i < hex.length; i += 3) {\n        dirpath.push(hex.substring(i, i + 3))\n      }\n      return `${dirpath.join('/')}.json${compress ? 'z' : ''}`\n    }\n    return ''\n  }\n\n  hash(data: string) {\n    return crc32(Buffer.from(data))\n      .toString('hex')\n      .toLowerCase()\n      .replace('-', 'n')\n  }\n}\n","import {\n  BaseTextSearchAdapter,\n  BaseArgs,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\nimport HttpMap from './HttpMap'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nexport interface TooManyHits {\n  name: string\n  hitLimit: number\n}\n\ninterface SearchResults {\n  prefix: ({ name: string } | string)[]\n  exact: [string, number, string, string, number, number][]\n}\n\nexport type NamesIndexRecord = string | Array<string | number>\n\n//  Jbrowse1 text search adapter\n// Uses index built by generate-names.pl\nexport default class JBrowse1TextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  httpMap: HttpMap\n\n  tracksNames?: string[]\n\n  constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const namesIndexLocation = readConfObject(config, 'namesIndexLocation')\n    if (!namesIndexLocation) {\n      throw new Error('must provide namesIndexLocation')\n    }\n    this.httpMap = new HttpMap({\n      url: namesIndexLocation.baseUri\n        ? new URL(namesIndexLocation.uri, namesIndexLocation.baseUri).href\n        : namesIndexLocation.uri,\n    })\n  }\n\n  /**\n   * Returns the contents of the file containing the query if it exists\n   * else it returns empty\n   * @param query - string query\n   */\n  async loadIndexFile(query: string): Promise<Record<string, SearchResults>> {\n    return this.httpMap.getBucket(query)\n  }\n\n  async searchIndex(args: BaseArgs) {\n    const { searchType, queryString } = args\n    const tracks = this.tracksNames || (await this.httpMap.getTrackNames())\n    const entries = await this.loadIndexFile(queryString.toLowerCase())\n    if (entries[queryString]) {\n      return this.formatResults(entries[queryString], tracks, searchType)\n    }\n    return []\n  }\n  formatResults(results: SearchResults, tracks: string[], searchType?: string) {\n    return [\n      ...(searchType === 'exact'\n        ? []\n        : results.prefix.map(result => {\n            return new BaseResult({\n              label: typeof result === 'object' ? result.name : result,\n              matchedAttribute: 'name',\n              matchedObject: { result: result },\n            })\n          })),\n      ...results.exact.map(result => {\n        const name = result[0] as string\n        const trackIndex = result[1] as number\n        const refName = result[3] as string\n        const start = result[4] as number\n        const end = result[5] as number\n        const locstring = `${refName || name}:${start}-${end}`\n        return new BaseResult({\n          locString: locstring,\n          label: name,\n          matchedAttribute: 'name',\n          matchedObject: result,\n          trackId: tracks[trackIndex],\n        })\n      }),\n    ].filter(result => result.getLabel() !== 'too many matches')\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'JBrowse1TextSearchAdapter',\n  {\n    // metadata about tracks and assemblies covered by text search adapter\n    namesIndexLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/volvox/names', locationType: 'UriLocation' },\n      description: 'the location of the JBrowse1 names index data directory',\n    },\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  { explicitlyTyped: true, explicitIdentifier: 'textSearchAdapterId' },\n)\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'JBrowse1Connection',\n  {\n    dataDirLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'http://mysite.com/jbrowse/data/',\n        locationType: 'UriLocation',\n      },\n      description:\n        'the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/',\n    },\n    assemblyNames: {\n      description:\n        'name of the assembly the connection belongs to, should be a single entry',\n      type: 'stringArray',\n      defaultValue: [],\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","import getValue from 'get-value'\nimport { Track, Source } from './types'\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isTrack(arg: any): arg is Track {\n  return arg && arg.label && typeof arg.label === 'string'\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isSource(arg: any): arg is Source {\n  return arg && arg.url && typeof arg.url === 'string'\n}\n\n/**\n * updates a with values from b, recursively\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Obj = Record<string, any>\nexport function deepUpdate(a: Obj, b: Obj): Obj {\n  for (const prop of Object.keys(b)) {\n    if (\n      prop in a &&\n      typeof b[prop] === 'object' &&\n      typeof a[prop] === 'object'\n    ) {\n      deepUpdate(a[prop], b[prop])\n    } else if (\n      typeof a[prop] === 'undefined' ||\n      typeof b[prop] !== 'undefined'\n    ) {\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * replace variables in a template string with values\n * @param template - String with variable names in curly brackets\n * e.g., `http://foo/{bar}?arg={baz.foo}`\n * @param fillWith - object with attribute-value mappings\n * e.g., `{ 'bar': 'someurl', 'baz': { 'foo': 42 } }`\n * @returns the template string with variables in fillWith replaced\n * e.g., 'htp://foo/someurl?arg=valueforbaz'\n */\nexport function fillTemplate(template: string, fillWith: Obj): string {\n  return template.replace(\n    /\\{([\\w\\s.]+)\\}/g,\n    (match, varName: string): string => {\n      varName = varName.replace(/\\s+/g, '') // remove all whitespace\n      const fill = getValue(fillWith, varName)\n      if (fill !== undefined) {\n        if (typeof fill === 'function') {\n          return fill(varName)\n        }\n        return fill\n      }\n      if (fillWith.callback) {\n        // @ts-ignore\n        const v = fillWith.callback.call(this, varName)\n        if (v !== undefined) {\n          return v\n        }\n      }\n      return match\n    },\n  )\n}\n\n/**\n * Clones objects (including DOM nodes) and all children.\n * Warning: do not clone cyclic structures\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n * @param src - The object to clone\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function clone(src: any): any {\n  if (\n    !src ||\n    typeof src !== 'object' ||\n    Object.prototype.toString.call(src) === '[object Function]'\n  ) {\n    // null, undefined, any non-object, or function\n    return src // anything\n  }\n  if (src.nodeType && 'cloneNode' in src) {\n    // DOM Node\n    return src.cloneNode(true) // Node\n  }\n  if (src instanceof Date) {\n    // Date\n    return new Date(src.getTime()) // Date\n  }\n  if (src instanceof RegExp) {\n    // RegExp\n    return new RegExp(src) // RegExp\n  }\n  let r\n  let i\n  let l\n  if (Array.isArray(src)) {\n    // array\n    r = []\n    for (i = 0, l = src.length; i < l; ++i) {\n      if (i in src) {\n        r[i] = clone(src[i])\n      }\n    }\n    // we don't clone functions for performance reasons\n    //    }else if(d.isFunction(src)){\n    //      // function\n    //      r = function(){ return src.apply(this, arguments); };\n  } else {\n    // generic objects\n    r = src.constructor ? new src.constructor() : {}\n  }\n  return mixin(r, src, clone)\n}\n\n/**\n * Copies/adds all properties of source to dest; returns dest.\n * (Lifted from dojo https://github.com/dojo/dojo/blob/master/_base/lang.js)\n *\n * All properties, including functions (sometimes termed \"methods\"), excluding\n * any non-standard extensions found in Object.prototype, are copied/added to\n * dest. Copying/adding each particular property is delegated to copyFunc\n * (if any); copyFunc defaults to the Javascript assignment operator if not\n * provided. Notice that by default, mixin executes a so-called \"shallow copy\"\n * and aggregate types are copied/added by reference.\n * @param dest - The object to which to copy/add all properties contained in\n * source.\n * @param source - The object from which to draw all properties to copy into dest.\n * @param copyFunc - The process used to copy/add a property in source; defaults\n * to the Javascript assignment operator.\n * @returns dest, as modified\n */\nfunction mixin(dest: Obj, source: Obj, copyFunc: Function): Obj {\n  let name\n  let s\n  const empty = {}\n  for (name in source) {\n    // the (!(name in empty) || empty[name] !== s) condition avoids copying\n    // properties in \"source\" inherited from Object.prototype.\t For example,\n    // if dest has a custom toString() method, don't overwrite it with the\n    // toString() method that source inherited from Object.prototype\n    s = source[name]\n    if (\n      !(name in dest) ||\n      // @ts-ignore\n      (dest[name] !== s && (!(name in empty) || empty[name] !== s))\n    ) {\n      dest[name] = copyFunc ? copyFunc(s) : s\n    }\n  }\n\n  return dest // Object\n}\n","/* eslint no-cond-assign: [\"error\", \"except-parens\"] */\nimport getValue from 'get-value'\nimport setValue from 'set-value'\nimport { objectHash } from '@jbrowse/core/util'\nimport { isSource, isTrack } from './util'\nimport { Config, Track, Source, Store, Names } from './types'\n\nexport function parseJB1Json(config: Config | string, url: string): Config {\n  if (typeof config === 'string') {\n    let parsedConf\n    try {\n      parsedConf = JSON.parse(config)\n    } catch (error) {\n      throw new Error(`${error} when parsing configuration.`)\n    }\n    return regularizeConf(parsedConf, url)\n  }\n  return regularizeConf(config, url)\n}\n\nexport function parseJB1Conf(config: string, url: string): Config {\n  let parsedConf\n  try {\n    parsedConf = parse(config, url)\n  } catch (error) {\n    throw new Error(`${error} when parsing configuration.`)\n  }\n  return regularizeConf(parsedConf, url)\n}\n\nfunction isAlwaysArray(varName: string): boolean {\n  if (varName === 'include') {\n    return true\n  }\n  return false\n}\n\nfunction parse(text: string, url: string): Config {\n  let section: string[] = []\n  let keyPath: string[] | undefined\n  let operation: string\n  let value: string | undefined\n  const data: Config = { tracks: {} }\n  let lineNumber: number\n\n  function recordVal(): void {\n    if (value !== undefined) {\n      let parsedValue:\n        | string\n        | number\n        | boolean\n        | string[]\n        | number[]\n        | boolean[]\n      try {\n        // parse json\n        const match = value.match(/^json:(.+)/i)\n        if (match) {\n          parsedValue = JSON.parse(match[1])\n        }\n        // parse numbers if it looks numeric\n        else if (/^[+-]?[\\d.,]+([eE][-+]?\\d+)?$/.test(value)) {\n          parsedValue = parseFloat(value.replace(/,/g, ''))\n        } else {\n          parsedValue = value\n        }\n\n        if (!keyPath) {\n          throw new Error(`Error parsing in section ${section.join(' - ')}`)\n        }\n        const path = section.concat(keyPath).join('.')\n        if (operation === '+=') {\n          let existing = getValue(data, path)\n          if (existing) {\n            if (!Array.isArray(existing)) {\n              existing = [existing]\n            }\n          } else {\n            existing = []\n          }\n\n          existing.push(parsedValue)\n          parsedValue = existing\n        }\n        if (parsedValue === 'true') {\n          parsedValue = true\n        }\n        if (parsedValue === 'false') {\n          parsedValue = false\n        }\n        setValue(data, path, parsedValue)\n      } catch (e) {\n        throw new Error(\n          `syntax error${url ? ` in ${url}` : ''}${\n            lineNumber ? ` at line ${lineNumber - 1}` : ''\n          }`,\n        )\n      }\n    }\n  }\n\n  text.split('\\n').forEach((textLine, i): void => {\n    lineNumber = i + 1\n    const line = textLine.replace(/^\\s*#.+/, '')\n\n    // new section\n    let match: RegExpMatchArray | null\n    if ((match = line.match(/^\\s*\\[([^\\]]+)/))) {\n      // new section\n      recordVal()\n      keyPath = undefined\n      value = undefined\n      section = match[1].trim().split(/\\s*\\.\\s*/)\n      if (section.length === 1 && section[0].toLowerCase() === 'general') {\n        section = []\n      }\n    }\n    // new value\n    else if (\n      (match = line.match(\n        value === undefined ? /^([^+=]+)(\\+?=)(.*)/ : /^(\\S[^+=]+)(\\+?=)(.*)/,\n      ))\n    ) {\n      recordVal()\n      keyPath = match[1].trim().split(/\\s*\\.\\s*/)\n      ;[, , operation] = match\n      if (isAlwaysArray(section.concat(keyPath).join('.'))) {\n        operation = '+='\n      }\n      value = match[3].trim()\n    }\n    // add to existing array value\n    else if (\n      keyPath !== undefined &&\n      (match = line.match(/^\\s{0,4}\\+\\s*(.+)/))\n    ) {\n      recordVal()\n      operation = '+='\n      value = match[1].trim()\n    }\n    // add to existing value\n    else if (value !== undefined && (match = line.match(/^\\s+(\\S.*)/))) {\n      value += value.length ? ` ${match[1].trim()}` : match[1].trim()\n    }\n    // done with last value\n    else {\n      recordVal()\n      keyPath = undefined\n      value = undefined\n    }\n  })\n\n  recordVal()\n\n  return data\n}\n\n/**\n * Applies defaults and any other necessary tweaks to the loaded configuration.\n * @param conf - the object containing the configuration, which it modifies\n * in-place\n * @param url - URL of the config file\n * @returns the same object it was passed\n */\nexport function regularizeConf(conf: Config, url: string): Config {\n  // if tracks is not an array, convert it to one\n  if (conf.tracks && !Array.isArray(conf.tracks)) {\n    // if it's a single track config, wrap it in an arrayref\n    if (isTrack(conf.tracks)) {\n      conf.tracks = [conf.tracks]\n    }\n    // otherwise, coerce it to an array\n    else {\n      const tracks: Track[] = []\n      for (const label of Object.keys(conf.tracks)) {\n        const track = conf.tracks[label]\n        if (isTrack(track)) {\n          tracks.push(track)\n        } else {\n          tracks.push({ label, ...track })\n        }\n      }\n      conf.tracks = tracks\n    }\n  }\n\n  // regularize trackMetadata.sources\n  const meta = conf.trackMetadata\n  if (meta && meta.sources) {\n    // if it's a single source config, wrap it in an arrayref\n    if (typeof meta.sources === 'string') {\n      meta.sources = [meta.sources]\n    }\n    if (isSource(meta.sources)) {\n      meta.sources = [meta.sources]\n    }\n\n    if (!Array.isArray(meta.sources)) {\n      const sources: Source[] = []\n      for (const name of Object.keys(meta.sources)) {\n        const source = meta.sources[name]\n        if (!('name' in source)) {\n          source.name = name\n        }\n        sources.push(source)\n      }\n      meta.sources = sources\n    }\n\n    // coerce any string source defs to be URLs, and try to detect their types\n    meta.sources = meta.sources.map((sourceDef: string | Source): Source => {\n      if (typeof sourceDef === 'string') {\n        const newSourceDef: Source = { url: sourceDef }\n        const typeMatch = sourceDef.match(/\\.(\\w+)$/)\n        if (typeMatch) {\n          newSourceDef.type = typeMatch[1].toLowerCase()\n        }\n        return newSourceDef\n      }\n      return sourceDef\n    })\n  }\n\n  conf.sourceUrl = conf.sourceUrl || url\n  if (conf.sourceUrl.startsWith('/')) {\n    conf.sourceUrl = new URL(conf.sourceUrl, window.location.href).href\n  }\n  conf.baseUrl = conf.baseUrl || new URL('.', conf.sourceUrl).href\n  if (conf.baseUrl.length && !conf.baseUrl.endsWith('/')) {\n    conf.baseUrl += '/'\n  }\n\n  if (conf.sourceUrl) {\n    // set a default baseUrl in each of the track and store confs, and the names\n    // conf, if needed\n    const addBase: (Track | Store | Names)[] = []\n    if (conf.tracks) {\n      addBase.push(...conf.tracks)\n    }\n    if (conf.stores) {\n      addBase.push(...Object.values(conf.stores))\n    }\n    if (conf.names) {\n      addBase.push(conf.names)\n    }\n\n    addBase.forEach((t): void => {\n      if (!t.baseUrl) {\n        t.baseUrl = conf.baseUrl || '/'\n      }\n    })\n\n    // resolve the refSeqs and nameUrl if present\n    if (conf.refSeqs && typeof conf.refSeqs === 'string') {\n      conf.refSeqs = new URL(conf.refSeqs, conf.sourceUrl).href\n    }\n    if (conf.nameUrl) {\n      conf.nameUrl = new URL(conf.nameUrl, conf.sourceUrl).href\n    }\n  }\n\n  conf.stores = conf.stores || {}\n  ;(conf.tracks || []).forEach((trackConfig: Track): void => {\n    // if there is a `config` subpart, just copy its keys in to the top-level\n    // config\n    if (trackConfig.config) {\n      const c = trackConfig.config\n      delete trackConfig.config\n      trackConfig = { ...c, ...trackConfig }\n    }\n\n    // skip if it's a new-style track def\n    if (trackConfig.store) {\n      return\n    }\n\n    let trackClassName: string\n    if (trackConfig.type === 'FeatureTrack') {\n      trackClassName = 'JBrowse/View/Track/HTMLFeatures'\n    } else if (trackConfig.type === 'ImageTrack') {\n      trackClassName = 'JBrowse/View/Track/FixedImage'\n    } else if (trackConfig.type === 'ImageTrack.Wiggle') {\n      trackClassName = 'JBrowse/View/Track/FixedImage/Wiggle'\n    } else if (trackConfig.type === 'SequenceTrack') {\n      trackClassName = 'JBrowse/View/Track/Sequence'\n    } else {\n      trackClassName = regularizeClass('JBrowse/View/Track', trackConfig.type)\n    }\n\n    trackConfig.type = trackClassName\n\n    synthesizeTrackStoreConfig(conf, trackConfig)\n\n    if (trackConfig.histograms) {\n      if (!trackConfig.histograms.baseUrl) {\n        trackConfig.histograms.baseUrl = trackConfig.baseUrl\n      }\n      synthesizeTrackStoreConfig(conf, trackConfig.histograms)\n    }\n  })\n\n  return conf\n}\n\n/**\n * prefix class name with `root` if it contains no slashes\n * @param root - Prefix root\n * @param className - class name\n */\nfunction regularizeClass(root: string, className: string | undefined): string {\n  if (!className) {\n    return ''\n  }\n  if (!className.includes('/')) {\n    className = `${root}/${className}`\n  }\n  className = className.replace(/^\\//, '')\n  return className\n}\n\nfunction guessStoreClass(\n  trackConfig: Track | undefined,\n  urlTemplate: string,\n): string {\n  if (!trackConfig) {\n    return ''\n  }\n  if (trackConfig.type && trackConfig.type.includes('/FixedImage')) {\n    return `JBrowse/Store/TiledImage/Fixed${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.jsonz?$/i.test(urlTemplate)) {\n    return `JBrowse/Store/SeqFeature/NCList${\n      trackConfig.backendVersion === 0 ? '_v0' : ''\n    }`\n  }\n  if (/\\.bam$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BAM'\n  }\n  if (/\\.cram$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/CRAM'\n  }\n  if (/\\.gff3?$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3'\n  }\n  if (/\\.bed$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BED'\n  }\n  if (/\\.vcf.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/VCFTabix'\n  }\n  if (/\\.gff3?.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/GFF3Tabix'\n  }\n  if (/\\.bed.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BEDTabix'\n  }\n  if (/\\.(bw|bigwig)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigWig'\n  }\n  if (/\\.(bb|bigbed)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BigBed'\n  }\n  if (/\\.(fa|fasta)$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/IndexedFasta'\n  }\n  if (/\\.(fa|fasta)\\.b?gz$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/BgzipIndexedFasta'\n  }\n  if (/\\.2bit$/i.test(urlTemplate)) {\n    return 'JBrowse/Store/SeqFeature/TwoBit'\n  }\n  if (trackConfig.type && trackConfig.type.endsWith('/Sequence')) {\n    return 'JBrowse/Store/Sequence/StaticChunked'\n  }\n  return ''\n}\n\nfunction synthesizeTrackStoreConfig(\n  mainConf: Config,\n  trackConfig: Track,\n): void {\n  // figure out what data store class to use with the track, applying some\n  // defaults if it is not explicit in the configuration\n  const { urlTemplate = '' } = trackConfig\n\n  let storeClass: string\n  if (trackConfig.storeClass) {\n    storeClass = regularizeClass('JBrowse/Store', trackConfig.storeClass)\n  } else {\n    storeClass = guessStoreClass(trackConfig, urlTemplate)\n  }\n\n  if (!storeClass) {\n    console.warn(\n      `Unable to determine an appropriate data store to use with track '${trackConfig.label}', please explicitly specify a storeClass in the configuration.`,\n    )\n    return\n  }\n\n  // synthesize a separate store conf\n  const storeConf: Store = { ...trackConfig, type: storeClass }\n\n  // if this is the first sequence store we see, and we have no refseqs store\n  // defined explicitly, make this the refseqs store.\n  if (\n    (storeClass === 'JBrowse/Store/Sequence/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta' ||\n      storeClass === 'JBrowse/Store/SeqFeature/TwoBit' ||\n      storeClass === 'JBrowse/Store/Sequence/TwoBit' ||\n      trackConfig.useAsRefSeqStore) &&\n    !(mainConf.stores && mainConf.stores.refseqs)\n  ) {\n    storeConf.name = 'refseqs'\n  } else {\n    storeConf.name = `store${objectHash(storeConf)}`\n  }\n  // record it\n  if (!mainConf.stores) {\n    mainConf.stores = {}\n  }\n  mainConf.stores[storeConf.name] = storeConf\n\n  // connect it to the track conf\n  trackConfig.store = storeConf.name\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { parseJB1Json, parseJB1Conf, regularizeConf } from './jb1ConfigParse'\nimport { clone, deepUpdate, fillTemplate } from './util'\nimport {\n  JBLocation,\n  UriLocation,\n  LocalPathLocation,\n  Config,\n  Track,\n  Include,\n} from './types'\n\nfunction isUriLocation(location: JBLocation): location is UriLocation {\n  return (location as UriLocation).uri !== undefined\n}\n\nfunction isLocalPathLocation(\n  location: JBLocation,\n): location is LocalPathLocation {\n  return (location as LocalPathLocation).localPath !== undefined\n}\n\nexport async function fetchJb1(\n  dataRoot: JBLocation = { uri: '', locationType: 'UriLocation' },\n  baseConfig: Config = {\n    include: ['{dataRoot}/trackList.json', '{dataRoot}/tracks.conf'],\n  },\n  baseConfigRoot: JBLocation = { uri: '', locationType: 'UriLocation' },\n): Promise<Config> {\n  const protocol = 'uri' in dataRoot ? 'uri' : 'localPath'\n  const dataRootReg = JSON.parse(JSON.stringify(dataRoot))\n  let dataRootLocation = ''\n  if (isUriLocation(dataRoot)) {\n    dataRootLocation = dataRoot.uri\n  }\n  if (isLocalPathLocation(dataRoot)) {\n    dataRootLocation = dataRoot.localPath\n  }\n  if (dataRootLocation.endsWith('/')) {\n    dataRootReg[protocol] = dataRootLocation.slice(\n      0,\n      dataRootLocation.length - 1,\n    )\n  }\n  if (\n    (isUriLocation(baseConfigRoot) && baseConfigRoot.uri) ||\n    (isLocalPathLocation(baseConfigRoot) && baseConfigRoot.localPath)\n  ) {\n    const baseProtocol = 'uri' in baseConfigRoot ? 'uri' : 'localPath'\n    let baseConfigLocation = ''\n    if (isUriLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.uri\n    }\n    if (isLocalPathLocation(baseConfigRoot)) {\n      baseConfigLocation = baseConfigRoot.localPath\n    }\n    if (baseConfigLocation.endsWith('/')) {\n      baseConfigLocation = baseConfigLocation.slice(\n        0,\n        baseConfigLocation.length - 1,\n      )\n    }\n    let newConfig: Config = {}\n    for (const conf of ['jbrowse.conf', 'jbrowse_conf.json']) {\n      let fetchedConfig = null\n      try {\n        // @ts-ignore\n        fetchedConfig = await fetchConfigFile({\n          [baseProtocol]: `${baseConfigLocation}/${conf}`,\n        })\n      } catch (error) {\n        console.error(\n          `tried to access ${baseConfigLocation}/${conf}, but failed`,\n        )\n      }\n      newConfig = mergeConfigs(newConfig, fetchedConfig) || {}\n    }\n    if (dataRootReg[protocol]) {\n      newConfig.dataRoot = dataRootReg[protocol]\n    }\n    return createFinalConfig(newConfig)\n  }\n  const newConfig = regularizeConf(baseConfig, window.location.href)\n  if (dataRootReg[protocol]) {\n    newConfig.dataRoot = dataRootReg[protocol]\n  }\n  return createFinalConfig(newConfig)\n}\n\nexport async function createFinalConfig(\n  baseConfig: Config,\n  defaults = configDefaults,\n): Promise<Config> {\n  const configWithDefaults = deepUpdate(clone(defaults), baseConfig)\n  let finalConfig = await loadIncludes(configWithDefaults)\n  finalConfig = mergeConfigs(finalConfig, baseConfig) || finalConfig\n  fillTemplates(finalConfig, finalConfig)\n  validateConfig(finalConfig)\n  return finalConfig\n}\n\nexport async function fetchConfigFile(location: JBLocation): Promise<Config> {\n  const result = await openLocation(location).readFile('utf8')\n  if (isUriLocation(location)) {\n    return parseJb1(result, location.uri)\n  }\n  if (isLocalPathLocation(location)) {\n    return parseJb1(result, location.localPath)\n  }\n  return parseJb1(result)\n}\n\nexport function parseJb1(config: string, url = ''): Config {\n  if (config.trim().startsWith('{')) {\n    return parseJB1Json(config, url)\n  }\n  return parseJB1Conf(config, url)\n}\n\n/**\n * Merges config object b into a. Properties in b override those in a.\n */\nfunction mergeConfigs(a: Config | null, b: Config | null): Config | null {\n  if (b === null) {\n    return null\n  }\n\n  if (a === null) {\n    a = {}\n  }\n\n  for (const prop of Object.keys(b)) {\n    if (prop === 'tracks' && prop in a) {\n      const aTracks = a[prop] || []\n      const bTracks = b[prop] || []\n      if (Array.isArray(aTracks) && Array.isArray(bTracks)) {\n        a[prop] = mergeTrackConfigs(aTracks || [], bTracks || [])\n      } else {\n        throw new Error(\n          `Track config has not been properly regularized: ${aTracks} ${bTracks}`,\n        )\n      }\n    } else if (\n      !noRecursiveMerge(prop) &&\n      prop in a &&\n      // @ts-ignore\n      typeof b[prop] === 'object' &&\n      // @ts-ignore\n      typeof a[prop] === 'object'\n    ) {\n      // @ts-ignore\n      a[prop] = deepUpdate(a[prop], b[prop])\n    } else if (prop === 'dataRoot') {\n      if (\n        a[prop] === undefined ||\n        (a[prop] === 'data' && b[prop] !== undefined)\n      ) {\n        a[prop] = b[prop]\n      }\n      // @ts-ignore\n    } else if (a[prop] === undefined || b[prop] !== undefined) {\n      // @ts-ignore\n      a[prop] = b[prop]\n    }\n  }\n  return a\n}\n\n/**\n * Special-case merging of two `tracks` configuration arrays.\n */\nfunction mergeTrackConfigs(a: Track[], b: Track[]): Track[] {\n  if (!b.length) {\n    return a\n  }\n\n  // index the tracks in `a` by track label\n  const aTracks: Record<string, Track> = {}\n  a.forEach((t, i): void => {\n    t.index = i\n    aTracks[t.label] = t\n  })\n\n  b.forEach((bT): void => {\n    const aT = aTracks[bT.label]\n    if (aT) {\n      mergeConfigs(aT, bT)\n    } else {\n      a.push(bT)\n    }\n  })\n\n  return a\n}\n\n/**\n * Recursively fetch, parse, and merge all the includes in the given config\n * object.  Calls the callback with the resulting configuration when finished.\n * @param inputConfig - Config to load includes into\n */\nasync function loadIncludes(inputConfig: Config): Promise<Config> {\n  inputConfig = clone(inputConfig)\n\n  async function loadRecur(\n    config: Config,\n    upstreamConf: Config,\n  ): Promise<Config> {\n    const sourceUrl = config.sourceUrl || config.baseUrl\n    if (!sourceUrl) {\n      throw new Error(\n        `Could not determine source URL: ${JSON.stringify(config)}`,\n      )\n    }\n    const newUpstreamConf = mergeConfigs(clone(upstreamConf), config)\n    if (!newUpstreamConf) {\n      throw new Error('Problem merging configs')\n    }\n    const includes = fillTemplates(\n      regularizeIncludes(config.include || []),\n      newUpstreamConf,\n    )\n    delete config.include\n\n    const loads = includes.map(async (include): Promise<Config> => {\n      include.cacheBuster = inputConfig.cacheBuster\n      const includedData = await fetchConfigFile({\n        uri: new URL(include.url, sourceUrl).href,\n        locationType: 'UriLocation',\n      })\n      return loadRecur(includedData, newUpstreamConf)\n    })\n    const includedDataObjects = await Promise.all(loads)\n    includedDataObjects.forEach((includedData): void => {\n      config = mergeConfigs(config, includedData) || config\n    })\n    return config\n  }\n\n  return loadRecur(inputConfig, {})\n}\n\nfunction regularizeIncludes(\n  includes: Include | string | (Include | string)[] | null,\n): Include[] {\n  if (!includes) {\n    return []\n  }\n\n  // coerce include to an array\n  if (!Array.isArray(includes)) {\n    includes = [includes]\n  }\n\n  return includes.map((include): Include => {\n    // coerce bare strings in the includes to URLs\n    if (typeof include === 'string') {\n      include = { url: include }\n    }\n\n    // set defaults for format and version\n    if (!('format' in include)) {\n      include.format = include.url.endsWith('.conf') ? 'conf' : 'JB_json'\n    }\n    if (include.format === 'JB_json' && !('version' in include)) {\n      include.version = 1\n    }\n    return include\n  })\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/no-unnecessary-type-constraint\nfunction fillTemplates<T extends any>(subconfig: T, config: Config): T {\n  if (!subconfig) {\n    return subconfig\n  }\n  if (Array.isArray(subconfig)) {\n    for (let i = 0; i < subconfig.length; i += 1) {\n      subconfig[i] = fillTemplates(subconfig[i], config)\n    }\n  } else if (typeof subconfig === 'object') {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const sub = subconfig as Record<string, any>\n    for (const name of Object.keys(sub)) {\n      sub[name] = fillTemplates(sub[name], config)\n    }\n  } else if (typeof subconfig === 'string') {\n    // @ts-ignore\n    return fillTemplate(subconfig, config)\n  }\n\n  return subconfig\n}\n\n/**\n * list of config properties that should not be recursively merged\n * @param propName - name of config property\n */\nfunction noRecursiveMerge(propName: string): boolean {\n  return propName === 'datasets'\n}\n\nconst configDefaults = {\n  tracks: [],\n\n  containerID: 'GenomeBrowser',\n  dataRoot: 'data',\n  show_tracklist: true,\n  show_nav: true,\n  show_menu: true,\n  show_overview: true,\n  show_fullviewlink: true,\n  update_browser_title: true,\n  updateBrowserURL: true,\n\n  refSeqs: '{dataRoot}/seq/refSeqs.json',\n  include: ['jbrowse.conf', 'jbrowse_conf.json'],\n  nameUrl: '{dataRoot}/names/root.json',\n\n  datasets: {\n    _DEFAULT_EXAMPLES: true,\n    volvox: { url: '?data=sample_data/json/volvox', name: 'Volvox Example' },\n    modencode: {\n      url: '?data=sample_data/json/modencode',\n      name: 'MODEncode Example',\n    },\n    yeast: { url: '?data=sample_data/json/yeast', name: 'Yeast Example' },\n  },\n\n  highlightSearchedRegions: false,\n  highResolutionMode: 'auto',\n}\n\n/**\n * Examine the loaded and merged configuration for errors.  Throws\n * exceptions if it finds anything amiss.\n * @returns nothing meaningful\n */\nfunction validateConfig(config: Config): void {\n  if (!config.tracks) {\n    config.tracks = []\n  }\n  if (!config.baseUrl) {\n    throw new Error('Must provide a `baseUrl` in configuration')\n  }\n}\n","import { openLocation } from '@jbrowse/core/util/io'\nimport { objectHash } from '@jbrowse/core/util'\nimport {\n  generateUnknownTrackConf,\n  generateUnsupportedTrackConf,\n  guessAdapter,\n  guessTrackType,\n  UNKNOWN,\n  UNSUPPORTED,\n} from '@jbrowse/core/util/tracks'\nimport { Track, RefSeqs, RefSeq } from './types'\n\ninterface Jb2Track {\n  trackId: string\n  name: string\n  description?: string\n  category?: string[]\n  adapter?: Jb2Adapter\n  type?: string\n  defaultRendering?: string\n}\n\ninterface Jb2Adapter {\n  type: string\n  features?: Jb2Feature[]\n  bamLocation?: Jb2Location\n  cramLocation?: Jb2Location\n  craiLocation?: Jb2Location\n  fastaLocation?: Jb2Location\n  faiLocation?: Jb2Location\n  gziLocation?: Jb2Location\n  twoBitLocation?: Jb2Location\n  bigWigLocation?: Jb2Location\n  bigBedLocation?: Jb2Location\n  vcfGzLocation?: Jb2Location\n  gffLocation?: Jb2Location\n  gffGzLocation?: Jb2Location\n  gtfLocation?: Jb2Location\n  bedGzLocation?: Jb2Location\n  index?: { location: Jb2Location; indexType?: string }\n  rootUrlTemplate?: Jb2Location\n  sequenceAdapter?: Jb2Adapter\n}\n\ninterface Jb2Feature {\n  refName: string\n  uniqueId: string\n  start: number\n  end: number\n}\n\ninterface Jb2Location {\n  uri?: string\n  localPath?: string\n  blobId?: string\n  locationType?: string\n}\n\nexport function convertTrackConfig(\n  jb1TrackConfig: Track,\n  dataRoot: string,\n  sequenceAdapter: Jb2Adapter,\n): Jb2Track {\n  const jb2TrackConfig: Jb2Track = {\n    trackId: objectHash(jb1TrackConfig),\n    name: jb1TrackConfig.key || jb1TrackConfig.label,\n  }\n\n  const description =\n    jb1TrackConfig.metadata &&\n    (jb1TrackConfig.metadata.description || jb1TrackConfig.metadata.Description)\n  if (description) {\n    jb2TrackConfig.description = description\n  }\n\n  const category =\n    jb1TrackConfig.category ||\n    (jb1TrackConfig.metadata && jb1TrackConfig.metadata.category)\n  jb2TrackConfig.category = category ? category.split(/\\s*\\/\\s*/) : []\n\n  const { storeClass } = jb1TrackConfig\n  if (!jb1TrackConfig.urlTemplate) {\n    if (!(storeClass && storeClass.endsWith('FromConfig'))) {\n      const trackIdentifier = jb1TrackConfig.key || jb1TrackConfig.label\n      console.warn(\n        `Could not import JBrowse1 track \"${trackIdentifier}\" because it does not have a \"urlTemplate\" or is not a \"FromConfig\" track`,\n      )\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        trackIdentifier,\n        jb2TrackConfig.category,\n      )\n    }\n    return generateFromConfigTrackConfig(jb1TrackConfig, jb2TrackConfig)\n  }\n\n  const resolveUrlTemplate = (urlTemplate: string) => {\n    return new URL(urlTemplate, `${dataRoot}/`).href\n      .replace(/%7B/gi, '{')\n      .replace(/%7D/gi, '}')\n  }\n  const urlTemplate = resolveUrlTemplate(jb1TrackConfig.urlTemplate)\n\n  if (storeClass) {\n    if (storeClass === 'JBrowse/Store/SeqFeature/BAM') {\n      const adapter: Jb2Adapter = {\n        type: 'BamAdapter',\n        bamLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.baiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.baiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.bai`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/CRAM') {\n      const adapter: Jb2Adapter = {\n        type: 'CramAdapter',\n        cramLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        sequenceAdapter,\n      }\n      if (jb1TrackConfig.craiUrlTemplate) {\n        adapter.craiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.craiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.craiLocation = {\n          uri: `${urlTemplate}.crai`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'AlignmentsTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/NCList') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'NCListAdapter',\n          rootUrlTemplate: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/BigWig' ||\n      storeClass === 'JBrowse/Store/BigWig'\n    ) {\n      if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n        jb2TrackConfig.defaultRendering = 'xyplot'\n      } else if (\n        jb1TrackConfig.type &&\n        jb1TrackConfig.type.endsWith('Density')\n      ) {\n        jb2TrackConfig.defaultRendering = 'density'\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'QuantitativeTrack',\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'VcfTabixAdapter',\n        vcfGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'VariantTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/VCFTribble') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `VCFTribble (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'Gff3Adapter',\n          gffLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BigBed') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GFF3Tabix') {\n      const adapter: Jb2Adapter = {\n        type: 'Gff3TabixAdapter',\n        gffGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BED') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `BED (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BEDTabix') {\n      const adapter: Jb2Adapter = {\n        type: 'BedTabixAdapter',\n        bedGzLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.tbiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.tbiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n        }\n      } else if (jb1TrackConfig.csiUrlTemplate) {\n        adapter.index = {\n          location: {\n            uri: resolveUrlTemplate(jb1TrackConfig.csiUrlTemplate),\n            locationType: 'UriLocation',\n          },\n          indexType: 'CSI',\n        }\n      } else {\n        adapter.index = {\n          location: { uri: `${urlTemplate}.tbi`, locationType: 'UriLocation' },\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/GTF') {\n      return {\n        ...jb2TrackConfig,\n        type: 'FeatureTrack',\n        adapter: {\n          type: 'GtfAdapter',\n          gtfLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n    if (\n      storeClass === 'JBrowse/Store/SeqFeature/StaticChunked' ||\n      storeClass === 'JBrowse/Store/Sequence/StaticChunked'\n    ) {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `StaticChunked (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/UnindexedFasta') {\n      return generateUnsupportedTrackConf(\n        jb2TrackConfig.name,\n        `UnindexedFasta (${urlTemplate})`,\n        jb2TrackConfig.category,\n      )\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/IndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.faiLocation = {\n          uri: `${urlTemplate}.fai`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'SequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/BgzipIndexedFasta') {\n      const adapter: Jb2Adapter = {\n        type: 'BgzipFastaAdapter',\n        fastaLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n      }\n      if (jb1TrackConfig.faiUrlTemplate) {\n        adapter.faiLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.faiUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.faiLocation = {\n          uri: `${urlTemplate}.fai`,\n          locationType: 'UriLocation',\n        }\n      }\n      if (jb1TrackConfig.gziUrlTemplate) {\n        adapter.gziLocation = {\n          uri: resolveUrlTemplate(jb1TrackConfig.gziUrlTemplate),\n          locationType: 'UriLocation',\n        }\n      } else {\n        adapter.gziLocation = {\n          uri: `${urlTemplate}.gzi`,\n          locationType: 'UriLocation',\n        }\n      }\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter,\n      }\n    }\n    if (storeClass === 'JBrowse/Store/SeqFeature/TwoBit') {\n      return {\n        ...jb2TrackConfig,\n        type: 'ReferenceSequenceTrack',\n        adapter: {\n          type: 'TwoBitAdapter',\n          twoBitLocation: { uri: urlTemplate, locationType: 'UriLocation' },\n        },\n      }\n    }\n  }\n\n  // If we don't recogize the store class, make a best effort to guess by file type\n  jb2TrackConfig.adapter = guessAdapter(\n    { uri: urlTemplate, locationType: 'UriLocation' },\n    undefined,\n    urlTemplate,\n  )\n  if (!jb2TrackConfig.adapter) {\n    throw new Error('Could not determine adapter')\n  }\n\n  if (jb2TrackConfig.adapter.type === UNSUPPORTED) {\n    return generateUnsupportedTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n  if (jb2TrackConfig.adapter.type === UNKNOWN) {\n    return generateUnknownTrackConf(\n      jb2TrackConfig.name,\n      urlTemplate,\n      jb2TrackConfig.category,\n    )\n  }\n\n  jb2TrackConfig.type = guessTrackType(jb2TrackConfig.adapter.type)\n\n  if (jb2TrackConfig.type === 'QuantitativeTrack') {\n    if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('XYPlot')) {\n      jb2TrackConfig.defaultRendering = 'xyplot'\n    } else if (jb1TrackConfig.type && jb1TrackConfig.type.endsWith('Density')) {\n      jb2TrackConfig.defaultRendering = 'density'\n    }\n  }\n\n  return jb2TrackConfig\n}\n\nfunction generateFromConfigTrackConfig(\n  jb1TrackConfig: Track,\n  jb2TrackConfig: Jb2Track,\n): Jb2Track {\n  const jb1Features = jb1TrackConfig.features || []\n  const jb2Features = jb1Features.map((feature): Jb2Feature => {\n    const jb2Feature: Jb2Feature = JSON.parse(JSON.stringify(feature))\n    jb2Feature.refName = feature.seq_id\n    jb2Feature.uniqueId = `${feature.seq_id}:${feature.start}-${feature.end}:${\n      feature.name || ''\n    }`\n    return jb2Feature\n  })\n  jb2TrackConfig.adapter = {\n    type: 'FromConfigAdapter',\n    features: jb2Features,\n  }\n  jb2TrackConfig.type = 'FeatureTrack'\n  return jb2TrackConfig\n}\n\nexport async function createRefSeqsAdapter(\n  refSeqs: string | RefSeqs,\n): Promise<Jb2Adapter> {\n  if (typeof refSeqs === 'string') {\n    // assume refSeqs is a url if it is string\n    refSeqs = {\n      url: refSeqs,\n    }\n  }\n\n  // check refseq urls\n  if (refSeqs.url) {\n    if (refSeqs.url.match(/.fai$/)) {\n      return {\n        type: 'IndexedFastaAdapter',\n        fastaLocation: {\n          uri: refSeqs.url.slice(0, -4),\n          locationType: 'UriLocation',\n        },\n        faiLocation: {\n          uri: refSeqs.url,\n          locationType: 'UriLocation',\n        },\n      }\n    }\n    if (refSeqs.url.match(/.2bit$/)) {\n      return {\n        type: 'TwoBitAdapter',\n        twoBitLocation: { uri: refSeqs.url, locationType: 'UriLocation' },\n      }\n    }\n    if (refSeqs.url.match(/.fa$/)) {\n      throw new Error('Unindexed FASTA adapter not available')\n    }\n    if (refSeqs.url.match(/.sizes/)) {\n      throw new Error('chromosome SIZES adapter not available')\n    }\n    const refSeqsJson = await openLocation({\n      uri: refSeqs.url,\n      locationType: 'UriLocation',\n    }).readFile('utf8')\n    const refSeqsData: RefSeq[] = JSON.parse(refSeqsJson)\n    return refSeqAdapterFromConfig(refSeqsData)\n  }\n  if ('data' in refSeqs) {\n    return refSeqAdapterFromConfig(refSeqs.data || [])\n  }\n  throw new Error(\n    `Could not determine adapter for JBrowse1 refSeqs: ${\n      refSeqs.url || JSON.stringify(refSeqs)\n    }`,\n  )\n}\n\nfunction refSeqAdapterFromConfig(refSeqsData: RefSeq[]): Jb2Adapter {\n  const features = refSeqsData.map(\n    (refSeq): Jb2Feature => ({\n      refName: refSeq.name,\n      uniqueId: refSeq.name,\n      start: refSeq.start,\n      end: refSeq.end,\n    }),\n  )\n  return {\n    type: 'FromConfigAdapter',\n    features,\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\n\nimport { fetchJb1 } from './jb1ConfigLoad'\nimport { convertTrackConfig } from './jb1ToJb2'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'JBrowse1Connection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        configuration: ConfigurationReference(configSchema),\n        type: types.literal('JBrowse1Connection'),\n      })\n      .actions(self => ({\n        connect() {\n          const dataDirLocation = readConfObject(\n            self.configuration,\n            'dataDirLocation',\n          )\n          const session = getSession(self)\n          fetchJb1(dataDirLocation)\n            .then(config => {\n              const assemblyName = readConfObject(\n                self.configuration,\n                'assemblyNames',\n              )[0]\n              if (!assemblyName) {\n                throw new Error(\n                  'assembly name required for JBrowse 1 connection',\n                )\n              }\n              const assemblyConf = session.assemblies.find(\n                assembly => readConfObject(assembly, 'name') === assemblyName,\n              )\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              const jb2Tracks = config.tracks.map(jb1Track => {\n                const jb2Track = convertTrackConfig(\n                  jb1Track,\n                  config.dataRoot,\n                  sequenceAdapter,\n                )\n                jb2Track.assemblyNames = [assemblyName]\n                return jb2Track\n              })\n              self.setTrackConfs(jb2Tracks)\n            })\n            .catch(error => {\n              console.error(error)\n              session.notify(\n                `There was a problem connecting to the JBrowse 1 data directory \"${self.name}\". Please make sure you have entered a valid location. The error that was thrown is: \"${error}\"`,\n                'error',\n              )\n              session.breakConnection(self.configuration)\n            })\n        },\n      })),\n  )\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport { configSchema as ncListAdapterConfigSchema } from './NCListAdapter'\nimport {\n  AdapterClass as JBrowse1TextSearchAdapterClass,\n  configSchema as jbrowse1AdapterConfigSchema,\n} from './JBrowse1TextSeachAdapter'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nimport {\n  configSchema as jbrowse1ConfigSchema,\n  modelFactory as jbrowse1ModelFactory,\n} from './JBrowse1Connection'\n\nexport default class LegacyJBrowsePlugin extends Plugin {\n  name = 'LegacyJBrowsePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'NCListAdapter',\n          configSchema: ncListAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./NCListAdapter/NCListAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /trackData.jsonz?$/i\n          const adapterName = 'NCListAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              rootUrlTemplate: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addTextSearchAdapterType(\n      () =>\n        new TextSearchAdapterType({\n          name: 'JBrowse1TextSearchAdapter',\n          configSchema: jbrowse1AdapterConfigSchema,\n          AdapterClass: JBrowse1TextSearchAdapterClass,\n          description: 'A JBrowse 1 text search adapter',\n        }),\n    )\n\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'JBrowse1Connection',\n          configSchema: jbrowse1ConfigSchema,\n          stateModel: jbrowse1ModelFactory(pluginManager),\n          displayName: 'JBrowse 1 Data',\n          description: 'A JBrowse 1 data directory',\n          url: '//jbrowse.org/',\n        }),\n    )\n  }\n}\n","import React from 'react'\nimport { SvgIcon, SvgIconProps } from '@material-ui/core'\n\nexport function Curves(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function StraightLines(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z\"\n      />\n    </SvgIcon>\n  )\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport { observer } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React, { useEffect, useState } from 'react'\n\nconst useStyles = makeStyles({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: '#f1f1f1',\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    textAlign: 'center',\n  },\n  error: {\n    display: 'block',\n    color: 'red',\n    width: '30em',\n    wordWrap: 'normal',\n    whiteSpace: 'normal',\n  },\n  blockMessage: {\n    background: '#f1f1f1',\n    padding: '10px',\n  },\n  blockError: {\n    background: '#f1f1f1',\n    padding: '10px',\n    color: 'red',\n  },\n})\n\nfunction LoadingMessage() {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    const timeout = setTimeout(() => setShown(true), 300)\n    return () => clearTimeout(timeout)\n  })\n\n  return shown ? (\n    <div data-testid=\"loading-synteny\" className={classes.loading}>\n      Loading &hellip;\n      <LinearProgress />\n    </div>\n  ) : null\n}\n\nfunction BlockMessage({ messageText }: { messageText: string }) {\n  const classes = useStyles()\n  return <div className={classes.blockMessage}>{messageText}</div>\n}\nBlockMessage.propTypes = {\n  messageText: PropTypes.string.isRequired,\n}\n\nfunction BlockError({ error }: { error: Error }) {\n  const classes = useStyles()\n  return <div className={classes.blockError}>{error.message}</div>\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst ServerSideRenderedBlockContent = observer(({ model }: { model: any }) => {\n  if (model.error) {\n    return <BlockError error={model.error} />\n  }\n  if (model.message) {\n    return <BlockMessage messageText={model.message} />\n  }\n  if (!model.filled) {\n    return <LoadingMessage />\n  }\n  return model.reactElement\n})\n\nexport default ServerSideRenderedBlockContent\n","import { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport { LinearComparativeDisplay as LCD } from '..'\n\nconst LinearComparativeDisplay: React.FC<{\n  model: LCD\n  children?: React.ReactNode\n}> = props => {\n  const { model, children } = props\n  return (\n    <div>\n      <model.ReactComponent2 {...props} />\n      {children}\n    </div>\n  )\n}\nLinearComparativeDisplay.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  children: PropTypes.element,\n}\n\nLinearComparativeDisplay.defaultProps = {\n  children: null,\n}\nexport default observer(LinearComparativeDisplay)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport {\n  getConf,\n  readConfObject,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { types, getSnapshot, Instance } from 'mobx-state-tree'\nimport clone from 'clone'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  getContainingView,\n  getSession,\n  makeAbortableReaction,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { LinearComparativeViewModel } from '../LinearComparativeView/model'\nimport ServerSideRenderedBlockContent from '../ServerSideRenderedBlockContent'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './components/LinearComparativeDisplay'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearComparativeDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearComparativeView',\n      ReactComponent,\n    })\n  })\n}\n\nexport function configSchemaFactory(pluginManager: any) {\n  return ConfigurationSchema(\n    'LinearComparativeDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n\nexport function stateModelFactory(configSchema: any) {\n  return types\n    .compose(\n      'LinearComparativeDisplay',\n      BaseDisplay,\n      types.model({\n        type: types.literal('LinearComparativeDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        height: 100,\n      }),\n    )\n    .volatile((/* self */) => ({\n      renderInProgress: undefined as AbortController | undefined,\n      filled: false,\n      data: undefined as any,\n      reactElement: undefined as React.ReactElement | undefined,\n      message: undefined as string | undefined,\n      renderingComponent: undefined as any,\n      ReactComponent2: ServerSideRenderedBlockContent as unknown as React.FC,\n    }))\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n      renderProps() {\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          highResolutionScaling: 2,\n        }\n      },\n    }))\n    .actions(self => {\n      let renderInProgress: undefined | AbortController\n\n      return {\n        afterAttach() {\n          makeAbortableReaction(\n            self as any,\n            renderBlockData as any,\n            renderBlockEffect as any,\n            {\n              name: `${self.type} ${self.id} rendering`,\n              delay: 1000,\n              fireImmediately: true,\n            },\n            this.setLoading,\n            this.setRendered,\n            this.setError,\n          )\n        },\n\n        setLoading(abortController: AbortController) {\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = abortController\n        },\n        setMessage(messageText: string) {\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          self.filled = false\n          self.message = messageText\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = undefined\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n        setRendered(args: {\n          data: any\n          reactElement: React.ReactElement\n          renderingComponent: React.Component\n        }) {\n          const { data, reactElement, renderingComponent } = args\n          self.filled = true\n          self.message = undefined\n          self.reactElement = reactElement\n          self.data = data\n          self.error = undefined\n          self.renderingComponent = renderingComponent\n          renderInProgress = undefined\n        },\n        setError(error: unknown) {\n          console.error(error)\n          if (renderInProgress && !renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n          // the rendering failed for some reason\n          self.filled = false\n          self.message = undefined\n          self.reactElement = undefined\n          self.data = undefined\n          self.error = error\n          self.renderingComponent = undefined\n          renderInProgress = undefined\n        },\n      }\n    })\n}\nfunction renderBlockData(self: LinearComparativeDisplay) {\n  const { rpcManager } = getSession(self) as any\n  const display = self\n\n  const { rendererType }: { rendererType: any } = display\n\n  // Alternative to readConfObject(config) is below used because renderProps is\n  // something under our control.  Compare to serverSideRenderedBlock\n  readConfObject(self.configuration)\n\n  const { adapterConfig } = self\n  const parent = getContainingView(self) as LinearComparativeViewModel\n  const sessionId = getRpcSessionId(self)\n  getSnapshot(parent)\n\n  return {\n    rendererType,\n    rpcManager,\n    renderProps: {\n      ...display.renderProps(),\n      view: clone(getSnapshot(parent)),\n      adapterConfig,\n      rendererType: rendererType.name,\n      sessionId,\n      timeout: 1000000,\n    },\n  }\n}\n\nasync function renderBlockEffect(props: ReturnType<typeof renderBlockData>) {\n  if (!props) {\n    throw new Error('cannot render with no props')\n  }\n\n  const { rendererType, rpcManager, renderProps } = props\n\n  const { reactElement, ...data } = await rendererType.renderInClient(\n    rpcManager,\n    renderProps,\n  )\n\n  return { reactElement, data, renderingComponent: rendererType.ReactComponent }\n}\n\nexport type LinearComparativeDisplayModel = ReturnType<typeof stateModelFactory>\nexport type LinearComparativeDisplay = Instance<LinearComparativeDisplayModel>\n\nexport { ReactComponent }\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { autorun } from 'mobx'\nimport BaseViewModel from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\nimport { MenuItem, ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport { getSession, isSessionModelWithWidgets } from '@jbrowse/core/util'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { transaction } from 'mobx'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getPath,\n  getRoot,\n  onAction,\n  resolveIdentifier,\n  types,\n  Instance,\n  SnapshotIn,\n} from 'mobx-state-tree'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  const defaultHeight = 400\n  return types\n    .compose(\n      'LinearComparativeView',\n      BaseViewModel,\n      types.model({\n        id: ElementId,\n        type: types.literal('LinearComparativeView'),\n        height: defaultHeight,\n        trackSelectorType: 'hierarchical',\n        showIntraviewLinks: true,\n        linkViews: false,\n        interactToggled: false,\n        middleComparativeHeight: 100,\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        views: types.array(\n          pluginManager.getViewType('LinearGenomeView')\n            .stateModel as LinearGenomeViewStateModel,\n        ),\n\n        // this represents tracks specific to this view specifically used for\n        // read vs ref dotplots where this track would not really apply\n        // elsewhere\n        viewTrackConfigs: types.array(\n          pluginManager.pluggableConfigSchemaType('track'),\n        ),\n      }),\n    )\n    .volatile(() => ({\n      headerHeight: 0,\n      width: 800,\n    }))\n    .views(self => ({\n      get highResolutionScaling() {\n        return 2\n      },\n      get initialized() {\n        return self.views.length > 0\n      },\n\n      get refNames() {\n        return self.views.map(v => [\n          ...new Set(v.staticBlocks.map(m => m.refName)),\n        ])\n      },\n\n      get assemblyNames() {\n        return [...new Set(self.views.map(v => v.assemblyNames).flat())]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          onAction(self, param => {\n            if (self.linkViews) {\n              const { name, path, args } = param\n              const actions = [\n                'horizontalScroll',\n                'zoomTo',\n                'setScaleFactor',\n                'showTrack',\n                'hideTrack',\n                'toggleTrack',\n              ]\n              if (actions.includes(name) && path) {\n                this.onSubviewAction(name, path, args)\n              }\n            }\n          }),\n        )\n      },\n\n      // automatically removes session assemblies associated with this view\n      // e.g. read vs ref\n      beforeDestroy() {\n        const session = getSession(self)\n        self.assemblyNames.forEach(name => {\n          if (name.endsWith('-temp')) {\n            session.removeAssembly?.(name)\n          }\n        })\n      },\n\n      onSubviewAction(actionName: string, path: string, args: any[] = []) {\n        self.views.forEach(view => {\n          const ret = getPath(view)\n          if (ret.lastIndexOf(path) !== ret.length - path.length) {\n            // @ts-ignore\n            view[actionName](args[0])\n          }\n        })\n      },\n\n      setWidth(newWidth: number) {\n        self.width = newWidth\n      },\n      setHeight(newHeight: number) {\n        self.height = newHeight\n      },\n\n      setViews(views: SnapshotIn<LinearGenomeViewModel>[]) {\n        self.views = cast(views)\n      },\n\n      removeView(view: LinearGenomeViewModel) {\n        self.views.remove(view)\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setHeaderHeight(height: number) {\n        self.headerHeight = height\n      },\n\n      setMiddleComparativeHeight(n: number) {\n        self.middleComparativeHeight = n\n        return self.middleComparativeHeight\n      },\n\n      toggleLinkViews() {\n        self.linkViews = !self.linkViews\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n          return undefined\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = this.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          this.showTrack(trackId)\n        }\n      },\n\n      showTrack(trackId: string, initialSnapshot = {}) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(schema, getRoot(self), trackId)\n        if (!configuration) {\n          throw new Error(`track not found ${trackId}`)\n        }\n        const trackType = pluginManager.getTrackType(configuration.type)\n        if (!trackType) {\n          throw new Error(`unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(d => d.name)\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `could not find a compatible display for view type ${self.type}`,\n          )\n        }\n        self.tracks.push(\n          trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [{ type: displayConf.type, configuration: displayConf }],\n          }),\n        )\n      },\n\n      hideTrack(trackId: string) {\n        const schema = pluginManager.pluggableConfigSchemaType('track')\n        const config = resolveIdentifier(schema, getRoot(self), trackId)\n        const shownTracks = self.tracks.filter(t => t.configuration === config)\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n      squareView() {\n        const bpPerPxs = self.views.map(v => v.bpPerPx)\n        const avg = bpPerPxs.reduce((a, b) => a + b, 0) / bpPerPxs.length\n        self.views.forEach(view => {\n          const center = view.pxToBp(view.width / 2)\n          view.setNewView(avg, view.offsetPx)\n          view.centerAt(center.coord, center.refName, center.index)\n        })\n      },\n      clearView() {\n        self.views = cast([])\n      },\n    }))\n    .views(self => ({\n      menuItems() {\n        const menuItems: MenuItem[] = []\n        self.views.forEach((view, idx) => {\n          if (view.menuItems?.()) {\n            menuItems.push({\n              label: `View ${idx + 1} Menu`,\n              subMenu: view.menuItems(),\n            })\n          }\n        })\n        menuItems.push({\n          label: 'Return to import form',\n          onClick: () => {\n            getSession(self).queueDialog(handleClose => [\n              ReturnToImportFormDialog,\n              { model: self, handleClose },\n            ])\n          },\n          icon: FolderOpenIcon,\n        })\n        menuItems.push({\n          label: 'Open track selector',\n          onClick: self.activateTrackSelector,\n          icon: TrackSelectorIcon,\n        })\n        return menuItems\n      },\n      rubberBandMenuItems() {\n        return [\n          {\n            label: 'Zoom to region(s)',\n            onClick: () => {\n              self.views.forEach(view => {\n                const { leftOffset, rightOffset } = view\n                if (leftOffset && rightOffset) {\n                  view.moveTo(leftOffset, rightOffset)\n                }\n              })\n            },\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            if (self.initialized) {\n              self.views.forEach(v => v.setWidth(self.width))\n            }\n          }),\n        )\n      },\n    }))\n}\n\nexport type LinearComparativeViewStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearComparativeViewModel =\n  Instance<LinearComparativeViewStateModel>\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\n\nexport default ({ jbrequire }: PluginManager) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearComparativeView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent: lazy(() => import('./components/LinearComparativeView')),\n  })\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  getConf,\n  ConfigurationReference,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getContainingView } from '@jbrowse/core/util'\nimport {\n  configSchemaFactory as baseConfigFactory,\n  stateModelFactory as baseModelFactory,\n  ReactComponent,\n} from '../LinearComparativeDisplay'\nimport { LinearSyntenyViewModel } from '../LinearSyntenyView/model'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addDisplayType(() => {\n    const configSchema = configSchemaFactory(pluginManager)\n    return new DisplayType({\n      name: 'LinearSyntenyDisplay',\n      configSchema,\n      stateModel: stateModelFactory(configSchema),\n      trackType: 'SyntenyTrack',\n      viewType: 'LinearSyntenyView',\n      ReactComponent,\n    })\n  })\n}\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearSyntenyDisplay',\n    {\n      trackIds: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'LinearSyntenyRenderer' },\n      ),\n      middle: { type: 'boolean', defaultValue: true },\n    },\n    {\n      baseConfiguration: baseConfigFactory(pluginManager),\n      explicitlyTyped: true,\n    },\n  )\n}\n\nexport function stateModelFactory(\n  configSchema: ReturnType<typeof configSchemaFactory>,\n) {\n  return types\n    .compose(\n      'LinearSyntenyDisplay',\n      baseModelFactory(configSchema),\n      types.model({\n        type: types.literal('LinearSyntenyDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => ({\n      renderProps() {\n        const parentView = getContainingView(self) as LinearSyntenyViewModel\n        return {\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          config: getConf(self, 'renderer'),\n          width: parentView.width,\n          height: parentView.middleComparativeHeight,\n        }\n      },\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n      get adapterConfig() {\n        // TODO possibly enriches with the adapters from associated trackIds\n        return {\n          name: self.parentTrack.configuration.adapter.type,\n          assemblyNames: getConf(self, 'assemblyNames'),\n          ...getConf(self.parentTrack, 'adapter'),\n        }\n      },\n\n      get trackIds() {\n        return getConf(self, 'trackIds') as string[]\n      },\n    }))\n}\n\nexport type LinearSyntenyDisplayStateModel = ReturnType<\n  typeof stateModelFactory\n>\nexport type LinearSyntenyDisplayModel = Instance<LinearSyntenyDisplayStateModel>\n","import { clamp } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nexport type LayoutRecord = [number, number, number, number]\n\nexport interface ReducedLinearGenomeView {\n  bpPerPx: number\n  offsetPx: number\n  staticBlocks: Region[]\n  dynamicBlocks: Region[]\n  displayedRegions: Region[]\n  headerHeight: number\n  scaleBarHeight: number\n  height: number\n  features: Feature[]\n  tracks: {\n    scrollTop: number\n    height: number\n    configuration: string\n    skip: number\n  }[]\n}\n\nconst [, TOP, , BOTTOM] = [0, 1, 2, 3]\n\nexport function cheight(chunk: LayoutRecord) {\n  return chunk[BOTTOM] - chunk[TOP]\n}\nfunction heightFromSpecificLevel(\n  views: ReducedLinearGenomeView[],\n  trackConfigId: string,\n  level: number,\n) {\n  const heightUpUntilThisPoint = views\n    .slice(0, level)\n    .map(v => v.height + 7)\n    .reduce((a, b) => a + b, 0)\n\n  return (\n    heightUpUntilThisPoint +\n    views[level].headerHeight +\n    views[level].scaleBarHeight +\n    getTrackPos(views[level], trackConfigId) +\n    1\n  )\n}\n\nexport function getTrackPos(\n  view: ReducedLinearGenomeView,\n  trackConfigId: string,\n) {\n  const idx = view.tracks.findIndex(t => t.configuration === trackConfigId)\n  let accum = 0\n  for (let i = 0; i < idx; i += 1) {\n    accum += view.tracks[i].height + 3 // +1px for trackresizehandle\n  }\n  return accum\n}\n\n// Uses bpToPx to get the screen pixel coordinates but ignores some conditions\n// where bpToPx could return undefined\nexport function getPxFromCoordinate(\n  view: ReducedLinearGenomeView,\n  refName: string,\n  coord: number,\n) {\n  return (\n    ((bpToPx(view, { refName, coord }) || {}).offsetPx || 0) - view.offsetPx\n  )\n}\n\n// Retrieves the y-position of a layout record in a track\n// If track not found returns 0\nexport function overlayYPos(\n  trackConfigId: string,\n  level: number,\n  views: ReducedLinearGenomeView[],\n  c: LayoutRecord,\n  cond: boolean,\n) {\n  const track = views[level].tracks.find(t => t.configuration === trackConfigId)\n  const ypos = track\n    ? clamp(c[TOP] - (track.scrollTop || 0), 0, track.height) +\n      heightFromSpecificLevel(views, trackConfigId, level) +\n      track.skip\n    : 0\n\n  return ypos + (cond ? cheight(c) : 0)\n}\n\n// Returns the pixel screen position of a refName:coord input, or undefined if\n// the input could not be located. Uses view.displayedRegions as a representation\n// of what is on the screen\n//\n// Note: does not consider that this refName:coord input could multi-match\nfunction bpToPx(\n  view: ReducedLinearGenomeView,\n  { refName, coord }: { refName: string; coord: number },\n) {\n  let offsetBp = 0\n\n  const index = view.displayedRegions.findIndex(r => {\n    if (refName === r.refName && coord >= r.start && coord <= r.end) {\n      offsetBp += coord - r.start\n      return true\n    }\n    offsetBp += r.end - r.start\n    return false\n  })\n  const foundRegion = view.displayedRegions[index]\n  if (foundRegion) {\n    return {\n      index,\n      offsetPx: Math.round(offsetBp / view.bpPerPx),\n    }\n  }\n  return undefined\n}\n\n// Returns either 0 or height depending on condition\nexport function interstitialYPos(cond: boolean, height: number) {\n  return cond ? 0 : height\n}\n\nexport function* generateMatches(\n  l1: Feature[] = [],\n  l2: Feature[] = [],\n  cb: (arg0: Feature) => number,\n) {\n  let i = 0\n  let j = 0\n  while (i < l1.length && j < l2.length) {\n    const a = cb(l1[i])\n    const b = cb(l2[j])\n    if (a < b) {\n      i++\n    } else if (b < a) {\n      j++\n    } else {\n      yield [l1[i], l2[j]]\n      i++\n      j++\n    }\n  }\n}\n","import React, { useRef, useMemo, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSnapshot, isAlive } from 'mobx-state-tree'\nimport SimpleFeature, {\n  SimpleFeatureSerialized,\n  Feature,\n} from '@jbrowse/core/util/simpleFeature'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport {\n  getContainingView,\n  viewBpToPx,\n  getSession,\n  ViewSnap,\n  AssemblyManager,\n} from '@jbrowse/core/util'\nimport { interstitialYPos, overlayYPos, generateMatches } from '../../util'\nimport { LinearSyntenyViewModel } from '../../LinearSyntenyView/model'\nimport { LinearComparativeDisplay } from '../../LinearComparativeDisplay'\n\nconst [LEFT, , RIGHT] = [0, 1, 2, 3]\n\ntype RectTuple = [number, number, number, number]\n\nconst colorMap = {\n  I: '#ff03',\n  N: '#0a03',\n  D: '#00f3',\n  X: 'brown',\n  M: '#f003',\n  '=': '#f003',\n}\n\nfunction px(view: ViewSnap, arg: { refName: string; coord: number }) {\n  return viewBpToPx({ ...arg, self: view })?.offsetPx || 0\n}\n\nfunction layoutMatches(\n  features: Feature[][],\n  assemblyManager?: AssemblyManager,\n) {\n  const matches = []\n  for (let i = 0; i < features.length; i++) {\n    for (let j = i; j < features.length; j++) {\n      if (i !== j) {\n        for (const [f1, f2] of generateMatches(features[i], features[j], feat =>\n          feat.get('syntenyId'),\n        )) {\n          let f1s = f1.get('start')\n          let f1e = f1.get('end')\n          const f2s = f2.get('start')\n          const f2e = f2.get('end')\n          if (f1.get('strand') === -1) {\n            ;[f1e, f1s] = [f1s, f1e]\n          }\n          const a1 = assemblyManager?.get(f1.get('assemblyName'))\n          const a2 = assemblyManager?.get(f2.get('assemblyName'))\n          const r1 = f1.get('refName')\n          const r2 = f2.get('refName')\n\n          matches.push([\n            {\n              feature: f1,\n              level: i,\n              refName: a1?.getCanonicalRefName(f1.get('refName')) || r1,\n              layout: [f1s, 0, f1e, 10] as RectTuple,\n            },\n            {\n              feature: f2,\n              level: j,\n              refName: a2?.getCanonicalRefName(f1.get('refName')) || r2,\n              layout: [f2s, 0, f2e, 10] as RectTuple,\n            },\n          ])\n        }\n      }\n    }\n  }\n  return matches\n}\n\n/**\n * A block whose content is rendered outside of the main thread and hydrated by\n * this component.\n */\n\nfunction getResources(displayModel: LinearComparativeDisplay) {\n  const worker = !('type' in displayModel)\n  if (!worker && isAlive(displayModel)) {\n    const parentView = getContainingView(displayModel) as LinearSyntenyViewModel\n    const color = getConf(displayModel, ['renderer', 'color'])\n    const session = getSession(displayModel)\n    const { assemblyManager } = session\n    return { color, session, parentView, assemblyManager }\n  }\n  return {}\n}\nfunction LinearSyntenyRendering({\n  height,\n  width,\n  displayModel,\n  features,\n  trackIds,\n  highResolutionScaling = 1,\n}: {\n  width: number\n  height: number\n  displayModel: LinearComparativeDisplay\n  highResolutionScaling: number\n  features: SimpleFeatureSerialized[][]\n  trackIds: string[]\n}) {\n  const ref = useRef<HTMLCanvasElement>(null)\n  const { color, assemblyManager, parentView } = getResources(displayModel)\n  const hydratedFeatures = useMemo(\n    () =>\n      features.map(level =>\n        level\n          .map(f => new SimpleFeature(f))\n          .sort((a, b) => a.get('syntenyId') - b.get('syntenyId')),\n      ),\n    [features],\n  )\n  const matches = useMemo(\n    () => layoutMatches(hydratedFeatures, assemblyManager),\n    [hydratedFeatures, assemblyManager],\n  )\n\n  const parsedCIGARs = useMemo(\n    () =>\n      new Map(\n        hydratedFeatures.flat().map(f => {\n          const cigar = f.get('cg') || f.get('CIGAR')\n          return [f.id(), cigar ? MismatchParser.parseCigar(cigar) : undefined]\n        }),\n      ),\n    [hydratedFeatures],\n  )\n  const drawCurves = parentView?.drawCurves\n  const views = parentView?.views\n  const offsets = views?.map(view => view.offsetPx)\n\n  useEffect(() => {\n    if (!ref.current || !offsets || !views || !isAlive(displayModel)) {\n      return\n    }\n    const ctx = ref.current.getContext('2d')\n    if (!ctx) {\n      return\n    }\n    ctx.resetTransform()\n    ctx.scale(highResolutionScaling, highResolutionScaling)\n    ctx.clearRect(0, 0, width, height)\n    ctx.fillStyle = color\n    ctx.strokeStyle = color\n    const showIntraviewLinks = false\n    const middle = true\n    const hideTiny = false\n    const viewSnaps = views.map(view => ({\n      ...getSnapshot(view),\n      width: view.width,\n      interRegionPaddingWidth: view.interRegionPaddingWidth,\n      minimumBlockWidth: view.minimumBlockWidth,\n    }))\n\n    for (let j = 0; j < matches.length; j++) {\n      const m = matches[j]\n      // we follow a path in the list of chunks, not from top to bottom, just\n      // in series following x1,y1 -> x2,y2\n      for (let i = 0; i < m.length - 1; i += 1) {\n        const { layout: c1, feature: f1, level: l1, refName: ref1 } = m[i]\n        const { layout: c2, feature: f2, level: l2, refName: ref2 } = m[i + 1]\n        const v1 = viewSnaps[l1]\n        const v2 = viewSnaps[l2]\n\n        if (!c1 || !c2) {\n          console.warn('received null layout for a overlay feature')\n          return\n        }\n\n        // disable rendering connections in a single level\n        if (!showIntraviewLinks && l1 === l2) {\n          continue\n        }\n        const length1 = f1.get('end') - f1.get('start')\n        const length2 = f2.get('end') - f2.get('start')\n\n        if ((length1 < v1.bpPerPx || length2 < v2.bpPerPx) && hideTiny) {\n          continue\n        }\n\n        const x11 = px(v1, { refName: ref1, coord: c1[LEFT] }) - offsets[l1]\n        const x12 = px(v1, { refName: ref1, coord: c1[RIGHT] }) - offsets[l1]\n        const x21 = px(v2, { refName: ref2, coord: c2[LEFT] }) - offsets[l2]\n        const x22 = px(v2, { refName: ref2, coord: c2[RIGHT] }) - offsets[l2]\n\n        const y1 = middle\n          ? interstitialYPos(l1 < l2, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[0], l1, viewSnaps, c1, l1 < l2)\n        const y2 = middle\n          ? interstitialYPos(l2 < l1, height)\n          : // prettier-ignore\n            // @ts-ignore\n            overlayYPos(trackIds[1], l2, viewSnaps, c2, l2 < l1)\n\n        const mid = (y2 - y1) / 2\n\n        // drawing a line if the results are thin results in much less\n        // pixellation than filling in a thin polygon\n        if (length1 < v1.bpPerPx || length2 < v2.bpPerPx) {\n          ctx.beginPath()\n          ctx.moveTo(x11, y1)\n          if (drawCurves) {\n            ctx.bezierCurveTo(x11, mid, x21, mid, x21, y2)\n          } else {\n            ctx.lineTo(x21, y2)\n          }\n          ctx.stroke()\n        } else {\n          let cx1 = x11\n          let cx2 = x21\n\n          // flip the direction of the CIGAR drawing in horizontally flipped\n          // modes\n          const rev1 = x11 < x12 ? 1 : -1\n          const rev2 = x21 < x22 ? 1 : -1\n\n          const cigar = parsedCIGARs.get(f1.id())\n          if (cigar) {\n            // continuingFlag helps speed up zoomed out by skipping draw\n            // commands on very small CIGAR features\n            let continuingFlag = false\n            let px1 = 0\n            let px2 = 0\n            for (let j = 0; j < cigar.length; j += 2) {\n              const len = +cigar[j]\n              const op = cigar[j + 1]\n\n              if (!continuingFlag) {\n                px1 = cx1\n                px2 = cx2\n              }\n\n              const d1 = len / viewSnaps[0].bpPerPx\n              const d2 = len / viewSnaps[1].bpPerPx\n              if (op === 'M' || op === '=' || op === 'X') {\n                cx1 += d1 * rev1\n                cx2 += d2 * rev2\n              } else if (op === 'D') {\n                cx1 += d1 * rev1\n              } else if (op === 'N') {\n                cx1 += d1 * rev1\n              } else if (op === 'I') {\n                cx2 += d2 * rev2\n              }\n\n              // check that we are even drawing in view here, e.g. that all\n              // points are not all less than 0 or greater than width\n              if (\n                !(\n                  Math.max(px1, px2, cx1, cx2) < 0 ||\n                  Math.min(px1, px2, cx1, cx2) > width\n                )\n              ) {\n                // if it is a small feature and not the last element of the\n                // CIGAR (which could skip rendering it entire if we did turn\n                // it on), then turn on continuing flag\n                if (cx1 - px1 < 1 && cx2 - px2 < 1 && j < cigar.length - 2) {\n                  continuingFlag = true\n                } else {\n                  continuingFlag = false\n\n                  // allow rendering the dominant color when using continuing\n                  // flag if the last element of continuing was a large\n                  // feature, else just use match\n                  ctx.fillStyle =\n                    colorMap[\n                      (continuingFlag && d1 > 1) || d2 > 1\n                        ? (op as keyof typeof colorMap)\n                        : 'M'\n                    ]\n                  ctx.beginPath()\n                  ctx.moveTo(px1, y1)\n                  ctx.lineTo(cx1, y1)\n                  if (drawCurves) {\n                    ctx.bezierCurveTo(cx1, mid, cx2, mid, cx2, y2)\n                  } else {\n                    ctx.lineTo(cx2, y2)\n                  }\n                  ctx.lineTo(px2, y2)\n                  if (drawCurves) {\n                    ctx.bezierCurveTo(px2, mid, px1, mid, px1, y1)\n                  } else {\n                    ctx.lineTo(px1, y1)\n                  }\n                  ctx.closePath()\n                  ctx.fill()\n                }\n              }\n            }\n          } else {\n            ctx.beginPath()\n            ctx.moveTo(x11, y1)\n            ctx.lineTo(x12, y1)\n            if (drawCurves) {\n              ctx.bezierCurveTo(x12, mid, x22, mid, x22, y2)\n            } else {\n              ctx.lineTo(x22, y2)\n            }\n            ctx.lineTo(x21, y2)\n            if (drawCurves) {\n              ctx.bezierCurveTo(x21, mid, x11, mid, x11, y1)\n            } else {\n              ctx.lineTo(x11, y1)\n            }\n            ctx.closePath()\n            ctx.fill()\n          }\n        }\n      }\n    }\n  }, [\n    displayModel,\n    highResolutionScaling,\n    trackIds,\n    width,\n    views,\n    offsets,\n    drawCurves,\n    color,\n    height,\n    matches,\n    parsedCIGARs,\n  ])\n\n  return (\n    <canvas\n      ref={ref}\n      data-testid=\"synteny_canvas\"\n      style={{ width, height }}\n      width={width * highResolutionScaling}\n      height={height * highResolutionScaling}\n    />\n  )\n}\n\nexport default observer(LinearSyntenyRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LinearSyntenyRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of each feature in a synteny',\n      defaultValue: 'rgb(255,100,100,0.3)',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import ComparativeServerSideRendererType from '@jbrowse/core/pluggableElementTypes/renderers/ComparativeServerSideRendererType'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport React from 'react'\n\nexport default class LinearSyntenyRenderer extends ComparativeServerSideRendererType {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async renameRegionsIfNeeded(args: any) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n\n    if (!assemblyManager) {\n      throw new Error('No assembly manager provided')\n    }\n    const {\n      view: { views },\n    } = args\n\n    for (let i = 0; i < views.length; i++) {\n      const view = views[i]\n      view.displayedRegions = (\n        await renameRegionsIfNeeded(assemblyManager, {\n          sessionId: args.sessionId,\n          regions: view.displayedRegions,\n          adapterConfig: args.adapterConfig,\n        })\n      ).regions\n    }\n\n    return args\n  }\n  async render(renderProps: {\n    height: number\n    width: number\n    view: { views: Base1DViewModel[] }\n  }) {\n    const {\n      width,\n      view: { views },\n    } = renderProps\n    const realizedViews = views.map(snap => {\n      const view = Base1DView.create(snap)\n      view.setVolatileWidth(width)\n      return view\n    })\n    const features = await Promise.all(\n      realizedViews.map(view =>\n        this.getFeatures({\n          ...renderProps,\n          regions: view.staticBlocks.contentBlocks,\n        }),\n      ),\n    )\n\n    const serializedFeatures = JSON.parse(JSON.stringify(features))\n    for (let i = 0; i < serializedFeatures.length; i++) {\n      for (let j = 0; j < serializedFeatures[i].length; j++) {\n        // eslint-disable-next-line no-underscore-dangle\n        serializedFeatures[i][j]._level = i\n      }\n    }\n\n    return {\n      reactElement: React.createElement(this.ReactComponent, {\n        ...renderProps,\n        features,\n      }),\n      features: serializedFeatures,\n    }\n  }\n}\n","import { types, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport CropFreeIcon from '@material-ui/icons/CropFree'\nimport LinkIcon from '@material-ui/icons/Link'\nimport LinkOffIcon from '@material-ui/icons/LinkOff'\nimport { Curves, StraightLines } from './components/Icons'\n\nimport baseModel from '../LinearComparativeView/model'\n\nexport default function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      baseModel(pluginManager),\n      types\n        .model('LinearSyntenyView', {\n          type: types.literal('LinearSyntenyView'),\n          drawCurves: false,\n        })\n        .actions(self => ({\n          toggleCurves() {\n            self.drawCurves = !self.drawCurves\n          },\n        })),\n    )\n    .views(self => {\n      const superMenuItems = self.menuItems\n      return {\n        menuItems() {\n          return [\n            ...superMenuItems(),\n\n            {\n              label: 'Square view',\n              onClick: self.squareView,\n              description:\n                'Makes both views use the same zoom level, adjusting to the average of each',\n              icon: CropFreeIcon,\n            },\n            {\n              label: self.linkViews ? 'Unlink views' : 'Link views',\n              onClick: self.toggleLinkViews,\n              icon: self.linkViews ? LinkOffIcon : LinkIcon,\n            },\n            {\n              label: self.drawCurves\n                ? 'Use straight lines'\n                : 'Use curved lines',\n              onClick: self.toggleCurves,\n              icon: self.drawCurves ? StraightLines : Curves,\n            },\n          ]\n        },\n      }\n    })\n}\nexport type LinearSyntenyViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearSyntenyViewModel = Instance<LinearSyntenyViewStateModel>\n","import { lazy } from 'react'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport modelFactory from './model'\n\nexport default (pluginManager: PluginManager) => {\n  const { jbrequire } = pluginManager\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n  return new ViewType({\n    name: 'LinearSyntenyView',\n    stateModel: jbrequire(modelFactory),\n    ReactComponent: lazy(() => import('./components/LinearSyntenyView')),\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { LinearSyntenyViewModel } from './LinearSyntenyView/model'\nimport { when } from 'mobx'\n\ntype LSV = LinearSyntenyViewModel\n\nexport default function LaunchLinearSyntenyView(pluginManager: PluginManager) {\n  pluginManager.addToExtensionPoint(\n    'LaunchView-LinearSyntenyView',\n    // @ts-ignore\n    async ({\n      session,\n      views,\n      tracks = [],\n    }: {\n      session: AbstractSessionModel\n      views: { loc: string; assembly: string; tracks?: string[] }[]\n      tracks?: string[]\n    }) => {\n      try {\n        const { assemblyManager } = session\n        const model = session.addView('LinearSyntenyView', {}) as LSV\n\n        await when(() => !!model.width)\n\n        model.setViews(\n          await Promise.all(\n            views.map(async view => {\n              const asm = await assemblyManager.waitForAssembly(view.assembly)\n              if (!asm) {\n                throw new Error(`Assembly ${view.assembly} failed to load`)\n              }\n              return {\n                type: 'LinearGenomeView' as const,\n                bpPerPx: 1,\n                offsetPx: 0,\n                hideHeader: true,\n                displayedRegions: asm.regions,\n              }\n            }),\n          ),\n        )\n\n        await Promise.all(model.views.map(view => when(() => view.initialized)))\n\n        const idsNotFound = [] as string[]\n        for (let i = 0; i < views.length; i++) {\n          const view = model.views[i]\n          const { loc, tracks = [] } = views[i]\n\n          view.navToLocString(loc)\n          tracks.forEach(track => tryTrack(view, track, idsNotFound))\n        }\n\n        tracks.forEach(track => tryTrack(model, track, idsNotFound))\n\n        if (idsNotFound.length) {\n          throw new Error(\n            `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n          )\n        }\n      } catch (e) {\n        session.notify(`${e}`, 'error')\n        throw e\n      }\n    },\n  )\n}\n\nfunction tryTrack(\n  model: { showTrack: (arg: string) => void },\n  trackId: string,\n  idsNotFound: string[],\n) {\n  try {\n    model.showTrack(trackId)\n  } catch (e) {\n    if (`${e}`.match('Could not resolve identifier')) {\n      idsNotFound.push(trackId)\n    } else {\n      throw e\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { useEffect, useState } from 'react'\nimport {\n  Button,\n  CircularProgress,\n  Checkbox,\n  FormControlLabel,\n  TextField,\n  Typography,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  makeStyles,\n} from '@material-ui/core'\n\nimport { getConf } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\n// icons\nimport CloseIcon from '@material-ui/icons/Close'\nimport { MismatchParser } from '@jbrowse/plugin-alignments'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\nconst { parseCigar } = MismatchParser\n\nfunction getLengthOnRef(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let lengthOnRef = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'I') {\n      lengthOnRef += len\n    }\n  }\n  return lengthOnRef\n}\n\nfunction getLength(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\n\nfunction getLengthSansClipping(cigar: string) {\n  const cigarOps = parseCigar(cigar)\n  let length = 0\n  for (let i = 0; i < cigarOps.length; i += 2) {\n    const len = +cigarOps[i]\n    const op = cigarOps[i + 1]\n    if (op !== 'H' && op !== 'S' && op !== 'D' && op !== 'N') {\n      length += len\n    }\n  }\n  return length\n}\nfunction getClip(cigar: string, strand: number) {\n  return strand === -1\n    ? +(cigar.match(/(\\d+)[SH]$/) || [])[1] || 0\n    : +(cigar.match(/^(\\d+)([SH])/) || [])[1] || 0\n}\n\ninterface ReducedFeature {\n  refName: string\n  start: number\n  clipPos: number\n  end: number\n  strand: number\n  seqLength: number\n  syntenyId?: number\n  uniqueId: string\n  mate: {\n    refName: string\n    start: number\n    end: number\n    syntenyId?: number\n    uniqueId?: string\n  }\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: 300,\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction getTag(f: Feature, tag: string) {\n  const tags = f.get('tags')\n  return tags ? tags[tag] : f.get(tag)\n}\n\nfunction mergeIntervals<T extends { start: number; end: number }>(\n  intervals: T[],\n  w = 5000,\n) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = []\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0])\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n    top = stack[stack.length - 1]\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i].start - w) {\n      stack.push(intervals[i])\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i].end) {\n      top.end = Math.max(top.end, intervals[i].end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n\ninterface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\n// hashmap of refName->array of features\ntype FeaturesPerRef = { [key: string]: BasicFeature[] }\n\nfunction gatherOverlaps(regions: BasicFeature[]) {\n  const groups = regions.reduce((memo, x) => {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName].push(x)\n    return memo\n  }, {} as FeaturesPerRef)\n\n  return Object.values(groups)\n    .map(group => mergeIntervals(group.sort((a, b) => a.start - b.start)))\n    .flat()\n}\n\nexport function WindowSizeDlg(props: {\n  feature: Feature\n  handleClose: () => void\n  track: any\n}) {\n  const classes = useStyles()\n  const { track, feature: preFeature, handleClose } = props\n\n  // window size stored as string, because it corresponds to a textfield which\n  // is parsed as number on submit\n  const [windowSizeText, setWindowSize] = useState('0')\n  const [error, setError] = useState<unknown>()\n  const [primaryFeature, setPrimaryFeature] = useState<Feature>()\n  const [qualTrack, setQualTrack] = useState(false)\n  const windowSize = +windowSizeText\n\n  // we need to fetch the primary alignment if the selected feature is 2048.\n  // this should be the first in the list of the SA tag\n  useEffect(() => {\n    let done = false\n    ;(async () => {\n      try {\n        if (preFeature.get('flags') & 2048) {\n          const SA: string = getTag(preFeature, 'SA') || ''\n          const primaryAln = SA.split(';')[0]\n          const [saRef, saStart] = primaryAln.split(',')\n          const { rpcManager } = getSession(track)\n          const adapterConfig = getConf(track, 'adapter')\n          const sessionId = getRpcSessionId(track)\n\n          const feats = (await rpcManager.call(sessionId, 'CoreGetFeatures', {\n            adapterConfig,\n            sessionId,\n            regions: [\n              {\n                refName: saRef,\n                start: +saStart - 1,\n                end: +saStart,\n              },\n            ],\n          })) as Feature[]\n\n          const result = feats.find(\n            f =>\n              f.get('name') === preFeature.get('name') &&\n              !(f.get('flags') & 2048),\n          )\n          if (result) {\n            if (!done) {\n              setPrimaryFeature(result)\n            }\n          } else {\n            throw new Error('primary feature not found')\n          }\n        } else {\n          setPrimaryFeature(preFeature)\n        }\n      } catch (e) {\n        console.error(e)\n        setError(e)\n      }\n    })()\n\n    return () => {\n      done = true\n    }\n  }, [preFeature, track])\n\n  function onSubmit() {\n    try {\n      if (!primaryFeature) {\n        return\n      }\n      const feature = primaryFeature\n      const session = getSession(track)\n      const view = getContainingView(track)\n      const cigar = feature.get('CIGAR')\n      const clipPos = getClip(cigar, 1)\n      const flags = feature.get('flags')\n      const qual = feature.get('qual') as string\n      const origStrand = feature.get('strand')\n      const SA: string = getTag(feature, 'SA') || ''\n      const readName = feature.get('name')\n\n      const readAssembly = `${readName}_assembly_${Date.now()}`\n      const [trackAssembly] = getConf(track, 'assemblyNames')\n      const assemblyNames = [trackAssembly, readAssembly]\n      const trackId = `track-${Date.now()}`\n      const trackName = `${readName}_vs_${trackAssembly}`\n\n      // get the canonical refname for the read because if the\n      // read.get('refName') is chr1 and the actual fasta refName is 1 then no\n      // tracks can be opened on the top panel of the linear read vs ref\n      const { assemblyManager } = session\n      const assembly = assemblyManager.get(trackAssembly)\n\n      const supplementaryAlignments = SA.split(';')\n        .filter(aln => !!aln)\n        .map((aln, index) => {\n          const [saRef, saStart, saStrand, saCigar] = aln.split(',')\n          const saLengthOnRef = getLengthOnRef(saCigar)\n          const saLength = getLength(saCigar)\n          const saLengthSansClipping = getLengthSansClipping(saCigar)\n          const saStrandNormalized = saStrand === '-' ? -1 : 1\n          const saClipPos = getClip(saCigar, saStrandNormalized * origStrand)\n          const saRealStart = +saStart - 1\n          return {\n            refName: saRef,\n            start: saRealStart,\n            end: saRealStart + saLengthOnRef,\n            seqLength: saLength,\n            clipPos: saClipPos,\n            CIGAR: saCigar,\n            assemblyName: trackAssembly,\n            strand: origStrand * saStrandNormalized,\n            uniqueId: `${feature.id()}_SA${index}`,\n            mate: {\n              start: saClipPos,\n              end: saClipPos + saLengthSansClipping,\n              refName: readName,\n            },\n          }\n        })\n\n      const feat = feature.toJSON()\n      feat.clipPos = clipPos\n      feat.strand = 1\n\n      feat.mate = {\n        refName: readName,\n        start: clipPos,\n        end: clipPos + getLengthSansClipping(cigar),\n      }\n\n      // if secondary alignment or supplementary, calculate length from SA[0]'s\n      // CIGAR which is the primary alignments. otherwise it is the primary\n      // alignment just use seq.length if primary alignment\n      const totalLength =\n        flags & 2048\n          ? getLength(supplementaryAlignments[0].CIGAR)\n          : getLength(cigar)\n\n      const features = [feat, ...supplementaryAlignments] as ReducedFeature[]\n\n      features.forEach((f, index) => {\n        f.refName = assembly?.getCanonicalRefName(f.refName) || f.refName\n        f.syntenyId = index\n        f.mate.syntenyId = index\n        f.mate.uniqueId = `${f.uniqueId}_mate`\n      })\n      features.sort((a, b) => a.clipPos - b.clipPos)\n\n      const featSeq = feature.get('seq')\n\n      // the config feature store includes synthetic mate features\n      // mapped to the read assembly\n      const configFeatureStore = features.concat(\n        // @ts-ignore\n        features.map(f => f.mate),\n      )\n\n      const expand = 2 * windowSize\n      const refLength = features.reduce(\n        (a, f) => a + f.end - f.start + expand,\n        0,\n      )\n\n      const seqTrackId = `${readName}_${Date.now()}`\n      const sequenceTrackConf = getConf(assembly, 'sequence')\n      const lgvRegions = gatherOverlaps(\n        features.map(f => ({\n          ...f,\n          start: Math.max(0, f.start - windowSize),\n          end: f.end + windowSize,\n          assemblyName: trackAssembly,\n        })),\n      )\n\n      session.addAssembly?.({\n        name: `${readAssembly}`,\n        sequence: {\n          type: 'ReferenceSequenceTrack',\n          name: `Read sequence`,\n          trackId: seqTrackId,\n          assemblyNames: [readAssembly],\n          adapter: {\n            type: 'FromConfigSequenceAdapter',\n            noAssemblyManager: true,\n            features: [\n              {\n                start: 0,\n                end: totalLength,\n                seq: featSeq,\n                refName: readName,\n                uniqueId: `${Math.random()}`,\n              },\n            ],\n          },\n        },\n      })\n\n      session.addView('LinearSyntenyView', {\n        type: 'LinearSyntenyView',\n        views: [\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: refLength / view.width,\n            displayedRegions: lgvRegions,\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                assemblyNames: [trackAssembly],\n                configuration: sequenceTrackConf.trackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: true,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n            ],\n          },\n          {\n            type: 'LinearGenomeView',\n            hideHeader: true,\n            offsetPx: 0,\n            bpPerPx: totalLength / view.width,\n            displayedRegions: [\n              {\n                assemblyName: readAssembly,\n                start: 0,\n                end: totalLength,\n                refName: readName,\n              },\n            ],\n            tracks: [\n              {\n                id: `${Math.random()}`,\n                type: 'ReferenceSequenceTrack',\n                configuration: seqTrackId,\n                displays: [\n                  {\n                    id: `${Math.random()}`,\n                    type: 'LinearReferenceSequenceDisplay',\n                    showReverse: true,\n                    showTranslation: false,\n                    height: 35,\n                    configuration: `${seqTrackId}-LinearReferenceSequenceDisplay`,\n                  },\n                ],\n              },\n              ...(qualTrack\n                ? [\n                    {\n                      id: `${Math.random()}`,\n                      type: 'QuantitativeTrack',\n                      configuration: {\n                        trackId: 'qualTrack',\n                        assemblyNames: [readAssembly],\n                        name: 'Read quality',\n                        type: 'QuantitativeTrack',\n                        adapter: {\n                          type: 'FromConfigAdapter',\n                          noAssemblyManager: true,\n                          features: qual.split(' ').map((score, index) => {\n                            return {\n                              start: index,\n                              end: index + 1,\n                              refName: readName,\n                              score: +score,\n                              uniqueId: `feat_${index}`,\n                            }\n                          }),\n                        },\n                      },\n                      displays: [\n                        {\n                          id: `${Math.random()}`,\n                          type: 'LinearWiggleDisplay',\n                          height: 100,\n                        },\n                      ],\n                    },\n                  ]\n                : []),\n            ],\n          },\n        ],\n        viewTrackConfigs: [\n          {\n            type: 'SyntenyTrack',\n            assemblyNames,\n            adapter: {\n              type: 'FromConfigAdapter',\n              features: configFeatureStore,\n            },\n            trackId,\n            name: trackName,\n          },\n        ],\n        tracks: [\n          {\n            configuration: trackId,\n            type: 'SyntenyTrack',\n            displays: [\n              {\n                type: 'LinearSyntenyDisplay',\n                configuration: `${trackId}-LinearSyntenyDisplay`,\n              },\n            ],\n          },\n        ],\n        displayName: `${readName} vs ${trackAssembly}`,\n      })\n      handleClose()\n    } catch (e) {\n      console.error(e)\n      setError(e)\n    }\n  }\n\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Set window size\n        <IconButton\n          aria-label=\"close\"\n          className={classes.closeButton}\n          onClick={handleClose}\n        >\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <Typography color=\"error\">{`${error}`}</Typography>\n        ) : !primaryFeature ? (\n          <div>\n            <Typography>\n              To accurately perform comparison we are fetching the primary\n              alignment. Loading primary feature...\n            </Typography>\n            <CircularProgress />\n          </div>\n        ) : (\n          <div className={classes.root}>\n            <Typography>\n              Show an extra window size around each part of the split alignment.\n              Using a larger value can allow you to see more genomic context.\n            </Typography>\n\n            <TextField\n              value={windowSize}\n              onChange={event => setWindowSize(event.target.value)}\n              label=\"Set window size\"\n            />\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={qualTrack}\n                  onChange={() => setQualTrack(val => !val)}\n                />\n              }\n              label=\"Show qual track\"\n            />\n          </div>\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button variant=\"contained\" color=\"secondary\" onClick={handleClose}>\n          Cancel\n        </Button>\n        <Button\n          disabled={!primaryFeature}\n          variant=\"contained\"\n          color=\"primary\"\n          onClick={onSubmit}\n        >\n          Submit\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AbstractSessionModel,\n  getSession,\n  getContainingTrack,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util'\nimport { PluggableElementType } from '@jbrowse/core/pluggableElementTypes'\n\nimport AddIcon from '@material-ui/icons/Add'\nimport CalendarIcon from '@material-ui/icons/CalendarViewDay'\nimport LinearComparativeDisplayF from './LinearComparativeDisplay'\nimport LinearComparativeViewF from './LinearComparativeView'\nimport LinearSyntenyDisplayF from './LinearSyntenyDisplay'\nimport LinearSyntenyRendererF from './LinearSyntenyRenderer'\nimport LinearSyntenyViewF from './LinearSyntenyView'\nimport LaunchLinearSyntenyViewF from './LaunchLinearSyntenyView'\nimport SyntenyTrackF from './SyntenyTrack'\nimport { WindowSizeDlg } from './ReadVsRef'\n\nfunction isDisplay(elt: { name: string }): elt is DisplayType {\n  return elt.name === 'LinearPileupDisplay'\n}\n\nexport default class extends Plugin {\n  name = 'LinearComparativeViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(LinearComparativeViewF),\n    )\n    pluginManager.addViewType(() => pluginManager.jbrequire(LinearSyntenyViewF))\n\n    LinearSyntenyRendererF(pluginManager)\n    LinearComparativeDisplayF(pluginManager)\n    LinearSyntenyDisplayF(pluginManager)\n    LaunchLinearSyntenyViewF(pluginManager)\n    SyntenyTrackF(pluginManager)\n\n    pluginManager.addToExtensionPoint(\n      'Core-extendPluggableElement',\n      (pluggableElement: PluggableElementType) => {\n        if (!isDisplay(pluggableElement)) {\n          return pluggableElement\n        }\n        pluggableElement.stateModel = pluggableElement.stateModel.extend(\n          self => {\n            const superContextMenuItems = self.contextMenuItems\n            return {\n              views: {\n                contextMenuItems() {\n                  const feature = self.contextMenuFeature\n                  return feature\n                    ? [\n                        ...superContextMenuItems(),\n                        {\n                          label: 'Linear read vs ref',\n                          icon: AddIcon,\n                          onClick: () => {\n                            getSession(self).queueDialog(handleClose => [\n                              WindowSizeDlg,\n                              {\n                                track: getContainingTrack(self),\n                                feature,\n                                handleClose,\n                              },\n                            ])\n                          },\n                        },\n                      ]\n                    : superContextMenuItems()\n                },\n              },\n            }\n          },\n        )\n        return pluggableElement\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear synteny view',\n        icon: CalendarIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearSyntenyView', {})\n        },\n      })\n    }\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\n\nimport ReactComponent from './components/LinearSyntenyRendering'\nimport configSchema from './configSchema'\nimport LinearSyntenyRenderer from './LinearSyntenyRenderer'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addRendererType(\n    () =>\n      new LinearSyntenyRenderer({\n        name: 'LinearSyntenyRenderer',\n        configSchema,\n        ReactComponent,\n        pluginManager,\n      }),\n  )\n}\n","import {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default (pluginManager: PluginManager) => {\n  pluginManager.addTrackType(() => {\n    const configSchema = ConfigurationSchema(\n      'SyntenyTrack',\n      {},\n      { baseConfiguration: createBaseTrackConfig(pluginManager) },\n    )\n    return new TrackType({\n      name: 'SyntenyTrack',\n      configSchema,\n      stateModel: createBaseTrackModel(\n        pluginManager,\n        'SyntenyTrack',\n        configSchema,\n      ),\n    })\n  })\n}\n","import React from 'react'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\n\nconst useStyles = makeStyles(theme => ({\n  contentBlock: {\n    position: 'relative',\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n  },\n  elidedBlock: {\n    minHeight: '100%',\n    boxSizing: 'border-box',\n    backgroundColor: '#999',\n    backgroundImage:\n      'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n  },\n  interRegionPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.text.primary,\n  },\n  boundaryPaddingBlock: {\n    minHeight: '100%',\n    backgroundColor: theme.palette.action.disabledBackground,\n  },\n}))\n\nconst ContentBlock = observer(\n  ({ block, children }: { block: BaseBlock; children: React.ReactNode }) => {\n    const classes = useStyles()\n    const { widthPx } = block\n    return (\n      <div style={{ width: widthPx }} className={classes.contentBlock}>\n        {children}\n      </div>\n    )\n  },\n)\n\nfunction ElidedBlock({ width }: { width: number }) {\n  const classes = useStyles()\n  return <div className={classes.elidedBlock} style={{ width }} />\n}\n\nfunction InterRegionPaddingBlock({\n  boundary,\n  width,\n  style = {},\n}: {\n  boundary: boolean\n  width: number\n  style?: React.CSSProperties\n}) {\n  const classes = useStyles()\n  return (\n    <div\n      style={{\n        ...style,\n        width,\n      }}\n      className={\n        boundary\n          ? classes.boundaryPaddingBlock\n          : classes.interRegionPaddingBlock\n      }\n    />\n  )\n}\n\nexport { ContentBlock, ElidedBlock, InterRegionPaddingBlock }\n","import React, { useState, useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Slider from '@material-ui/core/Slider'\nimport { makeStyles } from '@material-ui/core/styles'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n  },\n  slider: {\n    width: 70,\n  },\n})\n\nfunction ZoomControls({ model }: { model: LinearGenomeViewModel }) {\n  const classes = useStyles()\n  const { maxBpPerPx, minBpPerPx, bpPerPx, scaleFactor } = model\n  const [value, setValue] = useState(-Math.log2(bpPerPx) * 100)\n  useEffect(() => {\n    setValue(-Math.log2(bpPerPx) * 100)\n  }, [setValue, bpPerPx])\n  return (\n    <div className={classes.container}>\n      <IconButton\n        data-testid=\"zoom_out\"\n        onClick={() => {\n          model.zoom(bpPerPx * 2)\n        }}\n        disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomOut />\n      </IconButton>\n\n      <Slider\n        className={classes.slider}\n        value={value}\n        min={-Math.log2(maxBpPerPx) * 100}\n        max={-Math.log2(minBpPerPx) * 100}\n        onChange={(_, val) => setValue(val as number)}\n        onChangeCommitted={() => model.zoomTo(2 ** (-value / 100))}\n        disabled={scaleFactor !== 1}\n      />\n      <IconButton\n        data-testid=\"zoom_in\"\n        onClick={() => {\n          model.zoom(model.bpPerPx / 2)\n        }}\n        disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n        color=\"secondary\"\n      >\n        <ZoomIn />\n      </IconButton>\n    </div>\n  )\n}\n\nexport default observer(ZoomControls)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Button,\n  FormGroup,\n  Typography,\n  makeStyles,\n  alpha,\n} from '@material-ui/core'\nimport { getBpDisplayStr } from '@jbrowse/core/util'\nimport SearchBox from './SearchBox'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward'\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\n\n// locals\nimport {\n  LinearGenomeViewModel,\n  WIDGET_HEIGHT,\n  SPACING,\n  HEADER_BAR_HEIGHT,\n} from '..'\nimport OverviewScaleBar from './OverviewScaleBar'\nimport ZoomControls from './ZoomControls'\n\ntype LGV = LinearGenomeViewModel\nconst useStyles = makeStyles(theme => ({\n  headerBar: {\n    height: HEADER_BAR_HEIGHT,\n    display: 'flex',\n  },\n  headerForm: {\n    flexWrap: 'nowrap',\n    marginRight: 7,\n  },\n  spacer: {\n    flexGrow: 1,\n  },\n\n  panButton: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    height: WIDGET_HEIGHT,\n    margin: SPACING,\n  },\n  bp: {\n    display: 'flex',\n    alignItems: 'center',\n    marginLeft: 5,\n  },\n  toggleButton: {\n    height: 44,\n    border: 'none',\n    margin: theme.spacing(0.5),\n  },\n  buttonSpacer: {\n    marginRight: theme.spacing(2),\n  },\n}))\n\nconst HeaderButtons = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <Button\n      onClick={model.activateTrackSelector}\n      className={classes.toggleButton}\n      title=\"Open track selector\"\n      value=\"track_select\"\n      color=\"secondary\"\n    >\n      <TrackSelectorIcon className={classes.buttonSpacer} />\n    </Button>\n  )\n})\n\nfunction PanControls({ model }: { model: LGV }) {\n  const classes = useStyles()\n  return (\n    <>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(-0.9)}\n      >\n        <ArrowBackIcon />\n      </Button>\n      <Button\n        variant=\"outlined\"\n        className={classes.panButton}\n        onClick={() => model.slide(0.9)}\n      >\n        <ArrowForwardIcon />\n      </Button>\n    </>\n  )\n}\n\nconst RegionWidth = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const { coarseTotalBp } = model\n  return (\n    <Typography variant=\"body2\" color=\"textSecondary\" className={classes.bp}>\n      {getBpDisplayStr(coarseTotalBp)}\n    </Typography>\n  )\n})\n\nconst Controls = ({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <div className={classes.headerBar}>\n      <HeaderButtons model={model} />\n      <div className={classes.spacer} />\n      <FormGroup row className={classes.headerForm}>\n        <PanControls model={model} />\n        <SearchBox model={model} />\n      </FormGroup>\n      <RegionWidth model={model} />\n      <ZoomControls model={model} />\n      <div className={classes.spacer} />\n    </div>\n  )\n}\n\nconst LinearGenomeViewHeader = observer(({ model }: { model: LGV }) => {\n  return model.hideHeaderOverview ? (\n    <Controls model={model} />\n  ) : (\n    <OverviewScaleBar model={model}>\n      <Controls model={model} />\n    </OverviewScaleBar>\n  )\n})\n\nexport default LinearGenomeViewHeader\n","import React from 'react'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport CascadingMenu from '@jbrowse/core/ui/CascadingMenu'\nimport { getSession, getContainingView } from '@jbrowse/core/util'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport {\n  IconButton,\n  Paper,\n  Typography,\n  alpha,\n  makeStyles,\n} from '@material-ui/core'\n\nimport {\n  bindTrigger,\n  bindPopover,\n  usePopupState,\n} from 'material-ui-popup-state/hooks'\n\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\n\n// icons\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport DragIcon from '@material-ui/icons/DragIndicator'\nimport CloseIcon from '@material-ui/icons/Close'\n\nimport { LinearGenomeViewStateModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    background: alpha(theme.palette.background.paper, 0.8),\n    '&:hover': {\n      background: theme.palette.background.paper,\n    },\n    transition: theme.transitions.create(['background'], {\n      duration: theme.transitions.duration.shortest,\n    }),\n  },\n  trackName: {\n    margin: '0 auto',\n    width: '90%',\n    fontSize: '0.8rem',\n    pointerEvents: 'none',\n  },\n  dragHandle: {\n    cursor: 'grab',\n    color: '#135560',\n  },\n  dragHandleIcon: {\n    display: 'inline-block',\n    verticalAlign: 'middle',\n    pointerEvents: 'none',\n  },\n  iconButton: {\n    padding: theme.spacing(1),\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst TrackLabel = React.forwardRef(\n  (\n    { track, className }: { track: BaseTrackModel; className?: string },\n    ref,\n  ) => {\n    const classes = useStyles()\n    const view = getContainingView(track) as LGV\n    const session = getSession(track)\n    const trackConf = track.configuration\n    const trackId = getConf(track, 'trackId')\n\n    const popupState = usePopupState({\n      popupId: 'trackLabelMenu',\n      variant: 'popover',\n    })\n\n    const onDragStart = (event: React.DragEvent<HTMLSpanElement>) => {\n      const target = event.target as HTMLElement\n      if (target.parentNode) {\n        event.dataTransfer.setDragImage(\n          target.parentNode as HTMLElement,\n          20,\n          20,\n        )\n        view.setDraggingTrackId(track.id)\n      }\n    }\n\n    const onDragEnd = () => {\n      view.setDraggingTrackId(undefined)\n    }\n\n    let trackName = getConf(track, 'name')\n    if (getConf(track, 'type') === 'ReferenceSequenceTrack') {\n      const r = session.assemblies.find(a => a.sequence === trackConf)\n      trackName =\n        trackName ||\n        (r\n          ? `Reference Sequence (${readConfObject(r, 'name')})`\n          : 'Reference Sequence')\n    }\n\n    const items = [\n      ...(session.getTrackActionMenuItems?.(trackConf) || []),\n      ...track.trackMenuItems(),\n    ].sort((a, b) => (b.priority || 0) - (a.priority || 0))\n\n    return (\n      <>\n        <Paper ref={ref} className={clsx(className, classes.root)}>\n          <span\n            draggable\n            className={classes.dragHandle}\n            onDragStart={onDragStart}\n            onDragEnd={onDragEnd}\n            data-testid={`dragHandle-${view.id}-${trackId}`}\n          >\n            <DragIcon className={classes.dragHandleIcon} />\n          </span>\n          <IconButton\n            onClick={() => view.hideTrack(trackId)}\n            className={classes.iconButton}\n            title=\"close this track\"\n            color=\"secondary\"\n          >\n            <CloseIcon />\n          </IconButton>\n          <Typography\n            variant=\"body1\"\n            component=\"span\"\n            className={classes.trackName}\n          >\n            {trackName}\n          </Typography>\n          <IconButton\n            {...bindTrigger(popupState)}\n            className={classes.iconButton}\n            color=\"secondary\"\n            data-testid=\"track_menu_icon\"\n            disabled={!items.length}\n          >\n            <MoreVertIcon />\n          </IconButton>\n        </Paper>\n        <CascadingMenu\n          {...bindPopover(popupState)}\n          onMenuItemClick={(_: unknown, callback: Function) => callback()}\n          menuItems={items}\n          popupState={popupState}\n        />\n      </>\n    )\n  },\n)\n\nexport default observer(TrackLabel)\n","import React, { useEffect, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { isAlive } from 'mobx-state-tree'\nimport { BaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { ResizeHandle } from '@jbrowse/core/ui'\nimport { useDebouncedCallback } from '@jbrowse/core/util'\nimport clsx from 'clsx'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/core/styles'\n\nimport { LinearGenomeViewModel, RESIZE_HANDLE_HEIGHT } from '..'\nimport TrackLabel from './TrackLabel'\n\nconst useStyles = makeStyles(theme => ({\n  root: { marginTop: 2 },\n  resizeHandle: {\n    height: RESIZE_HANDLE_HEIGHT,\n    boxSizing: 'border-box',\n    position: 'relative',\n    zIndex: 2,\n  },\n  overlay: {\n    pointerEvents: 'none',\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    zIndex: 3,\n    borderRadius: theme.shape.borderRadius,\n  },\n  trackLabel: {\n    zIndex: 3,\n  },\n\n  // aligns with block bounderies. check for example the breakpoint split view\n  // demo to see if features align if wanting to change things\n  renderingComponentContainer: {\n    position: 'absolute',\n    // -1 offset because of the 1px border of the Paper\n    left: -1,\n    height: '100%',\n    width: '100%',\n  },\n  trackLabelInline: {\n    position: 'relative',\n    display: 'inline-block',\n  },\n  trackLabelOverlap: {\n    position: 'absolute',\n  },\n  trackRenderingContainer: {\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    whiteSpace: 'nowrap',\n    position: 'relative',\n    background: 'none',\n    zIndex: 2,\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst TrackContainerLabel = observer(\n  ({ model, view }: { model: BaseTrackModel; view: LGV }) => {\n    const classes = useStyles()\n    const labelStyle =\n      view.trackLabels === 'overlapping'\n        ? classes.trackLabelOverlap\n        : classes.trackLabelInline\n    return view.trackLabels !== 'hidden' ? (\n      <TrackLabel\n        track={model}\n        className={clsx(classes.trackLabel, labelStyle)}\n      />\n    ) : null\n  },\n)\n\nfunction TrackContainer({\n  model,\n  track,\n}: {\n  model: LinearGenomeViewModel\n  track: BaseTrackModel\n}) {\n  const classes = useStyles()\n  const display = track.displays[0]\n  const { horizontalScroll, draggingTrackId, moveTrack } = model\n  const { height } = display\n  const trackId = getConf(track, 'trackId')\n  const ref = useRef(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      model.trackRefs[trackId] = ref.current\n    }\n    return () => {\n      delete model.trackRefs[trackId]\n    }\n  }, [model.trackRefs, trackId])\n  function onDragEnter() {\n    if (\n      draggingTrackId !== undefined &&\n      isAlive(display) &&\n      draggingTrackId !== display.id\n    ) {\n      moveTrack(draggingTrackId, track.id)\n    }\n  }\n  const debouncedOnDragEnter = useDebouncedCallback(onDragEnter, 100)\n  const { RenderingComponent, DisplayBlurb } = display\n  const dimmed = draggingTrackId !== undefined && draggingTrackId !== display.id\n\n  return (\n    <Paper className={classes.root} variant=\"outlined\">\n      <TrackContainerLabel model={track} view={model} />\n      <div\n        className={classes.trackRenderingContainer}\n        style={{ height }}\n        onScroll={event => {\n          const target = event.target as HTMLDivElement\n          display.setScrollTop(target.scrollTop)\n        }}\n        onDragEnter={debouncedOnDragEnter}\n        data-testid={`trackRenderingContainer-${model.id}-${trackId}`}\n        role=\"presentation\"\n      >\n        <div\n          ref={ref}\n          className={classes.renderingComponentContainer}\n          style={{ transform: `scaleX(${model.scaleFactor})` }}\n        >\n          <RenderingComponent\n            model={display}\n            onHorizontalScroll={horizontalScroll}\n          />\n        </div>\n\n        {DisplayBlurb ? (\n          <div\n            style={{\n              position: 'absolute',\n              left: 0,\n              top: display.height - 20,\n            }}\n          >\n            <DisplayBlurb model={display} />\n          </div>\n        ) : null}\n      </div>\n      <div\n        className={classes.overlay}\n        style={{\n          height: display.height,\n          background: dimmed ? 'rgba(0, 0, 0, 0.4)' : undefined,\n        }}\n        onDragEnter={debouncedOnDragEnter}\n      />\n      <ResizeHandle\n        onDrag={display.resizeHeight}\n        className={classes.resizeHandle}\n      />\n    </Paper>\n  )\n}\n\nexport default observer(TrackContainer)\n","import React, { useRef, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Popover,\n  Tooltip,\n  Typography,\n  makeStyles,\n  alpha,\n} from '@material-ui/core'\nimport { stringify } from '@jbrowse/core/util'\nimport { Menu } from '@jbrowse/core/ui'\nimport { LinearGenomeViewModel } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles(theme => {\n  const background = theme.palette.tertiary\n    ? alpha(theme.palette.tertiary.main, 0.7)\n    : alpha(theme.palette.primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: theme.palette.tertiary\n        ? theme.palette.tertiary.contrastText\n        : theme.palette.primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst VerticalGuide = observer(\n  ({ model, coordX }: { model: LGV; coordX: number }) => {\n    const classes = useStyles()\n    return (\n      <Tooltip\n        open\n        placement=\"top\"\n        title={stringify(model.pxToBp(coordX))}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: coordX,\n            background: 'red',\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction RubberBand({\n  model,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  ControlComponent?: React.ReactElement\n}) {\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n\n  // clientX and clientY used for anchorPosition for menu\n  // offsetX used for calculations about width of selection\n  const [anchorPosition, setAnchorPosition] = useState<{\n    offsetX: number\n    clientX: number\n    clientY: number\n  }>()\n  const [guideX, setGuideX] = useState<number | undefined>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined && anchorPosition === undefined\n\n  const { setOffsets, pxToBp } = model\n\n  useEffect(() => {\n    function computeOffsets(offsetX: number) {\n      if (startX === undefined) {\n        return\n      }\n      let leftPx = startX\n      let rightPx = offsetX\n      // handles clicking and draging to the left\n      if (rightPx < leftPx) {\n        ;[leftPx, rightPx] = [rightPx, leftPx]\n      }\n      const leftOffset = pxToBp(leftPx)\n      const rightOffset = pxToBp(rightPx)\n\n      return { leftOffset, rightOffset }\n    }\n\n    function globalMouseMove(event: MouseEvent) {\n      if (controlsRef.current && mouseDragging) {\n        const relativeX =\n          event.clientX - controlsRef.current.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp(event: MouseEvent) {\n      if (startX !== undefined && controlsRef.current) {\n        const { clientX, clientY } = event\n        const ref = controlsRef.current\n        const offsetX = clientX - ref.getBoundingClientRect().left\n        // as stated above, store both clientX/Y and offsetX for different\n        // purposes\n        setAnchorPosition({\n          offsetX,\n          clientX,\n          clientY,\n        })\n        const args = computeOffsets(offsetX)\n        if (args) {\n          const { leftOffset, rightOffset } = args\n          setOffsets(leftOffset, rightOffset)\n        }\n        setGuideX(undefined)\n      }\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove)\n      window.addEventListener('mouseup', globalMouseUp)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove)\n        window.removeEventListener('mouseup', globalMouseUp)\n      }\n    }\n    return () => {}\n  }, [startX, mouseDragging, anchorPosition, setOffsets, pxToBp])\n\n  useEffect(() => {\n    if (\n      !mouseDragging &&\n      currentX !== undefined &&\n      startX !== undefined &&\n      Math.abs(currentX - startX) <= 3\n    ) {\n      handleClose()\n    }\n  }, [mouseDragging, currentX, startX, model.bpPerPx])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    const relativeX =\n      event.clientX -\n      (event.target as HTMLDivElement).getBoundingClientRect().left\n    setStartX(relativeX)\n    setCurrentX(relativeX)\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    const target = event.target as HTMLDivElement\n    setGuideX(event.clientX - target.getBoundingClientRect().left)\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n    model.setOffsets(undefined, undefined)\n  }\n\n  function handleClose() {\n    setAnchorPosition(undefined)\n    setStartX(undefined)\n    setCurrentX(undefined)\n  }\n\n  const open = Boolean(anchorPosition)\n\n  function handleMenuItemClick(_: unknown, callback: Function) {\n    callback()\n    handleClose()\n  }\n\n  if (startX === undefined) {\n    return (\n      <>\n        {guideX !== undefined ? (\n          <VerticalGuide model={model} coordX={guideX} />\n        ) : null}\n        <div\n          data-testid=\"rubberBand_controls\"\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </>\n    )\n  }\n\n  /* Calculating Pixels for Mouse Dragging */\n  const right = anchorPosition ? anchorPosition.offsetX : currentX || 0\n  const left = right < startX ? right : startX\n  const width = Math.abs(right - startX)\n  const leftBpOffset = model.pxToBp(left)\n  const rightBpOffset = model.pxToBp(left + width)\n  const numOfBpSelected = Math.ceil(width * model.bpPerPx)\n  return (\n    <>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(leftBpOffset)}</Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>{stringify(rightBpOffset)}</Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{ left, width }}\n      >\n        <Typography variant=\"h6\" className={classes.rubberBandText}>\n          {numOfBpSelected.toLocaleString('en-US')} bp\n        </Typography>\n      </div>\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n      {anchorPosition ? (\n        <Menu\n          anchorReference=\"anchorPosition\"\n          anchorPosition={{\n            left: anchorPosition.clientX,\n            top: anchorPosition.clientY,\n          }}\n          onMenuItemClick={handleMenuItemClick}\n          open={open}\n          onClose={handleClose}\n          menuItems={model.rubberBandMenuItems()}\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(RubberBand)\n","import { Paper, Typography, makeStyles } from '@material-ui/core'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport { LinearGenomeViewModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\nimport { makeTicks } from '../util'\nimport { getTickDisplayStr } from '@jbrowse/core/util'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles(theme => ({\n  scaleBarContainer: {\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  scaleBarZoomContainer: {\n    position: 'relative',\n    zIndex: 1,\n  },\n  scaleBar: {\n    position: 'absolute',\n    display: 'flex',\n    pointerEvents: 'none',\n  },\n  majorTickLabel: {\n    fontSize: '11px',\n    zIndex: 1,\n    background: theme.palette.background.paper,\n    lineHeight: 'normal',\n    pointerEvents: 'none',\n  },\n  tick: {\n    position: 'absolute',\n    width: 0,\n    display: 'flex',\n    justifyContent: 'center',\n    pointerEvents: 'none',\n  },\n  refLabel: {\n    fontSize: '11px',\n    position: 'absolute',\n    left: '2px',\n    top: '-1px',\n    fontWeight: 'bold',\n    lineHeight: 'normal',\n    zIndex: 1,\n    pointerEvents: 'none',\n    background: theme.palette.background.paper,\n  },\n}))\n\nconst RenderedRefNameLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n\n  // find the block that needs pinning to the left side for context\n  let lastLeftBlock = 0\n  model.staticBlocks.forEach((block, i) => {\n    if (block.offsetPx - model.offsetPx < 0) {\n      lastLeftBlock = i\n    }\n  })\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        return block instanceof ContentBlock &&\n          (block.isLeftEndOfDisplayedRegion || index === lastLeftBlock) ? (\n          <Typography\n            key={`refLabel-${block.key}-${index}`}\n            style={{\n              left:\n                index === lastLeftBlock\n                  ? Math.max(0, -model.offsetPx)\n                  : block.offsetPx - model.offsetPx - 1,\n              paddingLeft: index === lastLeftBlock ? 0 : 1,\n            }}\n            className={classes.refLabel}\n            data-testid={`refLabel-${block.refName}`}\n          >\n            {block.refName}\n          </Typography>\n        ) : null\n      })}\n    </>\n  )\n})\n\nconst RenderedScaleBarLabels = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const { bpPerPx } = model\n\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const { start, end } = block\n          const ticks = makeTicks(start, end, bpPerPx, true, false)\n\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                if (tick.type === 'major') {\n                  const x =\n                    (block.reversed\n                      ? block.end - tick.base\n                      : tick.base - block.start) / model.bpPerPx\n                  const baseNumber = tick.base + 1\n                  return (\n                    <div\n                      key={tick.base}\n                      className={classes.tick}\n                      style={{ left: x }}\n                    >\n                      {baseNumber ? (\n                        <Typography className={classes.majorTickLabel}>\n                          {getTickDisplayStr(baseNumber, bpPerPx)}\n                        </Typography>\n                      ) : null}\n                    </div>\n                  )\n                }\n                return null\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              style={{ background: 'none' }}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\n\nconst ScaleBar = React.forwardRef(\n  (\n    {\n      model,\n      style,\n      className,\n      ...other\n    }: { model: LGV; style?: React.CSSProperties; className?: string },\n    ref,\n  ) => {\n    const classes = useStyles()\n\n    const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n    return (\n      <Paper\n        data-resizer=\"true\" // used to avoid click-and-drag scrolls on trackscontainer\n        className={clsx(classes.scaleBarContainer, className)}\n        variant=\"outlined\"\n        ref={ref}\n        style={style}\n        {...other}\n      >\n        <div\n          className={classes.scaleBarZoomContainer}\n          style={{\n            transform:\n              model.scaleFactor !== 1\n                ? `scaleX(${model.scaleFactor})`\n                : undefined,\n          }}\n        >\n          <div\n            className={classes.scaleBar}\n            style={{\n              left: offsetLeft - 1,\n              width: model.staticBlocks.totalWidthPx,\n              ...style,\n            }}\n          >\n            <RenderedScaleBarLabels model={model} />\n          </div>\n        </div>\n        <RenderedRefNameLabels model={model} />\n      </Paper>\n    )\n  },\n)\n\nexport default observer(ScaleBar)\n","import {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { makeStyles } from '@material-ui/core/styles'\nimport clsx from 'clsx'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React from 'react'\nimport { LinearGenomeViewStateModel } from '..'\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from '../../BaseLinearDisplay/components/Block'\n\nimport { makeTicks } from '../util'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(theme => ({\n  verticalGuidesZoomContainer: {\n    position: 'absolute',\n    height: '100%',\n    width: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n  },\n  verticalGuidesContainer: {\n    position: 'absolute',\n    height: '100%',\n    zIndex: 1,\n    pointerEvents: 'none',\n    display: 'flex',\n  },\n  tick: {\n    position: 'absolute',\n    height: '100%',\n    width: 1,\n  },\n  majorTick: {\n    background: theme.palette.text.hint,\n  },\n  minorTick: {\n    background: theme.palette.divider,\n  },\n}))\nconst RenderedVerticalGuides = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  return (\n    <>\n      {model.staticBlocks.map((block, index) => {\n        if (block instanceof ContentBlock) {\n          const ticks = makeTicks(block.start, block.end, model.bpPerPx)\n          return (\n            <ContentBlockComponent key={`${block.key}-${index}`} block={block}>\n              {ticks.map(tick => {\n                const x =\n                  (block.reversed\n                    ? block.end - tick.base\n                    : tick.base - block.start) / model.bpPerPx\n                return (\n                  <div\n                    key={tick.base}\n                    className={clsx(\n                      classes.tick,\n                      tick.type === 'major' || tick.type === 'labeledMajor'\n                        ? classes.majorTick\n                        : classes.minorTick,\n                    )}\n                    style={{ left: x }}\n                  />\n                )\n              })}\n            </ContentBlockComponent>\n          )\n        }\n        if (block instanceof ElidedBlock) {\n          return <ElidedBlockComponent key={block.key} width={block.widthPx} />\n        }\n        if (block instanceof InterRegionPaddingBlock) {\n          return (\n            <InterRegionPaddingBlockComponent\n              key={block.key}\n              width={block.widthPx}\n              boundary={block.variant === 'boundary'}\n            />\n          )\n        }\n        return null\n      })}\n    </>\n  )\n})\nfunction VerticalGuides({ model }: { model: LGV }) {\n  const classes = useStyles()\n  // find the block that needs pinning to the left side for context\n  const offsetLeft = model.staticBlocks.offsetPx - model.offsetPx\n  return (\n    <div\n      className={classes.verticalGuidesZoomContainer}\n      style={{\n        transform:\n          model.scaleFactor !== 1 ? `scaleX(${model.scaleFactor})` : undefined,\n      }}\n    >\n      <div\n        className={classes.verticalGuidesContainer}\n        style={{\n          left: offsetLeft,\n          width: model.staticBlocks.totalWidthPx,\n        }}\n      >\n        <RenderedVerticalGuides model={model} />\n      </div>\n    </div>\n  )\n}\n\nexport default observer(VerticalGuides)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport React, { useRef } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { LinearGenomeViewStateModel } from '..'\n\ntype LGV = Instance<LinearGenomeViewStateModel>\n\nconst useStyles = makeStyles(() => ({\n  centerLineContainer: {\n    background: 'transparent',\n    height: '100%',\n    zIndex: 5, // above the track but under menu\n    position: 'absolute',\n    border: '1px black dashed',\n    borderTop: 'none',\n    borderBottom: 'none',\n    pointerEvents: 'none',\n  },\n  centerLineText: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    whiteSpace: 'nowrap',\n    fontWeight: 'bold',\n  },\n}))\n\nfunction CenterLine({ model }: { model: LGV }) {\n  const { bpPerPx, centerLineInfo, trackHeights, tracks, width } = model\n  const ref = useRef<HTMLDivElement>(null)\n  const classes = useStyles()\n  const startingPosition = width / 2\n\n  return tracks.length ? (\n    <div\n      data-testid=\"centerline_container\"\n      className={classes.centerLineContainer}\n      role=\"presentation\"\n      ref={ref}\n      style={{\n        left: `${startingPosition}px`,\n        width: Math.max(1 / bpPerPx, 1),\n      }}\n    >\n      {centerLineInfo && (\n        <div\n          // text that indicates what bp is center, positioned\n          // at the bottom right of the center line\n          data-testid=\"centerline_text\"\n          className={classes.centerLineText}\n          role=\"presentation\"\n          style={{\n            left: Math.max(1 / bpPerPx, 1) + 5,\n            top: trackHeights,\n          }}\n        >\n          {/* change bp to refName */}\n          {centerLineInfo.refName}:{' '}\n          {Math.max(Math.round(centerLineInfo.offset) + 1, 0)}\n        </div>\n      )}\n    </div>\n  ) : null\n}\n\nCenterLine.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n}\n\nexport default observer(CenterLine)\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport React, { useEffect, useRef, useState } from 'react'\nimport normalizeWheel from 'normalize-wheel'\n\nimport {\n  LinearGenomeViewStateModel,\n  RESIZE_HANDLE_HEIGHT,\n  SCALE_BAR_HEIGHT,\n} from '..'\nimport RubberBand from './RubberBand'\nimport ScaleBar from './ScaleBar'\nimport VerticalGuides from './VerticalGuides'\nimport CenterLine from './CenterLine'\n\nconst useStyles = makeStyles(theme => ({\n  tracksContainer: {\n    position: 'relative',\n    borderRadius: theme.shape.borderRadius,\n    overflow: 'hidden',\n  },\n  spacer: {\n    position: 'relative',\n    height: RESIZE_HANDLE_HEIGHT,\n  },\n}))\n\ntype LGV = Instance<LinearGenomeViewStateModel>\ntype Timer = ReturnType<typeof setTimeout>\n\nfunction TracksContainer({\n  children,\n  model,\n}: {\n  children: React.ReactNode\n  model: LGV\n}) {\n  const classes = useStyles()\n  // refs are to store these variables to avoid repeated rerenders associated\n  // with useState/setState\n  const delta = useRef(0)\n  const scheduled = useRef(false)\n  const timeout = useRef<Timer>()\n  const ref = useRef<HTMLDivElement>(null)\n  const prevX = useRef<number>(0)\n\n  const [mouseDragging, setMouseDragging] = useState(false)\n\n  useEffect(() => {\n    let cleanup = () => {}\n\n    function globalMouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const currX = event.clientX\n      const distance = currX - prevX.current\n      if (distance) {\n        // use rAF to make it so multiple event handlers aren't fired per-frame\n        // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n        if (!scheduled.current) {\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(-distance)\n            scheduled.current = false\n            prevX.current = event.clientX\n          })\n        }\n      }\n    }\n\n    function globalMouseUp() {\n      prevX.current = 0\n      if (mouseDragging) {\n        setMouseDragging(false)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      cleanup = () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n      }\n    }\n    return cleanup\n  }, [model, mouseDragging, prevX])\n\n  function mouseDown(event: React.MouseEvent) {\n    // check if clicking a draggable element or a resize handle\n    const target = event.target as HTMLElement\n    if (target.draggable || target.dataset.resizer) {\n      return\n    }\n\n    // otherwise do click and drag scroll\n    if (event.button === 0) {\n      prevX.current = event.clientX\n      setMouseDragging(true)\n    }\n  }\n\n  // this local mouseup is used in addition to the global because sometimes\n  // the global add/remove are not called in time, resulting in issue #533\n  function mouseUp(event: React.MouseEvent) {\n    event.preventDefault()\n    setMouseDragging(false)\n  }\n\n  function mouseLeave(event: React.MouseEvent) {\n    event.preventDefault()\n  }\n\n  useEffect(() => {\n    const curr = ref.current\n    // if ctrl is held down, zoom in with y-scroll\n    // else scroll horizontally with x-scroll\n    function onWheel(origEvent: WheelEvent) {\n      const event = normalizeWheel(origEvent)\n      if (origEvent.ctrlKey === true) {\n        origEvent.preventDefault()\n        delta.current += event.pixelY / 500\n        model.setScaleFactor(\n          delta.current < 0 ? 1 - delta.current : 1 / (1 + delta.current),\n        )\n        if (timeout.current) {\n          clearTimeout(timeout.current)\n        }\n        timeout.current = setTimeout(() => {\n          model.setScaleFactor(1)\n          model.zoomTo(\n            delta.current > 0\n              ? model.bpPerPx * (1 + delta.current)\n              : model.bpPerPx / (1 - delta.current),\n          )\n          delta.current = 0\n        }, 300)\n      } else {\n        // this is needed to stop the event from triggering \"back button\n        // action\" on MacOSX etc.  but is a heuristic to avoid preventing the\n        // inner-track scroll behavior\n        if (Math.abs(event.pixelX) > Math.abs(2 * event.pixelY)) {\n          origEvent.preventDefault()\n        }\n        delta.current += event.pixelX\n        if (!scheduled.current) {\n          // use rAF to make it so multiple event handlers aren't fired per-frame\n          // see https://calendar.perfplanet.com/2013/the-runtime-performance-checklist/\n          scheduled.current = true\n          window.requestAnimationFrame(() => {\n            model.horizontalScroll(delta.current)\n            delta.current = 0\n            scheduled.current = false\n          })\n        }\n      }\n    }\n    if (curr) {\n      curr.addEventListener('wheel', onWheel)\n      return () => {\n        curr.removeEventListener('wheel', onWheel)\n      }\n    }\n    return () => {}\n  }, [model])\n\n  return (\n    <div\n      ref={ref}\n      role=\"presentation\"\n      className={classes.tracksContainer}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseLeave={mouseLeave}\n    >\n      <VerticalGuides model={model} />\n      {model.showCenterLine ? <CenterLine model={model} /> : null}\n\n      <RubberBand\n        model={model}\n        ControlComponent={\n          <ScaleBar\n            model={model}\n            style={{ height: SCALE_BAR_HEIGHT, boxSizing: 'border-box' }}\n          />\n        }\n      />\n      {children}\n    </div>\n  )\n}\n\nexport default observer(TracksContainer)\n","import React, { useState, lazy } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  Button,\n  CircularProgress,\n  Container,\n  Grid,\n  makeStyles,\n} from '@material-ui/core'\nimport ErrorMessage from '@jbrowse/core/ui/ErrorMessage'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport AssemblySelector from '@jbrowse/core/ui/AssemblySelector'\nimport CloseIcon from '@material-ui/icons/Close'\n\n// locals\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { fetchResults } from './util'\nimport { LinearGenomeViewModel, WIDGET_HEIGHT } from '..'\nconst SearchResultsDialog = lazy(() => import('./SearchResultsDialog'))\n\nconst useStyles = makeStyles(theme => ({\n  importFormContainer: {\n    padding: theme.spacing(2),\n  },\n  button: {\n    margin: theme.spacing(2),\n  },\n  container: {\n    padding: theme.spacing(4),\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\nconst ImportForm = observer(({ model }: { model: LGV }) => {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { assemblyNames, assemblyManager, textSearchManager } = session\n  const { rankSearchResults, isSearchDialogDisplayed, error } = model\n  const [selectedAsm, setSelectedAsm] = useState(assemblyNames[0])\n  const [importError, setImportError] = useState(error)\n  const searchScope = model.searchScope(selectedAsm)\n\n  const assembly = assemblyManager.get(selectedAsm)\n  const assemblyError = assemblyNames.length\n    ? assembly?.error\n    : 'No configured assemblies'\n  const regions = assembly?.regions || []\n  const err = assemblyError || importError\n  const [myVal, setValue] = useState('')\n  const value = myVal || regions[0]?.refName\n\n  // use this instead of useState initializer because the useState initializer\n  // won't update in response to an observable\n  const option = new BaseResult({\n    label: value,\n  })\n\n  // gets a string as input, or use stored option results from previous query,\n  // then re-query and\n  // 1) if it has multiple results: pop a dialog\n  // 2) if it's a single result navigate to it\n  // 3) else assume it's a locstring and navigate to it\n  async function handleSelectedRegion(input: string) {\n    if (!option) {\n      return\n    }\n    let trackId = option.getTrackId()\n    let location = input || option.getLocation() || ''\n    const [ref, rest] = location.split(':')\n    const allRefs = assembly?.allRefNames || []\n    try {\n      // instead of querying text-index, first:\n      // - check if input matches a refname directly\n      // - or looks like locstring\n      // then just navigate as if it were a locstring\n      if (\n        allRefs.includes(location) ||\n        (allRefs.includes(ref) &&\n          rest !== undefined &&\n          !Number.isNaN(parseInt(rest, 10)))\n      ) {\n        model.navToLocString(location, selectedAsm)\n      } else {\n        const results = await fetchResults({\n          queryString: input,\n          searchType: 'exact',\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n        if (results.length > 1) {\n          model.setSearchResults(results, input.toLowerCase())\n          return\n        } else if (results.length === 1) {\n          location = results[0].getLocation()\n          trackId = results[0].getTrackId()\n        }\n\n        model.navToLocString(location, selectedAsm)\n        if (trackId) {\n          model.showTrack(trackId)\n        }\n      }\n    } catch (e) {\n      console.error(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n\n  const height = WIDGET_HEIGHT + 5\n\n  // implementation notes:\n  // having this wrapped in a form allows intuitive use of enter key to submit\n  return (\n    <div className={classes.container}>\n      {err ? <ErrorMessage error={err} /> : null}\n      <Container className={classes.importFormContainer}>\n        <form\n          onSubmit={event => {\n            event.preventDefault()\n            model.setError(undefined)\n            if (value) {\n              handleSelectedRegion(value)\n            }\n          }}\n        >\n          <Grid\n            container\n            spacing={1}\n            justifyContent=\"center\"\n            alignItems=\"center\"\n          >\n            <Grid item>\n              <AssemblySelector\n                onChange={val => {\n                  setImportError('')\n                  setSelectedAsm(val)\n                }}\n                session={session}\n                selected={selectedAsm}\n                InputProps={{ style: { height } }}\n              />\n            </Grid>\n            <Grid item>\n              {selectedAsm ? (\n                err ? (\n                  <CloseIcon style={{ color: 'red' }} />\n                ) : value ? (\n                  <RefNameAutocomplete\n                    fetchResults={queryString =>\n                      fetchResults({\n                        queryString,\n                        assembly,\n                        textSearchManager,\n                        rankSearchResults,\n                        searchScope,\n                      })\n                    }\n                    model={model}\n                    assemblyName={assemblyError ? undefined : selectedAsm}\n                    value={value}\n                    // note: minWidth 270 accomodates full width of helperText\n                    minWidth={270}\n                    onChange={str => setValue(str)}\n                    TextFieldProps={{\n                      variant: 'outlined',\n                      helperText:\n                        'Enter sequence name, feature name, or location',\n                      style: { minWidth: '175px' },\n                      InputProps: { style: { height } },\n                    }}\n                  />\n                ) : (\n                  <CircularProgress\n                    role=\"progressbar\"\n                    size={20}\n                    disableShrink\n                  />\n                )\n              ) : null}\n            </Grid>\n            <Grid item>\n              <Button\n                type=\"submit\"\n                disabled={!value}\n                className={classes.button}\n                variant=\"contained\"\n                color=\"primary\"\n              >\n                Open\n              </Button>\n              <Button\n                disabled={!value}\n                className={classes.button}\n                onClick={() => {\n                  model.setError(undefined)\n                  model.showAllRegionsInAssembly(selectedAsm)\n                }}\n                variant=\"contained\"\n                color=\"secondary\"\n              >\n                Show all regions in assembly\n              </Button>\n            </Grid>\n          </Grid>\n        </form>\n      </Container>\n      {isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          optAssemblyName={selectedAsm}\n          handleClose={() => model.setSearchResults(undefined, undefined)}\n        />\n      ) : null}\n    </div>\n  )\n})\n\nexport default ImportForm\n","import React, { useState } from 'react'\nimport { observer } from 'mobx-react'\nimport IconButton from '@material-ui/core/IconButton'\nimport ZoomIn from '@material-ui/icons/ZoomIn'\nimport ZoomOut from '@material-ui/icons/ZoomOut'\nimport ArrowDown from '@material-ui/icons/KeyboardArrowDown'\nimport Paper from '@material-ui/core/Paper'\nimport Menu from '@jbrowse/core/ui/Menu'\nimport { LinearGenomeViewModel } from '..'\n\nconst MiniControls = observer((props: { model: LinearGenomeViewModel }) => {\n  const { model } = props\n  const { bpPerPx, maxBpPerPx, minBpPerPx, scaleFactor } = model\n  const [anchorEl, setAnchorEl] = useState<HTMLElement>()\n\n  return (\n    <>\n      <Paper style={{ background: '#aaa7' }}>\n        <IconButton\n          color=\"secondary\"\n          onClick={event => {\n            setAnchorEl(event.currentTarget)\n          }}\n        >\n          <ArrowDown />\n        </IconButton>\n\n        <IconButton\n          data-testid=\"zoom_out\"\n          onClick={() => {\n            model.zoom(bpPerPx * 2)\n          }}\n          disabled={bpPerPx >= maxBpPerPx - 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomOut />\n        </IconButton>\n        <IconButton\n          data-testid=\"zoom_in\"\n          onClick={() => {\n            model.zoom(model.bpPerPx / 2)\n          }}\n          disabled={bpPerPx <= minBpPerPx + 0.0001 || scaleFactor !== 1}\n          color=\"secondary\"\n        >\n          <ZoomIn />\n        </IconButton>\n      </Paper>\n      <Menu\n        anchorEl={anchorEl}\n        open={Boolean(anchorEl)}\n        onMenuItemClick={(_, callback) => {\n          callback()\n          setAnchorEl(undefined)\n        }}\n        onClose={() => {\n          setAnchorEl(undefined)\n        }}\n        menuItems={model.menuItems()}\n      />\n    </>\n  )\n})\n\nexport default MiniControls\n","export interface SeqChunk {\n  header: string\n  seq: string\n}\n/**\n * Returns sequence with new line every 80 characters\n * ref https://stackoverflow.com/a/51506718/2129219\n *\n * @param seqString -  string\n * @returns formated sequence string\n */\nexport function formatFastaLines(seqString: string) {\n  return seqString.replace(/(.{1,80})/g, '$1\\n').trimEnd()\n}\n/**\n * Formats the sequences chunks into Fasta format\n *\n * @param chunks - array of seq chunks of the form `{ header: string, seq: string }`\n * @returns formatted sequence in fasta format\n */\nexport function formatSeqFasta(chunks: SeqChunk[]) {\n  return chunks\n    .map(chunk => `>${chunk.header}\\n${formatFastaLines(chunk.seq)}`)\n    .join('\\n')\n}\n","import React, { useEffect, useMemo, useState } from 'react'\n\nimport {\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Container,\n  Typography,\n  Divider,\n  IconButton,\n  TextField,\n  makeStyles,\n} from '@material-ui/core'\nimport { observer } from 'mobx-react'\nimport { saveAs } from 'file-saver'\nimport { Region } from '@jbrowse/core/util/types'\nimport { getConf } from '@jbrowse/core/configuration'\nimport copy from 'copy-to-clipboard'\nimport { getSession } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { formatSeqFasta } from '@jbrowse/core/util/formatFastaStrings'\n\n// icons\nimport { ContentCopy as ContentCopyIcon } from '@jbrowse/core/ui/Icons'\nimport CloseIcon from '@material-ui/icons/Close'\nimport GetAppIcon from '@material-ui/icons/GetApp'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  loadingMessage: {\n    padding: theme.spacing(5),\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n  dialogContent: {\n    width: '80em',\n  },\n  textAreaFont: {\n    fontFamily: 'Courier New',\n  },\n}))\n\ntype LGV = LinearGenomeViewModel\n\n/**\n * Fetches and returns a list features for a given list of regions\n */\nasync function fetchSequence(\n  model: LGV,\n  regions: Region[],\n  signal?: AbortSignal,\n) {\n  const session = getSession(model)\n  const { leftOffset, rightOffset } = model\n\n  if (!leftOffset || !rightOffset) {\n    throw new Error('no offsets on model to use for range')\n  }\n\n  if (leftOffset.assemblyName !== rightOffset.assemblyName) {\n    throw new Error('not able to fetch sequences from multiple assemblies')\n  }\n  const { rpcManager, assemblyManager } = session\n  const assemblyName = leftOffset.assemblyName || rightOffset.assemblyName || ''\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  const adapterConfig = getConf(assembly, ['sequence', 'adapter'])\n\n  const sessionId = 'getSequence'\n  return rpcManager.call(sessionId, 'CoreGetFeatures', {\n    adapterConfig,\n    regions,\n    sessionId,\n    signal,\n  }) as Promise<Feature[]>\n}\n\nfunction SequenceDialog({\n  model,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const [error, setError] = useState<unknown>()\n  const [sequence, setSequence] = useState<string>()\n  const loading = Boolean(sequence === undefined)\n  const { leftOffset, rightOffset } = model\n\n  // avoid infinite looping of useEffect\n  // random note: the current selected region can't be a computed because it\n  // uses action on base1dview even though it's on the ephemeral base1dview\n  const regionsSelected = useMemo(\n    () => model.getSelectedRegions(leftOffset, rightOffset),\n    [model, leftOffset, rightOffset],\n  )\n\n  useEffect(() => {\n    let active = true\n    const controller = new AbortController()\n\n    ;(async () => {\n      try {\n        if (regionsSelected.length > 0) {\n          const chunks = await fetchSequence(\n            model,\n            regionsSelected,\n            controller.signal,\n          )\n          if (active) {\n            setSequence(\n              formatSeqFasta(\n                chunks\n                  .filter(f => !!f)\n                  .map(chunk => {\n                    const chunkSeq = chunk.get('seq')\n                    const chunkRefName = chunk.get('refName')\n                    const chunkStart = chunk.get('start') + 1\n                    const chunkEnd = chunk.get('end')\n                    const chunkLocstring = `${chunkRefName}:${chunkStart}-${chunkEnd}`\n                    if (chunkSeq?.length !== chunkEnd - chunkStart + 1) {\n                      throw new Error(\n                        `${chunkLocstring} returned ${chunkSeq.length.toLocaleString()} bases, but should have returned ${(\n                          chunkEnd - chunkStart\n                        ).toLocaleString()}`,\n                      )\n                    }\n                    return { header: chunkLocstring, seq: chunkSeq }\n                  }),\n              ),\n            )\n          }\n        } else {\n          throw new Error('Selected region is out of bounds')\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          setError(e)\n        }\n      }\n    })()\n\n    return () => {\n      controller.abort()\n      active = false\n    }\n  }, [model, session, regionsSelected, setSequence])\n\n  const sequenceTooLarge = sequence ? sequence.length > 1_000_000 : false\n\n  return (\n    <Dialog\n      data-testid=\"sequence-dialog\"\n      maxWidth=\"xl\"\n      open\n      onClose={handleClose}\n      aria-labelledby=\"alert-dialog-title\"\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogTitle id=\"alert-dialog-title\">\n        Reference sequence\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-seqDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n              model.setOffsets(undefined, undefined)\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n\n      <DialogContent>\n        {error ? <Typography color=\"error\">{`${error}`}</Typography> : null}\n        {loading && !error ? (\n          <Container>\n            Retrieving reference sequence...\n            <CircularProgress\n              style={{\n                marginLeft: 10,\n              }}\n              size={20}\n              disableShrink\n            />\n          </Container>\n        ) : null}\n        <TextField\n          data-testid=\"rubberband-sequence\"\n          variant=\"outlined\"\n          multiline\n          minRows={5}\n          disabled={sequenceTooLarge}\n          className={classes.dialogContent}\n          fullWidth\n          value={\n            sequenceTooLarge\n              ? 'Reference sequence too large to display, use the download FASTA button'\n              : sequence\n          }\n          InputProps={{\n            readOnly: true,\n            classes: {\n              input: classes.textAreaFont,\n            },\n          }}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            copy(sequence || '')\n            session.notify('Copied to clipboard', 'success')\n          }}\n          disabled={loading || !!error || sequenceTooLarge}\n          color=\"primary\"\n          startIcon={<ContentCopyIcon />}\n        >\n          Copy to clipboard\n        </Button>\n        <Button\n          onClick={() => {\n            const seqFastaFile = new Blob([sequence || ''], {\n              type: 'text/x-fasta;charset=utf-8',\n            })\n            saveAs(seqFastaFile, 'jbrowse_ref_seq.fa')\n          }}\n          disabled={loading || !!error}\n          color=\"primary\"\n          startIcon={<GetAppIcon />}\n        >\n          Download FASTA\n        </Button>\n        <Button onClick={handleClose} color=\"primary\" autoFocus>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n\nexport default observer(SequenceDialog)\n","import React from 'react'\nimport { Button, Paper, Typography, makeStyles } from '@material-ui/core'\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport Header from './Header'\nimport TrackContainer from './TrackContainer'\nimport TracksContainer from './TracksContainer'\nimport ImportForm from './ImportForm'\nimport MiniControls from './MiniControls'\nimport SequenceDialog from './SequenceDialog'\nimport SearchResultsDialog from './SearchResultsDialog'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles(theme => ({\n  note: {\n    textAlign: 'center',\n    paddingTop: theme.spacing(1),\n    paddingBottom: theme.spacing(1),\n  },\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      animation: '$ellipsis 1.5s infinite',\n      content: '\".\"',\n      width: '1em',\n      textAlign: 'left',\n    },\n  },\n  '@keyframes ellipsis': {\n    '0%': {\n      content: '\".\"',\n    },\n    '33%': {\n      content: '\"..\"',\n    },\n    '66%': {\n      content: '\"...\"',\n    },\n  },\n}))\n\nconst LinearGenomeView = observer(({ model }: { model: LGV }) => {\n  const { tracks, error, hideHeader, initialized, hasDisplayedRegions } = model\n  const classes = useStyles()\n\n  if (!initialized && !error) {\n    return (\n      <Typography className={classes.dots} variant=\"h5\">\n        Loading\n      </Typography>\n    )\n  }\n  if (!hasDisplayedRegions || error) {\n    return <ImportForm model={model} />\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {model.seqDialogDisplayed ? (\n        <SequenceDialog\n          model={model}\n          handleClose={() => {\n            model.setSequenceDialogOpen(false)\n          }}\n        />\n      ) : null}\n      {model.isSearchDialogDisplayed ? (\n        <SearchResultsDialog\n          model={model}\n          handleClose={() => {\n            model.setSearchResults(undefined, undefined)\n          }}\n        />\n      ) : null}\n      {!hideHeader ? (\n        <Header model={model} />\n      ) : (\n        <div\n          style={{\n            position: 'absolute',\n            right: 0,\n            zIndex: 1001,\n          }}\n        >\n          <MiniControls model={model} />\n        </div>\n      )}\n      <TracksContainer model={model}>\n        {!tracks.length ? (\n          <Paper variant=\"outlined\" className={classes.note}>\n            {!model.hideNoTracksActive ? (\n              <>\n                <Typography>No tracks active.</Typography>\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={model.activateTrackSelector}\n                  style={{ zIndex: 1000 }}\n                  startIcon={<TrackSelectorIcon />}\n                >\n                  Open track selector\n                </Button>\n              </>\n            ) : (\n              <div style={{ height: '48px' }}></div>\n            )}\n          </Paper>\n        ) : (\n          tracks.map(track => (\n            <TrackContainer key={track.id} model={model} track={track} />\n          ))\n        )}\n      </TracksContainer>\n    </div>\n  )\n})\n\nexport default LinearGenomeView\n","import React, { useRef, useEffect, useState } from 'react'\nimport {\n  Popover,\n  Tooltip,\n  Typography,\n  makeStyles,\n  alpha,\n} from '@material-ui/core'\nimport { getSession, stringify } from '@jbrowse/core/util'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { LinearGenomeViewModel, HEADER_OVERVIEW_HEIGHT } from '..'\n\ntype LGV = LinearGenomeViewModel\n\nconst useStyles = makeStyles(theme => {\n  const { tertiary, primary } = theme.palette\n  const background = tertiary\n    ? alpha(tertiary.main, 0.7)\n    : alpha(primary.main, 0.7)\n  return {\n    rubberBand: {\n      height: '100%',\n      background,\n      position: 'absolute',\n      zIndex: 10,\n      textAlign: 'center',\n      overflow: 'hidden',\n    },\n    rubberBandControl: {\n      cursor: 'crosshair',\n      width: '100%',\n      minHeight: 8,\n    },\n    rubberBandText: {\n      color: tertiary ? tertiary.contrastText : primary.contrastText,\n    },\n    popover: {\n      mouseEvents: 'none',\n      cursor: 'crosshair',\n    },\n    paper: {\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n    },\n    guide: {\n      pointerEvents: 'none',\n      height: '100%',\n      width: 1,\n      position: 'absolute',\n      zIndex: 10,\n    },\n  }\n})\n\nconst HoverTooltip = observer(\n  ({\n    model,\n    open,\n    guideX,\n    overview,\n  }: {\n    model: LGV\n    open: boolean\n    guideX: number\n    overview: Base1DViewModel\n  }) => {\n    const classes = useStyles()\n    const { cytobandOffset } = model\n    const { assemblyManager } = getSession(model)\n\n    const px = overview.pxToBp(guideX - cytobandOffset)\n    const assembly = assemblyManager.get(px.assemblyName)\n    const cytoband = assembly?.cytobands?.find(\n      f =>\n        px.coord > f.get('start') &&\n        px.coord < f.get('end') &&\n        px.refName === assembly.getCanonicalRefName(f.get('refName')),\n    )\n\n    return (\n      <Tooltip\n        open={open}\n        placement=\"top\"\n        title={[stringify(px), cytoband?.get('name')].join(' ')}\n        arrow\n      >\n        <div\n          className={classes.guide}\n          style={{\n            left: guideX,\n          }}\n        />\n      </Tooltip>\n    )\n  },\n)\n\nfunction OverviewRubberBand({\n  model,\n  overview,\n  ControlComponent = <div />,\n}: {\n  model: LGV\n  overview: Base1DViewModel\n  ControlComponent?: React.ReactElement\n}) {\n  const { cytobandOffset } = model\n  const [startX, setStartX] = useState<number>()\n  const [currentX, setCurrentX] = useState<number>()\n  const [guideX, setGuideX] = useState<number>()\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const rubberBandRef = useRef(null)\n  const classes = useStyles()\n  const mouseDragging = startX !== undefined\n\n  useEffect(() => {\n    function globalMouseMove(event: MouseEvent) {\n      const ref = controlsRef.current\n      if (ref && mouseDragging) {\n        const relativeX = event.clientX - ref.getBoundingClientRect().left\n        setCurrentX(relativeX)\n      }\n    }\n\n    function globalMouseUp() {\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX !== undefined\n      ) {\n        if (Math.abs(currentX - startX) > 3) {\n          model.zoomToDisplayedRegions(\n            overview.pxToBp(startX - cytobandOffset),\n            overview.pxToBp(currentX - cytobandOffset),\n          )\n        }\n      }\n      /* handling clicking and centering at a specific Bp */\n      if (\n        controlsRef.current &&\n        startX !== undefined &&\n        currentX === undefined\n      ) {\n        const clickedAt = overview.pxToBp(startX - cytobandOffset)\n        model.centerAt(\n          Math.round(clickedAt.coord),\n          clickedAt.refName,\n          clickedAt.index,\n        )\n      }\n      setStartX(undefined)\n      setCurrentX(undefined)\n\n      if (startX !== undefined) {\n        setGuideX(undefined)\n      }\n    }\n\n    function globalKeyDown(event: KeyboardEvent) {\n      if (event.key === 'Escape') {\n        setStartX(undefined)\n        setCurrentX(undefined)\n      }\n    }\n\n    if (mouseDragging) {\n      window.addEventListener('mousemove', globalMouseMove, true)\n      window.addEventListener('mouseup', globalMouseUp, true)\n      window.addEventListener('keydown', globalKeyDown, true)\n      return () => {\n        window.removeEventListener('mousemove', globalMouseMove, true)\n        window.removeEventListener('mouseup', globalMouseUp, true)\n        window.removeEventListener('keydown', globalKeyDown, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, currentX, startX, model, overview, cytobandOffset])\n\n  function mouseDown(event: React.MouseEvent<HTMLDivElement>) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (controlsRef.current) {\n      setStartX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseMove(event: React.MouseEvent<HTMLDivElement>) {\n    if (controlsRef.current) {\n      setGuideX(\n        event.clientX - controlsRef.current.getBoundingClientRect().left,\n      )\n    }\n  }\n\n  function mouseOut() {\n    setGuideX(undefined)\n  }\n\n  if (startX === undefined) {\n    return (\n      <div style={{ position: 'relative' }}>\n        {guideX !== undefined ? (\n          <HoverTooltip\n            model={model}\n            open={!mouseDragging}\n            overview={overview}\n            guideX={guideX}\n          />\n        ) : null}\n        <div\n          className={classes.rubberBandControl}\n          role=\"presentation\"\n          ref={controlsRef}\n          onMouseDown={mouseDown}\n          onMouseOut={mouseOut}\n          onMouseMove={mouseMove}\n        >\n          {ControlComponent}\n        </div>\n      </div>\n    )\n  }\n\n  let left = startX || 0\n  let width = 0\n  if (startX !== undefined && currentX !== undefined) {\n    left = currentX < startX ? currentX : startX\n    width = currentX - startX\n  }\n  // calculate the start and end bp of drag\n  let leftBpOffset\n  let rightBpOffset\n  if (startX) {\n    leftBpOffset = overview.pxToBp(startX - cytobandOffset)\n    rightBpOffset = overview.pxToBp(startX + width - cytobandOffset)\n    if (currentX && currentX < startX) {\n      ;[leftBpOffset, rightBpOffset] = [rightBpOffset, leftBpOffset]\n    }\n  }\n\n  return (\n    <div style={{ position: 'relative' }}>\n      {rubberBandRef.current ? (\n        <>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'left',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'right',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {leftBpOffset ? stringify(leftBpOffset) : ''}\n            </Typography>\n          </Popover>\n          <Popover\n            className={classes.popover}\n            classes={{\n              paper: classes.paper,\n            }}\n            open\n            anchorEl={rubberBandRef.current}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            transformOrigin={{\n              vertical: 'bottom',\n              horizontal: 'left',\n            }}\n            keepMounted\n            disableRestoreFocus\n          >\n            <Typography>\n              {rightBpOffset ? stringify(rightBpOffset) : ''}\n            </Typography>\n          </Popover>\n        </>\n      ) : null}\n      <div\n        ref={rubberBandRef}\n        className={classes.rubberBand}\n        style={{\n          left,\n          width: Math.abs(width),\n          height: HEADER_OVERVIEW_HEIGHT,\n        }}\n      />\n      <div\n        data-testid=\"rubberBand_controls\"\n        className={classes.rubberBandControl}\n        role=\"presentation\"\n        ref={controlsRef}\n        onMouseDown={mouseDown}\n        onMouseOut={mouseOut}\n        onMouseMove={mouseMove}\n      >\n        {ControlComponent}\n      </div>\n    </div>\n  )\n}\n\nOverviewRubberBand.propTypes = {\n  model: MobxPropTypes.objectOrObservableObject.isRequired,\n  overview: MobxPropTypes.objectOrObservableObject.isRequired,\n  ControlComponent: ReactPropTypes.node,\n}\n\nOverviewRubberBand.defaultProps = {\n  ControlComponent: <div />,\n}\n\nexport default observer(OverviewRubberBand)\n","import React from 'react'\nimport { Typography, makeStyles, useTheme, alpha } from '@material-ui/core'\nimport { observer } from 'mobx-react'\nimport { Instance } from 'mobx-state-tree'\nimport clsx from 'clsx'\n\nimport Base1DView, { Base1DViewModel } from '@jbrowse/core/util/Base1DViewModel'\nimport { getSession, getTickDisplayStr } from '@jbrowse/core/util'\nimport { ContentBlock } from '@jbrowse/core/util/blockTypes'\nimport { Assembly } from '@jbrowse/core/assemblyManager/assembly'\n\n// locals\nimport {\n  LinearGenomeViewModel,\n  HEADER_BAR_HEIGHT,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { chooseGridPitch } from '../util'\nimport OverviewRubberBand from './OverviewRubberBand'\n\nconst wholeSeqSpacer = 2\n\nconst useStyles = makeStyles(theme => {\n  return {\n    scaleBar: {\n      height: HEADER_OVERVIEW_HEIGHT,\n    },\n    scaleBarBorder: {\n      border: '1px solid',\n    },\n    scaleBarContig: {\n      backgroundColor: theme.palette.background.default,\n      position: 'absolute',\n      top: 0,\n      height: HEADER_OVERVIEW_HEIGHT,\n    },\n    scaleBarContigForward: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n    scaleBarContigReverse: {\n      backgroundImage: `url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")`,\n      backgroundRepeat: 'repeat',\n    },\n\n    scaleBarRefName: {\n      position: 'absolute',\n      fontWeight: 'bold',\n      pointerEvents: 'none',\n      zIndex: 100,\n    },\n    scaleBarLabel: {\n      height: HEADER_OVERVIEW_HEIGHT,\n      position: 'absolute',\n      display: 'flex',\n      justifyContent: 'center',\n      pointerEvents: 'none',\n    },\n    scaleBarVisibleRegion: {\n      position: 'absolute',\n      height: HEADER_OVERVIEW_HEIGHT,\n      pointerEvents: 'none',\n      zIndex: 100,\n      border: '1px solid',\n    },\n    overview: {\n      height: HEADER_BAR_HEIGHT,\n      position: 'relative',\n    },\n    overviewSvg: {\n      width: '100%',\n      position: 'absolute',\n    },\n  }\n})\n\nconst Polygon = observer(\n  ({\n    model,\n    overview,\n    useOffset = true,\n  }: {\n    model: LGV\n    overview: Instance<Base1DViewModel>\n    useOffset?: boolean\n  }) => {\n    const theme = useTheme()\n    const multiplier = Number(useOffset)\n    const { interRegionPaddingWidth, offsetPx, dynamicBlocks, cytobandOffset } =\n      model\n    const { contentBlocks, totalWidthPxWithoutBorders } = dynamicBlocks\n    const { tertiary, primary } = theme.palette\n    const polygonColor = tertiary ? tertiary.light : primary.light\n\n    if (!contentBlocks.length) {\n      return null\n    }\n    const first = contentBlocks[0]\n    const last = contentBlocks[contentBlocks.length - 1]\n    const topLeft =\n      (overview.bpToPx({\n        ...first,\n        coord: first.reversed ? first.end : first.start,\n      }) || 0) +\n      cytobandOffset * multiplier\n    const topRight =\n      (overview.bpToPx({\n        ...last,\n        coord: last.reversed ? last.start : last.end,\n      }) || 0) +\n      cytobandOffset * multiplier\n\n    const startPx = Math.max(0, -offsetPx)\n    const endPx =\n      startPx +\n      totalWidthPxWithoutBorders +\n      (contentBlocks.length * interRegionPaddingWidth) / 2\n\n    const points = [\n      [startPx, HEADER_BAR_HEIGHT],\n      [endPx, HEADER_BAR_HEIGHT],\n      [topRight, 0],\n      [topLeft, 0],\n    ]\n\n    return (\n      <polygon\n        points={points.toString()}\n        fill={alpha(polygonColor, 0.3)}\n        stroke={alpha(polygonColor, 0.8)}\n      />\n    )\n  },\n)\n\ntype LGV = LinearGenomeViewModel\n\n// rounded rect from https://stackoverflow.com/a/45889603/2129219\n// prettier-ignore\nfunction rightRoundedRect(x: number, y: number, width: number, height: number, radius: number) {\n  return \"M\" + x + \",\" + y\n       + \"h\" + (width - radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + radius\n       + \"v\" + (height - 2 * radius)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + -radius + \",\" + radius\n       + \"h\" + (radius - width)\n       + \"z\";\n}\n\n// prettier-ignore\nfunction leftRoundedRect(x: number, y: number, width: number, height: number, radius: number ) {\n  return \"M\" + (x + radius) + \",\" + y\n       + \"h\" + (width - radius)\n       + \"v\" + height\n       + \"h\" + (radius - width)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + (-radius) + \",\" + (-radius)\n       + \"v\" + (2 * radius - height)\n       + \"a\" + radius + \",\" + radius + \" 0 0 1 \" + radius + \",\" + (-radius)\n       + \"z\";\n}\n\nconst colorMap: { [key: string]: string | undefined } = {\n  gneg: 'rgb(227,227,227)',\n  gpos25: 'rgb(142,142,142)',\n  gpos50: 'rgb(85,85,85)',\n  gpos100: 'rgb(0,0,0)',\n  gpos75: 'rgb(57,57,57)',\n  gvar: 'rgb(0,0,0)',\n  stalk: 'rgb(127,127,127)',\n  acen: '#800',\n}\n\nfunction getCytobands(assembly: Assembly | undefined, refName: string) {\n  return (\n    assembly?.cytobands\n      ?.map(f => ({\n        refName: assembly.getCanonicalRefName(f.get('refName')),\n        start: f.get('start'),\n        end: f.get('end'),\n        type: f.get('type'),\n      }))\n      .filter(f => f.refName === refName) || []\n  )\n}\n\nconst Cytobands = observer(\n  ({\n    overview,\n    block,\n    assembly,\n  }: {\n    overview: Base1DViewModel\n    assembly?: Assembly\n    block: ContentBlock\n  }) => {\n    const { offsetPx, reversed } = block\n    const cytobands = getCytobands(assembly, block.refName)\n    const coords = cytobands.map(f => {\n      const { refName, start, end, type } = f\n      return [\n        overview.bpToPx({\n          refName,\n          coord: start,\n        }),\n        overview.bpToPx({\n          refName,\n          coord: end,\n        }),\n        type,\n      ]\n    })\n\n    const arr = cytobands || []\n    const lcap = reversed ? arr.length - 1 : 0\n    const rcap = reversed ? 0 : arr.length - 1\n\n    let firstCent = true\n    return (\n      <g transform={`translate(-${offsetPx})`}>\n        {coords.map(([start, end, type], index) => {\n          const key = `${start}-${end}-${type}`\n          if (type === 'acen' && firstCent) {\n            firstCent = false\n            return (\n              <polygon\n                key={key}\n                points={[\n                  [start, 0],\n                  [end, HEADER_OVERVIEW_HEIGHT / 2],\n                  [start, HEADER_OVERVIEW_HEIGHT],\n                ].toString()}\n                fill={colorMap[type]}\n              />\n            )\n          }\n          if (type === 'acen' && !firstCent) {\n            return (\n              <polygon\n                key={key}\n                points={[\n                  [start, HEADER_OVERVIEW_HEIGHT / 2],\n                  [end, 0],\n                  [end, HEADER_OVERVIEW_HEIGHT],\n                ].toString()}\n                fill={colorMap[type]}\n              />\n            )\n          }\n\n          if (lcap === index) {\n            return (\n              <path\n                key={key}\n                d={leftRoundedRect(\n                  Math.min(start, end),\n                  0,\n                  Math.abs(end - start),\n                  HEADER_OVERVIEW_HEIGHT,\n                  8,\n                )}\n                fill={colorMap[type]}\n              />\n            )\n          } else if (rcap === index) {\n            return (\n              <path\n                key={key}\n                d={rightRoundedRect(\n                  Math.min(start, end),\n                  0,\n                  Math.abs(end - start) - 2,\n                  HEADER_OVERVIEW_HEIGHT,\n                  8,\n                )}\n                fill={colorMap[type]}\n              />\n            )\n          } else {\n            return (\n              <rect\n                key={key}\n                x={Math.min(start, end)}\n                y={0}\n                width={Math.abs(end - start)}\n                height={HEADER_OVERVIEW_HEIGHT}\n                fill={colorMap[type]}\n              />\n            )\n          }\n        })}\n      </g>\n    )\n  },\n)\n\nconst OverviewBox = observer(\n  ({\n    scale,\n    model,\n    block,\n    overview,\n  }: {\n    scale: number\n    model: LGV\n    block: ContentBlock\n    overview: Base1DViewModel\n  }) => {\n    const classes = useStyles()\n    const { cytobandOffset, bpPerPx, showCytobands } = model\n    const { start, end, reversed, refName, assemblyName } = block\n    const { majorPitch } = chooseGridPitch(scale, 120, 15)\n    const { assemblyManager } = getSession(model)\n    const assembly = assemblyManager.get(assemblyName)\n    const refNameColor = assembly?.getRefNameColor(refName)\n\n    const tickLabels = []\n    for (let i = 0; i < Math.floor((end - start) / majorPitch); i++) {\n      const offsetLabel = (i + 1) * majorPitch\n      tickLabels.push(reversed ? end - offsetLabel : start + offsetLabel)\n    }\n\n    const canDisplayCytobands =\n      showCytobands && getCytobands(assembly, block.refName).length\n\n    return (\n      <div>\n        {/* name of sequence */}\n        <Typography\n          style={{\n            left: block.offsetPx + 3,\n            color: canDisplayCytobands ? 'black' : refNameColor,\n          }}\n          className={classes.scaleBarRefName}\n        >\n          {refName}\n        </Typography>\n        <div\n          className={clsx(\n            classes.scaleBarContig,\n            canDisplayCytobands\n              ? undefined\n              : reversed\n              ? classes.scaleBarContigReverse\n              : classes.scaleBarContigForward,\n            !canDisplayCytobands ? classes.scaleBarBorder : undefined,\n          )}\n          style={{\n            left: block.offsetPx + cytobandOffset,\n            width: block.widthPx,\n            borderColor: refNameColor,\n          }}\n        >\n          {!canDisplayCytobands\n            ? tickLabels.map((tickLabel, labelIdx) => (\n                <Typography\n                  key={`${JSON.stringify(block)}-${tickLabel}-${labelIdx}`}\n                  className={classes.scaleBarLabel}\n                  variant=\"body2\"\n                  style={{\n                    left: ((labelIdx + 1) * majorPitch) / scale,\n                    pointerEvents: 'none',\n                    color: refNameColor,\n                  }}\n                >\n                  {getTickDisplayStr(tickLabel, bpPerPx)}\n                </Typography>\n              ))\n            : null}\n\n          {canDisplayCytobands ? (\n            <svg style={{ width: '100%' }}>\n              <Cytobands\n                overview={overview}\n                assembly={assembly}\n                block={block}\n              />\n            </svg>\n          ) : null}\n        </div>\n      </div>\n    )\n  },\n)\n\nconst ScaleBar = observer(\n  ({\n    model,\n    scale,\n    overview,\n  }: {\n    model: LGV\n    overview: Base1DViewModel\n    scale: number\n  }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n    const { dynamicBlocks, showCytobands, cytobandOffset } = model\n    const visibleRegions = dynamicBlocks.contentBlocks\n    const overviewVisibleRegions = overview.dynamicBlocks\n    const { tertiary, primary } = theme.palette\n    const scaleBarColor = tertiary ? tertiary.light : primary.light\n\n    if (!visibleRegions.length) {\n      return null\n    }\n    const first = visibleRegions[0]\n    const firstOverviewPx =\n      overview.bpToPx({\n        ...first,\n        coord: first.reversed ? first.end : first.start,\n      }) || 0\n\n    const last = visibleRegions[visibleRegions.length - 1]\n    const lastOverviewPx =\n      overview.bpToPx({\n        ...last,\n        coord: last.reversed ? last.start : last.end,\n      }) || 0\n\n    const color = showCytobands ? '#f00' : scaleBarColor\n    const transparency = showCytobands ? 0.1 : 0.3\n\n    return (\n      <div className={classes.scaleBar}>\n        <div\n          className={classes.scaleBarVisibleRegion}\n          style={{\n            width: lastOverviewPx - firstOverviewPx,\n            left: firstOverviewPx + cytobandOffset,\n            background: alpha(color, transparency),\n            borderColor: color,\n          }}\n        />\n        {/* this is the entire scale bar */}\n        {overviewVisibleRegions.map((block, idx) => {\n          return !(block instanceof ContentBlock) ? (\n            <div\n              key={`${JSON.stringify(block)}-${idx}`}\n              className={classes.scaleBarContig}\n              style={{\n                width: block.widthPx,\n                left: block.offsetPx,\n                backgroundColor: '#999',\n                backgroundImage:\n                  'repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)',\n              }}\n            />\n          ) : (\n            <OverviewBox\n              scale={scale}\n              block={block}\n              model={model}\n              overview={overview}\n              key={`${JSON.stringify(block)}-${idx}`}\n            />\n          )\n        })}\n      </div>\n    )\n  },\n)\n\nfunction OverviewScaleBar({\n  model,\n  children,\n}: {\n  model: LGV\n  children: React.ReactNode\n}) {\n  const classes = useStyles()\n  const { totalBp, width, cytobandOffset, displayedRegions } = model\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n\n  const modWidth = width - cytobandOffset\n  overview.setVolatileWidth(modWidth)\n  overview.showAllRegions()\n\n  const scale =\n    totalBp / (modWidth - (displayedRegions.length - 1) * wholeSeqSpacer)\n\n  return (\n    <div>\n      <OverviewRubberBand\n        model={model}\n        overview={overview}\n        ControlComponent={\n          <ScaleBar model={model} overview={overview} scale={scale} />\n        }\n      />\n      <div className={classes.overview}>\n        <svg height={HEADER_BAR_HEIGHT} className={classes.overviewSvg}>\n          <Polygon model={model} overview={overview} />\n        </svg>\n        {children}\n      </div>\n    </div>\n  )\n}\n\nexport default observer(OverviewScaleBar)\n\nexport { Cytobands, Polygon }\n","import React, { Suspense, lazy, useMemo, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { getSession, useDebounce, measureText } from '@jbrowse/core/util'\nimport BaseResult, {\n  RefSequenceResult,\n} from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  CircularProgress,\n  IconButton,\n  InputAdornment,\n  Popper,\n  PopperProps,\n  TextField,\n  TextFieldProps as TFP,\n  Typography,\n} from '@material-ui/core'\n\n// icons\nimport SearchIcon from '@material-ui/icons/Search'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport HelpIcon from '@material-ui/icons/Help'\n\n// locals\nimport { LinearGenomeViewModel } from '..'\nimport { dedupe } from './util'\n\n// lazy\nconst HelpDialog = lazy(() => import('./HelpDialog'))\n\nexport interface Option {\n  group?: string\n  result: BaseResult\n}\n\n// the logic of this method is to only apply a filter to RefSequenceResults\n// because they do not have a matchedObject. the trix search results already\n// filter so don't need re-filtering\nfunction filterOptions(options: Option[], searchQuery: string) {\n  return options.filter(option => {\n    const { result } = option\n    return (\n      result.getLabel().toLowerCase().includes(searchQuery) ||\n      result.matchedObject\n    )\n  })\n}\n\n// MyPopper used to expand search results box wider if needed\n// xref https://stackoverflow.com/a/63583835/2129219\nconst MyPopper = function (\n  props: PopperProps & { style?: { width?: unknown } },\n) {\n  const { style } = props\n  return (\n    <Popper\n      {...props}\n      style={{\n        width: 'fit-content',\n        minWidth: Math.min(+(style?.width || 0), 200),\n        background: 'white',\n      }}\n      placement=\"bottom-start\"\n    />\n  )\n}\n\nfunction RefNameAutocomplete({\n  model,\n  onSelect,\n  assemblyName,\n  style,\n  fetchResults,\n  onChange,\n  value,\n  showHelp = true,\n  minWidth = 200,\n  TextFieldProps = {},\n}: {\n  model: LinearGenomeViewModel\n  onSelect?: (region: BaseResult) => void\n  onChange?: (val: string) => void\n  assemblyName?: string\n  value?: string\n  fetchResults: (query: string) => Promise<BaseResult[]>\n  style?: React.CSSProperties\n  minWidth?: number\n  showHelp?: boolean\n  TextFieldProps?: TFP\n}) {\n  const session = getSession(model)\n  const { assemblyManager } = session\n  const [open, setOpen] = useState(false)\n  const [loaded, setLoaded] = useState(true)\n  const [isHelpDialogDisplayed, setHelpDialogDisplayed] = useState(false)\n  const [currentSearch, setCurrentSearch] = useState('')\n  const [inputValue, setInputValue] = useState('')\n  const [searchOptions, setSearchOptions] = useState<Option[]>()\n  const debouncedSearch = useDebounce(currentSearch, 300)\n  const { coarseVisibleLocStrings, hasDisplayedRegions } = model\n  const assembly = assemblyName ? assemblyManager.get(assemblyName) : undefined\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const regions = assembly?.regions || []\n\n  const options = useMemo(\n    () =>\n      regions.map(option => ({\n        result: new RefSequenceResult({\n          refName: option.refName,\n          label: option.refName,\n          matchedAttribute: 'refName',\n        }),\n      })),\n    [regions],\n  )\n\n  useEffect(() => {\n    let active = true\n\n    ;(async () => {\n      try {\n        if (debouncedSearch === '' || !assemblyName) {\n          return\n        }\n\n        setLoaded(false)\n        const results = await fetchResults(debouncedSearch)\n        if (active) {\n          setSearchOptions(\n            dedupe(results, r => r.getDisplayString()).map(result => ({\n              result,\n            })),\n          )\n          setLoaded(true)\n        }\n      } catch (e) {\n        console.error(e)\n        if (active) {\n          session.notify(`${e}`, 'error')\n        }\n      }\n    })()\n\n    return () => {\n      active = false\n    }\n  }, [assemblyName, fetchResults, debouncedSearch, session, model])\n\n  const inputBoxVal = coarseVisibleLocStrings || value || ''\n\n  // heuristic, text width + icon width\n  // + 45 accomodates help icon and search icon\n  const width = Math.min(\n    Math.max(measureText(inputBoxVal, 16) + 45, minWidth),\n    550,\n  )\n\n  // notes on implementation:\n  // The selectOnFocus setting helps highlight the field when clicked\n  return (\n    <>\n      <Autocomplete\n        id={`refNameAutocomplete-${model.id}`}\n        data-testid=\"autocomplete\"\n        disableListWrap\n        disableClearable\n        PopperComponent={MyPopper}\n        disabled={!assemblyName}\n        freeSolo\n        includeInputInList\n        selectOnFocus\n        style={{ ...style, width }}\n        value={inputBoxVal}\n        loading={!loaded}\n        inputValue={inputValue}\n        onInputChange={(event, newInputValue) => {\n          setInputValue(newInputValue)\n          onChange?.(newInputValue)\n        }}\n        loadingText=\"loading results\"\n        open={open}\n        onOpen={() => setOpen(true)}\n        onClose={() => {\n          setOpen(false)\n          setLoaded(true)\n          if (hasDisplayedRegions) {\n            setCurrentSearch('')\n            setSearchOptions(undefined)\n          }\n        }}\n        onChange={(_event, selectedOption) => {\n          if (!selectedOption || !assemblyName) {\n            return\n          }\n\n          if (typeof selectedOption === 'string') {\n            // handles string inputs on keyPress enter\n            onSelect?.(new BaseResult({ label: selectedOption }))\n          } else {\n            onSelect?.(selectedOption.result)\n          }\n          setInputValue(inputBoxVal)\n        }}\n        options={!searchOptions?.length ? options : searchOptions}\n        getOptionDisabled={option => option?.group === 'limitOption'}\n        filterOptions={(options, params) => {\n          const filtered = filterOptions(\n            options,\n            params.inputValue.toLocaleLowerCase(),\n          )\n          return [\n            ...filtered.slice(0, 100),\n            ...(filtered.length > 100\n              ? [\n                  {\n                    group: 'limitOption',\n                    result: new BaseResult({\n                      label: 'keep typing for more results',\n                    }),\n                  },\n                ]\n              : []),\n          ]\n        }}\n        renderInput={params => {\n          const { helperText, InputProps = {} } = TextFieldProps\n          return (\n            <TextField\n              onBlur={() => {\n                // this is used to restore a refName or the non-user-typed input\n                // to the box on blurring\n                setInputValue(inputBoxVal)\n              }}\n              {...params}\n              {...TextFieldProps}\n              helperText={helperText}\n              InputProps={{\n                ...params.InputProps,\n                ...InputProps,\n\n                endAdornment: (\n                  <>\n                    {regions.length === 0 ? (\n                      <CircularProgress color=\"inherit\" size={20} />\n                    ) : (\n                      <InputAdornment position=\"end\" style={{ marginRight: 7 }}>\n                        <SearchIcon />\n                        {showHelp ? (\n                          <IconButton\n                            onClick={() => setHelpDialogDisplayed(true)}\n                          >\n                            <HelpIcon />\n                          </IconButton>\n                        ) : null}\n                      </InputAdornment>\n                    )}\n                    {params.InputProps.endAdornment}\n                  </>\n                ),\n              }}\n              placeholder=\"Search for location\"\n              onChange={e => {\n                setCurrentSearch(e.target.value)\n              }}\n            />\n          )\n        }}\n        renderOption={option => {\n          const { result } = option\n          const component = result.getRenderingComponent()\n          if (component && React.isValidElement(component)) {\n            return component\n          }\n\n          return <Typography noWrap>{result.getDisplayString()}</Typography>\n        }}\n        getOptionLabel={option =>\n          (typeof option === 'string' ? option : option.result.getLabel()) || ''\n        }\n      />\n      {isHelpDialogDisplayed ? (\n        <Suspense fallback={<div />}>\n          <HelpDialog handleClose={() => setHelpDialogDisplayed(false)} />\n        </Suspense>\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(RefNameAutocomplete)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles, useTheme, alpha } from '@material-ui/core'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { getSession } from '@jbrowse/core/util'\n\n// locals\nimport RefNameAutocomplete from './RefNameAutocomplete'\nimport { fetchResults } from './util'\nimport { LinearGenomeViewModel, SPACING, WIDGET_HEIGHT } from '..'\n\nconst useStyles = makeStyles(() => ({\n  headerRefName: {\n    minWidth: 100,\n  },\n}))\n\nfunction SearchBox({\n  model,\n  showHelp,\n}: {\n  showHelp?: boolean\n  model: LinearGenomeViewModel\n}) {\n  const classes = useStyles()\n  const theme = useTheme()\n  const session = getSession(model)\n\n  const { textSearchManager, assemblyManager } = session\n  const { assemblyNames, rankSearchResults } = model\n  const assemblyName = assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n  const searchScope = model.searchScope(assemblyName)\n\n  // gets a string as input, or use stored option results from previous query,\n  // then re-query and\n  // 1) if it has multiple results: pop a dialog\n  // 2) if it's a single result navigate to it\n  // 3) else assume it's a locstring and navigate to it\n  async function handleSelectedRegion(option: BaseResult) {\n    let trackId = option.getTrackId()\n    let location = option.getLocation()\n    const label = option.getLabel()\n    const [ref, rest] = location.split(':')\n    const allRefs = assembly?.allRefNames || []\n    try {\n      // instead of querying text-index, first:\n      // - check if input matches a refName directly\n      // - or looks like locString\n      // then just navigate as if it were a locString\n      if (\n        allRefs.includes(location) ||\n        (allRefs.includes(ref) &&\n          rest !== undefined &&\n          !Number.isNaN(parseInt(rest, 10)))\n      ) {\n        model.navToLocString(location, assemblyName)\n      } else {\n        const results = await fetchResults({\n          queryString: label,\n          searchType: 'exact',\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n        if (results.length > 1) {\n          model.setSearchResults(results, label.toLowerCase())\n          return\n        } else if (results.length === 1) {\n          location = results[0].getLocation()\n          trackId = results[0].getTrackId()\n        }\n\n        model.navToLocString(location, assemblyName)\n        if (trackId) {\n          model.showTrack(trackId)\n        }\n      }\n    } catch (e) {\n      console.error(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n  return (\n    <RefNameAutocomplete\n      showHelp={showHelp}\n      onSelect={handleSelectedRegion}\n      assemblyName={assemblyName}\n      fetchResults={queryString =>\n        fetchResults({\n          queryString,\n          searchScope,\n          rankSearchResults,\n          textSearchManager,\n          assembly,\n        })\n      }\n      model={model}\n      TextFieldProps={{\n        variant: 'outlined',\n        className: classes.headerRefName,\n        style: { margin: SPACING, minWidth: '175px' },\n        InputProps: {\n          style: {\n            padding: 0,\n            height: WIDGET_HEIGHT,\n            background: alpha(theme.palette.background.paper, 0.8),\n          },\n        },\n      }}\n    />\n  )\n}\n\nexport default observer(SearchBox)\n","import React from 'react'\nimport { getEnv, resolveIdentifier, getRoot } from 'mobx-state-tree'\nimport { getSession } from '@jbrowse/core/util'\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  IconButton,\n  Table,\n  TableBody,\n  TableCell,\n  TableContainer,\n  TableHead,\n  TableRow,\n  Typography,\n  Paper,\n  makeStyles,\n} from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { LinearGenomeViewModel } from '../..'\n\nexport const useStyles = makeStyles(theme => ({\n  dialogContent: {\n    width: '80em',\n  },\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nexport default function SearchResultsDialog({\n  model,\n  optAssemblyName,\n  handleClose,\n}: {\n  model: LinearGenomeViewModel\n  optAssemblyName?: string\n  handleClose: () => void\n}) {\n  const classes = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(session)\n  const { assemblyManager } = session\n  let assemblyName = optAssemblyName\n  if (model.displayedRegions.length > 0) {\n    assemblyName = model.displayedRegions[0]?.assemblyName\n  }\n  if (!assemblyName) {\n    throw new Error(`Assembly name not found`)\n  }\n  const assembly = assemblyManager.get(assemblyName)\n  if (!assembly) {\n    throw new Error(`assembly ${assemblyName} not found`)\n  }\n  if (!assembly.regions) {\n    throw new Error(`assembly ${assemblyName} regions not loaded`)\n  }\n  const assemblyRegions = assembly.regions\n\n  function handleClick(location: string) {\n    try {\n      const newRegion = assemblyRegions.find(\n        region => location === region.refName,\n      )\n      if (newRegion) {\n        model.setDisplayedRegions([newRegion])\n        // we use showAllRegions after setDisplayedRegions to make the entire\n        // region visible, xref #1703\n        model.showAllRegions()\n      } else {\n        model.navToLocString(location, assemblyName)\n      }\n    } catch (e) {\n      console.warn(e)\n      session.notify(`${e}`, 'warning')\n    }\n  }\n\n  function getTrackName(trackId: string | undefined) {\n    if (trackId) {\n      const trackConfigSchema = pluginManager.pluggableConfigSchemaType('track')\n      const configuration = resolveIdentifier(\n        trackConfigSchema,\n        getRoot(model),\n        trackId,\n      )\n      if (configuration) {\n        return configuration.name?.value\n      }\n    }\n    return ''\n  }\n\n  return (\n    <Dialog open maxWidth=\"xl\" onClose={handleClose}>\n      <DialogTitle>\n        Search results\n        {handleClose ? (\n          <IconButton\n            data-testid=\"close-resultsDialog\"\n            className={classes.closeButton}\n            onClick={() => {\n              handleClose()\n            }}\n          >\n            <CloseIcon />\n          </IconButton>\n        ) : null}\n      </DialogTitle>\n      <Divider />\n      <DialogContent>\n        {!model.searchResults?.length ? (\n          <Typography>\n            No results found for <b>{model.searchQuery}</b>\n          </Typography>\n        ) : (\n          <>\n            <Typography>\n              Showing results for <b>{model.searchQuery}</b>\n            </Typography>\n            <TableContainer component={Paper}>\n              <Table>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>Name</TableCell>\n                    <TableCell align=\"right\">Location</TableCell>\n                    <TableCell align=\"right\">Track</TableCell>\n                    <TableCell align=\"right\" />\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {model.searchResults.map(result => (\n                    <TableRow key={`${result.getId()}`}>\n                      <TableCell component=\"th\" scope=\"row\">\n                        {result.getLabel()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {result.getLocation()}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        {getTrackName(result.getTrackId()) || 'N/A'}\n                      </TableCell>\n                      <TableCell align=\"right\">\n                        <Button\n                          onClick={() => {\n                            handleClick(result.getLocation())\n                            const resultTrackId = result.getTrackId()\n                            if (resultTrackId) {\n                              model.showTrack(resultTrackId)\n                            }\n                            handleClose()\n                          }}\n                          color=\"primary\"\n                          variant=\"contained\"\n                        >\n                          Go\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </TableContainer>\n          </>\n        )}\n      </DialogContent>\n      <Divider />\n      <DialogActions>\n        <Button onClick={() => handleClose()} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { Assembly } from '@jbrowse/core/assemblyManager/assembly'\nimport { SearchType } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { SearchScope } from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { TextSearchManager } from '@jbrowse/core/util'\n\nexport function dedupe(\n  results: BaseResult[] = [],\n  cb: (result: BaseResult) => string,\n) {\n  return results.filter(\n    (elt, idx, self) => idx === self.findIndex(t => cb(t) === cb(elt)),\n  )\n}\n\nexport async function fetchResults({\n  queryString,\n  searchType,\n  searchScope,\n  rankSearchResults,\n  textSearchManager,\n  assembly,\n}: {\n  queryString: string\n  searchScope: SearchScope\n  rankSearchResults: (results: BaseResult[]) => BaseResult[]\n  searchType?: SearchType\n  textSearchManager?: TextSearchManager\n  assembly?: Assembly\n}) {\n  if (!textSearchManager) {\n    console.warn('No text search manager')\n  }\n\n  const textSearchResults = await textSearchManager?.search(\n    {\n      queryString,\n      searchType,\n    },\n    searchScope,\n    rankSearchResults,\n  )\n\n  const refNameResults = assembly?.allRefNames\n    ?.filter(ref => ref.toLowerCase().startsWith(queryString.toLowerCase()))\n    .slice(0, 10)\n    .map(r => new BaseResult({ label: r }))\n\n  return dedupe(\n    [...(refNameResults || []), ...(textSearchResults || [])],\n    elt => elt.getId(),\n  )\n}\n","import { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport { makeTicks } from '../util'\n\nfunction mathPower(num: number): string {\n  if (num < 999) {\n    return String(num)\n  }\n  return `${mathPower(~~(num / 1000))},${`00${~~(num % 1000)}`.substr(-3, 3)}`\n}\n\nconst useStyles = makeStyles((/* theme */) => ({\n  majorTickLabel: {\n    fontSize: '11px',\n    // fill: theme.palette.text.primary,\n  },\n  majorTick: {\n    stroke: '#555',\n    // stroke: theme.palette.text.secondary,\n  },\n  minorTick: {\n    stroke: '#999',\n    // stroke: theme.palette.text.hint,\n  },\n}))\n\nfunction Ruler({\n  start,\n  end,\n  bpPerPx,\n  reversed,\n  major,\n  minor,\n}: {\n  start: number\n  end: number\n  bpPerPx: number\n  reversed?: boolean\n  major: boolean\n  minor: boolean\n}) {\n  const classes = useStyles()\n  const ticks = makeTicks(start, end, bpPerPx, major, minor)\n  return (\n    <>\n      {ticks.map(tick => {\n        const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n        return (\n          <line\n            key={tick.base}\n            x1={x}\n            x2={x}\n            y1={0}\n            y2={tick.type === 'major' ? 6 : 4}\n            strokeWidth={1}\n            stroke={tick.type === 'major' ? '#555' : '#999'}\n            className={\n              tick.type === 'major' ? classes.majorTick : classes.minorTick\n            }\n            data-bp={tick.base}\n          />\n        )\n      })}\n      {ticks\n        .filter(tick => tick.type === 'major')\n        .map(tick => {\n          const x = (reversed ? end - tick.base : tick.base - start) / bpPerPx\n          return (\n            <text\n              x={x - 3}\n              y={7 + 11}\n              key={`label-${tick.base}`}\n              style={{ fontSize: '11px' }}\n              className={classes.majorTickLabel}\n            >\n              {mathPower(tick.base + 1)}\n            </text>\n          )\n        })}\n    </>\n  )\n}\n\nRuler.propTypes = {\n  start: ReactPropTypes.number.isRequired,\n  end: ReactPropTypes.number.isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  reversed: ReactPropTypes.bool,\n  major: ReactPropTypes.bool,\n  minor: ReactPropTypes.bool,\n}\n\nRuler.defaultProps = {\n  reversed: false,\n  major: true,\n  minor: true,\n}\n\nexport default observer(Ruler)\n","import React from 'react'\nimport { renderToStaticMarkup } from 'react-dom/server'\nimport { when } from 'mobx'\nimport { getParent } from 'mobx-state-tree'\nimport { getConf, readConfObject } from '@jbrowse/core/configuration'\nimport { getSession, getBpDisplayStr } from '@jbrowse/core/util'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\n\n// locals\nimport Ruler from './Ruler'\nimport {\n  LinearGenomeViewModel,\n  ExportSvgOptions,\n  HEADER_OVERVIEW_HEIGHT,\n} from '..'\nimport { Polygon, Cytobands } from './OverviewScaleBar'\n\ntype LGV = LinearGenomeViewModel\n\nfunction ScaleBar({ model, fontSize }: { model: LGV; fontSize: number }) {\n  const {\n    offsetPx,\n    dynamicBlocks: { totalWidthPxWithoutBorders: totalWidthPx, totalBp },\n  } = model\n  const displayBp = getBpDisplayStr(totalBp)\n  const x0 = Math.max(-offsetPx, 0)\n  const x1 = x0 + totalWidthPx\n  return (\n    <>\n      <line x1={x0} x2={x1} y1={10} y2={10} stroke=\"black\" />\n      <line x1={x0} x2={x0} y1={5} y2={15} stroke=\"black\" />\n      <line x1={x1} x2={x1} y1={5} y2={15} stroke=\"black\" />\n      <text\n        x={x0 + (x1 - x0) / 2}\n        y={fontSize * 2}\n        textAnchor=\"middle\"\n        fontSize={fontSize}\n      >\n        {displayBp}\n      </text>\n    </>\n  )\n}\n\nfunction SVGRuler({\n  model,\n  fontSize,\n  width,\n}: {\n  model: LGV\n  fontSize: number\n  width: number\n}) {\n  const {\n    dynamicBlocks: { contentBlocks },\n    offsetPx: viewOffsetPx,\n    bpPerPx,\n  } = model\n  const renderRuler = contentBlocks.length < 5\n  return (\n    <>\n      <defs>\n        <clipPath id=\"clip-ruler\">\n          <rect x={0} y={0} width={width} height={20} />\n        </clipPath>\n      </defs>\n      {contentBlocks.map(block => {\n        const { key, start, end, reversed, offsetPx, refName } = block\n        const offsetLeft = offsetPx - viewOffsetPx\n        return (\n          <g key={`${key}`} transform={`translate(${offsetLeft} 0)`}>\n            <text x={offsetLeft / bpPerPx} y={fontSize} fontSize={fontSize}>\n              {refName}\n            </text>\n            {renderRuler ? (\n              <g transform=\"translate(0 20)\" clipPath=\"url(#clip-ruler)\">\n                <Ruler\n                  start={start}\n                  end={end}\n                  bpPerPx={bpPerPx}\n                  reversed={reversed}\n                />\n              </g>\n            ) : (\n              <line\n                strokeWidth={1}\n                stroke=\"black\"\n                x1={start / bpPerPx}\n                x2={end / bpPerPx}\n                y1={20}\n                y2={20}\n              />\n            )}\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\nconst fontSize = 15\nconst rulerHeight = 50\nconst textHeight = fontSize + 5\nconst paddingHeight = 20\nconst headerHeight = textHeight + 20\nconst cytobandHeightIfExists = 100\n\ninterface Display {\n  height: number\n}\ninterface Track {\n  displays: Display[]\n}\n\nconst totalHeight = (tracks: Track[]) => {\n  return tracks.reduce((accum, track) => {\n    const display = track.displays[0]\n    return accum + display.height + paddingHeight + textHeight\n  }, 0)\n}\n\n// SVG component, ruler and assembly name\nconst SVGHeader = ({ model }: { model: LGV }) => {\n  const { width, assemblyNames, showCytobands, displayedRegions } = model\n  const { assemblyManager } = getSession(model)\n  const assemblyName = assemblyNames.length > 1 ? '' : assemblyNames[0]\n  const assembly = assemblyManager.get(assemblyName)\n\n  const overview = Base1DView.create({\n    displayedRegions: JSON.parse(JSON.stringify(displayedRegions)),\n    interRegionPaddingWidth: 0,\n    minimumBlockWidth: model.minimumBlockWidth,\n  })\n  const visibleRegions = model.dynamicBlocks.contentBlocks\n\n  overview.setVolatileWidth(width)\n  overview.showAllRegions()\n  const block = overview.dynamicBlocks.contentBlocks[0]\n\n  const first = visibleRegions[0]\n  const firstOverviewPx =\n    overview.bpToPx({\n      ...first,\n      coord: first.reversed ? first.end : first.start,\n    }) || 0\n\n  const last = visibleRegions[visibleRegions.length - 1]\n  const lastOverviewPx =\n    overview.bpToPx({\n      ...last,\n      coord: last.reversed ? last.start : last.end,\n    }) || 0\n\n  const cytobandHeight = showCytobands ? cytobandHeightIfExists : 0\n\n  return (\n    <g id=\"header\">\n      <text x={0} y={fontSize} fontSize={fontSize}>\n        {assemblyName}\n      </text>\n\n      {showCytobands ? (\n        <g transform={`translate(0 ${rulerHeight})`}>\n          <Cytobands overview={overview} assembly={assembly} block={block} />\n          <rect\n            stroke=\"red\"\n            fill=\"rgb(255,0,0,0.1)\"\n            width={Math.max(lastOverviewPx - firstOverviewPx, 0.5)}\n            height={HEADER_OVERVIEW_HEIGHT - 1}\n            x={firstOverviewPx}\n            y={0.5}\n          />\n          <g transform={`translate(0,${HEADER_OVERVIEW_HEIGHT})`}>\n            <Polygon overview={overview} model={model} useOffset={false} />\n          </g>\n        </g>\n      ) : null}\n\n      <g transform={`translate(0 ${fontSize + cytobandHeight})`}>\n        <ScaleBar model={model} fontSize={fontSize} />\n      </g>\n      <g transform={`translate(0 ${rulerHeight + cytobandHeight})`}>\n        <SVGRuler model={model} fontSize={fontSize} width={width} />\n      </g>\n    </g>\n  )\n}\n\n// SVG component, region separator\nconst SVGRegionSeparators = ({\n  model,\n  height,\n}: {\n  height: number\n  model: LGV\n}) => {\n  const { dynamicBlocks, offsetPx, interRegionPaddingWidth } = model\n  return (\n    <>\n      {dynamicBlocks.contentBlocks.slice(1).map(block => (\n        <rect\n          key={block.key}\n          x={block.offsetPx - offsetPx - interRegionPaddingWidth}\n          width={interRegionPaddingWidth}\n          y={0}\n          height={height}\n          stroke=\"none\"\n          fill=\"grey\"\n        />\n      ))}\n    </>\n  )\n}\n\n// SVG component, tracks\nfunction SVGTracks({\n  displayResults,\n  model,\n  offset,\n}: {\n  displayResults: {\n    track: {\n      configuration: AnyConfigurationModel\n      displays: { height: number }[]\n    }\n    result: string\n  }[]\n  model: LGV\n  offset: number\n}) {\n  return (\n    <>\n      {displayResults.map(({ track, result }) => {\n        const current = offset\n        const trackName =\n          getConf(track, 'name') ||\n          `Reference sequence (${readConfObject(\n            getParent(track.configuration),\n            'name',\n          )})`\n        const display = track.displays[0]\n        offset += display.height + paddingHeight + textHeight\n        return (\n          <g\n            key={track.configuration.trackId}\n            transform={`translate(0 ${current})`}\n          >\n            <text fontSize={fontSize} x={Math.max(-model.offsetPx, 0)}>\n              {trackName}\n            </text>\n            <g transform={`translate(0 ${textHeight})`}>\n              {result}\n              <SVGRegionSeparators model={model} height={display.height} />\n            </g>\n          </g>\n        )\n      })}\n    </>\n  )\n}\n\n// render LGV to SVG\nexport async function renderToSvg(model: LGV, opts: ExportSvgOptions) {\n  await when(() => model.initialized)\n  const { width, tracks, showCytobands } = model\n  const shift = 50\n  const offset =\n    headerHeight +\n    rulerHeight +\n    (showCytobands ? cytobandHeightIfExists : 0) +\n    20\n  const height = totalHeight(tracks) + offset\n  const displayResults = await Promise.all(\n    tracks.map(async track => {\n      const display = track.displays[0]\n      await when(() => (display.ready !== undefined ? display.ready : true))\n      const result = await display.renderSvg(opts)\n      return { track, result }\n    }),\n  )\n\n  // the xlink namespace is used for rendering <image> tag\n  return renderToStaticMarkup(\n    <svg\n      width={width}\n      height={height}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      viewBox={[0, 0, width + shift * 2, height].toString()}\n    >\n      {/* background white */}\n      <rect width={width + shift * 2} height={height} fill=\"white\" />\n\n      <g stroke=\"none\" transform={`translate(${shift} ${fontSize})`}>\n        <SVGHeader model={model} />\n        <SVGTracks\n          model={model}\n          displayResults={displayResults}\n          offset={offset}\n        />\n      </g>\n    </svg>,\n  )\n}\n","import React, { useState } from 'react'\nimport {\n  Button,\n  Checkbox,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControlLabel,\n  IconButton,\n  TextField,\n  Typography,\n  makeStyles,\n} from '@material-ui/core'\nimport { ErrorMessage } from '@jbrowse/core/ui'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { LinearGenomeViewModel as LGV } from '..'\n\nconst useStyles = makeStyles(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction LoadingMessage() {\n  return (\n    <div>\n      <CircularProgress size={20} style={{ marginRight: 20 }} />\n      <Typography display=\"inline\">Creating SVG</Typography>\n    </div>\n  )\n}\n\nexport default function ExportSvgDlg({\n  model,\n  handleClose,\n}: {\n  model: LGV\n  handleClose: () => void\n}) {\n  // @ts-ignore\n  const offscreenCanvas = typeof OffscreenCanvas !== 'undefined'\n  const [rasterizeLayers, setRasterizeLayers] = useState(offscreenCanvas)\n  const [loading, setLoading] = useState(false)\n  const [filename, setFilename] = useState('jbrowse.svg')\n  const [error, setError] = useState<unknown>()\n  const classes = useStyles()\n  return (\n    <Dialog open onClose={handleClose}>\n      <DialogTitle>\n        Export SVG\n        <IconButton className={classes.closeButton} onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </DialogTitle>\n      <DialogContent>\n        {error ? (\n          <ErrorMessage error={error} />\n        ) : loading ? (\n          <LoadingMessage />\n        ) : null}\n        <TextField\n          helperText=\"filename\"\n          value={filename}\n          onChange={event => setFilename(event.target.value)}\n        />\n        {offscreenCanvas ? (\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={rasterizeLayers}\n                onChange={() => setRasterizeLayers(val => !val)}\n              />\n            }\n            label=\"Rasterize canvas based tracks? File may be much larger if this is turned off\"\n          />\n        ) : (\n          <Typography>\n            Note: rasterizing layers not yet supported in this browser, so SVG\n            size may be large\n          </Typography>\n        )}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={() => handleClose()}\n        >\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          type=\"submit\"\n          onClick={async () => {\n            setLoading(true)\n            setError(undefined)\n            try {\n              await model.exportSvg({ rasterizeLayers, filename })\n              handleClose()\n            } catch (e) {\n              console.error(e)\n              setError(e)\n              setLoading(false)\n            }\n          }}\n        >\n          Submit\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import { getConf, AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { Region } from '@jbrowse/core/util/types'\nimport { ElementId, Region as MUIRegion } from '@jbrowse/core/util/types/mst'\nimport { MenuItem, ReturnToImportFormDialog } from '@jbrowse/core/ui'\nimport {\n  assembleLocString,\n  clamp,\n  findLastIndex,\n  getContainingView,\n  getSession,\n  isViewContainer,\n  isSessionModelWithWidgets,\n  measureText,\n  parseLocString,\n  springAnimate,\n  viewBpToPx,\n} from '@jbrowse/core/util'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport { BlockSet, BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport calculateDynamicBlocks from '@jbrowse/core/util/calculateDynamicBlocks'\nimport calculateStaticBlocks from '@jbrowse/core/util/calculateStaticBlocks'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { transaction, autorun } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getRoot,\n  resolveIdentifier,\n  types,\n  Instance,\n} from 'mobx-state-tree'\n\nimport Base1DView from '@jbrowse/core/util/Base1DViewModel'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport clone from 'clone'\nimport { saveAs } from 'file-saver'\n\n// icons\nimport { TrackSelector as TrackSelectorIcon } from '@jbrowse/core/ui/Icons'\nimport SyncAltIcon from '@material-ui/icons/SyncAlt'\nimport VisibilityIcon from '@material-ui/icons/Visibility'\nimport LabelIcon from '@material-ui/icons/Label'\nimport FolderOpenIcon from '@material-ui/icons/FolderOpen'\nimport PhotoCameraIcon from '@material-ui/icons/PhotoCamera'\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\n\n// locals\nimport { renderToSvg } from './components/LinearGenomeViewSvg'\nimport RefNameAutocomplete from './components/RefNameAutocomplete'\nimport SearchBox from './components/SearchBox'\nimport ExportSvgDlg from './components/ExportSvgDialog'\n\nexport interface BpOffset {\n  refName?: string\n  index: number\n  offset: number\n  start?: number\n  end?: number\n  coord?: number\n  reversed?: boolean\n  assemblyName?: string\n  oob?: boolean\n}\n\nexport interface ExportSvgOptions {\n  rasterizeLayers?: boolean\n  filename?: string\n}\n\nfunction calculateVisibleLocStrings(contentBlocks: BaseBlock[]) {\n  if (!contentBlocks.length) {\n    return ''\n  }\n  const isSingleAssemblyName = contentBlocks.every(\n    block => block.assemblyName === contentBlocks[0].assemblyName,\n  )\n  const locs = contentBlocks.map(block =>\n    assembleLocString({\n      ...block,\n      start: Math.round(block.start),\n      end: Math.round(block.end),\n      assemblyName: isSingleAssemblyName ? undefined : block.assemblyName,\n    }),\n  )\n  return locs.join(' ')\n}\n\nexport interface NavLocation {\n  refName: string\n  start?: number\n  end?: number\n  assemblyName?: string\n}\n\nexport const HEADER_BAR_HEIGHT = 48\nexport const HEADER_OVERVIEW_HEIGHT = 20\nexport const SCALE_BAR_HEIGHT = 17\nexport const RESIZE_HANDLE_HEIGHT = 3\nexport const INTER_REGION_PADDING_WIDTH = 2\nexport const SPACING = 7\nexport const WIDGET_HEIGHT = 32\n\nfunction localStorageGetItem(item: string) {\n  return typeof localStorage !== 'undefined'\n    ? localStorage.getItem(item)\n    : undefined\n}\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseViewModel,\n      types.model('LinearGenomeView', {\n        id: ElementId,\n        type: types.literal('LinearGenomeView'),\n        offsetPx: 0,\n        bpPerPx: 1,\n        displayedRegions: types.array(MUIRegion),\n\n        // we use an array for the tracks because the tracks are displayed in a\n        // specific order that we need to keep.\n        tracks: types.array(\n          pluginManager.pluggableMstType('track', 'stateModel'),\n        ),\n        hideHeader: false,\n        hideHeaderOverview: false,\n        hideNoTracksActive: false,\n        trackSelectorType: types.optional(\n          types.enumeration(['hierarchical']),\n          'hierarchical',\n        ),\n        trackLabels: types.optional(\n          types.string,\n          () => localStorageGetItem('lgv-trackLabels') || 'overlapping',\n        ),\n        showCenterLine: types.optional(types.boolean, () => {\n          const setting = localStorageGetItem('lgv-showCenterLine')\n          return setting !== undefined && setting !== null ? !!+setting : false\n        }),\n        showCytobandsSetting: types.optional(types.boolean, () => {\n          const setting = localStorageGetItem('lgv-showCytobands')\n          return setting !== undefined && setting !== null ? !!+setting : true\n        }),\n      }),\n    )\n    .volatile(() => ({\n      volatileWidth: undefined as number | undefined,\n      minimumBlockWidth: 3,\n      draggingTrackId: undefined as undefined | string,\n      volatileError: undefined as undefined | Error,\n\n      // array of callbacks to run after the next set of the displayedRegions,\n      // which is basically like an onLoad\n      afterDisplayedRegionsSetCallbacks: [] as Function[],\n      scaleFactor: 1,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      trackRefs: {} as { [key: string]: any },\n      coarseDynamicBlocks: [] as BaseBlock[],\n      coarseTotalBp: 0,\n      leftOffset: undefined as undefined | BpOffset,\n      rightOffset: undefined as undefined | BpOffset,\n      searchResults: undefined as undefined | BaseResult[],\n      searchQuery: undefined as undefined | string,\n      seqDialogDisplayed: false,\n    }))\n    .views(self => ({\n      get width(): number {\n        if (self.volatileWidth === undefined) {\n          throw new Error(\n            'width undefined, make sure to check for model.initialized',\n          )\n        }\n        return self.volatileWidth\n      },\n      get interRegionPaddingWidth() {\n        return INTER_REGION_PADDING_WIDTH\n      },\n\n      get assemblyNames() {\n        return [\n          ...new Set(self.displayedRegions.map(region => region.assemblyName)),\n        ]\n      },\n    }))\n    .views(self => ({\n      get assemblyErrors() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames\n          .map(a => assemblyManager.get(a)?.error)\n          .filter(f => !!f)\n          .join(', ')\n      },\n\n      get assembliesInitialized() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames.every(a => assemblyManager.get(a)?.initialized)\n      },\n      get initialized() {\n        return self.volatileWidth !== undefined && this.assembliesInitialized\n      },\n      get hasDisplayedRegions() {\n        return self.displayedRegions.length > 0\n      },\n      get isSearchDialogDisplayed() {\n        return self.searchResults !== undefined\n      },\n      get scaleBarHeight() {\n        return SCALE_BAR_HEIGHT + RESIZE_HANDLE_HEIGHT\n      },\n      get headerHeight() {\n        if (self.hideHeader) {\n          return 0\n        }\n        if (self.hideHeaderOverview) {\n          return HEADER_BAR_HEIGHT\n        }\n        return HEADER_BAR_HEIGHT + HEADER_OVERVIEW_HEIGHT\n      },\n      get trackHeights() {\n        return self.tracks\n          .map(t => t.displays[0].height)\n          .reduce((a, b) => a + b, 0)\n      },\n\n      get trackHeightsWithResizeHandles() {\n        return this.trackHeights + self.tracks.length * RESIZE_HANDLE_HEIGHT\n      },\n      get height() {\n        return (\n          this.trackHeightsWithResizeHandles +\n          this.headerHeight +\n          this.scaleBarHeight\n        )\n      },\n      get totalBp() {\n        return self.displayedRegions.reduce((a, b) => a + b.end - b.start, 0)\n      },\n\n      get maxBpPerPx() {\n        return this.totalBp / (self.width * 0.9)\n      },\n\n      get minBpPerPx() {\n        return 1 / 50\n      },\n\n      get error() {\n        return self.volatileError || this.assemblyErrors\n      },\n\n      get maxOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const leftPadding = 10\n        return this.displayedRegionsTotalPx - leftPadding\n      },\n\n      get minOffset() {\n        // objectively determined to keep the linear genome on the main screen\n        const rightPadding = 30\n        return -self.width + rightPadding\n      },\n\n      get displayedRegionsTotalPx() {\n        return this.totalBp / self.bpPerPx\n      },\n\n      renderProps() {\n        return {\n          ...getParentRenderProps(self),\n          bpPerPx: self.bpPerPx,\n          highResolutionScaling: getConf(\n            getSession(self),\n            'highResolutionScaling',\n          ),\n        }\n      },\n\n      searchScope(assemblyName: string) {\n        return {\n          assemblyName,\n          includeAggregateIndexes: true,\n          tracks: self.tracks,\n        }\n      },\n\n      bpToPx({\n        refName,\n        coord,\n        regionNumber,\n      }: {\n        refName: string\n        coord: number\n        regionNumber?: number\n      }) {\n        return viewBpToPx({ refName, coord, regionNumber, self })\n      },\n      /**\n       *\n       * @param px - px in the view area, return value is the displayed regions\n       * @returns BpOffset of the displayed region that it lands in\n       */\n      pxToBp(px: number) {\n        let bpSoFar = 0\n        const bp = (self.offsetPx + px) * self.bpPerPx\n        const n = self.displayedRegions.length\n        if (bp < 0) {\n          const region = self.displayedRegions[0]\n          const offset = bp\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            offset,\n            index: 0,\n          }\n        }\n\n        const interRegionPaddingBp = self.interRegionPaddingWidth * self.bpPerPx\n        const minimumBlockBp = self.minimumBlockWidth * self.bpPerPx\n\n        for (let index = 0; index < self.displayedRegions.length; index += 1) {\n          const region = self.displayedRegions[index]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar\n          if (len + bpSoFar > bp && bpSoFar <= bp) {\n            return {\n              ...getSnapshot(region),\n              oob: false,\n              offset,\n              coord: region.reversed\n                ? Math.floor(region.end - offset) + 1\n                : Math.floor(region.start + offset) + 1,\n              index,\n            }\n          }\n\n          // add the interRegionPaddingWidth if the boundary is in the screen\n          // e.g. offset>0 && offset<width\n          if (\n            region.end - region.start > minimumBlockBp &&\n            offset / self.bpPerPx > 0 &&\n            offset / self.bpPerPx < self.width\n          ) {\n            bpSoFar += len + interRegionPaddingBp\n          } else {\n            bpSoFar += len\n          }\n        }\n\n        if (bp >= bpSoFar) {\n          const region = self.displayedRegions[n - 1]\n          const len = region.end - region.start\n          const offset = bp - bpSoFar + len\n          return {\n            ...getSnapshot(region),\n            oob: true,\n            offset,\n            coord: region.reversed\n              ? Math.floor(region.end - offset) + 1\n              : Math.floor(region.start + offset) + 1,\n            index: n - 1,\n          }\n        }\n        return {\n          coord: 0,\n          index: 0,\n          refName: '',\n          oob: true,\n          assemblyName: '',\n          offset: 0,\n          start: 0,\n          end: 0,\n          reversed: false,\n        }\n      },\n\n      getTrack(id: string) {\n        return self.tracks.find(t => t.configuration.trackId === id)\n      },\n\n      rankSearchResults(results: BaseResult[]) {\n        // order of rank\n        const openTrackIds = self.tracks.map(\n          track => track.configuration.trackId,\n        )\n        results.forEach(result => {\n          if (openTrackIds.includes(result.trackId)) {\n            result.updateScore(result.getScore() + 1)\n          }\n        })\n        return results\n      },\n\n      // modifies view menu action onClick to apply to all tracks of same type\n      rewriteOnClicks(trackType: string, viewMenuActions: MenuItem[]) {\n        viewMenuActions.forEach(action => {\n          // go to lowest level menu\n          if ('subMenu' in action) {\n            this.rewriteOnClicks(trackType, action.subMenu)\n          }\n          if ('onClick' in action) {\n            const holdOnClick = action.onClick\n            action.onClick = (...args: unknown[]) => {\n              self.tracks.forEach(track => {\n                if (track.type === trackType) {\n                  holdOnClick.apply(track, [track, ...args])\n                }\n              })\n            }\n          }\n        })\n      },\n\n      get trackTypeActions() {\n        const allActions: Map<string, MenuItem[]> = new Map()\n        self.tracks.forEach(track => {\n          const trackInMap = allActions.get(track.type)\n          if (!trackInMap) {\n            const viewMenuActions = clone(track.viewMenuActions)\n            this.rewriteOnClicks(track.type, viewMenuActions)\n            allActions.set(track.type, viewMenuActions)\n          }\n        })\n\n        return allActions\n      },\n\n      get centerLineInfo() {\n        return self.displayedRegions.length\n          ? this.pxToBp(self.width / 2)\n          : undefined\n      },\n    }))\n    .actions(self => ({\n      setShowCytobands(flag: boolean) {\n        self.showCytobandsSetting = flag\n        localStorage.setItem('lgv-showCytobands', `${+flag}`)\n      },\n      setWidth(newWidth: number) {\n        self.volatileWidth = newWidth\n      },\n      setError(error: Error | undefined) {\n        self.volatileError = error\n      },\n\n      toggleHeader() {\n        self.hideHeader = !self.hideHeader\n      },\n\n      toggleHeaderOverview() {\n        self.hideHeaderOverview = !self.hideHeaderOverview\n      },\n      toggleNoTracksActive() {\n        self.hideNoTracksActive = !self.hideNoTracksActive\n      },\n\n      scrollTo(offsetPx: number) {\n        const newOffsetPx = clamp(offsetPx, self.minOffset, self.maxOffset)\n        self.offsetPx = newOffsetPx\n        return newOffsetPx\n      },\n\n      zoomTo(bpPerPx: number) {\n        const newBpPerPx = clamp(bpPerPx, self.minBpPerPx, self.maxBpPerPx)\n        if (newBpPerPx === self.bpPerPx) {\n          return newBpPerPx\n        }\n        const oldBpPerPx = self.bpPerPx\n        self.bpPerPx = newBpPerPx\n\n        if (Math.abs(oldBpPerPx - newBpPerPx) < 0.000001) {\n          console.warn('zoomTo bpPerPx rounding error')\n          return oldBpPerPx\n        }\n\n        // tweak the offset so that the center of the view remains at the same coordinate\n        const viewWidth = self.width\n        this.scrollTo(\n          Math.round(\n            ((self.offsetPx + viewWidth / 2) * oldBpPerPx) / newBpPerPx -\n              viewWidth / 2,\n          ),\n        )\n        return newBpPerPx\n      },\n\n      setOffsets(left: undefined | BpOffset, right: undefined | BpOffset) {\n        // sets offsets used in the get sequence dialog\n        self.leftOffset = left\n        self.rightOffset = right\n      },\n\n      setSearchResults(\n        results: BaseResult[] | undefined,\n        query: string | undefined,\n      ) {\n        self.searchResults = results\n        self.searchQuery = query\n      },\n\n      setSequenceDialogOpen(open: boolean) {\n        self.seqDialogDisplayed = open\n      },\n\n      setNewView(bpPerPx: number, offsetPx: number) {\n        this.zoomTo(bpPerPx)\n        this.scrollTo(offsetPx)\n      },\n\n      horizontallyFlip() {\n        self.displayedRegions = cast(\n          self.displayedRegions\n            .slice()\n            .reverse()\n            .map(region => ({ ...region, reversed: !region.reversed })),\n        )\n        this.scrollTo(self.totalBp / self.bpPerPx - self.offsetPx - self.width)\n      },\n\n      showTrack(\n        trackId: string,\n        initialSnapshot = {},\n        displayInitialSnapshot = {},\n      ) {\n        const trackConfigSchema =\n          pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        if (!configuration) {\n          throw new Error(`Could not resolve identifier \"${trackId}\"`)\n        }\n        const trackType = pluginManager.getTrackType(configuration?.type)\n        if (!trackType) {\n          throw new Error(`Unknown track type ${configuration.type}`)\n        }\n        const viewType = pluginManager.getViewType(self.type)\n        const supportedDisplays = viewType.displayTypes.map(\n          displayType => displayType.name,\n        )\n        const displayConf = configuration.displays.find(\n          (d: AnyConfigurationModel) => supportedDisplays.includes(d.type),\n        )\n        if (!displayConf) {\n          throw new Error(\n            `Could not find a compatible display for view type ${self.type}`,\n          )\n        }\n\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        if (shownTracks.length === 0) {\n          const track = trackType.stateModel.create({\n            ...initialSnapshot,\n            type: configuration.type,\n            configuration,\n            displays: [\n              {\n                type: displayConf.type,\n                configuration: displayConf,\n                ...displayInitialSnapshot,\n              },\n            ],\n          })\n          self.tracks.push(track)\n          return track\n        }\n        return shownTracks[0]\n      },\n\n      hideTrack(trackId: string) {\n        const trackConfigSchema =\n          pluginManager.pluggableConfigSchemaType('track')\n        const configuration = resolveIdentifier(\n          trackConfigSchema,\n          getRoot(self),\n          trackId,\n        )\n        // if we have any tracks with that configuration, turn them off\n        const shownTracks = self.tracks.filter(\n          t => t.configuration === configuration,\n        )\n        transaction(() => shownTracks.forEach(t => self.tracks.remove(t)))\n        return shownTracks.length\n      },\n    }))\n    .actions(self => ({\n      moveTrack(movingTrackId: string, targetTrackId: string) {\n        const oldIndex = self.tracks.findIndex(\n          track => track.id === movingTrackId,\n        )\n        if (oldIndex === -1) {\n          throw new Error(`Track ID ${movingTrackId} not found`)\n        }\n        const newIndex = self.tracks.findIndex(\n          track => track.id === targetTrackId,\n        )\n        if (newIndex === -1) {\n          throw new Error(`Track ID ${targetTrackId} not found`)\n        }\n        const track = getSnapshot(self.tracks[oldIndex])\n        self.tracks.splice(oldIndex, 1)\n        self.tracks.splice(newIndex, 0, track)\n      },\n\n      closeView() {\n        const parent = getContainingView(self)\n        if (parent) {\n          // I am embedded in a some other view\n          if (isViewContainer(parent)) {\n            parent.removeView(self)\n          }\n        } else {\n          // I am part of a session\n          getSession(self).removeView(self)\n        }\n      },\n\n      toggleTrack(trackId: string) {\n        // if we have any tracks with that configuration, turn them off\n        const hiddenCount = self.hideTrack(trackId)\n        // if none had that configuration, turn one on\n        if (!hiddenCount) {\n          self.showTrack(trackId)\n        }\n      },\n\n      setTrackLabels(setting: 'overlapping' | 'offset' | 'hidden') {\n        self.trackLabels = setting\n        localStorage.setItem('lgv-trackLabels', setting)\n      },\n\n      toggleCenterLine() {\n        self.showCenterLine = !self.showCenterLine\n        localStorage.setItem('lgv-showCenterLine', `${+self.showCenterLine}`)\n      },\n\n      setDisplayedRegions(regions: Region[]) {\n        self.displayedRegions = cast(regions)\n        self.zoomTo(self.bpPerPx)\n      },\n\n      activateTrackSelector() {\n        if (self.trackSelectorType === 'hierarchical') {\n          const session = getSession(self)\n          if (isSessionModelWithWidgets(session)) {\n            const selector = session.addWidget(\n              'HierarchicalTrackSelectorWidget',\n              'hierarchicalTrackSelector',\n              { view: self },\n            )\n            session.showWidget(selector)\n            return selector\n          }\n        }\n        throw new Error(`invalid track selector type ${self.trackSelectorType}`)\n      },\n\n      navToLocString(locString: string, optAssemblyName?: string) {\n        const { assemblyNames } = self\n        const { assemblyManager } = getSession(self)\n        const { isValidRefName } = assemblyManager\n        const assemblyName = optAssemblyName || assemblyNames[0]\n        let parsedLocStrings\n        const inputs = locString\n          .split(/(\\s+)/)\n          .map(f => f.trim())\n          .filter(f => !!f)\n\n        // first try interpreting as a whitespace-separated sequence of\n        // multiple locstrings\n        try {\n          parsedLocStrings = inputs.map(l =>\n            parseLocString(l, ref => isValidRefName(ref, assemblyName)),\n          )\n        } catch (e) {\n          // if this fails, try interpreting as a whitespace-separated refname,\n          // start, end if start and end are integer inputs\n          const [refName, start, end] = inputs\n          if (\n            `${e}`.match(/Unknown reference sequence/) &&\n            Number.isInteger(+start) &&\n            Number.isInteger(+end)\n          ) {\n            parsedLocStrings = [\n              parseLocString(refName + ':' + start + '..' + end, ref =>\n                isValidRefName(ref, assemblyName),\n              ),\n            ]\n          } else {\n            throw e\n          }\n        }\n\n        const locations = parsedLocStrings?.map(region => {\n          const asmName = region.assemblyName || assemblyName\n          const asm = assemblyManager.get(asmName)\n          const { refName } = region\n          if (!asm) {\n            throw new Error(`assembly ${asmName} not found`)\n          }\n          const { regions } = asm\n          if (!regions) {\n            throw new Error(`regions not loaded yet for ${asmName}`)\n          }\n          const canonicalRefName = asm.getCanonicalRefName(region.refName)\n          if (!canonicalRefName) {\n            throw new Error(`Could not find refName ${refName} in ${asm.name}`)\n          }\n          const parentRegion = regions.find(\n            region => region.refName === canonicalRefName,\n          )\n          if (!parentRegion) {\n            throw new Error(`Could not find refName ${refName} in ${asmName}`)\n          }\n\n          return {\n            ...region,\n            assemblyName: asmName,\n            parentRegion,\n          }\n        })\n\n        if (locations.length === 1) {\n          const loc = locations[0]\n          this.setDisplayedRegions([\n            { reversed: loc.reversed, ...loc.parentRegion },\n          ])\n          const { start, end, parentRegion } = loc\n\n          this.navTo({\n            ...loc,\n            start: clamp(start ?? 0, 0, parentRegion.end),\n            end: clamp(end ?? parentRegion.end, 0, parentRegion.end),\n          })\n        } else {\n          this.setDisplayedRegions(\n            // @ts-ignore\n            locations.map(r => (r.start === undefined ? r.parentRegion : r)),\n          )\n          this.showAllRegions()\n        }\n      },\n\n      /**\n       * Navigate to a location based on its refName and optionally start, end,\n       * and assemblyName. Can handle if there are multiple displayedRegions\n       * from same refName. Only navigates to a location if it is entirely\n       * within a displayedRegion. Navigates to the first matching location\n       * encountered.\n       *\n       * Throws an error if navigation was unsuccessful\n       *\n       * @param location - a proposed location to navigate to\n       */\n      navTo(query: NavLocation) {\n        this.navToMultiple([query])\n      },\n\n      navToMultiple(locations: NavLocation[]) {\n        const firstLocation = locations[0]\n        let { refName } = firstLocation\n        const {\n          start,\n          end,\n          assemblyName = self.assemblyNames[0],\n        } = firstLocation\n\n        if (start !== undefined && end !== undefined && start > end) {\n          throw new Error(`start \"${start + 1}\" is greater than end \"${end}\"`)\n        }\n        const session = getSession(self)\n        const { assemblyManager } = session\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const canonicalRefName = assembly.getCanonicalRefName(refName)\n          if (canonicalRefName) {\n            refName = canonicalRefName\n          }\n        }\n        let s = start\n        let e = end\n        let refNameMatched = false\n        const predicate = (r: Region) => {\n          if (refName === r.refName) {\n            refNameMatched = true\n            if (s === undefined) {\n              s = r.start\n            }\n            if (e === undefined) {\n              e = r.end\n            }\n            if (s >= r.start && s <= r.end && e <= r.end && e >= r.start) {\n              return true\n            }\n            s = start\n            e = end\n          }\n          return false\n        }\n\n        const lastIndex = findLastIndex(self.displayedRegions, predicate)\n        let index\n        while (index !== lastIndex) {\n          try {\n            const previousIndex: number | undefined = index\n            index = self.displayedRegions\n              .slice(previousIndex === undefined ? 0 : previousIndex + 1)\n              .findIndex(predicate)\n            if (previousIndex !== undefined) {\n              index += previousIndex + 1\n            }\n            if (!refNameMatched) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\"`,\n              )\n            }\n            if (s === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained an end position ${e}`,\n              )\n            }\n            if (e === undefined) {\n              throw new Error(\n                `could not find a region with refName \"${refName}\" that contained a start position ${\n                  s + 1\n                }`,\n              )\n            }\n            if (index === -1) {\n              throw new Error(\n                `could not find a region that completely contained \"${assembleLocString(\n                  firstLocation,\n                )}\"`,\n              )\n            }\n            if (locations.length === 1) {\n              const f = self.displayedRegions[index]\n              this.moveTo(\n                { index, offset: f.reversed ? f.end - e : s - f.start },\n                { index, offset: f.reversed ? f.end - s : e - f.start },\n              )\n              return\n            }\n            let locationIndex = 0\n            let locationStart = 0\n            let locationEnd = 0\n            for (\n              locationIndex;\n              locationIndex < locations.length;\n              locationIndex++\n            ) {\n              const location = locations[locationIndex]\n              const region = self.displayedRegions[index + locationIndex]\n              locationStart = location.start || region.start\n              locationEnd = location.end || region.end\n              if (location.refName !== region.refName) {\n                throw new Error(\n                  `Entered location ${assembleLocString(\n                    location,\n                  )} does not match with displayed regions`,\n                )\n              }\n            }\n            locationIndex -= 1\n            const startDisplayedRegion = self.displayedRegions[index]\n            const endDisplayedRegion =\n              self.displayedRegions[index + locationIndex]\n            this.moveTo(\n              {\n                index,\n                offset: startDisplayedRegion.reversed\n                  ? startDisplayedRegion.end - e\n                  : s - startDisplayedRegion.start,\n              },\n              {\n                index: index + locationIndex,\n                offset: endDisplayedRegion.reversed\n                  ? endDisplayedRegion.end - locationStart\n                  : locationEnd - endDisplayedRegion.start,\n              },\n            )\n            return\n          } catch (error) {\n            if (index === lastIndex) {\n              throw error\n            }\n          }\n        }\n      },\n\n      /**\n       * Navigate to a location based on user clicking and dragging on the\n       * overview scale bar to select a region to zoom into.\n       * Can handle if there are multiple displayedRegions from same refName.\n       * Only navigates to a location if it is entirely within a displayedRegion.\n       *\n       * @param leftPx- `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightPx- `object as {start, end, index, offset}`, offset = end of user drag\n       */\n      zoomToDisplayedRegions(leftPx: BpOffset, rightPx: BpOffset) {\n        if (leftPx === undefined || rightPx === undefined) {\n          return\n        }\n\n        const singleRefSeq =\n          leftPx.refName === rightPx.refName && leftPx.index === rightPx.index\n        // zooming into one displayed Region\n        if (\n          (singleRefSeq && rightPx.offset < leftPx.offset) ||\n          leftPx.index > rightPx.index\n        ) {\n          ;[leftPx, rightPx] = [rightPx, leftPx]\n        }\n        const startOffset = {\n          start: leftPx.start,\n          end: leftPx.end,\n          index: leftPx.index,\n          offset: leftPx.offset,\n        }\n        const endOffset = {\n          start: rightPx.start,\n          end: rightPx.end,\n          index: rightPx.index,\n          offset: rightPx.offset,\n        }\n        if (startOffset && endOffset) {\n          this.moveTo(startOffset, endOffset)\n        } else {\n          const session = getSession(self)\n          session.notify('No regions found to navigate to', 'warning')\n        }\n      },\n      /**\n       * Helper method for the fetchSequence.\n       * Retrieves the corresponding regions that were selected by the rubberband\n       *\n       * @param leftOffset - `object as {start, end, index, offset}`, offset = start of user drag\n       * @param rightOffset - `object as {start, end, index, offset}`, offset = end of user drag\n       * @returns array of Region[]\n       */\n      getSelectedRegions(\n        leftOffset: BpOffset | undefined,\n        rightOffset: BpOffset | undefined,\n      ) {\n        const simView = Base1DView.create({\n          ...getSnapshot(self),\n          interRegionPaddingWidth: self.interRegionPaddingWidth,\n        })\n\n        simView.setVolatileWidth(self.width)\n        simView.zoomToDisplayedRegions(leftOffset, rightOffset)\n\n        return simView.dynamicBlocks.contentBlocks.map(region => {\n          return {\n            ...region,\n            start: Math.floor(region.start),\n            end: Math.ceil(region.end),\n          }\n        })\n      },\n\n      // schedule something to be run after the next time displayedRegions is set\n      afterDisplayedRegionsSet(cb: Function) {\n        self.afterDisplayedRegionsSetCallbacks.push(cb)\n      },\n      /**\n       * offset is the base-pair-offset in the displayed region, index is the index of the\n       * displayed region in the linear genome view\n       *\n       * @param start - object as `{start, end, offset, index}`\n       * @param end - object as `{start, end, offset, index}`\n       */\n      moveTo(start: BpOffset, end: BpOffset) {\n        // find locations in the modellist\n        let bpSoFar = 0\n\n        if (start.index === end.index) {\n          bpSoFar += end.offset - start.offset\n        } else {\n          const s = self.displayedRegions[start.index]\n          bpSoFar += s.end - s.start - start.offset\n          if (end.index - start.index >= 2) {\n            for (let i = start.index + 1; i < end.index; i += 1) {\n              bpSoFar +=\n                self.displayedRegions[i].end - self.displayedRegions[i].start\n            }\n          }\n          bpSoFar += end.offset\n        }\n        const targetBpPerPx =\n          bpSoFar /\n          (self.width -\n            self.interRegionPaddingWidth * (end.index - start.index))\n        const newBpPerPx = self.zoomTo(targetBpPerPx)\n        // If our target bpPerPx was smaller than the allowed minBpPerPx, adjust\n        // the scroll so the requested range is in the middle of the screen\n        let extraBp = 0\n        if (targetBpPerPx < newBpPerPx) {\n          extraBp = ((newBpPerPx - targetBpPerPx) * self.width) / 2\n        }\n\n        let bpToStart = -extraBp\n        for (let i = 0; i < self.displayedRegions.length; i += 1) {\n          const region = self.displayedRegions[i]\n          if (start.index === i) {\n            bpToStart += start.offset\n            break\n          } else {\n            bpToStart += region.end - region.start\n          }\n        }\n        self.scrollTo(\n          Math.round(bpToStart / self.bpPerPx) +\n            self.interRegionPaddingWidth * start.index,\n        )\n      },\n\n      horizontalScroll(distance: number) {\n        const oldOffsetPx = self.offsetPx\n        // newOffsetPx is the actual offset after the scroll is clamped\n        const newOffsetPx = self.scrollTo(self.offsetPx + distance)\n        return newOffsetPx - oldOffsetPx\n      },\n\n      /**\n       * scrolls the view to center on the given bp. if that is not in any\n       * of the displayed regions, does nothing\n       * @param bp - basepair at which you want to center the view\n       * @param refName - refName of the displayedRegion you are centering at\n       * @param regionIndex - index of the displayedRegion\n       */\n      centerAt(bp: number, refName: string, regionIndex: number) {\n        const centerPx = self.bpToPx({\n          refName,\n          coord: bp,\n          regionNumber: regionIndex,\n        })\n        if (centerPx) {\n          self.scrollTo(Math.round(centerPx.offsetPx - self.width / 2))\n        }\n      },\n\n      center() {\n        const centerBp = self.totalBp / 2\n        self.scrollTo(Math.round(centerBp / self.bpPerPx - self.width / 2))\n      },\n\n      showAllRegions() {\n        self.zoomTo(self.maxBpPerPx)\n        this.center()\n      },\n\n      showAllRegionsInAssembly(assemblyName?: string) {\n        const session = getSession(self)\n        const { assemblyManager } = session\n        if (!assemblyName) {\n          const assemblyNames = [\n            ...new Set(\n              self.displayedRegions.map(region => region.assemblyName),\n            ),\n          ]\n          if (assemblyNames.length > 1) {\n            session.notify(\n              `Can't perform this with multiple assemblies currently`,\n            )\n            return\n          }\n\n          ;[assemblyName] = assemblyNames\n        }\n        const assembly = assemblyManager.get(assemblyName)\n        if (assembly) {\n          const { regions } = assembly\n          if (regions) {\n            this.setDisplayedRegions(regions)\n            self.zoomTo(self.maxBpPerPx)\n            this.center()\n          }\n        }\n      },\n\n      setDraggingTrackId(idx?: string) {\n        self.draggingTrackId = idx\n      },\n\n      setScaleFactor(factor: number) {\n        self.scaleFactor = factor\n      },\n    }))\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function slide(viewWidths: number) {\n        const [animate, cancelAnimation] = springAnimate(\n          self.offsetPx,\n          self.offsetPx + self.width * viewWidths,\n          self.scrollTo,\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { slide }\n    })\n    .actions(self => {\n      let cancelLastAnimation = () => {}\n\n      function zoom(targetBpPerPx: number) {\n        self.zoomTo(self.bpPerPx)\n        if (\n          // already zoomed all the way in\n          (targetBpPerPx < self.bpPerPx && self.bpPerPx === self.minBpPerPx) ||\n          // already zoomed all the way out\n          (targetBpPerPx > self.bpPerPx && self.bpPerPx === self.maxBpPerPx)\n        ) {\n          return\n        }\n        const factor = self.bpPerPx / targetBpPerPx\n        const [animate, cancelAnimation] = springAnimate(\n          1,\n          factor,\n          self.setScaleFactor,\n          () => {\n            self.zoomTo(targetBpPerPx)\n            self.setScaleFactor(1)\n          },\n        )\n        cancelLastAnimation()\n        cancelLastAnimation = cancelAnimation\n        animate()\n      }\n\n      return { zoom }\n    })\n    .views(self => ({\n      get canShowCytobands() {\n        return self.displayedRegions.length === 1 && this.anyCytobandsExist\n      },\n      get showCytobands() {\n        return this.canShowCytobands && self.showCytobandsSetting\n      },\n      get anyCytobandsExist() {\n        const { assemblyManager } = getSession(self)\n        const { assemblyNames } = self\n        return assemblyNames.some(\n          asm => assemblyManager.get(asm)?.cytobands?.length,\n        )\n      },\n\n      get cytobandOffset() {\n        return this.showCytobands\n          ? measureText(self.displayedRegions[0].refName, 12) + 15\n          : 0\n      },\n    }))\n    .views(self => ({\n      menuItems(): MenuItem[] {\n        const { canShowCytobands, showCytobands } = self\n\n        const menuItems: MenuItem[] = [\n          {\n            label: 'Return to import form',\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ReturnToImportFormDialog,\n                { model: self, handleClose },\n              ])\n            },\n            icon: FolderOpenIcon,\n          },\n          {\n            label: 'Export SVG',\n            icon: PhotoCameraIcon,\n            onClick: () => {\n              getSession(self).queueDialog(handleClose => [\n                ExportSvgDlg,\n                { model: self, handleClose },\n              ])\n            },\n          },\n          {\n            label: 'Open track selector',\n            onClick: self.activateTrackSelector,\n            icon: TrackSelectorIcon,\n          },\n          {\n            label: 'Horizontally flip',\n            icon: SyncAltIcon,\n            onClick: self.horizontallyFlip,\n          },\n          { type: 'divider' },\n          {\n            label: 'Show all regions in assembly',\n            icon: VisibilityIcon,\n            onClick: self.showAllRegionsInAssembly,\n          },\n          {\n            label: 'Show center line',\n            icon: VisibilityIcon,\n            type: 'checkbox',\n            checked: self.showCenterLine,\n            onClick: self.toggleCenterLine,\n          },\n          {\n            label: 'Show header',\n            icon: VisibilityIcon,\n            type: 'checkbox',\n            checked: !self.hideHeader,\n            onClick: self.toggleHeader,\n          },\n          {\n            label: 'Show header overview',\n            icon: VisibilityIcon,\n            type: 'checkbox',\n            checked: !self.hideHeaderOverview,\n            onClick: self.toggleHeaderOverview,\n            disabled: self.hideHeader,\n          },\n          {\n            label: 'Show no tracks active button',\n            icon: VisibilityIcon,\n            type: 'checkbox',\n            checked: !self.hideNoTracksActive,\n            onClick: self.toggleNoTracksActive,\n          },\n          {\n            label: 'Track labels',\n            icon: LabelIcon,\n            subMenu: [\n              {\n                label: 'Overlapping',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'overlapping',\n                onClick: () => self.setTrackLabels('overlapping'),\n              },\n              {\n                label: 'Offset',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'offset',\n                onClick: () => self.setTrackLabels('offset'),\n              },\n              {\n                label: 'Hidden',\n                icon: VisibilityIcon,\n                type: 'radio',\n                checked: self.trackLabels === 'hidden',\n                onClick: () => self.setTrackLabels('hidden'),\n              },\n            ],\n          },\n          ...(canShowCytobands\n            ? [\n                {\n                  label: showCytobands ? 'Hide ideogram' : 'Show ideograms',\n                  onClick: () => {\n                    self.setShowCytobands(!showCytobands)\n                  },\n                },\n              ]\n            : []),\n        ]\n\n        // add track's view level menu options\n        for (const [key, value] of self.trackTypeActions.entries()) {\n          if (value.length) {\n            menuItems.push(\n              { type: 'divider' },\n              { type: 'subHeader', label: key },\n            )\n            value.forEach(action => {\n              menuItems.push(action)\n            })\n          }\n        }\n\n        return menuItems\n      },\n    }))\n    .views(self => {\n      let currentlyCalculatedStaticBlocks: BlockSet | undefined\n      let stringifiedCurrentlyCalculatedStaticBlocks = ''\n      return {\n        get staticBlocks() {\n          const ret = calculateStaticBlocks(self)\n          const sret = JSON.stringify(ret)\n          if (stringifiedCurrentlyCalculatedStaticBlocks !== sret) {\n            currentlyCalculatedStaticBlocks = ret\n            stringifiedCurrentlyCalculatedStaticBlocks = sret\n          }\n          return currentlyCalculatedStaticBlocks as BlockSet\n        },\n\n        get dynamicBlocks() {\n          return calculateDynamicBlocks(self)\n        },\n\n        get roundedDynamicBlocks() {\n          return this.dynamicBlocks.contentBlocks.map(block => {\n            return {\n              ...block,\n              start: Math.floor(block.start),\n              end: Math.ceil(block.end),\n            }\n          })\n        },\n        get visibleLocStrings() {\n          return calculateVisibleLocStrings(this.dynamicBlocks.contentBlocks)\n        },\n        get coarseVisibleLocStrings() {\n          return calculateVisibleLocStrings(self.coarseDynamicBlocks)\n        },\n      }\n    })\n    .actions(self => ({\n      // this \"clears the view\" and makes the view return to the import form\n      clearView() {\n        self.setDisplayedRegions([])\n        self.tracks.clear()\n        // it is necessary to run these after setting displayed regions empty\n        // or else model.offsetPx gets set to Infinity and breaks\n        // mobx-state-tree snapshot\n        self.scrollTo(0)\n        self.zoomTo(10)\n      },\n      setCoarseDynamicBlocks(blocks: BlockSet) {\n        self.coarseDynamicBlocks = blocks.contentBlocks\n        self.coarseTotalBp = blocks.totalBp\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (self.initialized) {\n                this.setCoarseDynamicBlocks(self.dynamicBlocks)\n              }\n            },\n            { delay: 150 },\n          ),\n        )\n      },\n    }))\n    .actions(self => ({\n      async exportSvg(opts: ExportSvgOptions = {}) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const html = await renderToSvg(self as any, opts)\n        const blob = new Blob([html], { type: 'image/svg+xml' })\n        saveAs(blob, opts.filename || 'image.svg')\n      },\n    }))\n    .views(self => ({\n      rubberBandMenuItems(): MenuItem[] {\n        return [\n          {\n            label: 'Zoom to region',\n            icon: ZoomInIcon,\n            onClick: () => {\n              const { leftOffset, rightOffset } = self\n              if (leftOffset && rightOffset) {\n                self.moveTo(leftOffset, rightOffset)\n              }\n            },\n          },\n          {\n            label: 'Get sequence',\n            icon: MenuOpenIcon,\n            onClick: () => {\n              self.setSequenceDialogOpen(true)\n            },\n          },\n        ]\n      },\n    }))\n}\n\nexport { renderToSvg, RefNameAutocomplete, SearchBox }\nexport type LinearGenomeViewStateModel = ReturnType<typeof stateModelFactory>\nexport type LinearGenomeViewModel = Instance<LinearGenomeViewStateModel>\nexport { default as ReactComponent } from './components/LinearGenomeView'\n","/**\n * Given a scale ( bp/px ) and minimum distances (px) between major and minor\n * gridlines, return an object like `{ majorPitch: bp, minorPitch: bp }` giving\n * the gridline pitches to use.\n */\nexport function chooseGridPitch(\n  scale: number,\n  minMajorPitchPx: number,\n  minMinorPitchPx: number,\n) {\n  scale = Math.abs(scale)\n  const minMajorPitchBp = minMajorPitchPx * scale\n  const majorMagnitude = parseInt(\n    Number(minMajorPitchBp).toExponential().split(/e/i)[1],\n    10,\n  )\n\n  let majorPitch = 10 ** majorMagnitude\n  while (majorPitch < minMajorPitchBp) {\n    majorPitch *= 2\n    if (majorPitch >= minMajorPitchBp) {\n      break\n    }\n    majorPitch *= 2.5\n  }\n\n  majorPitch = Math.max(majorPitch, 5)\n\n  const majorPitchPx = majorPitch / scale\n\n  let minorPitch = 0\n  if (!(majorPitch % 10) && majorPitchPx / 10 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 10\n  } else if (!(majorPitch % 5) && majorPitchPx / 5 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 5\n  } else if (!(majorPitch % 2) && majorPitchPx / 2 >= minMinorPitchPx) {\n    minorPitch = majorPitch / 2\n  }\n\n  return { majorPitch, minorPitch }\n}\n\nexport function makeTicks(\n  start: number,\n  end: number,\n  bpPerPx: number,\n  emitMajor = true,\n  emitMinor = true,\n) {\n  const gridPitch = chooseGridPitch(bpPerPx, 60, 15)\n\n  let minBase = start\n  let maxBase = end\n  if (minBase === null || maxBase === null) {\n    return []\n  }\n\n  if (bpPerPx < 0) {\n    ;[minBase, maxBase] = [maxBase, minBase]\n  }\n\n  // add 20px additional on the right and left to allow us to draw the ends\n  // of labels that lie a little outside our region\n  minBase -= Math.abs(20 * bpPerPx) - 1\n  maxBase += Math.abs(20 * bpPerPx) + 1\n\n  const iterPitch = gridPitch.minorPitch || gridPitch.majorPitch\n  let index = 0\n  const ticks = []\n  for (\n    let base = Math.ceil(minBase / iterPitch) * iterPitch;\n    base < maxBase;\n    base += iterPitch\n  ) {\n    if (emitMinor && base % (gridPitch.majorPitch * 2)) {\n      ticks.push({ type: 'minor', base: base - 1, index })\n      index += 1\n    } else if (emitMajor && !(base % (gridPitch.majorPitch * 2))) {\n      ticks.push({ type: 'major', base: base - 1, index })\n      index += 1\n    }\n  }\n  return ticks\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport const baseLinearDisplayConfigSchema = ConfigurationSchema(\n  'BaseLinearDisplay',\n  {\n    maxFeatureScreenDensity: {\n      type: 'number',\n      description:\n        'maximum features per pixel that is displayed in the view, used if byte size estimates not available',\n      defaultValue: 0.3,\n    },\n    fetchSizeLimit: {\n      type: 'number',\n      defaultValue: 1_000_000,\n      description:\n        \"maximum data to attempt to download for a given track, used if adapter doesn't specify one\",\n    },\n  },\n  { explicitIdentifier: 'displayId' },\n)\n","// takes an array or Map or Set (anything iterable with values()) of Maps\n// and lets you query them as one Map\nexport default class CompositeMap<T, U> {\n  constructor(private submaps: Map<T, U>[]) {}\n\n  has(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return true\n      }\n    }\n    return false\n  }\n\n  get(id: T) {\n    for (const submap of this.submaps.values()) {\n      if (submap.has(id)) {\n        return submap.get(id)\n      }\n    }\n    return undefined\n  }\n\n  *values() {\n    for (const key of this.keys()) {\n      yield this.get(key) as U\n    }\n  }\n\n  *keys() {\n    const keys = new Set<T>()\n    for (const submap of this.submaps.values()) {\n      for (const key of submap.keys()) {\n        keys.add(key)\n      }\n    }\n    for (const key of keys) {\n      yield key\n    }\n  }\n\n  find<V>(f: (arg0: U) => V) {\n    for (const submap of this.submaps.values()) {\n      for (const value of submap.values()) {\n        const found = f(value)\n        if (found) {\n          return value\n        }\n      }\n    }\n    return undefined\n  }\n\n  *[Symbol.iterator]() {\n    for (const key of this.keys()) {\n      yield [key, this.get(key)]\n    }\n  }\n\n  *entries() {\n    for (const k of this.keys()) {\n      yield [k, this.get(k)]\n    }\n  }\n}\n","import React, { useState, useMemo } from 'react'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { Portal, alpha, makeStyles } from '@material-ui/core'\nimport { usePopper } from 'react-popper'\n\n// locals\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\nconst useStyles = makeStyles(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n}))\n\nconst TooltipContents = React.forwardRef<\n  HTMLDivElement,\n  { message: React.ReactNode | string }\n>(({ message }: { message: React.ReactNode | string }, ref) => {\n  return <div ref={ref}>{message}</div>\n})\n\ntype Coord = [number, number]\nconst Tooltip = observer(\n  ({\n    model,\n    clientMouseCoord,\n  }: {\n    model: BaseLinearDisplayModel\n    clientMouseCoord: Coord\n  }) => {\n    const classes = useStyles()\n    const { featureUnderMouse } = model\n    const [width, setWidth] = useState(0)\n    const [popperElt, setPopperElt] = useState<HTMLDivElement | null>(null)\n\n    // must be memoized a la https://github.com/popperjs/react-popper/issues/391\n    const virtElement = useMemo(\n      () => ({\n        getBoundingClientRect: () => {\n          const x = clientMouseCoord[0] + width / 2 + 20\n          const y = clientMouseCoord[1]\n          return {\n            top: y,\n            left: x,\n            bottom: y,\n            right: x,\n            width: 0,\n            height: 0,\n            x,\n            y,\n            toJSON() {},\n          }\n        },\n      }),\n      [clientMouseCoord, width],\n    )\n    const { styles, attributes } = usePopper(virtElement, popperElt)\n\n    const contents = featureUnderMouse\n      ? getConf(model, 'mouseover', { feature: featureUnderMouse })\n      : undefined\n\n    return featureUnderMouse && contents ? (\n      <Portal>\n        <div\n          ref={setPopperElt}\n          className={classes.tooltip}\n          // zIndex needed to go over widget drawer\n          style={{ ...styles.popper, zIndex: 100000 }}\n          {...attributes.popper}\n        >\n          <TooltipContents\n            ref={elt => setWidth(elt?.getBoundingClientRect().width || 0)}\n            message={contents}\n          />\n        </div>\n      </Portal>\n    ) : null\n  },\n)\n\nexport default Tooltip\n","import React from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { getContainingView } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport {\n  ContentBlock,\n  ElidedBlock,\n  InterRegionPaddingBlock,\n} from '@jbrowse/core/util/blockTypes'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nimport {\n  ContentBlock as ContentBlockComponent,\n  ElidedBlock as ElidedBlockComponent,\n  InterRegionPaddingBlock as InterRegionPaddingBlockComponent,\n} from './Block'\nimport { LinearGenomeViewModel } from '../../LinearGenomeView'\n\nconst useStyles = makeStyles({\n  linearBlocks: {\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    position: 'absolute',\n    minHeight: '100%',\n    display: 'flex',\n  },\n  heightOverflowed: {\n    position: 'absolute',\n    color: 'rgb(77,77,77)',\n    borderBottom: '2px solid rgb(77,77,77)',\n    textShadow: 'white 0px 0px 1px',\n    whiteSpace: 'nowrap',\n    width: '100%',\n    fontWeight: 'bold',\n    textAlign: 'center',\n    zIndex: 2000,\n    boxSizing: 'border-box',\n  },\n})\nconst RenderedBlocks = observer(\n  ({ model }: { model: BaseLinearDisplayModel }) => {\n    const classes = useStyles()\n    const { blockDefinitions, blockState } = model\n    return (\n      <>\n        {blockDefinitions.map(block => {\n          if (block instanceof ContentBlock) {\n            const state = blockState.get(block.key)\n\n            return (\n              <ContentBlockComponent\n                block={block}\n                key={`${model.id}-${block.key}`}\n              >\n                {state && state.ReactComponent ? (\n                  <state.ReactComponent model={state} />\n                ) : null}\n                {state && state.maxHeightReached ? (\n                  <div\n                    className={classes.heightOverflowed}\n                    style={{\n                      top: state.layout.getTotalHeight() - 16,\n                      pointerEvents: 'none',\n                      height: 16,\n                    }}\n                  >\n                    Max height reached\n                  </div>\n                ) : null}\n              </ContentBlockComponent>\n            )\n          }\n          if (block instanceof ElidedBlock) {\n            return (\n              <ElidedBlockComponent\n                key={`${model.id}-${block.key}`}\n                width={block.widthPx}\n              />\n            )\n          }\n          if (block instanceof InterRegionPaddingBlock) {\n            return (\n              <InterRegionPaddingBlockComponent\n                key={block.key}\n                width={block.widthPx}\n                style={{ background: 'none' }}\n                boundary={block.variant === 'boundary'}\n              />\n            )\n          }\n          throw new Error(`invalid block type ${typeof block}`)\n        })}\n      </>\n    )\n  },\n)\nfunction LinearBlocks({ model }: { model: BaseLinearDisplayModel }) {\n  const classes = useStyles()\n  const { blockDefinitions } = model\n  const viewModel = getContainingView(model) as LinearGenomeViewModel\n  return (\n    <div\n      data-testid=\"Blockset\"\n      className={classes.linearBlocks}\n      style={{\n        left: blockDefinitions.offsetPx - viewModel.offsetPx,\n      }}\n    >\n      <RenderedBlocks model={model} />\n    </div>\n  )\n}\n\nexport { RenderedBlocks, useStyles }\nexport default observer(LinearBlocks)\n","import React, { useState, useRef } from 'react'\nimport { observer } from 'mobx-react'\nimport { useTheme, makeStyles } from '@material-ui/core'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { Menu } from '@jbrowse/core/ui'\n\n// locals\nimport Tooltip from './Tooltip'\nimport LinearBlocks from './LinearBlocks'\nimport { BaseLinearDisplayModel } from '../models/BaseLinearDisplayModel'\n\nconst useStyles = makeStyles({\n  display: {\n    position: 'relative',\n    whiteSpace: 'nowrap',\n    textAlign: 'left',\n    width: '100%',\n    minHeight: '100%',\n  },\n})\n\ntype Coord = [number, number]\nconst BaseLinearDisplay = observer(\n  (props: { model: BaseLinearDisplayModel; children?: React.ReactNode }) => {\n    const classes = useStyles()\n    const theme = useTheme()\n    const ref = useRef<HTMLDivElement>(null)\n    const [clientRect, setClientRect] = useState<DOMRect>()\n    const [offsetMouseCoord, setOffsetMouseCoord] = useState<Coord>([0, 0])\n    const [clientMouseCoord, setClientMouseCoord] = useState<Coord>([0, 0])\n    const [contextCoord, setContextCoord] = useState<Coord>()\n    const { model, children } = props\n    const {\n      TooltipComponent,\n      DisplayMessageComponent,\n      contextMenuItems,\n      height,\n      setContextMenuFeature,\n    } = model\n\n    return (\n      <div\n        ref={ref}\n        data-testid={`display-${getConf(model, 'displayId')}`}\n        className={classes.display}\n        onContextMenu={event => {\n          event.preventDefault()\n          if (contextCoord) {\n            // There's already a context menu open, so close it\n            setContextCoord(undefined)\n          } else if (ref.current) {\n            setContextCoord([event.clientX, event.clientY])\n          }\n        }}\n        onMouseMove={event => {\n          if (!ref.current) {\n            return\n          }\n          const rect = ref.current.getBoundingClientRect()\n          const { left, top } = rect\n          setOffsetMouseCoord([event.clientX - left, event.clientY - top])\n          setClientMouseCoord([event.clientX, event.clientY])\n          setClientRect(rect)\n        }}\n      >\n        {DisplayMessageComponent ? (\n          <DisplayMessageComponent model={model} />\n        ) : (\n          <LinearBlocks {...props} />\n        )}\n        {children}\n\n        <TooltipComponent\n          model={model}\n          height={height}\n          offsetMouseCoord={offsetMouseCoord}\n          clientMouseCoord={clientMouseCoord}\n          clientRect={clientRect}\n          mouseCoord={offsetMouseCoord}\n        />\n\n        <Menu\n          open={Boolean(contextCoord) && Boolean(contextMenuItems().length)}\n          onMenuItemClick={(_, callback) => {\n            callback()\n            setContextCoord(undefined)\n          }}\n          onClose={() => {\n            setContextCoord(undefined)\n            setContextMenuFeature(undefined)\n          }}\n          TransitionProps={{\n            onExit: () => {\n              setContextCoord(undefined)\n              setContextMenuFeature(undefined)\n            },\n          }}\n          anchorReference=\"anchorPosition\"\n          anchorPosition={\n            contextCoord\n              ? { top: contextCoord[1], left: contextCoord[0] }\n              : undefined\n          }\n          style={{ zIndex: theme.zIndex.tooltip }}\n          menuItems={contextMenuItems()}\n          data-testid=\"base_linear_display_context_menu\"\n        />\n      </div>\n    )\n  },\n)\n\nexport default BaseLinearDisplay\nexport { Tooltip }\n","import React, { useEffect, useState } from 'react'\nimport Typography from '@material-ui/core/Typography'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observer } from 'mobx-react'\nimport { getParent } from 'mobx-state-tree'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport Button from '@material-ui/core/Button'\nimport RefreshIcon from '@material-ui/icons/Refresh'\n\nconst useStyles = makeStyles(theme => ({\n  loading: {\n    paddingLeft: '0.6em',\n    backgroundColor: theme.palette.action.disabledBackground,\n    backgroundImage:\n      'repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)',\n    height: '100%',\n    width: '100%',\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    pointerEvents: 'none',\n    textAlign: 'center',\n  },\n  blockError: {\n    padding: theme.spacing(2),\n    width: '100%',\n    whiteSpace: 'normal',\n    color: theme.palette.error.main,\n    overflowY: 'auto',\n  },\n  blockReactNodeMessage: {\n    width: '100%',\n    background: theme.palette.action.disabledBackground,\n    padding: theme.spacing(2),\n    textAlign: 'center',\n  },\n  dots: {\n    '&::after': {\n      display: 'inline-block',\n      animation: '$ellipsis 1.5s infinite',\n      content: '\".\"',\n      width: '1em',\n      textAlign: 'left',\n    },\n  },\n  '@keyframes ellipsis': {\n    '0%': {\n      content: '\".\"',\n    },\n    '33%': {\n      content: '\"..\"',\n    },\n    '66%': {\n      content: '\"...\"',\n    },\n  },\n}))\n\nfunction Repeater({ children }: { children: React.ReactNode }) {\n  return (\n    <div style={{ display: 'flex' }}>\n      {children}\n      {children}\n    </div>\n  )\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst LoadingMessage = observer(({ model }: { model: any }) => {\n  // only show the loading message after 300ms to prevent excessive flickering\n  const [shown, setShown] = useState(false)\n  const classes = useStyles()\n  useEffect(() => {\n    let killed = false\n    const timeout = setTimeout(() => {\n      if (!killed) {\n        setShown(true)\n      }\n    }, 300)\n    return () => {\n      clearTimeout(timeout)\n      killed = true\n    }\n  }, [])\n\n  const { status: blockStatus } = model\n  const { message: displayStatus } = getParent(model, 2)\n  const status = displayStatus || blockStatus\n  return (\n    <>\n      {shown ? (\n        <div className={classes.loading}>\n          <Typography className={classes.dots} variant=\"body2\">\n            {status ? `${status}` : 'Loading'}\n          </Typography>\n        </div>\n      ) : null}\n    </>\n  )\n})\n\nfunction BlockMessage({\n  messageContent,\n}: {\n  messageContent: string | React.ReactNode\n}) {\n  const classes = useStyles()\n\n  return React.isValidElement(messageContent) ? (\n    <div className={classes.blockReactNodeMessage}>{messageContent}</div>\n  ) : (\n    <Typography variant=\"body2\" className={classes.blockMessage}>\n      {messageContent}\n    </Typography>\n  )\n}\n\nfunction BlockError({\n  error,\n  reload,\n  displayHeight,\n}: {\n  error: Error\n  reload: () => void\n  displayHeight: number\n}) {\n  const classes = useStyles()\n  return (\n    <div className={classes.blockError} style={{ height: displayHeight }}>\n      {reload ? (\n        <Button\n          data-testid=\"reload_button\"\n          onClick={reload}\n          startIcon={<RefreshIcon />}\n        >\n          Reload\n        </Button>\n      ) : null}\n      <Typography color=\"error\" variant=\"body2\" display=\"inline\">\n        {`${error}`}\n      </Typography>\n    </div>\n  )\n}\n\nconst ServerSideRenderedBlockContent = observer(\n  ({\n    model,\n  }: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    model: any\n  }) => {\n    if (model.error) {\n      return (\n        <Repeater>\n          <BlockError\n            error={model.error}\n            reload={model.reload}\n            displayHeight={getParentRenderProps(model).displayModel.height}\n          />\n        </Repeater>\n      )\n    }\n    if (model.message) {\n      return (\n        <Repeater>\n          <BlockMessage messageContent={model.message} />\n        </Repeater>\n      )\n    }\n    if (!model.filled) {\n      return (\n        <Repeater>\n          <LoadingMessage model={model} />\n        </Repeater>\n      )\n    }\n    return model.reactElement\n  },\n)\n\nexport default ServerSideRenderedBlockContent\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { types, getParent, isAlive, cast, Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport {\n  assembleLocString,\n  getSession,\n  getContainingDisplay,\n  getContainingView,\n  getViewParams,\n  makeAbortableReaction,\n  Feature,\n} from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types/mst'\nimport {\n  AbstractDisplayModel,\n  isRetryException,\n} from '@jbrowse/core/util/types'\n\nimport {\n  getTrackAssemblyNames,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\n\nimport ServerSideRenderedBlockContent from '../components/ServerSideRenderedBlockContent'\n\n// the MST state of a single server-side-rendered block in a display\nconst blockState = types\n  .model('BlockState', {\n    key: types.string,\n    region: Region,\n    reloadFlag: 0,\n    isLeftEndOfDisplayedRegion: false,\n    isRightEndOfDisplayedRegion: false,\n  })\n  // NOTE: all this volatile stuff has to be filled in at once, so that it stays consistent\n  .volatile(() => ({\n    renderInProgress: undefined as AbortController | undefined,\n    filled: false,\n    reactElement: undefined as React.ReactElement | undefined,\n    features: undefined as Map<string, Feature> | undefined,\n    layout: undefined as any,\n    status: '',\n    error: undefined as unknown,\n    message: undefined as string | undefined,\n    maxHeightReached: false,\n    ReactComponent: ServerSideRenderedBlockContent,\n    renderProps: undefined as any,\n  }))\n  .actions(self => {\n    let renderInProgress: undefined | AbortController\n    return {\n      doReload() {\n        self.reloadFlag = self.reloadFlag + 1\n      },\n      afterAttach() {\n        const display = getContainingDisplay(self)\n        makeAbortableReaction(\n          self as any,\n          renderBlockData,\n          renderBlockEffect as any, // reaction doesn't expect async here\n          {\n            name: `${display.id}/${assembleLocString(self.region)} rendering`,\n            delay: display.renderDelay,\n            fireImmediately: true,\n          },\n          this.setLoading,\n          this.setRendered,\n          this.setError,\n        )\n      },\n      setStatus(message: string) {\n        self.status = message\n      },\n      setLoading(abortController: AbortController) {\n        if (renderInProgress !== undefined) {\n          if (!renderInProgress.signal.aborted) {\n            renderInProgress.abort()\n          }\n        }\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = abortController\n      },\n      setMessage(messageText: string) {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        self.filled = false\n        self.message = messageText\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.maxHeightReached = false\n        self.renderProps = undefined\n        renderInProgress = undefined\n      },\n      setRendered(\n        props:\n          | {\n              reactElement: React.ReactElement\n              features: Map<string, Feature>\n              layout: any\n              maxHeightReached: boolean\n              renderProps: any\n            }\n          | undefined,\n      ) {\n        if (!props) {\n          return\n        }\n        const {\n          reactElement,\n          features,\n          layout,\n          maxHeightReached,\n          renderProps,\n        } = props\n        self.filled = true\n        self.message = undefined\n        self.reactElement = reactElement\n        self.features = features\n        self.layout = layout\n        self.error = undefined\n        self.maxHeightReached = maxHeightReached\n        self.renderProps = renderProps\n        renderInProgress = undefined\n      },\n      setError(error: Error | unknown) {\n        console.error(error)\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        // the rendering failed for some reason\n        self.filled = false\n        self.message = undefined\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.maxHeightReached = false\n        self.error = error\n        self.renderProps = undefined\n        renderInProgress = undefined\n        if (isRetryException(error as Error)) {\n          this.reload()\n        }\n      },\n      reload() {\n        self.renderInProgress = undefined\n        self.filled = false\n        self.reactElement = undefined\n        self.features = undefined\n        self.layout = undefined\n        self.error = undefined\n        self.message = undefined\n        self.maxHeightReached = false\n        self.ReactComponent = ServerSideRenderedBlockContent\n        self.renderProps = undefined\n        getParent(self, 2).reload()\n      },\n      beforeDestroy() {\n        if (renderInProgress && !renderInProgress.signal.aborted) {\n          renderInProgress.abort()\n        }\n        const display = getContainingDisplay(self)\n        const { rpcManager } = getSession(self)\n        const { rendererType } = display\n        const { renderArgs } = renderBlockData(cast(self))\n        // renderArgs can be undefined if an error occured in this block\n        if (renderArgs) {\n          rendererType\n            .freeResourcesInClient(\n              rpcManager,\n              JSON.parse(JSON.stringify(renderArgs)),\n            )\n            .catch((e: Error) => {\n              // just console.error if it's something while it's being destroyed\n              console.warn('Error while destroying block', e)\n            })\n        }\n      },\n    }\n  })\n\nexport default blockState\nexport type BlockStateModel = typeof blockState\nexport type BlockModel = Instance<BlockStateModel>\n\n// calls the render worker to render the block content not using a flow for\n// this, because the flow doesn't work with autorun\nexport function renderBlockData(\n  self: Instance<BlockStateModel>,\n  optDisplay?: AbstractDisplayModel,\n) {\n  try {\n    const display = optDisplay || (getContainingDisplay(self) as any)\n    const { assemblyManager, rpcManager } = getSession(display)\n    const { adapterConfig, rendererType, error, parentTrack } = display\n    const assemblyNames = getTrackAssemblyNames(parentTrack)\n    const regionAsm = self.region.assemblyName\n    if (\n      !assemblyNames.includes(regionAsm) &&\n      !assemblyNames.find(name => assemblyManager.get(name)?.hasName(regionAsm))\n    ) {\n      throw new Error(\n        `region assembly (${regionAsm}) does not match track assemblies (${assemblyNames})`,\n      )\n    }\n\n    const renderProps = display.renderProps()\n    const { config } = renderProps\n\n    // This line is to trigger the mobx reaction when the config changes\n    // It won't trigger the reaction if it doesn't think we're accessing it\n    readConfObject(config)\n\n    const sessionId = getRpcSessionId(display)\n    const layoutId = getContainingView(display).id\n    const cannotBeRenderedReason = display.regionCannotBeRendered(self.region)\n\n    return {\n      rendererType,\n      rpcManager,\n      renderProps,\n      cannotBeRenderedReason,\n      displayError: error,\n      renderArgs: {\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            self.setStatus(message)\n          }\n        },\n        assemblyName: self.region.assemblyName,\n        regions: [self.region],\n        adapterConfig,\n        rendererType: rendererType.name,\n        sessionId,\n        layoutId,\n        blockKey: self.key,\n        reloadFlag: self.reloadFlag,\n        timeout: 1000000, // 10000,\n      },\n    }\n  } catch (e) {\n    return { displayError: e }\n  }\n}\n\ninterface RenderProps {\n  displayError: Error\n  rendererType: any\n  renderProps: { [key: string]: any }\n  rpcManager: { call: Function }\n  cannotBeRenderedReason: string\n  renderArgs: { [key: string]: any }\n}\n\ninterface ErrorProps {\n  displayError: string\n}\n\nasync function renderBlockEffect(\n  props: RenderProps | ErrorProps,\n  signal: AbortSignal,\n  self: Instance<BlockStateModel>,\n) {\n  const {\n    rendererType,\n    renderProps,\n    rpcManager,\n    renderArgs,\n    cannotBeRenderedReason,\n    displayError,\n  } = props as RenderProps\n  if (!isAlive(self)) {\n    return undefined\n  }\n\n  if (displayError) {\n    self.setError(displayError)\n    return undefined\n  }\n  if (cannotBeRenderedReason) {\n    self.setMessage(cannotBeRenderedReason)\n    return undefined\n  }\n\n  if (renderProps.notReady) {\n    return undefined\n  }\n\n  const { reactElement, features, layout, maxHeightReached } =\n    await rendererType.renderInClient(rpcManager, {\n      ...renderArgs,\n      ...renderProps,\n      viewParams: getViewParams(self),\n      signal,\n    })\n  return {\n    reactElement,\n    features,\n    layout,\n    maxHeightReached,\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { Button, Typography } from '@material-ui/core'\nimport { BaseDisplay } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport {\n  isAbortException,\n  getContainingView,\n  getContainingTrack,\n  getSession,\n  getViewParams,\n  isSelectionContainer,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { Stats } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { BaseBlock } from '@jbrowse/core/util/blockTypes'\nimport { Region } from '@jbrowse/core/util/types'\nimport CompositeMap from '@jbrowse/core/util/compositeMap'\nimport { Feature, isFeature } from '@jbrowse/core/util/simpleFeature'\nimport {\n  getParentRenderProps,\n  getRpcSessionId,\n} from '@jbrowse/core/util/tracks'\nimport { autorun } from 'mobx'\nimport { addDisposer, isAlive, types, Instance } from 'mobx-state-tree'\n// icons\nimport MenuOpenIcon from '@material-ui/icons/MenuOpen'\n\nimport { LinearGenomeViewModel, ExportSvgOptions } from '../../LinearGenomeView'\nimport { Tooltip } from '../components/BaseLinearDisplay'\nimport BlockState, { renderBlockData } from './serverSideRenderedBlock'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface Layout {\n  minX: number\n  minY: number\n  maxX: number\n  maxY: number\n  name: string\n}\n\n// stabilize clipid under test for snapshot\nfunction getId(id: string, index: number) {\n  const isJest = typeof jest === 'undefined'\n  return `clip-${isJest ? id : 'jest'}-${index}`\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nfunction getDisplayStr(totalBytes: number) {\n  let displayBp\n  if (Math.floor(totalBytes / 1000000) > 0) {\n    displayBp = `${parseFloat((totalBytes / 1000000).toPrecision(3))} Mb`\n  } else if (Math.floor(totalBytes / 1000) > 0) {\n    displayBp = `${parseFloat((totalBytes / 1000).toPrecision(3))} Kb`\n  } else {\n    displayBp = `${Math.floor(totalBytes)} bytes`\n  }\n  return displayBp\n}\n\nconst minDisplayHeight = 20\nconst defaultDisplayHeight = 100\n\nexport const BaseLinearDisplay = types\n  .compose(\n    'BaseLinearDisplay',\n    BaseDisplay,\n    types.model({\n      height: types.optional(\n        types.refinement(\n          'displayHeight',\n          types.number,\n          n => n >= minDisplayHeight,\n        ),\n        defaultDisplayHeight,\n      ),\n      blockState: types.map(BlockState),\n      userBpPerPxLimit: types.maybe(types.number),\n      userByteSizeLimit: types.maybe(types.number),\n    }),\n  )\n  .volatile(() => ({\n    currBpPerPx: 0,\n    message: '',\n    featureIdUnderMouse: undefined as undefined | string,\n    contextMenuFeature: undefined as undefined | Feature,\n    scrollTop: 0,\n    estimatedRegionStatsP: undefined as undefined | Promise<Stats>,\n    estimatedRegionStats: undefined as undefined | Stats,\n  }))\n  .views(self => ({\n    get blockType(): 'staticBlocks' | 'dynamicBlocks' {\n      return 'staticBlocks'\n    },\n    get blockDefinitions() {\n      const { blockType } = this\n      const view = getContainingView(self) as LGV\n      if (!view.initialized) {\n        throw new Error('view not initialized yet')\n      }\n      return view[blockType]\n    },\n  }))\n  .views(self => ({\n    /**\n     * how many milliseconds to wait for the display to\n     * \"settle\" before re-rendering a block\n     */\n    get renderDelay() {\n      return 50\n    },\n\n    get TooltipComponent(): React.FC<any> {\n      return Tooltip as unknown as React.FC\n    },\n\n    /**\n     * returns a string feature ID if the globally-selected object\n     * is probably a feature\n     */\n    get selectedFeatureId() {\n      if (isAlive(self)) {\n        const { selection } = getSession(self)\n        // does it quack like a feature?\n        if (isFeature(selection)) {\n          return selection.id()\n        }\n      }\n      return undefined\n    },\n    /**\n     * if a display-level message should be displayed instead of the blocks,\n     * make this return a react component\n     */\n    get DisplayMessageComponent() {\n      return undefined as undefined | React.FC<any>\n    },\n  }))\n  .views(self => ({\n    /**\n     * a CompositeMap of `featureId -> feature obj` that\n     * just looks in all the block data for that feature\n     */\n    get features() {\n      const featureMaps = []\n      for (const block of self.blockState.values()) {\n        if (block && block.features) {\n          featureMaps.push(block.features)\n        }\n      }\n      return new CompositeMap(featureMaps)\n    },\n\n    get featureUnderMouse() {\n      const feat = self.featureIdUnderMouse\n      return feat ? this.features.get(feat) : undefined\n    },\n\n    getFeatureOverlapping(blockKey: string, x: number, y: number) {\n      return self.blockState.get(blockKey)?.layout?.getByCoord(x, y)\n    },\n\n    getFeatureByID(blockKey: string, id: string): LayoutRecord | undefined {\n      return self.blockState.get(blockKey)?.layout?.getByID(id)\n    },\n\n    // if block key is not supplied, can look at all blocks\n    searchFeatureByID(id: string): LayoutRecord | undefined {\n      let ret\n      self.blockState.forEach(block => {\n        const val = block?.layout?.getByID(id)\n        if (val) {\n          ret = val\n        }\n      })\n      return ret\n    },\n\n    get currentBytesRequested() {\n      return self.estimatedRegionStats?.bytes || 0\n    },\n\n    get currentFeatureScreenDensity() {\n      const view = getContainingView(self) as LGV\n      return (self.estimatedRegionStats?.featureDensity || 0) * view.bpPerPx\n    },\n\n    get maxFeatureScreenDensity() {\n      return getConf(self, 'maxFeatureScreenDensity')\n    },\n    get estimatedStatsReady() {\n      return !!self.estimatedRegionStats\n    },\n\n    get maxAllowableBytes() {\n      return (\n        self.userByteSizeLimit ||\n        self.estimatedRegionStats?.fetchSizeLimit ||\n        (getConf(self, 'fetchSizeLimit') as number)\n      )\n    },\n  }))\n  .actions(self => ({\n    // base display reload does nothing, see specialized displays for details\n    setMessage(message: string) {\n      self.message = message\n    },\n\n    afterAttach() {\n      // watch the parent's blocks to update our block state when they change,\n      // then we recreate the blocks on our own model (creating and deleting to\n      // match the parent blocks)\n      const blockWatchDisposer = autorun(() => {\n        const blocksPresent: { [key: string]: boolean } = {}\n        const view = getContainingView(self) as LGV\n        if (view.initialized) {\n          self.blockDefinitions.contentBlocks.forEach(block => {\n            blocksPresent[block.key] = true\n            if (!self.blockState.has(block.key)) {\n              this.addBlock(block.key, block)\n            }\n          })\n          self.blockState.forEach((_, key) => {\n            if (!blocksPresent[key]) {\n              this.deleteBlock(key)\n            }\n          })\n        }\n      })\n\n      addDisposer(self, blockWatchDisposer)\n    },\n\n    estimateRegionsStats(\n      regions: Region[],\n      opts: {\n        headers?: Record<string, string>\n        signal?: AbortSignal\n        filters?: string[]\n      },\n    ) {\n      if (self.estimatedRegionStatsP) {\n        return self.estimatedRegionStatsP\n      }\n\n      const { rpcManager } = getSession(self)\n      const { adapterConfig } = self\n      if (!adapterConfig) {\n        // A track extending the base track might not have an adapter config\n        // e.g. Apollo tracks don't use adapters\n        return Promise.resolve({})\n      }\n      const sessionId = getRpcSessionId(self)\n\n      const params = {\n        sessionId,\n        regions,\n        adapterConfig,\n        statusCallback: (message: string) => {\n          if (isAlive(self)) {\n            this.setMessage(message)\n          }\n        },\n        ...opts,\n      }\n\n      self.estimatedRegionStatsP = rpcManager\n        .call(sessionId, 'CoreEstimateRegionStats', params)\n        .catch(e => {\n          this.setRegionStatsP(undefined)\n          throw e\n        }) as Promise<Stats>\n\n      return self.estimatedRegionStatsP\n    },\n    setRegionStatsP(p?: Promise<Stats>) {\n      self.estimatedRegionStatsP = p\n    },\n    setRegionStats(estimatedRegionStats?: Stats) {\n      self.estimatedRegionStats = estimatedRegionStats\n    },\n    clearRegionStats() {\n      self.estimatedRegionStatsP = undefined\n      self.estimatedRegionStats = undefined\n    },\n    setHeight(displayHeight: number) {\n      if (displayHeight > minDisplayHeight) {\n        self.height = displayHeight\n      } else {\n        self.height = minDisplayHeight\n      }\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n\n    setScrollTop(scrollTop: number) {\n      self.scrollTop = scrollTop\n    },\n\n    updateStatsLimit(stats: Stats) {\n      const view = getContainingView(self) as LGV\n      if (stats.bytes) {\n        self.userByteSizeLimit = stats.bytes\n      } else {\n        self.userBpPerPxLimit = view.bpPerPx\n      }\n    },\n\n    addBlock(key: string, block: BaseBlock) {\n      self.blockState.set(\n        key,\n        BlockState.create({\n          key,\n          region: block.toRegion(),\n        }),\n      )\n    },\n    setCurrBpPerPx(n: number) {\n      self.currBpPerPx = n\n    },\n    deleteBlock(key: string) {\n      self.blockState.delete(key)\n    },\n    selectFeature(feature: Feature) {\n      const session = getSession(self)\n      if (isSessionModelWithWidgets(session)) {\n        const featureWidget = session.addWidget(\n          'BaseFeatureWidget',\n          'baseFeature',\n          {\n            view: getContainingView(self),\n            track: getContainingTrack(self),\n            featureData: feature.toJSON(),\n          },\n        )\n\n        session.showWidget(featureWidget)\n      }\n      if (isSelectionContainer(session)) {\n        session.setSelection(feature)\n      }\n    },\n    clearFeatureSelection() {\n      const session = getSession(self)\n      session.clearSelection()\n    },\n    setFeatureIdUnderMouse(feature: string | undefined) {\n      self.featureIdUnderMouse = feature\n    },\n    reload() {\n      ;[...self.blockState.values()].map(val => val.doReload())\n    },\n    setContextMenuFeature(feature?: Feature) {\n      self.contextMenuFeature = feature\n    },\n  }))\n  .views(self => ({\n    // region is too large if:\n    // - stats are ready\n    // - region is greater than 20kb (don't warn when zoomed in less than that)\n    // - and bytes > max allowed bytes || curr density>max density\n    get regionTooLarge() {\n      const view = getContainingView(self) as LGV\n      if (!self.estimatedStatsReady || view.dynamicBlocks.totalBp < 20_000) {\n        return false\n      }\n      const bpLimitOrDensity = self.userBpPerPxLimit\n        ? view.bpPerPx > self.userBpPerPxLimit\n        : self.currentFeatureScreenDensity > self.maxFeatureScreenDensity\n\n      return (\n        self.currentBytesRequested > self.maxAllowableBytes || bpLimitOrDensity\n      )\n    },\n\n    // only shows a message of bytes requested is defined, the feature density\n    // based stats don't produce any helpful message besides to zoom in\n    get regionTooLargeReason() {\n      const req = self.currentBytesRequested\n      const max = self.maxAllowableBytes\n\n      return req && req > max\n        ? `Requested too much data (${getDisplayStr(req)})`\n        : ''\n    },\n  }))\n  .actions(self => {\n    const { reload: superReload } = self\n\n    return {\n      async reload() {\n        self.setError()\n        const aborter = new AbortController()\n        const view = getContainingView(self) as LGV\n\n        // extra check for contentBlocks.length\n        // https://github.com/GMOD/jbrowse-components/issues/2694\n        if (!view.initialized || !view.staticBlocks.contentBlocks.length) {\n          return\n        }\n\n        try {\n          self.estimatedRegionStatsP = self.estimateRegionsStats(\n            view.staticBlocks.contentBlocks,\n            { signal: aborter.signal },\n          )\n          const estimatedRegionStats = await self.estimatedRegionStatsP\n\n          if (isAlive(self)) {\n            self.setRegionStats(estimatedRegionStats)\n            superReload()\n          } else {\n            return\n          }\n        } catch (e) {\n          console.error(e)\n          self.setError(e)\n        }\n      },\n      afterAttach() {\n        // this autorun performs stats estimation\n        //\n        // the chain of events calls estimateRegionsStats against the data\n        // adapter which by default uses featureDensity, but can also respond\n        // with a byte size estimate and fetch size limit (data adapter can\n        // define what is too much data)\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              try {\n                const aborter = new AbortController()\n                const view = getContainingView(self) as LGV\n\n                // extra check for contentBlocks.length\n                // https://github.com/GMOD/jbrowse-components/issues/2694\n                if (\n                  !view.initialized ||\n                  !view.staticBlocks.contentBlocks.length\n                ) {\n                  return\n                }\n\n                // don't re-estimate featureDensity even if zoom level changes,\n                // jbrowse1-style assume it's sort of representative\n                if (self.estimatedRegionStats?.featureDensity !== undefined) {\n                  self.setCurrBpPerPx(view.bpPerPx)\n                  return\n                }\n\n                // we estimate stats once at a given zoom level\n                if (view.bpPerPx === self.currBpPerPx) {\n                  return\n                }\n\n                self.clearRegionStats()\n                self.setCurrBpPerPx(view.bpPerPx)\n                const statsP = self.estimateRegionsStats(\n                  view.staticBlocks.contentBlocks,\n                  { signal: aborter.signal },\n                )\n                self.setRegionStatsP(statsP)\n                const estimatedRegionStats = await statsP\n\n                if (isAlive(self)) {\n                  self.setRegionStats(estimatedRegionStats)\n                }\n              } catch (e) {\n                if (!isAbortException(e) && isAlive(self)) {\n                  console.error(e)\n                  self.setError(e)\n                }\n              }\n            },\n            { delay: 500 },\n          ),\n        )\n      },\n    }\n  })\n  .views(self => ({\n    regionCannotBeRenderedText(_region: Region) {\n      return self.regionTooLarge ? 'Force load to see features' : ''\n    },\n\n    /**\n     * @param region -\n     * @returns falsy if the region is fine to try rendering. Otherwise,\n     *  return a react node + string of text.\n     *  string of text describes why it cannot be rendered\n     *  react node allows user to force load at current setting\n     */\n    regionCannotBeRendered(_region: Region) {\n      const { regionTooLarge, regionTooLargeReason } = self\n\n      if (regionTooLarge) {\n        return (\n          <>\n            <Typography component=\"span\" variant=\"body2\">\n              {regionTooLargeReason ? regionTooLargeReason + '. ' : ''}\n              Zoom in to see features or{' '}\n            </Typography>\n            <Button\n              data-testid=\"force_reload_button\"\n              onClick={() => {\n                if (!self.estimatedRegionStats) {\n                  console.error('No global stats?')\n                } else {\n                  self.updateStatsLimit(self.estimatedRegionStats)\n                  self.reload()\n                }\n              }}\n              variant=\"outlined\"\n            >\n              Force Load\n            </Button>\n            <Typography component=\"span\" variant=\"body2\">\n              (force load may be slow)\n            </Typography>\n          </>\n        )\n      }\n      return undefined\n    },\n\n    trackMenuItems(): MenuItem[] {\n      return []\n    },\n\n    contextMenuItems() {\n      return self.contextMenuFeature\n        ? [\n            {\n              label: 'Open feature details',\n              icon: MenuOpenIcon,\n              onClick: () => {\n                if (self.contextMenuFeature) {\n                  self.selectFeature(self.contextMenuFeature)\n                }\n              },\n            },\n          ]\n        : []\n    },\n    renderProps() {\n      const view = getContainingView(self) as LGV\n      return {\n        ...getParentRenderProps(self),\n        notReady:\n          self.currBpPerPx !== view.bpPerPx || !self.estimatedRegionStats,\n        rpcDriverName: self.rpcDriverName,\n        displayModel: self,\n        onFeatureClick(_: unknown, featureId?: string) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            const feature = self.features.get(f)\n            if (feature) {\n              self.selectFeature(feature)\n            }\n          }\n        },\n        onClick() {\n          self.clearFeatureSelection()\n        },\n        // similar to click but opens a menu with further options\n        onFeatureContextMenu(_: unknown, featureId?: string) {\n          const f = featureId || self.featureIdUnderMouse\n          if (!f) {\n            self.clearFeatureSelection()\n          } else {\n            // feature id under mouse passed to context menu\n            self.setContextMenuFeature(self.features.get(f))\n          }\n        },\n\n        onMouseMove(_: unknown, featureId?: string) {\n          self.setFeatureIdUnderMouse(featureId)\n        },\n\n        onMouseLeave(_: unknown) {\n          self.setFeatureIdUnderMouse(undefined)\n        },\n\n        onContextMenu() {\n          self.setContextMenuFeature(undefined)\n          self.clearFeatureSelection()\n        },\n      }\n    },\n  }))\n  .actions(self => ({\n    async renderSvg(opts: ExportSvgOptions & { overrideHeight: number }) {\n      const { height, id } = self\n      const { overrideHeight } = opts\n      const view = getContainingView(self) as LGV\n      const { offsetPx: viewOffsetPx, roundedDynamicBlocks, width } = view\n\n      const renderings = await Promise.all(\n        roundedDynamicBlocks.map(block => {\n          const blockState = BlockState.create({\n            key: block.key,\n            region: block,\n          })\n\n          // regionCannotBeRendered can return jsx so look for plaintext\n          // version, or just get the default if none available\n          const cannotBeRenderedReason =\n            self.regionCannotBeRenderedText(block) ||\n            self.regionCannotBeRendered(block)\n\n          if (cannotBeRenderedReason) {\n            return {\n              reactElement: (\n                <>\n                  <rect x={0} y={0} width={width} height={20} fill=\"#aaa\" />\n                  <text x={0} y={15}>\n                    {cannotBeRenderedReason}\n                  </text>\n                </>\n              ),\n            }\n          }\n\n          const { rpcManager, renderArgs, renderProps, rendererType } =\n            renderBlockData(blockState, self)\n\n          return rendererType.renderInClient(rpcManager, {\n            ...renderArgs,\n            ...renderProps,\n            viewParams: getViewParams(self, true),\n            exportSVG: opts,\n          })\n        }),\n      )\n\n      return (\n        <>\n          {renderings.map((rendering, index) => {\n            const { offsetPx } = roundedDynamicBlocks[index]\n            const offset = offsetPx - viewOffsetPx\n            const clipid = getId(id, index)\n\n            return (\n              <React.Fragment key={`frag-${index}`}>\n                <defs>\n                  <clipPath id={clipid}>\n                    <rect\n                      x={0}\n                      y={0}\n                      width={width}\n                      height={overrideHeight || height}\n                    />\n                  </clipPath>\n                </defs>\n                <g transform={`translate(${offset} 0)`}>\n                  <g clipPath={`url(#${clipid})`}>\n                    {React.isValidElement(rendering.reactElement) ? (\n                      rendering.reactElement\n                    ) : (\n                      // eslint-disable-next-line react/no-danger\n                      <g dangerouslySetInnerHTML={{ __html: rendering.html }} />\n                    )}\n                  </g>\n                </g>\n              </React.Fragment>\n            )\n          })}\n        </>\n      )\n    },\n  }))\n  .postProcessSnapshot(self => {\n    const { blockState, ...rest } = self\n    return rest\n  })\n\nexport type BaseLinearDisplayStateModel = typeof BaseLinearDisplay\nexport type BaseLinearDisplayModel = Instance<BaseLinearDisplayStateModel>\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { getParentRenderProps } from '@jbrowse/core/util/tracks'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearBareDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBareDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            ...getParentRenderProps(self),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { lazy } from 'react'\nimport {\n  getConf,\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n} from '@jbrowse/core/configuration'\nimport { getSession } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { types, getEnv, Instance } from 'mobx-state-tree'\n\n// icons\nimport VisibilityIcon from '@material-ui/icons/Visibility'\n\n// locals\nimport { BaseLinearDisplay } from '../BaseLinearDisplay'\n\nconst SetMaxHeightDlg = lazy(() => import('./components/SetMaxHeight'))\n\nconst stateModelFactory = (configSchema: AnyConfigurationSchemaType) =>\n  types\n    .compose(\n      'LinearBasicDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearBasicDisplay'),\n        trackShowLabels: types.maybe(types.boolean),\n        trackShowDescriptions: types.maybe(types.boolean),\n        trackDisplayMode: types.maybe(types.string),\n        trackMaxHeight: types.maybe(types.number),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return getConf(self, ['renderer', 'type'])\n      },\n\n      get showLabels() {\n        return self.trackShowLabels ?? getConf(self, ['renderer', 'showLabels'])\n      },\n\n      get showDescriptions() {\n        return (\n          self.trackShowDescriptions ??\n          getConf(self, ['renderer', 'showDescriptions'])\n        )\n      },\n\n      get maxHeight() {\n        return self.trackMaxHeight ?? getConf(self, ['renderer', 'maxHeight'])\n      },\n\n      get displayMode() {\n        const displayMode = getConf(self, ['renderer', 'displayMode'])\n        return self.trackDisplayMode ?? displayMode\n      },\n      get rendererConfig() {\n        const configBlob = getConf(self, ['renderer']) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            showLabels: this.showLabels,\n            showDescriptions: this.showDescriptions,\n            displayMode: this.displayMode,\n            maxHeight: this.maxHeight,\n          },\n          getEnv(self),\n        )\n      },\n    }))\n\n    .actions(self => ({\n      toggleShowLabels() {\n        self.trackShowLabels = !self.showLabels\n      },\n      toggleShowDescriptions() {\n        self.trackShowDescriptions = !self.showDescriptions\n      },\n      setDisplayMode(val: string) {\n        self.trackDisplayMode = val\n      },\n      setMaxHeight(val: number) {\n        self.trackMaxHeight = val\n      },\n    }))\n    .views(self => {\n      const {\n        trackMenuItems: superTrackMenuItems,\n        renderProps: superRenderProps,\n      } = self\n      return {\n        renderProps() {\n          const config = self.rendererConfig\n\n          return {\n            ...superRenderProps(),\n            config,\n          }\n        },\n\n        trackMenuItems(): MenuItem[] {\n          return [\n            ...superTrackMenuItems(),\n            {\n              label: 'Show labels',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showLabels,\n              onClick: () => {\n                self.toggleShowLabels()\n              },\n            },\n            {\n              label: 'Show descriptions',\n              icon: VisibilityIcon,\n              type: 'checkbox',\n              checked: self.showDescriptions,\n              onClick: () => self.toggleShowDescriptions(),\n            },\n            {\n              label: 'Display mode',\n              icon: VisibilityIcon,\n              subMenu: [\n                'compact',\n                'reducedRepresentation',\n                'normal',\n                'collapse',\n              ].map(val => ({\n                label: val,\n                onClick: () => {\n                  self.setDisplayMode(val)\n                },\n              })),\n            },\n            {\n              label: 'Set max height',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetMaxHeightDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n\nexport type FeatureTrackStateModel = ReturnType<typeof stateModelFactory>\nexport type FeatureTrackModel = Instance<FeatureTrackStateModel>\n\nexport default stateModelFactory\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport default function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBasicDisplay',\n    {\n      mouseover: {\n        type: 'string',\n        description: 'what to display in a given mouseover',\n        defaultValue: `jexl:get(feature,'name')`,\n\n        contextVariable: ['feature'],\n      },\n      renderer: pluginManager.pluggableConfigSchemaType('renderer'),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n","import { lazy } from 'react'\nimport { when } from 'mobx'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport LineStyleIcon from '@material-ui/icons/LineStyle'\nimport {\n  BaseLinearDisplay,\n  BaseLinearDisplayComponent,\n  baseLinearDisplayConfigSchema,\n  BlockModel,\n} from './BaseLinearDisplay'\nimport {\n  configSchemaFactory as linearBareDisplayConfigSchemaFactory,\n  stateModelFactory as LinearBareDisplayStateModelFactory,\n} from './LinearBareDisplay'\nimport {\n  LinearGenomeViewModel,\n  LinearGenomeViewStateModel,\n  stateModelFactory as linearGenomeViewStateModelFactory,\n  renderToSvg,\n  RefNameAutocomplete,\n  SearchBox,\n} from './LinearGenomeView'\n\nimport {\n  configSchema as linearBasicDisplayConfigSchemaFactory,\n  modelFactory as linearBasicDisplayModelFactory,\n} from './LinearBasicDisplay'\n\ntype LGV = LinearGenomeViewModel\n\nexport default class LinearGenomeViewPlugin extends Plugin {\n  name = 'LinearGenomeViewPlugin'\n\n  exports = {\n    BaseLinearDisplayComponent,\n    BaseLinearDisplay,\n    baseLinearDisplayConfigSchema,\n  }\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'FeatureTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'FeatureTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'FeatureTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'BasicTrack',\n        {},\n        {\n          baseConfiguration: createBaseTrackConfig(pluginManager),\n          explicitIdentifier: 'trackId',\n        },\n      )\n      return new TrackType({\n        name: 'BasicTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'BasicTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBareDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBareDisplay',\n        configSchema,\n        stateModel: LinearBareDisplayStateModelFactory(configSchema),\n        trackType: 'BasicTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearBasicDisplay',\n        configSchema,\n        stateModel: linearBasicDisplayModelFactory(configSchema),\n        trackType: 'FeatureTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addViewType(\n      () =>\n        new ViewType({\n          name: 'LinearGenomeView',\n          stateModel: linearGenomeViewStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./LinearGenomeView/components/LinearGenomeView'),\n          ),\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-LinearGenomeView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        loc,\n        tracks = [],\n      }: {\n        session: AbstractSessionModel\n        assembly?: string\n        loc: string\n        tracks?: string[]\n      }) => {\n        try {\n          const { assemblyManager } = session\n          const view = session.addView('LinearGenomeView', {}) as LGV\n\n          await when(() => !!view.volatileWidth)\n\n          if (!assembly) {\n            throw new Error(\n              'No assembly provided when launching linear genome view',\n            )\n          }\n\n          const asm = await assemblyManager.waitForAssembly(assembly)\n          if (!asm) {\n            throw new Error(\n              `Assembly \"${assembly}\" not found when launching linear genome view`,\n            )\n          }\n\n          view.navToLocString(loc, assembly)\n\n          const idsNotFound = [] as string[]\n          tracks.forEach(track => {\n            try {\n              view.showTrack(track)\n            } catch (e) {\n              if (`${e}`.match('Could not resolve identifier')) {\n                idsNotFound.push(track)\n              } else {\n                throw e\n              }\n            }\n          })\n          if (idsNotFound.length) {\n            throw new Error(\n              `Could not resolve identifiers: ${idsNotFound.join(',')}`,\n            )\n          }\n        } catch (e) {\n          session.notify(`${e}`, 'error')\n          throw e\n        }\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'Linear genome view',\n        icon: LineStyleIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('LinearGenomeView', {})\n        },\n      })\n    }\n  }\n}\n\nexport {\n  baseLinearDisplayConfigSchema,\n  linearBareDisplayConfigSchemaFactory,\n  linearBasicDisplayConfigSchemaFactory,\n  linearBasicDisplayModelFactory,\n  renderToSvg,\n  BaseLinearDisplayComponent,\n  BaseLinearDisplay,\n  RefNameAutocomplete,\n  SearchBox,\n}\n\nexport type { LinearGenomeViewModel, LinearGenomeViewStateModel, BlockModel }\n\nexport type { BaseLinearDisplayModel } from './BaseLinearDisplay'\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '../BaseLinearDisplay'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearBareDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationReference,\n} from '@jbrowse/core/configuration/configurationSchema'\nimport { types } from 'mobx-state-tree'\nimport { BaseLinearDisplay } from '@jbrowse/plugin-linear-genome-view'\n\nexport function stateModelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearLollipopDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearLollipopDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        get blockType() {\n          return 'dynamicBlocks'\n        },\n        get renderDelay() {\n          return 500\n        },\n        renderProps() {\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n          }\n        },\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n}\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction ScoreText({\n  feature,\n  config,\n  layoutRecord: {\n    y,\n    data: { anchorX, radiusPx, score },\n  },\n}) {\n  const innerColor = readConfObject(config, 'innerColor', { feature })\n\n  const scoreString = String(score)\n  const fontWidth = (radiusPx * 2) / scoreString.length\n  const fontHeight = fontWidth * 1.1\n  if (fontHeight < 12) {\n    return null\n  }\n  return (\n    <text\n      style={{ fontSize: fontHeight, fill: contrastingTextColor(innerColor) }}\n      x={anchorX}\n      y={y + radiusPx - fontHeight / 2.4}\n      textAnchor=\"middle\"\n      dominantBaseline=\"hanging\"\n    >\n      {scoreString}\n    </text>\n  )\n}\n\nScoreText.propTypes = {\n  feature: ReactPropTypes.shape({ get: ReactPropTypes.func.isRequired })\n    .isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }).isRequired,\n  }).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\n\nfunction Lollipop(props) {\n  const onFeatureMouseDown = event => {\n    const { onFeatureMouseDown: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseEnter = event => {\n    const { onFeatureMouseEnter: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOut = event => {\n    const { onFeatureMouseOut: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseOver = event => {\n    const { onFeatureMouseOver: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseUp = event => {\n    const { onFeatureMouseUp: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseLeave = event => {\n    const { onFeatureMouseLeave: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureMouseMove = event => {\n    const { onFeatureMouseMove: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event, feature.id())\n  }\n\n  const onFeatureClick = event => {\n    const { onFeatureClick: handler, feature } = props\n    if (!handler) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, feature.id())\n  }\n\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx, score },\n    },\n    selectedFeatureId,\n  } = props\n\n  const styleOuter = {\n    fill: readConfObject(config, 'strokeColor', { feature }),\n  }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    styleOuter.fill = 'red'\n  }\n\n  const styleInner = {\n    fill: readConfObject(config, 'innerColor', { feature }),\n  }\n\n  const strokeWidth = readConfObject(config, 'strokeWidth', { feature })\n\n  return (\n    <g data-testid={feature.id()}>\n      <title>{readConfObject(config, 'caption', { feature })}</title>\n      <circle\n        cx={anchorLocation}\n        cy={y + radiusPx}\n        r={radiusPx}\n        style={styleOuter}\n        onMouseDown={onFeatureMouseDown}\n        onMouseEnter={onFeatureMouseEnter}\n        onMouseOut={onFeatureMouseOut}\n        onMouseOver={onFeatureMouseOver}\n        onMouseUp={onFeatureMouseUp}\n        onMouseLeave={onFeatureMouseLeave}\n        onMouseMove={onFeatureMouseMove}\n        onClick={onFeatureClick}\n        onFocus={onFeatureMouseOver}\n        onBlur={onFeatureMouseOut}\n      />\n      {radiusPx - strokeWidth <= 2 ? null : (\n        <circle\n          cx={anchorLocation}\n          cy={y + radiusPx}\n          r={radiusPx - strokeWidth}\n          style={styleInner}\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n        />\n      )}\n      <ScoreText {...props} score={score} />\n    </g>\n  )\n}\nLollipop.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({\n      anchorX: ReactPropTypes.number.isRequired,\n      radiusPx: ReactPropTypes.number.isRequired,\n      score: ReactPropTypes.number.isRequired,\n    }),\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n\n  onFeatureMouseDown: ReactPropTypes.func,\n  onFeatureMouseEnter: ReactPropTypes.func,\n  onFeatureMouseOut: ReactPropTypes.func,\n  onFeatureMouseOver: ReactPropTypes.func,\n  onFeatureMouseUp: ReactPropTypes.func,\n  onFeatureMouseLeave: ReactPropTypes.func,\n  onFeatureMouseMove: ReactPropTypes.func,\n\n  // synthesized from mouseup and mousedown\n  onFeatureClick: ReactPropTypes.func,\n}\n\nLollipop.defaultProps = {\n  selectedFeatureId: undefined,\n\n  onFeatureMouseDown: undefined,\n  onFeatureMouseEnter: undefined,\n  onFeatureMouseOut: undefined,\n  onFeatureMouseOver: undefined,\n  onFeatureMouseUp: undefined,\n  onFeatureMouseLeave: undefined,\n  onFeatureMouseMove: undefined,\n\n  onFeatureClick: undefined,\n}\nexport default observer(Lollipop)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\n\nfunction Stick(props) {\n  const {\n    feature,\n    config,\n    layoutRecord: {\n      anchorLocation,\n      y,\n      data: { radiusPx },\n    },\n    selectedFeatureId,\n  } = props\n\n  const style = { fill: readConfObject(config, 'bodyColor', { feature }) }\n  if (String(selectedFeatureId) === String(feature.id())) {\n    style.fill = 'red'\n  }\n  return (\n    <line\n      x1={anchorLocation}\n      y1={0}\n      x2={anchorLocation}\n      y2={y + 2 * radiusPx}\n      stroke={readConfObject(config, 'stickColor', { feature })}\n      strokeWidth={readConfObject(config, 'stickWidth', { feature })}\n    />\n  )\n}\nStick.propTypes = {\n  feature: ReactPropTypes.shape({\n    id: ReactPropTypes.func.isRequired,\n    get: ReactPropTypes.func.isRequired,\n  }).isRequired,\n  // bpPerPx: ReactPropTypes.number.isRequired,\n  // region: CommonPropTypes.Region.isRequired,\n  // config: CommonPropTypes.ConfigSchema.isRequired,\n  layoutRecord: ReactPropTypes.shape({\n    x: ReactPropTypes.number.isRequired,\n    y: ReactPropTypes.number.isRequired,\n    width: ReactPropTypes.number.isRequired,\n    height: ReactPropTypes.number.isRequired,\n    anchorLocation: ReactPropTypes.number.isRequired,\n    data: ReactPropTypes.shape({ radiusPx: ReactPropTypes.number.isRequired })\n      .isRequired,\n  }).isRequired,\n\n  selectedFeatureId: ReactPropTypes.string,\n\n  config: CommonPropTypes.ConfigSchema.isRequired,\n}\nStick.defaultProps = {\n  selectedFeatureId: undefined,\n}\n\nexport default observer(Stick)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { bpToPx } from '@jbrowse/core/util'\nimport { observer } from 'mobx-react'\nimport ReactPropTypes from 'prop-types'\nimport React from 'react'\nimport Lollipop from './Lollipop'\nimport Stick from './Stick'\n\nfunction LollipopRendering(props) {\n  const onMouseDown = event => {\n    const { onMouseDown: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseUp = event => {\n    const { onMouseUp: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseEnter = event => {\n    const { onMouseEnter: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseLeave = event => {\n    const { onMouseLeave: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOver = event => {\n    const { onMouseOver: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onMouseOut = event => {\n    const { onMouseOut: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  const onClick = event => {\n    const { onClick: handler } = props\n    if (!handler) {\n      return undefined\n    }\n    return handler(event)\n  }\n\n  function layoutFeat(args) {\n    const { feature, bpPerPx, region, layout } = args\n\n    const centerBp = Math.abs(feature.get('end') + feature.get('start')) / 2\n    const centerPx = bpToPx(centerBp, region, bpPerPx)\n    const radiusPx = readConfObject(args.config, 'radius', { feature })\n\n    if (!radiusPx) {\n      console.error(\n        new Error(\n          `lollipop radius ${radiusPx} configured for feature ${feature.id()}`,\n        ),\n      )\n    }\n    layout.add(feature.id(), centerPx, radiusPx * 2, radiusPx * 2, {\n      featureId: feature.id(),\n      anchorX: centerPx,\n      radiusPx,\n      score: readConfObject(args.config, 'score', { feature }),\n    })\n  }\n\n  const {\n    regions,\n    bpPerPx,\n    layout,\n    config,\n    features,\n    displayModel: { selectedFeatureId },\n  } = props\n\n  const [region] = regions\n  const sticksRendered = []\n  const lollipopsRendered = []\n  for (const feature of features.values()) {\n    layoutFeat({\n      feature,\n      bpPerPx,\n      region,\n      config,\n      layout,\n    })\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Stick\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`stick-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  for (const layoutRecord of layout.getLayout(config).values()) {\n    const feature = features.get(layoutRecord.data.featureId)\n    lollipopsRendered.push(\n      <Lollipop\n        {...props}\n        layoutRecord={layoutRecord}\n        feature={feature}\n        key={`body-${feature.id()}`}\n        selectedFeatureId={selectedFeatureId}\n      />,\n    )\n  }\n\n  const width = (region.end - region.start) / bpPerPx\n  const height = layout.getTotalHeight()\n\n  return (\n    <svg\n      className=\"LollipopRendering\"\n      width={width}\n      height={height}\n      style={{\n        position: 'relative',\n      }}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onFocus={onMouseEnter}\n      onBlur={onMouseLeave}\n      onClick={onClick}\n    >\n      {sticksRendered}\n      {lollipopsRendered}\n    </svg>\n  )\n}\n\nLollipopRendering.propTypes = {\n  layout: ReactPropTypes.shape({\n    getLayout: ReactPropTypes.func.isRequired,\n    add: ReactPropTypes.func.isRequired,\n    getTotalHeight: ReactPropTypes.func.isRequired,\n  }).isRequired,\n\n  regions: ReactPropTypes.arrayOf(CommonPropTypes.Region).isRequired,\n  bpPerPx: ReactPropTypes.number.isRequired,\n  features: ReactPropTypes.instanceOf(Map),\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: ReactPropTypes.shape({\n    /** id of the currently selected feature, if any */\n    selectedFeatureId: ReactPropTypes.string,\n  }),\n\n  onMouseDown: ReactPropTypes.func,\n  onMouseUp: ReactPropTypes.func,\n  onMouseEnter: ReactPropTypes.func,\n  onMouseLeave: ReactPropTypes.func,\n  onMouseOver: ReactPropTypes.func,\n  onMouseOut: ReactPropTypes.func,\n  onClick: ReactPropTypes.func,\n}\n\nLollipopRendering.defaultProps = {\n  displayModel: {},\n\n  features: new Map(),\n\n  onMouseDown: undefined,\n  onMouseUp: undefined,\n  onMouseEnter: undefined,\n  onMouseLeave: undefined,\n  onMouseOver: undefined,\n  onMouseOut: undefined,\n  onClick: undefined,\n}\n\nexport default observer(LollipopRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'LollipopRenderer',\n  {\n    strokeColor: {\n      type: 'color',\n      description: 'the outer color of each lollipop',\n      defaultValue: 'green',\n      contextVariable: ['feature'],\n    },\n    innerColor: {\n      type: 'color',\n      description: 'the inner color of each lollipop',\n      defaultValue: '#7fc75f',\n      contextVariable: ['feature'],\n    },\n    strokeWidth: {\n      type: 'number',\n      description: 'width of the stroked border',\n      defaultValue: 4,\n      contextVariable: ['feature'],\n    },\n    radius: {\n      type: 'number',\n      description: 'radius in pixels of each lollipop body',\n      defaultValue: `jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))`,\n      contextVariable: ['feature'],\n    },\n    caption: {\n      type: 'string',\n      description:\n        'the tooltip caption displayed when the mouse hovers over a lollipop',\n      defaultValue: `jexl:get(feature,'name')`,\n      contextVariable: ['feature'],\n    },\n    minStickLength: {\n      type: 'number',\n      description: 'minimum lollipop \"stick\" length, in pixels',\n      defaultValue: 5,\n    },\n    stickColor: {\n      type: 'color',\n      description: 'color of the lollipop stick',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    stickWidth: {\n      type: 'number',\n      description: 'width in pixels of the lollipop stick',\n      defaultValue: 2,\n      contextVariable: ['feature'],\n    },\n    score: {\n      type: 'number',\n      description:\n        'the \"score\" of each lollipop, displayed as a number in the center of the circle',\n      defaultValue: `jexl:get(feature,'score')`,\n      contextVariable: ['feature'],\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { doesIntersect2 } from '@jbrowse/core/util/range'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\n\ninterface LayoutItem {\n  uniqueId: string\n  anchorLocation: number\n  width: number\n  height: number\n  data: { score: number }\n}\n\ntype LayoutEntry = LayoutItem & { x: number; y: number }\n\ntype LayoutMap = Map<string, LayoutEntry>\n\nexport class FloatingLayout {\n  width: number\n\n  totalHeight = 0\n\n  constructor({ width }: { width: number }) {\n    if (!width) {\n      throw new Error('width required to make a new FloatingLayout')\n    }\n    this.width = width\n  }\n\n  items: LayoutItem[] = []\n\n  layout: LayoutMap = new Map()\n\n  layoutDirty = false\n\n  add(\n    uniqueId: string,\n    anchorLocation: number,\n    width: number,\n    height: number,\n    data: { score: number },\n  ) {\n    this.items.push({ uniqueId, anchorLocation, width, height, data })\n    this.layoutDirty = true\n  }\n\n  /**\n   * @returns Map of `uniqueId => {x,y,anchorLocation,width,height,data}`\n   */\n  getLayout(configuration?: AnyConfigurationModel) {\n    if (!this.layoutDirty) {\n      return this.layout\n    }\n    if (!configuration) {\n      throw new Error('configuration object required')\n    }\n\n    const minY = readConfObject(configuration, 'minStickLength')\n\n    // sort them by score ascending, so higher scores will always end up\n    // stacked last (toward the bottom)\n    const sorted = this.items.sort((a, b) => a.data.score - b.data.score)\n\n    // bump them\n    let maxBottom = 0\n    const layoutEntries: [string, LayoutEntry][] = Array(sorted.length)\n    for (let i = 0; i < sorted.length; i += 1) {\n      const currentItem = sorted[i]\n      const { anchorLocation, width, height } = currentItem\n      const start = anchorLocation - width / 2\n      const end = start + width\n      let top = minY\n      let bottom = top + height\n\n      // figure out how far down to put it\n      for (let j = 0; j < i; j += 1) {\n        const [, previouslyLayedOutItem] = layoutEntries[j]\n        const {\n          x: prevStart,\n          y: prevTop,\n          width: prevWidth,\n          height: prevHeight,\n        } = previouslyLayedOutItem\n        const prevEnd = prevStart + prevWidth\n        const prevBottom = prevTop + prevHeight\n        if (\n          doesIntersect2(prevStart, prevEnd, start, end) &&\n          doesIntersect2(prevTop, prevBottom, top, bottom)\n        ) {\n          // bump this one to the bottom of the previous one\n          top = prevBottom\n          bottom = top + height\n          j = -1 // we need to check all of them again after bumping\n        }\n      }\n\n      // record the entry and update the maxBottom\n      layoutEntries[i] = [\n        currentItem.uniqueId,\n        { ...currentItem, x: start, y: top },\n      ]\n      if (bottom > maxBottom) {\n        maxBottom = bottom\n      }\n    }\n\n    // try to tile them left to right all at the same level\n    // if they don't fit, try to alternate them on 2 levels, then 3\n    this.totalHeight = maxBottom\n    this.layout = new Map(layoutEntries)\n    this.layoutDirty = false\n    return this.layout\n  }\n\n  getTotalHeight() {\n    if (this.layoutDirty) {\n      throw new Error('getTotalHeight does not work when the layout is dirty.')\n    }\n    return this.totalHeight\n  }\n\n  serializeRegion() {\n    return this.toJSON()\n  }\n\n  toJSON() {\n    if (this.layoutDirty) {\n      throw new Error('toJSON does not work when the layout is dirty.')\n    }\n    return { pairs: [...this.getLayout()], totalHeight: this.getTotalHeight() }\n  }\n\n  static fromJSON() {\n    throw new Error('not supported')\n  }\n}\n\nexport class PrecomputedFloatingLayout {\n  layout: LayoutMap\n\n  totalHeight: number\n\n  constructor({\n    pairs,\n    totalHeight,\n  }: {\n    pairs: [string, LayoutEntry][]\n    totalHeight: number\n  }) {\n    this.layout = new Map(pairs)\n    this.totalHeight = totalHeight\n  }\n\n  add(uniqueId: string) {\n    if (!this.layout.has(uniqueId)) {\n      throw new Error(`layout error, precomputed layout is missing ${uniqueId}`)\n    }\n  }\n\n  getLayout() {\n    return this.layout\n  }\n\n  getTotalHeight() {\n    return this.totalHeight\n  }\n\n  static fromJSON(\n    json: ConstructorParameters<typeof PrecomputedFloatingLayout>[0],\n  ) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import BoxRendererType, {\n  LayoutSession,\n} from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport MultiLayout from '@jbrowse/core/util/layouts/MultiLayout'\nimport { FloatingLayout, PrecomputedFloatingLayout } from './Layout'\n\nclass FloatingLayoutSession extends LayoutSession {\n  makeLayout() {\n    'sequenceAdapter'\n\n    const { end, start } = this.regions[0]\n    const widthPx = (end - start) / this.bpPerPx\n    return new MultiLayout(FloatingLayout, { width: widthPx })\n  }\n\n  layoutIsValid(/* layout */) {\n    return false // layout.left layout.width === this.width\n  }\n}\n\nexport default class extends BoxRendererType {\n  createSession(args) {\n    return new FloatingLayoutSession(args)\n  }\n\n  deserializeLayoutInClient(json) {\n    return new PrecomputedFloatingLayout(json)\n  }\n}\n","import DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  configSchemaFactory as linearLollipopDisplayConfigSchemaFactory,\n  stateModelFactory as LinearLollipopDisplayStateModelFactory,\n} from './LinearLollipopDisplay'\nimport LollipopRenderer, {\n  configSchema as lollipopRendererConfigSchema,\n  ReactComponent as LollipopRendererReactComponent,\n} from './LollipopRenderer'\n\nexport default class extends Plugin {\n  name = 'LollipopPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new LollipopRenderer({\n          name: 'LollipopRenderer',\n          ReactComponent: LollipopRendererReactComponent,\n          configSchema: lollipopRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema =\n        linearLollipopDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearLollipopDisplay',\n        configSchema,\n        stateModel: LinearLollipopDisplayStateModelFactory(configSchema),\n        trackType: 'LollipopTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n  }\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\n\nexport function configSchemaFactory(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'LinearLollipopDisplay',\n    { renderer: pluginManager.pluggableConfigSchemaType('renderer') },\n    {\n      baseConfiguration: baseLinearDisplayConfigSchema,\n      explicitlyTyped: true,\n    },\n  )\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('AboutWidget', {})\n\nexport const stateModel = types.model('AboutWidget', {\n  id: ElementId,\n  type: types.literal('AboutWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('HelpWidget', {})\n\nexport const stateModel = types.model('HelpWidget', {\n  id: ElementId,\n  type: types.literal('HelpWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('ImportSessionWidget', {})\n\nexport const stateModel = types.model('ImportSessionWidget', {\n  id: ElementId,\n  type: types.literal('ImportSessionWidget'),\n})\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\nimport { types } from 'mobx-state-tree'\n\nexport const configSchema = ConfigurationSchema('SessionManager', {})\n\nexport const stateModel = types.model('SessionManager', {\n  id: ElementId,\n  type: types.literal('SessionManager'),\n})\n","import { lazy } from 'react'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { SessionWithWidgets, isAbstractMenuManager } from '@jbrowse/core/util'\n\nimport HelpIcon from '@material-ui/icons/Help'\nimport InfoIcon from '@material-ui/icons/Info'\n\nimport {\n  configSchema as aboutConfigSchema,\n  stateModel as aboutStateModel,\n} from './AboutWidget'\nimport {\n  configSchema as helpConfigSchema,\n  stateModel as helpStateModel,\n} from './HelpWidget'\nimport {\n  configSchema as importSessionConfigSchema,\n  stateModel as importSessionStateModel,\n} from './ImportSessionWidget'\nimport {\n  configSchema as sessionManagerConfigSchema,\n  stateModel as sessionManagerStateModel,\n} from './SessionManager'\n\nexport default class extends Plugin {\n  name = 'MenusPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'AboutWidget',\n        heading: 'About',\n        configSchema: aboutConfigSchema,\n        stateModel: aboutStateModel,\n        ReactComponent: lazy(\n          () => import('./AboutWidget/components/AboutWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'HelpWidget',\n        heading: 'Help',\n        configSchema: helpConfigSchema,\n        stateModel: helpStateModel,\n        ReactComponent: lazy(\n          () => import('./HelpWidget/components/HelpWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'ImportSessionWidget',\n        heading: 'Import session',\n        configSchema: importSessionConfigSchema,\n        stateModel: importSessionStateModel,\n        ReactComponent: lazy(\n          () => import('./ImportSessionWidget/components/ImportSessionWidget'),\n        ),\n      })\n    })\n\n    pluginManager.addWidgetType(() => {\n      return new WidgetType({\n        name: 'SessionManager',\n        heading: 'Sessions',\n        configSchema: sessionManagerConfigSchema,\n        stateModel: sessionManagerStateModel,\n        ReactComponent: lazy(\n          () => import('./SessionManager/components/SessionManager'),\n        ),\n      })\n    })\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'About',\n        icon: InfoIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('AboutWidget', 'aboutWidget')\n          session.showWidget(widget)\n        },\n      })\n      pluginManager.rootModel.appendToMenu('Help', {\n        label: 'Help',\n        icon: HelpIcon,\n        onClick: (session: SessionWithWidgets) => {\n          const widget = session.addWidget('HelpWidget', 'helpWidget')\n          session.showWidget(widget)\n        },\n      })\n    }\n  }\n}\n","import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport SimpleFeature, { Feature } from '@jbrowse/core/util/simpleFeature'\nimport format from 'string-template'\n\nimport { Instance } from 'mobx-state-tree'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport MyConfigSchema from './configSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\ninterface SPARQLEntry {\n  type: string\n  value: string\n  dataTypes?: string\n}\n\ninterface SPARQLBinding {\n  [key: string]: SPARQLEntry\n}\n\ninterface SPARQLResponseHead {\n  vars: string[]\n}\n\ninterface SPARQLResponseResults {\n  bindings: SPARQLBinding[]\n}\n\ninterface SPARQLResponse {\n  head: SPARQLResponseHead\n  results: SPARQLResponseResults\n}\n\ninterface SPARQLFeatureData {\n  start: number\n  end: number\n  strand: number\n  subfeatures?: SPARQLFeatureData[]\n  uniqueId: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [propName: string]: any\n}\n\ninterface SPARQLFeature {\n  data: SPARQLFeatureData\n}\n\nexport default class SPARQLAdapter extends BaseFeatureDataAdapter {\n  private endpoint: string\n\n  private queryTemplate: string\n\n  private refNamesQueryTemplate: string\n\n  private additionalQueryParams: string[]\n\n  private configRefNames: string[]\n\n  private refNames: string[] | undefined\n\n  public constructor(\n    config: Instance<typeof MyConfigSchema>,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    this.endpoint = readConfObject(config, 'endpoint').uri\n    this.queryTemplate = readConfObject(config, 'queryTemplate')\n    this.additionalQueryParams = readConfObject(config, 'additionalQueryParams')\n    this.refNamesQueryTemplate = readConfObject(config, 'refNamesQueryTemplate')\n    this.configRefNames = readConfObject(config, 'refNames')\n  }\n\n  public async getRefNames(opts: BaseOptions = {}): Promise<string[]> {\n    if (this.refNames) {\n      return this.refNames\n    }\n    let refNames = [] as string[]\n    if (this.refNamesQueryTemplate) {\n      const queryTemplate = encodeURIComponent(this.refNamesQueryTemplate)\n      const results = await this.querySparql(queryTemplate, opts)\n      refNames = this.resultsToRefNames(results)\n    } else if (this.configRefNames) {\n      refNames = this.configRefNames\n    }\n    this.refNames = refNames\n    return refNames\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const filledTemplate = encodeURIComponent(\n        format(this.queryTemplate, query),\n      )\n      const { refName } = query\n      const results = await this.querySparql(filledTemplate, opts)\n      this.resultsToFeatures(results, refName).forEach(feature => {\n        observer.next(feature)\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private async querySparql(query: string, opts?: BaseOptions): Promise<any> {\n    let additionalQueryParams = ''\n    if (this.additionalQueryParams.length) {\n      additionalQueryParams = `&${this.additionalQueryParams.join('&')}`\n    }\n    const signal = opts && opts.signal\n    const response = await fetch(\n      `${this.endpoint}?query=${query}${additionalQueryParams}`,\n      {\n        headers: { accept: 'application/json,application/sparql-results+json' },\n        signal,\n      },\n    )\n    return response.json()\n  }\n\n  private resultsToRefNames(response: SPARQLResponse): string[] {\n    const rows = ((response || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = response.head.vars\n    if (!fields.includes('refName')) {\n      throw new Error('\"refName\" not found in refNamesQueryTemplate response')\n    }\n    return rows.map(row => row.refName.value)\n  }\n\n  private resultsToFeatures(\n    results: SPARQLResponse,\n    refName: string,\n  ): SimpleFeature[] {\n    const rows = ((results || {}).results || {}).bindings || []\n    if (!rows.length) {\n      return []\n    }\n    const fields = results.head.vars\n    const requiredFields = ['start', 'end', 'uniqueId']\n    requiredFields.forEach(requiredField => {\n      if (!fields.includes(requiredField)) {\n        console.error(\n          `Required field ${requiredField} missing from feature data`,\n        )\n      }\n    })\n    const seenFeatures: Record<string, SPARQLFeature> = {}\n    rows.forEach(row => {\n      const rawData: Record<string, string>[] = [{}]\n      fields.forEach(field => {\n        if (field in row) {\n          const { value } = row[field]\n          let idx = 0\n          while (field.startsWith('sub_')) {\n            field = field.slice(4)\n            idx += 1\n          }\n          while (idx > rawData.length - 1) {\n            rawData.push({})\n          }\n          rawData[idx][field] = value\n        }\n      })\n\n      rawData.forEach((rd, idx) => {\n        const { uniqueId } = rd\n        if (idx < rawData.length - 1) {\n          rawData[idx + 1].parentUniqueId = uniqueId\n        }\n        seenFeatures[uniqueId] = {\n          data: {\n            ...rd,\n            uniqueId,\n            refName,\n            start: parseInt(rd.start, 10),\n            end: parseInt(rd.end, 10),\n            strand: parseInt(rd.strand, 10) || 0,\n          },\n        }\n      })\n    })\n\n    // resolve subfeatures, keeping only top-level features in seenFeatures\n    for (const [uniqueId, f] of Object.entries(seenFeatures)) {\n      const pid = f.data.parentUniqueId\n      delete f.data.parentUniqueId\n      if (pid) {\n        const p = seenFeatures[pid]\n        if (p) {\n          if (!p.data.subfeatures) {\n            p.data.subfeatures = []\n          }\n          p.data.subfeatures.push({\n            ...f.data,\n            uniqueId,\n          })\n          delete seenFeatures[uniqueId]\n        } else {\n          const subfeatures = Object.values(seenFeatures)\n            .map(sf => sf.data.subfeatures)\n            .filter(sf => !!sf)\n            .flat()\n          let found = false\n          for (const subfeature of subfeatures) {\n            if (subfeature && subfeature.uniqueId === pid) {\n              if (!subfeature.subfeatures) {\n                subfeature.subfeatures = []\n              }\n              subfeature.subfeatures.push({\n                ...f.data,\n                uniqueId,\n              })\n              delete seenFeatures[uniqueId]\n              found = true\n              break\n            } else if (subfeature && subfeature.subfeatures) {\n              subfeatures.push(...subfeature.subfeatures)\n            }\n          }\n          if (!found) {\n            console.error(`Could not find parentID ${pid}`)\n          }\n        }\n      }\n    }\n\n    return Object.keys(seenFeatures).map(\n      seenFeature =>\n        new SimpleFeature({\n          ...seenFeatures[seenFeature].data,\n          uniqueId: seenFeature,\n          subfeatures: seenFeatures[seenFeature].data.subfeatures,\n        }),\n    )\n  }\n\n  public async hasDataForRefName(\n    refName: string,\n    opts: BaseOptions = {},\n  ): Promise<boolean> {\n    const refNames = await this.getRefNames(opts)\n    if (refNames.length && !refNames.includes(refName)) {\n      return false\n    }\n    return true\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'SPARQLAdapter',\n  {\n    endpoint: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: 'https://somesite.com/sparql',\n        locationType: 'UriLocation',\n      },\n      description: 'URL of the SPARQL endpoint',\n    },\n    queryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query where {start} {end} and {refName} will get replaced for each call',\n    },\n    refNamesQueryTemplate: {\n      type: 'text',\n      defaultValue: '',\n      description:\n        'SPARQL query that returns the possible refNames in a ?refName column',\n    },\n    refNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Possible refNames used by the SPARQL endpoint (ignored if \"refNamesQueryTemplate\" is provided)',\n    },\n    additionalQueryParams: {\n      type: 'stringArray',\n      defaultValue: [],\n      description:\n        'Additional parameters to add to the query, e.g. \"format=JSON\"',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport {\n  AdapterClass as SPARQLAdapterClass,\n  configSchema as sparqlAdapterConfigSchema,\n} from './SPARQLAdapter'\nimport { AdapterGuesser, getFileName } from '@jbrowse/core/util/tracks'\n\nexport default class RdfPlugin extends Plugin {\n  name = 'RdfPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'SPARQLAdapter',\n          configSchema: sparqlAdapterConfigSchema,\n          AdapterClass: SPARQLAdapterClass,\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\/sparql$/i\n          const adapterName = 'SPARQLAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              endpoint: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BgzipFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.gz', locationType: 'UriLocation' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.fai',\n        locationType: 'UriLocation',\n      },\n    },\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n    gziLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/seq.fa.gz.gzi',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'ChromSizesAdapter',\n  {\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/species.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React from 'react'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport { contrastingTextColor } from '@jbrowse/core/util/color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { createJBrowseTheme } from '@jbrowse/core/ui'\nimport { observer } from 'mobx-react'\nimport {\n  bpSpanPx,\n  revcom,\n  complement,\n  defaultStarts,\n  defaultStops,\n  defaultCodonTable,\n  generateCodonTable,\n} from '@jbrowse/core/util'\n\ninterface MyProps {\n  exportSVG?: { rasterizeLayers: boolean }\n  features: Map<string, Feature>\n  regions: Region[]\n  bpPerPx: number\n  config: AnyConfigurationModel\n  highResolutionScaling: number\n  theme: any\n  showForward: boolean\n  showReverse: boolean\n  showTranslation: boolean\n}\n\nfunction Translation(props: {\n  codonTable: any\n  seq: string\n  frame: number\n  bpPerPx: number\n  region: Region\n  reverse?: boolean\n  height: number\n  y: number\n  theme?: any\n}) {\n  const {\n    codonTable,\n    seq,\n    frame,\n    bpPerPx,\n    region,\n    height,\n    y,\n    reverse = false,\n    theme,\n  } = props\n  const scale = bpPerPx\n\n  // the tilt variable normalizes the frame to where we are starting from,\n  // which increases consistency across blocks\n  const tilt = 3 - (region.start % 3)\n\n  // the effectiveFrame incorporates tilt and the frame to say what the\n  // effective frame that is plotted. The +3 is for when frame is -2 and this\n  // can otherwise result in effectiveFrame -1\n  const effectiveFrame = (frame + tilt + 3) % 3\n\n  const seqSliced = seq.slice(effectiveFrame)\n\n  const translated: { letter: string; codon: string }[] = []\n  for (let i = 0; i < seqSliced.length; i += 3) {\n    const codon = seqSliced.slice(i, i + 3)\n    const normalizedCodon = reverse ? revcom(codon) : codon\n    const aminoAcid = codonTable[normalizedCodon] || ''\n    translated.push({ letter: aminoAcid, codon: normalizedCodon.toUpperCase() })\n  }\n\n  const w = (1 / scale) * 3\n  const drop = region.start === 0 ? 0 : w\n  const render = 1 / bpPerPx >= 12\n  const width = (region.end - region.start) / bpPerPx\n\n  const map = ['#d8d8d8', '#adadad', '#8f8f8f'].reverse()\n  return (\n    <>\n      {translated.map((element, index) => {\n        const x = region.reversed\n          ? width - (w * (index + 1) + effectiveFrame / scale - drop)\n          : w * index + effectiveFrame / scale - drop\n        const { letter, codon } = element\n        return (\n          <React.Fragment key={`${index}-${letter}`}>\n            <rect\n              x={x}\n              y={y}\n              width={\n                render ? w : w + 0.7 /* small fudge factor when zoomed out*/\n              }\n              height={height}\n              stroke={render ? '#555' : 'none'}\n              fill={\n                defaultStarts.includes(codon)\n                  ? theme.palette.startCodon\n                  : defaultStops.includes(codon)\n                  ? theme.palette.stopCodon\n                  : map[Math.abs(frame)]\n              }\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nfunction DNA(props: {\n  seq: string\n  theme: any\n  bpPerPx: number\n  height: number\n  region: Region\n  feature: Feature\n  y: number\n}) {\n  const { bpPerPx, region, feature, theme, height, seq, y } = props\n  const render = 1 / bpPerPx >= 12\n\n  const [leftPx, rightPx] = bpSpanPx(\n    feature.get('start'),\n    feature.get('end'),\n    region,\n    bpPerPx,\n  )\n  const reverse = region.reversed\n  const len = feature.get('end') - feature.get('start')\n  const w = Math.max((rightPx - leftPx) / len, 0.8)\n\n  return (\n    <>\n      {seq.split('').map((letter, index) => {\n        const color = theme.palette.bases[letter.toUpperCase()]\n        const x = reverse ? rightPx - (index + 1) * w : leftPx + index * w\n        return (\n          <React.Fragment key={index}>\n            <rect\n              x={x}\n              y={y}\n              width={w}\n              height={height}\n              fill={color ? color.main : '#aaa'}\n              stroke={render ? '#555' : 'none'}\n            />\n            {render ? (\n              <text\n                x={x + w / 2}\n                y={y + height / 2}\n                dominantBaseline=\"middle\"\n                textAnchor=\"middle\"\n                fill={color ? contrastingTextColor(color.main) : 'black'}\n              >\n                {letter}\n              </text>\n            ) : null}\n          </React.Fragment>\n        )\n      })}\n    </>\n  )\n}\n\nconst SequenceSVG = ({\n  regions,\n  theme: configTheme,\n  features = new Map(),\n  showReverse,\n  showForward,\n  showTranslation,\n  bpPerPx,\n}: any) => {\n  const [region] = regions\n  const theme = createJBrowseTheme(configTheme)\n  const codonTable = generateCodonTable(defaultCodonTable)\n  const height = 20\n  const [feature] = [...features.values()]\n  if (!feature) {\n    return null\n  }\n  const seq: string = feature.get('seq')\n  if (!seq) {\n    return null\n  }\n\n  // incrementer for the y-position of the current sequence being rendered\n  // (applies to both translation rows and dna rows)\n  let currY = -20\n\n  return (\n    <>\n      {/* the upper translation row. if the view is reversed, the reverse\n        translation is on the top */}\n      {showTranslation && (region.reversed ? showReverse : showForward)\n        ? [2, 1, 0].map(index => (\n            <Translation\n              key={`translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={region.reversed}\n            />\n          ))\n        : null}\n\n      {showForward ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? complement(seq) : seq}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {showReverse ? (\n        <DNA\n          height={height}\n          y={(currY += 20)}\n          feature={feature}\n          region={region}\n          seq={region.reversed ? seq : complement(seq)}\n          bpPerPx={bpPerPx}\n          theme={theme}\n        />\n      ) : null}\n\n      {/* the lower translation row. if the view is reversed, the forward\n        translation is on the bottom */}\n      {showTranslation && (region.reversed ? showForward : showReverse)\n        ? [0, -1, -2].map(index => (\n            <Translation\n              key={`rev-translation-${index}`}\n              seq={seq}\n              y={(currY += 20)}\n              codonTable={codonTable}\n              frame={index}\n              bpPerPx={bpPerPx}\n              region={region}\n              theme={theme}\n              height={height}\n              reverse={!region.reversed}\n            />\n          ))\n        : null}\n    </>\n  )\n}\n\nconst Wrapper = ({ exportSVG, width, totalHeight, children }: any) => {\n  return exportSVG ? (\n    <>{children}</>\n  ) : (\n    <svg\n      data-testid=\"sequence_track\"\n      width={width}\n      height={totalHeight}\n      style={{ width, height: totalHeight }}\n    >\n      {children}\n    </svg>\n  )\n}\n\nfunction Sequence(props: MyProps) {\n  const { regions, bpPerPx } = props\n  const [region] = regions\n  const width = (region.end - region.start) / bpPerPx\n  const totalHeight = 200\n\n  return (\n    <Wrapper {...props} totalHeight={totalHeight} width={width}>\n      <SequenceSVG {...props} />\n    </Wrapper>\n  )\n}\n\nexport default observer(Sequence)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'DivSequenceRenderer',\n  {\n    height: {\n      type: 'number',\n      description: 'height in pixels of each line of sequence',\n      defaultValue: 16,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'IndexedFastaAdapter',\n  {\n    fastaLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa', locationType: 'UriLocation' },\n    },\n    faiLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/seq.fa.fai', locationType: 'UriLocation' },\n    },\n    metadataLocation: {\n      description: 'Optional metadata file',\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/fa.metadata.yaml',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { configSchema as divSequenceRendererConfigSchema } from '../DivSequenceRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinearReferenceSequenceDisplay',\n  { renderer: divSequenceRendererConfigSchema },\n  { explicitIdentifier: 'displayId', explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TwoBitAdapter',\n  {\n    twoBitLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.2bit', locationType: 'UriLocation' },\n    },\n    chromSizesLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/default.chrom.sizes',\n        locationType: 'UriLocation',\n      },\n      description:\n        'An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time',\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default (pluginManager: PluginManager) => {\n  return ConfigurationSchema(\n    'GCContentAdapter',\n    {\n      sequenceAdapter: pluginManager.pluggableConfigSchemaType('adapter'),\n    },\n    { explicitlyTyped: true },\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport configSchemaF from './configSchema'\n\nexport default (pluginManager: PluginManager) => {\n  return {\n    configSchema: pluginManager.load(configSchemaF),\n    getAdapterClass: () => import('./GCContentAdapter').then(r => r.default),\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport { Region, FileLocation } from '@jbrowse/core/util/types'\nimport { createBaseTrackModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport FeatureRendererType from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport {\n  makeIndex,\n  AdapterGuesser,\n  getFileName,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\nimport { configSchema as bgzipFastaAdapterConfigSchema } from './BgzipFastaAdapter'\nimport { configSchema as chromSizesAdapterConfigSchema } from './ChromSizesAdapter'\nimport {\n  configSchema as divSequenceRendererConfigSchema,\n  ReactComponent as DivSequenceRendererReactComponent,\n} from './DivSequenceRenderer'\nimport { configSchema as indexedFastaAdapterConfigSchema } from './IndexedFastaAdapter'\nimport {\n  configSchema as linearReferenceSequenceDisplayConfigSchema,\n  modelFactory as linearReferenceSequenceDisplayModelFactory,\n} from './LinearReferenceSequenceDisplay'\nimport { configSchema as twoBitAdapterConfigSchema } from './TwoBitAdapter'\nimport GCContentAdapterF from './GCContentAdapter'\nimport { createReferenceSeqTrackConfig } from './referenceSeqTrackConfig'\n\n/* adjust in both directions */\nclass DivSequenceRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  getExpandedRegion(region: Region) {\n    return {\n      ...region,\n      start: Math.max(region.start - 3, 0),\n      end: region.end + 3,\n    }\n  }\n}\n\nexport default class SequencePlugin extends Plugin {\n  name = 'SequencePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'TwoBitAdapter',\n          configSchema: twoBitAdapterConfigSchema,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n          getAdapterClass: () =>\n            import('./TwoBitAdapter/TwoBitAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.2bit$/i\n          const adapterName = 'TwoBitAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            twoBitLocation: file,\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'TwoBitAdapter') {\n            return 'ReferenceSequenceTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'ChromSizesAdapter',\n          configSchema: chromSizesAdapterConfigSchema,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n          getAdapterClass: () =>\n            import('./ChromSizesAdapter/ChromSizesAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'IndexedFastaAdapter',\n          configSchema: indexedFastaAdapterConfigSchema,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n          getAdapterClass: () =>\n            import('./IndexedFastaAdapter/IndexedFastaAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(fa|fasta|fas|fna|mfa)$/i\n          const adapterName = 'IndexedFastaAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            fastaLocation: file,\n            faiLocation: index || makeIndex(file, '.fai'),\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'IndexedFastaAdapter') {\n            return 'ReferenceSequenceTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BgzipFastaAdapter',\n          configSchema: bgzipFastaAdapterConfigSchema,\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n          getAdapterClass: () =>\n            import('./BgzipFastaAdapter/BgzipFastaAdapter').then(\n              r => r.default,\n            ),\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(fa|fasta|fas|fna|mfa)\\.b?gz$/i\n          const adapterName = 'BgzipFastaAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            faiLocation: makeIndex(file, '.fai'),\n            gziLocation: makeIndex(file, '.gzi'),\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BgzipFastaAdapter') {\n            return 'ReferenceSequenceTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'GCContentAdapter',\n          adapterMetadata: {\n            category: null,\n            hiddenFromGUI: true,\n            displayName: null,\n            description: null,\n          },\n          ...pluginManager.load(GCContentAdapterF),\n        }),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = createReferenceSeqTrackConfig(pluginManager)\n\n      return new TrackType({\n        name: 'ReferenceSequenceTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'ReferenceSequenceTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const stateModel = linearReferenceSequenceDisplayModelFactory(\n        linearReferenceSequenceDisplayConfigSchema,\n      )\n      return {\n        name: 'LinearReferenceSequenceDisplay',\n        configSchema: linearReferenceSequenceDisplayConfigSchema,\n        stateModel,\n        trackType: 'ReferenceSequenceTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      }\n    })\n\n    pluginManager.addRendererType(\n      () =>\n        new DivSequenceRenderer({\n          name: 'DivSequenceRenderer',\n          ReactComponent: DivSequenceRendererReactComponent,\n          configSchema: divSequenceRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n/*\nNote: this is primarily a copy of createBaseTrackConfig, except with a subset\nof the config slots, to avoid including fields that don't make sense for the\nReferenceSequenceTrack\n*/\nexport function createReferenceSeqTrackConfig(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'ReferenceSequenceTrack',\n    {\n      adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n      displays: types.array(pluginManager.pluggableConfigSchemaType('display')),\n      name: {\n        type: 'string',\n        description: 'optional track name',\n        defaultValue: '',\n      },\n      metadata: {\n        type: 'frozen',\n        description: 'anything to add about this track',\n        defaultValue: {},\n      },\n    },\n    {\n      preProcessSnapshot: s => {\n        const snap = JSON.parse(JSON.stringify(s))\n        const displayTypes = new Set()\n        const { displays = [] } = snap\n        if (snap.trackId !== 'placeholderId') {\n          // Gets the displays on the track snapshot and the possible displays\n          // from the track type and adds any missing possible displays to the\n          // snapshot\n          displays.forEach((d: any) => d && displayTypes.add(d.type))\n          const trackType = pluginManager.getTrackType(snap.type)\n          trackType.displayTypes.forEach(displayType => {\n            if (!displayTypes.has(displayType.name)) {\n              displays.push({\n                displayId: `${snap.trackId}-${displayType.name}`,\n                type: displayType.name,\n              })\n            }\n          })\n        }\n        return { ...snap, displays }\n      },\n      explicitIdentifier: 'trackId',\n      explicitlyTyped: true,\n      actions: (self: any) => ({\n        addDisplayConf(displayConf: { type: string; displayId: string }) {\n          const { type } = displayConf\n          if (!type) {\n            throw new Error(`unknown display type ${type}`)\n          }\n          const display = self.displays.find(\n            (d: any) => d && d.displayId === displayConf.displayId,\n          )\n          if (display) {\n            return display\n          }\n          const length = self.displays.push(displayConf)\n          return self.displays[length - 1]\n        },\n      }),\n    },\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { ConfigurationReference } from '@jbrowse/core/configuration'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration/configurationSchema'\nimport { getContainingView } from '@jbrowse/core/util'\n\nexport function modelFactory(configSchema: AnyConfigurationSchemaType) {\n  return types\n    .compose(\n      'LinearReferenceSequenceDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearReferenceSequenceDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        showForward: types.optional(types.boolean, true),\n        showReverse: types.optional(types.boolean, true),\n        showTranslation: types.optional(types.boolean, true),\n        height: 180,\n      }),\n    )\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          const { showForward, showReverse, showTranslation } = self\n          return {\n            ...superRenderProps(),\n            rpcDriverName: self.rpcDriverName,\n            config: self.configuration.renderer,\n            showForward,\n            showReverse,\n            showTranslation,\n          }\n        },\n        regionCannotBeRendered(/* region */) {\n          const view = getContainingView(self) as LinearGenomeViewModel\n          if (view && view.bpPerPx >= 1) {\n            return 'Zoom in to see sequence'\n          }\n          return undefined\n        },\n\n        get rendererTypeName() {\n          return self.configuration.renderer.type\n        },\n      }\n    })\n    .actions(self => ({\n      toggleShowForward() {\n        self.showForward = !self.showForward\n      },\n      toggleShowReverse() {\n        self.showReverse = !self.showReverse\n      },\n      toggleShowTranslation() {\n        self.showTranslation = !self.showTranslation\n      },\n    }))\n    .views(self => ({\n      trackMenuItems() {\n        return [\n          {\n            label: 'Show forward',\n            type: 'checkbox',\n            checked: self.showForward,\n            onClick: () => {\n              self.toggleShowForward()\n            },\n          },\n          {\n            label: 'Show reverse',\n            type: 'checkbox',\n            checked: self.showReverse,\n            onClick: () => {\n              self.toggleShowReverse()\n            },\n          },\n          {\n            label: 'Show translation',\n            type: 'checkbox',\n            checked: self.showTranslation,\n            onClick: () => {\n              self.toggleShowTranslation()\n            },\n          },\n        ]\n      },\n    }))\n}\n","import { types } from 'mobx-state-tree'\n\n/** utility function for assembling the MST model of a column data type */\nexport default function MakeSpreadsheetColumnType(\n  name,\n  {\n    DataCellReactComponent = null,\n    FilterModelType = null,\n    compare,\n    displayName = undefined,\n    categoryName = undefined,\n  },\n) {\n  return types\n    .model(`ColumnDataType${name}`, {\n      type: types.literal(name),\n    })\n    .volatile(() => ({\n      DataCellReactComponent,\n      FilterModelType,\n      displayName: displayName || name,\n      categoryName,\n    }))\n    .views(() => ({\n      compare,\n      get hasFilter() {\n        return !!FilterModelType\n      },\n    }))\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { types, getType, getParent } from 'mobx-state-tree'\nimport { doesIntersect2, isContainedWithin } from '@jbrowse/core/util/range'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport {\n  when,\n  compareLocs,\n  getSession,\n  parseLocString,\n} from '@jbrowse/core/util'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\n\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n  makeStyles,\n} from '@material-ui/core'\n\nconst useStyles = makeStyles((/* theme */) => {\n  return {\n    textFilterControlAdornment: { marginRight: '-18px' },\n    textFilterControl: {\n      margin: [[0, 0, 0, '0.4rem']],\n      '& .MuiInput-formControl': {\n        marginTop: 8,\n      },\n      '& .MuiInputLabel-formControl': {\n        top: '-7px',\n        '&.MuiInputLabel-shrink': {\n          top: '-3px',\n        },\n      },\n    },\n  }\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(({ filterModel }) => {\n  const classes = useStyles()\n  const operationChoices = getEnumerationValues(\n    getSubType(getPropertyType(getType(filterModel), 'operation')),\n  )\n  return (\n    <>\n      <Select\n        value={filterModel.operation}\n        onChange={event => {\n          filterModel.setOperation(String(event.target.value))\n        }}\n      >\n        {operationChoices.map(name => (\n          <MenuItem key={name} value={name}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>{' '}\n      <TextField\n        label=\"range\"\n        placeholder=\"chr1:100-200\"\n        error={filterModel.locStringIsInvalid}\n        value={filterModel.locString}\n        onChange={evt => filterModel.setLocString(evt.target.value)}\n        className={classes.textFilterControl}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment\n              className={classes.textFilterControlAdornment}\n              position=\"end\"\n            >\n              <IconButton\n                aria-label=\"clear filter\"\n                onClick={() => filterModel.setLocString('')}\n                color=\"secondary\"\n              >\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n    </>\n  )\n})\n\nconst OPERATIONS = [\n  'overlaps with',\n  'contained within',\n  'fully contains',\n  'does not overlap',\n  'not contained within',\n  'does not contain',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  'overlaps with': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      doesIntersect2(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'contained within': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        cellLocation.start,\n        cellLocation.end,\n        specifiedLocation.start,\n        specifiedLocation.end,\n      )\n    )\n  },\n  'fully contains': (cellLocation, specifiedLocation) => {\n    return (\n      cellLocation.refName === specifiedLocation.refName &&\n      isContainedWithin(\n        specifiedLocation.start,\n        specifiedLocation.end,\n        cellLocation.start,\n        cellLocation.end,\n      )\n    )\n  },\n}\nOPERATION_PREDICATES['does not overlap'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['overlaps with'](cellLocation, specifiedLocation)\n}\nOPERATION_PREDICATES['not contained within'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['contained within'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\nOPERATION_PREDICATES['does not contain'] = (\n  cellLocation,\n  specifiedLocation,\n) => {\n  return !OPERATION_PREDICATES['fully contains'](\n    cellLocation,\n    specifiedLocation,\n  )\n}\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnLocStringFilter', {\n    type: types.literal('LocString'),\n    columnNumber: types.integer,\n    locString: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    get locStringIsInvalid() {\n      if (self.locString) {\n        const parsed = self.parsedLocString\n        return (\n          !parsed ||\n          parsed.refName === '' ||\n          typeof parsed.start !== 'number' ||\n          typeof parsed.end !== 'number' ||\n          parsed.start > parsed.end\n        )\n      }\n      return false\n    },\n    get parsedLocString() {\n      const session = getSession(self)\n      const model = getParent(self, 3).spreadsheet\n      const { assemblyName } = model\n      try {\n        return parseLocString(self.locString, refName =>\n          session.assemblyManager.isValidRefName(refName, assemblyName),\n        )\n      } catch (e) {\n        return undefined\n      }\n    },\n    // returns a function that tests the given row\n    get predicate() {\n      if (!self.locString || self.locStringIsInvalid) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      const { parsedLocString, operation, columnNumber } = self // avoid closing over self\n      return function stringPredicate(sheet, row) {\n        const { cellsWithDerived: cells } = row\n        const cell = cells[columnNumber]\n\n        if (!cell || !cell.text || !cell.extendedData) {\n          return false\n        }\n        const parsedCellText = cell.extendedData\n        if (!parsedCellText.refName) {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, parsedLocString)\n      }\n    },\n  }))\n  .actions(self => ({\n    setLocString(s) {\n      self.locString = s\n    },\n    setOperation(op) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\n// opens a new LGV at the location described in the locString in the cell text\nasync function locationLinkClick(spreadsheet, columnNumber, cell) {\n  const session = getSession(spreadsheet)\n  const { assemblyManager } = session\n  const { assemblyName } = spreadsheet\n  const { id } = getParent(spreadsheet)\n  const assembly = await assemblyManager.waitForAssembly(assemblyName)\n  try {\n    const loc = parseLocString(cell.text, name =>\n      assemblyManager.isValidRefName(name, spreadsheet.assemblyName),\n    )\n    const { refName } = loc\n    const canonicalRefName = assembly.getCanonicalRefName(refName)\n    const newDisplayedRegion = assembly.regions.find(\n      region => region.refName === canonicalRefName,\n    )\n\n    const newViewId = `${id}_${assemblyName}`\n    let view = session.views.find(v => v.id === newViewId)\n    if (!view) {\n      view = session.addView('LinearGenomeView', {\n        displayName: assemblyName,\n        id: newViewId,\n      })\n      await when(() => view.initialized)\n\n      // note that we have to clone this because otherwise it adds \"same object\n      // twice to the mst tree\"\n      view.setDisplayedRegions([JSON.parse(JSON.stringify(newDisplayedRegion))])\n    }\n    view.navToLocString(cell.text)\n  } catch (e) {\n    session.notify(`${e}`, 'error')\n  }\n}\n\nconst DataCellReactComponent = observer(\n  ({ cell, columnNumber, spreadsheet }) => {\n    function click(evt) {\n      evt.preventDefault()\n      locationLinkClick(spreadsheet, columnNumber, cell)\n    }\n    return (\n      <a\n        onClick={click}\n        title=\"open a new linear genome view here\"\n        href=\"#link\"\n      >\n        {cell.text}\n      </a>\n    )\n  },\n)\n\nconst LocStringColumnType = MakeSpreadsheetColumnType('LocString', {\n  categoryName: 'Location',\n  displayName: 'Full location',\n  compare(cellA, cellB) {\n    return compareLocs(cellA.extendedData, cellB.extendedData)\n  },\n  FilterModelType,\n  DataCellReactComponent,\n})\n\nexport default LocStringColumnType\n","import ClearIcon from '@material-ui/icons/Clear'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types, getType } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport React from 'react'\nimport {\n  getPropertyType,\n  getEnumerationValues,\n  getSubType,\n} from '@jbrowse/core/util/mst-reflection'\n\nimport {\n  IconButton,\n  TextField,\n  MenuItem,\n  InputAdornment,\n  Select,\n  makeStyles,\n} from '@material-ui/core'\n\nconst OPERATIONS = [\n  'equals',\n  'contains',\n  'does not contain',\n  'does not equal',\n  'starts with',\n  'ends with',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  contains: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().indexOf(stringToFind) !== -1\n  },\n  equals: (textInCell, stringToFind) => {\n    return textInCell.toLowerCase() === stringToFind\n  },\n  'starts with': (textInCell, stringToFind) => {\n    return textInCell.toLowerCase().indexOf(stringToFind) === 0\n  },\n  'ends with': (textInCell, stringToFind) => {\n    const index = textInCell.toLowerCase().indexOf(stringToFind)\n    if (index === -1) {\n      return false\n    }\n    return index === textInCell.length - stringToFind.length\n  },\n}\nOPERATION_PREDICATES['does not contain'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.contains(textInCell, stringToFind)\n}\nOPERATION_PREDICATES['does not equal'] = (textInCell, stringToFind) => {\n  return !OPERATION_PREDICATES.equals(textInCell, stringToFind)\n}\nconst useStyles = makeStyles((/* theme */) => {\n  return {\n    textFilterControlAdornment: { marginRight: '-18px' },\n    textFilterControl: {\n      margin: 0,\n      '& .MuiInput-formControl': {\n        marginTop: 8,\n      },\n      '& .MuiInputLabel-formControl': {\n        top: '-7px',\n        '&.MuiInputLabel-shrink': {\n          top: '-3px',\n        },\n      },\n    },\n  }\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(({ filterModel }) => {\n  const classes = useStyles()\n  const operationChoices = getEnumerationValues(\n    getSubType(getPropertyType(getType(filterModel), 'operation')),\n  )\n  return (\n    <>\n      <Select\n        value={filterModel.operation}\n        onChange={event => {\n          filterModel.setOperation(String(event.target.value))\n        }}\n      >\n        {operationChoices.map(name => (\n          <MenuItem key={name} value={name}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>{' '}\n      <TextField\n        label=\"text\"\n        value={filterModel.stringToFind}\n        onChange={evt => filterModel.setString(evt.target.value)}\n        className={classes.textFilterControl}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment\n              className={classes.textFilterControlAdornment}\n              position=\"end\"\n            >\n              <IconButton\n                aria-label=\"clear filter\"\n                onClick={() => filterModel.setString('')}\n                color=\"secondary\"\n              >\n                <ClearIcon />\n              </IconButton>\n            </InputAdornment>\n          ),\n        }}\n      />\n    </>\n  )\n})\n\n// MST model for the column filter control\nconst ColumnTextFilter = types\n  .model('ColumnTextFilter', {\n    type: types.literal('Text'),\n    columnNumber: types.integer,\n    stringToFind: '',\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      const { stringToFind, columnNumber, operation } = self // avoid closing over self\n      if (!stringToFind) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      const s = stringToFind.toLowerCase() // case insensitive match\n      return function stringPredicate(sheet, row) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n        if (!cell || !cell.text) {\n          return false\n        }\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n        return predicate(cell.text, s)\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s) {\n      self.stringToFind = s\n    },\n    setOperation(op) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst TextColumnType = MakeSpreadsheetColumnType('Text', {\n  compare(cellA, cellB) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType: ColumnTextFilter,\n})\n\nexport { TextColumnType as TextColumn, ColumnTextFilter as FilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Text'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocRef'),\n  }),\n)\n\nconst LocRef = MakeSpreadsheetColumnType('LocRef', {\n  categoryName: 'Location',\n  displayName: 'Reference seq',\n  compare(cellA, cellB) {\n    return cellA.text.localeCompare(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocRef\n","import React from 'react'\nimport { types } from 'mobx-state-tree'\nimport { observer } from 'mobx-react'\nimport { MenuItem, Select, TextField, makeStyles } from '@material-ui/core'\nimport MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\n\nconst OPERATIONS = [\n  'equals',\n  'greater than',\n  'less than',\n  'between',\n  'not between',\n]\n\n// NOTE: assembly names, if present, are ignored in all of these predicates\nconst OPERATION_PREDICATES = {\n  equals: (numberInCell, firstNumber) => {\n    return numberInCell === firstNumber\n  },\n  'greater than': (numberInCell, firstNumber) => {\n    return numberInCell > firstNumber\n  },\n  'less than': (numberInCell, firstNumber) => {\n    return numberInCell < firstNumber\n  },\n  between: (numberInCell, firstNumber, secondNumber) => {\n    return numberInCell > firstNumber && numberInCell < secondNumber\n  },\n}\nOPERATION_PREDICATES['not between'] = (\n  numberInCell,\n  firstNumber,\n  secondNumber,\n) => {\n  return !OPERATION_PREDICATES.between(numberInCell, firstNumber, secondNumber)\n}\n\nconst useStyles = makeStyles((/* theme */) => {\n  return {\n    textFilterControlAdornment: { marginRight: '-18px' },\n    textFilterControl: {\n      margin: [[0, 0, 0, '0.4rem']],\n      '& .MuiInput-formControl': {\n        marginTop: 8,\n      },\n      '& .MuiInputLabel-formControl': {\n        top: '-7px',\n        '&.MuiInputLabel-shrink': {\n          top: '-3px',\n        },\n      },\n    },\n  }\n})\n\n// React component for the column filter control\nconst FilterReactComponent = observer(({ filterModel }) => {\n  const classes = useStyles()\n\n  const operationChoices = OPERATIONS\n\n  return (\n    <>\n      <Select\n        value={filterModel.operation}\n        onChange={event => {\n          filterModel.setOperation(String(event.target.value))\n        }}\n      >\n        {operationChoices.map(name => (\n          <MenuItem key={name} value={name}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>{' '}\n      <TextField\n        label=\"number\"\n        placeholder=\"123\"\n        type=\"number\"\n        error={filterModel.firstNumberIsInvalid}\n        defaultValue={filterModel.firstNumber}\n        onChange={evt => {\n          filterModel.setFirstNumber(parseFloat(evt.target.value))\n        }}\n        className={classes.textFilterControl}\n      />\n      {filterModel.operation !== 'between' &&\n      filterModel.operation !== 'not between' ? null : (\n        <>\n          {' and '}\n          <TextField\n            label=\"number\"\n            placeholder=\"456\"\n            type=\"number\"\n            error={filterModel.secondNumberIsInvalid}\n            defaultValue={filterModel.secondNumber}\n            onChange={evt =>\n              filterModel.setSecondNumber(parseFloat(evt.target.value))\n            }\n            className={classes.textFilterControl}\n          />\n        </>\n      )}\n    </>\n  )\n})\n\n// MST model for the column filter control\nconst FilterModelType = types\n  .model('ColumnNumberFilter', {\n    type: types.literal('Number'),\n    columnNumber: types.integer,\n    firstNumber: types.maybe(types.number),\n    secondNumber: types.maybe(types.number),\n    operation: types.optional(types.enumeration(OPERATIONS), OPERATIONS[0]),\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      if (typeof self.firstNumber !== 'number') {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n\n      const { firstNumber, secondNumber, operation, columnNumber } = self // avoid closing over self\n      return function stringPredicate(sheet, row) {\n        const { cellsWithDerived } = row\n        const cell = cellsWithDerived[columnNumber]\n\n        if (!cell || !cell.text) {\n          return false\n        }\n\n        const parsedCellText = parseFloat(cell.text)\n        if (typeof parsedCellText !== 'number') {\n          return false\n        }\n\n        const predicate = OPERATION_PREDICATES[operation]\n        if (!predicate) {\n          throw new Error(`\"${operation}\" not implemented in location filter`)\n        }\n\n        return predicate(parsedCellText, firstNumber, secondNumber)\n      }\n    },\n  }))\n  .actions(self => ({\n    setFirstNumber(n) {\n      if (Number.isNaN(n) || typeof n !== 'number') {\n        self.firstNumber = undefined\n      } else {\n        self.firstNumber = n\n      }\n    },\n    setSecondNumber(n) {\n      if (Number.isNaN(n) || typeof n !== 'number') {\n        self.secondNumber = undefined\n      } else {\n        self.secondNumber = n\n      }\n    },\n    setOperation(op) {\n      self.operation = op\n    },\n  }))\n  .volatile(() => ({ ReactComponent: FilterReactComponent }))\n\nconst NumberColumn = MakeSpreadsheetColumnType('Number', {\n  compare(cellA, cellB) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport { NumberColumn, FilterModelType }\n","import LocString from './LocString'\nimport LocRef from './LocRef'\nimport LocStart from './LocStart'\nimport LocEnd from './LocEnd'\nimport { NumberColumn as Number } from './Number'\nimport { TextColumn as Text } from './Text'\nimport { types, IAnyModelType } from 'mobx-state-tree'\n\nconst ColumnTypes = {\n  Number,\n  Text,\n  LocString,\n  LocRef,\n  LocStart,\n  LocEnd,\n}\n\nconst allColumnTypes = Object.values(ColumnTypes)\nconst AnyColumnType = types.union(...allColumnTypes)\nconst AnyFilterModelType = types.union(\n  ...allColumnTypes\n    .map(columnType => {\n      // just instantiate the blank types to get their filter model types\n      const { FilterModelType } = columnType.create({\n        // @ts-ignore\n        type: columnType.properties.type.value,\n      })\n      return FilterModelType as unknown as IAnyModelType\n    })\n    // some column types might not have filter machinery, filter those out\n    .filter(t => !!t),\n)\n\nexport { ColumnTypes, AnyColumnType, AnyFilterModelType }\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { types } from 'mobx-state-tree'\nimport { FilterModelType as NumberFilterModel } from './Number'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocStart'),\n  }),\n)\n\nconst LocStart = MakeSpreadsheetColumnType('LocStart', {\n  categoryName: 'Location',\n  displayName: 'Start',\n  compare(cellA, cellB) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocStart\n","import MakeSpreadsheetColumnType from './MakeSpreadsheetColumnType'\nimport { FilterModelType as NumberFilterModel } from './Number'\nimport { types } from 'mobx-state-tree'\n\nconst FilterModelType = types.compose(\n  NumberFilterModel,\n  types.model({\n    type: types.literal('LocEnd'),\n  }),\n)\n\nconst LocEnd = MakeSpreadsheetColumnType('LocEnd', {\n  categoryName: 'Location',\n  displayName: 'End',\n  compare(cellA, cellB) {\n    return parseFloat(cellA.text) - parseFloat(cellB.text)\n  },\n  FilterModelType,\n})\n\nexport default LocEnd\n","import { types, getParent } from 'mobx-state-tree'\n\nconst CellModel = types.model('SpreadsheetCell', {\n  text: types.string,\n  extendedData: types.maybe(types.frozen()),\n})\n\nconst RowModel = types\n  .model('SpreadsheetRow', {\n    id: types.identifier,\n    cells: types.array(CellModel),\n    extendedData: types.maybe(types.frozen()),\n    isSelected: false,\n  })\n  .actions(self => ({\n    toggleSelect() {\n      self.isSelected = !self.isSelected\n    },\n    unSelect() {\n      self.isSelected = false\n    },\n    select() {\n      self.isSelected = true\n    },\n    setExtendedData(data: unknown) {\n      self.extendedData = data\n    },\n  }))\n  .views(self => ({\n    get cellsWithDerived() {\n      const { columns } = getParent(self, 3)\n      let i = 0\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return columns.map((column: { isDerived: boolean; expr: any }) => {\n        if (column.isDerived) {\n          return column.expr.evalSync({\n            row: self,\n          })\n        }\n        return self.cells[i++]\n      })\n    },\n  }))\n\nexport default RowModel\n","import RowModel from './Row'\nimport { types, getParent } from 'mobx-state-tree'\n\nconst StaticRowModel = types\n  .model('StaticRowSet', {\n    isLoaded: types.literal(true),\n    rows: types.array(RowModel),\n  })\n  .views(self => ({\n    get count() {\n      return self.rows.length\n    },\n\n    get passingFiltersCount() {\n      return this.sortedFilteredRows.length\n    },\n\n    get selectedCount() {\n      return this.selectedRows.length\n    },\n\n    get selectedAndPassingFiltersCount() {\n      return this.selectedFilteredRows.length\n    },\n\n    get sortedRows() {\n      const parent = getParent(self)\n      return self.rows.slice().sort(parent.rowSortingComparisonFunction)\n    },\n\n    get selectedRows() {\n      return self.rows.filter(r => r.isSelected)\n    },\n\n    get selectedFilteredRows() {\n      const sheet = getParent(self)\n      const view = getParent(sheet)\n      const { filterControls } = view\n      return this.selectedRows.filter(row =>\n        filterControls.rowPassesFilters(sheet, row),\n      )\n    },\n\n    // the set of all rows that pass the filters, sorted\n    get sortedFilteredRows() {\n      const sheet = getParent(self)\n      const view = getParent(sheet)\n      const { filterControls } = view\n      return self.rows\n        .filter(row => filterControls.rowPassesFilters(sheet, row))\n        .sort(sheet.rowSortingComparisonFunction)\n    },\n  }))\n  .actions(self => ({\n    unselectAll() {\n      self.rows.forEach(row => row.unSelect())\n    },\n  }))\n\nexport default StaticRowModel\n","import { stringToJexlExpression } from '@jbrowse/core/util/jexlStrings'\nimport { getSession } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport {\n  addDisposer,\n  types,\n  getParent,\n  getEnv,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\n\n// locals\nimport { ColumnTypes, AnyColumnType } from './ColumnDataTypes'\nimport StaticRowSetModel from './StaticRowSet'\nimport RowModel from './Row'\n\ntype Row = Instance<typeof RowModel>\n\nconst ColumnDefinition = types\n  .model('ColumnDefinition', {\n    name: types.maybe(types.string),\n    dataType: types.optional(AnyColumnType, () => ({\n      type: 'Text',\n    })),\n    // set to true if column is derived from other columns\n    // if the column is derived, each cell will have a\n    // `derivationFunction` that is called to get its value\n    isDerived: false,\n    // if this cell is derived from other cells, execute this function to get\n    // the value\n    derivationFunctionText: types.maybe(types.string),\n  })\n  .views(self => ({\n    get expr() {\n      if (self.isDerived) {\n        // compile this as a jexl expression\n        return stringToJexlExpression(\n          String(self.derivationFunctionText),\n          getEnv(self).pluginManager.jexl,\n        )\n      }\n      return undefined\n    },\n  }))\n\ntype RowMenuPosition = { anchorEl: Element; rowNumber: number } | null\n\nconst Spreadsheet = types\n  .model('Spreadsheet', {\n    rowSet: types.optional(StaticRowSetModel, () => StaticRowSetModel.create()),\n    columns: types.array(ColumnDefinition),\n    columnDisplayOrder: types.array(types.number),\n    hasColumnNames: false,\n\n    sortColumns: types.array(\n      types\n        .model('SortColumns', {\n          columnNumber: types.number,\n          descending: false,\n        })\n        .actions(self => ({\n          switchDirection() {\n            self.descending = !self.descending\n          },\n        })),\n    ),\n\n    assemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    defaultDataType: ColumnTypes.Text,\n    rowMenuPosition: null as RowMenuPosition,\n    isLoaded: false,\n  }))\n  .views(self => ({\n    get initialized() {\n      const session = getSession(self)\n      const name = self.assemblyName\n      return name ? session.assemblyManager.get(name)?.initialized : false\n    },\n    get hideRowSelection() {\n      // just delegates to parent\n      return getParent(self).hideRowSelection\n    },\n\n    // list of data type names to be made available in the column\n    // dropdown menu\n    get dataTypeChoices() {\n      const typeNames = Object.keys(ColumnTypes) as (keyof typeof ColumnTypes)[]\n      return typeNames.map(typeName => {\n        const dataType = ColumnTypes[typeName].create({ type: typeName })\n        const { displayName, categoryName } = dataType\n        return { typeName, displayName, categoryName }\n      })\n    },\n\n    rowSortingComparisonFunction(rowA: Row, rowB: Row) {\n      for (let i = 0; i < self.sortColumns.length; i += 1) {\n        const { columnNumber, descending } = self.sortColumns[i]\n        const { dataType } = self.columns[columnNumber]\n        const result = dataType.compare(\n          rowA.cellsWithDerived[columnNumber],\n          rowB.cellsWithDerived[columnNumber],\n        )\n        if (result) {\n          return descending ? -result : result\n        }\n      }\n      return 0\n    },\n  }))\n  .actions(self => ({\n    afterAttach() {\n      addDisposer(\n        self,\n        autorun(async () => {\n          const session = getSession(self)\n          const { assemblyManager } = session\n          try {\n            if (self.assemblyName) {\n              await assemblyManager.waitForAssembly(self.assemblyName)\n              this.setLoaded(true)\n            }\n          } catch (error) {\n            session.notify(\n              `failed to load assembly ${self.assemblyName} ${error}`,\n              'error',\n            )\n          }\n        }),\n      )\n    },\n\n    setLoaded(flag: boolean) {\n      self.isLoaded = flag\n    },\n\n    setRowMenuPosition(newPosition: RowMenuPosition) {\n      self.rowMenuPosition = newPosition\n    },\n\n    setSortColumns(newSort: NonNullable<SnapshotIn<typeof self.sortColumns>>) {\n      if (newSort) {\n        // @ts-ignore\n        self.sortColumns = newSort\n      }\n    },\n    setColumnType(columnNumber: number, newTypeName: string) {\n      self.columns[columnNumber].dataType = { type: newTypeName }\n    },\n    unselectAll() {\n      return self.rowSet.unselectAll()\n    },\n  }))\n\nexport default Spreadsheet\n","import { types, getEnv, getParent } from 'mobx-state-tree'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { getSession } from '@jbrowse/core/util'\n\n// 30MB\nconst IMPORT_SIZE_LIMIT = 30_000_000\n\nconst fileTypes = ['CSV', 'TSV', 'VCF', 'BED', 'BEDPE', 'STAR-Fusion']\nconst fileTypeParsers = {\n  CSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseCsvBuffer),\n  TSV: () =>\n    import('../importAdapters/ImportUtils').then(r => r.parseTsvBuffer),\n  VCF: () => import('../importAdapters/VcfImport').then(r => r.parseVcfBuffer),\n  BED: () => import('../importAdapters/BedImport').then(r => r.parseBedBuffer),\n  BEDPE: () =>\n    import('../importAdapters/BedImport').then(r => r.parseBedPEBuffer),\n  'STAR-Fusion': () =>\n    import('../importAdapters/STARFusionImport').then(\n      r => r.parseSTARFusionBuffer,\n    ),\n}\n// regexp used to guess the type of a file or URL from its file extension\nconst fileTypesRegexp = new RegExp(`\\\\.(${fileTypes.join('|')})(\\\\.gz)?$`, 'i')\n\nconst ImportWizard = types\n  .model('SpreadsheetImportWizard', {\n    fileType: types.optional(types.enumeration(fileTypes), 'CSV'),\n    hasColumnNameLine: true,\n    columnNameLineNumber: 1,\n    selectedAssemblyName: types.maybe(types.string),\n  })\n  .volatile(() => ({\n    fileTypes,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    fileSource: undefined as any,\n    error: undefined as unknown,\n    loading: false,\n  }))\n  .views(self => ({\n    get isReadyToOpen() {\n      return (\n        !self.error &&\n        self.fileSource &&\n        (self.fileSource.blobId ||\n          self.fileSource.localPath ||\n          self.fileSource.uri)\n      )\n    },\n    get canCancel() {\n      return getParent(self).readyToDisplay\n    },\n\n    get fileName() {\n      return (\n        self.fileSource.uri ||\n        self.fileSource.localPath ||\n        (self.fileSource.blobId && self.fileSource.name)\n      )\n    },\n\n    get requiresUnzip() {\n      return this.fileName.endsWith('gz')\n    },\n\n    isValidRefName(refName: string, assemblyName?: string) {\n      return getSession(self).assemblyManager.isValidRefName(\n        refName,\n        assemblyName,\n      )\n    },\n  }))\n  .actions(self => ({\n    setSelectedAssemblyName(s: string) {\n      self.selectedAssemblyName = s\n    },\n    setFileSource(newSource: unknown) {\n      self.fileSource = newSource\n      self.error = undefined\n\n      if (self.fileSource) {\n        // try to autodetect the file type, ignore errors\n        const name = self.fileName\n\n        if (name) {\n          const match = fileTypesRegexp.exec(name)\n          if (match && match[1]) {\n            if (match[1] === 'tsv' && name.includes('star-fusion')) {\n              self.fileType = 'STAR-Fusion'\n            } else {\n              self.fileType = match[1].toUpperCase()\n            }\n          }\n        }\n      }\n    },\n\n    toggleHasColumnNameLine() {\n      self.hasColumnNameLine = !self.hasColumnNameLine\n    },\n\n    setColumnNameLineNumber(newnumber: number) {\n      if (newnumber > 0) {\n        self.columnNameLineNumber = newnumber\n      }\n    },\n\n    setFileType(typeName: string) {\n      self.fileType = typeName\n    },\n\n    setError(error: unknown) {\n      console.error(error)\n      self.loading = false\n      self.error = error\n    },\n\n    setLoaded() {\n      self.loading = false\n      self.error = undefined\n    },\n\n    cancelButton() {\n      self.error = undefined\n      getParent(self).setDisplayMode()\n    },\n\n    // fetch and parse the file, make a new Spreadsheet model for it,\n    // then set the parent to display it\n    async import(assemblyName: string) {\n      if (!self.fileSource) {\n        return\n      }\n\n      if (self.loading) {\n        throw new Error('Cannot import, load already in progress')\n      }\n\n      self.selectedAssemblyName = assemblyName\n      self.loading = true\n      const type = self.fileType as keyof typeof fileTypeParsers\n      const typeParser = await fileTypeParsers[type]()\n      if (!typeParser) {\n        throw new Error(`cannot open files of type '${self.fileType}'`)\n      }\n\n      const { unzip } = await import('@gmod/bgzf-filehandle')\n      const { pluginManager } = getEnv(self)\n      const filehandle = openLocation(self.fileSource, pluginManager)\n      try {\n        const stat = await filehandle.stat()\n        if (stat.size > IMPORT_SIZE_LIMIT) {\n          throw new Error(\n            `File is too big. Tabular files are limited to at most ${(\n              IMPORT_SIZE_LIMIT / 1000\n            ).toLocaleString()}kb.`,\n          )\n        }\n      } catch (e) {\n        // not required for stat to succeed to proceed, but it is helpful\n        console.warn(e)\n      }\n      await filehandle\n        .readFile()\n        .then(buffer => (self.requiresUnzip ? unzip(buffer) : buffer))\n        .then(buffer => typeParser(buffer, self))\n        .then(spreadsheet => {\n          this.setLoaded()\n          getParent(self).displaySpreadsheet(spreadsheet)\n        })\n    },\n  }))\n\nexport default ImportWizard\n","import { types, getParent, SnapshotIn } from 'mobx-state-tree'\nimport { AnyFilterModelType as AnyColumnFilter } from './ColumnDataTypes'\n\n// filter that finds a simple string in any of the cells of a row\nconst RowFullTextFilter = types\n  .model('RowFullTextFilter', {\n    type: types.literal('RowFullText'),\n    stringToFind: '',\n  })\n  .views(self => ({\n    // returns a function that tests the given row\n    get predicate() {\n      let s = self.stringToFind // avoid closing over self\n      if (!s) {\n        return function alwaysTrue() {\n          return true\n        }\n      }\n      s = s.toLowerCase()\n      return function stringPredicate(\n        _sheet: unknown,\n        row: { cellsWithDerived: { text: string }[] },\n      ) {\n        const { cellsWithDerived } = row\n        for (\n          let columnNumber = 0;\n          columnNumber < cellsWithDerived.length;\n          columnNumber += 1\n        ) {\n          const cell = cellsWithDerived[columnNumber]\n          // note: case insensitive\n          if (cell.text && cell.text.toLowerCase().includes(s)) {\n            return true\n          }\n        }\n        return false\n      }\n    },\n  }))\n  .actions(self => ({\n    setString(s: string) {\n      self.stringToFind = s\n    },\n    clear() {\n      self.stringToFind = ''\n    },\n  }))\n\nconst model = types\n  .model('SpreadsheetFilterControls', {\n    rowFullText: types.optional(\n      RowFullTextFilter,\n      () =>\n        ({\n          type: 'RowFullText',\n          stringToFind: '',\n        } as SnapshotIn<typeof RowFullTextFilter>),\n    ),\n    columnFilters: types.array(AnyColumnFilter),\n  })\n  .views(self => ({\n    get filters() {\n      return [self.rowFullText, ...self.columnFilters].filter(f => !!f)\n    },\n    setRowFullTextFilter(stringToFind: string) {\n      // @ts-ignore\n      self.rowFullText = {\n        type: 'RowFullText',\n        stringToFind,\n      }\n    },\n    rowPassesFilters(sheet: unknown, row: unknown) {\n      for (let i = 0; i < this.filters.length; i += 1) {\n        if (!this.filters[i].predicate(sheet, row)) {\n          return false\n        }\n      }\n      return true\n    },\n  }))\n  .actions(self => ({\n    addBlankColumnFilter(columnNumber: number) {\n      const { dataType } = getParent(self).spreadsheet.columns[columnNumber]\n      self.columnFilters.push({\n        type: dataType.type,\n        columnNumber,\n      })\n    },\n    removeColumnFilter(filter: typeof AnyColumnFilter) {\n      return self.columnFilters.remove(filter)\n    },\n    clearAllFilters() {\n      self.columnFilters.clear()\n      self.rowFullText.clear()\n    },\n  }))\n\nexport default model\n","import {\n  types,\n  getParent,\n  getEnv,\n  cast,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { MenuItem } from '@jbrowse/core/ui'\nimport { getSession } from '@jbrowse/core/util'\n\n// icons\nimport DoneIcon from '@material-ui/icons/Done'\n\nimport SpreadsheetModel from './Spreadsheet'\nimport ImportWizardModel from './ImportWizard'\nimport FilterControlsModel from './FilterControls'\n\ntype Spreadsheet = Instance<typeof SpreadsheetModel>\n\nexport type MenuItemWithDisabledCallback = MenuItem & {\n  disabled?:\n    | boolean\n    | ((\n        viewModel: unknown,\n        spreadsheetModel: Spreadsheet,\n        rowNumber: number,\n        row: Spreadsheet['rowSet']['rows'][0],\n      ) => boolean)\n}\n\nconst defaultRowMenuItems: MenuItemWithDisabledCallback[] = [\n  {\n    label: 'Toggle select',\n    icon: DoneIcon,\n    onClick(_view: unknown, spreadsheet: Spreadsheet) {\n      const rowNumber = spreadsheet.rowMenuPosition?.rowNumber\n      if (rowNumber !== undefined) {\n        spreadsheet.rowSet.rows[rowNumber - 1].toggleSelect()\n      }\n    },\n  },\n]\n\nconst minHeight = 40\nconst defaultHeight = 440\nconst model = types\n  .model('SpreadsheetView', {\n    type: types.literal('SpreadsheetView'),\n    offsetPx: 0,\n    height: types.optional(\n      types.refinement(\n        'SpreadsheetViewHeight',\n        types.number,\n        n => n >= minHeight,\n      ),\n      defaultHeight,\n    ),\n\n    hideViewControls: false,\n    hideVerticalResizeHandle: false,\n    hideFilterControls: false,\n\n    filterControls: types.optional(FilterControlsModel, () =>\n      FilterControlsModel.create({}),\n    ),\n\n    // switch specifying whether we are showing the import wizard or the\n    // spreadsheet in our viewing area\n    mode: types.optional(\n      types.enumeration('SpreadsheetViewMode', ['import', 'display']),\n      'import',\n    ),\n    importWizard: types.optional(ImportWizardModel, () =>\n      ImportWizardModel.create(),\n    ),\n    spreadsheet: types.maybe(SpreadsheetModel),\n  })\n  .volatile(() => ({\n    width: 400,\n    rowMenuItems: defaultRowMenuItems,\n  }))\n  .views(self => ({\n    get readyToDisplay() {\n      return !!self.spreadsheet && self.spreadsheet.isLoaded\n    },\n\n    get hideRowSelection() {\n      return !!getEnv(self).hideRowSelection\n    },\n\n    get outputRows() {\n      if (self.spreadsheet && self.spreadsheet.rowSet.isLoaded) {\n        const selected = self.spreadsheet.rowSet.selectedFilteredRows\n        if (selected.length) {\n          return selected\n        }\n        return self.spreadsheet.rowSet.sortedFilteredRows\n      }\n      return undefined\n    },\n\n    get assembly() {\n      const name = self.spreadsheet?.assemblyName\n      if (name) {\n        const assemblies = getSession(self).assemblies\n        return assemblies?.find(asm => readConfObject(asm, 'name') === name)\n      }\n      return undefined\n    },\n  }))\n  .actions(self => ({\n    setRowMenuItems(newItems: MenuItem[]) {\n      self.rowMenuItems = newItems\n    },\n    setWidth(newWidth: number) {\n      self.width = newWidth\n      return self.width\n    },\n    setHeight(newHeight: number) {\n      if (newHeight > minHeight) {\n        self.height = newHeight\n      } else {\n        self.height = minHeight\n      }\n      return self.height\n    },\n    resizeHeight(distance: number) {\n      const oldHeight = self.height\n      const newHeight = this.setHeight(self.height + distance)\n      return newHeight - oldHeight\n    },\n    resizeWidth(distance: number) {\n      const oldWidth = self.width\n      const newWidth = this.setWidth(self.width + distance)\n      return newWidth - oldWidth\n    },\n\n    /** load a new spreadsheet and set our mode to display it */\n    displaySpreadsheet(spreadsheet: SnapshotIn<typeof SpreadsheetModel>) {\n      self.filterControls.clearAllFilters()\n      self.spreadsheet = cast(spreadsheet)\n      self.mode = 'display'\n    },\n\n    setImportMode() {\n      self.mode = 'import'\n    },\n\n    setDisplayMode() {\n      if (self.readyToDisplay) {\n        self.mode = 'display'\n      }\n    },\n\n    closeView() {\n      getParent(self, 2).removeView(self)\n    },\n  }))\n\nconst SpreadsheetView = types.compose(BaseViewModel, model)\n\nexport default SpreadsheetView\n","import { lazy } from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { AbstractSessionModel, isAbstractMenuManager } from '@jbrowse/core/util'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport ViewComfyIcon from '@material-ui/icons/ViewComfy'\nimport ViewType from '@jbrowse/core/pluggableElementTypes/ViewType'\nimport SpreadsheetViewModel from './SpreadsheetView/models/SpreadsheetView'\n\ntype SpreadsheetView = Instance<typeof SpreadsheetViewModel>\n\nexport default class SpreadsheetViewPlugin extends Plugin {\n  name = 'SpreadsheetViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() => {\n      return new ViewType({\n        name: 'SpreadsheetView',\n        stateModel: SpreadsheetViewModel,\n        ReactComponent: lazy(\n          () => import('./SpreadsheetView/components/SpreadsheetView'),\n        ),\n      })\n    })\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-SpreadsheetView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        uri,\n        fileType,\n      }: {\n        session: AbstractSessionModel\n        assembly: string\n        uri: string\n        fileType?: string\n      }) => {\n        // add view, make typescript happy with return type\n        const { rootModel } = pluginManager\n        const view = rootModel?.session?.addView(\n          'SpreadsheetView',\n        ) as SpreadsheetView\n\n        if (!view) {\n          throw new Error('Failed to initialize view')\n        }\n        const exts = uri.split('.')\n        let ext = exts?.pop()?.toUpperCase()\n        if (ext === 'GZ') {\n          ext = exts?.pop()?.toUpperCase()\n        }\n\n        view.importWizard.setFileType(fileType || ext || '')\n        view.importWizard.setSelectedAssemblyName(assembly)\n        view.importWizard.setFileSource({\n          uri,\n          locationType: 'UriLocation',\n        })\n        view.importWizard.import(assembly)\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    const { rootModel } = pluginManager\n    if (isAbstractMenuManager(rootModel)) {\n      rootModel.appendToSubMenu(['Add'], {\n        label: 'Spreadsheet view',\n        icon: ViewComfyIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SpreadsheetView', {})\n        },\n      })\n    }\n  }\n}\n","import FolderOpenIcon from '@material-ui/icons/FolderOpen'\n\nconst SvInspectorComponentF = pluginManager => {\n  const { jbrequire } = pluginManager\n  const { observer, PropTypes } = jbrequire('mobx-react')\n  const React = jbrequire('react')\n  const IconButton = jbrequire('@material-ui/core/IconButton')\n  const { makeStyles } = jbrequire('@material-ui/core/styles')\n  const Grid = jbrequire('@material-ui/core/Grid')\n  const FormControlLabel = jbrequire('@material-ui/core/FormControlLabel')\n  const Checkbox = jbrequire('@material-ui/core/Checkbox')\n  const { ResizeHandle } = jbrequire('@jbrowse/core/ui')\n  const { grey } = jbrequire('@material-ui/core/colors')\n\n  const headerHeight = 52\n\n  const style = {\n    width: 4,\n    background: '#ccc',\n    boxSizing: 'border-box',\n    borderTop: '1px solid #fafafa',\n  }\n\n  const useStyles = makeStyles(theme => {\n    return {\n      root: {\n        marginBottom: theme.spacing(1),\n        background: 'white',\n        overflow: 'hidden',\n      },\n      header: {\n        overflow: 'hidden',\n        whiteSpace: 'nowrap',\n        boxSizing: 'border-box',\n        height: headerHeight,\n        background: grey[200],\n        // borderBottom: '1px solid #a2a2a2',\n      },\n      viewControls: {\n        margin: 0,\n      },\n      viewsContainer: {\n        display: 'flex',\n      },\n      spreadsheetViewContainer: {\n        borderRight: [['1px', 'solid', grey[400]]],\n        overflow: 'hidden',\n      },\n      circularViewOptions: {\n        padding: theme.spacing(1),\n        background: grey[200],\n      },\n    }\n  })\n\n  const ViewControls = observer(({ model }) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const classes = useStyles()\n    return (\n      <Grid\n        className={classes.viewControls}\n        container\n        spacing={1}\n        direction=\"row\"\n        alignItems=\"center\"\n      >\n        <Grid item>\n          <IconButton\n            onClick={() => model.setImportMode()}\n            className={classes.iconButton}\n            title=\"open a tabular file\"\n            data-testid=\"sv_inspector_view_open\"\n            color=\"secondary\"\n          >\n            <FolderOpenIcon />\n          </IconButton>\n        </Grid>\n      </Grid>\n    )\n  })\n\n  const CircularViewOptions = observer(({ svInspector }) => {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    const classes = useStyles()\n\n    return (\n      <Grid\n        container\n        className={classes.circularViewOptions}\n        style={{ height: svInspector.circularViewOptionsBarHeight }}\n      >\n        <Grid item>\n          <FormControlLabel\n            control={\n              <Checkbox\n                className={classes.rowSelector}\n                checked={svInspector.onlyDisplayRelevantRegionsInCircularView}\n                onClick={evt =>\n                  svInspector.setOnlyDisplayRelevantRegionsInCircularView(\n                    evt.target.checked,\n                  )\n                }\n              />\n            }\n            label=\"show only regions with data\"\n          />\n        </Grid>\n      </Grid>\n    )\n  })\n\n  function SvInspectorView({ model }) {\n    const classes = useStyles()\n\n    const {\n      resizeHeight,\n      dragHandleHeight,\n      SpreadsheetViewReactComponent,\n      CircularViewReactComponent,\n      showCircularView,\n    } = model\n\n    return (\n      <div className={classes.root} data-testid={model.id}>\n        <Grid container direction=\"row\" className={classes.header}>\n          <Grid item>\n            <ViewControls model={model} />\n          </Grid>\n        </Grid>\n        <div className={classes.viewsContainer}>\n          <div className={classes.spreadsheetViewContainer}>\n            <SpreadsheetViewReactComponent model={model.spreadsheetView} />\n          </div>\n\n          {showCircularView ? (\n            <>\n              <ResizeHandle\n                onDrag={distance => {\n                  const ret1 = model.circularView.resizeWidth(-distance)\n                  const ret2 = model.spreadsheetView.resizeWidth(-ret1)\n                  return ret2\n                }}\n                vertical\n                flexbox\n                style={style}\n              />\n              <div\n                className={classes.circularViewContainer}\n                style={{ width: model.circularView.width }}\n              >\n                <CircularViewOptions svInspector={model} />\n                <CircularViewReactComponent model={model.circularView} />\n              </div>\n            </>\n          ) : null}\n        </div>\n        <ResizeHandle\n          onDrag={resizeHeight}\n          style={{\n            height: dragHandleHeight,\n            background: '#ccc',\n            boxSizing: 'border-box',\n            borderTop: '1px solid #fafafa',\n          }}\n        />\n      </div>\n    )\n  }\n  SvInspectorView.propTypes = {\n    model: PropTypes.objectOrObservableObject.isRequired,\n  }\n  return observer(SvInspectorView)\n}\n\nexport default SvInspectorComponentF\n","// this file contains the rather verbose functions for\n// creating features from CSV/TSV lines\nimport { parseLocString } from '@jbrowse/core/util'\n\nexport function makeAdHocFeature(\n  columns,\n  columnsAlreadyUsedInLocations,\n  row,\n  loc1,\n  loc2,\n  rowNumber,\n) {\n  // load all the other data in the row into an `otherData` object\n  const otherData = {}\n  columns.forEach((column, columnNumber) => {\n    if (columnsAlreadyUsedInLocations.includes(columnNumber)) {\n      return\n    }\n    let { text } = row.cells[columnNumber]\n    if (column.dataType.type === 'Number') {\n      text = parseFloat(text)\n    }\n    otherData[column.name] = text\n  })\n\n  // make the final feature data out of otherData + the parsed locations\n  return {\n    ...otherData,\n    uniqueId: `sv-inspector-adhoc-${rowNumber}`,\n    refName: loc1.refName,\n    start: loc1.start,\n    end: loc1.end,\n    mate: {\n      refName: loc2.refName,\n      start: loc2.start,\n      end: loc2.end,\n    },\n  }\n}\n\nexport function makeAdHocSvFeatureFromTwoLocations(\n  columns,\n  locationColumnNumbers,\n  row,\n  rowNumber,\n  isValidRefName,\n) {\n  // use the first two locations we found (first according to *displayed* order)\n  const loc1 = parseLocString(\n    row.cells[locationColumnNumbers[0]].text,\n    isValidRefName,\n  )\n  const loc2 = parseLocString(\n    row.cells[locationColumnNumbers[1]].text,\n    isValidRefName,\n  )\n\n  const columnsAlreadyUsedInLocations = [\n    locationColumnNumbers[0],\n    locationColumnNumbers[1],\n  ]\n\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\nexport function makeAdHocSvFeatureFromTwoRefStartEndSets(\n  columns,\n  locRefColumnNumbers,\n  locStartColumnNumbers,\n  locEndColumnNumbers,\n  row,\n  rowNumber,\n) {\n  const textOf = colno => row.cells[colno].text\n  const loc1 = {\n    refName: textOf(locRefColumnNumbers[0]),\n    start: parseInt(textOf(locStartColumnNumbers[0]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[0]), 10),\n  }\n  const loc2 = {\n    refName: textOf(locRefColumnNumbers[1]),\n    start: parseInt(textOf(locStartColumnNumbers[1]), 10) - 1,\n    end: parseInt(textOf(locEndColumnNumbers[1]), 10),\n  }\n  const columnsAlreadyUsedInLocations = [\n    locRefColumnNumbers[0],\n    locStartColumnNumbers[0],\n    locEndColumnNumbers[0],\n    locRefColumnNumbers[1],\n    locStartColumnNumbers[1],\n    locEndColumnNumbers[1],\n  ]\n  return makeAdHocFeature(\n    columns,\n    columnsAlreadyUsedInLocations,\n    row,\n    loc1,\n    loc2,\n    rowNumber,\n  )\n}\n\n// makes a feature data object (passed as `data` to a SimpleFeature constructor)\n// out of table row if the row has 2 location columns. undefined if not\nexport function makeAdHocSvFeature(sheet, rowNumber, row, isValidRefName) {\n  const { columns, columnDisplayOrder } = sheet\n  const columnTypes = {}\n  columnDisplayOrder.forEach(columnNumber => {\n    const columnDefinition = columns[columnNumber]\n    if (!columnTypes[columnDefinition.dataType.type]) {\n      columnTypes[columnDefinition.dataType.type] = []\n    }\n    columnTypes[columnDefinition.dataType.type].push(columnNumber)\n  })\n  const locationColumnNumbers = columnTypes.LocString || []\n  const locStartColumnNumbers = columnTypes.LocStart || []\n  const locEndColumnNumbers = columnTypes.LocEnd || []\n  const locRefColumnNumbers = columnTypes.LocRef || []\n\n  // if we have 2 or more columns of type location, make a feature from them\n  if (locationColumnNumbers.length >= 2) {\n    return makeAdHocSvFeatureFromTwoLocations(\n      columns,\n      locationColumnNumbers,\n      row,\n      rowNumber,\n      isValidRefName,\n    )\n  }\n  if (\n    locRefColumnNumbers.length >= 2 &&\n    locStartColumnNumbers.length >= 2 &&\n    locEndColumnNumbers.length >= 2\n  ) {\n    return makeAdHocSvFeatureFromTwoRefStartEndSets(\n      columns,\n      locRefColumnNumbers,\n      locStartColumnNumbers,\n      locEndColumnNumbers,\n      row,\n      rowNumber,\n    )\n  }\n  return undefined\n}\n","import SimpleFeature from '@jbrowse/core/util/simpleFeature'\nimport { makeAdHocSvFeature } from './adhocFeatureUtils'\nimport { getSession } from '@jbrowse/core/util'\nimport { getEnv } from 'mobx-state-tree'\n\nexport function getSerializedFeatureForRow(\n  session,\n  spreadsheetView,\n  row,\n  rowNumber,\n) {\n  if (row.extendedData) {\n    if (row.extendedData.vcfFeature) {\n      return row.extendedData.vcfFeature\n    }\n    if (row.extendedData.feature) {\n      return row.extendedData.feature\n    }\n  }\n  const adhocFeature = makeAdHocSvFeature(\n    spreadsheetView.spreadsheet,\n    rowNumber,\n    row,\n    session.assemblyManager.isValidRefName,\n  )\n  if (adhocFeature) {\n    return adhocFeature\n  }\n  return undefined\n}\n\nexport function breakpointSplitViewSnapshotFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const { pluginManager } = getEnv(svInspectorView)\n  const session = getSession(spreadsheetView)\n  const featureData = getSerializedFeatureForRow(\n    session,\n    spreadsheet,\n    row,\n    rowNumber,\n  )\n\n  if (featureData) {\n    const feature = new SimpleFeature(featureData)\n    session.setSelection(feature)\n    const viewType = pluginManager.getViewType('BreakpointSplitView')\n    const { circularView } = svInspectorView\n\n    const viewSnapshot = viewType.snapshotFromBreakendFeature(\n      feature,\n      circularView,\n    )\n    return viewSnapshot\n  }\n  return undefined\n}\n\nexport function openBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n    svInspectorView,\n    spreadsheetView,\n    spreadsheet,\n    row,\n    rowNumber,\n  )\n  if (viewSnapshot) {\n    // try to center the offsetPx\n    const { circularView } = svInspectorView\n    viewSnapshot.views[0].offsetPx -= circularView.width / 2 + 100\n    viewSnapshot.views[1].offsetPx -= circularView.width / 2 + 100\n\n    const session = getSession(spreadsheetView)\n    session.addView('BreakpointSplitView', viewSnapshot)\n  }\n}\n\nexport function canOpenBreakpointSplitViewFromTableRow(\n  svInspectorView,\n  spreadsheetView,\n  spreadsheet,\n  row,\n  rowNumber,\n) {\n  try {\n    const viewSnapshot = breakpointSplitViewSnapshotFromTableRow(\n      svInspectorView,\n      spreadsheetView,\n      spreadsheet,\n      row,\n      rowNumber,\n    )\n    return Boolean(viewSnapshot)\n  } catch (e) {\n    console.error('Unable to open breakpoint split view from table row', e)\n    return false\n  }\n}\n","import OpenInNewIcon from '@material-ui/icons/OpenInNew'\nimport { getContainingView, getSession } from '@jbrowse/core/util'\n\nimport { autorun, reaction } from 'mobx'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { types, getParent, addDisposer } from 'mobx-state-tree'\nimport { BaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// locals\nimport {\n  canOpenBreakpointSplitViewFromTableRow,\n  openBreakpointSplitViewFromTableRow,\n  getSerializedFeatureForRow,\n} from './breakpointSplitViewFromTableRow'\n\nfunction defaultOnChordClick(feature, chordTrack, pluginManager) {\n  const session = getSession(chordTrack)\n  session.setSelection(feature)\n  const view = getContainingView(chordTrack)\n  const viewType = pluginManager.getViewType('BreakpointSplitView')\n  const viewSnapshot = viewType.snapshotFromBreakendFeature(feature, view)\n\n  // try to center the offsetPx\n  viewSnapshot.views[0].offsetPx -= view.width / 2 + 100\n  viewSnapshot.views[1].offsetPx -= view.width / 2 + 100\n  viewSnapshot.featureData = feature.data\n\n  session.addView('BreakpointSplitView', viewSnapshot)\n}\n\nconst SvInspectorViewF = pluginManager => {\n  const SpreadsheetViewType = pluginManager.getViewType('SpreadsheetView')\n  const CircularViewType = pluginManager.getViewType('CircularView')\n\n  const minHeight = 400\n  const defaultHeight = 500\n  const headerHeight = 52\n  const circularViewOptionsBarHeight = 52\n  const model = types\n    .model('SvInspectorView', {\n      type: types.literal('SvInspectorView'),\n      dragHandleHeight: 4,\n      height: types.optional(\n        types.refinement(\n          'SvInspectorViewHeight',\n          types.number,\n          n => n >= minHeight,\n        ),\n        defaultHeight,\n      ),\n\n      onlyDisplayRelevantRegionsInCircularView: false,\n\n      // switch specifying whether we are showing the import wizard or the\n      // spreadsheet in our viewing area\n      mode: types.optional(\n        types.enumeration('SvInspectorViewMode', ['import', 'display']),\n        'import',\n      ),\n\n      spreadsheetView: types.optional(SpreadsheetViewType.stateModel, () =>\n        SpreadsheetViewType.stateModel.create({\n          type: 'SpreadsheetView',\n          hideViewControls: true,\n          hideVerticalResizeHandle: true,\n        }),\n      ),\n\n      circularView: types.optional(CircularViewType.stateModel, () =>\n        CircularViewType.stateModel.create({\n          type: 'CircularView',\n          hideVerticalResizeHandle: true,\n          hideTrackSelectorButton: true,\n          disableImportForm: true,\n        }),\n      ),\n    })\n    .volatile(() => ({\n      width: 800,\n    }))\n    .views(self => ({\n      get selectedRows() {\n        return self.spreadsheetView.rowSet.selectedRows\n      },\n\n      get assemblyName() {\n        const { assembly } = self.spreadsheetView\n        if (assembly) {\n          return readConfObject(assembly, 'name')\n        }\n        return undefined\n      },\n\n      get showCircularView() {\n        return self.spreadsheetView.mode === 'display'\n      },\n\n      get featuresAdapterConfigSnapshot() {\n        const session = getSession(self)\n        return {\n          type: 'FromConfigAdapter',\n          features: (self.spreadsheetView.outputRows || [])\n            .map((row, rowNumber) =>\n              getSerializedFeatureForRow(\n                session,\n                self.spreadsheetView,\n                row,\n                rowNumber,\n              ),\n            )\n            .filter(f => Boolean(f)),\n        }\n      },\n\n      // Promise<string[]> of refnames\n      get featuresRefNamesP() {\n        const { AdapterClass: FromConfigAdapter } =\n          pluginManager.getAdapterType('FromConfigAdapter')\n        const adapter = new FromConfigAdapter(\n          self.featuresAdapterConfigSnapshot,\n        )\n        return adapter.getRefNames()\n      },\n\n      get featuresCircularTrackConfiguration() {\n        pluginManager.jexl.addFunction(\n          'defaultOnChordClick',\n          defaultOnChordClick,\n        )\n        const configuration = {\n          type: 'VariantTrack',\n          trackId: `sv-inspector-variant-track-${self.id}`,\n          name: 'features from tabular data',\n          adapter: self.featuresAdapterConfigSnapshot,\n          assemblyNames: [self.assemblyName],\n          displays: [\n            {\n              type: 'ChordVariantDisplay',\n              displayId: `sv-inspector-variant-track-chord-display-${self.id}`,\n              onChordClick: `jexl:defaultOnChordClick(feature, track, pluginManager)`,\n              renderer: { type: 'StructuralVariantChordRenderer' },\n            },\n          ],\n        }\n        return configuration\n      },\n    }))\n    .volatile(() => ({\n      SpreadsheetViewReactComponent: SpreadsheetViewType.ReactComponent,\n      CircularViewReactComponent: CircularViewType.ReactComponent,\n      circularViewOptionsBarHeight,\n    }))\n    .actions(self => ({\n      afterAttach() {\n        // synchronize subview widths\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              const borderWidth = 1\n              if (self.showCircularView) {\n                const spreadsheetWidth = Math.round(self.width * 0.66)\n                const circularViewWidth = self.width - spreadsheetWidth\n                self.spreadsheetView.setWidth(spreadsheetWidth - borderWidth)\n                self.circularView.setWidth(circularViewWidth)\n              } else {\n                self.spreadsheetView.setWidth(self.width)\n              }\n            },\n            { name: 'SvInspectorView width binding' },\n          ),\n        )\n        // synchronize subview heights\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              self.spreadsheetView.setHeight(self.height - headerHeight)\n              self.circularView.setHeight(\n                self.height - headerHeight - circularViewOptionsBarHeight,\n              )\n            },\n            { name: 'SvInspectorView height binding' },\n          ),\n        )\n        // bind circularview displayedRegions to spreadsheet assembly, mediated by\n        // the onlyRelevantRegions toggle\n        addDisposer(\n          self,\n          autorun(\n            async () => {\n              const {\n                assemblyName,\n                onlyDisplayRelevantRegionsInCircularView,\n                circularView,\n                featuresRefNamesP,\n              } = self\n              const { tracks } = circularView\n              const session = getSession(self)\n              if (assemblyName) {\n                const assembly = await session.assemblyManager.waitForAssembly(\n                  assemblyName,\n                )\n                if (assembly) {\n                  const { getCanonicalRefName, regions: assemblyRegions = [] } =\n                    assembly\n                  if (onlyDisplayRelevantRegionsInCircularView) {\n                    if (tracks.length === 1) {\n                      featuresRefNamesP\n                        .then(featureRefNames => {\n                          // canonicalize the store's ref names if necessary\n                          const canonicalFeatureRefNames = new Set(\n                            featureRefNames.map(\n                              refName =>\n                                getCanonicalRefName(refName) || refName,\n                            ),\n                          )\n                          const displayedRegions = assemblyRegions.filter(r =>\n                            canonicalFeatureRefNames.has(r.refName),\n                          )\n                          circularView.setDisplayedRegions(\n                            JSON.parse(JSON.stringify(displayedRegions)),\n                          )\n                        })\n                        .catch(e => circularView.setError(e))\n                    }\n                  } else {\n                    circularView.setDisplayedRegions(assemblyRegions)\n                  }\n                } else {\n                  circularView.setDisplayedRegions([])\n                }\n              }\n            },\n            { name: 'SvInspectorView displayed regions bind' },\n          ),\n        )\n\n        // bind circularview tracks to our track snapshot view\n        addDisposer(\n          self,\n          reaction(\n            () => ({\n              generatedTrackConf:\n                self && self.featuresCircularTrackConfiguration,\n              assemblyName: self && self.assemblyName,\n            }),\n            data => {\n              if (!data) {\n                return\n              }\n              const { assemblyName, generatedTrackConf } = data\n              // hide any visible tracks\n              if (self.circularView.tracks.length) {\n                self.circularView.tracks.forEach(track => {\n                  self.circularView.hideTrack(track.configuration.trackId)\n                })\n              }\n\n              // put our track in as the only track\n              if (assemblyName && generatedTrackConf) {\n                self.circularView.addTrackConf(generatedTrackConf, {\n                  assemblyName,\n                })\n              }\n            },\n            {\n              name: 'SvInspectorView track configuration binding',\n              fireImmediately: true,\n            },\n          ),\n        )\n\n        // bind spreadsheetView row menu actions to us\n        addDisposer(\n          self,\n          autorun(() => {\n            self.spreadsheetView.setRowMenuItems(\n              // these are the MenuItem entries for the row menu actions in the spreadsheet view.\n              // these are installed into the child SpreadsheetView using an autorun below\n              [\n                {\n                  label: 'Open split detail view',\n                  icon: OpenInNewIcon,\n                  disabled(spreadsheetView, spreadsheet, rowNumber, row) {\n                    return !canOpenBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                  onClick(spreadsheetView, spreadsheet, rowNumber, row) {\n                    openBreakpointSplitViewFromTableRow(\n                      self,\n                      spreadsheetView,\n                      spreadsheet,\n                      row,\n                      rowNumber,\n                    )\n                  },\n                },\n              ],\n            )\n          }),\n        )\n      },\n      setWidth(newWidth) {\n        self.width = newWidth\n      },\n      setHeight(newHeight) {\n        if (newHeight > minHeight) {\n          self.height = newHeight\n        } else {\n          self.height = minHeight\n        }\n        return self.height\n      },\n      resizeHeight(distance) {\n        const oldHeight = self.height\n        const newHeight = self.setHeight(self.height + distance)\n        return newHeight - oldHeight\n      },\n\n      setImportMode() {\n        self.spreadsheetView.setImportMode()\n      },\n\n      setDisplayMode() {\n        self.spreadsheetView.setDisplayMode()\n      },\n\n      closeView() {\n        getParent(self, 2).removeView(self)\n      },\n\n      setDisplayedRegions(regions) {\n        self.circularView.setDisplayedRegions(regions)\n      },\n\n      setOnlyDisplayRelevantRegionsInCircularView(val) {\n        self.onlyDisplayRelevantRegionsInCircularView = Boolean(val)\n      },\n    }))\n\n  const stateModel = types.compose(BaseViewModel, model)\n\n  return { stateModel }\n}\n\nexport default SvInspectorViewF\n","import ReactComponentFactory from './components/SvInspectorView'\nimport StateModelFactory from './models/SvInspectorView'\n\nconst SvInspectorViewF = ({ jbrequire }) => {\n  const ViewType = jbrequire('@jbrowse/core/pluggableElementTypes/ViewType')\n\n  const ReactComponent = jbrequire(ReactComponentFactory)\n  const { stateModel } = jbrequire(StateModelFactory)\n\n  return new ViewType({ name: 'SvInspectorView', stateModel, ReactComponent })\n}\n\nexport default SvInspectorViewF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport Plugin from '@jbrowse/core/Plugin'\nimport {\n  AbstractSessionModel,\n  isAbstractMenuManager,\n} from '@jbrowse/core/util/types'\nimport TableChartIcon from '@material-ui/icons/TableChart'\nimport SvInspectorViewTypeFactory from './SvInspectorView/SvInspectorViewType'\n\ntype SvInspectorView = ReturnType<typeof SvInspectorViewTypeFactory>\n\nexport default class SvInspectorViewPlugin extends Plugin {\n  name = 'SvInspectorViewPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addViewType(() =>\n      pluginManager.jbrequire(SvInspectorViewTypeFactory),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'LaunchView-SvInspectorView',\n      // @ts-ignore\n      async ({\n        session,\n        assembly,\n        uri,\n        fileType,\n      }: {\n        session: AbstractSessionModel\n        assembly: string\n        uri: string\n        fileType?: string\n      }) => {\n        // add view, make typescript happy with return type\n        const { rootModel } = pluginManager\n        const view = rootModel?.session?.addView(\n          'SvInspectorView',\n        ) as SvInspectorView\n\n        if (!view) {\n          throw new Error('Failed to initialize view')\n        }\n        const exts = uri.split('.')\n        let ext = exts?.pop()?.toUpperCase()\n        if (ext === 'GZ') {\n          ext = exts?.pop()?.toUpperCase()\n        }\n\n        view.spreadsheetView.importWizard.setFileType(fileType || ext || '')\n        view.spreadsheetView.importWizard.setSelectedAssemblyName(assembly)\n        view.spreadsheetView.importWizard.setFileSource({\n          uri,\n          locationType: 'UriLocation',\n        })\n        view.spreadsheetView.importWizard.import(assembly)\n      },\n    )\n  }\n\n  configure(pluginManager: PluginManager) {\n    if (isAbstractMenuManager(pluginManager.rootModel)) {\n      pluginManager.rootModel.appendToSubMenu(['Add'], {\n        label: 'SV inspector',\n        icon: TableChartIcon,\n        onClick: (session: AbstractSessionModel) => {\n          session.addView('SvInspectorView', {})\n        },\n      })\n    }\n  }\n}\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { isStateTreeNode } from 'mobx-state-tree'\nimport { measureText, getViewParams, Feature, Region } from '@jbrowse/core/util'\nimport { DisplayModel } from './util'\n\nexport default observer(\n  ({\n    text,\n    x,\n    y,\n    region,\n    reversed,\n    bpPerPx,\n    feature,\n    viewParams,\n    color = 'black',\n    fontHeight = 13,\n    featureWidth = 0,\n    allowedWidthExpansion = 0,\n    displayModel = {},\n  }: {\n    text: string\n    x: number\n    y: number\n    color?: string\n    fontHeight?: number\n    featureWidth?: number\n    bpPerPx: number\n    allowedWidthExpansion?: number\n    feature: Feature\n    reversed?: boolean\n    displayModel: DisplayModel\n    region: Region\n    viewParams: {\n      start: number\n      end: number\n      offsetPx: number\n      offsetPx1: number\n    }\n  }) => {\n    const totalWidth = featureWidth + allowedWidthExpansion\n    const measuredTextWidth = measureText(text, fontHeight)\n    const params = isStateTreeNode(displayModel)\n      ? getViewParams(displayModel)\n      : viewParams\n\n    const viewLeft = reversed ? params.end : params.start\n\n    const rstart = region.start\n    const rend = region.end\n    const fstart = feature.get('start')\n    const fend = feature.get('end')\n\n    const featureWidthBp = measuredTextWidth * bpPerPx\n\n    // this tricky bit of code helps smooth over block boundaries\n    // not supported for reverse mode currently\n    // reason: reverse mode allocates space for the label in the \"normal\n    // forward orientation\" making it hard to slide. The reverse mode should\n    // allocate the label space in the reverse orientation to slide it\n    if (\n      viewLeft < rend &&\n      viewLeft > rstart &&\n      fstart < viewLeft &&\n      viewLeft + featureWidthBp < fend\n    ) {\n      x = params.offsetPx\n    } else if (fstart < viewLeft && viewLeft + featureWidthBp < fend) {\n      x = params.offsetPx1\n    }\n\n    return (\n      <text x={x} y={y + fontHeight} fill={color} fontSize={fontHeight}>\n        {measuredTextWidth > totalWidth\n          ? `${text.slice(0, totalWidth / (fontHeight * 0.6))}...`\n          : text}\n      </text>\n    )\n  },\n)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Feature, Region } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { observer } from 'mobx-react'\n\n// locals\nimport type { DisplayModel } from './util'\nimport FeatureLabel from './FeatureLabel'\n\nfunction FeatureGlyph(props: {\n  feature: Feature\n  rootLayout: SceneGraph\n  config: AnyConfigurationModel\n  name: string\n  description: string\n  shouldShowName: boolean\n  shouldShowDescription: boolean\n  fontHeight: number\n  allowedWidthExpansion: number\n  displayModel: DisplayModel\n  selected?: boolean\n  reversed?: boolean\n  topLevel?: boolean\n  region: Region\n  viewParams: {\n    end: number\n    start: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  bpPerPx: number\n}) {\n  const {\n    feature,\n    rootLayout,\n    config,\n    name,\n    description,\n    shouldShowName,\n    shouldShowDescription,\n  } = props\n\n  const featureLayout = rootLayout.getSubRecord(String(feature.id()))\n  if (!featureLayout) {\n    return null\n  }\n  const { GlyphComponent } = featureLayout.data || {}\n\n  return (\n    <g>\n      <GlyphComponent featureLayout={featureLayout} {...props} />\n      {shouldShowName ? (\n        <FeatureLabel\n          text={name}\n          x={rootLayout.getSubRecord('nameLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('nameLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'nameColor'], { feature })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n      {shouldShowDescription ? (\n        <FeatureLabel\n          text={description}\n          x={rootLayout.getSubRecord('descriptionLabel')?.absolute.left || 0}\n          y={rootLayout.getSubRecord('descriptionLabel')?.absolute.top || 0}\n          color={readConfObject(config, ['labels', 'descriptionColor'], {\n            feature,\n          })}\n          featureWidth={featureLayout.width}\n          {...props}\n        />\n      ) : null}\n    </g>\n  )\n}\n\nexport default observer(FeatureGlyph)\n","import React from 'react'\nimport { bpSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { Region } from '@jbrowse/core/util/types'\nimport { observer } from 'mobx-react'\n\ntype LayoutRecord = [number, number, number, number]\ninterface SvgOverlayProps {\n  region: Region\n  displayModel: {\n    getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n    selectedFeatureId?: string\n    featureIdUnderMouse?: string\n    contextMenuFeature?: Feature\n  }\n  bpPerPx: number\n  blockKey: string\n  movedDuringLastMouseDown: boolean\n  onFeatureMouseDown?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseEnter?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOut?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseOver?(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n    featureId: string,\n  ): {}\n  onFeatureMouseUp?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseLeave?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureMouseMove?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  // synthesized from mouseup and mousedown\n  onFeatureClick?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n  onFeatureContextMenu?(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n    featureId: string,\n  ): {}\n}\n\ninterface OverlayRectProps extends React.SVGProps<SVGRectElement> {\n  rect?: LayoutRecord\n  region: Region\n  bpPerPx: number\n}\n\nfunction OverlayRect({\n  rect,\n  region,\n  bpPerPx,\n  ...rectProps\n}: OverlayRectProps) {\n  if (!rect) {\n    return null\n  }\n  const [leftBp, topPx, rightBp, bottomPx] = rect\n  const [leftPx, rightPx] = bpSpanPx(leftBp, rightBp, region, bpPerPx)\n  const rectTop = Math.round(topPx)\n  const screenWidth = (region.end - region.start) / bpPerPx\n  const rectHeight = Math.round(bottomPx - topPx)\n  const width = rightPx - leftPx\n\n  if (leftPx + width < 0) {\n    return null\n  }\n  const leftWithinBlock = Math.max(leftPx, 0)\n  const diff = leftWithinBlock - leftPx\n  const widthWithinBlock = Math.max(1, Math.min(width - diff, screenWidth))\n\n  return (\n    <rect\n      x={leftWithinBlock - 2}\n      y={rectTop - 2}\n      width={widthWithinBlock + 4}\n      height={rectHeight + 4}\n      {...rectProps}\n    />\n  )\n}\n\nfunction SvgOverlay({\n  displayModel = {},\n  blockKey,\n  region,\n  bpPerPx,\n  movedDuringLastMouseDown,\n  ...handlers\n}: SvgOverlayProps) {\n  const { selectedFeatureId, featureIdUnderMouse, contextMenuFeature } =\n    displayModel\n\n  const mouseoverFeatureId = featureIdUnderMouse || contextMenuFeature?.id()\n\n  function onFeatureMouseDown(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseDown: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseEnter(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseEnter: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOut(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOut: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseOver(\n    event:\n      | React.MouseEvent<SVGRectElement, MouseEvent>\n      | React.FocusEvent<SVGRectElement>,\n  ) {\n    const { onFeatureMouseOver: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseUp(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseUp: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseLeave(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseLeave: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureMouseMove(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureMouseMove: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureClick(event: React.MouseEvent<SVGRectElement, MouseEvent>) {\n    if (movedDuringLastMouseDown) {\n      return undefined\n    }\n    const { onFeatureClick: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    event.stopPropagation()\n    return handler(event, mouseoverFeatureId)\n  }\n\n  function onFeatureContextMenu(\n    event: React.MouseEvent<SVGRectElement, MouseEvent>,\n  ) {\n    const { onFeatureContextMenu: handler } = handlers\n    if (!(handler && mouseoverFeatureId)) {\n      return undefined\n    }\n    return handler(event, mouseoverFeatureId)\n  }\n\n  return (\n    <>\n      {mouseoverFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, mouseoverFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          fill=\"#000\"\n          fillOpacity=\"0.2\"\n          onMouseDown={onFeatureMouseDown}\n          onMouseEnter={onFeatureMouseEnter}\n          onMouseOut={onFeatureMouseOut}\n          onMouseOver={onFeatureMouseOver}\n          onMouseUp={onFeatureMouseUp}\n          onMouseLeave={onFeatureMouseLeave}\n          onMouseMove={onFeatureMouseMove}\n          onClick={onFeatureClick}\n          onContextMenu={onFeatureContextMenu}\n          onFocus={onFeatureMouseOver}\n          onBlur={onFeatureMouseOut}\n          data-testid={mouseoverFeatureId}\n        />\n      ) : null}\n      {selectedFeatureId ? (\n        <OverlayRect\n          rect={displayModel.getFeatureByID?.(blockKey, selectedFeatureId)}\n          region={region}\n          bpPerPx={bpPerPx}\n          stroke=\"#00b8ff\"\n          fill=\"none\"\n        />\n      ) : null}\n    </>\n  )\n}\n\nexport default observer(SvgOverlay)\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature } from '@jbrowse/core/util'\n\nconst Arrow = ({\n  feature,\n  featureLayout,\n  config,\n  region,\n}: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n}) => {\n  const strand = feature.get('strand')\n  const size = 5\n  const reverseFlip = region.reversed ? -1 : 1\n  const offset = 7 * strand * reverseFlip\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n  const color2 = readConfObject(config, 'color2', { feature })\n  const p =\n    strand * reverseFlip === -1\n      ? left\n      : strand * reverseFlip === 1\n      ? left + width\n      : null\n  const y = top + height / 2\n\n  return p ? (\n    <>\n      <line x1={p} x2={p + offset} y1={y} y2={y} stroke={color2} />\n      <polygon\n        points={[\n          [p + offset / 2, y - size / 2],\n          [p + offset / 2, y + size / 2],\n          [p + offset, y],\n        ].toString()}\n        stroke={color2}\n      />\n    </>\n  ) : null\n}\n\nexport default observer(Arrow)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { Region, Feature } from '@jbrowse/core/util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\n\n// locals\nimport { isUTR } from './util'\nimport Arrow from './Arrow'\n\nconst utrHeightFraction = 0.65\nfunction Box(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  bpPerPx: number\n  selected?: boolean\n  topLevel?: boolean\n  children?: React.ReactNode\n}) {\n  const { feature, region, config, featureLayout, bpPerPx, topLevel } = props\n  const { start, end } = region\n  const screenWidth = (end - start) / bpPerPx\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const { left = 0 } = featureLayout.absolute\n  let { top = 0, height = 0 } = featureLayout.absolute\n\n  if (left + width < 0) {\n    return null\n  }\n\n  if (isUTR(feature)) {\n    top += ((1 - utrHeightFraction) / 2) * height\n    height *= utrHeightFraction\n  }\n  const leftWithinBlock = Math.max(left, 0)\n  const diff = leftWithinBlock - left\n  const widthWithinBlock = Math.max(2, Math.min(width - diff, screenWidth))\n\n  // if feature has parent and type is intron, then don't render the intron\n  // subfeature (if it doesn't have a parent, then maybe the introns are\n  // separately displayed features that should be displayed)\n  return feature.parent() && feature.get('type') === 'intron' ? null : (\n    <>\n      {topLevel ? <Arrow {...props} /> : null}\n      <rect\n        data-testid={`box-${feature.id()}`}\n        x={leftWithinBlock}\n        y={top}\n        width={widthWithinBlock}\n        height={height}\n        fill={\n          isUTR(feature)\n            ? readConfObject(config, 'color3', { feature })\n            : readConfObject(config, 'color1', { feature })\n        }\n        stroke={readConfObject(config, 'outline', { feature }) as string}\n      />\n    </>\n  )\n}\n\nexport default observer(Box)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport Arrow from './Arrow'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature } from '@jbrowse/core/util'\n\nfunction Segments(props: {\n  region: Region\n  feature: Feature\n  featureLayout: SceneGraph\n  config: AnyConfigurationModel\n  selected?: boolean\n  reversed?: boolean\n  subfeatures?: Feature[]\n  children?: React.ReactNode\n}) {\n  const {\n    feature,\n    featureLayout,\n    selected,\n    config,\n    // some subfeatures may be computed e.g. makeUTRs,\n    // so these are passed as a prop, or feature.get('subfeatures') by default\n    subfeatures = feature.get('subfeatures'),\n  } = props\n\n  const color2 = readConfObject(config, 'color2', { feature })\n\n  const { left = 0, top = 0, width = 0, height = 0 } = featureLayout.absolute\n\n  const y = top + height / 2\n  return (\n    <>\n      <line\n        data-testid={feature.id()}\n        x1={left}\n        y1={y}\n        y2={y}\n        x2={left + width}\n        stroke={color2}\n      />\n      {subfeatures?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        // This subfeature got filtered out\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            topLevel={false}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n      <Arrow {...props} />\n    </>\n  )\n}\n\nexport default observer(Segments)\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\n\nimport Segments from './Segments'\nimport { ExtraGlyphValidator, layOutFeature, layOutSubfeatures } from './util'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport { Region, Feature, SimpleFeature } from '@jbrowse/core/util'\n\nfunction ProcessedTranscript(props: {\n  feature: Feature\n  region: Region\n  config: AnyConfigurationModel\n  featureLayout: SceneGraph\n  selected?: boolean\n  reversed?: boolean\n  [key: string]: unknown\n}) {\n  const { feature, config } = props\n  const subfeatures = getSubparts(feature, config)\n\n  // we manually compute some subfeatures, so pass these separately\n  return <Segments {...props} subfeatures={subfeatures} />\n}\n\n// returns a callback that will filter features features according to the\n// subParts conf var\nfunction makeSubpartsFilter(\n  confKey = 'subParts',\n  config: AnyConfigurationModel,\n) {\n  let filter = readConfObject(config, confKey) as string[] | string\n\n  if (typeof filter == 'string') {\n    // convert to array\n    filter = filter.split(/\\s*,\\s*/)\n  }\n\n  return (feature: Feature) =>\n    (filter as string[])\n      .map(typeName => typeName.toLowerCase())\n      .includes(feature.get('type').toLowerCase())\n}\n\nfunction filterSubpart(feature: Feature, config: AnyConfigurationModel) {\n  return makeSubpartsFilter('subParts', config)(feature)\n}\n\nfunction isUTR(feature: Feature) {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n\nfunction makeUTRs(parent: Feature, subs: Feature[]) {\n  // based on Lincoln's UTR-making code in Bio::Graphics::Glyph::processed_transcript\n  const subparts = [...subs]\n\n  let codeStart = Infinity\n  let codeEnd = -Infinity\n\n  let haveLeftUTR\n  let haveRightUTR\n\n  // gather exons, find coding start and end, and look for UTRs\n  const exons = []\n  for (let i = 0; i < subparts.length; i++) {\n    const type = subparts[i].get('type')\n    if (/^cds/i.test(type)) {\n      if (codeStart > subparts[i].get('start')) {\n        codeStart = subparts[i].get('start')\n      }\n      if (codeEnd < subparts[i].get('end')) {\n        codeEnd = subparts[i].get('end')\n      }\n    } else if (/exon/i.test(type)) {\n      exons.push(subparts[i])\n    } else if (isUTR(subparts[i])) {\n      haveLeftUTR = subparts[i].get('start') === parent.get('start')\n      haveRightUTR = subparts[i].get('end') === parent.get('end')\n    }\n  }\n\n  // bail if we don't have exons and CDS\n  if (!(exons.length && codeStart < Infinity && codeEnd > -Infinity)) {\n    return subparts\n  }\n\n  // make sure the exons are sorted by coord\n  exons.sort((a, b) => a.get('start') - b.get('start'))\n\n  const strand = parent.get('strand')\n\n  // make the left-hand UTRs\n  let start\n  let end\n  if (!haveLeftUTR) {\n    for (let i = 0; i < exons.length; i++) {\n      start = exons[i].get('start')\n      if (start >= codeStart) {\n        break\n      }\n      end = codeStart > exons[i].get('end') ? exons[i].get('end') : codeStart\n      const type = strand >= 0 ? 'five_prime_UTR' : 'three_prime_UTR'\n      subparts.unshift(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  // make the right-hand UTRs\n  if (!haveRightUTR) {\n    for (let i = exons.length - 1; i >= 0; i--) {\n      end = exons[i].get('end')\n      if (end <= codeEnd) {\n        break\n      }\n\n      start = codeEnd < exons[i].get('start') ? exons[i].get('start') : codeEnd\n      const type = strand >= 0 ? 'three_prime_UTR' : 'five_prime_UTR'\n      subparts.push(\n        new SimpleFeature({\n          parent,\n          id: `${parent.id()}_${type}_${i}`,\n          data: { start, end, strand, type },\n        }),\n      )\n    }\n  }\n\n  return subparts\n}\n\nfunction getSubparts(f: Feature, config: AnyConfigurationModel) {\n  let c = f.get('subfeatures')\n  if (!c || !c.length) {\n    return []\n  }\n  const hasUTRs = !!c.find(child => isUTR(child))\n  const isTranscript = ['mRNA', 'transcript'].includes(f.get('type'))\n  const impliedUTRs = !hasUTRs && isTranscript\n\n  // if we think we should use impliedUTRs, or it is specifically in the\n  // config, then makeUTRs\n  if (impliedUTRs || readConfObject(config, 'impliedUTRs')) {\n    c = makeUTRs(f, c)\n  }\n\n  return c.filter(element => filterSubpart(element, config))\n}\n\nProcessedTranscript.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const subfeatures = getSubparts(feature, config)\n  layOutSubfeatures({\n    layout: subLayout,\n    subfeatures,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  return subLayout\n}\n\nexport default observer(ProcessedTranscript)\n","import React from 'react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { observer } from 'mobx-react'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { SceneGraph } from '@jbrowse/core/util/layouts'\nimport {\n  chooseGlyphComponent,\n  ExtraGlyphValidator,\n  layOut,\n  layOutFeature,\n} from './util'\n\nfunction Subfeatures(props: {\n  feature: Feature\n  featureLayout: SceneGraph\n  selected?: boolean\n}) {\n  const { feature, featureLayout, selected } = props\n\n  return (\n    <>\n      {feature.get('subfeatures')?.map(subfeature => {\n        const subfeatureId = String(subfeature.id())\n        const subfeatureLayout = featureLayout.getSubRecord(subfeatureId)\n        if (!subfeatureLayout) {\n          return null\n        }\n        const { GlyphComponent } = subfeatureLayout.data || {}\n        return (\n          <GlyphComponent\n            key={`glyph-${subfeatureId}`}\n            {...props}\n            feature={subfeature}\n            featureLayout={subfeatureLayout}\n            selected={selected}\n          />\n        )\n      })}\n    </>\n  )\n}\n\nSubfeatures.layOut = ({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: {\n  layout: SceneGraph\n  feature: Feature\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n  extraGlyphs: ExtraGlyphValidator[]\n}) => {\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  const displayMode = readConfObject(config, 'displayMode')\n  if (displayMode !== 'reducedRepresentation') {\n    let topOffset = 0\n    feature.get('subfeatures')?.forEach(subfeature => {\n      const SubfeatureGlyphComponent = chooseGlyphComponent(\n        subfeature,\n        extraGlyphs,\n      )\n      const subfeatureHeight = readConfObject(config, 'height', {\n        feature: subfeature,\n      }) as number\n\n      const subSubLayout = (SubfeatureGlyphComponent.layOut || layOut)({\n        layout: subLayout,\n        feature: subfeature,\n        bpPerPx,\n        reversed,\n        config,\n        extraGlyphs,\n      })\n      subSubLayout.move(0, topOffset)\n      topOffset +=\n        displayMode === 'collapse'\n          ? 0\n          : (displayMode === 'compact'\n              ? subfeatureHeight / 3\n              : subfeatureHeight) + 2\n    })\n  }\n  return subLayout\n}\n\nexport default observer(Subfeatures)\n","import React from 'react'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport SceneGraph from '@jbrowse/core/util/layouts/SceneGraph'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration/configurationSchema'\nimport Box from './Box'\nimport ProcessedTranscript from './ProcessedTranscript'\nimport Segments from './Segments'\nimport Subfeatures from './Subfeatures'\nimport { Region } from '@jbrowse/core/util'\n\nexport interface Glyph\n  extends React.FC<{\n    children: React.ReactNode\n    feature: Feature\n    featureLayout: SceneGraph\n    selected?: boolean\n    config: AnyConfigurationModel\n    region: Region\n    bpPerPx: number\n    topLevel?: boolean\n    [key: string]: unknown\n  }> {\n  layOut?: Function\n}\n\ntype LayoutRecord = [number, number, number, number]\n\nexport interface DisplayModel {\n  getFeatureByID?: (arg0: string, arg1: string) => LayoutRecord\n  getFeatureOverlapping?: (\n    blockKey: string,\n    bp: number,\n    y: number,\n  ) => string | undefined\n  selectedFeatureId?: string\n  featureIdUnderMouse?: string\n  contextMenuFeature?: Feature\n}\n\nexport interface ExtraGlyphValidator {\n  glyph: Glyph\n  validator: (feature: Feature) => boolean\n}\n\nexport function chooseGlyphComponent(\n  feature: Feature,\n  extraGlyphs?: ExtraGlyphValidator[],\n): Glyph {\n  const type = feature.get('type')\n  const subfeatures = feature.get('subfeatures')\n\n  if (subfeatures && type !== 'CDS') {\n    const hasSubSub = subfeatures.find(sub => !!sub.get('subfeatures'))\n    if (\n      ['mRNA', 'transcript', 'primary_transcript'].includes(type) &&\n      subfeatures.find(f => f.get('type') === 'CDS')\n    ) {\n      return ProcessedTranscript\n    } else if (!feature.parent() && hasSubSub) {\n      // only do sub-sub on parent level features like gene\n      return Subfeatures\n    } else {\n      return Segments\n    }\n  }\n\n  return extraGlyphs?.find(f => f.validator(feature))?.glyph || Box\n}\n\ninterface BaseLayOutArgs {\n  layout: SceneGraph\n  bpPerPx: number\n  reversed: boolean\n  config: AnyConfigurationModel\n}\n\ninterface FeatureLayOutArgs extends BaseLayOutArgs {\n  feature: Feature\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\ninterface SubfeatureLayOutArgs extends BaseLayOutArgs {\n  subfeatures: Feature[]\n  extraGlyphs: ExtraGlyphValidator[]\n}\n\nexport function layOut({\n  layout,\n  feature,\n  bpPerPx,\n  reversed,\n  config,\n  extraGlyphs,\n}: FeatureLayOutArgs): SceneGraph {\n  const displayMode = readConfObject(config, 'displayMode')\n  const subLayout = layOutFeature({\n    layout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  if (displayMode !== 'reducedRepresentation') {\n    layOutSubfeatures({\n      layout: subLayout,\n      subfeatures: feature.get('subfeatures') || [],\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  }\n  return subLayout\n}\n\nexport function layOutFeature(args: FeatureLayOutArgs): SceneGraph {\n  const { layout, feature, bpPerPx, reversed, config, extraGlyphs } = args\n  const displayMode = readConfObject(config, 'displayMode') as string\n  const GlyphComponent =\n    displayMode === 'reducedRepresentation'\n      ? Box\n      : chooseGlyphComponent(feature, extraGlyphs)\n  const parentFeature = feature.parent()\n  let x = 0\n  if (parentFeature) {\n    x =\n      (reversed\n        ? parentFeature.get('end') - feature.get('end')\n        : feature.get('start') - parentFeature.get('start')) / bpPerPx\n  }\n  const height = readConfObject(config, 'height', { feature }) as number\n  const width = (feature.get('end') - feature.get('start')) / bpPerPx\n  const layoutParent = layout.parent\n  const top = layoutParent ? layoutParent.top : 0\n  const subLayout = layout.addChild(\n    String(feature.id()),\n    x,\n    displayMode === 'collapse' ? 0 : top,\n    Math.max(width, 1), // has to be at least one to register in the layout\n    displayMode === 'compact' ? height / 2 : height,\n    { GlyphComponent },\n  )\n  return subLayout\n}\n\nexport function layOutSubfeatures(args: SubfeatureLayOutArgs): void {\n  const { layout, subfeatures, bpPerPx, reversed, config, extraGlyphs } = args\n  subfeatures.forEach(feature => {\n    ;(chooseGlyphComponent(feature, extraGlyphs).layOut || layOut)({\n      layout,\n      feature,\n      bpPerPx,\n      reversed,\n      config,\n      extraGlyphs,\n    })\n  })\n}\n\nexport function isUTR(feature: Feature): boolean {\n  return /(\\bUTR|_UTR|untranslated[_\\s]region)\\b/.test(\n    feature.get('type') || '',\n  )\n}\n","import React, { useEffect, useRef, useState, useCallback } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { bpToPx, measureText, Region, Feature } from '@jbrowse/core/util'\nimport { BaseLayout, SceneGraph } from '@jbrowse/core/util/layouts'\n\nimport FeatureGlyph from './FeatureGlyph'\nimport SvgOverlay from './SvgOverlay'\nimport {\n  chooseGlyphComponent,\n  layOut,\n  ExtraGlyphValidator,\n  DisplayModel,\n} from './util'\n\n// used to make features have a little padding for their labels\nconst namePadding = 2\nconst textPadding = 2\n\n// used so that user can click-away-from-feature below the laid out features\n// (issue #1248)\nconst svgHeightPadding = 100\n\nfunction RenderedFeatureGlyph(props: {\n  feature: Feature\n  bpPerPx: number\n  region: Region\n  config: AnyConfigurationModel\n  layout: BaseLayout<unknown>\n  extraGlyphs: ExtraGlyphValidator[]\n  displayMode: string\n  displayModel: DisplayModel\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  [key: string]: unknown\n}) {\n  const { feature, bpPerPx, region, config, displayMode, layout, extraGlyphs } =\n    props\n  const { reversed } = region\n  const start = feature.get(reversed ? 'end' : 'start')\n  const startPx = bpToPx(start, region, bpPerPx)\n  const labelsAllowed = displayMode !== 'compact' && displayMode !== 'collapsed'\n\n  const rootLayout = new SceneGraph('root', 0, 0, 0, 0)\n  const GlyphComponent = chooseGlyphComponent(feature, extraGlyphs)\n  const featureLayout = (GlyphComponent.layOut || layOut)({\n    layout: rootLayout,\n    feature,\n    bpPerPx,\n    reversed,\n    config,\n    extraGlyphs,\n  })\n  let shouldShowName = false\n  let shouldShowDescription = false\n  let name = ''\n  let description = ''\n  let fontHeight = 0\n  let expansion = 0\n  if (labelsAllowed) {\n    const showLabels = readConfObject(config, 'showLabels')\n    const showDescriptions = readConfObject(config, 'showDescriptions')\n    fontHeight = readConfObject(config, ['labels', 'fontSize'], { feature })\n    expansion = readConfObject(config, 'maxFeatureGlyphExpansion') || 0\n    name = String(readConfObject(config, ['labels', 'name'], { feature }) || '')\n    shouldShowName = /\\S/.test(name) && showLabels\n\n    const getWidth = (text: string) => {\n      const glyphWidth = rootLayout.width + expansion\n      const textWidth = measureText(text, fontHeight)\n      return Math.round(Math.min(textWidth, glyphWidth)) + namePadding\n    }\n\n    description = String(\n      readConfObject(config, ['labels', 'description'], { feature }) || '',\n    )\n    shouldShowDescription =\n      /\\S/.test(description) && showLabels && showDescriptions\n\n    if (shouldShowName) {\n      rootLayout.addChild(\n        'nameLabel',\n        0,\n        featureLayout.bottom + textPadding,\n        getWidth(name),\n        fontHeight,\n      )\n    }\n\n    if (shouldShowDescription) {\n      const aboveLayout = shouldShowName\n        ? rootLayout.getSubRecord('nameLabel')\n        : featureLayout\n\n      rootLayout.addChild(\n        'descriptionLabel',\n        0,\n        aboveLayout.bottom + textPadding,\n        getWidth(description),\n        fontHeight,\n      )\n    }\n  }\n\n  const topPx = layout.addRect(\n    feature.id(),\n    feature.get('start'),\n    feature.get('start') + rootLayout.width * bpPerPx,\n    rootLayout.height,\n  )\n  if (topPx === null) {\n    return null\n  }\n  rootLayout.move(startPx, topPx)\n\n  return (\n    <FeatureGlyph\n      rootLayout={rootLayout}\n      name={name}\n      shouldShowName={shouldShowName}\n      description={description}\n      shouldShowDescription={shouldShowDescription}\n      fontHeight={fontHeight}\n      allowedWidthExpansion={expansion}\n      reversed={region.reversed}\n      topLevel={true}\n      {...props}\n    />\n  )\n}\n\nconst RenderedFeatures = observer(\n  (props: {\n    features: Map<string, Feature>\n    isFeatureDisplayed: (f: Feature) => boolean\n    bpPerPx: number\n    config: AnyConfigurationModel\n    displayMode: string\n    displayModel: DisplayModel\n    region: Region\n    extraGlyphs: ExtraGlyphValidator[]\n    layout: BaseLayout<unknown>\n    viewParams: {\n      start: number\n      end: number\n      offsetPx: number\n      offsetPx1: number\n    }\n    [key: string]: unknown\n  }) => {\n    const { features = new Map(), isFeatureDisplayed } = props\n    return (\n      <>\n        {[...features.values()]\n          .filter(feature => isFeatureDisplayed(feature))\n          .map(feature => (\n            <RenderedFeatureGlyph\n              key={feature.id()}\n              feature={feature}\n              {...props}\n            />\n          ))}\n      </>\n    )\n  },\n)\n\nfunction SvgFeatureRendering(props: {\n  layout: BaseLayout<unknown>\n  blockKey: string\n  regions: Region[]\n  bpPerPx: number\n  config: AnyConfigurationModel\n  features: Map<string, Feature>\n  displayModel: DisplayModel\n  exportSVG: boolean\n  viewParams: {\n    start: number\n    end: number\n    offsetPx: number\n    offsetPx1: number\n  }\n  featureDisplayHandler: (f: Feature) => boolean\n  extraGlyphs: ExtraGlyphValidator[]\n  onMouseOut?: React.MouseEventHandler\n  onMouseDown?: React.MouseEventHandler\n  onMouseLeave?: React.MouseEventHandler\n  onMouseEnter?: React.MouseEventHandler\n  onMouseOver?: React.MouseEventHandler\n  onMouseMove?: (event: React.MouseEvent, featureId?: string) => void\n  onMouseUp?: React.MouseEventHandler\n  onClick?: React.MouseEventHandler\n}) {\n  const {\n    layout,\n    blockKey,\n    regions,\n    bpPerPx,\n    config,\n    displayModel = {},\n    exportSVG,\n    featureDisplayHandler = () => true,\n    onMouseOut,\n    onMouseDown,\n    onMouseLeave,\n    onMouseEnter,\n    onMouseOver,\n    onMouseMove,\n    onMouseUp,\n    onClick,\n  } = props\n  const [region] = regions || []\n  const width = (region.end - region.start) / bpPerPx\n  const displayMode = readConfObject(config, 'displayMode') as string\n\n  const ref = useRef<SVGSVGElement>(null)\n  const [mouseIsDown, setMouseIsDown] = useState(false)\n  const [height, setHeight] = useState(0)\n  const [movedDuringLastMouseDown, setMovedDuringLastMouseDown] =\n    useState(false)\n  const mouseDown = useCallback(\n    event => {\n      setMouseIsDown(true)\n      setMovedDuringLastMouseDown(false)\n      return onMouseDown?.(event)\n    },\n    [onMouseDown],\n  )\n\n  const mouseUp = useCallback(\n    event => {\n      setMouseIsDown(false)\n      return onMouseUp?.(event)\n    },\n    [onMouseUp],\n  )\n\n  const mouseMove = useCallback(\n    event => {\n      if (!ref.current) {\n        return\n      }\n      if (mouseIsDown) {\n        setMovedDuringLastMouseDown(true)\n      }\n      const { left, top } = ref.current.getBoundingClientRect()\n      const offsetX = event.clientX - left\n      const offsetY = event.clientY - top\n      const px = region.reversed ? width - offsetX : offsetX\n      const clientBp = region.start + bpPerPx * px\n\n      const featureIdCurrentlyUnderMouse = displayModel.getFeatureOverlapping?.(\n        blockKey,\n        clientBp,\n        offsetY,\n      )\n\n      if (onMouseMove) {\n        onMouseMove(event, featureIdCurrentlyUnderMouse)\n      }\n    },\n    [\n      blockKey,\n      bpPerPx,\n      mouseIsDown,\n      onMouseMove,\n      region.reversed,\n      region.start,\n      displayModel,\n      width,\n    ],\n  )\n\n  const click = useCallback(\n    event => {\n      // don't select a feature if we are clicking and dragging\n      if (movedDuringLastMouseDown) {\n        return\n      }\n      onClick?.(event)\n    },\n    [movedDuringLastMouseDown, onClick],\n  )\n\n  useEffect(() => {\n    setHeight(layout.getTotalHeight())\n  }, [layout])\n\n  if (exportSVG) {\n    return (\n      <RenderedFeatures\n        displayMode={displayMode}\n        isFeatureDisplayed={featureDisplayHandler}\n        region={region}\n        {...props}\n      />\n    )\n  }\n  return (\n    <svg\n      ref={ref}\n      data-testid=\"svgfeatures\"\n      width={width}\n      height={height + svgHeightPadding}\n      onMouseDown={mouseDown}\n      onMouseUp={mouseUp}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onMouseOver={onMouseOver}\n      onMouseOut={onMouseOut}\n      onMouseMove={mouseMove}\n      onClick={click}\n    >\n      <RenderedFeatures\n        displayMode={displayMode}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n        isFeatureDisplayed={featureDisplayHandler}\n        {...props}\n      />\n      <SvgOverlay\n        {...props}\n        region={region}\n        movedDuringLastMouseDown={movedDuringLastMouseDown}\n      />\n    </svg>\n  )\n}\n\nexport default observer(SvgFeatureRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'SvgFeatureRenderer',\n  {\n    color1: {\n      type: 'color',\n      description: 'the main color of each feature',\n      defaultValue: 'goldenrod',\n      contextVariable: ['feature'],\n    },\n    color2: {\n      type: 'color',\n      description:\n        'the secondary color of each feature, used for connecting lines, etc',\n      defaultValue: 'black',\n      contextVariable: ['feature'],\n    },\n    color3: {\n      type: 'color',\n      description:\n        'the tertiary color of each feature, often used for contrasting fills, like on UTRs',\n      defaultValue: '#357089',\n      contextVariable: ['feature'],\n    },\n\n    outline: {\n      type: 'color',\n      description: 'the outline for features',\n      defaultValue: '',\n      contextVariable: ['feature'],\n    },\n    height: {\n      type: 'number',\n      description: 'height in pixels of the main body of each feature',\n      defaultValue: 10,\n      contextVariable: ['feature'],\n    },\n    showLabels: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    showDescriptions: {\n      type: 'boolean',\n      defaultValue: true,\n    },\n    labels: ConfigurationSchema('SvgFeatureLabels', {\n      name: {\n        type: 'string',\n        description:\n          'the primary name of the feature to show, if space is available',\n        defaultValue: `jexl:get(feature,'name') || get(feature,'id')`,\n        contextVariable: ['feature'],\n      },\n      nameColor: {\n        type: 'color',\n        description: 'the color of the name label, if shown',\n        defaultValue: 'black',\n        contextVariable: ['feature'],\n      },\n      description: {\n        type: 'string',\n        description: 'the text description to show, if space is available',\n        defaultValue: `jexl:get(feature,'note') || get(feature,'description')`,\n        contextVariable: ['feature'],\n      },\n      descriptionColor: {\n        type: 'color',\n        description: 'the color of the description, if shown',\n        defaultValue: 'blue',\n        contextVariable: ['feature'],\n      },\n      fontSize: {\n        type: 'number',\n        description:\n          'height in pixels of the text to use for names and descriptions',\n        defaultValue: 13,\n        contextVariable: ['feature'],\n      },\n    }),\n    displayMode: {\n      type: 'stringEnum',\n      model: types.enumeration('displayMode', [\n        'normal',\n        'compact',\n        'reducedRepresentation',\n        'collapse',\n      ]),\n      description: 'Alternative display modes',\n      defaultValue: 'normal',\n    },\n    maxFeatureGlyphExpansion: {\n      type: 'number',\n      description:\n        \"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use\",\n      defaultValue: 500,\n    },\n    maxHeight: {\n      type: 'integer',\n      description: 'the maximum height to be used in a svg rendering',\n      defaultValue: 600,\n    },\n    subParts: {\n      type: 'string',\n      description: 'subparts for a glyph',\n      defaultValue: 'CDS,UTR,five_prime_UTR,three_prime_UTR',\n    },\n    impliedUTRs: {\n      type: 'boolean',\n      description: 'imply UTR from the exon and CDS differences',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import BoxRendererType from '@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  configSchema as svgFeatureRendererConfigSchema,\n  ReactComponent as SvgFeatureRendererReactComponent,\n} from './SvgFeatureRenderer'\n\nclass SvgFeatureRenderer extends BoxRendererType {\n  supportsSVG = true\n}\n\nexport default class SVGPlugin extends Plugin {\n  name = 'SVGPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addRendererType(\n      () =>\n        new SvgFeatureRenderer({\n          name: 'SvgFeatureRenderer',\n          ReactComponent: SvgFeatureRendererReactComponent,\n          configSchema: svgFeatureRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n  }\n}\n\nexport { svgFeatureRendererConfigSchema, SvgFeatureRendererReactComponent }\n","import { baseConnectionConfig } from '@jbrowse/core/pluggableElementTypes/models'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TheTrackHubRegistryConnection',\n  {\n    trackDbId: {\n      type: 'string',\n      defaultValue: '',\n      description: 'id of the trackDb in The Track Hub Registry',\n    },\n  },\n  { baseConfiguration: baseConnectionConfig },\n)\n","import { objectHash } from '@jbrowse/core/util'\nimport { generateUnsupportedTrackConf } from '@jbrowse/core/util/tracks'\n\nexport function generateTracks(trackDb, assemblyName, sequenceAdapter) {\n  // eslint-disable-next-line no-underscore-dangle\n  const { configuration } = trackDb._source\n  const subTracks = getSubtracks({ members: configuration })\n  return subTracks.map(subTrack => {\n    const ret = makeTrackConfig(\n      subTrack,\n      // eslint-disable-next-line no-underscore-dangle\n      trackDb._source.hub.url,\n      sequenceAdapter,\n    )\n    ret.trackId = `trackhub-registry-${objectHash(ret)}`\n    ret.assemblyNames = [assemblyName]\n    return ret\n  })\n\n  function getSubtracks(track, trackPath = []) {\n    if (track.members) {\n      return Object.values(track.members)\n        .map(subTrack =>\n          getSubtracks(\n            subTrack,\n            track.shortLabel ? trackPath.concat([track.shortLabel]) : trackPath,\n          ),\n        )\n        .flat()\n    }\n    track.categories = trackPath\n    return [track]\n  }\n}\n\nfunction makeTrackConfig(track, trackDbUrl, sequenceAdapter) {\n  const trackType = track.type\n  let baseTrackType = trackType.split(' ')[0].toLowerCase()\n  if (\n    baseTrackType === 'bam' &&\n    track.bigDataUrl.toLowerCase().endsWith('cram')\n  ) {\n    baseTrackType = 'cram'\n  }\n  const { bigDataUrl } = track\n  const bigDataLocation = {\n    uri: new URL(bigDataUrl, trackDbUrl).href,\n    locationType: 'UriLocation',\n  }\n  const { categories } = track\n  let bigDataIndexLocation\n  switch (baseTrackType) {\n    case 'bam':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex, locationType: 'LocalPathLocation' }\n          : {\n              localPath: `${track.bigDataUrl}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BamAdapter',\n          bamLocation: bigDataLocation,\n          index: {\n            location: bigDataIndexLocation,\n          },\n        },\n      }\n    case 'bed':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bed5floatscore':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedgraph':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bedrnaelements':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbarchart':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigbed':\n      return {\n        type: 'FeatureTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigBedAdapter',\n          bigBedLocation: bigDataLocation,\n        },\n      }\n    case 'bigchain':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'biginteract':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigpsl':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'bigwig':\n      return {\n        type: 'QuantitativeTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'BigWigAdapter',\n          bigWigLocation: bigDataLocation,\n        },\n      }\n    case 'broadpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'coloredexon':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'cram':\n      if (trackDbUrl) {\n        bigDataIndexLocation = track.bigDataIndex\n          ? {\n              uri: new URL(track.bigDataIndex, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n          : {\n              uri: new URL(`${track.bigDataUrl}.bai`, trackDbUrl).href,\n              locationType: 'UriLocation',\n            }\n      } else {\n        bigDataIndexLocation = track.bigDataIndex\n          ? { localPath: track.bigDataIndex, locationType: 'LocalPathLocation' }\n          : {\n              localPath: `${track.bigDataUrl}.bai`,\n              locationType: 'LocalPathLocation',\n            }\n      }\n      return {\n        type: 'AlignmentsTrack',\n        name: track.shortLabel,\n        description: track.longLabel,\n        category: categories,\n        adapter: {\n          type: 'CramAdapter',\n          bamLocation: bigDataLocation,\n          index: { location: bigDataIndexLocation },\n          sequenceAdapter,\n        },\n      }\n    case 'gvf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'ld2':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'narrowpeak':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'peptidemapping':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'vcftabix':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wig':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    case 'wigmaf':\n      return generateUnsupportedTrackConf(\n        track.shortLabel,\n        baseTrackType,\n        categories,\n      )\n    default:\n      throw new Error(`Unsupported track type: ${baseTrackType}`)\n  }\n}\n","import {\n  ConfigurationReference,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { BaseConnectionModelFactory } from '@jbrowse/core/pluggableElementTypes/models'\nimport { getSession } from '@jbrowse/core/util'\nimport { types } from 'mobx-state-tree'\nimport configSchema from './configSchema'\nimport { generateTracks } from './tracks'\n\nexport default function (pluginManager) {\n  return types.compose(\n    'TheTrackHubRegistryConnection',\n    BaseConnectionModelFactory(pluginManager),\n    types\n      .model({\n        type: types.literal('TheTrackHubRegistryConnection'),\n        configuration: ConfigurationReference(configSchema),\n      })\n      .actions(self => ({\n        connect(connectionConf) {\n          self.clear()\n          const trackDbId = readConfObject(connectionConf, 'trackDbId')\n          fetch(\n            `https://www.trackhubregistry.org/api/search/trackdb/${trackDbId}`,\n          )\n            .then(rawResponse => rawResponse.json())\n            .then(trackDb => {\n              // eslint-disable-next-line no-underscore-dangle\n              const assemblyName = trackDb._source.assembly.name\n              const session = getSession(self)\n              const assembly = session.assemblyManager.get(assemblyName)\n              const assemblyConf = assembly.configuration\n              const sequenceAdapter = readConfObject(assemblyConf, [\n                'sequence',\n                'adapter',\n              ])\n              self.setTrackConfs(\n                generateTracks(trackDb, assemblyName, sequenceAdapter),\n              )\n            })\n            .catch(error => {\n              console.error(error)\n            })\n        },\n      })),\n  )\n}\n","import { lazy } from 'react'\nimport ConnectionType from '@jbrowse/core/pluggableElementTypes/ConnectionType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { configSchema, modelFactory } from './trackhub-registry'\n\nexport default class TrackHubRegistryPlugin extends Plugin {\n  name = 'TrackHubRegistryPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addConnectionType(\n      () =>\n        new ConnectionType({\n          name: 'TheTrackHubRegistryConnection',\n          configSchema,\n          configEditorComponent: lazy(\n            () => import('./trackhub-registry/TrackHubRegistrySelect'),\n          ),\n          stateModel: modelFactory(pluginManager),\n          displayName: 'The Track Hub Registry',\n          description: 'A hub from The Track Hub Registry',\n          url: '//trackhubregistry.org/',\n        }),\n    )\n  }\n}\n","import Trix from '@gmod/trix'\nimport {\n  BaseTextSearchAdapter,\n  BaseArgs,\n  BaseAdapter,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport BaseResult from '@jbrowse/core/TextSearch/BaseResults'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getSubAdapterType } from '@jbrowse/core/data_adapters/dataAdapterCache'\n\nfunction decodeURIComponentNoThrow(uri: string) {\n  try {\n    return decodeURIComponent(uri)\n  } catch (e) {\n    // avoid throwing exception on a failure to decode URI component\n    return uri\n  }\n}\n\nfunction shorten(str: string, term: string, w = 15) {\n  const tidx = str.toLowerCase().indexOf(term)\n\n  return str.length < 40\n    ? str\n    : (Math.max(0, tidx - w) > 0 ? '...' : '') +\n        str.slice(Math.max(0, tidx - w), tidx + term.length + w).trim() +\n        (tidx + term.length < str.length ? '...' : '')\n}\n\nexport default class TrixTextSearchAdapter\n  extends BaseAdapter\n  implements BaseTextSearchAdapter\n{\n  indexingAttributes?: string[]\n  trixJs: Trix\n  tracksNames?: string[]\n\n  constructor(\n    config: AnyConfigurationModel,\n    getSubAdapter?: getSubAdapterType,\n    pluginManager?: PluginManager,\n  ) {\n    super(config, getSubAdapter, pluginManager)\n    const ixFilePath = readConfObject(config, 'ixFilePath')\n    const ixxFilePath = readConfObject(config, 'ixxFilePath')\n\n    if (!ixFilePath) {\n      throw new Error('must provide out.ix')\n    }\n    if (!ixxFilePath) {\n      throw new Error('must provide out.ixx')\n    }\n    this.trixJs = new Trix(\n      openLocation(ixxFilePath),\n      openLocation(ixFilePath),\n      1500,\n    )\n  }\n\n  /*\n   * Returns list of results\n   * @param args - search options/arguments include: search query\n   * limit of results to return, searchType...prefix | full | exact\", etc.\n   */\n  async searchIndex(args: BaseArgs) {\n    const query = args.queryString.toLowerCase()\n    const strs = query.split(' ')\n    const results = await this.trixJs.search(query)\n    const formatted = results\n      // if multi-word search try to filter out relevant items\n      .filter(([, data]) =>\n        strs.every(r =>\n          decodeURIComponentNoThrow(data).toLowerCase().includes(r),\n        ),\n      )\n      .map(([term, data]) => {\n        const result = JSON.parse(data.replace(/\\|/g, ',')) as string[]\n        const [loc, trackId, ...rest] = result.map(record =>\n          decodeURIComponentNoThrow(record),\n        )\n\n        const labelFieldIdx = rest.findIndex(elt => !!elt)\n        const contextIdx = rest\n          .map(elt => elt.toLowerCase())\n          .findIndex(f => f.indexOf(term.toLowerCase()) !== -1)\n\n        const labelField = rest[labelFieldIdx]\n        const contextField = rest[contextIdx]\n        const context =\n          contextIdx !== -1 ? shorten(contextField, term) : undefined\n        const label = shorten(labelField, term)\n\n        const displayString =\n          !context || label.toLowerCase() === context.toLowerCase()\n            ? label\n            : `${label} (${context})`\n\n        return new BaseResult({\n          locString: loc,\n          label: labelField,\n          displayString,\n          matchedObject: result.map(record => decodeURIComponent(record)),\n          trackId,\n        })\n      })\n\n    if (args.searchType === 'exact') {\n      return formatted.filter(\n        res => res.getLabel().toLowerCase() === args.queryString.toLowerCase(),\n      )\n    }\n    return formatted\n  }\n\n  freeResources() {}\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'TrixTextSearchAdapter',\n  {\n    ixFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ix', locationType: 'UriLocation' },\n      description: 'the location of the trix ix file',\n    },\n    ixxFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'out.ixx', locationType: 'UriLocation' },\n      description: 'the location of the trix ixx file',\n    },\n    metaFilePath: {\n      type: 'fileLocation',\n      defaultValue: { uri: 'meta.json', locationType: 'UriLocation' },\n      description: 'the location of the metadata json file for the trix index',\n    },\n    tracks: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of tracks covered by text search adapter',\n    },\n    assemblyNames: {\n      type: 'stringArray',\n      defaultValue: [],\n      description: 'List of assemblies covered by text search adapter',\n    },\n  },\n  { explicitlyTyped: true, explicitIdentifier: 'textSearchAdapterId' },\n)\n","import TextSearchAdapterType from '@jbrowse/core/pluggableElementTypes/TextSearchAdapterType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AdapterClass as TrixTextSearchAdapterClass,\n  configSchema as trixAdapterConfigSchema,\n} from './TrixTextSearchAdapter'\n\nexport default class extends Plugin {\n  name = 'TrixPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTextSearchAdapterType(\n      () =>\n        new TextSearchAdapterType({\n          name: 'TrixTextSearchAdapter',\n          configSchema: trixAdapterConfigSchema,\n          AdapterClass: TrixTextSearchAdapterClass,\n          description: 'Trix adapter',\n        }),\n    )\n  }\n}\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { parseBreakend } from '@gmod/vcf'\n\n/* eslint-disable no-underscore-dangle */\n\n/**\n * VCF Feature creation with lazy genotype evaluation.\n */\ninterface Samples {\n  [key: string]: {\n    [key: string]: { values: string[] | number[] | null }\n  }\n}\n\ninterface FeatureData {\n  [key: string]: unknown\n  refName: string\n  start: number\n  end: number\n  description?: string\n  type?: string\n  name?: string\n  aliases?: string[]\n  samples?: Samples\n}\n\nexport default class VCFFeature implements Feature {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private variant: any\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private parser: any\n\n  private data: FeatureData\n\n  private _id: string\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  constructor(args: { variant: any; parser: any; id: string }) {\n    this.variant = args.variant\n    this.parser = args.parser\n    this.data = this.dataFromVariant(this.variant)\n    this._id = args.id\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  get(field: string): any {\n    return field === 'samples'\n      ? this.variant.SAMPLES\n      : this.data[field] || this.variant[field]\n  }\n\n  set(): void {}\n\n  parent(): undefined {\n    return undefined\n  }\n\n  children(): undefined {\n    return undefined\n  }\n\n  tags(): string[] {\n    const t = [\n      ...Object.keys(this.data),\n      ...Object.keys(this.variant),\n      'samples',\n    ]\n    return t\n  }\n\n  id(): string {\n    return this._id\n  }\n\n  dataFromVariant(variant: {\n    REF: string\n    POS: number\n    ALT: string[]\n    CHROM: string\n    INFO: any // eslint-disable-line @typescript-eslint/no-explicit-any\n    ID: string[]\n  }): FeatureData {\n    const { REF, ALT, POS, CHROM, INFO, ID } = variant\n    const start = POS - 1\n    const [SO_term, description] = this._getSOTermAndDescription(REF, ALT)\n    const isTRA = ALT?.some(f => f === '<TRA>')\n    const isSymbolic = ALT?.some(f => f.indexOf('<') !== -1)\n\n    return {\n      refName: CHROM,\n      start,\n      end: isSymbolic && INFO.END && !isTRA ? +INFO.END[0] : start + REF.length,\n      description,\n      type: SO_term,\n      name: ID?.join(','),\n      aliases: ID && ID.length > 1 ? variant.ID.slice(1) : undefined,\n    }\n  }\n\n  /**\n   * Get a sequence ontology (SO) term that describes the variant type\n   */\n  _getSOTermAndDescription(\n    ref: string,\n    alt: string[],\n  ): [string, string] | [undefined, undefined] {\n    // it's just a remark if there are no alternate alleles\n    if (!alt || alt === []) {\n      return ['remark', 'no alternative alleles']\n    }\n\n    const soTerms = new Set<string>()\n    let descriptions = new Set<string>()\n    alt.forEach(a => {\n      let [soTerm, description] = this._getSOAndDescFromAltDefs(ref, a)\n\n      if (!soTerm) {\n        ;[soTerm, description] = this._getSOAndDescByExamination(ref, a)\n      }\n      if (soTerm && description) {\n        soTerms.add(soTerm)\n        descriptions.add(description)\n      }\n    })\n\n    // Combine descriptions like [\"SNV G -> A\", \"SNV G -> T\"] to [\"SNV G -> A,T\"]\n    if (descriptions.size > 1) {\n      const prefixes = new Set(\n        [...descriptions].map(desc => {\n          const prefix = desc.split('->')\n          return prefix[1] ? prefix[0] : desc\n        }),\n      )\n\n      const new_descs = [...prefixes].map(prefix => {\n        const suffixes = [...descriptions]\n          .map(desc => {\n            const pref = desc.split('-> ')\n            return pref[1] && pref[0] === prefix ? pref[1] : ''\n          })\n          .filter(f => !!f)\n\n        return suffixes.length\n          ? prefix + '-> ' + suffixes.join(',')\n          : [...descriptions].join(',')\n      })\n\n      descriptions = new Set(new_descs)\n    }\n    if (soTerms.size) {\n      return [[...soTerms].join(','), [...descriptions].join(',')]\n    }\n    return [undefined, undefined]\n  }\n\n  static _altTypeToSO: { [key: string]: string | undefined } = {\n    DEL: 'deletion',\n    INS: 'insertion',\n    DUP: 'duplication',\n    INV: 'inversion',\n    INVDUP: 'inverted duplication',\n    CNV: 'copy_number_variation',\n    TRA: 'translocation',\n    'DUP:TANDEM': 'tandem_duplication',\n    NON_REF: 'sequence_variant',\n    '*': 'sequence_variant',\n  }\n\n  _getSOAndDescFromAltDefs(\n    ref: string,\n    alt: string,\n  ): [string, string] | [undefined, undefined] {\n    if (typeof alt === 'string' && !alt.startsWith('<')) {\n      return [undefined, undefined]\n    }\n\n    // look for a definition with an SO type for this\n    let soTerm = VCFFeature._altTypeToSO[alt]\n    // if no SO term but ALT is in metadata, assume sequence_variant\n    if (!soTerm && this.parser.getMetadata('ALT', alt)) {\n      soTerm = 'sequence_variant'\n    }\n    if (soTerm) {\n      return [soTerm, alt]\n    }\n\n    // try to look for a definition for a parent term if we can\n    const modAlt = alt.split(':')\n    if (modAlt.length > 1) {\n      return this._getSOAndDescFromAltDefs(\n        ref,\n        `<${modAlt.slice(0, modAlt.length - 1).join(':')}>`,\n      )\n    }\n\n    // no parent\n    return [undefined, undefined]\n  }\n\n  // note: term SNV is used instead of SNP because SO definition of SNP says\n  // abundance must be at least 1% in population, and can't be sure we meet\n  // that\n  _getSOAndDescByExamination(ref: string, alt: string): [string, string] {\n    const bnd = parseBreakend(alt)\n    if (bnd) {\n      return ['breakend', alt]\n    } else if (ref.length === 1 && alt.length === 1) {\n      return ['SNV', this._makeDescriptionString('SNV', ref, alt)]\n    } else if (alt === '<INS>') {\n      return ['insertion', alt]\n    } else if (alt === '<DEL>') {\n      return ['deletion', alt]\n    } else if (alt === '<INV>') {\n      return ['deletion', alt]\n    } else if (alt === '<TRA>') {\n      return ['translocation', alt]\n    } else if (alt.includes('<')) {\n      return ['sv', alt]\n    } else if (ref.length === alt.length) {\n      if (ref.split('').reverse().join('') === alt) {\n        return ['inversion', this._makeDescriptionString('inversion', ref, alt)]\n      }\n      return [\n        'substitution',\n        this._makeDescriptionString('substitution', ref, alt),\n      ]\n    } else if (ref.length <= alt.length) {\n      return ['insertion', this._makeDescriptionString('insertion', ref, alt)]\n    } else if (ref.length > alt.length) {\n      return ['deletion', this._makeDescriptionString('deletion', ref, alt)]\n    }\n\n    return ['indel', this._makeDescriptionString('indel', ref, alt)]\n  }\n\n  _makeDescriptionString(soTerm: string, ref: string, alt: string): string {\n    return `${soTerm} ${ref} -> ${alt}`\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  toJSON(): any {\n    return {\n      uniqueId: this._id,\n      ...this.variant,\n      ...this.data,\n      samples: this.variant.SAMPLES,\n    }\n  }\n}\n","import {\n  baseChordDisplayConfig,\n  BaseChordDisplayModel,\n} from '@jbrowse/plugin-circular-view'\n\nconst ChordVariantDisplayF = pluginManager => {\n  const { jbrequire } = pluginManager\n\n  const { types } = jbrequire('mobx-state-tree')\n  const { ConfigurationSchema, ConfigurationReference } = jbrequire(\n    '@jbrowse/core/configuration',\n  )\n  const { getContainingView } = jbrequire('@jbrowse/core/util')\n  const { getParentRenderProps } = jbrequire('@jbrowse/core/util/tracks')\n  const configSchema = ConfigurationSchema(\n    'ChordVariantDisplay',\n    {\n      renderer: types.optional(\n        pluginManager.pluggableConfigSchemaType('renderer'),\n        { type: 'StructuralVariantChordRenderer' },\n      ),\n    },\n    { baseConfiguration: baseChordDisplayConfig, explicitlyTyped: true },\n  )\n\n  const stateModel = types\n    .compose(\n      'ChordVariantDisplay',\n      BaseChordDisplayModel,\n      types.model({\n        type: types.literal('ChordVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .views(self => ({\n      get rendererTypeName() {\n        return self.configuration.renderer.type\n      },\n\n      renderProps() {\n        const view = getContainingView(self)\n        return {\n          ...getParentRenderProps(self),\n          rpcDriverName: self.rpcDriverName,\n          displayModel: self,\n          bezierRadius: view.radiusPx * self.bezierRadiusRatio,\n          radius: view.radiusPx,\n          blockDefinitions: this.blockDefinitions,\n          config: self.configuration.renderer,\n          onChordClick: self.onChordClick,\n        }\n      },\n    }))\n\n  return { stateModel, configSchema }\n}\n\n// http://localhost:3000/test_data/hs37d5.HG002-SequelII-CCS.sv.vcf.gz.tbi\n\n// render request is for 1.5x the current viewing window\n\n// tracks all have a height\n//\nexport default ChordVariantDisplayF\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseChordDisplayComponentFactory } from '@jbrowse/plugin-circular-view'\nimport ChordVariantDisplay from './models/ChordVariantDisplay'\n\nexport default (pluginManager: PluginManager) => {\n  const { lib, load } = pluginManager\n  const DisplayType = lib['@jbrowse/core/pluggableElementTypes/DisplayType']\n\n  const { stateModel, configSchema } = load(ChordVariantDisplay)\n\n  return new DisplayType({\n    name: 'ChordVariantDisplay',\n    configSchema,\n    stateModel,\n    trackType: 'VariantTrack',\n    viewType: 'CircularView',\n    ReactComponent: BaseChordDisplayComponentFactory(pluginManager),\n  })\n}\n","import { getConf, ConfigurationReference } from '@jbrowse/core/configuration'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  getContainingTrack,\n  getSession,\n  getContainingView,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\n\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { linearBasicDisplayModelFactory } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport { LinearVariantDisplayConfigModel } from './configSchema'\n\nexport default function (configSchema: LinearVariantDisplayConfigModel) {\n  return types\n    .compose(\n      'LinearVariantDisplay',\n      linearBasicDisplayModelFactory(configSchema),\n      types.model({\n        type: types.literal('LinearVariantDisplay'),\n        configuration: ConfigurationReference(configSchema),\n      }),\n    )\n    .actions(self => ({\n      async selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSessionModelWithWidgets(session)) {\n          const { rpcManager } = session\n          const sessionId = getRpcSessionId(self)\n          const track = getContainingTrack(self)\n          const adapterConfig = getConf(track, 'adapter')\n          const header = await rpcManager.call(sessionId, 'CoreGetMetadata', {\n            adapterConfig,\n          })\n          const featureWidget = session.addWidget(\n            'VariantFeatureWidget',\n            'variantFeature',\n            {\n              featureData: feature.toJSON(),\n              view: getContainingView(self),\n              descriptions: header,\n            },\n          )\n          session.showWidget(featureWidget)\n        }\n\n        session.setSelection(feature)\n      },\n    }))\n}\n","import React, { useMemo } from 'react'\nimport { observer, PropTypes as MobxPropTypes } from 'mobx-react'\nimport { polarToCartesian } from '@jbrowse/core/util'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { PropTypes as CommonPropTypes } from '@jbrowse/core/util/types/mst'\nimport { parseBreakend } from '@gmod/vcf'\nimport PropTypes from 'prop-types'\n\nfunction bpToRadians(block, pos) {\n  const blockStart = block.region.elided ? 0 : block.region.start\n  const blockEnd = block.region.elided ? 0 : block.region.end\n  const bpOffset = block.flipped ? blockEnd - pos : pos - blockStart\n  const radians = bpOffset / block.bpPerRadian + block.startRadians\n  return radians\n}\n\nconst Chord = observer(function Chord({\n  feature,\n  blocksForRefs,\n  radius,\n  config,\n  bezierRadius,\n  selected,\n  onClick,\n}) {\n  // find the blocks that our start and end points belong to\n  const startBlock = blocksForRefs[feature.get('refName')]\n  if (!startBlock) {\n    return null\n  }\n  let svType\n  if (feature.get('INFO')) {\n    ;[svType] = feature.get('INFO').SVTYPE || []\n  } else if (feature.get('mate')) {\n    svType = 'mate'\n  }\n  let endPosition\n  let endBlock\n  const alt = feature.get('ALT')?.[0]\n  const bnd = alt && parseBreakend(alt)\n  if (bnd) {\n    // VCF BND\n    const matePosition = bnd.MatePosition.split(':')\n    endPosition = +matePosition[1]\n    endBlock = blocksForRefs[matePosition[0]]\n  } else if (alt === '<TRA>') {\n    // VCF TRA\n    const chr2 = feature.get('INFO')?.CHR2?.[0]\n    const end = feature.get('INFO')?.END?.[0]\n    endPosition = parseInt(end, 10)\n    endBlock = blocksForRefs[chr2]\n  } else if (svType === 'mate') {\n    // generic simplefeatures arcs\n    const mate = feature.get('mate')\n    const chr2 = mate.refName\n    endPosition = mate.start\n    endBlock = blocksForRefs[chr2]\n  }\n\n  if (endBlock) {\n    const startPos = feature.get('start')\n    const startRadians = bpToRadians(startBlock, startPos)\n    const endRadians = bpToRadians(endBlock, endPosition)\n    const startXY = polarToCartesian(radius, startRadians)\n    const endXY = polarToCartesian(radius, endRadians)\n    const controlXY = polarToCartesian(\n      bezierRadius,\n      (endRadians + startRadians) / 2,\n    )\n\n    const strokeColor = selected\n      ? readConfObject(config, 'strokeColorSelected', { feature })\n      : readConfObject(config, 'strokeColor', { feature })\n\n    const hoverStrokeColor = readConfObject(config, 'strokeColorHover', {\n      feature,\n    })\n    return (\n      <path\n        data-testid={`chord-${feature.id()}`}\n        d={['M', ...startXY, 'Q', ...controlXY, ...endXY].join(' ')}\n        style={{ stroke: strokeColor }}\n        onClick={evt =>\n          onClick(feature, startBlock.region, endBlock.region, evt)\n        }\n        onMouseOver={evt => {\n          if (!selected) {\n            evt.target.style.stroke = hoverStrokeColor\n            evt.target.style.strokeWidth = 3\n          }\n        }}\n        onMouseOut={evt => {\n          if (!selected) {\n            evt.target.style.stroke = strokeColor\n            evt.target.style.strokeWidth = 1\n          }\n        }}\n      />\n    )\n  }\n\n  return null\n})\n\nfunction StructuralVariantChords(props) {\n  const {\n    features,\n    config,\n    displayModel,\n    blockDefinitions,\n    radius,\n    bezierRadius,\n    displayModel: { selectedFeatureId },\n\n    onChordClick,\n  } = props\n  // make a map of refName -> blockDefinition\n  const blocksForRefsMemo = useMemo(() => {\n    const blocksForRefs = {}\n    blockDefinitions.forEach(block => {\n      const regions = block.region.elided\n        ? block.region.regions\n        : [block.region]\n      regions.forEach(region => {\n        blocksForRefs[region.refName] = block\n      })\n    })\n    return blocksForRefs\n  }, [blockDefinitions])\n  // console.log(blocksForRefs)\n  const chords = []\n  for (const [id, feature] of features) {\n    const selected = String(selectedFeatureId) === String(feature.id())\n    chords.push(\n      <Chord\n        key={id}\n        feature={feature}\n        config={config}\n        displayModel={displayModel}\n        radius={radius}\n        bezierRadius={bezierRadius}\n        blocksForRefs={blocksForRefsMemo}\n        selected={selected}\n        onClick={onChordClick}\n      />,\n    )\n  }\n  const trackStyleId = `chords-${displayModel.id}`\n  return (\n    <g id={trackStyleId} data-testid=\"structuralVariantChordRenderer\">\n      <style\n        // eslint-disable-next-line react/no-danger\n        dangerouslySetInnerHTML={{\n          __html: `\n          #${trackStyleId} > path {\n            cursor: crosshair;\n            fill: none;\n          }\n`,\n        }}\n      />\n      {chords}\n    </g>\n  )\n}\n\nStructuralVariantChords.propTypes = {\n  features: PropTypes.instanceOf(Map).isRequired,\n  config: CommonPropTypes.ConfigSchema.isRequired,\n  displayModel: MobxPropTypes.objectOrObservableObject,\n  blockDefinitions: PropTypes.arrayOf(MobxPropTypes.objectOrObservableObject)\n    .isRequired,\n  radius: PropTypes.number.isRequired,\n  bezierRadius: PropTypes.number.isRequired,\n  selectedFeatureId: PropTypes.string,\n  onChordClick: PropTypes.oneOfType([PropTypes.func, PropTypes.string]),\n}\n\nStructuralVariantChords.defaultProps = {\n  displayModel: undefined,\n  selectedFeatureId: '',\n  onChordClick: undefined,\n}\n\nexport default observer(StructuralVariantChords)\n","import ChordRendererType from '@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ReactComponent from './ReactComponent'\n\nconst ChordRendererConfigF = pluginManager => {\n  const configSchema = ConfigurationSchema(\n    'StructuralVariantChordRenderer',\n    {\n      strokeColor: {\n        type: 'color',\n        description: 'the line color of each arc',\n        defaultValue: 'rgba(255,133,0,0.32)',\n        contextVariable: ['feature'],\n      },\n      strokeColorSelected: {\n        type: 'color',\n        description: 'the line color of an arc that has been selected',\n        defaultValue: 'black',\n        contextVariable: ['feature'],\n      },\n      strokeColorHover: {\n        type: 'color',\n        description:\n          'the line color of an arc that is being hovered over with the mouse',\n        defaultValue: '#555',\n        contextVariable: ['feature'],\n      },\n    },\n    { explicitlyTyped: true },\n  )\n  return new ChordRendererType({\n    name: 'StructuralVariantChordRenderer',\n    ReactComponent,\n    configSchema,\n    pluginManager,\n  })\n}\n\nexport default ChordRendererConfigF\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { types } from 'mobx-state-tree'\nimport { stateModelFactory as baseModelFactory } from '@jbrowse/core/BaseFeatureWidget'\n\nexport const configSchema = ConfigurationSchema('VariantFeatureWidget', {})\n\nexport function stateModelFactory(pluginManager: PluginManager) {\n  const baseModel = baseModelFactory(pluginManager)\n  return types.compose(\n    baseModel,\n    types.model('VariantFeatureWidget', {\n      type: types.literal('VariantFeatureWidget'),\n      descriptions: types.frozen(),\n    }),\n  )\n}\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'VcfTabixAdapter',\n  {\n    vcfGzLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf.gz', locationType: 'UriLocation' },\n    },\n    index: ConfigurationSchema('VcfIndex', {\n      indexType: {\n        model: types.enumeration('IndexType', ['TBI', 'CSI']),\n        type: 'stringEnum',\n        defaultValue: 'TBI',\n      },\n      location: {\n        type: 'fileLocation',\n        defaultValue: {\n          uri: '/path/to/my.vcf.gz.tbi',\n          locationType: 'UriLocation',\n        },\n      },\n    }),\n  },\n  { explicitlyTyped: true },\n)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'VcfAdapter',\n  {\n    vcfLocation: {\n      type: 'fileLocation',\n      defaultValue: { uri: '/path/to/my.vcf', locationType: 'UriLocation' },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { lazy } from 'react'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport WidgetType from '@jbrowse/core/pluggableElementTypes/WidgetType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport ChordVariantDisplay from './ChordVariantDisplay'\nimport {\n  configSchemaFactory as linearVariantDisplayConfigSchemaFactory,\n  modelFactory as linearVariantDisplayModelFactory,\n} from './LinearVariantDisplay'\nimport StructuralVariantChordRendererFactory from './StructuralVariantChordRenderer'\nimport {\n  configSchema as variantFeatureWidgetConfigSchema,\n  stateModelFactory as variantFeatureWidgetStateModelFactory,\n} from './VariantFeatureWidget'\nimport { configSchema as vcfTabixAdapterConfigSchema } from './VcfTabixAdapter'\nimport { configSchema as vcfAdapterConfigSchema } from './VcfAdapter'\nimport {\n  makeIndex,\n  makeIndexType,\n  AdapterGuesser,\n  getFileName,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class VariantsPlugin extends Plugin {\n  name = 'VariantsPlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'VcfTabixAdapter',\n          configSchema: vcfTabixAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./VcfTabixAdapter/VcfTabixAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.vcf\\.b?gz$/i\n          const adapterName = 'VcfTabixAdapter'\n          const fileName = getFileName(file)\n          const indexName = index && getFileName(index)\n          const obj = {\n            type: adapterName,\n            vcfGzLocation: file,\n            index: {\n              location: index || makeIndex(file, '.tbi'),\n              indexType: makeIndexType(indexName, 'CSI', 'TBI'),\n            },\n          }\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (\n            adapterName === 'VcfTabixAdapter' ||\n            adapterName === 'VcfAdapter'\n          ) {\n            return 'VariantTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'VcfAdapter',\n          configSchema: vcfAdapterConfigSchema,\n          getAdapterClass: () =>\n            import('./VcfAdapter/VcfAdapter').then(r => r.default),\n        }),\n    )\n\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.vcf$/i\n          const adapterName = 'VcfAdapter'\n          const fileName = getFileName(file)\n          if (regexGuess.test(fileName) || adapterHint === adapterName) {\n            return {\n              type: adapterName,\n              vcfLocation: file,\n            }\n          }\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n\n    pluginManager.addRendererType(() =>\n      pluginManager.jbrequire(StructuralVariantChordRendererFactory),\n    )\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'VariantTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'VariantTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'VariantTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() =>\n      pluginManager.jbrequire(ChordVariantDisplay),\n    )\n\n    pluginManager.addDisplayType(() => {\n      const configSchema =\n        linearVariantDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearVariantDisplay',\n        configSchema,\n        stateModel: linearVariantDisplayModelFactory(configSchema),\n        trackType: 'VariantTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: BaseLinearDisplayComponent,\n      })\n    })\n\n    pluginManager.addWidgetType(\n      () =>\n        new WidgetType({\n          name: 'VariantFeatureWidget',\n          heading: 'Feature details',\n          configSchema: variantFeatureWidgetConfigSchema,\n          stateModel: variantFeatureWidgetStateModelFactory(pluginManager),\n          ReactComponent: lazy(\n            () => import('./VariantFeatureWidget/VariantFeatureWidget'),\n          ),\n        }),\n    )\n  }\n}\n\nexport { default as VcfFeature } from './VcfTabixAdapter/VcfFeature'\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { linearBasicDisplayConfigSchemaFactory } from '@jbrowse/plugin-linear-genome-view'\n\nexport function LinearVariantDisplayConfigFactory(\n  pluginManager: PluginManager,\n) {\n  const configSchema = linearBasicDisplayConfigSchemaFactory(pluginManager)\n\n  return ConfigurationSchema(\n    'LinearVariantDisplay',\n    {},\n    { baseConfiguration: configSchema, explicitlyTyped: true },\n  )\n}\n\nexport type LinearVariantDisplayConfigModel = ReturnType<\n  typeof LinearVariantDisplayConfigFactory\n>\nexport type LinearVariantDisplayConfig =\n  Instance<LinearVariantDisplayConfigModel>\n","import { Feature } from '@jbrowse/core/util/simpleFeature'\nimport FeatureRendererType, {\n  RenderArgs as FeatureRenderArgs,\n  RenderArgsSerialized,\n  RenderArgsDeserialized as FeatureRenderArgsDeserialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n} from '@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType'\nimport { renderToAbstractCanvas } from '@jbrowse/core/util/offscreenCanvasUtils'\nimport { ThemeOptions } from '@material-ui/core'\nimport { ScaleOpts } from './util'\n\nexport interface RenderArgs extends FeatureRenderArgs {\n  scaleOpts: ScaleOpts\n}\n\nexport interface RenderArgsDeserialized extends FeatureRenderArgsDeserialized {\n  bpPerPx: number\n  height: number\n  highResolutionScaling: number\n  scaleOpts: ScaleOpts\n  displayCrossHatches: boolean\n  ticks: { values: number[] }\n  theme: ThemeOptions\n}\n\nexport interface RenderArgsDeserializedWithFeatures\n  extends RenderArgsDeserialized {\n  features: Map<string, Feature>\n}\n\nexport type {\n  RenderArgsSerialized,\n  RenderResults,\n  ResultsSerialized,\n  ResultsDeserialized,\n}\n\nexport default abstract class WiggleBaseRenderer extends FeatureRendererType {\n  supportsSVG = true\n\n  async render(renderProps: RenderArgsDeserialized) {\n    const features = await this.getFeatures(renderProps)\n    const { height, regions, bpPerPx } = renderProps\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    const res = await renderToAbstractCanvas(\n      width,\n      height,\n      renderProps,\n      (ctx: CanvasRenderingContext2D) =>\n        this.draw(ctx, {\n          ...renderProps,\n          features,\n        }),\n    )\n\n    const results = await super.render({\n      ...renderProps,\n      ...res,\n      features,\n      height,\n      width,\n    })\n\n    return {\n      ...results,\n      ...res,\n      features,\n      containsNoTransferables: true,\n      height,\n      width,\n    }\n  }\n\n  /*\n   * draw features to context given props, to be used by derived renderer\n   * classes\n   */\n  abstract draw<T extends RenderArgsDeserializedWithFeatures>(\n    ctx: CanvasRenderingContext2D,\n    props: T,\n  ): void\n}\n","import { observer } from 'mobx-react'\nimport React, { useRef } from 'react'\n\nimport { Region } from '@jbrowse/core/util/types'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { PrerenderedCanvas } from '@jbrowse/core/ui'\n\nfunction WiggleRendering(props: {\n  regions: Region[]\n  features: Map<string, Feature>\n  bpPerPx: number\n  width: number\n  height: number\n  onMouseLeave: Function\n  onMouseMove: Function\n  onFeatureClick: Function\n  blockKey: string\n}) {\n  const {\n    regions,\n    features,\n    bpPerPx,\n    width,\n    height,\n    onMouseLeave = () => {},\n    onMouseMove = () => {},\n    onFeatureClick = () => {},\n  } = props\n  const [region] = regions\n  const ref = useRef<HTMLDivElement>(null)\n\n  function getFeatureUnderMouse(eventClientX: number) {\n    // calculates feature under mouse\n    let offset = 0\n    if (ref.current) {\n      offset = ref.current.getBoundingClientRect().left\n    }\n    const offsetX = eventClientX - offset\n    const px = region.reversed ? width - offsetX : offsetX\n    const clientBp = region.start + bpPerPx * px\n    let featureUnderMouse\n    for (const feature of features.values()) {\n      if (clientBp <= feature.get('end') && clientBp >= feature.get('start')) {\n        featureUnderMouse = feature\n        break\n      }\n    }\n    return featureUnderMouse\n  }\n  return (\n    <div\n      ref={ref}\n      data-testid=\"wiggle-rendering-test\"\n      onMouseMove={event => {\n        const featureUnderMouse = getFeatureUnderMouse(event.clientX)\n        onMouseMove(\n          event,\n          featureUnderMouse ? featureUnderMouse.id() : undefined,\n        )\n      }}\n      onClick={event => {\n        const featureUnderMouse = getFeatureUnderMouse(event.clientX)\n        onFeatureClick(\n          event,\n          featureUnderMouse ? featureUnderMouse.id() : undefined,\n        )\n      }}\n      onMouseLeave={event => onMouseLeave(event)}\n      role=\"presentation\"\n      className=\"WiggleRendering\"\n      style={{\n        overflow: 'visible',\n        position: 'relative',\n        height,\n      }}\n    >\n      <PrerenderedCanvas {...props} />\n    </div>\n  )\n}\n\nexport default observer(WiggleRendering)\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nexport default ConfigurationSchema(\n  'BigWigAdapter',\n  {\n    bigWigLocation: {\n      type: 'fileLocation',\n      defaultValue: {\n        uri: '/path/to/my.bw',\n        locationType: 'UriLocation',\n      },\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import { scaleLinear, scaleLog, scaleQuantize } from 'd3-scale'\n\nexport interface ScaleOpts {\n  domain: number[]\n  range: number[]\n  scaleType: string\n  pivotValue?: number\n  inverted: boolean\n}\n/**\n * produces a d3-scale from arguments. applies a \"nice domain\" adjustment\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - range [min,max]\n *   - bounds [min,max]\n *   - scaleType (linear or log)\n *   - pivotValue (number)\n *   - inverted (boolean)\n */\nexport function getScale({\n  domain = [],\n  range = [],\n  scaleType,\n  pivotValue,\n  inverted,\n}: ScaleOpts) {\n  let scale\n  const [min, max] = domain\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain')\n  }\n  if (scaleType === 'linear') {\n    scale = scaleLinear()\n  } else if (scaleType === 'log') {\n    scale = scaleLog()\n    scale.base(2)\n  } else if (scaleType === 'quantize') {\n    scale = scaleQuantize()\n  } else {\n    throw new Error('undefined scaleType')\n  }\n  scale.domain(pivotValue !== undefined ? [min, pivotValue, max] : [min, max])\n  scale.nice()\n\n  const [rangeMin, rangeMax] = range\n  if (rangeMin === undefined || rangeMax === undefined) {\n    throw new Error('invalid range')\n  }\n  scale.range(inverted ? range.slice().reverse() : range)\n  return scale\n}\n/**\n * gets the origin for drawing the graph. for linear this is 0, for log this is arbitrarily set to log(1)==0\n *\n * @param scaleType -\n */\nexport function getOrigin(scaleType: string /* , pivot, stats */) {\n  // if (pivot) {\n  //   if (pivot === 'mean') {\n  //     return stats.scoreMean || 0\n  //   }\n  //   if (pivot === 'zero') {\n  //     return 0\n  //   }\n  //   return parseFloat()\n  // }\n  // if (scaleType === 'z_score') {\n  //   return stats.scoreMean || 0\n  // }\n  if (scaleType === 'log') {\n    return 1\n  }\n  return 0\n}\n\n/**\n * produces a \"nice\" domain that actually rounds down to 0 for the min\n * or 0 to the max depending on if all values are positive or negative\n *\n * @param object - containing attributes\n *   - domain [min,max]\n *   - bounds [min,max]\n *   - mean\n *   - stddev\n *   - scaleType (linear or log)\n */\nexport function getNiceDomain({\n  scaleType,\n  domain,\n  bounds,\n}: {\n  scaleType: string\n  domain: number[]\n  bounds: number[]\n}) {\n  const [minScore, maxScore] = bounds\n  let [min, max] = domain\n\n  if (scaleType === 'linear') {\n    if (max < 0) {\n      max = 0\n    }\n    if (min > 0) {\n      min = 0\n    }\n  }\n  if (scaleType === 'log') {\n    // if the min is 0, assume that it's just something\n    // with no read coverage and that we should ignore it in calculations\n    // if it's greater than 1 pin to 1 for the full range also\n    // otherwise, we may see bigwigs with fractional values\n    if (min === 0 || min > 1) {\n      min = 1\n    }\n  }\n  if (min === undefined || max === undefined) {\n    throw new Error('invalid domain supplied to stats function')\n  }\n  if (minScore !== undefined && minScore !== Number.MIN_VALUE) {\n    min = minScore\n  }\n  if (maxScore !== undefined && maxScore !== Number.MAX_VALUE) {\n    max = maxScore\n  }\n  const getScaleType = (type: string) => {\n    if (type === 'linear') {\n      return scaleLinear()\n    }\n    if (type === 'log') {\n      const scale = scaleLog()\n      scale.base(2)\n      return scale\n    }\n    if (type === 'quantize') {\n      return scaleQuantize()\n    }\n    throw new Error(`undefined scaleType ${type}`)\n  }\n  const scale = getScaleType(scaleType)\n\n  scale.domain([min, max])\n  scale.nice()\n  return scale.domain() as [number, number]\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { types } from 'mobx-state-tree'\n\nexport default ConfigurationSchema(\n  'WiggleRenderer',\n  {\n    color: {\n      type: 'color',\n      description: 'the color of track, overrides posColor and negColor',\n      defaultValue: '#f0f',\n    },\n    posColor: {\n      type: 'color',\n      description: 'the color to use when the score is positive',\n      defaultValue: 'blue',\n    },\n    negColor: {\n      type: 'color',\n      description: 'the color to use when the score is negative',\n      defaultValue: 'red',\n    },\n    highlightColor: {\n      type: 'color',\n      description: 'the color of highlights over the wiggle track',\n      defaultValue: 'rgba(255,255,0,0.5)',\n    },\n    clipColor: {\n      type: 'color',\n      description: 'the color of the clipping marker',\n      defaultValue: 'red',\n    },\n    renderType: {\n      type: 'stringEnum',\n      model: types.enumeration('Rendering type', ['xyplot', 'density', 'line']),\n      description: 'The type of rendering for wiggle data to use',\n      defaultValue: 'xyplot',\n    },\n    filled: {\n      type: 'boolean',\n      description: 'fill in histogram',\n      defaultValue: true,\n    },\n    bicolorPivot: {\n      type: 'stringEnum',\n      model: types.enumeration('Scale type', [\n        'numeric',\n        'mean',\n        'z_score',\n        'none',\n      ]),\n      description: 'type of bicolor pivot',\n      defaultValue: 'numeric',\n    },\n    bicolorPivotValue: {\n      type: 'number',\n      defaultValue: 0,\n      description: 'value to use for bicolor pivot',\n    },\n    summaryScoreMode: {\n      type: 'stringEnum',\n      model: types.enumeration('Score type', ['max', 'min', 'avg', 'whiskers']),\n      description:\n        'choose whether to use max/min/average or whiskers which combines all three into the same rendering',\n      defaultValue: 'whiskers',\n    },\n    displayCrossHatches: {\n      type: 'boolean',\n      description: 'choose to draw cross hatches (sideways lines)',\n      defaultValue: false,\n    },\n  },\n  { explicitlyTyped: true },\n)\n","import {\n  readConfObject,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getScale } from '../util'\n\nimport ConfigSchema from '../configSchema'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\n\nexport { default as ReactComponent } from '../WiggleRendering'\n\nexport default class DensityRenderer extends WiggleBaseRenderer {\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const { features, regions, bpPerPx, scaleOpts, height, config } = props\n    const [region] = regions\n    const pivot = readConfObject(config, 'bicolorPivot')\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const color = readConfObject(config, 'color')\n    let colorCallback\n    if (color === '#f0f') {\n      const colorScale =\n        pivot !== 'none'\n          ? getScale({\n              ...scaleOpts,\n              pivotValue,\n              range: [negColor, 'white', posColor],\n            })\n          : getScale({ ...scaleOpts, range: ['white', posColor] })\n      colorCallback = (feature: Feature) => colorScale(feature.get('score'))\n    } else {\n      colorCallback = (feature: Feature) =>\n        readConfObject(config, 'color', { feature })\n    }\n\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n      ctx.fillStyle = colorCallback(feature)\n      ctx.fillRect(leftPx, 0, w, height)\n    }\n  }\n}\nexport const configSchema = ConfigurationSchema(\n  'DensityRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import React, { useMemo, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport { makeStyles, alpha, Portal } from '@material-ui/core'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\n\n// locals\nimport { YSCALEBAR_LABEL_OFFSET } from '../models/model'\nimport { usePopper } from 'react-popper'\n\n// convert to number, apply shortened precision, and render\nfunction toP(s = 0) {\n  return +(+s).toPrecision(6)\n}\n\nfunction round(value: number) {\n  return Math.round(value * 1e5) / 1e5\n}\n\nconst en = (n: number) => n.toLocaleString('en-US')\n\nconst useStyles = makeStyles(theme => ({\n  // these styles come from\n  // https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/Tooltip/Tooltip.js\n  tooltip: {\n    position: 'absolute',\n    pointerEvents: 'none',\n    backgroundColor: alpha(theme.palette.grey[700], 0.9),\n    borderRadius: theme.shape.borderRadius,\n    color: theme.palette.common.white,\n    fontFamily: theme.typography.fontFamily,\n    padding: '4px 8px',\n    fontSize: theme.typography.pxToRem(12),\n    lineHeight: `${round(14 / 10)}em`,\n    maxWidth: 300,\n    wordWrap: 'break-word',\n  },\n\n  hoverVertical: {\n    background: '#333',\n    border: 'none',\n    width: 1,\n    height: '100%',\n    top: YSCALEBAR_LABEL_OFFSET,\n    cursor: 'default',\n    position: 'absolute',\n    pointerEvents: 'none',\n  },\n}))\n\nconst TooltipContents = React.forwardRef<HTMLDivElement, { feature: Feature }>(\n  ({ feature }: { feature: Feature }, ref) => {\n    const start = feature.get('start')\n    const end = feature.get('end')\n    const name = feature.get('refName')\n    const loc = [name, start === end ? en(start) : `${en(start)}..${en(end)}`]\n      .filter(f => !!f)\n      .join(':')\n\n    return feature.get('summary') !== undefined ? (\n      <div ref={ref}>\n        {loc}\n        <br />\n        Max: {toP(feature.get('maxScore'))}\n        <br />\n        Avg: {toP(feature.get('score'))}\n        <br />\n        Min: {toP(feature.get('minScore'))}\n      </div>\n    ) : (\n      <div ref={ref}>\n        {loc}\n        <br />\n        {`${toP(feature.get('score'))}`}\n      </div>\n    )\n  },\n)\n\ntype Coord = [number, number]\n\nconst Tooltip = observer(\n  ({\n    model,\n    height,\n    clientMouseCoord,\n    offsetMouseCoord,\n    clientRect,\n    TooltipContents,\n  }: {\n    model: { featureUnderMouse: Feature }\n    height: number\n    clientMouseCoord: Coord\n    offsetMouseCoord: Coord\n    clientRect?: DOMRect\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    TooltipContents: React.FC<any>\n  }) => {\n    const { featureUnderMouse } = model\n    const [width, setWidth] = useState(0)\n    const [anchorEl, setAnchorEl] = useState<HTMLDivElement | null>(null)\n    const classes = useStyles()\n\n    // must be memoized a la https://github.com/popperjs/react-popper/issues/391\n    const virtElement = useMemo(\n      () => ({\n        getBoundingClientRect: () => {\n          const x = clientMouseCoord[0] + width / 2 + 20\n          const y = clientRect?.top || 0\n          return {\n            top: y,\n            left: x,\n            bottom: y,\n            right: x,\n            width: 0,\n            height: 0,\n            x,\n            y,\n            toJSON() {},\n          }\n        },\n      }),\n      [clientRect?.top, clientMouseCoord, width],\n    )\n    const { styles, attributes } = usePopper(virtElement, anchorEl)\n\n    return featureUnderMouse ? (\n      <>\n        <Portal>\n          <div\n            ref={setAnchorEl}\n            className={classes.tooltip}\n            // zIndex needed to go over widget drawer\n            style={{ ...styles.popper, zIndex: 100000 }}\n            {...attributes.popper}\n          >\n            <TooltipContents\n              ref={(elt: HTMLDivElement) => {\n                setWidth(elt?.getBoundingClientRect().width || 0)\n              }}\n              feature={featureUnderMouse}\n            />\n          </div>\n        </Portal>\n\n        <div\n          className={classes.hoverVertical}\n          style={{\n            left: offsetMouseCoord[0],\n            height: height - YSCALEBAR_LABEL_OFFSET * 2,\n          }}\n        />\n      </>\n    ) : null\n  },\n)\n\nconst WiggleTooltip = observer(\n  (props: {\n    model: { featureUnderMouse: Feature }\n    height: number\n    offsetMouseCoord: Coord\n    clientMouseCoord: Coord\n    clientRect?: DOMRect\n  }) => {\n    return <Tooltip TooltipContents={TooltipContents} {...props} />\n  },\n)\nexport default WiggleTooltip\nexport { Tooltip }\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Axis, LEFT, RIGHT } from 'react-d3-axis-mod'\nimport { WiggleDisplayModel } from '../models/model'\n\nconst YScaleBar = observer(\n  ({\n    model,\n    orientation,\n  }: {\n    model: WiggleDisplayModel\n    orientation?: string\n  }) => {\n    const { ticks } = model\n\n    return ticks ? (\n      <Axis\n        {...ticks}\n        shadow={2}\n        format={(n: number) => n}\n        style={{ orient: orientation === 'left' ? LEFT : RIGHT }}\n      />\n    ) : null\n  },\n)\nexport default YScaleBar\n","import React from 'react'\nimport {\n  measureText,\n  getContainingView,\n  getContainingTrack,\n} from '@jbrowse/core/util'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { BaseLinearDisplayComponent } from '@jbrowse/plugin-linear-genome-view'\nimport { observer } from 'mobx-react'\nimport { WiggleDisplayModel } from '../models/model'\nimport YScaleBar from './YScaleBar'\n\nconst LinearWiggleDisplay = observer((props: { model: WiggleDisplayModel }) => {\n  const { model } = props\n  const { stats, height, needsScalebar } = model\n\n  // @ts-ignore\n  const { trackLabels } = getContainingView(model)\n  const left =\n    trackLabels === 'overlapping'\n      ? measureText(getConf(getContainingTrack(model), 'name'), 12.8) + 100\n      : 50\n  return (\n    <div>\n      <BaseLinearDisplayComponent {...props} />\n      {stats && needsScalebar ? (\n        <svg\n          style={{\n            position: 'absolute',\n            top: 0,\n            left,\n            pointerEvents: 'none',\n            height,\n            width: 50,\n          }}\n        >\n          <YScaleBar model={model} />\n        </svg>\n      ) : null}\n    </div>\n  )\n})\n\nexport default LinearWiggleDisplay\n\nexport { YScaleBar }\n","import React, { lazy } from 'react'\nimport {\n  ConfigurationReference,\n  AnyConfigurationSchemaType,\n  getConf,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport {\n  isAbortException,\n  getSession,\n  getContainingView,\n  isSelectionContainer,\n} from '@jbrowse/core/util'\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks'\nimport {\n  BaseLinearDisplay,\n  LinearGenomeViewModel,\n} from '@jbrowse/plugin-linear-genome-view'\nimport { autorun, when } from 'mobx'\nimport { addDisposer, isAlive, types, getEnv, Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nimport { FeatureStats } from '@jbrowse/core/util/stats'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { axisPropsFromTickScale } from 'react-d3-axis-mod'\nimport { getNiceDomain, getScale } from '../../util'\n\nimport Tooltip from '../components/Tooltip'\nimport { YScaleBar } from '../components/WiggleDisplayComponent'\n\nconst SetMinMaxDlg = lazy(() => import('../components/SetMinMaxDialog'))\nconst SetColorDlg = lazy(() => import('../components/SetColorDialog'))\n\n// fudge factor for making all labels on the YScalebar visible\nexport const YSCALEBAR_LABEL_OFFSET = 5\n\n// using a map because it preserves order\nconst rendererTypes = new Map([\n  ['xyplot', 'XYPlotRenderer'],\n  ['density', 'DensityRenderer'],\n  ['line', 'LinePlotRenderer'],\n])\n\ntype LGV = LinearGenomeViewModel\n\nconst stateModelFactory = (\n  pluginManager: PluginManager,\n  configSchema: AnyConfigurationSchemaType,\n) =>\n  types\n    .compose(\n      'LinearWiggleDisplay',\n      BaseLinearDisplay,\n      types.model({\n        type: types.literal('LinearWiggleDisplay'),\n        configuration: ConfigurationReference(configSchema),\n        selectedRendering: types.optional(types.string, ''),\n        resolution: types.optional(types.number, 1),\n        fill: types.maybe(types.boolean),\n        color: types.maybe(types.string),\n        posColor: types.maybe(types.string),\n        negColor: types.maybe(types.string),\n        summaryScoreMode: types.maybe(types.string),\n        rendererTypeNameState: types.maybe(types.string),\n        scale: types.maybe(types.string),\n        autoscale: types.maybe(types.string),\n        displayCrossHatches: types.maybe(types.boolean),\n        constraints: types.optional(\n          types.model({\n            max: types.maybe(types.number),\n            min: types.maybe(types.number),\n          }),\n          {},\n        ),\n      }),\n    )\n    .volatile(() => ({\n      statsReady: false,\n      message: undefined as undefined | string,\n      stats: { scoreMin: 0, scoreMax: 50 },\n      statsFetchInProgress: undefined as undefined | AbortController,\n    }))\n    .actions(self => ({\n      updateStats({\n        scoreMin,\n        scoreMax,\n      }: {\n        scoreMin: number\n        scoreMax: number\n      }) {\n        if (\n          self.stats.scoreMin !== scoreMin ||\n          self.stats.scoreMax !== scoreMax\n        ) {\n          self.stats = { scoreMin, scoreMax }\n        }\n        self.statsReady = true\n      },\n      setColor(color: string) {\n        self.color = color\n      },\n      setPosColor(color: string) {\n        self.posColor = color\n      },\n      setNegColor(color: string) {\n        self.negColor = color\n      },\n\n      setLoading(aborter: AbortController) {\n        const { statsFetchInProgress: statsFetch } = self\n        if (statsFetch !== undefined && !statsFetch.signal.aborted) {\n          statsFetch.abort()\n        }\n        self.statsFetchInProgress = aborter\n      },\n\n      // this overrides the BaseLinearDisplayModel to avoid popping up a\n      // feature detail display, but still sets the feature selection on the\n      // model so listeners can detect a click\n      selectFeature(feature: Feature) {\n        const session = getSession(self)\n        if (isSelectionContainer(session)) {\n          session.setSelection(feature)\n        }\n      },\n      setResolution(res: number) {\n        self.resolution = res\n      },\n\n      setFill(fill: boolean) {\n        self.fill = fill\n      },\n\n      toggleLogScale() {\n        if (self.scale !== 'log') {\n          self.scale = 'log'\n        } else {\n          self.scale = 'linear'\n        }\n      },\n\n      setScaleType(scale?: string) {\n        self.scale = scale\n      },\n\n      setSummaryScoreMode(val: string) {\n        self.summaryScoreMode = val\n      },\n\n      setAutoscale(val: string) {\n        self.autoscale = val\n      },\n\n      setMaxScore(val?: number) {\n        self.constraints.max = val\n      },\n\n      setRendererType(val: string) {\n        self.rendererTypeNameState = val\n      },\n\n      setMinScore(val?: number) {\n        self.constraints.min = val\n      },\n\n      toggleCrossHatches() {\n        self.displayCrossHatches = !self.displayCrossHatches\n      },\n\n      setCrossHatches(cross: boolean) {\n        self.displayCrossHatches = cross\n      },\n    }))\n    .views(self => ({\n      get TooltipComponent() {\n        return Tooltip as unknown as React.FC\n      },\n\n      get adapterTypeName() {\n        return self.adapterConfig.type\n      },\n\n      get rendererTypeName() {\n        const viewName =\n          self.rendererTypeNameState || getConf(self, 'defaultRendering')\n        const rendererType = rendererTypes.get(viewName)\n        if (!rendererType) {\n          throw new Error(`unknown alignments view name ${viewName}`)\n        }\n        return rendererType\n      },\n\n      // subclasses can define these, as snpcoverage track does\n      get filters() {\n        return undefined\n      },\n\n      get scaleType() {\n        return self.scale || getConf(self, 'scaleType')\n      },\n\n      get maxScore() {\n        const { max } = self.constraints\n        return max ?? getConf(self, 'maxScore')\n      },\n\n      get minScore() {\n        const { min } = self.constraints\n        return min ?? getConf(self, 'minScore')\n      },\n    }))\n    .views(self => ({\n      get rendererConfig() {\n        const configBlob =\n          getConf(self, ['renderers', self.rendererTypeName]) || {}\n\n        return self.rendererType.configSchema.create(\n          {\n            ...configBlob,\n            filled: self.fill,\n            scaleType: self.scaleType,\n            displayCrossHatches: self.displayCrossHatches,\n            summaryScoreMode: self.summaryScoreMode,\n            ...(self.color ? { color: self.color } : {}),\n            ...(self.negColor ? { negColor: self.negColor } : {}),\n            ...(self.posColor ? { posColor: self.posColor } : {}),\n          },\n          getEnv(self),\n        )\n      },\n    }))\n    .views(self => {\n      let oldDomain: [number, number] = [0, 0]\n      return {\n        get filled() {\n          return self.fill ?? readConfObject(self.rendererConfig, 'filled')\n        },\n        get summaryScoreModeSetting() {\n          return (\n            self.summaryScoreMode ||\n            readConfObject(self.rendererConfig, 'summaryScoreMode')\n          )\n        },\n        get domain() {\n          const { stats, scaleType, minScore, maxScore } = self\n          const { scoreMin, scoreMax } = stats\n\n          const ret = getNiceDomain({\n            domain: [scoreMin, scoreMax],\n            bounds: [minScore, maxScore],\n            scaleType,\n          })\n\n          // avoid weird scalebar if log value and empty region displayed\n          if (scaleType === 'log' && ret[1] === Number.MIN_VALUE) {\n            return [0, Number.MIN_VALUE]\n          }\n\n          // avoid returning a new object if it matches the old value\n          if (JSON.stringify(oldDomain) !== JSON.stringify(ret)) {\n            oldDomain = ret\n          }\n\n          return oldDomain\n        },\n\n        get needsScalebar() {\n          return (\n            self.rendererTypeName === 'XYPlotRenderer' ||\n            self.rendererTypeName === 'LinePlotRenderer'\n          )\n        },\n        get scaleOpts() {\n          return {\n            domain: this.domain,\n            stats: self.stats,\n            autoscaleType: this.autoscaleType,\n            scaleType: self.scaleType,\n            inverted: getConf(self, 'inverted'),\n          }\n        },\n\n        get canHaveFill() {\n          return self.rendererTypeName === 'XYPlotRenderer'\n        },\n\n        get autoscaleType() {\n          return self.autoscale || getConf(self, 'autoscale')\n        },\n\n        get displayCrossHatchesSetting() {\n          return (\n            self.displayCrossHatches ||\n            readConfObject(self.rendererConfig, 'displayCrossHatches')\n          )\n        },\n      }\n    })\n    .views(self => ({\n      get ticks() {\n        const { scaleType, domain, height } = self\n        const minimalTicks = getConf(self, 'minimalTicks')\n        const range = [height - YSCALEBAR_LABEL_OFFSET, YSCALEBAR_LABEL_OFFSET]\n        const scale = getScale({\n          scaleType,\n          domain,\n          range,\n          inverted: getConf(self, 'inverted'),\n        })\n        const ticks = axisPropsFromTickScale(scale, 4)\n        return height < 100 || minimalTicks\n          ? { ...ticks, values: domain }\n          : ticks\n      },\n    }))\n    .views(self => {\n      const { renderProps: superRenderProps } = self\n      return {\n        renderProps() {\n          const superProps = superRenderProps()\n          return {\n            ...superProps,\n            notReady: superProps.notReady || !self.statsReady,\n            rpcDriverName: self.rpcDriverName,\n            displayModel: self,\n            config: self.rendererConfig,\n            scaleOpts: self.scaleOpts,\n            resolution: self.resolution,\n            height: self.height,\n            ticks: self.ticks,\n            displayCrossHatches: self.displayCrossHatches,\n            filters: self.filters,\n          }\n        },\n\n        get adapterCapabilities() {\n          return pluginManager.getAdapterType(self.adapterTypeName)\n            .adapterCapabilities\n        },\n\n        get hasResolution() {\n          return this.adapterCapabilities.includes('hasResolution')\n        },\n\n        get hasGlobalStats() {\n          return this.adapterCapabilities.includes('hasGlobalStats')\n        },\n      }\n    })\n    .views(self => {\n      const { trackMenuItems: superTrackMenuItems } = self\n      return {\n        trackMenuItems() {\n          return [\n            ...superTrackMenuItems(),\n            ...(self.hasResolution\n              ? [\n                  {\n                    label: 'Resolution',\n                    subMenu: [\n                      {\n                        label: 'Finer resolution',\n                        onClick: () => {\n                          self.setResolution(self.resolution * 5)\n                        },\n                      },\n                      {\n                        label: 'Coarser resolution',\n                        onClick: () => {\n                          self.setResolution(self.resolution / 5)\n                        },\n                      },\n                    ],\n                  },\n                  {\n                    label: 'Summary score mode',\n                    subMenu: ['min', 'max', 'avg', 'whiskers'].map(elt => {\n                      return {\n                        label: elt,\n                        onClick: () => self.setSummaryScoreMode(elt),\n                      }\n                    }),\n                  },\n                ]\n              : []),\n            ...(self.canHaveFill\n              ? [\n                  {\n                    label: self.filled\n                      ? 'Turn off histogram fill'\n                      : 'Turn on histogram fill',\n                    onClick: () => {\n                      self.setFill(!self.filled)\n                    },\n                  },\n                ]\n              : []),\n            {\n              label:\n                self.scaleType === 'log' ? 'Set linear scale' : 'Set log scale',\n              onClick: () => {\n                self.toggleLogScale()\n              },\n            },\n            {\n              type: 'checkbox',\n              label: 'Draw cross hatches',\n              checked: self.displayCrossHatchesSetting,\n              onClick: () => {\n                self.toggleCrossHatches()\n              },\n            },\n\n            ...(Object.keys(getConf(self, 'renderers') || {}).length > 1\n              ? [\n                  {\n                    label: 'Renderer type',\n                    subMenu: [...rendererTypes.keys()].map(key => ({\n                      label: key,\n                      onClick: () => self.setRendererType(key),\n                    })),\n                  },\n                ]\n              : []),\n            {\n              label: 'Autoscale type',\n              subMenu: [\n                ['local', 'Local'],\n                ...(self.hasGlobalStats\n                  ? [\n                      ['global', 'Global'],\n                      ['globalsd', 'Global  3'],\n                    ]\n                  : []),\n                ['localsd', 'Local  3'],\n              ].map(([val, label]) => {\n                return {\n                  label,\n                  onClick() {\n                    self.setAutoscale(val)\n                  },\n                }\n              }),\n            },\n            {\n              label: 'Set min/max score',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetMinMaxDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n            {\n              label: 'Set color',\n              onClick: () => {\n                getSession(self).queueDialog(doneCallback => [\n                  SetColorDlg,\n                  { model: self, handleClose: doneCallback },\n                ])\n              },\n            },\n          ]\n        },\n      }\n    })\n    .actions(self => {\n      const { reload: superReload, renderSvg: superRenderSvg } = self\n\n      type ExportSvgOpts = Parameters<typeof superRenderSvg>[0]\n\n      async function getStats(opts: {\n        headers?: Record<string, string>\n        signal?: AbortSignal\n        filters?: string[]\n      }): Promise<FeatureStats> {\n        const { rpcManager } = getSession(self)\n        const nd = getConf(self, 'numStdDev') || 3\n        const { adapterConfig, autoscaleType } = self\n        const sessionId = getRpcSessionId(self)\n        const params = {\n          sessionId,\n          adapterConfig,\n          statusCallback: (message: string) => {\n            if (isAlive(self)) {\n              self.setMessage(message)\n            }\n          },\n          ...opts,\n        }\n\n        if (autoscaleType === 'global' || autoscaleType === 'globalsd') {\n          const results: FeatureStats = (await rpcManager.call(\n            sessionId,\n            'WiggleGetGlobalStats',\n            params,\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n          // globalsd uses heuristic to avoid unnecessary scoreMin<0\n          // if the scoreMin is never less than 0\n          // helps with most coverage bigwigs just being >0\n          return autoscaleType === 'globalsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'local' || autoscaleType === 'localsd') {\n          const { dynamicBlocks, bpPerPx } = getContainingView(self) as LGV\n          const results = (await rpcManager.call(\n            sessionId,\n            'WiggleGetMultiRegionStats',\n            {\n              ...params,\n              regions: dynamicBlocks.contentBlocks.map(region => {\n                const { start, end } = region\n                return {\n                  ...JSON.parse(JSON.stringify(region)),\n                  start: Math.floor(start),\n                  end: Math.ceil(end),\n                }\n              }),\n              bpPerPx,\n            },\n          )) as FeatureStats\n          const { scoreMin, scoreMean, scoreStdDev } = results\n\n          // localsd uses heuristic to avoid unnecessary scoreMin<0 if the\n          // scoreMin is never less than 0 helps with most coverage bigwigs\n          // just being >0\n          return autoscaleType === 'localsd'\n            ? {\n                ...results,\n                scoreMin: scoreMin >= 0 ? 0 : scoreMean - nd * scoreStdDev,\n                scoreMax: scoreMean + nd * scoreStdDev,\n              }\n            : results\n        }\n        if (autoscaleType === 'zscale') {\n          return rpcManager.call(\n            sessionId,\n            'WiggleGetGlobalStats',\n            params,\n          ) as Promise<FeatureStats>\n        }\n        throw new Error(`invalid autoscaleType '${autoscaleType}'`)\n      }\n      return {\n        // re-runs stats and refresh whole display on reload\n        async reload() {\n          self.setError()\n          const aborter = new AbortController()\n          let stats\n          try {\n            stats = await getStats({\n              signal: aborter.signal,\n              ...self.renderProps(),\n            })\n            if (isAlive(self)) {\n              self.updateStats(stats)\n              superReload()\n            }\n          } catch (e) {\n            self.setError(e)\n          }\n        },\n        afterAttach() {\n          addDisposer(\n            self,\n            autorun(\n              async () => {\n                try {\n                  const aborter = new AbortController()\n                  const view = getContainingView(self) as LGV\n                  self.setLoading(aborter)\n\n                  if (!view.initialized) {\n                    return\n                  }\n\n                  if (!self.estimatedStatsReady) {\n                    return\n                  }\n                  if (self.regionTooLarge) {\n                    return\n                  }\n\n                  const wiggleStats = await getStats({\n                    signal: aborter.signal,\n                    ...self.renderProps(),\n                  })\n\n                  if (isAlive(self)) {\n                    self.updateStats(wiggleStats)\n                  }\n                } catch (e) {\n                  if (!isAbortException(e) && isAlive(self)) {\n                    console.error(e)\n                    self.setError(e)\n                  }\n                }\n              },\n              { delay: 1000 },\n            ),\n          )\n        },\n        async renderSvg(opts: ExportSvgOpts) {\n          await when(() => self.statsReady && !!self.regionCannotBeRenderedText)\n          const { needsScalebar, stats } = self\n          const { offsetPx } = getContainingView(self) as LGV\n          return (\n            <>\n              <g id=\"snpcov\">{await superRenderSvg(opts)}</g>\n              {needsScalebar && stats ? (\n                <g transform={`translate(${Math.max(-offsetPx, 0)})`}>\n                  <YScaleBar\n                    model={self as WiggleDisplayModel}\n                    orientation=\"left\"\n                  />\n                </g>\n              ) : null}\n            </>\n          )\n        },\n      }\n    })\n\nexport type WiggleDisplayStateModel = ReturnType<typeof stateModelFactory>\nexport type WiggleDisplayModel = Instance<WiggleDisplayStateModel>\n\nexport default stateModelFactory\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport Color from 'color'\nimport { Feature } from '@jbrowse/core/util/simpleFeature'\nimport { getOrigin, getScale } from '../util'\nimport WiggleBaseRenderer, {\n  RenderArgsDeserializedWithFeatures,\n} from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../LinearWiggleDisplay/models/model'\n\nexport default class XYPlotRenderer extends WiggleBaseRenderer {\n  draw(\n    ctx: CanvasRenderingContext2D,\n    props: RenderArgsDeserializedWithFeatures,\n  ) {\n    const {\n      features,\n      bpPerPx,\n      regions,\n      scaleOpts,\n      height: unadjustedHeight,\n      config,\n      ticks,\n      displayCrossHatches,\n    } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const offset = YSCALEBAR_LABEL_OFFSET\n    const height = unadjustedHeight - offset * 2\n\n    const pivotValue = readConfObject(config, 'bicolorPivotValue')\n    const negColor = readConfObject(config, 'negColor')\n    const posColor = readConfObject(config, 'posColor')\n    const filled = readConfObject(config, 'filled')\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const summaryScoreMode = readConfObject(config, 'summaryScoreMode')\n\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const originY = getOrigin(scaleOpts.scaleType)\n    const [niceMin, niceMax] = scale.domain()\n\n    const toY = (n: number) => height - (scale(n) || 0) + offset\n    const toHeight = (n: number) => toY(originY) - toY(n)\n\n    const colorCallback =\n      readConfObject(config, 'color') === '#f0f'\n        ? (_: Feature, score: number) =>\n            score < pivotValue ? negColor : posColor\n        : (feature: Feature, _score: number) =>\n            readConfObject(config, 'color', { feature })\n\n    const crossingOrigin = niceMin < pivotValue && niceMax > pivotValue\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      let score = feature.get('score')\n      const maxr = feature.get('maxScore')\n      const minr = feature.get('minScore')\n\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.4 // fudge factor for subpixel rendering\n\n      const summary = feature.get('summary')\n\n      if (summaryScoreMode === 'max') {\n        score = summary ? maxr : score\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'min') {\n        score = summary ? minr : score\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      } else if (summaryScoreMode === 'whiskers') {\n        const c = colorCallback(feature, score)\n        if (summary) {\n          ctx.fillStyle = crossingOrigin\n            ? colorCallback(feature, maxr)\n            : Color(c).lighten(0.6).toString()\n          ctx.fillRect(\n            leftPx,\n            toY(maxr),\n            w,\n            filled ? toHeight(maxr) - toHeight(score) : 1,\n          )\n        }\n\n        // normal\n        ctx.fillStyle =\n          crossingOrigin && summary\n            ? Color(colorCallback(feature, maxr)).mix(\n                Color(colorCallback(feature, minr)),\n              )\n            : c\n        ctx.fillRect(\n          leftPx,\n          toY(score),\n          w,\n          filled ? toHeight(score) - (summary ? toHeight(minr) : 0) : 1,\n        )\n\n        // min\n        if (summary) {\n          ctx.fillStyle = crossingOrigin\n            ? colorCallback(feature, minr)\n            : Color(c).darken(0.6).toString()\n          ctx.fillRect(leftPx, toY(minr), w, filled ? toHeight(minr) : 1)\n        }\n      } else {\n        ctx.fillStyle = colorCallback(feature, score)\n        ctx.fillRect(leftPx, toY(score), w, filled ? toHeight(score) : 1)\n      }\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, unadjustedHeight - 4, w, 4)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      ticks.values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './XYPlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'XYPlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { readConfObject } from '@jbrowse/core/configuration'\nimport { featureSpanPx } from '@jbrowse/core/util'\nimport { getScale } from '../util'\nimport WiggleBaseRenderer from '../WiggleBaseRenderer'\nimport { YSCALEBAR_LABEL_OFFSET } from '../LinearWiggleDisplay/models/model'\n\nexport default class LinePlotRenderer extends WiggleBaseRenderer {\n  draw(ctx, props) {\n    const {\n      features,\n      regions,\n      bpPerPx,\n      scaleOpts,\n      height: unadjustedHeight,\n      ticks: { values },\n      displayCrossHatches,\n      config,\n    } = props\n    const [region] = regions\n    const width = (region.end - region.start) / bpPerPx\n    const offset = YSCALEBAR_LABEL_OFFSET\n\n    // the adjusted height takes into account YSCALEBAR_LABEL_OFFSET from the\n    // wiggle display, and makes the height of the actual drawn area add\n    // \"padding\" to the top and bottom of the display\n    const height = unadjustedHeight - offset * 2\n    const clipColor = readConfObject(config, 'clipColor')\n    const highlightColor = readConfObject(config, 'highlightColor')\n    const scale = getScale({ ...scaleOpts, range: [0, height] })\n    const [niceMin, niceMax] = scale.domain()\n    const toY = rawscore => height - scale(rawscore) + offset\n    const colorCallback =\n      readConfObject(config, 'color') === '#f0f'\n        ? () => 'grey'\n        : feature => readConfObject(config, 'color', { feature })\n\n    let lastVal\n    for (const feature of features.values()) {\n      const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx)\n      const score = feature.get('score')\n      const lowClipping = score < niceMin\n      const highClipping = score > niceMax\n      const w = rightPx - leftPx + 0.3 // fudge factor for subpixel rendering\n\n      const c = colorCallback(feature)\n\n      ctx.strokeStyle = c\n      ctx.beginPath()\n      if (!region.reversed) {\n        ctx.moveTo(\n          leftPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(leftPx, toY(score))\n        ctx.lineTo(rightPx, toY(score))\n      } else {\n        ctx.moveTo(\n          rightPx,\n          toY(typeof lastVal !== 'undefined' ? lastVal : score),\n        )\n        ctx.lineTo(rightPx, toY(score))\n        ctx.lineTo(leftPx, toY(score))\n      }\n      ctx.stroke()\n      lastVal = score\n\n      if (highClipping) {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, 0, w, 4)\n      } else if (lowClipping && scaleOpts.scaleType !== 'log') {\n        ctx.fillStyle = clipColor\n        ctx.fillRect(leftPx, height - 4, w, height)\n      }\n      if (feature.get('highlighted')) {\n        ctx.fillStyle = highlightColor\n        ctx.fillRect(leftPx, 0, w, height)\n      }\n    }\n\n    if (displayCrossHatches) {\n      ctx.lineWidth = 1\n      ctx.strokeStyle = 'rgba(200,200,200,0.8)'\n      values.forEach(tick => {\n        ctx.beginPath()\n        ctx.moveTo(0, Math.round(toY(tick)))\n        ctx.lineTo(width, Math.round(toY(tick)))\n        ctx.stroke()\n      })\n    }\n  }\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport ConfigSchema from '../configSchema'\n\nexport { default as ReactComponent } from '../WiggleRendering'\nexport { default } from './LinePlotRenderer'\n\nexport const configSchema = ConfigurationSchema(\n  'LinePlotRenderer',\n  {},\n  { baseConfiguration: ConfigSchema, explicitlyTyped: true },\n)\n","import { getAdapter } from '@jbrowse/core/data_adapters/dataAdapterCache'\nimport RpcMethodType from '@jbrowse/core/pluggableElementTypes/RpcMethodType'\nimport { RenderArgs } from '@jbrowse/core/rpc/coreRpcMethods'\nimport { renameRegionsIfNeeded } from '@jbrowse/core/util'\nimport { Region } from '@jbrowse/core/util/types'\nimport { RemoteAbortSignal } from '@jbrowse/core/rpc/remoteAbortSignals'\nimport { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter'\nimport SerializableFilterChain from '@jbrowse/core/pluggableElementTypes/renderers/util/serializableFilterChain'\nimport { FeatureStats } from '@jbrowse/core/util/stats'\n\nexport class WiggleGetGlobalStats extends RpcMethodType {\n  name = 'WiggleGetGlobalStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      headers?: Record<string, string>\n      sessionId: string\n    },\n    rpcDriverClassName: string,\n  ): Promise<FeatureStats> {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    // @ts-ignore\n    return dataAdapter.getGlobalStats(deserializedArgs)\n  }\n}\n\nexport class WiggleGetMultiRegionStats extends RpcMethodType {\n  name = 'WiggleGetMultiRegionStats'\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async deserializeArguments(args: any, rpcDriverClassName: string) {\n    const l = await super.deserializeArguments(args, rpcDriverClassName)\n    return {\n      ...l,\n      filters: args.filters\n        ? new SerializableFilterChain({\n            filters: args.filters,\n          })\n        : undefined,\n    }\n  }\n\n  async serializeArguments(\n    args: RenderArgs & { signal?: AbortSignal; statusCallback?: Function },\n    rpcDriverClassName: string,\n  ) {\n    const assemblyManager =\n      this.pluginManager.rootModel?.session?.assemblyManager\n    if (!assemblyManager) {\n      return args\n    }\n\n    const renamedArgs = await renameRegionsIfNeeded(assemblyManager, {\n      ...args,\n      filters: args.filters && args.filters.toJSON().filters,\n    })\n\n    return super.serializeArguments(renamedArgs, rpcDriverClassName)\n  }\n\n  async execute(\n    args: {\n      adapterConfig: {}\n      signal?: RemoteAbortSignal\n      sessionId: string\n      headers?: Record<string, string>\n      regions: Region[]\n      bpPerPx: number\n    },\n    rpcDriverClassName: string,\n  ) {\n    const deserializedArgs = await this.deserializeArguments(\n      args,\n      rpcDriverClassName,\n    )\n    const { regions, adapterConfig, sessionId } = deserializedArgs\n    const { dataAdapter } = await getAdapter(\n      this.pluginManager,\n      sessionId,\n      adapterConfig,\n    )\n\n    if (dataAdapter instanceof BaseFeatureDataAdapter) {\n      return dataAdapter.getMultiRegionStats(regions, deserializedArgs)\n    }\n    throw new Error('Data adapter not found')\n  }\n}\n","import AdapterType from '@jbrowse/core/pluggableElementTypes/AdapterType'\nimport TrackType from '@jbrowse/core/pluggableElementTypes/TrackType'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { ConfigurationSchema } from '@jbrowse/core/configuration'\n\nimport {\n  createBaseTrackConfig,\n  createBaseTrackModel,\n} from '@jbrowse/core/pluggableElementTypes/models'\nimport DisplayType from '@jbrowse/core/pluggableElementTypes/DisplayType'\nimport { FileLocation } from '@jbrowse/core/util/types'\nimport WiggleBaseRenderer from './WiggleBaseRenderer'\nimport WiggleRendering from './WiggleRendering'\nimport { configSchema as bigWigAdapterConfigSchema } from './BigWigAdapter'\nimport DensityRenderer, {\n  configSchema as densityRendererConfigSchema,\n  ReactComponent as DensityRendererReactComponent,\n} from './DensityRenderer'\nimport * as utils from './util'\nimport {\n  configSchemaFactory as linearWiggleDisplayConfigSchemaFactory,\n  modelFactory as linearWiggleDisplayModelFactory,\n  ReactComponent as LinearWiggleDisplayReactComponent,\n  YSCALEBAR_LABEL_OFFSET,\n} from './LinearWiggleDisplay'\nimport XYPlotRenderer, {\n  configSchema as xyPlotRendererConfigSchema,\n  ReactComponent as XYPlotRendererReactComponent,\n} from './XYPlotRenderer'\nimport LinePlotRenderer, {\n  configSchema as linePlotRendererConfigSchema,\n  ReactComponent as LinePlotRendererReactComponent,\n} from './LinePlotRenderer'\nimport {\n  WiggleGetGlobalStats,\n  WiggleGetMultiRegionStats,\n} from './WiggleRPC/rpcMethods'\nimport {\n  AdapterGuesser,\n  getFileName,\n  TrackTypeGuesser,\n} from '@jbrowse/core/util/tracks'\n\nexport default class WigglePlugin extends Plugin {\n  name = 'WigglePlugin'\n\n  install(pluginManager: PluginManager) {\n    pluginManager.addTrackType(() => {\n      const configSchema = ConfigurationSchema(\n        'QuantitativeTrack',\n        {},\n        { baseConfiguration: createBaseTrackConfig(pluginManager) },\n      )\n      return new TrackType({\n        name: 'QuantitativeTrack',\n        configSchema,\n        stateModel: createBaseTrackModel(\n          pluginManager,\n          'QuantitativeTrack',\n          configSchema,\n        ),\n      })\n    })\n\n    pluginManager.addDisplayType(() => {\n      const configSchema = linearWiggleDisplayConfigSchemaFactory(pluginManager)\n      return new DisplayType({\n        name: 'LinearWiggleDisplay',\n        configSchema,\n        stateModel: linearWiggleDisplayModelFactory(\n          pluginManager,\n          configSchema,\n        ),\n        trackType: 'QuantitativeTrack',\n        viewType: 'LinearGenomeView',\n        ReactComponent: LinearWiggleDisplayReactComponent,\n      })\n    })\n\n    pluginManager.addAdapterType(\n      () =>\n        new AdapterType({\n          name: 'BigWigAdapter',\n          configSchema: bigWigAdapterConfigSchema,\n          adapterCapabilities: [\n            'hasResolution',\n            'hasLocalStats',\n            'hasGlobalStats',\n          ],\n          getAdapterClass: () =>\n            import('./BigWigAdapter/BigWigAdapter').then(r => r.default),\n        }),\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessAdapterForLocation',\n      (adapterGuesser: AdapterGuesser) => {\n        return (\n          file: FileLocation,\n          index?: FileLocation,\n          adapterHint?: string,\n        ) => {\n          const regexGuess = /\\.(bw|bigwig)$/i\n          const adapterName = 'BigWigAdapter'\n          const fileName = getFileName(file)\n          const obj = {\n            type: adapterName,\n            bigWigLocation: file,\n          }\n\n          if (regexGuess.test(fileName) && !adapterHint) {\n            return obj\n          } else if (adapterHint === adapterName) {\n            return obj\n          }\n\n          return adapterGuesser(file, index, adapterHint)\n        }\n      },\n    )\n    pluginManager.addToExtensionPoint(\n      'Core-guessTrackTypeForLocation',\n      (trackTypeGuesser: TrackTypeGuesser) => {\n        return (adapterName: string) => {\n          if (adapterName === 'BigWigAdapter') {\n            return 'QuantitativeTrack'\n          }\n          return trackTypeGuesser(adapterName)\n        }\n      },\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new DensityRenderer({\n          name: 'DensityRenderer',\n          ReactComponent: DensityRendererReactComponent,\n          configSchema: densityRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new LinePlotRenderer({\n          name: 'LinePlotRenderer',\n          ReactComponent: LinePlotRendererReactComponent,\n          configSchema: linePlotRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRendererType(\n      () =>\n        new XYPlotRenderer({\n          name: 'XYPlotRenderer',\n          ReactComponent: XYPlotRendererReactComponent,\n          configSchema: xyPlotRendererConfigSchema,\n          pluginManager,\n        }),\n    )\n\n    pluginManager.addRpcMethod(() => new WiggleGetGlobalStats(pluginManager))\n    pluginManager.addRpcMethod(\n      () => new WiggleGetMultiRegionStats(pluginManager),\n    )\n  }\n\n  exports = {\n    LinearWiggleDisplayReactComponent,\n    XYPlotRendererReactComponent,\n    XYPlotRenderer,\n    xyPlotRendererConfigSchema,\n    utils,\n    WiggleBaseRenderer,\n    linearWiggleDisplayModelFactory,\n  }\n}\n\nexport * from './util'\n\nexport { WiggleRendering }\nexport { WiggleBaseRenderer }\nexport { LinearWiggleDisplayReactComponent, linearWiggleDisplayModelFactory }\nexport { Tooltip } from './LinearWiggleDisplay/components/Tooltip'\nexport { YSCALEBAR_LABEL_OFFSET }\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\nimport { baseLinearDisplayConfigSchema } from '@jbrowse/plugin-linear-genome-view'\nimport { types } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\nexport default function WiggleConfigFactory(pluginManager: PluginManager) {\n  const XYPlotRendererConfigSchema =\n    pluginManager.getRendererType('XYPlotRenderer').configSchema\n  const DensityRendererConfigSchema =\n    pluginManager.getRendererType('DensityRenderer').configSchema\n  const LinePlotRendererConfigSchema =\n    pluginManager.getRendererType('LinePlotRenderer').configSchema\n\n  return ConfigurationSchema(\n    'LinearWiggleDisplay',\n    {\n      autoscale: {\n        type: 'stringEnum',\n        defaultValue: 'local',\n        model: types.enumeration('Autoscale type', [\n          'global',\n          'local',\n          'globalsd',\n          'localsd',\n          'zscore',\n        ]),\n        description:\n          'global/local using their min/max values or w/ standard deviations (globalsd/localsd)',\n      },\n      minimalTicks: {\n        type: 'boolean',\n        defaultValue: false,\n        description: 'use the minimal amount of ticks',\n      },\n\n      minScore: {\n        type: 'number',\n        defaultValue: Number.MIN_VALUE,\n        description: 'minimum value for the y-scale',\n      },\n      maxScore: {\n        type: 'number',\n        description: 'maximum value for the y-scale',\n        defaultValue: Number.MAX_VALUE,\n      },\n      numStdDev: {\n        type: 'number',\n        description:\n          'number of standard deviations to use for autoscale types globalsd or localsd',\n        defaultValue: 3,\n      },\n      scaleType: {\n        type: 'stringEnum',\n        model: types.enumeration('Scale type', ['linear', 'log']), // todo zscale\n        description: 'The type of scale to use',\n        defaultValue: 'linear',\n      },\n      inverted: {\n        type: 'boolean',\n        description: 'draw upside down',\n        defaultValue: false,\n      },\n\n      defaultRendering: {\n        type: 'stringEnum',\n        model: types.enumeration('Rendering', ['density', 'xyplot', 'line']),\n        defaultValue: 'xyplot',\n      },\n\n      renderers: ConfigurationSchema('RenderersConfiguration', {\n        DensityRenderer: DensityRendererConfigSchema,\n        XYPlotRenderer: XYPlotRendererConfigSchema,\n        LinePlotRenderer: LinePlotRendererConfigSchema,\n      }),\n    },\n    { baseConfiguration: baseLinearDisplayConfigSchema, explicitlyTyped: true },\n  )\n}\n"],"names":["useStyles","makeStyles","theme","button","margin","spacing","cdsColor","updownstreamColor","GeneCDS","cds","sequence","style","background","stitch","GeneProtein","codonTable","str","protein","i","length","slice","GenecDNA","utr","exons","upstream","downstream","includeIntrons","collapseIntron","chunks","sort","a","b","start","filter","f","end","map","chunk","index","intron","type","undefined","JSON","stringify","SequencePanel","React","ref","feature","mode","seq","subfeatures","generateCodonTable","defaultCodonTable","children","sub","dedupe","match","calculateUTRs","strand","revcom","revlist","fontFamily","wordWrap","maxWidth","name","id","SequenceFeatureDetails","model","classes","parentFeature","hasCDS","find","seqPanelRef","useRef","useInView","inView","useState","setSequence","error","setError","setMode","copied","setCopied","copiedHtml","setCopiedHtml","useEffect","finished","getSession","assemblyManager","rpcManager","view","assemblyNames","assemblyName","fetchSeq","refName","waitForAssembly","assembly","Error","sessionId","call","adapterConfig","getConf","regions","getCanonicalRefName","feats","feat","get","Math","max","up","down","loading","value","onChange","event","target","className","variant","onClick","current","copy","textContent","format","setTimeout","title","innerHTML","color","configSchema","ConfigurationSchema","formatSubfeatures","obj","depth","parse","currentDepth","returnObj","stateModelFactory","pluginManager","types","ElementId","featureData","formattedFields","unformattedFeatureData","pluggableMstType","track","volatile","actions","self","setFeatureData","clearFeatureData","setFormattedData","afterCreate","addDisposer","autorun","clone","__jbrowsefmt","subfeature","preProcessSnapshot","snap","finalizedFeatureData","rest","postProcessSnapshot","_","v","subfeats","join","getItemId","list","item","pos","ary","seqlen","firstCds","lastCds","firstCdsIdx","findIndex","exon","lastCdsIdx","lastCdsExon","firstCdsExon","fiveUTRs","elt","threeUTRs","ellipses","slug","CoreGetRefNames","args","rpcDriverClassName","this","deserializeArguments","deserializedArgs","getAdapter","dataAdapter","BaseFeatureDataAdapter","getRefNames","RpcMethodType","CoreGetFileInfo","isFeatureAdapter","getHeader","CoreGetMetadata","getMetadata","CoreGetFeatures","superDeserialized","SimpleFeature","rootModel","session","renameRegionsIfNeeded","renamedArgs","superArgs","signal","opts","ret","getFeaturesInMultipleRegions","pipe","toArray","toPromise","r","toJSON","CoreFreeResources","specification","deleteCount","freeAdapterResources","getRendererTypes","forEach","renderer","count","freeResources","_rpcDriverClassName","CoreEstimateRegionStats","filters","estimateRegionsStats","CoreRender","rendererType","RendererType","validateRendererType","getRendererType","serializeArgsInClient","checkAbortSignal","render","renderInWorker","result","serializedReturn","deserializeResultsInClient","CoreGetFeatureDetails","featureId","sess","sessions","getLayoutId","layout","cachedLayout","xref","getDataByID","ReactComponent","ServerSideRendererType","cytobandLocation","defaultValue","uri","explicitlyTyped","CytobandAdapter","loc","readConfObject","config","openLocation","readFile","data","split","trim","line","uniqueId","BaseAdapter","CorePlugin","Object","values","coreRpcMethods","RpcMethod","addRpcMethod","addAdapterType","AdapterType","cytobandConfigSchema","AdapterClass","DataAdapter","addWidgetType","WidgetType","heading","stateModel","lazy","Plugin","url","version","configurationSchema","_pluginManager","libs","mobx","mst","react","ReactDom","mxreact","PropTypes","MUICore","MUISvgIcon","MUIUtils","MUILab","MUIDataGrid","MUIColors","MUIStyles","MUIBox","MUIButton","MUIButtonGroup","MUICard","MUICardContent","MUIContainer","MUICheckbox","MUIDialog","MUIFormGroup","MUIFormLabel","MUIFormControl","MUIFormControlLabel","MUIGrid","MUIIcon","MUIIconButton","MUIInputAdornment","MUILinearProgress","MUIListItemIcon","MUIListItemText","MUIMenu","MUIMenuItem","MUIRadioGroup","MUIRadio","MUISelect","MUISnackbar","MUISnackbarContent","MUITextField","MUITooltip","MUITypography","ToggleButton","ToggleButtonGroup","pluggableElementTypes","ViewType","DisplayType","TrackType","pluggableElementTypeModels","CircularChordRendererType","BoxRendererType","FeatureRendererType","Configuration","mstTypes","coreUi","coreUtil","coreColor","coreLayouts","trackUtils","Base1DView","coreIo","coreMstReflection","rxjs","BaseFeatureDetail","BaseAdapterExports","ReExportsList","BaseResult","label","renderingComponent","displayString","matchedAttribute","matchedObject","textSearchAdapter","relevance","trackId","score","locString","newScore","getLabel","getLocation","getTrackId","RefSequenceResult","typeModels","stringArray","stringArrayMap","numberMap","boolean","integer","number","string","text","fileLocation","FileLocation","frozen","fallbackDefaults","locationType","literalJSON","views","valueJSON","objectJSON","typeModelExtensions","add","val","push","removeAtIndex","idx","splice","setAtIndex","key","set","remove","delete","addToKey","ar","removeAtKeyIndex","setAtKeyIndex","JexlStringType","startsWith","isEmptyArray","thing","Array","isArray","makeConfigurationSchemaModel","modelName","schemaDefinition","options","identifier","modelDefinition","explicitIdentifier","implicitIdentifier","volatileConstants","isJBrowseConfigurationSchema","jbrowseSchema","definition","entries","slotName","slotDefinition","isType","isLateType","isConfigurationSchemaType","description","contextVariable","configSlotModelName","charAt","toUpperCase","slot","isCallback","String","expr","getEnv","jest","console","warn","stringToJexlExpression","jexl","evalSync","newVal","reset","convertToCallback","convertToValue","funcResult","e","extend","m","defineProperty","ConfigSlot","completeModel","setSubschema","newSchema","isStateTreeNode","create","keys","identifierDefault","modelDefault","defaultSnap","getSnapshot","newSnap","matchesDefault","inputSchemaDefinition","inputOptions","baseConfiguration","jbrowseSchemaDefinition","jbrowseSchemaOptions","preprocessConfigurationSchemaArguments","schemaType","ConfigurationReference","confObject","slotPath","TypeError","isMapType","getType","appliedFunc","newPath","subConf","configuration","isConfigurationModel","getTypeNamesFromExplicitlyTypedUnion","maybeUnionType","resolveLateType","isUnionType","typeNames","getUnionSubTypes","typeName","getDefaultValue","isBareConfigurationSchemaType","isModelType","includes","every","t","isOptionalType","getSubType","isArrayType","isConfigurationSlotType","getSubAdapter","idMaker","capabilities","arg","_opts","region","ObservableCreate","observer","hasDataForRefName","hasData","getFeatures","subscribe","complete","merge","getFeaturesInRegion","refNames","scoresToStats","blankStats","Promise","all","getRegionStats","scoreMax","reduce","scoreMin","min","scoreSum","scoreSumSquares","featureCount","basesCovered","rectifyStats","lastTime","Date","now","statsFromInterval","expansionTime","sampleCenter","query","round","features","maybeRecordStats","featureDensity","interval","stats","statsSampleFeatures","refLen","currTime","Infinity","BaseSequenceAdapter","isSequenceAdapter","isRegionsAdapter","isRefNameAliasAdapter","isTextSearchAdapter","adapterConfigCacheKey","adapterCache","adapterConfigSnapshot","cacheKey","adapterType","dataAdapterType","getAdapterType","bind","getAdapterClass","CLASS","sessionIds","Set","cacheEntry","specKeys","size","stuff","adapterCapabilities","adapterMetadata","PluggableElementBase","ConnectionType","displayName","configEditorComponent","trackType","viewType","InternetAccountType","blobMap","getBlobMap","augmentLocationObjects","isAppRootModel","internetAccountPreAuthorization","account","findAppropriateInternetAccount","getPreAuthorizationInformation","serializedArgs","setBlobMap","isRemoteAbortSignal","deserializeAbortSignal","originalReturn","_args","isAuthNeededException","retryAccount","createEphemeralInternetAccount","URL","origin","RetryError","internetAccountId","isAlive","isUriLocation","serializeNewAuthArguments","TextSearchAdapterType","displayTypes","display","HeadingComponent","BaseViewModel","width","menuItems","setDisplayName","setWidth","newWidth","tracks","pluggableConfigSchemaType","afterAttach","connect","addTrackConf","trackConf","addTrackConfs","trackConfs","setTrackConfs","clear","BaseDisplay","rpcDriverName","rendererTypeName","RenderingComponent","getDisplayType","DisplayBlurb","parentTrack","getParent","isRoot","renderProps","getParentRenderProps","displayModel","DisplayMessageComponent","trackMenuItems","viewMenuActions","regionCannotBeRendered","setRpcDriverName","reload","inWebWorker","sessionStorage","InternetAccount","authHeader","tokenType","domains","toggleContents","SelectorComponent","selectorLabel","handlesLocation","location","some","domain","tokenKey","getTokenFromUser","resolve","reject","storeToken","token","setItem","removeToken","removeItem","retrieveToken","getItem","validateToken","tokenPromise","getToken","authInfo","x","addAuthHeaderToInit","init","tokenInfoString","newHeaders","Headers","headers","append","authToken","validatedToken","internetAccountType","getFetcher","input","newInit","fetch","RemoteFileWithRangeCache","BaseInternetAccountConfig","createBaseTrackModel","baseTrackConfig","displays","rpcSessionId","pm","canConfigure","isSessionModelWithConfigEditing","adminMode","sessionTracks","activateConfigurationUI","getContainingView","editTrackConfiguration","hideTrack","showTrack","showDisplay","displayId","initialSnapshot","displayTypeConfigSchema","resolveIdentifier","getRoot","displayType","hideDisplay","shownDisplays","d","transaction","replaceDisplay","oldDisplayId","newDisplayId","displayIdx","displayChoices","compatibleDisplayTypes","getViewType","compatibleDisplays","displayConf","shownId","checked","createBaseTrackConfig","category","metadata","adapter","textSearching","indexingAttributes","indexingFeatureTypesToExclude","formatDetails","s","getTrackType","has","addDisplayConf","LayoutSession","bpPerPx","update","props","assign","MultiLayout","GranularRectLayout","maxHeight","displayMode","pitchX","pitchY","subLayoutConstructorArgs","deepEqual","cachedLayoutIsValid","makeLayout","createSession","renderArgs","maxFeatureGlyphExpansion","bpExpansion","floor","ceil","freed","discardRange","json","PrecomputedLayout","deserializeLayoutInClient","getWorkerSession","getSublayout","results","serialized","serializeRegion","getExpandedRegion","rectangles","Boolean","maxHeightReached","createLayoutInWorker","FeatureRenderer","ComparativeServerSideRenderer","deserialized","blockKey","passes","requestRegions","requestRegion","featurePassesFilters","ServerSideRenderer","selectedFeatureId","deserializedFeatures","Map","j","iterMap","_renderArgs","featureObservable","NewFeatureRendererType","supportsSVG","reactElement","ServerSideRenderedContent","ssrContainerNode","html","jbrowseTheme","createJBrowseTheme","domNode","unmountComponentAtNode","rIC","hydrate","timeout","exportSVG","SerializableFilterChain","renderToString","height","canvasRecordedData","C2S","ctx","default","CanvasSequence","execute","getSvg","statusCallback","deserializeArgsInWorker","updateStatus","serializeResultsInWorker","freedRpc","filterChain","inputFilter","paper","overflowY","zIndex","drawer","outline","palette","resizeHandle","position","top","drawerPosition","drawerWidth","Paper","elevation","square","ResizeHandle","onDrag","resizeDrawer","vertical","left","drawerActions","float","backgroundColor","alpha","secondary","contrastText","action","hoverOpacity","drawerToolbar","paddingLeft","spacer","flexGrow","drawerSelect","drawerLoading","dropDownIcon","header","main","DrawerHeader","setToolbarHeight","visibleWidget","activeWidgets","anchorEl","setAnchorEl","AppBar","getBoundingClientRect","Toolbar","disableGutters","Select","icon","renderValue","widgetId","widget","Typography","widgetType","getWidgetType","w","notify","showWidget","from","MenuItem","ListItemSecondaryAction","IconButton","hideWidget","Delete","currentTarget","MoreVert","Tooltip","minimizeWidgetDrawer","Minimize","Close","Menu","open","onClose","option","selected","setDrawerPosition","DrawerComponent","toolbarHeight","Suspense","fallback","root","buttonRoot","primary","menuTitle","setOpen","handleClose","anchorOrigin","horizontal","onMenuItemClick","_event","callback","ResetComponent","onFactoryReset","resetButtonText","dialogOpen","setDialogOpen","FatalErrorDialog","componentStack","toString","window","defaultProps","message","isBlobLocation","filename","marginLeft","setLocation","isLocalPathLocation","localPath","needToReload","getBlob","blobId","flexDirection","alignItems","fullWidth","component","hidden","file","files","isElectron","path","storeBlobLocation","blob","inputProps","ContentCopy","TrackSelector","Cable","snackbarMessage","setSnackbarMessage","popSnackbarMessage","snackbarMessages","latestMessage","timeoutId","clearTimeout","reason","level","severity","viewContainer","overflow","grow","iconRoot","paddingBottom","paddingTop","inputBase","inputRoot","light","inputFocused","borderColor","ViewMenu","IconButtonProps","IconProps","items","ViewContainer","padWidth","useTheme","useMeasure","scrollRef","scrollIntoView","block","padding","edge","arrow","setValue","displayedRegions","Region","offsetPx","interRegionPaddingWidth","minimumBlockWidth","volatileWidth","setDisplayedRegions","cast","setBpPerPx","setVolatileWidth","displayedRegionsTotalPx","totalBp","maxOffset","minOffset","pxToBp","px","bpSoFar","bp","n","offset","oob","coord","reversed","interRegionPaddingBp","minimumBlockBp","len","dynamicBlocks","calculateDynamicBlocks","staticBlocks","calculateStaticBlocks","currBp","bpToPx","regionNumber","viewBpToPx","setFeatures","zoomToDisplayedRegions","leftPx","rightPx","startOffset","endOffset","moveTo","showAllRegions","zoomTo","bpToStart","zoomOut","zoomIn","newBpPerPx","oldBpPerPx","clamp","scrollTo","newOffsetPx","centerAt","regionIndex","centerPx","scroll","distance","oldOffsetPx","BlockSet","blocks","ElidedBlock","lastBlock","toRegion","func","thisarg","widthPx","ContentBlock","contentBlocks","BaseBlock","isLeftEndOfDisplayedRegion","constructor","elidedBlockCount","otherBlock","InterRegionPaddingBlock","elision","displayedRegionLeftPx","windowLeftPx","windowRightPx","regionStart","regionEnd","displayedRegionRightPx","regionWidthPx","isRightEndOfDisplayedRegion","blockOffsetPx","intersection2","blockData","parentRegion","assembleLocString","extra","innerWidth","windowLeftBp","windowRightBp","blockSizePx","blockSizeBp","regionBpOffset","regionBlockCount","windowRightBlockNum","windowLeftBlockNum","blockNum","colors","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","namedColorToHex","isNamedColor","contrastingTextColor","getLuminance","convertedColor","muiGetLuminance","emphasize","coefficient","muiEmphasize","makeContrasting","foreground","minContrastRatio","convertedForeground","convertedBackground","backgroundLuminance","contrastRatio","getContrastRatio","originalColor","darken","lighten","hashCode","fromEntries","inDevelopment","process","inProduction","useDebounce","delay","debouncedValue","setDebouncedValue","handle","useDebouncedCallback","wait","argsRef","cleanup","findParentThat","node","predicate","hasParent","currentNode","springAnimate","fromValue","toValue","animationFrameId","onFinish","precision","tension","friction","mass","animation","time","lastPosition","velocity","lastVelocity","numSteps","isVelocity","abs","isDisplacement","requestAnimationFrame","cancelAnimationFrame","findParentThatIs","isSessionModel","isViewModel","getContainingTrack","isTrackModel","getContainingDisplay","isDisplayModel","startString","endString","assemblyNameString","toLocaleString","rev","parseLocStringOneBased","isValidRefName","endsWith","replace","assemblyMatch","lastColonIdx","lastIndexOf","prefix","suffix","rangeMatch","singleMatch","separator","parseLocString","parsed","compareLocs","locA","locB","assemblyComp","localeCompare","refComp","startComp","endComp","compareLocStrings","num","oneEightyOverPi","PI","piOverOneEighty","radToDeg","radians","degToRad","degrees","polarToCartesian","rho","theta","cos","sin","cartesianToPolar","y","sqrt","atan","featureSpanPx","bpSpanPx","leftBp","rightBp","objectFromEntries","iterable","sizeHint","counter","mergeConfigs","A","B","merged","defaultSession","findLastIndex","array","l","makeAbortableReaction","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","isAbortException","reactionDisposer","reaction","mobxReactionHandle","aborted","abort","AbortController","thisInProgress","renameRegionIfNeeded","refNameMap","newRef","originalRefName","getRefNameMapForAdapter","assemblyMaps","minmax","test","navigator","userAgent","seqString","complement","reverse","complementRegex","complementTable","S","T","N","K","Y","V","M","h","k","C","g","W","X","H","c","D","R","G","blobToDataURL","FileReader","onload","readAsDataURL","requestIdleCallback","cb","measureText","fontSize","widths","avg","charCodeAt","cur","acc","defaultStarts","defaultStops","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","table","tempCodonTable","codon","aa","nucs","nuc","toLowerCase","n0","n1","n2","msg","fn","res","hash","objectHash","bytesForRegions","blocksForRange","blockResults","flat","minv","blockPosition","maxv","offsetBp","supportedIndexingAdapters","getBpDisplayStr","parseFloat","toPrecision","toLocale","getTickDisplayStr","toFixed","getViewParams","staticblock","staticblock1","offsetPx1","layoutId","fetchers","globalRangeCache","HttpRangeFetcher","fetcher","chunkSize","maxFetchSize","minimumTTL","fetchBinaryRange","requestHeaders","range","rangeParse","exec","parseInt","getRange","response","Response","buffer","status","requestDate","responseDate","errorMessage","statusText","hint","arrayBuffer","Buffer","RemoteFile","isNode","LocalFile","BlobFile","absoluteLocation","baseUri","href","internetAccount","getInternetAccount","checkAuthNeededFetch","getInternetAccountType","authHeaders","AuthNeededError","addFunction","parent","log","log10","Number","char","codePointAt","search","pad","padEnd","fill","padStart","repeat","replaceAll","substring","trimEnd","trimStart","tags","addBinaryOp","compilationCache","code","compiled","compile","createJexlInstance","minSizeToBotherWith","segmentsIntersect","x1","x2","y1","y2","LayoutRow","allFilled","widthLimit","rowState","bits","right","maxX","getItemAt","rectWidth","rect","initialize","oLeft","oRight","currLength","additionalLength","concat","leftTrimAmount","rightTrimAmount","trimAmount","desiredLength","hardRowLimit","bitmap","pTotalHeight","storedRec","addRectToBitmap","pLeft","pRight","pHeight","rectangle","originalHeight","maxTop","collides","maxY","row","isRangeClear","yEnd","autovivifyRow","setAllFilled","addRect","pY","pX","getTotalHeight","regionRectangles","containsNoTransferables","totalHeight","getRectangles","SubLayoutClass","layoutArgs","subLayouts","layoutName","subLayout","sublayout","rbush","RBush","insert","minX","minY","_rect","_top","_data","_left","_right","_region","ThrowingLayout","PrecomputedMultiLayout","sublayoutJson","SceneGraph","absoluteCache","isNaN","dirty","nameOrSceneGraph","child","absolute","childLeft","childRight","childTop","childBottom","bottom","expand","newLeft","newRight","newTop","newBottom","diff","walkParents","walkChildren","xOffset","yOffset","_subtype","_subType","subType","unionType","_types","getPropertyType","propertyName","properties","_defaultValue","getEnumerationValues","maybeLate","left1","right1","left2","right2","doesIntersect2","isContainedWithin","Observable","catch","takeUntil","observeAbortSignal","isFeature","isSimpleFeatureSerialized","parentHandle","aliases","p","parentId","calcStdFromSums","sum","sumSquares","variance","population","scoreMean","scoreStdDev","seed","MAX_VALUE","MIN_VALUE","getTrackAssemblyNames","trackAssemblyNames","getRpcSessionId","thisNode","highestRpcSessionId","UNKNOWN","UNSUPPORTED","makeIndex","makeIndexType","typeA","typeB","getFileName","guessAdapter","adapterHint","evaluateExtensionPoint","_file","_index","_adapterHint","adapterGuesser","guessTrackType","_adapterName","trackTypeGuesser","generateUnsupportedTrackConf","trackName","trackUrl","categories","conf","generateUnknownTrackConf","shortid","propTypes","ConfigSchema","MxPropTypes","Feature","NoAssemblyRegion","setRefName","newRefName","LocalPathLocation","BlobLocation","UriLocationRaw","UriLocation","postProcessor","preProcessor","snapshot","getNextRefPos","mdRegex","RegExp","modificationRegex","parseCigar","cigar","cigarToMismatches","ops","qual","roffset","soffset","mismatches","hasRefAndSeq","op","base","altbase","q","cliplen","mdToMismatches","mdstring","cigarMismatches","mismatchRecords","curr","skips","lastCigar","lastTemplateOffset","lastRefOffset","lastSkipPos","getTemplateCoordLocal","refCoord","templateOffset","refOffset","md","mismatch","qualScore","getMismatches","cigarOps","positions","readPos","refPos","currPos","getModificationPositions","mm","fseq","fstrand","mods","mod","basemod","matches","delta","temp","getModificationTypes","mismatchLen","isInterbase","inc","bin","field","thisBin","total","SNPCoverageAdapter","subadapterConfig","sequenceConf","sequenceAdapter","subadapter","configure","fetchSequence","generateCoverageBins","bins","skipmap","next","snpinfo","skip","xs","colorBy","binMax","shouldFetchReferenceSequence","regionSeq","fstart","fend","lowqual","cov","delskips","noncov","getTagAlt","epos","methBins","l1","l2","bin1","colorSNPs","mstart","mlen","mend","interbase","refbase","getTag","fetchSizeLimit","cramLocation","craiLocation","load","configSchemaF","then","bamLocation","indexType","htsgetBase","htsgetTrackId","hiddenFromGUI","configSchemaFactory","clipColor","indicatorThreshold","drawArcs","drawInterbaseCounts","drawIndicators","SNPCoverageRenderer","displayCrossHatches","modificationTagMap","scaleOpts","unadjustedHeight","configTheme","cfg","ticks","YSCALEBAR_LABEL_OFFSET","viewScale","getScale","indicatorViewScale","scaleType","originY","getOrigin","toY","toHeight","indicatorToY","indicatorToHeight","colorForBase","bases","insertion","softclip","hardclip","meth","unmeth","coverage","fillStyle","fillRect","prevTotal","extraHorizontallyFlippedOffset","totalScore","interbaseEvents","accum","maxBase","indicatorComparatorScore","beginPath","lineTo","neg","strokeStyle","lineWidth","bezierCurveTo","stroke","tick","WiggleBaseRenderer","register","addRendererType","WiggleRendering","PileupLayoutSession","sortedBy","filterBy","showSoftClip","cw","getColorBaseMap","deletion","alignmentColoring","color_fwd_strand_not_proper","color_rev_strand_not_proper","color_fwd_strand","color_rev_strand","color_fwd_missing_mate","color_rev_missing_mate","color_fwd_diff_chr","color_rev_diff_chr","color_pair_lr","color_pair_rr","color_pair_rl","color_pair_ll","color_nostrand","color_interchrom","color_longinsert","color_shortinsert","PileupRenderer","charWidth","charHeight","heightPx","expansionBefore","expansionAfter","topPx","maxClippingSize","getOrientation","orientationType","LR","RR","RL","LL","orientationTypes","_config","flags","flipper","contrastForBase","canvasWidth","heightLim","letter","fillText","scores","ml","probabilities","modifications","probIndex","col","Color","prob","hsl","regionSequence","leftPx2","flip","closePath","defaultColor","colorTagMap","tag","colorType","colorByInsertSize","colorByOrientation","colorByStranded","foundValue","drawRect","colorByPerBaseQuality","colorByPerBaseLettering","colorByModifications","colorByMethylation","minSubfeatureWidth","largeInsertionIndicatorScale","mismatchAlpha","drawSNPs","drawIndels","pxPerBp","mbase","baseColor","contrastColor","txt","rwidth","insW","adjustPx","clearRect","minFeatWidth","getCharWidthHeight","softClipLength","softClipStart","softClipLeftPx","softClipRightPx","softClipWidthPx","getContrastText","layoutRecords","getContrastBaseMap","font","drawAlignmentRect","drawMismatches","drawSoftClipping","featureMap","featureArray","featuresInCenterLine","featuresOutsideCenter","innerArray","isCram","baseSortArray","baseMap","aMismatch","bMismatch","acode","bcode","sortFeature","layoutFeature","layoutFeats","renderToAbstractCanvas","makeImageData","onMouseMove","featureIdUnderMouse","contextMenuFeature","highlightOverlayCanvas","mouseIsDown","setMouseIsDown","movedDuringLastMouseDown","setMovedDuringLastMouseDown","mouseMove","offsetX","offsetY","canvas","clientX","clientY","clientBp","featIdUnderMouse","getFeatureOverlapping","callMouseHandler","handlerName","featureHandler","canvasHandler","getContext","selectedRect","getFeatureByID","bottomPx","rectTop","rectHeight","shadowColor","shadowBlur","lineJoin","strokeRect","highlightedFeature","highlightedRect","PrerenderedCanvas","onMouseDown","onMouseEnter","onMouseOut","onMouseOver","onMouseUp","onMouseLeave","onContextMenu","onFocus","onBlur","noSpacing","PileupDisplayConfigSchema","SNPCoverageDisplayConfigSchema","pileupDisplay","snpCoverageDisplay","baseLinearDisplayConfigSchema","PileupDisplay","SNPCoverageDisplay","snpCovHeight","showCoverage","showPileup","userFeatureScreenDensity","scrollTop","toggleCoverage","togglePileup","setScrollTop","setSNPCoverageHeight","superTrackMenuItems","pileupDisplayConfig","searchFeatureByID","sortedByPosition","sortedByRefName","snpCoverageDisplayConfig","subMenu","setSNPCoverageDisplay","displayConfig","setUserFeatureScreenDensity","limit","setPileupDisplay","setHeight","displayHeight","resizeHeight","oldHeight","setConfig","setFilterBy","setColorBy","renderSvg","pileupHeight","when","ready","overrideHeight","transform","addDisplayType","modelFactory","en","pct","toP","TooltipContents","reactRef","rn1","r1","info","entry","featureUnderMouse","getUniqueTagValues","colorScheme","getUniqueModificationValues","rendererTypes","linearWiggleDisplayModelFactory","flagInclude","flagExclude","readName","tagFilter","observable","updateModificationColorMap","uniqueModifications","colorPalette","newColor","superRenderProps","rendererConfig","configBlob","drawArcsSetting","drawInterbaseCountsSetting","drawIndicatorsSetting","modificationsReady","superProps","notReady","toggleDrawIndicators","toggleDrawInterbaseCounts","toggleDrawArcs","vals","TooltipComponent","needsScalebar","contextMenuItems","SNPCoverageRendererConfigSchema","autoscale","minScore","maxScore","inverted","multiTicks","renderers","LinearWiggleDisplayReactComponent","PileupRendererConfigSchema","defaultRendering","maxFeatureScreenDensity","linearBasicDisplayConfigSchemaFactory","ColorByTagDlg","FilterByTagDlg","SortByTagDlg","SetFeatureHeightDlg","SetMaxHeightDlg","ModificationsDlg","BaseLinearDisplay","showSoftClipping","featureHeight","fadeLikelihood","trackMaxHeight","featureUnderMouseVolatile","setReady","flag","setMaxHeight","setFeatureHeight","setNoSpacing","setColorScheme","totalKeys","updateColorTagMap","uniqueTag","setFeatureUnderMouse","uniqueTagSet","renderInClient","setCurrBpPerPx","selectFeature","isSessionModelWithWidgets","featureWidget","addWidget","setSelection","clearSelected","copyFeatureToClipboard","toggleSoftClipping","toggleMismatchAlpha","setSortedBy","centerLineInfo","centerBp","centerRefName","superReload","featureHeightSetting","mismatchAlphaSetting","viewName","MenuOpenIcon","clearFeatureSelection","ContentCopyIcon","LinearPileupDisplayBlurb","currBpPerPx","onFeatureClick","onFeatureContextMenu","setContextMenuFeature","VisibilityIcon","SortIcon","disabled","queueDialog","PaletteIcon","doneCallback","FilterListIcon","BaseLinearDisplayComponent","addTrackType","linearAlignmentsDisplay","baseModel","baseModelFactory","PileupGetGlobalValueForTag","featuresArray","uniqueValues","PileupGetVisibleModifications","AlignmentsPlugin","CramAdapterF","BamAdapterF","LinearPileupDisplayF","LinearSNPCoverageDisplayF","AlignmentsTrackF","SNPCoverageAdapterF","HtsgetBamAdapterF","PileupRendererF","SNPCoverageRendererF","LinearAlignmentsDisplayF","AlignmentsFeatureWidgetF","addToExtensionPoint","adapterName","fileName","indexName","alt","fr","F1R2","F2R1","F1F2","F2F1","R1R2","R2R1","R1F2","R2F1","rf","ff","getPlugin","exports","blockType","renderDelay","handler","arcsRendered","textStroke","caption","strokeWidth","tooltipWidth","textYCoord","pointerEvents","triggerRef","rx","ry","fillOpacity","textLength","thickness","MyProjectPlugin","ArcRenderer","ArcRendererReactComponent","ArcRendererConfigSchema","linearArcDisplayConfigSchemaFactory","LinearArcDisplayStateModelFactory","attributeName","authEndpoint","tokenEndpoint","needsPKCE","clientId","scopes","responseType","hasRefreshToken","fixup","buf","codeVerifier","codeVerifierPKCE","global","getGlobalObject","Uint8Array","crypto","getRandomValues","refreshTokenKey","storeRefreshToken","refreshToken","localStorage","removeRefreshToken","retrieveRefreshToken","exchangeAuthorizationForAccessToken","redirectUri","grant_type","client_id","code_verifier","redirect_uri","params","URLSearchParams","method","body","ok","accessToken","refresh_token","access_token","exchangeRefreshForAccessToken","listener","addMessageChannel","finishOAuthWindow","addEventListener","deleteMessageChannel","removeEventListener","redirectUriWithInfo","fixedQueryString","redirectUrl","queryStringSearch","urlParams","pathname","useEndpointForAuthorization","response_type","scope","codeChallenge","Base64","sha256","code_challenge","code_challenge_method","token_access_type","eventName","require","ipcRenderer","invoke","eventFromDesktop","MessageEvent","validateWithHEAD","ExternalTokenEntryForm","setToken","Dialog","DialogTitle","DialogContent","TextField","required","DialogActions","Button","HTTPBasicLoginForm","username","setUsername","password","setPassword","onSubmit","btoa","preventDefault","autoComplete","OAuthConfigSchema","dropboxErrorMessages","shared_link_not_found","shared_link_access_denied","unsupported_link_type","shared_link_is_directory","DropboxIcon","SvgIcon","getDescriptiveErrorMessage","errorMessageParsed","messageTag","Authorization","newToken","GoogleDriveFile","source","statsPromise","metadataOnly","GoogleDriveIcon","urlId","driveUrl","searchParams","credentials","AuthenticationPlugin","addInternetAccountType","OAuthInternetAccountModelFactory","ExternalTokenConfigSchema","ExternalTokenInternetAccountModelFactory","HTTPBasicConfigSchema","HTTPBasicInternetAccountModelFactory","DropboxOAuthConfigSchema","DropboxOAuthInternetAccountModelFactory","GoogleDriveOAuthConfigSchema","GoogleDriveOAuthInternetAccountModelFactory","bigBedLocation","bedGzLocation","columnNames","scoreColumn","autoSql","bedLocation","colRef","colStart","colEnd","BedPlugin","bigBedAdapterConfigSchema","bedTabixAdapterConfigSchema","bedAdapterConfigSchema","TOP","BOTTOM","getPxFromCoordinate","yPos","trackConfigId","trackRefs","heightFromSpecificLevel","useNextFrame","variable","setNextFrameState","LEFT","RIGHT","parentRef","showIntraviewLinks","totalFeatures","getTrackFeatures","hasPaired","useMemo","layoutMatches","candidates","alreadySeen","unmapped","correctlyPaired","getBadlyPairedAlignments","getMatchedAlignmentFeatures","getMatchedFeaturesInLayout","mouseoverElt","setMouseoverElt","c1","f1","level1","c2","f2","level2","f1origref","f2origref","f1ref","f2ref","s1","s2","p1","p2","reversed1","reversed2","getTrack","Path","curveTo","feature1","feature2","alts","bnd","parseBreakend","MatePosition","getMatchedBreakendFeatures","yoff","relevantAlt","feat1","feat2","findMatchingAlt","Join","MateDirection","headerBar","gridArea","InteractWithSquiggles","toggleInteract","interactToggled","LocationSearching","LocationDisabled","LinkViews","toggleLinkViews","linkViews","Link","LinkOff","Sync","toggleIntraviewLinks","LeakAdd","LeakRemove","getMatchedTranslocationFeatures","chr2","CHR2","end2","END","STRANDS","myDirection","mateDirection","marginBottom","breakpointMarker","viewDivider","container","overlay","cursor","content","Overlay","getMatchedTracks","hasTranslocations","BreakpointSplitView","viewComponent","matchedTracks","intersect","a1","a2","ids","a12","getBlockFeatures","trackSelectorType","matchedTrackFeatures","calc","onAction","onSubviewAction","actionName","getPath","removeView","closeView","setMatchedTrackFeatures","BreakpointSplitViewType","endPos","startPos","mateRefName","featureRefName","topRegion","startMod","endMod","INFO","matePosition","mate","bottomRegion","topMarkedRegion","bottomMarkedRegion","hideHeader","BreakpointSplitViewModel","BreakpointSplitViewComponent","BreakpointSplitViewPlugin","addViewType","jbrequire","BreakpointSplitViewFactory","alignmentsFeatureDetailConfigSchema","alignmentsFeatureDetailStateModel","findCircleIntersectionX","cx","cy","resultArray","solution","findCircleIntersectionY","cartesianToTheta","twoPi","Slice","currentRadianOffset","radianWidth","offsetRadians","startRadians","endRadians","bpPerRadian","flipped","widthBp","freeze","radiusPx","totalRadians","elided","sliceIsVisible","r1start","r1length","r2start","r2length","visibleSection","visibleThetaMin","visibleThetaMax","CircularView","hideVerticalResizeHandle","hideTrackSelectorButton","lockedFitToWindow","disableImportForm","minimumRadiusPx","spacingPx","paddingPx","lockedPaddingPx","minVisibleWidth","scrollX","scrollY","staticSlices","slices","elidedRegions","pxPerRadian","calculateStaticSlices","visibleStaticSlices","viewSides","circleCenter","circleRadius","viewL","viewR","viewT","viewB","vertices","maxRho","reflect","rhoMin","rhoMax","thetaMin","thetaMax","vx","vy","viewportVisibleSection","centerXY","circumferencePx","elidedBp","maximumRadiusPx","maxBpPerPx","minCircumferencePx","minBpPerPx","maxCircumferencePx","atMaxBpPerPx","atMinBpPerPx","tooSmallToLock","figureDimensions","figureWidth","figureHeight","visible","lastVisible","displayedRegion","initialized","newHeight","setModelViewWhenAdjust","resizeWidth","oldWidth","rotateClockwiseButton","rotateClockwise","rotateCounterClockwiseButton","rotateCounterClockwise","zoomInButton","zoomOutButton","secondCondition","previouslyEmpty","activateTrackSelector","selector","toggleTrack","trackConfigSchema","supportedDisplays","shownTracks","toggleFitToWindowLock","lib","strokeDasharray","strokeDashoffset","duration","tertiary","quaternary","radius","shown","setShown","patternTransform","patternUnits","dominantBaseline","textAnchor","strokeLinecap","errorBackground","errorText","errorPattern","filled","mainThreadRendering","createElement","Loading","ChordDisplayLoadingFactory","DisplayError","ChordDisplayErrorFactory","RpcRenderedSvgGroup","RpcRenderedSvgGroupF","cannotBeRenderedReason","isCompatibleWithRenderer","renderReactionData","blockDefinitions","renderReactionEffect","BaseChordDisplayModel","bezierRadiusRatio","onChordClick","origSlices","renamed","bezierRadius","ThisRendererType","selection","renderStarted","renderSuccess","renderError","setRefNameMap","renderReactionFactory","fireImmediately","baseChordDisplayConfig","CircularViewPlugin","addView","asm","isAbstractMenuManager","appendToSubMenu","DataUsageIcon","isGzip","getWeightedMeans","scoreMap","qname","tname","quals","mappingQual","blockLen","meanScoreMap","zip","weightedMean","meanScore","tuples","valueSum","weightSum","weight","PAFAdapter","setupP","setupPre","pafLocation","unzip","TextDecoder","fatal","decode","qstart","qend","tstart","tend","numMatches","fields","indexOf","setup","getAssemblyNames","pafRecords","mateName","mateStart","mateEnd","syntenyId","targetAssembly","queryAssembly","parseBed","MCScanAnchorsAdapter","bed1","bed2","mcscan","bed1text","bed2text","mcscantext","bed1Map","bed2Map","name1","name2","r2","rowNum","mcscanAnchorsLocation","bed1Location","bed2Location","n11","n12","n21","n22","r11","r12","r21","r22","f11","f12","f21","f22","mcscanSimpleAnchorsLocation","MashMapAdapter","outLoc","outLocation","paf_delta2paf","lines","rname","qs","qe","rs","re","NM","seen_gt","records","regex","t0","t1","t2","t3","blen","cigar_str","rlen","cg","DeltaAdapter","deltaLocation","generate_record","qstrand","paf_chain2paf","t_name","t_start","t_end","q_name","q_size","q_strand","q_start","q_end","num_matches","l_vec","tmp","size_ungapped_alignment","diff_in_target","diff_in_query","ChainAdapter","chainLocation","ComparativeAdaptersPlugin","PAFAdapterF","DeltaAdapterF","ChainAdapterF","MCScanAnchorsAdapterF","MCScanSimpleAnchorsAdapterF","MashMapAdapterF","CodeEditor","contents","setContents","debouncedJson","shrink","htmlFor","setTarget","newTarget","FromConfigAdapter","makeFeatures","fdata","makeFeature","bucket","FromConfigRegionsAdapter","currentRegion","FromConfigSequenceAdapter","superGetFeatures","featureClass","regionsConfigSchema","sequenceConfigSchema","RefNameAliasAdapter","refColumn","refNameColumn","ConfigurationEditorComponent","fromConfigAdapterConfigSchema","FromConfigAdapterClass","fromConfigRegionsAdapterConfigSchema","FromConfigRegionsAdapterClass","fromConfigSequenceAdapterConfigSchema","FromConfigSequenceAdapterClass","refNameAliasAdapterConfigSchema","RefNameAliasAdapterClass","ConfigurationEditorHeadingComponent","ConfigurationEditorConfigSchema","ConfigurationEditorStateModelFactory","isAbsoluteUrl","trackSource","trackData","indexTrackData","altAssemblyName","altTrackName","altTrackType","textIndexTrack","textIndexingConf","setAdapterHint","setTrackSource","setTextIndexingConf","setTextIndexTrack","setTrackData","setIndexTrackData","setAssembly","setTrackName","setTrackType","clearData","trackAdapter","isFtp","isRelativeTrackUrl","isRelativeIndexUrl","isRelativeUrl","trackHttp","indexHttp","wrongProtocol","protocol","unsupported","warningMessage","hasAnyOverlap","getTrackName","generateHierarchy","trackConfigurations","collapsed","hierarchy","filterText","filterLower","passesFilter","unshift","currLevel","isOpenByDefault","stateTreeFactory","setView","toggleCategory","pathName","clearFilterText","setFilterText","newText","getRefSeqTrackConf","refseq","trackConfAssemblies","allAliases","connectionTrackConfigurations","connection","hier","connections","connectionInstances","conns","names","conn","connectionId","connectionHierarchy","state","expanded","closeDialog","dialogContainer","lockedPluginTooltip","marginRight","LockedPlugin","Lock","PluginDialog","plugin","dialogPlugin","setDialogPlugin","sessionPlugins","isSessionPlugin","pluginMetadata","jbrowse","removePlugin","isSessionWithSessionPlugins","removeSessionPlugin","ListItem","plugins","corePlugins","isCore","externalPlugins","List","card","bold","fontWeight","dataField","isInstalled","runtimePluginDefinitions","pluginDefinition","tempDisabled","setTempDisabled","disableButton","Card","CardContent","rel","Person","authors","CardActions","startIcon","Check","Add","addPlugin","addSessionPlugin","closeButton","dialogContent","transition","transitions","shortest","expandOpen","umdPluginName","setUMDPluginName","umdPluginUrl","setUMDPluginUrl","esmPluginUrl","setESMPluginUrl","cjsPluginUrl","setCJSPluginUrl","advancedOptionsOpen","setAdvancedOptionsOpen","handleChange","handleSubmit","umdUrl","esmUrl","cjsUrl","DialogContentText","clsx","ExpandMore","Collapse","in","expandIcon","adminBadge","borderRadius","alignContent","customPluginButton","justifyContent","pluginArray","setPluginArray","customPluginFormOpen","setCustomPluginFormOpen","controller","err","InfoOutlined","InputProps","endAdornment","InputAdornment","Clear","Accordion","defaultExpanded","AccordionSummary","hubTxtLocation","baseConnectionConfig","hubFileLocation","hubFileText","HubFile","fetchGenomesFile","genomesFileLocation","genomesFileText","GenomesFile","fetchTrackDbFile","trackDbFileLocation","TrackDbFile","generateTracks","trackDb","trackKeys","parentTrackKeys","parentTracks","currentTrackName","makeTrackConfig","bigDataLocation","bigDataIndexLocation","baseTrackType","bigWigLocation","vcfGzLocation","hicLocation","UCSCTrackHubConnection","BaseConnectionModelFactory","connectionName","fetchHubFile","hubFile","genomesFile","trackDbData","genomeName","genome","assemblyConf","assemblies","trackDbFile","breakConnection","locstr","includeAsm","getBlockLabelKeysToHide","viewOffsetPx","blockLabelKeysToHide","sortedBlocks","alen","labelBounds","chooseGridPitch","scale","minMajorPitchPx","minMinorPitchPx","minMajorPitchBp","majorMagnitude","toExponential","majorPitch","majorPitchPx","minorPitch","makeTicks","emitMajor","emitMinor","gridPitch","iterPitch","minBase","Dotplot1DView","scaleFactor","setScaleFactor","DotplotHView","viewWidth","DotplotVView","viewHeight","headerHeight","borderSize","tickSize","vtextRotation","htextRotation","hview","vview","viewTrackConfigs","viewAssemblyConfigs","volatileError","borderX","borderY","assemblyErrors","assembliesInitialized","hticks","vticks","highResolutionScaling","clearView","setBorderX","setBorderY","setHeaderHeight","setAssemblyNames","setViews","arr","getCoords","mousedown","mouseup","xmin","xmax","ymin","ymax","onDotplotView","d1","d2","viewSnapshot","axis","regionsSnapshot","vblocks","hblocks","by","bx","squareView","hpx","vpx","squareViewProportional","ratio","ReturnToImportFormDialog","FolderOpenIcon","TrackSelectorIcon","backgroundImage","textAlign","blockMessage","blockError","LoadingMessage","LinearProgress","BlockMessage","messageText","BlockError","ReactComponent2","renderInProgress","ServerSideRenderedBlockContent","renderBlockData","renderBlockEffect","setLoading","setRendered","abortController","setMessage","posColor","negColor","thresholdsPalette","thresholds","MismatchParser","drawCir","arc","DotplotRenderer","createCanvas","db1","db2","unableToDraw","hBpPerPx","vBpPerPx","hvsnap","vvsnap","mateRef","identity","mq","b10","b20","e10","e20","b1","b2","e1","e2","currX","currY","createImageBitmap","dimensions","realizedViews","imageData","ComparativeServerSideRendererType","tryTrack","idsNotFound","ComparativeRender","renameRegionsIfNeeeded","getLength","getLengthSansClipping","getClip","gatherOverlaps","groups","memo","group","intervals","stack","pop","mergeIntervals","clipPos","origStrand","readAssembly","trackAssembly","SAs","aln","saRef","saStart","saStrand","saCigar","saLengthOnRef","lengthOnRef","getLengthOnRef","saLength","saLengthSansClipping","saStrandNormalized","saClipPos","saRealStart","seqLength","CIGAR","totalLength","refLength","DotplotPlugin","DotplotViewF","DotplotDisplayF","DotplotRendererF","LaunchDotplotViewF","pluggableElement","newStateModel","superContextMenuItems","AddIcon","TimelineIcon","gffGzLocation","dontRedispatch","gffLocation","gff3TabixAdapterConfigSchema","gff3AdapterConfigSchema","selectText","marginTop","flexItem","selectedAssembly","setSelectedAssembly","noAssemblies","FormControl","determineCurrentValue","rowNumber","removeBookmark","bookmarkedRegions","lgv","navToLocString","canonicalRefName","newDisplayedRegion","flexContainer","fileType","setFileType","GetApp","fileFormat","fileHeader","fileContents","labelVal","Blob","saveAs","downloadBookmarkFile","selectedAsm","setSelectedAsm","FileSelector","importBookmarks","clearAllBookmarks","ClearAll","link","measure","BookmarkGrid","compact","dialogRowNumber","setDialogRowNumber","bookmarkRows","toJS","columns","headerName","renderCell","navToBookmark","editable","DataGrid","rows","rowHeight","onCellEditCommit","updateBookmarkLabel","disableSelectionOnClick","DeleteBookmark","setCompact","ViewCompact","LabeledRegionModel","RegionModel","setLabel","modelSelectedAssembly","addBookmark","GridBookmarkConfigSchema","GridBookmarkStateModelFactory","superMenuItems","superRubberBandMenuItems","rubberBandMenuItems","activateBookmarkWidget","bookmarkWidget","widgets","bookmarkCurrentRegion","firstRegion","getSelectedRegions","leftOffset","rightOffset","BookmarksIcon","BookmarkIcon","gtfLocation","GtfPlugin","gtfAdapterConfigSchema","HicRenderer","resolution","getResolution","minBin","maxBin","abortBreakPoint","bin2","counts","rotate","HicRendererConfigSchema","setResolution","HicPlugin","hicAdapterConfigSchema","HicRendererReactComponent","hicRendererConfigSchema","linearHicdisplayConfigSchemaFactory","linearHicdisplayModelFactory","rootUrlTemplate","HttpMap","loadFile","meta","compress","track_names","hashHexCharacters","hash_bits","readMeta","getBucket","bucketIdent","hexToDirPath","hex","getHashHexCharacters","getCompress","substr","dirpath","crc32","JBrowse1TextSearchAdapter","httpMap","tracksNames","namesIndexLocation","searchType","queryString","getTrackNames","loadIndexFile","formatResults","exact","trackIndex","locstring","dataDirLocation","isTrack","deepUpdate","prop","src","prototype","nodeType","cloneNode","getTime","dest","copyFunc","empty","mixin","parseJB1Json","parsedConf","regularizeConf","parseJB1Conf","keyPath","operation","lineNumber","section","recordVal","parsedValue","existing","getValue","textLine","varName","isAlwaysArray","trackMetadata","sources","sourceDef","newSourceDef","typeMatch","sourceUrl","baseUrl","addBase","stores","refSeqs","nameUrl","trackConfig","trackClassName","store","regularizeClass","synthesizeTrackStoreConfig","histograms","mainConf","storeClass","urlTemplate","backendVersion","guessStoreClass","storeConf","useAsRefSeqStore","refseqs","dataRoot","baseConfig","include","baseConfigRoot","dataRootReg","dataRootLocation","baseProtocol","baseConfigLocation","newConfig","fetchedConfig","fetchConfigFile","createFinalConfig","defaults","configDefaults","configWithDefaults","loadIncludes","fillTemplates","finalConfig","validateConfig","parseJb1","aTracks","bTracks","mergeTrackConfigs","bT","aT","inputConfig","loadRecur","upstreamConf","newUpstreamConf","regularizeIncludes","loads","cacheBuster","includedData","subconfig","template","fillWith","fillTemplate","containerID","show_tracklist","show_nav","show_menu","show_overview","show_fullviewlink","update_browser_title","updateBrowserURL","datasets","_DEFAULT_EXAMPLES","volvox","modencode","yeast","highlightSearchedRegions","highResolutionMode","convertTrackConfig","jb1TrackConfig","jb2TrackConfig","Description","trackIdentifier","jb2Features","jb2Feature","seq_id","generateFromConfigTrackConfig","resolveUrlTemplate","baiUrlTemplate","csiUrlTemplate","craiUrlTemplate","tbiUrlTemplate","fastaLocation","faiUrlTemplate","faiLocation","gziUrlTemplate","gziLocation","twoBitLocation","fetchJb1","jb2Tracks","jb1Track","jb2Track","LegacyJBrowsePlugin","ncListAdapterConfigSchema","addTextSearchAdapterType","jbrowse1AdapterConfigSchema","JBrowse1TextSearchAdapterClass","addConnectionType","jbrowse1ConfigSchema","jbrowse1ModelFactory","Curves","StraightLines","whiteSpace","LinearComparativeDisplay","middleComparativeHeight","param","beforeDestroy","removeAssembly","setMiddleComparativeHeight","schema","bpPerPxs","center","setNewView","trackIds","middle","baseConfigFactory","parentView","generateMatches","interstitialYPos","cond","colorMap","I","getResources","hydratedFeatures","f1s","f1e","f2s","f2e","parsedCIGARs","drawCurves","offsets","resetTransform","viewSnaps","ref1","ref2","v1","v2","length1","length2","x11","x12","x21","x22","mid","cx1","cx2","rev1","rev2","continuingFlag","px1","px2","LinearSyntenyRenderer","serializedFeatures","_level","toggleCurves","CropFreeIcon","LinkOffIcon","LinkIcon","WindowSizeDlg","preFeature","windowSizeText","setWindowSize","primaryFeature","setPrimaryFeature","qualTrack","setQualTrack","windowSize","done","SA","primaryAln","FormControlLabel","control","Checkbox","CircularProgress","supplementaryAlignments","featSeq","configFeatureStore","seqTrackId","sequenceTrackConf","lgvRegions","addAssembly","noAssemblyManager","random","showReverse","showTranslation","LinearComparativeViewF","LinearSyntenyViewF","LinearSyntenyRendererF","LinearComparativeDisplayF","LinearSyntenyDisplayF","LaunchLinearSyntenyViewF","SyntenyTrackF","CalendarIcon","contentBlock","minHeight","boxSizing","elidedBlock","interRegionPaddingBlock","boundaryPaddingBlock","disabledBackground","boundary","slider","log2","zoom","ZoomOut","Z","Slider","onChangeCommitted","ZoomIn","HEADER_BAR_HEIGHT","headerForm","flexWrap","panButton","WIDGET_HEIGHT","SPACING","toggleButton","border","buttonSpacer","HeaderButtons","PanControls","slide","ArrowBack","ArrowForward","RegionWidth","coarseTotalBp","Controls","FormGroup","SearchBox","hideHeaderOverview","OverviewScaleBar","dragHandle","dragHandleIcon","verticalAlign","iconButton","TrackLabel","popupState","usePopupState","popupId","getTrackActionMenuItems","priority","draggable","onDragStart","parentNode","dataTransfer","setDragImage","setDraggingTrackId","onDragEnd","bindTrigger","CascadingMenu","bindPopover","RESIZE_HANDLE_HEIGHT","shape","trackLabel","renderingComponentContainer","trackLabelInline","trackLabelOverlap","trackRenderingContainer","overflowX","TrackContainerLabel","labelStyle","trackLabels","horizontalScroll","draggingTrackId","moveTrack","debouncedOnDragEnter","dimmed","onScroll","onDragEnter","role","onHorizontalScroll","rubberBand","rubberBandControl","rubberBandText","popover","mouseEvents","paddingRight","guide","VerticalGuide","coordX","placement","ControlComponent","startX","setStartX","currentX","setCurrentX","anchorPosition","setAnchorPosition","guideX","setGuideX","controlsRef","rubberBandRef","mouseDragging","setOffsets","mouseDown","stopPropagation","relativeX","mouseOut","globalMouseMove","globalMouseUp","computeOffsets","leftBpOffset","rightBpOffset","numOfBpSelected","Popover","transformOrigin","keepMounted","disableRestoreFocus","anchorReference","scaleBarContainer","scaleBarZoomContainer","scaleBar","majorTickLabel","lineHeight","refLabel","RenderedRefNameLabels","lastLeftBlock","RenderedScaleBarLabels","baseNumber","ScaleBar","other","offsetLeft","totalWidthPx","verticalGuidesZoomContainer","verticalGuidesContainer","majorTick","minorTick","divider","RenderedVerticalGuides","centerLineContainer","borderTop","borderBottom","centerLineText","trackHeights","startingPosition","tracksContainer","scheduled","prevX","setMouseDragging","onWheel","origEvent","normalizeWheel","ctrlKey","pixelY","pixelX","dataset","resizer","showCenterLine","SCALE_BAR_HEIGHT","SearchResultsDialog","importFormContainer","ImportForm","textSearchManager","rankSearchResults","isSearchDialogDisplayed","importError","setImportError","searchScope","assemblyError","myVal","allRefs","allRefNames","fetchResults","setSearchResults","ErrorMessage","Container","handleSelectedRegion","Grid","AssemblySelector","RefNameAutocomplete","minWidth","TextFieldProps","helperText","disableShrink","showAllRegionsInAssembly","optAssemblyName","formatSeqFasta","loadingMessage","textAreaFont","regionsSelected","active","chunkSeq","chunkRefName","chunkStart","chunkEnd","chunkLocstring","sequenceTooLarge","Divider","multiline","minRows","readOnly","seqFastaFile","autoFocus","note","dots","hasDisplayedRegions","seqDialogDisplayed","setSequenceDialogOpen","Header","hideNoTracksActive","HoverTooltip","overview","cytobandOffset","cytoband","cytobands","OverviewRubberBand","clickedAt","globalKeyDown","HEADER_OVERVIEW_HEIGHT","scaleBarBorder","scaleBarContig","scaleBarContigForward","backgroundRepeat","scaleBarContigReverse","scaleBarRefName","scaleBarLabel","scaleBarVisibleRegion","overviewSvg","Polygon","useOffset","multiplier","totalWidthPxWithoutBorders","polygonColor","first","last","topLeft","topRight","startPx","endPx","points","rightRoundedRect","gneg","gpos25","gpos50","gpos100","gpos75","gvar","stalk","acen","getCytobands","Cytobands","coords","lcap","rcap","firstCent","OverviewBox","showCytobands","refNameColor","getRefNameColor","tickLabels","offsetLabel","canDisplayCytobands","tickLabel","labelIdx","visibleRegions","overviewVisibleRegions","scaleBarColor","firstOverviewPx","lastOverviewPx","transparency","modWidth","HelpDialog","MyPopper","onSelect","showHelp","loaded","setLoaded","isHelpDialogDisplayed","setHelpDialogDisplayed","currentSearch","setCurrentSearch","inputValue","setInputValue","searchOptions","setSearchOptions","debouncedSearch","coarseVisibleLocStrings","getDisplayString","inputBoxVal","disableListWrap","disableClearable","PopperComponent","freeSolo","includeInputInList","selectOnFocus","onInputChange","newInputValue","loadingText","onOpen","selectedOption","getOptionDisabled","filterOptions","filtered","searchQuery","toLocaleLowerCase","renderInput","placeholder","renderOption","getRenderingComponent","noWrap","getOptionLabel","headerRefName","assemblyRegions","searchResults","align","newRegion","handleClick","resultTrackId","getId","textSearchResults","refNameResults","mathPower","Ruler","major","minor","displayBp","x0","SVGRuler","renderRuler","clipPath","SVGHeader","cytobandHeight","SVGRegionSeparators","SVGTracks","displayResults","renderToSvg","shift","renderToStaticMarkup","xmlns","xmlnsXlink","viewBox","ExportSvgDlg","offscreenCanvas","OffscreenCanvas","rasterizeLayers","setRasterizeLayers","setFilename","exportSvg","calculateVisibleLocStrings","isSingleAssemblyName","localStorageGetItem","MUIRegion","setting","showCytobandsSetting","afterDisplayedRegionsSetCallbacks","coarseDynamicBlocks","scaleBarHeight","trackHeightsWithResizeHandles","includeAggregateIndexes","openTrackIds","updateScore","getScore","rewriteOnClicks","holdOnClick","apply","trackTypeActions","allActions","setShowCytobands","toggleHeader","toggleHeaderOverview","toggleNoTracksActive","horizontallyFlip","displayInitialSnapshot","movingTrackId","targetTrackId","oldIndex","newIndex","isViewContainer","setTrackLabels","toggleCenterLine","parsedLocStrings","inputs","isInteger","locations","asmName","navTo","navToMultiple","firstLocation","refNameMatched","lastIndex","previousIndex","locationIndex","locationStart","locationEnd","startDisplayedRegion","endDisplayedRegion","simView","afterDisplayedRegionsSet","targetBpPerPx","extraBp","factor","cancelLastAnimation","viewWidths","animate","cancelAnimation","canShowCytobands","anyCytobandsExist","PhotoCameraIcon","SyncAltIcon","LabelIcon","currentlyCalculatedStaticBlocks","stringifiedCurrentlyCalculatedStaticBlocks","sret","roundedDynamicBlocks","visibleLocStrings","setCoarseDynamicBlocks","ZoomInIcon","CompositeMap","submaps","submap","Symbol","iterator","tooltip","common","typography","pxToRem","clientMouseCoord","popperElt","setPopperElt","virtElement","usePopper","styles","attributes","Portal","popper","linearBlocks","heightOverflowed","textShadow","RenderedBlocks","blockState","viewModel","clientRect","setClientRect","offsetMouseCoord","setOffsetMouseCoord","setClientMouseCoord","contextCoord","setContextCoord","mouseCoord","TransitionProps","onExit","blockReactNodeMessage","Repeater","killed","blockStatus","messageContent","Refresh","reloadFlag","doReload","setStatus","isRetryException","freeResourcesInClient","optDisplay","regionAsm","hasName","displayError","viewParams","isJest","BlockState","userBpPerPxLimit","userByteSizeLimit","estimatedRegionStatsP","estimatedRegionStats","featureMaps","getByCoord","getByID","currentBytesRequested","bytes","currentFeatureScreenDensity","estimatedStatsReady","maxAllowableBytes","blockWatchDisposer","blocksPresent","addBlock","deleteBlock","setRegionStatsP","setRegionStats","clearRegionStats","updateStatsLimit","isSelectionContainer","clearSelection","setFeatureIdUnderMouse","regionTooLarge","bpLimitOrDensity","regionTooLargeReason","totalBytes","req","aborter","statsP","regionCannotBeRenderedText","renderings","rendering","clipid","dangerouslySetInnerHTML","__html","trackShowLabels","trackShowDescriptions","trackDisplayMode","showLabels","showDescriptions","toggleShowLabels","toggleShowDescriptions","setDisplayMode","mouseover","LinearGenomeViewPlugin","linearBareDisplayConfigSchemaFactory","LinearBareDisplayStateModelFactory","linearBasicDisplayModelFactory","linearGenomeViewStateModelFactory","LineStyleIcon","ScoreText","layoutRecord","anchorX","innerColor","scoreString","fontHeight","Lollipop","onFeatureMouseDown","onFeatureMouseEnter","onFeatureMouseOut","onFeatureMouseOver","onFeatureMouseUp","onFeatureMouseLeave","onFeatureMouseMove","anchorLocation","styleOuter","styleInner","Stick","LollipopRendering","layoutFeat","lollipopsRendered","getLayout","strokeColor","minStickLength","stickColor","stickWidth","FloatingLayout","layoutDirty","sorted","maxBottom","layoutEntries","currentItem","previouslyLayedOutItem","prevStart","prevTop","prevEnd","prevBottom","pairs","PrecomputedFloatingLayout","FloatingLayoutSession","LollipopRenderer","LollipopRendererReactComponent","lollipopRendererConfigSchema","linearLollipopDisplayConfigSchemaFactory","LinearLollipopDisplayStateModelFactory","aboutConfigSchema","aboutStateModel","helpConfigSchema","helpStateModel","importSessionConfigSchema","importSessionStateModel","sessionManagerConfigSchema","sessionManagerStateModel","appendToMenu","InfoIcon","HelpIcon","SPARQLAdapter","endpoint","queryTemplate","refNamesQueryTemplate","additionalQueryParams","configRefNames","encodeURIComponent","querySparql","resultsToRefNames","filledTemplate","resultsToFeatures","accept","bindings","head","vars","requiredField","seenFeatures","rawData","rd","parentUniqueId","pid","sf","found","seenFeature","RdfPlugin","sparqlAdapterConfigSchema","SPARQLAdapterClass","metadataLocation","chromSizesLocation","Translation","frame","tilt","effectiveFrame","seqSliced","translated","normalizedCodon","aminoAcid","drop","element","startCodon","stopCodon","DNA","SequenceSVG","showForward","Wrapper","divSequenceRendererConfigSchema","DivSequenceRenderer","SequencePlugin","twoBitAdapterConfigSchema","chromSizesAdapterConfigSchema","indexedFastaAdapterConfigSchema","bgzipFastaAdapterConfigSchema","GCContentAdapterF","createReferenceSeqTrackConfig","toggleShowForward","toggleShowReverse","toggleShowTranslation","linearReferenceSequenceDisplayModelFactory","linearReferenceSequenceDisplayConfigSchema","DivSequenceRendererReactComponent","MakeSpreadsheetColumnType","DataCellReactComponent","FilterModelType","compare","categoryName","hasFilter","textFilterControlAdornment","textFilterControl","FilterReactComponent","filterModel","operationChoices","setOperation","locStringIsInvalid","evt","setLocString","OPERATIONS","OPERATION_PREDICATES","cellLocation","specifiedLocation","columnNumber","parsedLocString","spreadsheet","sheet","cell","cellsWithDerived","extendedData","parsedCellText","locationLinkClick","newViewId","cellA","cellB","contains","textInCell","stringToFind","equals","setString","ColumnTextFilter","TextColumnType","NumberFilterModel","numberInCell","firstNumber","between","secondNumber","firstNumberIsInvalid","setFirstNumber","secondNumberIsInvalid","setSecondNumber","ColumnTypes","Text","LocString","LocRef","LocStart","LocEnd","allColumnTypes","AnyColumnType","AnyFilterModelType","columnType","CellModel","cells","isSelected","toggleSelect","unSelect","select","setExtendedData","column","isDerived","isLoaded","RowModel","passingFiltersCount","sortedFilteredRows","selectedCount","selectedRows","selectedAndPassingFiltersCount","selectedFilteredRows","sortedRows","rowSortingComparisonFunction","filterControls","rowPassesFilters","unselectAll","ColumnDefinition","dataType","derivationFunctionText","rowSet","StaticRowSetModel","columnDisplayOrder","hasColumnNames","sortColumns","descending","switchDirection","defaultDataType","rowMenuPosition","hideRowSelection","dataTypeChoices","rowA","rowB","setRowMenuPosition","newPosition","setSortColumns","newSort","setColumnType","newTypeName","IMPORT_SIZE_LIMIT","fileTypes","fileTypeParsers","CSV","parseCsvBuffer","TSV","parseTsvBuffer","VCF","parseVcfBuffer","BED","parseBedBuffer","BEDPE","parseBedPEBuffer","parseSTARFusionBuffer","fileTypesRegexp","hasColumnNameLine","columnNameLineNumber","selectedAssemblyName","fileSource","isReadyToOpen","canCancel","readyToDisplay","requiresUnzip","setSelectedAssemblyName","setFileSource","newSource","toggleHasColumnNameLine","setColumnNameLineNumber","newnumber","cancelButton","import","typeParser","filehandle","stat","displaySpreadsheet","RowFullTextFilter","_sheet","rowFullText","columnFilters","AnyColumnFilter","setRowFullTextFilter","addBlankColumnFilter","removeColumnFilter","clearAllFilters","defaultRowMenuItems","DoneIcon","_view","hideViewControls","hideFilterControls","FilterControlsModel","importWizard","ImportWizardModel","SpreadsheetModel","rowMenuItems","outputRows","setRowMenuItems","newItems","setImportMode","SpreadsheetViewPlugin","SpreadsheetViewModel","exts","ext","ViewComfyIcon","viewControls","viewsContainer","spreadsheetViewContainer","borderRight","circularViewOptions","ViewControls","direction","FolderOpen","CircularViewOptions","svInspector","circularViewOptionsBarHeight","rowSelector","onlyDisplayRelevantRegionsInCircularView","setOnlyDisplayRelevantRegionsInCircularView","dragHandleHeight","SpreadsheetViewReactComponent","CircularViewReactComponent","showCircularView","spreadsheetView","ret1","circularView","flexbox","circularViewContainer","makeAdHocFeature","columnsAlreadyUsedInLocations","loc1","loc2","otherData","makeAdHocSvFeature","columnTypes","columnDefinition","locationColumnNumbers","locStartColumnNumbers","locEndColumnNumbers","locRefColumnNumbers","makeAdHocSvFeatureFromTwoLocations","textOf","colno","makeAdHocSvFeatureFromTwoRefStartEndSets","getSerializedFeatureForRow","vcfFeature","adhocFeature","breakpointSplitViewSnapshotFromTableRow","svInspectorView","snapshotFromBreakendFeature","defaultOnChordClick","chordTrack","SpreadsheetViewType","CircularViewType","featuresAdapterConfigSnapshot","featuresRefNamesP","featuresCircularTrackConfiguration","spreadsheetWidth","circularViewWidth","featureRefNames","canonicalFeatureRefNames","generatedTrackConf","OpenInNewIcon","canOpenBreakpointSplitViewFromTableRow","openBreakpointSplitViewFromTableRow","ReactComponentFactory","StateModelFactory","SvInspectorViewPlugin","SvInspectorViewTypeFactory","TableChartIcon","featureWidth","allowedWidthExpansion","totalWidth","measuredTextWidth","viewLeft","rstart","rend","featureWidthBp","rootLayout","shouldShowName","shouldShowDescription","featureLayout","getSubRecord","GlyphComponent","FeatureLabel","OverlayRect","rectProps","screenWidth","leftWithinBlock","widthWithinBlock","handlers","mouseoverFeatureId","reverseFlip","color2","topLevel","isUTR","subfeatureId","subfeatureLayout","ProcessedTranscript","getSubparts","filterSubpart","confKey","makeSubpartsFilter","hasUTRs","isTranscript","subs","haveLeftUTR","haveRightUTR","subparts","codeStart","codeEnd","makeUTRs","layOut","extraGlyphs","layOutFeature","layOutSubfeatures","Subfeatures","topOffset","SubfeatureGlyphComponent","chooseGlyphComponent","subfeatureHeight","move","hasSubSub","Segments","validator","glyph","Box","layoutParent","addChild","RenderedFeatureGlyph","labelsAllowed","expansion","getWidth","glyphWidth","textWidth","aboveLayout","RenderedFeatures","isFeatureDisplayed","featureDisplayHandler","useCallback","mouseUp","featureIdCurrentlyUnderMouse","click","color1","color3","labels","nameColor","descriptionColor","subParts","impliedUTRs","SvgFeatureRenderer","SVGPlugin","SvgFeatureRendererReactComponent","svgFeatureRendererConfigSchema","trackDbId","subTracks","getSubtracks","trackPath","members","subTrack","shortLabel","_source","trackDbUrl","bigDataUrl","bigDataIndex","longLabel","hub","connectionConf","rawResponse","TrackHubRegistryPlugin","decodeURIComponentNoThrow","decodeURIComponent","shorten","term","tidx","TrixTextSearchAdapter","trixJs","ixFilePath","ixxFilePath","Trix","strs","formatted","record","labelFieldIdx","contextIdx","labelField","contextField","context","metaFilePath","trixAdapterConfigSchema","TrixTextSearchAdapterClass","VCFFeature","parser","_id","dataFromVariant","SAMPLES","REF","ALT","POS","CHROM","ID","_getSOTermAndDescription","SO_term","isTRA","soTerms","descriptions","_getSOAndDescFromAltDefs","soTerm","_getSOAndDescByExamination","prefixes","desc","new_descs","suffixes","pref","_altTypeToSO","modAlt","_makeDescriptionString","samples","DEL","INS","DUP","INV","INVDUP","CNV","TRA","NON_REF","optional","compose","literal","ChordVariantDisplay","BaseChordDisplayComponentFactory","bpToRadians","blockStart","blockEnd","Chord","svType","endPosition","endBlock","blocksForRefs","startBlock","SVTYPE","startXY","endXY","controlXY","hoverStrokeColor","StructuralVariantChords","blocksForRefsMemo","chords","trackStyleId","strokeColorSelected","strokeColorHover","ChordRendererType","vcfLocation","VariantsPlugin","vcfTabixAdapterConfigSchema","vcfAdapterConfigSchema","StructuralVariantChordRendererFactory","linearVariantDisplayConfigSchemaFactory","linearVariantDisplayModelFactory","variantFeatureWidgetConfigSchema","variantFeatureWidgetStateModelFactory","draw","getFeatureUnderMouse","eventClientX","pivotValue","scaleLinear","scaleLog","scaleQuantize","nice","rangeMin","rangeMax","getNiceDomain","bounds","getScaleType","highlightColor","renderType","bicolorPivot","bicolorPivotValue","summaryScoreMode","DensityRenderer","colorCallback","pivot","colorScale","hoverVertical","YScaleBar","orientation","shadow","orient","LinearWiggleDisplay","SetMinMaxDlg","SetColorDlg","selectedRendering","rendererTypeNameState","constraints","statsReady","statsFetchInProgress","updateStats","setColor","setPosColor","setNegColor","statsFetch","setFill","toggleLogScale","setScaleType","setSummaryScoreMode","setAutoscale","setMaxScore","setRendererType","setMinScore","toggleCrossHatches","setCrossHatches","cross","adapterTypeName","oldDomain","summaryScoreModeSetting","autoscaleType","canHaveFill","displayCrossHatchesSetting","minimalTicks","axisPropsFromTickScale","hasResolution","hasGlobalStats","superRenderSvg","getStats","nd","wiggleStats","XYPlotRenderer","niceMin","niceMax","_score","crossingOrigin","maxr","minr","lowClipping","highClipping","summary","mix","LinePlotRenderer","lastVal","rawscore","WiggleGetGlobalStats","getGlobalStats","WiggleGetMultiRegionStats","getMultiRegionStats","WigglePlugin","XYPlotRendererReactComponent","xyPlotRendererConfigSchema","utils","XYPlotRendererConfigSchema","DensityRendererConfigSchema","LinePlotRendererConfigSchema","numStdDev","linearWiggleDisplayConfigSchemaFactory","bigWigAdapterConfigSchema","DensityRendererReactComponent","densityRendererConfigSchema","LinePlotRendererReactComponent","linePlotRendererConfigSchema"],"sourceRoot":""}