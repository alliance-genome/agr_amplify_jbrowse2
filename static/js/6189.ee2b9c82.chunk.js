(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6189],{87518:function(e,t,n){"use strict";n.d(t,{e$:function(){return m},jS:function(){return h}});var r=n(59740),a=n(33028),i=n(63680),o=n(75717),s=n(73636),c=n.n(s),u=n(99836),l=n(97531),d=n(42328),f=["featureData","finalizedFeatureData"],p=["unformattedFeatureData","featureData"],h=(0,u.ConfigurationSchema)("BaseFeatureWidget",{});function g(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t<=a||(i.subfeatures=null===(r=e.subfeatures)||void 0===r?void 0:r.map((function(e){return g(e,t,n,a+1,i),n(e)}))),i}function m(e){return i.types.model("BaseFeatureWidget",{id:d.ElementId,type:i.types.literal("BaseFeatureWidget"),featureData:i.types.frozen(),formattedFields:i.types.frozen(),unformattedFeatureData:i.types.frozen(),view:i.types.safeReference(e.pluggableMstType("view","stateModel")),track:i.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:i.types.maybe(i.types.string),trackType:i.types.maybe(i.types.string)}).actions((function(e){return{setFeatureData:function(t){e.unformattedFeatureData=t},clearFeatureData:function(){e.featureData=void 0},setFormattedData:function(t){e.featureData=t},setExtra:function(t,n){e.trackId=n,e.trackType=t}}})).actions((function(e){return{afterCreate:function(){(0,i.addDisposer)(e,(0,o.autorun)((function(){var t,n;e.setExtra(null===(t=e.track)||void 0===t?void 0:t.type,null===(n=e.track)||void 0===n?void 0:n.configuration.trackId);var r=e.unformattedFeatureData,i=e.track,o=(0,l.getSession)(e);if(r){var s=c()(r),d=function(e,t){return(0,u.getConf)(e,["formatDetails",t],{feature:s})};if(i){s.__jbrowsefmt=(0,a.Z)((0,a.Z)({},d(o,"feature")),d(i,"feature"));var f=(0,u.getConf)(i,["formatDetails","depth"]);g(s,f,(function(e){e.__jbrowsefmt=(0,a.Z)((0,a.Z)({},d(o,"subfeature")),d(i,"subfeature"))}))}e.setFormattedData(s)}})))}}})).preProcessSnapshot((function(e){var t=e.featureData,n=e.finalizedFeatureData,i=(0,r.Z)(e,f);return(0,a.Z)({unformattedFeatureData:t,featureData:n},i)})).postProcessSnapshot((function(e){var t=e,n=(t.unformattedFeatureData,t.featureData),i=(0,r.Z)(t,p);return(0,a.Z)({finalizedFeatureData:JSON.parse(JSON.stringify(n,(function(e,t){return"undefined"===typeof t?null:t})))},i)}))}},77707:function(e,t,n){"use strict";n.d(t,{Z:function(){return z}});var r={};n.r(r),n.d(r,{CoreEstimateRegionStats:function(){return N},CoreFreeResources:function(){return A},CoreGetFeatureDetails:function(){return C},CoreGetFeatures:function(){return P},CoreGetFileInfo:function(){return R},CoreGetMetadata:function(){return v},CoreGetRefNames:function(){return m},CoreRender:function(){return L}});var a=n(9249),i=n(87371),o=n(45754),s=n(13820),c=n(96902),u=n(87518),l=n(87977),d=n(32723),f=n(34795),p=n(75019),h=n(42273),g=n(82972),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetRefNames",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.sessionId,o=a.adapterConfig,e.next=7,(0,p.uP)(r,i,o);case 7:if(s=e.sent,c=s.dataAdapter,!(0,g.isFeatureAdapter)(c)){e.next=11;break}return e.abrupt("return",c.getRefNames(a));case 11:return e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),v=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetMetadata",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.sessionId,o=a.adapterConfig,e.next=7,(0,p.uP)(r,i,o);case 7:return s=e.sent,c=s.dataAdapter,e.abrupt("return",(0,g.isFeatureAdapter)(c)?c.getMetadata(a):null);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),y=n(93069),b=n(95058),x=n(97531),w=n(62518);function k(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof w.default))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var C=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetFeatureDetails",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r){var a,i,o,s,c,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.pluginManager.rootModel,i=a.session.assemblyManager,e.next=4,(0,x.renameRegionsIfNeeded)(i,t);case 4:return o=e.sent,e.next=7,(0,y.Z)((0,b.Z)(n.prototype),"serializeArguments",this).call(this,o,r);case 7:if(s=e.sent,"MainThreadRpcDriver"!==r){e.next=10;break}return e.abrupt("return",s);case 10:return c=t.rendererType,u=k(c,this.pluginManager.getRendererType(c)),e.abrupt("return",u.serializeArgsInClient(s));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:return i=(a=r).rendererType,o=a.featureId,s=k(i,this.pluginManager.getRendererType(i)),c=s.sessions[(0,x.getLayoutId)(t)],u=c.cachedLayout.layout,l=u.getDataByID(o),e.abrupt("return",{feature:l.toJSON()});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),Z=n(33028),S=n(66043),T=n(56218),M=n(43430),P=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetFeatures",e}return(0,i.Z)(n,[{key:"deserializeReturn",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r,a){var i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.Z)((0,b.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:return i=e.sent,e.abrupt("return",i.map((function(e){return new M.Z(e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r){var a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.pluginManager.rootModel,i=a.session.assemblyManager,e.next=4,(0,x.renameRegionsIfNeeded)(i,t);case 4:return o=e.sent,e.abrupt("return",(0,y.Z)((0,b.Z)(n.prototype),"serializeArguments",this).call(this,o,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l,f,h,m;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.signal,o=a.sessionId,s=a.adapterConfig,c=a.regions,u=a.opts,e.next=7,(0,p.uP)(r,o,s);case 7:if(l=e.sent,f=l.dataAdapter,(0,g.isFeatureAdapter)(f)){e.next=11;break}throw new Error("Adapter does not support retrieving features");case 11:return h=f.getFeaturesInMultipleRegions(c,(0,Z.Z)((0,Z.Z)({},u),{},{signal:i})),e.next=14,(0,T.z)(h.pipe((0,S.q)()));case 14:return m=e.sent,e.abrupt("return",m.map((function(e){return e.toJSON()})));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),R=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetInfo",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.sessionId,o=a.adapterConfig,e.next=7,(0,p.uP)(r,i,o);case 7:return s=e.sent,c=s.dataAdapter,e.abrupt("return",(0,g.isFeatureAdapter)(c)?c.getHeader(a):null);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreFreeResources",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,n+=(0,p.Yr)(t),this.pluginManager.getRendererTypes().forEach((function(e){var t=e.freeResources();t&&(n+=t)})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),L=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreRender",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r){var a,i,o,s,c,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.pluginManager.rootModel,i=a.session.assemblyManager,e.next=4,(0,x.renameRegionsIfNeeded)(i,t);case 4:return o=e.sent,e.next=7,(0,y.Z)((0,b.Z)(n.prototype),"serializeArguments",this).call(this,o,r);case 7:if(s=e.sent,"MainThreadRpcDriver"!==r){e.next=10;break}return e.abrupt("return",s);case 10:return c=t.rendererType,u=k(c,this.pluginManager.getRendererType(c)),e.abrupt("return",u.serializeArgsInClient(s));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,o=a.rendererType,s=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:if((0,x.checkAbortSignal)(s),c=k(o,this.pluginManager.getRendererType(o)),"MainThreadRpcDriver"!==n){e.next=16;break}return e.next=13,c.render(r);case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,c.renderInWorker(r);case 18:e.t0=e.sent;case 19:return u=e.t0,(0,x.checkAbortSignal)(s),e.abrupt("return",u);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r,a){var i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.Z)((0,b.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(i=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",i);case 5:return o=r.rendererType,s=k(o,this.pluginManager.getRendererType(o)),e.abrupt("return",s.deserializeResultsInClient(i,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(h.Z),N=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreEstimateRegionStats",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r){var a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.pluginManager.rootModel,o=i.session.assemblyManager,e.next=4,(0,x.renameRegionsIfNeeded)(o,(0,Z.Z)((0,Z.Z)({},t),{},{filters:null===(a=t.filters)||void 0===a?void 0:a.toJSON().filters}));case 4:return s=e.sent,e.abrupt("return",(0,y.Z)((0,b.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,c,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.adapterConfig,o=a.sessionId,s=a.regions,e.next=7,(0,p.uP)(r,o,i);case 7:if(c=e.sent,u=c.dataAdapter,(0,g.isFeatureAdapter)(u)){e.next=11;break}throw new Error("Adapter does not support retrieving features");case 11:return e.abrupt("return",u.estimateRegionsStats(s,a));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(h.Z),j=n(5868),F=n(26347),I=n(96234),B=n(99836),D=n(32145);var E=(0,B.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0}),V=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"getData",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=(0,B.readConfObject)(this.config,"cytobandLocation")).uri&&"/path/to/cytoband.txt.gz"!==t.uri){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,(0,D.openLocation)(t).readFile("utf8");case 5:return n=e.sent,e.abrupt("return",n.split(/\n|\r\n|\r/).filter((function(e){return!!e.trim()})).map((function(e){var t=e.split("\t"),n=(0,I.Z)(t,5),r=n[0],a=n[1],i=n[2],o=n[3],s=n[4];return new M.Z({uniqueId:e,refName:r,start:+a,end:+i,name:o,type:s})})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(g.BaseAdapter),z=function(e){(0,o.Z)(l,e);var t=(0,s.Z)(l);function l(){var e;(0,a.Z)(this,l);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="CorePlugin",e}return(0,i.Z)(l,[{key:"install",value:function(e){Object.values(r).forEach((function(t){e.addRpcMethod((function(){return new t(e)}))})),e.addAdapterType((function(){return new j.Z({name:"CytobandAdapter",configSchema:E,AdapterClass:V})})),e.addWidgetType((function(){return new F.Z({name:"BaseFeatureWidget",heading:"Feature details",configSchema:u.jS,stateModel:(0,u.e$)(e),ReactComponent:(0,c.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(5471)]).then(n.bind(n,58941))}))})}))}}]),l}(l.Z)},87977:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9249),a=n(87371),i=function(){function e(){(0,r.Z)(this,e),this.name=void 0,this.url=void 0,this.version=void 0,this.configurationSchema=void 0}return(0,a.Z)(e,[{key:"install",value:function(e){}},{key:"configure",value:function(e){}}]),e}()},20167:function(e,t,n){"use strict";n.d(t,{Z:function(){return se}});var r=n(33028),a=n(96234),i=n(96902),o=n(54370),s=n.t(o,2),c=n(75717),u=n(63680),l=n(4782),d=n(91188),f=n(61113),p=n.n(f),h=n(16644),g=n(14100),m=n(47301),v=n(88636),y=n(52646),b=n(77327),x=n(8575),w=n(82972),k=n(30368),C=n(91271),Z=n(65317),S=n(5868),T=n(95984),M=n(55385),P=n(26347),R=n(33991),A=n(62518),L=n(73749),N=n(66568),j=n(13381),F=n(57173),I=n(99836),B=n(87977),D=n(46186),E=n(97531),V=n(51632),z=n(70577),O=n(16151),W=n(32145),H=n(29151),G=n(93824),q=n(42328),U=["mobx","mobx-state-tree","react","react-dom","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","prop-types","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"],_=n(29938),J={Accordion:(0,i.lazy)((function(){return Promise.all([n.e(952),n.e(6274)]).then(n.bind(n,66274))})),AccordionActions:(0,i.lazy)((function(){return n.e(6844).then(n.bind(n,26844))})),AccordionDetails:(0,i.lazy)((function(){return n.e(7564).then(n.bind(n,67564))})),Alert:(0,i.lazy)((function(){return n.e(1336).then(n.bind(n,41336))})),AlertTitle:(0,i.lazy)((function(){return n.e(157).then(n.bind(n,10157))})),Autocomplete:(0,i.lazy)((function(){return n.e(500).then(n.bind(n,20500))})),Avatar:(0,i.lazy)((function(){return n.e(9815).then(n.bind(n,24609))})),AvatarGroup:(0,i.lazy)((function(){return n.e(506).then(n.bind(n,90506))})),Backdrop:(0,i.lazy)((function(){return n.e(4788).then(n.bind(n,24788))})),Badge:(0,i.lazy)((function(){return Promise.all([n.e(9883),n.e(7166)]).then(n.bind(n,7166))})),Box:(0,i.lazy)((function(){return n.e(842).then(n.bind(n,60842))})),Breadcrumbs:(0,i.lazy)((function(){return n.e(4822).then(n.bind(n,54822))})),Button:(0,i.lazy)((function(){return n.e(6745).then(n.bind(n,76745))})),ButtonGroup:(0,i.lazy)((function(){return n.e(1032).then(n.bind(n,81032))})),Card:(0,i.lazy)((function(){return n.e(7389).then(n.bind(n,67389))})),CardActions:(0,i.lazy)((function(){return n.e(930).then(n.bind(n,10930))})),CardActionArea:(0,i.lazy)((function(){return n.e(5868).then(n.bind(n,75868))})),CardContent:(0,i.lazy)((function(){return n.e(389).then(n.bind(n,70389))})),CardHeader:(0,i.lazy)((function(){return n.e(4682).then(n.bind(n,84682))})),CardMedia:(0,i.lazy)((function(){return n.e(3382).then(n.bind(n,23382))})),CircularProgress:(0,i.lazy)((function(){return n.e(3091).then(n.bind(n,23091))})),Collapse:(0,i.lazy)((function(){return n.e(1770).then(n.bind(n,91770))})),ClickAwayListener:(0,i.lazy)((function(){return n.e(2909).then(n.bind(n,32909))})),Chip:(0,i.lazy)((function(){return n.e(764).then(n.bind(n,764))})),Checkbox:(0,i.lazy)((function(){return n.e(7414).then(n.bind(n,57414))})),Container:(0,i.lazy)((function(){return n.e(9673).then(n.bind(n,29673))})),Dialog:(0,i.lazy)((function(){return n.e(6551).then(n.bind(n,46551))})),DialogActions:(0,i.lazy)((function(){return n.e(8162).then(n.bind(n,78162))})),DialogTitle:(0,i.lazy)((function(){return n.e(9743).then(n.bind(n,19743))})),DialogContent:(0,i.lazy)((function(){return n.e(309).then(n.bind(n,40309))})),DialogContentText:(0,i.lazy)((function(){return n.e(9276).then(n.bind(n,49276))})),Divider:(0,i.lazy)((function(){return n.e(683).then(n.bind(n,20683))})),Drawer:(0,i.lazy)((function(){return n.e(1153).then(n.bind(n,41153))})),Fab:(0,i.lazy)((function(){return n.e(7791).then(n.bind(n,37791))})),Fade:(0,i.lazy)((function(){return n.e(8789).then(n.bind(n,68789))})),FilledInput:(0,i.lazy)((function(){return n.e(3600).then(n.bind(n,53600))})),FormLabel:(0,i.lazy)((function(){return n.e(1174).then(n.bind(n,91174))})),FormControl:(0,i.lazy)((function(){return n.e(4311).then(n.bind(n,4311))})),FormControlLabel:(0,i.lazy)((function(){return n.e(508).then(n.bind(n,70508))})),FormHelperText:(0,i.lazy)((function(){return n.e(4099).then(n.bind(n,44099))})),FormGroup:(0,i.lazy)((function(){return n.e(7440).then(n.bind(n,27440))})),Grid:(0,i.lazy)((function(){return n.e(3346).then(n.bind(n,3346))})),Grow:(0,i.lazy)((function(){return n.e(2792).then(n.bind(n,92792))})),Icon:(0,i.lazy)((function(){return n.e(2235).then(n.bind(n,12235))})),IconButton:(0,i.lazy)((function(){return n.e(7551).then(n.bind(n,67551))})),Input:(0,i.lazy)((function(){return n.e(6369).then(n.bind(n,76369))})),InputBase:(0,i.lazy)((function(){return n.e(264).then(n.bind(n,80264))})),InputLabel:(0,i.lazy)((function(){return n.e(4476).then(n.bind(n,4476))})),InputAdornment:(0,i.lazy)((function(){return n.e(8630).then(n.bind(n,38630))})),Link:(0,i.lazy)((function(){return n.e(9087).then(n.bind(n,39087))})),LinearProgress:(0,i.lazy)((function(){return n.e(542).then(n.bind(n,10542))})),List:(0,i.lazy)((function(){return n.e(6734).then(n.bind(n,6734))})),ListItem:(0,i.lazy)((function(){return Promise.all([n.e(8581),n.e(7219)]).then(n.bind(n,57219))})),ListItemAvatar:(0,i.lazy)((function(){return n.e(9144).then(n.bind(n,59144))})),ListItemSecondaryAction:(0,i.lazy)((function(){return n.e(2868).then(n.bind(n,62868))})),ListItemIcon:(0,i.lazy)((function(){return n.e(4243).then(n.bind(n,64243))})),ListSubheader:(0,i.lazy)((function(){return n.e(2970).then(n.bind(n,2970))})),ListItemText:(0,i.lazy)((function(){return n.e(2835).then(n.bind(n,62835))})),Menu:(0,i.lazy)((function(){return Promise.resolve().then(n.bind(n,80730))})),MenuItem:(0,i.lazy)((function(){return n.e(444).then(n.bind(n,40444))})),MenuList:(0,i.lazy)((function(){return n.e(5819).then(n.bind(n,85819))})),Modal:(0,i.lazy)((function(){return n.e(4076).then(n.bind(n,54076))})),NativeSelect:(0,i.lazy)((function(){return n.e(4329).then(n.bind(n,44329))})),OutlinedInput:(0,i.lazy)((function(){return n.e(4390).then(n.bind(n,4390))})),Pagination:(0,i.lazy)((function(){return n.e(140).then(n.bind(n,70140))})),PaginationItem:(0,i.lazy)((function(){return n.e(6776).then(n.bind(n,56776))})),Paper:(0,i.lazy)((function(){return n.e(7798).then(n.bind(n,67798))})),Popover:(0,i.lazy)((function(){return n.e(1784).then(n.bind(n,41784))})),Popper:(0,i.lazy)((function(){return n.e(286).then(n.bind(n,286))})),Portal:(0,i.lazy)((function(){return n.e(2158).then(n.bind(n,42158))})),Radio:(0,i.lazy)((function(){return n.e(7255).then(n.bind(n,77255))})),RadioGroup:(0,i.lazy)((function(){return n.e(4460).then(n.bind(n,24460))})),Rating:(0,i.lazy)((function(){return n.e(9226).then(n.bind(n,59226))})),ScopedCssBaseline:(0,i.lazy)((function(){return n.e(3596).then(n.bind(n,93596))})),Select:(0,i.lazy)((function(){return n.e(7425).then(n.bind(n,7425))})),Skeleton:(0,i.lazy)((function(){return n.e(9742).then(n.bind(n,49742))})),Slider:(0,i.lazy)((function(){return n.e(2110).then(n.bind(n,72110))})),Snackbar:(0,i.lazy)((function(){return n.e(6235).then(n.bind(n,26235))})),SnackbarContent:(0,i.lazy)((function(){return n.e(601).then(n.bind(n,90601))})),SpeedDial:(0,i.lazy)((function(){return n.e(6616).then(n.bind(n,36616))})),SpeedDialAction:(0,i.lazy)((function(){return n.e(6294).then(n.bind(n,56294))})),SpeedDialIcon:(0,i.lazy)((function(){return n.e(2299).then(n.bind(n,12299))})),Stack:(0,i.lazy)((function(){return n.e(4360).then(n.bind(n,74360))})),Step:(0,i.lazy)((function(){return n.e(9697).then(n.bind(n,69697))})),StepButton:(0,i.lazy)((function(){return n.e(1132).then(n.bind(n,51132))})),StepConnector:(0,i.lazy)((function(){return n.e(3869).then(n.bind(n,63869))})),StepLabel:(0,i.lazy)((function(){return n.e(8685).then(n.bind(n,58685))})),StepIcon:(0,i.lazy)((function(){return n.e(674).then(n.bind(n,90674))})),Stepper:(0,i.lazy)((function(){return n.e(9739).then(n.bind(n,49739))})),SvgIcon:(0,i.lazy)((function(){return n.e(1021).then(n.bind(n,91021))})),Switch:(0,i.lazy)((function(){return n.e(2996).then(n.bind(n,92996))})),Tab:(0,i.lazy)((function(){return n.e(588).then(n.bind(n,90588))})),Table:(0,i.lazy)((function(){return n.e(551).then(n.bind(n,551))})),TableBody:(0,i.lazy)((function(){return n.e(829).then(n.bind(n,30829))})),TableCell:(0,i.lazy)((function(){return n.e(4642).then(n.bind(n,24642))})),TableContainer:(0,i.lazy)((function(){return n.e(742).then(n.bind(n,90742))})),TableFooter:(0,i.lazy)((function(){return n.e(4217).then(n.bind(n,64217))})),TableHead:(0,i.lazy)((function(){return n.e(5185).then(n.bind(n,95185))})),TablePagination:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(5547)]).then(n.bind(n,35547))})),TableRow:(0,i.lazy)((function(){return n.e(4463).then(n.bind(n,44463))})),TableSortLabel:(0,i.lazy)((function(){return n.e(4267).then(n.bind(n,74267))})),Tabs:(0,i.lazy)((function(){return n.e(8838).then(n.bind(n,48838))})),TextField:(0,i.lazy)((function(){return n.e(4161).then(n.bind(n,4161))})),TextareaAutosize:(0,i.lazy)((function(){return n.e(362).then(n.bind(n,10362))})),ToggleButton:(0,i.lazy)((function(){return n.e(8206).then(n.bind(n,8206))})),ToggleButtonGroup:(0,i.lazy)((function(){return n.e(2800).then(n.bind(n,72800))})),Toolbar:(0,i.lazy)((function(){return n.e(5537).then(n.bind(n,85537))})),Tooltip:(0,i.lazy)((function(){return n.e(5600).then(n.bind(n,95600))})),Typography:(0,i.lazy)((function(){return n.e(1463).then(n.bind(n,11463))}))},X=Object.fromEntries(Object.entries(J).map((function(e){var t=(0,a.Z)(e,2),n=t[0],o=t[1];return[n,function(e){return(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)("div",{}),children:(0,_.jsx)(o,(0,r.Z)({},e))})}]}))),Y=Object.fromEntries(Object.entries(X).map((function(e){var t=(0,a.Z)(e,2);return["@material-ui/core/"+t[0],t[1]]}))),Q=Object.fromEntries(Object.entries(X).map((function(e){var t=(0,a.Z)(e,2);return["@mui/material/"+t[0],t[1]]}))),K=(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(2209)]).then(n.bind(n,98907))})),$=(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(6921)]).then(n.bind(n,5781))})),ee=(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(8990)]).then(n.bind(n,29051))})),te={DataGrid:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.DataGrid}}))})),GridActionsCellItem:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridActionsCellItem}}))})),GridAddIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridAddIcon}}))})),GridArrowDownwardIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridArrowDownwardIcon}}))})),GridArrowUpwardIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridArrowUpwardIcon}}))})),GridAutoSizer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridAutoSizer}}))})),GridCellCheckboxForwardRef:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridCellCheckboxForwardRef}}))})),GridCellCheckboxRenderer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridCellCheckboxRenderer}}))})),GridCheckCircleIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridCheckCircleIcon}}))})),GridCheckIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridCheckIcon}}))})),GridCloseIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridCloseIcon}}))})),GridColumnHeaderSeparator:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridColumnHeaderSeparator}}))})),GridColumnHeaderSortIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridColumnHeaderSortIcon}}))})),GridColumnIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridColumnIcon}}))})),GridColumnMenu:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridColumnMenu}}))})),GridColumnMenuContainer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridColumnMenuContainer}}))})),GridDragIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridDragIcon}}))})),GridExpandMoreIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridExpandMoreIcon}}))})),GridFilterAltIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFilterAltIcon}}))})),GridFilterForm:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFilterForm}}))})),GridFilterListIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFilterListIcon}}))})),GridFilterPanel:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFilterPanel}}))})),GridFooter:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFooter}}))})),GridFooterContainer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridFooterContainer}}))})),GridHeader:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridHeader}}))})),GridHeaderCheckbox:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridHeaderCheckbox}}))})),GridKeyboardArrowRight:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridKeyboardArrowRight}}))})),GridLoadIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridLoadIcon}}))})),GridLoadingOverlay:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridLoadingOverlay}}))})),GridMenuIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridMenuIcon}}))})),GridMoreVertIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridMoreVertIcon}}))})),GridNoRowsOverlay:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridNoRowsOverlay}}))})),GridOverlay:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridOverlay}}))})),GridPagination:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridPagination}}))})),GridPanel:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridPanel}}))})),GridPanelWrapper:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridPanelWrapper}}))})),GridPreferencesPanel:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridPreferencesPanel}}))})),GridRemoveIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridRemoveIcon}}))})),GridRoot:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridRoot}}))})),GridRowCount:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridRowCount}}))})),GridSaveAltIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridSaveAltIcon}}))})),GridScrollArea:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridScrollArea}}))})),GridSearchIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridSearchIcon}}))})),GridSelectedRowCount:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridSelectedRowCount}}))})),GridSeparatorIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridSeparatorIcon}}))})),GridTableRowsIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridTableRowsIcon}}))})),GridToolbar:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbar}}))})),GridToolbarColumnsButton:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarColumnsButton}}))})),GridToolbarContainer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarContainer}}))})),GridToolbarDensitySelector:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarDensitySelector}}))})),GridToolbarExport:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarExport}}))})),GridToolbarExportContainer:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarExportContainer}}))})),GridToolbarFilterButton:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridToolbarFilterButton}}))})),GridTripleDotsVerticalIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridTripleDotsVerticalIcon}}))})),GridViewHeadlineIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridViewHeadlineIcon}}))})),GridViewStreamIcon:(0,i.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(7825)]).then(n.bind(n,37825)).then((function(e){return{default:e.GridViewStreamIcon}}))}))},ne=Object.fromEntries(Object.entries(te).map((function(e){var t=(0,a.Z)(e,2),n=t[0],o=t[1];return[n,function(e){return(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)("div",{}),children:(0,_.jsx)(o,(0,r.Z)({},e))})}]}))),re=(0,r.Z)((0,r.Z)((0,r.Z)({mobx:c,"mobx-state-tree":u,react:i,"react-dom":s,"mobx-react":l,"@mui/x-data-grid":(0,r.Z)({useGridApiContext:y.l,useGridApiRef:b.A,useGridRootProps:x.B},ne),"@mui/material/utils":m,"@material-ui/core/utils":m,"tss-react/mui":{makeStyles:d.ZL},"@material-ui/core":(0,r.Z)((0,r.Z)({},X),{},{useTheme:v.Z,alpha:h.Fq,makeStyles:function(e){var t=(0,d.ZL)()(e);return function(){return t().classes}}}),"@mui/material":X,"prop-types":p(),"@mui/material/styles":g,"@material-ui/core/styles":g},Y),Q),{},{"@material-ui/lab/ToggleButton":J.ToggleButton,"@material-ui/lab/ToggleButtonGroup":J.ToggleButtonGroup,"@material-ui/lab/Autocomplete":J.Autocomplete,"@material-ui/lab/Alert":J.Alert,"@material-ui/lab":{Alert:J.Alert,Autocomplete:J.Autocomplete,ToggleButton:J.ToggleButton,ToggleButtonGroup:J.ToggleButtonGroup},"@jbrowse/core/Plugin":B.Z,"@jbrowse/core/pluggableElementTypes":C,"@jbrowse/core/pluggableElementTypes/ViewType":Z.Z,"@jbrowse/core/pluggableElementTypes/AdapterType":S.Z,"@jbrowse/core/pluggableElementTypes/DisplayType":T.Z,"@jbrowse/core/pluggableElementTypes/TrackType":M.Z,"@jbrowse/core/pluggableElementTypes/WidgetType":P.Z,"@jbrowse/core/pluggableElementTypes/models":R,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":A,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":L.Z,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":N,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":j,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":F,"@jbrowse/core/configuration":I,"@jbrowse/core/util/types/mst":q,"@jbrowse/core/ui":D,"@jbrowse/core/util":E,"@jbrowse/core/util/color":V,"@jbrowse/core/util/layouts":z,"@jbrowse/core/util/tracks":O,"@jbrowse/core/util/Base1DViewModel":k.Z,"@jbrowse/core/util/io":W,"@jbrowse/core/util/mst-reflection":H,"@jbrowse/core/util/rxjs":G,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":{Attributes:function(e){return(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)("div",{}),children:(0,_.jsx)(K,(0,r.Z)({},e))})},FeatureDetails:function(e){return(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)("div",{}),children:(0,_.jsx)($,(0,r.Z)({},e))})},BaseCard:function(e){return(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)("div",{}),children:(0,_.jsx)(ee,(0,r.Z)({},e))})}},"@jbrowse/core/data_adapters/BaseAdapter":w}),ae=Array.from(Object.keys(re)),ie=ae.filter((function(e){return!U.includes(e)}));if(ie.length)throw new Error("The following modules are in the re-exports list, but not the modules libs: ".concat(ie.join(", ")));var oe=U.filter((function(e){return!ae.includes(e)}));if(oe.length)throw new Error("The following modules are in the modules libs, but not the re-exports list: ".concat(oe.join(", ")));var se=re},17168:function(e,t,n){"use strict";n.d(t,{R:function(){return c},Z:function(){return s}});var r=n(45754),a=n(13820),i=n(9249),o=n(87371),s=function(){function e(t){(0,i.Z)(this,e),this.label=void 0,this.renderingComponent=void 0,this.displayString=void 0,this.matchedAttribute=void 0,this.matchedObject=void 0,this.textSearchAdapter=void 0,this.relevance=void 0,this.trackId=void 0,this.score=void 0,this.locString=void 0,this.results=void 0,this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1,this.results=t.results||[]}return(0,o.Z)(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"hasLocation",value:function(){return!!this.locString}},{key:"getLocation",value:function(){return this.locString}},{key:"getComboResults",value:function(){return this.results}}]),e}(),c=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r,a;return(0,i.Z)(this,n),(a=t.call(this,e)).refName=void 0,a.refName=null!==(r=e.refName)&&void 0!==r?r:"",a}return(0,o.Z)(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(s)},9159:function(e,t,n){"use strict";n.d(t,{B:function(){return x},c:function(){return b}});var r=n(56666),a=n(96234),i=n(33028),o=n(63680),s=n(42328),c=n(56921),u=n(97531);var l={stringArray:o.types.array(o.types.string),stringArrayMap:o.types.map(o.types.array(o.types.string)),numberMap:o.types.map(o.types.number),boolean:o.types.boolean,color:o.types.refinement("Color",o.types.string,(function(){return!0})),integer:o.types.integer,number:o.types.number,string:o.types.string,text:o.types.string,fileLocation:s.FileLocation,frozen:o.types.frozen()},d={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},f=function(e){return{views:{get valueJSON(){return e.value}}}},p=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},h={fileLocation:p,number:f,integer:f,boolean:f,frozen:p,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,n){e.value[t]=n}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)},addToKey:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.push(n)},removeAtKeyIndex:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.splice(n,1)},setAtKeyIndex:function(t,n,r){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[n]=r}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)}}}}},g=o.types.refinement("JexlString",o.types.string,(function(e){return e.startsWith("jexl:")}));var m=n(29558);function v(e){return Array.isArray(e)&&0===e.length}function y(e,t,n){var f,p={};if(n.explicitlyTyped&&(p.type=o.types.optional(o.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(p[n.explicitIdentifier]=o.types.identifier,f=n.explicitIdentifier):(p.id=o.types.identifier,f="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(p[n.implicitIdentifier]=s.ElementId,f=n.implicitIdentifier):(p.id=s.ElementId,f="id"));var y={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((function(t){var n=(0,a.Z)(t,2),r=n[0],i=n[1];if((0,o.isType)(i)&&(0,o.isLateType)(i)||(0,m.qN)(i))p[r]=i;else if("string"===typeof i||"number"===typeof i)y[r]=i;else{if("object"!==typeof i)throw new Error('invalid configuration schema definition, "'.concat(r,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!i.type)throw new Error("no type set for config slot ".concat(e,".").concat(r));try{p[r]=function(e,t){var n=t.description,r=void 0===n?"":n,a=t.model,i=t.type,s=t.defaultValue,f=t.contextVariable,p=void 0===f?[]:f;if(!i)throw new Error("type name required");if(a||(a=l[i]),!a)throw new Error('no builtin config slot type "'.concat(i,"\", and no 'model' param provided"));if(void 0===s)throw new Error("no 'defaultValue' provided");var m="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),v=o.types.model(m,{name:o.types.literal(e),description:o.types.literal(r),type:o.types.literal(i),value:o.types.optional(o.types.union(g,a),s)}).volatile((function(){return{contextVariable:p}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){if(e.isCallback){var t=(0,u.getEnv)(e).pluginManager;return t||"undefined"!==typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,c.P)(String(e.value),null===t||void 0===t?void 0:t.jexl)}return{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===typeof t&&t.name===e?t:{name:e,description:r,type:i,value:t}})).postProcessSnapshot((function(e){return"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(s)?e.value:void 0:e.value!==s?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=s},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(n){}if(e.value=s,e.isCallback){if(!(i in d))throw new Error("no fallbackDefault defined for type ".concat(i));e.value=d[i]}}}}}));h[i]&&(v=v.extend(h[i]));var y=o.types.optional(v,{name:e,type:i,description:r,value:s});return Object.defineProperty(y,"isJBrowseConfigurationSlot",{value:!0}),y}(r,i)}catch(s){throw new Error("invalid config slot definition for ".concat(e,".").concat(r,": ").concat(s))}}}));var b=o.types.model("".concat(e,"ConfigurationSchema"),p).actions((function(e){return{setSubschema:function(t,n){if(!(0,m.qN)(p[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var r=(0,o.isStateTreeNode)(n)?n:p[t].create(n);return e[t]=r,r}}}));Object.keys(y).length&&(b=b.volatile((function(){return y}))),n.actions&&(b=b.actions(n.actions)),n.views&&(b=b.views(n.views)),n.extend&&(b=b.extend(n.extend));var x=f?(0,r.Z)({},f,"placeholderId"):{},w=n.explicitlyTyped?(0,i.Z)({type:e},x):x,k=(0,o.getSnapshot)(b.create(w));return b=b.postProcessSnapshot((function(e){for(var t,n={},r=!0,i=0,o=Object.entries(e);i<o.length;i++){var s=(0,a.Z)(o[i],2),c=s[0],u=s[1];r&&("object"===typeof k[c]&&"object"===typeof u?JSON.stringify(k[c])!==JSON.stringify(u)&&(r=!1):k[c]!==u&&(r=!1)),void 0!==u&&void 0===y[c]&&("object"!==typeof(t=u)||Array.isArray(t)||null===t||0!==Object.keys(t).length)&&!v(u)&&(n[c]=u)}return r?{}:n})),n.preProcessSnapshot&&(b=b.preProcessSnapshot(n.preProcessSnapshot)),o.types.optional(b,w)}function b(e,t,n){var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var r=t,a=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(r=(0,i.Z)((0,i.Z)({},n.baseConfiguration.jbrowseSchemaDefinition),r),delete(a=(0,i.Z)((0,i.Z)({},n.baseConfiguration.jbrowseSchemaOptions||{}),n)).baseConfiguration),{schemaDefinition:r,options:a}}(e,t,n),a=r.schemaDefinition,o=r.options,s=y(e,a,o);return s.isJBrowseConfigurationSchema=!0,s.jbrowseSchemaDefinition=a,s.jbrowseSchemaOptions=o,s}function x(e){return o.types.union(o.types.reference(e),e)}},29558:function(e,t,n){"use strict";n.d(t,{G:function(){return c},Pb:function(){return u},bc:function(){return s},mu:function(){return f},pS:function(){return o},qN:function(){return l},yt:function(){return d}});var r=n(68079),a=n(63680),i=n(29151);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,a.getSnapshot)(e)));if("string"===typeof t){var r=e[t];if(!r&&(0,a.isStateTreeNode)(e)&&(0,a.isMapType)((0,a.getType)(e))&&(r=e.get(t)),!r)return;if(r.expr){var i=r.expr.evalSync(n);return(0,a.isStateTreeNode)(i)?JSON.parse(JSON.stringify((0,a.getSnapshot)(i))):i}return(0,a.isStateTreeNode)(r)?JSON.parse(JSON.stringify((0,a.getSnapshot)(r))):r}var s=t[0];if(t.length>1){var c=t.slice(1),u=e[s];return!u&&(0,a.isStateTreeNode)(e)&&(0,a.isMapType)((0,a.getType)(e))&&(u=e.get(s)),u?o(u,c,n):void 0}return o(e,s,n)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var r=e.configuration;if(d(r))return o(r,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function c(e){if((0,a.isType)(e)&&(e=(0,i.resolveLateType)(e),(0,a.isUnionType)(e))){var t=[];return(0,i.getUnionSubTypes)(e).forEach((function(e){var n=c(e=(0,i.resolveLateType)(e));n.length||(n=[(0,i.getDefaultValue)(e).type]);if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push.apply(t,(0,r.Z)(n))})),t}return[]}function u(e){if((0,a.isType)(e)){if((0,a.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,a.isLateType)(e))return!0}return!1}function l(e){return!!(0,a.isType)(e)&&(!!u(e)||((0,a.isUnionType)(e)?(0,i.getUnionSubTypes)(e).every((function(e){return l(e)||"undefined"===e.name})):!(!(0,a.isOptionalType)(e)||!l((0,i.getSubType)(e)))||(!(!(0,a.isArrayType)(e)||!l((0,i.getSubType)(e)))||!(!(0,a.isMapType)(e)||!l((0,i.getSubType)(e))))))}function d(e){return(0,a.isStateTreeNode)(e)&&l((0,a.getType)(e))}function f(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},82972:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseAdapter:function(){return w},BaseFeatureDataAdapter:function(){return k},BaseSequenceAdapter:function(){return C},isFeatureAdapter:function(){return T},isRefNameAliasAdapter:function(){return M},isRegionsAdapter:function(){return S},isSequenceAdapter:function(){return Z},isTextSearchAdapter:function(){return P}});var r=n(33028),a=n(68079),i=n(32723),o=n(34795),s=n(45754),c=n(13820),u=n(9249),l=n(87371),d=n(1576),f=n(56218),p=n(66043),h=n(63680),g=n(93824),m=n(97531),v=n(99836),y=n(74560),b=n(95155),x=(0,v.ConfigurationSchema)("empty",{}),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.create(),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if((0,u.Z)(this,e),this.config=t,this.getSubAdapter=n,this.pluginManager=r,this.id=void 0,"undefined"===typeof jest){var a=(0,h.isStateTreeNode)(t)?(0,h.getSnapshot)(t):t;this.id="".concat((0,b.Z)(a))}else this.id="test"}return(0,l.Z)(e,[{key:"getConf",value:function(e){return(0,v.readConfObject)(this.config,e)}}]),e}();w.capabilities=[];var k=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"getHeader",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeaturesInRegion",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.ObservableCreate)(function(){var r=(0,o.Z)((0,i.Z)().mark((function r(a){var o;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:o=r.sent,(0,m.checkAbortSignal)(n.signal),o?t.getFeatures(e,n).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.T.apply(void 0,(0,a.Z)(e.map((function(e){return t.getFeaturesInRegion(e,n)}))))}},{key:"hasDataForRefName",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,r,a=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:return r=e.sent,e.abrupt("return",r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegionStats",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getFeatures(t,n),e.abrupt("return",(0,y.fK)(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMultiRegionStats",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){var t,n,r,a,o,s,c,u,l,d=this,f=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1?f[1]:void 0,(t=f.length>0&&void 0!==f[0]?f[0]:[]).length){e.next=4;break}return e.abrupt("return",(0,y.fY)());case 4:return e.next=6,Promise.all(t.map((function(e){return d.getRegionStats(e,n)})));case 6:return r=e.sent,a=(0,m.max)(r.map((function(e){return e.scoreMax}))),o=(0,m.min)(r.map((function(e){return e.scoreMin}))),s=(0,m.sum)(r.map((function(e){return e.scoreSum}))),c=(0,m.sum)(r.map((function(e){return e.scoreSumSquares}))),u=(0,m.sum)(r.map((function(e){return e.featureCount}))),l=(0,m.sum)(r.map((function(e){return e.basesCovered}))),e.abrupt("return",(0,y.I9)({scoreMin:o,scoreMax:a,featureCount:u,basesCovered:l,scoreSumSquares:c,scoreSum:s}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"estimateRegionsStats",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var a,s,c,u,l=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}throw new Error("No regions to estimate stats for");case 2:return a=t[0],s=+Date.now(),c=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,o){var s,c,d,h,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.start,c=a.end,d=.75*s+.25*c,h=(0,r.Z)((0,r.Z)({},a),{},{start:Math.max(0,Math.round(d-t/2)),end:Math.min(Math.round(d+t/2),c)}),e.next=5,(0,f.z)(l.getFeatures(h,n).pipe((0,p.q)()));case 5:return g=e.sent,e.abrupt("return",u(t,{featureDensity:g.length/t},g.length,o));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n,r,o){var u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=a.end-a.start,!(r>=70||2*t>u)){e.next=5;break}return e.abrupt("return",n);case 5:if(!(o<=5e3)){e.next=12;break}return l=+Date.now(),o+=l-s,s=l,e.abrupt("return",c(2*t,o));case 12:return console.warn("Stats estimation reached timeout, or didn't get enough features"),e.abrupt("return",{featureDensity:1/0});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),e.abrupt("return",c(1e3,0));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(w),C=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"estimateRegionsStats",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{featureDensity:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(k);function Z(e){return"getRegions"in e&&"getFeatures"in e}function S(e){return"getRegions"in e}function T(e){return"getFeatures"in e}function M(e){return"getRefNameAliases"in e}function P(e){return"searchIndex"in e}},75019:function(e,t,n){"use strict";n.d(t,{Yr:function(){return d},uP:function(){return u}});var r=n(32723),a=n(96234),i=n(34795),o=n(95155);function s(e){return"".concat((0,o.Z)(e))}var c={};function u(e,t,n){return l.apply(this,arguments)}function l(){return(l=(0,i.Z)((0,r.Z)().mark((function e(t,n,a){var i,o,l,d,f,p,h,g,m,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s(a),c[i]){e.next=21;break}if(o=(a||{}).type){e.next=5;break}throw new Error("could not determine adapter type from adapter config snapshot");case 5:if(l=t.getAdapterType(o)){e.next=8;break}throw new Error("unknown data adapter type ".concat(o));case 8:if(d=l.configSchema.create(a,{pluginManager:t}),f=u.bind(null,t,n),p=l.AdapterClass,h=l.getAdapterClass,e.t0=p,e.t0){e.next=16;break}return e.next=15,h();case 15:e.t0=e.sent;case 16:if(g=e.t0){e.next=19;break}throw new Error("Failed to get adapter");case 19:m=new g(d,f,t),c[i]={dataAdapter:m,sessionIds:new Set([n])};case 21:return(v=c[i]).sessionIds.add(n),e.abrupt("return",v);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){var t=0,n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){var r=e.sessionId;Object.entries(c).forEach((function(e){var n=(0,a.Z)(e,2),i=n[0],o=n[1];o.sessionIds.delete(r),0===o.sessionIds.size&&(t+=1,delete c[i])}))}else Object.values(c).forEach((function(t){t.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach((function(e){void 0!==e.refName&&t.dataAdapter.freeResources(e)})):console.warn(t.dataAdapter,"does not implement freeResources")}));return t}},5868:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(32723),a=n(34795),i=n(87371),o=n(9249),s=n(45754),c=n(13820),u=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;if((0,o.Z)(this,n),(i=t.call(this,e)).AdapterClass=void 0,i.getAdapterClass=void 0,i.configSchema=void 0,i.adapterCapabilities=void 0,i.adapterMetadata=void 0,"AdapterClass"in e)i.AdapterClass=e.AdapterClass,i.getAdapterClass=(0,a.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.AdapterClass);case 1:case"end":return t.stop()}}),t)})));else{if(!("getAdapterClass"in e))throw new Error("no AdapterClass or getAdapterClass is defined for adapter type ".concat(i.name));i.getAdapterClass=e.getAdapterClass}return i.configSchema=e.configSchema,i.adapterCapabilities=e.adapterCapabilities||[],i.adapterMetadata=e.adapterMetadata,i}return(0,i.Z)(n)}(n(43933).Z)},6769:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.stateModel=void 0,r.ReactComponent=e.ReactComponent,r.stateModel=e.stateModel,!r.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for view ".concat(r.name));return r}return(0,r.Z)(n)}(n(43933).Z)},73561:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.description=void 0,r.url=void 0,r.configEditorComponent=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.description=e.description,r.url=e.url,r.configEditorComponent=e.configEditorComponent,!r.stateModel)throw new Error("no stateModel defined for connection ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema defined for connection ".concat(r.name));return r}return(0,r.Z)(n)}(n(43933).Z)},95984:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=n(43933),c=n(29151),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.ReactComponent=void 0,r.trackType=void 0,r.subDisplay=void 0,r.viewType=void 0,r.stateModel=e.stateModel,r.subDisplay=e.subDisplay,r.configSchema=e.configSchema,r.ReactComponent=e.ReactComponent,r.trackType=e.trackType,r.viewType=e.viewType,!r.stateModel)throw new Error("no stateModel defined for display ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for display ".concat(r.name));if(!r.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(r.name));if(!r.trackType)throw new Error("no trackType provided for display ".concat(r.name));if(!r.viewType)throw new Error("no viewType provided for display ".concat(r.name));if(!(0,c.getDefaultValue)(r.configSchema).type){var i=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return r}return(0,r.Z)(n)}(s.Z)},7857:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=n(43933),c=n(29151),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,!r.stateModel)throw new Error("no stateModel defined for internet account type ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for internet account type ".concat(r.name));if(!(0,c.getDefaultValue)(r.configSchema).type){var i=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return r}return(0,r.Z)(n)}(s.Z)},43933:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9249),a=n(87371),i=function(){function e(t){(0,r.Z)(this,e),this.name="",this.maybeDisplayName=void 0,this.name=t.name,this.maybeDisplayName=t.displayName}return(0,a.Z)(e,[{key:"displayName",get:function(){return this.maybeDisplayName||this.name}}]),e}()},42273:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(41361),a=n(32723),i=n(33028),o=n(34795),s=n(9249),c=n(87371),u=n(45754),l=n(13820),d=n(43933),f=n(16151),p=n(63680),h=n(73),g=n(95439),m=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,{name:""})).pluginManager=e,r.name="UNKNOWN",r}return(0,c.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,f.getBlobMap)(),e.next=3,this.augmentLocationObjects(t);case 3:return e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{blobMap:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeNewAuthArguments",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.pluginManager.rootModel,(0,h.dc)(n)&&!t.internetAccountPreAuthorization){e.next=3;break}return e.abrupt("return",t);case 3:if(!(r=null===n||void 0===n?void 0:n.findAppropriateInternetAccount(t))){e.next=8;break}return e.next=7,r.getPreAuthorizationInformation(t);case 7:t.internetAccountPreAuthorization=e.sent;case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deserializeArguments",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.blobMap&&(0,f.setBlobMap)(t.blobMap),!(r=t.signal)||!(0,g.k$)(r)){e.next=4;break}return e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{signal:(0,g.ie)(r)}));case 4:return e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{signal:void 0}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeReturn",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.pluginManager.rootModel,e.prev=1,e.next=4,t;case 4:i=e.sent,e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(1),!(0,h.PK)(e.t0)){e.next=12;break}throw s=null===o||void 0===o?void 0:o.createEphemeralInternetAccount("HTTPBasicInternetAccount-".concat(new URL(e.t0.url).origin),{},e.t0.url),new h.Ms("Retrying with created internet account",s.internetAccountId);case 12:throw e.t0;case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"augmentLocationObjects",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,i,o,s,c,u,l,d,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,p.isStateTreeNode)(t)||(0,p.isAlive)(t)){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,h.hb)(t)){e.next=5;break}return e.next=5,this.serializeNewAuthArguments(t);case 5:if(!Array.isArray(t)){e.next=23;break}n=(0,r.Z)(t),e.prev=7,n.s();case 9:if((i=n.n()).done){e.next=15;break}return o=i.value,e.next=13,this.augmentLocationObjects(o);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:if("object"!==typeof t||null===t){e.next=53;break}s=0,c=Object.values(t);case 25:if(!(s<c.length)){e.next=53;break}if(u=c[s],!Array.isArray(u)){e.next=47;break}l=(0,r.Z)(u),e.prev=29,l.s();case 31:if((d=l.n()).done){e.next=37;break}return f=d.value,e.next=35,this.augmentLocationObjects(f);case 35:e.next=31;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(29),l.e(e.t1);case 42:return e.prev=42,l.f(),e.finish(42);case 45:e.next=50;break;case 47:if("object"!==typeof u||null===u){e.next=50;break}return e.next=50,this.augmentLocationObjects(u);case 50:s++,e.next=25;break;case 53:case"end":return e.stop()}}),e,this,[[7,17,20,23],[29,39,42,45]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(d.Z)},28204:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).AdapterClass=void 0,r.configSchema=void 0,r.description=void 0,r.description=e.description,r.configSchema=e.configSchema,r.AdapterClass=e.AdapterClass,!r.AdapterClass)throw new Error("no AdapterClass defined for adapter type ".concat(r.name));return r}return(0,r.Z)(n)}(n(43933).Z)},55385:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(43933),c=n(29151),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;if((0,r.Z)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.displayTypes=[],a.stateModel=e.stateModel,a.configSchema=e.configSchema,!a.stateModel)throw new Error("no stateModel defined for track ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema provided for track ".concat(a.name));if(!(0,c.getDefaultValue)(a.configSchema).type){var i=a.configSchema?a.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return a}return(0,a.Z)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(s.Z)},65317:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;if((0,r.Z)(this,n),(a=t.call(this,e)).ReactComponent=void 0,a.stateModel=void 0,a.displayTypes=[],a.extendedName=void 0,a.ReactComponent=e.ReactComponent,a.stateModel=e.stateModel,a.extendedName=e.extendedName,!a.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(a.name));if(!a.stateModel)throw new Error("no stateModel defined for view ".concat(a.name));return a}return(0,a.Z)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(n(43933).Z)},26347:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).heading=void 0,r.configSchema=void 0,r.HeadingComponent=void 0,r.ReactComponent=void 0,r.stateModel=void 0,r.heading=e.heading,r.HeadingComponent=e.HeadingComponent,r.configSchema=e.configSchema,r.stateModel=e.stateModel,r.ReactComponent=e.ReactComponent,!r.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for widget ".concat(r.name));return r}return(0,r.Z)(n)}(n(43933).Z)},91271:function(e,t,n){"use strict";n.r(t),n.d(t,{AdapterType:function(){return r.Z},AddTrackWorkflowType:function(){return p.Z},BaseConnectionModelFactory:function(){return x.BaseConnectionModelFactory},BaseDisplay:function(){return x.BaseDisplay},BaseInternetAccountConfig:function(){return x.BaseInternetAccountConfig},BaseViewModel:function(){return x.BaseViewModel},BoxRendererType:function(){return h.default},CircularChordRendererType:function(){return g.Z},ComparativeServerSideRendererType:function(){return m.Z},ConnectionType:function(){return a.Z},DisplayType:function(){return c.Z},FeatureRendererType:function(){return v.default},InternetAccount:function(){return x.InternetAccount},InternetAccountType:function(){return d.Z},RendererType:function(){return i.default},RpcMethodType:function(){return l.Z},ServerSideRenderedContent:function(){return y.Z},ServerSideRendererType:function(){return b.default},TextSearchAdapterType:function(){return f.Z},TrackType:function(){return s.Z},ViewType:function(){return u.Z},WidgetType:function(){return o.Z},baseConnectionConfig:function(){return x.baseConnectionConfig},createBaseTrackConfig:function(){return x.createBaseTrackConfig},createBaseTrackModel:function(){return x.createBaseTrackModel}});var r=n(5868),a=n(73561),i=n(57173),o=n(26347),s=n(55385),c=n(95984),u=n(65317),l=n(42273),d=n(7857),f=n(28204),p=n(6769),h=n(66568),g=n(73749),m=n(55373),v=n(13381),y=n(22616),b=n(62518),x=n(33991)},66705:function(e,t,n){"use strict";var r=n(63680),a=n(42328);var i=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string),minimized:!1}).volatile((function(){return{width:800}})).views((function(){return{menuItems:function(){return[]}}})).actions((function(e){return{setDisplayName:function(t){e.displayName=t},setWidth:function(t){e.width=t},setMinimized:function(t){e.minimized=t}}}));t.Z=i},33991:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseConnectionModelFactory:function(){return s},BaseDisplay:function(){return p},BaseInternetAccountConfig:function(){return b},BaseViewModel:function(){return c.Z},InternetAccount:function(){return y},baseConnectionConfig:function(){return a},createBaseTrackConfig:function(){return T},createBaseTrackModel:function(){return S}});var r=n(99836);var a=(0,r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"}),i=n(68079),o=n(63680);var s=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{afterAttach:function(){e.tracks.length||e.connect(e.configuration)},addTrackConf:function(t){var n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs:function(t){var n,r=(n=e.tracks).push.apply(n,(0,i.Z)(t));return e.tracks.slice(r-1-t.length,r-1)},setTrackConfs:function(t){return e.tracks=(0,o.cast)(t),e.tracks},clear:function(){}}}))},c=n(66705),u=n(33028),l=n(16151),d=n(97531),f=n(42328);var p=o.types.model("BaseDisplay",{id:f.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((function(){return{rendererTypeName:"",error:void 0}})).views((function(e){return{get RenderingComponent(){return(0,d.getEnv)(e).pluginManager.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,r.getConf)(this.parentTrack,"adapter")},get parentTrack(){for(var t=(0,o.getParent)(e);!t.configuration||!(0,r.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=(0,o.getParent)(t)}return t},renderProps:function(){return(0,u.Z)((0,u.Z)({},(0,l.getParentRenderProps)(e)),{},{notReady:(0,d.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e})},get rendererType(){var t=(0,d.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!t)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return t},get DisplayMessageComponent(){},trackMenuItems:function(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered:function(){}}})).actions((function(e){return{setError:function(t){e.error=t},setRpcDriverName:function(t){e.rpcDriverName=t},reload:function(){}}})),h=n(32723),g=n(34795),m=n(32145),v="undefined"===typeof sessionStorage;var y=o.types.model("InternetAccount",{id:f.ElementId,type:o.types.string}).views((function(e){return{get name(){return(0,r.getConf)(e,"name")},get description(){return(0,r.getConf)(e,"description")},get internetAccountId(){return(0,r.getConf)(e,"internetAccountId")},get authHeader(){return(0,r.getConf)(e,"authHeader")},get tokenType(){return(0,r.getConf)(e,"tokenType")},get domains(){return(0,r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}})).views((function(e){return{handlesLocation:function(t){return e.domains.some((function(e){return null===t||void 0===t?void 0:t.uri.includes(e)}))},get tokenKey(){return"".concat(e.internetAccountId,"-token")}}})).actions((function(e){return{getTokenFromUser:function(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken:function(t){sessionStorage.setItem(e.tokenKey,t)},removeToken:function(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:function(){return sessionStorage.getItem(e.tokenKey)},validateToken:function(e,t){return(0,g.Z)((0,h.Z)().mark((function t(){return(0,h.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)})))()}}})).actions((function(e){var t=void 0;return{getToken:function(n){return(0,g.Z)((0,h.Z)().mark((function r(){var a,i,o;return(0,h.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return",t);case 2:if(!(o=null===n||void 0===n||null===(a=n.internetAccountPreAuthorization)||void 0===a||null===(i=a.authInfo)||void 0===i?void 0:i.token)){r.next=6;break}return t=Promise.resolve(o),r.abrupt("return",t);case 6:if(!v){r.next=8;break}throw new Error("Did not get internet account pre-authorization info in worker");case 8:if(!(o=e.retrieveToken())){r.next=12;break}return t=Promise.resolve(o),r.abrupt("return",t);case 12:return t=new Promise((function(t,n){e.getTokenFromUser((function(n){e.storeToken(n),t(n)}),(function(t){e.removeToken(),n(t)}))})),r.abrupt("return",t);case 14:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){return{addAuthHeaderToInit:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=e.tokenType?"".concat(e.tokenType," ").concat(n):n,a=new Headers(t.headers||{});return a.append(e.authHeader,r),(0,u.Z)((0,u.Z)({},t),{},{headers:a})},getPreAuthorizationInformation:function(t){return(0,g.Z)((0,h.Z)().mark((function n(){var a,i;return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return a=n.sent,n.prev=3,n.next=6,e.validateToken(a,t);case 6:i=n.sent,n.next=13;break;case 9:throw n.prev=9,n.t0=n.catch(3),e.removeToken(),n.t0;case 13:return n.abrupt("return",{internetAccountType:e.type,authInfo:{token:i,configuration:(0,r.getConf)(e)}});case 14:case"end":return n.stop()}}),n,null,[[3,9]])})))()}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,g.Z)((0,h.Z)().mark((function n(r,a){var i,o;return(0,h.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return i=n.sent,o=e.addAuthHeaderToInit(a,i),n.abrupt("return",fetch(r,o));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}}})).actions((function(e){return{openLocation:function(t){return new m.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})}}}));var b=(0,r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0}),x=n(96902),w=n(75717),k=n(23642),C=n(73),Z=(0,x.lazy)((function(){return n.e(3175).then(n.bind(n,3175))}));function S(e,t,n){return o.types.model(t,{id:f.ElementId,type:o.types.literal(t),configuration:(0,r.ConfigurationReference)(n),minimized:!1,displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((function(t){return{get rpcSessionId(){return t.configuration.trackId},get name(){return(0,r.getConf)(t,"name")},get textSearchAdapter(){return(0,r.getConf)(t,"textSearchAdapter")},get adapterType(){var n=(0,r.getConf)(t,"adapter");if(!n)throw new Error("no adapter configuration provided for ".concat(t.type));var a=e.getAdapterType(n.type);if(!a)throw new Error("unknown adapter type ".concat(n.type));return a},get viewMenuActions(){return t.displays.map((function(e){return e.viewMenuActions})).flat()},get canConfigure(){var e=(0,d.getSession)(t);return(0,C.cX)(e)&&(e.adminMode||e.sessionTracks.find((function(e){return e.trackId===t.configuration.trackId})))}}})).actions((function(t){return{setMinimized:function(e){t.minimized=e},activateConfigurationUI:function(){var e=(0,d.getSession)(t),n=(0,d.getContainingView)(t);if((0,C.cX)(e)){var r=e.editTrackConfiguration(t.configuration);r&&r!==t.configuration&&(n.hideTrack(t.configuration),n.showTrack(r))}},showDisplay:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(a,(0,o.getRoot)(t),n),s=e.getDisplayType(i.type);if(!s)throw new Error("unknown display type ".concat(i.type));var c=s.stateModel.create((0,u.Z)((0,u.Z)({},r),{},{type:i.type,configuration:i}));t.displays.push(c)},hideDisplay:function(n){var r=e.pluggableConfigSchemaType("display"),a=(0,o.resolveIdentifier)(r,(0,o.getRoot)(t),n),i=t.displays.filter((function(e){return e.configuration===a}));return(0,w.transaction)((function(){return i.forEach((function(e){return t.displays.remove(e)}))})),i.length},replaceDisplay:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.displays.findIndex((function(e){return e.configuration.displayId===n}));if(-1===i)throw new Error("could not find display id ".concat(n," to replace"));var s=e.pluggableConfigSchemaType("display"),c=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),r);if(!e.getDisplayType(c.type))throw new Error("unknown display type ".concat(c.type));t.displays.splice(i,1,(0,u.Z)((0,u.Z)({},a),{},{type:c.type,configuration:c}))}}})).views((function(t){return{trackMenuItems:function(){var n=t.displays.map((function(e){return e.trackMenuItems()})).flat(),r=t.displays[0].configuration.displayId,a=function(e){var t=(0,d.getEnv)(e).pluginManager,n=(0,d.getContainingView)(e),r=t.getViewType(n.type).displayTypes.map((function(e){return e.name}));return e.configuration.displays.filter((function(e){return r.includes(e.type)}))}(t);return[].concat((0,i.Z)(n),[{label:"Save track data",icon:k.vc,onClick:function(){(0,d.getSession)(t).queueDialog((function(e){return[Z,{model:t,handleClose:e}]}))}}],(0,i.Z)(a.length>1?[{type:"subMenu",label:"Display types",subMenu:a.map((function(n){return{type:"radio",label:e.getDisplayType(n.type).displayName,checked:n.displayId===r,onClick:function(){return t.replaceDisplay(r,n.displayId)}}}))}]:[]))}}}))}function T(e){return(0,r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,r.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"}}),formatAbout:(0,r.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,i=void 0===a?[]:a;"placeholderId"!==n.trackId&&(i.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||i.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return(0,u.Z)((0,u.Z)({},n),{},{displays:i})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}},66568:function(e,t,n){"use strict";n.r(t),n.d(t,{LayoutSession:function(){return w},default:function(){return k}});var r=n(96234),a=n(32723),i=n(34795),o=n(33028),s=n(93069),c=n(95058),u=n(45754),l=n(13820),d=n(9249),f=n(87371),p=n(16001),h=n.n(p),g=n(12052),m=n(84613),v=n(43929),y=n(13381),b=n(97531),x=n(99836),w=function(){function e(t){(0,d.Z)(this,e),this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=t.config,this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}return(0,f.Z)(e,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"makeLayout",value:function(){return new m.Z(g.Z,{maxHeight:(0,x.readConfObject)(this.config,"maxHeight"),displayMode:(0,x.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,x.readConfObject)(this.config,"noSpacing")?1:3})}},{key:"cachedLayoutIsValid",value:function(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&h()((0,x.readConfObject)(this.config),e.config)&&h()(this.filters,e.filters)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,x.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}]),e}(),k=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;(0,d.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sessions={},e}return(0,f.Z)(n,[{key:"getWorkerSession",value:function(e){var t=(0,b.getLayoutId)(e);this.sessions[t]||(this.sessions[t]=this.createSession(e));var n=this.sessions[t];return n.update(e),n}},{key:"getExpandedRegion",value:function(e,t){if(!e)return e;var n=t.bpPerPx,r=t.config,a=void 0===r?0:(0,x.readConfObject)(r,"maxFeatureGlyphExpansion");if(!a)return e;var i=Math.round(a*n);return(0,o.Z)((0,o.Z)({},e),{},{start:Math.floor(Math.max(e.start-i,0)),end:Math.ceil(e.end+i)})}},{key:"createSession",value:function(e){return new w(e)}},{key:"freeResourcesInClient",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r){var i,o,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.regions,o=(0,b.getLayoutId)(r),u=0,l=this.sessions[o],!i&&l&&(delete this.sessions[o],u=1),l&&i&&l.layout.discardRange(i[0].refName,i[0].start,i[0].end),e.t0=u,e.next=9,(0,s.Z)((0,c.Z)(n.prototype),"freeResourcesInClient",this).call(this,t,r);case 9:return e.t1=e.sent,e.abrupt("return",e.t0+e.t1);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeLayoutInClient",value:function(e){return new v.Z(e)}},{key:"deserializeResultsInClient",value:function(e,t){var r=this.deserializeLayoutInClient(e.layout);return(0,s.Z)((0,c.Z)(n.prototype),"deserializeResultsInClient",this).call(this,(0,o.Z)((0,o.Z)({},e),{},{layout:r}),t)}},{key:"createLayoutInWorker",value:function(e){var t=e.regions;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}},{key:"serializeResultsInWorker",value:function(e,t){var a=(0,s.Z)((0,c.Z)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),i=(0,r.Z)(t.regions,1)[0];return a.layout=e.layout.serializeRegion(this.getExpandedRegion(i,t)),a.layout.rectangles&&(a.features=a.features.filter((function(e){return Boolean(a.layout.rectangles[e.uniqueId])}))),a.maxHeightReached=a.layout.maxHeightReached,a}},{key:"render",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layout||this.createLayoutInWorker(t),e.next=3,(0,s.Z)((0,c.Z)(n.prototype),"render",this).call(this,(0,o.Z)((0,o.Z)({},t),{},{layout:r}));case 3:return i=e.sent,e.abrupt("return",(0,o.Z)((0,o.Z)({},i),{},{layout:r}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(y.default)},73749:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(33028),a=n(9249),i=n(87371),o=n(45754),s=n(13820),c=n(96902),u=n(43430),l=n(13381),d=n(4782),f=n(54370),p=n(97531),h=n(29938),g=(0,d.observer)((function(e){var t=e.html,n=e.RenderingComponent,a=(0,c.useRef)(null);return(0,c.useEffect)((function(){var i=a.current;return i&&t&&(i.innerHTML&&(0,f.unmountComponentAtNode)(i),i.style.outline="none",i.innerHTML=t,(0,p.rIC)((function(){(0,f.hydrate)((0,h.jsx)(n,(0,r.Z)({},e)),i)}))),function(){i&&(0,f.unmountComponentAtNode)(i)}}),[t,n,e]),(0,h.jsx)("g",{ref:a})})),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"deserializeResultsInClient",value:function(e,t){var n=new Map(e.features.map((function(e){return u.Z.fromJSON(e)})).map((function(e){return[e.id(),e]})));return t.exportSVG?(0,r.Z)((0,r.Z)({},e),{},{html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}):(0,r.Z)((0,r.Z)({},e),{},{reactElement:(0,h.jsx)(g,(0,r.Z)((0,r.Z)((0,r.Z)({},t),e),{},{features:n,RenderingComponent:this.ReactComponent}))})}}]),n}(l.default)},55373:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(33028),a=n(32723),i=n(34795),o=n(9249),s=n(87371),c=n(93069),u=n(95058),l=n(45754),d=n(13820),f=n(62801),p=n(66043),h=n(62518),g=n(75019),m=n(97531),v=n(56218),y=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArgsInClient",value:function(e){var t=(0,r.Z)((0,r.Z)({},e),{},{displayModel:{}});return(0,c.Z)((0,u.Z)(n.prototype),"serializeArgsInClient",this).call(this,t)}},{key:"deserializeResultsInClient",value:function(e,t){var a=(0,c.Z)((0,u.Z)(n.prototype),"deserializeResultsInClient",this).call(this,e,t);return(0,r.Z)((0,r.Z)({},a),{},{blockKey:t.blockKey})}},{key:"renderInClient",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"ComparativeRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"getFeatures",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,i,o,s,c,u,l,d,h=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.pluginManager,i=t.sessionId,o=t.adapterConfig,e.next=4,(0,g.uP)(n,i,o);case 4:if(s=e.sent,c=s.dataAdapter,u=[],(u=t.regions)&&0!==u.length){e.next=11;break}return console.warn("no regions supplied to comparative renderer"),e.abrupt("return",[]);case 11:return l=u.map((function(e){var t=(0,r.Z)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),e.next=14,(0,v.z)(c.getFeaturesInMultipleRegions(l,t).pipe((0,f.h)((function(e){return h.featurePassesFilters(t,e)})),(0,p.q)()));case 14:return d=e.sent,e.abrupt("return",(0,m.dedupe)(d,(function(e){return e.id()})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(h.default)},13381:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(32723),a=n(34795),i=n(33028),o=n(9249),s=n(87371),c=n(93069),u=n(95058),l=n(45754),d=n(13820),f=n(66043),p=n(73636),h=n.n(p),g=n(56218),m=n(97531),v=n(43430),y=n(75019),b=n(62518),x=n(82972),w=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"serializeArgsInClient",value:function(e){var t=e.displayModel,r=e.regions,a=(0,i.Z)((0,i.Z)({},e),{},{displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:h()(r)});return(0,c.Z)((0,u.Z)(n.prototype),"serializeArgsInClient",this).call(this,a)}},{key:"deserializeResultsInClient",value:function(e,t){var r=new Map(e.features.map((function(e){return v.Z.fromJSON(e)})).map((function(e){return[e.id(),e]}))),a=(0,c.Z)((0,u.Z)(n.prototype),"deserializeResultsInClient",this).call(this,(0,i.Z)((0,i.Z)({},e),{},{features:r}),t);return(0,i.Z)((0,i.Z)({},a),{},{blockKey:t.blockKey,features:r})}},{key:"serializeResultsInWorker",value:function(e,t){var r=(0,c.Z)((0,u.Z)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),a=e.features;return(0,i.Z)((0,i.Z)({},r),{},{features:(0,m.iterMap)(a.values(),(function(e){return e.toJSON()}),a.size)})}},{key:"getExpandedRegion",value:function(e,t){return e}},{key:"getFeatures",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,s,c,u,l,d,p,h,v,b,w=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.pluginManager,a=t.signal,o=t.regions,s=t.sessionId,c=t.adapterConfig,e.next=4,(0,y.uP)(n,s,c);case 4:if(u=e.sent,l=u.dataAdapter,(0,x.isFeatureAdapter)(l)){e.next=8;break}throw new Error("Adapter does not support retrieving features");case 8:if(d=new Map,o&&0!==o.length){e.next=11;break}return e.abrupt("return",d);case 11:return p=o.map((function(e){var t=(0,i.Z)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),h=p[0],v=1===p.length?l.getFeatures(this.getExpandedRegion(h,t),t):l.getFeaturesInMultipleRegions(p,t),e.next=16,(0,g.z)(v.pipe((0,f.q)()));case 16:return b=e.sent,(0,m.checkAbortSignal)(a),e.abrupt("return",new Map(b.filter((function(e){return w.featurePassesFilters(t,e)})).map((function(e){return[e.id(),e]}))));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"render",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.features,e.t0){e.next=5;break}return e.next=4,this.getFeatures(t);case 4:e.t0=e.sent;case 5:return a=e.t0,e.next=8,(0,c.Z)((0,u.Z)(n.prototype),"render",this).call(this,(0,i.Z)((0,i.Z)({},t),{},{features:a}));case 8:return o=e.sent,e.abrupt("return",(0,i.Z)((0,i.Z)({},o),{},{features:a}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(b.default)},57173:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(32723),a=n(34795),i=n(9249),o=n(87371),s=n(45754),c=n(13820),u=n(96902),l=n(29151),d=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;if((0,i.Z)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.supportsSVG=!1,r.configSchema=void 0,r.pluginManager=void 0,r.ReactComponent=e.ReactComponent,r.configSchema=e.configSchema,r.pluginManager=e.pluginManager,!r.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(r.name));if(!(0,l.getDefaultValue)(r.configSchema).type)throw new Error("".concat(r.name," config schema ").concat(r.configSchema.name," is not explicitlyTyped"));if(!r.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(r.name));return r}return(0,o.Z)(n,[{key:"render",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{reactElement:u.createElement(this.ReactComponent,t,null)});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){return 0}}]),n}(n(43933).Z)},22616:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(33028),a=n(59740),i=n(96902),o=n(68094),s=n(54370),c=n(46186),u=n(97531),l=n(29938),d=["theme","html","RenderingComponent"];function f(e){var t=e.theme,n=e.html,f=e.RenderingComponent,p=(0,a.Z)(e,d),h=(0,i.useRef)(null),g=(0,c.createJBrowseTheme)(t);return(0,i.useEffect)((function(){var e=h.current;return e&&(e&&(0,s.unmountComponentAtNode)(e),e.innerHTML=n,(0,u.rIC)((function(){(0,s.hydrate)((0,l.jsx)(o.Z,{theme:g,children:(0,l.jsx)(f,(0,r.Z)({},p))}),e)}),{timeout:300})),function(){e&&(0,s.unmountComponentAtNode)(e)}}),[n,g,p,f]),(0,l.jsx)("div",{ref:h})}},62518:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return x}});var r=n(32723),a=n(34795),i=n(33028),o=n(9249),s=n(87371),c=n(45754),u=n(13820),l=(n(96902),n(68094)),d=n(31910),f=n(30908),p=n(63680),h=n(97531),g=n(21742),m=n(46186),v=n(57173),y=n(22616),b=n(29938);var x=function(e){(0,c.Z)(v,e);var t=(0,u.Z)(v);function v(){return(0,o.Z)(this,v),t.apply(this,arguments)}return(0,s.Z)(v,[{key:"serializeArgsInClient",value:function(e){var t;return(0,i.Z)((0,i.Z)({},e),{},{config:(0,p.isStateTreeNode)(e.config)?(0,p.getSnapshot)(e.config):e.config,filters:null===(t=e.filters)||void 0===t?void 0:t.toJSON().filters})}},{key:"deserializeResultsInClient",value:function(e,t){return t.exportSVG?(0,i.Z)((0,i.Z)({},e),{},{html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}):(0,i.Z)((0,i.Z)({},e),{},{reactElement:(0,b.jsx)(y.Z,(0,i.Z)((0,i.Z)((0,i.Z)({},t),e),{},{RenderingComponent:this.ReactComponent}))})}},{key:"deserializeArgsInWorker",value:function(e){var t=(0,i.Z)({},e);return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=new g.Z({filters:e.filters}),t}},{key:"serializeResultsInWorker",value:function(e,t){var n=(0,f.renderToString)((0,b.jsx)(l.Z,{theme:(0,m.createJBrowseTheme)(t.theme),children:e.reactElement}));return delete e.reactElement,(0,i.Z)((0,i.Z)({},e),{},{html:n})}},{key:"renderInClient",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,a){var i,o,s,c,u,l,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.call(a.sessionId,"CoreRender",a);case 2:if(i=e.sent,!("canvasRecordedData"in i)){e.next=14;break}return o=i.width,s=i.height,c=i.canvasRecordedData,e.next=7,n.e(7911).then(n.t.bind(n,47911,23));case 7:u=e.sent,l=new u.default(o,s),new d.CanvasSequence(c).execute(l),f=l.getSvg(),i.html=f.innerHTML,delete i.reactElement;case 14:return e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renderInWorker",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,i,o,s,c=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,a=t.statusCallback,i=void 0===a?function(){}:a,o=this.deserializeArgsInWorker(t),e.next=4,(0,h.updateStatus)("Rendering plot",i,(function(){return c.render(o)}));case 4:return s=e.sent,(0,h.checkAbortSignal)(n),e.abrupt("return",(0,h.updateStatus)("Serializing results",i,(function(){return c.serializeResultsInWorker(s,o)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,i,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.serializeArgsInClient(n),i=this.freeResources(),e.next=4,t.call(n.sessionId,"CoreFreeResources",a);case 4:return o=e.sent,e.abrupt("return",i+o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),v}(v.default)},21742:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(9249),a=n(87371),i=n(56921),o=function(){function e(t){var n=t.filters,a=void 0===n?[]:n;(0,r.Z)(this,e),this.filterChain=void 0,this.filterChain=a.map((function(e){if("string"===typeof e)return{expr:(0,i.P)(e),string:e};throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}return(0,a.Z)(e,[{key:"passes",value:function(){for(var e=0;e<this.filterChain.length;e+=1)if(!this.filterChain[e].expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}},{key:"toJSON",value:function(){return{filters:this.filterChain.map((function(e){return e.string}))}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()},22084:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(96902),a=n(82658),i=n(50543),o=n(91188),s=n(4782),c=n(96234),u=n(16644),l=n(44536),d=n(74859),f=n(41590),p=n(29938),h=(0,o.ZL)()((function(e){return{buttonRoot:{"&:hover":{backgroundColor:(0,u.Fq)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}}));var g=(0,s.observer)((function(e){var t=e.menuTitle,n=e.session,a=e.menuItems,i=(0,r.useState)(!1),o=(0,c.Z)(i,2),s=o[0],u=o[1],g=(0,r.useRef)(null),m=h().classes;function v(){u(!1)}return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(l.Z,{ref:g,onClick:function(){u(!s)},color:"inherit","data-testid":"dropDownMenuButton",classes:{root:m.buttonRoot},children:[t,(0,p.jsx)(d.Z,{})]}),(0,p.jsx)(f.Z,{anchorEl:g.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:function(e,t){t(n),v()},open:s,onClose:v,menuItems:a})]})})),m=n(35130),v=n(99836),y=n(16690),b=(0,s.observer)((function(e){var t=e.session.configuration,n=(0,v.readConfObject)(t,"logoPath");return null!==n&&void 0!==n&&n.uri?(0,p.jsx)("img",{src:n.uri,alt:"Custom logo"}):(0,p.jsx)(y.e,{variant:"white"})})),x=(0,o.ZL)()((function(e){return{grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light}}})),w=(0,s.observer)((function(e){var t=e.session,n=e.HeaderButtons,r=void 0===n?(0,p.jsx)("div",{}):n,o=x().classes,s=t.savedSessionNames,c=t.name,u=t.menus;return(0,p.jsxs)(a.Z,{children:[u.map((function(e){return(0,p.jsx)(g,{menuTitle:e.label,menuItems:e.menuItems,session:t},e.label)})),(0,p.jsx)("div",{className:o.grow}),(0,p.jsx)(i.Z,{title:"Rename Session",arrow:!0,children:(0,p.jsx)(m.Z,{value:c,setValue:function(e){null!==s&&void 0!==s&&s.includes(e)?t.notify('Cannot rename session to "'.concat(e,'", a saved session with that name already exists'),"warning"):t.renameCurrentSession(e)},variant:"body1",classes:{inputBase:o.inputBase,inputRoot:o.inputRoot,inputFocused:o.inputFocused}})}),r,(0,p.jsx)("div",{className:o.grow}),(0,p.jsx)("div",{style:{width:150,maxHeight:48},children:(0,p.jsx)(b,{session:t})})]})}))},86106:function(e,t,n){"use strict";n.d(t,{Z:function(){return L}});var r=n(96234),a=n(96902),i=n(69029),o=n(19459),s=n(82658),c=n(13655),u=n(33266),l=n(35388),d=n(15996),f=n(25322),p=n(50543),h=n(5966),g=n(91188),m=n(4782),v=n(97531),y=n(20893),b=n(31946),x=n(47057),w=n(21630),k=n(38238),C=n(6880),Z=n(54896),S=n(29938),T=(0,g.ZL)()((function(e){return{paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}}));var M=(0,m.observer)((function(e){var t=e.children,n=e.session,r=n.drawerPosition,a=n.drawerWidth,i=T().classes;return(0,S.jsxs)(C.Z,{className:i.paper,elevation:16,square:!0,children:["right"===r?(0,S.jsx)(Z.Z,{onDrag:n.resizeDrawer,className:i.resizeHandle,vertical:!0}):null,t,"left"===r?(0,S.jsx)(Z.Z,{onDrag:n.resizeDrawer,className:i.resizeHandle,style:{left:a},vertical:!0}):null]})})),P=n(66379),R=(0,g.ZL)()((function(e){return{formControl:{margin:0},spacer:{flexGrow:1},drawerSelect:{margin:0,color:e.palette.secondary.contrastText},dropDownIcon:{color:e.palette.secondary.contrastText},header:{background:e.palette.secondary.main}}})),A=(0,m.observer)((function(e){var t=e.session,n=e.setToolbarHeight,i=(0,v.getEnv)(t).pluginManager,g=t.visibleWidget,m=t.activeWidgets,y=t.drawerPosition,C=R().classes,Z=(0,a.useState)(null),T=(0,r.Z)(Z,2),M=T[0],P=T[1];return(0,S.jsxs)(o.Z,{position:"sticky",className:C.header,ref:function(e){return n((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)},children:[(0,S.jsxs)(s.Z,{disableGutters:!0,children:[(0,S.jsx)(c.Z,{className:C.formControl,children:(0,S.jsx)(u.Z,{value:null===g||void 0===g?void 0:g.id,"data-testid":"widget-drawer-selects",className:C.drawerSelect,classes:{icon:C.dropDownIcon},renderValue:function(e){var n=t.activeWidgets.get(e);if(!n)return(0,S.jsx)(l.Z,{variant:"h6",color:"inherit",children:"Unknown widget"});var r=i.getWidgetType(n.type),a=r.HeadingComponent,o=r.heading;return a?(0,S.jsx)(a,{model:n}):(0,S.jsx)(l.Z,{variant:"h6",color:"inherit",children:o})},onChange:function(e){var n=t.activeWidgets.get(e.target.value);n?t.showWidget(n):t.notify("Widget not found ".concat(e.target.value),"warning")},children:Array.from(m.values()).map((function(e){var n=i.getWidgetType(e.type),r=n.HeadingComponent,a=n.heading;return(0,S.jsxs)(d.Z,{"data-testid":"widget-drawer-selects-item-".concat(e.type),value:e.id,children:[r?(0,S.jsx)(r,{model:e}):(0,S.jsx)(l.Z,{variant:"h6",color:"inherit",children:a}),(0,S.jsx)(f.Z,{"data-testid":"".concat(e.type,"-drawer-delete"),color:"inherit","aria-label":"Delete",onClick:function(){return t.hideWidget(e)},children:(0,S.jsx)(b.Z,{})})]},e.id)}))})}),(0,S.jsx)("div",{className:C.spacer}),(0,S.jsxs)("div",{children:[(0,S.jsx)(f.Z,{"data-testid":"drawer-close",color:"inherit",onClick:function(e){return P(e.currentTarget)},children:(0,S.jsx)(k.Z,{})}),(0,S.jsx)(p.Z,{title:"Minimize drawer",children:(0,S.jsx)(f.Z,{"data-testid":"drawer-minimize",color:"inherit",onClick:function(){t.notify("Drawer minimized, click button on ".concat(y," side of screen to re-open"),"info"),t.minimizeWidgetDrawer()},children:(0,S.jsx)(w.Z,{})})}),(0,S.jsx)(p.Z,{title:"Close drawer",children:(0,S.jsx)(f.Z,{"data-testid":"drawer-close",color:"inherit",onClick:function(){return t.hideWidget(g)},children:(0,S.jsx)(x.Z,{})})})]})]}),(0,S.jsx)(h.Z,{anchorEl:M,open:Boolean(M),onClose:function(){return P(null)},children:["left","right"].map((function(e){return(0,S.jsx)(d.Z,{selected:"option"===y,onClick:function(){t.setDrawerPosition(e),P(null)},children:e},e)}))})]})})),L=(0,m.observer)((function(e){var t=e.session,n=t.visibleWidget,o=(0,v.getEnv)(t).pluginManager,s=n?o.evaluateExtensionPoint("Core-replaceWidget",o.getWidgetType(n.type).ReactComponent,{session:t,model:n}):null,c=(0,a.useState)(0),u=(0,r.Z)(c,2),l=u[0],d=u[1];return(0,S.jsxs)(M,{session:t,children:[(0,S.jsx)(A,{session:t,setToolbarHeight:d}),(0,S.jsx)(a.Suspense,{fallback:(0,S.jsx)(y.Z,{}),children:(0,S.jsx)(i.ErrorBoundary,{FallbackComponent:function(e){var t=e.error;return(0,S.jsx)(P.default,{error:t})},children:s?(0,S.jsx)(s,{model:n,session:t,toolbarHeight:l}):null})})]})}))},90264:function(e,t,n){"use strict";var r=n(96234),a=n(96902),i=n(44536),o=n(99826),s=n(83674),c=n(52809),u=n(99688),l=n(97342),d=n(29938),f=function(e){var t=e.onFactoryReset,n=e.resetButtonText,o=(0,a.useState)(!1),s=(0,r.Z)(o,2),c=s[0],u=s[1];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.Z,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:function(){return u(!0)},children:n}),(0,d.jsx)(l.Z,{onClose:function(){return u(!1)},open:c,onFactoryReset:t})]})};t.Z=function(e){var t=e.componentStack,n=e.error,r=void 0===n?"No error message provided":n,a=e.onFactoryReset,l=e.resetButtonText,p=void 0===l?"Factory Reset":l;return(0,d.jsxs)(o.Z,{open:!0,children:[(0,d.jsx)(s.Z,{style:{background:"#e88"},children:"Fatal error"}),(0,d.jsx)(c.Z,{children:(0,d.jsxs)("pre",{children:["".concat(r),t]})}),(0,d.jsxs)(u.Z,{children:[(0,d.jsx)(i.Z,{color:"secondary",variant:"contained",onClick:function(){return window.location.reload()},children:"Refresh"}),(0,d.jsx)(f,{onFactoryReset:a,resetButtonText:p})]})]})}},50811:function(e,t,n){"use strict";n(96902);var r=n(37676),a=n(13655),i=n(44536),o=n(35388),s=n(91188),c=n(97531),u=n(16151),l=n(29938);function d(e){return"blobId"in e}var f=(0,s.ZL)()((function(e){return{filename:{marginLeft:e.spacing(1)}}}));t.Z=function(e){var t=f().classes,n=e.location,s=e.setLocation,p=n&&(d(n)&&n.name||function(e){return"localPath"in e}(n)&&n.localPath),h=n&&d(n)&&!(0,u.getBlob)(n.blobId);return(0,l.jsxs)(r.Z,{display:"flex",flexDirection:"row",alignItems:"center",children:[(0,l.jsx)(r.Z,{children:(0,l.jsx)(a.Z,{fullWidth:!0,children:(0,l.jsxs)(i.Z,{variant:"outlined",component:"label",children:["Choose File",(0,l.jsx)("input",{type:"file",hidden:!0,onChange:function(e){var t=e.target,n=t&&t.files&&t.files[0];n&&(c.isElectron?s({localPath:n.path,locationType:"LocalPathLocation"}):s((0,u.storeBlobLocation)({blob:n})))}})]})})}),(0,l.jsxs)(r.Z,{children:[(0,l.jsx)(o.Z,{component:"span",className:t.filename,color:p?"initial":"textSecondary",children:p||"No file chosen"}),h?(0,l.jsx)(o.Z,{color:"error",children:"(need to reload)"}):null]})]})}},58865:function(e,t,n){"use strict";n(96902);var r=n(66519),a=n(4782),i=n(73),o=n(29938);t.Z=(0,a.observer)((function(e){var t=e.location,n=e.setLocation,a=e.label;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(r.Z,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:t&&(0,i.hb)(t)?t.uri:"",label:a||"Enter URL",onChange:function(e){n({uri:e.target.value.trim(),locationType:"UriLocation"})}})})}))},20893:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var r,a=n(33028),i=n(59740),o=n(71171),s=(n(96902),n(35388)),c=n(91188),u=n(99455),l=n(29938),d=["message","variant"],f=(0,c.ZL)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:"".concat((0,u.F4)(r||(r=(0,o.Z)(["\n      0% {\n        content: '...';\n      }\n      25% {\n          content: '';\n      }\n      50% {\n        content: '.';\n      }\n      75% {\n        content: '..';\n      }\n      "])))," 1.2s infinite ease-in-out")}}});function p(e){var t=e.message,n=void 0===t?"Loading":t,r=e.variant,o=void 0===r?"body2":r,c=(0,i.Z)(e,d),u=f().classes;return(0,l.jsx)(s.Z,(0,a.Z)((0,a.Z)({className:u.dots},c),{},{variant:o,children:"".concat(n||"Loading")}))}},7947:function(e,t,n){"use strict";var r=n(96234),a=(n(96902),n(53974)),i=n(49408),o=n(44536),s=n(25322),c=n(4782),u=n(47057),l=n(29938);t.Z=(0,c.observer)((function(e){var t=e.session,n=t.popSnackbarMessage,c=t.snackbarMessages,d=c.length?c[c.length-1]:null,f=function(e,t){"clickaway"!==t&&n()},p=!!d,h=d||[],g=(0,r.Z)(h,3),m=g[0],v=g[1],y=g[2];return(0,l.jsx)(a.Z,{open:p,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,l.jsx)(i.Z,{onClose:f,action:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(o.Z,{color:"inherit",onClick:function(e){y.onClick(),f()},children:y.name}),(0,l.jsx)(s.Z,{color:"inherit",onClick:f,children:(0,l.jsx)(u.Z,{})})]}):null,severity:v||"warning",children:m})})}))},2880:function(e,t,n){"use strict";var r=n(96234),a=n(96902),i=n(6880),o=n(35388),s=n(13655),c=n(33266),u=n(15996),l=n(44536),d=n(4782),f=n(91188),p=n(97531),h=n(29938),g=(0,f.ZL)()((function(e){return{selectPaper:{padding:e.spacing(4)}}})),m=(0,d.observer)((function(e){var t,n=e.session,d=g().classes,f=(0,p.getEnv)(n).pluginManager.getElementTypeRecord("view").all(),m=(0,a.useState)(null===(t=f[0])||void 0===t?void 0:t.name),v=(0,r.Z)(m,2),y=v[0],b=v[1];return(0,h.jsxs)(i.Z,{className:d.selectPaper,children:[(0,h.jsx)(o.Z,{children:"Select a view to launch"}),(0,h.jsx)(s.Z,{style:{margin:2},children:(0,h.jsx)(c.Z,{value:y,onChange:function(e){return b(e.target.value)},children:f.map((function(e){var t=e.displayName,n=e.name;return(0,h.jsx)(u.Z,{value:n,children:t},n)}))})}),(0,h.jsx)(s.Z,{style:{margin:2},children:(0,h.jsx)(l.Z,{onClick:function(){return n.addView(y,{})},variant:"contained",color:"primary",children:"Launch view"})})]})}));t.Z=m},80659:function(e,t,n){"use strict";n.d(t,{Z:function(){return L}});var r=n(96902),a=n(69029),i=n(4782),o=n(97531),s=n(66379),c=n(20893),u=n(33028),l=n(96234),d=n(88636),f=n(6880),p=n(50543),h=n(25322),g=n(91188),m=n(63680),v=n(10159),y=n(47057),b=n(21630),x=n(51467),w=n(35130),k=n(68079),C=n(4645),Z=n(39077),S=n(41499),T=n(41590),M=n(29938),P=(0,i.observer)((function(e){var t=e.model,n=e.IconButtonProps,a=e.IconProps,i=(0,r.useState)(),s=(0,l.Z)(i,2),c=s[0],d=s[1],f=t.menuItems,p=(0,o.getSession)(t),g=[].concat((0,k.Z)(p.views.length>1?[{label:"Move view up",icon:S.Z,onClick:function(){return p.moveViewUp(t.id)}},{label:"Move view down",icon:Z.Z,onClick:function(){return p.moveViewDown(t.id)}}]:[]),(0,k.Z)(("function"===typeof f?f():f)||[]));return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(h.Z,(0,u.Z)((0,u.Z)({},n),{},{onClick:function(e){return d(e.currentTarget)},"data-testid":"view_menu_icon",children:(0,M.jsx)(C.Z,(0,u.Z)((0,u.Z)({},a),{},{fontSize:"small"}))})),(0,M.jsx)(T.Z,{anchorEl:c,open:Boolean(c),onMenuItemClick:function(e,t){t(),d(void 0)},onClose:function(){return d(void 0)},menuItems:g})]})})),R=(0,g.ZL)()((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),A=(0,i.observer)((function(e){var t,n=e.view,a=e.onClose,i=e.onMinimize,o=e.style,s=e.children,c=R().classes,g=(0,d.Z)().spacing(1),k=(0,v.Z)(),C=(0,l.Z)(k,2),Z=C[0],S=C[1].width;(0,r.useEffect)((function(){S&&(0,m.isAlive)(n)&&n.setWidth(S-2*parseInt(g,10))}),[g,n,S]);var T=(0,r.useRef)(null);return(0,r.useEffect)((function(){var e,t;null===(e=T.current)||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,{block:"center"})}),[]),(0,M.jsxs)(f.Z,{ref:Z,elevation:12,className:c.viewContainer,style:(0,u.Z)((0,u.Z)({},o),{},{padding:"0px ".concat(g," ").concat(g)}),children:[(0,M.jsxs)("div",{ref:T,style:{display:"flex"},children:[(0,M.jsx)(P,{model:n,IconProps:{className:c.icon}}),(0,M.jsx)("div",{className:c.grow}),(0,M.jsx)(p.Z,{title:"Rename view",arrow:!0,children:(0,M.jsx)(w.Z,{value:(n.displayName||(null===(t=n.assemblyNames)||void 0===t?void 0:t.join(","))||"Untitled view")+(n.minimized?" (minimized)":""),setValue:function(e){return n.setDisplayName(e)},variant:"body2",classes:{input:c.input,inputBase:c.inputBase,inputRoot:c.inputRoot,inputFocused:c.inputFocused}})}),(0,M.jsx)("div",{className:c.grow}),(0,M.jsx)(h.Z,{"data-testid":"minimize_view",onClick:i,children:n.minimized?(0,M.jsx)(x.Z,{className:c.icon,fontSize:"small"}):(0,M.jsx)(b.Z,{className:c.icon,fontSize:"small"})}),(0,M.jsx)(h.Z,{"data-testid":"close_view",onClick:a,children:(0,M.jsx)(y.Z,{className:c.icon,fontSize:"small"})})]}),(0,M.jsx)(f.Z,{children:s})]})})),L=(0,i.observer)((function(e){var t=e.view,n=e.session,i=(0,o.getEnv)(n).pluginManager.getViewType(t.type);if(!i)throw new Error("unknown view type ".concat(t.type));var u=i.ReactComponent;return(0,M.jsx)(A,{view:t,onClose:function(){return n.removeView(t)},onMinimize:function(){return t.setMinimized(!t.minimized)},children:!t.minimized&&(0,M.jsx)(a.ErrorBoundary,{FallbackComponent:function(e){var t=e.error;return(0,M.jsx)(s.default,{error:t})},children:(0,M.jsx)(r.Suspense,{fallback:(0,M.jsx)(c.Z,{variant:"h4"}),children:(0,M.jsx)(u,{model:t,session:n})})})})}))},66185:function(e,t,n){"use strict";n.r(t),n.d(t,{category10:function(){return r},dark2:function(){return a},ggplot2Colors3:function(){return d},ggplot2Colors4:function(){return l},ggplot2Colors5:function(){return u},ggplot2Colors6:function(){return c},set1:function(){return i},set2:function(){return o},tableau10:function(){return s}});var r=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],i=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],o=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],c=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],u=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],l=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],d=["#F8766D","#00BA38","#619CFF"]},98103:function(e,t,n){"use strict";n.d(t,{Ao:function(){return i},R:function(){return c},j4:function(){return s}});var r=n(33028),a=n(63680);function i(e,t,n){if(t&&n){for(var r=e.width,a=e.interRegionPaddingWidth,i=e.displayedRegions,o=e.bpPerPx,s=e.minimumBlockWidth,c=function(e,t,n){var r=0,a=e.displayedRegions;if(t.index===n.index)r+=n.offset-t.offset;else{var i=a[t.index];if(r+=i.end-i.start-t.offset,n.index-t.index>=2)for(var o=t.index+1;o<n.index;o++){var s=a[o];r+=s.end-s.start}r+=n.offset}return r}(e,t,n),u=0,l=t.index;l<n.index;l++){var d=i[l];(d.end-d.start)/o>s&&u++}var f=c/(r-a*u),p=e.zoomTo(f),h=0;f<p&&(h=(p-f)*e.width/2);for(var g=-h,m=0;m<e.displayedRegions.length;m+=1){var v=e.displayedRegions[m];if(t.index===m){g+=t.offset;break}g+=v.end-v.start}e.scrollTo(Math.round(g/e.bpPerPx))}}function o(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function s(e,t){var n=0,i=e.bpPerPx,s=e.offsetPx,c=e.displayedRegions,u=e.interRegionPaddingWidth,l=e.staticBlocks.contentBlocks,d=(s+t)*i;if(d<0){var f=c[0],p=(0,a.getSnapshot)(f);return(0,r.Z)((0,r.Z)({},p),{},{oob:!0,coord:o(f,d),offset:d,index:0})}for(var h=u*i,g=0,m=0;m<c.length;m++){var v,y=c[m],b=y.end-y.start,x=d-n;if(b+n>d&&n<=d){var w=(0,a.getSnapshot)(y);return(0,r.Z)((0,r.Z)({},w),{},{oob:!1,offset:x,coord:o(y,x),index:m})}(null===(v=l[g])||void 0===v?void 0:v.regionNumber)===m?(n+=b+h,g++):n+=b}if(d>=n&&c.length){var k=c[c.length-1],C=d-n+(k.end-k.start),Z=(0,a.getSnapshot)(k);return(0,r.Z)((0,r.Z)({},Z),{},{oob:!0,offset:C,coord:o(k,C),index:c.length-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function c(e){for(var t=e.refName,n=e.coord,r=e.regionNumber,a=e.self,i=0,o=a.interRegionPaddingWidth,s=a.bpPerPx,c=a.displayedRegions,u=a.staticBlocks.contentBlocks,l=o*s,d=0,f=0;f<c.length;f++){var p,h=c[f],g=h.end-h.start;if(t===h.refName&&n>=h.start&&n<=h.end&&(!r||r===f)){i+=h.reversed?h.end-n:n-h.start;break}(null===(p=u[d])||void 0===p?void 0:p.regionNumber)===f?(i+=g+l,d++):i+=g}if(c[f])return{index:f,offsetPx:Math.round(i/s)}}},30368:function(e,t,n){"use strict";var r=n(68079),a=n(63680),i=n(97531),o=n(42328),s=n(15276),c=n(25574),u=n(98103);var l=a.types.model("Base1DView",{id:o.ElementId,displayedRegions:a.types.array(o.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:a.types.optional(a.types.number,0),minimumBlockWidth:a.types.optional(a.types.number,0)}).volatile((function(){return{features:void 0,volatileWidth:0}})).actions((function(e){return{setDisplayedRegions:function(t){e.displayedRegions=(0,a.cast)(t)},setBpPerPx:function(t){e.bpPerPx=t},setVolatileWidth:function(t){e.volatileWidth=t}}})).views((function(e){return{get width(){return e.volatileWidth},get assemblyNames(){return(0,r.Z)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}})).views((function(e){return{get dynamicBlocks(){return(0,s.Z)(e)},get staticBlocks(){return(0,c.Z)(e)},get currBp(){return this.dynamicBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}})).views((function(e){return{pxToBp:function(t){return(0,u.j4)(e,t)},bpToPx:function(t){var n,r=t.refName,a=t.coord,i=t.regionNumber;return null===(n=(0,u.R)({refName:r,coord:a,regionNumber:i,self:e}))||void 0===n?void 0:n.offsetPx}}})).actions((function(e){return{setFeatures:function(t){e.features=t},showAllRegions:function(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut:function(){this.zoomTo(2*e.bpPerPx)},zoomIn:function(){this.zoomTo(e.bpPerPx/2)},zoomTo:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2,r=t;if(r===e.bpPerPx)return e.bpPerPx;var a=e.bpPerPx;return e.bpPerPx=r,e.offsetPx=(0,i.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset),e.bpPerPx},scrollTo:function(t){var n=(0,i.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt:function(t,n,r){if(n){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))}},scroll:function(t){var n=e.offsetPx,r=(0,i.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}}})).actions((function(e){return{moveTo:function(t,n){(0,u.Ao)(e,t,n)}}}));t.Z=l},39926:function(e,t,n){"use strict";n.d(t,{Jw:function(){return c},b0:function(){return l},n2:function(){return f},sh:function(){return d}});var r=n(45754),a=n(13820),i=n(33028),o=n(9249),s=n(87371),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,o.Z)(this,e),this.blocks=t}return(0,s.Z)(e,[{key:"push",value:function(e){if(e instanceof d&&this.blocks.length){var t=this.blocks[this.blocks.length-1];if(t instanceof d)return void t.push(e)}this.blocks.push(e)}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRegions",value:function(){return this.blocks.map((function(e){return e.toRegion()}))}},{key:"map",value:function(e,t){return this.blocks.map(e,t)}},{key:"forEach",value:function(e,t){return this.blocks.forEach(e,t)}},{key:"length",get:function(){return this.blocks.length}},{key:"totalWidthPx",get:function(){return this.blocks.length?this.blocks.map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"totalWidthPxWithoutBorders",get:function(){return this.blocks.length?this.blocks.filter((function(e){return"boundary"!==e.variant})).map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"offsetPx",get:function(){return this.blocks.length?this.blocks[0].offsetPx:0}},{key:"contentBlocks",get:function(){return this.blocks.filter((function(e){return e instanceof l}))}},{key:"totalBp",get:function(){return this.contentBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}]),e}(),u=function(){function e(t){(0,o.Z)(this,e),this.regionNumber=void 0,this.reversed=void 0,this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,this.offsetPx=void 0,this.widthPx=0,this.variant=void 0,this.isLeftEndOfDisplayedRegion=void 0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key,this.offsetPx=t.offsetPx}return(0,s.Z)(e,[{key:"renameReference",value:function(e){return this.refName&&e!==this.refName?new this.constructor((0,i.Z)((0,i.Z)({},this),{},{refName:e})):this}},{key:"toRegion",value:function(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}]),e}(),l=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n)}(u),d=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).widthPx=void 0,r.elidedBlockCount=0,r.widthPx=e.widthPx,r}return(0,s.Z)(n,[{key:"push",value:function(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}]),n}(u),f=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n)}(u)},15276:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(96234),a=n(63680),i=n(23995),o=n(97531),s=n(39926);function c(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e.offsetPx,u=e.displayedRegions,l=e.bpPerPx,d=e.width,f=e.minimumBlockWidth,p=e.interRegionPaddingWidth;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");var h=new s.Jw,g=0,m=c,v=m+d;return u.forEach((function(e,y){var b=e.assemblyName,x=e.refName,w=e.start,k=e.end,C=e.reversed,Z=g+(k-w)/l,S=(k-w)/l,T=(0,a.isStateTreeNode)(e)?(0,a.getSnapshot)(e):e;if(g<v&&Z>m){var M,P,R,A,L,N=(0,i.U0)(m,v,g,Z),j=(0,r.Z)(N,2),F=j[0],I=j[1];C?(M=Math.max(w,k-(I-g)*l),R=(P=k-(F-g)*l)===k,A=M===w,L=g+(k-P)/l):(R=(M=(F-g)*l+w)===w,A=(P=Math.min(k,(I-g)*l+w))===k,L=g+(M-w)/l);var B={assemblyName:b,refName:x,start:M,end:P,reversed:C,offsetPx:L,parentRegion:T,regionNumber:y,widthPx:(P-M)/l,isLeftEndOfDisplayedRegion:R,isRightEndOfDisplayedRegion:A,key:""};B.key="".concat((0,o.assembleLocStringFast)(B),"-").concat(y).concat(C?"-reversed":""),t&&0===h.length&&R&&h.push(new s.n2({key:"".concat(B.key,"-beforeFirstRegion"),widthPx:-c,offsetPx:B.offsetPx+c,variant:"boundary"})),n&&S<f?h.push(new s.sh(B)):h.push(new s.b0(B)),t&&(S>=f&&B.isRightEndOfDisplayedRegion&&y<u.length-1&&(h.push(new s.n2({key:"".concat(B.key,"-rightpad"),widthPx:p,offsetPx:B.offsetPx+B.widthPx})),g+=p),y===u.length-1&&B.isRightEndOfDisplayedRegion&&(L=B.offsetPx+B.widthPx,h.push(new s.n2({key:"".concat(B.key,"-afterLastRegion"),widthPx:d-L+c,offsetPx:L,variant:"boundary"}))))}g+=(k-w)/l})),h}},25574:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(63680),a=n(97531),i=n(39926);function o(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:800,c=e.offsetPx,u=e.displayedRegions,l=e.bpPerPx,d=e.minimumBlockWidth,f=e.interRegionPaddingWidth,p=e.width,h=c*l,g=(c+p)*l,m=s,v=Math.ceil(m*l),y=0,b=new i.Jw;return u.forEach((function(e,c){var p=e.assemblyName,m=e.refName,x=e.start,w=e.end,k=e.reversed,C=Math.ceil((w-x)/v),Z=(0,r.isStateTreeNode)(e)?(0,r.getSnapshot)(e):e,S=Math.floor((g-y)/v)+o;S>=C&&(S=C-1);var T=Math.floor((h-y)/v)-o;T<0&&(T=0);for(var M=(w-x)/l,P=T;P<=S;P+=1){var R=void 0,A=void 0,L=void 0,N=void 0;k?(R=Math.max(x,w-(P+1)*v),L=(A=w-P*v)===w,N=R===x):(L=(R=x+P*v)===x,N=(A=Math.min(w,x+(P+1)*v))===w);var j={assemblyName:p,refName:m,start:R,end:A,reversed:k,offsetPx:(y+P*v)/l,parentRegion:Z,regionNumber:c,widthPx:(A-R)/l,isLeftEndOfDisplayedRegion:L,isRightEndOfDisplayedRegion:N,key:""};j.key="".concat((0,a.assembleLocStringFast)(j),"-").concat(c).concat(k?"-reversed":""),t&&0===c&&0===P&&b.push(new i.n2({key:"".concat(j.key,"-beforeFirstRegion"),widthPx:s,offsetPx:j.offsetPx-s,variant:"boundary"})),n&&M<d?b.push(new i.sh(j)):b.push(new i.b0(j)),t&&(M>=d&&j.isRightEndOfDisplayedRegion&&c<u.length-1&&(y+=f*l,b.push(new i.n2({key:"".concat(j.key,"-rightpad"),widthPx:f,offsetPx:j.offsetPx+j.widthPx}))),c===u.length-1&&j.isRightEndOfDisplayedRegion&&(y+=f*l,b.push(new i.n2({key:"".concat(j.key,"-afterLastRegion"),widthPx:s,offsetPx:j.offsetPx+j.widthPx,variant:"boundary"}))))}y+=w-x})),b}},51632:function(e,t,n){"use strict";n.r(t),n.d(t,{contrastingTextColor:function(){return s},emphasize:function(){return u},isNamedColor:function(){return o},makeContrasting:function(){return l},namedColorToHex:function(){return i}});var r=n(16644),a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(e){return a[e]}function o(e){return!!a[e]}function s(e){return c(e)>.5?"black":"white"}function c(e){var t=i(e);return(0,r.H3)(t||e)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15,n=i(e);return(0,r._4)(n||e,t)}function l(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=i(e)||e,o=i(t)||t,s=c(o),u=(0,r.mi)(a,o),l=a,d=.05;u<n;)a=s>.5?(0,r._j)(l,d):(0,r.$n)(l,d),d+=.05,u=(0,r.mi)(a,o);return a}},29943:function(e,t,n){"use strict";function r(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n=[],r=new Set,a=0;a<e.length;a++){var i=e[a],o=t(i);r.has(o)||(n.push(i),r.add(o))}return n}n.d(t,{D:function(){return r}})},95155:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(97531);function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Object.keys(e),i=0;i<n.length;i++){var o=n[i];if(t.length>5e3)break;"object"===typeof e[o]&&e[o]?t+=a(e[o],t):t+="".concat(o,"-").concat(e[o],";")}return(0,r.hashCode)(t)}},32145:function(e,t,n){"use strict";n.r(t),n.d(t,{RemoteFileWithRangeCache:function(){return w},getFetcher:function(){return T},openLocation:function(){return S}});var r=n(32723),a=n(34795),i=n(33028),o=n(18973),s=n(19522),c=n.n(s),u=n(41361),l=n(96234),d=n(9249),f=n(87371),p=n(93069),h=n(95058),g=n(45754),m=n(13820),v=n(38306),y=n(59706),b={};var x=new v.t({fetch:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=b[e];if(!a)throw new Error("fetch not registered for ".concat(e));return a(e,t,n,r)},size:500*Math.pow(1024,2),chunkSize:15872,maxFetchSize:100*Math.pow(1024,2),minimumTTL:864e5});var w=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,f.Z)(n,[{key:"fetch",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,a){var i,o,s,c,u,d,f,g,m,v,y,w;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b[String(t)]||(b[String(t)]=this.fetchBinaryRange.bind(this)),(i=a&&a.headers)&&(i instanceof Headers?o=i.get("range"):Array.isArray(i)?(s=i.find((function(e){return"range"===(0,l.Z)(e,1)[0]}))||[void 0,void 0],c=(0,l.Z)(s,2),o=c[1]):o=i.range),!o){e.next=14;break}if(!(u=/bytes=(\d+)-(\d+)/.exec(o))){e.next=14;break}return d=(0,l.Z)(u,3),f=d[1],g=d[2],m=parseInt(f,10),v=parseInt(g,10),e.next=11,x.getRange(t,m,v-m+1,{signal:a&&a.signal});case 11:return y=e.sent,w=y.headers,e.abrupt("return",new Response(y.buffer,{status:206,headers:w}));case 14:return e.abrupt("return",(0,p.Z)((0,h.Z)(n.prototype),"fetch",this).call(this,t,a));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchBinaryRange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,a,o){var s,c,d,f,g,m,v,b,x,w,k,C,Z,S=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=S.length>3&&void 0!==S[3]?S[3]:{},c=new Date,d=(0,i.Z)((0,i.Z)({},s.headers),{},{range:"bytes=".concat(a,"-").concat(o)}),e.next=5,(0,p.Z)((0,h.Z)(n.prototype),"fetch",this).call(this,t,(0,i.Z)((0,i.Z)({},s),{},{headers:d}));case 5:if(f=e.sent,g=new Date,206===f.status){e.next=11;break}throw m="HTTP ".concat(f.status," (").concat(f.statusText,") when fetching ").concat(t," bytes ").concat(a,"-").concat(o)," (should be 206 for range requests)",new Error("".concat(m).concat(200===f.status?" (should be 206 for range requests)":""));case 11:v={},b=(0,u.Z)(f.headers.entries());try{for(b.s();!(x=b.n()).done;)w=(0,l.Z)(x.value,2),k=w[0],C=w[1],v[k]=C}catch(r){b.e(r)}finally{b.f()}return e.next=16,f.arrayBuffer();case 16:return Z=e.sent,e.abrupt("return",{headers:v,requestDate:c,responseDate:g,buffer:y.Buffer.from(Z)});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(o.kC),k=n(73),C=n(16151),Z=n(97531);function S(e,t){if(!e)throw new Error("must provide a location to openLocation");if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(c()||Z.isElectron)return new o.S9(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){var n=(0,C.getBlob)(e.blobId);if(!n)throw new Error('file ("'.concat(e.name,'") was opened locally from a previous session. To restore it, go to track settings and reopen the file'));return new o.SH(n)}if((0,k.hb)(e)){if(!e.uri)throw new Error("No URI provided");var r=e.baseUri?(0,i.Z)((0,i.Z)({},e),{},{uri:new URL(e.uri,e.baseUri).href}):e;if(t){var a=M(e,t);if(a)return a.openLocation(r)}return new w(r.uri,{fetch:P})}throw new Error("invalid fileLocation")}function T(e,t){if(!(0,k.hb)(e))throw new Error("Not a valid UriLocation: ".concat(JSON.stringify(e)));if(t){var n=M(e,t);if(n)return n.getFetcher(e)}return P}function M(e,t){var n=t.rootModel;if(n&&(0,k.At)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}function P(e,t){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,n);case 2:if(401!==(a=e.sent).status){e.next=6;break}if(null===(i=a.headers.get("WWW-Authenticate"))||void 0===i||!i.includes("Basic")){e.next=6;break}throw new k.yb("Accessing HTTPBasic resource without authentication",t.toString());case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},47901:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(16283),a=n.n(r);function i(){var e=new(a().Jexl);return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("parent",(function(e){return e.parent()})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("endsWith",(function(e,t,n){return e.endsWith(t,n)})),e.addFunction("padEnd",(function(e,t,n){return e.padEnd(t,n)})),e.addFunction("padStart",(function(e,t,n){return e.padStart(t,n)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,n){return e.replace(t,n)})),e.addFunction("replaceAll",(function(e,t,n){return e.replaceAll(t,n)})),e.addFunction("slice",(function(e,t,n){return e.slice(t,n)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("substring",(function(e,t,n){return e.substring(t,n)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){return e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e}},56921:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(47901),a={};function i(e,t){var n="nosig|".concat(e);if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var i=e.split("jexl:")[1],o=t?t.compile("".concat(i)):(0,r.Z)().compile("".concat(i));a[n]=o}return a[n]}},12052:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(41361),a=n(96234),i=n(9249),o=n(87371),s=1e4;function c(e,t,n,r){return t>=n&&r>=e}var u=function(){function e(){(0,i.Z)(this,e),this.padding=1,this.allFilled=void 0,this.widthLimit=1e6,this.rowState=void 0}return(0,o.Z)(e,[{key:"setAllFilled",value:function(e){this.allFilled=e}},{key:"getItemAt",value:function(e){var t;return this.allFilled?this.allFilled:void 0===(null===(t=this.rowState)||void 0===t?void 0:t.min)||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}},{key:"isRangeClear",value:function(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;for(var n=this.rowState,r=n.min,a=n.max,i=n.offset,o=n.bits,s=Math.min(a,t)-i,c=!0,u=Math.max(r,e)-i;u<s&&c;u++)c=void 0===o[u];return c}},{key:"initialize",value:function(e,t){var n=t-e;return{offset:e-n,min:e,max:t,bits:new Array(3*n)}}},{key:"addRect",value:function(e,t){var n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));var a=n-this.rowState.offset,i=r-this.rowState.offset,o=this.rowState.bits.length;if(i>=this.rowState.bits.length){var s=i+1;this.rowState.bits.length+s>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):s>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(s)))}if(n<this.rowState.offset){var c=Math.min(o-a,this.rowState.offset);this.rowState.bits.length+c>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=new Array(c).concat(this.rowState.bits),this.rowState.offset-=c)}var u=(i=r-this.rowState.offset)-(a=n-this.rowState.offset);u>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(u," bits in a single row."),e,t);for(var l=a;l<i;l+=1)this.rowState.bits[l]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}},{key:"discardRange",value:function(e,t){if(!this.allFilled&&this.rowState&&!(t<=this.rowState.min||e>=this.rowState.max))if(e<=this.rowState.min&&t>=this.rowState.max)this.rowState=void 0;else{if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-s&&this.rowState.bits.length>this.rowState.max+s-this.rowState.offset){var n=this.rowState.min-this.rowState.offset,r=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(n,this.rowState.bits.length-r),this.rowState.offset+=n}else if(this.rowState.offset<this.rowState.min-s){var a=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,a),this.rowState.offset+=a}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+s){var i=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=i}for(var o=Math.max(this.rowState.min,e)-this.rowState.offset,c=Math.min(t,this.rowState.max)-this.rowState.offset,u=o;u>=0&&u<c;u+=1)this.rowState.bits[u]=void 0}}}]),e}(),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pitchX,r=void 0===n?10:n,a=t.pitchY,o=void 0===a?10:a,s=t.maxHeight,c=void 0===s?1e4:s,u=t.hardRowLimit,l=void 0===u?1e4:u,d=t.displayMode,f=void 0===d?"normal":d;(0,i.Z)(this,e),this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=r,this.pitchY=o,this.hardRowLimit=l,this.maxHeightReached=!1,this.displayMode=f,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(c/this.pitchY),this.pTotalHeight=0}return(0,o.Z)(e,[{key:"addRect",value:function(e,t,n,r,a){var i=this.rectangles.get(e);if(i)return null===i.top?null:(this.addRectToBitmap(i),i.top*this.pitchY);var o=Math.floor(t/this.pitchX),s=Math.floor(n/this.pitchX),c=Math.ceil(r/this.pitchY),u={id:e,l:o,r:s,top:null,h:c,originalHeight:r,data:a},l=this.maxHeight-c,d=0;if("collapse"!==this.displayMode){for(;d<=l&&this.collides(u,d);d+=1);if(d>l)return u.top=null,this.rectangles.set(e,u),this.maxHeightReached=!0,null}return u.top=d,this.addRectToBitmap(u),this.rectangles.set(e,u),this.pTotalHeight=Math.max(this.pTotalHeight||0,d+c),d*this.pitchY}},{key:"collides",value:function(e,t){for(var n=this.bitmap,r=t+e.h,a=t;a<r;a+=1){var i=n[a];if(void 0!==i&&!i.isRangeClear(e.l,e.r))return!0}return!1}},{key:"autovivifyRow",value:function(e,t){var n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new u,e[t]=n}return n}},{key:"addRectToBitmap",value:function(e){if(null!==e.top){var t=e.id,n=e.top+e.h;if(e.r-e.l>2e4)for(var r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).setAllFilled(t);else for(var a=e.top;a<n;a+=1)this.autovivifyRow(this.bitmap,a).addRect(e,t)}}},{key:"discardRange",value:function(e,t){for(var n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),a=this.bitmap,i=0;i<a.length;i+=1){var o=a[i];o&&o.discardRange(n,r)}}},{key:"hasSeen",value:function(e){return this.rectangles.has(e)}},{key:"getByCoord",value:function(e,t){var n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(r){var a=Math.floor(e/this.pitchX);return r.getItemAt(a)}}},{key:"getByID",value:function(e){var t=this.rectangles.get(e);if(t){var n=t.top*this.pitchY;return[t.l*this.pitchX,n,t.r*this.pitchX,n+t.originalHeight]}}},{key:"getDataByID",value:function(e){var t;return null===(t=this.rectangles.get(e))||void 0===t?void 0:t.data}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}},{key:"totalHeight",get:function(){return this.getTotalHeight()}},{key:"getRectangles",value:function(){var e=this;return new Map(Array.from(this.rectangles.entries()).map((function(t){var n=(0,a.Z)(t,2),r=n[0],i=n[1],o=i.l,s=i.r,c=i.originalHeight,u=(i.top||0)*e.pitchY,l=u+c;return[r,[o*e.pitchX,u,s*e.pitchX,l]]})))}},{key:"serializeRegion",value:function(e){var t,n={},i=!1,o=(0,r.Z)(this.rectangles.entries());try{for(o.s();!(t=o.n()).done;){var s=(0,a.Z)(t.value,2),u=s[0],l=s[1],d=l.l,f=l.r,p=l.originalHeight,h=l.top;if(null===l.top)i=!0;else{var g=(h||0)*this.pitchY,m=g+p,v=d*this.pitchX,y=f*this.pitchX;c(e.start,e.end,v-this.pitchX,y+this.pitchX)&&(n[u]=[v,g,y,m])}}}catch(b){o.e(b)}finally{o.f()}return{rectangles:n,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:i}}},{key:"toJSON",value:function(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}]),e}()},84613:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(96234),a=n(41361),i=n(9249),o=n(87371),s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.Z)(this,e),this.SubLayoutClass=t,this.subLayoutConstructorArgs=n,this.subLayouts=new Map}return(0,o.Z)(e,[{key:"getDataByID",value:function(e){var t,n=(0,a.Z)(this.subLayouts.values());try{for(n.s();!(t=n.n()).done;){var r=t.value.getDataByID(e);if(r)return r}}catch(i){n.e(i)}finally{n.f()}}},{key:"getSublayout",value:function(e){var t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}},{key:"addRect",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,r,a,i)}},{key:"discardRange",value:function(e,t,n){var r;return null===(r=this.subLayouts.get(e))||void 0===r?void 0:r.discardRange(t,n)}},{key:"toJSON",value:function(){var e,t={},n=(0,a.Z)(this.subLayouts.entries());try{for(n.s();!(e=n.n()).done;){var i=(0,r.Z)(e.value,2),o=i[0],s=i[1];t[o]=s.toJSON()}}catch(c){n.e(c)}finally{n.f()}return t}}]),e}()},43929:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var r=n(96234),a=n(9249),i=n(87371),o=n(36305),s=n.n(o),c=function(){function e(t){var n=t.rectangles,i=t.totalHeight,o=t.maxHeightReached;(0,a.Z)(this,e),this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rbush=void 0,this.rectangles=new Map(Object.entries(n)),this.totalHeight=i,this.maxHeightReached=o,this.rbush=new(s());for(var c=0,u=Object.entries(n);c<u.length;c++){var l=(0,r.Z)(u[c],2),d=l[0],f=l[1];this.rbush.insert({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],name:d})}}return(0,i.Z)(e,[{key:"addRect",value:function(e){var t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}},{key:"getRectangles",value:function(){return this.rectangles}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"collides",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getByCoord",value:function(e,t){var n={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(n)?this.rbush.search(n)[0].name:void 0}},{key:"getByID",value:function(e){return this.rectangles.get(e)}},{key:"addRectToBitmap",value:function(e,t){throw new Error("Method not implemented.")}},{key:"discardRange",value:function(e,t){throw new Error("Method not implemented.")}},{key:"serializeRegion",value:function(e){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}]),e}()},70577:function(e,t,n){"use strict";n.r(t),n.d(t,{GranularRectLayout:function(){return r.Z},MultiLayout:function(){return a.Z},PrecomputedLayout:function(){return i.Z},PrecomputedMultiLayout:function(){return f},SceneGraph:function(){return g}});var r=n(12052),a=n(84613),i=n(43929),o=n(96234),s=n(45754),c=n(13820),u=n(87371),l=n(9249),d=(0,u.Z)((function e(){throw(0,l.Z)(this,e),new Error("invalid layout name")})),f=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,l.Z)(this,n),r=t.call(this,d),Object.entries(e).forEach((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1];r.subLayouts.set(n,new i.Z(a))})),r}return(0,u.Z)(n)}(a.Z),p=n(41361),h=n(97531),g=function(){function e(t,n,r,a,i,o){if((0,l.Z)(this,e),this.name=t,this.left=n,this.top=r,this.width=a,this.height=i,this.data=o,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,h.inDevelopment&&("string"!==typeof t||"number"!==typeof n||Number.isNaN(n)||"number"!==typeof r||Number.isNaN(r)||"number"!==typeof a||Number.isNaN(a)||"number"!==typeof i||Number.isNaN(i)))throw new TypeError("invalid SceneGraph arguments");this.children=new Map,this.absoluteCache={dirty:!0}}return(0,u.Z)(e,[{key:"addChild",value:function(t,n,r,a,i,o){var s;if(!((s=t instanceof e?t:new e(t,n,r,a,i,o))instanceof e))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(s.name))throw new Error('child named "'.concat(s.name,'" already exists'));s.parent=this;var c=s.absolute,u=c.left,l=c.right,d=c.top,f=c.bottom;return void 0!==u&&void 0!==l&&void 0!==d&&void 0!==f&&(this.expand(u,l,d,f),this.children.set(s.name,s)),s}},{key:"getSubRecord",value:function(e){return this.children.get(e)}},{key:"expand",value:function(e,t,n,r){var a=this.absolute,i=a.left,o=a.right,s=a.top,c=a.bottom;if(void 0!==i&&e<i){var u=i-e;this.width+=u,this.left-=u}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==s&&n<s){var l=s-n;this.height+=l,this.top-=l}void 0!==c&&r>c&&(this.height+=r-c),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}},{key:"walkParents",value:function(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}},{key:"walkChildren",value:function(e){var t,n=(0,p.Z)(this.children.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r),r.walkChildren(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"absolute",get:function(){if(this.absoluteCache.dirty){var e=0,t=0;this.walkParents((function(n){e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}},{key:"move",value:function(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((function(e){e.absoluteCache.dirty=!0}));var n=this.absolute,r=n.left,a=n.right,i=n.top,o=n.bottom;void 0!==r&&void 0!==a&&void 0!==i&&void 0!==o&&this.expand(r,a,i,o)}}]),e}()},29151:function(e,t,n){"use strict";n.r(t),n.d(t,{getDefaultValue:function(){return s},getEnumerationValues:function(){return c},getPropertyType:function(){return o},getSubType:function(){return a},getUnionSubTypes:function(){return i},resolveLateType:function(){return u}});var r=n(63680);function a(e){var t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function i(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function o(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function c(e){return i(e).map((function(e){return e.value}))}function u(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},23995:function(e,t,n){"use strict";function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function i(e,t,n,r){return n<=e&&r>=t}n.d(t,{J7:function(){return i},U0:function(){return r},qY:function(){return a}})},85762:function(e,t,n){"use strict";n.d(t,{n:function(){return s},u:function(){return u}});var r=n(32723),a=n(33028),i=n(34795),o=n(63680);function s(e,t){return c.apply(this,arguments)}function c(){return c=(0,i.Z)((0,r.Z)().mark((function e(t,n){var o,s,c,l,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.regions,s=void 0===o?[]:o,c=n.adapterConfig,n.sessionId){e.next=3;break}throw new Error("sessionId is required");case 3:return l=s.map((function(e){return e.assemblyName})),e.t0=Object,e.next=7,Promise.all(l.map(function(){var e=(0,i.Z)((0,r.Z)().mark((function e(a){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.next=3,t.getRefNameMapForAdapter(c,a,n);case 3:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return e.t1=e.sent,d=e.t0.fromEntries.call(e.t0,e.t1),e.abrupt("return",(0,a.Z)((0,a.Z)({},n),{},{regions:s.map((function(e,t){return u(d[l[t]],e)}))}));case 10:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function u(e,t){if((0,o.isStateTreeNode)(t)&&!(0,o.isAlive)(t))return t;if(t&&e&&e[t.refName]){var n=e[(t=(0,o.isStateTreeNode)(t)?(0,a.Z)({},(0,o.getSnapshot)(t)):(0,a.Z)({},t)).refName];if(n)return(0,a.Z)((0,a.Z)({},t),{},{refName:n,originalRefName:t.refName})}return t}},93824:function(e,t,n){"use strict";n.r(t),n.d(t,{ObservableCreate:function(){return o}});var r=n(6160),a=n(13905),i=n(97531);function o(e,t){return r.y.create((function(t){try{var n=e(t);n&&n.catch&&n.catch((function(e){return t.error(e)}))}catch(r){t.error(r)}})).pipe((0,a.R)((0,i.observeAbortSignal)(t)))}},43430:function(e,t,n){"use strict";n.d(t,{T:function(){return o},Z:function(){return c}});var r=n(33028),a=n(9249),i=n(87371);function o(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function s(e){return"uniqueId"in e&&"object"!==typeof e.data}var c=function(){function e(t){var n=this;(0,a.Z)(this,e),this.data=void 0,this.subfeatures=void 0,this.parentHandle=void 0,this.uniqueId=void 0,s(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);var i,o=s(t)?t.uniqueId:t.id;if(void 0===o||null===o)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(o),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(i=this.data.subfeatures)||void 0===i?void 0:i.map((function(t,a){return"function"!==typeof t.get?new e({id:t.uniqueId||"".concat(o,"-").concat(a),data:(0,r.Z)({strand:n.data.strand},t),parent:n}):t})))}return(0,i.Z)(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=(0,r.Z)((0,r.Z)({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e((0,r.Z)({},t))}}]),e}()},74560:function(e,t,n){"use strict";n.d(t,{I9:function(){return u},fK:function(){return l},fY:function(){return f}});var r=n(32723),a=n(34795),i=n(33028),o=n(56218),s=n(59937);function c(e,t,n){var r;return 0===n?0:(arguments.length>3&&void 0!==arguments[3]&&arguments[3]?r=t/n-e*e/(n*n):(r=t-e*e/n,n>1&&(r/=n-1)),r<0?0:Math.sqrt(r))}function u(e){return(0,i.Z)((0,i.Z)({},e),{},{scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:c(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered})}function l(e,t){return d.apply(this,arguments)}function d(){return(d=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,i,c,l,d,f,p,h,g,m;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.start,i=t.end,c={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0},l=!1,e.next=5,(0,o.z)(n.pipe((0,s.u)((function(e,t){var n=t.get("score"),r=t.get("summary"),a=e.scoreMax,i=e.scoreMin;return e.scoreMax=Math.max(a,r?t.get("maxScore"):n),e.scoreMin=Math.min(i,r?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,l=!0,e}),c)));case 5:return d=e.sent,f=d.scoreMin,p=d.scoreMax,h=d.scoreSum,g=d.scoreSumSquares,m=d.featureCount,e.abrupt("return",l?u({scoreMax:p,scoreMin:f,scoreSum:h,scoreSumSquares:g,featureCount:m,basesCovered:i-a+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},16151:function(e,t,n){"use strict";n.r(t),n.d(t,{UNKNOWN:function(){return u},UNSUPPORTED:function(){return l},generateUnknownTrackConf:function(){return C},generateUnsupportedTrackConf:function(){return k},getBlob:function(){return f},getBlobMap:function(){return p},getFileName:function(){return b},getParentRenderProps:function(){return c},getRpcSessionId:function(){return s},getTrackAssemblyNames:function(){return o},getTrackName:function(){return Z},guessAdapter:function(){return x},guessTrackType:function(){return w},makeIndex:function(){return v},makeIndexType:function(){return y},setBlobMap:function(){return h},storeBlobLocation:function(){return m}});var r=n(63680),a=n(97531),i=n(99836);function o(e){var t=(0,i.getConf)(e,"assemblyNames");if(!t){var n=(0,r.getParent)(e.configuration);if("sequence"in n)return[(0,i.readConfObject)(n,"name")]}return t}function s(e){for(var t,n=e;!(0,r.isRoot)(n);n=(0,r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function c(e){for(var t=(0,r.getParent)(e);!(0,r.isRoot)(t);t=(0,r.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}var u="UNKNOWN",l="UNSUPPORTED",d={};function f(e){return d[e]}function p(){return d}function h(e){d=e}var g=0;function m(e){if(e&&"blob"in e){var t="b".concat(+Date.now(),"-").concat(g++);return d[t]=e.blob,{name:null===e||void 0===e?void 0:e.blob.name,blobId:t,locationType:"BlobLocation"}}return e}function v(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function y(e,t,n){return null!==e&&void 0!==e&&e.toUpperCase().endsWith(t)?t:n}function b(e){var t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0;return(null===r||void 0===r?void 0:r.name)||(null===t||void 0===t?void 0:t.slice(t.lastIndexOf("/")+1))||(null===n||void 0===n?void 0:n.slice(n.lastIndexOf("/")+1))||""}function x(e,t,n,r){if(r){var i=(0,a.getEnv)(r).pluginManager.evaluateExtensionPoint("Core-guessAdapterForLocation",(function(e,t,n){}))(e,t,n);if(i)return i}return{type:u}}function w(e,t){if(t){var n=(0,a.getSession)(t),r=(0,a.getEnv)(n).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",(function(e){}))(e);if(r)return r}return"FeatureTrack"}function k(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}function C(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}function Z(e,t){var n=(0,i.readConfObject)(e,"name");if(!n&&"ReferenceSequenceTrack"===(0,i.readConfObject)(e,"type")){var r=t.assemblies.find((function(t){return t.sequence===e}));return r?"Reference sequence (".concat((0,i.readConfObject)(r,"displayName")||(0,i.readConfObject)(r,"name"),")"):"Reference sequence"}return n}},42328:function(e,t,n){"use strict";n.r(t),n.d(t,{BlobLocation:function(){return y},ElementId:function(){return p},FileLocation:function(){return w},LocalPathLocation:function(){return v},NoAssemblyRegion:function(){return g},PropTypes:function(){return h},Region:function(){return m},UriLocation:function(){return x},UriLocationRaw:function(){return b}});var r=n(33028),a=n(59740),i=n(26968),o=n.n(i),s=n(63680),c=n(61113),u=n.n(c),l=n(4782),d=["baseUri"],f=["locationType"],p=s.types.optional(s.types.identifier,o().generate),h={Region:u().shape({refName:u().string.isRequired,start:u().number.isRequired,end:u().number.isRequired}),ConfigSchema:l.PropTypes.objectOrObservableObject,Feature:u().shape({get:u().func.isRequired,id:u().func.isRequired})},g=s.types.model("NoAssemblyRegion",{refName:s.types.string,start:s.types.number,end:s.types.number,reversed:s.types.optional(s.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}})),m=s.types.compose("Region",g,s.types.model({assemblyName:s.types.string})),v=s.types.model("LocalPathLocation",{locationType:s.types.literal("LocalPathLocation"),localPath:s.types.string}),y=s.types.model("BlobLocation",{locationType:s.types.literal("BlobLocation"),name:s.types.string,blobId:s.types.string}),b=s.types.model("UriLocation",{locationType:s.types.literal("UriLocation"),uri:s.types.string,baseUri:s.types.maybe(s.types.string),internetAccountId:s.types.maybe(s.types.string),internetAccountPreAuthorization:s.types.maybe(s.types.model("InternetAccountPreAuthorization",{internetAccountType:s.types.string,authInfo:s.types.frozen()}))}),x=s.types.snapshotProcessor(b,{postProcessor:function(e){var t=e,n=t.baseUri,r=(0,a.Z)(t,d);return n?e:r}}),w=s.types.snapshotProcessor(s.types.union(v,x,y),{preProcessor:function(e){if(e){var t=e,n=t.locationType,i=(0,a.Z)(t,f);if(!n){var o=i.uri,s=i.localPath,c=i.blob,u="";return void 0!==o?u="UriLocation":void 0!==s?u="LocalPathLocation":void 0!==c&&(u="BlobLocation"),(0,r.Z)((0,r.Z)({},i),{},{locationType:u})}return e}}})},24793:function(e,t,n){"use strict";n.r(t),n.d(t,{cigarToMismatches:function(){return h},featurizeSA:function(){return M},getClip:function(){return S},getLength:function(){return C},getLengthOnRef:function(){return k},getLengthSansClipping:function(){return Z},getMismatches:function(){return m},getModificationPositions:function(){return y},getModificationTypes:function(){return b},getNextRefPos:function(){return v},getOrientedCigar:function(){return x},getOrientedMismatches:function(){return w},getTag:function(){return T},mdToMismatches:function(){return g},parseCigar:function(){return p}});var r=n(96234),a=n(46840),i=n(32723),o=n(97531),s=(0,i.Z)().mark(v),c=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi),u=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/),l=new RegExp(/([MIDNSHPX=])/),d=new RegExp(/(\d+)[SH]$/),f=new RegExp(/^(\d+)([SH])/);function p(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(l).slice(0,-1)}function h(e,t,n,r){for(var a=0,i=0,o=[],s=n&&t,c=0;c<e.length;c+=2){var u=+e[c],l=e[c+1];if("M"===l||"="===l||"E"===l){if(s)for(var d=0;d<u;d++)t[i+d].toUpperCase()!==n[a+d].toUpperCase()&&o.push({start:a+d,type:"mismatch",base:t[i+d],altbase:n[a+d],length:1});i+=u}if("I"===l)o.push({start:a,type:"insertion",base:"".concat(u),length:0}),i+=u;else if("D"===l)o.push({start:a,type:"deletion",base:"*",length:u});else if("N"===l)o.push({start:a,type:"skip",base:"N",length:u});else if("X"===l){for(var f=(null===t||void 0===t?void 0:t.slice(i,i+u))||[],p=(null===r||void 0===r?void 0:r.slice(i,i+u))||[],h=0;h<u;h++)o.push({start:a+h,type:"mismatch",base:f[h],qual:p[h],length:1});i+=u}else"H"===l?o.push({start:a,type:"hardclip",base:"H".concat(u),cliplen:u,length:1}):"S"===l&&(o.push({start:a,type:"softclip",base:"S".concat(u),cliplen:u,length:1}),i+=u);"I"!==l&&"S"!==l&&"H"!==l&&(a+=u)}return o}function g(e,t,n,r,a){var i=[],o={start:0,base:"",length:0,type:"mismatch"},s=n.filter((function(e){return"skip"===e.type})),u=0,l=0,d=0,f=0;function p(e){for(var n=l,r=d,a=u;a<t.length&&r<=e;u=a+=2){var i=+t[a],o=t[a+1];"S"===o||"I"===o?n+=i:"D"===o||"P"===o||"N"===o?r+=i:"H"!==o&&(n+=i,r+=i)}return l=n,d=r,n-(r-e)}for(var h=e.match(c)||[],g=0;g<h.length;g++){var m=h[g],v=+m;if(Number.isNaN(v))if(m.startsWith("^"))o.start+=m.length-1;else for(var y=0;y<m.length;y+=1){for(o.length=1;f<s.length;){var b=s[f];if(!(o.start>=b.start))break;o.start+=b.length,f++}var x=p(o.start);o.base=r[x]||"X",o.qual=null===a||void 0===a?void 0:a[x],o.altbase=m,i.push(o),o={start:o.start+o.length,length:0,base:"",type:"mismatch"}}else o.start+=v}return i}function m(e,t,n,r,a){var i=[],o=p(e);return e&&(i=i.concat(h(o,n,r,a))),t&&n&&(i=i.concat(g(t,o,i,n,a))),i}function v(e,t){var n,r,a,o,c,u,l,d;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=0,r=0,a=0,o=0;case 4:if(!(o<e.length&&a<t.length)){i.next=31;break}if(c=+e[o],"S"!==(u=e[o+1])&&"I"!==u){i.next=12;break}for(l=0;l<c&&a<t.length;l++)t[a]===n+l&&a++;n+=c,i.next=28;break;case 12:if("D"!==u&&"N"!==u){i.next=16;break}r+=c,i.next=28;break;case 16:if("M"!==u&&"X"!==u&&"="!==u){i.next=28;break}d=0;case 18:if(!(d<c&&a<t.length)){i.next=26;break}if(t[a]!==n+d){i.next=23;break}return i.next=22,r+d;case 22:a++;case 23:d++,i.next=18;break;case 26:n+=c,r+=c;case 28:o+=2,i.next=4;break;case 31:case"end":return i.stop()}}),s)}function y(e,t,n){for(var i=-1===n?(0,o.revcom)(t):t,s=e.split(";").filter((function(e){return!!e})),c=[],l=0;l<s.length;l++){var d=s[l].split(","),f=(0,a.Z)(d),p=f[0],h=f.slice(1),g=p.match(u);if(!g)throw new Error("bad format for MM tag");var m=(0,r.Z)(g,4),v=m[1],y=m[2],b=m[3].split(/(\d+|.)/).filter((function(e){return!!e}));"-"===y&&(console.warn("unsupported negative strand modifications"),c.push({type:"unsupported",positions:[]}));for(var x=0;x<b.length;x++){for(var w=b[x],k=0,C=[],Z=0;Z<h.length;Z++){var S=+h[Z];do{"N"!==v&&v!==i[k]||S--,k++}while(S>=0&&k<i.length);var T=k-1;C.push(-1===n?i.length-1-T:T)}-1===n&&C.sort((function(e,t){return e-t})),c.push({type:w,positions:C})}}return c}function b(e){return e.split(";").filter((function(e){return!!e})).map((function(t){var n=t.split(","),a=(0,r.Z)(n,1)[0].match(u);if(!a)throw new Error("bad format for MM tag: ".concat(e));return(0,r.Z)(a,4)[3].split(/(\d+|.)/).filter((function(e){return!!e}))})).flat()}function x(e,t){if(e){for(var n=[],r=0;r<t.length;r+=2){var a=t[r],i=t[r+1];"D"===i?i="I":"I"===i&&(i="D"),n.push(a),n.push(i)}return n}return t}function w(e,t){var n=p(t);return h(e?x(e,n):n)}function k(e){for(var t=p(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"I"!==i&&(n+=a)}return n}function C(e){for(var t=p(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"D"!==i&&"N"!==i&&(n+=a)}return n}function Z(e){for(var t=p(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"D"!==i&&"N"!==i&&(n+=a)}return n}function S(e,t){return-1===t?+(e.match(d)||[])[1]||0:+(e.match(f)||[])[1]||0}function T(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function M(e,t,n,a,i){return(null===e||void 0===e?void 0:e.split(";").filter((function(e){return!!e})).map((function(e,o){var s=e.split(","),c=(0,r.Z)(s,4),u=c[0],l=c[1],d=c[2],f=c[3],p=k(f),h=C(f),g=Z(f),m="-"===d?-1:1,v=S(f,(i?n:1)*m),y=+l-1;return{refName:u,start:y,end:y+p,seqLength:h,clipPos:v,CIGAR:f,strand:(i?n:1)*m,uniqueId:"".concat(t,"_SA").concat(o),mate:{start:v,end:v+g,refName:a}}})))||[]}},64459:function(e,t,n){"use strict";n.r(t),n.d(t,{capabilities:function(){return Z},default:function(){return C}});var r=n(96234),a=n(32723),i=n(34795),o=n(9249),s=n(87371),c=n(45754),u=n(13820),l=n(82972),d=n(43430),f=n(93824),p=n(66043),h=n(56218),g=n(41361),m=n(95920),v=n(24793);function y(e){return b(e.type)?1:e.length}function b(e){return"softclip"===e||"hardclip"===e||"insertion"===e}function x(e,t,n,r){var a=e[n][r];void 0===a&&(a=e[n][r]={total:0,"-1":0,0:0,1:0}),a.total++,a[t]++}function w(e,t,n,r){return k.apply(this,arguments)}function k(){return(k=(0,i.Z)((0,a.Z)().mark((function e(t,n,r,i){var o,s,c,u,l,d,f,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.colorBy,c=Math.ceil(n.end-n.start),u={},!t.length||!(0,m.ES)(null===(o=r.colorBy)||void 0===o?void 0:o.type)){e.next=9;break}return e.next=6,i(n);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=void 0;case 10:l=e.t0,d=[],f=(0,a.Z)().mark((function e(){var r,i,o,f,h,w,k,C,Z,S,T,M,P,R,A,L,N,j,F,I,B,D,E,V,z,O,W,H,G,q,U,_,J,X;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t[p],i=r.get("start"),o=r.get("end"),f=r.get("strand"),h=i;h<o+1;h++)(w=h-n.start)>=0&&w<c&&(void 0===d[w]&&(d[w]={total:0,all:0,ref:0,"-1":0,0:0,1:0,lowqual:{},cov:{},delskips:{},noncov:{}}),h!==o&&(d[w].total++,d[w].all++,d[w].ref++,d[w][f]++));if("modifications"!==(null===s||void 0===s?void 0:s.type)){e.next=13;break}k=r.get("seq"),C=(0,m.TN)(r,"MM","Mm")||"",Z=(0,v.parseCigar)(r.get("CIGAR")),S=r.get("end"),(0,v.getModificationPositions)(C,k,f).forEach((function(e){var t,r=e.type,a=e.positions,o="mod_".concat(r),s=(0,g.Z)((0,v.getNextRefPos)(Z,a));try{for(s.s();!(t=s.n()).done;){var c=t.value,u=c+i-n.start;if(u>=0&&u<d.length&&c+i<S){var l=d[u];l?x(l,f,"cov",o):console.warn("Undefined position in modifications snpcoverage encountered")}}}catch(p){s.e(p)}finally{s.f()}})),e.next=22;break;case 13:if("methylation"!==(null===s||void 0===s?void 0:s.type)){e.next=22;break}if(l){e.next=16;break}throw new Error("no region sequence detected, need sequenceAdapter configuration");case 16:for(T=r.get("seq"),M=(0,m.TN)(r,"MM","Mm")||"",P=new Array(n.end-n.start).fill(0),R=(0,v.parseCigar)(r.get("CIGAR")),(0,v.getModificationPositions)(M,T,f).forEach((function(e){var t=e.type,r=e.positions;if("m"===t){var a,o=(0,g.Z)((0,v.getNextRefPos)(R,r));try{for(o.s();!(a=o.n()).done;){var s=a.value+i-n.start;s>=0&&s<P.length&&(P[s]=1)}}catch(c){o.e(c)}finally{o.f()}}})),A=i;A<o;A++)(L=A-n.start)>=0&&L<d.length-1&&(N=l[L].toLowerCase(),j=l[L+1].toLowerCase(),F=d[L],I=d[L+1],"c"===N&&"g"===j&&(P[L]||P[L+1]?(x(F,f,"cov","meth"),x(I,f,"cov","meth"),d[L].ref--,d[L][f]--,d[L+1].ref--,d[L+1][f]--):(x(F,f,"cov","unmeth"),x(I,f,"cov","unmeth"),d[L].ref--,d[L][f]--,d[L+1].ref--,d[L+1][f]--)));case 22:for(B=r.get("mismatches")||[],D="modifications"!==(null===s||void 0===s?void 0:s.type)&&"methylation"!==(null===s||void 0===s?void 0:s.type),E=0;E<B.length;E++){for(V=B[E],z=i+V.start,O=y(V),W=z+O,H=z;H<z+O;H++)(G=H-n.start)>=0&&G<d.length&&(q=d[G],U=V.base,_=V.type,(J=b(_))?x(q,f,"noncov",_):(q.ref--,q[f]--),"deletion"===_||"skip"===_?(x(q,f,"delskips",_),q.total--):!J&&D&&(x(q,f,"cov",U),q.refbase=V.altbase));"skip"===V.type&&(X="".concat(z,"_").concat(W,"_").concat(f),void 0===u[X]&&(u[X]={feature:r,start:z,end:W,strand:f,xs:(0,m.h1)(r,"XS")||(0,m.h1)(r,"TS"),score:0}),u[X].score++)}case 25:case"end":return e.stop()}}),e)})),p=0;case 14:if(!(p<t.length)){e.next=19;break}return e.delegateYield(f(),"t1",16);case 16:p++,e.next=14;break;case 19:return e.abrupt("return",{bins:d,skipmap:u});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"configure",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getConf("subadapter"),i=r.sequenceAdapter,e.next=4,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 4:if(o=e.sent,!i){e.next=11;break}return e.next=8,null===(n=this.getSubAdapter)||void 0===n?void 0:n.call(this,i);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=void 0;case 12:if(s=e.t0,o){e.next=15;break}throw new Error("Failed to get subadapter");case 15:return e.abrupt("return",{subadapter:o.dataAdapter,sequenceAdapter:null===s||void 0===s?void 0:s.dataAdapter});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchSequence",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(n=e.sent,r=n.sequenceAdapter){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",(0,m.O)(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,f.ObservableCreate)(function(){var o=(0,i.Z)((0,a.Z)().mark((function i(o){var s,c,u,l,f,g;return(0,a.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.configure();case 2:return s=a.sent,c=s.subadapter,a.next=6,(0,h.z)(c.getFeatures(e,n).pipe((0,p.q)()));case 6:return u=a.sent,a.next=9,w(u,e,n,(function(e){return t.fetchSequence(e)}));case 9:l=a.sent,f=l.bins,g=l.skipmap,f.forEach((function(n,r){var a=e.start+r;o.next(new d.Z({id:"".concat(t.id,"-").concat(a),data:{score:n.total,snpinfo:n,start:a,end:a+1,refName:e.refName}}))})),Object.entries(g).forEach((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];o.next(new d.Z({id:n,data:{type:"skip",start:a.start,end:a.end,strand:a.strand,score:a.score,xs:a.xs}}))})),o.complete();case 15:case"end":return a.stop()}}),i)})));return function(e){return o.apply(this,arguments)}}(),n.signal)}},{key:"estimateRegionsStats",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,i=r.subadapter,e.abrupt("return",i.estimateRegionsStats(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.configure();case 3:return n=e.sent,r=n.subadapter,e.abrupt("return",r.getRefNames(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(l.BaseFeatureDataAdapter),Z=C.capabilities},24839:function(e,t,n){"use strict";n.d(t,{tr:function(){return D},ZP:function(){return Vt},Ct:function(){return xt},$:function(){return Dt}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(5868),u=n(99836);var l=(0,u.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0}),d=function(e){e.addAdapterType((function(){return new c.Z({name:"CramAdapter",displayName:"CRAM adapter",configSchema:l,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(2094),n.e(2018),n.e(3472),n.e(7445),n.e(2142),n.e(6443)]).then(n.bind(n,26443)).then((function(e){return e.default}))}})}))},f=n(63680);var p=(0,u.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,u.ConfigurationSchema)("BamIndex",{indexType:{model:f.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),h=function(e){e.addAdapterType((function(){return new c.Z({name:"BamAdapter",displayName:"BAM adapter",configSchema:p,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2094),n.e(1343),n.e(7776)]).then(n.bind(n,37776)).then((function(e){return e.default}))}})}))};var g=(0,u.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),m=function(e){e.addAdapterType((function(){return new c.Z({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:g,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2094),n.e(1343),n.e(3344)]).then(n.bind(n,23344)).then((function(e){return e.default}))}})}))};var v=(0,u.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0}),y=n(64459);function b(e){e.addAdapterType((function(){return new c.Z({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.resolve().then(n.bind(n,64459)).then((function(e){return e.default}))},configSchema:v,adapterCapabilities:y.capabilities})}))}var x=(0,u.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0}),w=n(32723),k=n(68079),C=n(33028),Z=n(96234),S=n(34795),T=n(46186),M=n(97531),P=n(67903),R=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"draw",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,l,d,f,p,h,g,m,v,y,b,x,S,R,A,L,N,j,F,I,B,D,E,V,z,O,W,H,G,q,U,_,J,X,Y,Q,K,$,ee,te,ne,re,ae,ie,oe,se,ce,ue,le,de,fe,pe,he,ge,me,ve,ye,be,xe,we,ke,Ce,Ze,Se,Te,Me,Pe,Re,Ae,Le,Ne,je,Fe,Ie,Be,De,Ee,Ve,ze;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.features,a=n.regions,i=n.bpPerPx,o=n.displayCrossHatches,s=n.modificationTagMap,c=void 0===s?{}:s,l=n.scaleOpts,d=n.height,f=n.theme,p=n.config,h=n.ticks,g=(0,T.createJBrowseTheme)(f),m=(0,Z.Z)(a,1),v=m[0],y=(v.end-v.start)/i,b=P.Rv,x=d-2*b,l.domain){e.next=9;break}return e.abrupt("return");case 9:for(S=(0,C.Z)((0,C.Z)({},l),{},{range:[0,x]}),R=(0,P.yZ)(S),A=(0,P.yZ)((0,C.Z)((0,C.Z)({},S),{},{range:[0,x/2],scaleType:"linear"})),L=(0,P.P$)(l.scaleType),N=(0,u.readConfObject)(p,"indicatorThreshold"),j=(0,u.readConfObject)(p,"drawInterbaseCounts"),F=(0,u.readConfObject)(p,"drawArcs"),I=(0,u.readConfObject)(p,"drawIndicators"),B=function(e){return x-(R(e)||0)+b},D=function(e){return B(L)-B(e)},E=function(e){return x-(A(e)||0)+b},V=function(e){return E((0,P.P$)("linear"))-E(e)},z=g.palette.bases,O={A:z.A.main,C:z.C.main,G:z.G.main,T:z.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red",meth:"red",unmeth:"blue",ref:"lightgrey"},W=(0,k.Z)(r.values()),H=W.filter((function(e){return"skip"!==e.get("type")})),G=W.filter((function(e){return"skip"===e.get("type")})),t.fillStyle=O.total,q=0;q<H.length;q++)U=H[q],_=(0,M.featureSpanPx)(U,v,i),J=(0,Z.Z)(_,2),X=J[0],Y=J[1],Q=Y-X+.3,K=U.get("score"),t.fillRect(X,B(K),Q,D(K));for($=0,ee=v.reversed?1/i:0,te=0;te<H.length;te++){for(ne=H[te],re=(0,M.featureSpanPx)(ne,v,i),ae=(0,Z.Z)(re,2),ie=ae[0],oe=ae[1],se=ne.get("score"),ce=ne.get("snpinfo"),ue=Math.max(oe-ie+.3,1),le=ce.total,de=Object.keys(ce.cov).sort(),fe=0,pe=0;pe<de.length;pe++)he=de[pe],ge=ce.cov[he].total,t.fillStyle=O[he]||c[he.replace("mod_","")]||"#888",me=D(se),ve=B(se)+me,t.fillRect(ie,ve-(ge+fe)/se*me,ue,ge/se*me),fe+=ge;if(ye=Object.keys(ce.noncov),4.5,j)for(be=0,xe=0;xe<ye.length;xe++)we=ye[xe],ke=ce.noncov[we].total,t.fillStyle=O[we],t.fillRect(ie-.6+ee,4.5+V(be),1.2,V(ke)),be+=ke;if(I){for(Ce=0,Ze=0,Se="",Te=0;Te<ye.length;Te++)Me=ye[Te],Pe=ce.noncov[Me].total,Ce+=Pe,Pe>Ze&&(Ze=Pe,Se=Me);Re=Math.max(le,$),Ce>Re*N&&Re>7&&(t.fillStyle=O[Se],t.beginPath(),Ae=ie+ee,t.moveTo(Ae-3.5,0),t.lineTo(Ae+3.5,0),t.lineTo(Ae,4.5),t.fill())}$=le}if(F)for(Le=0;Le<G.length;Le++)Ne=G[Le],je=(0,M.bpSpanPx)(Ne.get("start"),Ne.get("end"),v,i),Fe=(0,Z.Z)(je,2),Ie=Fe[0],Be=Fe[1],t.beginPath(),De=Ne.get("strand"),Ee=Ne.get("xs"),Ve="rgba(255,200,200,0.7)",ze="rgba(200,200,255,0.7)","rgba(200,200,200,0.7)",t.strokeStyle="+"===Ee?Ve:"-"===Ee?ze:1===De?Ve:-1===De?ze:"rgba(200,200,200,0.7)",t.lineWidth=Math.log(Ne.get("score")+1),t.moveTo(Ie,x-2*b),t.bezierCurveTo(Ie,0,Be,0,Be,x-2*b),t.stroke();o&&(t.lineWidth=1,t.strokeStyle="rgba(140,140,140,0.8)",h.values.forEach((function(e){t.beginPath(),t.moveTo(0,Math.round(B(e))),t.lineTo(y,Math.round(B(e))),t.stroke()})));case 33:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(P.Aq);function A(e){e.addRendererType((function(){return new R({name:"SNPCoverageRenderer",ReactComponent:P.Eh,configSchema:x,pluginManager:e})}))}var L=n(41361),N=n(93069),j=n(95058),F=n(66568),I=n(31440),B=n(75019),D=n(24793),E=n(95920),V=n(16001),z=n.n(V),O=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).sortedBy=void 0,a.filterBy=void 0,a.showSoftClip=!1,a.cachedLayout=void 0,a.config=e.config,a}return(0,a.Z)(n,[{key:"cachedLayoutIsValid",value:function(e){return(0,N.Z)((0,j.Z)(n.prototype),"cachedLayoutIsValid",this).call(this,e)&&this.showSoftClip===e.showSoftClip&&z()(this.sortedBy,e.sortedBy)&&z()(this.filterBy,e.filterBy)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,u.readConfObject)(this.config),filters:this.filters,filterBy:this.filterBy,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}]),n}(F.LayoutSession);function W(e,t,n,r,a,i,o){t+r<0||t>i||(o&&(e.fillStyle=o),e.fillRect(t,n,r,a))}function H(e){var t=e.palette.bases;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}var G={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"};var q=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return(0,a.Z)(s,[{key:"getCharWidthHeight",value:function(){return{charWidth:(0,M.measureText)("A"),charHeight:(0,M.measureText)("M")-2}}},{key:"layoutFeature",value:function(e){var t=e.feature,n=e.layout,r=e.bpPerPx,a=e.region,i=e.showSoftClip,o=e.heightPx,s=e.displayMode,c=0,u=0;if(i){var l=t.get("mismatches");if(t.get("seq")&&l)for(var d=0;d<l.length;d+=1){var f=l[d],p=f.type,h=f.start,g=f.cliplen,m=void 0===g?0:g;"softclip"===p&&(0===h?c=m:u=m)}}var v=(0,M.bpSpanPx)(t.get("start")-c,t.get("end")+u,a,r),y=(0,Z.Z)(v,2),b=y[0],x=y[1];if("compact"===s&&(o/=3),t.get("refName")!==a.refName)throw new Error("feature ".concat(t.id()," is not on the current region's reference sequence ").concat(a.refName));var w=n.addRect(t.id(),t.get("start")-c,t.get("end")+u,o,t);return null===w?null:{feature:t,leftPx:b,rightPx:x,topPx:"collapse"===s?0:w,heightPx:o}}},{key:"getExpandedRegion",value:function(e,t){var n=t.config,r=t.showSoftClip,a=(0,u.readConfObject)(n,"maxClippingSize"),i=e.start,o=e.end,s=r?Math.round(a):0;return(0,C.Z)((0,C.Z)({},e),{},{start:Math.floor(Math.max(i-s,0)),end:Math.ceil(o+s)})}},{key:"colorByOrientation",value:function(e,t){return G[this.getOrientation(e,t)||"color_nostrand"]}},{key:"getOrientation",value:function(e,t){var n=(0,u.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[E.uD[n][e.get("pair_orientation")]]}},{key:"colorByInsertSize",value:function(e,t){return e.get("is_paired")&&e.get("refName")!==e.get("next_ref")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}},{key:"colorByStranded",value:function(e,t){var n=e.get("flags"),r=e.get("strand");if(1&n){var a=64&n?-1:1;return 2&n?r*a===1?"color_rev_strand":"color_fwd_strand":e.get("multi_segment_next_segment_unmapped")?r*a===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_refName")?r*a===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return 1===r?"color_fwd_strand":"color_rev_strand"}},{key:"colorByPerBaseLettering",value:function(e){for(var t=e.ctx,n=e.feat,r=e.region,a=e.bpPerPx,i=e.colorForBase,o=e.contrastForBase,s=e.charWidth,c=e.charHeight,u=e.canvasWidth,l=c-2,d=n.feature,f=n.topPx,p=n.heightPx,h=d.get("seq"),g=(0,D.parseCigar)(d.get("CIGAR")),m=1/a,v=d.get("start"),y=0,b=0,x=0;x<g.length;x+=2){var w=+g[x],k=g[x+1];if("S"===k||"I"===k)y+=w;else if("D"===k||"N"===k)b+=w;else if("M"===k||"X"===k||"="===k){for(var C=0;C<w;C++){var S=h[y+C],T=v+b+C,P=(0,M.bpSpanPx)(T,T+1,r,a),R=(0,Z.Z)(P,1)[0];W(t,R,f,m+.5,p,u,i[S]),m>=s&&p>=l&&(t.fillStyle=o[S],t.fillText(S,R+(m-s)/2+1,f+p))}y+=w,b+=w}}}},{key:"colorByPerBaseQuality",value:function(e){for(var t=e.ctx,n=e.feat,r=e.region,a=e.bpPerPx,i=e.canvasWidth,o=n.feature,s=n.topPx,c=n.heightPx,u=(o.get("qual")||"").split(" ").map((function(e){return+e})),l=(0,D.parseCigar)(o.get("CIGAR")),d=1/a,f=o.get("start"),p=0,h=0,g=0;g<l.length;g+=2){var m=+l[g],v=l[g+1];if("S"===v||"I"===v)p+=m;else if("D"===v||"N"===v)h+=m;else if("M"===v||"X"===v||"="===v){for(var y=0;y<m;y++){var b=u[p+y],x=(0,M.bpSpanPx)(f+h+y,f+h+y+1,r,a);W(t,(0,Z.Z)(x,1)[0],s,d+.5,c,i,"hsl(".concat(255===b?150:1.5*b,",55%,50%)"))}p+=m,h+=m}}}},{key:"colorByModifications",value:function(e){for(var t=e.ctx,n=e.feat,r=e.region,a=e.bpPerPx,i=e.renderArgs,o=e.canvasWidth,s=n.feature,c=n.topPx,u=n.heightPx,l=i.Color,d=i.modificationTagMap,f=void 0===d?{}:d,p=(0,E.TN)(s,"MM","Mm")||"",h=(0,E.TN)(s,"ML","Ml")||[],g=h?("string"===typeof h?h.split(",").map((function(e){return+e})):h).map((function(e){return e/255})):(0,E.TN)(s,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),m=s.get("CIGAR"),v=s.get("start"),y=s.get("seq"),b=s.get("strand"),x=(0,D.parseCigar)(m),w=(0,D.getModificationPositions)(p,y,b),k=0,C=0;C<w.length;C++){var S,T=w[C],P=T.type,R=T.positions,A=f[P]||"black",N=l(A),j=(0,L.Z)((0,D.getNextRefPos)(x,R));try{for(j.s();!(S=j.n()).done;){var F=v+S.value,I=(0,M.bpSpanPx)(F,F+1,r,a),B=(0,Z.Z)(I,2),V=B[0],z=B[1],O=g[k];W(t,V,c,z-V+.5,u,o,O&&1!==O?N.alpha(O+.1).hsl().string():A),k++}}catch(H){j.e(H)}finally{j.f()}}}},{key:"colorByMethylation",value:function(e){var t=e.ctx,n=e.feat,r=e.region,a=e.bpPerPx,i=e.renderArgs,o=e.canvasWidth,s=i.regionSequence,c=n.feature,u=n.topPx,l=n.heightPx,d=(0,E.TN)(c,"MM","Mm")||"";if(!s)throw new Error("region sequence required for methylation");for(var f=c.get("CIGAR"),p=c.get("start"),h=c.get("end"),g=c.get("seq"),m=c.get("strand"),v=(0,D.parseCigar)(f),y=new Array(r.end-r.start).fill(0),b=(0,D.getModificationPositions)(d,g,m),x=0;x<b.length;x++){var w=b[x],k=w.type,C=w.positions;if("m"===k&&C){var S,T=(0,L.Z)((0,D.getNextRefPos)(v,C));try{for(T.s();!(S=T.n()).done;){var P=S.value+p-r.start;P>=0&&P<y.length&&(y[P]=1)}}catch(J){T.e(J)}finally{T.f()}}}for(var R=p;R<h;R++){var A=R-r.start;if(A>=0&&A<y.length){var N=s[A].toLowerCase(),j=s[A+1].toLowerCase();if(a>2){if("c"===N&&"g"===j){var F=r.start+A,I=(0,M.bpSpanPx)(F,F+2,r,a),B=(0,Z.Z)(I,2),V=B[0];W(t,V,u,B[1]-V+.5,l,o,y[A]||y[A+1]?"red":"blue")}}else if("c"===N&&"g"===j){var z=r.start+A,O=(0,M.bpSpanPx)(z,z+1,r,a),H=(0,Z.Z)(O,2),G=H[0];W(t,G,u,H[1]-G+.5,l,o,y[A]?"red":"blue");var q=(0,M.bpSpanPx)(z+1,z+2,r,a),U=(0,Z.Z)(q,2),_=U[0];W(t,_,u,U[1]-_+.5,l,o,y[A+1]?"red":"blue")}}}}},{key:"drawRect",value:function(e,t,n){var r=n.regions,a=n.bpPerPx,i=t.heightPx,o=t.topPx,s=t.feature,c=(0,Z.Z)(r,1)[0],u=(0,M.bpSpanPx)(s.get("start"),s.get("end"),c,a),l=(0,Z.Z)(u,2),d=l[0],f=l[1],p=c.reversed?-1:1,h=s.get("strand")*p;a<10?-1===h?(e.beginPath(),e.moveTo(d-5,o+i/2),e.lineTo(d,o+i),e.lineTo(f,o+i),e.lineTo(f,o),e.lineTo(d,o),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(d,o),e.lineTo(d,o+i),e.lineTo(f,o+i),e.lineTo(f+5,o+i/2),e.lineTo(f,o),e.closePath(),e.fill()):e.fillRect(d,o,f-d,i)}},{key:"drawAlignmentRect",value:function(e){var t=e.ctx,n=e.feat,r=e.renderArgs,a=e.colorForBase,i=e.contrastForBase,o=e.charWidth,s=e.charHeight,c=e.defaultColor,l=e.canvasWidth,d=r.config,f=r.bpPerPx,p=r.regions,h=r.colorBy,g=r.colorTagMap,m=void 0===g?{}:g,v=h||{},y=v.tag,b=void 0===y?"":y,x=v.type,w=void 0===x?"":x,k=n.feature,C=p[0];switch(w){case"insertSize":t.fillStyle=this.colorByInsertSize(k,d);break;case"strand":t.fillStyle=-1===k.get("strand")?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":t.fillStyle="hsl(".concat(k.get("mq"),",50%,50%)");break;case"pairOrientation":t.fillStyle=this.colorByOrientation(k,d);break;case"stranded":t.fillStyle=G[this.colorByStranded(k,d)];break;case"xs":case"tag":var Z=k.get("tags"),S=Z?Z[b]:k.get(b);if("XS"===b||"TS"===b){t.fillStyle=G[{"-":"color_rev_strand","+":"color_fwd_strand"}[S]||"color_nostrand"]}if("ts"===b){var T={"-":-1===k.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===k.get("strand")?"color_rev_strand":"color_fwd_strand"};t.fillStyle=G[T[S]||"color_nostrand"]}else{var M=m[S];t.fillStyle=M||G.color_nostrand}break;case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":16&k.get("flags")?t.fillStyle="#c8dcc8":t.fillStyle="#c8c8c8";break;default:t.fillStyle=c?"#c8c8c8":(0,u.readConfObject)(d,"color",{feature:k})}switch(this.drawRect(t,n,r),w){case"perBaseQuality":this.colorByPerBaseQuality({ctx:t,feat:n,region:C,bpPerPx:f,canvasWidth:l});break;case"perBaseLettering":this.colorByPerBaseLettering({ctx:t,feat:n,region:C,bpPerPx:f,colorForBase:a,contrastForBase:i,charWidth:o,charHeight:s,canvasWidth:l});break;case"modifications":this.colorByModifications({ctx:t,feat:n,region:C,bpPerPx:f,renderArgs:r,canvasWidth:l});break;case"methylation":this.colorByMethylation({ctx:t,feat:n,region:C,bpPerPx:f,renderArgs:r,canvasWidth:l})}}},{key:"drawMismatches",value:function(e){var t=e.ctx,n=e.feat,r=e.renderArgs,a=e.minSubfeatureWidth,i=e.largeInsertionIndicatorScale,o=e.mismatchAlpha,s=e.charWidth,c=e.charHeight,u=e.colorForBase,l=e.contrastForBase,d=e.canvasWidth,f=e.drawSNPsMuted,p=e.drawIndels,h=void 0===p||p,g=r.Color,m=r.bpPerPx,v=r.regions,y=n.heightPx,b=n.topPx,x=n.feature,w=(0,Z.Z)(v,1)[0],k=x.get("start"),C=Math.min(1/m,2),S=Math.max(a,C),T=x.get("mismatches"),P=c-2,R=w.reversed?1/m+1:-1;if(T){for(var A=0;A<T.length;A+=1){var L=T[A],N=k+L.start,j=L.length,F=L.base,I=(0,M.bpSpanPx)(N,N+j,w,m),B=(0,Z.Z)(I,2),D=B[0],E=B[1],V=Math.max(a,Math.abs(D-E));if("mismatch"===L.type){if(!f){var z=u[L.base]||"#888";W(t,D,b,V,y,d,o&&void 0!==L.qual?g(z).alpha(Math.min(1,L.qual/50)).hsl().string():z)}if(V>=s&&y>=P){var O=f?"black":l[L.base]||"black";t.fillStyle=o&&void 0!==L.qual?g(O).alpha(Math.min(1,L.qual/50)).hsl().string():O,t.fillText(F,D+(V-s)/2+1,b+y)}}else if("deletion"===L.type&&h){W(t,D,b,Math.abs(D-E),y,d,u.deletion);var H="".concat(L.length),G=(0,M.measureText)(H,10);V>=G&&y>=P&&(t.fillStyle=l.deletion,t.fillText(H,(D+E)/2-G/2,b+y))}else if("insertion"===L.type&&h){t.fillStyle="purple";var q=D+R,U=+L.base||L.length,_=Math.max(0,Math.min(1.2,1/m));U<10&&(W(t,q,b,_,y,d,"purple"),1/m>=s&&y>=P&&(W(t,q-_,b,3*_,1,d),W(t,q-_,b+y-1,3*_,1,d),t.fillText("(".concat(L.base,")"),q+3,b+y)))}else if("hardclip"===L.type||"softclip"===L.type){var J=D+R;W(t,J,b,S,y,d,"hardclip"===L.type?"red":"blue"),1/m>=s&&y>=P&&(W(t,J-S,b,3*S,1,d),W(t,J-S,b+y-1,3*S,1,d),t.fillText("(".concat(L.base,")"),J+3,b+y))}else if("skip"===L.type&&D+V>0){var X=V-(m>10?1.5:0);t.clearRect(D,b,X,y),W(t,Math.max(0,D),b+y/2-1,X+(D<0?D:0),2,d,"#333")}}if(h)for(var Y=0;Y<T.length;Y+=1){var Q=T[Y],K=k+Q.start,$=Q.length,ee=(0,M.bpSpanPx)(K,K+$,w,m),te=(0,Z.Z)(ee,1)[0],ne=+Q.base||Q.length,re="".concat(ne);if("insertion"===Q.type&&ne>=10)if(m>i)W(t,te-1,b,2,y,d,"purple");else if(y>c){var ae=(0,M.measureText)(re);W(t,te-ae/2-5,b,ae+10,y,d,"purple"),t.fillStyle="white",t.fillText(re,te-ae/2,b+y)}else{W(t,te-2,b,4,y,d,"purple")}}}}},{key:"drawSoftClipping",value:function(e){var t=e.ctx,n=e.feat,r=e.renderArgs,a=e.config,i=e.theme,o=e.canvasWidth,s=n.feature,c=n.topPx,l=n.heightPx,d=r.regions,f=r.bpPerPx,p=(0,Z.Z)(d,1)[0],h=(0,u.readConfObject)(a,"minSubfeatureWidth"),g=s.get("mismatches"),m=s.get("seq"),v=this.getCharWidthHeight(),y=v.charWidth,b=v.charHeight,x=i.palette.bases,w={A:x.A.main,C:x.C.main,G:x.G.main,T:x.T.main,deletion:"#808080"};m&&g&&g.filter((function(e){return"softclip"===e.type})).forEach((function(e){for(var n=e.cliplen||0,r=s.get("start"),a=0===e.start?r-n:r+e.start,u=0;u<n;u+=1){var d=m.charAt(u+e.start);if(!d)return;var g=(0,M.bpSpanPx)(a+u,a+u+1,p,f),v=(0,Z.Z)(g,2),x=v[0],k=v[1],C=Math.max(h,k-x),S=w[d]||"#000000";t.fillStyle=S,W(t,x,c,C,l,o),C>=y&&l>=b-5&&(t.fillStyle=i.palette.getContrastText(S),t.fillText(d,x+(C-y)/2+1,c+l))}}))}},{key:"makeImageData",value:function(e){var t=e.ctx,n=e.layoutRecords,r=e.canvasWidth,a=e.renderArgs,i=a.layout,o=a.config,s=a.showSoftClip,c=a.colorBy,l=a.theme,d=(0,u.readConfObject)(o,"mismatchAlpha"),f=(0,u.readConfObject)(o,"minSubfeatureWidth"),p=(0,u.readConfObject)(o,"largeInsertionIndicatorScale"),h="#f0f"===(0,u.readConfObject)(o,"color"),g=(0,T.createJBrowseTheme)(l),m=H(g),v=function(e){return Object.fromEntries(Object.entries(H(e)).map((function(t){var n=(0,Z.Z)(t,2),r=n[0],a=n[1];return[r,e.palette.getContrastText(a)]})))}(g);if(!i)throw new Error("layout required");if(!i.addRect)throw new Error("invalid layout object");t.font="bold 10px Courier New,monospace";for(var y,b=this.getCharWidthHeight(),x=b.charWidth,w=b.charHeight,k=(y=null===c||void 0===c?void 0:c.type,["methylation","modifications"].includes(y||"")),C=(null===c||void 0===c||c.type,!0),S=0;S<n.length;S++){var M=n[S];null!==M&&(this.drawAlignmentRect({ctx:t,feat:M,renderArgs:a,defaultColor:h,colorForBase:m,contrastForBase:v,charWidth:x,charHeight:w,canvasWidth:r}),this.drawMismatches({ctx:t,feat:M,renderArgs:a,mismatchAlpha:d,drawSNPsMuted:k,drawIndels:C,largeInsertionIndicatorScale:p,minSubfeatureWidth:f,charWidth:x,charHeight:w,colorForBase:m,contrastForBase:v,canvasWidth:r}),s&&this.drawSoftClipping({ctx:t,feat:M,renderArgs:a,config:o,theme:g,canvasWidth:r}))}}},{key:"layoutFeats",value:function(e){var t=this,n=e.layout,r=e.features,a=e.sortedBy,i=e.config,o=e.bpPerPx,s=e.showSoftClip,c=e.regions,l=(0,Z.Z)(c,1)[0];if(!n)throw new Error("layout required");if(!n.addRect)throw new Error("invalid layout object");var d=null!==a&&void 0!==a&&a.type&&l.start===a.pos?function(e,t){var n=Array.from(e.values()),r=[],a=[],i=t.pos,o=t.type;n.forEach((function(e){var t=e,n=t.get("start"),o=t.get("end");(0,M.doesIntersect2)(i-1,i,n,o)?r.push(e):a.push(e)}));var s=!!n.length&&n[0].get("tags");switch(o){case"Start location":r.sort((function(e,t){return e.get("start")-t.get("start")}));break;case"tag":var c=t.tag,u=function(e,t){return s?e.get("tags")[t]:e.get(t)};r[0]&&"string"===typeof u(r[0],c)?r.sort((function(e,t){return u(t,c).localeCompare(u(e,c))})):r.sort((function(e,t){return(u(t,c)||0)-(u(e,c)||0)}));break;case"Base pair":var l=[];r.forEach((function(e){e.get("mismatches").forEach((function(t){var n=e.get("start")+t.start+1,r="insertion"===t.type||"softclip"===t.type?0:t.length;i>=n&&i<n+r&&l.push([e.id(),t])}))}));var d=new Map(l);r.sort((function(e,t){var n=d.get(e.id()),r=d.get(t.id()),a=r&&r.base.toUpperCase(),i=n&&n.base.toUpperCase();return a===i&&"*"===a?n.length-r.length:(a?a.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break;case"Read strand":r.sort((function(e,t){return e.get("strand")<=t.get("strand")?1:-1}))}return new Map(r.concat(a).map((function(e){return[e.id(),e]})))}(r,a):r,f=(0,u.readConfObject)(i,"height"),p=(0,u.readConfObject)(i,"displayMode");return(0,M.iterMap)(d.values(),(function(e){return t.layoutFeature({feature:e,layout:n,bpPerPx:o,region:l,showSoftClip:s,heightPx:f,displayMode:p})}),d.size)}},{key:"fetchSequence",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t){var n,r,a,i,o,s,c,u;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sessionId,r=t.regions,a=t.adapterConfig,i=a.sequenceAdapter){e.next=4;break}return e.abrupt("return",void 0);case 4:return e.next=6,(0,B.uP)(this.pluginManager,n,i);case 6:return o=e.sent,s=o.dataAdapter,c=(0,Z.Z)(r,1),u=c[0],e.abrupt("return",(0,E.O)(u,s));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t){var r,a,i,o,c,u,l,d,f,p,h,g,m,v,y,b,x=this;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:if(a=e.sent,i=this.createLayoutInWorker(t),o=t.regions,c=t.bpPerPx,u=(0,Z.Z)(o,1),l=u[0],d=this.layoutFeats((0,C.Z)((0,C.Z)({},t),{},{features:a,layout:i})),!a.size||!(0,E.ES)(null===(r=t.colorBy)||void 0===r?void 0:r.type)){e.next=13;break}return e.next=10,this.fetchSequence(t);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0=void 0;case 14:return f=e.t0,p=l.end,h=l.start,g=(p-h)/c,m=Math.max(i.getTotalHeight(),1),e.next=20,n.e(5707).then(n.t.bind(n,55707,23)).then((function(e){return e.default}));case 20:return v=e.sent,e.next=23,(0,I.C)(g,m,t,(function(e){return x.makeImageData({ctx:e,layoutRecords:d,canvasWidth:g,renderArgs:(0,C.Z)((0,C.Z)({},t),{},{layout:i,features:a,regionSequence:f,Color:v})})}));case 23:return y=e.sent,e.next=26,(0,N.Z)((0,j.Z)(s.prototype),"render",this).call(this,(0,C.Z)((0,C.Z)((0,C.Z)({},t),y),{},{features:a,layout:i,height:m,width:g}));case 26:return b=e.sent,e.abrupt("return",(0,C.Z)((0,C.Z)((0,C.Z)({},b),y),{},{features:new Map,layout:i,height:m,width:g,maxHeightReached:i.maxHeightReached}));case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(e){return new O(e)}}]),s}(F.default),U=n(96902),_=n(4782),J=n(29938),X=100;var Y=(0,_.observer)((function(e){var t=e.onMouseMove,n=e.blockKey,r=e.displayModel,a=e.width,i=e.height,o=e.regions,s=e.bpPerPx,c=e.sortedBy,u=e.colorBy,l=r.selectedFeatureId,d=r.featureIdUnderMouse,f=r.contextMenuFeature,p=(0,Z.Z)(o,1)[0],h=(0,U.useRef)(null),g=(0,U.useState)(!1),m=(0,Z.Z)(g,2),v=m[0],y=m[1],b=(0,U.useState)(!1),x=(0,Z.Z)(b,2),w=x[0],k=x[1];function S(e){v&&k(!0);var i=0,o=0,c=h.current;if(c){var u=c.getBoundingClientRect();i=u.left,o=u.top}i=e.clientX-i,o=e.clientY-o;var l=p.reversed?a-i:i,d=p.start+s*l,f=r.getFeatureOverlapping(n,d,o);t&&t(e,f)}function P(t,n){var r=e["onFeature".concat(t)],a=e["on".concat(t)];r&&d?r(n,d):a&&a(n,d)}(0,U.useEffect)((function(){var e,t,a=h.current;if(a){var i=a.getContext("2d");if(i){i.clearRect(0,0,a.width,a.height);var o=l?null===(e=r.getFeatureByID)||void 0===e?void 0:e.call(r,n,l):void 0;if(o){var c=(0,Z.Z)(o,4),u=c[0],g=c[1],m=c[2],v=c[3],y=(0,M.bpSpanPx)(u,m,p,s),b=(0,Z.Z)(y,2),x=b[0],w=b[1],k=Math.round(g),C=Math.round(v-g);i.shadowColor="#222266",i.shadowBlur=10,i.lineJoin="bevel",i.lineWidth=2,i.strokeStyle="#00b8ff",i.strokeRect(x-2,k-2,w-x+4,C+4),i.clearRect(x,k,w-x,C)}var S=d||(null===f||void 0===f?void 0:f.id()),T=S?null===(t=r.getFeatureByID)||void 0===t?void 0:t.call(r,n,S):void 0;if(T){var P=(0,Z.Z)(T,4),R=P[0],A=P[1],L=P[2],N=P[3],j=(0,M.bpSpanPx)(R,L,p,s),F=(0,Z.Z)(j,2),I=F[0],B=F[1],D=Math.round(A),E=Math.round(N-A);i.fillStyle="#0003",i.fillRect(I,D,B-I,E)}}}}),[s,p,n,l,r,d,f]);var R=Math.ceil(a);return(0,J.jsxs)("div",{className:"PileupRendering","data-testid":"pileup-".concat(c||u?"".concat((null===c||void 0===c?void 0:c.type)||"").concat((null===u||void 0===u?void 0:u.type)||"").concat((null===u||void 0===u?void 0:u.tag)||""):"normal"),style:{position:"relative",width:R,height:i},children:[(0,J.jsx)(T.PrerenderedCanvas,(0,C.Z)((0,C.Z)({},e),{},{style:{position:"absolute",left:0,top:0}})),(0,J.jsx)("canvas",{"data-testid":"pileup_overlay_canvas",width:R,height:i+X,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:h,onMouseDown:function(e){return function(e){y(!0),k(!1),P("MouseDown",e)}(e)},onMouseEnter:function(e){return function(e){P("MouseEnter",e)}(e)},onMouseOut:function(e){return function(e){P("MouseOut",e),P("MouseLeave",e)}(e)},onMouseOver:function(e){return function(e){P("MouseOver",e)}(e)},onMouseUp:function(e){return function(e){y(!1),P("MouseUp",e)}(e)},onMouseLeave:function(e){return function(e){P("MouseOut",e),P("MouseLeave",e)}(e)},onMouseMove:function(e){return S(e)},onClick:function(e){return function(e){w||P("Click",e)}(e)},onContextMenu:function(e){return function(e){P("ContextMenu",e)}(e)},onFocus:function(){},onBlur:function(){}})]})}));var Q=(0,u.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:f.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:f.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:.7},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function K(e){e.addRendererType((function(){return new q({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:Y,configSchema:Q,pluginManager:e})}))}var $=n(95984),ee=n(92777);var te=n(75717),ne=n(33991),re=20;function ae(e){return e.getDisplayElements().filter((function(e){var t;return"LinearAlignmentsDisplay"===(null===(t=e.subDisplay)||void 0===t?void 0:t.type)})).filter((function(e){var t;return null===(t=e.subDisplay)||void 0===t?void 0:t.lowerPanel}))}function ie(e,t){return z()(e?(0,f.getSnapshot)(e):void 0,t?(0,f.getSnapshot)(t):void 0)}function oe(e){var t=e.PileupDisplay,n=e.SNPCoverageDisplay;return t||(0,f.isAlive)(t)||n||(0,f.isAlive)(n)}var se=function(e,t){return f.types.compose("LinearAlignmentsDisplay",ne.BaseDisplay,function(e,t){var n=ae(e).map((function(e){return e.stateModel}));return f.types.model({PileupDisplay:f.types.maybe(f.types.union.apply(f.types,(0,k.Z)(n))),SNPCoverageDisplay:f.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:f.types.literal("LinearAlignmentsDisplay"),configuration:(0,u.ConfigurationReference)(t),height:250,userFeatureScreenDensity:f.types.maybe(f.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile((function(){return{scrollTop:0}})).actions((function(e){return{setScrollTop:function(t){e.scrollTop=t},setSNPCoverageHeight:function(t){e.snpCovHeight=t}}})).views((function(e){return{get pileupConf(){var t=(0,u.getConf)(e,"pileupDisplay");return(0,C.Z)((0,C.Z)({},t),{},{type:e.lowerPanelType,displayId:"".concat(e.configuration.displayId,"_").concat(e.lowerPanelType,"_xyz")})},getFeatureByID:function(t,n){return e.PileupDisplay.getFeatureByID(t,n)},searchFeatureByID:function(t){return e.PileupDisplay.searchFeatureByID(t)},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){var t=(0,u.getConf)(e,"snpCoverageDisplay");return(0,C.Z)((0,C.Z)({},t),{},{displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")})}}})).actions((function(e){return{setSNPCoverageDisplay:function(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},updateStatsLimit:function(t){e.PileupDisplay.updateStatsLimit(t),e.SNPCoverageDisplay.updateStatsLimit(t)},setPileupDisplay:function(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:function(t){return e.height=Math.max(t,re),e.height},setLowerPanelType:function(t){e.lowerPanelType=t},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n}}})).actions((function(e){return{afterAttach:function(){(0,f.addDisposer)(e,(0,te.autorun)((function(){var t=e.SNPCoverageDisplay,n=e.PileupDisplay,r=e.coverageConf,a=e.pileupConf;t?z()(r,(0,f.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(r),n&&e.lowerPanelType===n.type?z()(a,(0,f.getSnapshot)(n.configuration))||n.setConfig(e.pileupConf):e.setPileupDisplay(a),function(e){var t=e.PileupDisplay,n=e.SNPCoverageDisplay;oe(e)&&t.colorBy&&(ie(t.colorBy,n.colorBy)||n.setColorBy((0,f.getSnapshot)(t.colorBy)))}(e),function(e){var t=e.PileupDisplay,n=e.SNPCoverageDisplay;oe(e)&&t.filterBy&&(ie(t.filterBy,n.filterBy)||n.setFilterBy((0,f.getSnapshot)(t.filterBy)))}(e)}))),(0,f.addDisposer)(e,(0,te.autorun)((function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)}))),(0,f.addDisposer)(e,(0,te.autorun)((function(){e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)})))},renderSvg:function(t){return(0,S.Z)((0,w.Z)().mark((function n(){var r;return(0,w.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height-e.SNPCoverageDisplay.height,n.next=3,(0,te.when)((function(){return e.PileupDisplay.ready}));case 3:return n.t0=J.jsxs,n.t1=J.Fragment,n.t2=J.jsx,n.next=8,e.SNPCoverageDisplay.renderSvg(t);case 8:return n.t3=n.sent,n.t4={children:n.t3},n.t5=(0,n.t2)("g",n.t4),n.t6=J.jsx,n.t7="translate(0 ".concat(e.SNPCoverageDisplay.height,")"),n.next=15,e.PileupDisplay.renderSvg((0,C.Z)((0,C.Z)({},t),{},{overrideHeight:r}));case 15:return n.t8=n.sent,n.t9={transform:n.t7,children:n.t8},n.t10=(0,n.t6)("g",n.t9),n.t11=[n.t5,n.t10],n.t12={children:n.t11},n.abrupt("return",(0,n.t0)(n.t1,n.t12));case 21:case"end":return n.stop()}}),n)})))()}}})).views((function(t){var n=t.trackMenuItems;return{trackMenuItems:function(){var r=ae(e).map((function(e){return{type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:function(){return t.setLowerPanelType(e.name)}}}));return[].concat((0,k.Z)(n()),[{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:r}])}}}))},ce=n(91188),ue=(0,ce.ZL)()((function(){return{resizeHandle:{height:2,position:"absolute",zIndex:2}}}));var le=(0,_.observer)((function(e){var t=e.model,n=t.PileupDisplay,r=t.SNPCoverageDisplay,a=ue().classes,i=r.height;return(0,J.jsxs)("div",{"data-testid":"display-".concat((0,u.getConf)(t,"displayId")),style:{position:"relative"},children:[(0,J.jsx)("div",{"data-testid":"Blockset-snpcoverage",children:(0,J.jsx)(r.RenderingComponent,{model:r})}),(0,J.jsx)(T.ResizeHandle,{onDrag:function(e){return r.setHeight(r.height+e),e},className:a.resizeHandle,style:{top:i}}),(0,J.jsx)("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:i},children:(0,J.jsx)(n.RenderingComponent,{model:n})})]})}));function de(e){e.addDisplayType((function(){var t,n=(t=e,(0,u.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:t.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:t.getDisplayType("LinearSNPCoverageDisplay").configSchema},{baseConfiguration:ee.fU,explicitlyTyped:!0}));return new $.Z({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:n,stateModel:se(e,n),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:le})}))}var fe=n(73636),pe=n.n(fe),he=n(59740),ge=["refbase","all","total","ref","-1","1","0"],me=function(e){return e.toLocaleString("en-US")},ve=function(e,t){return"".concat(function(){return+(+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)).toFixed(1)}(e/(t||1)*100),"%")},ye=U.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),i=n.get("refName"),o=n.get("snpinfo"),s=o.refbase,c=o.all,u=(o.total,o.ref),l=o[-1],d=o[1],f=(o[0],(0,he.Z)(o,ge)),p=[i,r===a?me(r):"".concat(me(r),"..").concat(me(a))].filter((function(e){return!!e})).join(":");return(0,J.jsx)("div",{ref:t,children:(0,J.jsxs)("table",{children:[(0,J.jsx)("caption",{children:p}),(0,J.jsx)("thead",{children:(0,J.jsxs)("tr",{children:[(0,J.jsx)("th",{children:"Base"}),(0,J.jsx)("th",{children:"Count"}),(0,J.jsx)("th",{children:"% of Total"}),(0,J.jsx)("th",{children:"Strands"}),(0,J.jsx)("th",{children:"Source"})]})}),(0,J.jsxs)("tbody",{children:[(0,J.jsxs)("tr",{children:[(0,J.jsx)("td",{children:"Total"}),(0,J.jsx)("td",{children:c})]}),(0,J.jsxs)("tr",{children:[(0,J.jsxs)("td",{children:["REF ",s?"(".concat(s.toUpperCase(),")"):""]}),(0,J.jsx)("td",{children:u}),(0,J.jsx)("td",{children:ve(u,c)}),(0,J.jsxs)("td",{children:[l?"".concat(l,"(-)"):"",d?"".concat(d,"(+)"):""]}),(0,J.jsx)("td",{})]}),Object.entries(f).map((function(e){var t=(0,Z.Z)(e,2),n=t[0],r=t[1];return Object.entries(r).map((function(e){var t=(0,Z.Z)(e,2),r=t[0],a=t[1];return(0,J.jsxs)("tr",{children:[(0,J.jsx)("td",{children:r.toUpperCase()}),(0,J.jsx)("td",{children:a.total}),(0,J.jsx)("td",{children:"total"===r||"skip"===r?"---":ve(a.total,c)}),(0,J.jsxs)("td",{children:[a[-1]?"".concat(a[-1],"(-)"):"",a[1]?"".concat(a[1],"(+)"):""]}),(0,J.jsx)("td",{children:n})]},r)}))}))]})]})})})),be=(0,_.observer)((function(e){var t=e.model.featureUnderMouse;return t&&"skip"===t.get("type")?null:(0,J.jsx)(P.u,(0,C.Z)({TooltipContents:ye},e))})),xe=n(16151);function we(e,t,n,r){return ke.apply(this,arguments)}function ke(){return(ke=(0,S.Z)((0,w.Z)().mark((function e(t,n,r,a){var i,o,s,c,u;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,M.getSession)(t),o=i.rpcManager,s=t.adapterConfig,c=(0,xe.getRpcSessionId)(t),e.next=5,o.call((0,xe.getRpcSessionId)(t),"PileupGetGlobalValueForTag",(0,C.Z)({adapterConfig:s,tag:n.tag,sessionId:c,regions:r.contentBlocks},a));case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e,t,n,r,a){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,S.Z)((0,w.Z)().mark((function e(t,n,r,a,i){var o,s,c,u;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,M.getSession)(t),s=o.rpcManager,c=(0,xe.getRpcSessionId)(t),e.next=4,s.call(c,"PileupGetVisibleModifications",(0,C.Z)({adapterConfig:n,tag:r.tag,sessionId:c,regions:a.contentBlocks},i));case 4:return u=e.sent,e.abrupt("return",u);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=f.types.model({flagInclude:f.types.optional(f.types.number,0),flagExclude:f.types.optional(f.types.number,1540),readName:f.types.maybe(f.types.string),tagFilter:f.types.maybe(f.types.model({tag:f.types.string,value:f.types.string}))}),Te=new Map([["snpcoverage","SNPCoverageRenderer"]]);var Me=function(e,t){return f.types.compose("LinearSNPCoverageDisplay",(0,P.LT)(e,t),f.types.model({type:f.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:f.types.maybe(f.types.boolean),drawIndicators:f.types.maybe(f.types.boolean),drawArcs:f.types.maybe(f.types.boolean),filterBy:f.types.optional(Se,{}),colorBy:f.types.maybe(f.types.model({type:f.types.string,tag:f.types.maybe(f.types.string)}))})).volatile((function(){return{modificationTagMap:void 0}})).actions((function(e){return{setConfig:function(t){e.configuration=t},setFilterBy:function(t){e.filterBy=(0,f.cast)(t)},setColorBy:function(t){e.colorBy=(0,f.cast)(t)},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"],r=0,a=pe()(e.modificationTagMap)||{};t.forEach((function(e){if(!a[e]){var t=n[r++];a[e]=t}})),e.modificationTagMap=a}}})).views((function(e){var t=e.renderProps;return{get rendererConfig(){var t,n,r,a=(0,u.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create((0,C.Z)((0,C.Z)({},a),{},{drawInterbaseCounts:null!==(t=e.drawInterbaseCounts)&&void 0!==t?t:a.drawInterbaseCounts,drawIndicators:null!==(n=e.drawIndicators)&&void 0!==n?n:a.drawIndicators,drawArcs:null!==(r=e.drawArcs)&&void 0!==r?r:a.drawArcs}),(0,f.getEnv)(e))},get drawArcsSetting(){var t;return null!==(t=e.drawArcs)&&void 0!==t?t:(0,u.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){var t;return null!==(t=e.drawInterbaseCounts)&&void 0!==t?t:(0,u.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){var t;return null!==(t=e.drawIndicators)&&void 0!==t?t:(0,u.readConfObject)(this.rendererConfig,"drawIndicators")},get modificationsReady(){var t;return"modifications"!==(null===(t=e.colorBy)||void 0===t?void 0:t.type)||void 0!==e.modificationTagMap},renderProps:function(){var n=t(),r=e.colorBy,a=e.filterBy,i=e.modificationTagMap;return(0,C.Z)((0,C.Z)({},n),{},{notReady:n.notReady||!this.modificationsReady,modificationTagMap:i,colorBy:r?(0,f.getSnapshot)(r):void 0,filterBy:a?(0,f.getSnapshot)(a):void 0})}}})).actions((function(e){return{toggleDrawIndicators:function(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts:function(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs:function(){e.drawArcs=!e.drawArcsSetting},afterAttach:function(){(0,f.addDisposer)(e,(0,te.autorun)((0,S.Z)((0,w.Z)().mark((function t(){var n,r,a,i;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.colorBy,(r=(0,M.getContainingView)(e)).initialized&&e.estimatedStatsReady&&!e.regionTooLarge){t.next=5;break}return t.abrupt("return");case 5:if(a=r.staticBlocks,"modifications"!==(null===n||void 0===n?void 0:n.type)){t.next=13;break}return i=(0,u.getConf)(e.parentTrack,"adapter"),t.t0=e,t.next=11,Ce(e,i,n,a);case 11:t.t1=t.sent,t.t0.updateModificationColorMap.call(t.t0,t.t1);case 13:t.next=19;break;case 15:t.prev=15,t.t2=t.catch(0),console.error(t.t2),e.setError(t.t2);case 19:case"end":return t.stop()}}),t,null,[[0,15]])}))),{delay:1e3}))}}})).views((function(e){var t=e.trackMenuItems;return{get TooltipComponent(){return be},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,u.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return Te.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:function(){return[]},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:function(){return e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:function(){return e.toggleDrawInterbaseCounts()}},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:function(){return e.toggleDrawArcs()}}])}}}))};function Pe(e){e.addDisplayType((function(){var t=function(e){return(0,u.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:f.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:f.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,u.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema})},{baseConfiguration:ee.fU,explicitlyTyped:!0})}(e);return new $.Z({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:Me(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:P.Xl})}))}var Re=(0,ce.ZL)()((function(e){var t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"}}})),Ae=(0,_.observer)((function(e){var t=e.model,n=(0,M.getContainingView)(t);return(0,J.jsx)("canvas",{"data-testid":"Arc-display-".concat(t.drawn),ref:function(e){(0,f.isAlive)(t)&&t.setRef(e)},style:{position:"absolute",left:-n.offsetPx+t.lastDrawnOffsetPx,width:n.dynamicBlocks.totalWidthPx,height:t.height},width:2*n.dynamicBlocks.totalWidthPx,height:2*t.height})})),Le=(0,_.observer)((function(e){var t=e.model,n=(0,M.getContainingView)(t),r=Re().classes,a=t.error;return a?(0,J.jsx)(ee.rK,{message:"".concat(a),severity:"error",buttonText:"Reload",action:t.reload}):t.loading?(0,J.jsx)("div",{className:r.loading,style:{width:n.dynamicBlocks.totalWidthPx,height:20,position:"absolute",left:Math.max(0,-n.offsetPx)},children:(0,J.jsx)(T.LoadingEllipses,{message:t.message})}):(0,J.jsx)(Ae,{model:t})}));var Ne=function(e){return(0,u.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorScheme:{type:"stringEnum",model:f.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,ee.RH)(e),explicitlyTyped:!0})},je=n(34305),Fe=n(4987),Ie={color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green"};function Be(e,t,n){var r=e.refName===t.refName,a=Math.abs(e.tlen||0);return r&&a>((null===n||void 0===n?void 0:n.upper)||0)?"red":r&&a<((null===n||void 0===n?void 0:n.lower)||0)?"#f0f":r?"":"purple"}function De(e,t,n){return Be(e,t,n)||Ee(e)}function Ee(e){var t=E.uD.fr[e.pair_orientation||""];return Ie[{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[t]]||"grey"}function Ve(e){var t,n=(0,L.Z)(e.chains.values());try{for(n.s();!(t=n.n()).done;){if(1&t.value[0].flags)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}function ze(e){return 2*Math.random()*e-e}function Oe(e,t){return We.apply(this,arguments)}function We(){return(We=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l,d,f,p,h,g,m,v,y,b,x,C,Z,S,T,P,R,A,L,N,j,F;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x=function(e,t,r,i){var s=e.strand,c=t.strand,d=-1===c,f=-1===s?e.start:e.end,p=g?d?t.start:t.end:d?t.end:t.start,m=r.getCanonicalRefName(e.refName),v=r.getCanonicalRefName(t.refName),x=l.bpToPx({refName:m,coord:f}),w=l.bpToPx({refName:v,coord:p});if(x&&w){var k=(w.offsetPx-x.offsetPx)/2,C=Math.abs(k),Z=x.offsetPx-l.offsetPx,S=w.offsetPx-l.offsetPx;i?(n.moveTo(Z,0),n.beginPath()):(n.beginPath(),n.moveTo(Z,0)),i?n.strokeStyle="red":g?"insertSizeAndOrientation"===y?n.strokeStyle=De(e,t,h):"orientation"===y?n.strokeStyle=Ee(e):"insertSize"===y?n.strokeStyle=Be(e,t,h)||"grey":"gradient"===y&&(n.strokeStyle="hsl(".concat(10*Math.log10(C),",50%,50%)")):"orientation"===y||"insertSizeAndOrientation"===y?n.strokeStyle=-1===s&&1===c?"navy":1===s&&-1===c?"green":"grey":"gradient"===y&&(n.strokeStyle="hsl(".concat(10*Math.log10(C),",50%,50%)"));var T=Z+2*k,M=Math.min(a+ze(u),C);i?C>1e5?(b(Z+ze(u),"red"),b(S+ze(u),"red")):(n.arc(Z+k+ze(u),0,C,0,Math.PI),n.stroke()):(n.bezierCurveTo(Z+ze(u),M,T,M,T+ze(u),0),n.stroke())}else x&&o&&b(x.offsetPx-l.offsetPx,"purple")},b=function(e,t){n.strokeStyle=t,n.beginPath(),n.moveTo(e,0),n.lineTo(e,a),n.stroke()},r=t.chainData,a=t.height,i=t.colorBy,o=t.drawInter,s=t.drawLongRange,c=t.lineWidthSetting,u=t.jitterVal,r){e.next=5;break}return e.abrupt("return");case 5:if(l=(0,M.getContainingView)(t),d=(0,M.getSession)(t),f=d.assemblyManager,t.setLastDrawnOffsetPx(l.offsetPx),n.lineWidth=c,p=r.chains,h=r.stats,g=Ve(r),m=l.assemblyNames[0],v=f.get(m),y=(null===i||void 0===i?void 0:i.type)||"insertSizeAndOrientation",v){e.next=16;break}return e.abrupt("return");case 16:for(C=0;C<p.length;C++)if(1===(Z=p[C]).length&&s)if(S=Z[0],g)T=S.next_ref,P=S.next_pos,x(S,{refName:T,start:P,end:P,strand:S.strand},v,!0);else for(R=(0,D.featurizeSA)(S.SA,S.id,S.strand,S.name),A=[S].concat((0,k.Z)(R)).sort((function(e,t){return e.clipPos-t.clipPos})),L=0;L<A.length-1;L++)N=A[L],j=A[L+1],x(N,j,v,!0);else for(g?Z=Z.filter((function(e){return!(2048&e.flags)})):(Z.sort((function(e,t){return e.clipPos-t.clipPos})),Z=Z.filter((function(e){return!(256&e.flags)}))),F=0;F<Z.length-1;F++)x(Z[F],Z[F+1],v,!1);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,S.Z)((0,w.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,M.getContainingTrack)(t),r=n.rpcSessionId,a=(0,M.getSession)(t),i=a.rpcManager,(o=(0,M.getContainingView)(t)).initialized&&!t.error){e.next=6;break}return e.abrupt("return");case 6:return t.setLoading(!0),e.next=9,i.call(r,"PileupGetReducedFeatures",{sessionId:r,regions:o.staticBlocks.contentBlocks,filterBy:(0,f.getSnapshot)(t.filterBy),adapterConfig:t.adapterConfig});case 9:s=e.sent,t.setChainData(s),t.setLoading(!1),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.error(e.t0),t.setError(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}var qe=(0,U.lazy)((function(){return n.e(4391).then(n.bind(n,4391))}));var Ue=function(e){return f.types.compose("LinearReadArcsDisplay",ee.fV,f.types.model({type:f.types.literal("LinearReadArcsDisplay"),configuration:(0,u.ConfigurationReference)(e),filterBy:f.types.optional(Se,{}),lineWidth:f.types.maybe(f.types.number),jitter:f.types.maybe(f.types.number),colorBy:f.types.maybe(f.types.model({type:f.types.string,tag:f.types.maybe(f.types.string),extra:f.types.frozen()})),drawInter:!0,drawLongRange:!0})).volatile((function(){return{loading:!1,drawn:!1,chainData:void 0,ref:null,lastDrawnOffsetPx:0}})).actions((function(e){return{reload:function(){e.error=void 0},setRef:function(t){e.ref=t},setColorScheme:function(t){e.colorBy=(0,f.cast)(t)},setChainData:function(t){e.chainData=t},setDrawInter:function(t){e.drawInter=t},setDrawLongRange:function(t){e.drawLongRange=t},setLoading:function(t){e.loading=t},setDrawn:function(t){e.drawn=t},setFilterBy:function(t){e.filterBy=(0,f.cast)(t)},setLastDrawnOffsetPx:function(t){e.lastDrawnOffsetPx=t},setLineWidth:function(t){e.lineWidth=t},setJitter:function(t){e.jitter=t}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{get lineWidthSetting(){var t;return null!==(t=e.lineWidth)&&void 0!==t?t:(0,u.getConf)(e,"lineWidth")},get jitterVal(){var t;return null!==(t=e.jitter)&&void 0!==t?t:(0,u.getConf)(e,"jitter")},get ready(){return!!e.chainData},get rendererTypeName(){return"PileupRenderer"},renderProps:function(){return(0,C.Z)((0,C.Z)({},n()),{},{notReady:!0,config:(0,u.ConfigurationSchema)("empty",{}).create()})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Filter by",icon:Fe.Z,onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[qe,{model:e,handleClose:t}]}))}},{label:"Line width",subMenu:[{label:"Thin",onClick:function(){return e.setLineWidth(1)}},{label:"Bold",onClick:function(){return e.setLineWidth(2)}},{label:"Extra bold",onClick:function(){return e.setLineWidth(5)}}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===this.jitterVal,label:"None",onClick:function(){return e.setJitter(0)}},{type:"checkbox",checked:2===this.jitterVal,label:"Small",onClick:function(){return e.setJitter(2)}},{type:"checkbox",checked:10===this.jitterVal,label:"Large",onClick:function(){return e.setJitter(10)}}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:function(){return e.setDrawInter(!e.drawInter)}},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:function(){return e.setDrawLongRange(!e.drawLongRange)}},{label:"Color scheme",icon:je.Z,subMenu:[{label:"Insert size \xb1 3\u03c3 and orientation",onClick:function(){return e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size \xb1 3\u03c3",onClick:function(){return e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:function(){return e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:function(){return e.setColorScheme({type:"gradient"})}}]}])}}})).views((function(e){return{renderSvg:function(t){return(0,S.Z)((0,w.Z)().mark((function r(){var a,i,o,s,c,u,l,d;return(0,w.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(0,M.getContainingView)(e),i=a.dynamicBlocks.totalWidthPx,o=e.height,!t.rasterizeLayers){r.next=16;break}if((c=document.createElement("canvas")).width=2*i,c.height=2*o,u=c.getContext("2d")){r.next=10;break}return r.abrupt("return");case 10:return u.scale(2,2),r.next=13,Oe(e,u);case 13:s=(0,J.jsx)("image",{width:i,height:o,xlinkHref:c.toDataURL("image/png")}),r.next=23;break;case 16:return r.next=18,n.e(7911).then(n.t.bind(n,47911,23));case 18:return l=r.sent,d=new l.default(i,o),r.next=22,Oe(e,d);case 22:s=(0,J.jsx)("g",{dangerouslySetInnerHTML:{__html:d.getSvg().innerHTML}});case 23:return r.abrupt("return",(0,J.jsx)("g",{children:s}));case 24:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){return{afterAttach:function(){(0,f.addDisposer)(e,(0,te.autorun)((function(){return He(e)}),{delay:1e3})),(0,f.addDisposer)(e,(0,te.autorun)((0,S.Z)((0,w.Z)().mark((function t(){var n,r;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.ref){t.next=4;break}return t.abrupt("return");case 4:if(r=n.getContext("2d")){t.next=7;break}return t.abrupt("return");case 7:return r.clearRect(0,0,n.width,2*e.height),r.resetTransform(),r.scale(2,2),t.next=12,Oe(e,r);case 12:e.setDrawn(!0),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,15]])}))),{delay:1e3}))}}}))};function _e(e){e.addDisplayType((function(){var t=Ne(e);return new $.Z({name:"LinearReadArcsDisplay",displayName:"Arc display",configSchema:t,stateModel:Ue(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:Le})}))}var Je=(0,ce.ZL)()((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"}}})),Xe=(0,_.observer)((function(e){var t=e.model,n=(0,M.getContainingView)(t);return(0,J.jsx)("canvas",{"data-testid":"ReadCloud-display-".concat(t.drawn),ref:function(e){(0,f.isAlive)(t)&&t.setRef(e)},style:{position:"absolute",left:-n.offsetPx+t.lastDrawnOffsetPx,width:n.dynamicBlocks.totalWidthPx,height:t.height},width:2*n.dynamicBlocks.totalWidthPx,height:2*t.height})})),Ye=(0,_.observer)((function(e){var t=e.model,n=(0,M.getContainingView)(t),r=Je().classes,a=t.error;return a?(0,J.jsx)(ee.rK,{message:"".concat(a),severity:"error",buttonText:"Reload",action:t.reload}):t.loading?(0,J.jsx)("div",{className:r.loading,style:{width:n.dynamicBlocks.totalWidthPx,height:20,position:"absolute",left:Math.max(0,-n.offsetPx)},children:(0,J.jsx)(T.LoadingEllipses,{message:t.message})}):(0,J.jsx)(Xe,{model:t})}));var Qe=function(e){return(0,u.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorScheme:{type:"stringEnum",model:f.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,ee.RH)(e),explicitlyTyped:!0})};function Ke(e,t,n,r,a,i){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),i&&(a.fillStyle=i),a.fillRect(e,t,n,r)}function $e(e,t){return et.apply(this,arguments)}function et(){return(et=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,l,d,f,p,h,g,m,v,y,b,x,k,C,Z,S,T,P,R,A,L,N,j,F,I,B,D,E,V,z,O,W,H,G,q,U,_,J,X,Y,Q,K,$,ee,te,ne,re,ae,ie,oe,se,ce,ue;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.chainData){e.next=3;break}return e.abrupt("return");case 3:if(a=(0,M.getSession)(t),i=a.assemblyManager,o=(0,u.getConf)(t,"featureHeight"),s=t.height,c=(0,M.getContainingView)(t),l=c.assemblyNames[0],d=i.get(l)){e.next=11;break}return e.abrupt("return");case 11:for(t.setLastDrawnOffsetPx(c.offsetPx),f=r.chains,p=r.stats,h=[],g=0;g<f.length;g++)if(1&(m=f[g])[0].flags&&m.length>1)v=m[0],y=m[1],b=d.getCanonicalRefName(v.refName),x=d.getCanonicalRefName(y.refName),k=c.bpToPx({refName:b,coord:v.start}),C=c.bpToPx({refName:b,coord:v.end}),Z=c.bpToPx({refName:x,coord:y.start}),S=c.bpToPx({refName:x,coord:y.end}),T=0,void 0!==k&&void 0!==C&&void 0!==Z&&void 0!==S&&(v.refName===y.refName&&(P=Math.min(v.start,y.start),R=Math.max(v.end,y.end),T=Math.abs(R-P)),h.push({r1s:k.offsetPx,r1e:C.offsetPx,r2s:Z.offsetPx,r2e:S.offsetPx,v0:v,v1:y,distance:T}));else for(A=1;A<m.length;A++)L=m[A-1],N=m[A],j=d.getCanonicalRefName(L.refName),F=d.getCanonicalRefName(N.refName),I=c.bpToPx({refName:j,coord:L.start}),B=c.bpToPx({refName:j,coord:L.end}),D=c.bpToPx({refName:F,coord:N.start}),E=c.bpToPx({refName:F,coord:N.end}),V=0,void 0!==I&&void 0!==B&&void 0!==D&&void 0!==E&&(L.refName===N.refName&&(z=Math.min(L.start,N.start),O=Math.max(L.end,N.end),V=Math.abs(O-z)),h.push({r1s:I.offsetPx,r1e:B.offsetPx,r2s:D.offsetPx,r2e:E.offsetPx,v0:L,v1:N,distance:V}));for(W=0,H=0;H<h.length;H++)G=h[H].distance,W=Math.max(W,G);for(q=o/2-.5,U=(s-20)/Math.log(W),_=0;_<h.length;_++)X=h[_],Y=X.r1s,Q=X.r1e,K=X.r2s,$=X.r2e,ee=X.v0,te=X.v1,ne=X.distance,re=(null===(J=t.colorBy)||void 0===J?void 0:J.type)||"insertSizeAndOrientation",ae=Math.log(ne)*U,n.fillStyle="black",ie=K-Q,Ke(Q-c.offsetPx,ae+q,ie,1,n),"insertSizeAndOrientation"===re?n.fillStyle=De(ee,te,p):"orientation"===re?n.fillStyle=Ee(ee):"insertSize"===re?n.fillStyle=Be(ee,te,p)||"grey":"gradient"===re&&(oe=Math.min(ee.start,te.start),se=Math.max(ee.end,te.end),n.fillStyle="hsl(".concat(10*Math.log10(Math.abs(se-oe)),",50%,50%)")),ce=Math.max(Q-Y,2),ue=Math.max($-K,2),Ke(Y-c.offsetPx,ae,ce,o,n),Ke(K-c.offsetPx,ae,ue,o,n);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tt=(0,U.lazy)((function(){return n.e(4391).then(n.bind(n,4391))}));var nt=function(e){return f.types.compose("LinearReadCloudDisplay",ee.fV,f.types.model({type:f.types.literal("LinearReadCloudDisplay"),configuration:(0,u.ConfigurationReference)(e),filterBy:f.types.optional(Se,{}),colorBy:f.types.maybe(f.types.model({type:f.types.string,tag:f.types.maybe(f.types.string),extra:f.types.frozen()}))})).volatile((function(){return{loading:!1,drawn:!1,chainData:void 0,ref:null,lastDrawnOffsetPx:0}})).actions((function(e){return{reload:function(){e.error=void 0},setRef:function(t){e.ref=t},setColorScheme:function(t){e.colorBy=(0,f.cast)(t)},setChainData:function(t){e.chainData=t},setLoading:function(t){e.loading=t},setDrawn:function(t){e.drawn=t},setFilterBy:function(t){e.filterBy=(0,f.cast)(t)},setLastDrawnOffsetPx:function(t){e.lastDrawnOffsetPx=t}}})).views((function(e){var t=e.trackMenuItems,r=e.renderProps;return{get ready(){return!!e.chainData},get rendererTypeName(){return"PileupRenderer"},renderProps:function(){return(0,C.Z)((0,C.Z)({},r()),{},{notReady:!0,config:(0,u.ConfigurationSchema)("empty",{}).create()})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Filter by",icon:Fe.Z,onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[tt,{model:e,handleClose:t}]}))}},{label:"Color scheme",icon:je.Z,subMenu:[{label:"Insert size \xb1 3\u03c3 and orientation",onClick:function(){return e.setColorScheme({type:"insertSizeAndOrientation"})}},{label:"Insert size \xb1 3\u03c3",onClick:function(){return e.setColorScheme({type:"insertSize"})}},{label:"Orientation",onClick:function(){return e.setColorScheme({type:"orientation"})}},{label:"Insert size gradient",onClick:function(){return e.setColorScheme({type:"gradient"})}}]}])},renderSvg:function(t){return(0,S.Z)((0,w.Z)().mark((function r(){var a,i,o,s,c,u,l,d;return(0,w.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a=(0,M.getContainingView)(e),i=a.dynamicBlocks.totalWidthPx,o=e.height,!t.rasterizeLayers){r.next=16;break}if((c=document.createElement("canvas")).width=2*i,c.height=2*o,u=c.getContext("2d")){r.next=10;break}return r.abrupt("return");case 10:return u.scale(2,2),r.next=13,$e(e,u);case 13:s=(0,J.jsx)("image",{width:i,height:o,xlinkHref:c.toDataURL("image/png")}),r.next=23;break;case 16:return r.next=18,n.e(7911).then(n.t.bind(n,47911,23));case 18:return l=r.sent,d=new l.default(i,o),r.next=22,$e(e,d);case 22:s=(0,J.jsx)("g",{dangerouslySetInnerHTML:{__html:d.getSvg().innerHTML}});case 23:return r.abrupt("return",(0,J.jsx)("g",{children:s}));case 24:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){return{afterAttach:function(){(0,f.addDisposer)(e,(0,te.autorun)((function(){return He(e)}),{delay:1e3})),(0,f.addDisposer)(e,(0,te.autorun)((0,S.Z)((0,w.Z)().mark((function t(){var n,r;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.ref){t.next=4;break}return t.abrupt("return");case 4:if(r=n.getContext("2d")){t.next=7;break}return t.abrupt("return");case 7:return r.clearRect(0,0,n.width,2*e.height),r.resetTransform(),r.scale(2,2),t.next=12,$e(e,r);case 12:e.setDrawn(!0),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,15]])}))),{delay:1e3}))}}}))};function rt(e){e.addDisplayType((function(){var t=Qe(e);return new $.Z({name:"LinearReadCloudDisplay",displayName:"Read cloud display",configSchema:t,stateModel:nt(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:Ye})}))}var at=n(55385);function it(e){e.addTrackType((function(){var t,n=(t=e,(0,u.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,ne.createBaseTrackConfig)(t)})),r=new at.Z({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:n,stateModel:(0,ne.createBaseTrackModel)(e,"AlignmentsTrack",n)}),a=e.getDisplayType("LinearAlignmentsDisplay");return r.addDisplayType(a),r}))}var ot=n(26347),st=n(87518),ct=(0,u.ConfigurationSchema)("AlignmentsFeatureWidget",{});function ut(e){var t=(0,st.e$)(e);return f.types.compose(t,f.types.model("AlignmentsFeatureWidget",{type:f.types.literal("AlignmentsFeatureWidget")}))}function lt(e){e.addWidgetType((function(){return new ot.Z({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:ct,stateModel:ut(e),ReactComponent:(0,U.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(7998)]).then(n.bind(n,66935))}))})}))}var dt=n(66043),ft=n(56218);function pt(e){var t=e.map((function(e){return Math.abs(e.tlen)})),n=t.reduce((function(e,t){return e+t}),0),r=t.map((function(e){return e*e})).reduce((function(e,t){return e+t}),0),a=t.length,i=n/a,o=Math.sqrt((a*r-n*n)/(a*a));return{upper:i+4*o,lower:i-3*o,avg:i,sd:o}}var ht=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t,r){var a,i,o,s;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pluginManager.rootModel,o=null===i||void 0===i||null===(a=i.session)||void 0===a?void 0:a.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.next=6,(0,M.renameRegionsIfNeeded)(o,t);case 6:return s=e.sent,e.abrupt("return",(0,N.Z)((0,j.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(n(42273).Z),gt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="PileupGetReducedFeatures",e}return(0,a.Z)(n,[{key:"execute",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l,d,f;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,e.next=6,(0,B.uP)(this.pluginManager,i,a);case 6:return s=e.sent.dataAdapter,e.next=9,(0,ft.z)(s.getFeaturesInMultipleRegions(o,r).pipe((0,dt.q)()));case 9:return c=e.sent,u=(0,M.dedupe)(c.map((function(e){return{id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:e.get("clipPos"),SA:(0,E.h1)(e,"SA")}})),(function(e){return e.id})),l=u.filter((function(e){return 2&e.flags&&!(256&e.flags)&&!(2048&e.flags)})),d=l.length?pt(l):void 0,f={},u.forEach((function(e){f[e.name]||(f[e.name]=[]),f[e.name].push(e)})),e.abrupt("return",{chains:Object.values(f),stats:d,hasPaired:!!d,containsNoTransferables:!0});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ht),mt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="PileupGetGlobalValueForTag",e}return(0,a.Z)(n,[{key:"execute",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,s=r.tag,e.next=9,(0,B.uP)(this.pluginManager,i,a);case 9:return c=e.sent.dataAdapter,u=c.getFeaturesInMultipleRegions(o),e.next=13,(0,ft.z)(u.pipe((0,dt.q)()));case 13:return l=e.sent,e.abrupt("return",(0,k.Z)(new Set(l.map((function(e){return(0,E.h1)(e,s)})).filter((function(e){return void 0!==e})).map((function(e){return"".concat(e)})))));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ht),vt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="PileupGetVisibleModifications",e}return(0,a.Z)(n,[{key:"execute",value:function(){var e=(0,S.Z)((0,w.Z)().mark((function e(t,n){var r,a,i,o,s,c,u;return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,e.next=8,(0,B.uP)(this.pluginManager,i,a);case 8:return s=e.sent.dataAdapter,e.next=11,(0,ft.z)(s.getFeaturesInMultipleRegions(o).pipe((0,dt.q)()));case 11:return c=e.sent,u=new Set,c.forEach((function(e){(0,D.getModificationTypes)((0,E.TN)(e,"MM","Mm")||"").forEach((function(e){return u.add(e)}))})),e.abrupt("return",(0,k.Z)(u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ht),yt=function(e){e.addRpcMethod((function(){return new mt(e)})),e.addRpcMethod((function(){return new vt(e)})),e.addRpcMethod((function(){return new gt(e)}))},bt=function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="CramAdapter",i=(0,xe.getFileName)(t),o={type:a,cramLocation:t,craiLocation:n||(0,xe.makeIndex)(t,".crai")};return/\.cram$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BamAdapter",i=(0,xe.getFileName)(t),o=n&&(0,xe.getFileName)(n),s={type:a,bamLocation:t,index:{location:n||(0,xe.makeIndex)(t,".bai"),indexType:(0,xe.makeIndexType)(o,"CSI","BAI")}};return/\.bam$/i.test(i)&&!r||r===a?s:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)}}))};var xt=function(e){return(0,u.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:f.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,u.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:f.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,ee.RH)(e),explicitlyTyped:!0})},wt=n(21051),kt=n.n(wt),Ct=n(42043),Zt=n(23642),St=n(78933),Tt=n(72824),Mt=n(35388);var Pt=(0,_.observer)((function(e){var t=e.model,n=t.sortedBy;return n?(0,J.jsx)("div",{"data-testid":"blurb-".concat(t.sortedBy),style:{backgroundColor:"white"},children:(0,J.jsx)(Mt.Z,{color:"secondary",variant:"caption",children:t.sortedBy?"Sorted by ".concat(n.type.toLowerCase()," at ").concat(n.refName,":").concat(n.pos):null})}):null})),Rt=["uniqueId"],At=(0,U.lazy)((function(){return n.e(4391).then(n.bind(n,4391))})),Lt=(0,U.lazy)((function(){return n.e(1280).then(n.bind(n,51280))})),Nt=(0,U.lazy)((function(){return n.e(9481).then(n.bind(n,59481))})),jt=(0,U.lazy)((function(){return n.e(6873).then(n.bind(n,26873))})),Ft=(0,U.lazy)((function(){return n.e(4947).then(n.bind(n,84947))})),It=(0,U.lazy)((function(){return n.e(2741).then(n.bind(n,62741))})),Bt=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);var Dt=function(e){return f.types.compose("LinearPileupDisplay",ee.fV,f.types.model({type:f.types.literal("LinearPileupDisplay"),configuration:(0,u.ConfigurationReference)(e),showSoftClipping:!1,featureHeight:f.types.maybe(f.types.number),noSpacing:f.types.maybe(f.types.boolean),fadeLikelihood:f.types.maybe(f.types.boolean),trackMaxHeight:f.types.maybe(f.types.number),mismatchAlpha:f.types.maybe(f.types.boolean),sortedBy:f.types.maybe(f.types.model({type:f.types.string,pos:f.types.number,tag:f.types.maybe(f.types.string),refName:f.types.string,assemblyName:f.types.string})),colorBy:f.types.maybe(f.types.model({type:f.types.string,tag:f.types.maybe(f.types.string),extra:f.types.frozen()})),filterBy:f.types.optional(Se,{})})).volatile((function(){return{colorTagMap:te.observable.map({}),modificationTagMap:te.observable.map({}),featureUnderMouseVolatile:void 0,currSortBpPerPx:0,ready:!1}})).actions((function(e){return{setReady:function(t){e.ready=t},setCurrSortBpPerPx:function(t){e.currSortBpPerPx=t},setMaxHeight:function(t){e.trackMaxHeight=t},setFeatureHeight:function(t){e.featureHeight=t},setNoSpacing:function(t){e.noSpacing=t},setColorScheme:function(t){e.colorTagMap=te.observable.map({}),e.colorBy=(0,f.cast)(t),e.ready=!1},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"];t.forEach((function(t){if(!e.modificationTagMap.has(t)){var r=(0,k.Z)(e.modificationTagMap.keys()).length,a=n[r];e.modificationTagMap.set(t,a)}}))},updateColorTagMap:function(t){var n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((function(t){if(!e.colorTagMap.has(t)){var r=(0,k.Z)(e.colorTagMap.keys()).length,a=n[r];e.colorTagMap.set(t,a)}}))},setFeatureUnderMouse:function(t){e.featureUnderMouseVolatile=t}}})).actions((function(e){return{afterAttach:function(){(0,f.addDisposer)(e,(0,te.autorun)((0,S.Z)((0,w.Z)().mark((function t(){var n,r,a,i,o,s,c,l,d,f,p,h,g,m;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=(0,M.getSession)(e),r=n.rpcManager,a=(0,M.getContainingView)(e),i=e.sortedBy,o=e.colorBy,s=e.parentTrack,c=e.adapterConfig,l=e.rendererType,a.initialized&&e.estimatedStatsReady&&!e.regionTooLarge){t.next=6;break}return t.abrupt("return");case 6:if(d=a.staticBlocks,f=a.bpPerPx,null===o||void 0===o||!o.tag){t.next=13;break}return t.t0=e,t.next=11,we(e,o,d);case 11:t.t1=t.sent,t.t0.updateColorTagMap.call(t.t0,t.t1);case 13:if("modifications"!==(null===o||void 0===o?void 0:o.type)){t.next=20;break}return p=(0,u.getConf)(s,["adapter"]),t.t2=e,t.next=18,Ce(e,p,o,d);case 18:t.t3=t.sent,t.t2.updateModificationColorMap.call(t.t2,t.t3);case 20:if(!i){t.next=28;break}return h=i.pos,g=i.refName,m=i.assemblyName,t.next=24,e.rendererType.renderInClient(r,(0,C.Z)({assemblyName:m,regions:[{start:h,end:h+1,refName:g,assemblyName:m}],adapterConfig:c,rendererType:l.name,sessionId:(0,xe.getRpcSessionId)(e),layoutId:a.id,timeout:1e6},e.renderProps()));case 24:e.setReady(!0),e.setCurrSortBpPerPx(f),t.next=29;break;case 28:e.setReady(!0);case 29:t.next=35;break;case 31:t.prev=31,t.t4=t.catch(0),console.error(t.t4),e.setError(t.t4);case 35:case"end":return t.stop()}}),t,null,[[0,31]])}))),{delay:1e3})),(0,f.addDisposer)(e,(0,te.autorun)((0,S.Z)((0,w.Z)().mark((function t(){var n,r,a,i,o,s,c;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=(0,M.getSession)(e),t.prev=1,a=e.featureIdUnderMouse,(null===(r=e.featureUnderMouse)||void 0===r?void 0:r.id())===a){t.next=15;break}if(a){t.next=8;break}e.setFeatureUnderMouse(void 0),t.next=15;break;case 8:return i=(0,xe.getRpcSessionId)(e),o=(0,M.getContainingView)(e),t.next=12,n.rpcManager.call(i,"CoreGetFeatureDetails",{featureId:a,sessionId:i,layoutId:o.id,rendererType:"PileupRenderer"});case 12:s=t.sent,c=s.feature,e.featureIdUnderMouse===c.uniqueId&&e.setFeatureUnderMouse(new M.SimpleFeature(c));case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(1),console.error(t.t0),n.notify("".concat(t.t0),"error");case 21:case"end":return t.stop()}}),t,null,[[1,17]])})))))},selectFeature:function(t){var n=(0,M.getSession)(e);if((0,M.isSessionModelWithWidgets)(n)){var r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,M.getContainingView)(e)});n.showWidget(r)}n.setSelection(t)},clearSelected:function(){e.sortedBy=void 0},copyFeatureToClipboard:function(t){var n=t.toJSON(),r=(n.uniqueId,(0,he.Z)(n,Rt)),a=(0,M.getSession)(e);kt()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")},toggleSoftClipping:function(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha:function(){e.mismatchAlpha=!e.mismatchAlpha},setConfig:function(t){e.configuration=t},setSortedBy:function(t,n){var r=(0,M.getContainingView)(e).centerLineInfo;if(r){var a=r.refName,i=r.assemblyName,o=r.offset,s=Math.round(o)+1;s<0||!a||(e.sortedBy={type:t,pos:s,refName:a,assemblyName:i,tag:n},e.ready=!1)}},setFilterBy:function(t){e.filterBy=(0,f.cast)(t)}}})).actions((function(e){var t=e.reload;return{reload:function(){e.clearSelected(),t()}}})).views((function(e){return{get maxHeight(){var t=(0,u.getConf)(e,["renderers",e.rendererTypeName])||{};return void 0!==e.trackMaxHeight?e.trackMaxHeight:t.maxHeight},get rendererConfig(){var t=(0,u.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create((0,C.Z)((0,C.Z)({},t),{},{height:e.featureHeight,noSpacing:e.noSpacing,maxHeight:this.maxHeight,mismatchAlpha:e.mismatchAlpha}),(0,M.getEnv)(e))},get featureHeightSetting(){return e.featureHeight||(0,u.readConfObject)(this.rendererConfig,"height")},get mismatchAlphaSetting(){return void 0!==e.mismatchAlpha?e.mismatchAlpha:(0,u.readConfObject)(this.rendererConfig,"mismatchAlpha")},get featureUnderMouse(){return e.featureUnderMouseVolatile}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{get rendererTypeName(){var t=(0,u.getConf)(e,"defaultRendering"),n=Bt.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},contextMenuItems:function(){var t=e.contextMenuFeature,n=t?[{label:"Open feature details",icon:St.Z,onClick:function(){e.clearFeatureSelection(),t&&e.selectFeature(t)}},{label:"Copy info to clipboard",icon:Zt.pt,onClick:function(){t&&e.copyFeatureToClipboard(t)}}]:[];return n},get DisplayBlurb(){return Pt},renderProps:function(){var t=(0,M.getContainingView)(e),r=e.colorTagMap,a=e.modificationTagMap,i=e.sortedBy,o=e.colorBy,s=e.filterBy,c=e.rpcDriverName,u=e.currSortBpPerPx,l=e.ready,d=n();return(0,C.Z)((0,C.Z)({},d),{},{notReady:d.notReady||!l||i&&u!==t.bpPerPx,rpcDriverName:c,displayModel:e,sortedBy:i,colorBy:o,filterBy:JSON.parse(JSON.stringify(s)),colorTagMap:Object.fromEntries(r.toJSON()),modificationTagMap:Object.fromEntries(a.toJSON()),showSoftClip:e.showSoftClipping,config:e.rendererConfig,onFeatureClick:function(t,n){return(0,S.Z)((0,w.Z)().mark((function t(){var r,a,i,o,s,c;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,M.getSession)(e),a=r.rpcManager,t.prev=2,i=n||e.featureIdUnderMouse){t.next=8;break}e.clearFeatureSelection(),t.next=14;break;case 8:return o=(0,xe.getRpcSessionId)(e),t.next=11,a.call(o,"CoreGetFeatureDetails",{featureId:i,sessionId:o,layoutId:(0,M.getContainingView)(e).id,rendererType:"PileupRenderer"});case 11:s=t.sent,(c=s.feature)&&e.selectFeature(new M.SimpleFeature(c));case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.error(t.t0),r.notify("".concat(t.t0));case 20:case"end":return t.stop()}}),t,null,[[2,16]])})))()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){return(0,S.Z)((0,w.Z)().mark((function t(){var r,a,i,o,s,c;return(0,w.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,M.getSession)(e),a=r.rpcManager,t.prev=2,i=n||e.featureIdUnderMouse){t.next=8;break}e.clearFeatureSelection(),t.next=14;break;case 8:return o=(0,xe.getRpcSessionId)(e),t.next=11,a.call(o,"CoreGetFeatureDetails",{featureId:i,sessionId:o,layoutId:(0,M.getContainingView)(e).id,rendererType:"PileupRenderer"});case 11:s=t.sent,(c=s.feature)&&e.setContextMenuFeature(new M.SimpleFeature(c));case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.error(t.t0),r.notify("".concat(t.t0));case 20:case"end":return t.stop()}}),t,null,[[2,16]])})))()}})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Show soft clipping",icon:Ct.Z,type:"checkbox",checked:e.showSoftClipping,onClick:function(){e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Sort by",icon:Tt.Z,disabled:e.showSoftClipping,subMenu:[].concat((0,k.Z)(["Start location","Read strand","Base pair"].map((function(t){return{label:t,onClick:function(){return e.setSortedBy(t)}}}))),[{label:"Sort by tag...",onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[Nt,{model:e,handleClose:t}]}))}},{label:"Clear sort",onClick:function(){return e.clearSelected()}}])},{label:"Color scheme",icon:je.Z,subMenu:[{label:"Normal",onClick:function(){return e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:function(){return e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:function(){return e.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:function(){return e.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:function(){return e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:function(){return e.setColorScheme({type:"perBaseLettering"})}},{label:"Modifications or methylation",onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[It,{model:e,handleClose:t}]}))}},{label:"Insert size",onClick:function(){return e.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:function(){return e.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[Lt,{model:e,handleClose:t}]}))}}]},{label:"Filter by",icon:Fe.Z,onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[At,{model:e,handleClose:t}]}))}},{label:"Set feature height",subMenu:[{label:"Normal",onClick:function(){e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:function(){e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[jt,{model:e,handleClose:t}]}))}}]},{label:"Set max height",onClick:function(){(0,M.getSession)(e).queueDialog((function(t){return[Ft,{model:e,handleClose:t}]}))}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:function(){return e.toggleMismatchAlpha()}}])}}}))};function Et(e){e.addDisplayType((function(){var t=xt(e);return new $.Z({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:Dt(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:ee.qb})}))}var Vt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="AlignmentsPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){[h,d,Et,Pe,it,b,m,K,yt,A,_e,rt,de,lt,bt].map((function(t){return t(e)}))}}]),n}(s.Z)},95920:function(e,t,n){"use strict";n.d(t,{ES:function(){return p},O:function(){return d},TN:function(){return u},h1:function(){return c},uD:function(){return l}});var r=n(32723),a=n(33028),i=n(34795),o=n(66043),s=n(56218);function c(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function u(e,t,n){return c(e,t)||c(e,n)}var l={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}};function d(e,t){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,c,u,l,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.end,u=t.originalRefName,l=t.refName,e.next=3,(0,s.z)(n.getFeatures((0,a.Z)((0,a.Z)({},t),{},{refName:u||l,end:c+1})).pipe((0,o.q)()));case 3:return d=e.sent,e.abrupt("return",null===(i=d[0])||void 0===i?void 0:i.get("seq"));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return"methylation"===e}},36526:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(91271),u=n(92777),l=n(63680),d=n(99836);var f=n(33028),p=n(9159);function h(e){return l.types.compose("LinearArcDisplay",u.fV,l.types.model({type:l.types.literal("LinearArcDisplay"),configuration:(0,p.B)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"staticBlocks"},get renderDelay(){return 500},renderProps:function(){return(0,f.Z)((0,f.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var g=function(e){e.addDisplayType((function(){var t=function(e){return(0,d.ConfigurationSchema)("LinearArcDisplay",{renderer:l.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:u.fU,explicitlyTyped:!0})}(e);return new c.DisplayType({name:"LinearArcDisplay",configSchema:t,stateModel:h(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:u.qb})}))},m=n(41361),v=n(96234),y=n(96902),b=n(97531),x=n(4782),w=n(28845),k=n(29938);var C=(0,x.observer)((function(e){var t,n=function(t,n){var r=e.onFeatureClick;if(r)return r(t,n)},r=e.features,a=e.config,i=e.regions,o=e.blockKey,s=e.bpPerPx,c=e.displayModel.selectedFeatureId,u=(0,v.Z)(i,1)[0],l=[],f=(0,m.Z)(r.values());try{var p=function(){var e=t.value,r=(0,b.bpSpanPx)(e.get("start"),e.get("end"),u,s),i=(0,v.Z)(r,2),f=i[0],p=i[1],h=e.id(),g=o+"-"+h,m=(0,d.readConfObject)(a,"color",{feature:e}),x="black";c&&String(c)===String(e.id())&&(m=x="red");var C=(0,d.readConfObject)(a,"label",{feature:e}),Z=(0,d.readConfObject)(a,"caption",{feature:e}),S=(0,d.readConfObject)(a,"thickness",{feature:e})||1,T=(0,d.readConfObject)(a,"height",{feature:e})||100,M=y.createRef(),P=20+(0,b.measureText)(null===Z||void 0===Z?void 0:Z.toString()),R=.5,A=0+R*T*.75+.375*T+0;l.push((0,k.jsxs)("g",{onClick:function(e){return n(e,h)},children:[(0,k.jsx)("path",{id:g,d:"M ".concat(f," 0 C ").concat(f," ").concat(T,", ").concat(p," ").concat(T,", ").concat(p," 0"),stroke:m,strokeWidth:S,fill:"transparent",onClick:function(e){return n(e,h)},ref:M,pointerEvents:"stroke"}),(0,k.jsxs)(w.u,{triggerRef:M,children:[(0,k.jsx)("rect",{x:12,y:0,width:P,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),(0,k.jsx)("text",{x:22,y:14,fontSize:10,fill:"white",textLength:P-20,children:Z})]}),(0,k.jsx)("text",{x:f+(p-f)/2,y:A+3,style:{stroke:"white",strokeWidth:"0.6em"},children:C}),(0,k.jsx)("text",{x:f+(p-f)/2,y:A+3,style:{stroke:x},children:C})]},g))};for(f.s();!(t=f.n()).done;)p()}catch(g){f.e(g)}finally{f.f()}var h=(u.end-u.start)/s;return(0,k.jsx)("svg",{className:"ArcRendering",width:h,height:500,style:{outline:"none",position:"relative"},children:l})}));var Z=(0,d.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]}},{explicitlyTyped:!0}),S=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n)}(n(13381).default),T=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ArcRenderer",e}return(0,a.Z)(n,[{key:"install",value:function(e){!function(e){e.addRendererType((function(){return new S({name:"ArcRenderer",ReactComponent:C,configSchema:Z,pluginManager:e})}))}(e),g(e),e.jexl.addFunction("logThickness",(function(e,t){return Math.log(e.get(t)+1)}))}}]),n}(s.Z)},44965:function(e,t,n){"use strict";n.d(t,{ZP:function(){return K}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(7857),u=n(99836),l=n(33991);var d=(0,u.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"code"},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!1}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),f=n(32723),p=n(34795),h=n(97531),g=n(63680),m=n(5295),v=n(97960).lW;function y(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var b=function(e){return l.InternetAccount.named("OAuthInternetAccount").props({type:g.types.literal("OAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)}).views((function(){var e=void 0;return{get codeVerifierPKCE(){if(e)return e;var t=function(){return"object"===typeof self&&self.self===self&&self||"object"===typeof n.g&&n.g.global===n.g&&n.g||this}(),r=new Uint8Array(32);return t.crypto.getRandomValues(r),e=y(v.from(r).toString("base64"))}}})).views((function(e){return{get authEndpoint(){return(0,u.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,u.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,u.getConf)(e,"needsPKCE")},get clientId(){return(0,u.getConf)(e,"clientId")},get scopes(){return(0,u.getConf)(e,"scopes")},state:function(){return(0,u.getConf)(e,"state")||void 0},get responseType(){return(0,u.getConf)(e,"responseType")},get hasRefreshToken(){return(0,u.getConf)(e,"hasRefreshToken")},get refreshTokenKey(){return"".concat(e.internetAccountId,"-refreshToken")}}})).actions((function(e){return{storeRefreshToken:function(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken:function(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:function(){return localStorage.getItem(e.refreshTokenKey)},exchangeAuthorizationForAccessToken:function(t,n){var r=this;return(0,p.Z)((0,f.Z)().mark((function a(){var i,o,s,c,u;return(0,f.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i={code:t,grant_type:"authorization_code",client_id:e.clientId,code_verifier:e.codeVerifierPKCE,redirect_uri:n},o=new URLSearchParams(Object.entries(i)),a.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});case 4:if((s=a.sent).ok){a.next=16;break}return a.prev=6,a.next=9,s.text();case 9:c=a.sent,a.next=15;break;case 12:a.prev=12,a.t0=a.catch(6),c="";case 15:throw new Error("Failed to obtain token from endpoint: ".concat(s.status," (").concat(s.statusText,")").concat(c?" (".concat(c,")"):""));case 16:return a.next=18,s.json();case 18:return(u=a.sent).refresh_token&&r.storeRefreshToken(u.refresh_token),a.abrupt("return",u.access_token);case 21:case"end":return a.stop()}}),a,null,[[6,12]])})))()},exchangeRefreshForAccessToken:function(t){var n=this;return(0,p.Z)((0,f.Z)().mark((function r(){var a,i,o,s,c,u,l;return(0,f.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={grant_type:"refresh_token",refresh_token:t,client_id:e.clientId},i=new URLSearchParams(Object.entries(a)),r.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()});case 4:if((o=r.sent).ok){r.next=12;break}return e.removeToken(),r.next=9,o.text();case 9:s=r.sent;try{"invalid_grant"===(u=JSON.parse(s)).error&&n.removeRefreshToken(),s=null!==(c=null===u||void 0===u?void 0:u.error_description)&&void 0!==c?c:s}catch(d){}throw new Error("Network response failure \u2014 ".concat(o.status," (").concat(o.statusText,") ").concat(s?" (".concat(s,")"):""));case 12:return r.next=14,o.json();case 14:return(l=r.sent).refresh_token&&n.storeRefreshToken(l.refresh_token),r.abrupt("return",l.access_token);case 17:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){var t,r=void 0;return{addMessageChannel:function(e,n){var r=this;t=function(t){r.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel:function(){window.removeEventListener("message",t)},finishOAuthWindow:function(t,n,r){var a=this;return(0,p.Z)((0,f.Z)().mark((function i(){var o,s,c,u,l,d,p,h;return(0,f.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t.data.name==="JBrowseAuthWindow-".concat(e.internetAccountId)){i.next=2;break}return i.abrupt("return",a.deleteMessageChannel());case 2:if(o=t.data.redirectUri,s=o.replace("#","?"),c=new URL(s),u=c.search,!(l=new URLSearchParams(u)).has("access_token")){i.next=13;break}if(d=l.get("access_token")){i.next=11;break}return i.abrupt("return",r(new Error("Error with token endpoint")));case 11:return e.storeToken(d),i.abrupt("return",n(d));case 13:if(!l.has("code")){i.next=32;break}if(p=l.get("code")){i.next=17;break}return i.abrupt("return",r(new Error("Error with authorization endpoint")));case 17:return i.prev=17,i.next=20,e.exchangeAuthorizationForAccessToken(p,c.origin+c.pathname);case 20:return h=i.sent,e.storeToken(h),i.abrupt("return",n(h));case 25:if(i.prev=25,i.t0=i.catch(17),!(i.t0 instanceof Error)){i.next=31;break}return i.abrupt("return",r(i.t0));case 31:return i.abrupt("return",r(new Error(String(i.t0))));case 32:if(!o.includes("access_denied")){i.next=34;break}return i.abrupt("return",r(new Error("OAuth flow was cancelled")));case 34:if(!o.includes("error")){i.next=36;break}return i.abrupt("return",r(new Error("Oauth flow error: "+u)));case 36:a.deleteMessageChannel();case 37:case"end":return i.stop()}}),i,null,[[17,25]])})))()},useEndpointForAuthorization:function(t,r){var a=this;return(0,p.Z)((0,f.Z)().mark((function i(){var o,s,c,u,l,d,p,g,m,v,b,x,w;return(0,f.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o=h.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,s={client_id:e.clientId,redirect_uri:o,response_type:e.responseType||"code"},e.state()&&(s.state=e.state()),e.scopes&&(s.scope=e.scopes),!e.needsPKCE){i.next=15;break}return c=e.codeVerifierPKCE,i.next=8,n.e(1916).then(n.t.bind(n,1916,23)).then((function(e){return e.default}));case 8:return u=i.sent,i.next=11,n.e(8682).then(n.t.bind(n,18682,23));case 11:l=i.sent,d=y(l.stringify(u(c))),s.code_challenge=d,s.code_challenge_method="S256";case 15:if(e.hasRefreshToken&&(s.token_access_type="offline"),p=new URLSearchParams(Object.entries(s)),(g=new URL(e.authEndpoint)).search=p.toString(),m="JBrowseAuthWindow-".concat(e.internetAccountId),!h.isElectron){i.next=29;break}return v=window.require("electron"),b=v.ipcRenderer,i.next=24,b.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:s,url:g.toString()});case 24:x=i.sent,w=new MessageEvent("message",{data:{name:m,redirectUri:x}}),a.finishOAuthWindow(w,t,r),i.next=31;break;case 29:"width=500,height=600,left=0,top=0",window.open(g,m,"width=500,height=600,left=0,top=0");case 31:case"end":return i.stop()}}),i)})))()},getTokenFromUser:function(t,n){var r=this;return(0,p.Z)((0,f.Z)().mark((function a(){var i;return(0,f.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=7;break}return a.t0=t,a.next=5,e.exchangeRefreshForAccessToken(i);case 5:a.t1=a.sent,(0,a.t0)(a.t1);case 7:r.addMessageChannel(t,n),r.useEndpointForAuthorization(t,n);case 9:case"end":return a.stop()}}),a)})))()},validateToken:function(t,n){var a=this;return(0,p.Z)((0,f.Z)().mark((function i(){var o,s,c;return(0,f.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!((o=(0,m.Z)(t)).exp&&o.exp<(new Date).getTime()/1e3)){i.next=17;break}if(!(s=e.hasRefreshToken&&e.retrieveRefreshToken())){i.next=15;break}return i.prev=4,r||(r=e.exchangeRefreshForAccessToken(s)),i.next=8,r;case 8:return c=i.sent,i.abrupt("return",a.validateToken(c,n));case 12:throw i.prev=12,i.t0=i.catch(4),new Error("Token could not be refreshed. ".concat(i.t0));case 15:i.next=18;break;case 17:r=void 0;case 18:return i.abrupt("return",t);case 19:case"end":return i.stop()}}),i,null,[[4,12]])})))()}}}))};var x=(0,u.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),w=n(96234),k=n(96902),C=n(52809),Z=n(66519),S=n(99688),T=n(44536),M=n(46186),P=n(29938),R=function(e){var t=e.internetAccountId,n=e.handleClose,r=(0,k.useState)(""),a=(0,w.Z)(r,2),i=a[0],o=a[1];return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(M.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",title:"Enter token for ".concat(t),children:[(0,P.jsx)(C.Z,{style:{display:"flex",flexDirection:"column"},children:(0,P.jsx)(Z.Z,{required:!0,label:"Enter Token",variant:"outlined",inputProps:{"data-testid":"entry-externalToken"},onChange:function(e){return o(e.target.value)},margin:"dense"})}),(0,P.jsxs)(S.Z,{children:[(0,P.jsx)(T.Z,{variant:"contained",color:"primary",type:"submit",disabled:!i,onClick:function(){i&&n(i)},children:"Add"}),(0,P.jsx)(T.Z,{variant:"contained",color:"primary",onClick:function(){return n()},children:"Cancel"})]})]})})},A=function(e){return l.InternetAccount.named("ExternalTokenInternetAccount").props({type:g.types.literal("ExternalTokenInternetAccount"),configuration:(0,u.ConfigurationReference)(e)}).views((function(e){return{get validateWithHEAD(){return(0,u.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){(0,g.getRoot)(e).session.queueDialog((function(r){return[R,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return(0,p.Z)((0,f.Z)().mark((function r(){var a,i,o;return(0,f.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((i=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,i.text();case 10:o=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),o="";case 16:throw new Error("Token could not be validated \u2014 ".concat(i.status," (").concat(i.statusText,")").concat(o?" (".concat(o,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))};var L=(0,u.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),N=n(99826),j=n(83674),F=function(e){var t=e.internetAccountId,n=e.handleClose,r=(0,k.useState)(""),a=(0,w.Z)(r,2),i=a[0],o=a[1],s=(0,k.useState)(""),c=(0,w.Z)(s,2),u=c[0],l=c[1];return(0,P.jsx)(P.Fragment,{children:(0,P.jsxs)(N.Z,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",children:[(0,P.jsxs)(j.Z,{children:["Log In for ",t]}),(0,P.jsxs)("form",{onSubmit:function(e){i&&u?n(btoa("".concat(i,":").concat(u))):n(),e.preventDefault()},children:[(0,P.jsxs)(C.Z,{style:{display:"flex",flexDirection:"column"},children:[(0,P.jsx)(Z.Z,{required:!0,label:"Username",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-username"},onChange:function(e){return o(e.target.value)},margin:"dense"}),(0,P.jsx)(Z.Z,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-password"},onChange:function(e){return l(e.target.value)},margin:"dense"})]}),(0,P.jsxs)(S.Z,{children:[(0,P.jsx)(T.Z,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),(0,P.jsx)(T.Z,{variant:"contained",type:"submit",onClick:function(){return n()},children:"Cancel"})]})]})]})})},I=function(e){return l.InternetAccount.named("HTTPBasicInternetAccount").props({type:g.types.literal("HTTPBasicInternetAccount"),configuration:(0,u.ConfigurationReference)(e)}).views((function(e){return{get validateWithHEAD(){return(0,u.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){(0,g.getRoot)(e).session.queueDialog((function(r){return[F,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return(0,p.Z)((0,f.Z)().mark((function r(){var a,i,o;return(0,f.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((i=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,i.text();case 10:o=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),o="";case 16:throw new Error("Error validating token \u2014 ".concat(i.status," (").concat(i.statusText,")").concat(o?" (".concat(o,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))};var B=(0,u.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!0}},{baseConfiguration:d,explicitlyTyped:!0}),D=n(33028),E=n(66026),V={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};function z(e){return(0,P.jsx)(E.Z,(0,D.Z)((0,D.Z)({},e),{},{children:(0,P.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"})}))}function O(e){return W.apply(this,arguments)}function W(){return(W=(0,p.Z)((0,f.Z)().mark((function e(t){var n,r,a;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(i){r=void 0}r&&(a=r.error[".tag"],n=V[a]||a)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var H=function(e){return b(d).named("DropboxOAuthInternetAccount").props({type:g.types.literal("DropboxOAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)}).views((function(){return{get toggleContents(){return(0,P.jsx)(z,{})},get selectorLabel(){return"Enter Dropbox share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,p.Z)((0,f.Z)().mark((function n(r,a){var i,o,s,c;return(0,f.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return i=n.sent,(o=e.addAuthHeaderToInit((0,D.Z)((0,D.Z)({},a),{},{method:"POST"}),i)).headers.append("Dropbox-API-Arg",JSON.stringify({url:r})),n.next=7,fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);case 7:if((s=n.sent).ok){n.next=13;break}return n.next=11,O(s);case 11:throw c=n.sent,new Error(c);case 13:return n.abrupt("return",s);case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},validateToken:function(t,n){var r=this;return(0,p.Z)((0,f.Z)().mark((function a(){var i,o,s,c;return(0,f.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});case 2:if((i=a.sent).ok){a.next=15;break}if(!(o=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=11;break}return e.removeRefreshToken(),a.next=9,e.exchangeRefreshForAccessToken(o);case 9:return s=a.sent,a.abrupt("return",r.validateToken(s,n));case 11:return a.next=13,O(i);case 13:throw c=a.sent,new Error("Token could not be validated. ".concat(c));case 15:return a.abrupt("return",t);case 16:case"end":return a.stop()}}),a)})))()}}}))};var G=(0,u.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:d,explicitlyTyped:!0}),q=n(93069),U=n(95058),_=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a){var i;return(0,r.Z)(this,n),(i=t.call(this,e,a)).statsPromise=void 0,i.statsPromise=i.fetch(e,{metadataOnly:!0}).then((function(e){return e.json()})),i}return(0,a.Z)(n,[{key:"fetch",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,r){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,q.Z)((0,U.Z)(n.prototype),"fetch",this).call(this,t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.statsPromise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(n(32145).RemoteFileWithRangeCache);function J(e){return(0,P.jsx)(E.Z,(0,D.Z)((0,D.Z)({},e),{},{children:(0,P.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"})}))}function X(e){return Y.apply(this,arguments)}function Y(){return(Y=(0,p.Z)((0,f.Z)().mark((function e(t){var n,r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(a){r=void 0}r&&(n=r.error.message)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var Q=function(e){return b(d).named("GoogleDriveOAuthInternetAccount").props({type:g.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)}).views((function(){return{get toggleContents(){return(0,P.jsx)(J,{})},get selectorLabel(){return"Enter Google Drive share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,p.Z)((0,f.Z)().mark((function n(r,a){var i,o,s,c,u,l,d;return(0,f.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=String(r).match(/[-\w]{25,}/),o=new URL("https://www.googleapis.com/drive/v3/files/".concat(i)),s=new URLSearchParams,null!==a&&void 0!==a&&a.metadataOnly?s.append("fields","size"):s.append("alt","media"),o.search=s.toString(),n.next=7,e.getToken(t);case 7:return c=n.sent,u=e.addAuthHeaderToInit((0,D.Z)((0,D.Z)({},a),{},{method:"GET",credentials:"same-origin"}),c),n.next=11,fetch(o.toString(),u);case 11:if((l=n.sent).ok){n.next=17;break}return n.next=15,X(l);case 15:throw d=n.sent,new Error(d);case 17:return n.abrupt("return",l);case 18:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},openLocation:function(e){return new _(e.uri,{fetch:this.getFetcher(e)})},validateToken:function(e,t){return(0,p.Z)((0,f.Z)().mark((function n(){var r,a,i;return(0,f.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.uri.match(/[-\w]{25,}/),n.next=3,fetch("https://www.googleapis.com/drive/v3/files/".concat(r),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((a=n.sent).ok){n.next=9;break}return n.next=7,X(a);case 7:throw i=n.sent,new Error("Token could not be validated. ".concat(i));case 9:return n.abrupt("return",e);case 10:case"end":return n.stop()}}),n)})))()}}}))},K=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="AuthenticationPlugin",e.exports={OAuthConfigSchema:d,OAuthInternetAccountModelFactory:b,ExternalTokenConfigSchema:x,ExternalTokenInternetAccountModelFactory:A,HTTPBasicConfigSchema:L,HTTPBasicInternetAccountModelFactory:I,DropboxOAuthConfigSchema:B,DropboxOAuthInternetAccountModelFactory:H,GoogleDriveOAuthConfigSchema:G,GoogleDriveOAuthInternetAccountModelFactory:Q},e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addInternetAccountType((function(){return new c.Z({name:"OAuthInternetAccount",configSchema:d,stateModel:b(d)})})),e.addInternetAccountType((function(){return new c.Z({name:"ExternalTokenInternetAccount",configSchema:x,stateModel:A(x)})})),e.addInternetAccountType((function(){return new c.Z({name:"HTTPBasicInternetAccount",configSchema:L,stateModel:I(L)})})),e.addInternetAccountType((function(){return new c.Z({name:"DropboxOAuthInternetAccount",configSchema:B,stateModel:H(B)})})),e.addInternetAccountType((function(){return new c.Z({name:"GoogleDriveOAuthInternetAccount",configSchema:G,stateModel:Q(G)})}))}}]),n}(s.Z)},93799:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(5868),u=n(99836);var l=(0,u.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0});var d=(0,u.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0}),f=n(63680);var p=(0,u.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,u.ConfigurationSchema)("TabixIndex",{indexType:{model:f.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0});var h=(0,u.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0}),g=n(16151),m=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BedPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.Z({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:l,getAdapterClass:function(){return Promise.all([n.e(2018),n.e(730),n.e(590),n.e(7246)]).then(n.bind(n,27246)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"BedAdapter",displayName:"BED adapter",configSchema:h,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(8538),n.e(730),n.e(6809)]).then(n.bind(n,56809)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:d,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(8538),n.e(1988)]).then(n.bind(n,31988)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:p,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2094),n.e(2018),n.e(7704),n.e(730),n.e(7068)]).then(n.bind(n,57068)).then((function(e){return e.default}))}})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigBedAdapter",i=(0,g.getFileName)(t),o={type:a,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BedpeAdapter",i=(0,g.getFileName)(t);return/\.bedpe\.gz$/i.test(i)||r===a?{type:a,bedpeLocation:t}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BedTabixAdapter",i=(0,g.getFileName)(t),o=n&&(0,g.getFileName)(n);return/\.bed\.b?gz$/i.test(i)||r===a?{type:a,bedGzLocation:t,index:{location:n||(0,g.makeIndex)(t,".tbi"),indexType:(0,g.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BedAdapter",i=(0,g.getFileName)(t);return/\.bed$/i.test(i)||r===a?{type:a,bedLocation:t}:e(t,n,r)}}))}}]),s}(s.Z)},592:function(e,t,n){"use strict";n.d(t,{Z:function(){return le}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(96902),u=n(99836),l=n(42328),d=n(63680),f=n(91271),p=(0,u.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),h=d.types.model("BreakpointAlignmentsWidget",{id:l.ElementId,type:d.types.literal("BreakpointAlignmentsWidget"),featureData:d.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),g=n(33028),m=n(4782),v=n(91188),y=n(96234),b=n(9672),x=n.n(b),w=n(97531),k=n(41361),C=n(70899);var Z=[0,1,2,3],S=Z[1],T=Z[3];function M(e,t,n){return((e.bpToPx({refName:t,coord:n})||{}).offsetPx||0)-e.offsetPx}function P(e,t,n,r,a){var i,o=r[t].displays[0],s=o.height,c=0,u=o.SNPCoverageDisplay;return u&&(c=u.height),(0,w.clamp)(a[S]-o.scrollTop+((i=a)[T]-i[S])/2+c,0,s)+function(e,t,n){var r=e[n].trackRefs[t];return(null===r||void 0===r?void 0:r.getBoundingClientRect().top)||0}(n,e,t)+o.scrollTop}var R=function(e){var t=(0,c.useState)(),n=(0,y.Z)(t,2)[1];(0,c.useEffect)((function(){n(e)}),[e])};function A(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).map((function(t){return e(t)})),r=t.filter((function(t){return n.includes(e(t))})),a=arguments.length,i=new Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];return 0===i.length?r:A.apply(void 0,[e,r].concat(i))}var L=n(29938),N=[0,1,2,3],j=N[0],F=N[2],I=(0,m.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=t.showIntraviewLinks,o=(0,w.getSession)(t),s=(0,d.getSnapshot)(t),u=o.assemblyManager.get(a[0].assemblyNames[0]);R(s);var l=t.getTrackFeatures(n),f=(0,c.useMemo)((function(){return function(e){var t,n=(0,k.Z)(e.values());try{for(n.s();!(t=n.n()).done;)if(1&t.value.get("flags"))return!0}catch(r){n.e(r)}finally{n.f()}return!1}(l)}),[l]),p=(0,c.useMemo)((function(){var e=t.getMatchedFeaturesInLayout(n,f?function(e){var t,n={},r=new Set,a=(0,k.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.get("flags"),s=i.id(),c=4&o,u=2&o;if(!r.has(s)&&!u&&!c){var l=i.get("name");n[l]||(n[l]=[]),n[l].push(i)}r.add(i.id())}}catch(d){a.e(d)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(l):function(e){var t,n={},r=new Set,a=(0,k.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.id(),s=4&i.get("flags");if(!r.has(o)&&!s){var c=i.get("name");n[c]||(n[c]=[]),n[c].push(i)}r.add(i.id())}}catch(u){a.e(u)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(l));return f||e.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))})),e}),[l,n,f,t]),h=(0,c.useState)(),g=(0,y.Z)(h,2),m=g[0],v=g[1],b=0;if(r.current){var C=r.current.getBoundingClientRect();b=C.top}return u?(0,L.jsx)("g",{stroke:"#333",fill:"none","data-testid":p.length?"".concat(n,"-loaded"):n,children:p.map((function(e){for(var t=[],r=function(){var r=e[s],c=r.layout,d=r.feature,p=r.level,h=e[s+1],g=h.layout,y=h.feature,w=h.level;if(!c||!g)return console.warn("received null layout for a overlay feature"),{v:null};if(!i&&p===w)return{v:null};var k=u.getCanonicalRefName(d.get("refName")),C=u.getCanonicalRefName(y.get("refName"));if(!k||!C)throw new Error("unable to find ref for ".concat(k||C));var Z=d.get("strand"),S=y.get("strand"),T=c[-1===Z?j:F],R=f?g[-1===S?j:F]:g[-1===S?F:j],A=M(a[p],k,T),N=M(a[w],C,R),I=a[p].pxToBp(A).reversed,B=a[w].pxToBp(N).reversed,D=a.map((function(e){return e.getTrack(n)})),E=P(n,p,a,D,c)-b,V=P(n,w,a,D,g)-b,z=x()().moveTo(A,E).curveTo(A+200*d.get("strand")*(I?-1:1),E,N-200*y.get("strand")*(B?-1:1)*(f?-1:1),V,N,V).end(),O="".concat(d.id(),"-").concat(y.id());t.push((0,L.jsx)("path",{d:z,"data-testid":"r1",strokeWidth:m===O?5:1,onClick:function(){var e,t,n=null===(e=o.addWidget)||void 0===e?void 0:e.call(o,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(l.get(d.id())||{toJSON:function(){}}).toJSON(),feature2:(l.get(y.id())||{toJSON:function(){}}).toJSON()}});null===(t=o.showWidget)||void 0===t||t.call(o,n)},onMouseOver:function(){return v(O)},onMouseOut:function(){return v(void 0)}},O))},s=0;s<e.length-1;s++){var c=r();if("object"===typeof c)return c.v}return t}))}):null})),B=(0,m.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=(0,w.getSession)(t),o=i.assemblyManager,s=t.getTrackFeatures(n),u=(0,c.useMemo)((function(){return t.getMatchedFeaturesInLayout(n,function(e){var t,n={},r=new Set,a=(0,k.Z)(e.values());try{var i=function(){var e=t.value;if(!r.has(e.id())&&"breakend"===e.get("type")){var a=e.get("ALT");null===a||void 0===a||a.forEach((function(t){var r="".concat(e.get("refName"),":").concat(e.get("start")+1),a=(0,C.I)(t);a&&(n[r]?n[r].push(e):n[a.MatePosition||"none"]=[e])}))}r.add(e.id())};for(a.s();!(t=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(s))}),[s,n,t]),l=(0,c.useState)(),f=(0,y.Z)(l,2),p=f[0],h=f[1],g=(0,d.getSnapshot)(t);R(g);var m=o.get(a[0].assemblyNames[0]);if(!m)return null;var v=0;if(r.current){var b=r.current.getBoundingClientRect();v=b.top}return(0,L.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":u.length?"".concat(n,"-loaded"):n,children:u.map((function(e){for(var t=[],r=function(){var r=e[o],c=r.layout,u=r.feature,l=r.level,d=e[o+1],f=d.layout,g=d.feature,y=d.level,b=u.id(),w=function(e,t){var n=e.get("ALT");if(n)return Object.fromEntries(null===n||void 0===n?void 0:n.map((function(e){return(0,C.I)(e)})).filter((function(e){return!!e})).map((function(e){return[e.MatePosition,e]})))["".concat(t.get("refName"),":").concat(t.get("start")+1)]}(u,g);if(!c||!f)return{v:null};var k=u.get("refName"),Z=g.get("refName"),S=m.getCanonicalRefName(k),T=m.getCanonicalRefName(Z);if(!S||!T)throw new Error("unable to find ref for ".concat(S||T));var R=M(a[l],S,c[0]),A=M(a[y],T,f[0]),N=a[l].pxToBp(R).reversed,j=a[y].pxToBp(A).reversed,F=a.map((function(e){return e.getTrack(n)})),I=P(n,l,a,F,c)-v,B=P(n,y,a,F,f)-v;if(w){var D=x()().moveTo(R-20*("left"===w.Join?-1:1)*(N?-1:1),I).lineTo(R,I).lineTo(A,B).lineTo(A-20*("left"===w.MateDirection?1:-1)*(j?-1:1),B).end();t.push((0,L.jsx)("path",{d:D,strokeWidth:b===p?10:5,onClick:function(){var e,t,n,r=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:null===(t=s.get(b))||void 0===t?void 0:t.toJSON()});null===(n=i.showWidget)||void 0===n||n.call(i,r)},onMouseOver:function(){return h(b)},onMouseOut:function(){return h(void 0)}},JSON.stringify(D)))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1){var c=r();if("object"===typeof c)return c.v}return t}))})})),D=n(25322),E=n(55383),V=n(58470),z=n(39068),O=n(92233),W=n(56452),H=n(49391),G=(0,v.ZL)()({headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1}}),q=(0,m.observer)((function(e){var t=e.model;return(0,L.jsx)(D.Z,{onClick:function(){return t.toggleInteract()},title:"Toggle interacting with the overlay",children:t.interactToggled?(0,L.jsx)(E.Z,{}):(0,L.jsx)(V.Z,{})})})),U=(0,m.observer)((function(e){var t=e.model;return(0,L.jsx)(D.Z,{onClick:function(){return t.toggleLinkViews()},title:"Toggle linked scrolls and behavior across views",children:t.linkViews?(0,L.jsx)(W.Z,{}):(0,L.jsx)(H.Z,{})})})),_=(0,m.observer)((function(e){var t=e.model;return(0,L.jsx)(D.Z,{onClick:t.toggleIntraviewLinks,title:"Toggle rendering intraview links",children:t.showIntraviewLinks?(0,L.jsx)(z.Z,{}):(0,L.jsx)(O.Z,{})})})),J=(0,m.observer)((function(e){var t=e.model,n=G().classes;return(0,L.jsxs)("div",{className:n.headerBar,children:[(0,L.jsx)(U,{model:t}),(0,L.jsx)(q,{model:t}),(0,L.jsx)(_,{model:t}),(0,L.jsx)("div",{className:n.spacer})]})})),X=(0,m.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=(0,w.getSession)(t),o=i.assemblyManager,s=t.getTrackFeatures(n),u=(0,c.useMemo)((function(){return t.getMatchedFeaturesInLayout(n,function(e){var t,n=[],r=new Set,a=(0,k.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value;r.has(i.id())||"<TRA>"===i.get("ALT")[0]&&n.push([i]),r.add(i.id())}}catch(o){a.e(o)}finally{a.f()}return n}(s))}),[s,n,t]),l=(0,c.useState)(),f=(0,y.Z)(l,2),p=f[0],h=f[1],g=(0,d.getSnapshot)(t);if(R(g),!o.get(a[0].assemblyNames[0]))return null;var m=0;if(r.current){var v=r.current.getBoundingClientRect();m=v.top}return a.length<2?null:(0,L.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":u.length?"".concat(n,"-loaded"):n,children:u.map((function(e){for(var t=[],r=function(){var r=e[o],c=r.layout,u=r.feature,l=r.level,d=0===l?1:0,f=u.id();if(!c)return{v:null};var g=u.get("INFO"),v=g.CHR2[0],b=g.END[0],w=g.STRANDS[0].split(""),k=(0,y.Z)(w,2),C=k[0],Z=k[1],S=M(a[d],v,b);if(S){var T=[S,0,S+1,0],R=M(a[l],u.get("refName"),c[0]),A=S,N=a[l].pxToBp(R).reversed,j=a[d].pxToBp(A).reversed,F=a.map((function(e){return e.getTrack(n)})),I=P(n,l,a,F,c)-m,B=P(n,d,a,F,T)-m,D=x()().moveTo(R-20*("+"===C?1:-1)*(N?-1:1),I).lineTo(R,I).lineTo(A,B).lineTo(A-20*("+"===Z?1:-1)*(j?-1:1),B).end();t.push((0,L.jsx)("path",{d:D,strokeWidth:f===p?10:5,onClick:function(){var e,t,n=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:(s.get(f)||{toJSON:function(){}}).toJSON()});null===(t=i.showWidget)||void 0===t||t.call(i,n)},onMouseOver:function(){return h(f)},onMouseOut:function(){return h(void 0)}},JSON.stringify(D)))}},o=0;o<e.length;o+=1){var c=r();if("object"===typeof c)return c.v}return t}))})})),Y=(0,v.ZL)()((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:3,background:"magenta"},viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}},content:{gridArea:"1/1"}}})),Q=(0,m.observer)((function(e){var t,n,r=e.model,a=e.trackId,i=r.getMatchedTracks(a);return"AlignmentsTrack"===(null===(t=i[0])||void 0===t?void 0:t.type)?(0,L.jsx)(I,(0,g.Z)({},e)):"VariantTrack"===(null===(n=i[0])||void 0===n?void 0:n.type)?r.hasTranslocations(a)?(0,L.jsx)(X,(0,g.Z)({},e)):(0,L.jsx)(B,(0,g.Z)({},e)):null})),K=(0,m.observer)((function(e){var t=e.model,n=Y().classes,r=t.views,a=(0,d.getEnv)(t).pluginManager,i=(0,c.useRef)(null);return(0,L.jsxs)("div",{children:[(0,L.jsx)(J,{model:t}),(0,L.jsxs)("div",{className:n.container,children:[(0,L.jsx)("div",{className:n.content,children:(0,L.jsx)("div",{style:{position:"relative"},children:r.map((function(e,t){var i=a.getViewType(e.type).ReactComponent,o=(0,L.jsx)(i,{model:e},e.id);return t===r.length-1?o:[o,(0,L.jsx)("div",{className:n.viewDivider},"".concat(e.id,"-divider"))]}))})}),(0,L.jsx)("div",{className:n.overlay,children:(0,L.jsx)("svg",{ref:i,style:{width:"100%",zIndex:10,pointerEvents:t.interactToggled?void 0:"none"},children:t.matchedTracks.map((function(e){return(0,L.jsx)(Q,{parentRef:i,model:t,trackId:e.configuration.trackId},e.configuration.trackId)}))})})]})]})})),$=K,ee=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"snapshotFromBreakendFeature",value:function(e,t){var n,r,a=null===(n=e.get("ALT"))||void 0===n?void 0:n[0],i=a?(0,C.I)(a):void 0,o=e.get("start"),s=t.displayedRegions[0].assemblyName,c=(0,w.getSession)(t).assemblyManager.get(s);if(!c)throw new Error("assembly ".concat(s," not found"));if(!c.regions)throw new Error("assembly ".concat(s," regions not loaded"));var u,l=c.getCanonicalRefName,d=l(e.get("refName")),f=c.regions.find((function(e){return e.refName===d})),p=0,h=0;if("<TRA>"===a){var m=e.get("INFO");r=m.END[0]-1,u=l(m.CHR2[0])}else if(null!==i&&void 0!==i&&i.MatePosition){var v=i.MatePosition.split(":");r=+v[1]-1,u=l(v[0]),"left"===i.Join&&(p=-1),"left"===i.MateDirection&&(h=-1)}else if(e.get("mate")){var y=e.get("mate");u=l(y.refName),r=y.start}if(!u)return console.warn("unable to resolve mate refName ".concat(u," in reference genome")),{};var b=c.regions.find((function(e){return e.refName===u}));if(!f||!b)return console.warn("unable to find the refName for the top or bottom of the breakpoint view"),{};var x=[(0,g.Z)({},f),(0,g.Z)({},f)],k=[(0,g.Z)({},b),(0,g.Z)({},b)];return x[0].end=o+p,x[1].start=o+p,k[0].end=r+h,k[1].start=r+h,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:x,hideHeader:!0,bpPerPx:10,offsetPx:(f.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:k,hideHeader:!0,bpPerPx:10,offsetPx:(b.start+r)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail")}}}]),n}(n(65317).Z),te=n(32723),ne=n(68079),re=n(34795),ae=n(75717),ie=n(33991);function oe(e,t){return e.displays[0].searchFeatureByID(t.id())}function se(e,t){return ce.apply(this,arguments)}function ce(){return ce=(0,re.Z)((0,te.Z)().mark((function e(t,n){var r,a,i,o,s,c;return(0,te.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.views,a=(0,w.getSession)(t),i=a.rpcManager,o=a.assemblyManager,s=t.views[0].assemblyNames[0],e.next=5,o.waitForAssembly(s);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",void 0);case 8:return c=n.configuration.trackId,e.abrupt("return",Promise.all(r.map(function(){var e=(0,re.Z)((0,te.Z)().mark((function e(t){return(0,te.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.call(c,"CoreGetFeatures",{adapterConfig:(0,u.getConf)(n,["adapter"]),sessionId:c,regions:t.staticBlocks.contentBlocks});case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 10:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function ue(e){var t=d.types.model("BreakpointSplitView",{type:d.types.literal("BreakpointSplitView"),height:d.types.optional(d.types.refinement("viewHeight",d.types.number,(function(e){return e>=40})),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:d.types.array(e.getViewType("LinearGenomeView").stateModel)}).volatile((function(){return{width:800,matchedTrackFeatures:{}}})).views((function(e){return{get matchedTracks(){return A.apply(void 0,[function(e){return e.configuration.trackId}].concat((0,ne.Z)(e.views.map((function(e){return e.tracks})))))},menuItems:function(){e.views.map((function(e,t){var n;return[t,null===(n=e.menuItems)||void 0===n?void 0:n.call(e)]})).filter((function(e){return!!e[1]})).map((function(e){return{label:"View ".concat(e[0]," Menu"),subMenu:e[1]}}))},getMatchedTracks:function(t){return e.views.map((function(e){return e.getTrack(t)})).filter((function(e){return!!e}))},hasTranslocations:function(e){return(0,ne.Z)(this.getTrackFeatures(e).values()).find((function(e){return"translocation"===e.get("type")}))},getTrackFeatures:function(t){var n;return new Map(null===(n=e.matchedTrackFeatures[t])||void 0===n?void 0:n.flat().map((function(e){return[e.id(),e]})))},getMatchedFeaturesInLayout:function(e,t){var n=this.getMatchedTracks(e);return t.map((function(e){return e.map((function(e){var t=n.findIndex((function(t){return oe(t,e)}));return-1!==t?{feature:e,layout:oe(n[t],e),level:t}:void 0})).filter((function(e){return!!e}))}))}}})).actions((function(e){return{afterAttach:function(){var t=this;(0,d.addDisposer)(e,(0,d.onAction)(e,(function(n){var r=n.name,a=n.path,i=n.args;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(r)&&a&&t.onSubviewAction(r,a,i)}})))},onSubviewAction:function(t,n,r){e.views.forEach((function(e){var a=(0,d.getPath)(e);a.lastIndexOf(n)!==a.length-n.length&&e[t](null===r||void 0===r?void 0:r[0])}))},setWidth:function(t){e.width=t,e.views.forEach((function(e){return e.setWidth(t)}))},removeView:function(t){e.views.remove(t)},closeView:function(){(0,d.getParent)(e,2).removeView(e)},toggleInteract:function(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks:function(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews:function(){e.linkViews=!e.linkViews},setMatchedTrackFeatures:function(t){e.matchedTrackFeatures=t}}})).actions((function(e){return{afterAttach:function(){(0,d.addDisposer)(e,(0,ae.autorun)((0,re.Z)((0,te.Z)().mark((function t(){return(0,te.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.views.every((function(e){return e.initialized}))){t.next=3;break}return t.abrupt("return");case 3:return t.t0=e,t.t1=Object,t.next=7,Promise.all(e.matchedTracks.map(function(){var t=(0,re.Z)((0,te.Z)().mark((function t(n){return(0,te.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n.configuration.trackId,t.next=3,se(e,n);case 3:return t.t1=t.sent,t.abrupt("return",[t.t0,t.t1]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 7:t.t2=t.sent,t.t3=t.t1.fromEntries.call(t.t1,t.t2),t.t0.setMatchedTrackFeatures.call(t.t0,t.t3),t.next=16;break;case 12:t.prev=12,t.t4=t.catch(0),console.error(t.t4),(0,w.getSession)(e).notify("".concat(t.t4),"error");case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))))}}}));return d.types.compose(ie.BaseViewModel,t)}var le=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BreakpointSplitViewPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new ee({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:ue(e),ReactComponent:$})}))}(e),function(e){e.addWidgetType((function(){return new f.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:p,stateModel:h,ReactComponent:(0,c.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(1145)]).then(n.bind(n,55303))}))})}))}(e)}},{key:"configure",value:function(){}}]),s}(s.Z)},24277:function(e,t,n){"use strict";n.d(t,{lJ:function(){return I},pL:function(){return q},_U:function(){return U},ZP:function(){return _}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(97531),c=n(87977),u=n(96902),l=n(65317),d=n(33028),f=n(41361),p=n(63680),h=n(42328),g=n(75717),m=n(99836),v=n(33991),y=n(96234);function b(e,t,n,r,a){var i=Math.abs(e-n);if(!(i>r)){i===r&&a.push([t,e]);var o=Math.sqrt(r*r-i*i);a.push([t-o,e]),a.push([t+o,e])}}function x(e,t,n,r,a){var i=Math.abs(e-t);if(!(i>r)){i===r&&a.push([e,n]);var o=Math.sqrt(r*r-i*i);a.push([e,n-o]),a.push([e,n+o])}}function w(e,t){var n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];var r=function(e,t){var n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}var k=2*Math.PI;var C=function(){function e(t,n,a,i){(0,r.Z)(this,e),this.region=n,this.radianWidth=i,this.key=void 0,this.offsetRadians=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.flipped=void 0;var o=t.bpPerRadian;this.key=(0,s.assembleLocString)(n),this.offsetRadians=a,this.bpPerRadian=o,this.flipped=!1,this.startRadians=this.offsetRadians,this.endRadians=n.widthBp/this.bpPerRadian+this.offsetRadians,Object.freeze(this)}return(0,a.Z)(e,[{key:"bpToXY",value:function(e,t){var n=(this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start)/this.bpPerRadian+this.offsetRadians;return(0,s.polarToCartesian)(t,n)}},{key:"toJSON",value:function(){return Object.fromEntries(Object.entries(this))}}]),e}();function Z(e,t){var n,r,a,i,o=(0,y.Z)(e.visibleSection.theta,2),s=o[0],c=o[1];return n=t.offsetRadians+e.offsetRadians,r=t.radianWidth,a=s,i=c-s,!(r<=0||i<=0)&&(r+1e-4>=k||i+1e-4>=k||(n=(n%k+k)%k+k)<(a=(a%k+k)%k+k)+i&&n+r>a||n<(a-=k)+i&&n+r>a||n<(a+=k+k)+i&&n+r>a)}var S=function(e){return p.types.compose(v.BaseViewModel,p.types.model("CircularView",{type:p.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:p.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:p.types.optional(p.types.refinement("trackHeight",p.types.number,(function(e){return e>=40})),400),displayedRegions:p.types.array(h.Region),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile((function(){return{volatileWidth:void 0,error:void 0}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get staticSlices(){return function(e){var t,n=[],r=0,a=(0,f.Z)(e.elidedRegions);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.widthBp/e.bpPerRadian+e.spacingPx/e.pxPerRadian;n.push(new C(e,i,r,o)),r+=o}}catch(s){a.e(s)}finally{a.f()}return n}(e)},get visibleSection(){return function(e,t,n){var r=(0,y.Z)(e,4),a=r[0],i=r[1],o=r[2],s=r[3],c=(0,y.Z)(t,2),u=c[0],l=c[1];if(i-=u,o-=l,s-=l,(a-=u)<0&&i>0&&o<0&&s>0){for(var d=[[a,o],[i,o],[a,s],[i,s]],f=-1/0,p=0;p<d.length;p+=1){var h=(0,y.Z)(d[p],2),g=h[0],m=h[1],v=Math.sqrt(g*g+m*m);v>f&&(f=v)}return{rho:[0,Math.min(n,f)],theta:[0,2*Math.PI]}}var k=[[a,o],[i,o],[a,s],[i,s]];x(a,0,0,n,k),x(i,0,0,n,k),b(o,0,0,n,k),b(s,0,0,n,k),-a<n&&k.push([a,0]),i<n&&k.push([i,0]),-o<n&&k.push([0,o]),s<n&&k.push([0,s]);for(var C=a>=0?-1:1,Z=1/0,S=-1/0,T=1/0,M=-1/0,P=0;P<k.length;P+=1){var R=(0,y.Z)(k[P],2),A=R[0],L=R[1];if(A>=a&&A<=i&&L>=o&&L<=s){var N=w(A*C,L*C),j=(0,y.Z)(N,2),F=j[0],I=j[1];F<=n+.001&&(I<T&&F>1e-4&&(T=I),I>M&&F>1e-4&&(M=I),F<Z&&(Z=F),F>S&&(S=F))}}return-1===C&&(T+=Math.PI,M+=Math.PI),T>2*Math.PI&&M>2*Math.PI&&(T-=2*Math.PI,M-=2*Math.PI),{rho:[Z,Math.min(n,S)],theta:[T,M]}}([e.scrollX,e.scrollX+e.width,e.scrollY,e.scrollY+e.height],this.centerXY,this.radiusPx)},get circumferencePx(){var t,n=0,r=(0,f.Z)(this.elidedRegions);try{for(r.s();!(t=r.n()).done;){n+=t.value.widthBp}}catch(a){r.e(a)}finally{r.f()}return n/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){var t,n=0,r=(0,f.Z)(e.displayedRegions);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a.end-a.start}}catch(i){r.e(i)}finally{r.f()}return n},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){var t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){var e=2*Math.PI*this.maximumRadiusPx;return(0,s.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){var t=[];e.displayedRegions.forEach((function(n){var r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){var a=t[t.length-1];null!==a&&void 0!==a&&a.elided?(a.regions.push((0,d.Z)({},n)),a.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[(0,d.Z)({},n)]})}else t.push((0,d.Z)((0,d.Z)({},n),{},{widthBp:r,elided:!1}))}));for(var n=0;n<t.length;n+=1){var r=t[n];r.elided&&1===r.regions.length&&(t[n]=(0,d.Z)((0,d.Z)((0,d.Z)({},r),r.regions[0]),{},{elided:!1}))}return t},get assemblyNames(){var t=[];return e.displayedRegions.forEach((function(e){t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){var t=(0,s.getSession)(e).assemblyManager;return void 0!==e.volatileWidth&&this.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))}}})).views((function(e){return{get visibleStaticSlices(){return e.staticSlices.filter((function(t){return Z(e,t)}))}}})).actions((function(t){return{setWidth:function(e){return t.volatileWidth=Math.max(e,100),t.volatileWidth},setHeight:function(e){return t.height=Math.max(e,40),t.height},resizeHeight:function(e){var n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth:function(e){var n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton:function(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton:function(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton:function(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton:function(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx:function(e){t.bpPerPx=(0,s.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust:function(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView:function(){(0,p.getParent)(t,2).removeView(t)},setDisplayedRegions:function(e){var n=0===t.displayedRegions.length;t.displayedRegions=(0,p.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=(0,s.getSession)(t);if((0,s.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setError:function(e){t.error=e},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=(0,p.resolveIdentifier)(a,(0,p.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=e.getViewType(t.type).displayTypes.map((function(e){return e.name})),c=i.displays.find((function(e){return s.includes(e.type)})),u=o.stateModel.create((0,d.Z)((0,d.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]}));t.tracks.push(u)},addTrackConf:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type,i=(0,m.readConfObject)(n,"name"),o=e.getTrackType(a);if(!o)throw new Error("unknown track type ".concat(n.type));var s=e.getViewType(t.type).displayTypes.map((function(e){return e.name})),c=n.displays.find((function(e){return s.includes(e.type)})),u=o.stateModel.create((0,d.Z)((0,d.Z)({},r),{},{name:i,type:a,configuration:n,displays:[{type:c.type,configuration:c}]}));t.tracks.push(u)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,p.resolveIdentifier)(r,(0,p.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,g.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},toggleFitToWindowLock:function(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow}}}))},T=n(32723),M=n(34795),P=n(40655),R=n(4782),A=n(91188),L=n(29938),N=(0,A.ZL)()((function(e){var t=e.palette,n=t.primary,r=t.secondary,a=t.tertiary,i=t.quaternary;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:n.light},"25%":{stroke:r.light},"50%":{stroke:a.light},"75%":{stroke:i.light},"100%":{stroke:n.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}})),j=(0,R.observer)((function(e){var t=e.model.renderProps.radius,n=N().classes,r=(0,u.useState)(!1),a=(0,y.Z)(r,2),i=a[0],o=a[1];return(0,u.useEffect)((function(){var e=setTimeout((function(){return o(!0)}),400);return function(){return clearTimeout(e)}})),i?(0,L.jsxs)("g",{children:[(0,L.jsx)("defs",{children:(0,L.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,L.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),(0,L.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),(0,L.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),(0,L.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading\u2026"}),(0,L.jsx)("circle",{className:n.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null})),F=(0,R.observer)((function(e){var t=e.model,n=t.renderProps.radius,r=t.error;return(0,L.jsxs)("g",{children:[(0,L.jsx)("defs",{children:(0,L.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,L.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),(0,L.jsx)("circle",{cx:"0",cy:"0",r:n,fill:"#ffb4b4"}),(0,L.jsx)("circle",{cx:"0",cy:"0",r:n,fill:"url(#diagonalHatch)"}),(0,L.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(r)})]})})),I=(0,R.observer)((function(e){var t=e.display;return t.error?(0,L.jsx)(F,{model:t}):t.filled?t.reactElement:(0,L.jsx)(j,{model:t})})),B=n(73636),D=n.n(B),E=n(73749),V=n(16151),z=n(59740),O=["html"];function W(e){var t,n=(0,s.getContainingView)(e),r=e.rendererType;return{rendererType:r,rpcManager:(0,s.getSession)(n).rpcManager,renderProps:e.renderProps(),renderArgs:{assemblyName:null===(t=n.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:D()(e.adapterConfig),rendererType:r.name,regions:D()(n.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,V.getRpcSessionId)(e),timeout:1e6}}}function H(e,t,n){return G.apply(this,arguments)}function G(){return(G=(0,M.Z)((0,T.Z)().mark((function e(t,n,r){var a,i,o,s,c,u,l,f;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:if(a=t.rendererType,i=t.rpcManager,o=t.cannotBeRenderedReason,s=t.renderArgs,c=t.renderProps,!o){e.next=5;break}return e.abrupt("return",{message:o});case 5:if(t.renderProps.radius&&t.renderArgs.regions&&t.renderArgs.regions.length){e.next=7;break}return e.abrupt("return",{message:"Skipping render"});case 7:if(r.isCompatibleWithRenderer(a)){e.next=9;break}throw new Error("renderer ".concat(a.name," is not compatible with this display type"));case 9:return e.next=11,a.renderInClient(i,(0,d.Z)((0,d.Z)((0,d.Z)({},s),c),{},{signal:n}));case 11:return u=e.sent,l=u.html,f=(0,z.Z)(u,O),e.abrupt("return",{html:l,data:f,reactElement:f.reactElement,renderingComponent:a.ReactComponent});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=p.types.compose("BaseChordDisplay",v.BaseDisplay,p.types.model({bezierRadiusRatio:.1,assemblyName:p.types.maybe(p.types.string)})).volatile((function(){return{filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}})).actions((function(e){var t=(0,s.getEnv)(e).pluginManager,n=e;return{onChordClick:function(r){(0,m.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}})).views((function(e){return{get blockDefinitions(){var t=(0,s.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;var n=D()(t);return n.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(t){var n,r=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),n},renderProps:function(){var t=(0,s.getContainingView)(e);return(0,d.Z)((0,d.Z)({},(0,V.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick})},get rendererType(){var t=e,n=(0,s.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},isCompatibleWithRenderer:function(e){return!!(e instanceof E.Z)},get selectedFeatureId(){if((0,p.isAlive)(e)){var t=(0,s.getSession)(e);if(t){var n=t.selection;return(0,s.isFeature)(n)?n.id():void 0}}}}})).actions((function(e){return{renderStarted:function(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess:function(t){var n=t.message,r=t.data,a=t.reactElement,i=t.html,o=t.renderingComponent;n?(e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=a,e.data=r,e.html=i,e.error=void 0,e.renderingComponent=o)},renderError:function(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap:function(t){e.refNameMap=t}}})).actions((function(e){return{afterAttach:function(){(0,s.makeAbortableReaction)(e,W,H,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,s.makeAbortableReaction)(e,(function(){return{assemblyNames:(0,V.getTrackAssemblyNames)(e.parentTrack),adapter:(0,m.getConf)((0,p.getParent)(e,2),"adapter"),assemblyManager:(0,s.getSession)(e).assemblyManager}}),function(){var t=(0,M.Z)((0,T.Z)().mark((function t(n,r){var a,i,o;return(0,T.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.assemblyNames,i=n.adapter,o=n.assemblyManager,t.abrupt("return",o.getRefNameMapForAdapter(i,a[0],{signal:r,sessionId:(0,V.getRpcSessionId)(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(function(){}),(function(t){e.setRefNameMap(t)}),(function(t){console.error(t),e.setError(t)}))}}}));var U=(0,m.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),_=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="CircularViewPlugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new l.Z({ReactComponent:(0,u.lazy)((function(){return n.e(2515).then(n.bind(n,92515))})),stateModel:S(e),name:"CircularView",displayName:"Circular view"})}))}(e),function(e){e.addToExtensionPoint("LaunchView-CircularView",function(){var e=(0,M.Z)((0,T.Z)().mark((function e(t){var n,r,a,i,o,s,c;return(0,T.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,t.loc,a=t.tracks,i=void 0===a?[]:a,o=n.assemblyManager,s=n.addView("CircularView",{}),e.next=5,(0,g.when)((function(){return s.initialized}));case 5:if(r){e.next=7;break}throw new Error("No assembly provided when launching circular genome view");case 7:return e.next=9,o.waitForAssembly(r);case 9:if(c=e.sent){e.next=12;break}throw new Error('Assembly "'.concat(r,'" not found when launching circular genome view'));case 12:s.setDisplayedRegions(c.regions||[]),i.forEach((function(e){return s.showTrack(e)}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}(e)}},{key:"configure",value:function(e){(0,s.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:P.Z,onClick:function(e){e.addView("CircularView",{})}})}}]),c}(c.Z)},97620:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(5868),u=n(99836);var l=(0,u.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0});var d=(0,u.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});var f=(0,u.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});var p=(0,u.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0});var h=(0,u.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0});var g=(0,u.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0}),m=n(16151),v=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="ComparativeAdaptersPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.Z({name:"PAFAdapter",displayName:"PAF adapter",configSchema:l,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(644)]).then(n.bind(n,19068)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:h,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(4656)]).then(n.bind(n,44656)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:g,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2386)]).then(n.bind(n,32386)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:d,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(3499)]).then(n.bind(n,23499)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:f,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(9132)]).then(n.bind(n,29132)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:p,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(7212)]).then(n.bind(n,7212)).then((function(e){return e.default}))}})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="PAFAdapter",i=(0,m.getFileName)(t);return/\.paf/i.test(i)||r===a?{type:a,pafLocation:t}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"PAFAdapter"===t?"SyntenyTrack":e(t)}}))}}]),s}(s.Z)},49968:function(e,t,n){"use strict";var r=n(96234),a=n(96902),i=n(36276),o=n(66519),s=n(91188),c=n(4782),u=n(29938),l='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',d=(0,s.ZL)()((function(e){return{error:{color:"red",fontSize:"0.8em"},callbackEditor:{fontFamily:l,fontSize:"12px",background:e.palette.background.default,width:800,marginTop:"16px",border:"1px solid rgba(0,0,0,0.42)"},callbackContainer:{width:"100%",overflowX:"auto"},textAreaFont:{fontFamily:l}}}));t.Z=(0,c.observer)((function(e){var t=e.slot,n=d().classes,s=(0,a.useState)(JSON.stringify(t.value,null,2)),c=(0,r.Z)(s,2),l=c[0],f=c[1],p=(0,a.useState)(),h=(0,r.Z)(p,2),g=h[0],m=h[1];return(0,a.useEffect)((function(){try{m(void 0),t.set(JSON.parse(l))}catch(e){console.error({e:e}),m(e)}}),[l,t]),(0,u.jsxs)(u.Fragment,{children:[g?(0,u.jsx)("p",{className:n.error,children:"".concat(g)}):null,(0,u.jsxs)("div",{className:n.callbackContainer,children:[(0,u.jsx)(i.Z,{shrink:!0,htmlFor:"json-editor",children:t.name}),(0,u.jsx)(o.Z,{id:"json-editor",className:n.callbackEditor,value:l,helperText:t.description,multiline:!0,onChange:function(e){return f(e.target.value)},style:{background:g?"#fdd":void 0},InputProps:{classes:{input:n.textAreaFont}}})]})]})}))},30474:function(e,t,n){"use strict";n.d(t,{wP:function(){return C},ZP:function(){return Z}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(96902),c=n(26347),u=n(87977),l=n(4782),d=n(63680),f=n(99836),p=n(29938),h=n(42328),g=function(e){return d.types.model("ConfigurationEditorWidget",{id:h.ElementId,type:d.types.literal("ConfigurationEditorWidget"),target:d.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{setTarget:function(t){e.target=t}}}))},m=(0,f.ConfigurationSchema)("ConfigurationEditorWidget",{}),v=(0,l.observer)((function(e){var t=e.model;if(null!==t&&void 0!==t&&t.target){if(t.target.type)return(0,p.jsx)(p.Fragment,{children:"".concat(t.target.type," settings")});if((0,d.isStateTreeNode)(t.target)){var n=(0,d.getType)(t.target);if(null!==n&&void 0!==n&&n.name)return(0,p.jsx)(p.Fragment,{children:"".concat(n.name.replace("ConfigurationSchema","")," settings")})}}return(0,p.jsx)(p.Fragment,{children:"Settings"})})),y=n(91271);var b=(0,f.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});var x=(0,f.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});var w=(0,f.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"});var k=(0,f.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0}),C=(n(49968),(0,s.lazy)((function(){return Promise.all([n.e(952),n.e(8581),n.e(9558),n.e(6488)]).then(n.bind(n,46488))}))),Z=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="ConfigurationPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new y.AdapterType({name:"FromConfigAdapter",configSchema:b,getAdapterClass:function(){return n.e(6261).then(n.bind(n,56261)).then((function(e){return e.default}))},adapterMetadata:{hiddenFromGUI:!0}})}))}(e),function(e){e.addAdapterType((function(){return new y.AdapterType({name:"FromConfigRegionsAdapter",configSchema:x,getAdapterClass:function(){return n.e(7149).then(n.bind(n,47149)).then((function(e){return e.default}))},adapterMetadata:{hiddenFromGUI:!0}})}))}(e),function(e){e.addAdapterType((function(){return new y.AdapterType({name:"FromConfigSequenceAdapter",configSchema:w,getAdapterClass:function(){return n.e(7652).then(n.bind(n,47652)).then((function(e){return e.default}))},adapterMetadata:{hiddenFromGUI:!0}})}))}(e),function(e){e.addAdapterType((function(){return new y.AdapterType({name:"RefNameAliasAdapter",configSchema:k,getAdapterClass:function(){return n.e(3069).then(n.bind(n,33069)).then((function(e){return e.default}))},adapterMetadata:{hiddenFromGUI:!0}})}))}(e),e.addWidgetType((function(){return new c.Z({name:"ConfigurationEditorWidget",HeadingComponent:v,configSchema:m,stateModel:g(e),ReactComponent:C})}))}}]),s}(u.Z)},69218:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(99836),a=n(91271),i=n(96902),o=n(63680),s=n(42328),c=o.types.model("AddConnectionModel",{id:s.ElementId,type:o.types.literal("AddConnectionWidget")}),u=(0,r.ConfigurationSchema)("AddConnectionWidget",{}),l=function(e){e.addWidgetType((function(){return new a.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:u,stateModel:c,ReactComponent:(0,i.lazy)((function(){return Promise.all([n.e(8102),n.e(9589)]).then(n.bind(n,69589))}))})}))}},22820:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(99836),a=n(91271),i=n(96902),o=n(63680),s=n(42328),c=n(16151);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function l(e){return o.types.model("AddTrackModel",{id:s.ElementId,type:o.types.literal("AddTrackWidget"),view:o.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0}})).actions((function(e){return{setAdapterHint:function(t){e.adapterHint=t},setTrackSource:function(t){e.trackSource=t},setTextIndexingConf:function(t){e.textIndexingConf=t},setTextIndexTrack:function(t){e.textIndexTrack=t},setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},setAssembly:function(t){e.altAssemblyName=t},setTrackName:function(t){e.altTrackName=t},setTrackType:function(t){e.altTrackType=t},clearData:function(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}}})).views((function(e){return{get trackAdapter(){var t=e.trackData,n=e.indexTrackData,r=e.adapterHint;return t?(0,c.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,c.getFileName)(e.trackData):"")},get isFtp(){var t,n,r=e.trackData,a=e.indexTrackData;return!!(null!==a&&void 0!==a&&null!==(t=a.uri)&&void 0!==t&&t.startsWith("ftp://")||null!==r&&void 0!==r&&null!==(n=r.uri)&&void 0!==n&&n.startsWith("ftp://"))},get isRelativeTrackUrl(){var t,n=null===(t=e.trackData)||void 0===t?void 0:t.uri;return!!n&&!u(n)},get isRelativeIndexUrl(){var t,n=null===(t=e.indexTrackData)||void 0===t?void 0:t.uri;return!!n&&!u(n)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var t,n;return null===(t=e.trackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get indexHttp(){var t,n;return null===(t=e.indexTrackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){var e;return(null===(e=this.trackAdapter)||void 0===e?void 0:e.type)===c.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||(this.trackAdapter?(0,c.guessTrackType)(this.trackAdapter.type,e):"")}}})).views((function(e){return{get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}}))}var d=(0,r.ConfigurationSchema)("AddTrackWidget",{}),f=function(e){e.addWidgetType((function(){return new a.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:d,stateModel:l(e),ReactComponent:(0,i.lazy)((function(){return Promise.all([n.e(8581),n.e(8102),n.e(3437)]).then(n.bind(n,13437))}))})}))}},19497:function(e,t,n){"use strict";n.d(t,{ZP:function(){return s}});var r=n(71186),a=(0,n(99836).ConfigurationSchema)("HierarchicalTrackSelectorWidget",{}),i=n(91271),o=n(96902),s=function(e){e.addWidgetType((function(){return new i.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:a,stateModel:(0,r.ZP)(e),ReactComponent:(0,o.lazy)((function(){return Promise.all([n.e(9883),n.e(9869),n.e(7538)]).then(n.bind(n,37538))}))})}))}},71186:function(e,t,n){"use strict";n.d(t,{ZP:function(){return h},wB:function(){return d}});var r=n(41361),a=n(68079),i=n(63680),o=n(99836),s=n(97531),c=n(16151),u=n(42328);function l(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find((function(t){return e.includes(t)}))}function d(e,t,n){var r=(0,o.readConfObject)(t,"category"),a=e.toLowerCase();return(0,c.getTrackName)(t,n).toLowerCase().includes(a)||!(null===r||void 0===r||!r.filter((function(e){return e.toLowerCase().includes(a)})).length)}function f(e,t,n){var r=(0,s.getSession)(t).assemblyManager,a=(0,s.getEnv)(t).pluginManager,i=r.get(n);if(!i)return[];var c=i.allAliases;return e.filter((function(e){return l(c,(0,o.readConfObject)(e,"assemblyNames"))})).filter((function(e){return l(a.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),e.displays.map((function(e){return e.type})))}))}function p(e,t,n,r){var i={children:[]},u=e.filterText,l=e.view,f=(0,s.getSession)(e);return t.filter((function(e){return d(u,e,f)})).forEach((function(e){var t=(0,a.Z)((0,o.readConfObject)(e,"category")||[]);e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");for(var s=i,u=function(){var e=t[d],a=s.children.find((function(t){return t.name===e})),i=r+"-"+t.slice(0,d+1).join(",");if(a)s=a;else{var o={children:[],name:e,id:i,isOpenByDefault:!n.get(i)};s.children.push(o),s=o}},d=0;d<t.length;d++)u();var p=l.tracks;s.children.splice(s.children.findIndex((function(e){return e.children.length})),0,{id:e.trackId,name:(0,c.getTrackName)(e,f),conf:e,checked:!!p.find((function(t){return t.configuration===e})),children:[]})})),i.children}function h(e){return i.types.model("HierarchicalTrackSelectorWidget",{id:u.ElementId,type:i.types.literal("HierarchicalTrackSelectorWidget"),collapsed:i.types.map(i.types.boolean),view:i.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{selection:[],filterText:""}})).actions((function(e){return{setSelection:function(t){e.selection=t},addToSelection:function(t){e.selection=(0,s.dedupe)([].concat((0,a.Z)(e.selection),(0,a.Z)(t)),(function(e){return e.trackId}))},removeFromSelection:function(t){e.selection=e.selection.filter((function(e){return!t.includes(e)}))},clearSelection:function(){e.selection=[]},setView:function(t){e.view=t},toggleCategory:function(t){e.collapsed.set(t,!e.collapsed.get(t))},clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}})).views((function(t){return{getRefSeqTrackConf:function(n){var a=(0,s.getSession)(t).assemblyManager.get(n),i=null===a||void 0===a?void 0:a.configuration.sequence,o=e.getViewType(t.view.type);if(i){var c,u=(0,r.Z)(i.displays);try{var l=function(){var e=c.value;if(o.displayTypes.find((function(t){return t.name===e.type})))return{v:i}};for(u.s();!(c=u.n()).done;){var d=l();if("object"===typeof d)return d.v}}catch(f){u.e(f)}finally{u.f()}}}}})).views((function(e){return{trackConfigurations:function(t){if(!e.view)return[];var n=(0,s.getSession)(e),r=n.tracks;if(!n.assemblyManager.get(t))return[];var i=e.getRefSeqTrackConf(t);return(i?[i]:[]).concat((0,a.Z)(f(r,e,t)))},get assemblyNames(){var t;return(null===(t=e.view)||void 0===t?void 0:t.assemblyNames)||[]},connectionTrackConfigurations:function(t,n){return e.view?f(n.tracks,e,t):[]}}})).views((function(e){return{hierarchy:function(t){var n=this,r=p(e,e.trackConfigurations(t),e.collapsed),c=(0,s.getSession)(e).connectionInstances,u=(0,s.getSession)(e).assemblyManager.get(t)&&(null===c||void 0===c?void 0:c.map((function(e){return{id:(0,i.getSnapshot)(e).configuration,name:(0,o.getConf)(e,"name"),children:n.connectionHierarchy(t,e),state:{expanded:!0}}})).filter((function(e){return e.children.length})))||[];return{name:"Root",id:"Root",children:[{name:"Tracks",id:"Tracks",children:r}].concat((0,a.Z)(u))}},connectionHierarchy:function(t,n){return p(e,e.connectionTrackConfigurations(t,n),e.collapsed,n.name)}}}))}},32979:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(99836),a=n(91271),i=n(96902),o=n(63680),s=n(42328);function c(e){return o.types.model("PluginStoreModel",{id:s.ElementId,type:o.types.literal("PluginStoreWidget"),filterText:"",view:o.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}}))}var u=(0,r.ConfigurationSchema)("PluginStoreWidget",{}),l=function(e){e.addWidgetType((function(){return new a.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:u,stateModel:c(e),ReactComponent:(0,i.lazy)((function(){return Promise.all([n.e(952),n.e(8581),n.e(8632)]).then(n.bind(n,28632))}))})}))}},82412:function(e,t,n){"use strict";n.d(t,{Z:function(){return P}});var r=n(91271),a=n(32723),i=n(96234),o=n(41361),s=n(34795),c=n(33991),u=n(99836),l=n(97531),d=n(63680);var f=(0,u.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:c.baseConnectionConfig}),p=n(33028),h=n(32145),g=n(16151);"ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9".split(/\r?\n/);function m(e){return v.apply(this,arguments)}function v(){return(v=(0,s.Z)((0,a.Z)().mark((function e(t){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.openLocation)(t).readFile("utf8");case 3:return r=e.sent,e.next=6,n.e(705).then(n.bind(n,10705));case 6:return i=e.sent,o=i.HubFile,e.abrupt("return",new o(r));case 11:throw e.prev=11,e.t0=e.catch(0),new Error("Not a valid hub.txt file, got error: '".concat(e.t0,"'"));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=(0,s.Z)((0,a.Z)().mark((function e(t){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(705).then(n.bind(n,10705));case 5:return i=e.sent,o=i.GenomesFile,e.abrupt("return",new o(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return w.apply(this,arguments)}function w(){return(w=(0,s.Z)((0,a.Z)().mark((function e(t){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(705).then(n.bind(n,10705));case 5:return i=e.sent,o=i.TrackDbFile,e.abrupt("return",new o(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return{uri:new URL(e,t.uri).href,locationType:"UriLocation"}}function C(e,t,n){return k(e||t,n)}function Z(e,t){return e?{uri:e,locationType:"LocalPath"}:{uri:t,locationType:"UriLocation"}}function S(e,t,n,r){var a=[];return e.forEach((function(o,s){var c=Array.from(o.keys()),u=["superTrack","compositeTrack","container","view"];if(!c.some((function(e){return u.includes(e)}))){var d=[],f=s;do{var h;if(f=(null===(h=e.get(f))||void 0===h?void 0:h.get("parent"))||""){var g=f.split(" ");f=(0,i.Z)(g,1)[0],d.push(e.get(f))}}while(f);d.reverse();var m=T(o,d.map((function(e){return null===e||void 0===e?void 0:e.get("shortLabel")})).filter((function(e){return!!e})),t,e,r);a.push((0,p.Z)((0,p.Z)({},m),{},{trackId:"ucsc-trackhub-".concat((0,l.objectHash)(m)),assemblyNames:[n]}))}})),a}function T(e,t,n,r,a){var i,o,s=e.get("type"),c=e.get("shortLabel")||"",u=e.get("bigDataUrl")||"",d=e.get("bigDataIndex")||"",f=(0,l.isUriLocation)(n);s||(s=null===(o=r.get(e.get("parent")||""))||void 0===o?void 0:o.get("type"));var p=(null===(i=s)||void 0===i?void 0:i.split(" ")[0])||"";"bam"===p&&u.toLowerCase().endsWith("cram")&&(p="cram");var h=f?k(u,n):Z(u);switch(p){case"bam":return{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:h,index:{location:f?C(d,u+".bai",n):Z(d,u+".bai")}}};case"bigBarChart":case"bigChain":case"bigInteract":case"bigMaf":case"bigPsl":return{type:"FeatureTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:h},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":case"bigGenePred":case"bigNarrowPeak":return{type:"FeatureTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:h}};case"bigWig":return{type:"QuantitativeTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:h}};case"cram":return{type:"AlignmentsTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:h,craiLocation:f?C(d,u+".crai",n):Z(d,u+".crai"),sequenceAdapter:a}};case"peptideMapping":return(0,g.generateUnsupportedTrackConf)(c,p,t);case"vcfTabix":return{type:"VariantTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:h,index:{location:f?C(d,u+".tbi",n):Z(d,u+".tbi")}}};case"hic":return{type:"HicTrack",name:c,description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:h}};default:return(0,g.generateUnknownTrackConf)(c,p,t)}}function M(e){return d.types.compose("UCSCTrackHubConnection",(0,c.BaseConnectionModelFactory)(e),d.types.model({configuration:(0,u.ConfigurationReference)(f),type:d.types.literal("UCSCTrackHubConnection")})).actions((function(e){return{connect:function(){return(0,s.Z)((0,a.Z)().mark((function t(){var n,r,s,c,d,f,p,h,g,v,b,w,k,C,Z,T,M,P,R,A;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,l.getSession)(e),t.prev=1,r=(0,u.getConf)(e,"name"),s=(0,u.getConf)(e,"hubTxtLocation"),t.next=6,m(s);case 6:if(c=t.sent,d=c.get("genomesFile")){t.next=10;break}throw new Error("genomesFile not found on hub");case 10:return f=new URL(s.uri,s.baseUri),p=f?{uri:new URL(d,f).href,locationType:"UriLocation"}:{localPath:d,locationType:"LocalPathLocation"},t.next=14,y(p);case 14:h=t.sent,g=[],v=(0,o.Z)(h),t.prev=17,w=(0,a.Z)().mark((function t(){var o,s,c,l,p,h,m,v,y;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(0,i.Z)(b.value,2),s=o[0],c=o[1],!((l=(0,u.getConf)(e,"assemblyNames")).length>0)||l.includes(s)){t.next=4;break}return t.abrupt("return","continue");case 4:if(p=n.assemblies.find((function(e){return(0,u.readConfObject)(e,"name")===s}))){t.next=7;break}throw new Error('Cannot find assembly for "'.concat(s,'" from the genomes file for connection "').concat(r,'"'));case 7:if(h=c.get("trackDb")){t.next=10;break}throw new Error("genomesFile not found on hub");case 10:return m=new URL(d,f),v=f?{uri:new URL(h,m).href,locationType:"UriLocation"}:{localPath:h,locationType:"LocalPathLocation"},t.next=14,x(v);case 14:y=t.sent,g.push([v,y,s,p]);case 16:case"end":return t.stop()}}),t)})),v.s();case 20:if((b=v.n()).done){t.next=27;break}return t.delegateYield(w(),"t0",22);case 22:if("continue"!==t.t0){t.next=25;break}return t.abrupt("continue",25);case 25:t.next=20;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(17),v.e(t.t1);case 32:return t.prev=32,v.f(),t.finish(32);case 35:for(k=0,C=g;k<C.length;k++)Z=(0,i.Z)(C[k],4),T=Z[0],M=Z[1],P=Z[2],R=Z[3],A=(0,u.readConfObject)(R,["sequence","adapter"]),e.addTrackConfs(S(M,T,P,A));t.next=43;break;case 38:t.prev=38,t.t2=t.catch(1),console.error(t.t2),n.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.configuration.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(t.t2,'"'),"error"),n.breakConnection(e.configuration);case 43:case"end":return t.stop()}}),t,null,[[1,38],[17,29,32,35]])})))()}}}))}var P=function(e){e.addConnectionType((function(){return new r.ConnectionType({name:"UCSCTrackHubConnection",configSchema:f,stateModel:M(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})}))}},44529:function(e,t,n){"use strict";function r(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.pxToBp(e),a=r.assemblyName,i=r.refName,o=r.start,s=r.offset,c=r.oob,u=Math.floor(o+s);return c?"out of bounds":"".concat(n?"{"+a+"}":"").concat(i,":").concat(u.toLocaleString("en-US"))}function a(e,t,n){var r=new Set,a=e.slice(0).sort((function(e,t){var n=e.end-e.start;return t.end-t.start-n})),i=new Array(Math.round(t));return a.forEach((function(e){var a=e.key,o=e.offsetPx,s=Math.round(t-o+n),c=[Math.max(s-12,0),s];0===s||i.slice.apply(i,c).some(Boolean)?r.add(a):i.fill.apply(i,[!0].concat(c))})),r}function i(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[],i=function(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),i=Math.pow(10,a);i<r&&!((i*=2)>=r);)i*=2.5;var o=(i=Math.max(i,5))/e,s=0;return!(i%10)&&o/10>=n?s=i/10:!(i%5)&&o/5>=n?s=i/5:!(i%2)&&o/2>=n&&(s=i/2),{majorPitch:i,minorPitch:s}}(t,60,15),o=i.minorPitch||i.majorPitch,s=0;s<e.length;s++)for(var c=e[s],u=c.start,l=c.end,d=c.refName,f=0,p=u,h=l,g=Math.ceil(p/o)*o;g<h;g+=o)r&&g%i.majorPitch?(a.push({type:"minor",base:g-1,index:f,refName:d}),f+=1):n&&Math.abs(g-c.start)>i.minorPitch&&(a.push({type:"major",base:g-1,index:f,refName:d}),f+=1);return a}n.d(t,{Cz:function(){return i},F$:function(){return a},c4:function(){return r}})},63702:function(e,t,n){"use strict";n.d(t,{Z:function(){return ke}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(97531),u=n(57968),l=n(96902),d=n(65317),f=n(68079),p=n(59740),h=n(96234),g=n(33028),m=n(63680),v=n(44529),y=n(75717),b=n(16151),x=n(46186),w=n(66705),k=n(99836),C=n(42328),Z=n(23642),S=n(93472),T=n(30368),M=n(15276),P=T.Z.extend((function(e){var t=y.observable.box(1);return{views:{get dynamicBlocks(){return(0,M.Z)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/e.width}},actions:{setScaleFactor:function(e){t.set(e)},center:function(){var t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))}}}})),R=P.extend((function(e){return{views:{get width(){return(0,m.getParent)(e).viewWidth}}}})),A=P.extend((function(e){return{views:{get width(){return(0,m.getParent)(e).viewHeight}}}})),L=["id"],N=["id"];var j=n(95984),F=n(33991),I=n(91188),B=n(35388),D=n(4782),E=n(29938),V=(0,I.ZL)()((function(e){var t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"},blockError:{backgroundColor:t,padding:"10px",color:"red"}}}));function z(){var e=(0,l.useState)(!1),t=(0,h.Z)(e,2),n=t[0],r=t[1],a=V().classes;return(0,l.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}}),[]),n?(0,E.jsx)("div",{className:a.loading,children:(0,E.jsx)(x.LoadingEllipses,{})}):null}function O(e){var t=e.messageText,n=V().classes;return(0,E.jsx)("div",{className:n.blockMessage,children:(0,E.jsx)(B.Z,{children:"".concat(t)})})}function W(e){var t=e.error,n=V().classes;return(0,E.jsx)("div",{className:n.blockError,children:(0,E.jsx)(B.Z,{children:"".concat(t)})})}var H=(0,D.observer)((function(e){var t=e.model,n=e.style;return t.error?(0,E.jsx)(W,{error:t.error,"data-testid":"reload_button"}):t.message?(0,E.jsx)(O,{messageText:t.message}):t.filled?(0,E.jsx)("div",{style:n,children:t.reactElement}):(0,E.jsx)(z,{})})),G=n(32723),q=n(34795),U=n(73636),_=n.n(U),J=["reactElement"];function X(){return(X=(0,q.Z)((0,G.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,e.next=5,n.renderInClient(r,a);case 5:return i=e.sent,o=i.reactElement,s=(0,p.Z)(i,J),e.abrupt("return",{reactElement:o,data:s,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){return m.types.compose("DotplotDisplay",F.BaseDisplay,m.types.model({type:m.types.literal("DotplotDisplay"),configuration:(0,k.ConfigurationReference)(e)}).volatile((function(){return{warnings:[],renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:H}}))).views((function(e){return{get rendererTypeName(){return(0,k.getConf)(e,["renderer","type"])},renderProps:function(){return(0,g.Z)((0,g.Z)({},(0,b.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}}})).actions((function(e){var t;return{afterAttach:function(){(0,c.makeAbortableReaction)(e,(function(){return function(e){var t=(0,c.getSession)(e).rpcManager,n=e.rendererType,r=e.adapterConfig,a=(0,c.getContainingView)(e);if((0,k.readConfObject)(e.configuration),(0,m.getSnapshot)(a),a.initialized){var i=a.viewWidth,o=a.viewHeight,s=a.borderSize,u=a.borderX,l=a.borderY;return{rendererType:n,rpcManager:t,renderProps:(0,g.Z)((0,g.Z)({},e.renderProps()),{},{view:_()((0,m.getSnapshot)(a)),width:i,height:o,borderSize:s,borderX:u,borderY:l,adapterConfig:r,rendererType:n.name,sessionId:(0,b.getRpcSessionId)(e),timeout:1e6})}}}(e)}),(function(e){return e?function(e){return X.apply(this,arguments)}(e):void 0}),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){if(void 0!==n){var r=n.data,a=n.reactElement,i=n.renderingComponent;e.warnings=r.warnings,e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}var Q=(0,D.observer)((function(e){var t=e.model,n=e.children,r=t.data||{},a=r.offsetX,i=void 0===a?0:a,o=r.offsetY,s=void 0===o?0:o,u=(0,c.getContainingView)(t),l=u.vview.offsetPx-s,d=-(u.hview.offsetPx-i);return(0,E.jsxs)("div",{style:{position:"relative"},children:[(0,E.jsx)(t.ReactComponent2,(0,g.Z)((0,g.Z)({},e),{},{style:{position:"absolute",top:l,left:d}})),n]})})),K=function(e){e.addDisplayType((function(){var t=function(e){return(0,k.ConfigurationSchema)("DotplotDisplay",{renderer:m.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new j.Z({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:t,stateModel:Y(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:Q})}))};var $=(0,D.observer)((function(e){return(0,E.jsx)(x.PrerenderedCanvas,(0,g.Z)({},e))})),ee=n(93069),te=n(95058),ne=n(98103),re=n(55373),ae=n(24839),ie=ae.tr.parseCigar,oe="fell outside of range due to CIGAR string",se="(less than min coordinate of feature)",ce="(greater than max coordinate of feature)";function ue(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.beginPath(),e.arc(t,n,r/2,0,2*Math.PI),e.fill()}var le=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t){var n,r,a,i,o,s,u,l,d;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(){return(d=(0,q.Z)((0,G.Z)().mark((function e(t){var n;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}throw new Error("No assembly manager provided");case 2:return e.next=4,(0,c.renameRegionsIfNeeded)(i,{sessionId:s,adapterConfig:u,regions:t});case 4:return n=e.sent,e.abrupt("return",n.regions);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},l=function(e){return d.apply(this,arguments)},a=this.pluginManager,i=null===(n=a.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager,o=t.view,s=t.sessionId,u=t.adapterConfig,e.next=7,l(o.hview.displayedRegions);case 7:return o.hview.displayedRegions=e.sent,e.next=10,l(o.vview.displayedRegions);case 10:return o.vview.displayedRegions=e.sent,e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawDotplot",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,l,d,f,p,v,y,b,w,C,Z,S,T,M,P,R,A,L,N,j,F,I,B;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j=function(e,t,n,r){if(e<t-1){var a=r.get("mate"),i=a.refName,o=a.start,s=a.end;return R.push({message:"feature at (Y ".concat(i,":").concat(o,"-").concat(s,") ").concat(oe," ").concat(se),effect:"clipped the feature"}),t}if(e>n+1){var c=r.get("mate"),u=c.refName,l=c.start,d=c.end;return R.push({message:"feature at (Y ".concat(u,":").concat(l,"-").concat(d,") ").concat(oe," ").concat(ce),effect:"clipped the feature"}),n}return e},N=function(e,t,n,r){var a=r.get("strand")||1;if(-1===a){var i=[t,n];n=i[0],t=i[1]}if(e<t-1){var o=r.get("start"),s=r.get("end"),c=r.get("refName");if(-1===a){var u=[o,s];s=u[0],o=u[1]}return R.push({message:"feature at (X ".concat(c,":").concat(o,"-").concat(s,") ").concat(oe," ").concat(se),effect:"clipped the feature"}),t}if(e>n+1){var l=r.get("strand")||1,d=1===l?r.get("start"):r.get("end"),f=1===l?r.get("end"):r.get("start"),p=r.get("refName");return R.push({message:"feature at (X ".concat(p,":").concat(d,"-").concat(f,") ").concat(oe," ").concat(ce),effect:"clipped the feature"}),n}return e},o=n.config,s=n.views,c=n.height,u=n.drawCigar,l=n.theme,d=(0,k.readConfObject)(o,"color"),f=(0,k.readConfObject)(o,"posColor"),p=(0,k.readConfObject)(o,"negColor"),v=(0,k.readConfObject)(o,"colorBy"),y=(0,k.readConfObject)(o,"lineWidth"),b=(0,k.readConfObject)(o,"thresholds"),w=(0,k.readConfObject)(o,"thresholdsPalette"),C=o.color.isCallback,Z=(0,h.Z)(s,2),S=Z[0],T=Z[1],M=null===(r=S.dynamicBlocks.contentBlocks[0])||void 0===r?void 0:r.offsetPx,P=null===(a=T.dynamicBlocks.contentBlocks[0])||void 0===a?void 0:a.offsetPx,R=[],t.lineWidth=y,A=S.bpPerPx,L=T.bpPerPx,F=(0,g.Z)((0,g.Z)({},(0,m.getSnapshot)(S)),{},{staticBlocks:S.staticBlocks,width:S.width}),I=(0,g.Z)((0,g.Z)({},(0,m.getSnapshot)(T)),{},{staticBlocks:T.staticBlocks,width:T.width}),B=(0,x.createJBrowseTheme)(l),null===(i=S.features)||void 0===i||i.forEach((function(e){var n,r=e.get("strand")||1,a=1===r?e.get("start"):e.get("end"),i=1===r?e.get("end"):e.get("start"),s=e.get("refName"),l=e.get("mate"),h=l.refName;if("identity"===v){for(var g=e.get("identity"),m=0;m<b.length;m++)if(g>+b[m]){n=w[m];break}}else"meanQueryIdentity"===v?n="hsl(".concat(200*e.get("meanScore"),",100%,40%)"):"mappingQuality"===v?n="hsl(".concat(e.get("mappingQual"),",100%,40%)"):"strand"===v?n=-1===r?p:f:"default"===v&&(n=C?(0,k.readConfObject)(o,"color",{feature:e}):"#f0f"===d?B.palette.text.primary:d);t.fillStyle=n,t.strokeStyle=n;var x=(0,ne.R)({self:F,refName:s,coord:a}),Z=(0,ne.R)({self:F,refName:s,coord:i}),S=(0,ne.R)({self:I,refName:h,coord:l.start}),T=(0,ne.R)({self:I,refName:h,coord:l.end});if(void 0!==x&&void 0!==Z&&void 0!==S&&void 0!==T){var D=x.offsetPx-M,E=Z.offsetPx-M,V=S.offsetPx-P,z=T.offsetPx-P;if(Math.abs(D-E)<=4&&Math.abs(V-z)<=4)ue(t,D,c-V,y);else{var O=D,W=V,H=e.get("CIGAR");if(u&&H){var G=ie(H);t.beginPath(),t.moveTo(O,c-W);for(var q=0;q<G.length;q+=2){var U=+G[q],_=G[q+1];"M"===_||"="===_||"X"===_?(O+=U/A*r,W+=U/L):"D"===_||"N"===_?O+=U/A*r:"I"===_&&(W+=U/L),O=N(O,D,E,e),W=j(W,V,z,e),t.lineTo(O,c-W)}t.stroke()}else t.beginPath(),t.moveTo(D,c-V),t.lineTo(E,c-z),t.stroke()}}else R.length<=5&&(void 0===x||void 0===Z?R.push({message:"feature at (X ".concat(s,":").concat(a,"-").concat(i,") not plotted, fell outside of range"),effect:"feature not rendered"}):R.push({message:"feature at (Y ".concat(h,":").concat(l.start,"-").concat(l.end,") not plotted, fell outside of range"),effect:"feature not rendered"}))})),e.abrupt("return",{warnings:R});case 23:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t){var r,a,i,o,s,u,l,d,f,p,h,m=this;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,a=t.height,i=t.view,o=i.hview,s=i.vview,u=[r,a],l=[o,s].map((function(e,t){var n=P.create(e);return n.setVolatileWidth(u[t]),n})),d=l[0],e.next=6,this.getFeatures((0,g.Z)((0,g.Z)({},t),{},{regions:d.dynamicBlocks.contentBlocks}));case 6:return f=e.sent,d.setFeatures(f),e.next=10,(0,c.renderToAbstractCanvas)(r,a,t,(function(e){return m.drawDotplot(e,(0,g.Z)((0,g.Z)({},t),{},{views:l}))}));case 10:return p=e.sent,e.next=13,(0,ee.Z)((0,te.Z)(n.prototype),"render",this).call(this,(0,g.Z)((0,g.Z)((0,g.Z)({},t),p),{},{height:a,width:r}));case 13:return h=e.sent,e.abrupt("return",(0,g.Z)((0,g.Z)((0,g.Z)({},h),p),{},{height:a,width:r,offsetX:l[0].dynamicBlocks.blocks[0].offsetPx,offsetY:l[1].dynamicBlocks.blocks[0].offsetPx}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(re.Z);var de=(0,k.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:m.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});function fe(e,t,n){try{e.showTrack(t)}catch(r){if(!"".concat(r).match("Could not resolve identifier"))throw r;n.push(t)}}var pe=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ComparativeRender",e}return(0,a.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t,n){return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.renameRegionsIfNeeded(t));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRenderer",value:function(e){return this.pluginManager.getRendererType(e)}},{key:"serializeArguments",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t,r){var a,i,o,s;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rendererType,i=this.getRenderer(a),e.next=4,(0,ee.Z)((0,te.Z)(n.prototype),"serializeArguments",this).call(this,t,r);case 4:return o=e.sent,e.next=7,this.renameRegionsIfNeeded(o,i);case 7:return s=e.sent,e.abrupt("return","MainThreadRpcDriver"===r?s:i.serializeArgsInClient(s));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,o=a.rendererType,s=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:return(0,c.checkAbortSignal)(s),u=this.getRenderer(o),e.abrupt("return","MainThreadRpcDriver"===n?u.render(r):u.renderInWorker(r));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t,r,a){var i,o;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,ee.Z)((0,te.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(i=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",i);case 5:return o=this.getRenderer(r.rendererType),e.abrupt("return",o.deserializeResultsInClient(i,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(n(42273).Z),he=n(51467);function ge(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}var me=ae.tr.featurizeSA,ve=ae.tr.getClip,ye=ae.tr.getTag,be=ae.tr.getLength,xe=ae.tr.getLengthSansClipping;function we(e){e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearPileupDisplay"===e.name){var t=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature;return[].concat((0,f.Z)(t()),(0,f.Z)(n?[{label:"Dotplot of read vs ref",icon:he.Z,onClick:function(){return function(e,t){var n=(0,c.getSession)(t);try{var r=e.get("CIGAR"),a=ve(r,1),i=e.get("flags"),o=e.get("strand"),s=e.get("name"),u="".concat(s,"_assembly_").concat(Date.now()),l=t.parentTrack,d=(0,k.getConf)(l,"assemblyNames"),p=(0,h.Z)(d,1)[0],g=[p,u],m="track-".concat(Date.now()),v="".concat(s,"_vs_").concat(p),y=ye(e,"SA")||"",b=me(y,e.id(),o,s,!0),x=e.toJSON();x.strand=1,x.mate={refName:s,start:a,end:a+xe(r)};var w=be(2048&i?b[0].CIGAR:r),C=[x].concat((0,f.Z)(b));C.sort((function(e,t){return e.clipPos-t.clipPos}));var Z=C.reduce((function(e,t){return e+t.end-t.start}),0);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:Z/800,displayedRegions:ge(C.map((function(e,t){return{start:e.start,end:e.end,refName:e.refName,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:w/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:u,start:0,end:w,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:g,adapter:{type:"FromConfigAdapter",features:C},trackId:m,name:v}],assemblyNames:g,tracks:[{configuration:m,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(m,"-DotplotDisplay")}]}],displayName:"".concat(s," vs ").concat(p)})}catch(S){console.error(S),n.notify("".concat(S),"error")}}(n,e)}}]:[]))}}}}));e.stateModel=t}return e}))}var ke=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="DotplotPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new d.Z({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,m.types.compose(w.Z,m.types.model("DotplotView",{id:C.ElementId,type:m.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:m.types.array(m.types.string),drawCigar:!0,hview:m.types.optional(R,{}),vview:m.types.optional(A,{}),cursorMode:"crosshair",tracks:m.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:m.types.array(t.pluggableConfigSchemaType("track"))})).volatile((function(){return{volatileWidth:void 0,volatileError:void 0,borderX:100,borderY:100}})).views((function(e){return{get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}})).views((function(e){return{get assemblyErrors(){var t=(0,c.getSession)(e).assemblyManager;return e.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=e.assemblyNames,n=(0,c.getSession)(e).assemblyManager;return t.every((function(e){var t,r;return null===(t=null===(r=n.get(e))||void 0===r?void 0:r.initialized)||void 0===t||t}))}}})).views((function(e){return{get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){var t=e.hview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:(0,v.Cz)(r.contentBlocks,a)},get vticks(){var t=e.vview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:(0,v.Cz)(r.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps:function(){return(0,g.Z)((0,g.Z)({},(0,b.getParentRenderProps)(e)),{},{drawCigar:e.drawCigar,highResolutionScaling:(0,k.getConf)((0,c.getSession)(e),"highResolutionScaling")})}}})).actions((function(e){return{setCursorMode:function(t){e.cursorMode=t},setDrawCigar:function(t){e.drawCigar=t},clearView:function(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,m.cast)([]),e.tracks.clear()},setBorderX:function(t){e.borderX=t},setBorderY:function(t){e.borderY=t},setWidth:function(t){return e.volatileWidth=t,e.volatileWidth},setHeight:function(t){return e.height=t,e.height},setError:function(t){e.volatileError=t},closeView:function(){(0,m.getParent)(e,2).removeView(e)},zoomOutButton:function(){e.hview.zoomOut(),e.vview.zoomOut()},zoomInButton:function(){e.hview.zoomIn(),e.vview.zoomIn()},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=(0,c.getSession)(e),n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.pluggableConfigSchemaType("track"),i=(0,m.resolveIdentifier)(a,(0,m.getRoot)(e),n),o=t.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=t.getViewType(e.type),c=i.displays.find((function(e){return s.displayTypes.find((function(t){return t.name===e.type}))}));if(!c)throw new Error("could not find a compatible display for view type ".concat(e.type));var u=o.stateModel.create((0,g.Z)((0,g.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]}));e.tracks.push(u)},hideTrack:function(n){var r=t.pluggableConfigSchemaType("track"),a=(0,m.resolveIdentifier)(r,(0,m.getRoot)(e),n),i=e.tracks.filter((function(e){return e.configuration===a}));return(0,y.transaction)((function(){return i.forEach((function(t){return e.tracks.remove(t)}))})),i.length},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames:function(t,n){e.assemblyNames=(0,m.cast)([t,n])},setViews:function(t){e.hview=(0,m.cast)(t[0]),e.vview=(0,m.cast)(t[1])},getCoords:function(t,n){var r=(0,c.minmax)(n[0],t[0]),a=(0,h.Z)(r,2),i=a[0],o=a[1],s=(0,c.minmax)(n[1],t[1]),u=(0,h.Z)(s,2),l=u[0],d=u[1];return Math.abs(o-i)>3&&Math.abs(d-l)>3?[e.hview.pxToBp(i),e.hview.pxToBp(o),e.vview.pxToBp(e.viewHeight-l),e.vview.pxToBp(e.viewHeight-d)]:void 0},zoomIn:function(t,n){var r=this.getCoords(t,n);if(r){var a=(0,h.Z)(r,4),i=a[0],o=a[1],s=a[2],c=a[3];e.hview.moveTo(i,o),e.vview.moveTo(c,s)}},onDotplotView:function(t,n){var r=this.getCoords(t,n);if(r){var a=(0,h.Z)(r,4),i=a[0],o=a[1],s=a[2],u=a[3],l=(0,c.getSession)(e),d=P.create((0,g.Z)((0,g.Z)({},(0,m.getSnapshot)(e.hview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0})),f=P.create((0,g.Z)((0,g.Z)({},(0,m.getSnapshot)(e.vview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0}));d.setVolatileWidth(e.hview.width),f.setVolatileWidth(e.vview.width),d.moveTo(i,o),f.moveTo(u,s),d.zoomTo(d.bpPerPx/(e.width/e.hview.width),0),f.zoomTo(f.bpPerPx/(e.width/e.vview.width),0);var v=e.tracks.map((function(e){return e.configuration.displays.find((function(e){return"LinearSyntenyDisplay"===e.type}))})).filter((function(e){return!!e})).map((function(e){var t=(0,m.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}})),y=(0,m.getSnapshot)(d),b=(y.id,(0,p.Z)(y,L)),x=(0,m.getSnapshot)(f),w=(x.id,(0,p.Z)(x,N)),k={type:"LinearSyntenyView",views:[(0,g.Z)({type:"LinearGenomeView",tracks:[],hideHeader:!0},b),(0,g.Z)({type:"LinearGenomeView",tracks:[],hideHeader:!0},w)],tracks:v};l.addView("LinearSyntenyView",k)}}}})).actions((function(e){return{beforeDestroy:function(){var t=(0,c.getSession)(e);e.assemblyNames.forEach((function(e){t.removeTemporaryAssembly(e)}))},afterAttach:function(){(0,m.addDisposer)(e,(0,y.autorun)((function(){var t=(0,c.getSession)(e);if(void 0!==e.volatileWidth&&!e.initialized){var n=[e.viewWidth,e.viewHeight],r=[e.hview,e.vview];e.assemblyNames.forEach((function(a,i){var o=t.assemblyManager.get(a);if(o){o.error&&e.setError(o.error);var s=o.regions;if(s&&s.length){var c=s;c&&(0,y.transaction)((function(){var e=r[i];e.setDisplayedRegions(c),e.setBpPerPx(e.totalBp/n[i])}))}}}))}}),{delay:1e3})),(0,m.addDisposer)(e,(0,y.autorun)((function(){if(void 0!==e.volatileWidth){var t=e.vview,n=e.hview,r=e.viewHeight,a=e.viewWidth,i=t.dynamicBlocks.contentBlocks,o=n.dynamicBlocks.contentBlocks,s=n.offsetPx,u=t.offsetPx,l=(0,v.F$)(i,r,u),d=(0,v.F$)(o,a,s),f=function(e){return(0,c.measureText)(e.slice(0,30))},p=o.filter((function(e){return!d.has(e.key)})).reduce((function(e,t){return Math.max(e,f(t.refName))}),0),h=i.filter((function(e){return!l.has(e.key)})).reduce((function(e,t){return Math.max(e,f(t.refName))}),0);e.setBorderY(Math.max(p+40,50)),e.setBorderX(Math.max(h+40,50))}})))},squareView:function(){var t=e.hview,n=e.vview,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(i.coord,i.refName,i.index)},squareViewProportional:function(){var t=e.hview,n=e.vview,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,i=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(i.coord,i.refName,i.index),n.setBpPerPx(a),n.centerAt(o.coord,o.refName,o.index)},showAllRegions:function(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()}}})).views((function(e){return{menuItems:function(){var t=(0,c.getSession)(e);return[{label:"Return to import form",onClick:function(){(0,c.getSession)(e).queueDialog((function(t){return[x.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:S.Z},{label:"Square view - same bp per pixel",onClick:function(){return e.squareView()}},{label:"Rectangular view - same total bp",onClick:function(){return e.squareView()}},{label:"Show all regions",onClick:function(){return e.showAllRegions()}}].concat((0,f.Z)((0,c.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:Z.GD}]:[]))},get error(){return e.volatileError||e.assemblyErrors}}}))),ReactComponent:(0,l.lazy)((function(){return Promise.all([n.e(2361),n.e(138)]).then(n.bind(n,10138))}))});var t}))}(e),K(e),function(e){e.addRendererType((function(){return new le({name:"DotplotRenderer",configSchema:de,ReactComponent:$,pluginManager:e})}))}(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",function(){var e=(0,q.Z)((0,G.Z)().mark((function e(t){var n,r,a,i,o,s,c;return(0,G.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,r=t.views,a=t.tracks,i=void 0===a?[]:a,e.prev=1,o=n.addView("DotplotView",{}),s=r.map((function(e){return e.assembly})),(0,y.transaction)((function(){o.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),o.setAssemblyNames(s[0],s[1])})),c=[],i.forEach((function(e){return fe(o,e,c)})),!c.length){e.next=9;break}throw new Error("Could not resolve identifiers: ".concat(c.join(",")));case 9:e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(1),n.notify("".concat(e.t0),"error"),e.t0;case 15:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}())}(e),we(e),e.addRpcMethod((function(){return new pe(e)}))}},{key:"configure",value:function(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:u.Z,onClick:function(e){e.addView("DotplotView",{})}})}}]),s}(s.Z)},46323:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(5868),u=n(99836);var l=function(e){return(0,u.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})},d=n(91271),f=n(67903);var p=n(33028),h=n(63680);var g=function(e){e.addDisplayType((function(){var t=function(e){return(0,u.ConfigurationSchema)("LinearGCContentDisplay",{},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),n=function(e,t){return h.types.compose("LinearGCContentDisplay",(0,f.LT)(e,t),h.types.model({type:h.types.literal("LinearGCContentDisplay")})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=(0,u.getConf)(e.parentTrack,"adapter");return(0,p.Z)((0,p.Z)({},t()),{},{adapterConfig:{type:"GCContentAdapter",sequenceAdapter:n}})}}}))}(e,t);return new d.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:n,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:f.Xl})}))},m=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GCContentPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.Z({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:l(e),getAdapterClass:function(){return n.e(1658).then(n.bind(n,81658)).then((function(e){return e.default}))}})}))}(e),g(e)}}]),s}(s.Z)},31951:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(91271),u=n(63680),l=n(99836);var d=(0,l.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,l.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:u.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0});var f=(0,l.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),p=n(16151),h=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GFF3Plugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:d,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2094),n.e(2018),n.e(5413),n.e(7704),n.e(2598),n.e(2968)]).then(n.bind(n,8181)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:f,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(8538),n.e(5413),n.e(2598),n.e(2530)]).then(n.bind(n,3616)).then((function(e){return e.default}))}})}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3TabixAdapter",i=(0,p.getFileName)(t),o=n&&(0,p.getFileName)(n);return/\.gff3?\.b?gz$/i.test(i)||r===a?{type:a,bamLocation:t,gffGzLocation:t,index:{location:n||(0,p.makeIndex)(t,".tbi"),indexType:(0,p.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3Adapter",i=(0,p.getFileName)(t),o={type:a,gffLocation:t};return/\.gff3?$/i.test(i)&&!r||r===a?o:e(t,n,r)}}))}(e)}}]),s}(s.Z)},43568:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(68079),a=n(9249),i=n(87371),o=n(45754),s=n(13820),c=n(87977),u=n(97531),l=n(39352),d=n(92822),f=n(96902),p=n(99836),h=n(91271),g=n(63680),m=n(42328),v=g.types.compose(m.Region,g.types.model("Label",{label:g.types.optional(g.types.string,"")})).actions((function(e){return{setLabel:function(t){e.label=t}}}));function y(e){return g.types.model("GridBookmarkModel",{id:m.ElementId,type:g.types.literal("GridBookmarkWidget"),view:g.types.safeReference(e.pluggableMstType("view","stateModel")),bookmarkedRegions:g.types.array(v),modelSelectedAssembly:""}).actions((function(e){return{importBookmarks:function(t){e.bookmarkedRegions=(0,g.cast)(e.bookmarkedRegions.concat(t))},addBookmark:function(t){e.bookmarkedRegions.push(t)},removeBookmark:function(t){e.bookmarkedRegions.splice(t,1)},clearAllBookmarks:function(){e.bookmarkedRegions.clear()},updateBookmarkLabel:function(t,n){var r;null===(r=e.bookmarkedRegions[t])||void 0===r||r.setLabel(n)},setSelectedAssembly:function(t){e.modelSelectedAssembly=t}}})).views((function(e){return{get selectedAssembly(){return e.modelSelectedAssembly||(e.bookmarkedRegions.length?e.bookmarkedRegions[0].assemblyName:"")},get assemblies(){return(0,r.Z)(new Set(e.bookmarkedRegions.map((function(e){return e.assemblyName}))))}}}))}var b=(0,p.ConfigurationSchema)("GridBookmarkWidget",{}),x=function(e){(0,o.Z)(c,e);var t=(0,s.Z)(c);function c(){var e;(0,a.Z)(this,c);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="GridBookmarkPlugin",e}return(0,i.Z)(c,[{key:"install",value:function(e){!function(e){e.addWidgetType((function(){return new h.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:b,stateModel:y(e),ReactComponent:(0,f.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(9662)]).then(n.bind(n,79662))}))})}))}(e),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearGenomeView"===e.name){var t=e.stateModel.extend((function(e){var t=e.menuItems,n=e.rubberBandMenuItems;return{actions:{activateBookmarkWidget:function(){var t=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(t)){var n=t.widgets.get("GridBookmark");return n||(n=t.addWidget("GridBookmarkWidget","GridBookmark",{view:e})),t.showWidget(n),n}throw new Error("Could not open bookmark widget")},bookmarkCurrentRegion:function(){var t=e.getSelectedRegions(e.leftOffset,e.rightOffset)[0],n=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(n)){var r=n.widgets,a=r.get("GridBookmark");a||(this.activateBookmarkWidget(),a=r.get("GridBookmark")),a.addBookmark(t)}}},views:{menuItems:function(){return[].concat((0,r.Z)(t()),[{type:"divider"},{label:"Open bookmark widget",icon:d.Z,onClick:e.activateBookmarkWidget},{label:"Bookmark current region",icon:l.Z,onClick:e.bookmarkCurrentRegion}])},rubberBandMenuItems:function(){return[].concat((0,r.Z)(n()),[{label:"Bookmark region",icon:l.Z,onClick:function(){var t=e.leftOffset,n=e.rightOffset,r=e.getSelectedRegions(t,n)[0],a=(0,u.getSession)(e);if((0,u.isSessionModelWithWidgets)(a)){var i=a.widgets,o=i.get("GridBookmark");o||(e.activateBookmarkWidget(),o=i.get("GridBookmark")),o.addBookmark(r)}}}])}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){}}]),c}(c.Z)},58214:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(5868),c=n(87977);var u=(0,n(99836).ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),l=n(16151),d=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GTFPlugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"GtfAdapter",displayName:"GTF adapter",configSchema:u,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(8538),n.e(5413),n.e(6631)]).then(n.bind(n,5689)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="GtfAdapter",i=(0,l.getFileName)(t),o={type:a,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(i)&&!r||r===a?o:e(t,n,r)}}))}}]),c}(c.Z)},15578:function(e,t,n){"use strict";n.d(t,{Z:function(){return D}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(33028),u=(n(96902),n(46186)),l=n(4782),d=n(29938);var f=(0,l.observer)((function(e){var t=e.width,n=e.height,r=Math.ceil(t);return(0,d.jsx)("div",{style:{position:"relative",width:r,height:n},children:(0,d.jsx)(u.PrerenderedCanvas,(0,c.Z)((0,c.Z)({},e),{},{style:{position:"absolute",left:0,top:0}}))})})),p=n(99836);var h=(0,p.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0}),g=n(96234),m=n(32723),v=n(34795),y=n(93069),b=n(95058),x=n(62518),w=n(97531),k=n(31440),C=n(66043),Z=n(75019),S=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return(0,a.Z)(s,[{key:"makeImageData",value:function(){var e=(0,v.Z)((0,m.Z)().mark((function e(t,r){var a,i,o,s,c,u,l,d,f,h,g,v,y,b,x,k,C,S,T,M,P,R,A,L,N,j,F,I;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.features,i=r.config,o=r.bpPerPx,s=r.signal,c=r.resolution,u=r.sessionId,l=r.adapterConfig,e.next=3,(0,Z.uP)(this.pluginManager,u,l);case 3:return d=e.sent,f=d.dataAdapter,e.next=7,f.getResolution(o/c);case 7:return h=e.sent,e.next=10,n.e(5707).then(n.t.bind(n,55707,23)).then((function(e){return e.default}));case 10:if(g=e.sent,v=h/(o*Math.sqrt(2)),y=g((0,p.readConfObject)(i,"baseColor")),!a.length){e.next=37;break}return b=a[0].bin1,x=0,k=0,C=0,e.next=20,(0,w.abortBreakPoint)(s);case 20:for(S=0;S<a.length;S++)T=a[S],M=T.bin1,P=T.bin2,R=T.counts,x=Math.max(R,x),k=Math.min(Math.min(M,P),k),C=Math.max(Math.max(M,P),C);return e.next=23,(0,w.abortBreakPoint)(s);case 23:t.rotate(-Math.PI/4),A=Date.now(),L=0;case 26:if(!(L<a.length)){e.next=37;break}if(N=a[L],j=N.bin1,F=N.bin2,I=N.counts,t.fillStyle=(0,p.readConfObject)(i,"color",{count:I,maxScore:x,baseColor:y}),t.fillRect((j-b)*v,(F-b)*v,v,v),!(+Date.now()-A>400)){e.next=34;break}return e.next=33,(0,w.abortBreakPoint)(s);case 33:A=+Date.now();case 34:L++,e.next=26;break;case 37:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,v.Z)((0,m.Z)().mark((function e(t){var n,r,a,i,o,u,l,d,f,h,v=this;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.config,r=t.regions,a=t.bpPerPx,i=(0,g.Z)(r,1),o=i[0],u=(o.end-o.start)/a,l=(0,p.readConfObject)(n,"maxHeight"),e.next=6,this.getFeatures(t);case 6:return d=e.sent,e.next=9,(0,k.C)(u,l,t,(function(e){return v.makeImageData(e,(0,c.Z)((0,c.Z)({},t),{},{features:d}))}));case 9:return f=e.sent,e.next=12,(0,y.Z)((0,b.Z)(s.prototype),"render",this).call(this,(0,c.Z)((0,c.Z)((0,c.Z)({},t),f),{},{features:d,region:t.regions[0],height:l,width:u}));case 12:return h=e.sent,e.abrupt("return",(0,c.Z)((0,c.Z)((0,c.Z)({},h),f),{},{height:l,width:u}));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=(0,v.Z)((0,m.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.regions,r=t.sessionId,a=t.adapterConfig,e.next=3,(0,Z.uP)(this.pluginManager,r,a);case 3:return i=e.sent,o=i.dataAdapter,e.next=7,o.getFeatures(n[0],t).pipe((0,C.q)()).toPromise();case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),s}(x.default),T=n(55385),M=n(33991),P=n(91271);var R=function(e){return(0,p.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,P.createBaseTrackConfig)(e)})},A=n(92777);var L=function(e){return(0,p.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:A.fU,explicitlyTyped:!0})},N=n(68079),j=n(63680),F=function(e){return j.types.compose("LinearHicDisplay",A.fV,j.types.model({type:j.types.literal("LinearHicDisplay"),configuration:(0,p.ConfigurationReference)(e),resolution:j.types.optional(j.types.number,1)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps:function(){var n=e.rendererType.configSchema.create((0,p.getConf)(e,"renderer")||{},(0,j.getEnv)(e));return(0,c.Z)((0,c.Z)({},t()),{},{config:n,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution})}}})).actions((function(e){return{setResolution:function(t){e.resolution=t}}})).views((function(e){var t=e.trackMenuItems;return{trackMenuItems:function(){return[].concat((0,N.Z)(t()),[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/2)}}]}])}}}))};var I=(0,p.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}}},{explicitlyTyped:!0}),B=n(16151),D=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="HicPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new P.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:I,getAdapterClass:function(){return Promise.all([n.e(2243),n.e(5393)]).then(n.bind(n,10675)).then((function(e){return e.default}))}})}))}(e),function(e){e.addRendererType((function(){return new S({name:"HicRenderer",ReactComponent:f,configSchema:h,pluginManager:e})}))}(e),function(e){e.addTrackType((function(){var t=R(e);return new T.Z({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,M.createBaseTrackModel)(e,"HicTrack",t)})}))}(e),function(e){e.addDisplayType((function(){var t=L(e);return new P.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:F(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:A.qb})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="HicAdapter",i=(0,B.getFileName)(t),o={type:a,hicLocation:t};return/\.hic/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"HicAdapter"===t?"HicTrack":e(t)}}))}},{key:"configure",value:function(e){e.jexl.addFunction("alpha",(function(e,t){return e.alpha(t)})),e.jexl.addFunction("hsl",(function(e){return e.hsl()})),e.jexl.addFunction("colorString",(function(e){return e.string()}))}}]),s}(s.Z)},78215:function(e,t,n){"use strict";n.d(t,{Z:function(){return ce}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(91271),u=n(99836);var l=(0,u.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0}),d=n(28204),f=n(68079),p=n(32723),h=n(34795),g=n(82972),m=n(17168),v=n(73794),y=n.n(v),b=n(97960).lW,x=function(){function e(t){(0,r.Z)(this,e),this.url=void 0,this.url=/\/$/.test(t.url)?t.url:"".concat(t.url,"/")}return(0,a.Z)(e,[{key:"readMeta",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(){var t,n,r,a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadFile("meta.json");case 2:return t=e.sent,n=t.compress,r=t.track_names,a=Math.ceil(t.hash_bits/4),e.abrupt("return",{hashHexCharacters:a,compress:n,tracks:r});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHashHexCharacters",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.hashHexCharacters);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCompress",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.compress);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrackNames",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.tracks);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBucket(t);case 2:return n=e.sent,e.abrupt("return",n[t]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBucket",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.hash(t),e.next=3,this.hexToDirPath(n);case 3:return r=e.sent,e.abrupt("return",this.loadFile(r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFile",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.url).concat(t));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("HTTP ".concat(n.status," ").concat(n.statusText));case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hexToDirPath",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHashHexCharacters();case 2:if(!(n=e.sent)){e.next=12;break}return e.next=6,this.getCompress();case 6:for(r=e.sent;t.length<8;)t="0".concat(t);for(t=t.substr(8-n),a=[],i=0;i<t.length;i+=3)a.push(t.substring(i,i+3));return e.abrupt("return","".concat(a.join("/"),".json").concat(r?"z":""));case 12:return e.abrupt("return","");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hash",value:function(e){return y()(b.from(e)).toString("hex").toLowerCase().replace("-","n")}}]),e}(),w=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).httpMap=void 0,o.tracksNames=void 0;var s=(0,u.readConfObject)(e,"namesIndexLocation");if(!s)throw new Error("must provide namesIndexLocation");return o.httpMap=new x({url:s.baseUri?new URL(s.uri,s.baseUri).href:s.uri}),o}return(0,a.Z)(n,[{key:"loadIndexFile",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpMap.getBucket(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchIndex",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.searchType,r=t.queryString,e.t0=this.tracksNames,e.t0){e.next=6;break}return e.next=5,this.httpMap.getTrackNames();case 5:e.t0=e.sent;case 6:return a=e.t0,e.next=9,this.loadIndexFile(r.toLowerCase());case 9:if(!(i=e.sent)[r]){e.next=12;break}return e.abrupt("return",this.formatResults(i[r],a,n));case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"formatResults",value:function(e,t,n){return[].concat((0,f.Z)("exact"===n?[]:e.prefix.map((function(e){return new m.Z({label:"object"===typeof e?e.name:e,matchedAttribute:"name",matchedObject:{result:e}})}))),(0,f.Z)(e.exact.map((function(e){var n=e[0],r=e[1],a=e[3],i=e[4],o=e[5],s="".concat(a||n,":").concat(i,"-").concat(o);return new m.Z({locString:s,label:n,matchedAttribute:"name",matchedObject:e,trackId:t[r]})})))).filter((function(e){return"too many matches"!==e.getLabel()}))}},{key:"freeResources",value:function(){}}]),n}(g.BaseAdapter);var k=(0,u.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),C=n(73561),Z=n(97531),S=n(33991),T=n(63680);var M=(0,u.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:S.baseConnectionConfig}),P=n(56666),R=n(32145),A=n(33028),L=n(96234),N=n(80131),j=n.n(N),F=n(88401),I=n.n(F);function B(e){return e&&e.label&&"string"===typeof e.label}function D(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?D(e[a],t[a]):"undefined"!==typeof e[a]&&"undefined"===typeof t[a]||(e[a]=t[a])}return e}function E(e){if(!e||"object"!==typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(Array.isArray(e))for(t=[],n=0,r=e.length;n<r;++n)n in e&&(t[n]=E(e[n]));else t=e.constructor?new e.constructor:{};return function(e,t,n){var r,a,i={};for(r in t)a=t[r],r in e&&(e[r]===a||r in i&&i[r]===a)||(e[r]=n?n(a):a);return e}(t,e,E)}function V(e,t){var n;try{n=function(e,t){var n,r,a,i,o=[],s={tracks:{}};function c(){var e;if(void 0!==a)try{var c=a.match(/^json:(.+)/i);if(e=c?JSON.parse(c[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(a)?parseFloat(a.replace(/,/g,"")):a,!n)throw new Error("Error parsing in section ".concat(o.join(" - ")));var u=o.concat(n).join(".");if("+="===r){var l=j()(s,u);l?Array.isArray(l)||(l=[l]):l=[],l.push(e),e=l}"true"===e&&(e=!0),"false"===e&&(e=!1),I()(s,u,e)}catch(d){throw new Error("syntax error".concat(t?" in ".concat(t):"").concat(i?" at line ".concat(i-1):""))}}return e.split(/\n|\r\n|\r/).forEach((function(e,t){i=t+1;var s,u=e.replace(/^\s*#.+/,"");if(s=u.match(/^\s*\[([^\]]+)/))c(),n=void 0,a=void 0,1===(o=s[1].trim().split(/\s*\.\s*/)).length&&"general"===o[0].toLowerCase()&&(o=[]);else if(s=u.match(void 0===a?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/)){c(),n=s[1].trim().split(/\s*\.\s*/);var l=s,d=(0,L.Z)(l,3);r=d[2],function(e){if("include"===e)return!0;return!1}(o.concat(n).join("."))&&(r="+="),a=s[3].trim()}else void 0!==n&&(s=u.match(/^\s{0,4}\+\s*(.+)/))?(c(),r="+=",a=s[1].trim()):void 0!==a&&(s=u.match(/^\s+(\S.*)/))?a+=a.length?" ".concat(s[1].trim()):s[1].trim():(c(),n=void 0,a=void 0)})),c(),s}(e,t)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return z(n,t)}function z(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(B(e.tracks))e.tracks=[e.tracks];else{for(var n=[],r=0,a=Object.keys(e.tracks);r<a.length;r++){var i=a[r],o=e.tracks[i];B(o)?n.push(o):n.push((0,A.Z)({label:i},o))}e.tracks=n}var s,c=e.trackMetadata;if(c&&c.sources){if("string"===typeof c.sources&&(c.sources=[c.sources]),(s=c.sources)&&s.url&&"string"===typeof s.url&&(c.sources=[c.sources]),!Array.isArray(c.sources)){for(var u=[],l=0,d=Object.keys(c.sources);l<d.length;l++){var p=d[l],h=c.sources[p];"name"in h||(h.name=p),u.push(h)}c.sources=u}c.sources=c.sources.map((function(e){if("string"===typeof e){var t={url:e},n=e.match(/\.(\w+)$/);return n&&(t.type=n[1].toLowerCase()),t}return e}))}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){var g=[];e.tracks&&g.push.apply(g,(0,f.Z)(e.tracks)),e.stores&&g.push.apply(g,(0,f.Z)(Object.values(e.stores))),e.names&&g.push(e.names),g.forEach((function(t){t.baseUrl||(t.baseUrl=e.baseUrl||"/")})),e.refSeqs&&"string"===typeof e.refSeqs&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach((function(t){if(t.config){var n=t.config;delete t.config,t=(0,A.Z)((0,A.Z)({},n),t)}var r;t.store||(r="FeatureTrack"===t.type?"JBrowse/View/Track/HTMLFeatures":"ImageTrack"===t.type?"JBrowse/View/Track/FixedImage":"ImageTrack.Wiggle"===t.type?"JBrowse/View/Track/FixedImage/Wiggle":"SequenceTrack"===t.type?"JBrowse/View/Track/Sequence":O("JBrowse/View/Track",t.type),t.type=r,W(e,t),t.histograms&&(t.histograms.baseUrl||(t.histograms.baseUrl=t.baseUrl),W(e,t.histograms)))})),e}function O(e,t){return t?(t.includes("/")||(t="".concat(e,"/").concat(t)),t=t.replace(/^\//,"")):""}function W(e,t){var n,r=t.urlTemplate,a=void 0===r?"":r;if(n=t.storeClass?O("JBrowse/Store",t.storeClass):function(e,t){return e?e.type&&e.type.includes("/FixedImage")?"JBrowse/Store/TiledImage/Fixed".concat(0===e.backendVersion?"_v0":""):/\.jsonz?$/i.test(t)?"JBrowse/Store/SeqFeature/NCList".concat(0===e.backendVersion?"_v0":""):/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}(t,a),n){var i=(0,A.Z)((0,A.Z)({},t),{},{type:n});"JBrowse/Store/Sequence/StaticChunked"!==n&&"JBrowse/Store/Sequence/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/BgzipIndexedFasta"!==n&&"JBrowse/Store/SeqFeature/TwoBit"!==n&&"JBrowse/Store/Sequence/TwoBit"!==n&&!t.useAsRefSeqStore||e.stores&&e.stores.refseqs?i.name="store".concat((0,Z.objectHash)(i)):i.name="refseqs",e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}else console.warn("Unable to determine an appropriate data store to use with track '".concat(t.label,"', please explicitly specify a storeClass in the configuration."))}function H(e){return void 0!==e.uri}function G(e){return void 0!==e.localPath}function q(){return q=(0,h.Z)((0,p.Z)().mark((function e(){var t,n,r,a,i,o,s,c,u,l,d,f,h,g,m=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>1&&void 0!==m[1]?m[1]:{include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r=m.length>2&&void 0!==m[2]?m[2]:{uri:"",locationType:"UriLocation"},a="uri"in(t=m.length>0&&void 0!==m[0]?m[0]:{uri:"",locationType:"UriLocation"})?"uri":"localPath",i=JSON.parse(JSON.stringify(t)),o="",H(t)&&(o=t.uri),G(t)&&(o=t.localPath),o.endsWith("/")&&(i[a]=o.slice(0,o.length-1)),!(H(r)&&r.uri||G(r)&&r.localPath)){e.next=35;break}s="uri"in r?"uri":"localPath",c="",H(r)&&(c=r.uri),G(r)&&(c=r.localPath),c.endsWith("/")&&(c=c.slice(0,c.length-1)),u={},l=0,d=["jbrowse.conf","jbrowse_conf.json"];case 17:if(!(l<d.length)){e.next=33;break}return f=d[l],h=null,e.prev=20,e.next=23,J((0,P.Z)({},s,"".concat(c,"/").concat(f)));case 23:h=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(20),console.error("tried to access ".concat(c,"/").concat(f,", but failed"));case 29:u=Q(u,h)||{};case 30:l++,e.next=17;break;case 33:return i[a]&&(u.dataRoot=i[a]),e.abrupt("return",U(u));case 35:return g=z(n,window.location.href),i[a]&&(g.dataRoot=i[a]),e.abrupt("return",U(g));case 38:case"end":return e.stop()}}),e,null,[[20,26]])}))),q.apply(this,arguments)}function U(e){return _.apply(this,arguments)}function _(){return _=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=D(E(a.length>1&&void 0!==a[1]?a[1]:re),t),e.next=4,$(n);case 4:return ne(r=Q(r=e.sent,t)||r,r),ae(r),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function J(e){return X.apply(this,arguments)}function X(){return(X=(0,h.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,R.openLocation)(t).readFile("utf8");case 2:if(n=e.sent,!H(t)){e.next=5;break}return e.abrupt("return",Y(n,t.uri));case 5:if(!G(t)){e.next=7;break}return e.abrupt("return",Y(n,t.localPath));case 7:return e.abrupt("return",Y(n));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.trim().startsWith("{")?function(e,t){if("string"===typeof e){var n;try{n=JSON.parse(e)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return z(n,t)}return z(e,t)}(e,t):V(e,t)}function Q(e,t){if(null===t)return null;null===e&&(e={});for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("tracks"===a&&a in e){var i=e[a]||[],o=t[a]||[];if(!Array.isArray(i)||!Array.isArray(o))throw new Error("Track config has not been properly regularized: ".concat(i," ").concat(o));e[a]=K(i||[],o||[])}else"datasets"!==a&&a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?e[a]=D(e[a],t[a]):"dataRoot"===a?(void 0===e[a]||"data"===e[a]&&void 0!==t[a])&&(e[a]=t[a]):void 0!==e[a]&&void 0===t[a]||(e[a]=t[a])}return e}function K(e,t){if(!t.length)return e;var n={};return e.forEach((function(e,t){e.index=t,n[e.label]=e})),t.forEach((function(t){var r=n[t.label];r?Q(r,t):e.push(t)})),e}function $(e){return ee.apply(this,arguments)}function ee(){return ee=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return r=(0,h.Z)((0,p.Z)().mark((function e(r,a){var i,o,s,c;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.sourceUrl||r.baseUrl){e.next=3;break}throw new Error("Could not determine source URL: ".concat(JSON.stringify(r)));case 3:if(o=Q(E(a),r)){e.next=6;break}throw new Error("Problem merging configs");case 6:return s=ne(te(r.include||[]),o),delete r.include,c=s.map(function(){var e=(0,h.Z)((0,p.Z)().mark((function e(r){var a;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.cacheBuster=t.cacheBuster,e.next=3,J({uri:new URL(r.url,i).href,locationType:"UriLocation"});case 3:return a=e.sent,e.abrupt("return",n(a,o));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(c);case 11:return e.sent.forEach((function(e){r=Q(r,e)||r})),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)},n=function(e,t){return r.apply(this,arguments)},t=E(t),e.abrupt("return",n(t,{}));case 4:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return"string"===typeof e&&(e={url:e}),"format"in e||(e.format=e.url.endsWith(".conf")?"conf":"JB_json"),"JB_json"!==e.format||"version"in e||(e.version=1),e}))):[]}function ne(e,t){if(!e)return e;if(Array.isArray(e))for(var n=0;n<e.length;n+=1)e[n]=ne(e[n],t);else if("object"===typeof e)for(var r=e,a=0,i=Object.keys(r);a<i.length;a++){var o=i[a];r[o]=ne(r[o],t)}else if("string"===typeof e)return function(e,t){var n=this;return e.replace(/\{([\w\s.]+)\}/g,(function(e,r){r=r.replace(/\s+/g,"");var a=j()(t,r);if(void 0!==a)return"function"===typeof a?a(r):a;if(t.callback){var i=t.callback.call(n,r);if(void 0!==i)return i}return e}))}(e,t);return e}var re={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function ae(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}var ie=n(16151);function oe(e,t,n){var r={trackId:(0,Z.objectHash)(e),name:e.key||e.label},a=e.metadata&&(e.metadata.description||e.metadata.Description);a&&(r.description=a);var i=e.category||e.metadata&&e.metadata.category;r.category=i?i.split(/\s*\/\s*/):[];var o=e.storeClass;if(!e.urlTemplate){if(!o||!o.endsWith("FromConfig")){var s=e.key||e.label;return console.warn('Could not import JBrowse1 track "'.concat(s,'" because it does not have a "urlTemplate" or is not a "FromConfig" track')),(0,ie.generateUnsupportedTrackConf)(r.name,s,r.category)}return function(e,t){var n=e.features||[],r=n.map((function(e){var t=JSON.parse(JSON.stringify(e));return t.refName=e.seq_id,t.uniqueId="".concat(e.seq_id,":").concat(e.start,"-").concat(e.end,":").concat(e.name||""),t}));return t.adapter={type:"FromConfigAdapter",features:r},t.type="FeatureTrack",t}(e,r)}var c=function(e){return new URL(e,"".concat(t,"/")).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}")},u=c(e.urlTemplate);if(o){if("JBrowse/Store/SeqFeature/BAM"===o){var l={type:"BamAdapter",bamLocation:{uri:u,locationType:"UriLocation"}};return e.baiUrlTemplate?l.index={location:{uri:c(e.baiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?l.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:l.index={location:{uri:"".concat(u,".bai"),locationType:"UriLocation"}},(0,A.Z)((0,A.Z)({},r),{},{type:"AlignmentsTrack",adapter:l})}if("JBrowse/Store/SeqFeature/CRAM"===o){var d={type:"CramAdapter",cramLocation:{uri:u,locationType:"UriLocation"},sequenceAdapter:n};return e.craiUrlTemplate?d.craiLocation={uri:c(e.craiUrlTemplate),locationType:"UriLocation"}:d.craiLocation={uri:"".concat(u,".crai"),locationType:"UriLocation"},(0,A.Z)((0,A.Z)({},r),{},{type:"AlignmentsTrack",adapter:d})}if("JBrowse/Store/SeqFeature/NCList"===o)return(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/BigWig"===o||"JBrowse/Store/BigWig"===o)return e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density"),(0,A.Z)((0,A.Z)({},r),{},{type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/VCFTabix"===o){var f={type:"VcfTabixAdapter",vcfGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?f.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?f.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:f.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,A.Z)((0,A.Z)({},r),{},{type:"VariantTrack",adapter:f})}if("JBrowse/Store/SeqFeature/VCFTribble"===o)return(0,ie.generateUnsupportedTrackConf)(r.name,"VCFTribble (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/GFF3"===o)return(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"Gff3Adapter",gffLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/BigBed"===o)return(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/GFF3Tabix"===o){var p={type:"Gff3TabixAdapter",gffGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?p.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?p.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:p.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:p})}if("JBrowse/Store/SeqFeature/BED"===o)return(0,ie.generateUnsupportedTrackConf)(r.name,"BED (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/BEDTabix"===o){var h={type:"BedTabixAdapter",bedGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?h.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?h.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:h.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:h})}if("JBrowse/Store/SeqFeature/GTF"===o)return(0,A.Z)((0,A.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"GtfAdapter",gtfLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/StaticChunked"===o||"JBrowse/Store/Sequence/StaticChunked"===o)return(0,ie.generateUnsupportedTrackConf)(r.name,"StaticChunked (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/UnindexedFasta"===o)return(0,ie.generateUnsupportedTrackConf)(r.name,"UnindexedFasta (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/IndexedFasta"===o){var g={type:"IndexedFastaAdapter",fastaLocation:{uri:u,locationType:"UriLocation"}};return e.faiUrlTemplate?g.faiLocation={uri:c(e.faiUrlTemplate),locationType:"UriLocation"}:g.faiLocation={uri:"".concat(u,".fai"),locationType:"UriLocation"},(0,A.Z)((0,A.Z)({},r),{},{type:"SequenceTrack",adapter:g})}if("JBrowse/Store/SeqFeature/BgzipIndexedFasta"===o){var m={type:"BgzipFastaAdapter",fastaLocation:{uri:u,locationType:"UriLocation"}};return e.faiUrlTemplate?m.faiLocation={uri:c(e.faiUrlTemplate),locationType:"UriLocation"}:m.faiLocation={uri:"".concat(u,".fai"),locationType:"UriLocation"},e.gziUrlTemplate?m.gziLocation={uri:c(e.gziUrlTemplate),locationType:"UriLocation"}:m.gziLocation={uri:"".concat(u,".gzi"),locationType:"UriLocation"},(0,A.Z)((0,A.Z)({},r),{},{type:"ReferenceSequenceTrack",adapter:m})}if("JBrowse/Store/SeqFeature/TwoBit"===o)return(0,A.Z)((0,A.Z)({},r),{},{type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:u,locationType:"UriLocation"}}})}if(r.adapter=(0,ie.guessAdapter)({uri:u,locationType:"UriLocation"},void 0,u),!r.adapter)throw new Error("Could not determine adapter");return r.adapter.type===ie.UNSUPPORTED?(0,ie.generateUnsupportedTrackConf)(r.name,u,r.category):r.adapter.type===ie.UNKNOWN?(0,ie.generateUnknownTrackConf)(r.name,u,r.category):(r.type=(0,ie.guessTrackType)(r.adapter.type),"QuantitativeTrack"===r.type&&(e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density")),r)}function se(e){return T.types.compose("JBrowse1Connection",(0,S.BaseConnectionModelFactory)(e),T.types.model({configuration:(0,u.ConfigurationReference)(M),type:T.types.literal("JBrowse1Connection")})).actions((function(e){return{connect:function(){var t=(0,u.readConfObject)(e.configuration,"dataDirLocation"),n=(0,Z.getSession)(e);(function(){return q.apply(this,arguments)})(t).then((function(t){var r,a=(0,u.readConfObject)(e.configuration,"assemblyNames")[0];if(!a)throw new Error("assembly name required for JBrowse 1 connection");var i=n.assemblies.find((function(e){return(0,u.readConfObject)(e,"name")===a}));if(!i)throw new Error('Assembly "'.concat(a,'" not found'));var o=(0,u.readConfObject)(i,["sequence","adapter"]),s=null===(r=t.tracks)||void 0===r?void 0:r.map((function(e){var n=oe(e,t.dataRoot||"",o);return n.assemblyNames=[a],n}));e.setTrackConfs(s)})).catch((function(t){console.error(t),n.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'". Please make sure you have entered a valid location. The error that was thrown is: "').concat(t,'"'),"error"),n.breakConnection(e.configuration)}))}}}))}var ce=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LegacyJBrowsePlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:l,getAdapterClass:function(){return Promise.all([n.e(2018),n.e(3472),n.e(4782),n.e(2693)]).then(n.bind(n,22693)).then((function(e){return e.default}))}})}))}(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="NCListAdapter",i=(0,ie.getFileName)(t);return/trackData.jsonz?$/i.test(i)||r===a?{type:a,rootUrlTemplate:t}:e(t,n,r)}}))}(e),function(e){e.addTextSearchAdapterType((function(){return new d.Z({name:"JBrowse1TextSearchAdapter",configSchema:k,AdapterClass:w,description:"A JBrowse 1 text search adapter"})}))}(e),function(e){e.addConnectionType((function(){return new C.Z({name:"JBrowse1Connection",configSchema:M,stateModel:se(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})}))}(e)}}]),s}(s.Z)},77251:function(e,t,n){"use strict";n.d(t,{Z:function(){return We}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(97531),u=n(2956),l=n(95984),d=n(99836);var f=function(e){return(0,d.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})},p=n(32723),h=n(34795),g=n(33028),m=n(63680),v=n(16151),y=n(33991);function b(e){var t=(0,c.getSession)(e).rpcManager,n=e;(0,d.readConfObject)(e.configuration);var r=e.adapterConfig,a=(0,c.getContainingView)(e),i=(0,v.getRpcSessionId)(e);return(0,m.getSnapshot)(a),a.initialized?{rpcManager:t,renderProps:(0,g.Z)((0,g.Z)({},n.renderProps()),{},{view:a,adapterConfig:r,sessionId:i,timeout:1e6,self:e})}:void 0}function x(e){return w.apply(this,arguments)}function w(){return(w=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a,i,o;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n=t.rpcManager,r=t.renderProps,a=r.adapterConfig,i=r.view.views[0],e.next=7,n.call("getFeats","CoreGetFeatures",{regions:i.staticBlocks.contentBlocks,sessionId:"getFeats",adapterConfig:a});case 7:return o=e.sent,e.abrupt("return",{features:(0,c.dedupe)(o,(function(e){return e.id()}))});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=function(e){return m.types.compose("LinearComparativeDisplay",y.BaseDisplay,m.types.model({type:m.types.literal("LinearComparativeDisplay"),configuration:(0,d.ConfigurationReference)(e),height:100})).volatile((function(){return{renderInProgress:void 0,features:void 0,message:void 0}})).views((function(e){return{renderProps:function(){return{rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2}}}})).actions((function(e){var t;return{setLoading:function(n){e.message=void 0,e.error=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.message=n,e.error=void 0,t=void 0},setRendered:function(n){if(n){for(var r=n.features,a=e.features||[],i=new Set(a.map((function(e){return e.id()}))||[]),o=new Set((null===r||void 0===r?void 0:r.map((function(e){return e.id()})))||[]),s=!1,c=!1,u=0;u<r.length;u++)if(!i.has(r[u].id())){s=!0;break}for(var l=0;l<a.length;l++)if(!o.has(a[l].id())){c=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||c)&&(e.features=r)}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.message=void 0,e.error=n,t=void 0}}})).actions((function(e){return{afterAttach:function(){(0,c.makeAbortableReaction)(e,b,x,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}}}))},C=n(96902),Z=n(65317),S=n(68079),T=n(75717),M=n(66705),P=n(46186),R=n(42328),A=n(23642),L=n(93472);var N=function(e){return m.types.compose("LinearComparativeView",M.Z,m.types.model({id:R.ElementId,type:m.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,middleComparativeHeight:100,tracks:m.types.array(e.pluggableMstType("track","stateModel")),views:m.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:m.types.array(e.pluggableConfigSchemaType("track"))})).volatile((function(){return{width:void 0}})).views((function(e){return{get highResolutionScaling(){return 2},get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every((function(e){return e.initialized}))},get refNames(){return e.views.map((function(e){return(0,S.Z)(new Set(e.staticBlocks.map((function(e){return e.refName}))))}))},get assemblyNames(){return(0,S.Z)(new Set(e.views.map((function(e){return e.assemblyNames})).flat()))}}})).actions((function(t){return{afterAttach:function(){var e=this;(0,m.addDisposer)(t,(0,m.onAction)(t,(function(n){if(t.linkViews){var r=n.name,a=n.path,i=n.args;["horizontalScroll","zoomTo","setScaleFactor"].includes(r)&&a&&e.onSubviewAction(r,a,i)}})))},beforeDestroy:function(){var e=(0,c.getSession)(t);t.assemblyNames.forEach((function(t){e.removeTemporaryAssembly(t)}))},onSubviewAction:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.views.forEach((function(t){var a=(0,m.getPath)(t);a.lastIndexOf(n)!==a.length-n.length&&t[e](r[0])}))},setWidth:function(e){t.width=e},setViews:function(e){t.views=(0,m.cast)(e)},removeView:function(e){t.views.remove(e)},closeView:function(){(0,m.getParent)(t,2).removeView(t)},setMiddleComparativeHeight:function(e){return t.middleComparativeHeight=e,t.middleComparativeHeight},toggleLinkViews:function(){t.linkViews=!t.linkViews},activateTrackSelector:function(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));var e=(0,c.getSession)(t);if((0,c.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=(0,m.resolveIdentifier)(a,(0,m.getRoot)(t),n);if(!i)throw new Error("track not found ".concat(n));var o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=e.getViewType(t.type).displayTypes.map((function(e){return e.name})),c=i.displays.find((function(e){return s.includes(e.type)}));if(!c)throw new Error("could not find a compatible display for view type ".concat(t.type));t.tracks.push(o.stateModel.create((0,g.Z)((0,g.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]})))},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,m.resolveIdentifier)(r,(0,m.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,T.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},squareView:function(){var e=(0,c.avg)(t.views.map((function(e){return e.bpPerPx})));t.views.forEach((function(t){var n=t.pxToBp(t.width/2);t.setNewView(e,t.offsetPx),n.refName&&t.centerAt(n.coord,n.refName,n.index)}))},clearView:function(){t.views=(0,m.cast)([]),t.tracks=(0,m.cast)([])}}})).views((function(){return{headerMenuItems:function(){return[]}}})).views((function(e){return{menuItems:function(){return[].concat((0,S.Z)(e.views.map((function(e,t){var n,r=null===(n=e.menuItems)||void 0===n?void 0:n.call(e);return r?{label:"View ".concat(t+1," Menu"),subMenu:r}:void 0})).filter((function(e){return!!e}))),[{label:"Return to import form",onClick:function(){(0,c.getSession)(e).queueDialog((function(t){return[P.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:L.Z},{label:"Open track selector",onClick:e.activateTrackSelector,icon:A.GD}])},rubberBandMenuItems:function(){return[{label:"Zoom to region(s)",onClick:function(){e.views.forEach((function(e){var t=e.leftOffset,n=e.rightOffset;t&&n&&e.moveTo(t,n)}))}}]}}})).actions((function(e){return{afterAttach:function(){(0,m.addDisposer)(e,(0,T.autorun)((function(){e.width&&e.views.forEach((function(t){return t.setWidth(e.width)}))})))}}}))};var j=function(e){return(0,d.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:f(e),explicitlyTyped:!0})},F=n(98103),I=n(24839);function B(e){var t=e.feature,n=e.ctx,r=e.offsets,a=e.cb,i=e.height,o=e.drawCurves,s=e.oobLimit,u=e.viewWidth,l=e.hideTiny,d=t.p11,f=t.p12,p=t.p21,h=t.p22,g=d.offsetPx-r[0],m=f.offsetPx-r[0],v=p.offsetPx-r[1],y=h.offsetPx-r[1],b=Math.abs(m-g),x=Math.abs(y-v),w=i,k=(w-0)/2,C=Math.min(v,y),Z=Math.max(v,y);(0,c.doesIntersect2)(C,Z,-s,u+s)&&(b<=1&&x<=1?l||(n.beginPath(),n.moveTo(g,0),o?n.bezierCurveTo(g,k,v,k,v,w):n.lineTo(v,w),n.stroke()):(D(n,g,m,0,y,v,w,k,o),a(n)))}function D(e,t,n,r,a,i,o,s,c){c?function(e,t,n,r,a,i,o,s){var c=Math.abs(t-n),u=Math.abs(t-n);if(c<5&&u<5&&n<t&&Math.abs(t-a)>100){var l=t;t=n,n=l}e.beginPath(),e.moveTo(t,r),e.lineTo(n,r),e.bezierCurveTo(n,s,a,s,a,o),e.lineTo(i,o),e.bezierCurveTo(i,s,t,s,t,r),e.closePath(),e.fill()}(e,t,n,r,a,i,o,s):function(e,t,n,r,a,i,o){e.beginPath(),e.moveTo(t,r),e.lineTo(n,r),e.lineTo(a,o),e.lineTo(i,o),e.closePath(),e.fill()}(e,t,n,r,a,i,o)}var E=16581375;function V(e){var t=Math.floor(e/65025)%255,n=Math.floor(e/255)%255,r=e%255;return"rgb(".concat(t,",").concat(n,",").concat(r,")")}var z={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},O=3,W=1600;function H(e,t,n,r){return Math.floor((255*e*255+255*t+n-1)/r)}var G=function(e){return m.types.compose("LinearSyntenyDisplay",k(e),m.types.model({type:m.types.literal("LinearSyntenyDisplay"),configuration:(0,d.ConfigurationReference)(e)})).volatile((function(){return{mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:-1,clickId:-1,cigarMouseoverId:-1}})).actions((function(e){return{setFeatPositions:function(t){e.featPositions=t},setMainCanvasRef:function(t){e.mainCanvas=t},setClickMapCanvasRef:function(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef:function(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef:function(t){e.mouseoverCanvas=t},setMouseoverId:function(t){e.mouseoverId=t},setCigarMouseoverId:function(t){e.cigarMouseoverId=t},setClickId:function(t){e.clickId=t}}})).views((function(e){return{get adapterConfig(){return(0,g.Z)({name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,d.getConf)(e,"assemblyNames")},(0,d.getConf)(e.parentTrack,"adapter"))},get trackIds(){return(0,d.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get featMap(){return Object.fromEntries(e.featPositions.map((function(e){return[e.f.id(),e]})))}}})).actions((function(e){return{afterAttach:function(){(0,m.addDisposer)(e,(0,T.autorun)((function(){(0,c.getContainingView)(e).initialized&&function(e){var t,n,r,a=null===(t=e.mainCanvas)||void 0===t?void 0:t.getContext("2d"),i=null===(n=e.cigarClickMapCanvas)||void 0===n?void 0:n.getContext("2d"),o=(0,c.getContainingView)(e),s=o.drawCurves,u=o.drawCIGAR,l=o.middleComparativeHeight,d=o.width,f=o.views.map((function(e){return e.bpPerPx}));if(a&&i){i.imageSmoothingEnabled=!1,a.resetTransform(),a.scale(1,1),a.clearRect(0,0,d,l),a.beginPath();var p=e.featPositions,h=o.views.map((function(e){return e.offsetPx})),g=Math.floor(E/p.length);a.fillStyle=z.M,a.strokeStyle=z.M;for(var m=0;m<p.length;m++){var v=p[m],y=v.p11,b=v.p12,x=v.p21,w=v.p22,k=y.offsetPx-h[0],C=b.offsetPx-h[0],Z=x.offsetPx-h[1],S=w.offsetPx-h[1],T=Math.abs(C-k),M=Math.abs(S-Z),P=l,R=(P-0)/2;T<=O&&M<=O&&Z<d+W&&Z>-W&&(a.moveTo(k,0),s?a.bezierCurveTo(k,R,Z,R,Z,P):a.lineTo(Z,P))}a.stroke(),a.fillStyle=z.M,a.strokeStyle=z.M;for(var A=0;A<p.length;A++){var L=p[A],N=L.p11,j=L.p12,F=L.p21,I=L.p22,H=L.f,G=L.cigar,q=N.offsetPx-h[0],U=j.offsetPx-h[0],_=F.offsetPx-h[1],J=I.offsetPx-h[1],X=Math.abs(U-q),Y=Math.abs(J-_),Q=Math.min(_,J),K=Math.max(_,J),$=l,ee=($-0)/2;if(!(X<=O&&Y<=O)&&(0,c.doesIntersect2)(Q,K,-W,o.width+W)){var te=H.get("strand"),ne=-1===te?U:q,re=ne<(-1===te?q:U)?1:-1,ae=(_<J?1:-1)*te,ie=ne,oe=-1===te?J:_;if(null!==G&&void 0!==G&&G.length&&u)for(var se=!1,ce=0,ue=0,le=Math.floor(E/G.length),de=0;de<G.length;de+=2){var fe=de*le+1,pe=+G[de],he=G[de+1];se||(ce=ie,ue=oe);var ge=pe/f[0],me=pe/f[1];if("M"===he||"="===he||"X"===he?(ie+=ge*re,oe+=me*ae):"D"===he||"N"===he?ie+=ge*re:"I"===he&&(oe+=me*ae),!(Math.max(ce,ue,ie,oe)<0||Math.min(ce,ue,ie,oe)>d)){var ve=de<G.length-2;Math.abs(ie-ce)<=1&&Math.abs(oe-ue)<=1&&ve?se=!0:(se=!1,a.fillStyle=z[se&&ge>1||me>1?he:"M"],i.fillStyle=V(fe),D(a,ce,ie,0,oe,ue,$,ee,s),D(i,ce,ie,0,oe,ue,$,ee,s))}}else D(a,q,U,0,J,_,$,ee,s)}}var ye=null===(r=e.clickMapCanvas)||void 0===r?void 0:r.getContext("2d");if(ye){ye.imageSmoothingEnabled=!1,ye.clearRect(0,0,d,l);for(var be=0;be<p.length;be++){var xe=p[be],we=be*g+1;ye.fillStyle=V(we),B({cb:function(e){return e.fill()},feature:xe,ctx:ye,drawCurves:s,offsets:h,oobLimit:W,viewWidth:o.width,hideTiny:!0,height:l})}}}}(e)}))),(0,m.addDisposer)(e,(0,T.autorun)((function(){(0,c.getContainingView)(e).initialized&&(e.mouseoverId||e.clickId)&&function(e){var t,n=e.clickId,r=e.mouseoverId,a=(0,c.getContainingView)(e),i=a.drawCurves,o=a.middleComparativeHeight,s=a.width,u=null===(t=e.mouseoverCanvas)||void 0===t?void 0:t.getContext("2d"),l=a.views.map((function(e){return e.offsetPx}));if(u){if(u.resetTransform(),u.scale(1,1),u.clearRect(0,0,s,o),-1!==r&&e.features&&e.features[r]){var d=e.featPositions[r];u.fillStyle="rgb(0,0,0,0.1)",B({cb:function(e){return e.fill()},feature:d,ctx:u,oobLimit:W,viewWidth:a.width,drawCurves:i,offsets:l,height:o})}if(-1!==n&&e.features&&e.featPositions[n]){var f=e.featPositions[n];u.strokeStyle="rgb(0, 0, 0, 0.9)",B({cb:function(e){return e.stroke()},feature:f,ctx:u,oobLimit:W,viewWidth:a.width,drawCurves:i,offsets:l,height:o})}}}(e)}))),(0,m.addDisposer)(e,(0,T.reaction)((function(){var t=(0,c.getContainingView)(e);return{bpPerPx:t.views.map((function(e){return e.bpPerPx})),displayedRegions:JSON.stringify(t.views.map((function(e){return e.displayedRegions}))),features:e.features,initialized:t.initialized}}),(function(t){if(t.initialized){for(var n=(0,c.getSession)(e).assemblyManager,r=(0,c.getContainingView)(e).views.map((function(e){return(0,g.Z)((0,g.Z)({},(0,m.getSnapshot)(e)),{},{width:e.width,staticBlocks:e.staticBlocks,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth})})),a=[],i=e.features||[],o=0;o<i.length;o++){var s=i[o],u=s.get("mate"),l=s.get("start"),d=s.get("end"),f=u.start,p=u.end;if(-1===s.get("strand")){var h=[l,d];d=h[0],l=h[1]}var v=null===n||void 0===n?void 0:n.get(s.get("assemblyName")),y=null===n||void 0===n?void 0:n.get(u.assemblyName),b=s.get("refName"),x=u.refName,w=(null===v||void 0===v?void 0:v.getCanonicalRefName(b))||b,k=(null===y||void 0===y?void 0:y.getCanonicalRefName(x))||x,C=r[0],Z=r[1],S=(0,F.R)({self:C,refName:w,coord:l}),T=(0,F.R)({self:C,refName:w,coord:d}),M=(0,F.R)({self:Z,refName:k,coord:f}),P=(0,F.R)({self:Z,refName:k,coord:p});if(void 0!==S&&void 0!==T&&void 0!==M&&void 0!==P){var R=s.get("CIGAR");a.push({p11:S,p12:T,p21:M,p22:P,f:s,cigar:I.tr.parseCigar(R)})}}e.setFeatPositions(a)}}),{fireImmediately:!0}))}}}))},q=n(96234),U=n(91188),_=n(4782),J=n(16644),X=n(60131),Y=n(61291),Q=n(29938);var K=(0,U.ZL)()((function(e){return{tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,J.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"}};var t})),$=(0,_.observer)((function(e){var t=e.x,n=e.y,r=e.title,a=(0,C.useState)(0),i=(0,q.Z)(a,2),o=i[0],s=i[1],c=(0,C.useState)(null),u=(0,q.Z)(c,2),l=u[0],d=u[1],f=K().classes,p=(0,C.useMemo)((function(){return{getBoundingClientRect:function(){return{top:n,left:t+o/2,bottom:n,right:t,width:0,height:0,x:t,y:n,toJSON:function(){}}}}}),[t,n,o]),h=(0,Y.D)(p,l),m=h.styles,v=h.attributes;return r?(0,Q.jsx)(X.Z,{children:(0,Q.jsx)("div",(0,g.Z)((0,g.Z)({ref:function(e){s((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0),d(e)},className:f.tooltip,style:(0,g.Z)((0,g.Z)({},m.popper),{},{zIndex:1e5})},v.popper),{},{children:(0,Q.jsx)(P.SanitizedHTML,{html:r})}))}):null})),ee=$,te=(0,_.observer)((function(e){var t=e.model,n=(0,c.getContainingView)(t),r=n.middleComparativeHeight,a=n.width,i=(0,C.useState)(""),o=(0,q.Z)(i,2),s=o[0],u=o[1],l=(0,C.useState)(),d=(0,q.Z)(l,2),f=d[0],p=d[1],h=(0,C.useState)(),g=(0,q.Z)(h,2),m=g[0],v=g[1],y=(0,C.useCallback)((function(e){return t.setMouseoverCanvasRef(e)}),[t,r,a]),b=(0,C.useCallback)((function(e){return t.setMainCanvasRef(e)}),[t,r,a]),x=(0,C.useCallback)((function(e){return t.setClickMapCanvasRef(e)}),[t,r,a]),w=(0,C.useCallback)((function(e){return t.setCigarClickMapCanvasRef(e)}),[t,r,a]);return(0,Q.jsxs)("div",{style:{position:"relative"},children:[(0,Q.jsx)("canvas",{ref:y,width:a,height:r,style:{width:a,height:r,position:"absolute",pointerEvents:"none"}}),(0,Q.jsx)("canvas",{ref:b,onMouseMove:function(e){var n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(n&&r){var a=n.getBoundingClientRect(),i=n.getContext("2d"),o=r.getContext("2d");if(i&&o){var s=e.clientX,l=e.clientY,d=s-a.left,f=l-a.top;p(s),v(l);var h=(0,q.Z)(i.getImageData(d,f,1,1).data,3),g=h[0],m=h[1],y=h[2],b=(0,q.Z)(o.getImageData(d,f,1,1).data,3),x=b[0],w=b[1],k=b[2],C=H(g,m,y,Math.floor(E/t.numFeats));if(t.setMouseoverId(C),-1===C)u("");else if(t.featPositions[C]){var Z=t.featPositions[C],S=Z.f,T=Z.cigar,M=S.toJSON(),P=M.mate,R=H(x,w,k,Math.floor(E/T.length)),A=M.end-M.start,L=P.end-P.start,N=M.identity,j=M.name,F=P.name,I=[];I.push("Loc1: ".concat((0,c.assembleLocString)(M))),I.push("Loc2: ".concat((0,c.assembleLocString)(P))),I.push("Inverted: ".concat(-1===M.strand)),I.push("Query len: ".concat(A)),I.push("Target len: ".concat(L)),N&&I.push("Identity: ".concat(N)),T[R]&&I.push("CIGAR operator: ".concat(T[R]).concat(T[R+1])),j&&F&&(I.push("Name 1: ".concat(j)),I.push("Name 2: ".concat(F))),u(I.join("<br/>"))}}}},onMouseLeave:function(){return t.setMouseoverId(-1)},onClick:function(e){var n=t.clickMapCanvas,r=t.cigarClickMapCanvas;if(n&&r){var a=n.getBoundingClientRect(),i=n.getContext("2d"),o=r.getContext("2d");if(i&&o){var s=e.clientX-a.left,u=e.clientY-a.top,l=(0,q.Z)(i.getImageData(s,u,1,1).data,3),d=H(l[0],l[1],l[2],Math.floor(E/t.numFeats));t.setClickId(d);var f=t.featPositions[d],p=(0,c.getSession)(t);f&&(0,c.isSessionModelWithWidgets)(p)&&p.showWidget(p.addWidget("SyntenyFeatureWidget","syntenyFeature",{featureData:{feature1:f.f.toJSON(),feature2:f.f.get("mate")}}))}}},"data-testid":"synteny_canvas",style:{width:a,height:r,position:"absolute"},width:1*a,height:1*r}),(0,Q.jsx)("canvas",{ref:x,style:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},width:a,height:r}),(0,Q.jsx)("canvas",{ref:w,style:{imageRendering:"pixelated",pointerEvents:"none",visibility:"hidden",position:"absolute"},width:a,height:r}),-1!==t.mouseoverId&&s&&f&&m?(0,Q.jsx)(ee,{x:f,y:m,title:s}):null]})})),ne=(0,U.ZL)()((function(e){var t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}}}));function re(){var e=(0,C.useState)(!1),t=(0,q.Z)(e,2),n=t[0],r=t[1],a=ne().classes;return(0,C.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}})),n?(0,Q.jsx)("div",{className:a.loading,children:(0,Q.jsx)(P.LoadingEllipses,{})}):null}function ae(e){var t=e.messageText,n=ne().classes;return(0,Q.jsx)("div",{className:n.blockMessage,children:t})}function ie(e){var t=e.error,n=ne().classes;return(0,Q.jsx)("div",{className:n.blockError,children:"".concat(t)})}var oe=(0,_.observer)((function(e){var t=e.model;return t.error?(0,Q.jsx)(ie,{error:t.error}):t.message?(0,Q.jsx)(ae,{messageText:t.message}):t.features?(0,Q.jsx)(te,{model:t}):(0,Q.jsx)(re,{})})),se=oe;var ce=function(e){return(0,d.ConfigurationSchema)("LGVSyntenyDisplay",{},{baseConfiguration:(0,I.Ct)(e),explicitlyTyped:!0})},ue=I.tr.parseCigar;function le(e,t){for(var n=0,r=0,a=0;a<e.length;a++){var i=+e[a],o=e[a+1],s=Math.min(i,t-n);if(n>=t)break;"I"===o?r+=i:"D"===o?n+=s:"M"===o&&(r+=s,n+=s)}return[n,r]}function de(){return(de=(0,h.Z)((0,p.Z)().mark((function e(t,n){var r,a,i,o,s,u,l,d,f,h,g,m,v,y,b,x,w,k,C,Z,S,M,P,R,A,L,N,j,F,I,B,D,E,V,z,O,W,H;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,c.getSession)(n),a=(0,c.getContainingTrack)(n),i=(0,c.getContainingView)(n),o=i.dynamicBlocks.contentBlocks[0],s=t.get("CIGAR"),u=t.get("strand"),l=o.start,d=o.end,f=t.get("start"),h=t.get("end"),g=t.get("mate"),m=g.start,v=g.end,y=g.assemblyName,b=g.refName,x=o.assemblyName,w=o.refName,s?(M=ue(s),P=le(M,l-f),R=(0,q.Z)(P,2),A=R[0],L=R[1],N=le(M,d-f),j=(0,q.Z)(N,2),F=j[0],I=j[1],Z=f+A,S=f+F,k=(-1===u?v:m)+L*(B=-1===u?-1:1),C=(-1===u?v:m)+I*B):(Z=f,S=h,k=m,C=v),D=a.configuration.trackId,E=r.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{id:"".concat(Math.random()),type:"LinearGenomeView",hideHeader:!0},{id:"".concat(Math.random()),type:"LinearGenomeView",hideHeader:!0}],tracks:[{configuration:D,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(D,"-LinearSyntenyDisplay")}]}]}),V=function(e){return Math.floor(e)},z="".concat(w,":").concat(V(Z),"-").concat(V(S)),O=Math.min(k,C),W=Math.max(k,C),H="".concat(b,":").concat(V(O),"-").concat(V(W)).concat(-1===u?"[rev]":""),e.next=27,(0,T.when)((function(){return void 0!==E.width}));case 27:return e.next=29,Promise.all([E.views[0].navToLocString(z,x),E.views[1].navToLocString(H,y)]);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=function(e){return m.types.compose("LGVSyntenyDisplay",(0,I.$)(e),m.types.model({type:m.types.literal("LGVSyntenyDisplay"),configuration:(0,d.ConfigurationReference)(e)})).views((function(e){var t=e.contextMenuItems;return{contextMenuItems:function(){var n=e.contextMenuFeature;return[].concat((0,S.Z)(t()),(0,S.Z)(n?[{label:"Open synteny view for this position",onClick:function(){return function(e,t){return de.apply(this,arguments)}(n,e)}}]:[]))}}})).actions((function(e){return{afterCreate:function(){e.setColorScheme({type:"strand"})}}}))},pe=n(92777),he=n(3252),ge=n(56452),me=n(49391),ve=n(42043),ye=n(66026);function be(e){return(0,Q.jsx)(ye.Z,(0,g.Z)((0,g.Z)({},e),{},{children:(0,Q.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"})}))}function xe(e){return m.types.compose(N(e),m.types.model("LinearSyntenyView",{type:m.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCurves:!1})).actions((function(e){return{toggleCurves:function(){e.drawCurves=!e.drawCurves},toggleCIGAR:function(){e.drawCIGAR=!e.drawCIGAR},showAllRegions:function(){(0,T.transaction)((function(){e.views.forEach((function(e){return e.showAllRegionsInAssembly()}))}))}}})).views((function(e){var t=e.headerMenuItems;return{headerMenuItems:function(){return[].concat((0,S.Z)(t()),[{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:he.Z},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:ve.Z},{label:"Draw CIGAR",onClick:e.toggleCIGAR,checked:e.drawCIGAR,type:"checkbox",description:"Draws per-base CIGAR level alignments",icon:ve.Z},{label:e.linkViews?"Unlink views":"Link views",onClick:e.toggleLinkViews,icon:e.linkViews?me.Z:ge.Z},{label:"Use curved lines",type:"checkbox",checked:e.drawCurves,onClick:e.toggleCurves,icon:be}])}}}))}function we(e,t,n){try{e.showTrack(t)}catch(r){if(!"".concat(r).match("Could not resolve identifier"))throw r;n.push(t)}}var ke=n(55385);var Ce=function(e){return(0,d.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,y.createBaseTrackConfig)(e)})},Ze=n(26347),Se=(0,d.ConfigurationSchema)("SyntenyFeatureWidget",{}),Te=m.types.model("SyntenyFeatureWidget",{id:R.ElementId,type:m.types.literal("SyntenyFeatureWidget"),featureData:m.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),Me=n(51467),Pe=n(52809),Re=n(35388),Ae=n(78888),Le=n(66519),Ne=n(99688),je=n(44536);var Fe=I.tr.featurizeSA,Ie=I.tr.getClip,Be=I.tr.getLength,De=I.tr.getLengthSansClipping,Ee=I.tr.getTag,Ve=(0,U.ZL)()({root:{width:300}});function ze(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}function Oe(e){var t=e.track,n=e.feature,r=e.handleClose,a=Ve().classes,i=(0,C.useState)("0"),o=(0,q.Z)(i,2),s=o[0],u=o[1],l=(0,C.useState)(),f=(0,q.Z)(l,2),m=f[0],y=f[1],b=(0,C.useState)(),x=(0,q.Z)(b,2),w=x[0],k=x[1],Z=+s;return(0,C.useEffect)((function(){(0,h.Z)((0,p.Z)().mark((function e(){var r,a,i,o,s,u,l,f,h,g,m,b;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y(void 0),e.prev=1,!(2048&n.get("flags"))){e.next=20;break}return r=Ee(n,"SA")||"",a=r.split(";")[0],i=a.split(","),o=(0,q.Z)(i,2),s=o[0],u=o[1],l=(0,c.getSession)(t),f=l.rpcManager,h=(0,d.getConf)(t,"adapter"),g=(0,v.getRpcSessionId)(t),e.next=11,f.call(g,"CoreGetFeatures",{adapterConfig:h,sessionId:g,regions:[{refName:s,start:+u-1,end:+u}]});case 11:if(m=e.sent,!(b=m.find((function(e){return e.get("name")===n.get("name")&&!(2048&e.get("flags"))&&!(256&e.get("flags"))})))){e.next=17;break}k(b),e.next=18;break;case 17:throw new Error("primary feature not found");case 18:e.next=21;break;case 20:k(n);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(1),console.error(e.t0),y(e.t0);case 27:case"end":return e.stop()}}),e,null,[[1,23]])})))()}),[n,t]),(0,Q.jsxs)(P.Dialog,{open:!0,onClose:r,title:"Set window size",children:[(0,Q.jsx)(Pe.Z,{children:m?(0,Q.jsx)(Re.Z,{color:"error",children:"".concat(m)}):w?(0,Q.jsxs)("div",{className:a.root,children:[256&w.get("flags")?(0,Q.jsx)(Re.Z,{style:{color:"orange"},children:"Note: You selected a secondary alignment (which generally does not have SA tags or SEQ fields) so do a full reconstruction of the alignment"}):null,(0,Q.jsx)(Re.Z,{children:"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."}),(0,Q.jsx)(Le.Z,{value:Z,onChange:function(e){return u(e.target.value)},label:"Set window size"})]}):(0,Q.jsxs)("div",{children:[(0,Q.jsx)(Re.Z,{children:"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."}),(0,Q.jsx)(Ae.Z,{})]})}),(0,Q.jsxs)(Ne.Z,{children:[(0,Q.jsx)(je.Z,{variant:"contained",color:"secondary",onClick:r,children:"Cancel"}),(0,Q.jsx)(je.Z,{disabled:!w,variant:"contained",color:"primary",onClick:function(){try{if(!w)return;var e=w,n=(0,c.getSession)(t),a=(0,c.getContainingView)(t),i=e.get("CIGAR"),o=e.get("flags"),s=e.get("strand"),u=Ee(e,"SA")||"",l=e.get("name"),f=Ie(i,1),p="".concat(l,"_assembly_").concat(Date.now()),h=(0,d.getConf)(t,"assemblyNames"),m=(0,q.Z)(h,1)[0],v=[m,p],b="track-".concat(Date.now()),x="".concat(l,"_vs_").concat(m),k=n.assemblyManager.get(m),C=Fe(u,e.id(),s,l,!0),T=e.toJSON();T.clipPos=f,T.strand=1,T.mate={refName:l,start:f,end:f+De(i)};var M=Be(2048&o?C[0].CIGAR:i),P=[T].concat((0,S.Z)(C));P.forEach((function(e,t){e.refName=(null===k||void 0===k?void 0:k.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),P.sort((function(e,t){return e.clipPos-t.clipPos}));var R=e.get("seq"),A=P.concat(P.map((function(e){return e.mate}))),L=2*Z,N=P.reduce((function(e,t){return e+t.end-t.start+L}),0),j="".concat(l,"_").concat(Date.now()),F=(0,d.getConf)(k,"sequence"),I=ze(P.map((function(e){return(0,g.Z)((0,g.Z)({},e),{},{start:Math.max(0,e.start-Z),end:e.end+Z,assemblyName:m})})));n.addTemporaryAssembly({name:"".concat(p),sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:j,assemblyNames:[p],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:M,seq:R||"",refName:l,uniqueId:"".concat(Math.random())}]}}}),n.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:N/a.width,displayedRegions:I,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[m],configuration:F.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(j,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:M/a.width,displayedRegions:[{assemblyName:p,start:0,end:M,refName:l}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:j,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(j,"-LinearReferenceSequenceDisplay")}]}]}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:v,adapter:{type:"FromConfigAdapter",features:A},trackId:b,name:x}],tracks:[{configuration:b,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(b,"-LinearSyntenyDisplay")}]}],displayName:"".concat(l," vs ").concat(m)}),r()}catch(B){console.error(B),y(B)}},children:"Submit"})]})]})}var We=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LinearComparativeViewPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){var t;!function(e){e.addViewType((function(){return new Z.Z({name:"LinearComparativeView",displayName:"Linear comparative view",stateModel:N(e),ReactComponent:(0,C.lazy)((function(){return n.e(7554).then(n.bind(n,47554))}))})}))}(e),function(e){e.addViewType((function(){return new Z.Z({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:xe(e),ReactComponent:(0,C.lazy)((function(){return Promise.all([n.e(2361),n.e(9116)]).then(n.bind(n,49116))}))})}))}(e),function(e){e.addDisplayType((function(){var t=f(e);return new l.Z({name:"LinearComparativeDisplay",configSchema:t,stateModel:k(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:function(){return null}})}))}(e),function(e){e.addDisplayType((function(){var t=j(e);return new l.Z({name:"LinearSyntenyDisplay",configSchema:t,stateModel:G(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:se})}))}(e),function(e){e.addDisplayType((function(){var t=ce(e),n=fe(t);return new l.Z({name:"LGVSyntenyDisplay",configSchema:t,stateModel:n,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:pe.qb})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a,i,o,s,c;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.views,a=t.tracks,i=void 0===a?[]:a,e.prev=1,o=n.assemblyManager,s=n.addView("LinearSyntenyView",{}),e.next=6,(0,T.when)((function(){return!!s.width}));case 6:return e.t0=s,e.next=9,Promise.all(r.map(function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.waitForAssembly(t.assembly);case 2:if(n=e.sent){e.next=5;break}throw new Error("Assembly ".concat(t.assembly," failed to load"));case 5:return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:n.regions});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),e.next=13,Promise.all(s.views.map((function(e){return(0,T.when)((function(){return e.initialized}))})));case 13:return c=[],e.next=16,Promise.all(r.map(function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t,n){var r,a,i,o;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.views[n],a=t.loc,i=t.tracks,o=void 0===i?[]:i,e.next=4,r.navToLocString(a);case 4:o.forEach((function(e){return we(r,e,c)}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 16:if(i.forEach((function(e){return we(s,e,c)})),!c.length){e.next=19;break}throw new Error("Could not resolve identifiers: ".concat(c.join(",")));case 19:e.next=25;break;case 21:throw e.prev=21,e.t2=e.catch(1),n.notify("".concat(e.t2),"error"),e.t2;case 25:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t){return e.apply(this,arguments)}}())}(e),(t=e).addTrackType((function(){var e=Ce(t);return new ke.Z({name:"SyntenyTrack",configSchema:e,stateModel:(0,y.createBaseTrackModel)(t,"SyntenyTrack",e)})})),function(e){e.addWidgetType((function(){return new Ze.Z({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:Se,stateModel:Te,ReactComponent:(0,C.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(8227)]).then(n.bind(n,72e3))}))})}))}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",(function(e){return"LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature,r=(0,c.getContainingTrack)(e);return[].concat((0,S.Z)(t()),(0,S.Z)(n?[{label:"Linear read vs ref",icon:Me.Z,onClick:function(){(0,c.getSession)(e).queueDialog((function(e){return[Oe,{track:r,feature:n,handleClose:e}]}))}}]:[]))}}}}))),e}))}(e)}},{key:"configure",value:function(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:u.Z,onClick:function(e){e.addView("LinearSyntenyView",{})}})}}]),s}(s.Z)},64031:function(e,t,n){"use strict";n.d(t,{b0:function(){return c},n2:function(){return l},sh:function(){return u}});var r=n(33028),a=(n(96902),n(91188)),i=n(4782),o=n(29938),s=(0,a.ZL)()((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),c=(0,i.observer)((function(e){var t=e.block,n=e.children,r=s().classes,a=t.widthPx;return(0,o.jsx)("div",{style:{width:a},className:r.contentBlock,children:n})}));function u(e){var t=e.width,n=s().classes;return(0,o.jsx)("div",{className:n.elidedBlock,style:{width:t}})}function l(e){var t=e.boundary,n=e.width,a=e.style,i=void 0===a?{}:a,c=s().classes;return(0,o.jsx)("div",{style:(0,r.Z)((0,r.Z)({},i),{},{width:n}),className:t?c.boundaryPaddingBlock:c.interRegionPaddingBlock})}},54721:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return De}});var r=n(96902),a=n(6880),i=n(35388),o=n(44536),s=n(91188),c=n(23642),u=n(46186),l=n(4782),d=n(63680),f=n(69029),p=n(99836),h=n(97531),g=n(33028),m=n(68079),v=n(16644),y=n(25322),b=n(16151),x=n(46751),w=n(41874),k=n(38238),C=n(29926),Z=n(47057),S=n(21630),T=n(51467),M=n(29938),P=(0,s.ZL)()((function(e){return{root:{background:(0,v.Fq)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{pointerEvents:"none"},dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),R=r.forwardRef((function(e,t){var n,r=e.track,o=e.className,s=P(),c=s.classes,l=s.cx,d=(0,h.getContainingView)(r),f=(0,h.getSession)(r),v=r.configuration,R=r.minimized,A=(0,p.getConf)(r,"trackId"),L=(0,b.getTrackName)(v,f),N=(0,w.o_)({popupId:"trackLabelMenu",variant:"popover"}),j=[{label:R?"Restore track":"Minimize track",icon:R?T.Z:S.Z,onClick:function(){return r.setMinimized(!R)}}].concat((0,m.Z)((null===(n=f.getTrackActionMenuItems)||void 0===n?void 0:n.call(f,v))||[]),(0,m.Z)(r.trackMenuItems())).sort((function(e,t){return(t.priority||0)-(e.priority||0)}));return(0,M.jsxs)(a.Z,{ref:t,className:l(o,c.root),children:[(0,M.jsx)("span",{draggable:!0,className:c.dragHandle,onDragStart:function(e){var t=e.currentTarget;if(t.parentNode){var n=t.parentNode;e.dataTransfer.setDragImage(n,20,20),d.setDraggingTrackId(r.id)}},onDragEnd:function(){return d.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(d.id,"-").concat(A),children:(0,M.jsx)(C.Z,{className:c.dragHandleIcon,fontSize:"small"})}),(0,M.jsx)(y.Z,{onClick:function(){return d.hideTrack(A)},className:c.iconButton,title:"close this track",children:(0,M.jsx)(Z.Z,{fontSize:"small"})}),(0,M.jsx)(i.Z,{variant:"body1",component:"span",className:c.trackName,children:(0,M.jsx)(u.SanitizedHTML,{html:L+(R?" (minimized)":"")})}),(0,M.jsx)(y.Z,(0,g.Z)((0,g.Z)({},(0,w.vW)(N)),{},{className:c.iconButton,"data-testid":"track_menu_icon",disabled:!j.length,children:(0,M.jsx)(k.Z,{fontSize:"small"})})),(0,M.jsx)(x.Z,(0,g.Z)((0,g.Z)({},(0,w.ZW)(N)),{},{onMenuItemClick:function(e,t){return t()},menuItems:j,popupState:N}))]})})),A=(0,l.observer)(R),L=(0,s.ZL)()({root:{marginTop:2},resizeHandle:{height:3,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3},trackLabel:{zIndex:3},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}),N=(0,l.observer)((function(e){var t=e.model,n=e.view,r=L(),a=r.classes,i=r.cx,o=t.displays[0],s=a.trackLabel,c=a.trackLabelOverlap,u=a.trackLabelOffset,l="overlapping"!==n.trackLabels||o.prefersOffset?u:c;return"hidden"!==n.trackLabels?(0,M.jsx)(A,{track:t,className:i(s,l)}):null}));var j=(0,l.observer)((function(e){var t=e.model,n=e.track,i=L().classes,o=n.displays[0],s=t.horizontalScroll,c=t.draggingTrackId,l=t.moveTrack,g=o.height,m=o.RenderingComponent,v=o.DisplayBlurb,y=(0,p.getConf)(n,"trackId"),b=(0,r.useRef)(null),x=void 0!==c&&c!==o.id,w=n.minimized,k=(0,h.useDebouncedCallback)((function(){(0,d.isAlive)(o)&&x&&l(c,n.id)}),100);return(0,r.useEffect)((function(){return b.current&&(t.trackRefs[y]=b.current),function(){delete t.trackRefs[y]}}),[t.trackRefs,y]),(0,M.jsxs)(a.Z,{className:i.root,variant:"outlined",children:[(0,M.jsx)(N,{model:n,view:t}),(0,M.jsx)(f.ErrorBoundary,{FallbackComponent:function(e){var t=e.error;return(0,M.jsx)(u.ErrorMessage,{error:t})},children:(0,M.jsx)("div",{className:i.trackRenderingContainer,style:{height:w?20:g},onScroll:function(e){return o.setScrollTop(e.currentTarget.scrollTop)},onDragEnter:k,"data-testid":"trackRenderingContainer-".concat(t.id,"-").concat(y),children:w?null:(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{ref:b,className:i.renderingComponentContainer,style:{transform:"scaleX(".concat(t.scaleFactor,")")},children:(0,M.jsx)(m,{model:o,onHorizontalScroll:s})}),v?(0,M.jsx)("div",{style:{position:"absolute",left:0,top:o.height-20},children:(0,M.jsx)(v,{model:o})}):null]})})},n.id),(0,M.jsx)("div",{className:i.overlay,style:{height:o.height,background:x?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:k}),(0,M.jsx)(u.ResizeHandle,{onDrag:o.resizeHeight,className:i.resizeHandle})]})})),F=n(89743),I=n(96234),B=n(45298),D=n.n(B),E=n(36949);function V(e,t,n){var a=(0,r.useState)(),i=(0,I.Z)(a,2),o=i[0],s=i[1],c=(0,r.useState)(),u=(0,I.Z)(c,2),l=u[0],d=u[1],f=(0,r.useState)(),p=(0,I.Z)(f,2),h=p[0],g=p[1],m=(0,r.useState)(),v=(0,I.Z)(m,2),y=v[0],b=v[1],x=void 0!==o&&void 0===h;function w(t){if(!n||t.shiftKey){t.preventDefault(),t.stopPropagation();var r=(0,E.c6)(t,e.current);s(r),d(r)}}function k(t){n?t.shiftKey?b((0,E.c6)(t,e.current)):b(void 0):b((0,E.c6)(t,e.current))}function C(){b(void 0),t.setOffsets(void 0,void 0)}function Z(){g(void 0),s(void 0),d(void 0)}function S(e,t){t(),Z()}(0,r.useEffect)((function(){function n(t){if(e.current&&x){var n=(0,E.c6)(t,e.current);d(n)}}function r(n){if(void 0!==o&&e.current){var r=n.clientX,a=n.clientY,i=(0,E.c6)(n,e.current);g({offsetX:i,clientX:r,clientY:a});var s=function(e){if(void 0!==o){var n=Math.min(o,e),r=Math.max(o,e);return{leftOffset:t.pxToBp(n),rightOffset:t.pxToBp(r)}}}(i);s&&t.setOffsets(s.leftOffset,s.rightOffset),b(void 0)}}return x?(window.addEventListener("mousemove",n),window.addEventListener("mouseup",r),function(){window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",r)}):function(){}}),[o,x,h,t,e]),(0,r.useEffect)((function(){!x&&void 0!==l&&void 0!==o&&Math.abs(l-o)<=3&&Z()}),[x,l,o]);var T=Boolean(h);if(void 0===o)return{open:T,guideX:y,mouseDown:w,mouseMove:k,mouseOut:C,handleMenuItemClick:S};var M=h?h.offsetX:l||0,P=M<o?M:o,R=Math.abs(M-o);return{open:T,rubberbandOn:!0,mouseDown:w,mouseMove:k,mouseOut:C,handleClose:Z,handleMenuItemClick:S,leftBpOffset:t.pxToBp(P),rightBpOffset:t.pxToBp(P+R),anchorPosition:h,numOfBpSelected:Math.ceil(R*t.bpPerPx),width:R,left:P}}var z=n(50543),O=(0,s.ZL)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}});var W=(0,l.observer)((function(e){var t=e.model,n=e.coordX,r=O().classes;return(0,M.jsx)(z.Z,{open:!0,placement:"top",title:(0,h.stringify)(t.pxToBp(n)),arrow:!0,children:(0,M.jsx)("div",{className:r.guide,style:{left:n,background:"red"}})})})),H=n(81295),G=(0,s.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8}});var q=(0,l.observer)((function(e){var t=e.model,n=e.ControlComponent,a=void 0===n?(0,M.jsx)("div",{}):n,i=(0,r.useRef)(null),o=G().classes,s=V(i,t),c=s.guideX,l=s.rubberbandOn,d=s.leftBpOffset,f=s.rightBpOffset,p=s.numOfBpSelected,h=s.width,g=s.left,m=s.anchorPosition,v=s.handleMenuItemClick,y=s.open,b=s.handleClose,x=s.mouseMove,w=s.mouseDown,k=s.mouseOut;return(0,M.jsxs)(M.Fragment,{children:[void 0!==c?(0,M.jsx)(W,{model:t,coordX:c}):l?(0,M.jsx)(H.Z,{leftBpOffset:d,rightBpOffset:f,numOfBpSelected:p,width:h,left:g}):null,m?(0,M.jsx)(u.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:m.clientX,top:m.clientY},onMenuItemClick:v,open:y,onClose:b,menuItems:t.rubberBandMenuItems()}):null,(0,M.jsx)("div",{"data-testid":"rubberband_controls",className:o.rubberbandControl,ref:i,onMouseDown:w,onMouseMove:x,onMouseOut:k,children:a})]})})),U=n(59740),_=n(39926),J=n(64031),X=n(98018),Y=["model","style","className"],Q=(0,s.ZL)()((function(e){return{scalebarContainer:{overflow:"hidden",position:"relative"},scalebarZoomContainer:{position:"relative",zIndex:1},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),K=(0,l.observer)((function(e){var t=e.model,n=Q().classes,r=0;return t.staticBlocks.forEach((function(e,n){e.offsetPx-t.offsetPx<0&&(r=n)})),(0,M.jsx)(M.Fragment,{children:t.staticBlocks.map((function(e,a){return e instanceof _.b0&&(e.isLeftEndOfDisplayedRegion||a===r)?(0,M.jsx)(i.Z,{style:{left:a===r?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:a===r?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName),children:e.refName},"refLabel-".concat(e.key,"-").concat(a)):null}))})})),$=(0,l.observer)((function(e){var t=e.model,n=Q().classes,r=t.bpPerPx,a=t.staticBlocks;return(0,M.jsx)(M.Fragment,{children:a.map((function(e,t){var a=e.reversed,o=e.start,s=e.end,c=e.key,u=e.widthPx;if(e instanceof _.b0){var l=(0,X.C)(o,s,r,!0,!1);return(0,M.jsx)(J.b0,{block:e,children:l.map((function(e){if("major"===e.type){var t=(a?s-e.base:e.base-o)/r,c=e.base+1;return(0,M.jsx)("div",{className:n.tick,style:{left:t},children:c?(0,M.jsx)(i.Z,{className:n.majorTickLabel,children:(0,h.getTickDisplayStr)(c,r)}):null},e.base)}return null}))},"".concat(c,"-").concat(t))}return e instanceof _.sh?(0,M.jsx)(J.sh,{width:u},c):e instanceof _.n2?(0,M.jsx)(J.n2,{width:u,style:{background:"none"},boundary:"boundary"===e.variant},c):null}))})})),ee=r.forwardRef((function(e,t){var n=e.model,r=e.style,i=e.className,o=(0,U.Z)(e,Y),s=Q(),c=s.classes,u=s.cx,l=n.staticBlocks.offsetPx-n.offsetPx;return(0,M.jsxs)(a.Z,(0,g.Z)((0,g.Z)({"data-resizer":"true",className:u(c.scalebarContainer,i),variant:"outlined",ref:t,style:r},o),{},{children:[(0,M.jsx)("div",{className:c.scalebarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0},children:(0,M.jsx)("div",{className:c.scalebar,style:(0,g.Z)({left:l-1,width:n.staticBlocks.totalWidthPx},r),children:(0,M.jsx)($,{model:n})})}),(0,M.jsx)(K,{model:n})]}))})),te=(0,l.observer)(ee),ne=(0,s.ZL)()((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}}})),re=(0,l.observer)((function(e){var t=e.model,n=ne(),r=n.classes,a=n.cx;return(0,M.jsx)(M.Fragment,{children:t.staticBlocks.map((function(e,n){if(e instanceof _.b0){var i=(0,X.C)(e.start,e.end,t.bpPerPx);return(0,M.jsx)(J.b0,{block:e,children:i.map((function(n){var i=(e.reversed?e.end-n.base:n.base-e.start)/t.bpPerPx;return(0,M.jsx)("div",{className:a(r.tick,"major"===n.type||"labeledMajor"===n.type?r.majorTick:r.minorTick),style:{left:i}},n.base)}))},"".concat(e.key,"-").concat(n))}return e instanceof _.sh?(0,M.jsx)(J.sh,{width:e.widthPx},e.key):e instanceof _.n2?(0,M.jsx)(J.n2,{width:e.widthPx,boundary:"boundary"===e.variant},e.key):null}))})}));var ae=(0,l.observer)((function(e){var t=e.model,n=ne().classes,r=t.staticBlocks.offsetPx-t.offsetPx;return(0,M.jsx)("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0},children:(0,M.jsx)("div",{className:n.verticalGuidesContainer,style:{left:r,width:t.staticBlocks.totalWidthPx},children:(0,M.jsx)(re,{model:t})})})})),ie=(0,s.ZL)()((function(e){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px ".concat(e.palette.action.active," dashed"),borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));var oe=(0,l.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.centerLineInfo,i=t.trackHeights,o=t.tracks,s=t.width,c=(0,r.useRef)(null),u=ie().classes,l=s/2;return o.length?(0,M.jsx)("div",{"data-testid":"centerline_container",className:u.centerLineContainer,role:"presentation",ref:c,style:{left:"".concat(l,"px"),width:Math.max(1/n,1)},children:a&&(0,M.jsxs)("div",{"data-testid":"centerline_text",className:u.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:i},children:[a.refName,":"," ",Math.max(Math.round(a.offset)+1,0)]})}):null})),se=(0,s.ZL)()({tracksContainer:{position:"relative",overflow:"hidden"},spacer:{position:"relative",height:3}});var ce=(0,l.observer)((function(e){var t=e.children,n=e.model,a=se().classes,i=function(e){var t=(0,r.useState)(!1),n=(0,I.Z)(t,2),a=n[0],i=n[1],o=(0,r.useRef)(!1),s=(0,r.useRef)(0);return(0,r.useEffect)((function(){var t=function(){};function n(t){t.preventDefault();var n=t.clientX-s.current;n&&(o.current||(o.current=!0,window.requestAnimationFrame((function(){e.horizontalScroll(-n),o.current=!1,s.current=t.clientX}))))}function r(){s.current=0,a&&i(!1)}return a&&(window.addEventListener("mousemove",n,!0),window.addEventListener("mouseup",r,!0),t=function(){window.removeEventListener("mousemove",n,!0),window.removeEventListener("mouseup",r,!0)}),t}),[e,a,s]),{mouseDown:function(e){if(!e.shiftKey){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(s.current=e.clientX,i(!0))}},mouseUp:function(e){e.preventDefault(),i(!1)}}}(n),o=i.mouseDown,s=i.mouseUp,c=(0,r.useRef)(null),l=V(c,n,!0),d=l.guideX,f=l.rubberbandOn,p=l.leftBpOffset,h=l.rightBpOffset,g=l.numOfBpSelected,m=l.width,v=l.left,y=l.anchorPosition,b=l.handleMenuItemClick,x=l.open,w=l.handleClose,k=l.mouseMove,C=l.mouseDown;return function(e,t){var n=(0,r.useRef)(0),a=(0,r.useRef)(),i=(0,r.useRef)(!1);(0,r.useEffect)((function(){var r=e.current;function o(e){var r=D()(e);!0===e.ctrlKey?(e.preventDefault(),n.current+=r.pixelY/500,t.setScaleFactor(n.current<0?1-n.current:1/(1+n.current)),a.current&&clearTimeout(a.current),a.current=setTimeout((function(){t.setScaleFactor(1),t.zoomTo(n.current>0?t.bpPerPx*(1+n.current):t.bpPerPx/(1-n.current)),n.current=0}),300)):(Math.abs(r.pixelX)>Math.abs(2*r.pixelY)&&e.preventDefault(),n.current+=r.pixelX,i.current||(i.current=!0,window.requestAnimationFrame((function(){t.horizontalScroll(n.current),n.current=0,i.current=!1}))))}return r?(r.addEventListener("wheel",o),function(){r.removeEventListener("wheel",o)}):function(){}}),[t,e])}(c,n),(0,M.jsxs)("div",{ref:c,"data-testid":"trackContainer",className:a.tracksContainer,onMouseDown:function(e){o(e),C(e)},onMouseMove:k,onMouseUp:s,children:[n.showGridlines?(0,M.jsx)(ae,{model:n}):null,n.showCenterLine?(0,M.jsx)(oe,{model:n}):null,void 0!==d?(0,M.jsx)(W,{model:n,coordX:d}):f?(0,M.jsx)(H.Z,{leftBpOffset:p,rightBpOffset:h,numOfBpSelected:g,width:m,left:v}):null,y?(0,M.jsx)(u.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:y.clientX,top:y.clientY},onMenuItemClick:b,open:x,onClose:w,menuItems:n.rubberBandMenuItems()}):null,(0,M.jsx)(q,{model:n,ControlComponent:(0,M.jsx)(te,{model:n,style:{height:F.n8,boxSizing:"border-box"}})}),t]})})),ue=n(32723),le=n(34795),de=n(34592),fe=n(54417),pe=n(13655),he=n(78888),ge=n(34836),me=(0,r.lazy)((function(){return Promise.resolve().then(n.bind(n,97971))})),ve=(0,s.ZL)()((function(e){return{importFormContainer:{padding:e.spacing(2)},button:{margin:e.spacing(2)},container:{padding:e.spacing(4)}}})),ye=(0,l.observer)((function(e){var t,n=e.model,a=ve().classes,i=(0,h.getSession)(n),s=i.assemblyNames,c=i.assemblyManager,l=i.textSearchManager,d=n.rankSearchResults,f=n.isSearchDialogDisplayed,p=n.error,g=(0,r.useState)(s[0]),m=(0,I.Z)(g,2),v=m[0],y=m[1],b=(0,r.useState)(),x=(0,I.Z)(b,2),w=x[0],k=x[1],C=n.searchScope(v),S=c.get(v),T=s.length?null===S||void 0===S?void 0:S.error:"No configured assemblies",P=(null===S||void 0===S?void 0:S.regions)||[],R=T||p,A=(0,r.useState)(""),L=(0,I.Z)(A,2),N=L[0],j=L[1],F=null===(t=P[0])||void 0===t?void 0:t.refName;function B(e){return D.apply(this,arguments)}function D(){return D=(0,le.Z)((0,ue.Z)().mark((function e(t){var r,a;return(0,ue.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getLocation(),a=t.getTrackId(),!r){e.next=6;break}return e.next=5,n.navToLocString(r,v);case 5:a&&n.showTrack(a);case 6:case"end":return e.stop()}}),e)}))),D.apply(this,arguments)}function V(e){return z.apply(this,arguments)}function z(){return(z=(0,le.Z)((0,ue.Z)().mark((function e(t){var r,a,o,s,c,u,f;return(0,ue.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(null===w||void 0===w?void 0:w.getDisplayString())!==t||!w.hasLocation()){e.next=6;break}return e.next=4,B(w);case 4:e.next=31;break;case 6:if(null===w||void 0===w||null===(r=w.results)||void 0===r||!r.length){e.next=10;break}n.setSearchResults(w.results,w.getLabel()),e.next=31;break;case 10:if(a=(0,E.pG)(t,":"),o=(0,I.Z)(a,2),s=o[0],c=o[1],!((u=(null===S||void 0===S?void 0:S.allRefNamesWithLowerCase)||[]).includes(t)||u.includes(s)&&!Number.isNaN(parseInt(c,10)))){e.next=17;break}return e.next=15,n.navToLocString(t,v);case 15:e.next=31;break;case 17:return e.next=19,(0,E.kx)({queryString:t,searchType:"exact",searchScope:C,rankSearchResults:d,textSearchManager:l,assembly:S});case 19:if(!((f=e.sent).length>1)){e.next=24;break}n.setSearchResults(f,t.toLowerCase()),e.next=31;break;case 24:if(1!==f.length){e.next=29;break}return e.next=27,B(f[0]);case 27:e.next=31;break;case 29:return e.next=31,n.navToLocString(t,v);case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(0),console.error(e.t0),i.notify("".concat(e.t0),"warning");case 37:case"end":return e.stop()}}),e,null,[[0,33]])})))).apply(this,arguments)}return(0,r.useEffect)((function(){j(F)}),[F,v]),(0,M.jsxs)("div",{className:a.container,children:[R?(0,M.jsx)(u.ErrorMessage,{error:R}):null,(0,M.jsx)(de.Z,{className:a.importFormContainer,children:(0,M.jsx)("form",{onSubmit:function(){var e=(0,le.Z)((0,ue.Z)().mark((function e(t){return(0,ue.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n.setError(void 0),!N){e.next=5;break}return e.next=5,V(N);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:(0,M.jsxs)(fe.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,M.jsx)(fe.ZP,{item:!0,children:(0,M.jsx)(pe.Z,{children:(0,M.jsx)(u.AssemblySelector,{onChange:function(e){y(e),j("")},localStorageKey:"lgv",session:i,selected:v})})}),(0,M.jsx)(fe.ZP,{item:!0,children:v?T?(0,M.jsx)(Z.Z,{style:{color:"red"}}):N?(0,M.jsx)(pe.Z,{children:(0,M.jsx)(ge.Z,{fetchResults:function(e){return(0,E.kx)({queryString:e,assembly:S,textSearchManager:l,rankSearchResults:d,searchScope:C})},model:n,assemblyName:T?void 0:v,value:N,minWidth:270,onChange:function(e){return j(e)},onSelect:function(e){return k(e)},TextFieldProps:{variant:"outlined",helperText:"Enter sequence name, feature name, or location",style:{minWidth:"175px"}}})}):(0,M.jsx)(he.Z,{role:"progressbar",size:20,disableShrink:!0}):null}),(0,M.jsxs)(fe.ZP,{item:!0,children:[(0,M.jsx)(pe.Z,{children:(0,M.jsx)(o.Z,{type:"submit",disabled:!N,className:a.button,variant:"contained",color:"primary",children:"Open"})}),(0,M.jsx)(pe.Z,{children:(0,M.jsx)(o.Z,{disabled:!N,className:a.button,onClick:function(){n.setError(void 0),n.showAllRegionsInAssembly(v)},variant:"contained",color:"secondary",children:"Show all regions in assembly"})})]})]})})}),f?(0,M.jsx)(me,{model:n,optAssemblyName:v,handleClose:function(){return n.setSearchResults(void 0,void 0)}}):null]})})),be=ye,xe=n(52809),we=n(66519),ke=n(52),Ce=n(80367),Ze=n(32114),Se=n(99688),Te=n(64837),Me=n(21051),Pe=n.n(Me);var Re=n(14393),Ae=(0,s.ZL)()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}});function Le(e,t,n){return Ne.apply(this,arguments)}function Ne(){return(Ne=(0,le.Z)((0,ue.Z)().mark((function e(t,n,r){var a,i,o,s,c,u,l,d,f;return(0,ue.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,h.getSession)(t),i=t.leftOffset,o=t.rightOffset,i&&o){e.next=4;break}throw new Error("no offsets on model to use for range");case 4:if(i.assemblyName===o.assemblyName){e.next=6;break}throw new Error("not able to fetch sequences from multiple assemblies");case 6:if(s=a.rpcManager,c=a.assemblyManager,u=i.assemblyName||o.assemblyName||"",l=c.get(u)){e.next=11;break}throw new Error("assembly ".concat(u," not found"));case 11:return d=(0,p.getConf)(l,["sequence","adapter"]),f="getSequence",e.abrupt("return",s.call(f,"CoreGetFeatures",{adapterConfig:d,regions:n,sessionId:f,signal:r}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=(0,l.observer)((function(e){var t=e.model,n=e.handleClose,a=Ae().classes,s=(0,h.getSession)(t),l=(0,r.useState)(),d=(0,I.Z)(l,2),f=d[0],p=d[1],g=(0,r.useState)(),m=(0,I.Z)(g,2),v=m[0],y=m[1],b=(0,r.useState)(!1),x=(0,I.Z)(b,2),w=x[0],k=x[1],C=(0,r.useState)(!1),Z=(0,I.Z)(C,2),S=Z[0],T=Z[1],P=(0,r.useState)(!1),R=(0,I.Z)(P,2),A=R[0],L=R[1],N=t.leftOffset,j=t.rightOffset,F=Boolean(void 0===v),B=(0,r.useMemo)((function(){return t.getSelectedRegions(N,j)}),[t,N,j]);(0,r.useEffect)((function(){var e=!0,n=new AbortController;return(0,le.Z)((0,ue.Z)().mark((function r(){var a;return(0,ue.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(B.length>0)){r.next=8;break}return r.next=4,Le(t,B,n.signal);case 4:a=r.sent,e&&y(a),r.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),e&&p(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))(),function(){n.abort(),e=!1}}),[t,s,B]);var D=v?v.filter((function(e){return!!e})).map((function(e){var t,n=e.get("seq"),r=e.get("refName"),a=e.get("start")+1,i=e.get("end"),o="".concat(r,":").concat(a,"-").concat(i);if((null===(t=n)||void 0===t?void 0:t.length)!==i-a+1)throw new Error("".concat(o," returned ").concat(n.length.toLocaleString()," bases, but should have returned ").concat((i-a).toLocaleString()));return w&&(n=(0,h.reverse)(n)),A&&(n=(0,h.complement)(n)),{header:o+(w?"-rev":"")+(A?"-comp":""),seq:n}})).map((function(e){return">".concat(e.header,"\n").concat(e.seq.replace(/(.{1,80})/g,"$1\n").trimEnd())})).join("\n"):"",E=!!D&&D.length>1e6;return(0,M.jsxs)(u.Dialog,{maxWidth:"xl",open:!0,onClose:function(){n(),t.setOffsets(void 0,void 0)},title:"Reference sequence",children:[(0,M.jsxs)(xe.Z,{children:[f?(0,M.jsx)(i.Z,{color:"error",children:"".concat(f)}):F?(0,M.jsxs)(de.Z,{children:["Retrieving reference sequence...",(0,M.jsx)(he.Z,{style:{marginLeft:10},size:20,disableShrink:!0})]}):null,(0,M.jsx)(we.Z,{variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:E,className:a.dialogContent,fullWidth:!0,value:E?"Reference sequence too large to display, use the download FASTA button":D,InputProps:{readOnly:!0,classes:{input:a.textAreaFont}}}),(0,M.jsxs)(ke.Z,{children:[(0,M.jsx)(Ce.Z,{control:(0,M.jsx)(Ze.Z,{value:w,onChange:function(e){return k(e.target.checked)}}),label:"Reverse sequence"}),(0,M.jsx)(Ce.Z,{control:(0,M.jsx)(Ze.Z,{value:A,onChange:function(e){return L(e.target.checked)}}),label:"Complement sequence"})]}),(0,M.jsx)(i.Z,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),(0,M.jsxs)(Se.Z,{children:[(0,M.jsx)(o.Z,{onClick:function(){Pe()(D),T(!0),setTimeout((function(){return T(!1)}),500)},disabled:F||!!f||E,startIcon:(0,M.jsx)(c.pt,{}),children:S?"Copied":"Copy to clipboard"}),(0,M.jsx)(o.Z,{onClick:function(){(0,Te.saveAs)(new Blob([D||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:F||!!f,startIcon:(0,M.jsx)(Re.Z,{}),children:"Download FASTA"}),(0,M.jsx)(o.Z,{onClick:n,variant:"contained",children:"Close"})]})]})})),Fe=n(97971),Ie=(0,s.ZL)()((function(e){return{note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)}}})),Be=(0,l.observer)((function(e){var t=e.model,n=t.tracks,r=t.error,s=t.initialized,l=t.hasDisplayedRegions,d=Ie().classes;if(!s&&!r)return(0,M.jsx)(u.LoadingEllipses,{variant:"h5"});if(!l||r)return(0,M.jsx)(be,{model:t});var f=t.MiniControlsComponent(),p=t.HeaderComponent();return(0,M.jsxs)("div",{style:{position:"relative"},children:[t.seqDialogDisplayed?(0,M.jsx)(je,{model:t,handleClose:function(){return t.setGetSequenceDialogOpen(!1)}}):null,t.isSearchDialogDisplayed?(0,M.jsx)(Fe.default,{model:t,handleClose:function(){return t.setSearchResults(void 0,void 0)}}):null,(0,M.jsx)(p,{model:t}),(0,M.jsx)(f,{model:t}),(0,M.jsx)(ce,{model:t,children:n.length?n.map((function(e){return(0,M.jsx)(j,{model:t,track:e},e.id)})):(0,M.jsx)(a.Z,{variant:"outlined",className:d.note,children:t.hideNoTracksActive?(0,M.jsx)("div",{style:{height:"48px"}}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(i.Z,{children:"No tracks active."}),(0,M.jsx)(o.Z,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3},startIcon:(0,M.jsx)(c.GD,{}),children:"Open track selector"})]})})})]})})),De=Be},34836:function(e,t,n){"use strict";var r=n(68079),a=n(33028),i=n(32723),o=n(34795),s=n(96234),c=n(96902),u=n(4782),l=n(97531),d=n(17168),f=n(44164),p=n(66519),h=n(78888),g=n(5738),m=n(25322),v=n(27010),y=n(57900),b=n(29938),x=(0,c.lazy)((function(){return n.e(1335).then(n.bind(n,11335))}));t.Z=(0,u.observer)((function(e){var t=e.model,n=e.onSelect,u=e.assemblyName,w=e.style,k=e.fetchResults,C=e.onChange,Z=e.value,S=e.showHelp,T=void 0===S||S,M=e.minWidth,P=void 0===M?200:M,R=e.TextFieldProps,A=void 0===R?{}:R,L=(0,l.getSession)(t),N=L.assemblyManager,j=(0,c.useState)(!1),F=(0,s.Z)(j,2),I=F[0],B=F[1],D=(0,c.useState)(!0),E=(0,s.Z)(D,2),V=E[0],z=E[1],O=(0,c.useState)(!1),W=(0,s.Z)(O,2),H=W[0],G=W[1],q=(0,c.useState)(""),U=(0,s.Z)(q,2),_=U[0],J=U[1],X=(0,c.useState)(""),Y=(0,s.Z)(X,2),Q=Y[0],K=Y[1],$=(0,c.useState)(),ee=(0,s.Z)($,2),te=ee[0],ne=ee[1],re=(0,l.useDebounce)(_,300),ae=u?N.get(u):void 0,ie=t.coarseVisibleLocStrings,oe=t.hasDisplayedRegions,se=(null===ae||void 0===ae?void 0:ae.regions)||[],ce=(0,c.useMemo)((function(){return se.map((function(e){return{result:new d.R({refName:e.refName,label:e.refName,matchedAttribute:"refName"})}}))}),[se]);(0,c.useEffect)((function(){var e=!0;return(0,o.Z)((0,i.Z)().mark((function t(){var n,r,a,o,c,l;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,""!==re&&u){t.next=3;break}return t.abrupt("return");case 3:return z(!1),t.next=6,k(re);case 6:if(n=t.sent,e){for(r={},a=0;a<n.length;a++)o=n[a],c=o.getDisplayString(),r[c]||(r[c]=[]),r[c].push(o);l=Object.entries(r).map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return 1===r.length?{result:r[0]}:{result:new d.Z({displayString:n,results:r,label:n})}})),ne(l),z(!0)}t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e&&L.notify("".concat(t.t0),"error");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))(),function(){e=!1}}),[u,k,re,L,t]);var ue=ie||Z||"",le=Math.min(Math.max((0,l.measureText)(ue,16)+50,P),550);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Z,{id:"refNameAutocomplete-".concat(t.id),"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!u,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:(0,a.Z)((0,a.Z)({},w),{},{width:le}),value:ue,loading:!V,inputValue:Q,onInputChange:function(e,t){K(t),null===C||void 0===C||C(t)},loadingText:"loading results",open:I,onOpen:function(){return B(!0)},onClose:function(){B(!1),z(!0),oe&&(J(""),ne(void 0))},onChange:function(e,t){t&&u&&("string"===typeof t?null===n||void 0===n||n(new d.Z({label:t})):null===n||void 0===n||n(t.result),K(ue))},options:null!==te&&void 0!==te&&te.length?te:ce,getOptionDisabled:function(e){return"limitOption"===(null===e||void 0===e?void 0:e.group)},filterOptions:function(e,t){var n=function(e,t){return e.filter((function(e){var n=e.result;return n.getLabel().toLowerCase().includes(t)||n.matchedObject}))}(e,t.inputValue.toLocaleLowerCase());return[].concat((0,r.Z)(n.slice(0,100)),(0,r.Z)(n.length>100?[{group:"limitOption",result:new d.Z({label:"keep typing for more results"})}]:[]))},renderInput:function(e){var t=A.helperText,n=A.InputProps,r=void 0===n?{}:n;return(0,b.jsx)(p.Z,(0,a.Z)((0,a.Z)((0,a.Z)({onBlur:function(){return K(ue)}},e),A),{},{helperText:t,InputProps:(0,a.Z)((0,a.Z)((0,a.Z)({},e.InputProps),r),{},{endAdornment:(0,b.jsxs)(b.Fragment,{children:[0===se.length?(0,b.jsx)(h.Z,{color:"inherit",size:20}):(0,b.jsxs)(g.Z,{position:"end",style:{marginRight:7},children:[(0,b.jsx)(v.Z,{fontSize:"small"}),T?(0,b.jsx)(m.Z,{onClick:function(){return G(!0)},size:"small",children:(0,b.jsx)(y.Z,{fontSize:"small"})}):null]}),e.InputProps.endAdornment]})}),placeholder:"Search for location",onChange:function(e){return J(e.target.value)}}))},getOptionLabel:function(e){return("string"===typeof e?e:e.result.getDisplayString())||""}}),H?(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{}),children:(0,b.jsx)(x,{handleClose:function(){return G(!1)}})}):null]})}))},81295:function(e,t,n){"use strict";var r=n(96902),a=n(91188),i=n(16644),o=n(78566),s=n(35388),c=n(97531),u=n(29938),l=(0,a.ZL)()((function(e){var t=e.palette,n=t.primary,r=t.tertiary;return{rubberband:{height:"100%",background:r?(0,i.Fq)(r.light,.7):(0,i.Fq)(n.light,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:r?r.contrastText:n.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)}}}));t.Z=function(e){var t=e.leftBpOffset,n=e.rightBpOffset,a=e.numOfBpSelected,i=e.left,d=e.width,f=(0,r.useRef)(null),p=l().classes;return(0,u.jsxs)(u.Fragment,{children:[f.current?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(o.ZP,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:(0,u.jsx)(s.Z,{children:(0,c.stringify)(t)})}),(0,u.jsx)(o.ZP,{className:p.popover,classes:{paper:p.paper},open:!0,anchorEl:f.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:(0,u.jsx)(s.Z,{children:(0,c.stringify)(n)})})]}):null,(0,u.jsx)("div",{ref:f,className:p.rubberband,style:{left:i,width:d},children:a?(0,u.jsxs)(s.Z,{variant:"h6",className:p.rubberbandText,children:[(0,c.toLocale)(a)," bp"]}):null})]})}},97971:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(32723),a=n(34795),i=(n(96902),n(63680)),o=n(97531),s=n(46186),c=n(52809),u=n(35388),l=n(90322),d=n(6880),f=n(39275),p=n(5603),h=n(74194),g=n(27344),m=n(26074),v=n(44536),y=n(12546),b=n(99688),x=n(29938);function w(e){var t,n,w=e.model,k=e.optAssemblyName,C=e.handleClose,Z=(0,o.getSession)(w),S=(0,o.getEnv)(Z).pluginManager,T=Z.assemblyManager,M=k;w.displayedRegions.length>0&&(M=null===(n=w.displayedRegions[0])||void 0===n?void 0:n.assemblyName);if(!M)throw new Error("Assembly name not found");var P=T.get(M);if(!P)throw new Error("assembly ".concat(M," not found"));if(!P.regions)throw new Error("assembly ".concat(M," regions not loaded"));var R=P.regions;function A(e){return L.apply(this,arguments)}function L(){return(L=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n=R.find((function(e){return t===e.refName})))){e.next=7;break}w.setDisplayedRegions([n]),w.showAllRegions(),e.next=9;break;case 7:return e.next=9,w.navToLocString(t,M);case 9:e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.warn(e.t0),Z.notify("".concat(e.t0),"warning");case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function N(e){if(e){var t,n=S.pluggableConfigSchemaType("track"),r=(0,i.resolveIdentifier)(n,(0,i.getRoot)(w),e);return(null===r||void 0===r||null===(t=r.name)||void 0===t?void 0:t.value)||""}return""}return(0,x.jsxs)(s.Dialog,{open:!0,maxWidth:"xl",onClose:C,title:"Search results",children:[(0,x.jsx)(c.Z,{children:null!==(t=w.searchResults)&&void 0!==t&&t.length?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(u.Z,{children:["Showing results for ",(0,x.jsx)("b",{children:w.searchQuery})]}),(0,x.jsx)(l.Z,{component:d.Z,children:(0,x.jsxs)(f.Z,{children:[(0,x.jsx)(p.Z,{children:(0,x.jsxs)(h.Z,{children:[(0,x.jsx)(g.Z,{children:"Name"}),(0,x.jsx)(g.Z,{align:"right",children:"Location"}),(0,x.jsx)(g.Z,{align:"right",children:"Track"}),(0,x.jsx)(g.Z,{align:"right"})]})}),(0,x.jsx)(m.Z,{children:w.searchResults.map((function(e){return(0,x.jsxs)(h.Z,{children:[(0,x.jsx)(g.Z,{component:"th",scope:"row",children:e.getLabel()}),(0,x.jsx)(g.Z,{align:"right",children:e.getLocation()}),(0,x.jsx)(g.Z,{align:"right",children:N(e.getTrackId())||"N/A"}),(0,x.jsx)(g.Z,{align:"right",children:(0,x.jsx)(v.Z,{onClick:(0,a.Z)((0,r.Z)().mark((function t(){var n,a;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=e.getLocation())){t.next=7;break}return t.next=5,A(n);case 5:(a=e.getTrackId())&&w.showTrack(a);case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0),Z.notify("".concat(t.t0),"error");case 13:C();case 14:case"end":return t.stop()}}),t,null,[[0,9]])}))),color:"primary",variant:"contained",children:"Go"})})]},"".concat(e.getId()))}))})]})})]}):(0,x.jsxs)(u.Z,{children:["No results found for ",(0,x.jsx)("b",{children:w.searchQuery})]})}),(0,x.jsx)(y.Z,{}),(0,x.jsx)(b.Z,{children:(0,x.jsx)(v.Z,{onClick:function(){return C()},color:"primary",children:"Cancel"})})]})}},36949:function(e,t,n){"use strict";n.d(t,{c6:function(){return d},kx:function(){return c},pG:function(){return l},wo:function(){return f}});var r=n(32723),a=n(68079),i=n(34795),o=n(97531),s=n(17168);function c(e){return u.apply(this,arguments)}function u(){return(u=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i,c,u,l,d,f,p,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.queryString,c=t.searchType,u=t.searchScope,l=t.rankSearchResults,d=t.textSearchManager,f=t.assembly,d||console.warn("No text search manager"),e.next=4,null===d||void 0===d?void 0:d.search({queryString:i,searchType:c},u,l);case 4:return p=e.sent,h=null===f||void 0===f||null===(n=f.allRefNames)||void 0===n?void 0:n.filter((function(e){return e.toLowerCase().startsWith(i.toLowerCase())})).slice(0,10).map((function(e){return new s.Z({label:e})})),e.abrupt("return",(0,o.dedupe)([].concat((0,a.Z)(h||[]),(0,a.Z)(p||[])),(function(e){return e.getId()})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t){var n=e.lastIndexOf(t);return-1===n?[e,""]:[e.slice(0,n),e.slice(n+1)]}function d(e,t){return e.clientX-((null===t||void 0===t?void 0:t.getBoundingClientRect().left)||0)}function f(e,t){var n;return(null===e||void 0===e||null===(n=e.cytobands)||void 0===n?void 0:n.map((function(t){return{refName:e.getCanonicalRefName(t.get("refName")),start:t.get("start"),end:t.get("end"),type:t.get("type")}})).filter((function(e){return e.refName===t})))||[]}},89743:function(e,t,n){"use strict";n.d(t,{Od:function(){return et},VH:function(){return tt},I1:function(){return Qe.default},n8:function(){return nt},N_:function(){return it},Rj:function(){return Ce},EE:function(){return ot},FX:function(){return Ge},ZP:function(){return ct}});var r=n(96902),a=n(91271),i=n(41361),o=n(96234),s=n(32723),c=n(34795),u=n(68079),l=n(33028),d=n(99836),f=n(33991),p=n(42328),h=n(46186),g=n(97531),m=n(15276),v=n(25574),y=n(16151),b=n(75717),x=n(63680),w=n(30368),k=n(98103),C=n(64837),Z=n(73636),S=n.n(Z),T=n(23642),M=n(69498),P=n(42043),R=n(27690),A=n(93472),L=n(46255),N=n(96050),j=n(78933),F=n(30908),I=n(88636),B=n(68094),D=n(4782),E=n(98018),V=n(29938),z=(0,D.observer)((function(e){var t=e.start,n=e.end,r=e.bpPerPx,a=e.reversed,i=void 0!==a&&a,o=e.major,s=void 0===o||o,c=e.minor,u=void 0===c||c,l=(0,E.C)(t,n,r,s,u),d=(0,I.Z)();return(0,V.jsxs)(V.Fragment,{children:[l.map((function(e){var a=(i?n-e.base:e.base-t)/r;return(0,V.jsx)("line",{x1:a,x2:a,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:d.palette.divider,"data-bp":e.base},e.base)})),l.filter((function(e){return"major"===e.type})).map((function(e){var a=(i?n-e.base:e.base-t)/r;return(0,V.jsx)("text",{x:a-3,y:18,fontSize:11,fill:d.palette.text.primary,children:(0,g.getTickDisplayStr)(e.base+1,r)},"label-".concat(e.base))}))]})})),O=n(16644),W=n(35388),H=n(91188),G=n(39926),q=n(50543),U=n(81295),_=n(36949),J=(0,H.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}),X=(0,D.observer)((function(e){var t,n=e.model,r=e.open,a=e.guideX,i=e.overview,o=J().classes,s=n.cytobandOffset,c=(0,g.getSession)(n).assemblyManager,u=i.pxToBp(a-s),l=c.get(u.assemblyName),d=null===l||void 0===l||null===(t=l.cytobands)||void 0===t?void 0:t.find((function(e){return u.coord>e.get("start")&&u.coord<e.get("end")&&u.refName===l.getCanonicalRefName(e.get("refName"))}));return(0,V.jsx)(q.Z,{open:r,placement:"top",title:[(0,g.stringify)(u),null===d||void 0===d?void 0:d.get("name")].join(" "),arrow:!0,children:(0,V.jsx)("div",{className:o.guide,style:{left:a}})})}));var Y=(0,D.observer)((function(e){var t=e.model,n=e.overview,a=e.ControlComponent,i=void 0===a?(0,V.jsx)("div",{}):a,s=t.cytobandOffset,c=(0,r.useState)(),u=(0,o.Z)(c,2),l=u[0],d=u[1],f=(0,r.useState)(),p=(0,o.Z)(f,2),h=p[0],m=p[1],v=(0,r.useState)(),y=(0,o.Z)(v,2),b=y[0],x=y[1],w=(0,r.useRef)(null),k=J().classes,C=void 0!==l;function Z(e){e.preventDefault(),e.stopPropagation(),d((0,_.c6)(e,w.current))}function S(e){x((0,_.c6)(e,w.current))}function T(){x(void 0)}if((0,r.useEffect)((function(){function e(e){var t=w.current;t&&C&&m((0,_.c6)(e,t))}function r(){if(void 0!==l&&void 0!==h&&Math.abs(h-l)>3){var e=Math.min(l,h),r=Math.max(l,h);t.moveTo(n.pxToBp(e-s),n.pxToBp(r-s))}if(void 0!==l&&void 0===h){var a=n.pxToBp(l-s);a.refName?t.centerAt(Math.round(a.coord),a.refName,a.index):((0,g.getSession)(t).notify("unknown position clicked"),console.error("unknown position clicked",a))}d(void 0),m(void 0),void 0!==l&&x(void 0)}function a(e){"Escape"===e.key&&(d(void 0),m(void 0))}return C?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",r,!0),window.addEventListener("keydown",a,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",r,!0),window.removeEventListener("keydown",a,!0)}):function(){}}),[C,h,l,t,n,s]),void 0===l)return(0,V.jsxs)("div",{style:{position:"relative"},children:[void 0!==b?(0,V.jsx)(X,{model:t,open:!C,overview:n,guideX:b}):null,(0,V.jsx)("div",{className:k.rubberbandControl,role:"presentation",ref:w,onMouseDown:Z,onMouseOut:T,onMouseMove:S,children:i})]});var M,P,R=l||0,A=0;if(void 0!==l&&void 0!==h&&(R=h<l?h:l,A=h-l),l&&(M=n.pxToBp(l-s),P=n.pxToBp(l+A-s),h&&h<l)){var L=[P,M];M=L[0],P=L[1]}return(0,V.jsxs)("div",{style:{position:"relative"},children:[M&&P?(0,V.jsx)(U.Z,{leftBpOffset:M,rightBpOffset:P,width:A,left:R}):null,(0,V.jsx)("div",{"data-testid":"rubberband_controls",className:k.rubberbandControl,role:"presentation",ref:w,onMouseDown:Z,onMouseOut:T,onMouseMove:S,children:i})]})}));function Q(e,t,n,r,a){return"M"+e+","+t+"h"+(n-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-n)+"z"}var K={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},$=(0,D.observer)((function(e){var t=e.overview,n=e.block,r=e.assembly,a=n.offsetPx,i=n.reversed,s=(0,_.wo)(r,n.refName),c=s.map((function(e){var n=e.refName,r=e.start,a=e.end,i=e.type;return[t.bpToPx({refName:n,coord:r}),t.bpToPx({refName:n,coord:a}),i]})),u=s||[],l=i?u.length-1:0,d=i?0:u.length-1,f=!0;return(0,V.jsx)("g",{transform:"translate(-".concat(a,")"),children:c.map((function(e,t){var n,r,a,i,s,c=(0,o.Z)(e,3),u=c[0],p=c[1],h=c[2],g="".concat(u,"-").concat(p,"-").concat(h);return"acen"===h&&f?(f=!1,(0,V.jsx)("polygon",{points:[[u,0],[p,tt/2],[u,tt]].toString(),fill:K[h]},g)):"acen"!==h||f?l===t?(0,V.jsx)("path",{d:(n=Math.min(u,p),r=0,a=Math.abs(p-u),i=tt,s=8,"M"+(n+s)+","+r+"h"+(a-s)+"v"+i+"h"+(s-a)+"a"+s+","+s+" 0 0 1 "+-s+","+-s+"v"+(2*s-i)+"a"+s+","+s+" 0 0 1 "+s+","+-s+"z"),fill:K[h]},g):d===t?(0,V.jsx)("path",{d:Q(Math.min(u,p),0,Math.abs(p-u)-2,tt,8),fill:K[h]},g):(0,V.jsx)("rect",{x:Math.min(u,p),y:0,width:Math.abs(p-u),height:tt,fill:K[h]},g):(0,V.jsx)("polygon",{points:[[u,tt/2],[p,0],[p,tt]].toString(),fill:K[h]},g)}))})})),ee=2,te=(0,H.ZL)()((function(e){return{scalebar:{height:tt},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:tt},scalebarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='".concat(e.palette.divider,"'/%3E%3C/svg%3E\")"),backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='".concat(e.palette.divider,"'/%3E%3C/svg%3E\")"),backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarLabel:{height:tt,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scalebarVisibleRegion:{position:"absolute",height:tt,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:et,position:"relative"},overviewSvg:{width:"100%",position:"absolute"}}})),ne=(0,D.observer)((function(e){var t=e.model,n=e.overview,r=e.useOffset,a=void 0===r||r,i=(0,I.Z)(),o=Number(a),s=t.interRegionPaddingWidth,c=t.offsetPx,u=t.dynamicBlocks,d=t.cytobandOffset,f=u.contentBlocks,p=u.totalWidthPxWithoutBorders,h=i.palette,g=h.tertiary,m=h.primary,v=g?g.light:m.light;if(!f.length)return null;var y=f[0],b=f[f.length-1],x=(n.bpToPx((0,l.Z)((0,l.Z)({},y),{},{coord:y.reversed?y.end:y.start}))||0)+d*o,w=(n.bpToPx((0,l.Z)((0,l.Z)({},b),{},{coord:b.reversed?b.start:b.end}))||0)+d*o,k=Math.max(0,-c),C=k+p+f.length*s/2,Z=[[k,et],[C,et],[w,0],[x,0]];return(0,V.jsx)("polygon",{points:Z.toString(),fill:(0,O.Fq)(v,.3),stroke:(0,O.Fq)(v,.8)})})),re=(0,D.observer)((function(e){for(var t=e.scale,n=e.model,r=e.block,a=e.overview,i=te(),o=i.classes,s=i.cx,c=(0,I.Z)(),u=n.cytobandOffset,l=n.showCytobands,d=r.start,f=r.end,p=r.reversed,h=r.refName,m=r.assemblyName,v=(0,E._)(t,120,15).majorPitch,y=(0,g.getSession)(n).assemblyManager.get(m),b=null===y||void 0===y?void 0:y.getRefNameColor(h),x=[],w=0;w<Math.floor((f-d)/v);w++){var k=(w+1)*v;x.push(p?f-k:d+k)}var C=l&&(0,_.wo)(y,r.refName).length;return(0,V.jsxs)("div",{children:[(0,V.jsx)(W.Z,{style:{left:r.offsetPx+3,color:C?c.palette.primary.contrastText:b},className:o.scalebarRefName,children:h}),(0,V.jsxs)("div",{className:s(o.scalebarContig,C?void 0:p?o.scalebarContigReverse:o.scalebarContigForward,C?void 0:o.scalebarBorder),style:{left:r.offsetPx+u,width:r.widthPx,borderColor:b},children:[C?null:x.map((function(e,n){return(0,V.jsx)(W.Z,{className:o.scalebarLabel,variant:"body2",style:{left:(n+1)*v/t,pointerEvents:"none",color:b},children:(0,g.getTickDisplayStr)(e,a.bpPerPx)},"".concat(JSON.stringify(r),"-").concat(e,"-").concat(n))})),C?(0,V.jsx)("svg",{style:{width:"100%"},children:(0,V.jsx)($,{overview:a,assembly:y,block:r})}):null]})]})})),ae=(0,D.observer)((function(e){var t=e.model,n=e.scale,r=e.overview,a=te().classes,i=(0,I.Z)(),o=t.dynamicBlocks,s=t.showCytobands,c=t.cytobandOffset,u=o.contentBlocks,d=r.dynamicBlocks,f=i.palette,p=f.tertiary,h=f.primary,g=p?p.light:h.light;if(!u.length)return null;var m=u[0],v=r.bpToPx((0,l.Z)((0,l.Z)({},m),{},{coord:m.reversed?m.end:m.start}))||0,y=u[u.length-1],b=r.bpToPx((0,l.Z)((0,l.Z)({},y),{},{coord:y.reversed?y.start:y.end}))||0,x=s?"#f00":g,w=s?.1:.3;return(0,V.jsxs)("div",{className:a.scalebar,children:[(0,V.jsx)("div",{className:a.scalebarVisibleRegion,style:{width:b-v,left:v+c,background:(0,O.Fq)(x,w),borderColor:x}}),d.map((function(e,i){return e instanceof G.b0?(0,V.jsx)(re,{scale:n,block:e,model:t,overview:r},"".concat(JSON.stringify(e),"-").concat(i)):(0,V.jsx)("div",{className:a.scalebarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},"".concat(JSON.stringify(e),"-").concat(i))}))]})}));var ie=(0,D.observer)((function(e){var t=e.model,n=e.children,r=te().classes,a=t.totalBp,i=t.width,o=t.cytobandOffset,s=t.displayedRegions,c=w.Z.create({displayedRegions:JSON.parse(JSON.stringify(s)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),u=i-o;c.setVolatileWidth(u),c.showAllRegions();var l=a/(u-(s.length-1)*ee);return(0,V.jsxs)("div",{children:[(0,V.jsx)(Y,{model:t,overview:c,ControlComponent:(0,V.jsx)(ae,{model:t,overview:c,scale:l})}),(0,V.jsxs)("div",{className:r.overview,children:[(0,V.jsx)("svg",{height:et,className:r.overviewSvg,children:(0,V.jsx)(ne,{model:t,overview:c})}),n]})]})}));function oe(e){var t=e.model,n=e.fontSize,r=t.offsetPx,a=t.dynamicBlocks,i=a.totalWidthPxWithoutBorders,o=a.totalBp,s=(0,I.Z)(),c=(0,g.getBpDisplayStr)(o),u=Math.max(-r,0),l=u+i;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("line",{x1:u,x2:l,y1:10,y2:10,stroke:s.palette.text.secondary}),(0,V.jsx)("line",{x1:u,x2:u,y1:5,y2:15,stroke:s.palette.text.secondary}),(0,V.jsx)("line",{x1:l,x2:l,y1:5,y2:15,stroke:s.palette.text.secondary}),(0,V.jsx)("text",{x:u+(l-u)/2,y:2*n,textAnchor:"middle",fontSize:n,fill:s.palette.text.primary,children:c})]})}function se(e){var t=e.model,n=e.fontSize,r=e.width,a=t.dynamicBlocks.contentBlocks,i=t.offsetPx,o=t.bpPerPx,s=a.length<5,c=(0,I.Z)();return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("defs",{children:(0,V.jsx)("clipPath",{id:"clip-ruler",children:(0,V.jsx)("rect",{x:0,y:0,width:r,height:20})})}),a.map((function(e){var t=e.key,r=e.start,a=e.end,u=e.reversed,l=e.offsetPx,d=e.refName,f=l-i;return(0,V.jsxs)("g",{transform:"translate(".concat(f," 0)"),children:[(0,V.jsx)("text",{x:f/o,y:n,fontSize:n,fill:c.palette.text.primary,children:d}),s?(0,V.jsx)("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)",children:(0,V.jsx)(z,{start:r,end:a,bpPerPx:o,reversed:u})}):(0,V.jsx)("line",{strokeWidth:1,stroke:c.palette.text.secondary,x1:r/o,x2:a/o,y1:20,y2:20})]},"".concat(t))}))]})}var ce=15,ue=50,le=ce+5,de=20,fe=le+20,pe=100,he=function(e){return e.reduce((function(e,t){return e+t.displays[0].height+de+le}),0)},ge=function(e){var t=e.model,n=t.width,r=t.assemblyNames,a=t.showCytobands,i=t.displayedRegions,o=(0,g.getSession)(t).assemblyManager,s=r.length>1?"":r[0],c=o.get(s),u=(0,I.Z)(),d=w.Z.create({displayedRegions:JSON.parse(JSON.stringify(i)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),f=t.dynamicBlocks.contentBlocks;d.setVolatileWidth(n),d.showAllRegions();var p=d.dynamicBlocks.contentBlocks[0],h=f[0],m=d.bpToPx((0,l.Z)((0,l.Z)({},h),{},{coord:h.reversed?h.end:h.start}))||0,v=f[f.length-1],y=d.bpToPx((0,l.Z)((0,l.Z)({},v),{},{coord:v.reversed?v.start:v.end}))||0,b=a?pe:0;return(0,V.jsxs)("g",{id:"header",children:[(0,V.jsx)("text",{x:0,y:ce,fontSize:ce,fill:u.palette.text.primary,children:s}),a?(0,V.jsxs)("g",{transform:"translate(0 ".concat(ue,")"),children:[(0,V.jsx)($,{overview:d,assembly:c,block:p}),(0,V.jsx)("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(y-m,.5),height:tt-1,x:m,y:.5}),(0,V.jsx)("g",{transform:"translate(0,".concat(tt,")"),children:(0,V.jsx)(ne,{overview:d,model:t,useOffset:!1})})]}):null,(0,V.jsx)("g",{transform:"translate(0 ".concat(ce+b,")"),children:(0,V.jsx)(oe,{model:t,fontSize:ce})}),(0,V.jsx)("g",{transform:"translate(0 ".concat(ue+b,")"),children:(0,V.jsx)(se,{model:t,fontSize:ce,width:n})})]})},me=function(e){var t=e.model,n=e.height,r=t.dynamicBlocks,a=t.offsetPx,i=t.interRegionPaddingWidth;return(0,V.jsx)(V.Fragment,{children:r.contentBlocks.slice(1).map((function(e){return(0,V.jsx)("rect",{x:e.offsetPx-a-i,width:i,y:0,height:n,stroke:"none",fill:"grey"},e.key)}))})};function ve(e){var t=e.displayResults,n=e.model,r=e.offset,a=(0,I.Z)();return(0,V.jsx)(V.Fragment,{children:t.map((function(e){var t=e.track,i=e.result,o=r,s=(0,d.getConf)(t,"name")||"Reference sequence (".concat((0,d.readConfObject)((0,x.getParent)(t.configuration),"displayName")||(0,d.readConfObject)((0,x.getParent)(t.configuration),"name"),")"),c=t.displays[0];return r+=c.height+de+le,(0,V.jsxs)("g",{transform:"translate(0 ".concat(o,")"),children:[(0,V.jsx)("text",{fontSize:ce,x:Math.max(-n.offsetPx,0),fill:a.palette.text.primary,children:s}),(0,V.jsxs)("g",{transform:"translate(0 ".concat(le,")"),children:[i,(0,V.jsx)(me,{model:n,height:c.height})]})]},t.configuration.trackId)}))})}function ye(e){var t=e.width,n=e.height,r=e.shift,a=(0,I.Z)();return(0,V.jsx)("rect",{width:t+2*r,height:n,fill:a.palette.background.default})}function be(e,t){return xe.apply(this,arguments)}function xe(){return xe=(0,c.Z)((0,s.Z)().mark((function e(t,n){var r,a,i,o,u,l,d,f,p,m;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.when)((function(){return t.initialized}));case 2:return r=n.Wrapper,a=void 0===r?function(e){var t=e.children;return(0,V.jsx)(V.Fragment,{children:t})}:r,i=(0,g.getSession)(t),o=t.width,u=t.tracks,l=t.showCytobands,d=50,f=fe+ue+(l?pe:0)+20,p=he(u)+f,e.next=10,Promise.all(u.map(function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.displays[0],e.next=3,(0,b.when)((function(){return void 0===r.ready||r.ready}));case 3:return e.t0=t,e.next=6,r.renderSvg(n);case 6:return e.t1=e.sent,e.abrupt("return",{track:e.t0,result:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:return m=e.sent,e.abrupt("return",(0,F.renderToStaticMarkup)((0,V.jsx)(B.Z,{theme:(0,h.createJBrowseTheme)(i.theme),children:(0,V.jsx)(a,{children:(0,V.jsxs)("svg",{width:o,height:p,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,o+2*d,p].toString(),children:[(0,V.jsx)(ye,{width:o,height:p,shift:d}),(0,V.jsxs)("g",{stroke:"none",transform:"translate(".concat(d," ").concat(ce,")"),children:[(0,V.jsx)(ge,{model:t}),(0,V.jsx)(ve,{model:t,displayResults:m,offset:f})]})]})})})));case 12:case"end":return e.stop()}}),e)}))),xe.apply(this,arguments)}var we=n(34836),ke=(0,H.ZL)()((function(){return{headerRefName:{minWidth:100}}}));var Ce=(0,D.observer)((function(e){var t=e.model,n=e.showHelp,r=ke().classes,a=(0,I.Z)(),i=(0,g.getSession)(t),u=i.textSearchManager,l=i.assemblyManager,d=t.assemblyNames,f=t.rankSearchResults,p=d[0],h=l.get(p),m=t.searchScope(p);function v(e){return y.apply(this,arguments)}function y(){return(y=(0,c.Z)((0,s.Z)().mark((function e(n){var r,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getLocation(),a=n.getTrackId(),!r){e.next=6;break}return e.next=5,t.navToLocString(r,p);case 5:a&&t.showTrack(a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=(0,c.Z)((0,s.Z)().mark((function e(n){var r,a,c,l,d,g,y,b;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n.hasLocation()){e.next=6;break}return e.next=4,v(n);case 4:e.next=32;break;case 6:if(null===(r=n.results)||void 0===r||!r.length){e.next=10;break}t.setSearchResults(n.results,n.getLabel()),e.next=32;break;case 10:if(a=n.getLabel(),c=(0,_.pG)(a,":"),l=(0,o.Z)(c,2),d=l[0],g=l[1],!((y=(null===h||void 0===h?void 0:h.allRefNamesWithLowerCase)||[]).includes(a)||y.includes(d)&&!Number.isNaN(parseInt(g,10)))){e.next=18;break}return e.next=16,t.navToLocString(a,p);case 16:e.next=32;break;case 18:return e.next=20,(0,_.kx)({queryString:a,searchType:"exact",searchScope:m,rankSearchResults:f,textSearchManager:u,assembly:h});case 20:if(!((b=e.sent).length>1)){e.next=25;break}t.setSearchResults(b,a.toLowerCase()),e.next=32;break;case 25:if(1!==b.length){e.next=30;break}return e.next=28,v(b[0]);case 28:e.next=32;break;case 30:return e.next=32,t.navToLocString(a,p);case 32:e.next=38;break;case 34:e.prev=34,e.t0=e.catch(0),console.error(e.t0),i.notify("".concat(e.t0),"warning");case 38:case"end":return e.stop()}}),e,null,[[0,34]])})))).apply(this,arguments)}return(0,V.jsx)(we.Z,{showHelp:n,onSelect:function(e){return b.apply(this,arguments)},assemblyName:p,fetchResults:function(e){return(0,_.kx)({queryString:e,searchScope:m,rankSearchResults:f,textSearchManager:u,assembly:h})},model:t,TextFieldProps:{variant:"outlined",className:r.headerRefName,style:{margin:it,minWidth:"175px"},InputProps:{style:{padding:0,height:ot,background:(0,O.Fq)(a.palette.background.paper,.8)}}}})})),Ze=n(78888),Se=n(52809),Te=n(66519),Me=n(80367),Pe=n(32114),Re=n(99688),Ae=n(44536);function Le(){return(0,V.jsxs)("div",{children:[(0,V.jsx)(Ze.Z,{size:20,style:{marginRight:20}}),(0,V.jsx)(W.Z,{display:"inline",children:"Creating SVG"})]})}function Ne(e){var t=e.model,n=e.handleClose,a="undefined"!==typeof OffscreenCanvas,i=(0,r.useState)(a),u=(0,o.Z)(i,2),l=u[0],d=u[1],f=(0,r.useState)(!1),p=(0,o.Z)(f,2),g=p[0],m=p[1],v=(0,r.useState)("jbrowse.svg"),y=(0,o.Z)(v,2),b=y[0],x=y[1],w=(0,r.useState)(),k=(0,o.Z)(w,2),C=k[0],Z=k[1];return(0,V.jsxs)(h.Dialog,{open:!0,onClose:n,title:"Export SVG",children:[(0,V.jsxs)(Se.Z,{children:[C?(0,V.jsx)(h.ErrorMessage,{error:C}):g?(0,V.jsx)(Le,{}):null,(0,V.jsx)(Te.Z,{helperText:"filename",value:b,onChange:function(e){return x(e.target.value)}}),a?(0,V.jsx)(Me.Z,{control:(0,V.jsx)(Pe.Z,{checked:l,onChange:function(){return d((function(e){return!e}))}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):(0,V.jsx)(W.Z,{children:"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"})]}),(0,V.jsxs)(Re.Z,{children:[(0,V.jsx)(Ae.Z,{variant:"contained",color:"secondary",onClick:function(){return n()},children:"Cancel"}),(0,V.jsx)(Ae.Z,{variant:"contained",color:"primary",type:"submit",onClick:(0,c.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),Z(void 0),e.prev=2,e.next=5,t.exportSvg({rasterizeLayers:l,filename:b});case 5:n(),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),Z(e.t0),m(!1);case 13:case"end":return e.stop()}}),e,null,[[2,8]])}))),children:"Submit"})]})]})}var je=n(6880),Fe=n(25322),Ie=n(41590),Be=n(30156),De=n(48974),Ee=(0,D.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.maxBpPerPx,i=t.minBpPerPx,s=t.scaleFactor,c=t.hideHeader,u=(0,r.useState)(),l=(0,o.Z)(u,2),d=l[0],f=l[1];return c?(0,V.jsx)("div",{style:{position:"absolute",right:"0px",zIndex:"1001"},children:(0,V.jsxs)(je.Z,{style:{background:"#aaa7"},children:[(0,V.jsx)(Fe.Z,{onClick:function(e){return f(e.currentTarget)},children:(0,V.jsx)(De.Z,{fontSize:"small"})}),(0,V.jsx)(Fe.Z,{"data-testid":"zoom_out",onClick:function(){return t.zoom(2*n)},disabled:n>=a-1e-4||1!==s,children:(0,V.jsx)(Be.Z,{fontSize:"small"})}),(0,V.jsx)(Fe.Z,{"data-testid":"zoom_in",onClick:function(){return t.zoom(t.bpPerPx/2)},disabled:n<=i+1e-4||1!==s,children:(0,V.jsx)(N.Z,{fontSize:"small"})}),(0,V.jsx)(Ie.Z,{anchorEl:d,open:Boolean(d),onMenuItemClick:function(e,t){t(),f(void 0)},onClose:function(){return f(void 0)},menuItems:t.menuItems()})]})}):null})),Ve=n(52),ze=n(94175),Oe=n(14882),We=n(36050),He=(0,H.ZL)()((function(e){return{container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70,color:e.palette.text.secondary}}}));var Ge=(0,D.observer)((function(e){var t=e.model,n=He().classes,a=t.maxBpPerPx,i=t.minBpPerPx,s=t.bpPerPx,c=t.scaleFactor,u=(0,r.useState)(100*-Math.log2(s)),l=(0,o.Z)(u,2),d=l[0],f=l[1];return(0,r.useEffect)((function(){f(100*-Math.log2(s))}),[f,s]),(0,V.jsxs)("div",{className:n.container,children:[(0,V.jsx)(Fe.Z,{"data-testid":"zoom_out",onClick:function(){return t.zoom(2*s)},disabled:s>=a-1e-4||1!==c,size:"large",children:(0,V.jsx)(Be.Z,{})}),(0,V.jsx)(We.ZP,{size:"small",className:n.slider,value:d,min:100*-Math.log2(a),max:100*-Math.log2(i),onChange:function(e,t){return f(t)},onChangeCommitted:function(){return t.zoomTo(Math.pow(2,-d/100))},disabled:1!==c}),(0,V.jsx)(Fe.Z,{"data-testid":"zoom_in",onClick:function(){return t.zoom(t.bpPerPx/2)},disabled:s<=i+1e-4||1!==c,size:"large",children:(0,V.jsx)(N.Z,{})})]})})),qe=(0,H.ZL)()((function(e){return{headerBar:{height:et,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:(0,O.Fq)(e.palette.background.paper,.8),color:e.palette.text.primary,height:ot,margin:it},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),Ue=(0,D.observer)((function(e){var t=e.model,n=qe().classes;return(0,V.jsx)(Fe.Z,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",children:(0,V.jsx)(T.GD,{className:n.buttonSpacer})})}));function _e(e){var t=e.model,n=qe().classes;return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(Ae.Z,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)},children:(0,V.jsx)(Oe.Z,{})}),(0,V.jsx)(Ae.Z,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)},children:(0,V.jsx)(ze.Z,{})})]})}var Je=(0,D.observer)((function(e){var t=e.model,n=qe().classes,r=t.coarseTotalBp;return(0,V.jsx)(W.Z,{variant:"body2",color:"textSecondary",className:n.bp,children:(0,g.getBpDisplayStr)(r)})})),Xe=function(e){var t=e.model,n=qe().classes;return(0,V.jsxs)("div",{className:n.headerBar,children:[(0,V.jsx)(Ue,{model:t}),(0,V.jsx)("div",{className:n.spacer}),(0,V.jsxs)(Ve.Z,{row:!0,className:n.headerForm,children:[(0,V.jsx)(_e,{model:t}),(0,V.jsx)(Ce,{model:t})]}),(0,V.jsx)(Je,{model:t}),(0,V.jsx)(Ge,{model:t}),(0,V.jsx)("div",{className:n.spacer})]})},Ye=(0,D.observer)((function(e){var t=e.model;return t.hideHeader?null:t.hideHeaderOverview?(0,V.jsx)(Xe,{model:t}):(0,V.jsx)(ie,{model:t,children:(0,V.jsx)(Xe,{model:t})})})),Qe=n(54721),Ke=(0,r.lazy)((function(){return n.e(1241).then(n.bind(n,91241))}));function $e(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return(0,g.assembleLocString)((0,l.Z)((0,l.Z)({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(" ")}var et=48,tt=20,nt=17,rt=3,at=2,it=7,ot=32;function st(e){return x.types.compose(f.BaseViewModel,x.types.model("LinearGenomeView",{id:p.ElementId,type:x.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:x.types.array(p.Region),tracks:x.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:x.types.optional(x.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:x.types.optional(x.types.string,(function(){return(0,g.localStorageGetItem)("lgv-trackLabels")||"overlapping"})),showCenterLine:x.types.optional(x.types.boolean,(function(){return Boolean(JSON.parse((0,g.localStorageGetItem)("lgv-showCenterLine")||"false"))})),showCytobandsSetting:x.types.optional(x.types.boolean,(function(){return Boolean(JSON.parse((0,g.localStorageGetItem)("lgv-showCytobands")||"true"))})),showGridlines:!0})).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,searchResults:void 0,searchQuery:void 0,seqDialogDisplayed:!1}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return at},get assemblyNames(){return(0,u.Z)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))}}})).views((function(e){return{MiniControlsComponent:function(){return Ee},HeaderComponent:function(){return Ye},get assemblyErrors(){var t=(0,g.getSession)(e).assemblyManager;return e.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=(0,g.getSession)(e).assemblyManager;return e.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSearchDialogDisplayed(){return void 0!==e.searchResults},get scaleBarHeight(){return nt+rt},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?et:et+tt},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*rt},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return e.displayedRegions.reduce((function(e,t){return e+t.end-t.start}),0)},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:function(){return(0,l.Z)((0,l.Z)({},(0,y.getParentRenderProps)(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:(0,d.getConf)((0,g.getSession)(e),"highResolutionScaling")})},searchScope:function(t){return{assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rankSearchResults:function(t){var n=e.tracks.map((function(e){return e.configuration.trackId}));return t.forEach((function(e){n.includes(e.trackId)&&e.updateScore(e.getScore()+1)})),t},rewriteOnClicks:function(t,n){var r=this;n.forEach((function(n){if("subMenu"in n&&r.rewriteOnClicks(t,n.subMenu),"onClick"in n){var a=n.onClick;n.onClick=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.tracks.forEach((function(e){e.type===t&&a.apply(e,[e].concat(r))}))}}}))},get trackTypeActions(){var t=this,n=new Map;return e.tracks.forEach((function(e){if(!n.get(e.type)){var r=S()(e.viewMenuActions);t.rewriteOnClicks(e.type,r),n.set(e.type,r)}})),n}}})).actions((function(t){return{setShowCytobands:function(e){t.showCytobandsSetting=e},setWidth:function(e){t.volatileWidth=e},setError:function(e){t.volatileError=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},toggleNoTracksActive:function(){t.hideNoTracksActive=!t.hideNoTracksActive},toggleShowGridlines:function(){t.showGridlines=!t.showGridlines},scrollTo:function(e){var n=(0,g.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo:function(e){var n=(0,g.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;var r=t.bpPerPx;if(t.bpPerPx=n,Math.abs(r-n)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),r;var a=t.width;return this.scrollTo(Math.round((t.offsetPx+a/2)*r/n-a/2)),n},setOffsets:function(e,n){t.leftOffset=e,t.rightOffset=n},setSearchResults:function(e,n){t.searchResults=e,t.searchQuery=n},setGetSequenceDialogOpen:function(e){t.seqDialogDisplayed=e},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=(0,x.cast)(t.displayedRegions.slice().reverse().map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.pluggableConfigSchemaType("track"),o=(0,x.resolveIdentifier)(i,(0,x.getRoot)(t),n);if(!o)throw new Error('Could not resolve identifier "'.concat(n,'"'));var s=e.getTrackType(null===o||void 0===o?void 0:o.type);if(!s)throw new Error("Unknown track type ".concat(o.type));var c=e.getViewType(t.type).displayTypes.map((function(e){return e.name})),u=o.displays.find((function(e){return c.includes(e.type)}));if(!u)throw new Error("Could not find a compatible display for view type ".concat(t.type));var d=t.tracks.filter((function(e){return e.configuration===o}));if(0===d.length){var f=s.stateModel.create((0,l.Z)((0,l.Z)({},r),{},{type:o.type,configuration:o,displays:[(0,l.Z)({type:u.type,configuration:u},a)]}));return t.tracks.push(f),f}return d[0]},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,x.resolveIdentifier)(r,(0,x.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,b.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length}}})).actions((function(e){return{moveTrack:function(t,n){var r=e.tracks.findIndex((function(e){return e.id===t}));if(-1===r)throw new Error("Track ID ".concat(t," not found"));var a=e.tracks.findIndex((function(e){return e.id===n}));if(-1===a)throw new Error("Track ID ".concat(n," not found"));var i=(0,x.getSnapshot)(e.tracks[r]);e.tracks.splice(r,1),e.tracks.splice(a,0,i)},closeView:function(){var t=(0,g.getContainingView)(e);t?(0,g.isViewContainer)(t)&&t.removeView(e):(0,g.getSession)(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions:function(t){e.displayedRegions=(0,x.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=(0,g.getSession)(e);if((0,g.isSessionModelWithWidgets)(t)){var n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},getSelectedRegions:function(t,n){var r=(0,x.getSnapshot)(e),a=w.Z.create((0,l.Z)((0,l.Z)({},r),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return a.setVolatileWidth(e.width),a.moveTo(t,n),a.dynamicBlocks.contentBlocks.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll:function(t){var n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},center:function(){var t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var n=(0,g.getSession)(e),r=n.assemblyManager;if(!t){var a=new Set(e.displayedRegions.map((function(e){return e.assemblyName})));if(a.size>1)return void n.notify("Can't perform operation with multiple assemblies currently");t=(0,u.Z)(a)[0]}var i=r.get(t);if(i){var o=i.regions;o&&(this.setDisplayedRegions(o),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t},clearView:function(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},exportSvg:function(){var t=arguments;return(0,c.Z)((0,s.Z)().mark((function n(){var r,a,i;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},n.next=3,be(e,r);case 3:a=n.sent,i=new Blob([a],{type:"image/svg+xml"}),(0,C.saveAs)(i,r.filename||"image.svg");case 6:case"end":return n.stop()}}),n)})))()}}})).actions((function(e){var t=function(){};return{slide:function(n){var r=(0,g.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo),a=(0,o.Z)(r,2),i=a[0],s=a[1];t(),t=s,i()}}})).actions((function(e){var t=function(){};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),!(n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var r=e.bpPerPx/n,a=(0,g.springAnimate)(1,r,e.setScaleFactor,(function(){e.zoomTo(n),e.setScaleFactor(1)})),i=(0,o.Z)(a,2),s=i[0],c=i[1];t(),t=c,s()}}}})).views((function(e){return{get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){var t=(0,g.getSession)(e).assemblyManager;return e.assemblyNames.some((function(e){var n,r;return null===(n=t.get(e))||void 0===n||null===(r=n.cytobands)||void 0===r?void 0:r.length}))},get cytobandOffset(){return this.showCytobands?(0,g.measureText)(e.displayedRegions[0].refName,12)+15:0}}})).views((function(e){return{menuItems:function(){var t,n=e.canShowCytobands,r=e.showCytobands,a=(0,g.getSession)(e),s=[{label:"Return to import form",onClick:function(){(0,g.getSession)(e).queueDialog((function(t){return[h.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:A.Z}].concat((0,u.Z)((0,g.isSessionWithAddTracks)(a)?[{label:"Sequence search",onClick:function(){(0,g.getSession)(e).queueDialog((function(t){return[Ke,{model:e,handleClose:t}]}))}}]:[]),[{label:"Export SVG",icon:L.Z,onClick:function(){(0,g.getSession)(e).queueDialog((function(t){return[Ne,{model:e,handleClose:t}]}))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:T.GD},{label:"Horizontally flip",icon:M.Z,onClick:e.horizontallyFlip},{label:"Show...",icon:P.Z,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:e.toggleNoTracksActive},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:e.toggleShowGridlines}].concat((0,u.Z)(n?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:function(){return e.setShowCytobands(!r)}}]:[]))},{label:"Track labels",icon:R.Z,subMenu:[{label:"Overlapping",icon:P.Z,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:P.Z,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:P.Z,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}]),c=(0,i.Z)(e.trackTypeActions.entries());try{for(c.s();!(t=c.n()).done;){var l=(0,o.Z)(t.value,2),d=l[0],f=l[1];f.length&&(s.push({type:"divider"},{type:"subHeader",label:d}),f.forEach((function(e){return s.push(e)})))}}catch(p){c.e(p)}finally{c.f()}return s}}})).views((function(e){var t,n="";return{get staticBlocks(){var r=(0,v.Z)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return(0,m.Z)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((function(e){return(0,l.Z)((0,l.Z)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},get visibleLocStrings(){return $e(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return $e(e.coarseDynamicBlocks)}}})).actions((function(e){return{setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;(0,x.addDisposer)(e,(0,b.autorun)((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150})),(0,x.addDisposer)(e,(0,b.autorun)((function(){var t=function(e){return JSON.stringify(e)},n=e.trackLabels,r=e.showCytobandsSetting,a=e.showCenterLine;"undefined"!==typeof localStorage&&(localStorage.setItem("lgv-trackLabels",n),localStorage.setItem("lgv-showCytobands",t(r)),localStorage.setItem("lgv-showCenterLine",t(a)))})))}}})).actions((function(e){return{moveTo:function(t,n){(0,k.Ao)(e,t,n)},navToLocString:function(t,n){var r=this;return(0,c.Z)((0,s.Z)().mark((function a(){var i,u,d,f,p,h,m,v,y,x,w,k,C,Z,S,T,M;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=e.assemblyNames,d=(0,g.getSession)(e),f=d.assemblyManager,p=f.isValidRefName,a.next=5,(0,b.when)((function(){return void 0!==e.volatileWidth}));case 5:if(h=n||u[0],v=t.split(/(\s+)/).map((function(e){return e.trim()})).filter((function(e){return!!e})),!h){a.next=10;break}return a.next=10,f.waitForAssembly(h);case 10:a.prev=10,m=v.map((function(e){return(0,g.parseLocString)(e,(function(e){return p(e,h)}))})),a.next=22;break;case 14:if(a.prev=14,a.t0=a.catch(10),y=(0,o.Z)(v,3),x=y[0],w=y[1],k=y[2],!("".concat(a.t0).match(/Unknown reference sequence/)&&Number.isInteger(+w)&&Number.isInteger(+k))){a.next=21;break}m=[(0,g.parseLocString)(x+":"+w+".."+k,(function(e){return p(e,h)}))],a.next=22;break;case 21:throw a.t0;case 22:return a.next=24,Promise.all(null===(i=m)||void 0===i?void 0:i.map(function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var n,r,a,i,o,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.assemblyName||h,e.next=3,f.waitForAssembly(n);case 3:if(r=e.sent,a=t.refName,r){e.next=7;break}throw new Error("assembly ".concat(n," not found"));case 7:if(i=r.regions){e.next=10;break}throw new Error("regions not loaded yet for ".concat(n));case 10:if(o=r.getCanonicalRefName(t.refName)){e.next=13;break}throw new Error("Could not find refName ".concat(a," in ").concat(r.name));case 13:if(c=i.find((function(e){return e.refName===o}))){e.next=16;break}throw new Error("Could not find refName ".concat(a," in ").concat(n));case 16:return e.abrupt("return",(0,l.Z)((0,l.Z)({},t),{},{assemblyName:n,parentRegion:c}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:1===(C=a.sent).length?(Z=C[0],e.setDisplayedRegions([(0,l.Z)({reversed:Z.reversed},Z.parentRegion)]),S=Z.start,T=Z.end,M=Z.parentRegion,r.navTo((0,l.Z)((0,l.Z)({},Z),{},{start:(0,g.clamp)(null!==S&&void 0!==S?S:0,0,M.end),end:(0,g.clamp)(null!==T&&void 0!==T?T:M.end,0,M.end)}))):(e.setDisplayedRegions(C.map((function(e){return void 0===e.start?e.parentRegion:e}))),e.showAllRegions());case 26:case"end":return a.stop()}}),a,null,[[10,14]])})))()},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var n=t[0],r=n.refName,a=n.start,i=n.end,o=n.assemblyName,s=void 0===o?e.assemblyNames[0]:o;if(void 0!==a&&void 0!==i&&a>i)throw new Error('start "'.concat(a+1,'" is greater than end "').concat(i,'"'));var c=(0,g.getSession)(e).assemblyManager.get(s);if(c){var u=c.getCanonicalRefName(r);u&&(r=u)}for(var l,d=a,f=i,p=!1,h=function(e){if(r===e.refName){if(p=!0,void 0===d&&(d=e.start),void 0===f&&(f=e.end),d>=e.start&&d<=e.end&&f<=e.end&&f>=e.start)return!0;d=a,f=i}return!1},m=(0,g.findLastIndex)(e.displayedRegions,h);l!==m;)try{var v=l;if(l=e.displayedRegions.slice(void 0===v?0:v+1).findIndex(h),void 0!==v&&(l+=v+1),!p)throw new Error('could not find a region with refName "'.concat(r,'"'));if(void 0===d)throw new Error('could not find a region with refName "'.concat(r,'" that contained an end position ').concat(f));if(void 0===f)throw new Error('could not find a region with refName "'.concat(r,'" that contained a start position ').concat(d+1));if(-1===l)throw new Error('could not find a region that completely contained "'.concat((0,g.assembleLocString)(n),'"'));if(1===t.length){var y=e.displayedRegions[l];return void this.moveTo({index:l,offset:y.reversed?y.end-f:d-y.start},{index:l,offset:y.reversed?y.end-d:f-y.start})}for(var b=0,x=0,w=0;b<t.length;b++){var k=t[b],C=e.displayedRegions[l+b];if(x=k.start||C.start,w=k.end||C.end,k.refName!==C.refName)throw new Error("Entered location ".concat((0,g.assembleLocString)(k)," does not match with displayed regions"))}b-=1;var Z=e.displayedRegions[l],S=e.displayedRegions[l+b];return void this.moveTo({index:l,offset:Z.reversed?Z.end-f:d-Z.start},{index:l+b,offset:S.reversed?S.end-x:w-S.start})}catch(T){if(l===m)throw T}}}})).views((function(e){return{rubberBandMenuItems:function(){return[{label:"Zoom to region",icon:N.Z,onClick:function(){var t=e.leftOffset,n=e.rightOffset;e.moveTo(t,n)}},{label:"Get sequence",icon:j.Z,onClick:function(){return e.setGetSequenceDialogOpen(!0)}}]},bpToPx:function(t){var n=t.refName,r=t.coord,a=t.regionNumber;return(0,k.R)({refName:n,coord:r,regionNumber:a,self:e})},centerAt:function(t,n,r){var a=this.bpToPx({refName:n,coord:t,regionNumber:r});a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:function(t){return(0,k.j4)(e,t)},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}}))}var ct=function(e){e.addViewType((function(){return new a.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:st(e),ReactComponent:(0,r.lazy)((function(){return Promise.resolve().then(n.bind(n,54721))}))})}))}},98018:function(e,t,n){"use strict";function r(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),i=Math.pow(10,a);i<r&&!((i*=2)>=r);)i*=2.5;var o=(i=Math.max(i,5))/e,s=0;return!(i%10)&&o/10>=n?s=i/10:!(i%5)&&o/5>=n?s=i/5:!(i%2)&&o/2>=n&&(s=i/2),{majorPitch:i,minorPitch:s}}function a(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=r(n,60,15),s=e,c=t;if(null===s||null===c)return[];if(n<0){var u=[c,s];s=u[0],c=u[1]}s-=Math.abs(20*n)-1,c+=Math.abs(20*n)+1;for(var l=o.minorPitch||o.majorPitch,d=0,f=[],p=Math.ceil(s/l)*l;p<c;p+=l)i&&p%(2*o.majorPitch)?(f.push({type:"minor",base:p-1,index:d}),d+=1):!a||p%(2*o.majorPitch)||(f.push({type:"major",base:p-1,index:d}),d+=1);return f}n.d(t,{C:function(){return a},_:function(){return r}})},92777:function(e,t,n){"use strict";n.d(t,{fV:function(){return pe},qb:function(){return Y},rK:function(){return W},Rj:function(){return ye.Rj},fU:function(){return d},ZP:function(){return Se},RH:function(){return be},l0:function(){return ke}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(97531),u=n(40283),l=n(99836);var d=(0,l.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"}},{explicitIdentifier:"displayId"}),f=n(59740),p=n(32723),h=n(34795),g=n(68079),m=n(33028),v=n(41361),y=n(96902),b=n(33991),x=function(e){function t(e){(0,r.Z)(this,t),this.submaps=e}return(0,a.Z)(t,[{key:"has",value:function(e){var t,n=(0,v.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){if(t.value.has(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"get",value:function(e){var t,n=(0,v.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.has(e))return r.get(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"values",value:(0,p.Z)().mark((function e(){var t,n,r;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,v.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,this.get(r);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"keys",value:(0,p.Z)().mark((function(){var e,t,n,r,a,i,o,s,c,u;return(0,p.Z)().wrap((function(l){for(;;)switch(l.prev=l.next){case 0:e=new Set,t=(0,v.Z)(this.submaps.values());try{for(t.s();!(n=t.n()).done;){r=n.value,a=(0,v.Z)(r.keys());try{for(a.s();!(i=a.n()).done;)o=i.value,e.add(o)}catch(d){a.e(d)}finally{a.f()}}}catch(d){t.e(d)}finally{t.f()}s=(0,v.Z)(e),l.prev=4,s.s();case 6:if((c=s.n()).done){l.next=12;break}return u=c.value,l.next=10,u;case 10:l.next=6;break;case 12:l.next=17;break;case 14:l.prev=14,l.t0=l.catch(4),s.e(l.t0);case 17:return l.prev=17,s.f(),l.finish(17);case 20:case"end":return l.stop()}}),e,this,[[4,14,17,20]])}))},{key:"find",value:function(e){var t,n=(0,v.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=(0,v.Z)(a.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(e(o))return o}}catch(s){i.e(s)}finally{i.f()}}}catch(s){n.e(s)}finally{n.f()}}},{key:e,value:(0,p.Z)().mark((function e(){var t,n,r;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,v.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"entries",value:(0,p.Z)().mark((function e(){var t,n,r;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,v.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))}]),t}(Symbol.iterator),w=n(16151),k=n(75717),C=n(63680),Z=n(78933),S=n(96234),T=n(4782),M=n(88636),P=n(91188),R=n(46186),A=n(16644),L=n(60131),N=n(61291),j=n(29938);var F=(0,P.ZL)()((function(e){return{tooltip:{pointerEvents:"none",backgroundColor:(0,A.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"}};var t})),I=y.forwardRef((function(e,t){var n=e.message;return(0,j.jsx)("div",{ref:t,children:y.isValidElement(n)?n:n?(0,j.jsx)(R.SanitizedHTML,{html:String(n)}):null})})),B=(0,T.observer)((function(e){var t=e.model,n=e.clientMouseCoord,r=F().classes,a=t.featureUnderMouse,i=(0,y.useState)(0),o=(0,S.Z)(i,2),s=o[0],c=o[1],u=(0,y.useState)(null),d=(0,S.Z)(u,2),f=d[0],p=d[1],h=(0,y.useMemo)((function(){return{getBoundingClientRect:function(){var e=n[0]+s/2+20,t=n[1];return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[n,s]),g=(0,N.D)(h,f),v=g.styles,b=g.attributes,x=a?(0,l.getConf)(t,"mouseover",{feature:a}):void 0;return a&&x?(0,j.jsx)(L.Z,{children:(0,j.jsx)("div",(0,m.Z)((0,m.Z)({ref:p,className:r.tooltip,style:(0,m.Z)((0,m.Z)({},v.popper),{},{zIndex:1e5})},b.popper),{},{children:(0,j.jsx)(I,{ref:function(e){return c((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},message:x})}))}):null})),D=B,E=n(44536),V=n(49408),z=n(50543),O=(0,P.ZL)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function W(e){var t=e.message,n=e.severity,r=e.buttonText,a=e.icon,i=e.action,o=O().classes,s=i?(0,j.jsx)(E.Z,{"data-testid":"reload_button",onClick:i,startIcon:a,children:r}):null;return(0,j.jsx)(V.Z,{severity:n,action:s,classes:{message:o.ellipses},children:(0,j.jsx)(z.Z,{title:t,children:(0,j.jsx)("div",{children:t})})})}var H=n(39926),G=n(64031),q=(0,P.ZL)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),U=(0,T.observer)((function(e){var t=e.model,n=q().classes,r=t.blockDefinitions,a=t.blockState;return(0,j.jsx)(j.Fragment,{children:r.map((function(e){if(e instanceof H.b0){var r=a.get(e.key);return(0,j.jsxs)(G.b0,{block:e,children:[r&&r.ReactComponent?(0,j.jsx)(r.ReactComponent,{model:r}):null,r&&r.maxHeightReached?(0,j.jsx)("div",{className:n.heightOverflowed,style:{top:r.layout.getTotalHeight()-16,pointerEvents:"none",height:16},children:"Max height reached"}):null]},"".concat(t.id,"-").concat(e.key))}if(e instanceof H.sh)return(0,j.jsx)(G.sh,{width:e.widthPx},"".concat(t.id,"-").concat(e.key));if(e instanceof H.n2)return(0,j.jsx)(G.n2,{width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant},e.key);throw new Error("invalid block type ".concat(typeof e))}))})}));var _=(0,T.observer)((function(e){var t=e.model,n=q().classes,r=t.blockDefinitions,a=(0,c.getContainingView)(t);return(0,j.jsx)("div",{className:n.linearBlocks,style:{left:r.offsetPx-a.offsetPx},children:(0,j.jsx)(U,{model:t})})})),J=(0,P.ZL)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),X=(0,T.observer)((function(e){var t=J().classes,n=(0,M.Z)(),r=(0,y.useRef)(null),a=(0,y.useState)(),i=(0,S.Z)(a,2),o=i[0],s=i[1],c=(0,y.useState)([0,0]),u=(0,S.Z)(c,2),d=u[0],f=u[1],p=(0,y.useState)([0,0]),h=(0,S.Z)(p,2),g=h[0],v=h[1],b=(0,y.useState)(),x=(0,S.Z)(b,2),w=x[0],k=x[1],C=e.model,Z=e.children,T=C.TooltipComponent,P=C.DisplayMessageComponent,A=C.contextMenuItems,L=C.height,N=C.setContextMenuFeature;return(0,j.jsxs)("div",{ref:r,"data-testid":"display-".concat((0,l.getConf)(C,"displayId")),className:t.display,onContextMenu:function(e){e.preventDefault(),w?k(void 0):r.current&&k([e.clientX,e.clientY])},onMouseMove:function(e){if(r.current){var t=r.current.getBoundingClientRect(),n=t.left,a=t.top;f([e.clientX-n,e.clientY-a]),v([e.clientX,e.clientY]),s(t)}},children:[P?(0,j.jsx)(P,{model:C}):(0,j.jsx)(_,(0,m.Z)({},e)),Z,(0,j.jsx)(T,{model:C,height:L,offsetMouseCoord:d,clientMouseCoord:g,clientRect:o,mouseCoord:d}),(0,j.jsx)(R.Menu,{open:Boolean(w)&&Boolean(A().length),onMenuItemClick:function(e,t){t(),k(void 0)},onClose:function(){k(void 0),N(void 0)},TransitionProps:{onExit:function(){k(void 0),N(void 0)}},anchorReference:"anchorPosition",anchorPosition:w?{top:w[1],left:w[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:A()})]})})),Y=X;var Q=function(e){var t=e.model,n=t.regionTooLargeReason;return(0,j.jsx)(W,{severity:"warning",action:function(){t.estimatedRegionStats?(t.updateStatsLimit(t.estimatedRegionStats),t.reload()):console.error("No global stats?")},buttonText:"Force load",message:"".concat(n?n+". ":"","\n      Zoom in to see features or force load (may be slow).")})},K=n(42328),$=n(73),ee=n(88179),te=(0,P.ZL)()((function(e){var t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, ".concat(t," 5px, ").concat(t," 10px)"),textAlign:"center"}}})),ne=(0,T.observer)((function(e){var t=e.model,n=(0,y.useState)(!1),r=(0,S.Z)(n,2),a=r[0],i=r[1],o=te().classes;(0,y.useEffect)((function(){var e=!1,t=setTimeout((function(){e||i(!0)}),300);return function(){clearTimeout(t),e=!0}}),[]);var s=t.status,c=(0,C.getParent)(t,2).message||s;return(0,j.jsx)(j.Fragment,{children:a?(0,j.jsx)("div",{className:o.loading,children:(0,j.jsx)(R.LoadingEllipses,{message:c})}):null})})),re=(0,T.observer)((function(e){var t=e.model;return t.error?(0,j.jsx)(W,{message:"".concat(t.error),severity:"error",buttonText:"reload",icon:(0,j.jsx)(ee.Z,{}),action:t.reload}):t.message?y.isValidElement(t.message)?t.message:(0,j.jsx)(W,{message:"".concat(t.message),severity:"info"}):t.filled?t.reactElement:(0,j.jsx)(ne,{model:t})})),ae=re,ie=C.types.model("BlockState",{key:C.types.string,region:K.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:ae,renderProps:void 0}})).actions((function(e){var t;return{doReload:function(){e.reloadFlag=e.reloadFlag+1},afterAttach:function(){var t=(0,c.getContainingDisplay)(e);(0,c.makeAbortableReaction)(e,oe,se,{name:"".concat(t.id,"/").concat((0,c.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(n){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered:function(n){if(n){var r=n.reactElement,a=n.features,i=n.layout,o=n.maxHeightReached,s=n.renderProps;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=i,e.error=void 0,e.maxHeightReached=o,e.renderProps=s,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0,(0,$.Z6)(n)&&this.reload()},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=ae,e.renderProps=void 0,(0,C.getParent)(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var n=(0,c.getContainingDisplay)(e),r=(0,c.getSession)(e).rpcManager,a=n.rendererType,i=oe((0,C.cast)(e)).renderArgs;i&&a.freeResourcesInClient(r,JSON.parse(JSON.stringify(i))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function oe(e,t){try{var n=t||(0,c.getContainingDisplay)(e),r=(0,c.getSession)(n),a=r.assemblyManager,i=r.rpcManager,o=n.adapterConfig,s=n.rendererType,u=n.error,d=n.parentTrack,f=(0,w.getTrackAssemblyNames)(d),p=e.region.assemblyName;if(!f.includes(p)&&!f.find((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.hasName(p)})))throw new Error("region assembly (".concat(p,") does not match track assemblies (").concat(f,")"));var h=n.renderProps(),g=h.config;(0,l.readConfObject)(g);var m=(0,w.getRpcSessionId)(n),v=(0,c.getContainingView)(n).id;return{rendererType:s,rpcManager:i,renderProps:h,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:function(t){(0,C.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[(0,C.getSnapshot)(e.region)],adapterConfig:o,rendererType:s.name,sessionId:m,layoutId:v,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(y){return{displayError:y}}}function se(e,t,n){return ce.apply(this,arguments)}function ce(){return(ce=(0,h.Z)((0,p.Z)().mark((function e(t,n,r){var a,i,o,s,u,l,d,f,h,g,v;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(a=t.rendererType,i=t.renderProps,o=t.rpcManager,s=t.renderArgs,u=t.cannotBeRenderedReason,l=t.displayError,(0,C.isAlive)(r)){e.next=5;break}return e.abrupt("return",void 0);case 5:if(!l){e.next=8;break}return r.setError(l),e.abrupt("return",void 0);case 8:if(!u){e.next=11;break}return r.setMessage(u),e.abrupt("return",void 0);case 11:if(!i.notReady){e.next=13;break}return e.abrupt("return",void 0);case 13:return e.next=15,a.renderInClient(o,(0,m.Z)((0,m.Z)((0,m.Z)({},s),i),{},{viewParams:(0,c.getViewParams)(r),signal:n}));case 15:return d=e.sent,f=d.reactElement,h=d.features,g=d.layout,v=d.maxHeightReached,e.abrupt("return",{reactElement:f,features:h,layout:g,maxHeightReached:v,renderProps:i});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ue=["blockState"];function le(e,t){var n="undefined"===typeof jest;return"clip-".concat(n?e:"jest","-").concat(t)}var de=20,fe=100;var pe=C.types.compose("BaseLinearDisplay",b.BaseDisplay,C.types.model({height:C.types.optional(C.types.refinement("displayHeight",C.types.number,(function(e){return e>=de})),fe),blockState:C.types.map(ie),userBpPerPxLimit:C.types.maybe(C.types.number),userByteSizeLimit:C.types.maybe(C.types.number)})).volatile((function(){return{currBpPerPx:0,scrollTop:0,message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,estimatedRegionStatsP:void 0,estimatedRegionStats:void 0}})).views((function(e){return{get blockType(){return"staticBlocks"},get blockDefinitions(){var t=this.blockType,n=(0,c.getContainingView)(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]}}})).views((function(e){return{get renderDelay(){return 50},get TooltipComponent(){return D},get selectedFeatureId(){if((0,C.isAlive)(e)){var t=(0,c.getSession)(e).selection;if((0,c.isFeature)(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){return{get features(){var t,n=[],r=(0,v.Z)(e.blockState.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&a.features&&n.push(a.features)}}catch(i){r.e(i)}finally{r.f()}return new x(n)},get featureUnderMouse(){var t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:function(t,n,r){var a,i;return null===(a=e.blockState.get(t))||void 0===a||null===(i=a.layout)||void 0===i?void 0:i.getByCoord(n,r)},getFeatureByID:function(t,n){var r,a;return null===(r=e.blockState.get(t))||void 0===r||null===(a=r.layout)||void 0===a?void 0:a.getByID(n)},searchFeatureByID:function(t){var n;return e.blockState.forEach((function(e){var r,a=null===e||void 0===e||null===(r=e.layout)||void 0===r?void 0:r.getByID(t);a&&(n=a)})),n},get currentBytesRequested(){var t;return(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.bytes)||0},get currentFeatureScreenDensity(){var t,n=(0,c.getContainingView)(e);return((null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.featureDensity)||0)*n.bpPerPx},get maxFeatureScreenDensity(){return(0,l.getConf)(e,"maxFeatureScreenDensity")},get estimatedStatsReady(){return!!e.estimatedRegionStats},get maxAllowableBytes(){var t;return e.userByteSizeLimit||(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.fetchSizeLimit)||(0,l.getConf)(e,"fetchSizeLimit")}}})).actions((function(e){return{setMessage:function(t){e.message=t},afterAttach:function(){var t=this,n=(0,k.autorun)((function(){var n={};(0,c.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(r){n[r.key]=!0,e.blockState.has(r.key)||t.addBlock(r.key,r)})),e.blockState.forEach((function(e,r){n[r]||t.deleteBlock(r)})))}));(0,C.addDisposer)(e,n)},estimateRegionsStats:function(t,n){var r=this;if(e.estimatedRegionStatsP)return e.estimatedRegionStatsP;var a=(0,c.getSession)(e).rpcManager,i=e.adapterConfig;if(!i)return Promise.resolve({});var o=(0,w.getRpcSessionId)(e),s=(0,m.Z)({sessionId:o,regions:t,adapterConfig:i,statusCallback:function(t){(0,C.isAlive)(e)&&r.setMessage(t)}},n);return e.estimatedRegionStatsP=a.call(o,"CoreEstimateRegionStats",s).catch((function(e){throw r.setRegionStatsP(void 0),e})),e.estimatedRegionStatsP},setRegionStatsP:function(t){e.estimatedRegionStatsP=t},setRegionStats:function(t){e.estimatedRegionStats=t},clearRegionStats:function(){e.estimatedRegionStatsP=void 0,e.estimatedRegionStats=void 0},setHeight:function(t){return e.height=t>de?t:de,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},setScrollTop:function(t){e.scrollTop=t},updateStatsLimit:function(t){var n=(0,c.getContainingView)(e);t.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},addBlock:function(t,n){e.blockState.set(t,ie.create({key:t,region:n.toRegion()}))},setCurrBpPerPx:function(t){e.currBpPerPx=t},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var n=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(n)){var r=n.addWidget("BaseFeatureWidget","baseFeature",{view:(0,c.getContainingView)(e),track:(0,c.getContainingTrack)(e),featureData:t.toJSON()});n.showWidget(r)}(0,c.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection:function(){(0,c.getSession)(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){(0,g.Z)(e.blockState.values()).map((function(e){return e.doReload()}))},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{get regionTooLarge(){var t=(0,c.getContainingView)(e);if(!e.estimatedStatsReady||t.dynamicBlocks.totalBp<2e4)return!1;var n=e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity;return e.currentBytesRequested>e.maxAllowableBytes||n},get regionTooLargeReason(){var t,n=e.currentBytesRequested,r=e.maxAllowableBytes;return n&&n>r?"Requested too much data (".concat((t=n,Math.floor(t/1e6)>0?"".concat(parseFloat((t/1e6).toPrecision(3))," Mb"):Math.floor(t/1e3)>0?"".concat(parseFloat((t/1e3).toPrecision(3))," Kb"):"".concat(Math.floor(t)," bytes")),")"):""}}})).actions((function(e){var t=e.reload;return{reload:function(){return(0,h.Z)((0,p.Z)().mark((function n(){var r,a,i;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.setError(),r=new AbortController,(a=(0,c.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){n.next=5;break}return n.abrupt("return");case 5:return n.prev=5,e.estimatedRegionStatsP=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),n.next=9,e.estimatedRegionStatsP;case 9:if(i=n.sent,!(0,C.isAlive)(e)){n.next=15;break}e.setRegionStats(i),t(),n.next=16;break;case 15:return n.abrupt("return");case 16:n.next=22;break;case 18:n.prev=18,n.t0=n.catch(5),console.error(n.t0),e.setError(n.t0);case 22:case"end":return n.stop()}}),n,null,[[5,18]])})))()},afterAttach:function(){(0,C.addDisposer)(e,(0,k.autorun)((0,h.Z)((0,p.Z)().mark((function t(){var n,r,a,i,o;return(0,p.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=new AbortController,(a=(0,c.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){t.next=5;break}return t.abrupt("return");case 5:if(void 0===(null===(n=e.estimatedRegionStats)||void 0===n?void 0:n.featureDensity)){t.next=8;break}return e.setCurrBpPerPx(a.bpPerPx),t.abrupt("return");case 8:if(a.bpPerPx!==e.currBpPerPx){t.next=10;break}return t.abrupt("return");case 10:return e.clearRegionStats(),e.setCurrBpPerPx(a.bpPerPx),i=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),e.setRegionStatsP(i),t.next=16,i;case 16:o=t.sent,(0,C.isAlive)(e)&&e.setRegionStats(o),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),!(0,c.isAbortException)(t.t0)&&(0,C.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 23:case"end":return t.stop()}}),t,null,[[0,20]])}))),{delay:500}))}}})).views((function(e){return{regionCannotBeRenderedText:function(t){return e.regionTooLarge?"Force load to see features":""},regionCannotBeRendered:function(t){return e.regionTooLarge?(0,j.jsx)(Q,{model:e}):null},trackMenuItems:function(){return[]},contextMenuItems:function(){return e.contextMenuFeature?[{label:"Open feature details",icon:Z.Z,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]},renderProps:function(){var t=(0,c.getContainingView)(e);return(0,m.Z)((0,m.Z)({},(0,w.getParentRenderProps)(e)),{},{notReady:e.currBpPerPx!==t.bpPerPx||!e.estimatedRegionStats,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick:function(t,n){var r=n||e.featureIdUnderMouse;if(r){var a=e.features.get(r);a&&e.selectFeature(a)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){var r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove:function(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}}})).actions((function(e){return{renderSvg:function(t){return(0,h.Z)((0,p.Z)().mark((function n(){var r,a,i,o,s,u,l,d;return(0,p.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height,a=e.id,i=t.overrideHeight,o=(0,c.getContainingView)(e),s=o.offsetPx,u=o.roundedDynamicBlocks,l=o.width,n.next=6,Promise.all(u.map((function(n){var r=ie.create({key:n.key,region:n}),a=e.regionCannotBeRenderedText(n)||e.regionCannotBeRendered(n);if(a)return{reactElement:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("rect",{x:0,y:0,width:l,height:20,fill:"#aaa"}),(0,j.jsx)("text",{x:0,y:15,children:a})]})};var i=oe(r,e),o=i.rpcManager,s=i.renderArgs,u=i.renderProps;return i.rendererType.renderInClient(o,(0,m.Z)((0,m.Z)((0,m.Z)({},s),u),{},{viewParams:(0,c.getViewParams)(e,!0),exportSVG:t}))})));case 6:return d=n.sent,n.abrupt("return",(0,j.jsx)(j.Fragment,{children:d.map((function(e,t){var n=u[t].offsetPx-s,o=le(a,t);return(0,j.jsxs)(y.Fragment,{children:[(0,j.jsx)("defs",{children:(0,j.jsx)("clipPath",{id:o,children:(0,j.jsx)("rect",{x:0,y:0,width:l,height:i||r})})}),(0,j.jsx)("g",{transform:"translate(".concat(n," 0)"),children:(0,j.jsx)("g",{clipPath:"url(#".concat(o,")"),children:y.isValidElement(e.reactElement)?e.reactElement:(0,j.jsx)("g",{dangerouslySetInnerHTML:{__html:e.html}})})})]},"frag-".concat(t))}))}));case 8:case"end":return n.stop()}}),n)})))()}}})).postProcessSnapshot((function(e){var t=e;return t.blockState,(0,f.Z)(t,ue)})),he=n(91271);function ge(e){return(0,l.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:d,explicitlyTyped:!0})}var me=n(9159);function ve(e){return C.types.compose("LinearBareDisplay",pe,C.types.model({type:C.types.literal("LinearBareDisplay"),configuration:(0,me.B)(e)})).views((function(e){var t=e.renderProps;return{renderProps:function(){return(0,m.Z)((0,m.Z)((0,m.Z)({},t()),(0,w.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var ye=n(89743);var be=function(e){return(0,l.ConfigurationSchema)("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:d,explicitlyTyped:!0})},xe=n(42043),we=(0,y.lazy)((function(){return n.e(7194).then(n.bind(n,67194))}));var ke=function(e){return C.types.compose("LinearBasicDisplay",pe,C.types.model({type:C.types.literal("LinearBasicDisplay"),trackShowLabels:C.types.maybe(C.types.boolean),trackShowDescriptions:C.types.maybe(C.types.boolean),trackDisplayMode:C.types.maybe(C.types.string),trackMaxHeight:C.types.maybe(C.types.number),configuration:(0,l.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return(0,l.getConf)(e,["renderer","type"])},get showLabels(){var t;return null!==(t=e.trackShowLabels)&&void 0!==t?t:(0,l.getConf)(e,["renderer","showLabels"])},get showDescriptions(){var t;return null!==(t=e.trackShowDescriptions)&&void 0!==t?t:(0,l.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){var t;return null!==(t=e.trackMaxHeight)&&void 0!==t?t:(0,l.getConf)(e,["renderer","maxHeight"])},get displayMode(){var t;return null!==(t=e.trackDisplayMode)&&void 0!==t?t:(0,l.getConf)(e,["renderer","displayMode"])}}})).views((function(e){return{get rendererConfig(){var t=(0,l.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create((0,m.Z)((0,m.Z)({},t),{},{showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight}),(0,C.getEnv)(e))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions:function(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{renderProps:function(){var t=e.rendererConfig,r=n();return(0,m.Z)((0,m.Z)({},r),{},{config:t})},trackMenuItems:function(){return[].concat((0,g.Z)(t()),[{label:"Show labels",icon:xe.Z,type:"checkbox",checked:e.showLabels,onClick:function(){return e.toggleShowLabels()}},{label:"Show descriptions",icon:xe.Z,type:"checkbox",checked:e.showDescriptions,onClick:function(){return e.toggleShowDescriptions()}},{label:"Display mode",icon:xe.Z,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){return e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){(0,c.getSession)(e).queueDialog((function(t){return[we,{model:e,handleClose:t}]}))}}])}}}))};var Ce=function(e){return(0,l.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,he.createBaseTrackConfig)(e),explicitIdentifier:"trackId"})};var Ze=function(e){return(0,l.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,he.createBaseTrackConfig)(e),explicitIdentifier:"trackId"})},Se=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:Y,BaseLinearDisplay:pe,baseLinearDisplayConfigSchema:d,SearchBox:ye.Rj,ZoomControls:ye.FX,LinearGenomeView:ye.I1},e}return(0,a.Z)(n,[{key:"install",value:function(e){var t;(t=e).addTrackType((function(){var e=Ce(t);return new he.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,he.createBaseTrackModel)(t,"FeatureTrack",e)})})),function(e){e.addTrackType((function(){var t=Ze(e);return new he.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,he.createBaseTrackModel)(e,"BasicTrack",t)})}))}(e),function(e){e.addDisplayType((function(){var t=be(e);return new he.DisplayType({name:"LinearBasicDisplay",displayName:"Basic deature display",configSchema:t,stateModel:ke(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:Y})}))}(e),(0,ye.ZP)(e),function(e){e.addDisplayType((function(){var t=ge(e);return new he.DisplayType({name:"LinearBareDisplay",configSchema:t,stateModel:ve(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:Y})}))}(e),function(e){e.addToExtensionPoint("LaunchView-LinearGenomeView",function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a,i,o,s,u,l;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,a=t.loc,i=t.tracks,o=void 0===i?[]:i,e.prev=1,s=n.assemblyManager,u=n.addView("LinearGenomeView",{}),e.next=6,(0,c.when)((function(){return!!u.volatileWidth}));case 6:if(r){e.next=8;break}throw new Error("No assembly provided when launching linear genome view");case 8:return e.next=10,s.waitForAssembly(r);case 10:if(e.sent){e.next=13;break}throw new Error('Assembly "'.concat(r,'" not found when launching linear genome view'));case 13:return e.next=15,u.navToLocString(a,r);case 15:if(l=[],o.forEach((function(e){try{u.showTrack(e)}catch(t){if(!"".concat(t).match("Could not resolve identifier"))throw t;l.push(e)}})),!l.length){e.next=19;break}throw new Error("Could not resolve identifiers: ".concat(l.join(",")));case 19:e.next=25;break;case 21:throw e.prev=21,e.t0=e.catch(1),n.notify("".concat(e.t0),"error"),e.t0;case 25:case"end":return e.stop()}}),e,null,[[1,21]])})));return function(t){return e.apply(this,arguments)}}())}(e)}},{key:"configure",value:function(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:u.Z,onClick:function(e){e.addView("LinearGenomeView",{})}})}}]),n}(s.Z)},47356:function(e,t,n){"use strict";n.d(t,{Z:function(){return D}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(95984),c=n(87977),u=n(92777),l=n(99836);var d=n(33028),f=n(9159),p=n(63680);function h(e){return p.types.compose("LinearLollipopDisplay",u.fV,p.types.model({type:p.types.literal("LinearLollipopDisplay"),configuration:(0,f.B)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:function(){return(0,d.Z)((0,d.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var g=n(41361),m=n(96234),v=(n(42328),n(97531)),y=n(4782),b=n(96902),x=n(51632),w=n(29938);function k(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.y,i=r.data,o=i.anchorX,s=i.radiusPx,c=i.score,u=(0,l.readConfObject)(n,"innerColor",{feature:t}),d=String(c),f=1.1*(2*s/d.length);return f<12?null:(0,w.jsx)("text",{style:{fontSize:f,fill:(0,x.contrastingTextColor)(u)},x:o,y:a+s-f/2.4,textAnchor:"middle",dominantBaseline:"hanging",children:d})}function C(e){var t=function(t){var n=e.onFeatureMouseDown,r=e.feature;if(n)return n(t,r.id())},n=function(t){var n=e.onFeatureMouseEnter,r=e.feature;if(n)return n(t,r.id())},r=function(t){var n=e.onFeatureMouseOut,r=e.feature;if(n)return n(t,r.id())},a=function(t){var n=e.onFeatureMouseOver,r=e.feature;if(n)return n(t,r.id())},i=function(t){var n=e.onFeatureMouseUp,r=e.feature;if(n)return n(t,r.id())},o=function(t){var n=e.onFeatureMouseLeave,r=e.feature;if(n)return n(t,r.id())},s=function(t){var n=e.onFeatureMouseMove,r=e.feature;if(n)return n(t,r.id())},c=function(t){var n=e.onFeatureClick,r=e.feature;if(n)return t.stopPropagation(),n(t,r.id())},u=e.feature,f=e.config,p=e.layoutRecord,h=p.anchorLocation,g=p.y,m=p.data,v=m.radiusPx,y=m.score,b=e.selectedFeatureId,x={fill:(0,l.readConfObject)(f,"strokeColor",{feature:u})};String(b)===String(u.id())&&(x.fill="red");var C={fill:(0,l.readConfObject)(f,"innerColor",{feature:u})},Z=(0,l.readConfObject)(f,"strokeWidth",{feature:u});return(0,w.jsxs)("g",{"data-testid":u.id(),children:[(0,w.jsx)("title",{children:(0,l.readConfObject)(f,"caption",{feature:u})}),(0,w.jsx)("circle",{cx:h,cy:g+v,r:v,style:x,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:s,onClick:c,onFocus:a,onBlur:r}),v-Z<=2?null:(0,w.jsx)("circle",{cx:h,cy:g+v,r:v-Z,style:C,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:s,onClick:c,onFocus:a,onBlur:r}),(0,w.jsx)(k,(0,d.Z)((0,d.Z)({},e),{},{score:y}))]})}C.defaultProps={selectedFeatureId:void 0,onFeatureMouseDown:void 0,onFeatureMouseEnter:void 0,onFeatureMouseOut:void 0,onFeatureMouseOver:void 0,onFeatureMouseUp:void 0,onFeatureMouseLeave:void 0,onFeatureMouseMove:void 0,onFeatureClick:void 0};var Z=(0,y.observer)(C);var S=(0,y.observer)((function(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.anchorLocation,i=r.y,o=r.data.radiusPx;return(0,w.jsx)("line",{x1:a,y1:0,x2:a,y2:i+2*o,stroke:(0,l.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:(0,l.readConfObject)(n,"stickWidth",{feature:t})})}));function T(e){var t=function(t){var n=e.onMouseEnter;if(n)return n(t)},n=function(t){var n=e.onMouseLeave;if(n)return n(t)};function r(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.layout,i=Math.abs(t.get("end")+t.get("start"))/2,o=(0,v.bpToPx)(i,r,n),s=(0,l.readConfObject)(e.config,"radius",{feature:t});s||console.error(new Error("lollipop radius ".concat(s," configured for feature ").concat(t.id()))),a.add(t.id(),o,2*s,2*s,{featureId:t.id(),anchorX:o,radiusPx:s,score:(0,l.readConfObject)(e.config,"score",{feature:t})})}var a,i=e.regions,o=e.bpPerPx,s=e.layout,c=e.config,u=e.features,f=e.displayModel.selectedFeatureId,p=(0,m.Z)(i,1)[0],h=[],y=(0,g.Z)(u.values());try{for(y.s();!(a=y.n()).done;){r({feature:a.value,bpPerPx:o,region:p,config:c,layout:s})}}catch(j){y.e(j)}finally{y.f()}var x,k=(0,g.Z)(s.getLayout(c).values());try{for(k.s();!(x=k.n()).done;){var C=x.value,T=u.get(C.data.featureId);h.push((0,b.createElement)(S,(0,d.Z)((0,d.Z)({},e),{},{layoutRecord:C,feature:T,key:"stick-".concat(T.id()),selectedFeatureId:f})))}}catch(j){k.e(j)}finally{k.f()}var M,P=(0,g.Z)(s.getLayout(c).values());try{for(P.s();!(M=P.n()).done;){var R=M.value,A=u.get(R.data.featureId);h.push((0,b.createElement)(Z,(0,d.Z)((0,d.Z)({},e),{},{layoutRecord:R,feature:A,key:"body-".concat(A.id()),selectedFeatureId:f})))}}catch(j){P.e(j)}finally{P.f()}var L=(p.end-p.start)/o,N=s.getTotalHeight();return(0,w.jsxs)("svg",{className:"LollipopRendering",width:L,height:N,style:{position:"relative"},onMouseDown:function(t){var n=e.onMouseDown;if(n)return n(t)},onMouseUp:function(t){var n=e.onMouseUp;if(n)return n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:function(t){var n=e.onMouseOver;if(n)return n(t)},onMouseOut:function(t){var n=e.onMouseOut;if(n)return n(t)},onFocus:t,onBlur:n,onClick:function(t){var n=e.onClick;if(n)return n(t)},children:[[],h]})}T.defaultProps={displayModel:{},features:new Map,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onClick:void 0};var M=(0,y.observer)(T),P=(0,l.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0}),R=n(66568),A=n(84613),L=n(68079),N=n(23995),j=function(){function e(t){var n=t.width;if((0,r.Z)(this,e),this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!n)throw new Error("width required to make a new FloatingLayout");this.width=n}return(0,a.Z)(e,[{key:"add",value:function(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a}),this.layoutDirty=!0}},{key:"getLayout",value:function(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");for(var t=(0,l.readConfObject)(e,"minStickLength"),n=this.items.sort((function(e,t){return e.data.score-t.data.score})),r=0,a=Array(n.length),i=0;i<n.length;i+=1){for(var o=n[i],s=o.anchorLocation,c=o.width,u=o.height,f=s-c/2,p=f+c,h=t,g=h+u,v=0;v<i;v+=1){var y=(0,m.Z)(a[v],2)[1],b=y.x,x=y.y,w=b+y.width,k=x+y.height;(0,N.qY)(b,w,f,p)&&(0,N.qY)(x,k,h,g)&&(g=(h=k)+u,v=-1)}a[i]=[o.uniqueId,(0,d.Z)((0,d.Z)({},o),{},{x:f,y:h})],g>r&&(r=g)}return this.totalHeight=r,this.layout=new Map(a),this.layoutDirty=!1,this.layout}},{key:"getTotalHeight",value:function(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}},{key:"serializeRegion",value:function(){return this.toJSON()}},{key:"toJSON",value:function(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:(0,L.Z)(this.getLayout()),totalHeight:this.getTotalHeight()}}}],[{key:"fromJSON",value:function(){throw new Error("not supported")}}]),e}(),F=function(){function e(t){var n=t.pairs,a=t.totalHeight;(0,r.Z)(this,e),this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(n),this.totalHeight=a}return(0,a.Z)(e,[{key:"add",value:function(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}},{key:"getLayout",value:function(){return this.layout}},{key:"getTotalHeight",value:function(){return this.totalHeight}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}(),I=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"makeLayout",value:function(){var e=this.regions[0],t=(e.end-e.start)/this.bpPerPx;return new A.Z(j,{width:t})}},{key:"layoutIsValid",value:function(){return!1}}]),n}(R.LayoutSession),B=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"createSession",value:function(e){return new I(e)}},{key:"deserializeLayoutInClient",value:function(e){return new F(e)}}]),n}(R.default),D=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="LollipopPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new B({name:"LollipopRenderer",ReactComponent:M,configSchema:P,pluginManager:e})})),e.addDisplayType((function(){var t=function(e){return(0,l.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:u.fU,explicitlyTyped:!0})}(e);return new s.Z({name:"LinearLollipopDisplay",configSchema:t,stateModel:h(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:u.qb})}))}}]),n}(c.Z)},26340:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(96902),c=n(26347),u=n(87977),l=n(97531),d=n(57900),f=n(47306),p=n(99836),h=n(42328),g=n(63680),m=(0,p.ConfigurationSchema)("AboutWidget",{}),v=g.types.model("AboutWidget",{id:h.ElementId,type:g.types.literal("AboutWidget")}),y=(0,p.ConfigurationSchema)("HelpWidget",{}),b=g.types.model("HelpWidget",{id:h.ElementId,type:g.types.literal("HelpWidget")}),x=(0,p.ConfigurationSchema)("ImportSessionWidget",{}),w=g.types.model("ImportSessionWidget",{id:h.ElementId,type:g.types.literal("ImportSessionWidget")}),k=(0,p.ConfigurationSchema)("SessionManager",{}),C=g.types.model("SessionManager",{id:h.ElementId,type:g.types.literal("SessionManager")}),Z=function(e){(0,i.Z)(u,e);var t=(0,o.Z)(u);function u(){var e;(0,r.Z)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="MenusPlugin",e}return(0,a.Z)(u,[{key:"install",value:function(e){e.addWidgetType((function(){return new c.Z({name:"AboutWidget",heading:"About",configSchema:m,stateModel:v,ReactComponent:(0,s.lazy)((function(){return n.e(3821).then(n.bind(n,13821))}))})})),e.addWidgetType((function(){return new c.Z({name:"HelpWidget",heading:"Help",configSchema:y,stateModel:b,ReactComponent:(0,s.lazy)((function(){return n.e(8309).then(n.bind(n,68309))}))})})),e.addWidgetType((function(){return new c.Z({name:"ImportSessionWidget",heading:"Import session",configSchema:x,stateModel:w,ReactComponent:(0,s.lazy)((function(){return Promise.all([n.e(409),n.e(2311)]).then(n.bind(n,2311))}))})})),e.addWidgetType((function(){return new c.Z({name:"SessionManager",heading:"Sessions",configSchema:k,stateModel:C,ReactComponent:(0,s.lazy)((function(){return Promise.all([n.e(8581),n.e(9636)]).then(n.bind(n,39636))}))})}))}},{key:"configure",value:function(e){(0,l.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:f.Z,onClick:function(e){var t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:d.Z,onClick:function(e){var t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}]),u}(u.Z)},65886:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(5868),c=n(87977),u=n(68079),l=n(41361),d=n(96234),f=n(33028),p=n(32723),h=n(34795),g=n(82972),m=n(93824),v=n(43430),y=n(74657),b=n.n(y),x=n(99836),w=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;return(0,r.Z)(this,n),(o=t.call(this,e,a,i)).endpoint=void 0,o.queryTemplate=void 0,o.refNamesQueryTemplate=void 0,o.additionalQueryParams=void 0,o.configRefNames=void 0,o.refNames=void 0,o.endpoint=(0,x.readConfObject)(e,"endpoint").uri,o.queryTemplate=(0,x.readConfObject)(e,"queryTemplate"),o.additionalQueryParams=(0,x.readConfObject)(e,"additionalQueryParams"),o.refNamesQueryTemplate=(0,x.readConfObject)(e,"refNamesQueryTemplate"),o.configRefNames=(0,x.readConfObject)(e,"refNames"),o}return(0,a.Z)(n,[{key:"getRefNames",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(){var t,n,r,a,i=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},!this.refNames){e.next=3;break}return e.abrupt("return",this.refNames);case 3:if(n=[],!this.refNamesQueryTemplate){e.next=12;break}return r=encodeURIComponent(this.refNamesQueryTemplate),e.next=8,this.querySparql(r,t);case 8:a=e.sent,n=this.resultsToRefNames(a),e.next=13;break;case 12:this.configRefNames&&(n=this.configRefNames);case 13:return this.refNames=n,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.ObservableCreate)(function(){var r=(0,h.Z)((0,p.Z)().mark((function r(a){var i,o,s;return(0,p.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=encodeURIComponent(b()(t.queryTemplate,e)),o=e.refName,r.next=4,t.querySparql(i,n);case 4:s=r.sent,t.resultsToFeatures(s,o).forEach((function(e){a.next(e)})),a.complete();case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"querySparql",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t,n){var r,a,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",this.additionalQueryParams.length&&(r="&".concat(this.additionalQueryParams.join("&"))),a=n&&n.signal,e.next=5,fetch("".concat(this.endpoint,"?query=").concat(t).concat(r),{headers:{accept:"application/json,application/sparql-results+json"},signal:a});case 5:return i=e.sent,e.abrupt("return",i.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resultsToRefNames",value:function(e){var t=((e||{}).results||{}).bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((function(e){return e.refName.value}))}},{key:"resultsToFeatures",value:function(e,t){var n=((e||{}).results||{}).bindings||[];if(!n.length)return[];var r=e.head.vars;["start","end","uniqueId"].forEach((function(e){r.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));var a={};n.forEach((function(e){var n=[{}];r.forEach((function(t){if(t in e){for(var r=e[t].value,a=0;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>n.length-1;)n.push({});n[a][t]=r}})),n.forEach((function(e,r){var i=e.uniqueId;r<n.length-1&&(n[r+1].parentUniqueId=i),a[i]={data:(0,f.Z)((0,f.Z)({},e),{},{uniqueId:i,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0})}}))}));for(var i=0,o=Object.entries(a);i<o.length;i++){var s=(0,d.Z)(o[i],2),c=s[0],p=s[1],h=p.data.parentUniqueId;if(delete p.data.parentUniqueId,h){var g=a[h];if(g)g.data.subfeatures||(g.data.subfeatures=[]),g.data.subfeatures.push((0,f.Z)((0,f.Z)({},p.data),{},{uniqueId:c})),delete a[c];else{var m,y=Object.values(a).map((function(e){return e.data.subfeatures})).filter((function(e){return!!e})).flat(),b=!1,x=(0,l.Z)(y);try{for(x.s();!(m=x.n()).done;){var w=m.value;if(w&&w.uniqueId===h){w.subfeatures||(w.subfeatures=[]),w.subfeatures.push((0,f.Z)((0,f.Z)({},p.data),{},{uniqueId:c})),delete a[c],b=!0;break}w&&w.subfeatures&&y.push.apply(y,(0,u.Z)(w.subfeatures))}}catch(k){x.e(k)}finally{x.f()}b||console.error("Could not find parentID ".concat(h))}}}return Object.keys(a).map((function(e){return new v.Z((0,f.Z)((0,f.Z)({},a[e].data),{},{uniqueId:e,subfeatures:a[e].data.subfeatures}))}))}},{key:"hasDataForRefName",value:function(){var e=(0,h.Z)((0,p.Z)().mark((function e(t){var n,r,a=arguments;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:if(!(r=e.sent).length||r.includes(t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(g.BaseFeatureDataAdapter),k=(0,x.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0}),C=n(16151),Z=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="RdfPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:k,AdapterClass:w})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="SPARQLAdapter",i=(0,C.getFileName)(t);return/\/sparql$/i.test(i)||r===a?{type:a,endpoint:t}:e(t,n,r)}}))}}]),n}(c.Z)},67109:function(e,t,n){"use strict";n.d(t,{Z:function(){return W}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(5868),u=n(99836);var l=(0,u.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0}),d=n(33028),f=n(13381),p=n(68079),h=n(96234),g=n(96902),m=n(51632),v=n(46186),y=n(4782),b=n(97531),x=n(29938);function w(e){for(var t=e.codonTable,n=e.seq,r=e.frame,a=e.bpPerPx,i=e.region,o=e.height,s=e.y,c=e.reverse,u=void 0!==c&&c,l=e.theme,d=a,f=3-i.start%3,p=(r+f+3)%3,h=n.slice(p),m=[],v=0;v<h.length;v+=3){var y=h.slice(v,v+3),w=u?(0,b.revcom)(y):y,k=t[w]||"";m.push({letter:k,codon:w.toUpperCase()})}var C=1/d*3,Z=0===i.start?0:C,S=1/a>=12,T=(i.end-i.start)/a,M=["#d8d8d8","#adadad","#8f8f8f"].reverse();return(0,x.jsx)(x.Fragment,{children:m.map((function(e,t){var n=i.reversed?T-(C*(t+1)+p/d-Z):C*t+p/d-Z,a=e.letter,c=e.codon;return(0,x.jsxs)(g.Fragment,{children:[(0,x.jsx)("rect",{x:n,y:s,width:S?C:C+.7,height:o,stroke:S?"#555":"none",fill:b.defaultStarts.includes(c)?l.palette.startCodon:b.defaultStops.includes(c)?l.palette.stopCodon:M[Math.abs(r)]}),S?(0,x.jsx)("text",{x:n+C/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",children:a}):null]},"".concat(t,"-").concat(a))}))})}function k(e){var t=e.bpPerPx,n=e.region,r=e.feature,a=e.theme,i=e.height,o=e.seq,s=e.y,c=1/t>=12,u=(0,b.bpSpanPx)(r.get("start"),r.get("end"),n,t),l=(0,h.Z)(u,2),d=l[0],f=l[1],p=n.reversed,v=r.get("end")-r.get("start"),y=Math.max((f-d)/v,.8);return(0,x.jsx)(x.Fragment,{children:o.split("").map((function(e,t){var n=a.palette.bases[e.toUpperCase()],r=p?f-(t+1)*y:d+t*y;return(0,x.jsxs)(g.Fragment,{children:[(0,x.jsx)("rect",{x:r,y:s,width:y,height:i,fill:n?n.main:"#aaa",stroke:c?"#555":"none"}),c?(0,x.jsx)("text",{x:r+y/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?(0,m.contrastingTextColor)(n.main):"black",children:e}):null]},t)}))})}var C=function(e){var t=e.regions,n=e.theme,r=e.features,a=void 0===r?new Map:r,i=e.showReverse,o=void 0===i||i,s=e.showForward,c=void 0===s||s,u=e.showTranslation,l=void 0===u||u,d=e.bpPerPx,f=(0,h.Z)(t,1)[0],g=(0,v.createJBrowseTheme)(n),m=(0,b.generateCodonTable)(b.defaultCodonTable),y=(0,p.Z)(a.values())[0];if(!y)return null;var C=y.get("seq");if(!C)return null;var Z=-20;return(0,x.jsxs)(x.Fragment,{children:[l&&(f.reversed?o:c)?[2,1,0].map((function(e){return(0,x.jsx)(w,{seq:C,y:Z+=20,codonTable:m,frame:e,bpPerPx:d,region:f,theme:g,height:20,reverse:f.reversed},"translation-".concat(e))})):null,c?(0,x.jsx)(k,{height:20,y:Z+=20,feature:y,region:f,seq:f.reversed?(0,b.complement)(C):C,bpPerPx:d,theme:g}):null,o?(0,x.jsx)(k,{height:20,y:Z+=20,feature:y,region:f,seq:f.reversed?C:(0,b.complement)(C),bpPerPx:d,theme:g}):null,l&&(f.reversed?c:o)?[0,-1,-2].map((function(e){return(0,x.jsx)(w,{seq:C,y:Z+=20,codonTable:m,frame:e,bpPerPx:d,region:f,theme:g,height:20,reverse:!f.reversed},"rev-translation-".concat(e))})):null]})},Z=function(e){var t=e.exportSVG,n=e.width,r=e.totalHeight,a=e.children;return t?(0,x.jsx)(x.Fragment,{children:a}):(0,x.jsx)("svg",{"data-testid":"sequence_track",width:n,height:r,style:{width:n,height:r},children:a})};var S=(0,y.observer)((function(e){var t=e.regions,n=e.bpPerPx,r=(0,h.Z)(t,1)[0],a=(r.end-r.start)/n;return(0,x.jsx)(Z,(0,d.Z)((0,d.Z)({},e),{},{totalHeight:200,width:a,children:(0,x.jsx)(C,(0,d.Z)({},e))}))}));var T=(0,u.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),M=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,a.Z)(n,[{key:"getExpandedRegion",value:function(e){return(0,d.Z)((0,d.Z)({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),n}(f.default);var P=(0,u.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0});var R=(0,u.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0});var A=(0,u.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0});var L=(0,u.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),N=n(55385),j=n(33991),F=n(63680);var I=function(e){e.addTrackType((function(){var t=function(e){return(0,u.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:F.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,u.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,i=void 0===a?[]:a;return"placeholderId"!==n.trackId&&(i.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||i.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))),(0,d.Z)((0,d.Z)({},n),{},{displays:i})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}(e);return new N.Z({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,j.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})}))},B=n(91271),D=n(92777);var E=(0,u.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:T},{explicitIdentifier:"displayId",explicitlyTyped:!0}),V=n(75717);var z=function(e){e.addDisplayType((function(){var e=function(e){return F.types.compose("LinearReferenceSequenceDisplay",D.fV,F.types.model({type:F.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,u.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=e.showForward,r=e.showReverse,a=e.showTranslation;return(0,d.Z)((0,d.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer,showForward:n,showReverse:r,showTranslation:a})}}})).views((function(e){return{regionCannotBeRendered:function(){var t=(0,b.getContainingView)(e);return(null===t||void 0===t?void 0:t.bpPerPx)>=1?"Zoom in to see sequence":void 0},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation},afterAttach:function(){(0,F.addDisposer)(e,(0,V.autorun)((function(){var t=(0,b.getContainingView)(e);if((null===t||void 0===t?void 0:t.bpPerPx)>=1)e.setHeight(50);else{var n=e.showTranslation,r=e.showReverse,a=e.showForward,i=(r&&n?60:0)+(a&&n?60:0),o=r?20:0,s=a?20:0;e.setHeight(i+o+s)}})))}}})).views((function(e){return{trackMenuItems:function(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){return e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){return e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){return e.toggleShowTranslation()}}]}}}))}(E);return new B.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:E,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:D.qb})}))},O=n(16151),W=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SequencePlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addRendererType((function(){return new M({name:"DivSequenceRenderer",ReactComponent:S,configSchema:T,pluginManager:e})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:l,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(2094),n.e(7445),n.e(5571)]).then(n.bind(n,85571)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:P,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(7818),n.e(397)]).then(n.bind(n,80397)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:R,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return n.e(8552).then(n.bind(n,88552)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:A,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(7818),n.e(8495)]).then(n.bind(n,18495)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:L,getAdapterClass:function(){return n.e(9121).then(n.bind(n,89121)).then((function(e){return e.default}))}})}))}(e),I(e),z(e),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="TwoBitAdapter",i=(0,O.getFileName)(t),o={type:a,twoBitLocation:t};return/\.2bit$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="IndexedFastaAdapter",i=(0,O.getFileName)(t),o={type:a,fastaLocation:t,faiLocation:n||(0,O.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BgzipFastaAdapter",i=(0,O.getFileName)(t),o={type:a,faiLocation:(0,O.makeIndex)(t,".fai"),gziLocation:(0,O.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}}))}(e)}}]),s}(s.Z)},2085:function(e,t,n){"use strict";n.d(t,{Z:function(){return be}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(97531),u=n(78331),l=n(96902),d=n(91271),f=n(63680),p=n(33991),h=n(99836),g=n(52238),m=n(32723),v=n(34795),y=n(56921),b=n(75717),x=n(68079),w=n(33266),k=n(15996),C=n(66519),Z=n(5738),S=n(25322),T=n(91188),M=n(4782),P=n(29151),R=n(30570);function A(e,t){var n=t.DataCellReactComponent,r=void 0===n?null:n,a=t.FilterModelType,i=void 0===a?null:a,o=t.compare,s=t.displayName,c=void 0===s?void 0:s,u=t.categoryName,l=void 0===u?void 0:u;return f.types.model("ColumnDataType".concat(e),{type:f.types.literal(e)}).volatile((function(){return{DataCellReactComponent:r,FilterModelType:i,displayName:c||e,categoryName:l}})).views((function(){return{compare:o,get hasFilter(){return!!i}}}))}var L=n(29938),N=(0,T.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),j=(0,M.observer)((function(e){var t=e.filterModel,n=N().classes,r=(0,P.getEnumerationValues)((0,P.getSubType)((0,P.getPropertyType)((0,f.getType)(t),"operation")));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(w.Z,{value:t.operation,onChange:function(e){return t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(k.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(C.Z,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:function(e){return t.setLocString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:(0,L.jsx)(Z.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,L.jsx)(S.Z,{"aria-label":"clear filter",onClick:function(){return t.setLocString("")},children:(0,L.jsx)(R.Z,{})})})}})]})})),F=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],I={"overlaps with":function(e,t){return e.refName===t.refName&&(0,c.doesIntersect2)(e.start,e.end,t.start,t.end)},"contained within":function(e,t){return e.refName===t.refName&&(0,c.isContainedWithin)(e.start,e.end,t.start,t.end)},"fully contains":function(e,t){return e.refName===t.refName&&(0,c.isContainedWithin)(t.start,t.end,e.start,e.end)},"does not overlap":function(e,t){return!I["overlaps with"](e,t)},"not contained within":function(e,t){return!I["contained within"](e,t)},"does not contain":function(e,t){return!I["fully contains"](e,t)}},B=f.types.model("ColumnLocStringFilter",{type:f.types.literal("LocString"),columnNumber:f.types.integer,locString:"",operation:f.types.optional(f.types.enumeration(F),F[0])}).views((function(e){return{get locStringIsInvalid(){if(e.locString){var t=this.parsedLocString;return!t||""===t.refName||"number"!==typeof t.start||"number"!==typeof t.end||t.start>t.end}return!1},get parsedLocString(){var t=(0,c.getSession)(e),n=(0,f.getParent)(e,3).spreadsheet.assemblyName;try{return(0,c.parseLocString)(e.locString,(function(e){return t.assemblyManager.isValidRefName(e,n)}))}catch(r){return}}}})).views((function(e){return{get predicate(){var t=e.locString,n=e.locStringIsInvalid,r=e.parsedLocString,a=e.operation,i=e.columnNumber;return t&&!n&&r?function(e,t){var n=t.cellsWithDerived[i];if(!n||!n.text||!n.extendedData)return!1;var o=n.extendedData;if(!o.refName)return!1;var s=I[a];if(!s)throw new Error('"'.concat(a,'" not implemented in location filter'));return s(o,r)}:function(){return!0}}}})).actions((function(e){return{setLocString:function(t){e.locString=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:j}}));function D(e,t,n){return E.apply(this,arguments)}function E(){return(E=(0,v.Z)((0,m.Z)().mark((function e(t,n,r){var a,i,o,s,u,l;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,c.getSession)(t),i=t.assemblyName,o=(0,f.getParent)(t),s=o.id,u="".concat(s,"_").concat(i),(l=a.views.find((function(e){return e.id===u})))||(l=a.addView("LinearGenomeView",{id:u})),e.next=8,l.navToLocString(r.text,i);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=(0,M.observer)((function(e){var t=e.cell,n=e.columnNumber,r=e.spreadsheet;return(0,L.jsx)("a",{onClick:function(){var e=(0,v.Z)((0,m.Z)().mark((function e(a){var i;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),i=(0,c.getSession)(r),e.prev=2,e.next=5,D(r,n,t);case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0),i.notify("".concat(e.t0),"error");case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),title:"open a new linear genome view here",href:"#link",children:t.text})})),z=A("LocString",{categoryName:"Location",displayName:"Full location",compare:function(e,t){return(0,c.compareLocs)(e.extendedData,t.extendedData)},FilterModelType:B,DataCellReactComponent:V}),O=["equals","contains","does not contain","does not equal","starts with","ends with"],W={contains:function(e,t){return-1!==e.toLowerCase().indexOf(t)},equals:function(e,t){return e.toLowerCase()===t},"starts with":function(e,t){return 0===e.toLowerCase().indexOf(t)},"ends with":function(e,t){var n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":function(e,t){return!W.contains(e,t)},"does not equal":function(e,t){return!W.equals(e,t)}},H=(0,T.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),G=(0,M.observer)((function(e){var t=e.filterModel,n=H().classes,r=(0,P.getEnumerationValues)((0,P.getSubType)((0,P.getPropertyType)((0,f.getType)(t),"operation")));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(w.Z,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(k.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(C.Z,{label:"text",value:t.stringToFind,onChange:function(e){return t.setString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:(0,L.jsx)(Z.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,L.jsx)(S.Z,{"aria-label":"clear filter",onClick:function(){return t.setString("")},children:(0,L.jsx)(R.Z,{})})})}})]})})),q=f.types.model("ColumnTextFilter",{type:f.types.literal("Text"),columnNumber:f.types.integer,stringToFind:"",operation:f.types.optional(f.types.enumeration(O),O[0])}).views((function(e){return{get predicate(){var t=e.stringToFind,n=e.columnNumber,r=e.operation;if(!t)return function(){return!0};var a=t.toLowerCase();return function(e,t){var i=t.cellsWithDerived[n];if(!i||!i.text)return!1;var o=W[r];if(!o)throw new Error('"'.concat(r,'" not implemented in location filter'));return o(i.text,a)}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:G}})),U=A("Text",{compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:q}),_=A("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:f.types.compose(q,f.types.model({type:f.types.literal("LocRef")}))}),J=["equals","greater than","less than","between","not between"],X={equals:function(e,t){return e===t},"greater than":function(e,t){return e>t},"less than":function(e,t){return e<t},between:function(e,t,n){return e>t&&void 0!==n&&e<n},"not between":function(e,t,n){return!X.between(e,t,n)}},Y=(0,T.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Q=(0,M.observer)((function(e){var t=e.filterModel,n=Y().classes,r=J;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(w.Z,{value:t.operation,onChange:function(e){return t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(k.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(C.Z,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:function(e){t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:(0,L.jsxs)(L.Fragment,{children:[" and ",(0,L.jsx)(C.Z,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:function(e){return t.setSecondNumber(parseFloat(e.target.value))},className:n.textFilterControl})]})]})})),K=f.types.model("ColumnNumberFilter",{type:f.types.literal("Number"),columnNumber:f.types.integer,firstNumber:f.types.maybe(f.types.number),secondNumber:f.types.maybe(f.types.number),operation:f.types.optional(f.types.enumeration(J),J[0])}).views((function(e){return{get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};var t=e.firstNumber,n=e.secondNumber,r=e.operation,a=e.columnNumber;return function(e,i){var o=i.cellsWithDerived[a];if(!o||!o.text)return!1;var s=parseFloat(o.text);if("number"!==typeof s)return!1;var c=X[r];if(!c)throw new Error('"'.concat(r,'" not implemented in location filter'));return c(s,t,n)}}}})).actions((function(e){return{setFirstNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.firstNumber=void 0:e.firstNumber=t},setSecondNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.secondNumber=void 0:e.secondNumber=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:Q}})),$={Number:A("Number",{compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:K}),Text:U,LocString:z,LocRef:_,LocStart:A("LocStart",{categoryName:"Location",displayName:"Start",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:f.types.compose(K,f.types.model({type:f.types.literal("LocStart")}))}),LocEnd:A("LocEnd",{categoryName:"Location",displayName:"End",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:f.types.compose(K,f.types.model({type:f.types.literal("LocEnd")}))})},ee=Object.values($),te=f.types.union.apply(f.types,ee),ne=f.types.union.apply(f.types,(0,x.Z)(ee.map((function(e){return e.create({type:e.properties.type.value}).FilterModelType})).filter((function(e){return!!e})))),re=f.types.model("SpreadsheetCell",{text:f.types.string,extendedData:f.types.maybe(f.types.frozen())}),ae=f.types.model("SpreadsheetRow",{id:f.types.identifier,cells:f.types.array(re),extendedData:f.types.maybe(f.types.frozen()),isSelected:!1}).actions((function(e){return{toggleSelect:function(){e.isSelected=!e.isSelected},unSelect:function(){e.isSelected=!1},select:function(){e.isSelected=!0},setExtendedData:function(t){e.extendedData=t}}})).views((function(e){return{get cellsWithDerived(){var t=(0,f.getParent)(e,3).columns,n=0;return t.map((function(t){return t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]}))}}})),ie=f.types.model("StaticRowSet",{isLoaded:f.types.literal(!0),rows:f.types.array(ae)}).views((function(e){return{get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){var t=(0,f.getParent)(e);return e.rows.slice().sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((function(e){return e.isSelected}))},get selectedFilteredRows(){var t=(0,f.getParent)(e),n=(0,f.getParent)(t).filterControls;return this.selectedRows.filter((function(e){return n.rowPassesFilters(t,e)}))},get sortedFilteredRows(){var t=(0,f.getParent)(e),n=(0,f.getParent)(t).filterControls;return e.rows.filter((function(e){return n.rowPassesFilters(t,e)})).sort(t.rowSortingComparisonFunction)}}})).actions((function(e){return{unselectAll:function(){e.rows.forEach((function(e){return e.unSelect()}))}}})),oe=f.types.model("ColumnDefinition",{name:f.types.maybe(f.types.string),dataType:f.types.optional(te,(function(){return{type:"Text"}})),isDerived:!1,derivationFunctionText:f.types.maybe(f.types.string)}).views((function(e){return{get expr(){if(e.isDerived)return(0,y.P)(String(e.derivationFunctionText),(0,c.getEnv)(e).pluginManager.jexl)}}})),se=f.types.model("Spreadsheet",{rowSet:f.types.optional(ie,(function(){return ie.create()})),columns:f.types.array(oe),columnDisplayOrder:f.types.array(f.types.number),hasColumnNames:!1,sortColumns:f.types.array(f.types.model("SortColumns",{columnNumber:f.types.number,descending:!1}).actions((function(e){return{switchDirection:function(){e.descending=!e.descending}}}))),assemblyName:f.types.maybe(f.types.string)}).volatile((function(){return{defaultDataType:$.Text,rowMenuPosition:null,isLoaded:!1}})).views((function(e){return{get initialized(){var t,n=(0,c.getSession)(e),r=e.assemblyName;return!!r&&(null===(t=n.assemblyManager.get(r))||void 0===t?void 0:t.initialized)},get hideRowSelection(){return(0,f.getParent)(e).hideRowSelection},get dataTypeChoices(){return Object.keys($).map((function(e){var t=$[e].create({type:e});return{typeName:e,displayName:t.displayName,categoryName:t.categoryName}}))},rowSortingComparisonFunction:function(t,n){for(var r=0;r<e.sortColumns.length;r+=1){var a=e.sortColumns[r],i=a.columnNumber,o=a.descending,s=e.columns[i].dataType.compare(t.cellsWithDerived[i],n.cellsWithDerived[i]);if(s)return o?-s:s}return 0}}})).actions((function(e){return{afterAttach:function(){var t=this;(0,f.addDisposer)(e,(0,b.autorun)((0,v.Z)((0,m.Z)().mark((function n(){var r,a;return(0,m.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(0,c.getSession)(e),a=r.assemblyManager,n.prev=2,!e.assemblyName){n.next=7;break}return n.next=6,a.waitForAssembly(e.assemblyName);case 6:t.setLoaded(!0);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),r.notify("failed to load assembly ".concat(e.assemblyName," ").concat(n.t0),"error");case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))))},setLoaded:function(t){e.isLoaded=t},setRowMenuPosition:function(t){e.rowMenuPosition=t},setSortColumns:function(t){t&&(e.sortColumns=t)},setColumnType:function(t,n){e.columns[t].dataType={type:n}},unselectAll:function(){return e.rowSet.unselectAll()}}})),ce=n(32145),ue=3e7,le=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],de={CSV:function(){return n.e(477).then(n.bind(n,20477)).then((function(e){return e.parseCsvBuffer}))},TSV:function(){return n.e(477).then(n.bind(n,20477)).then((function(e){return e.parseTsvBuffer}))},VCF:function(){return n.e(6157).then(n.bind(n,6157)).then((function(e){return e.parseVcfBuffer}))},BED:function(){return n.e(3207).then(n.bind(n,23207)).then((function(e){return e.parseBedBuffer}))},BEDPE:function(){return n.e(3207).then(n.bind(n,23207)).then((function(e){return e.parseBedPEBuffer}))},"STAR-Fusion":function(){return n.e(9735).then(n.bind(n,29735)).then((function(e){return e.parseSTARFusionBuffer}))}},fe=new RegExp("\\.(".concat(le.join("|"),")(\\.gz)?$"),"i"),pe=f.types.model("SpreadsheetImportWizard",{fileType:f.types.optional(f.types.enumeration(le),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:f.types.maybe(f.types.string)}).volatile((function(){return{fileTypes:le,fileSource:void 0,error:void 0,loading:!1}})).views((function(e){return{get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return(0,f.getParent)(e).readyToDisplay},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName:function(t,n){var r=(0,c.getSession)(e).assemblyManager;return!!n&&r.isValidRefName(t,n)}}})).actions((function(e){return{setSelectedAssemblyName:function(t){e.selectedAssemblyName=t},setFileSource:function(t){if(e.fileSource=t,e.error=void 0,e.fileSource){var n=e.fileName;if(n){var r=fe.exec(n);r&&r[1]&&("tsv"===r[1]&&n.includes("star-fusion")?e.fileType="STAR-Fusion":e.fileType=r[1].toUpperCase())}}},toggleHasColumnNameLine:function(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber:function(t){t>0&&(e.columnNameLineNumber=t)},setFileType:function(t){e.fileType=t},setError:function(t){console.error(t),e.loading=!1,e.error=t},setLoaded:function(){e.loading=!1,e.error=void 0},cancelButton:function(){e.error=void 0,(0,f.getParent)(e).setDisplayMode()},import:function(t){var r=this;return(0,v.Z)((0,m.Z)().mark((function a(){var i,o,s,u,l,d,p;return(0,m.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.fileSource){a.next=2;break}return a.abrupt("return");case 2:if(!e.loading){a.next=4;break}throw new Error("Cannot import, load already in progress");case 4:return e.selectedAssemblyName=t,e.loading=!0,i=e.fileType,a.next=9,de[i]();case 9:if(o=a.sent){a.next=12;break}throw new Error("cannot open files of type '".concat(e.fileType,"'"));case 12:return a.next=14,Promise.all([n.e(7221),n.e(6959)]).then(n.bind(n,16959));case 14:return s=a.sent,u=s.unzip,l=(0,c.getEnv)(e),d=l.pluginManager,p=(0,ce.openLocation)(e.fileSource,d),a.prev=18,a.next=21,p.stat();case 21:if(!(a.sent.size>ue)){a.next=24;break}throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."));case 24:a.next=29;break;case 26:a.prev=26,a.t0=a.catch(18),console.warn(a.t0);case 29:return a.prev=29,a.next=32,p.readFile().then((function(t){return e.requiresUnzip?u(t):t})).then((function(t){return o(t,e)})).then((function(t){r.setLoaded(),(0,f.getParent)(e).displaySpreadsheet(t)}));case 32:a.next=37;break;case 34:a.prev=34,a.t1=a.catch(29),r.setError(a.t1);case 37:case"end":return a.stop()}}),a,null,[[18,26],[29,34]])})))()}}})),he=f.types.model("RowFullTextFilter",{type:f.types.literal("RowFullText"),stringToFind:""}).views((function(e){return{get predicate(){var t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){for(var r=n.cellsWithDerived,a=0;a<r.length;a+=1){var i=r[a];if(i.text&&i.text.toLowerCase().includes(t))return!0}return!1}):function(){return!0}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},clear:function(){e.stringToFind=""}}})),ge=f.types.model("SpreadsheetFilterControls",{rowFullText:f.types.optional(he,(function(){return{type:"RowFullText",stringToFind:""}})),columnFilters:f.types.array(ne)}).views((function(e){return{get filters(){return[e.rowFullText].concat((0,x.Z)(e.columnFilters)).filter((function(e){return!!e}))},setRowFullTextFilter:function(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters:function(e,t){for(var n=0;n<this.filters.length;n+=1)if(!this.filters[n].predicate(e,t))return!1;return!0}}})).actions((function(e){return{addBlankColumnFilter:function(t){var n=(0,f.getParent)(e).spreadsheet.columns[t].dataType;e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:function(t){return e.columnFilters.remove(t)},clearAllFilters:function(){e.columnFilters.clear(),e.rowFullText.clear()}}})),me=[{label:"Toggle select",icon:g.Z,onClick:function(e,t){var n,r=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==r&&t.rowSet.rows[+r-1].toggleSelect()}}],ve=f.types.model("SpreadsheetView",{type:f.types.literal("SpreadsheetView"),offsetPx:0,height:f.types.optional(f.types.refinement("SpreadsheetViewHeight",f.types.number,(function(e){return e>=40})),440),hideViewControls:!1,hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:f.types.optional(ge,(function(){return ge.create({})})),mode:f.types.optional(f.types.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:f.types.optional(pe,(function(){return pe.create()})),spreadsheet:f.types.maybe(se)}).volatile((function(){return{width:400,rowMenuItems:me}})).views((function(e){return{get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!(0,f.getEnv)(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){var t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){var t,n=null===(t=e.spreadsheet)||void 0===t?void 0:t.assemblyName;if(n){var r=(0,c.getSession)(e).assemblies;return null===r||void 0===r?void 0:r.find((function(e){return(0,h.readConfObject)(e,"name")===n}))}}}})).actions((function(e){return{setRowMenuItems:function(t){e.rowMenuItems=t},setWidth:function(t){return e.width=t,e.width},setHeight:function(t){return e.height=t>40?t:40,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},resizeWidth:function(t){var n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet:function(t){e.filterControls.clearAllFilters(),e.spreadsheet=(0,f.cast)(t),e.mode="display"},setImportMode:function(){e.mode="import"},setDisplayMode:function(){e.readyToDisplay&&(e.mode="display")},closeView:function(){(0,f.getParent)(e,2).removeView(e)}}})),ye=f.types.compose(p.BaseViewModel,ve),be=function(e){(0,i.Z)(s,e);var t=(0,o.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SpreadsheetViewPlugin",e}return(0,a.Z)(s,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new d.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:ye,ReactComponent:(0,l.lazy)((function(){return Promise.all([n.e(534),n.e(6219)]).then(n.bind(n,46219))}))})}))}(e),function(e){e.addToExtensionPoint("LaunchView-SpreadsheetView",function(){var e=(0,v.Z)((0,m.Z)().mark((function e(t){var n,r,a,i,o,s,c,u,l;return(0,m.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.session,a=t.assembly,i=t.uri,o=t.fileType,s=r.addView("SpreadsheetView")){e.next=4;break}throw new Error("Failed to initialize view");case 4:return c=i.split("."),"GZ"===(u=null===c||void 0===c||null===(n=c.pop())||void 0===n?void 0:n.toUpperCase())&&(u=null===c||void 0===c||null===(l=c.pop())||void 0===l?void 0:l.toUpperCase()),s.importWizard.setFileType(o||u||""),s.importWizard.setSelectedAssemblyName(a),s.importWizard.setFileSource({uri:i,locationType:"UriLocation"}),e.next=12,s.importWizard.import(a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}(e)}},{key:"configure",value:function(e){var t=e.rootModel;(0,c.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:u.Z,onClick:function(e){e.addView("SpreadsheetView",{})}})}}]),s}(s.Z)},49113:function(e,t,n){"use strict";n.d(t,{Z:function(){return H}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(87977),c=n(73),u=n(42692),l=n(65317),d=(n(96902),n(4782)),f=n(54417),p=n(25322),h=n(80367),g=n(32114),m=n(91188),v=n(46186),y=n(93472),b=n(29938),x=(0,m.ZL)()((function(e){return{resizeHandle:{width:4,background:e.palette.action.selected,boxSizing:"border-box",borderTop:"1px solid #fafafa"},root:{marginBottom:e.spacing(1),overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52},viewControls:{margin:0},viewsContainer:{display:"flex"},spreadsheetViewContainer:{borderRight:"1px solid #ccc",overflow:"hidden"},circularViewOptions:{padding:e.spacing(1)}}})),w=(0,d.observer)((function(e){var t=e.model,n=x().classes;return(0,b.jsx)(f.ZP,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center",children:(0,b.jsx)(f.ZP,{item:!0,children:(0,b.jsx)(p.Z,{onClick:function(){return t.setImportMode()},title:"open a tabular file","data-testid":"sv_inspector_view_open",children:(0,b.jsx)(y.Z,{})})})})})),k=(0,d.observer)((function(e){var t=e.svInspector,n=x().classes;return(0,b.jsx)(f.ZP,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight},children:(0,b.jsx)(f.ZP,{item:!0,children:(0,b.jsx)(h.Z,{control:(0,b.jsx)(g.Z,{checked:t.onlyDisplayRelevantRegionsInCircularView,onChange:function(e){return t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}}),label:"show only regions with data"})})})}));var C=(0,d.observer)((function(e){var t=e.model,n=x().classes,r=t.resizeHeight,a=t.dragHandleHeight,i=t.SpreadsheetViewReactComponent,o=t.CircularViewReactComponent,s=t.showCircularView;return(0,b.jsxs)("div",{className:n.root,"data-testid":t.id,children:[(0,b.jsx)(f.ZP,{container:!0,direction:"row",className:n.header,children:(0,b.jsx)(f.ZP,{item:!0,children:(0,b.jsx)(w,{model:t})})}),(0,b.jsxs)("div",{className:n.viewsContainer,children:[(0,b.jsx)("div",{className:n.spreadsheetViewContainer,children:(0,b.jsx)(i,{model:t.spreadsheetView})}),s?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.ResizeHandle,{onDrag:function(e){var n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,className:n.resizeHandle}),(0,b.jsxs)("div",{style:{width:t.circularView.width},children:[(0,b.jsx)(k,{svInspector:t}),(0,b.jsx)(o,{model:t.circularView})]})]}):null]}),(0,b.jsx)(v.ResizeHandle,{onDrag:r,style:{height:a,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}})]})})),Z=n(32723),S=n(34795),T=n(16403),M=n(73636),P=n.n(M),R=n(97531),A=n(75717),L=n(99836),N=n(63680),j=n(42328),F=n(33991),I=n(43430),B=n(33028);function D(e,t,n,r,a,i){var o={};return e.forEach((function(e,r){if(!t.includes(r)){var a=n.cells[r].text;"Number"===e.dataType.type&&(a=parseFloat(a)),o[e.name]=a}})),(0,B.Z)((0,B.Z)({},o),{},{uniqueId:"sv-inspector-adhoc-".concat(i),refName:r.refName,start:r.start,end:r.end,mate:{refName:a.refName,start:a.start,end:a.end}})}function E(e,t,n,r){var a=e.columns,i=e.columnDisplayOrder,o={};i.forEach((function(e){var t=a[e];o[t.dataType.type]||(o[t.dataType.type]=[]),o[t.dataType.type].push(e)}));var s=o.LocString||[],c=o.LocStart||[],u=o.LocEnd||[],l=o.LocRef||[];return s.length>=2?function(e,t,n,r,a){var i=(0,R.parseLocString)(n.cells[t[0]].text,a),o=(0,R.parseLocString)(n.cells[t[1]].text,a);return D(e,[t[0],t[1]],n,i,o,r)}(a,s,n,t,r):l.length>=2&&c.length>=2&&u.length>=2?function(e,t,n,r,a,i){var o=function(e){return a.cells[e].text},s={refName:o(t[0]),start:parseInt(o(n[0]),10)-1,end:parseInt(o(r[0]),10)},c={refName:o(t[1]),start:parseInt(o(n[1]),10)-1,end:parseInt(o(r[1]),10)};return D(e,[t[0],n[0],r[0],t[1],n[1],r[1]],a,s,c,i)}(a,l,c,u,n,t):void 0}function V(e,t,n,r){if(n.extendedData){if(n.extendedData.vcfFeature)return n.extendedData.vcfFeature;if(n.extendedData.feature)return n.extendedData.feature}var a=E(t.spreadsheet,r,n,e.assemblyManager.isValidRefName);if(a)return a}function z(e,t,n,r,a){var i=(0,R.getEnv)(e).pluginManager,o=(0,R.getSession)(t),s=V(o,n,r,a);if(s){var c=new I.Z(s);o.setSelection(c);var u=i.getViewType("BreakpointSplitView"),l=e.circularView;return u.snapshotFromBreakendFeature(c,l)}}function O(e,t,n){var r=(0,R.getSession)(t);r.setSelection(e);var a=(0,R.getContainingView)(t),i=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,a);i.views[0].offsetPx-=a.width/2+100,i.views[1].offsetPx-=a.width/2+100,i.featureData=e.toJSON(),r.addView("BreakpointSplitView",i)}var W=function(e){var t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=t.stateModel,a=n.stateModel,i=N.types.model("SvInspectorView",{id:j.ElementId,type:N.types.literal("SvInspectorView"),dragHandleHeight:4,height:N.types.optional(N.types.refinement("SvInspectorViewHeight",N.types.number,(function(e){return e>=400})),550),onlyDisplayRelevantRegionsInCircularView:!1,mode:N.types.optional(N.types.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:N.types.optional(r,(function(){return r.create({type:"SpreadsheetView",hideViewControls:!0,hideVerticalResizeHandle:!0})})),circularView:N.types.optional(a,(function(){return a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})}))}).volatile((function(){return{width:800}})).views((function(t){return{get selectedRows(){return t.spreadsheetView.rowSet.selectedRows},get assemblyName(){var e=t.spreadsheetView.assembly;return e?(0,L.readConfObject)(e,"name"):void 0},get showCircularView(){return"display"===t.spreadsheetView.mode},get featuresAdapterConfigSnapshot(){var e=(0,R.getSession)(t),n=t.spreadsheetView,r=n.outputRows;return{type:"FromConfigAdapter",features:(void 0===r?[]:r).map((function(t,r){return V(e,n,t,r)})).filter((function(e){return!!e}))}},get featuresRefNamesP(){return(0,e.getAdapterType("FromConfigAdapter").getAdapterClass)().then((function(e){return new e(t.featuresAdapterConfigSnapshot).getRefNames()}))},get featuresCircularTrackConfiguration(){return e.jexl.addFunction("defaultOnChordClick",O),{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(t.id),name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(t.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}})).volatile((function(){return{SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52}})).actions((function(e){return{setWidth:function(t){e.width=t},setHeight:function(t){return e.height=t>400?t:400,e.height},setImportMode:function(){e.spreadsheetView.setImportMode()},setDisplayMode:function(){e.spreadsheetView.setDisplayMode()},closeView:function(){(0,N.getParent)(e,2).removeView(e)},setDisplayedRegions:function(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView:function(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}})).actions((function(e){return{resizeHeight:function(t){var n=e.height;return e.setHeight(e.height+t)-n},afterAttach:function(){(0,N.addDisposer)(e,(0,A.autorun)((function(){if(e.showCircularView){var t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,N.addDisposer)(e,(0,A.autorun)((function(){e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,N.addDisposer)(e,(0,A.autorun)((0,S.Z)((0,Z.Z)().mark((function t(){var n,r,a,i,o,s,c,u,l,d,f,p,h;return(0,Z.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.assemblyName,r=e.onlyDisplayRelevantRegionsInCircularView,a=e.circularView,i=e.featuresRefNamesP,o=a.tracks,s=(0,R.getSession)(e),n){t.next=5;break}return t.abrupt("return");case 5:return c=s.assemblyManager,t.next=8,c.waitForAssembly(n);case 8:if(u=t.sent){t.next=12;break}return a.setDisplayedRegions([]),t.abrupt("return");case 12:if(l=u.getCanonicalRefName,d=u.regions,f=void 0===d?[]:d,!r){t.next=28;break}if(1!==o.length){t.next=26;break}return t.prev=15,t.next=18,i;case 18:p=t.sent,h=new Set(p.map((function(e){return l(e)||e}))),a.setDisplayedRegions(P()(f.filter((function(e){return h.has(e.refName)})))),t.next=26;break;case 23:t.prev=23,t.t0=t.catch(15),a.setError(t.t0);case 26:t.next=29;break;case 28:a.setDisplayedRegions(f);case 29:case"end":return t.stop()}}),t,null,[[15,23]])}))),{name:"SvInspectorView displayed regions bind"})),(0,N.addDisposer)(e,(0,A.reaction)((function(){return{generatedTrackConf:null===e||void 0===e?void 0:e.featuresCircularTrackConfiguration,assemblyName:null===e||void 0===e?void 0:e.assemblyName}}),(function(t){if(t){var n=t.assemblyName,r=t.generatedTrackConf;e.circularView.tracks.forEach((function(t){e.circularView.hideTrack(t.configuration.trackId)})),n&&r&&e.circularView.addTrackConf(r,{assemblyName:n})}}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),(0,N.addDisposer)(e,(0,A.autorun)((function(){e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:T.Z,disabled:function(t,n,r,a){return!function(e,t,n,r,a){try{var i=z(e,t,n,r,a);return Boolean(i)}catch(o){return console.error("Unable to open breakpoint split view from table row",o),!1}}(e,t,n,a,r)},onClick:function(t,n,r,a){!function(e,t,n,r,a){var i=z(e,t,n,r,a);if(i){var o=e.circularView;i.views[0].offsetPx-=o.width/2+100,i.views[1].offsetPx-=o.width/2+100,(0,R.getSession)(t).addView("BreakpointSplitView",i)}}(e,t,n,a,r)}}])})))}}}));return{stateModel:N.types.compose(F.BaseViewModel,i)}},H=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="SvInspectorViewPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){!function(e){e.addViewType((function(){var t=W(e).stateModel;return new l.Z({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:C})}))}(e),function(e){e.addToExtensionPoint("LaunchView-SvInspectorView",function(){var e=(0,S.Z)((0,Z.Z)().mark((function e(t){var n,r,a,i,o,s,c,u,l;return(0,Z.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.session,a=t.assembly,i=t.uri,o=t.fileType,s=r.addView("SvInspectorView")){e.next=4;break}throw new Error("Failed to initialize view");case 4:return c=i.split("."),"GZ"===(u=null===c||void 0===c||null===(n=c.pop())||void 0===n?void 0:n.toUpperCase())&&(u=null===c||void 0===c||null===(l=c.pop())||void 0===l?void 0:l.toUpperCase()),s.spreadsheetView.importWizard.setFileType(o||u||""),s.spreadsheetView.importWizard.setSelectedAssemblyName(a),s.spreadsheetView.importWizard.setFileSource({uri:i,locationType:"UriLocation"}),e.next=12,s.spreadsheetView.importWizard.import(a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}(e)}},{key:"configure",value:function(e){(0,c.J0)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:u.Z,onClick:function(e){e.addView("SvInspectorView",{})}})}}]),n}(s.Z)},57482:function(e,t,n){"use strict";n.d(t,{ZP:function(){return Q}});var r=n(87371),a=n(9249),i=n(45754),o=n(13820),s=n(66568),c=n(87977),u=n(96234),l=n(68079),d=n(33028),f=n(96902),p=n(4782),h=n(99836),g=n(97531),m=n(70577),v=n(88636),y=n(63680),b=n(29938),x=(0,p.observer)((function(e){var t=e.text,n=e.x,r=e.y,a=e.region,i=e.reversed,o=e.bpPerPx,s=e.exportSVG,c=e.feature,l=e.viewParams,d=e.color,p=void 0===d?"black":d,h=e.fontHeight,m=void 0===h?13:h,x=e.featureWidth,w=void 0===x?0:x,k=e.allowedWidthExpansion,C=void 0===k?0:k,Z=e.displayModel,S=void 0===Z?{}:Z,T=w+C,M=(0,g.measureText)(t,m),P=(0,y.isStateTreeNode)(S)&&(0,y.isAlive)(S)?(0,g.getViewParams)(S):l,R=i?P.end:P.start,A=(0,f.useState)(s),L=(0,u.Z)(A,2),N=L[0],j=L[1],F=(0,v.Z)();if((0,f.useEffect)((function(){j(!0)}),[]),(0,y.isStateTreeNode)(a)&&!(0,y.isAlive)(a))return null;var I=a.start,B=a.end,D=c.get("start"),E=c.get("end"),V=M*o;return R<B&&R>I&&D<R&&R+V<E?n=P.offsetPx:D<R&&R+V<E&&R+V>I&&R+V<B&&(n=P.offsetPx1),N?(0,b.jsx)("text",{x:n,y:r+m,fill:"#f0f"===p?F.palette.text.primary:p,fontSize:m,children:M>T?"".concat(t.slice(0,T/(.6*m)),"..."):t}):null}));var w=(0,p.observer)((function(e){var t,n,r,a,i=e.feature,o=e.rootLayout,s=e.config,c=e.name,u=e.description,l=e.shouldShowName,f=e.shouldShowDescription,p=o.getSubRecord(String(i.id()));if(!p)return null;var g=(p.data||{}).GlyphComponent;return(0,b.jsxs)("g",{children:[(0,b.jsx)(g,(0,d.Z)({featureLayout:p},e)),l?(0,b.jsx)(x,(0,d.Z)({text:c,x:(null===(t=o.getSubRecord("nameLabel"))||void 0===t?void 0:t.absolute.left)||0,y:(null===(n=o.getSubRecord("nameLabel"))||void 0===n?void 0:n.absolute.top)||0,color:(0,h.readConfObject)(s,["labels","nameColor"],{feature:i}),featureWidth:p.width},e)):null,f?(0,b.jsx)(x,(0,d.Z)({text:u,x:(null===(r=o.getSubRecord("descriptionLabel"))||void 0===r?void 0:r.absolute.left)||0,y:(null===(a=o.getSubRecord("descriptionLabel"))||void 0===a?void 0:a.absolute.top)||0,color:(0,h.readConfObject)(s,["labels","descriptionColor"],{feature:i}),featureWidth:p.width},e)):null]})})),k=n(59740),C=["rect","region","bpPerPx"],Z=["displayModel","blockKey","region","bpPerPx","movedDuringLastMouseDown"];function S(e){var t=e.rect,n=e.region,r=e.bpPerPx,a=(0,k.Z)(e,C);if(!t)return null;var i=(0,u.Z)(t,4),o=i[0],s=i[1],c=i[2],l=i[3],f=(0,g.bpSpanPx)(o,c,n,r),p=(0,u.Z)(f,2),h=p[0],m=p[1],v=Math.round(s),y=(n.end-n.start)/r,x=Math.round(l-s),w=m-h;if(h+w<0)return null;var Z=Math.max(h,0),S=Z-h,T=Math.max(1,Math.min(w-S,y));return(0,b.jsx)("rect",(0,d.Z)({x:Z-2,y:v-2,width:T+4,height:x+4},a))}var T=(0,p.observer)((function(e){var t,n,r=e.displayModel,a=void 0===r?{}:r,i=e.blockKey,o=e.region,s=e.bpPerPx,c=e.movedDuringLastMouseDown,u=(0,k.Z)(e,Z),l=a.selectedFeatureId,d=a.featureIdUnderMouse,f=a.contextMenuFeature,p=d||(null===f||void 0===f?void 0:f.id());function h(e){var t=u.onFeatureMouseOut;if(t&&p)return t(e,p)}function g(e){var t=u.onFeatureMouseOver;if(t&&p)return t(e,p)}return(0,b.jsxs)(b.Fragment,{children:[p?(0,b.jsx)(S,{rect:null===(t=a.getFeatureByID)||void 0===t?void 0:t.call(a,i,p),region:o,bpPerPx:s,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){var t=u.onFeatureMouseDown;if(t&&p)return t(e,p)},onMouseEnter:function(e){var t=u.onFeatureMouseEnter;if(t&&p)return t(e,p)},onMouseOut:h,onMouseOver:g,onMouseUp:function(e){var t=u.onFeatureMouseUp;if(t&&p)return t(e,p)},onMouseLeave:function(e){var t=u.onFeatureMouseLeave;if(t&&p)return t(e,p)},onMouseMove:function(e){var t=u.onFeatureMouseMove;if(t&&p)return t(e,p)},onClick:function(e){if(!c){var t=u.onFeatureClick;if(t&&p)return e.stopPropagation(),t(e,p)}},onContextMenu:function(e){var t=u.onFeatureContextMenu;if(t&&p)return t(e,p)},onFocus:g,onBlur:h,"data-testid":p}):null,l?(0,b.jsx)(S,{rect:null===(n=a.getFeatureByID)||void 0===n?void 0:n.call(a,i,l),region:o,bpPerPx:s,stroke:"#00b8ff",fill:"none"}):null]})})),M=(0,p.observer)((function(e){var t=e.feature,n=e.featureLayout,r=e.config,a=e.region,i=t.get("strand"),o=a.reversed?-1:1,s=7*i*o,c=n.absolute,u=c.left,l=void 0===u?0:u,d=c.top,f=void 0===d?0:d,p=c.width,g=void 0===p?0:p,m=c.height,y=void 0===m?0:m,x=(0,h.readConfObject)(r,"color2",{feature:t}),w=(0,v.Z)(),k="#f0f"===x?w.palette.text.disabled:x,C=i*o===-1?l:i*o===1?l+g:null,Z=f+y/2;return C?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("line",{x1:C,x2:C+s,y1:Z,y2:Z,stroke:k}),(0,b.jsx)("polygon",{points:[[C+s/2,Z-2.5],[C+s/2,Z+2.5],[C+s,Z]].toString(),stroke:k,fill:k})]}):null})),P=.65;var R=(0,p.observer)((function(e){var t=e.feature,n=e.region,r=e.config,a=e.featureLayout,i=e.bpPerPx,o=e.topLevel,s=n.start,c=(n.end-s)/i,u=(t.get("end")-t.get("start"))/i,l=a.absolute.left,f=void 0===l?0:l,p=a.absolute,g=p.top,m=void 0===g?0:g,v=p.height,y=void 0===v?0:v;if(f+u<0)return null;W(t)&&(m+=(1-P)/2*y,y*=P);var x=Math.max(f,0),w=x-f,k=Math.max(2,Math.min(u-w,c));return t.parent()&&"intron"===t.get("type")?null:(0,b.jsxs)(b.Fragment,{children:[o?(0,b.jsx)(M,(0,d.Z)({},e)):null,(0,b.jsx)("rect",{"data-testid":"box-".concat(t.id()),x:x,y:m,width:k,height:y,fill:W(t)?(0,h.readConfObject)(r,"color3",{feature:t}):(0,h.readConfObject)(r,"color1",{feature:t}),stroke:(0,h.readConfObject)(r,"outline",{feature:t})})]})}));var A=(0,p.observer)((function(e){var t=e.feature,n=e.featureLayout,r=e.selected,a=e.config,i=e.subfeatures,o=void 0===i?t.get("subfeatures"):i,s=(0,v.Z)(),c=(0,h.readConfObject)(a,"color2",{feature:t}),u="#f0f"===c?s.palette.text.disabled:c,l=n.absolute,f=l.left,p=void 0===f?0:f,g=l.top,m=void 0===g?0:g,y=l.width,x=void 0===y?0:y,w=l.height,k=m+(void 0===w?0:w)/2;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("line",{"data-testid":t.id(),x1:p,y1:k,y2:k,x2:p+x,stroke:u}),null===o||void 0===o?void 0:o.map((function(t){var a=String(t.id()),i=n.getSubRecord(a);if(!i)return null;var o=(i.data||{}).GlyphComponent;return(0,b.jsx)(o,(0,d.Z)((0,d.Z)({},e),{},{feature:t,topLevel:!1,featureLayout:i,selected:r}),"glyph-".concat(a))})),(0,b.jsx)(M,(0,d.Z)({},e))]})}));function L(e){var t=F(e.feature,e.config);return(0,b.jsx)(A,(0,d.Z)((0,d.Z)({},e),{},{subfeatures:t}))}function N(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=(0,h.readConfObject)(t,e);return"string"==typeof n&&(n=n.split(/\s*,\s*/)),function(e){return n.map((function(e){return e.toLowerCase()})).includes(e.get("type").toLowerCase())}}("subParts",t)(e)}function j(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function F(e,t){var n=e.get("subfeatures");if(!n||!n.length)return[];var r=!!n.find((function(e){return j(e)})),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||(0,h.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){for(var n,r,a=(0,l.Z)(t),i=1/0,o=-1/0,s=[],c=0;c<a.length;c++){var u=a[c].get("type");/^cds/i.test(u)?(i>a[c].get("start")&&(i=a[c].get("start")),o<a[c].get("end")&&(o=a[c].get("end"))):/exon/i.test(u)?s.push(a[c]):j(a[c])&&(n=a[c].get("start")===e.get("start"),r=a[c].get("end")===e.get("end"))}if(!(s.length&&i<1/0&&o>-1/0))return a;s.sort((function(e,t){return e.get("start")-t.get("start")}));var d,f,p=e.get("strand");if(!n)for(var h=0;h<s.length&&!((d=s[h].get("start"))>=i);h++){f=i>s[h].get("end")?s[h].get("end"):i;var m=p>=0?"five_prime_UTR":"three_prime_UTR";a.unshift(new g.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(m,"_").concat(h),data:{start:d,end:f,strand:p,type:m}}))}if(!r)for(var v=s.length-1;v>=0&&!((f=s[v].get("end"))<=o);v--){d=o<s[v].get("start")?s[v].get("start"):o;var y=p>=0?"three_prime_UTR":"five_prime_UTR";a.push(new g.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(y,"_").concat(v),data:{start:d,end:f,strand:p,type:y}}))}return a}(e,n)),n.filter((function(e){return N(e,t)}))}L.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=z({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o});return O({layout:s,subfeatures:F(n,i),bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),s};var I=(0,p.observer)(L);function B(e){var t,n=e.feature,r=e.featureLayout,a=e.selected;return(0,b.jsx)(b.Fragment,{children:null===(t=n.get("subfeatures"))||void 0===t?void 0:t.map((function(t){var n=String(t.id()),i=r.getSubRecord(n);if(!i)return null;var o=(i.data||{}).GlyphComponent;return(0,b.jsx)(o,(0,d.Z)((0,d.Z)({},e),{},{feature:t,featureLayout:i,selected:a}),"glyph-".concat(n))}))})}B.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=z({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),c=(0,h.readConfObject)(i,"displayMode");if("reducedRepresentation"!==c){var u,l=0;null===(u=n.get("subfeatures"))||void 0===u||u.forEach((function(e){var t=E(e,o),n=(0,h.readConfObject)(i,"height",{feature:e});(t.layOut||V)({layout:s,feature:e,bpPerPx:r,reversed:a,config:i,extraGlyphs:o}).move(0,l),l+="collapse"===c?0:("compact"===c?n/3:n)+2}))}return s};var D=(0,p.observer)(B);function E(e,t){var n,r=e.get("type"),a=e.get("subfeatures");if(a&&"CDS"!==r){var i=a.find((function(e){return!!e.get("subfeatures")}));return["mRNA","transcript","primary_transcript"].includes(r)&&a.find((function(e){return"CDS"===e.get("type")}))?I:!e.parent()&&i?D:A}return(null===t||void 0===t||null===(n=t.find((function(t){return t.validator(e)})))||void 0===n?void 0:n.glyph)||R}function V(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=(0,h.readConfObject)(i,"displayMode"),c=z({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o});return"reducedRepresentation"!==s&&O({layout:c,subfeatures:n.get("subfeatures")||[],bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),c}function z(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=(0,h.readConfObject)(i,"displayMode"),c="reducedRepresentation"===s?R:E(n,o),u=n.parent(),l=0;u&&(l=(a?u.get("end")-n.get("end"):n.get("start")-u.get("start"))/r);var d=(0,h.readConfObject)(i,"height",{feature:n}),f=(n.get("end")-n.get("start"))/r,p=t.parent,g=p?p.top:0;return t.addChild(String(n.id()),l,"collapse"===s?0:g,Math.max(f,1),"compact"===s?d/2:d,{GlyphComponent:c})}function O(e){var t=e.layout,n=e.subfeatures,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs;n.forEach((function(e){(E(e,o).layOut||V)({layout:t,feature:e,bpPerPx:r,reversed:a,config:i,extraGlyphs:o})}))}function W(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}var H=2,G=2,q=100;function U(e){var t=e.feature,n=e.detectRerender,r=e.bpPerPx,a=e.region,i=e.config,o=e.displayMode,s=e.layout,c=e.extraGlyphs;null===n||void 0===n||n();var u=a.reversed,l=t.get(u?"end":"start"),f=(0,g.bpToPx)(l,a,r),p="collapsed"!==o,v=new m.SceneGraph("root",0,0,0,0),y=(E(t,c).layOut||V)({layout:v,feature:t,bpPerPx:r,reversed:u,config:i,extraGlyphs:c}),x=!1,k=!1,C="",Z="",S=0,T=0;if(p){var M=(0,h.readConfObject)(i,"showLabels"),P=(0,h.readConfObject)(i,"showDescriptions");S=(0,h.readConfObject)(i,["labels","fontSize"],{feature:t}),T=(0,h.readConfObject)(i,"maxFeatureGlyphExpansion")||0,C=String((0,h.readConfObject)(i,["labels","name"],{feature:t})||""),x=/\S/.test(C)&&M;var R=function(e){var t=v.width+T,n=(0,g.measureText)(e,S);return Math.round(Math.min(n,t))+H};if(Z=String((0,h.readConfObject)(i,["labels","description"],{feature:t})||""),k=/\S/.test(Z)&&P,x&&v.addChild("nameLabel",0,y.bottom+G,R(C),S),k){var A=x?v.getSubRecord("nameLabel"):y;v.addChild("descriptionLabel",0,A.bottom+G,R(Z),S)}}var L=s.addRect(t.id(),t.get("start"),t.get("start")+v.width*r,v.height);return null===L?null:(v.move(f,L),(0,b.jsx)(w,(0,d.Z)({rootLayout:v,name:C,shouldShowName:x,description:Z,shouldShowDescription:k,fontHeight:S,allowedWidthExpansion:T,reversed:a.reversed,topLevel:!0},e)))}var _=(0,p.observer)((function(e){var t=e.features,n=void 0===t?new Map:t,r=e.isFeatureDisplayed;return(0,b.jsx)(b.Fragment,{children:(0,l.Z)(n.values()).filter((function(e){return!r||r(e)})).map((function(t){return(0,b.jsx)(U,(0,d.Z)({feature:t},e),t.id())}))})}));var J=(0,p.observer)((function(e){var t=e.layout,n=e.blockKey,r=e.regions,a=e.bpPerPx,i=e.config,o=e.displayModel,s=void 0===o?{}:o,c=e.exportSVG,l=e.featureDisplayHandler,p=e.onMouseOut,g=e.onMouseDown,m=e.onMouseLeave,v=e.onMouseEnter,y=e.onMouseOver,x=e.onMouseMove,w=e.onMouseUp,k=e.onClick,C=r||[],Z=(0,u.Z)(C,1)[0],S=(Z.end-Z.start)/a,M=(0,h.readConfObject)(i,"displayMode"),P=(0,f.useRef)(null),R=(0,f.useState)(!1),A=(0,u.Z)(R,2),L=A[0],N=A[1],j=(0,f.useState)(0),F=(0,u.Z)(j,2),I=F[0],B=F[1],D=(0,f.useState)(!1),E=(0,u.Z)(D,2),V=E[0],z=E[1],O=(0,f.useCallback)((function(e){return N(!0),z(!1),null===g||void 0===g?void 0:g(e)}),[g]),W=(0,f.useCallback)((function(e){return N(!1),null===w||void 0===w?void 0:w(e)}),[w]),H=(0,f.useCallback)((function(e){var t;if(P.current){L&&z(!0);var r=P.current.getBoundingClientRect(),i=r.left,o=r.top,c=e.clientX-i,u=e.clientY-o,l=Z.reversed?S-c:c,d=Z.start+a*l,f=null===(t=s.getFeatureOverlapping)||void 0===t?void 0:t.call(s,n,d,u);x&&x(e,f)}}),[n,a,L,x,Z.reversed,Z.start,s,S]),G=(0,f.useCallback)((function(e){V||null===k||void 0===k||k(e)}),[V,k]);return(0,f.useEffect)((function(){B(t.getTotalHeight())}),[t]),c?(0,b.jsx)(_,(0,d.Z)({displayMode:M,isFeatureDisplayed:l,region:Z},e)):(0,b.jsxs)("svg",{ref:P,"data-testid":"svgfeatures",width:S,height:I+q,onMouseDown:O,onMouseUp:W,onMouseEnter:v,onMouseLeave:m,onMouseOver:y,onMouseOut:p,onMouseMove:H,onClick:G,children:[(0,b.jsx)(_,(0,d.Z)({displayMode:M,region:Z,movedDuringLastMouseDown:V,isFeatureDisplayed:l},e)),(0,b.jsx)(T,(0,d.Z)((0,d.Z)({},e),{},{region:Z,movedDuringLastMouseDown:V}))]})}));var X=(0,h.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,h.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:y.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0}),Y=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,r.Z)(n)}(s.default),Q=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="SVGPlugin",e}return(0,r.Z)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new Y({name:"SvgFeatureRenderer",ReactComponent:J,configSchema:X,pluginManager:e})}))}}]),n}(c.Z)},89782:function(e,t,n){"use strict";n.d(t,{Z:function(){return k}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(28204),c=n(87977),u=n(32723),l=n(46840),d=n(96234),f=n(34795),p=n(82932),h=n(82972),g=n(32145),m=n(17168),v=n(99836);function y(e){try{return decodeURIComponent(e)}catch(t){return e}}function b(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,r-n)>0?"...":"")+e.slice(Math.max(0,r-n),r+t.length+n).trim()+(r+t.length<e.length?"...":"")}var x=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).indexingAttributes=void 0,o.trixJs=void 0,o.tracksNames=void 0;var s=(0,v.readConfObject)(e,"ixFilePath"),c=(0,v.readConfObject)(e,"ixxFilePath");if(!s)throw new Error("must provide out.ix");if(!c)throw new Error("must provide out.ixx");return o.trixJs=new p.Z((0,g.openLocation)(c),(0,g.openLocation)(s),1500),o}return(0,a.Z)(n,[{key:"searchIndex",value:function(){var e=(0,f.Z)((0,u.Z)().mark((function e(t){var n,r,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryString.toLowerCase(),r=n.split(" "),e.next=4,this.trixJs.search(n);case 4:if(a=e.sent,i=a.filter((function(e){var t=(0,d.Z)(e,2)[1];return r.every((function(e){return y(t).toLowerCase().includes(e)}))})).map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1],a=JSON.parse(r.replace(/\|/g,",")),i=a.map((function(e){return y(e)})),o=(0,l.Z)(i),s=o[0],c=o[1],u=o.slice(2),f=u.findIndex((function(e){return!!e})),p=u.map((function(e){return e.toLowerCase()})).findIndex((function(e){return-1!==e.indexOf(n.toLowerCase())})),h=u[f],g=u[p],v=-1!==p?b(g,n):void 0,x=b(h,n),w=v&&x.toLowerCase()!==v.toLowerCase()?"".concat(x," (").concat(v,")"):x;return new m.Z({locString:s,label:h,displayString:w,matchedObject:a.map((function(e){return decodeURIComponent(e)})),trackId:c})})),"exact"!==t.searchType){e.next=8;break}return e.abrupt("return",i.filter((function(e){return e.getLabel().toLowerCase()===t.queryString.toLowerCase()})));case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(h.BaseAdapter);var w=(0,v.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),k=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="TrixPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addTextSearchAdapterType((function(){return new s.Z({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:w,AdapterClass:x,description:"Trix adapter"})}))}}]),n}(c.Z)},43743:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var r=n(33028),a=n(96234),i=n(68079),o=n(9249),s=n(87371),c=n(70899),u={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function l(e,t,n){if(!t||0===t.length)return["remark","no alternative alleles"];var r=new Set,o=new Set;if(t.forEach((function(t){var i=d(e,t,n),s=(0,a.Z)(i,2),u=s[0],l=s[1];if(!u){var p=function(e,t){var n=(0,c.I)(t);if(n)return["breakend",t];if(1===e.length&&1===t.length)return["SNV",f("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<INV>"===t)return["deletion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length)return e.split("").reverse().join("")===t?["inversion",f("inversion",e,t)]:["substitution",f("substitution",e,t)];if(e.length<=t.length)return["insertion",f("insertion",e,t)];if(e.length>t.length)return["deletion",f("deletion",e,t)];return["indel",f("indel",e,t)]}(e,t),h=(0,a.Z)(p,2);u=h[0],l=h[1]}u&&l&&(r.add(u),o.add(l))})),o.size>1){var s=(0,i.Z)(o),u=new Set(s.map((function(e){var t=e.split("->");return t[1]?t[0]:e})));o=new Set((0,i.Z)(u).map((function(e){var t=s.map((function(t){var n=t.split("-> ");return n[1]&&n[0]===e?n[1]:""})).filter((function(e){return!!e}));return t.length?e+"-> "+t.join(","):e})))}return r.size?[(0,i.Z)(r).join(","),(0,i.Z)(o).join(",")]:[]}function d(e,t,n){if("string"===typeof t&&!t.startsWith("<"))return[];var r=u[t];if(!r&&n.getMetadata("ALT",t)&&(r="sequence_variant"),r)return[r,t];var a=t.split(":");return a.length>1?d(e,"<".concat(a.slice(0,a.length-1).join(":"),">"),n):[]}function f(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}var p=function(){function e(t){(0,o.Z)(this,e),this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}return(0,s.Z)(e,[{key:"get",value:function(e){return"samples"===e?this.variant.SAMPLES:this.data[e]||this.variant[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat((0,i.Z)(Object.keys(this.data)),(0,i.Z)(Object.keys(this.variant)),["samples"])}},{key:"id",value:function(){return this._id}},{key:"dataFromVariant",value:function(e){var t=e.REF,n=e.ALT,r=e.POS,i=e.CHROM,o=e.INFO,s=e.ID,c=r-1,u=l(t,n,this.parser),d=(0,a.Z)(u,2),f=d[0],p=d[1],h=null===n||void 0===n?void 0:n.some((function(e){return"<TRA>"===e}));return{refName:i,start:c,end:(null===n||void 0===n?void 0:n.some((function(e){return-1!==e.indexOf("<")})))&&o.END&&!h?+o.END[0]:c+t.length,description:p,type:f,name:null===s||void 0===s?void 0:s.join(","),aliases:s&&s.length>1?e.ID.slice(1):void 0}}},{key:"toJSON",value:function(){return(0,r.Z)((0,r.Z)((0,r.Z)({uniqueId:this._id},this.variant),this.data),{},{samples:this.variant.SAMPLES})}}]),e}()},52465:function(e,t,n){"use strict";n.d(t,{B:function(){return q.Z},Z:function(){return U}});var r=n(9249),a=n(87371),i=n(45754),o=n(13820),s=n(5868),c=n(99836);var u=(0,c.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),l=n(63680);var d=(0,c.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("VcfIndex",{indexType:{model:l.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0}),f=n(16151),p=n(55385),h=n(33991),g=n(91271);var m=function(e){return(0,c.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,g.createBaseTrackConfig)(e)})},v=n(87977),y=n(24277),b=n(95984);var x=function(e){return(0,c.ConfigurationSchema)("ChordVariantDisplay",{renderer:l.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:y._U,explicitlyTyped:!0})},w=n(33028),k=n(97531),C=function(e){return l.types.compose("ChordVariantDisplay",y.pL,l.types.model({type:l.types.literal("ChordVariantDisplay"),configuration:(0,c.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return e.configuration.renderer.type},renderProps:function(){var t=(0,k.getContainingView)(e);return(0,w.Z)((0,w.Z)({},(0,f.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick})}}}))},Z=n(92777),S=n(32723),T=n(34795);function M(e){return l.types.compose("LinearVariantDisplay",(0,Z.l0)(e),l.types.model({type:l.types.literal("LinearVariantDisplay"),configuration:(0,c.ConfigurationReference)(e)})).actions((function(e){return{selectFeature:function(t){return(0,T.Z)((0,S.Z)().mark((function n(){var r,a,i,o,s,u,l;return(0,S.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(0,k.getSession)(e),!(0,k.isSessionModelWithWidgets)(r)){n.next=11;break}return a=r.rpcManager,i=(0,f.getRpcSessionId)(e),o=(0,k.getContainingTrack)(e),s=(0,k.getContainingView)(e),u=(0,c.getConf)(o,"adapter"),n.next=9,a.call(i,"CoreGetMetadata",{adapterConfig:u});case 9:l=n.sent,r.showWidget(r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:o,descriptions:l}));case 11:r.setSelection(t);case 12:case"end":return n.stop()}}),n)})))()}}}))}var P=function(e){e.addDisplayType((function(){var t=function(e){return(0,c.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,Z.RH)(e),explicitlyTyped:!0})}(e);return new b.Z({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:M(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:Z.qb})}))},R=n(73749);var A=(0,c.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0}),L=n(41361),N=n(96902),j=n(4782),F=n(68079),I=n(96234),B=n(70899),D=n(29938);function E(e,t){var n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}var V=(0,j.observer)((function(e){var t,n,r,a,i=e.feature,o=e.blocksForRefs,s=e.radius,u=e.config,l=e.bezierRadius,d=e.selected,f=e.onClick,p=o[i.get("refName")];if(!p)return null;if(i.get("INFO")){var h=i.get("INFO").SVTYPE||[];n=(0,I.Z)(h,1)[0]}else i.get("mate")&&(n="mate");var g=null===(t=i.get("ALT"))||void 0===t?void 0:t[0],m=g&&(0,B.I)(g);if(m){var v=m.MatePosition.split(":");r=+v[1],a=o[v[0]]}else if("<TRA>"===g){var y,b,x,w,C=null===(y=i.get("INFO"))||void 0===y||null===(b=y.CHR2)||void 0===b?void 0:b[0],Z=null===(x=i.get("INFO"))||void 0===x||null===(w=x.END)||void 0===w?void 0:w[0];r=parseInt(Z,10),a=o[C]}else if("mate"===n){var S=i.get("mate"),T=S.refName;r=S.start,a=o[T]}if(a){var M=i.get("start"),P=E(p,M),R=E(a,r),A=(0,k.polarToCartesian)(s,P),L=(0,k.polarToCartesian)(s,R),N=(0,k.polarToCartesian)(l,(R+P)/2),j=d?(0,c.readConfObject)(u,"strokeColorSelected",{feature:i}):(0,c.readConfObject)(u,"strokeColor",{feature:i}),V=(0,c.readConfObject)(u,"strokeColorHover",{feature:i});return(0,D.jsx)("path",{"data-testid":"chord-".concat(i.id()),d:["M"].concat((0,F.Z)(A),["Q"],(0,F.Z)(N),(0,F.Z)(L)).join(" "),style:{stroke:j},onClick:function(e){a&&p&&f(i,p.region,a.region,e)},onMouseOver:function(e){d||(e.currentTarget.style.stroke=V,e.currentTarget.style.strokeWidth="3px")},onMouseOut:function(e){d||(e.currentTarget.style.stroke=j,e.currentTarget.style.strokeWidth="1px")}})}return null}));var z=(0,j.observer)((function(e){var t,n=e.features,r=e.config,a=e.displayModel,i=e.blockDefinitions,o=e.radius,s=e.bezierRadius,c=e.displayModel.selectedFeatureId,u=e.onChordClick,l=(0,N.useMemo)((function(){var e={};return i.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(n){return e[n.refName]=t}))})),e}),[i]),d=[],f=(0,L.Z)(n.values());try{for(f.s();!(t=f.n()).done;){var p=t.value,h=p.id(),g=String(c)===String(h);d.push((0,D.jsx)(V,{feature:p,config:r,radius:o,bezierRadius:s,blocksForRefs:l,selected:g,onClick:u},h))}}catch(v){f.e(v)}finally{f.f()}var m="chords-".concat(a.id);return(0,D.jsxs)("g",{id:m,"data-testid":"structuralVariantChordRenderer",children:[(0,D.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(m," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),d]})})),O=n(26347),W=n(87518),H=(0,c.ConfigurationSchema)("VariantFeatureWidget",{});function G(e){var t=(0,W.e$)(e);return l.types.compose(t,l.types.model("VariantFeatureWidget",{type:l.types.literal("VariantFeatureWidget"),descriptions:l.types.frozen()}))}var q=n(43743),U=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="VariantsPlugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){var t;!function(e){e.addAdapterType((function(){return new s.Z({name:"VcfAdapter",displayName:"VCF adapter",configSchema:u,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(8538),n.e(6980)]).then(n.bind(n,86980)).then((function(e){return e.default}))}})}))}(e),function(e){e.addAdapterType((function(){return new s.Z({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:d,getAdapterClass:function(){return Promise.all([n.e(7221),n.e(6959),n.e(2094),n.e(2018),n.e(7704),n.e(298)]).then(n.bind(n,30298)).then((function(e){return e.default}))}})}))}(e),function(e){e.addWidgetType((function(){return new O.Z({name:"VariantFeatureWidget",heading:"Feature details",configSchema:H,stateModel:G(e),ReactComponent:(0,N.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(8941),n.e(7296)]).then(n.bind(n,61294))}))})}))}(e),(t=e).addTrackType((function(){var e=m(t);return new p.Z({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,h.createBaseTrackModel)(t,"VariantTrack",e)})})),function(e){e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfTabixAdapter",i=(0,f.getFileName)(t),o=n&&(0,f.getFileName)(n),s={type:a,vcfGzLocation:t,index:{location:n||(0,f.makeIndex)(t,".tbi"),indexType:(0,f.makeIndexType)(o,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(i)&&!r||r===a?s:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfAdapter",i=(0,f.getFileName)(t);return/\.vcf$/i.test(i)||r===a?{type:a,vcfLocation:t}:e(t,n,r)}}))}(e),P(e),function(e){e.addRendererType((function(){return new R.Z({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:z,configSchema:A,pluginManager:e})}))}(e),function(e){e.addDisplayType((function(){var t=x(e),n=C(t);return new b.Z({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:n,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:y.lJ})}))}(e)}}]),c}(v.Z)},67903:function(e,t,n){"use strict";n.d(t,{Xl:function(){return Se},u:function(){return we},Aq:function(){return x},Eh:function(){return T},Rv:function(){return W},ZP:function(){return Tt},P$:function(){return G},yZ:function(){return H},LT:function(){return Re}});var r={};n.r(r),n.d(r,{YSCALEBAR_LABEL_OFFSET:function(){return W},getNiceDomain:function(){return q},getOrigin:function(){return G},getScale:function(){return H},getStats:function(){return _},groupBy:function(){return U},round:function(){return Q},statsAutorun:function(){return X},toP:function(){return Y}});var a=n(9249),i=n(87371),o=n(45754),s=n(13820),c=n(87977),u=n(16151),l=n(32723),d=n(33028),f=n(59740),p=n(96234),h=n(34795),g=n(93069),m=n(95058),v=n(13381),y=n(97531),b=["reducedFeatures"],x=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,i.Z)(n,[{key:"render",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t){var r,a,i,o,s,c,u,h,v,x,w,k=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:return r=e.sent,a=t.height,i=t.regions,o=t.bpPerPx,s=(0,p.Z)(i,1),c=s[0],u=(c.end-c.start)/o,e.next=8,(0,y.renderToAbstractCanvas)(u,a,t,(function(e){return k.draw(e,(0,d.Z)((0,d.Z)({},t),{},{features:r}))}));case 8:return h=e.sent,v=h.reducedFeatures,x=(0,f.Z)(h,b),e.next=13,(0,g.Z)((0,m.Z)(n.prototype),"render",this).call(this,(0,d.Z)((0,d.Z)((0,d.Z)({},t),x),{},{features:r,height:a,width:u}));case 13:return w=e.sent,e.abrupt("return",(0,d.Z)((0,d.Z)((0,d.Z)({},w),x),{},{features:v?new Map(v.map((function(e){return[e.id(),e]}))):w.features,height:a,width:u,containsNoTransferables:!0}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(v.default),w=n(41361),k=n(4782),C=n(96902),Z=n(46186),S=n(29938);var T=(0,k.observer)((function(e){var t=e.regions,n=e.features,r=e.bpPerPx,a=e.width,i=e.height,o=e.onMouseLeave,s=void 0===o?function(){}:o,c=e.onMouseMove,u=void 0===c?function(){}:c,l=e.onFeatureClick,f=void 0===l?function(){}:l,h=(0,p.Z)(t,1)[0],g=(0,C.useRef)(null);function m(e){var t=0;g.current&&(t=g.current.getBoundingClientRect().left);var i,o,s=e-t,c=h.reversed?a-s:s,u=h.start+r*c,l=(0,w.Z)(n.values());try{for(l.s();!(o=l.n()).done;){var d=o.value;if(u<=d.get("end")+r&&u>=d.get("start")){i=d;break}}}catch(f){l.e(f)}finally{l.f()}return i}return(0,S.jsx)("div",{ref:g,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t;return u(e,null===(t=m(e.clientX))||void 0===t?void 0:t.id())},onClick:function(e){var t;return f(e,null===(t=m(e.clientX))||void 0===t?void 0:t.id())},onMouseLeave:function(e){return s(e)},style:{overflow:"visible",position:"relative",height:i},children:(0,S.jsx)(Z.PrerenderedCanvas,(0,d.Z)({},e))})})),M=n(5868),P=n(99836);var R=(0,P.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"}},{explicitlyTyped:!0}),A=n(33991),L=n(55385);var N=function(e){return(0,P.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,A.createBaseTrackConfig)(e)})};var j=function(e){return(0,P.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,A.createBaseTrackConfig)(e)})};var F=(0,P.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0}),I=n(63680);var B=(0,P.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:I.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0});var D=(0,P.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:B,explicitlyTyped:!0}),E=n(720),V=n(30897),z=n(73137),O=n(75717),W=5;function H(e){var t,n=e.domain,r=void 0===n?[]:n,a=e.range,i=void 0===a?[]:a,o=e.scaleType,s=e.pivotValue,c=e.inverted,u=(0,p.Z)(r,2),l=u[0],d=u[1];if(void 0===l||void 0===d)throw new Error("invalid domain");if("linear"===o)t=(0,E.Z)();else if("log"===o)(t=(0,V.Z)()).base(2);else{if("quantize"!==o)throw new Error("undefined scaleType");t=(0,z.Z)()}t.domain(void 0!==s?[l,s,d]:[l,d]),t.nice();var f=(0,p.Z)(i,2),h=f[0],g=f[1];if(void 0===h||void 0===g)throw new Error("invalid range");return t.range(c?i.slice().reverse():i),t}function G(e){return"log"===e?1:0}function q(e){var t=e.scaleType,n=e.domain,r=e.bounds,a=(0,p.Z)(r,2),i=a[0],o=a[1],s=(0,p.Z)(n,2),c=s[0],u=s[1];if("linear"===t&&(u<0&&(u=0),c>0&&(c=0)),"log"===t&&(0===c||c>1)&&(c=1),void 0===c||void 0===u)throw new Error("invalid domain supplied to stats function");void 0!==i&&i!==Number.MIN_VALUE&&(c=i),void 0!==o&&o!==Number.MAX_VALUE&&(u=o);var l=function(e){if("linear"===e)return(0,E.Z)();if("log"===e){var t=(0,V.Z)();return t.base(2),t}if("quantize"===e)return(0,z.Z)();throw new Error("undefined scaleType ".concat(e))}(t);return l.domain([c,u]),l.nice(),l.domain()}function U(e,t){return e.reduce((function(e,n){var r;return(e[r=t(n)]||(e[r]=[])).push(n),e}),{})}function _(e,t){return J.apply(this,arguments)}function J(){return(J=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c,f,p,h,g,m,v,b,x,w,k,C,Z;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,y.getSession)(t),a=r.rpcManager,i=(0,P.getConf)(t,"numStdDev")||3,o=t.adapterConfig,s=t.autoscaleType,c=(0,u.getRpcSessionId)(t),f=(0,d.Z)({sessionId:c,adapterConfig:o,statusCallback:function(e){(0,I.isAlive)(t)&&t.setMessage(e)}},n),"global"!==s&&"globalsd"!==s){e.next=11;break}return e.next=8,a.call(c,"WiggleGetGlobalStats",f);case 8:return p=e.sent,h=p.scoreMin,g=p.scoreMean,m=p.scoreStdDev,e.abrupt("return","globalsd"===s?(0,d.Z)((0,d.Z)({},p),{},{scoreMin:h>=0?0:g-i*m,scoreMax:g+i*m}):p);case 11:if("local"!==s&&"localsd"!==s){e.next=18;break}return v=(0,y.getContainingView)(t),b=v.dynamicBlocks,x=v.bpPerPx,e.next=15,a.call(c,"WiggleGetMultiRegionStats",(0,d.Z)((0,d.Z)({},f),{},{regions:b.contentBlocks.map((function(e){var t=e.start,n=e.end;return(0,d.Z)((0,d.Z)({},JSON.parse(JSON.stringify(e))),{},{start:Math.floor(t),end:Math.ceil(n)})})),bpPerPx:x}));case 15:return w=e.sent,k=w.scoreMin,C=w.scoreMean,Z=w.scoreStdDev,e.abrupt("return","localsd"===s?(0,d.Z)((0,d.Z)({},w),{},{scoreMin:k>=0?0:C-i*Z,scoreMax:C+i*Z}):w);case 18:if("zscale"!==s){e.next=20;break}return e.abrupt("return",a.call(c,"WiggleGetGlobalStats",f));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){(0,I.addDisposer)(e,(0,O.autorun)((0,h.Z)((0,l.Z)().mark((function t(){var n,r,a,i;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=new AbortController,r=(0,y.getContainingView)(e),e.setLoading(n),r.initialized&&e.estimatedStatsReady&&!e.regionTooLarge){t.next=6;break}return t.abrupt("return");case 6:return a=JSON.stringify(r.dynamicBlocks),t.next=9,_(e,(0,d.Z)({signal:n.signal},e.renderProps()));case 9:i=t.sent,(0,I.isAlive)(e)&&e.updateStats(i,a),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),!(0,y.isAbortException)(t.t0)&&(0,I.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 16:case"end":return t.stop()}}),t,null,[[0,13]])}))),{delay:1e3}))}function Y(){return+(+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)).toPrecision(6)}function Q(e){return Math.round(1e5*e)/1e5}function K(e,t,n,r,a,i){n<0&&(e+=n,n=-n),r<0&&(t+=r,r=-r),i&&(a.fillStyle=i),a.fillRect(e,t,n,r)}var $=.4,ee=2;function te(e,t){var n=t.features,r=t.bpPerPx,a=t.regions,i=t.scaleOpts,o=t.height,s=t.config,c=t.ticks,u=t.displayCrossHatches,l=t.offset,f=void 0===l?0:l,h=t.colorCallback,g=t.Color,m=(0,p.Z)(a,1)[0],v=(m.end-m.start)/r,b=o-2*f,x=(0,P.readConfObject)(s,"filled"),k=(0,P.readConfObject)(s,"clipColor"),C=(0,P.readConfObject)(s,"summaryScoreMode"),Z=(0,P.readConfObject)(s,"bicolorPivotValue"),S=(0,P.readConfObject)(s,"minSize"),T=H((0,d.Z)((0,d.Z)({},i),{},{range:[0,b]})),M=G(i.scaleType),R=T.domain(),A=(0,p.Z)(R,2),L=A[0],N=A[1],j=function(e){return(0,y.clamp)(b-(T(e)||0),0,b)+f},F=function(e){return x?function(e){return j(M)-j(e)}(e):Math.max(S,1)},I=!1,B=-1/0,D=[],E=L<Z&&N>Z;if("whiskers"===C){var V,z,O,W=(0,w.Z)(n.values());try{for(W.s();!(O=W.n()).done;){var q=O.value,U=(0,y.featureSpanPx)(q,m,r),_=(0,p.Z)(U,2),J=_[0],X=_[1];if(q.get("summary")){var Y=Math.max(X-J+$,S),Q=q.get("maxScore"),te=h(q,Q),ne=E?te:te===V?z:z=g(te).lighten(.4).toString();K(J,j(Q),Y,F(Q),e,ne),V=te}}}catch(Je){W.e(Je)}finally{W.f()}z=void 0,V=void 0;var re,ae=(0,w.Z)(n.values());try{for(ae.s();!(re=ae.n()).done;){var ie=re.value,oe=(0,y.featureSpanPx)(ie,m,r),se=(0,p.Z)(oe,2),ce=se[0],ue=se[1],le=ie.get("score"),de=ie.get("maxScore"),fe=ie.get("minScore"),pe=ie.get("summary"),he=h(ie,le),ge=E&&pe?he===V?z:z=g(h(ie,de)).mix(g(h(ie,fe))).toString():he,me=Math.max(ue-ce+$,S);Math.floor(ce)!==Math.floor(B)&&(D.push(ie),B=ce),I=I||le<L||le>N,K(ce,j(le),me,F(le),e,ge),V=he}}catch(Je){ae.e(Je)}finally{ae.f()}z=void 0,V=void 0;var ve,ye=(0,w.Z)(n.values());try{for(ye.s();!(ve=ye.n()).done;){var be=ve.value,xe=(0,y.featureSpanPx)(be,m,r),we=(0,p.Z)(xe,2),ke=we[0],Ce=we[1];if(be.get("summary")){var Ze=be.get("minScore"),Se=h(be,Ze),Te=Math.max(Ce-ke+$,S),Me=E?Se:Se===V?z:z=g(Se).darken(.4).toString();K(ke,j(Ze),Te,F(Ze),e,Me),V=Se}}}catch(Je){ye.e(Je)}finally{ye.f()}}else{var Pe,Re=(0,w.Z)(n.values());try{for(Re.s();!(Pe=Re.n()).done;){var Ae=Pe.value,Le=(0,y.featureSpanPx)(Ae,m,r),Ne=(0,p.Z)(Le,2),je=Ne[0],Fe=Ne[1];Math.floor(je)!==Math.floor(B)&&(D.push(Ae),B=je);var Ie=Ae.get("score"),Be=h(Ae,Ie);I=I||Ie<L||Ie>N;var De=Math.max(Fe-je+$,S);if("max"===C){var Ee=Ae.get("summary")?Ae.get("maxScore"):Ie;K(je,j(Ee),De,F(Ee),e,Be)}else if("min"===C){var Ve=Ae.get("summary")?Ae.get("minScore"):Ie;K(je,j(Ve),De,F(Ve),e,Be)}else K(je,j(Ie),De,F(Ie),e,Be)}}catch(Je){Re.e(Je)}finally{Re.f()}}if(e.save(),I){e.fillStyle=k;var ze,Oe=(0,w.Z)(n.values());try{for(Oe.s();!(ze=Oe.n()).done;){var We=ze.value,He=(0,y.featureSpanPx)(We,m,r),Ge=(0,p.Z)(He,2),qe=Ge[0],Ue=Ge[1]-qe+$,_e=We.get("score");_e>N?K(qe,f,Ue,ee,e):_e<L&&"log"!==i.scaleType&&K(qe,o,Ue,ee,e)}}catch(Je){Oe.e(Je)}finally{Oe.f()}}return e.restore(),u&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",c.values.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(j(t))),e.lineTo(v,Math.round(j(t))),e.stroke()}))),{reducedFeatures:D}}function ne(e,t){var n,r,a=t.features,i=t.regions,o=t.bpPerPx,s=t.scaleOpts,c=t.height,u=t.ticks.values,l=t.displayCrossHatches,f=t.colorCallback,h=t.config,g=t.offset,m=void 0===g?0:g,v=(0,p.Z)(i,1)[0],b=(v.end-v.start)/o,x=c-2*m,k=(0,P.readConfObject)(h,"clipColor"),C=H((0,d.Z)((0,d.Z)({},s),{},{range:[0,x]})),Z=C.domain(),S=(0,p.Z)(Z,2),T=S[0],M=S[1],R=function(e){return(0,y.clamp)(x-(C(e)||0),0,x)+m},A=-1/0,L=[],N=(0,w.Z)(a.values());try{for(N.s();!(r=N.n()).done;){var j=r.value,F=(0,y.featureSpanPx)(j,v,o),I=(0,p.Z)(F,2),B=I[0],D=I[1];Math.floor(B)!==Math.floor(A)&&(L.push(j),A=B);var E=j.get("score"),V=E<T,z=E>M,O=D-B+$,W=f(j,E);e.beginPath(),e.strokeStyle=W;var G="undefined"!==typeof n?n:E;v.reversed?(e.moveTo(D,R(G)),e.lineTo(D,R(E)),e.lineTo(B,R(E))):(e.moveTo(B,R(G)),e.lineTo(B,R(E)),e.lineTo(D,R(E))),e.stroke(),n=E,z?(e.fillStyle=k,e.fillRect(B,m,O,ee)):V&&"log"!==s.scaleType&&(e.fillStyle=k,e.fillRect(B,x-ee,O,x))}}catch(q){N.e(q)}finally{N.f()}return l&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",u.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(R(t))),e.lineTo(b,Math.round(R(t))),e.stroke()}))),{reducedFeatures:L}}function re(e,t){var n,r=t.features,a=t.regions,i=t.bpPerPx,o=t.scaleOpts,s=t.height,c=t.config,u=(0,p.Z)(a,1)[0],l=(0,P.readConfObject)(c,"bicolorPivot"),f=(0,P.readConfObject)(c,"bicolorPivotValue"),h=(0,P.readConfObject)(c,"negColor"),g=(0,P.readConfObject)(c,"posColor"),m=(0,P.readConfObject)(c,"color"),v=(0,P.readConfObject)(c,"clipColor"),b="none"!==l&&"log"!==o.scaleType,x=H((0,d.Z)((0,d.Z)({},o),{},{pivotValue:b?f:void 0,range:b?[h,"white",g]:["white",g]}));n="#f0f"===m?function(e,t){return x(t)}:function(e,t){return(0,P.readConfObject)(c,"color",{feature:e,score:t})};var k,C=H((0,d.Z)((0,d.Z)({},o),{},{range:[0,s]})).domain(),Z=(0,p.Z)(C,2),S=Z[0],T=Z[1],M=-1/0,R=!1,A=[],L=(0,w.Z)(r.values());try{for(L.s();!(k=L.n()).done;){var N=k.value,j=(0,y.featureSpanPx)(N,u,i),F=(0,p.Z)(j,2),I=F[0],B=F[1];Math.floor(I)!==Math.floor(M)&&(A.push(N),M=I);var D=N.get("score");R=R||D>T||D<S;var E=B-I+$;e.fillStyle=n(N,D),e.fillRect(I,0,E,s)}}catch(J){L.e(J)}finally{L.f()}if(e.save(),R){e.fillStyle=v;var V,z=(0,w.Z)(r.values());try{for(z.s();!(V=z.n()).done;){var O=V.value,W=(0,y.featureSpanPx)(O,u,i),G=(0,p.Z)(W,2),q=G[0],U=G[1]-q+$,_=O.get("score");(_>T||_<S&&"log"!==o.scaleType)&&K(q,0,U,ee,e)}}catch(J){z.e(J)}finally{z.f()}}return e.restore(),{reducedFeatures:A}}var ae=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x),ie=n(68079),oe=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a,i,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.features,i=r.config,o=(0,P.readConfObject)(i,"bicolorPivotValue"),s=(0,P.readConfObject)(i,"negColor"),c=(0,P.readConfObject)(i,"posColor"),e.next=6,n.e(5707).then(n.t.bind(n,55707,23)).then((function(e){return e.default}));case 6:return u=e.sent,e.abrupt("return",te(t,(0,d.Z)((0,d.Z)({},r),{},{colorCallback:"#f0f"===(0,P.readConfObject)(i,"color")?function(e,t){return t<o?s:c}:function(e,t){return(0,P.readConfObject)(i,"color",{feature:e})},offset:W,features:(0,ie.Z)(a.values()),Color:u})));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(x);var se=(0,P.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:I.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:B,explicitlyTyped:!0});var ce=(0,P.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:B,explicitlyTyped:!0}),ue=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ne(t,(0,d.Z)((0,d.Z)({},n),{},{offset:W,colorCallback:function(){return"grey"}})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x),le=n(95984),de=n(92777);var fe=n(89554),pe=n(16644),he=n(60131),ge=n(91188),me=n(61291),ve=(0,ge.ZL)()((function(e){return{tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,pe.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat(Q(1.4),"em"),maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:W,cursor:"default",position:"absolute",pointerEvents:"none"}}}));var ye=(0,k.observer)((function(e){var t=e.model,n=e.height,r=e.clientMouseCoord,a=e.offsetMouseCoord,i=e.clientRect,o=e.TooltipContents,s=e.useClientY,c=t.featureUnderMouse,u=(0,C.useState)(0),l=(0,p.Z)(u,2),f=l[0],h=l[1],g=(0,C.useState)(null),m=(0,p.Z)(g,2),v=m[0],y=m[1],b=ve().classes,x=(0,C.useMemo)((function(){return{getBoundingClientRect:function(){var e=r[0]+f/2+20,t=s?r[1]:(null===i||void 0===i?void 0:i.top)||0;return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[null===i||void 0===i?void 0:i.top,r,f,s]),w=(0,me.D)(x,v),k=w.styles,Z=w.attributes;return c?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(he.Z,{children:(0,S.jsx)("div",(0,d.Z)((0,d.Z)({ref:y,className:b.tooltip,style:(0,d.Z)((0,d.Z)({},k.popper),{},{zIndex:1e5})},Z.popper),{},{children:(0,S.jsx)(o,{ref:function(e){return h((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},model:t,feature:c})}))}),(0,S.jsx)("div",{className:b.hoverVertical,style:{left:a[0],height:n-2*W}})]}):null})),be=function(e){return e.toLocaleString("en-US")},xe=C.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),i=[n.get("refName"),r===a?be(r):"".concat(be(r),"..").concat(be(a))].filter((function(e){return!!e})).join(":");return void 0!==n.get("summary")?(0,S.jsxs)("div",{ref:t,children:[i,(0,S.jsx)("br",{}),"Max: ",Y(n.get("maxScore")),(0,S.jsx)("br",{}),"Avg: ",Y(n.get("score")),(0,S.jsx)("br",{}),"Min: ",Y(n.get("minScore"))]}):(0,S.jsxs)("div",{ref:t,children:[i,(0,S.jsx)("br",{}),"".concat(Y(n.get("score")))]})})),we=(0,k.observer)((function(e){return(0,S.jsx)(ye,(0,d.Z)({TooltipContents:xe},e))})),ke=(0,k.observer)((function(e){var t=e.model,n=e.orientation,r=t.ticks;return r?(0,S.jsx)(fe.Axis,(0,d.Z)((0,d.Z)({},r),{},{shadow:2,format:function(e){return e},style:{orient:"left"===n?fe.LEFT:fe.RIGHT}})):null})),Ce=ke,Ze=(0,k.observer)((function(e){var t=e.model,n=t.stats,r=t.height,a=t.needsScalebar,i=(0,y.getContainingView)(t).trackLabels,o=(0,y.getContainingTrack)(t),s="overlapping"===i?(0,y.measureText)((0,P.getConf)(o,"name"),12.8)+100:50;return(0,S.jsxs)("div",{children:[(0,S.jsx)(de.qb,(0,d.Z)({},e)),n&&a?(0,S.jsx)("svg",{style:{position:"absolute",top:0,left:s,pointerEvents:"none",height:r,width:50},children:(0,S.jsx)(Ce,{model:t})}):null]})})),Se=Ze,Te=(0,C.lazy)((function(){return n.e(4274).then(n.bind(n,94274))})),Me=(0,C.lazy)((function(){return Promise.all([n.e(5707),n.e(6528)]).then(n.bind(n,76528))})),Pe=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]);var Re=function(e,t){return I.types.compose("LinearWiggleDisplay",de.fV,I.types.model({type:I.types.literal("LinearWiggleDisplay"),configuration:(0,P.ConfigurationReference)(t),selectedRendering:I.types.optional(I.types.string,""),resolution:I.types.optional(I.types.number,1),fill:I.types.maybe(I.types.boolean),minSize:I.types.maybe(I.types.number),color:I.types.maybe(I.types.string),posColor:I.types.maybe(I.types.string),negColor:I.types.maybe(I.types.string),summaryScoreMode:I.types.maybe(I.types.string),rendererTypeNameState:I.types.maybe(I.types.string),scale:I.types.maybe(I.types.string),autoscale:I.types.maybe(I.types.string),displayCrossHatches:I.types.maybe(I.types.boolean),constraints:I.types.optional(I.types.model({max:I.types.maybe(I.types.number),min:I.types.maybe(I.types.number)}),{})})).volatile((function(){return{message:void 0,stats:void 0,statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){var n=t.scoreMin,r=t.scoreMax,a=1e-6;e.stats?(Math.abs(e.stats.scoreMax-r)>a||Math.abs(e.stats.scoreMin-n)>a)&&(e.stats={scoreMin:n,scoreMax:r}):e.stats={scoreMin:n,scoreMax:r}},setColor:function(t){e.color=t},setPosColor:function(t){e.posColor=t},setNegColor:function(t){e.negColor=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=(0,y.getSession)(e);(0,y.isSelectionContainer)(n)&&n.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get TooltipComponent(){return we},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState||(0,P.getConf)(e,"defaultRendering")},get rendererTypeName(){var e=this.rendererTypeNameSimple,t=Pe.get(e);if(!t)throw new Error("unknown renderer ".concat(e));return t},get filters(){},get scaleType(){return e.scale||(0,P.getConf)(e,"scaleType")},get maxScore(){var t;return null!==(t=e.constraints.max)&&void 0!==t?t:(0,P.getConf)(e,"maxScore")},get minScore(){var t;return null!==(t=e.constraints.min)&&void 0!==t?t:(0,P.getConf)(e,"minScore")}}})).views((function(e){return{get rendererConfig(){var t=(0,P.getConf)(e,["renderers",e.rendererTypeName])||{},n=e.color,r=e.displayCrossHatches,a=e.fill,i=e.minSize,o=e.negColor,s=e.posColor,c=e.summaryScoreMode,u=e.scaleType;return e.rendererType.configSchema.create((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)({},t),u?{scaleType:u}:{}),void 0!==a?{filled:a}:{}),void 0!==r?{displayCrossHatches:r}:{}),void 0!==c?{summaryScoreMode:c}:{}),void 0!==n?{color:n}:{}),void 0!==o?{negColor:o}:{}),void 0!==s?{posColor:s}:{}),void 0!==i?{minSize:i}:{}),(0,y.getEnv)(e))}}})).views((function(e){var t=[0,0];return{get filled(){var t=e.fill,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"filled")},get summaryScoreModeSetting(){var t=e.summaryScoreMode,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"summaryScoreMode")},get domain(){var n=e.stats,r=e.scaleType,a=e.minScore,i=e.maxScore;if(n){var o=q({domain:[n.scoreMin,n.scoreMax],bounds:[a,i],scaleType:r});return"log"===r&&o[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(o)&&(t=o),t)}},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:(0,P.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){var t;return null!==(t=e.autoscale)&&void 0!==t?t:(0,P.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){var t=e.displayCrossHatches,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"displayCrossHatches")}}})).views((function(t){return{get ticks(){var e=t.scaleType,n=t.domain,r=t.height,a=(0,P.getConf)(t,"minimalTicks"),i=(0,P.getConf)(t,"inverted");if(n){var o=H({scaleType:e,domain:n,range:[r-W,W],inverted:i}),s=(0,fe.axisPropsFromTickScale)(o,4);return r<100||a?(0,d.Z)((0,d.Z)({},s),{},{values:n}):s}},get adapterCapabilities(){var n=t.adapterTypeName;return e.getAdapterType(n).adapterCapabilities}}})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=t(),r=e.filters,a=e.ticks,i=e.height,o=e.resolution,s=e.scaleOpts;return(0,d.Z)((0,d.Z)({},n),{},{notReady:n.notReady||!e.stats,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:s,resolution:o,height:i,ticks:a,filters:r})},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((function(e){var t=e.trackMenuItems,n=(0,P.getConf)(e,"defaultRendering");return{trackMenuItems:function(){return[].concat((0,ie.Z)(t()),(0,ie.Z)(e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){return e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:function(){return e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(t){return{label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:function(){return e.setSummaryScoreMode(t)}}}))}]:[]),(0,ie.Z)(e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((function(t,n){return{label:t,type:"radio",checked:e.fillSetting===n,onClick:function(){return e.setFill(n)}}}))}]:[]),[{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:function(){return e.toggleLogScale()}}],(0,ie.Z)(e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:function(){return e.toggleCrossHatches()}}]:[]),(0,ie.Z)(n?[{label:"Renderer type",subMenu:["xyplot","density","line"].map((function(t){return{label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:function(){return e.setRendererType(t)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat((0,ie.Z)(e.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(t){var n=(0,p.Z)(t,2),r=n[0];return{label:n[1],type:"radio",checked:e.autoscaleType===r,onClick:function(){return e.setAutoscale(r)}}}))},{label:"Set min/max score",onClick:function(){(0,y.getSession)(e).queueDialog((function(t){return[Te,{model:e,handleClose:t}]}))}},{label:"Set color",onClick:function(){(0,y.getSession)(e).queueDialog((function(t){return[Me,{model:e,handleClose:t}]}))}}])}}})).actions((function(e){var t=e.reload,n=e.renderSvg;return{reload:function(){return(0,h.Z)((0,l.Z)().mark((function n(){var r,a;return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setError(),r=new AbortController,e.setLoading(r),n.prev=3,n.next=6,_(e,(0,d.Z)({signal:r.signal},e.renderProps()));case 6:a=n.sent,(0,I.isAlive)(e)&&(e.updateStats(a),t()),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(3),e.setError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[3,10]])})))()},afterAttach:function(){X(e)},renderSvg:function(t){return(0,h.Z)((0,l.Z)().mark((function r(){var a,i,o,s;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,O.when)((function(){return!!e.stats&&!!e.regionCannotBeRenderedText}));case 2:return a=e.needsScalebar,i=e.stats,o=(0,y.getContainingView)(e),s=o.offsetPx,r.t0=S.jsxs,r.t1=S.Fragment,r.t2=S.jsx,r.next=9,n(t);case 9:return r.t3=r.sent,r.t4={id:"snpcov",children:r.t3},r.t5=(0,r.t2)("g",r.t4),r.t6=a&&i?(0,S.jsx)("g",{transform:"translate(".concat(Math.max(-s,0),")"),children:(0,S.jsx)(Ce,{model:e,orientation:"left"})}):null,r.t7=[r.t5,r.t6],r.t8={children:r.t7},r.abrupt("return",(0,r.t0)(r.t1,r.t8));case 16:case"end":return r.stop()}}),r)})))()}}}))},Ae=function(e){e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,P.ConfigurationSchema)("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:I.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:I.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:I.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,P.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:de.fU,explicitlyTyped:!0})}(e),n=Re(e,t);return new le.Z({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:n,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:Se})}))};var Le=n(16001),Ne=n.n(Le),je=n(66185),Fe=function(e){return e.toLocaleString("en-US")},Ie=C.forwardRef((function(e,t){var n=e.model,r=e.feature,a=r.get("start"),i=r.get("end"),o=r.get("refName"),s=a===i?Fe(a):"".concat(Fe(a),"..").concat(Fe(i)),c=r.get("sources"),u=r.get("source"),l=r.get("summary"),d=Object.fromEntries(n.sources.map((function(e){return[e.name,e]})));return(0,S.jsxs)("div",{ref:t,children:[[o,s].filter((function(e){return!!e})).join(":"),(0,S.jsx)("br",{}),c?(0,S.jsxs)("table",{children:[(0,S.jsx)("thead",{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)("th",{children:"color"}),(0,S.jsx)("th",{children:"source"}),(0,S.jsx)("th",{children:"score"})]})}),(0,S.jsx)("tbody",{children:Object.entries(c).map((function(e){var t,n=(0,p.Z)(e,2),r=n[0],a=n[1];return(0,S.jsxs)("tr",{children:[(0,S.jsx)("td",{style:{background:null===(t=d[r])||void 0===t?void 0:t.color},children:" "}),(0,S.jsx)("td",{children:r}),(0,S.jsx)("td",{children:Y(a.score)})]},r)}))})]}):(0,S.jsxs)("span",{children:[u," ",l?"min:".concat(Y(r.get("minScore"))," avg:").concat(Y(r.get("score"))," max:").concat(Y(r.get("maxScore"))):Y(r.get("score"))]})]})})),Be=(0,k.observer)((function(e){return(0,S.jsx)(ye,(0,d.Z)({useClientY:!0,TooltipContents:Ie},e))})),De=(0,k.observer)((function(e){var t=e.model,n=e.orientation,r=t.ticks;return r?(0,S.jsx)(fe.Axis,(0,d.Z)((0,d.Z)({},r),{},{shadow:2,format:function(e){return e},style:{orient:"left"===n?fe.LEFT:fe.RIGHT}})):null})),Ee=De,Ve=12.8;function ze(e){var t=e.prefersOffset,n=(0,y.getContainingView)(e).trackLabels,r=(0,y.getContainingTrack)(e),a=(0,P.getConf)(r,"name");return"overlapping"!==n||t?10:(0,y.measureText)(a,Ve)+100}var Oe=(0,k.observer)((function(e){var t=e.children,n=e.model;if(e.exportSVG)return(0,S.jsx)(S.Fragment,{children:t});var r=n.height;return(0,S.jsx)("svg",{style:{position:"absolute",top:0,left:0,pointerEvents:"none",height:r,width:(0,y.getContainingView)(n).width},children:t})})),We=function(e){var t=e.color,n=void 0===t?"rgb(255,255,255,0.8)":t;return(0,S.jsx)("rect",(0,d.Z)((0,d.Z)({},e),{},{fill:n}))},He=(0,k.observer)((function(e){var t=e.model,n=t.ticks,r=t.scaleType,a=(0,y.getContainingView)(t).width,i="[".concat(null===n||void 0===n?void 0:n.values[0],"-").concat(null===n||void 0===n?void 0:n.values[1],"]")+("log"===r?" (log scale)":""),o=(0,y.measureText)(i,14),s=a-o-25;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(We,{y:0,x:s,width:o+6,height:16}),(0,S.jsx)("text",{y:13,x:s,children:i})]})})),Ge=(0,k.observer)((function(e){var t=e.model,n=e.rowHeight,r=e.labelWidth,a=e.exportSVG,i=t.needsCustomLegend,o=t.needsScalebar,s=t.needsFullHeightScalebar,c=t.rowHeightTooSmallForScalebar,u=t.renderColorBoxes,l=t.sources,d=Math.min(n,12),f=n>11,p=u?15:0,h=r+p+5,g=(a?10:0)||(o&&!c?50:0);return l?(0,S.jsxs)(S.Fragment,{children:[s?(0,S.jsx)(We,{y:0,x:g,width:h,height:(l.length+.25)*n}):null,l.map((function(e,t){var r=Math.min(20,n);return(0,S.jsxs)(C.Fragment,{children:[s?null:(0,S.jsx)(We,{y:t*n+1,x:g,width:h,height:r}),e.color?(0,S.jsx)(We,{y:t*n+1,x:g,width:p,height:i?n:r,color:e.color}):null,f?(0,S.jsx)("text",{y:t*n+13,x:g+p+2,fontSize:d,children:e.name}):null]},e.name+"-"+t)}))]}):null})),qe=(0,k.observer)((function(e){var t=e.model,n=e.orientation,r=e.exportSVG,a=t.stats,i=t.needsCustomLegend,o=t.needsFullHeightScalebar,s=t.rowHeightTooSmallForScalebar,c=t.rowHeight,u=t.sources,l=t.ticks,f=Math.min(c,12),p=c>11,h=(0,y.getContainingView)(t).width;if(!(a&&u))return null;var g=Math.max.apply(Math,(0,ie.Z)(u.map((function(e){return(0,y.measureText)(e.name,f)})).map((function(e){return p?e:20}))||[0]));return(0,S.jsx)(Oe,(0,d.Z)((0,d.Z)({},e),{},{children:o?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("g",{transform:"translate(".concat(r?0:ze(t),",0)"),children:(0,S.jsx)(Ee,{model:t,orientation:n})}),(0,S.jsx)("g",{transform:"translate(".concat(h-g-100,",0)"),children:(0,S.jsx)(Ge,{exportSVG:r,model:t,rowHeight:12,labelWidth:g})})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Ge,{exportSVG:r,model:t,rowHeight:t.rowHeight,labelWidth:g}),s||i?(0,S.jsx)(He,(0,d.Z)({},e)):u.map((function(e,r){return(0,S.jsx)("g",{transform:"translate(0 ".concat(c*r,")"),children:(0,S.jsx)(Ee,{model:t,orientation:n})},JSON.stringify(l)+"-"+r)}))]})}))})),Ue=(0,k.observer)((function(e){var t=e.model;return(0,S.jsxs)("div",{children:[(0,S.jsx)(de.qb,(0,d.Z)({},e)),(0,S.jsx)(qe,{model:t})]})})),_e=Ue,Je=(0,C.lazy)((function(){return n.e(4274).then(n.bind(n,94274))})),Xe=(0,C.lazy)((function(){return Promise.all([n.e(534),n.e(9883),n.e(4514),n.e(952),n.e(5394),n.e(5707),n.e(2761),n.e(8941),n.e(902)]).then(n.bind(n,50902))})),Ye=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),Qe=function(e,t){return I.types.compose("MultiLinearWiggleDisplay",de.fV,I.types.model({type:I.types.literal("MultiLinearWiggleDisplay"),configuration:(0,P.ConfigurationReference)(t),selectedRendering:I.types.optional(I.types.string,""),resolution:I.types.optional(I.types.number,1),fill:I.types.maybe(I.types.boolean),minSize:I.types.maybe(I.types.number),height:200,color:I.types.maybe(I.types.string),posColor:I.types.maybe(I.types.string),negColor:I.types.maybe(I.types.string),summaryScoreMode:I.types.maybe(I.types.string),rendererTypeNameState:I.types.maybe(I.types.string),scale:I.types.maybe(I.types.string),autoscale:I.types.maybe(I.types.string),displayCrossHatches:I.types.maybe(I.types.boolean),layout:I.types.optional(I.types.frozen(),[]),constraints:I.types.optional(I.types.model({max:I.types.maybe(I.types.number),min:I.types.maybe(I.types.number)}),{})})).volatile((function(){return{message:void 0,stats:void 0,statsRegion:void 0,statsFetchInProgress:void 0,featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}})).actions((function(e){return{setLayout:function(t){e.layout=t},clearLayout:function(){e.layout=[]},updateStats:function(t){var n=t.scoreMin,r=t.scoreMax,a=1e-6;e.stats?(Math.abs(e.stats.scoreMax-r)>a||Math.abs(e.stats.scoreMin-n)>a)&&(e.stats={scoreMin:n,scoreMax:r}):e.stats={scoreMin:n,scoreMax:r}},setSources:function(t){Ne()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setColor:function(t){e.color=t},setPosColor:function(t){e.posColor=t},setNegColor:function(t){e.negColor=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=(0,y.getSession)(e);(0,y.isSelectionContainer)(n)&&n.setSelection(t)},setFeatureUnderMouse:function(t){e.featureUnderMouseVolatile=t},setResolution:function(t){e.resolution=t},setFill:function(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return Be},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState||(0,P.getConf)(e,"defaultRendering")},get rendererTypeName(){var e=this.rendererTypeNameSimple,t=Ye.get(e);if(!t)throw new Error("unknown renderer ".concat(e));return t},get filters(){},get scaleType(){var t;return null!==(t=e.scale)&&void 0!==t?t:(0,P.getConf)(e,"scaleType")},get maxScore(){var t;return null!==(t=e.constraints.max)&&void 0!==t?t:(0,P.getConf)(e,"maxScore")},get minScore(){var t;return null!==(t=e.constraints.min)&&void 0!==t?t:(0,P.getConf)(e,"minScore")}}})).views((function(e){return{get rendererConfig(){var t=(0,P.getConf)(e,["renderers",e.rendererTypeName])||{},n=e.color,r=e.displayCrossHatches,a=e.fill,i=e.minSize,o=e.negColor,s=e.posColor,c=e.summaryScoreMode,u=e.scaleType;return e.rendererType.configSchema.create((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)((0,d.Z)({},t),u?{scaleType:u}:{}),void 0!==a?{filled:a}:{}),void 0!==r?{displayCrossHatches:r}:{}),void 0!==c?{summaryScoreMode:c}:{}),void 0!==n?{color:n}:{}),void 0!==o?{negColor:o}:{}),void 0!==s?{posColor:s}:{}),void 0!==i?{minSize:i}:{}),(0,y.getEnv)(e))}}})).views((function(e){return{get needsScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sources(){var t,n=this,r=Object.fromEntries((null===(t=e.sourcesVolatile)||void 0===t?void 0:t.map((function(e){return[e.name,e]})))||[]),a=e.layout.length?e.layout:e.sourcesVolatile;return null===a||void 0===a?void 0:a.map((function(e){return(0,d.Z)((0,d.Z)({},r[e.name]),e)})).map((function(e,t){return(0,d.Z)((0,d.Z)({},e),{},{color:e.color||(n.isMultiRow?"blue":je.set1[t]||"#000000".replace(/0/g,(function(){return(~~(16*Math.random())).toString(16)})))})}))}}})).views((function(e){var t=[0,0];return{get filled(){var t=e.fill,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"filled")},get summaryScoreModeSetting(){var t=e.summaryScoreMode,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"summaryScoreMode")},get domain(){var n=e.stats,r=e.scaleType,a=e.minScore,i=e.maxScore;if(n){var o=q({domain:[n.scoreMin,n.scoreMax],bounds:[a,i],scaleType:r});return"log"===r&&o[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(Ne()(t,o)||(t=o),t)}},get scaleOpts(){var t=e.scaleType,n=e.stats;return{autoscaleType:this.autoscaleType,domain:this.domain,stats:n,scaleType:t,inverted:(0,P.getConf)(e,"inverted")}},get autoscaleType(){var t;return null!==(t=e.autoscale)&&void 0!==t?t:(0,P.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){var t=e.displayCrossHatches,n=e.rendererConfig;return null!==t&&void 0!==t?t:(0,P.readConfObject)(n,"displayCrossHatches")},get rowHeight(){var t=e.sources,n=e.height;return e.isMultiRow?n/((null===t||void 0===t?void 0:t.length)||1):n},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,P.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}}})).views((function(t){return{get ticks(){var e=t.scaleType,n=t.domain,r=t.isMultiRow,a=t.rowHeight,i=t.useMinimalTicks;if(n){var o=r?0:W,s=(0,fe.axisPropsFromTickScale)(H({scaleType:e,domain:n,range:[a-o,o],inverted:(0,P.getConf)(t,"inverted")}),4);return i?(0,d.Z)((0,d.Z)({},s),{},{values:n}):s}},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]},get adapterCapabilities(){var n=t.adapterTypeName;return e.getAdapterType(n).adapterCapabilities}}})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=t(),r=e.displayCrossHatches,a=e.filters,i=e.height,o=e.resolution,s=e.rpcDriverName,c=e.scaleOpts,u=e.stats,l=e.sources,f=e.ticks,p=e.rendererConfig;return(0,d.Z)((0,d.Z)({},n),{},{notReady:n.notReady||!l||!u,displayModel:e,config:p,displayCrossHatches:r,filters:a,height:i,resolution:o,rpcDriverName:s,scaleOpts:c,sources:l,ticks:f,onMouseMove:function(t,n){return e.setFeatureUnderMouse(n)},onMouseLeave:function(){return e.setFeatureUnderMouse(void 0)}})},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((function(e){var t=e.trackMenuItems,n=(0,P.getConf)(e,"defaultRendering");return{trackMenuItems:function(){return[].concat((0,ie.Z)(t()),(0,ie.Z)(e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){return e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:function(){return e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(t){return{label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:function(){return e.setSummaryScoreMode(t)}}}))}]:[]),(0,ie.Z)(e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map((function(t,n){return{label:t,type:"radio",checked:e.fillSetting===n,onClick:function(){return e.setFill(n)}}}))}]:[]),[{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:function(){return e.toggleLogScale()}}],(0,ie.Z)(e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:function(){return e.toggleCrossHatches()}}]:[]),(0,ie.Z)(n?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map((function(t){return{label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:function(){return e.setRendererType(t)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat((0,ie.Z)(e.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(t){var n=(0,p.Z)(t,2),r=n[0];return{label:n[1],type:"radio",checked:e.autoscaleType===r,onClick:function(){return e.setAutoscale(r)}}}))},{label:"Set min/max score...",onClick:function(){(0,y.getSession)(e).queueDialog((function(t){return[Je,{model:e,handleClose:t}]}))}},{label:"Edit colors/arrangement...",onClick:function(){(0,y.getSession)(e).queueDialog((function(t){return[Xe,{model:e,handleClose:t}]}))}}])}}})).actions((function(e){var t=e.reload,n=e.renderSvg;return{reload:function(){return(0,h.Z)((0,l.Z)().mark((function n(){var r,a;return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setError(),r=new AbortController,n.prev=2,e.setLoading(r),n.next=6,_(e,(0,d.Z)({signal:r.signal},e.renderProps()));case 6:a=n.sent,(0,I.isAlive)(e)&&(e.updateStats(a),t()),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(2),e.setError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[2,10]])})))()},afterAttach:function(){X(e),(0,I.addDisposer)(e,(0,O.autorun)((0,h.Z)((0,l.Z)().mark((function t(){var n,r,a,i,o;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,y.getSession)(e),r=n.rpcManager,a=e.adapterConfig,i=(0,u.getRpcSessionId)(e),t.next=5,r.call(i,"MultiWiggleGetSources",{sessionId:i,adapterConfig:a});case 5:o=t.sent,(0,I.isAlive)(e)&&e.setSources(o);case 7:case"end":return t.stop()}}),t)})))))},renderSvg:function(t){return(0,h.Z)((0,l.Z)().mark((function r(){var a,i;return(0,l.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,O.when)((function(){return!!e.stats&&!!e.regionCannotBeRenderedText}));case 2:return a=(0,y.getContainingView)(e),i=a.offsetPx,r.t0=S.jsxs,r.t1=S.Fragment,r.t2=S.jsx,r.next=8,n(t);case 8:return r.t3=r.sent,r.t4={id:"snpcov",children:r.t3},r.t5=(0,r.t2)("g",r.t4),r.t6=(0,S.jsx)("g",{transform:"translate(".concat(Math.max(-i,0),")"),children:(0,S.jsx)(qe,{model:e,orientation:"left",exportSVG:!0})}),r.t7=[r.t5,r.t6],r.t8={children:r.t7},r.abrupt("return",(0,r.t0)(r.t1,r.t8));case 15:case"end":return r.stop()}}),r)})))()}}}))},Ke=function(e){e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("MultiXYPlotRenderer").configSchema,n=e.getRendererType("MultiDensityRenderer").configSchema,r=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,i=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,P.ConfigurationSchema)("MultiLinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:I.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:I.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:I.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,P.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:n,MultiRowXYPlotRenderer:r,MultiLineRenderer:a,MultiRowLineRenderer:i})},{baseConfiguration:de.fU,explicitlyTyped:!0})}(e);return new le.Z({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:Qe(e,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:_e})}))},$e=["refName","start","end","source"];var et=(0,k.observer)((function(e){var t=e.regions,n=e.features,r=e.bpPerPx,a=e.width,i=e.height,o=e.sources,s=e.onMouseLeave,c=void 0===s?function(){}:s,u=e.onMouseMove,l=void 0===u?function(){}:u,h=e.onFeatureClick,g=void 0===h?function(){}:h,m=e.displayModel,v=(0,p.Z)(t,1)[0],b=(0,C.useRef)(null);function x(e,t){if(b.current){var s=b.current.getBoundingClientRect(),c=e-s.left,u=t-s.top,l=o[Math.floor(u/i*o.length)];if(l){var p,h=v.reversed?a-c:c,g=v.start+r*h;if(m.isMultiRow){var x,k=(0,w.Z)(n.values());try{for(k.s();!(x=k.n()).done;){var C=x.value;if(C.get("source")===l.name&&(g<=C.get("end")+r&&g>=C.get("start"))){p=C;break}}}catch(R){k.e(R)}finally{k.f()}}else{var Z,S=[],T=(0,w.Z)(n.values());try{for(T.s();!(Z=T.n()).done;){var M=Z.value;g<=M.get("end")+r&&g>=M.get("start")&&S.push(M)}}catch(R){T.e(R)}finally{T.f()}if(S.length){var P=Math.floor(g);p=new y.SimpleFeature((0,d.Z)((0,d.Z)({uniqueId:"mouseoverfeat",sources:Object.fromEntries(S.map((function(e){return e.toJSON()})).map((function(e){e.refName,e.start,e.end;return[e.source,(0,f.Z)(e,$e)]})))},v),{},{start:P,end:P+1}))}}return p}}}return(0,S.jsx)("div",{ref:b,onMouseMove:function(e){var t=x(e.clientX,e.clientY);l(e,t)},onClick:function(e){var t=x(e.clientX,e.clientY);g(e,t)},onMouseLeave:function(e){return c(e)},style:{overflow:"visible",position:"relative",height:i},children:(0,S.jsx)(Z.PrerenderedCanvas,(0,d.Z)({},e))})})),tt=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a,i,o,s,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.sources,i=r.features,o=U((0,ie.Z)(i.values()),(function(e){return e.get("source")})),e.next=4,n.e(5707).then(n.t.bind(n,55707,23)).then((function(e){return e.default}));case 4:return s=e.sent,c=[],a.forEach((function(e){var n=o[e.name];if(n){var a=te(t,(0,d.Z)((0,d.Z)({},r),{},{features:n,offset:W,colorCallback:function(){return e.color||"blue"},Color:s})).reducedFeatures;c=c.concat(a)}})),e.abrupt("return",{reducedFeatures:c});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(x);var nt=(0,P.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:I.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:B,explicitlyTyped:!0}),rt=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a,i,o,s,c,u,f,h,g,m,v;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.bpPerPx,i=r.sources,o=r.regions,s=r.features,c=(0,p.Z)(o,1),u=c[0],f=U((0,ie.Z)(s.values()),(function(e){return e.get("source")})),h=r.height/Object.keys(f).length,g=(u.end-u.start)/a,e.next=7,n.e(5707).then(n.t.bind(n,55707,23)).then((function(e){return e.default}));case 7:return m=e.sent,v=[],t.save(),i.forEach((function(e){var n=f[e.name];if(n){var a=te(t,(0,d.Z)((0,d.Z)({},r),{},{features:n,height:h,colorCallback:function(){return e.color||"blue"},Color:m})).reducedFeatures;t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,h),t.lineTo(g,h),t.stroke(),t.translate(0,h),v=v.concat(a)}})),t.restore(),e.abrupt("return",{reducedFeatures:v});case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),r}(x);var at=(0,P.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:I.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:B,explicitlyTyped:!0});var it=(0,P.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:B,explicitlyTyped:!0}),ot=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,f,h,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.bpPerPx,a=n.sources,i=n.regions,o=n.features,s=(0,p.Z)(i,1),c=s[0],u=U((0,ie.Z)(o.values()),(function(e){return e.get("source")})),f=n.height/Object.keys(u).length,h=(c.end-c.start)/r,g=[],t.save(),a.forEach((function(e){var r=u[e.name];if(r){var a=re(t,(0,d.Z)((0,d.Z)({},n),{},{features:r,height:f})).reducedFeatures;t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,f),t.lineTo(h,f),t.stroke(),t.translate(0,f),g=g.concat(a)}})),t.restore(),e.abrupt("return",{reducedFeatures:g});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x),st=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.sources,a=n.features,i=U((0,ie.Z)(a.values()),(function(e){return e.get("source")})),o=[],r.forEach((function(e){var r=i[e.name];if(r){var a=ne(t,(0,d.Z)((0,d.Z)({},n),{},{features:r,colorCallback:function(){return e.color||"blue"}})).reducedFeatures;o=o.concat(a)}})),e.abrupt("return",{reducedFeatures:o});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x);var ct=(0,P.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:I.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:B,explicitlyTyped:!0}),ut=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c,u,f,h,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.bpPerPx,a=n.sources,i=n.regions,o=n.features,s=(0,p.Z)(i,1),c=s[0],u=U((0,ie.Z)(o.values()),(function(e){return e.get("source")})),f=n.height/Object.keys(u).length,h=(c.end-c.start)/r,g=[],t.save(),a.forEach((function(e){var r=ne(t,(0,d.Z)((0,d.Z)({},n),{},{features:u[e.name],height:f,colorCallback:function(){return e.color||"blue"}})).reducedFeatures;t.strokeStyle="rgba(200,200,200,0.8)",t.beginPath(),t.moveTo(0,f),t.lineTo(h,f),t.stroke(),t.translate(0,f),g=g.concat(r)})),t.restore(),e.abrupt("return",{reducedFeatures:g});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x);var lt=(0,P.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:I.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:B,explicitlyTyped:!0}),dt=(0,C.lazy)((function(){return n.e(2287).then(n.bind(n,2287))}));function ft(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",(function(e,t){var n=t.session;return[].concat((0,ie.Z)(e),(0,ie.Z)((0,y.isSessionWithAddTracks)(n)?[{label:"Create multi-wiggle track",onClick:function(e){var t=e.selection,n=t.map((function(e){return(0,P.readConfObject)(e,"name")}));(0,y.getSession)(e).queueDialog((function(r){return[dt,{tracks:t,onClose:function(a,i){a&&i&&function(r){var a=t.map((function(e){return(0,P.readConfObject)(e,"adapter")})).map((function(e,t){return(0,d.Z)((0,d.Z)({},e),{},{source:n[t]})})),i=(0,ie.Z)(new Set(t.map((function(e){return(0,P.readConfObject)(e,"assemblyNames")})).flat())),o=+Date.now(),s="multitrack-".concat(o,"-sessionTrack");(0,y.getSession)(e).addTrackConf({type:"MultiQuantitativeTrack",trackId:s,name:r.name,assemblyNames:i,adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(s)}(i),r()}}]}))}}]:[]))}))}var pt=n(91271),ht=n(6880),gt=n(66519),mt=n(44536),vt=(0,ge.ZL)()((function(e){return{textbox:{width:"100%"},paper:{margin:e.spacing(),padding:e.spacing()},submit:{marginTop:25,marginBottom:100,display:"block"}}}));function yt(e){var t=e.model,n=vt().classes,r=(0,C.useState)(""),a=(0,p.Z)(r,2),i=a[0],o=a[1],s=(0,C.useState)("MultiWiggle "+Date.now()),c=(0,p.Z)(s,2),l=c[0],f=c[1];return(0,S.jsxs)(ht.Z,{className:n.paper,children:[(0,S.jsxs)("ul",{children:[(0,S.jsx)("li",{children:"Enter list of URLs for bigwig files in the textbox"}),(0,S.jsx)("li",{children:"Or, use the button below the text box to select files from your computer"})]}),(0,S.jsx)(gt.Z,{multiline:!0,rows:10,value:i,onChange:function(e){return o(e.target.value)},placeholder:"Paste list of URLs here, or use file selector below",variant:"outlined",className:n.textbox}),(0,S.jsxs)(mt.Z,{variant:"outlined",component:"label",children:["Choose Files from your computer",(0,S.jsx)("input",{type:"file",hidden:!0,multiple:!0,onChange:function(e){var t=e.target,n=Array.from((null===t||void 0===t?void 0:t.files)||[]).map((function(e){return{type:"BigWigAdapter",bigWigLocation:y.isElectron?{localPath:e.path,locationType:"LocalPathLocation"}:(0,u.storeBlobLocation)({blob:e}),source:e.name}}));o(JSON.stringify(n,null,2))}})]}),(0,S.jsx)(gt.Z,{value:l,onChange:function(e){return f(e.target.value)},helperText:"Track name"}),(0,S.jsx)(mt.Z,{variant:"contained",className:n.submit,onClick:function(){var e,n,r=(0,y.getSession)(t),a=["".concat(l.toLowerCase().replace(/ /g,"_"),"-").concat(Date.now()),"".concat(r.adminMode?"":"-sessionTrack")].join("");try{n=JSON.parse(i)}catch(s){n=i.split(/\n|\r\n|\r/)}var o="string"===typeof n[0]?{bigWigs:n}:{subadapters:n};r.addTrackConf({trackId:a,type:"MultiQuantitativeTrack",name:l,assemblyNames:[t.assembly],adapter:(0,d.Z)({type:"MultiWiggleAdapter"},o)}),null===(e=t.view)||void 0===e||e.showTrack(a),t.clearData(),r.hideWidget(t)},children:"Submit"}),(0,S.jsx)("p",{children:"Additional notes: "}),(0,S.jsxs)("ul",{children:[(0,S.jsxs)("li",{children:["The list of bigwig files in the text box can be a list of URLs, or a list of elements like"," ",(0,S.jsx)("code",{children:'[{"type":"BigWigAdapter","bigWigLocation":{"uri":"http://host/file.bw"}, "color":"green","source":"name for subtrack"}]'})," ","to apply e.g. the color attribute to the view"]}),(0,S.jsx)("li",{children:'Adding local files will update the textbox with JSON contents that are ready to submit with the "Submit" button'})]})]})}var bt=n(42273),xt=n(21742),wt=n(75019),kt=n(82972),Ct=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WiggleGetGlobalStats",e}return(0,i.Z)(n,[{key:"deserializeArguments",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.Z)((0,m.Z)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",(0,d.Z)((0,d.Z)({},a),{},{filters:t.filters?new xt.Z({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.adapterConfig,o=a.sessionId,e.next=7,(0,wt.uP)(r,o,i);case 7:return s=e.sent,c=s.dataAdapter,e.abrupt("return",c.getGlobalStats(a));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(bt.Z),Zt=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WiggleGetMultiRegionStats",e}return(0,i.Z)(n,[{key:"deserializeArguments",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.Z)((0,m.Z)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",(0,d.Z)((0,d.Z)({},a),{},{filters:t.filters?new xt.Z({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a,i,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.pluginManager,c=null===(a=s.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager){e.next=4;break}return e.abrupt("return",t);case 4:return e.next=6,(0,y.renameRegionsIfNeeded)(c,(0,d.Z)((0,d.Z)({},t),{},{filters:null===(o=t.filters)||void 0===o?void 0:o.toJSON().filters}));case 6:return u=e.sent,e.abrupt("return",(0,g.Z)((0,m.Z)(n.prototype),"serializeArguments",this).call(this,u,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.regions,o=a.adapterConfig,s=a.sessionId,e.next=7,(0,wt.uP)(r,s,o);case 7:if(c=e.sent,!((u=c.dataAdapter)instanceof kt.BaseFeatureDataAdapter)){e.next=11;break}return e.abrupt("return",u.getMultiRegionStats(i,a));case 11:throw new Error("Data adapter not found");case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(bt.Z),St=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="MultiWiggleGetSources",e}return(0,i.Z)(n,[{key:"deserializeArguments",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,g.Z)((0,m.Z)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",(0,d.Z)((0,d.Z)({},a),{},{filters:t.filters?new xt.Z({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,r){var a,i,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.pluginManager,c=null===(a=s.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager){e.next=4;break}return e.abrupt("return",t);case 4:return e.next=6,(0,y.renameRegionsIfNeeded)(c,(0,d.Z)((0,d.Z)({},t),{},{filters:null===(o=t.filters)||void 0===o?void 0:o.toJSON().filters}));case 6:return u=e.sent,e.abrupt("return",(0,g.Z)((0,m.Z)(n.prototype),"serializeArguments",this).call(this,u,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,h.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s,c,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pluginManager,e.next=3,this.deserializeArguments(t,n);case 3:return a=e.sent,i=a.regions,o=a.adapterConfig,s=a.sessionId,e.next=7,(0,wt.uP)(r,s,o);case 7:return c=e.sent,u=c.dataAdapter,e.abrupt("return",u.getSources(i,a));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(bt.Z),Tt=function(e){(0,o.Z)(c,e);var t=(0,s.Z)(c);function c(){var e;(0,a.Z)(this,c);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:Se,XYPlotRendererReactComponent:T,XYPlotRenderer:oe,WiggleBaseRenderer:x,linearWiggleDisplayModelFactory:Re,xyPlotRendererConfigSchema:se,utils:r},e}return(0,i.Z)(c,[{key:"install",value:function(e){e.addAdapterType((function(){return new M.Z({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:F,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:function(){return n.e(9018).then(n.bind(n,79018)).then((function(e){return e.default}))}})})),function(e){e.addAdapterType((function(){return new M.Z({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:R,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:function(){return Promise.all([n.e(2018),n.e(590),n.e(9605)]).then(n.bind(n,99605)).then((function(e){return e.default}))}})}))}(e),function(e){e.addTrackType((function(){var t=N(e);return new L.Z({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,A.createBaseTrackModel)(e,"QuantitativeTrack",t)})}))}(e),function(e){e.addTrackType((function(){var t=j(e);return new L.Z({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,A.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})}))}(e),Ae(e),Ke(e),function(e){e.addRendererType((function(){return new ue({name:"LinePlotRenderer",ReactComponent:T,configSchema:ce,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new oe({name:"XYPlotRenderer",ReactComponent:T,configSchema:se,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new ae({name:"DensityRenderer",ReactComponent:T,configSchema:D,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new tt({name:"MultiXYPlotRenderer",ReactComponent:et,configSchema:nt,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new rt({name:"MultiRowXYPlotRenderer",ReactComponent:et,configSchema:at,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new ot({name:"MultiDensityRenderer",ReactComponent:et,configSchema:it,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new st({name:"MultiLineRenderer",ReactComponent:et,configSchema:ct,pluginManager:e})}))}(e),function(e){e.addRendererType((function(){return new ut({name:"MultiRowLineRenderer",ReactComponent:et,configSchema:lt,pluginManager:e})}))}(e),function(e){e.addAddTrackWorkflowType((function(){return new pt.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:yt,stateModel:I.types.model({})})}))}(e),ft(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigWigAdapter",i=(0,u.getFileName)(t),o={type:a,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BigWigAdapter"===t?"QuantitativeTrack":e(t)}})),e.addRpcMethod((function(){return new Ct(e)})),e.addRpcMethod((function(){return new Zt(e)})),e.addRpcMethod((function(){return new St(e)}))}}]),c}(c.Z)},31158:function(){}}]);
//# sourceMappingURL=6189.ee2b9c82.chunk.js.map