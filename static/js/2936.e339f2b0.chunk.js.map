{"version":3,"file":"static/js/2936.e339f2b0.chunk.js","mappings":"iOAwCO,SAAeA,EAAWC,GAAA,OAAAC,EAAAC,MAAC,KAADC,UAAA,CAsBhC,SAAAF,IAAA,OAAAA,GAAAG,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAtBM,SAAAC,EACLC,GAA8D,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAT,EAAAA,EAAAA,KAAAU,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAK1B,GAHpCT,GACoCU,EAAAA,EAAAA,oBAAmBX,GAAjCE,EAASD,EAAvBW,aAAYT,GACGU,EAAAA,EAAAA,YAAWb,GAA1BI,EAAUD,EAAVC,YACFC,GAAOS,EAAAA,EAAAA,mBAAkBd,IAErBe,cAAef,EAAKgB,QAAShB,EAAKiB,eAAc,CAAAT,EAAAE,KAAA,eAAAF,EAAAU,OAAA,iBAIrC,OAArBlB,EAAKmB,YAAW,GAAKX,EAAAE,KAAA,EACFN,EAAWgB,KAAKlB,EAAW,2BAA4B,CACxEA,UAAAA,EACAmB,QAAShB,EAAKiB,aAAaC,cAC3BC,UAAUC,EAAAA,EAAAA,aAAYzB,EAAKwB,UAC3BE,cAAe1B,EAAK0B,gBACpB,OALIpB,EAAGE,EAAAmB,KAOT3B,EAAK4B,aAAatB,GAClBN,EAAKmB,YAAW,GAAM,yBAAAX,EAAAqB,OAAA,GAAA9B,EAAA,MACvBL,MAAA,KAAAC,UAAA,CCtDM,SAASmC,EACd9B,EACA+B,GAeA,SAASC,EAAK3B,GACZ,IAAM4B,EAASjC,EAAKkC,IACpB,GAAKD,EAAL,CAIA,IAAME,EAAMF,EAAOG,WAAW,MACzBD,GAIAnC,EAAKqC,YAIVF,EAAIG,UAAU,EAAG,EAAGL,EAAOM,MAAqB,EAAdvC,EAAKwC,QACvCL,EAAIM,iBACJN,EAAIO,MAAM,EAAG,GACbX,EAAG/B,EAAMmC,EAAKF,EAAOM,MAAOvC,EAAKwC,QACjCxC,EAAK2C,qBAAqBtC,EAAKuC,UAC/B5C,EAAK6C,oBAAoBxC,EAAKyC,SAhB9B,CAiBF,EA7BAC,EAAAA,EAAAA,IACE/C,GAAIJ,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MACJ,SAAAC,IAAA,OAAAF,EAAAA,EAAAA,KAAAU,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,cAAAF,EAAAE,KAAA,EACQnB,EAAYS,GAAK,wBAAAQ,EAAAqB,OAAA,GAAA9B,EAAA,KAEzB,CAAEiD,MAAO,OA2BXD,EAAAA,EAAAA,IAAc/C,GAAIJ,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAE,SAAAmD,IAAA,IAAA5C,EAAA,OAAAR,EAAAA,EAAAA,KAAAU,MAAA,SAAA2C,GAAA,cAAAA,EAAAzC,KAAAyC,EAAAxC,MAAA,QACZL,GAAOS,EAAAA,EAAAA,mBAAkBd,IACtB8C,UAAY9C,EAAKmD,kBACxBnB,EAAK3B,GACN,wBAAA6C,EAAArB,OAAA,GAAAoB,EAAA,OAIHF,EAAAA,EAAAA,IACE/C,GAAIJ,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MACJ,SAAAsD,IAAA,OAAAvD,EAAAA,EAAAA,KAAAU,MAAA,SAAA8C,GAAA,cAAAA,EAAA5C,KAAA4C,EAAA3C,MAAA,OAEEsB,GADalB,EAAAA,EAAAA,mBAAkBd,IACrB,wBAAAqD,EAAAxB,OAAA,GAAAuB,EAAA,KAEZ,CAAEJ,MAAO,KAEb,C","sources":["../../../plugins/alignments/src/shared/fetchChains.ts","../../../plugins/alignments/src/shared/afterAttach.tsx"],"sourcesContent":["import {\n  getContainingTrack,\n  getContainingView,\n  getSession,\n} from '@jbrowse/core/util'\nimport { getSnapshot } from 'mobx-state-tree'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { LinearReadArcsDisplayModel } from '../LinearReadArcsDisplay/model'\nimport { LinearReadCloudDisplayModel } from '../LinearReadCloudDisplay/model'\n\ntype LGV = LinearGenomeViewModel\n\nexport interface ReducedFeature {\n  name: string\n  strand: number\n  refName: string\n  start: number\n  end: number\n  id: string\n  flags: number\n  tlen: number\n  pair_orientation: string\n  next_ref?: string\n  next_pos?: number\n  clipPos: number\n  SA?: string\n}\n\nexport interface ChainStats {\n  max: number\n  min: number\n  upper: number\n  lower: number\n}\n\nexport interface ChainData {\n  chains: ReducedFeature[][]\n  stats?: ChainStats\n}\n\nexport async function fetchChains(\n  self: LinearReadArcsDisplayModel | LinearReadCloudDisplayModel,\n) {\n  // @ts-expect-error\n  const { rpcSessionId: sessionId } = getContainingTrack(self)\n  const { rpcManager } = getSession(self)\n  const view = getContainingView(self) as LGV\n\n  if (!view.initialized || self.error || self.regionTooLarge) {\n    return\n  }\n\n  self.setLoading(true)\n  const ret = (await rpcManager.call(sessionId, 'PileupGetReducedFeatures', {\n    sessionId,\n    regions: view.staticBlocks.contentBlocks,\n    filterBy: getSnapshot(self.filterBy),\n    adapterConfig: self.adapterConfig,\n  })) as ChainData\n\n  self.setChainData(ret)\n  self.setLoading(false)\n}\n","import { getContainingView } from '@jbrowse/core/util'\nimport { createAutorun } from '../util'\nimport { fetchChains } from './fetchChains'\nimport { LinearGenomeViewModel } from '@jbrowse/plugin-linear-genome-view'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\n\ntype LGV = LinearGenomeViewModel\n\nexport function doAfterAttach<T extends IAnyStateTreeNode>(\n  self: T,\n  cb: (\n    self: T,\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number,\n  ) => void,\n) {\n  createAutorun(\n    self,\n    async () => {\n      await fetchChains(self)\n    },\n    { delay: 1000 },\n  )\n\n  function draw(view: LGV) {\n    const canvas = self.ref\n    if (!canvas) {\n      return\n    }\n\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      return\n    }\n\n    if (!self.chainData) {\n      return\n    }\n\n    ctx.clearRect(0, 0, canvas.width, self.height * 2)\n    ctx.resetTransform()\n    ctx.scale(2, 2)\n    cb(self, ctx, canvas.width, self.height)\n    self.setLastDrawnOffsetPx(view.offsetPx)\n    self.setLastDrawnBpPerPx(view.bpPerPx)\n  }\n\n  // first autorun instantly draws if bpPerPx changes\n  createAutorun(self, async () => {\n    const view = getContainingView(self) as LGV\n    if (view.bpPerPx !== self.lastDrawnBpPerPx) {\n      draw(view)\n    }\n  })\n\n  // second autorun draws after delay 1000 e.g. if offsetPx changes\n  createAutorun(\n    self,\n    async () => {\n      const view = getContainingView(self) as LGV\n      draw(view)\n    },\n    { delay: 1000 },\n  )\n}\n"],"names":["fetchChains","_x","_fetchChains","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","self","_getContainingTrack","sessionId","_getSession","rpcManager","view","ret","wrap","_context","prev","next","getContainingTrack","rpcSessionId","getSession","getContainingView","initialized","error","regionTooLarge","abrupt","setLoading","call","regions","staticBlocks","contentBlocks","filterBy","getSnapshot","adapterConfig","sent","setChainData","stop","doAfterAttach","cb","draw","canvas","ref","ctx","getContext","chainData","clearRect","width","height","resetTransform","scale","setLastDrawnOffsetPx","offsetPx","setLastDrawnBpPerPx","bpPerPx","createAutorun","delay","_callee2","_context2","lastDrawnBpPerPx","_callee3","_context3"],"sourceRoot":""}