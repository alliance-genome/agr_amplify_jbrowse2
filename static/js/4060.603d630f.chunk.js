"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4060],{24060:(t,e,r)=>{r.d(e,{makeImageData:()=>b});var a=r(68584),o=r(49823),n=r(99546);function i(t,e,r,a,o,n,i){e+a<0||e>n||(i&&(t.fillStyle=i),t.fillRect(e,r,a,o))}function s(t){const{bases:e}=t.palette;return{A:e.A.main,C:e.C.main,G:e.G.main,T:e.T.main,deletion:"#808080"}}function c(){return{charWidth:(0,n.measureText)("A"),charHeight:(0,n.measureText)("M")-2}}var l=r(36917),f=r(86576);function h({colorType:t,tag:e,feature:r,config:o,defaultColor:n,colorTagMap:i}){switch(t){case"insertSize":return function(t){return t.get("is_paired")&&t.get("refName")!==t.get("next_ref")?"#555":`hsl(${Math.abs(t.get("template_length"))/10},50%,50%)`}(r);case"strand":return function(t){return-1===t.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(t){return`hsl(${t.get("score")},50%,50%)`}(r);case"pairOrientation":return function(t,e){return l.pf[function(t,e){const r=(0,a.readConfObject)(e,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[f.il[r][t.get("pair_orientation")]]}(t,e)||"color_nostrand"]}(r,o);case"stranded":return function(t){return l.pf[function(t){const e=t.get("flags"),r=t.get("strand");if(1&e){const a=64&e?-1:1;return 2&e?r*a==1?"color_rev_strand":"color_fwd_strand":8&e?r*a==1?"color_rev_missing_mate":"color_fwd_missing_mate":t.get("refName")===t.get("next_ref")?r*a==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(t)]}(r);case"xs":case"tag":{const t=r.get("tags"),a=t?t[e]:r.get(e);return"XS"===e||"TS"===e?l.pf[{"-":"color_rev_strand","+":"color_fwd_strand"}[a]||"color_nostrand"]:"ts"===e?l.pf[{"-":-1===r.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===r.get("strand")?"color_rev_strand":"color_fwd_strand"}[a]||"color_nostrand"]:i[a]||l.pf.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return n?"lightgrey":(0,a.readConfObject)(o,"color",{feature:r})}}var g=r(80544),d=r(87485);function p({ctx:t,feat:e,renderArgs:r,colorForBase:a,contrastForBase:o,charWidth:s,charHeight:c,defaultColor:l,canvasWidth:p}){const{config:u,bpPerPx:x,regions:b,colorBy:m,colorTagMap:P={}}=r,{tag:_="",type:S=""}=m||{},{feature:T}=e,y=b[0];switch(t.fillStyle=h({feature:T,config:u,tag:_,defaultColor:l,colorType:S,colorTagMap:P}),function({ctx:t,feat:e,renderArgs:r}){const{regions:a,bpPerPx:o}=r,{heightPx:i,topPx:s,feature:c}=e,[l]=a,f=c.get("start"),h=c.get("end"),[g,d]=(0,n.bpSpanPx)(f,h,l,o),p=l.reversed?-1:1,u=c.get("strand")*p;o<10&&i>5?-1===u?(t.beginPath(),t.moveTo(g-5,s+i/2),t.lineTo(g,s+i),t.lineTo(d,s+i),t.lineTo(d,s),t.lineTo(g,s),t.closePath(),t.fill()):(t.beginPath(),t.moveTo(g,s),t.lineTo(g,s+i),t.lineTo(d,s+i),t.lineTo(d+5,s+i/2),t.lineTo(d,s),t.closePath(),t.fill()):t.fillRect(g,s,d-g,i)}({ctx:t,feat:e,renderArgs:r}),S){case"perBaseQuality":!function({ctx:t,feat:e,region:r,bpPerPx:a,canvasWidth:o}){const{feature:s,topPx:c,heightPx:l}=e,f=(s.get("qual")||"").split(" ").map((t=>+t)),h=(0,g.parseCigar)(s.get("CIGAR")),d=1/a,p=s.get("start");let u=0,x=0;for(let e=0;e<h.length;e+=2){const s=+h[e],g=h[e+1];if("S"===g||"I"===g)u+=s;else if("D"===g||"N"===g)x+=s;else if("M"===g||"X"===g||"="===g){for(let e=0;e<s;e++){const s=f[u+e],h=p+x+e;i(t,(0,n.bpSpanPx)(h,h+1,r,a)[0],c,d+.5,l,o,`hsl(${255===s?150:1.5*s},55%,50%)`)}u+=s,x+=s}}}({ctx:t,feat:e,region:y,bpPerPx:x,canvasWidth:p});break;case"perBaseLettering":!function({ctx:t,feat:e,region:r,bpPerPx:a,colorForBase:o,contrastForBase:s,charWidth:c,charHeight:l,canvasWidth:f}){const h=l-2,{feature:d,topPx:p,heightPx:u}=e,x=d.get("seq"),b=(0,g.parseCigar)(d.get("CIGAR")),m=1/a,P=d.get("start");let _=0,S=0;if(x)for(let e=0;e<b.length;e+=2){const l=+b[e],g=b[e+1];if("S"===g||"I"===g)_+=l;else if("D"===g||"N"===g)S+=l;else if("M"===g||"X"===g||"="===g){for(let e=0;e<l;e++){const l=x[_+e],g=P+S+e,[d]=(0,n.bpSpanPx)(g,g+1,r,a);i(t,d,p,m+.5,u,f,o[l]),m>=c&&u>=h&&(t.fillStyle=s[l],t.fillText(l,d+(m-c)/2+1,p+u))}_+=l,S+=l}}}({ctx:t,feat:e,region:y,bpPerPx:x,colorForBase:a,contrastForBase:o,charWidth:s,charHeight:c,canvasWidth:p});break;case"modifications":!function({ctx:t,feat:e,region:r,bpPerPx:a,renderArgs:o,canvasWidth:s}){const{feature:c,topPx:l,heightPx:h}=e,{modificationTagMap:p={}}=o,u=c.get("seq");if(!u)return;const x=(0,f.c$)(c,"MM","Mm")||"",b=c.get("CIGAR"),m=c.get("start"),P=c.get("strand"),_=(0,g.parseCigar)(b),S=(0,g.getModificationProbabilities)(c),T=(0,g.getModificationPositions)(x,u,P);let y=0;for(const{type:e,positions:o}of T){const c=p[e]||"black",f=(0,d.M)(c);for(const e of(0,g.getNextRefPos)(_,o)){const o=m+e,[g,d]=(0,n.bpSpanPx)(o,o+1,r,a),p=S?.[y]||0;i(t,g,l,d-g+.5,h,s,1!==p?f.alpha(p+.1).toHslString():c),y++}}}({ctx:t,feat:e,region:y,bpPerPx:x,renderArgs:r,canvasWidth:p});break;case"methylation":!function({ctx:t,feat:e,region:r,bpPerPx:a,renderArgs:o,canvasWidth:s}){const{regionSequence:c}=o,{feature:l,topPx:f,heightPx:h}=e;if(!c)throw new Error("region sequence required for methylation");if(!l.get("seq"))return;const p=l.get("start"),u=l.get("end"),{methBins:x,methProbs:b}=(0,g.getMethBins)(l);function m(t){if(x[t]){const e=b[t]||0;return(e>.5?(0,d.M)("red").alpha(2*(e-.5)):(0,d.M)("blue").alpha(1-2*e)).toHslString()}}for(let e=0;e<u-p;e++){const o=e+p,l=c[o-r.start+1]?.toLowerCase(),g=c[o-r.start+2]?.toLowerCase();if("c"===l&&"g"===g)if(a>2){const[c,l]=(0,n.bpSpanPx)(o,o+2,r,a);i(t,c,f,l-c+.5,h,s,m(e)||m(e+1)||"blue")}else{const[c,l]=(0,n.bpSpanPx)(o,o+1,r,a);i(t,c,f,l-c+.5,h,s,m(e)||"blue");const[g,d]=(0,n.bpSpanPx)(o+1,o+2,r,a);i(t,g,f,d-g+.5,h,s,m(e+1)||"blue")}}}({ctx:t,feat:e,region:y,bpPerPx:x,renderArgs:r,canvasWidth:p})}}function u({ctx:t,feat:e,renderArgs:r,minSubfeatureWidth:a,largeInsertionIndicatorScale:o,mismatchAlpha:s,charWidth:c,charHeight:l,colorForBase:f,contrastForBase:h,canvasWidth:g,drawSNPsMuted:p,drawIndels:u=!0}){const{bpPerPx:x,regions:b}=r,{heightPx:m,topPx:P,feature:_}=e,[S]=b,T=_.get("start"),y=Math.min(1/x,2),M=_.get("mismatches"),v=l-2,w=S.reversed?1/x+1:-1;if(M){for(const e of M){const r=T+e.start,o=e.length,l=e.base,[b,_]=(0,n.bpSpanPx)(r,r+o,S,x),M=Math.max(a,Math.abs(b-_));if("mismatch"===e.type){if(!p){const r=f[e.base]||"#888",a=s?void 0===e.qual?r:(0,d.M)(r).alpha(Math.min(1,e.qual/50)).toHslString():r;i(t,Math.round(b),P,M,m,g,a)}if(M>=c&&m>=v){const r=p?"black":h[e.base]||"black";t.fillStyle=s?void 0===e.qual?r:(0,d.M)(r).alpha(Math.min(1,e.qual/50)).toHslString():r,t.fillText(l,b+(M-c)/2+1,P+m)}}else if("deletion"===e.type&&u){i(t,b,P,Math.abs(b-_),m,g,f.deletion);const r=`${e.length}`,a=(0,n.measureText)(r,10);M>=a&&m>=v&&(t.fillStyle=h.deletion,t.fillText(r,(b+_)/2-a/2,P+m))}else if("insertion"===e.type&&u){t.fillStyle="purple";const r=b+w,a=+e.base||e.length,o=Math.max(0,Math.min(1.2,1/x));if(a<10&&(i(t,r,P,o,m,g,"purple"),1/x>=c&&m>=v)){const a=r-o;i(t,a,P,3*o,1,g),i(t,a,P+m-1,3*o,1,g),t.fillText(`(${e.base})`,r+3,P+m)}}else if("hardclip"===e.type||"softclip"===e.type){const r=b+w,o="hardclip"===e.type?"red":"blue",n=Math.max(a,y);if(i(t,r,P,n,m,g,o),1/x>=c&&m>=v){const a=r-n;i(t,a,P,3*n,1,g),i(t,a,P+m-1,3*n,1,g),t.fillText(`(${e.base})`,r+3,P+m)}}else if("skip"===e.type&&b+M>0){const e=M-(x>10?1.5:0);t.clearRect(b,P,e,m),i(t,Math.max(0,b),P+m/2-1,e+(b<0?b:0),2,g,"#333")}}if(u)for(const e of M){const r=T+e.start,a=e.length,[s]=(0,n.bpSpanPx)(r,r+a,S,x),c=+e.base||e.length,f=`${c}`;if("insertion"===e.type&&c>=10)if(x>o)i(t,s-1,P,2,m,g,"purple");else if(m>l){const e=(0,n.measureText)(f),r=5;i(t,s-e/2-r,P,e+2*r,m,g,"purple"),t.fillStyle="white",t.fillText(f,s-e/2,P+m)}else{const e=2;i(t,s-e,P,2*e,m,g,"purple")}}}}function x({ctx:t,feat:e,renderArgs:r,config:o,theme:s,colorForBase:l,canvasWidth:f}){const{feature:h,topPx:g,heightPx:d}=e,{regions:p,bpPerPx:u}=r,[x]=p,b=(0,a.readConfObject)(o,"minSubfeatureWidth"),m=h.get("mismatches"),P=h.get("seq"),{charWidth:_,charHeight:S}=c();if(!P||!m)return;const T=S-2;for(const e of m)if("softclip"===e.type){const r=e.cliplen||0,a=h.get("start"),o=0===e.start?a-r:a+e.start;for(let a=0;a<r;a+=1){const r=P.charAt(a+e.start);if(!r)return;const c=o+a,[h,p]=(0,n.bpSpanPx)(c,c+1,x,u),m=Math.max(b,p-h),S=l[r]||"#000000";t.fillStyle=S,i(t,h,g,m,d,f),m>=_&&d>=T&&(t.fillStyle=s.palette.getContrastText(S),t.fillText(r,h+(m-_)/2+1,g+d))}}}function b({ctx:t,layoutRecords:e,canvasWidth:r,renderArgs:n}){const{config:i,showSoftClip:l,colorBy:f,theme:h}=n,g=(0,a.readConfObject)(i,"mismatchAlpha"),d=(0,a.readConfObject)(i,"minSubfeatureWidth"),b=(0,a.readConfObject)(i,"largeInsertionIndicatorScale"),m="#f0f"===(0,a.readConfObject)(i,"color"),P=(0,o.createJBrowseTheme)(h),_=s(P),S=function(t){return Object.fromEntries(Object.entries(s(t)).map((([e,r])=>[e,t.palette.getContrastText(r)])))}(P);t.font="bold 10px Courier New,monospace";const{charWidth:T,charHeight:y}=c(),M=(v=f?.type,["methylation","modifications"].includes(v||""));var v;for(const a of e)p({ctx:t,feat:a,renderArgs:n,defaultColor:m,colorForBase:_,contrastForBase:S,charWidth:T,charHeight:y,canvasWidth:r}),u({ctx:t,feat:a,renderArgs:n,mismatchAlpha:g,drawSNPsMuted:M,drawIndels:!0,largeInsertionIndicatorScale:b,minSubfeatureWidth:d,charWidth:T,charHeight:y,colorForBase:_,contrastForBase:S,canvasWidth:r}),l&&x({ctx:t,feat:a,renderArgs:n,colorForBase:_,config:i,theme:P,canvasWidth:r})}}}]);
//# sourceMappingURL=4060.603d630f.chunk.js.map