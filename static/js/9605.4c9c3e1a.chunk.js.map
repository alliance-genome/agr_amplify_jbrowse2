{"version":3,"file":"static/js/9605.4c9c3e1a.chunk.js","mappings":"4TAkBqBA,EAAa,SAAAC,IAAAC,EAAAA,EAAAA,GAAAF,EAAAC,GAAA,IAAAE,GAAAC,EAAAA,EAAAA,GAAAJ,GAAA,SAAAA,IAAA,IAAAK,GAAAC,EAAAA,EAAAA,GAAA,KAAAN,GAAA,QAAAO,EAAAC,UAAAC,OAAAC,EAAA,IAAAC,MAAAJ,GAAAK,EAAA,EAAAA,EAAAL,EAAAK,IAAAF,EAAAE,GAAAJ,UAAAI,GAElB,OAFkBP,EAAAF,EAAAU,KAAAC,MAAAX,EAAA,OAAAY,OAAAL,KAExBM,YAAM,EAAAX,CAAA,CA0FiB,OA1FjBY,EAAAA,EAAAA,GAAAjB,EAAA,EAAAkB,IAAA,WAAAC,MAAA,eAAAC,GAAAC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAQd,SAAAC,EAAuBC,GAAkB,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAR,EAAAA,EAAAA,KAAAS,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAKrC,OAJ8CR,GAAVD,GAAQ,CAAC,GAAvCE,eAAAA,OAAc,IAAAD,EAAG,WAAO,EAACA,EAC3BE,EAAKO,KAAKC,cACVP,EAAS,IAAIQ,EAAAA,EAAO,CACxBC,YAAYC,EAAAA,EAAAA,cAAaJ,KAAKK,QAAQ,kBAAmBZ,KACzDI,EAAAE,KAAA,GACmBO,EAAAA,EAAAA,cACnB,4BACAd,GACA,kBAAME,EAAOa,UAAUjB,EAAK,IAC7B,OAJW,OAANK,EAAME,EAAAW,KAAAX,EAAAY,OAAA,SAKL,CAAEf,OAAAA,EAAQC,OAAAA,IAAQ,wBAAAE,EAAAa,OAAA,GAAArB,EAAA,UAC1B,gBAAAsB,GAAA,OAAA1B,EAAAN,MAAA,KAAAN,UAAA,EApBa,IAoBb,CAAAU,IAAA,QAAAC,MAAA,eAAA4B,GAAA1B,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAED,SAAAyB,EAAYvB,GAAkB,IAAAwB,EAAA,YAAA3B,EAAAA,EAAAA,KAAAS,MAAA,SAAAmB,GAAA,cAAAA,EAAAjB,KAAAiB,EAAAhB,MAAA,OAM3B,OALIC,KAAKnB,SACRmB,KAAKnB,OAASmB,KAAKgB,SAAS1B,GAAM2B,OAAM,SAAAC,GAEtC,MADAJ,EAAKjC,YAASsC,EACRD,CACR,KACDH,EAAAN,OAAA,SACMT,KAAKnB,QAAM,wBAAAkC,EAAAL,OAAA,GAAAG,EAAA,UACnB,gBAAAO,GAAA,OAAAR,EAAAjC,MAAA,KAAAN,UAAA,EAVA,IAUA,CAAAU,IAAA,cAAAC,MAAA,eAAAqC,GAAAnC,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAED,SAAAkC,EAAyBhC,GAAkB,IAAAiC,EAAA5B,EAAA,OAAAR,EAAAA,EAAAA,KAAAS,MAAA,SAAA4B,GAAA,cAAAA,EAAA1B,KAAA0B,EAAAzB,MAAA,cAAAyB,EAAAzB,KAAA,EAChBC,KAAKyB,MAAMnC,GAAK,OAA3B,OAA2BiC,EAAAC,EAAAhB,KAAjCb,EAAM4B,EAAN5B,OAAM6B,EAAAf,OAAA,SACPiB,OAAOC,KAAKhC,EAAOiC,aAAW,wBAAAJ,EAAAd,OAAA,GAAAY,EAAA,UACtC,gBAAAO,GAAA,OAAAR,EAAA1C,MAAA,KAAAN,UAAA,EALA,IAKA,CAAAU,IAAA,cAAAC,MAAA,eAAA8C,GAAA5C,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAED,SAAA2C,EAAyBC,GAAa,IAAAC,EAAAC,EAAAvC,EAAA,OAAAR,EAAAA,EAAAA,KAAAS,MAAA,SAAAuC,GAAA,cAAAA,EAAArC,KAAAqC,EAAApC,MAAA,cAAAoC,EAAApC,KAAA,EACXC,KAAKyB,QAAO,OAAvB,OAAuBS,EAAAC,EAAA3B,KAA7Bb,EAAMuC,EAANvC,OAAMwC,EAAA1B,OAAA,SACmB,QADnBwB,EACPtC,EAAOyC,aAAaJ,UAAM,IAAAC,OAAA,EAA1BA,EAA4BI,MAAI,wBAAAF,EAAAzB,OAAA,GAAAqB,EAAA,UACxC,gBAAAO,GAAA,OAAAR,EAAAnD,MAAA,KAAAN,UAAA,EALA,IAKA,CAAAU,IAAA,iBAAAC,MAAA,eAAAuD,GAAArD,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAED,SAAAoD,EAA4BlD,GAAkB,IAAAmD,EAAA9C,EAAA,OAAAR,EAAAA,EAAAA,KAAAS,MAAA,SAAA8C,GAAA,cAAAA,EAAA5C,KAAA4C,EAAA3C,MAAA,cAAA2C,EAAA3C,KAAA,EACnBC,KAAKyB,MAAMnC,GAAK,OAA3B,OAA2BmD,EAAAC,EAAAlC,KAAjCb,EAAM8C,EAAN9C,OAAM+C,EAAAjC,OAAA,UACPkC,EAAAA,EAAAA,IAAahD,EAAOiD,eAA6C,wBAAAF,EAAAhC,OAAA,GAAA8B,EAAA,UACzE,gBAAAK,GAAA,OAAAN,EAAA5D,MAAA,KAAAN,UAAA,EALA,IAKA,CAAAU,IAAA,cAAAC,MAED,SAAmB8D,GAA2C,IAADC,EAAA,KAA1BzD,EAAmBjB,UAAAC,OAAA,QAAA6C,IAAA9C,UAAA,GAAAA,UAAA,GAAG,CAAC,EAChD2E,EAAwBF,EAAxBE,QAASC,EAAeH,EAAfG,MAAOC,EAAQJ,EAARI,IACxBC,EAKI7D,EAJF8D,QAAAA,OAAO,IAAAD,EAAG,EAACA,EACXE,EAGE/D,EAHF+D,OAAMC,EAGJhE,EAFFiE,WAAAA,OAAU,IAAAD,EAAG,EAACA,EAAAE,EAEZlE,EADFE,eAAAA,OAAc,IAAAgE,EAAG,WAAO,EAACA,EAE3B,OAAOC,EAAAA,EAAAA,kBAAgB,eAAAC,GAAAxE,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MAAU,SAAAuE,EAAMC,GAAQ,IAAAC,EAAAC,EAAApE,EAAAqE,EAAAC,EAAAC,EAAAC,EAAA,OAAA/E,EAAAA,EAAAA,KAAAS,MAAA,SAAAuE,GAAA,cAAAA,EAAArE,KAAAqE,EAAApE,MAAA,OAER,OADrCP,EAAe,2BACTqE,EAASd,EAAK1C,QAAQ,UAAS8D,EAAApE,KAAA,EACZgD,EAAKtB,MAAMnC,GAAK,OAA3B,OAA2BwE,EAAAK,EAAA3D,KAAjCd,EAAMoE,EAANpE,OAAMyE,EAAApE,KAAA,EACML,EAAO0E,YAAYpB,EAASC,EAAOC,GAAGmB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACrD/E,GAAI,IACPgF,aAAclB,EAAUG,KACxB,OAHIQ,EAAKI,EAAA3D,KAAAwD,GAAAO,EAAAA,EAAAA,GAKQR,GAAKI,EAAArE,KAAA,GAAAoE,GAAA/E,EAAAA,EAAAA,KAAAC,MAAA,SAAA8E,IAAA,IAAAM,EAAAC,EAAA,OAAAtF,EAAAA,EAAAA,KAAAS,MAAA,SAAA8E,GAAA,cAAAA,EAAA5E,KAAA4E,EAAA3E,MAAA,OAAbyE,EAAIP,EAAAjF,MACT6E,IAEFW,EAAKX,OAASA,GAEVY,EAAQ,GAAA7F,OAAMiF,EAAM,KAAAjF,OAAIkE,EAAOE,QAAO,KAAApE,OAAI4F,EAAKvB,MAAK,KAAArE,OAAI4F,EAAKtB,KAEnEsB,EAAKxB,QAAUA,EACfwB,EAAKC,SAAWA,EAChBb,EAAS7D,KAAK,CAEZ4E,IAAK,SAACC,GAAW,OAAMJ,EAAiCI,EAAI,EAC5DC,GAAI,kBAAMJ,CAAQ,EAElBK,OAAQ,kBAAMN,CAAI,IAClB,wBAAAE,EAAAhE,OAAA,GAAAwD,EAAA,IAAAF,EAAAe,IAAA,YAAAd,EAAAD,EAAAgB,KAAAC,KAAA,CAAAd,EAAApE,KAAA,gBAAAoE,EAAAe,cAAAhB,IAAA,iBAAAC,EAAApE,KAAA,iBAAAoE,EAAApE,KAAA,iBAAAoE,EAAArE,KAAA,GAAAqE,EAAAgB,GAAAhB,EAAA,UAAAH,EAAA9C,EAAAiD,EAAAgB,IAAA,eAAAhB,EAAArE,KAAA,GAAAkE,EAAAoB,IAAAjB,EAAAkB,OAAA,YAEJzB,EAAS0B,WAAU,yBAAAnB,EAAAzD,OAAA,GAAAiD,EAAA,0BACpB,gBAAA4B,GAAA,OAAA7B,EAAA/E,MAAA,KAAAN,UAAA,EA3BsB,GA2BpBgF,EACL,GAEA,CAAAtE,IAAA,oCAAAC,MAAA,eAAAwG,GAAAtG,EAAAA,EAAAA,IAAAC,EAAAA,EAAAA,KAAAC,MACA,SAAAqG,EAAwCC,GAAkB,OAAAvG,EAAAA,EAAAA,KAAAS,MAAA,SAAA+F,GAAA,cAAAA,EAAA7F,KAAA6F,EAAA5F,MAAA,cAAA4F,EAAAlF,OAAA,SACjD,CAAEmF,eAAgB,IAAG,wBAAAD,EAAAjF,OAAA,GAAA+E,EAAA,KAC7B,gBAAAI,GAAA,OAAAL,EAAA7G,MAAA,KAAAN,UAAA,EAHD,IAGC,CAAAU,IAAA,gBAAAC,MAED,WAA8B,KAACnB,CAAA,CA5FC,CAASiI,EAAAA,wBAAtBjI,EAILkI,aAAe,CAC3B,gBACA,gBACA,iB","sources":["../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts"],"sourcesContent":["import { BigWig } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { updateStatus, Feature } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport {\n  rectifyStats,\n  UnrectifiedQuantitativeStats,\n} from '@jbrowse/core/util/stats'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nexport default class BigWigAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private setupP?: Promise<{ bigwig: BigWig; header: any }>\n\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  private async setupPre(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    const pm = this.pluginManager\n    const bigwig = new BigWig({\n      filehandle: openLocation(this.getConf('bigWigLocation'), pm),\n    })\n    const header = await updateStatus(\n      'Downloading bigwig header',\n      statusCallback,\n      () => bigwig.getHeader(opts),\n    )\n    return { bigwig, header }\n  }\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const { header } = await this.setup()\n    return header.refsByNumber[refId]?.name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedQuantitativeStats)\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    const { refName, start, end } = region\n    const {\n      bpPerPx = 0,\n      signal,\n      resolution = 1,\n      statusCallback = () => {},\n    } = opts\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const source = this.getConf('source')\n      const { bigwig } = await this.setup(opts)\n      const feats = await bigwig.getFeatures(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx / resolution,\n      })\n\n      for (const data of feats) {\n        if (source) {\n          // @ts-expect-error\n          data.source = source\n        }\n        const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`\n        // @ts-expect-error\n        data.refName = refName\n        data.uniqueId = uniqueId\n        observer.next({\n          // @ts-expect-error\n          get: (str: string) => (data as Record<string, unknown>)[str],\n          id: () => uniqueId,\n          // @ts-expect-error\n          toJSON: () => data,\n        })\n      }\n      observer.complete()\n    }, signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async getMultiRegionFeatureDensityStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["BigWigAdapter","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","setupP","_createClass","key","value","_setupPre","_asyncToGenerator","_regeneratorRuntime","mark","_callee","opts","_ref$statusCallback","statusCallback","pm","bigwig","header","wrap","_context","prev","next","this","pluginManager","BigWig","filehandle","openLocation","getConf","updateStatus","getHeader","sent","abrupt","stop","_x","_setup","_callee2","_this2","_context2","setupPre","catch","e","undefined","_x2","_getRefNames","_callee3","_yield$this$setup","_context3","setup","Object","keys","refsByName","_x3","_refIdToName","_callee4","refId","_header$refsByNumber$","_yield$this$setup2","_context4","refsByNumber","name","_x4","_getGlobalStats","_callee5","_yield$this$setup3","_context5","rectifyStats","totalSummary","_x5","region","_this3","refName","start","end","_opts$bpPerPx","bpPerPx","signal","_opts$resolution","resolution","_opts$statusCallback","ObservableCreate","_ref2","_callee6","observer","source","_yield$_this3$setup","feats","_iterator","_step","_loop","_context7","getFeatures","_objectSpread","basesPerSpan","_createForOfIteratorHelper","data","uniqueId","_context6","get","str","id","toJSON","s","n","done","delegateYield","t1","f","finish","complete","_x6","_getMultiRegionFeatureDensityStats","_callee7","_regions","_context8","featureDensity","_x7","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}