"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[3420,4493],{34493:function(e,n,t){t.r(n),t.d(n,{default:function(){return A}});var r=t(33028),o=t(96234),s=t(30969),i=t(2374),a=t(90550),c=t(9077),l=t(81073),d=t(53557),u=t(74262),m=t(21777),f=t(70054),h=t(86317),p=t(37574),v=(0,i.ZL)()((function(e){var n=e.palette,t=n.tertiary,r=n.primary;return{rubberBand:{height:"100%",background:t?(0,u.Fq)(t.main,.7):(0,u.Fq)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:t?t.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},sm:{fontSize:10}}})),x=(0,a.observer)((function(e){var n=e.model,t=e.coordX,r=v().classes;return(0,p.jsx)(m.Z,{open:!0,placement:"top",title:n.views.map((function(e){return e.pxToBp(t)})).map((function(e){return(0,p.jsx)(f.Z,{className:r.sm,children:(0,l.stringify)(e)},JSON.stringify(e))})),arrow:!0,children:(0,p.jsx)("div",{className:r.guide,style:{left:t,background:"red"}})})}));var g=(0,a.observer)((function(e){var n=e.model,t=e.ControlComponent,r=void 0===t?(0,p.jsx)("div",{}):t,i=(0,s.useState)(),a=(0,o.Z)(i,2),c=a[0],u=a[1],m=(0,s.useState)(),g=(0,o.Z)(m,2),j=g[0],b=g[1],y=(0,s.useState)(),Z=(0,o.Z)(y,2),w=Z[0],C=Z[1],N=(0,s.useState)(),S=(0,o.Z)(N,2),k=S[0],M=S[1],P=(0,s.useRef)(null),B=(0,s.useRef)(null),L=v().classes,A=void 0!==c&&void 0===w;function E(e){e.preventDefault(),e.stopPropagation();var n=e.clientX-e.target.getBoundingClientRect().left;u(n),b(n)}function T(e){var n=e.target;M(e.clientX-n.getBoundingClientRect().left)}function F(){M(void 0),n.views.forEach((function(e){return e.setOffsets(void 0,void 0)}))}function O(){C(void 0),u(void 0),b(void 0)}(0,s.useEffect)((function(){function e(e){if(P.current&&A){var n=e.clientX-P.current.getBoundingClientRect().left;b(n)}}function t(e){if(void 0!==c&&P.current){var t=e.clientX,r=e.clientY,o=t-P.current.getBoundingClientRect().left;C({offsetX:o,clientX:t,clientY:r}),n.views.forEach((function(e){var n=function(e,n){if(void 0!==c){var t=c,r=e;if(r<t){var o=[r,t];t=o[0],r=o[1]}return{leftOffset:n.pxToBp(t),rightOffset:n.pxToBp(r)}}}(o,e);if(n){var t=n.leftOffset,r=n.rightOffset;e.setOffsets(t,r)}})),M(void 0)}}return A?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[c,A,w,n]),(0,s.useEffect)((function(){!A&&void 0!==j&&void 0!==c&&Math.abs(j-c)<=3&&O()}),[A,j,c]);var R=Boolean(w);if(void 0===c)return(0,p.jsxs)(p.Fragment,{children:[void 0!==k?(0,p.jsx)(x,{model:n,coordX:k}):null,(0,p.jsx)("div",{"data-testid":"rubberBand_controls",className:L.rubberBandControl,role:"presentation",ref:P,onMouseDown:E,onMouseOut:F,onMouseMove:T,children:r})]});var z=w?w.offsetX:j||0,I=z<c?z:c,X=Math.abs(z-c),_=n.views,H=_.map((function(e){return e.pxToBp(I)})),q=_.map((function(e){return e.pxToBp(I+X)})),V=_.map((function(e){return Math.ceil(X*e.bpPerPx)}));return(0,p.jsxs)(p.Fragment,{children:[B.current?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.ZP,{className:L.popover,classes:{paper:L.paper},open:!0,anchorEl:B.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:H.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))}),(0,p.jsx)(h.ZP,{className:L.popover,classes:{paper:L.paper},open:!0,anchorEl:B.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:q.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))})]}):null,(0,p.jsx)("div",{ref:B,className:L.rubberBand,style:{left:I,width:X},children:(0,p.jsx)(f.Z,{variant:"h6",className:L.rubberBandText,children:V.map((function(e,n){return(0,p.jsx)(f.Z,{children:"".concat(e.toLocaleString("en-US"),"bp")},"".concat(e,"_").concat(n))}))})}),(0,p.jsx)("div",{"data-testid":"rubberBand_controls",className:L.rubberBandControl,role:"presentation",ref:P,onMouseDown:E,onMouseOut:F,onMouseMove:T,children:r}),w?(0,p.jsx)(d.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:w.clientX,top:w.clientY},onMenuItemClick:function(e,n){n(),O()},open:R,onClose:O,menuItems:n.rubberBandMenuItems()}):null]})})),j=t(66581),b=t(47217),y=t(1437),Z=t(45358),w=t(76867),C=(0,i.ZL)()((function(){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},bp:{display:"flex",alignItems:"center",marginLeft:10},searchContainer:{marginLeft:5},searchBox:{display:"flex"}}})),N=(0,a.observer)((function(e){var n=e.model;return(0,p.jsx)(j.Z,{onClick:n.toggleLinkViews,title:"Toggle linked scrolls and behavior across views",children:n.linkViews?(0,p.jsx)(Z.Z,{color:"secondary"}):(0,p.jsx)(y.Z,{color:"secondary"})})})),S=(0,a.observer)((function(e){var n=e.model;return(0,p.jsx)(j.Z,{onClick:n.squareView,title:"Square view (make both the same zoom level)",children:(0,p.jsx)(w.Z,{color:"secondary"})})})),k=(0,a.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=C().classes,o=n.views.some((function(e){return!e.hideHeader}));return(0,p.jsxs)("div",{className:r.headerBar,children:[(0,p.jsx)(N,{model:n}),(0,p.jsx)(S,{model:n}),t,o?null:n.views.map((function(e){return(0,p.jsxs)("div",{className:r.searchBox,children:[(0,p.jsx)("div",{className:r.searchContainer,children:(0,p.jsx)(b.Rj,{model:e,showHelp:!1})}),(0,p.jsx)("div",{className:r.bp,children:(0,p.jsxs)(f.Z,{variant:"body2",color:"textSecondary",className:r.bp,children:[Math.round(e.coarseTotalBp).toLocaleString("en-US")," bp"]})})]},e.id)})),(0,p.jsx)("div",{className:r.spacer})]})})),M=(0,i.ZL)()((function(){return{container:{display:"grid"},overlay:{zIndex:100,gridArea:"1/1"},content:{gridArea:"1/1",position:"relative"},grid:{display:"grid"},relative:{position:"relative"},rubberbandContainer:{position:"relative",overflow:"hidden"}}})),P=(0,a.observer)((function(e){var n=e.model,t=M().classes;return(0,p.jsx)(p.Fragment,{children:n.tracks.map((function(e){var r=(0,o.Z)(e.displays,1)[0],s=r.RenderingComponent,i=(0,c.getConf)(e,"trackId");return s?(0,p.jsx)("div",{className:t.overlay,style:{height:n.middleComparativeHeight,overflow:"hidden"},children:(0,p.jsx)(s,{model:r})},i):null}))})})),B=(0,a.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=M().classes,o=n.views,s=(0,l.getEnv)(n).pluginManager.getViewType(o[0].type).ReactComponent;return(0,p.jsxs)("div",{className:r.rubberbandContainer,children:[(0,p.jsx)(k,{ExtraButtons:t,model:n}),(0,p.jsx)(g,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",height:15}})}),(0,p.jsxs)("div",{className:r.container,children:[(0,p.jsx)(s,{model:o[0]}),(0,p.jsx)("div",{className:r.grid,children:(0,p.jsx)(P,{model:n})}),(0,p.jsx)(d.ResizeHandle,{onDrag:function(e){return n.setMiddleComparativeHeight(n.middleComparativeHeight+e)},style:{height:4,background:"#ccc"}}),(0,p.jsx)(s,{model:o[1]})]})]})})),L=(0,a.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=M().classes,o=n.views,s=(0,l.getEnv)(n).pluginManager;return(0,p.jsxs)("div",{className:r.rubberbandContainer,children:[(0,p.jsx)(k,{model:n,ExtraButtons:t}),(0,p.jsx)(g,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",height:15}})}),(0,p.jsx)("div",{className:r.container,children:(0,p.jsxs)("div",{className:r.content,children:[(0,p.jsx)("div",{className:r.relative,children:o.map((function(e){var n=s.getViewType(e.type).ReactComponent;return(0,p.jsx)(n,{model:e},e.id)}))}),(0,p.jsx)(P,{model:n})]})})]})})),A=(0,a.observer)((function(e){return e.model.tracks.some((function(e){return e.displays.some((function(e){return(0,c.getConf)(e,"middle")}))}))?(0,p.jsx)(B,(0,r.Z)({},e)):(0,p.jsx)(L,(0,r.Z)({},e))}))},83420:function(e,n,t){t.r(n),t.d(n,{default:function(){return A}});var r=t(30969),o=t(90550),s=t(66581),i=t(34493),a=t(6348),c=t(32723),l=t(68079),d=t(34795),u=t(96234),m=t(22523),f=t.n(m),h=t(90689),p=t(81073),v=t(59802),x=t(65629),g=t(58467),j=t(70054),b=t(72243),y=t(78742),Z=t(52849),w=t(69852),C=t(2374),N=t(53557),S=t(37574),k=(0,C.ZL)()((function(e){return{importFormContainer:{padding:e.spacing(4)},formPaper:{margin:"0 auto",padding:12,marginBottom:10}}}));function M(e){return e?e.uri||e.localPath||e.name:void 0}var P=(0,o.observer)((function(e){var n=e.model,t=k().classes,o=(0,p.getSession)(n),s=o.assemblyNames,i=o.assemblyManager,a=(0,r.useState)([s[0],s[0]]),m=(0,u.Z)(a,2),C=m[0],P=m[1],B=(0,r.useState)(),L=(0,u.Z)(B,2),A=L[0],E=L[1],T=(0,r.useState)(),F=(0,u.Z)(T,2),O=F[0],R=F[1],z=(0,r.useState)(),I=(0,u.Z)(z,2),X=I[0],_=I[1],H=(0,r.useState)(2),q=(0,u.Z)(H,1)[0],V=(0,r.useState)(),D=(0,u.Z)(V,2),J=D[0],U=D[1],W=(0,r.useState)(""),Y=(0,u.Z)(W,2),G=Y[0],K=Y[1],Q=M(A),$=G||(Q?f().extname(function(e){return e.endsWith(".gz")?e.slice(0,e.length-3):e}(Q)):""),ee=s.length?C.map((function(e){var n;return null===(n=i.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", "):"No configured assemblies";function ne(){if(".paf"===$)return{type:"PAFAdapter",pafLocation:A,assemblyNames:C};if(".out"===$)return{type:"MashMapAdapter",outLocation:A,assemblyNames:C};if(".delta"===$)return{type:"DeltaAdapter",deltaLocation:A,assemblyNames:C};if(".chain"===$)return{type:"ChainAdapter",chainLocation:A,assemblyNames:C};if(".anchors"===$)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:A,bed1Location:X,bed2Location:O,assemblyNames:C};if(".anchors.simple"===$)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:A,bed1Location:X,bed2Location:O,assemblyNames:C};throw new Error("Unknown type")}function te(){return te=(0,d.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,p.isSessionWithAddTracks)(o)){e.next=3;break}return e.abrupt("return");case 3:return e.t0=n,e.next=6,Promise.all(C.map(function(){var e=(0,d.Z)((0,c.Z)().mark((function e(n){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.waitForAssembly(n);case 2:if(t=e.sent){e.next=5;break}throw new Error("Assembly ".concat(n," failed to load"));case 5:return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:t.regions});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 6:e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),n.views.forEach((function(e){return e.setWidth(n.width)})),(0,h.transaction)((function(){if(A){var e=f().basename(M(A))||"MyTrack",t="".concat(e,"-").concat(Date.now());o.addTrackConf({trackId:t,name:e,assemblyNames:C,type:"SyntenyTrack",adapter:ne()}),n.toggleTrack(t)}})),e.next=16;break;case 12:e.prev=12,e.t2=e.catch(0),console.error(e.t2),U(e.t2);case 16:case"end":return e.stop()}}),e,null,[[0,12]])}))),te.apply(this,arguments)}var re=J||ee;return(0,S.jsxs)(v.Z,{className:t.importFormContainer,children:[re?(0,S.jsx)(N.ErrorMessage,{error:re}):null,(0,S.jsx)(x.Z,{className:t.formPaper,children:(0,S.jsx)(g.ZP,{container:!0,item:!0,justifyContent:"center",spacing:4,alignItems:"center",children:(0,S.jsxs)(g.ZP,{item:!0,children:[(0,S.jsx)(j.Z,{children:"Select assemblies for synteny view"}),(0,l.Z)(new Array(q)).map((function(e,n){return(0,S.jsx)(N.AssemblySelector,{selected:C[n],extra:n,onChange:function(e){var t=C.slice(0);t[n]=e,P(t)},session:o},"row_".concat(n,"_").concat(C[n]))}))]})})}),(0,S.jsxs)(x.Z,{className:t.formPaper,children:[(0,S.jsxs)(j.Z,{style:{textAlign:"center"},children:[(0,S.jsx)("b",{children:"Optional"}),": Add a .paf, .out (MashMap), .delta (Mummer), .chain, .anchors or .anchors.simple (MCScan) file to view in the synteny view. These file types can also be gzipped. The first assembly should be the query sequence (e.g. left column of the PAF) and the second assembly should be the target sequence (e.g. right column of the PAF)"]}),(0,S.jsx)(b.Z,{value:$,onChange:function(e){return K(e.target.value)},children:(0,S.jsxs)(g.ZP,{container:!0,justifyContent:"center",children:[(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".paf",control:(0,S.jsx)(Z.Z,{}),label:".paf"})}),(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".out",control:(0,S.jsx)(Z.Z,{}),label:".out"})}),(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".delta",control:(0,S.jsx)(Z.Z,{}),label:".delta"})}),(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".chain",control:(0,S.jsx)(Z.Z,{}),label:".chain"})}),(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".anchors",control:(0,S.jsx)(Z.Z,{}),label:".anchors"})}),(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(y.Z,{value:".anchors.simple",control:(0,S.jsx)(Z.Z,{}),label:".anchors.simple"})})]})}),(0,S.jsx)(g.ZP,{container:!0,justifyContent:"center",children:(0,S.jsx)(g.ZP,{item:!0,children:".anchors"===G||".anchors.simple"===G?(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{style:{margin:20},children:["Open the ",G,", and .bed files for both genome assemblies from the MCScan (Python verson) pipeline"," ",(0,S.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,S.jsxs)("div",{style:{display:"flex"},children:[(0,S.jsx)("div",{children:(0,S.jsx)(N.FileSelector,{name:".anchors file",description:"",location:A,setLocation:function(e){return E(e)}})}),(0,S.jsx)("div",{children:(0,S.jsx)(N.FileSelector,{name:"genome 1 .bed (left column of anchors file)",description:"",location:X,setLocation:function(e){return _(e)}})}),(0,S.jsx)("div",{children:(0,S.jsx)(N.FileSelector,{name:"genome 2 .bed (right column of anchors file)",description:"",location:O,setLocation:function(e){return R(e)}})})]})]}):(0,S.jsx)(N.FileSelector,{name:G?G+" location":"",description:"",location:A,setLocation:function(e){return E(e)}})})})]}),(0,S.jsx)(g.ZP,{container:!0,justifyContent:"center",children:(0,S.jsx)(g.ZP,{item:!0,children:(0,S.jsx)(w.Z,{disabled:!!ee,onClick:function(){return te.apply(this,arguments)},variant:"contained",color:"primary",children:"Open"})})})]})})),B=P,L=(0,o.observer)((function(e){var n=e.model;return(0,S.jsx)(s.Z,{onClick:function(){n.toggleCurves()},title:"Toggle drawing straight or curved synteny lines",children:n.drawCurves?(0,S.jsx)(a.Z,{color:"secondary"}):(0,S.jsx)(a.f,{color:"secondary"})})})),A=(0,o.observer)((function(e){var n=e.model;return n.initialized?(0,S.jsx)(i.default,{model:n,ExtraButtons:(0,S.jsx)(L,{model:n})}):(0,S.jsx)(B,{model:n})}))}}]);
//# sourceMappingURL=3420.2872f840.chunk.js.map