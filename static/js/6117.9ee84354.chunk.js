"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6117],{53591:function(e,r,n){n.r(r);var t=n(32723),s=n(34795),a=n(96234),o=n(41867),c=n(3762),i=n(31625),u=n(47409),l=n(77327),p=n(75258),h=n(51590),d=n(49133),f=n(27768),x=n(23801),w=n(47192),k=n(62877),m=n.n(k),b=n(90872),Z=n(35421),v=n(24728),y=n(97990),g=n(80838),j=(0,w.ZL)()((function(){return{flexItem:{margin:5}}})),S=(0,c.observer)((function(e){var r=e.onClose,n=e.model,c=j().classes,w=(0,o.useState)(""),k=(0,a.Z)(w,2),S=k[0],C=k[1],U=(0,o.useState)(),R=(0,a.Z)(U,2),L=R[0],I=R[1],E=(0,o.useState)(!0),O=(0,a.Z)(E,2),P=O[0],B=O[1],N=(0,b.getSession)(n),_=n.selectedBookmarks,A=0===_.length,D=0===_.length?n.allBookmarksModel:n.sharedBookmarksModel;return(0,o.useEffect)((function(){var e=!1;return(0,s.Z)((0,t.Z)().mark((function r(){var n,s,a,o;return(0,t.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,(0,b.isSessionWithShareURL)(N)){r.next=3;break}throw new Error("No shareURL configured");case 3:return B(!0),n=(0,i.getSnapshot)(D),s=new URL(window.location.href),r.next=8,(0,y.p)(n,N.shareURL,s.href);case 8:a=r.sent,e||((o=new URLSearchParams(s.search)).set("bookmarks","share-".concat(a.json.sessionId)),o.set("password",a.password),s.search=o.toString(),C(s.href),B(!1)),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(0),I(r.t0);case 15:return r.prev=15,B(!1),r.finish(15);case 18:case"end":return r.stop()}}),r,null,[[0,12,15,18]])})))(),function(){e=!0}}),[D,N]),(0,g.jsxs)(Z.Dialog,{open:!0,onClose:r,title:"Share bookmarks",children:[(0,g.jsxs)(u.Z,{style:{display:"flex",flexFlow:"column",gap:"5px"},children:[(0,g.jsx)(l.Z,{severity:"info",children:A?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("span",{children:"All bookmarks will be shared."}),(0,g.jsx)("br",{}),(0,g.jsx)("span",{children:"Use the checkboxes to select individual bookmarks to share."})]}):"Only selected bookmarks will be shared."}),(0,g.jsx)(p.Z,{children:"Copy the URL below to share your bookmarks."}),L?(0,g.jsx)(Z.ErrorMessage,{error:L}):P?(0,g.jsx)(h.Z,{children:"Generating short URL..."}):(0,g.jsx)(d.Z,{label:"URL",value:S,InputProps:{readOnly:!0},variant:"filled",fullWidth:!0,onClick:function(e){e.target.select()}}),(0,g.jsx)(p.Z,{children:'The URL should be pasted into the "Import from share link" field in the "Import" form found in the "Bookmarked regions" drawer.'})]}),(0,g.jsx)(f.Z,{children:(0,g.jsx)(x.Z,{className:c.flexItem,"data-testid":"dialogShare",variant:"contained",color:"primary",disabled:P,startIcon:(0,g.jsx)(v.pt,{}),onClick:(0,s.Z)((0,t.Z)().mark((function e(){return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m()(S),N.notify("Copied to clipboard","success"),r();case 3:case"end":return e.stop()}}),e)}))),children:"Copy share link"})})]})}));r.default=S},97990:function(e,r,n){n.d(r,{h:function(){return h},p:function(){return l}});var t=n(32723),s=n(34795),a=n(68079),o=n(42408);var c=function(){var e=(0,s.Z)((0,t.Z)().mark((function e(r,s){var a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(9466),n.e(5607)]).then(n.t.bind(n,45607,23));case 2:return a=e.sent,e.abrupt("return",a.encrypt(r,s).toString());case 4:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}(),i=function(){var e=(0,s.Z)((0,t.Z)().mark((function e(r,s){var a,o,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(9466),n.e(5607)]).then(n.t.bind(n,45607,23));case 2:return a=e.sent,e.next=5,n.e(7380).then(n.t.bind(n,87380,23));case 5:return o=e.sent,c=a.decrypt(r,s),e.abrupt("return",c.toString(o));case 8:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}();function u(e){try{return JSON.parse(e).message}catch(r){return e}}function l(e,r,n){return p.apply(this,arguments)}function p(){return(p=(0,s.Z)((0,t.Z)().mark((function e(r,n,s){var i,l,p,h,d,f,x;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.JY)(JSON.stringify(r));case 2:return i=e.sent,t=5,l=window.btoa((0,a.Z)(window.crypto.getRandomValues(new Uint8Array(2*t))).map((function(e){return String.fromCharCode(e)})).join("")).replaceAll(/[+/]/g,"").slice(0,t),e.next=6,c(i,l);case 6:return p=e.sent,(h=new FormData).append("session",p),h.append("dateShared","".concat(Date.now())),h.append("referer",s),e.next=13,fetch("".concat(n,"share"),{method:"POST",mode:"cors",body:h});case 13:if((d=e.sent).ok){e.next=19;break}return e.next=17,d.text();case 17:throw f=e.sent,new Error(u(f));case 19:return e.next=21,d.json();case 21:return x=e.sent,e.abrupt("return",{json:x,encryptedSession:p,password:l});case 23:case"end":return e.stop()}var t}),e)})))).apply(this,arguments)}function h(e,r,n,t){return d.apply(this,arguments)}function d(){return(d=(0,s.Z)((0,t.Z)().mark((function e(r,n,s,a){var o,c,l,p,h;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.split("share-")[1],c="".concat(r,"?sessionId=").concat(encodeURIComponent(o)),e.next=4,fetch(c,{signal:a});case 4:if((l=e.sent).ok){e.next=10;break}return e.next=8,l.text();case 8:throw p=e.sent,new Error(u(p));case 10:return e.next=12,l.json();case 12:return h=e.sent,e.abrupt("return",i(h.session,s));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=6117.9ee84354.chunk.js.map