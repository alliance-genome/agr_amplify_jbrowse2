"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[8982],{78982:function(e,t,r){r.d(t,{Q:function(){return D},B:function(){return I}});var n=r(32723),a=r(34795),i=r(9249),s=r(87371),u=r(45754),c=r(86906),o=r(33028),f=r(56666),l=r(76254),h=r(89410),p=r.n(h),d=r(26700),m=r(49882).Buffer;function g(e){return m.from((0,d.inflate)(e))}var v=r(43245),b=r.n(v),k=function(){function e(t,r){(0,i.Z)(this,e),this.ranges=2===arguments.length?[{min:t,max:r}]:0 in t?Object.assign({},t):[t]}return(0,s.Z)(e,[{key:"min",value:function(){return this.ranges[0].min}},{key:"max",value:function(){return this.ranges[this.ranges.length-1].max}},{key:"contains",value:function(e){for(var t=0;t<this.ranges.length;t+=1){var r=this.ranges[t];if(r.min<=e&&r.max>=e)return!0}return!1}},{key:"isContiguous",value:function(){return this.ranges.length>1}},{key:"getRanges",value:function(){return this.ranges.map((function(t){return new e(t.min,t.max)}))}},{key:"toString",value:function(){return this.ranges.map((function(e){return"[".concat(e.min,"-").concat(e.max,"]")})).join(",")}},{key:"union",value:function(t){for(var r=this.getRanges().concat(t.getRanges()).sort(this.rangeOrder),n=[],a=r[0],i=1;i<r.length;i+=1){var s=r[i];s.min()>a.max()+1?(n.push(a),a=s):s.max()>a.max()&&(a=new e(a.min(),s.max()))}return n.push(a),1===n.length?n[0]:new e(n)}},{key:"intersection",value:function(t){for(var r=this,n=t,a=this.ranges(),i=n.ranges(),s=a.length,u=i.length,c=0,o=0,f=[];c<s&&o<u;){r=a[c],n=i[o];var l=Math.max(r.min(),n.min()),h=Math.min(r.max(),n.max());h>=l&&f.push(new e(l,h)),r.max()>n.max()?o+=1:c+=1}if(0===f.length)throw new Error("found range of length 0");return 1===f.length?f[0]:new e(f)}},{key:"coverage",value:function(){for(var e=0,t=this.ranges(),r=0;r<t.length;r+=1){var n=t[r];e+=n.max()-n.min()+1}return e}},{key:"rangeOrder",value:function(e,t){var r=e,n=t;return arguments.length<2&&(n=r,r=this),r.min()<n.min()?-1:r.min()>n.min()?1:r.max()<n.max()?-1:n.max()>r.max()?1:0}}]),e}(),w=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).code="ERR_ABORTED",n}return(0,s.Z)(r)}((0,r(25991).Z)(Error));function y(e){e.sort((function(e,t){return(0|e.offset)-(0|t.offset)}));for(var t,r,n=[],a=0;a<e.length;a+=1)t&&e[a].offset-r<=2e3?(t.length+=e[a].length-r+e[a].offset,t.blocks.push(e[a])):n.push(t={blocks:[e[a]],length:e[a].length,offset:e[a].offset}),r=t.offset+t.length;return n}function x(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var t=new w("aborted");throw t.code="ERR_ABORTED",t}}var Z=r(49882).Buffer;var S=function(){function e(t,r,s,u,c,o,h){var d=this;if((0,i.Z)(this,e),this.featureCache=new(p())({cache:new(b())({maxSize:1e3}),fill:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var a,i,s,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.length,i=t.offset,e.next=3,d.bbi.read(Z.alloc(a),0,a,i,{signal:r});case 3:return s=e.sent,u=s.buffer,e.abrupt("return",u);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),!(s>=0))throw new Error("invalid cirTreeOffset!");if(!(u>0))throw new Error("invalid cirTreeLength!");this.cirTreeOffset=s,this.cirTreeLength=u,this.isCompressed=o,this.refsByName=r,this.isBigEndian=c,this.bbi=t,this.blockType=h,Object.assign(this,function(e){var t,r=e?"big":"little",n=(new l._).endianess(r).uint32("chromId").uint32("start").uint32("end").uint32("validCnt").float("minScore").float("maxScore").float("sumData").float("sumSqData"),a=(new l._).endianess(r).uint8("isLeaf").skip(1).uint16("cnt").choice({tag:"isLeaf",choices:{1:(new l._).array("blocksToFetch",{length:"cnt",type:(new l._).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").uint64("blockSize")}),0:(new l._).array("recurOffsets",{length:"cnt",type:(new l._).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset")})}}),i=(new l._).endianess(r).uint32("chromId").int32("start").int32("end").string("rest",{zeroTerminated:!0});return{bigWigParser:(new l._).endianess(r).skip(4).int32("blockStart").skip(4).uint32("itemStep").uint32("itemSpan").uint8("blockType").skip(1).uint16("itemCount").choice({tag:"blockType",choices:(t={},(0,f.Z)(t,3,(new l._).array("items",{length:"itemCount",type:(new l._).float("score")})),(0,f.Z)(t,2,(new l._).array("items",{length:"itemCount",type:(new l._).int32("start").float("score")})),(0,f.Z)(t,1,(new l._).array("items",{length:"itemCount",type:(new l._).int32("start").int32("end").float("score")})),t)}),bigBedParser:i,summaryParser:n,leafParser:a}}(c))}return(0,s.Z)(e,[{key:"readWigData",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,i,s,u){var c,f,l,h,p,d,m,g,v,b,w,y,x,S,B,_,O=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=this.refsByName,f=this.bbi,l=this.cirTreeOffset,h=this.isBigEndian,p=u.signal,void 0===(d=c[t])&&s.complete(),m={chrId:d,start:r,end:i},this.cirTreePromise||(this.cirTreePromise=f.read(Z.alloc(48),0,48,l,{signal:p})),e.next=9,this.cirTreePromise;case 9:return g=e.sent,v=g.buffer,b=h?v.readUInt32BE(4):v.readUInt32LE(4),w=[],y=0,x=function(e,t,r){try{var n=e.slice(t),a=O.leafParser.parse(n).result;if(a.blocksToFetch&&(w=w.concat(a.blocksToFetch.filter(S).map((function(e){return{offset:e.blockOffset,length:e.blockSize}})))),a.recurOffsets){var i=a.recurOffsets.filter(S).map((function(e){return e.blockOffset}));i.length>0&&_(i,r+1)}}catch(u){s.error(u)}},S=function(e){var t=e.startChrom,n=e.startBase,a=e.endChrom,s=e.endBase;return(t<d||t===d&&n<=i)&&(a>d||a===d&&s>=r)},B=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){var i,c,f,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i=r.max()-r.min(),c=r.min(),e.next=5,O.featureCache.get("".concat(i,"_").concat(c),{length:i,offset:c},p);case 5:for(f=e.sent,l=0;l<t.length;l+=1)r.contains(t[l])&&(x(f,t[l]-c,a),0===(y-=1)&&O.readFeatures(s,w,(0,o.Z)((0,o.Z)({},u),{},{request:m})));e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),s.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(e,t){try{y+=e.length;for(var r=4+32*b,n=new k(e[0],e[0]+r),a=1;a<e.length;a+=1){var i=new k(e[a],e[a]+r);n=n.union(i)}n.getRanges().map((function(r){return B(e,r,t)}))}catch(u){s.error(u)}},e.abrupt("return",_([l+48],1));case 21:e.prev=21,e.t0=e.catch(0),s.error(e.t0);case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"parseSummaryBlock",value:function(t,r,n){for(var a=[],i=r;i<t.byteLength;){var s=this.summaryParser.parse(t.slice(i));a.push(s.result),i+=s.offset}var u=a;n&&(u=u.filter((function(e){return e.chromId===n.chrId})));var c=u.map((function(e){return{start:e.start,end:e.end,maxScore:e.maxScore,minScore:e.minScore,score:e.sumData/(e.validCnt||1),summary:!0}}));return n?c.filter((function(t){return e.coordFilter(t,n)})):c}},{key:"parseBigBedBlock",value:function(t,r,n,a){for(var i=[],s=r;s<t.byteLength;){var u=this.bigBedParser.parse(t.slice(s));u.result.uniqueId="bb-".concat(n+s),i.push(u.result),s+=u.offset}return a?i.filter((function(t){return e.coordFilter(t,a)})):i}},{key:"parseBigWigBlock",value:function(t,r,n){var a=t.slice(r),i=this.bigWigParser.parse(a).result,s=i.items,u=i.itemSpan,c=i.itemStep,o=i.blockStart,f=i.blockType;if(3===f)for(var l=0;l<s.length;l++)s[l].start=o+l*c,s[l].end=o+l*c+u;else if(2===f)for(var h=0;h<s.length;h++)s[h].end=s[h].start+u;return n?s.filter((function(t){return e.coordFilter(t,n)})):s}},{key:"readFeatures",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,s,u,c,o,f,l=this,h=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.length>2&&void 0!==h[2]?h[2]:{},e.prev=1,s=this.blockType,u=this.isCompressed,c=i.signal,o=i.request,f=y(r),x(c),e.next=8,Promise.all(f.map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(r){var a,i,f;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x(c),a=r.length,i=r.offset,e.next=4,l.featureCache.get("".concat(a,"_").concat(i),r,c);case 4:f=e.sent,r.blocks.forEach((function(e){x(c);var n=e.offset-r.offset,a=f;switch(u&&(a=g(f.slice(n)),n=0),x(c),s){case"summary":t.next(l.parseSummaryBlock(a,n,o));break;case"bigwig":t.next(l.parseBigWigBlock(a,n,o));break;case"bigbed":t.next(l.parseBigBedBlock(a,n,256*e.offset,o));break;default:console.warn("Don't know what to do with ".concat(s))}}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:t.complete(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"coordFilter",value:function(e,t){return e.start<t.end&&e.end>=t.start}}]),e}(),B=r(2877),_=r(45996),O=r(6694),z=r(49882).Buffer,C=-2003829722,E=-2021002517;function T(e){var t=e?"big":"little",r=(new l._).endianess(t).int32("magic").uint16("version").uint16("numZoomLevels").uint64("chromTreeOffset").uint64("unzoomedDataOffset").uint64("unzoomedIndexOffset").uint16("fieldCount").uint16("definedFieldCount").uint64("asOffset").uint64("totalSummaryOffset").uint32("uncompressBufSize").uint64("extHeaderOffset").array("zoomLevels",{length:"numZoomLevels",type:(new l._).uint32("reductionLevel").uint32("reserved").uint64("dataOffset").uint64("indexOffset")}),n=(new l._).endianess(t).uint64("basesCovered").double("scoreMin").double("scoreMax").double("scoreSum").double("scoreSumSquares");return{chromTreeParser:(new l._).endianess(t).uint32("magic").uint32("blockSize").uint32("keySize").uint32("valSize").uint64("itemCount"),totalSummaryParser:n,headerParser:r,isLeafNode:(new l._).endianess(t).uint8("isLeafNode").skip(1).uint16("cnt")}}var P=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,e),this.headerCache=new(p())({cache:new(b())({maxSize:1}),fill:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(r,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getHeader((0,o.Z)((0,o.Z)({},r),{},{signal:a})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()});var s=r.filehandle,u=r.renameRefSeqs,c=r.path,f=r.url;if(this.renameRefSeqs=u||function(e){return e},s)this.bbi=s;else if(f)this.bbi=new B.kC(f);else{if(!c)throw new Error("no file given");this.bbi=new B.S9(c)}}return(0,s.Z)(e,[{key:"getHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="aborted"in e?{signal:e}:e;return this.headerCache.get(JSON.stringify(t),t,t.signal)}},{key:"_getHeader",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMainHeader(t);case 2:return r=e.sent,e.next=5,this._readChromTree(r,t);case 5:return a=e.sent,e.abrupt("return",(0,o.Z)((0,o.Z)({},r),a));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getMainHeader",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,s,u,c,f,l=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:2e3,e.next=3,this.bbi.read(z.alloc(r),0,r,0,t);case 3:if(a=e.sent,i=a.buffer,s=this._isBigEndian(i),u=T(s),(c=u.headerParser.parse(i).result).fileType=c.magic===E?"bigbed":"bigwig",!(c.asOffset>r||c.totalSummaryOffset>r)){e.next=11;break}return e.abrupt("return",this._getMainHeader(t,2*r));case 11:if(c.asOffset&&(c.autoSql=i.slice(c.asOffset,i.indexOf(0,c.asOffset)).toString("utf8")),!(c.totalSummaryOffset>r)){e.next=14;break}return e.abrupt("return",this._getMainHeader(t,2*r));case 14:return c.totalSummaryOffset&&(f=i.slice(c.totalSummaryOffset),c.totalSummary=u.totalSummaryParser.parse(f).result),e.abrupt("return",(0,o.Z)((0,o.Z)({},c),{},{isBigEndian:s}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isBigEndian",value:function(e){var t=e.readInt32LE(0);if(t===C||t===E)return!1;if((t=e.readInt32BE(0))===C||t===E)return!0;throw new Error("not a BigWig/BigBed file")}},{key:"_readChromTree",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,s,u,c,o,f,h,p,d,m,g,v,b,k=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.isBigEndian,s=i?"big":"little",u=[],c={},o=t.chromTreeOffset,f=t.unzoomedDataOffset;f%4!==0;)f+=1;return e.next=9,this.bbi.read(z.alloc(f-o),0,f-o,o,r);case 9:return h=e.sent,p=h.buffer,d=T(i),m=d.chromTreeParser.parse(p).result.keySize,g=(new l._).endianess(s).string("key",{stripNull:!0,length:m}).uint32("refId").uint32("refSize"),v=(new l._).endianess(s).skip(m).uint64("childOffset"),32,b=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,s,f,l,h,m,w,y,x,Z,S,B,_,O;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=t)>=p.length)){e.next=3;break}throw new Error("reading beyond end of buffer");case 3:if(a=d.isLeafNode.parse(p.slice(r)),i=a.result,s=i.isLeafNode,f=i.cnt,r+=a.offset,!s){e.next=10;break}for(l=0;l<f;l+=1)h=g.parse(p.slice(r)),r+=h.offset,m=h.result,w=m.key,y=m.refId,x=m.refSize,Z={name:w,id:y,length:x},c[k.renameRefSeqs(w)]=y,u[y]=Z;e.next=14;break;case 10:for(S=[],B=0;B<f;B+=1)_=v.parse(p.slice(r)),O=_.result.childOffset,r+=_.offset,O-=o,S.push(b(O));return e.next=14,Promise.all(S);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=19,b(32);case 19:return e.abrupt("return",{refsByName:c,refsByNumber:u});case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getUnzoomedView",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,s,u,c,o,f,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(t);case 2:return r=e.sent,a=r.unzoomedIndexOffset,i=r.zoomLevels,s=r.refsByName,u=r.uncompressBufSize,c=r.isBigEndian,o=r.fileType,f=i[0],l=f?f.dataOffset-a:4e3,e.abrupt("return",new S(this.bbi,s,a,l,c,u>0,o));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatureStream",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){var i,s,u,c=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{scale:1},e.next=3,this.getHeader(i);case 3:if(s=this.renameRefSeqs(t),!i.basesPerSpan){e.next=10;break}return e.next=7,this.getView(1/i.basesPerSpan,i);case 7:u=e.sent,e.next=19;break;case 10:if(!i.scale){e.next=16;break}return e.next=13,this.getView(i.scale,i);case 13:u=e.sent,e.next=19;break;case 16:return e.next=18,this.getView(1,i);case 18:u=e.sent;case 19:if(u){e.next=21;break}throw new Error("unable to get block view for data");case 21:return e.abrupt("return",new _.y((function(e){u.readWigData(s,r,a,e,i)})));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){var i,s,u,c=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.length>3&&void 0!==c[3]?c[3]:{scale:1},e.next=3,this.getFeatureStream(t,r,a,i);case 3:return s=e.sent,e.next=6,s.pipe((0,O.u)((function(e,t){return e.concat(t)}))).toPromise();case 6:return u=e.sent,e.abrupt("return",u||[]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}(),I=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"getView",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var a,i,s,u,c,o,f,l,h,p,d;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(r);case 2:a=e.sent,i=a.zoomLevels,s=a.refsByName,u=a.fileSize,c=a.isBigEndian,o=a.uncompressBufSize,f=1/t,l=i.length,u||(l-=1),h=l;case 12:if(!(h>=0)){e.next=20;break}if(!((p=i[h])&&p.reductionLevel<=2*f)){e.next=17;break}return d=h<i.length-1?i[h+1].dataOffset-p.indexOffset:u-4-p.indexOffset,e.abrupt("return",new S(this.bbi,s,p.indexOffset,d,c,o>0,"summary"));case 17:h-=1,e.next=12;break;case 20:return e.abrupt("return",this.getUnzoomedView(r));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(P),L=r(68079),N=r(23288),F=r(84040),H=r(49882).Buffer;function R(e){return e.filter((function(e){return!!e}))}var D=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var s;return(0,i.Z)(this,r),(s=t.call(this,e)).readIndicesCache=new(p())({cache:new(b())({maxSize:1}),fill:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s._readIndices((0,o.Z)((0,o.Z)({},t),{},{signal:r})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),s}return(0,s.Z)(r,[{key:"readIndices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="aborted"in e?{signal:e}:e;return this.readIndicesCache.get(JSON.stringify(t),t,t.signal)}},{key:"getView",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getUnzoomedView(r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_readIndices",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,s,u,c,o,f,h,p,d,m,g,v,b,k;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(t);case 2:return r=e.sent,a=r.extHeaderOffset,i=r.isBigEndian,e.next=7,this.bbi.read(H.alloc(64),0,64,a);case 7:if(s=e.sent,u=s.buffer,c=i?"big":"little",o=(new l._).endianess(c).uint16("size").uint16("count").uint64("offset").parse(u).result,f=o.count,h=o.offset,0!==f){e.next=14;break}return e.abrupt("return",[]);case 14:return d=(p=20)*f,e.next=18,this.bbi.read(H.alloc(d),0,d,h);case 18:for(m=e.sent,g=m.buffer,v=(new l._).endianess(c).int16("type").int16("fieldcount").uint64("offset").skip(4).int16("field"),b=[],k=0;k<f;k+=1)b.push(v.parse(g.slice(k*p)).result);return e.abrupt("return",b);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchExtraIndexBlocks",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,i,s,u,c,f=this,h=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},e.next=3,this.getHeader(r);case 3:return i=e.sent,s=i.isBigEndian,e.next=7,this.readIndices(r);case 7:if((u=e.sent).length){e.next=10;break}return e.abrupt("return",[]);case 10:return c=u.map(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(i){var u,c,h,p,d,m,g,v,b,k,w;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=i.offset,c=i.field,e.next=3,f.bbi.read(H.alloc(32),0,32,u,r);case 3:return h=e.sent,p=h.buffer,d=(new l._).endianess(s?"big":"little").int32("magic").int32("blockSize").int32("keySize").int32("valSize").uint64("itemCount"),m=d.parse(p).result,g=m.blockSize,v=m.keySize,b=m.valSize,k=(new l._).endianess(s?"big":"little").int8("nodeType").skip(1).int16("cnt").choice({tag:"nodeType",choices:{0:(new l._).array("leafkeys",{length:"cnt",type:(new l._).string("key",{length:v,stripNull:!0}).uint64("offset")}),1:(new l._).array("keys",{length:"cnt",type:(new l._).string("key",{length:v,stripNull:!0}).uint64("offset").uint32("length").uint32("reserved")})}}),w=function(){var e=(0,a.Z)((0,n.Z)().mark((function e(a){var i,s,u,l,h,p,d,m;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=4+g*(v+b),e.next=3,f.bbi.read(H.alloc(i),0,i,a,r);case 3:if(s=e.sent,u=s.buffer,!(l=k.parse(u).result).leafkeys){e.next=17;break}p=0;case 8:if(!(p<l.leafkeys.length)){e.next=16;break}if(d=l.leafkeys[p].key,!(t.localeCompare(d)<0&&h)){e.next=12;break}return e.abrupt("return",w(h));case 12:h=l.leafkeys[p].offset;case 13:p+=1,e.next=8;break;case 16:return e.abrupt("return",w(h));case 17:m=0;case 18:if(!(m<l.keys.length)){e.next=24;break}if(l.keys[m].key!==t){e.next=21;break}return e.abrupt("return",(0,o.Z)((0,o.Z)({},l.keys[m]),{},{field:c}));case 21:m+=1,e.next=18;break;case 24:return e.abrupt("return",void 0);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),32,e.abrupt("return",w(u+32));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=R,e.next=14,Promise.all(c);case 14:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchExtraIndex",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,i,s,u,c=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},e.next=3,this.searchExtraIndexBlocks(t,r);case 3:if((a=e.sent).length){e.next=6;break}return e.abrupt("return",[]);case 6:return e.next=8,this.getUnzoomedView(r);case 8:return i=e.sent,s=a.map((function(e){return new _.y((function(t){i.readFeatures(t,[e],r)})).pipe((0,O.u)((function(e,t){return e.concat(t)})),(0,F.U)((function(t){for(var r=0;r<t.length;r+=1)t[r].field=e.field;return t})))})),e.next=12,N.T.apply(void 0,(0,L.Z)(s)).toPromise();case 12:return u=e.sent,e.abrupt("return",u.filter((function(e){return e.rest.split("\t")[e.field-3]===t})));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(P)}}]);
//# sourceMappingURL=8982.4f69e112.chunk.js.map