"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6952],{46952:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var r=n(33028),a=n(46840),s=n(32723),u=n(34795),i=n(9249),c=n(87371),o=n(93069),f=n(95058),l=n(45754),p=n(13820),m=n(96234),h=n(82972),v=n(23995),d=n(32145),g=n(93824),y=n(27664),b=n(99836),x=n(16959),Z=n(46713),w=n(44922),k=Z.tr.getMismatches;function q(e){for(var t={},n=0;n<e.length;n++){var r=e[n],a=r.qname+"-"+r.tname;t[a]||(t[a]={quals:[],len:[]}),t[a].quals.push(r.extra.mappingQual),t[a].len.push(r.extra.blockLen||1)}for(var s=Object.fromEntries(Object.entries(t).map((function(e){var t=(0,m.Z)(e,2),n=t[0],r=t[1];return[n,N((0,w.$R)(r.quals,r.len))]}))),u=0;u<e.length;u++){var i=e[u],c=i.qname+"-"+i.tname;i.extra.meanScore=s[c]}for(var o=1e4,f=0,l=0;l<e.length;l++){var p=e[l];o=Math.min(p.extra.meanScore||0,o),f=Math.max(p.extra.meanScore||0,f)}for(var h=0;h<e.length;h++){var v=e[h],d=v.extra.meanScore||0;v.extra.meanScore=(d-o)/(f-o)}return e}function N(e){var t=e.reduce((function(e,t){var n=(0,m.Z)(e,2),r=n[0],a=n[1],s=(0,m.Z)(t,2),u=s[0],i=s[1];return[r+u*i,a+i]}),[0,0]),n=(0,m.Z)(t,2);return n[0]/n[1]}var C=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"get",value:function(e){if("mismatches"===e){var t=this.get("cg"),r=this.get("flipInsDel");return t?function(e,t){var n=k(t);if(e){var r=0;return n.map((function(e){if("insertion"===e.type)e.type="deletion",e.length=+e.base,e.start+=r,r+=e.length;else if("deletion"===e.type){var t=e.length;e.type="insertion",e.base="".concat(t),e.length=0,e.start+=r,r-=t}return e}))}return n}(r,t):[]}return(0,o.Z)((0,f.Z)(n.prototype),"get",this).call(this,e)}}]),n}(y.SimpleFeature),A=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).setupP=void 0,e}return(0,c.Z)(n,[{key:"setup",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,u,i,c,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.pluginManager,u=(0,d.openLocation)(this.getConf("pafLocation"),n),e.next=4,u.readFile(t);case 4:if(i=e.sent,!(0,w.lq)(i)){e.next=11;break}return e.next=8,(0,x.unzip)(i);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=i;case 12:if(!((c=e.t0).length>536870888)){e.next=15;break}throw new Error("Data exceeds maximum string length (512MB)");case 15:return o=new TextDecoder("utf8",{fatal:!0}).decode(c),e.abrupt("return",o.split(/\n|\r\n|\r/).filter((function(e){return!!e})).map((function(e){var t=e.split("\t"),n=(0,a.Z)(t),s=n[0],u=n[2],i=n[3],c=n[4],o=n[5],f=n[7],l=n[8],p=n[9],m=n[10],h=n[11],v=n.slice(12),d=Object.fromEntries(v.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));return{tname:o,tstart:+f,tend:+l,qname:s,qstart:+u,qend:+i,strand:"-"===c?-1:1,extra:(0,r.Z)({numMatches:+p,blockLen:+m,mappingQual:+h},d)}})));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyNames",value:function(){var e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}},{key:"getRefNames",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,r,a,u,i,c,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},r=null===(t=n.regions)||void 0===t?void 0:t[0].assemblyName,e.next=4,this.setup(n);case 4:if(a=e.sent,-1===(u=this.getAssemblyNames().indexOf(r))){e.next=10;break}for(i=new Set,c=0;c<a.length;c++)i.add(0===u?a[c].qname:a[c].tname);return e.abrupt("return",Array.from(i));case 10:return console.warn("Unable to do ref renaming on adapter"),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.ObservableCreate)(function(){var a=(0,u.Z)((0,s.Z)().mark((function a(u){var i,c,o,f,l,p,m,h,d,g,y,x,Z,w,k,N,A,M,O,S,D,F,P;return(0,s.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.setup(n);case 2:for(i=a.sent,(c=n.config)&&"meanQueryIdentity"===(0,b.readConfObject)(c,"colorBy")&&(i=q(i)),o=t.getAssemblyNames(),f=o.indexOf(e.assemblyName),l=e.start,p=e.end,m=e.refName,h=e.assemblyName,-1===f&&(console.warn("".concat(h," not found in this adapter")),u.complete()),d=0;d<i.length;d++)g=i[d],y=0,x=0,Z="",w="",k=0,N=0,0===f?(y=g.qstart,x=g.qend,Z=g.qname,w=g.tname,k=g.tstart,N=g.tend):(y=g.tstart,x=g.tend,Z=g.tname,w=g.qname,k=g.qstart,N=g.qend),A=g.extra,M=g.strand,Z===m&&(0,v.qY)(l,p,y,x)&&(O=A.numMatches,S=void 0===O?0:O,D=A.blockLen,F=void 0===D?1:D,P=0===f,u.next(new C((0,r.Z)({uniqueId:"".concat(d),assemblyName:o[+!P],start:y,end:x,type:"match",refName:Z,strand:M,revCigar:!0,flipInsDel:P,syntenyId:d,identity:S/F,mate:{start:k,end:N,refName:w,assemblyName:o[+P]}},A))));u.complete();case 11:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(h.BaseFeatureDataAdapter);A.capabilities=["getFeatures","getRefNames"]},44922:function(e,t,n){n.d(t,{$R:function(){return l},SN:function(){return c},lq:function(){return i},pJ:function(){return o}});var r=n(32723),a=n(34795),s=n(96234),u=n(16959);function i(e){return 31===e[0]&&139===e[1]&&8===e[2]}function c(e){return new Map(e.split(/\n|\r\n|\r/).filter((function(e){return!!e||e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=(0,s.Z)(t,6),r=n[0],a=n[1],u=n[2],i=n[3];return[i,{refName:r,start:+a,end:+u,score:+n[4],name:i,strand:"-"===n[5]?-1:1}]})))}function o(e,t){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if(a=e.sent,e.t0=new TextDecoder("utf8",{fatal:!0}),!i(a)){e.next=10;break}return e.next=7,(0,u.unzip)(a);case 7:e.t1=e.sent,e.next=11;break;case 10:e.t1=a;case 11:return e.t2=e.t1,e.abrupt("return",e.t0.decode.call(e.t0,e.t2));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t){return e.map((function(e,n){return[e,t[n]]}))}}}]);
//# sourceMappingURL=6952.4f7eeb86.chunk.js.map