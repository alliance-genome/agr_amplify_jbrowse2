{"version":3,"file":"static/js/298.af1e6aca.chunk.js","mappings":"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","sources":["../../../plugins/variants/src/VcfTabixAdapter/VcfTabixAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { NoAssemblyRegion } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { Feature } from '@jbrowse/core/util'\nimport { TabixIndexedFile } from '@gmod/tabix'\nimport VcfParser from '@gmod/vcf'\n\n// local\nimport VcfFeature from '../VcfFeature'\n\nexport default class extends BaseFeatureDataAdapter {\n  private configured?: Promise<{\n    vcf: TabixIndexedFile\n    parser: VcfParser\n  }>\n\n  private async configurePre() {\n    const pm = this.pluginManager\n    const vcfGzLocation = this.getConf('vcfGzLocation')\n    const location = this.getConf(['index', 'location'])\n    const indexType = this.getConf(['index', 'indexType'])\n\n    const filehandle = openLocation(vcfGzLocation, pm)\n    const isCSI = indexType === 'CSI'\n    const vcf = new TabixIndexedFile({\n      filehandle,\n      csiFilehandle: isCSI ? openLocation(location, pm) : undefined,\n      tbiFilehandle: !isCSI ? openLocation(location, pm) : undefined,\n      chunkCacheSize: 50 * 2 ** 20,\n      chunkSizeLimit: 1000000000,\n    })\n\n    const header = await vcf.getHeader()\n    return {\n      vcf,\n      parser: new VcfParser({ header }),\n    }\n  }\n\n  protected async configure() {\n    if (!this.configured) {\n      this.configured = this.configurePre().catch(e => {\n        this.configured = undefined\n        throw e\n      })\n    }\n    return this.configured\n  }\n\n  public async getRefNames(opts: BaseOptions = {}) {\n    const { vcf } = await this.configure()\n    return vcf.getReferenceSequenceNames(opts)\n  }\n\n  async getHeader() {\n    const { vcf } = await this.configure()\n    return vcf.getHeader()\n  }\n\n  async getMetadata() {\n    const { parser } = await this.configure()\n    return parser.getMetadata()\n  }\n\n  public getFeatures(query: NoAssemblyRegion, opts: BaseOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const { refName, start, end } = query\n      const { vcf, parser } = await this.configure()\n      await vcf.getLines(refName, start, end, {\n        lineCallback: (line, fileOffset) => {\n          observer.next(\n            new VcfFeature({\n              variant: parser.parseLine(line),\n              parser,\n              id: `${this.id}-vcf-${fileOffset}`,\n            }),\n          )\n        },\n        ...opts,\n      })\n      observer.complete()\n    }, opts.signal)\n  }\n\n  public freeResources(/* { region } */): void {}\n}\n"],"names":["_default","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","configured","_createClass","key","value","_configurePre","_asyncToGenerator","_regeneratorRuntime","mark","_callee","pm","vcfGzLocation","location","indexType","filehandle","isCSI","vcf","header","wrap","_context","prev","next","this","pluginManager","getConf","openLocation","TabixIndexedFile","csiFilehandle","undefined","tbiFilehandle","chunkCacheSize","Math","pow","chunkSizeLimit","getHeader","sent","abrupt","parser","VcfParser","stop","_configure","_callee2","_this2","_context2","configurePre","catch","e","_getRefNames","_callee3","opts","_yield$this$configure","_args3","_context3","configure","getReferenceSequenceNames","_getHeader","_callee4","_yield$this$configure2","_context4","_getMetadata","_callee5","_yield$this$configure3","_context5","getMetadata","query","_this3","ObservableCreate","_ref","_callee6","observer","refName","start","end","_yield$_this3$configu","_context6","getLines","_objectSpread","lineCallback","line","fileOffset","VcfFeature","variant","parseLine","id","complete","_x","signal","BaseFeatureDataAdapter"],"sourceRoot":""}