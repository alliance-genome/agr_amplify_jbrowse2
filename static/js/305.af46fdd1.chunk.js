(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[305],{37809:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(46377),s=a(99834),n=a(66885),i=a(32598),o=a(6434),d=a(7706),c=a(92202);class l extends r.BaseFeatureDataAdapter{async loadDataP(){const e=this.pluginManager,t=await(0,s.openLocation)(this.getConf("gffLocation"),e).readFile(),a=function(e){return 31===e[0]&&139===e[1]&&8===e[2]}(t)?await(0,d.unzip)(t):t;if(a.length>536870888)throw new Error("Data exceeds maximum string length (512MB)");const r=new TextDecoder("utf8",{fatal:!0}).decode(a),n=r.split(/\n|\r\n|\r/),l=[];for(let e=0;e<n.length&&n[e].startsWith("#");e++)l.push(n[e]);const u=l.join("\n"),f=c.A.parseStringSync(r,{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1,disableDerivesFromReferences:!0}),h={};for(const e of f.flat().map(((e,t)=>new o.A({data:this.featureData(e),id:`${this.id}-offset-${t}`})))){const t=e.get("refName");h[t]||(h[t]=new i.Ay),h[t].insert([e.get("start"),e.get("end")],e)}return{header:u,intervalTree:h}}async loadData(){return this.gffFeatures||(this.gffFeatures=this.loadDataP().catch((e=>{throw this.gffFeatures=void 0,e}))),this.gffFeatures}async getRefNames(e={}){const{intervalTree:t}=await this.loadData();return Object.keys(t)}async getHeader(){const{header:e}=await this.loadData();return e}getFeatures(e,t={}){return(0,n.ObservableCreate)((async t=>{try{const{start:a,end:r,refName:s}=e,{intervalTree:n}=await this.loadData();n[s]?.search([a,r]).forEach((e=>t.next(e))),t.complete()}catch(e){t.error(e)}}),t.signal)}featureData(e){const t={...e};t.start-=1,"+"===e.strand?t.strand=1:"-"===e.strand?t.strand=-1:"."===e.strand?t.strand=0:t.strand=void 0,t.phase=Number(e.phase),t.refName=e.seq_id,null===e.score&&delete t.score,null===e.phase&&delete t.score;const a=new Set(["start","end","seq_id","score","type","source","phase","strand"]),r=e.attributes||{};for(const e of Object.keys(r)){let s=e.toLowerCase();if(a.has(s)&&(s+="2"),null!==r[e]){let a=r[e];Array.isArray(a)&&1===a.length&&([a]=a),t[s]=a}}return t.refName=t.seq_id,e.child_features&&e.child_features.length>0&&(t.subfeatures=e.child_features.flatMap((e=>e.map((e=>this.featureData(e)))))),delete t.child_features,delete t.data,delete t.attributes,delete t.seq_id,t}freeResources(){}}},85392:()=>{},43951:()=>{}}]);
//# sourceMappingURL=305.af46fdd1.chunk.js.map