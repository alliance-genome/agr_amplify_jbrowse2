(this["webpackJsonp@jbrowse/web"]=this["webpackJsonp@jbrowse/web"]||[]).push([[14],{104:function(e,t,n){"use strict";n.r(t),n.d(t,"RemoteFileWithRangeCache",(function(){return O})),n.d(t,"openLocation",(function(){return C})),n.d(t,"getFetcher",(function(){return S}));var r=n(83),a=n(86),o=n(80),i=n.n(o),c=n(164),s=n(103),u=n(29),l=n(81),d=n(11),f=n(142),p=n(132),g=n(88),m=n(89),h=n(1292),b=n(99),v={};var y=new h.a({fetch:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=v[e];if(!a)throw new Error("fetch not registered for ".concat(e));return a(e,t,n,r)},size:500*Math.pow(1024,2),chunkSize:15872,maxFetchSize:100*Math.pow(1024,2),minimumTTL:864e5});var O=function(e){Object(g.a)(n,e);var t=Object(m.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"fetch",value:function(){var e=Object(r.a)(i.a.mark((function e(t,r){var a,o,c,s,l,d,g,m,h,b,O,w;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v[String(t)]||(v[String(t)]=this.fetchBinaryRange.bind(this)),(a=r&&r.headers)&&(a instanceof Headers?o=a.get("range"):Array.isArray(a)?(c=a.find((function(e){return"range"===Object(u.a)(e,1)[0]}))||[void 0,void 0],s=Object(u.a)(c,2),o=s[1]):o=a.range),!o){e.next=14;break}if(!(l=/bytes=(\d+)-(\d+)/.exec(o))){e.next=14;break}return d=Object(u.a)(l,3),g=d[1],m=d[2],h=parseInt(g,10),b=parseInt(m,10),e.next=11,y.getRange(t,h,b-h+1,{signal:r&&r.signal});case 11:return O=e.sent,w=O.headers,e.abrupt("return",new Response(O.buffer,{status:206,headers:w}));case 14:return e.abrupt("return",Object(f.a)(Object(p.a)(n.prototype),"fetch",this).call(this,t,r));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchBinaryRange",value:function(){var e=Object(r.a)(i.a.mark((function e(t,r,o){var c,l,d,g,m,h,v,y,O,w,j,k,x,C,S=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=S.length>3&&void 0!==S[3]?S[3]:{},l=new Date,d=Object(a.a)(Object(a.a)({},c.headers),{},{range:"bytes=".concat(r,"-").concat(o)}),e.next=5,Object(f.a)(Object(p.a)(n.prototype),"fetch",this).call(this,t,Object(a.a)(Object(a.a)({},c),{},{headers:d}));case 5:if(g=e.sent,m=new Date,206===g.status){e.next=11;break}throw h="HTTP ".concat(g.status," (").concat(g.statusText,") when fetching ").concat(t," bytes ").concat(r,"-").concat(o),v=" (should be 206 for range requests)",new Error("".concat(h).concat(200===g.status?v:""));case 11:y={},O=Object(s.a)(g.headers.entries());try{for(O.s();!(w=O.n()).done;)j=Object(u.a)(w.value,2),k=j[0],x=j[1],y[k]=x}catch(i){O.e(i)}finally{O.f()}return e.next=16,g.arrayBuffer();case 16:return C=e.sent,e.abrupt("return",{headers:y,requestDate:l,responseDate:m,buffer:b.Buffer.from(C)});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(c.RemoteFile),w=n(177),j=n(105),k=n(795),x=n.n(k);function C(e,t){if(!e)throw new Error("must provide a location to openLocation");if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(x.a)return new c.LocalFile(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){var n=Object(j.getBlob)(e.blobId);if(!n)throw new Error('file ("'.concat(e.name,'") was opened locally from a previous session. To restore it, go to track settings and reopen the file'));return new c.BlobFile(n)}if(Object(w.p)(e)){if(!e.uri)throw new Error("No URI provided");var r=e.baseUri?Object(a.a)(Object(a.a)({},e),{},{uri:new URL(e.uri,e.baseUri).href}):e;if(t){var o=T(e,t);if(o)return o.openLocation(r)}return new O(r.uri,{fetch:E})}throw new Error("invalid fileLocation")}function S(e,t){if(!Object(w.p)(e))throw new Error("Not a valid UriLocation: ".concat(JSON.stringify(e)));var n=T(e,t);return n?n.getFetcher(e):E}function T(e,t){var n=t.rootModel;if(n&&Object(w.d)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}function E(e,t){return M.apply(this,arguments)}function M(){return(M=Object(r.a)(i.a.mark((function e(t,n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,n);case 2:if(401!==(r=e.sent).status){e.next=7;break}if(!(a=r.headers.get("WWW-Authenticate"))||!a.includes("Basic")){e.next=7;break}throw new w.a("Accessing HTTPBasic resource without authentication",t.toString());case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},105:function(e,t,n){"use strict";n.r(t),n.d(t,"getTrackAssemblyNames",(function(){return i})),n.d(t,"getRpcSessionId",(function(){return c})),n.d(t,"getParentRenderProps",(function(){return s})),n.d(t,"UNKNOWN",(function(){return u})),n.d(t,"UNSUPPORTED",(function(){return l})),n.d(t,"getBlob",(function(){return f})),n.d(t,"getBlobMap",(function(){return p})),n.d(t,"setBlobMap",(function(){return g})),n.d(t,"storeBlobLocation",(function(){return m})),n.d(t,"makeIndex",(function(){return h})),n.d(t,"makeIndexType",(function(){return b})),n.d(t,"getFileName",(function(){return v})),n.d(t,"guessAdapter",(function(){return y})),n.d(t,"guessTrackType",(function(){return O})),n.d(t,"generateUnsupportedTrackConf",(function(){return w})),n.d(t,"generateUnknownTrackConf",(function(){return j}));var r=n(85),a=n(82),o=n(79);function i(e){var t=e.configuration,n=Object(o.readConfObject)(t,"assemblyNames");if(!n){var a=Object(r.getParent)(e.configuration);if("sequence"in a)return[Object(o.readConfObject)(a,"name")]}return n}function c(e){for(var t,n=e;!Object(r.isRoot)(n);n=Object(r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function s(e){for(var t=Object(r.getParent)(e);!Object(r.isRoot)(t);t=Object(r.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}var u="UNKNOWN",l="UNSUPPORTED",d={};function f(e){return d[e]}function p(){return d}function g(e){d=e}function m(e){if(e&&"blob"in e){var t="b".concat(+Date.now());return d[t]=e.blob,{name:null===e||void 0===e?void 0:e.blob.name,blobId:t,locationType:"BlobLocation"}}return e}function h(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function b(e,t,n){return null!==e&&void 0!==e&&e.toUpperCase().endsWith(t)?t:n}function v(e){var t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0;return(null===r||void 0===r?void 0:r.name)||(null===t||void 0===t?void 0:t.slice(t.lastIndexOf("/")+1))||(null===n||void 0===n?void 0:n.slice(n.lastIndexOf("/")+1))||""}function y(e,t,n,a){if(a){var o=Object(r.getEnv)(a).pluginManager.evaluateExtensionPoint("Core-guessAdapterForLocation",(function(e,t,n){}))(e,t,n);if(o)return o}return{type:u}}function O(e,t){if(t){var n=Object(a.getSession)(t),o=Object(r.getEnv)(n).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",(function(e){}))(e);if(o)return o}return"FeatureTrack"}function w(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=Object(a.objectHash)(r),r}function j(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=Object(a.objectHash)(r),r}},106:function(e,t,n){"use strict";n.r(t),n.d(t,"ElementId",(function(){return p})),n.d(t,"PropTypes",(function(){return g})),n.d(t,"NoAssemblyRegion",(function(){return m})),n.d(t,"Region",(function(){return h})),n.d(t,"LocalPathLocation",(function(){return b})),n.d(t,"BlobLocation",(function(){return v})),n.d(t,"UriLocationRaw",(function(){return y})),n.d(t,"UriLocation",(function(){return O})),n.d(t,"FileLocation",(function(){return w}));var r=n(86),a=n(2),o=n(330),i=n.n(o),c=n(85),s=n(25),u=n.n(s),l=n(84),d=["baseUri"],f=["locationType"],p=c.types.optional(c.types.identifier,i.a.generate),g={Region:u.a.shape({refName:u.a.string.isRequired,start:u.a.number.isRequired,end:u.a.number.isRequired}),ConfigSchema:l.PropTypes.objectOrObservableObject,Feature:u.a.shape({get:u.a.func.isRequired,id:u.a.func.isRequired})},m=c.types.model("NoAssemblyRegion",{refName:c.types.string,start:c.types.number,end:c.types.number,reversed:c.types.optional(c.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}})),h=c.types.compose("Region",m,c.types.model({assemblyName:c.types.string})),b=c.types.model("LocalPathLocation",{locationType:c.types.literal("LocalPathLocation"),localPath:c.types.string}),v=c.types.model("BlobLocation",{locationType:c.types.literal("BlobLocation"),name:c.types.string,blobId:c.types.string}),y=c.types.model("UriLocation",{locationType:c.types.literal("UriLocation"),uri:c.types.string,baseUri:c.types.maybe(c.types.string),internetAccountId:c.types.maybe(c.types.string),internetAccountPreAuthorization:c.types.maybe(c.types.model("InternetAccountPreAuthorization",{internetAccountType:c.types.string,authInfo:c.types.frozen()}))}),O=c.types.snapshotProcessor(y,{postProcessor:function(e){var t=e.baseUri,n=Object(a.a)(e,d);return t?e:n}}),w=c.types.snapshotProcessor(c.types.union(b,O,v),{preProcessor:function(e){if(e){var t=e.locationType,n=Object(a.a)(e,f);if(!t){var o=n.uri,i=n.localPath,c=n.blob,s="";return void 0!==o?s="UriLocation":void 0!==i?s="LocalPathLocation":void 0!==c&&(s="BlobLocation"),Object(r.a)(Object(r.a)({},n),{},{locationType:s})}return e}}})},108:function(e,t,n){"use strict";n.r(t),n.d(t,"jbrowseDefaultPalette",(function(){return f})),n.d(t,"createJBrowseDefaultProps",(function(){return p})),n.d(t,"createJBrowseDefaultOverrides",(function(){return g})),n.d(t,"jbrowseBaseTheme",(function(){return m})),n.d(t,"createJBrowseTheme",(function(){return h})),n.d(t,"LogoFull",(function(){return w})),n.d(t,"Logomark",(function(){return O})),n.d(t,"App",(function(){return Me})),n.d(t,"ReturnToImportFormDialog",(function(){return Fe})),n.d(t,"ErrorMessage",(function(){return De.default})),n.d(t,"AssemblySelector",(function(){return Be.a})),n.d(t,"FileSelector",(function(){return Ve.a})),n.d(t,"PrerenderedCanvas",(function(){return qe})),n.d(t,"ResizeHandle",(function(){return ne})),n.d(t,"EditableTypography",(function(){return be})),n.d(t,"FactoryResetDialog",(function(){return _e})),n.d(t,"Tooltip",(function(){return Je})),n.d(t,"FatalErrorDialog",(function(){return Qe})),n.d(t,"Menu",(function(){return le.a})),n.d(t,"SanitizedHTML",(function(){return Ke.a}));var r=n(86),a=n(24),o=n(23),i=n(821),c=n(21),s=n(34),u=n(790),l=n.n(u),d=Object(s.b)(),f={primary:{main:"#0D233F"},secondary:{main:"#721E63"},tertiary:d.palette.augmentColor({main:"#135560"}),quaternary:d.palette.augmentColor({main:"#FFB11D"}),stopCodon:"#e22",startCodon:"#3e3",bases:{A:d.palette.augmentColor(a.a),C:d.palette.augmentColor(o.a),G:d.palette.augmentColor(i.a),T:d.palette.augmentColor(c.a)}};function p(){return{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}}}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=l()(f,e);return{MuiIconButton:{colorSecondary:{color:t.tertiary.main}},MuiButton:{textSecondary:{color:t.tertiary.main}},MuiFab:{secondary:{backgroundColor:t.quaternary.main}},MuiLink:{root:{color:t.tertiary.main}},MuiAccordionSummary:{root:{backgroundColor:t.tertiary.main+" !important",width:"100%","&$expanded":{minHeight:0,color:t.tertiary.contrastText,backgroundColor:t.tertiary.main},minHeight:0},content:{"&$expanded":{margin:"8px 8px"},margin:"8px 8px",color:t.tertiary.contrastText}},MuiMenuItem:{root:{paddingTop:3,paddingBottom:3}},MuiListItemIcon:{root:{minWidth:32}},MuiListItemText:{inset:{paddingLeft:32}}}}var m={palette:f,typography:{fontSize:12},spacing:4,props:{MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},overrides:g()};function h(e){var t,n;return e?(null!==(t=e.palette)&&void 0!==t&&t.tertiary&&(e=Object(r.a)(Object(r.a)({},e),{},{palette:Object(r.a)(Object(r.a)({},e.palette),{},{tertiary:d.palette.augmentColor(e.palette.tertiary)})})),null!==(n=e.palette)&&void 0!==n&&n.quaternary&&(e=Object(r.a)(Object(r.a)({},e),{},{palette:Object(r.a)(Object(r.a)({},e.palette),{},{quaternary:d.palette.augmentColor(e.palette.quaternary)})})),e=Object(r.a)(Object(r.a)({},e),{},{props:l()({MuiButton:{size:"small"},MuiFilledInput:{margin:"dense"},MuiFormControl:{margin:"dense"},MuiFormHelperText:{margin:"dense"},MuiIconButton:{size:"small"},MuiInputBase:{margin:"dense"},MuiList:{dense:!0},MuiListItem:{dense:!0},MuiOutlinedInput:{margin:"dense"},MuiFab:{size:"small"},MuiTable:{size:"small"},MuiTextField:{margin:"dense",size:"small"},MuiToolbar:{variant:"dense"},MuiSvgIcon:{fontSize:"small"},MuiToggleButtonGroup:{size:"small"},MuiCheckbox:{size:"small"},MuiLink:{underline:"always"}},e.props||{}),overrides:l()(g(e.palette),e.overrides||{})}),Object(s.b)(l()(m,e))):Object(s.b)(m)}var b=n(1),v=n.n(b);function y(e){return"black"===e?{midnight:"#808080",forrest:"#666666",grape:"#4d4d4d",mandarin:"#333333",gray:"#1a1a1a"}:"white"===e?{midnight:"#ffffff",forrest:"#e6e6e6",grape:"#cccccc",mandarin:"#b3b3b3",gray:"#999999"}:{midnight:"#0d233f",forrest:"#135560",grape:"#721e63",mandarin:"#ffb11d",gray:"#dadada"}}function O(e){var t=e.variant;return v.a.createElement("svg",{viewBox:"0 0 175 175"},v.a.createElement(j,{variant:t}))}function w(e){var t=e.variant;return v.a.createElement("svg",{viewBox:"0 0 641 175"},v.a.createElement(k,{variant:t}),v.a.createElement(j,{variant:t}))}function j(e){var t=y(e.variant);return v.a.createElement(v.a.Fragment,null,v.a.createElement("path",{style:{fill:t.midnight},d:"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z"}),v.a.createElement("path",{style:{fill:t.forrest},d:"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z"}),v.a.createElement("path",{style:{fill:t.grape},d:"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z"}),v.a.createElement("path",{style:{fill:t.mandarin},d:"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z"}),v.a.createElement("path",{style:{fill:t.gray},d:"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z"}))}function k(e){var t=y(e.variant);return v.a.createElement("g",{"aria-label":"JBrowse",transform:"translate(213.084 144.241)",style:{fill:t.midnight}},v.a.createElement("path",{d:"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z"}),v.a.createElement("path",{d:"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z"}),v.a.createElement("path",{d:"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z"}),v.a.createElement("path",{d:"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z"}),v.a.createElement("path",{d:"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z"}),v.a.createElement("path",{d:"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z"}),v.a.createElement("path",{d:"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z"}))}var x=n(29),C=n(51),S=n(1659),T=n(1656),E=n(1636),M=n(1630),R=n(1638),P=n(1757),A=n(1633),N=n(1635),L=n(1665),I=n(1287),F=n.n(I),D=n(84),B=n(85),V=n(79),z=n(13),W=n(1660),U=n(1642),q=n(1263),H=n(257),_=n.n(H),G=n(113),J=n.n(G),X=n(1268),Y=n.n(X),Q=n(580),K=n.n(Q),$=n(2),Z=n(26),ee=["onDrag","vertical","flexbox","className"],te=Object(C.a)({horizontalHandle:{cursor:"row-resize",width:"100%"},verticalHandle:{cursor:"col-resize",height:"100%"},flexbox_verticalHandle:{cursor:"col-resize",alignSelf:"stretch"},flexbox_horizontalHandle:{cursor:"row-resize",alignSelf:"stretch"}});var ne=function(e){var t,n=e.onDrag,r=e.vertical,a=void 0!==r&&r,o=e.flexbox,i=void 0!==o&&o,c=e.className,s=Object($.a)(e,ee),u=Object(b.useState)(!1),l=Object(x.a)(u,2),d=l[0],f=l[1],p=Object(b.useRef)(0),g=te();return Object(b.useEffect)((function(){function e(e){e.preventDefault();var t=a?e.clientX:e.clientY,r=t-p.current;r&&(n(r),p.current=t)}function t(){f(!1)}return d?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",t,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",t,!0)}):function(){}}),[d,n,a]),t=i?a?g.flexbox_verticalHandle:g.flexbox_horizontalHandle:a?g.verticalHandle:g.horizontalHandle,v.a.createElement("div",Object.assign({"data-resizer":"true",onMouseDown:function(e){e.preventDefault(),p.current=a?e.clientX:e.clientY,f(!0)},role:"presentation",className:Object(Z.a)(t,c)},s))},re=Object(C.a)((function(e){return{paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}}));var ae=Object(D.observer)((function(e){var t=e.children,n=e.session,r=n.drawerPosition,a=n.drawerWidth,o=re();return v.a.createElement(M.a,{className:o.paper,elevation:16,square:!0},"right"===r?v.a.createElement(ne,{onDrag:n.resizeDrawer,className:o.resizeHandle,vertical:!0}):null,t,"left"===r?v.a.createElement(ne,{onDrag:n.resizeDrawer,className:o.resizeHandle,style:{left:a},vertical:!0}):null)})),oe=Object(C.a)((function(e){return{drawerActions:{float:"right","&:hover":{backgroundColor:Object(z.a)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},drawerToolbar:{paddingLeft:e.spacing(2)},spacer:{flexGrow:1},drawerSelect:{color:e.palette.secondary.contrastText},drawerLoading:{margin:e.spacing(2)},dropDownIcon:{color:e.palette.secondary.contrastText},header:{background:e.palette.secondary.main}}})),ie=Object(D.observer)((function(e){var t=e.session,n=e.setToolbarHeight,r=Object(B.getEnv)(t).pluginManager,a=t.visibleWidget,o=t.activeWidgets,i=t.drawerPosition,c=oe(),s=v.a.useState(null),u=Object(x.a)(s,2),l=u[0],d=u[1];return v.a.createElement(S.a,{position:"sticky",className:c.header,ref:function(e){return n((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)}},v.a.createElement(T.a,{disableGutters:!0,className:c.drawerToolbar},v.a.createElement(P.a,{value:null===a||void 0===a?void 0:a.id,"data-testid":"widget-drawer-selects",className:c.drawerSelect,classes:{icon:c.dropDownIcon},renderValue:function(e){var n=t.activeWidgets.get(e);if(!n)return v.a.createElement(R.a,{variant:"h6",color:"inherit"},"Unknown widget");var a=r.getWidgetType(n.type),o=a.HeadingComponent,i=a.heading;return o?v.a.createElement(o,{model:n}):v.a.createElement(R.a,{variant:"h6",color:"inherit"},i)},onChange:function(e){var n=t.activeWidgets.get(e.target.value);n||t.notify("Widget not found "+e.target.value,"warning"),t.showWidget(n)}},Array.from(o.values()).map((function(e){var n=r.getWidgetType(e.type),a=n.HeadingComponent,o=n.heading;return v.a.createElement(A.a,{"data-testid":"widget-drawer-selects-item-".concat(e.type),key:e.id,value:e.id},a?v.a.createElement(a,{model:e}):v.a.createElement(R.a,{variant:"h6",color:"inherit"},o),v.a.createElement(W.a,null,v.a.createElement(U.a,{"data-testid":"".concat(e.type,"-drawer-delete"),color:"inherit","aria-label":"Delete",onClick:function(){t.hideWidget(e)}},v.a.createElement(_.a,null))))}))),v.a.createElement("div",{className:c.spacer}),v.a.createElement("div",null,v.a.createElement(U.a,{"data-testid":"drawer-close",color:"inherit",onClick:function(e){return d(e.currentTarget)}},v.a.createElement(K.a,null)),v.a.createElement(E.a,{title:"Minimize drawer"},v.a.createElement(U.a,{"data-testid":"drawer-minimize",color:"inherit",onClick:function(){t.notify("Drawer minimized, click button on ".concat(i," side of screen to re-open"),"info"),t.minimizeWidgetDrawer()}},v.a.createElement(Y.a,null))),v.a.createElement(E.a,{title:"Close drawer"},v.a.createElement(U.a,{"data-testid":"drawer-close",color:"inherit",onClick:function(){t.hideWidget(a)}},v.a.createElement(J.a,null))))),v.a.createElement(q.a,{anchorEl:l,open:Boolean(l),onClose:function(){return d(null)}},["left","right"].map((function(e){return v.a.createElement(A.a,{key:e,selected:"option"===i,onClick:function(){t.setDrawerPosition(e),d(null)}},e)}))))})),ce=Object(D.observer)((function(e){var t=e.session,n=t.visibleWidget,r=Object(B.getEnv)(t).pluginManager,a=n?r.getWidgetType(n.type).ReactComponent:null,o=Object(b.useState)(0),i=Object(x.a)(o,2),c=i[0],s=i[1];return v.a.createElement(ae,{session:t},v.a.createElement(ie,{session:t,setToolbarHeight:s}),v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null,"Loading...")},v.a.createElement(a,{model:n,session:t,toolbarHeight:c})))})),se=n(441),ue=n.n(se),le=n(233),de=Object(C.a)((function(e){return{root:{display:"flex"},buttonRoot:{"&:hover":{backgroundColor:Object(z.a)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}}));var fe=Object(D.observer)((function(e){var t=e.menuTitle,n=e.session,r=e.menuItems,a=Object(b.useState)(!1),o=Object(x.a)(a,2),i=o[0],c=o[1],s=Object(b.useRef)(null),u=de();function l(){c(!1)}return v.a.createElement("div",{className:u.root},v.a.createElement(N.a,{ref:s,onClick:function(){c(!i)},color:"inherit","data-testid":"dropDownMenuButton",classes:{root:u.buttonRoot}},t,v.a.createElement(ue.a,null)),v.a.createElement(le.a,{anchorEl:s.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:function(e,t){t(n),l()},open:i,onClose:l,menuItems:r}))})),pe=n(1622),ge=n(140),me=["value","setValue","variant"],he=Object(C.a)((function(e){return{input:{},inputBase:{},typography:{top:6,left:2,position:"absolute",whiteSpace:"nowrap",visibility:"hidden"},inputRoot:{padding:e.spacing(.5)},inputFocused:{borderStyle:"solid",borderRadius:e.shape.borderRadius,borderWidth:2}}})),be=v.a.forwardRef((function(e,t){var n=e.value,a=e.setValue,o=e.variant,i=Object($.a)(e,me),c=Object(b.useState)(),s=Object(x.a)(c,2),u=s[0],l=s[1],d=Object(b.useState)(0),f=Object(x.a)(d,2),p=f[0],g=f[1],m=Object(b.useState)(null),h=Object(x.a)(m,2),y=h[0],O=h[1],w=Object(b.useState)(null),j=Object(x.a)(w,2),k=j[0],C=j[1],S=Object(b.useState)(!1),T=Object(x.a)(S,2),E=T[0],M=T[1];Object(b.useEffect)((function(){E&&(k&&k.blur(),M(!1))}),[E,k]);var P=he(e),A=Object(ge.a)(),N=y&&y.clientWidth;N&&N!==p&&g(N);return v.a.createElement("div",Object.assign({},i,{ref:t}),v.a.createElement("div",{style:{position:"relative"}},v.a.createElement(R.a,{ref:function(e){O(e)},component:"span",variant:o,className:P.typography},void 0===u?n:u)),v.a.createElement(pe.a,{inputRef:function(e){C(e)},className:P.inputBase,inputProps:{style:Object(r.a)({width:p},o&&"inherit"!==o&&"srOnly"!==o?A.typography[o]:{})},classes:{input:P.input,root:P.inputRoot,focused:P.inputFocused},value:void 0===u?n:u,onChange:function(e){l(e.target.value)},onKeyDown:function(e){"Enter"===e.key?k&&k.blur():"Escape"===e.key&&(l(void 0),M(!0))},onBlur:function(){u&&u!==n&&a(u),l(void 0)}}))})),ve=n(1663),ye=n(1746);var Oe=Object(D.observer)((function(e){var t=e.session,n=Object(b.useState)(!1),r=Object(x.a)(n,2),a=r[0],o=r[1],i=Object(b.useState)(),c=Object(x.a)(i,2),s=c[0],u=c[1],l=t.popSnackbarMessage,d=t.snackbarMessages,f=d.length?d[d.length-1]:null;Object(b.useEffect)((function(){var e;return s?f?s[0]!==f[0]&&(o(!1),e=setTimeout((function(){u(f),o(!0)}),100)):u(void 0):f&&(u(f),o(!0)),function(){clearTimeout(e)}}),[f,s]);var p=function(e,t){"clickaway"!==t&&(l(),o(!1))},g=s||[],m=Object(x.a)(g,2),h=m[0],y=m[1];return v.a.createElement(ve.a,{open:a&&!!h,onClose:p,action:v.a.createElement(U.a,{"aria-label":"close",color:"inherit",onClick:p},v.a.createElement(J.a,null))},v.a.createElement(ye.a,{onClose:p,severity:y||"warning"},h))})),we=n(1272),je=n(827),ke=n.n(je),xe=Object(C.a)((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:Object(z.a)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),Ce=Object(D.observer)((function(e){var t=e.model,n=e.IconButtonProps,r=e.IconProps,a=Object(b.useState)(),o=Object(x.a)(a,2),i=o[0],c=o[1],s=t.menuItems,u="function"===typeof s?s():s;return null!==u&&void 0!==u&&u.length?v.a.createElement(v.a.Fragment,null,v.a.createElement(U.a,Object.assign({},n,{"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)},"data-testid":"view_menu_icon"}),v.a.createElement(ke.a,r)),v.a.createElement(le.a,{anchorEl:i,open:Boolean(i),onMenuItemClick:function(e,t){t(),c(void 0)},onClose:function(){c(void 0)},menuItems:t.menuItems()})):null})),Se=Object(we.withSize)()(Object(D.observer)((function(e){var t=e.view,n=e.onClose,a=e.style,o=e.children,i=e.size.width,c=xe(),s=Object(ge.a)().spacing(1);Object(b.useEffect)((function(){i&&Object(B.isAlive)(t)&&t.setWidth(i-2*s)}),[s,t,i]);var u=Object(b.useRef)(null);return Object(b.useEffect)((function(){var e,t;null===(e=u.current)||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,{block:"center"})}),[]),v.a.createElement(M.a,{elevation:12,className:c.viewContainer,style:Object(r.a)(Object(r.a)({},a),{},{padding:"0px ".concat(s,"px ").concat(s,"px")})},v.a.createElement("div",{ref:u,style:{display:"flex"}},v.a.createElement(Ce,{model:t,IconButtonProps:{classes:{root:c.iconRoot},edge:"start"},IconProps:{className:c.icon}}),v.a.createElement("div",{className:c.grow}),v.a.createElement(E.a,{title:"Rename view",arrow:!0},v.a.createElement(be,{value:t.displayName||(t.assemblyNames?t.assemblyNames.join(","):"Untitled view"),setValue:function(e){t.setDisplayName(e)},variant:"body2",classes:{input:c.input,inputBase:c.inputBase,inputRoot:c.inputRoot,inputFocused:c.inputFocused}})),v.a.createElement("div",{className:c.grow}),v.a.createElement(U.a,{"data-testid":"close_view",classes:{root:c.iconRoot},edge:"end",onClick:n},v.a.createElement(J.a,{className:c.icon}))),v.a.createElement(M.a,null,o))}))),Te=Object(C.a)((function(e){return{"@global":{html:{"font-family":"Roboto"},"*":{"scrollbar-width":"auto","scrollbar-color":"rgba(0,0,0,.5) rgba(128,128,128)"},"*::-webkit-scrollbar":{"-webkit-appearance":"none",width:"12px"},"*::-webkit-scrollbar-thumb":{"background-color":"rgba(0,0,0,.5)","-webkit-box-shadow":"0 0 1px rgba(255,255,255,.5)"}},root:{display:"grid",height:"100vh",width:"100%"},fabLeft:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),left:e.spacing(2)},fabRight:{zIndex:1e4,position:"fixed",bottom:e.spacing(2),right:e.spacing(2)},menuBarAndComponents:{gridColumn:"main",display:"grid",gridTemplateRows:"[menubar] min-content [components] auto",height:"100vh"},menuBar:{gridRow:"menubar"},components:{overflowY:"auto",gridRow:"components"},appBar:{flexGrow:1},grow:{flexGrow:1},inputBase:{color:e.palette.primary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.primary.light}},inputFocused:{borderColor:e.palette.secondary.main,backgroundColor:e.palette.primary.light},selectPaper:{padding:e.spacing(4)}}})),Ee=Object(D.observer)((function(e){var t=e.session.configuration,n=Object(V.readConfObject)(t,"logoPath");return null!==n&&void 0!==n&&n.uri?v.a.createElement("img",{src:n.uri,alt:"Custom logo"}):v.a.createElement(w,{variant:"white"})})),Me=Object(D.observer)((function(e){var t,n,r=e.session,a=e.HeaderButtons,o=void 0===a?v.a.createElement("div",null):a,i=Te(),c=Object(B.getEnv)(r).pluginManager,s=c.getElementTypeRecord("view").all(),u=Object(b.useState)(null===(t=s[0])||void 0===t?void 0:t.name),l=Object(x.a)(u,2),d=l[0],f=l[1],p=r.visibleWidget,g=r.drawerWidth,m=r.minimized,h=r.activeWidgets,y=r.savedSessionNames,O=r.name,w=r.menus,j=r.views,k=r.drawerPosition;var C,I=p&&!m;return"right"===k?C=["[main] 1fr",I?"[drawer] ".concat(g,"px"):void 0]:"left"===k&&(C=[I?"[drawer] ".concat(g,"px"):void 0,"[main] 1fr"]),v.a.createElement("div",{className:i.root,style:{gridTemplateColumns:null===(n=C)||void 0===n?void 0:n.filter((function(e){return!!e})).join(" ")}},I&&"left"===k?v.a.createElement(ce,{session:r}):null,r.DialogComponent?v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null)},v.a.createElement(r.DialogComponent,r.DialogProps)):null,v.a.createElement("div",{className:i.menuBarAndComponents},v.a.createElement("div",{className:i.menuBar},v.a.createElement(S.a,{className:i.appBar,position:"static"},v.a.createElement(T.a,null,w.map((function(e){return v.a.createElement(fe,{key:e.label,menuTitle:e.label,menuItems:e.menuItems,session:r})})),v.a.createElement("div",{className:i.grow}),v.a.createElement(E.a,{title:"Rename Session",arrow:!0},v.a.createElement(be,{value:O,setValue:function(e){null!==y&&void 0!==y&&y.includes(e)?r.notify('Cannot rename session to "'.concat(e,'", a saved session with that name already exists'),"warning"):r.renameCurrentSession(e)},variant:"body1",classes:{inputBase:i.inputBase,inputRoot:i.inputRoot,inputFocused:i.inputFocused}})),o,v.a.createElement("div",{className:i.grow}),v.a.createElement("div",{style:{width:150,maxHeight:48}},v.a.createElement(Ee,{session:r}))))),v.a.createElement("div",{className:i.components},j.length?j.map((function(e){var t=c.getViewType(e.type);if(!t)throw new Error("unknown view type ".concat(e.type));var n=t.ReactComponent;return v.a.createElement(Se,{key:"view-".concat(e.id),view:e,onClose:function(){return r.removeView(e)}},v.a.createElement(b.Suspense,{fallback:v.a.createElement("div",null,"Loading...")},v.a.createElement(n,{model:e,session:r,getTrackType:c.getTrackType})))})):v.a.createElement(M.a,{className:i.selectPaper},v.a.createElement(R.a,null,"Select a view to launch"),v.a.createElement(P.a,{value:d,onChange:function(e){return f(e.target.value)}},s.map((function(e){var t=e.name;return v.a.createElement(A.a,{key:t,value:t},t)}))),v.a.createElement(N.a,{onClick:function(){r.addView(d,{})},variant:"contained",color:"primary"},"Launch view")),v.a.createElement("div",{style:{height:300}}))),h.size>0&&m?v.a.createElement(E.a,{title:"Open drawer widget"},v.a.createElement(L.a,{className:"right"===k?i.fabRight:i.fabLeft,color:"primary","data-testid":"drawer-maximize",onClick:function(){return r.showWidgetDrawer()}},v.a.createElement(F.a,null))):null,I&&"right"===k?v.a.createElement(ce,{session:r}):null,v.a.createElement(Oe,{session:r}))})),Re=n(1666),Pe=n(1669),Ae=n(1658),Ne=n(1670),Le=n(1671),Ie=Object(C.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));var Fe=Object(D.observer)((function(e){var t=e.model,n=e.handleClose,r=Ie();return v.a.createElement(Re.a,{maxWidth:"xl",open:!0,onClose:n},v.a.createElement(Pe.a,null,"Reference sequence",n?v.a.createElement(U.a,{className:r.closeButton,onClick:function(){return n()}},v.a.createElement(J.a,null)):null),v.a.createElement(Ae.a,null),v.a.createElement(Ne.a,null,v.a.createElement(R.a,null,"Are you sure you want to return to the import form? This will lose your current view")),v.a.createElement(Le.a,null,v.a.createElement(N.a,{onClick:function(){t.clearView(),n()},variant:"contained",color:"primary",autoFocus:!0},"OK"),v.a.createElement(N.a,{onClick:function(){return n()},color:"secondary",variant:"contained"},"Cancel")))})),De=n(442),Be=n(287),Ve=n(660),ze=n(12),We=n(328);function Ue(e){var t=e.width,n=e.height,a=e.highResolutionScaling,o=e.style,i=e.imageData,c=e.blockKey,s=e.showSoftClip,u=Object(b.useRef)(null);Object(b.useEffect)((function(){if(i){var e=u.current;if(e){var t=e.getContext("2d");if(t)if(i.commands)i.commands.forEach((function(e){"strokeStyle"===e.type?t.strokeStyle=e.style:"fillStyle"===e.type?t.fillStyle=e.style:"font"===e.type?t.font=e.style:t[e.type].apply(t,Object(ze.a)(e.args))}));else if(i instanceof We.a)t.drawImage(i,0,0);else if(i.dataURL){var n=new Image;n.onload=function(){return t.drawImage(n,0,0)},n.src=i.dataURL}}}}),[i]);var l=c?"_"+c:"",d="prerendered_canvas".concat(s?"_softclipped":"").concat(l);return v.a.createElement("canvas",{"data-testid":d,ref:u,width:t*a,height:n*a,style:Object(r.a)({width:t,height:n},o)})}Ue.defaultProps={imageData:void 0,highResolutionScaling:1,style:{}};var qe=Ue,He=n(1673),_e=function(e){var t=e.onClose,n=e.open,r=e.onFactoryReset;function a(e){"reset"===e&&r(),t()}return v.a.createElement(Re.a,{open:n,onClose:function(){return a()}},v.a.createElement(Pe.a,{id:"alert-dialog-title"},"Reset"),v.a.createElement(Ne.a,null,v.a.createElement(He.a,{id:"alert-dialog-description"},"Are you sure you want to reset? This will restore the default configuration.")),v.a.createElement(Le.a,null,v.a.createElement(N.a,{onClick:function(){return a()},color:"primary"},"Cancel"),v.a.createElement(N.a,{onClick:function(){return a("reset")},color:"primary",variant:"contained"},"OK")))},Ge=Object(C.a)({hoverLabel:{border:"1px solid black",position:"absolute",background:"#fffa",pointerEvents:"none",zIndex:1e4}}),Je=Object(D.observer)((function(e){var t=e.offsetX,n=e.offsetY,r=e.configuration,a=e.feature,o=e.timeout,i=void 0===o?300:o,c=Ge(),s=Object(b.useState)(!1),u=Object(x.a)(s,2),l=u[0],d=u[1];if(Object(b.useEffect)((function(){var e=setTimeout((function(){return d(!0)}),i);return function(){return clearTimeout(e)}})),a&&l){var f=Object(V.readConfObject)(r,"mouseover",{feature:a});return v.a.createElement("div",{className:c.hoverLabel,style:{left:t,top:n}},f)}return null})),Xe=function(e){var t=e.onFactoryReset,n=e.resetButtonText,r=Object(b.useState)(!1),a=Object(x.a)(r,2),o=a[0],i=a[1];return v.a.createElement(v.a.Fragment,null,v.a.createElement(N.a,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:function(){return i(!0)}},n),v.a.createElement(_e,{onClose:function(){return i(!1)},open:o,onFactoryReset:t}))},Ye=function(e){var t=e.componentStack,n=e.error,r=e.onFactoryReset,a=e.resetButtonText;return v.a.createElement(Re.a,{open:!0},v.a.createElement(Pe.a,{style:{backgroundColor:"#e88"}},"Fatal error"),v.a.createElement(Ne.a,null,v.a.createElement("pre",null,n.toString(),t)),v.a.createElement(Le.a,null,v.a.createElement(N.a,{color:"secondary",variant:"contained",onClick:function(){return window.location.reload()}},"Refresh"),v.a.createElement(Xe,{onFactoryReset:r,resetButtonText:a})))};Ye.defaultProps={error:{message:"No error message provided"},componentStack:"",resetButtonText:"Factory Reset"};var Qe=Ye,Ke=n(435)},116:function(e,t,n){"use strict";n.r(t),n.d(t,"BaseAdapter",(function(){return w})),n.d(t,"BaseFeatureDataAdapter",(function(){return j})),n.d(t,"BaseSequenceAdapter",(function(){return k})),n.d(t,"isSequenceAdapter",(function(){return x})),n.d(t,"isRegionsAdapter",(function(){return C})),n.d(t,"isFeatureAdapter",(function(){return S})),n.d(t,"isRefNameAliasAdapter",(function(){return T})),n.d(t,"isTextSearchAdapter",(function(){return E}));var r=n(86),a=n(12),o=n(83),i=n(88),c=n(89),s=n(11),u=n(81),l=n(80),d=n.n(l),f=n(569),p=n(801),g=n(807),m=n(85),h=n(125),b=n(82),v=n(79),y=n(805),O=n(806),w=Object(s.a)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(v.ConfigurationSchema)("empty",{}).create(),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if(Object(u.a)(this,e),this.config=t,this.getSubAdapter=n,this.pluginManager=r,this.id=void 0,"undefined"===typeof jest){var a=Object(m.isStateTreeNode)(t)?Object(m.getSnapshot)(t):t;this.id="".concat(Object(O.a)(a))}else this.id="test"}));w.capabilities=[];var j=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getConf",value:function(e){return Object(v.readConfObject)(this.config,e)}},{key:"getHeader",value:function(){var e=Object(o.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=Object(o.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeaturesInRegion",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(h.ObservableCreate)(function(){var r=Object(o.a)(d.a.mark((function r(a){var o;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:o=r.sent,Object(b.checkAbortSignal)(n.signal),o?t.getFeatures(e,n).pipe(Object(p.a)(Object(b.observeAbortSignal)(n.signal))).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=f.a.apply(void 0,Object(a.a)(e.map((function(e){return Object(h.ObservableCreate)(function(){var r=Object(o.a)(d.a.mark((function r(a){var o;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:o=r.sent,Object(b.checkAbortSignal)(n.signal),o?t.getFeatures(e,n).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}))));return n.signal?r.pipe(Object(p.a)(Object(b.observeAbortSignal)(n.signal))):r}},{key:"hasDataForRefName",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var n,r,a=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:return r=e.sent,e.abrupt("return",r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegionStats",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getFeatures(t,n),e.abrupt("return",Object(y.c)(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMultiRegionStats",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t,n,r,a,o,i,c,s,u,l=this,f=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:[],n=f.length>1?f[1]:void 0,t.length){e.next=4;break}return e.abrupt("return",Object(y.a)());case 4:return e.next=6,Promise.all(t.map((function(e){return l.getRegionStats(e,n)})));case 6:return r=e.sent,a=r.map((function(e){return e.scoreMax})).reduce((function(e,t){return Math.max(e,t)})),o=r.map((function(e){return e.scoreMin})).reduce((function(e,t){return Math.min(e,t)})),i=r.reduce((function(e,t){return e+t.scoreSum}),0),c=r.reduce((function(e,t){return e+t.scoreSumSquares}),0),s=r.reduce((function(e,t){return e+t.featureCount}),0),u=r.reduce((function(e,t){return e+t.basesCovered}),0),e.abrupt("return",Object(y.b)({scoreMin:o,scoreMax:a,featureCount:s,basesCovered:u,scoreSumSquares:c,scoreSum:i}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"estimateRegionsStats",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n){var a,i,c,s,u=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}throw new Error("No regions to estimate stats for");case 2:return a=t[0],i=+Date.now(),c=function(){var e=Object(o.a)(d.a.mark((function e(t,o){var i,c,l,f,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.start,c=a.end,l=.75*i+.25*c,f=Object(r.a)(Object(r.a)({},a),{},{start:Math.max(0,Math.round(l-t/2)),end:Math.min(Math.round(l+t/2),c)}),e.next=5,u.getFeatures(f,n).pipe(Object(g.a)()).toPromise();case 5:return p=e.sent,e.abrupt("return",s(t,{featureDensity:p.length/t},p.length,o));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s=function(){var e=Object(o.a)(d.a.mark((function e(t,n,r,o){var s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.end-a.start,!(r>=70||2*t>s)){e.next=5;break}return e.abrupt("return",n);case 5:if(!(o<=5e3)){e.next=12;break}return u=+Date.now(),o+=u-i,i=u,e.abrupt("return",c(2*t,o));case 12:return console.warn("Stats estimation reached timeout, or didn't get enough features"),e.abrupt("return",{featureDensity:1/0});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),e.abrupt("return",c(1e3,0));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(w),k=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"estimateRegionsStats",value:function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{featureDensity:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(j);function x(e){return"getRegions"in e&&"getFeatures"in e}function C(e){return"getRegions"in e}function S(e){return"getFeatures"in e}function T(e){return"getRefNameAliases"in e}function E(e){return"searchIndex"in e}},117:function(e,t,n){"use strict";n.r(t),n.d(t,"baseConnectionConfig",(function(){return a})),n.d(t,"BaseConnectionModelFactory",(function(){return c})),n.d(t,"BaseViewModel",(function(){return s.a})),n.d(t,"BaseDisplay",(function(){return f})),n.d(t,"InternetAccount",(function(){return v})),n.d(t,"BaseInternetAccountConfig",(function(){return y})),n.d(t,"createBaseTrackModel",(function(){return x})),n.d(t,"createBaseTrackConfig",(function(){return C}));var r=n(79),a=Object(r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"}),o=n(12),i=n(85),c=function(e){return i.types.model("Connection",{name:i.types.identifier,tracks:i.types.array(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{afterAttach:function(){e.tracks.length||e.connect(e.configuration)},addTrackConf:function(t){var n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs:function(t){var n,r=(n=e.tracks).push.apply(n,Object(o.a)(t));return e.tracks.slice(r-1-t.length,r-1)},setTrackConfs:function(t){return e.tracks=t,e.tracks},clear:function(){}}}))},s=n(445),u=n(86),l=n(105),d=n(106),f=i.types.model("BaseDisplay",{id:d.ElementId,type:i.types.string,rpcDriverName:i.types.maybe(i.types.string)}).volatile((function(){return{rendererTypeName:"",error:void 0}})).views((function(e){return{get RenderingComponent(){return Object(i.getEnv)(e).pluginManager.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return Object(r.getConf)(this.parentTrack,"adapter")},get parentTrack(){for(var t=Object(i.getParent)(e);!t.configuration||!Object(r.getConf)(t,"trackId");){if(Object(i.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=Object(i.getParent)(t)}return t},renderProps:function(){return Object(u.a)(Object(u.a)({},Object(l.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e})},get rendererType(){var t=Object(i.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!t)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return t},get DisplayMessageComponent(){},trackMenuItems:function(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered:function(){}}})).actions((function(e){return{setError:function(t){e.error=t},setRpcDriverName:function(t){e.rpcDriverName=t},reload:function(){}}})),p=n(83),g=n(80),m=n.n(g),h=n(104),b="undefined"===typeof sessionStorage,v=i.types.model("InternetAccount",{id:d.ElementId,type:i.types.string}).views((function(e){return{get name(){return Object(r.getConf)(e,"name")},get description(){return Object(r.getConf)(e,"description")},get internetAccountId(){return Object(r.getConf)(e,"internetAccountId")},get authHeader(){return Object(r.getConf)(e,"authHeader")},get tokenType(){return Object(r.getConf)(e,"tokenType")},get domains(){return Object(r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}})).views((function(e){return{handlesLocation:function(t){return e.domains.some((function(e){return null===t||void 0===t?void 0:t.uri.includes(e)}))},get tokenKey(){return"".concat(e.internetAccountId,"-token")}}})).actions((function(e){return{getTokenFromUser:function(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken:function(t){sessionStorage.setItem(e.tokenKey,t)},removeToken:function(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:function(){return sessionStorage.getItem(e.tokenKey)},validateToken:function(e,t){return Object(p.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)})))()}}})).actions((function(e){var t=void 0;return{getToken:function(n){return Object(p.a)(m.a.mark((function r(){var a,o,i;return m.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return",t);case 2:if(!(i=null===n||void 0===n||null===(a=n.internetAccountPreAuthorization)||void 0===a||null===(o=a.authInfo)||void 0===o?void 0:o.token)){r.next=6;break}return t=Promise.resolve(i),r.abrupt("return",t);case 6:if(!b){r.next=8;break}throw new Error("Did not get internet account pre-authorization info in worker");case 8:if(!(i=e.retrieveToken())){r.next=12;break}return t=Promise.resolve(i),r.abrupt("return",t);case 12:return t=new Promise(function(){var t=Object(p.a)(m.a.mark((function t(n,r){var a,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=function(t){e.removeToken(),r(t)},a=function(t){e.storeToken(t),n(t)},e.getTokenFromUser(a,o);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),r.abrupt("return",t);case 14:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){return{addAuthHeaderToInit:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=e.tokenType?"".concat(e.tokenType," ").concat(n):n,a=new Headers(t.headers||{});return a.append(e.authHeader,r),Object(u.a)(Object(u.a)({},t),{},{headers:a})},getPreAuthorizationInformation:function(t){return Object(p.a)(m.a.mark((function n(){var a,o;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return a=n.sent,n.prev=3,n.next=6,e.validateToken(a,t);case 6:o=n.sent,n.next=13;break;case 9:throw n.prev=9,n.t0=n.catch(3),e.removeToken(),n.t0;case 13:return n.abrupt("return",{internetAccountType:e.type,authInfo:{token:o,configuration:Object(r.getConf)(e)}});case 14:case"end":return n.stop()}}),n,null,[[3,9]])})))()}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=Object(p.a)(m.a.mark((function n(r,a){var o,i;return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return o=n.sent,i=e.addAuthHeaderToInit(a,o),n.abrupt("return",fetch(r,i));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}}})).actions((function(e){return{openLocation:function(t){return new h.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})}}})),y=Object(r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0}),O=n(107),w=n(264),j=n(82),k=n(177);function x(e,t,n){return i.types.model(t,{id:d.ElementId,type:i.types.literal(t),configuration:Object(w.a)(n),displays:i.types.array(e.pluggableMstType("display","stateModel"))}).views((function(e){return{get rpcSessionId(){return e.configuration.trackId},get name(){return Object(r.getConf)(e,"name")},get textSearchAdapter(){return Object(r.getConf)(e,"textSearchAdapter")},get adapterType(){var t=Object(r.getConf)(e,"adapter"),n=Object(i.getEnv)(e).pluginManager;if(!t)throw new Error("no adapter configuration provided for ".concat(e.type));var a=n.getAdapterType(t.type);if(!a)throw new Error("unknown adapter type ".concat(t.type));return a},get viewMenuActions(){var t=[];return e.displays.forEach((function(e){t.push.apply(t,Object(o.a)(e.viewMenuActions))})),t},get canConfigure(){var t=Object(j.getSession)(e);return Object(k.j)(t)&&(t.adminMode||t.sessionTracks.find((function(t){return t.trackId===e.configuration.trackId})))}}})).actions((function(t){return{activateConfigurationUI:function(){var e=Object(j.getSession)(t),n=Object(j.getContainingView)(t);if(Object(k.j)(e)){var r=e.editTrackConfiguration(t.configuration);r&&r!==t.configuration&&(n.hideTrack(t.configuration),n.showTrack(r))}},showDisplay:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("display"),o=Object(i.resolveIdentifier)(a,Object(i.getRoot)(t),n),c=e.getDisplayType(o.type);if(!c)throw new Error("unknown display type ".concat(o.type));var s=c.stateModel.create(Object(u.a)(Object(u.a)({},r),{},{type:o.type,configuration:o}));t.displays.push(s)},hideDisplay:function(n){var r=e.pluggableConfigSchemaType("display"),a=Object(i.resolveIdentifier)(r,Object(i.getRoot)(t),n),o=t.displays.filter((function(e){return e.configuration===a}));return Object(O.transaction)((function(){return o.forEach((function(e){return t.displays.remove(e)}))})),o.length},replaceDisplay:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t.displays.findIndex((function(e){return e.configuration.displayId===n}));if(-1===o)throw new Error("could not find display id ".concat(n," to replace"));var c=e.pluggableConfigSchemaType("display"),s=Object(i.resolveIdentifier)(c,Object(i.getRoot)(t),r),l=e.getDisplayType(s.type);if(!l)throw new Error("unknown display type ".concat(s.type));t.displays.splice(o,1,Object(u.a)(Object(u.a)({},a),{},{type:s.type,configuration:s}))}}})).views((function(t){return{trackMenuItems:function(){var n=[];t.displays.forEach((function(e){n.push.apply(n,Object(o.a)(e.trackMenuItems()))}));var r=[],a=Object(j.getContainingView)(t),i=e.getViewType(a.type).displayTypes.map((function(e){return e.name})),c=t.configuration.displays.filter((function(e){return i.includes(e.type)})),s=t.displays[0].configuration.displayId;return c.length>1&&(r.push({type:"divider"},{type:"subHeader",label:"Display types"}),c.forEach((function(e){r.push({type:"radio",label:"".concat(e.type),onClick:function(){t.replaceDisplay(s,e.displayId)},checked:e.displayId===s})}))),[].concat(n,r)}}}))}function C(e){return Object(r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:Object(r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:i.types.array(e.pluggableConfigSchemaType("display"))},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,o=void 0===a?[]:a;"placeholderId"!==n.trackId&&(o.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||o.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return Object(u.a)(Object(u.a)({},n),{},{displays:o})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}},1184:function(e,t){},119:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=n(86),a=n(81),o=n(11);function i(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function c(e){return"uniqueId"in e&&"object"!==typeof e.data}var s=function(){function e(t){var n=this;Object(a.a)(this,e),this.data=void 0,this.subfeatures=void 0,this.parentHandle=void 0,this.uniqueId=void 0,c(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);var o,i=c(t)?t.uniqueId:t.id;if(void 0===i||null===i)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(i),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(o=this.data.subfeatures)||void 0===o?void 0:o.map((function(t,a){return"function"!==typeof t.get?new e({id:t.uniqueId||"".concat(i,"-").concat(a),data:Object(r.a)({strand:n.data.strand},t),parent:n}):t})))}return Object(o.a)(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=Object(r.a)(Object(r.a)({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e(Object(r.a)({},t))}}]),e}()},120:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(81),a=n(11),o=function(){function e(){Object(r.a)(this,e),this.name=void 0,this.url=void 0,this.version=void 0,this.configurationSchema=void 0}return Object(a.a)(e,[{key:"install",value:function(e){}},{key:"configure",value:function(e){}}]),e}()},125:function(e,t,n){"use strict";n.r(t),n.d(t,"ObservableCreate",(function(){return i}));var r=n(111),a=n(801),o=n(82);function i(e,t){return r.a.create((function(t){try{var n=e(t);n&&n.catch&&n.catch((function(e){return t.error(e)}))}catch(r){t.error(r)}})).pipe(Object(a.a)(Object(o.observeAbortSignal)(t)))}},127:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(83),a=n(11),o=n(81),i=n(88),c=n(89),s=n(80),u=n.n(s),l=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(e){var a;if(Object(o.a)(this,n),(a=t.call(this,e)).AdapterClass=void 0,a.getAdapterClass=void 0,a.configSchema=void 0,a.adapterCapabilities=void 0,a.adapterMetadata=void 0,"AdapterClass"in e)a.AdapterClass=e.AdapterClass,a.getAdapterClass=Object(r.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.AdapterClass);case 1:case"end":return t.stop()}}),t)})));else{if(!("getAdapterClass"in e))throw new Error("no AdapterClass or getAdapterClass is defined for adapter type ".concat(a.name));a.getAdapterClass=e.getAdapterClass}return a.configSchema=e.configSchema,a.adapterCapabilities=e.adapterCapabilities||[],a.adapterMetadata=e.adapterMetadata,a}return Object(a.a)(n)}(n(192).a)},1291:function(e,t){},1310:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return C})),n.d(t,"capabilities",(function(){return S}));var r=n(103),a=n(29),o=n(83),i=n(81),c=n(11),s=n(88),u=n(89),l=n(80),d=n.n(l),f=n(116),p=n(119),g=n(79),m=n(125),h=n(258),b=n(807),v=n(335),y=n(585),O=n(235);function w(e){return j(e.type)?1:e.length}function j(e){return"softclip"===e||"hardclip"===e||"insertion"===e}function k(e,t,n,r){e[n][r]||(e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),e[n][r].total++,e[n][r].strands[t]++}function x(e,t,n,r){e[n][r]||(e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),e[n][r].total--,e[n][r].strands[t]--}var C=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"configure",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t,n,r,a,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(g.readConfObject)(this.config,"subadapter"),a=Object(g.readConfObject)(this.config,["subadapter","sequenceAdapter"]),e.next=4,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 4:if(o=e.sent,!a){e.next=11;break}return e.next=8,null===(n=this.getSubAdapter)||void 0===n?void 0:n.call(this,a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=void 0;case 12:if(i=e.t0,o){e.next=15;break}throw new Error("Failed to get subadapter");case 15:return e.abrupt("return",{subadapter:o.dataAdapter,sequenceAdapter:null===i||void 0===i?void 0:i.dataAdapter});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(m.ObservableCreate)(function(){var r=Object(o.a)(d.a.mark((function r(o){var i,c,s,u,l,f,g;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.configure();case 2:return i=r.sent,c=i.subadapter,s=c.getFeatures(e,n),n.filters&&(u=n.filters,s=s.pipe(Object(h.a)((function(e){return u.passes(e,n)})))),r.next=8,t.generateCoverageBins(s,e,n);case 8:l=r.sent,f=l.bins,g=l.skipmap,f.forEach((function(n,r){o.next(new p.a({id:"".concat(t.id,"-").concat(e.start,"-").concat(r),data:{score:n.total,snpinfo:n,start:e.start+r,end:e.start+r+1,refName:e.refName}}))})),Object.entries(g).forEach((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];o.next(new p.a({id:n,data:{type:"skip",start:r.start,end:r.end,strand:r.strand,score:r.score,xs:r.xs}}))})),o.complete();case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"estimateRegionsStats",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n){var r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,a=r.subadapter,e.abrupt("return",a.estimateRegionsStats(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(o.a)(d.a.mark((function e(){var t,n,r,a=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.configure();case 3:return n=e.sent,r=n.subadapter,e.abrupt("return",r.getRefNames(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}},{key:"generateCoverageBins",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n,o){var i,c,s,u,l,f,p,g,m,h,C,S,T,E;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.colorBy,e.next=3,this.configure();case 3:if(c=e.sent,s=c.sequenceAdapter,u=n.originalRefName,l=n.refName,f=n.start,p=n.end,g=Math.ceil(n.end-n.start),m={},!s){e.next=15;break}return e.next=11,s.getFeatures({refName:u||l,start:f,end:p+1,assemblyName:n.assemblyName}).pipe(Object(b.a)()).toPromise();case 11:C=e.sent,S=Object(a.a)(C,1),T=S[0],h=null===T||void 0===T?void 0:T.get("seq");case 15:return e.next=17,t.pipe(Object(v.a)((function(e,t){for(var a=t.get("CIGAR"),o=t.get("start"),c=t.get("end"),s=t.get("strand"),u=Object(O.parseCigar)(a),l=o;l<c+1;l++){var d=l-n.start;if(d>=0&&d<g){var f=e[d]||{total:0,lowqual:{},cov:{},delskips:{},noncov:{},ref:{}};l!==c&&(f.total++,k(f,s,"ref","ref")),e[d]=f}}if("modifications"===(null===i||void 0===i?void 0:i.type)){var p=t.get("seq"),b=Object(y.b)(t,"MM","Mm")||"",v=Object(y.b)(t,"ML","Ml")||[],C=v?("string"===typeof v?v.split(",").map((function(e){return+e})):v).map((function(e){return e/255})):Object(y.b)(t,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),S=0;Object(O.getModificationPositions)(b,p,s).forEach((function(t){var a,i=t.type,l=t.positions,d="mod_".concat(i),f=Object(r.a)(Object(O.getNextRefPos)(u,l));try{for(f.s();!(a=f.n()).done;){var p=a.value,g=p+o-n.start;if(g>=0&&g<e.length&&p+o<c){var m=e[g]||{total:0,lowqual:{},cov:{},delskips:{},noncov:{},ref:{}};C[S]>.5?k(m,s,"cov",d):k(m,s,"lowqual",d)}S++}}catch(h){f.e(h)}finally{f.f()}}))}else if("methylation"===(null===i||void 0===i?void 0:i.type)){if(!h)throw new Error("no region sequence detected, need sequenceAdapter configuration");var T=t.get("seq"),E=Object(y.b)(t,"MM","Mm")||"",M=new Array(n.end-n.start).fill(0);Object(O.getModificationPositions)(E,T,s).forEach((function(e){var t=e.type,a=e.positions;if("m"===t){var i,c=Object(r.a)(Object(O.getNextRefPos)(u,a));try{for(c.s();!(i=c.n()).done;){var s=i.value+o-n.start;s>=0&&s<M.length&&(M[s]=1)}}catch(l){c.e(l)}finally{c.f()}}}));for(var R=o;R<c;R++){var P=R-n.start;if(P>=0&&P<e.length-1){var A=h[P].toLowerCase(),N=h[P+1].toLowerCase(),L=e[P],I=e[P+1];"c"===A&&"g"===N&&(M[P]||M[P+1]?(k(L,s,"cov","meth"),k(I,s,"cov","meth"),x(L,s,"ref","ref"),x(I,s,"ref","ref")):(k(L,s,"cov","unmeth"),k(I,s,"cov","unmeth"),x(L,s,"ref","ref"),x(I,s,"ref","ref")))}}}else{var F=t.get("mismatches");if(F){for(var D=0;D<F.length;D++)for(var B=F[D],V=o+B.start,z=V;z<V+w(B);z++){var W=z-n.start;if(W>=0&&W<e.length){var U=e[W],q=B.base,H=B.type,_=j(H);_?k(U,s,"noncov",H):x(U,s,"ref","ref"),"deletion"===H||"skip"===H?(k(U,s,"delskips",H),U.total--):_||k(U,s,"cov",q)}}F.filter((function(e){return"skip"===e.type})).forEach((function(e){var n=t.get("start")+e.start,r=n,a=n+e.length,o=t.get("strand"),i="".concat(r,"_").concat(a,"_").concat(o);m[i]?m[i].score++:m[i]={feature:t,start:r,end:a,strand:o,xs:Object(y.a)(t,"XS")||Object(y.a)(t,"TS"),score:1}}))}}return e}),[])).toPromise();case 17:return E=e.sent,e.abrupt("return",{bins:E,skipmap:m});case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(f.BaseFeatureDataAdapter),S=C.capabilities},1325:function(e,t,n){"use strict";n.r(t),n.d(t,"useStyles",(function(){return C})),n.d(t,"default",(function(){return S}));var r=n(1),a=n.n(r),o=n(85),i=n(82),c=n(51),s=n(1666),u=n(1669),l=n(1642),d=n(1658),f=n(1670),p=n(1638),g=n(1695),m=n(1630),h=n(1693),b=n(1696),v=n(1697),y=n(1655),O=n(1694),w=n(1635),j=n(1671),k=n(113),x=n.n(k),C=Object(c.a)((function(e){return{dialogContent:{width:"80em"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function S(e){var t,n,r=e.model,c=e.optAssemblyName,k=e.handleClose,S=C(),T=Object(i.getSession)(r),E=Object(o.getEnv)(T).pluginManager,M=T.assemblyManager,R=c;r.displayedRegions.length>0&&(R=null===(n=r.displayedRegions[0])||void 0===n?void 0:n.assemblyName);if(!R)throw new Error("Assembly name not found");var P=M.get(R);if(!P)throw new Error("assembly ".concat(R," not found"));if(!P.regions)throw new Error("assembly ".concat(R," regions not loaded"));var A=P.regions;function N(e){if(e){var t,n=E.pluggableConfigSchemaType("track"),a=Object(o.resolveIdentifier)(n,Object(o.getRoot)(r),e);if(a)return null===(t=a.name)||void 0===t?void 0:t.value}return""}return a.a.createElement(s.a,{open:!0,maxWidth:"xl",onClose:k},a.a.createElement(u.a,null,"Search results",k?a.a.createElement(l.a,{"data-testid":"close-resultsDialog",className:S.closeButton,onClick:function(){k()}},a.a.createElement(x.a,null)):null),a.a.createElement(d.a,null),a.a.createElement(f.a,null,null!==(t=r.searchResults)&&void 0!==t&&t.length?a.a.createElement(a.a.Fragment,null,a.a.createElement(p.a,null,"Showing results for ",a.a.createElement("b",null,r.searchQuery)),a.a.createElement(g.a,{component:m.a},a.a.createElement(h.a,null,a.a.createElement(b.a,null,a.a.createElement(v.a,null,a.a.createElement(y.a,null,"Name"),a.a.createElement(y.a,{align:"right"},"Location"),a.a.createElement(y.a,{align:"right"},"Track"),a.a.createElement(y.a,{align:"right"}))),a.a.createElement(O.a,null,r.searchResults.map((function(e){return a.a.createElement(v.a,{key:"".concat(e.getId())},a.a.createElement(y.a,{component:"th",scope:"row"},e.getLabel()),a.a.createElement(y.a,{align:"right"},e.getLocation()),a.a.createElement(y.a,{align:"right"},N(e.getTrackId())||"N/A"),a.a.createElement(y.a,{align:"right"},a.a.createElement(w.a,{onClick:function(){!function(e){try{var t=A.find((function(t){return e===t.refName}));t?(r.setDisplayedRegions([t]),r.showAllRegions()):r.navToLocString(e,R)}catch(n){console.warn(n),T.notify("".concat(n),"warning")}}(e.getLocation());var t=e.getTrackId();t&&r.showTrack(t),k()},disabled:!N(e.getTrackId()),color:"primary",variant:"contained"},"Go")))})))))):a.a.createElement(p.a,null,"No results found for ",a.a.createElement("b",null,r.searchQuery))),a.a.createElement(d.a,null),a.a.createElement(j.a,null,a.a.createElement(w.a,{onClick:function(){return k()},color:"primary"},"Cancel")))}},133:function(e,t,n){"use strict";n.d(t,"e",(function(){return ke})),n.d(t,"d",(function(){return j})),n.d(t,"f",(function(){return je})),n.d(t,"g",(function(){return we})),n.d(t,"b",(function(){return K})),n.d(t,"a",(function(){return ge})),n.d(t,"c",(function(){return be.f}));var r=n(83),a=n(81),o=n(11),i=n(88),c=n(89),s=n(80),u=n.n(s),l=n(1),d=n.n(l),f=n(107),p=n(79),g=n(117),m=n(182),h=n(149),b=n(205),v=n(120),y=n(82),O=n(1326),w=n.n(O),j=Object(p.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"}},{explicitIdentifier:"displayId"}),k=n(2),x=n(12),C=n(86),S=n(103),T=n(1638),E=n(1635),M=n(861),R=n(119),P=n(105),A=n(85),N=n(588),L=n.n(N),I=n(29),F=n(51),D=n(13),B=n(1628),V=n(140),z=n(108),W=n(84),U=n(1738),q=n(286),H=n(587),_=Object(F.a)({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),G=Object(W.observer)((function(e){var t=e.model,n=_(),r=t.blockDefinitions,a=t.blockState;return d.a.createElement(d.a.Fragment,null,r.map((function(e){if(e instanceof q.b){var r=a.get(e.key);return d.a.createElement(H.a,{block:e,key:"".concat(t.id,"-").concat(e.key)},r&&r.ReactComponent?d.a.createElement(r.ReactComponent,{model:r}):null,r&&r.maxHeightReached?d.a.createElement("div",{className:n.heightOverflowed,style:{top:r.layout.getTotalHeight()-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if(e instanceof q.c)return d.a.createElement(H.b,{key:"".concat(t.id,"-").concat(e.key),width:e.widthPx});if(e instanceof q.d)return d.a.createElement(H.c,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant});throw new Error("invalid block type ".concat(typeof e))})))}));var J=Object(W.observer)((function(e){var t=e.model,n=_(),r=t.blockDefinitions,a=Object(y.getContainingView)(t);return d.a.createElement("div",{"data-testid":"Blockset",className:n.linearBlocks,style:{left:r.offsetPx-a.offsetPx}},d.a.createElement(G,{model:t}))}));var X=Object(F.a)((function(e){return{display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"},tooltip:{pointerEvents:"none",backgroundColor:Object(D.a)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"}};var t})),Y=d.a.forwardRef((function(e,t){var n=e.message;return d.a.createElement("div",{ref:t},n)})),Q=Object(W.observer)((function(e){var t=e.model,n=e.clientMouseCoord,r=X(),a=t.featureUnderMouse,o=Object(l.useState)(0),i=Object(I.a)(o,2),c=i[0],s=i[1],u=Object(l.useState)(null),f=Object(I.a)(u,2),g=f[0],m=f[1],h=Object(l.useMemo)((function(){return{getBoundingClientRect:function(){var e=n[0]+c/2+20,t=n[1];return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[n,c]),b=Object(U.a)(h,g),v=b.styles,y=b.attributes,O=a?Object(p.getConf)(t,"mouseover",{feature:a}):void 0;return a&&O?d.a.createElement(B.a,null,d.a.createElement("div",Object.assign({ref:m,className:r.tooltip,style:Object(C.a)(Object(C.a)({},v.popper),{},{zIndex:1e5})},y.popper),d.a.createElement(Y,{ref:function(e){return s((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},message:O}))):null})),K=Object(W.observer)((function(e){var t=X(),n=Object(V.a)(),r=Object(l.useRef)(null),a=Object(l.useState)(),o=Object(I.a)(a,2),i=o[0],c=o[1],s=Object(l.useState)([0,0]),u=Object(I.a)(s,2),f=u[0],g=u[1],m=Object(l.useState)([0,0]),h=Object(I.a)(m,2),b=h[0],v=h[1],y=Object(l.useState)(),O=Object(I.a)(y,2),w=O[0],j=O[1],k=e.model,x=e.children,C=k.TooltipComponent,S=k.DisplayMessageComponent,T=k.contextMenuItems,E=k.height,M=k.setContextMenuFeature;return d.a.createElement("div",{ref:r,"data-testid":"display-".concat(Object(p.getConf)(k,"displayId")),className:t.display,onContextMenu:function(e){e.preventDefault(),w?j(void 0):r.current&&j([e.clientX,e.clientY])},onMouseMove:function(e){if(r.current){var t=r.current.getBoundingClientRect();g([e.clientX-t.left,e.clientY-t.top]),v([e.clientX,e.clientY]),c(t)}},role:"presentation"},S?d.a.createElement(S,{model:k}):d.a.createElement(J,e),x,d.a.createElement(C,{model:k,height:E,offsetMouseCoord:f,clientMouseCoord:b,clientRect:i,mouseCoord:f}),d.a.createElement(z.Menu,{open:Boolean(w)&&Boolean(T().length),onMenuItemClick:function(e,t){t(),j(void 0)},onClose:function(){j(void 0),M(void 0)},TransitionProps:{onExit:function(){j(void 0),M(void 0)}},anchorReference:"anchorPosition",anchorPosition:w?{top:w[1],left:w[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:T(),"data-testid":"base_linear_display_context_menu"}))})),$=n(106),Z=n(177),ee=n(1313),te=n.n(ee),ne=Object(F.a)((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},blockMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),pointerEvents:"none",textAlign:"center"},blockError:{padding:e.spacing(2),width:"100%",whiteSpace:"normal",color:e.palette.error.main,overflowY:"auto"},blockReactNodeMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}}));function re(e){var t=e.children;return d.a.createElement("div",{style:{display:"flex"}},t,t)}var ae=Object(W.observer)((function(e){var t=e.model,n=Object(l.useState)(!1),r=Object(I.a)(n,2),a=r[0],o=r[1],i=ne();Object(l.useEffect)((function(){var e=!1,t=setTimeout((function(){e||o(!0)}),300);return function(){clearTimeout(t),e=!0}}),[]);var c=t.status,s=Object(A.getParent)(t,2).message||c;return d.a.createElement(d.a.Fragment,null,a?d.a.createElement("div",{className:i.loading},d.a.createElement(T.a,{className:i.dots,variant:"body2"},s?"".concat(s):"Loading")):null)}));function oe(e){var t=e.messageContent,n=ne();return d.a.isValidElement(t)?d.a.createElement("div",{className:n.blockReactNodeMessage},t):d.a.createElement(T.a,{variant:"body2",className:n.blockMessage},t)}function ie(e){var t=e.error,n=e.reload,r=e.displayHeight,a=ne();return d.a.createElement("div",{className:a.blockError,style:{height:r}},n?d.a.createElement(E.a,{"data-testid":"reload_button",onClick:n,startIcon:d.a.createElement(te.a,null)},"Reload"):null,d.a.createElement(T.a,{color:"error",variant:"body2",display:"inline"},"".concat(t)))}var ce=Object(W.observer)((function(e){var t=e.model;return t.error?d.a.createElement(re,null,d.a.createElement(ie,{error:t.error,reload:t.reload,displayHeight:Object(P.getParentRenderProps)(t).displayModel.height})):t.message?d.a.createElement(re,null,d.a.createElement(oe,{messageContent:t.message})):t.filled?t.reactElement:d.a.createElement(re,null,d.a.createElement(ae,{model:t}))})),se=A.types.model("BlockState",{key:A.types.string,region:$.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:ce,renderProps:void 0}})).actions((function(e){var t;return{doReload:function(){e.reloadFlag=e.reloadFlag+1},afterAttach:function(){var t=Object(y.getContainingDisplay)(e);Object(y.makeAbortableReaction)(e,ue,le,{name:"".concat(t.id,"/").concat(Object(y.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(n){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered:function(n){if(n){var r=n.reactElement,a=n.features,o=n.layout,i=n.maxHeightReached,c=n.renderProps;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=o,e.error=void 0,e.maxHeightReached=i,e.renderProps=c,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0,Object(Z.g)(n)&&this.reload()},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=ce,e.renderProps=void 0,Object(A.getParent)(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var n=Object(y.getContainingDisplay)(e),r=Object(y.getSession)(e).rpcManager,a=n.rendererType,o=ue(Object(A.cast)(e)).renderArgs;o&&a.freeResourcesInClient(r,JSON.parse(JSON.stringify(o))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function ue(e,t){try{var n=t||Object(y.getContainingDisplay)(e),r=Object(y.getSession)(n),a=r.assemblyManager,o=r.rpcManager,i=n.adapterConfig,c=n.rendererType,s=n.error,u=n.parentTrack,l=Object(P.getTrackAssemblyNames)(u),d=e.region.assemblyName;if(!l.includes(d)&&!l.find((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.hasName(d)})))throw new Error("region assembly (".concat(d,") does not match track assemblies (").concat(l,")"));var f=n.renderProps(),g=f.config;Object(p.readConfObject)(g);var m=Object(P.getRpcSessionId)(n);return{rendererType:c,rpcManager:o,renderProps:f,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:s,renderArgs:{statusCallback:function(t){Object(A.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:i,rendererType:c.name,sessionId:m,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(h){return{displayError:h}}}function le(e,t,n){return de.apply(this,arguments)}function de(){return(de=Object(r.a)(u.a.mark((function e(t,n,r){var a,o,i,c,s,l,d,f,p,g,m,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(a=t).rendererType,i=a.renderProps,c=a.rpcManager,s=a.renderArgs,l=a.cannotBeRenderedReason,d=a.displayError,Object(A.isAlive)(r)){e.next=3;break}return e.abrupt("return",void 0);case 3:if(!d){e.next=6;break}return r.setError(d),e.abrupt("return",void 0);case 6:if(!l){e.next=9;break}return r.setMessage(l),e.abrupt("return",void 0);case 9:if(!i.notReady){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,o.renderInClient(c,Object(C.a)(Object(C.a)(Object(C.a)({},s),i),{},{signal:n}));case 13:return f=e.sent,p=f.reactElement,g=f.features,m=f.layout,h=f.maxHeightReached,e.abrupt("return",{reactElement:p,features:g,layout:m,maxHeightReached:h});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=["blockState"];function pe(e,t){var n="undefined"===typeof jest;return"clip-".concat(n?e:"jest","-").concat(t)}var ge=A.types.compose("BaseLinearDisplay",g.BaseDisplay,A.types.model({height:A.types.optional(A.types.refinement("displayHeight",A.types.number,(function(e){return e>=20})),100),blockState:A.types.map(se),userBpPerPxLimit:A.types.maybe(A.types.number),userByteSizeLimit:A.types.maybe(A.types.number)})).volatile((function(){return{currBpPerPx:0,message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,scrollTop:0,estimatedRegionStatsP:void 0,estimatedRegionStats:void 0}})).views((function(e){return{get blockType(){return"staticBlocks"},get blockDefinitions(){var t=this.blockType,n=Object(y.getContainingView)(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]}}})).views((function(e){return{get renderDelay(){return 50},get TooltipComponent(){return Q},get selectedFeatureId(){if(Object(A.isAlive)(e)){var t=Object(y.getSession)(e).selection;if(Object(R.b)(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){return{get features(){var t,n=[],r=Object(S.a)(e.blockState.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&a.features&&n.push(a.features)}}catch(o){r.e(o)}finally{r.f()}return new M.a(n)},get featureUnderMouse(){var t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:function(t,n,r){var a,o;return null===(a=e.blockState.get(t))||void 0===a||null===(o=a.layout)||void 0===o?void 0:o.getByCoord(n,r)},getFeatureByID:function(t,n){var r,a;return null===(r=e.blockState.get(t))||void 0===r||null===(a=r.layout)||void 0===a?void 0:a.getByID(n)},searchFeatureByID:function(t){var n;return e.blockState.forEach((function(e){var r,a=null===e||void 0===e||null===(r=e.layout)||void 0===r?void 0:r.getByID(t);a&&(n=a)})),n},get currentBytesRequested(){var t;return(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.bytes)||0},get currentFeatureScreenDensity(){var t,n=Object(y.getContainingView)(e);return((null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.featureDensity)||0)*n.bpPerPx},get maxFeatureScreenDensity(){return Object(p.getConf)(e,"maxFeatureScreenDensity")},get estimatedStatsReady(){return!!e.estimatedRegionStats},get maxAllowableBytes(){var t;return e.userByteSizeLimit||(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.fetchSizeLimit)||Object(p.getConf)(e,"fetchSizeLimit")}}})).actions((function(e){return{setMessage:function(t){e.message=t},afterAttach:function(){var t=this,n=Object(f.autorun)((function(){var n={};Object(y.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(r){n[r.key]=!0,e.blockState.has(r.key)||t.addBlock(r.key,r)})),e.blockState.forEach((function(e,r){n[r]||t.deleteBlock(r)})))}));Object(A.addDisposer)(e,n)},estimateRegionsStats:function(t,n){var r=this;if(e.estimatedRegionStatsP)return e.estimatedRegionStatsP;var a=Object(y.getSession)(e).rpcManager,o=e.adapterConfig,i=Object(P.getRpcSessionId)(e),c=Object(C.a)({sessionId:i,regions:t,adapterConfig:o,statusCallback:function(t){Object(A.isAlive)(e)&&r.setMessage(t)}},n);return e.estimatedRegionStatsP=a.call(i,"CoreEstimateRegionStats",c).catch((function(e){throw r.setRegionStatsP(void 0),e})),e.estimatedRegionStatsP},setRegionStatsP:function(t){e.estimatedRegionStatsP=t},setRegionStats:function(t){e.estimatedRegionStats=t},clearRegionStats:function(){e.estimatedRegionStatsP=void 0,e.estimatedRegionStats=void 0},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},setScrollTop:function(t){e.scrollTop=t},updateStatsLimit:function(t){var n=Object(y.getContainingView)(e);t.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},addBlock:function(t,n){e.blockState.set(t,se.create({key:t,region:n.toRegion()}))},setCurrBpPerPx:function(t){e.currBpPerPx=t},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var n=Object(y.getSession)(e);if(Object(y.isSessionModelWithWidgets)(n)){var r=n.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:Object(y.getContainingView)(e)});n.showWidget(r)}Object(y.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection:function(){Object(y.getSession)(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){Object(x.a)(e.blockState.values()).map((function(e){return e.doReload()}))},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{get regionTooLarge(){var t=Object(y.getContainingView)(e);if(!e.estimatedStatsReady||t.dynamicBlocks.totalBp<2e4)return!1;var n=e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity;return e.currentBytesRequested>e.maxAllowableBytes||n},get regionTooLargeReason(){var t,n=e.currentBytesRequested,r=e.maxAllowableBytes;return n&&n>r?"Requested too much data (".concat((t=n,Math.floor(t/1e6)>0?"".concat(parseFloat((t/1e6).toPrecision(3))," Mb"):Math.floor(t/1e3)>0?"".concat(parseFloat((t/1e3).toPrecision(3))," Kb"):"".concat(Math.floor(t)," bytes")),")"):""}}})).actions((function(e){var t=e.reload;return{reload:function(){return Object(r.a)(u.a.mark((function n(){var r,a,o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.setError(),r=new AbortController,(a=Object(y.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){n.next=5;break}return n.abrupt("return");case 5:return n.prev=5,e.estimatedRegionStatsP=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),n.next=9,e.estimatedRegionStatsP;case 9:if(o=n.sent,!Object(A.isAlive)(e)){n.next=15;break}e.setRegionStats(o),t(),n.next=16;break;case 15:return n.abrupt("return");case 16:n.next=21;break;case 18:n.prev=18,n.t0=n.catch(5),e.setError(n.t0);case 21:case"end":return n.stop()}}),n,null,[[5,18]])})))()},afterAttach:function(){Object(A.addDisposer)(e,Object(f.autorun)(Object(r.a)(u.a.mark((function t(){var n,r,a,o,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=new AbortController,(a=Object(y.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){t.next=5;break}return t.abrupt("return");case 5:if(void 0===(null===(n=e.estimatedRegionStats)||void 0===n?void 0:n.featureDensity)){t.next=8;break}return e.setCurrBpPerPx(a.bpPerPx),t.abrupt("return");case 8:if(a.bpPerPx!==e.currBpPerPx){t.next=10;break}return t.abrupt("return");case 10:return e.clearRegionStats(),e.setCurrBpPerPx(a.bpPerPx),o=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),e.setRegionStatsP(o),t.next=16,o;case 16:i=t.sent,Object(A.isAlive)(e)&&e.setRegionStats(i),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),!Object(y.isAbortException)(t.t0)&&Object(A.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 23:case"end":return t.stop()}}),t,null,[[0,20]])}))),{delay:500}))}}})).views((function(e){return{regionCannotBeRenderedText:function(t){return e.regionTooLarge?"Force load to see features":""},regionCannotBeRendered:function(t){var n=e.regionTooLarge,r=e.regionTooLargeReason;if(n)return d.a.createElement(d.a.Fragment,null,d.a.createElement(T.a,{component:"span",variant:"body2"},r?r+". ":"","Zoom in to see features or"," "),d.a.createElement(E.a,{"data-testid":"force_reload_button",onClick:function(){e.estimatedRegionStats?(e.updateStatsLimit(e.estimatedRegionStats),e.reload()):console.error("No global stats?")},variant:"outlined"},"Force Load"),d.a.createElement(T.a,{component:"span",variant:"body2"},"(force load may be slow)"))},trackMenuItems:function(){return[]},contextMenuItems:function(){return e.contextMenuFeature?[{label:"Open feature details",icon:L.a,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]},renderProps:function(){var t=Object(y.getContainingView)(e);return Object(C.a)(Object(C.a)({},Object(P.getParentRenderProps)(e)),{},{notReady:e.currBpPerPx!==t.bpPerPx||!e.estimatedRegionStats,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick:function(t,n){var r=n||e.featureIdUnderMouse;if(r){var a=e.features.get(r);a&&e.selectFeature(a)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){var r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove:function(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}}})).actions((function(e){return{renderSvg:function(t){return Object(r.a)(u.a.mark((function n(){var r,a,o,i,c,s,l,f;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height,a=e.id,o=t.overrideHeight,i=Object(y.getContainingView)(e),c=i.offsetPx,s=i.roundedDynamicBlocks,l=i.width,n.next=6,Promise.all(s.map((function(n){var r=se.create({key:n.key,region:n}),a=e.regionCannotBeRenderedText(n)||e.regionCannotBeRendered(n);if(a)return{reactElement:d.a.createElement(d.a.Fragment,null,d.a.createElement("rect",{x:0,y:0,width:l,height:20,fill:"#aaa"}),d.a.createElement("text",{x:0,y:15},a))};var o=ue(r,e),i=o.rpcManager,c=o.renderArgs,s=o.renderProps;return o.rendererType.renderInClient(i,Object(C.a)(Object(C.a)(Object(C.a)({},c),s),{},{exportSVG:t}))})));case 6:return f=n.sent,n.abrupt("return",d.a.createElement(d.a.Fragment,null,f.map((function(e,t){var n=s[t].offsetPx-c,i=pe(a,t);return d.a.createElement(d.a.Fragment,{key:"frag-".concat(t)},d.a.createElement("defs",null,d.a.createElement("clipPath",{id:i},d.a.createElement("rect",{x:0,y:0,width:l,height:o||r}))),d.a.createElement("g",{transform:"translate(".concat(n," 0)")},d.a.createElement("g",{clipPath:"url(#".concat(i,")")},d.a.isValidElement(e.reactElement)?e.reactElement:d.a.createElement("g",{dangerouslySetInnerHTML:{__html:e.html}}))))}))));case 8:case"end":return n.stop()}}),n)})))()}}})).postProcessSnapshot((function(e){e.blockState;return Object(k.a)(e,fe)}));var me=n(264);function he(e){return A.types.compose("LinearBareDisplay",ge,A.types.model({type:A.types.literal("LinearBareDisplay"),configuration:Object(me.a)(e)})).views((function(e){var t=e.renderProps;return{renderProps:function(){return Object(C.a)(Object(C.a)(Object(C.a)({},t()),Object(P.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var be=n(197),ve=n(591),ye=n.n(ve),Oe=Object(l.lazy)((function(){return n.e(72).then(n.bind(null,1706))})),we=function(e){return A.types.compose("LinearBasicDisplay",ge,A.types.model({type:A.types.literal("LinearBasicDisplay"),trackShowLabels:A.types.maybe(A.types.boolean),trackShowDescriptions:A.types.maybe(A.types.boolean),trackDisplayMode:A.types.maybe(A.types.string),trackMaxHeight:A.types.maybe(A.types.number),configuration:Object(p.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return Object(p.getConf)(e,["renderer","type"])},get showLabels(){var t=Object(p.getConf)(e,["renderer","showLabels"]);return void 0!==e.trackShowLabels?e.trackShowLabels:t},get showDescriptions(){var t=Object(p.getConf)(e,["renderer","showLabels"]);return void 0!==e.trackShowDescriptions?e.trackShowDescriptions:t},get maxHeight(){var t=Object(p.getConf)(e,["renderer","maxHeight"]);return void 0!==e.trackMaxHeight?e.trackMaxHeight:t},get displayMode(){var t=Object(p.getConf)(e,["renderer","displayMode"]);return void 0!==e.trackDisplayMode?e.trackDisplayMode:t},get rendererConfig(){var t=Object(p.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create(Object(C.a)(Object(C.a)({},t),{},{showLabels:this.showLabels,showDescriptions:this.showDescriptions,displayMode:this.displayMode,maxHeight:this.maxHeight}),Object(A.getEnv)(e))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions:function(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{renderProps:function(){var t=e.rendererConfig;return Object(C.a)(Object(C.a)({},n()),{},{config:t})},trackMenuItems:function(){return[].concat(Object(x.a)(t()),[{label:"Show labels",icon:ye.a,type:"checkbox",checked:e.showLabels,onClick:function(){e.toggleShowLabels()}},{label:"Show descriptions",icon:ye.a,type:"checkbox",checked:e.showDescriptions,onClick:function(){e.toggleShowDescriptions()}},{label:"Display mode",icon:ye.a,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){Object(y.getSession)(e).queueDialog((function(t){return[Oe,{model:e,handleClose:t}]}))}}])}}}))};function je(e){return Object(p.ConfigurationSchema)("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:j,explicitlyTyped:!0})}var ke=function(e){Object(i.a)(s,e);var t=Object(c.a)(s);function s(){var e;Object(a.a)(this,s);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:K,BaseLinearDisplay:ge,baseLinearDisplayConfigSchema:j},e}return Object(o.a)(s,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(p.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:Object(g.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new m.a({name:"FeatureTrack",configSchema:t,stateModel:Object(g.createBaseTrackModel)(e,"FeatureTrack",t)})})),e.addTrackType((function(){var t=Object(p.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:Object(g.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new m.a({name:"BasicTrack",configSchema:t,stateModel:Object(g.createBaseTrackModel)(e,"BasicTrack",t)})})),e.addDisplayType((function(){var t=function(e){return Object(p.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:j,explicitlyTyped:!0})}(e);return new h.a({name:"LinearBareDisplay",configSchema:t,stateModel:he(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:K})})),e.addDisplayType((function(){var t=je(e);return new h.a({name:"LinearBasicDisplay",configSchema:t,stateModel:we(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:K})})),e.addViewType((function(){return new b.a({name:"LinearGenomeView",stateModel:Object(be.h)(e),ReactComponent:Object(l.lazy)((function(){return Promise.resolve().then(n.bind(null,951))}))})})),e.addToExtensionPoint("LaunchView-LinearGenomeView",function(){var e=Object(r.a)(u.a.mark((function e(t){var n,r,a,o,i,c,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,a=t.loc,o=t.tracks,i=void 0===o?[]:o,c=n.assemblyManager,s=n.addView("LinearGenomeView",{}),e.next=5,Object(f.when)((function(){return!!s.volatileWidth}));case 5:if(r){e.next=7;break}throw new Error("No assembly provided when launching linear genome view");case 7:return e.next=9,c.waitForAssembly(r);case 9:if(e.sent){e.next=12;break}throw new Error('Assembly "'.concat(r,'" not found when launching linear genome view'));case 12:if(s.navToLocString(a,r),l=[],i.forEach((function(e){try{s.showTrack(e)}catch(t){if(!"".concat(t).match("Could not resolve identifier"))throw t;l.push(e)}})),!l.length){e.next=17;break}throw new Error("Could not resolve identifiers: ".concat(l.join(",")));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"configure",value:function(e){Object(y.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:w.a,onClick:function(e){e.addView("LinearGenomeView",{})}})}}]),s}(v.a)},1352:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var r=n(83),a=n(81),o=n(11),i=n(80),c=n.n(i),s=n(599),u=n.n(s),l=function(){function t(e){Object(a.a)(this,t),this.url=void 0,this.url=/\/$/.test(e.url)?e.url:"".concat(e.url,"/")}return Object(o.a)(t,[{key:"readMeta",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t,n,r,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadFile("meta.json");case 2:return t=e.sent,n=t.compress,r=t.track_names,a=Math.ceil(t.hash_bits/4),e.abrupt("return",{hashHexCharacters:a,compress:n,tracks:r});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHashHexCharacters",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.hashHexCharacters);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCompress",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.compress);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrackNames",value:function(){var e=Object(r.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.tracks);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(r.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBucket(t);case 2:return n=e.sent,e.abrupt("return",n[t]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBucket",value:function(){var e=Object(r.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.hash(t),e.next=3,this.hexToDirPath(n);case 3:return r=e.sent,e.abrupt("return",this.loadFile(r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFile",value:function(){var e=Object(r.a)(c.a.mark((function e(t){var n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.url).concat(t));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("HTTP ".concat(n.status," ").concat(n.statusText));case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hexToDirPath",value:function(){var e=Object(r.a)(c.a.mark((function e(t){var n,r,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHashHexCharacters();case 2:if(!(n=e.sent)){e.next=12;break}return e.next=6,this.getCompress();case 6:for(r=e.sent;t.length<8;)t="0".concat(t);for(t=t.substr(8-n),a=[],o=0;o<t.length;o+=3)a.push(t.substring(o,o+3));return e.abrupt("return","".concat(a.join("/"),".json").concat(r?"z":""));case 12:return e.abrupt("return","");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hash",value:function(t){return u()(e.from(t)).toString("hex").toLowerCase().replace("-","n")}}]),t}()}).call(this,n(99).Buffer)},1387:function(e,t,n){e.exports=function(){return new Worker(n.p+"d64d45679b22086d4b5e.worker.js")}},1392:function(e){e.exports=JSON.parse('{"a":"1.6.5"}')},1393:function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return b})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return O}));var r=n(29),a=n(83),o=n(81),i=n(11),c=n(80),s=n.n(c),u=n(1394),l=n.n(u),d=n(1395),f=n.n(d),p=n(79),g=n(953),m=n(82);Object(p.ConfigurationSchema)("PluginSource",{name:{type:"string",defaultValue:""},url:{type:"string",defaultValue:""}});function h(e){return(void 0!==e.umdUrl||void 0!==e.url)&&void 0!==e.name}function b(e){return void 0!==e.esmUrl}function v(e){return void 0!==e.cjsUrl}function y(){return"object"===typeof self&&self.self===self&&self||"object"===typeof e&&e.global===e&&e||this}var O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(o.a)(this,e),this.definitions=[],this.definitions=JSON.parse(JSON.stringify(t))}return Object(i.a)(e,[{key:"loadScript",value:function(e){var t=y();if(!function(e){return Boolean("WorkerGlobalScope"in e)}(t))return l()(e);if(t&&t.importScripts)return new Promise((function(n,r){try{t.importScripts(e)}catch(a){return void r(a||new Error("failed to load ".concat(e)))}n()}));throw new Error("cannot figure out how to load external JS scripts in this environment")}},{key:"loadCJSPlugin",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var r,a,o,i,c,u,l,d,p,g,m,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=new URL(t.cjsUrl,y().location.href),e.next=8;break;case 4:throw e.prev=4,e.t0=e.catch(0),console.error(e.t0),new Error("Error parsing URL: ".concat(t.cjsUrl));case 8:if("http:"===r.protocol||"https:"===r.protocol){e.next=10;break}throw new Error('cannot load plugins using protocol "'.concat(r.protocol,'"'));case 10:return a=n(594),o=n(458),i=n(1399),c=n(1400),u=a.promises,e.next=17,u.realpath(i.tmpdir());case 17:return l=e.sent,e.next=20,u.mkdtemp(o.join(l,"jbrowse-plugin-"));case 20:return d=e.sent,p=void 0,e.prev=22,g=o.join(d,f()(r.href)),m=o.relative(".",g),h=new Promise((function(e,t){var n=a.createWriteStream(g);c.get(r.href,(function(t){t.pipe(n),n.on("finish",(function(){e()}))})).on("error",(function(e){a.unlinkSync(g),t(e)}))})),e.next=28,h;case 28:p=require(m);case 29:return e.prev=29,u.rmdir(d,{recursive:!0}),e.finish(29);case 32:if(p){e.next=34;break}throw new Error("Could not load CJS plugin: ".concat(r));case 34:return e.abrupt("return",p);case 35:case"end":return e.stop()}}),e,null,[[0,4],[22,,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadESMPlugin",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=new URL(t.esmUrl,y().location.href),e.next=8;break;case 4:throw e.prev=4,e.t0=e.catch(0),console.error(e.t0),new Error("Error parsing URL: ".concat(t.esmUrl));case 8:if("http:"===n.protocol||"https:"===n.protocol){e.next=10;break}throw new Error('cannot load plugins using protocol "'.concat(n.protocol,'"'));case 10:return e.next=12,import(n.href);case 12:if(r=e.sent){e.next=15;break}throw new Error("Could not load ESM plugin: ".concat(n));case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadUMDPlugin",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var n,r,a,o,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="url"in t?t.url:t.umdUrl,e.prev=1,r=new URL(n,y().location.href),e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(1),console.error(e.t0),new Error("Error parsing URL: ".concat(n));case 9:if("http:"===r.protocol||"https:"===r.protocol){e.next=11;break}throw new Error('cannot load plugins using protocol "'.concat(r.protocol,'"'));case 11:return e.next=13,this.loadScript(r.href);case 13:if(a=t.name,o="JBrowsePlugin".concat(a),i=y(),c=i[o]){e.next=19;break}throw new Error("Failed to load UMD bundle for ".concat(a,", ").concat(i.constructor.name,".").concat(o," is undefined"));case 19:return e.abrupt("return",c);case 20:case"end":return e.stop()}}),e,this,[[1,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadPlugin",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m.isElectron||!v(t)){e.next=6;break}return e.next=3,this.loadCJSPlugin(t);case 3:case 9:case 15:n=e.sent,e.next=23;break;case 6:if(!b(t)){e.next=12;break}return e.next=9,this.loadESMPlugin(t);case 12:if(!h(t)){e.next=18;break}return e.next=15,this.loadUMDPlugin(t);case 18:if(m.isElectron||!v(t)){e.next=22;break}throw new Error("Only CommonJS plugin found, but not in a NodeJS environment: ".concat(JSON.stringify(t)));case 22:throw new Error("Could not determine plugin type: ".concat(JSON.stringify(t)));case 23:return e.abrupt("return",n.default);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"installGlobalReExports",value:function(e){e.JBrowseExports=Object.fromEntries(Object.entries(g.a).map((function(e){var t=Object(r.a)(e,2);return[t[0],t[1]]})))}},{key:"load",value:function(){var e=Object(a.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(this.definitions.map(function(){var e=Object(a.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadPlugin(n);case 2:return e.t0=e.sent,e.t1=n,e.abrupt("return",{plugin:e.t0,definition:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}()}).call(this,n(123))},1402:function(e,t){},1404:function(e,t){},149:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(11),a=n(81),o=n(88),i=n(89),c=n(192),s=n(204),u=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.ReactComponent=void 0,r.trackType=void 0,r.viewType=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.ReactComponent=e.ReactComponent,r.trackType=e.trackType,r.viewType=e.viewType,!r.stateModel)throw new Error("no stateModel defined for display ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for display ".concat(r.name));if(!r.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(r.name));if(!r.trackType)throw new Error("no trackType provided for display ".concat(r.name));if(!r.viewType)throw new Error("no viewType provided for display ".concat(r.name));if(!Object(s.getDefaultValue)(r.configSchema).type){var o=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(o," is not explicitlyTyped"))}return r}return Object(r.a)(n)}(c.a)},172:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(11),a=n(81),o=n(88),i=n(89),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).heading=void 0,r.configSchema=void 0,r.HeadingComponent=void 0,r.ReactComponent=void 0,r.stateModel=void 0,r.heading=e.heading,r.HeadingComponent=e.HeadingComponent,r.configSchema=e.configSchema,r.stateModel=e.stateModel,r.ReactComponent=e.ReactComponent,!r.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for widget ".concat(r.name));return r}return Object(r.a)(n)}(n(192).a)},177:function(e,t,n){"use strict";n.d(t,"q",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return f})),n.d(t,"l",(function(){return p})),n.d(t,"k",(function(){return g})),n.d(t,"m",(function(){return m})),n.d(t,"h",(function(){return h})),n.d(t,"r",(function(){return b})),n.d(t,"n",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"o",(function(){return O})),n.d(t,"d",(function(){return w})),n.d(t,"c",(function(){return j})),n.d(t,"p",(function(){return k})),n.d(t,"a",(function(){return x})),n.d(t,"b",(function(){return C})),n.d(t,"e",(function(){return S})),n.d(t,"g",(function(){return T}));var r=n(11),a=n(81),o=n(27),i=n(88),c=n(89),s=n(661),u=n(85);function l(e){return Object(u.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function d(e){return"object"===typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function f(e){return d(e)&&"editConfiguration"in e}function p(e){return d(e)&&"addTrackConf"in e}function g(e){return d(e)&&"widgets"in e}function m(e){return d(e)&&"sessionPlugins"in e}function h(e){return"object"===typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function b(e){return"object"===typeof e&&null!==e&&"width"in e&&"setWidth"in e}function v(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function y(e){return"object"===typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function O(e){return"object"===typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function w(e){return"object"===typeof e&&null!==e&&"isAssemblyEditing"in e&&"findAppropriateInternetAccount"in e}function j(e){return"object"===typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function k(e){return"object"===typeof e&&null!==e&&"locationType"in e&&"uri"in e}var x=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(e,r){var i;return Object(a.a)(this,n),(i=t.call(this,e)).message=e,i.url=r,i.name="AuthNeededError",Object.setPrototypeOf(Object(o.a)(i),n.prototype),i}return Object(r.a)(n)}(Object(s.a)(Error)),C=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(e,r){var o;return Object(a.a)(this,n),(o=t.call(this,e)).message=e,o.internetAccountId=r,o.name="RetryError",o}return Object(r.a)(n)}(Object(s.a)(Error));function S(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function T(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},182:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(81),a=n(11),o=n(88),i=n(89),c=n(192),s=n(204),u=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.displayTypes=[],a.stateModel=e.stateModel,a.configSchema=e.configSchema,!a.stateModel)throw new Error("no stateModel defined for track ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema provided for track ".concat(a.name));if(!Object(s.getDefaultValue)(a.configSchema).type){var o=a.configSchema?a.configSchema.name:"UNKNOWN";throw new Error("".concat(o," is not explicitlyTyped"))}return a}return Object(a.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(c.a)},184:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return s}));var r=n(1624),a=n(1),o=n.n(a);function i(e){return o.a.createElement(r.a,e,o.a.createElement("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}))}function c(e){return o.a.createElement(r.a,e,o.a.createElement("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"}))}function s(e){return o.a.createElement(r.a,e,o.a.createElement("path",{d:"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z"}))}},192:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(11),a=n(81),o=Object(r.a)((function e(t){Object(a.a)(this,e),this.name="",this.name=t.name}))},197:function(e,t,n){"use strict";n.d(t,"a",(function(){return we})),n.d(t,"b",(function(){return je})),n.d(t,"d",(function(){return ke})),n.d(t,"c",(function(){return xe})),n.d(t,"g",(function(){return Ce})),n.d(t,"e",(function(){return Se})),n.d(t,"h",(function(){return Ee})),n.d(t,"f",(function(){return ae.a}));var r=n(83),a=n(103),o=n(29),i=n(12),c=n(86),s=n(80),u=n.n(s),l=n(79),d=n(117),f=n(106),p=n(82),g=n(577),m=n(819),h=n(105),b=n(107),v=n(85),y=n(285),O=n(452),w=n.n(O),j=n(453),k=n(184),x=n(1316),C=n.n(x),S=n(591),T=n.n(S),E=n(1317),M=n.n(E),R=n(289),P=n.n(R),A=n(1315),N=n.n(A),L=n(346),I=n.n(L),F=n(588),D=n.n(F),B=n(1),V=n.n(B),z=n(820),W=n(51),U=n(84),q=n(454);function H(e){return e<999?String(e):"".concat(H(~~(e/1e3)),",").concat("00".concat(~~(e%1e3)).substr(-3,3))}var _=Object(W.a)((function(){return{majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}}));function G(e){var t=e.start,n=e.end,r=e.bpPerPx,a=e.reversed,o=e.major,i=e.minor,c=_(),s=Object(q.b)(t,n,r,o,i);return V.a.createElement(V.a.Fragment,null,s.map((function(e){var o=(a?n-e.base:e.base-t)/r;return V.a.createElement("line",{key:e.base,x1:o,x2:o,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?c.majorTick:c.minorTick,"data-bp":e.base})})),s.filter((function(e){return"major"===e.type})).map((function(e){var o=(a?n-e.base:e.base-t)/r;return V.a.createElement("text",{x:o-3,y:18,key:"label-".concat(e.base),style:{fontSize:"11px"},className:c.majorTickLabel},H(e.base+1))})))}G.defaultProps={reversed:!1,major:!0,minor:!0};var J=Object(U.observer)(G),X=n(960);function Y(e){var t=e.model,n=e.fontSize,r=t.offsetPx,a=t.dynamicBlocks,o=a.totalWidthPxWithoutBorders,i=a.totalBp,c=Object(p.getBpDisplayStr)(i),s=Math.max(-r,0),u=s+o;return V.a.createElement(V.a.Fragment,null,V.a.createElement("line",{x1:s,x2:u,y1:10,y2:10,stroke:"black"}),V.a.createElement("line",{x1:s,x2:s,y1:5,y2:15,stroke:"black"}),V.a.createElement("line",{x1:u,x2:u,y1:5,y2:15,stroke:"black"}),V.a.createElement("text",{x:s+(u-s)/2,y:2*n,textAnchor:"middle",fontSize:n},c))}function Q(e){var t=e.model,n=e.fontSize,r=e.width,a=t.dynamicBlocks.contentBlocks,o=t.offsetPx,i=t.bpPerPx,c=a.length<5;return V.a.createElement(V.a.Fragment,null,V.a.createElement("defs",null,V.a.createElement("clipPath",{id:"clip-ruler"},V.a.createElement("rect",{x:0,y:0,width:r,height:20}))),a.map((function(e){var t=e.key,r=e.start,a=e.end,s=e.reversed,u=e.offsetPx,l=e.refName,d=u-o;return V.a.createElement("g",{key:"".concat(t),transform:"translate(".concat(d," 0)")},V.a.createElement("text",{x:d/i,y:n,fontSize:n},l),c?V.a.createElement("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)"},V.a.createElement(J,{start:r,end:a,bpPerPx:i,reversed:s})):V.a.createElement("line",{strokeWidth:1,stroke:"black",x1:r/i,x2:a/i,y1:20,y2:20}))})))}var K=15,$=function(e){return e.reduce((function(e,t){return e+t.displays[0].height+20+20}),0)},Z=function(e){var t=e.model,n=t.width,r=t.assemblyNames,a=t.showCytobands,o=t.displayedRegions,i=Object(p.getSession)(t).assemblyManager,s=r.length>1?"":r[0],u=i.get(s),l=y.a.create({displayedRegions:JSON.parse(JSON.stringify(o)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),d=t.dynamicBlocks.contentBlocks;l.setVolatileWidth(n),l.showAllRegions();var f=l.dynamicBlocks.contentBlocks[0],g=d[0],m=l.bpToPx(Object(c.a)(Object(c.a)({},g),{},{coord:g.reversed?g.end:g.start}))||0,h=d[d.length-1],b=l.bpToPx(Object(c.a)(Object(c.a)({},h),{},{coord:h.reversed?h.start:h.end}))||0,v=a?100:0;return V.a.createElement("g",{id:"header"},V.a.createElement("text",{x:0,y:K,fontSize:K},s),a?V.a.createElement("g",{transform:"translate(0 ".concat(50,")")},V.a.createElement(X.a,{overview:l,assembly:u,block:f}),V.a.createElement("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(b-m,.5),height:je-1,x:m,y:.5}),V.a.createElement("g",{transform:"translate(0,".concat(je,")")},V.a.createElement(X.b,{overview:l,model:t,useOffset:!1}))):null,V.a.createElement("g",{transform:"translate(0 ".concat(K+v,")")},V.a.createElement(Y,{model:t,fontSize:K})),V.a.createElement("g",{transform:"translate(0 ".concat(50+v,")")},V.a.createElement(Q,{model:t,fontSize:K,width:n})))},ee=function(e){var t=e.model,n=e.height,r=t.dynamicBlocks,a=t.offsetPx,o=t.interRegionPaddingWidth;return V.a.createElement(V.a.Fragment,null,r.contentBlocks.slice(1).map((function(e){return V.a.createElement("rect",{key:e.key,x:e.offsetPx-a-o,width:o,y:0,height:n,stroke:"none",fill:"grey"})})))};function te(e){var t=e.displayResults,n=e.model,r=e.offset;return V.a.createElement(V.a.Fragment,null,t.map((function(e){var t=e.track,a=e.result,o=r,i=Object(l.getConf)(t,"name")||"Reference sequence (".concat(Object(l.readConfObject)(Object(v.getParent)(t.configuration),"name"),")"),c=t.displays[0];return r+=c.height+20+20,V.a.createElement("g",{key:t.configuration.trackId,transform:"translate(0 ".concat(o,")")},V.a.createElement("text",{fontSize:K,x:Math.max(-n.offsetPx,0)},i),V.a.createElement("g",{transform:"translate(0 ".concat(20,")")},a,V.a.createElement(ee,{model:n,height:c.height})))})))}function ne(e,t){return re.apply(this,arguments)}function re(){return re=Object(r.a)(u.a.mark((function e(t,n){var a,o,i,c,s,l,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.when)((function(){return t.initialized}));case 2:return a=t.width,o=t.tracks,i=t.showCytobands,c=50,s=90+(i?100:0)+20,l=$(o)+s,e.next=8,Promise.all(o.map(function(){var e=Object(r.a)(u.a.mark((function e(t){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.displays[0],e.next=3,Object(b.when)((function(){return void 0===r.ready||r.ready}));case 3:return e.next=5,r.renderSvg(n);case 5:return a=e.sent,e.abrupt("return",{track:t,result:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return d=e.sent,e.abrupt("return",Object(z.renderToStaticMarkup)(V.a.createElement("svg",{width:a,height:l,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,a+2*c,l].toString()},V.a.createElement("rect",{width:a+2*c,height:l,fill:"white"}),V.a.createElement("g",{stroke:"none",transform:"translate(".concat(c," ").concat(K,")")},V.a.createElement(Z,{model:t}),V.a.createElement(te,{model:t,displayResults:d,offset:s})))));case 10:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}n(455);var ae=n(590),oe=n(1666),ie=n(1669),ce=n(1642),se=n(1670),ue=n(61),le=n(1638),de=n(1652),fe=n(1747),pe=n(1671),ge=n(1635),me=n(113),he=n.n(me),be=Object(W.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function ve(e){var t=e.model,n=e.handleClose,a="undefined"!==typeof OffscreenCanvas,i=Object(B.useState)(a),c=Object(o.a)(i,2),s=c[0],l=c[1],d=Object(B.useState)(!1),f=Object(o.a)(d,2),p=f[0],g=f[1],m=Object(B.useState)(),h=Object(o.a)(m,2),b=h[0],v=h[1],y=be();return V.a.createElement(oe.a,{open:!0,onClose:n},V.a.createElement(ie.a,null,"Export SVG",V.a.createElement(ce.a,{className:y.closeButton,onClick:n},V.a.createElement(he.a,null))),V.a.createElement(se.a,null,b?V.a.createElement("div",{style:{color:"red"}},"".concat(b)):p?V.a.createElement("div",null,V.a.createElement(ue.a,{size:20,style:{marginRight:20}}),V.a.createElement(le.a,{display:"inline"},"Creating SVG")):null,a?V.a.createElement(de.a,{control:V.a.createElement(fe.a,{checked:s,onChange:function(){return l((function(e){return!e}))}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):V.a.createElement(le.a,null,"Note: rasterizing layers not yet supported in this browser, so SVG size may be large")),V.a.createElement(pe.a,null,V.a.createElement(ge.a,{variant:"contained",color:"secondary",onClick:function(){return n()}},"Cancel"),V.a.createElement(ge.a,{variant:"contained",color:"primary",type:"submit",onClick:Object(r.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g(!0),v(void 0),e.prev=2,e.next=5,t.exportSvg({rasterizeLayers:s});case 5:n(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),v(e.t0);case 12:return e.prev=12,g(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,8,12,15]])})))},"Submit")))}var ye=n(108);n(951);function Oe(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return Object(p.assembleLocString)(Object(c.a)(Object(c.a)({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(" ")}var we=48,je=20,ke=17,xe=3,Ce=32,Se=7;function Te(e){return"undefined"!==typeof localStorage?localStorage.getItem(e):void 0}function Ee(e){return v.types.compose(d.BaseViewModel,v.types.model("LinearGenomeView",{id:f.ElementId,type:v.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:v.types.array(f.Region),tracks:v.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,trackSelectorType:v.types.optional(v.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:v.types.optional(v.types.string,(function(){return Te("lgv-trackLabels")||"overlapping"})),showCenterLine:v.types.optional(v.types.boolean,(function(){var e=Te("lgv-showCenterLine");return void 0!==e&&null!==e&&!!+e})),showCytobandsSetting:v.types.optional(v.types.boolean,(function(){var e=Te("lgv-showCytobands");return void 0===e||null===e||!!+e}))})).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,searchResults:void 0,searchQuery:void 0,seqDialogDisplayed:!1}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return 2}}})).views((function(e){return{get assemblyErrors(){var t=Object(p.getSession)(e).assemblyManager;return this.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=Object(p.getSession)(e).assemblyManager;return this.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSearchDialogDisplayed(){return void 0!==e.searchResults},get scaleBarHeight(){return ke+xe},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?we:we+je},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*xe},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return e.displayedRegions.reduce((function(e,t){return e+t.end-t.start}),0)},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:function(){return Object(c.a)(Object(c.a)({},Object(h.getParentRenderProps)(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:Object(l.getConf)(Object(p.getSession)(e),"highResolutionScaling")})},get assemblyNames(){return Object(i.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},searchScope:function(t){return{assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}},bpToPx:function(t){var n=t.refName,r=t.coord,a=t.regionNumber;return Object(p.viewBpToPx)({refName:n,coord:r,regionNumber:a,self:e})},pxToBp:function(t){var n=0,r=(e.offsetPx+t)*e.bpPerPx,a=e.displayedRegions.length;if(r<0){var o=e.displayedRegions[0],i=r;return Object(c.a)(Object(c.a)({},Object(v.getSnapshot)(o)),{},{oob:!0,coord:o.reversed?Math.floor(o.end-i)+1:Math.floor(o.start+i)+1,offset:i,index:0})}for(var s=e.interRegionPaddingWidth*e.bpPerPx,u=e.minimumBlockWidth*e.bpPerPx,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l],f=d.end-d.start,p=r-n;if(f+n>r&&n<=r)return Object(c.a)(Object(c.a)({},Object(v.getSnapshot)(d)),{},{oob:!1,offset:p,coord:d.reversed?Math.floor(d.end-p)+1:Math.floor(d.start+p)+1,index:l});d.end-d.start>u&&p/e.bpPerPx>0&&p/e.bpPerPx<e.width?n+=f+s:n+=f}if(r>=n){var g=e.displayedRegions[a-1],m=r-n+(g.end-g.start);return Object(c.a)(Object(c.a)({},Object(v.getSnapshot)(g)),{},{oob:!0,offset:m,coord:g.reversed?Math.floor(g.end-m)+1:Math.floor(g.start+m)+1,index:a-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rankSearchResults:function(t){var n=e.tracks.map((function(e){return e.configuration.trackId}));return t.forEach((function(e){n!==[]&&n.includes(e.trackId)&&e.updateScore(e.getScore()+1)})),t},rewriteOnClicks:function(t,n){var r=this;n.forEach((function(n){if("subMenu"in n&&r.rewriteOnClicks(t,n.subMenu),"onClick"in n){var a=n.onClick;n.onClick=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];e.tracks.forEach((function(e){e.type===t&&a.apply(e,[e].concat(r))}))}}}))},get trackTypeActions(){var t=this,n=new Map;return e.tracks.forEach((function(e){if(!n.get(e.type)){var r=w()(e.viewMenuActions);t.rewriteOnClicks(e.type,r),n.set(e.type,r)}})),n},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}})).actions((function(t){return{setShowCytobands:function(e){t.showCytobandsSetting=e,localStorage.setItem("lgv-showCytobands","".concat(+e))},setWidth:function(e){t.volatileWidth=e},setError:function(e){t.volatileError=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},scrollTo:function(e){var n=Object(p.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo:function(e){var n=Object(p.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;var r=t.bpPerPx;if(t.bpPerPx=n,Math.abs(r-n)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),r;var a=t.width;return this.scrollTo(Math.round((t.offsetPx+a/2)*r/n-a/2)),n},setOffsets:function(e,n){t.leftOffset=e,t.rightOffset=n},setSearchResults:function(e,n){t.searchResults=e,t.searchQuery=n},setSequenceDialogOpen:function(e){t.seqDialogDisplayed=e},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=Object(v.cast)(t.displayedRegions.slice().reverse().map((function(e){return Object(c.a)(Object(c.a)({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e.pluggableConfigSchemaType("track"),i=Object(v.resolveIdentifier)(o,Object(v.getRoot)(t),n);if(!i)throw new Error('Could not resolve identifier "'.concat(n,'"'));var s=e.getTrackType(null===i||void 0===i?void 0:i.type);if(!s)throw new Error("Unknown track type ".concat(i.type));var u=e.getViewType(t.type),l=u.displayTypes.map((function(e){return e.name})),d=i.displays.find((function(e){return l.includes(e.type)}));if(!d)throw new Error("Could not find a compatible display for view type ".concat(t.type));var f=t.tracks.filter((function(e){return e.configuration===i}));if(0===f.length){var p=s.stateModel.create(Object(c.a)(Object(c.a)({},r),{},{type:i.type,configuration:i,displays:[Object(c.a)({type:d.type,configuration:d},a)]}));return t.tracks.push(p),p}return f[0]},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(v.resolveIdentifier)(r,Object(v.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===a}));return Object(b.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length}}})).actions((function(e){return{moveTrack:function(t,n){var r=e.tracks.findIndex((function(e){return e.id===t}));if(-1===r)throw new Error("Track ID ".concat(t," not found"));var a=e.tracks.findIndex((function(e){return e.id===n}));if(-1===a)throw new Error("Track ID ".concat(n," not found"));var o=Object(v.getSnapshot)(e.tracks[r]);e.tracks.splice(r,1),e.tracks.splice(a,0,o)},closeView:function(){var t=Object(p.getContainingView)(e);t?Object(p.isViewContainer)(t)&&t.removeView(e):Object(p.getSession)(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t,localStorage.setItem("lgv-trackLabels",t)},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine,localStorage.setItem("lgv-showCenterLine","".concat(+e.showCenterLine))},setDisplayedRegions:function(t){e.displayedRegions=Object(v.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=Object(p.getSession)(e);if(Object(p.isSessionModelWithWidgets)(t)){var n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},navToLocString:function(t,n){var r=e.assemblyNames,a=Object(p.getSession)(e).assemblyManager,o=a.isValidRefName,i=n||r[0],s=t.split(" ").filter((function(e){return!!e.trim()})).map((function(e){return Object(p.parseLocString)(e,(function(e){return o(e,i)}))})).map((function(e){var t=e.assemblyName||i,n=a.get(t),r=e.refName;if(!n)throw new Error("assembly ".concat(t," not found"));var o=n.regions;if(!o)throw new Error("regions not loaded yet for ".concat(t));var s=n.getCanonicalRefName(e.refName);if(!s)throw new Error("Could not find refName ".concat(r," in ").concat(n.name));var u=o.find((function(e){return e.refName===s}));if(!u)throw new Error("Could not find refName ".concat(r," in ").concat(t));return Object(c.a)(Object(c.a)({},e),{},{assemblyName:t,parentRegion:u})}));if(1===s.length){var u=s[0];this.setDisplayedRegions([Object(c.a)({reversed:u.reversed},u.parentRegion)]);var l=u.start,d=u.end,f=u.parentRegion;this.navTo(Object(c.a)(Object(c.a)({},u),{},{start:Object(p.clamp)(null!==l&&void 0!==l?l:0,0,f.end),end:Object(p.clamp)(null!==d&&void 0!==d?d:f.end,0,f.end)}))}else this.setDisplayedRegions(s.map((function(e){return void 0===e.start?e.parentRegion:e}))),this.showAllRegions()},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var n=t[0],r=n.refName,a=n.start,o=n.end,i=n.assemblyName,c=void 0===i?e.assemblyNames[0]:i;if(void 0!==a&&void 0!==o&&a>o)throw new Error('start "'.concat(a+1,'" is greater than end "').concat(o,'"'));var s=Object(p.getSession)(e).assemblyManager.get(c);if(s){var u=s.getCanonicalRefName(r);u&&(r=u)}for(var l,d=a,f=o,g=!1,m=function(e){if(r===e.refName){if(g=!0,void 0===d&&(d=e.start),void 0===f&&(f=e.end),d>=e.start&&d<=e.end&&f<=e.end&&f>=e.start)return!0;d=a,f=o}return!1},h=Object(p.findLastIndex)(e.displayedRegions,m);l!==h;)try{var b=l;if(l=e.displayedRegions.slice(void 0===b?0:b+1).findIndex(m),void 0!==b&&(l+=b+1),!g)throw new Error('could not find a region with refName "'.concat(r,'"'));if(void 0===d)throw new Error('could not find a region with refName "'.concat(r,'" that contained an end position ').concat(f));if(void 0===f)throw new Error('could not find a region with refName "'.concat(r,'" that contained a start position ').concat(d+1));if(-1===l)throw new Error('could not find a region that completely contained "'.concat(Object(p.assembleLocString)(n),'"'));if(1===t.length){var v=e.displayedRegions[l];return void this.moveTo({index:l,offset:v.reversed?v.end-f:d-v.start},{index:l,offset:v.reversed?v.end-d:f-v.start})}for(var y=0,O=0,w=0;y<t.length;y++){var j=t[y],k=e.displayedRegions[l+y];if(O=j.start||k.start,w=j.end||k.end,j.refName!==k.refName)throw new Error("Entered location ".concat(Object(p.assembleLocString)(j)," does not match with displayed regions"))}y-=1;var x=e.displayedRegions[l],C=e.displayedRegions[l+y];return void this.moveTo({index:l,offset:x.reversed?x.end-f:d-x.start},{index:l+y,offset:C.reversed?C.end-O:w-C.start})}catch(S){if(l===h)throw S}},zoomToDisplayedRegions:function(t,n){if(void 0!==t&&void 0!==n){if(t.refName===n.refName&&t.index===n.index&&n.offset<t.offset||t.index>n.index){var r=[n,t];t=r[0],n=r[1]}var a={start:t.start,end:t.end,index:t.index,offset:t.offset},o={start:n.start,end:n.end,index:n.index,offset:n.offset};if(a&&o)this.moveTo(a,o);else Object(p.getSession)(e).notify("No regions found to navigate to","warning")}},getSelectedRegions:function(t,n){var r=y.a.create(Object(c.a)(Object(c.a)({},Object(v.getSnapshot)(e)),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return r.setVolatileWidth(e.width),r.zoomToDisplayedRegions(t,n),r.dynamicBlocks.contentBlocks.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var o=t.index+1;o<n.index;o+=1)r+=e.displayedRegions[o].end-e.displayedRegions[o].start;r+=n.offset}var i=r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)),c=e.zoomTo(i),s=0;i<c&&(s=(c-i)*e.width/2);for(var u=-s,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l];if(t.index===l){u+=t.offset;break}u+=d.end-d.start}e.scrollTo(Math.round(u/e.bpPerPx)+e.interRegionPaddingWidth*t.index)},horizontalScroll:function(t){var n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},centerAt:function(t,n,r){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},center:function(){var t=e.totalBp/2;e.scrollTo(Math.round(t/e.bpPerPx-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var n=Object(p.getSession)(e),r=n.assemblyManager;if(!t){var a=Object(i.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))));if(a.length>1)return void n.notify("Can't perform this with multiple assemblies currently");t=Object(o.a)(a,1)[0]}var c=r.get(t);if(c){var s=c.regions;s&&(this.setDisplayedRegions(s),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t}}})).actions((function(e){var t=function(){};return{slide:function(n){var r=Object(p.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo),a=Object(o.a)(r,2),i=a[0],c=a[1];t(),t=c,i()}}})).actions((function(e){var t=function(){};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),!(n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var r=e.bpPerPx/n,a=Object(p.springAnimate)(1,r,e.setScaleFactor,(function(){e.zoomTo(n),e.setScaleFactor(1)})),i=Object(o.a)(a,2),c=i[0],s=i[1];t(),t=s,c()}}}})).views((function(e){return{get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){var t=Object(p.getSession)(e).assemblyManager;return e.assemblyNames.some((function(e){var n,r;return null===(n=t.get(e))||void 0===n||null===(r=n.cytobands)||void 0===r?void 0:r.length}))},get cytobandOffset(){return this.showCytobands?Object(p.measureText)(e.displayedRegions[0].refName,12)+15:0}}})).views((function(e){return{menuItems:function(){var t,n=e.canShowCytobands,r=e.showCytobands,c=[{label:"Return to import form",onClick:function(){Object(p.getSession)(e).queueDialog((function(t){return[ye.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:P.a},{label:"Export SVG",icon:N.a,onClick:function(){Object(p.getSession)(e).queueDialog((function(t){return[ve,{model:e,handleClose:t}]}))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:k.c},{label:"Horizontally flip",icon:C.a,onClick:e.horizontallyFlip},{type:"divider"},{label:"Show all regions in assembly",icon:T.a,onClick:e.showAllRegionsInAssembly},{label:"Show center line",icon:T.a,type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{label:"Show header",icon:T.a,type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",icon:T.a,type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Track labels",icon:M.a,subMenu:[{label:"Overlapping",icon:T.a,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:T.a,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:T.a,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}].concat(Object(i.a)(n?[{label:r?"Hide ideogram":"Show ideograms",onClick:function(){e.setShowCytobands(!r)}}]:[])),s=Object(a.a)(e.trackTypeActions.entries());try{for(s.s();!(t=s.n()).done;){var u=Object(o.a)(t.value,2),l=u[0],d=u[1];d.length&&(c.push({type:"divider"},{type:"subHeader",label:l}),d.forEach((function(e){c.push(e)})))}}catch(f){s.e(f)}finally{s.f()}return c}}})).views((function(e){var t,n="";return{get staticBlocks(){var r=Object(m.a)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return Object(g.a)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},get visibleLocStrings(){return Oe(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return Oe(e.coarseDynamicBlocks)}}})).actions((function(e){return{clearView:function(){e.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;Object(v.addDisposer)(e,Object(b.autorun)((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150}))}}})).actions((function(e){return{exportSvg:function(){var t=arguments;return Object(r.a)(u.a.mark((function n(){var r,a,o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},n.next=3,ne(e,r);case 3:a=n.sent,o=new Blob([a],{type:"image/svg+xml"}),Object(j.saveAs)(o,"image.svg");case 6:case"end":return n.stop()}}),n)})))()}}})).views((function(e){return{rubberBandMenuItems:function(){return[{label:"Zoom to region",icon:I.a,onClick:function(){var t=e.leftOffset,n=e.rightOffset;t&&n&&e.moveTo(t,n)}},{label:"Get sequence",icon:D.a,onClick:function(){e.setSequenceDialogOpen(!0)}}]}}}))}},204:function(e,t,n){"use strict";n.r(t),n.d(t,"getSubType",(function(){return a})),n.d(t,"getUnionSubTypes",(function(){return o})),n.d(t,"getPropertyType",(function(){return i})),n.d(t,"getDefaultValue",(function(){return c})),n.d(t,"getEnumerationValues",(function(){return s})),n.d(t,"resolveLateType",(function(){return u}));var r=n(85);function a(e){var t;if(Object(r.isOptionalType)(e))t=e._subtype||e.type;else{if(!Object(r.isArrayType)(e)&&!Object(r.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!Object(r.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function c(e){if(!Object(r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function s(e){return o(e).map((function(e){return e.value}))}function u(e){return Object(r.isUnionType)(e)||Object(r.isArrayType)(e)||!Object(r.isLateType)(e)?e:e.getSubType()}},205:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(81),a=n(11),o=n(88),i=n(89),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var a;if(Object(r.a)(this,n),(a=t.call(this,e)).ReactComponent=void 0,a.stateModel=void 0,a.displayTypes=[],a.ReactComponent=e.ReactComponent,a.stateModel=e.stateModel,!a.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(a.name));if(!a.stateModel)throw new Error("no stateModel defined for view ".concat(a.name));return a}return Object(a.a)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(n(192).a)},229:function(e,t,n){"use strict";function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function o(e,t,n,r){return n<=e&&r>=t}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return o}))},232:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O})),n.d(t,"NewFeatureRendererType",(function(){return w}));var r=n(83),a=n(86),o=n(81),i=n(11),c=n(142),s=n(132),u=n(88),l=n(89),d=n(80),f=n.n(d),p=n(828),g=n(258),m=n(829),h=n(82),b=n(119),v=n(255),y=n(256),O=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"serializeArgsInClient",value:function(e){var t=e.displayModel,r=e.regions,o=Object(a.a)(Object(a.a)({},e),{},{displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:JSON.parse(JSON.stringify(r))});return Object(c.a)(Object(s.a)(n.prototype),"serializeArgsInClient",this).call(this,o)}},{key:"deserializeResultsInClient",value:function(e,t){var r=new Map;e.features.forEach((function(e){var t=b.a.fromJSON(e);r.set(String(t.id()),t)}));var o=Object(c.a)(Object(s.a)(n.prototype),"deserializeResultsInClient",this).call(this,Object(a.a)(Object(a.a)({},e),{},{features:r}),t);return Object(a.a)(Object(a.a)({},o),{},{blockKey:t.blockKey,features:r})}},{key:"serializeResultsInWorker",value:function(e,t){var r=Object(c.a)(Object(s.a)(n.prototype),"serializeResultsInWorker",this).call(this,e,t);return Object(a.a)(Object(a.a)({},r),{},{features:Object(h.iterMap)(e.features.values(),(function(e){return e.toJSON()}))})}},{key:"getExpandedRegion",value:function(e,t){return e}},{key:"getFeatures",value:function(){var e=Object(r.a)(f.a.mark((function e(t){var n,r,o,i,c,s,u,l,d,b,y=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,r=t.regions,o=t.sessionId,i=t.adapterConfig,e.next=3,Object(v.b)(this.pluginManager,o,i);case 3:if(c=e.sent,s=c.dataAdapter,u=new Map,r&&0!==r.length){e.next=8;break}return e.abrupt("return",u);case 8:return l=r.map((function(e){var t=Object(a.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),d=l[0],b=1===l.length?s.getFeatures(this.getExpandedRegion(d,t),t):s.getFeaturesInMultipleRegions(l,t),e.next=13,b.pipe(Object(p.a)((function(){return Object(h.checkAbortSignal)(n)})),Object(g.a)((function(e){return y.featurePassesFilters(t,e)})),Object(p.a)((function(e){var t=e.id();if(!t)throw new Error('invalid feature id "'.concat(t,'"'));u.set(t,e)})),Object(m.a)()).toPromise();case 13:return e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"render",value:function(){var e=Object(r.a)(f.a.mark((function e(t){var r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.features,e.t0){e.next=5;break}return e.next=4,this.getFeatures(t);case 4:e.t0=e.sent;case 5:return r=e.t0,e.next=8,Object(c.a)(Object(s.a)(n.prototype),"render",this).call(this,Object(a.a)(Object(a.a)({},t),{},{features:r}));case 8:return o=e.sent,e.abrupt("return",Object(a.a)(Object(a.a)({},o),{},{features:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(y.default),w=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n)}(y.default)},233:function(e,t,n){"use strict";var r=n(2),a=n(86),o=n(29),i=n(1),c=n.n(i),s=n(51),u=n(1631),l=n(1658),d=n(1661),f=n(1654),p=n(1633),g=n(1662),m=n(1627),h=n(1630),b=n(1626),v=n(822),y=n.n(v),O=n(1269),w=n.n(O),j=n(1270),k=n.n(j),x=n(1271),C=n.n(x),S=n(823),T=n.n(S),E=n(82),M=["open","onClose","menuItems","onMenuItemClick"],R=Object(s.a)({paper:{position:"fixed",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",top:0,left:0,outline:0},menuItemEndDecoration:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",padding:2,marginRight:-12,display:"inline-flex"}});function P(e){var t,n,r,a=R(),o=e.type;if("checked"in e&&(t=e.checked,n=e.disabled),"subMenu"===o)r=c.a.createElement(y.a,{color:"action"});else if("checkbox"===o)if(t){var i=n?"inherit":"secondary";r=c.a.createElement(w.a,{color:i})}else r=c.a.createElement(k.a,{color:"action"});else if("radio"===o)if(t){var s=n?"inherit":"secondary";r=c.a.createElement(C.a,{color:s})}else r=c.a.createElement(T.a,{color:"action"});return c.a.createElement("div",{className:a.menuItemEndDecoration},r)}var A=c.a.forwardRef((function(e,t){var n=Object(i.useState)(),r=Object(o.a)(n,2),s=r[0],b=r[1],v=Object(i.useState)(),y=Object(o.a)(v,2),O=y[0],w=y[1],j=Object(i.useState)(!1),k=Object(o.a)(j,2),x=k[0],C=k[1],S=Object(i.useState)(),T=Object(o.a)(S,2),M=T[0],N=T[1],L=Object(i.useState)(),I=Object(o.a)(L,2),F=I[0],D=I[1],B=Object(i.useRef)(),V=R(),z=e.menuItems,W=e.onMenuItemClick,U=e.open,q=e.onClose,H=e.anchorEl,_=e.top,G=void 0!==_&&_;Object(i.useEffect)((function(){U||(b(void 0),w(void 0))}),[U]),Object(i.useEffect)((function(){var e,t=U&&Boolean(s);return t&&!x?e=setTimeout((function(){C(!0)}),300):!t&&x&&(e=setTimeout((function(){C(!1)}),300)),function(){clearTimeout(e)}}),[x,U,s]),Object(i.useEffect)((function(){if(H){var e=H.getBoundingClientRect();F&&e.top===F.top&&e.left+e.width===F.left||D({top:e.top,left:e.left+e.width})}else F||D({})}),[F,H]);var J=z.some((function(e){return"subMenu"in e||"checkbox"===e.type||"radio"===e.type})),X=z.some((function(e){return"icon"in e&&e.icon})),Y={};J&&(Y.paddingRight=48);var Q=c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,{autoFocusItem:U&&!x},z.sort((function(e,t){return(t.priority||0)-(e.priority||0)})).map((function(e,t){if("divider"===e.type)return c.a.createElement(l.a,{key:"divider-".concat(t),component:"li"});if("subHeader"===e.type)return c.a.createElement(d.a,{key:"subHeader-".concat(e.label,"-").concat(t)},e.label);var n=null,r=null;if(e.icon){var a=e.icon;n=c.a.createElement(f.a,null,c.a.createElement(a,null))}"subMenu"in e?r=c.a.createElement(P,{type:"subMenu"}):"checkbox"!==e.type&&"radio"!==e.type||(r=c.a.createElement(P,{type:e.type,checked:e.checked,disabled:e.disabled}));var o,i="onClick"in e?(o=e.onClick,function(e){W(e,o)}):void 0;return c.a.createElement(p.a,{key:e.label,style:Y,selected:t===M,onClick:i,onMouseMove:function(n){n.currentTarget!==document.activeElement&&(n.currentTarget.focus(),N(t)),"subMenu"in e?O!==t&&(b(n.currentTarget),w(t)):(b(void 0),w(void 0))},onKeyDown:function(n){if("ArrowLeft"===n.key||"Escape"===n.key)q&&q(n,"escapeKeyDown");else if("ArrowUp"===n.key)N(function(e,t){return Object(E.findLastIndex)(e.slice(0,t),(function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}))}(z,t));else if("ArrowDown"===n.key){var r=function(e,t){var n=e.slice(t+1).findIndex((function(e){return"divider"!==e.type&&"subHeader"!==e.type&&!e.disabled}));return-1===n?n:t+1+n}(z,t);N(r)}else"subMenu"in e&&("ArrowRight"!==n.key&&"Enter"!==n.key||(b(n.currentTarget),w(t),C(!0)))},disabled:Boolean(e.disabled)},n,c.a.createElement(g.a,{primary:e.label,secondary:e.subLabel,inset:X&&!e.icon}),r)}))),z.map((function(e,t){var n=null;return"subMenu"in e&&(n=c.a.createElement(A,{key:e.label,anchorEl:s,open:x&&O===t,onClose:function(){C(!1),b(void 0)},onMenuItemClick:W,menuItems:e.subMenu})),n})));return G?Q:c.a.createElement(m.a,{in:U,style:{transformOrigin:"0 0 0"},ref:t},c.a.createElement(h.a,{elevation:8,ref:B,className:V.paper,style:Object(a.a)({},F)},Q))}));t.a=function(e){var t=e.open,n=e.onClose,a=e.menuItems,o=e.onMenuItemClick,i=Object(r.a)(e,M);return c.a.createElement(b.a,Object.assign({transitionDuration:0,open:t,onClose:n,BackdropProps:{invisible:!0}},i),c.a.createElement(A,{open:t,onClose:n,menuItems:a,onMenuItemClick:o,top:!0}))}},235:function(e,t,n){"use strict";n.r(t),n.d(t,"parseCigar",(function(){return u})),n.d(t,"cigarToMismatches",(function(){return l})),n.d(t,"mdToMismatches",(function(){return d})),n.d(t,"getTemplateCoord",(function(){return f})),n.d(t,"getMismatches",(function(){return p})),n.d(t,"generateMD",(function(){return g})),n.d(t,"getNextRefPos",(function(){return m})),n.d(t,"getModificationPositions",(function(){return h})),n.d(t,"getModificationTypes",(function(){return b}));var r=n(29),a=n(253),o=n(80),i=n.n(o),c=n(82),s=i.a.mark(m);function u(e){return(e||"").split(/([MIDNSHPX=])/)}function l(e,t,n){for(var r=0,a=0,o=[],i=0;i<e.length-1;i+=2){var c=+e[i],s=e[i+1];if("M"!==s&&"="!==s&&"E"!==s||(a+=c),"I"===s)o.push({start:r,type:"insertion",base:"".concat(c),length:0}),a+=c;else if("D"===s)o.push({start:r,type:"deletion",base:"*",length:c});else if("N"===s)o.push({start:r,type:"skip",base:"N",length:c});else if("X"===s){for(var u=t.slice(a,a+c),l=(null===n||void 0===n?void 0:n.slice(a,a+c))||[],d=0;d<c;d++)o.push({start:r+d,type:"mismatch",base:u[d],qual:l[d],length:1});a+=c}else"H"===s?o.push({start:r,type:"hardclip",base:"H".concat(c),cliplen:c,length:1}):"S"===s&&(o.push({start:r,type:"softclip",base:"S".concat(c),cliplen:c,length:1}),a+=c);"I"!==s&&"S"!==s&&"H"!==s&&(r+=c)}return o}function d(e,t,n,r,a){var o=[],i={start:0,base:"",length:0,type:"mismatch"},c=n.filter((function(e){return"skip"===e.type})),s=0,u=0,l=0,d=0;function f(){o.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}function p(e){for(var n=u,r=l,a=s;a<t.length&&r<=e;s=a+=2){var o=+t[a],i=t[a+1];"S"===i||"I"===i?n+=o:"D"===i||"P"===i||"N"===i?r+=o:"H"!==i&&(n+=o,r+=o)}return u=n,l=r,n-(r-e)}for(var g=e.match(/(\d+|\^[a-z]+|[a-z])/gi)||[],m=0;m<g.length;m++){var h=g[m],b=+h;if(Number.isNaN(b))if(h.startsWith("^"))i.length=h.length-1,i.base="*",i.type="deletion",i.seq=h.substring(1),f();else for(var v=0;v<h.length;v+=1){for(i.length=1;d<c.length;){var y=c[d];if(!(i.start>=y.start))break;i.start+=y.length,d++}var O=t?p(i.start):i.start;i.base=r?r.substr(O,1):"X";var w=null===a||void 0===a?void 0:a.slice(O,O+1)[0];w&&(i.qual=w),i.altbase=h,f()}else i.start+=b}return o}function f(e,t){for(var n=0,r=0,a=0;a<t.length&&r<=e;a+=2){var o=+t[a],i=t[a+1];"S"===i||"I"===i?n+=o:"D"===i||"P"===i?r+=o:"H"!==i&&(n+=o,r+=o)}return n-(r-e)}function p(e,t,n,r){var a=[],o=[];e&&(o=u(e),a=a.concat(l(o,n,r))),t&&(a=a.concat(d(t,o,a,n,r)));var i={};return a.filter((function(e){var t="".concat(e.type,",").concat(e.start,",").concat(e.length),n=i[t];return i[t]=!0,!n}))}function g(e,t,n){var r=0,a=0,o=0;if(!e)return console.warn("no ref supplied to generateMD"),"";for(var i=u(n),c="",s=0;s<i.length;s+=2){var l=+i[s],d=i[s+1];if("M"===d||"X"===d||"="===d){for(var f=0;f<l;f++)t[r+f].toLowerCase()!==e[a+f].toLowerCase()?(c+="".concat(o).concat(e[a+f].toUpperCase()),o=0):o++;r+=l,a+=l}else if("I"===d)r+=l;else if("D"===d){for(var p="",g=0;g<l;g++)p+=e[a+g].toUpperCase();c+="".concat(o,"^").concat(p),o=0,a+=l}else"N"===d?a+=l:"S"===d&&(r+=l)}return o>0&&(c+=o),c}function m(e,t){var n,r,a,o,c,u,l;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=0,r=0,a=0,o=0;case 4:if(!(o<t.length)){i.next=12;break}for(c=t[o];n<e.length&&r<c;n+=2)u=+e[n],"S"===(l=e[n+1])||"I"===l?r+=u:"D"===l||"N"===l?a+=u:"M"!==l&&"X"!==l&&"="!==l||(r+=u,a+=u);return i.next=9,t[o]-r+a;case 9:o++,i.next=4;break;case 12:case"end":return i.stop()}}),s)}function h(e,t,n){var o=-1===n?Object(c.revcom)(t):t;return e.split(";").filter((function(e){return!!e})).map((function(e){var t=e.split(","),i=Object(a.a)(t),c=i[0],s=i.slice(1),u=c.match(/([A-Z])([-+])([^,.?]+)([.?])?/);if(!u)throw new Error("bad format for MM tag");var l=Object(r.a)(u,4),d=l[1],f=l[2],p=l[3].split(/(\d+|.)/).filter((function(e){return!!e}));return"-"===f?(console.warn("unsupported negative strand modifications"),{type:"unsupported",positions:[]}):p.map((function(e){var t=0;return{type:e,positions:s.map((function(e){return+e})).map((function(e){do{"N"!==d&&d!==o[t]||e--,t++}while(e>=0&&t<o.length);var r=t-1;return-1===n?o.length-1-r:r})).sort((function(e,t){return e-t}))}}))})).flat()}function b(e){return e.split(";").filter((function(e){return!!e})).map((function(e){var t=e.split(","),n=Object(r.a)(t,1)[0].match(/([A-Z])([-+])([^,]+)/);if(!n)throw new Error("bad format for MM tag");return Object(r.a)(n,4)[3].split(/(\d+|.)/).filter((function(e){return!!e}))})).flat()}},247:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var r=n(83),a=n(81),o=n(11),i=n(88),c=n(89),s=n(80),u=n.n(s),l=n(1),d=n.n(l),f=n(204),p=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.supportsSVG=!1,r.configSchema=void 0,r.pluginManager=void 0,r.ReactComponent=e.ReactComponent,r.configSchema=e.configSchema,r.pluginManager=e.pluginManager,!r.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(r.name));if(!Object(f.getDefaultValue)(r.configSchema).type)throw new Error("".concat(r.name," config schema ").concat(r.configSchema.name," is not explicitlyTyped"));if(!r.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(r.name));return r}return Object(o.a)(n,[{key:"render",value:function(){var e=Object(r.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{reactElement:d.a.createElement(this.ReactComponent,t,null)});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){return 0}}]),n}(n(192).a)},248:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(103),a=n(86),o=n(83),i=n(81),c=n(11),s=n(88),u=n(89),l=n(80),d=n.n(l),f=n(192),p=n(105),g=n(85),m=n(177),h=n(800),b=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,{name:""})).pluginManager=e,r.name="UNKNOWN",r}return Object(c.a)(n,[{key:"serializeArguments",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(p.getBlobMap)(),e.next=3,this.augmentLocationObjects(t);case 3:return e.abrupt("return",Object(a.a)(Object(a.a)({},t),{},{blobMap:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeNewAuthArguments",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.pluginManager.rootModel,Object(m.d)(n)&&!t.internetAccountPreAuthorization){e.next=3;break}return e.abrupt("return",t);case 3:if(!(r=null===n||void 0===n?void 0:n.findAppropriateInternetAccount(t))){e.next=8;break}return e.next=7,r.getPreAuthorizationInformation(t);case 7:t.internetAccountPreAuthorization=e.sent;case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deserializeArguments",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.blobMap&&Object(p.setBlobMap)(t.blobMap),!(r=t.signal)||!Object(h.b)(r)){e.next=4;break}return e.abrupt("return",Object(a.a)(Object(a.a)({},t),{},{signal:Object(h.a)(r)}));case 4:return e.abrupt("return",Object(a.a)(Object(a.a)({},t),{},{signal:void 0}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeReturn",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(o.a)(d.a.mark((function e(t,n,r){var a,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.pluginManager.rootModel,e.prev=1,e.next=4,t;case 4:a=e.sent,e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(1),!Object(m.e)(e.t0)){e.next=12;break}throw i=null===o||void 0===o?void 0:o.createEphemeralInternetAccount("HTTPBasicInternetAccount-".concat(new URL(e.t0.url).origin),{},e.t0.url),new m.b("Retrying with created internet account",i.internetAccountId);case 12:throw e.t0;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"augmentLocationObjects",value:function(){var e=Object(o.a)(d.a.mark((function e(t){var n,a,o,i,c,s,u,l,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(g.isStateTreeNode)(t)||Object(g.isAlive)(t)){e.next=2;break}return e.abrupt("return",t);case 2:if(!Object(m.p)(t)){e.next=5;break}return e.next=5,this.serializeNewAuthArguments(t);case 5:if(!Array.isArray(t)){e.next=23;break}n=Object(r.a)(t),e.prev=7,n.s();case 9:if((a=n.n()).done){e.next=15;break}return o=a.value,e.next=13,this.augmentLocationObjects(o);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:if("object"!==typeof t||null===t){e.next=53;break}i=0,c=Object.values(t);case 25:if(!(i<c.length)){e.next=53;break}if(s=c[i],!Array.isArray(s)){e.next=47;break}u=Object(r.a)(s),e.prev=29,u.s();case 31:if((l=u.n()).done){e.next=37;break}return f=l.value,e.next=35,this.augmentLocationObjects(f);case 35:e.next=31;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(29),u.e(e.t1);case 42:return e.prev=42,u.f(),e.finish(42);case 45:e.next=50;break;case 47:if("object"!==typeof s||null===s){e.next=50;break}return e.next=50,this.augmentLocationObjects(s);case 50:i++,e.next=25;break;case 53:case"end":return e.stop()}}),e,this,[[7,17,20,23],[29,39,42,45]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(f.a)},254:function(e,t,n){"use strict";n.r(t),n.d(t,"LayoutSession",(function(){return w})),n.d(t,"default",(function(){return j}));var r=n(29),a=n(83),o=n(86),i=n(142),c=n(132),s=n(88),u=n(89),l=n(81),d=n(11),f=n(80),p=n.n(f),g=n(578),m=n.n(g),h=n(579),b=n(343),v=n(439),y=n(232),O=n(79),w=function(){function e(t){if(Object(l.a)(this,e),this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=t.config,!Object(O.isConfigurationModel)(this.config))throw new Error("configuration required");this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}return Object(d.a)(e,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"makeLayout",value:function(){return new b.a(h.a,{maxHeight:Object(O.readConfObject)(this.config,"maxHeight"),displayMode:Object(O.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:Object(O.readConfObject)(this.config,"noSpacing")?1:3})}},{key:"cachedLayoutIsValid",value:function(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&m()(Object(O.readConfObject)(this.config),e.config)&&m()(this.filters,e.filters)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(O.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}]),e}(),j=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(l.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).sessions={},e}return Object(d.a)(n,[{key:"getWorkerSession",value:function(e){var t=e.sessionId;this.sessions[t]||(this.sessions[t]=this.createSession(e));var n=this.sessions[t];return n.update(e),n}},{key:"getExpandedRegion",value:function(e,t){if(!e)return e;var n=t.bpPerPx,r=t.config,a=void 0===r?0:Object(O.readConfObject)(r,"maxFeatureGlyphExpansion");if(!a)return e;var i=Math.round(a*n);return Object(o.a)(Object(o.a)({},e),{},{start:Math.floor(Math.max(e.start-i,0)),end:Math.ceil(e.end+i)})}},{key:"createSession",value:function(e){return new w(e)}},{key:"freeResourcesInClient",value:function(){var e=Object(a.a)(p.a.mark((function e(t,r){var a,o,s,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.sessionId,o=r.regions,s=0,u=this.sessions[a],!o&&u&&(delete this.sessions[a],s=1),u&&o&&u.layout.discardRange(o[0].refName,o[0].start,o[0].end),e.t0=s,e.next=8,Object(i.a)(Object(c.a)(n.prototype),"freeResourcesInClient",this).call(this,t,r);case 8:return e.t1=e.sent,e.abrupt("return",e.t0+e.t1);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeLayoutInClient",value:function(e){return new v.a(e)}},{key:"deserializeResultsInClient",value:function(e,t){var r=this.deserializeLayoutInClient(e.layout);return Object(i.a)(Object(c.a)(n.prototype),"deserializeResultsInClient",this).call(this,Object(o.a)(Object(o.a)({},e),{},{layout:r}),t)}},{key:"createLayoutInWorker",value:function(e){var t=e.regions;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}},{key:"serializeResultsInWorker",value:function(e,t){var a=Object(i.a)(Object(c.a)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),o=Object(r.a)(t.regions,1)[0];return a.layout=e.layout.serializeRegion(this.getExpandedRegion(o,t)),a.layout.rectangles&&(a.features=a.features.filter((function(e){return Boolean(a.layout.rectangles[e.uniqueId])}))),a.maxHeightReached=a.layout.maxHeightReached,a}},{key:"render",value:function(){var e=Object(a.a)(p.a.mark((function e(t){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layout||this.createLayoutInWorker(t),e.next=3,Object(i.a)(Object(c.a)(n.prototype),"render",this).call(this,Object(o.a)(Object(o.a)({},t),{},{layout:r}));case 3:return a=e.sent,e.abrupt("return",Object(o.a)(Object(o.a)({},a),{},{layout:r}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(y.default)},255:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return f}));var r=n(29),a=n(83),o=n(80),i=n.n(o),c=n(806);function s(e){return"".concat(Object(c.a)(e))}var u={};function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=Object(a.a)(i.a.mark((function e(t,n,r){var a,o,c,d,f,p,g,m,h,b;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s(r),u[a]){e.next=21;break}if(o=(r||{}).type){e.next=5;break}throw new Error("could not determine adapter type from adapter config snapshot");case 5:if(c=t.getAdapterType(o)){e.next=8;break}throw new Error("unknown data adapter type ".concat(o));case 8:if(d=c.configSchema.create(r,{pluginManager:t}),f=l.bind(null,t,n),p=c.AdapterClass,g=c.getAdapterClass,e.t0=p,e.t0){e.next=16;break}return e.next=15,g();case 15:e.t0=e.sent;case 16:if(m=e.t0){e.next=19;break}throw new Error("Failed to get adapter");case 19:h=new m(d,f,t),u[a]={dataAdapter:h,sessionIds:new Set([n])};case 21:return(b=u[a]).sessionIds.add(n),e.abrupt("return",b);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var t=0,n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){var a=e.sessionId;Object.entries(u).forEach((function(e){var n=Object(r.a)(e,2),o=n[0],i=n[1];i.sessionIds.delete(a),0===i.sessionIds.size&&(t+=1,delete u[o])}))}else Object.values(u).forEach((function(t){t.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach((function(e){void 0!==e.refName&&t.dataAdapter.freeResources(e)})):console.warn(t.dataAdapter,"does not implement freeResources")}));return t}},256:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return k}));var r=n(83),a=n(2),o=n(86),i=n(81),c=n(11),s=n(88),u=n(89),l=n(80),d=n.n(l),f=n(1),p=n.n(f),g=n(1644),m=n(820),h=n(85),b=n(82),v=n(247),y=n(440),O=n(108),w=n(582),j=["html"],k=function(e){Object(s.a)(n,e);var t=Object(u.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"serializeArgsInClient",value:function(e){return Object(o.a)(Object(o.a)({},e),{},{config:Object(h.isStateTreeNode)(e.config)?Object(h.getSnapshot)(e.config):e.config,filters:e.filters&&e.filters.toJSON().filters})}},{key:"deserializeResultsInClient",value:function(e,t){e.html;var n=Object(a.a)(e,j);return t.exportSVG?Object(o.a)(Object(o.a)({},e),{},{html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}):Object(o.a)(Object(o.a)({},n),{},{reactElement:p.a.createElement(w.a,Object.assign({},t,e,{RenderingComponent:this.ReactComponent}))})}},{key:"deserializeArgsInWorker",value:function(e){var t=Object(o.a)({},e);return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=new y.a({filters:e.filters}),t}},{key:"serializeResultsInWorker",value:function(e,t){var n=Object(m.renderToString)(p.a.createElement(g.a,{theme:Object(O.createJBrowseTheme)(t.theme)},e.reactElement));return delete e.reactElement,Object(o.a)(Object(o.a)({},e),{},{html:n})}},{key:"renderInClient",value:function(){var e=Object(r.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"CoreRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renderInWorker",value:function(){var e=Object(r.a)(d.a.mark((function e(t){var n,r,a,o,i,c,s=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,r=t.statusCallback,a=void 0===r?function(){}:r,Object(b.checkAbortSignal)(n),o=this.deserializeArgsInWorker(t),Object(b.checkAbortSignal)(n),e.next=6,Object(b.updateStatus)("Rendering plot",a,(function(){return s.render(o)}));case 6:return i=e.sent,Object(b.checkAbortSignal)(n),e.next=10,Object(b.updateStatus)("Serializing results",a,(function(){return s.serializeResultsInWorker(i,o)}));case 10:return c=e.sent,e.abrupt("return",c);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(){var e=Object(r.a)(d.a.mark((function e(t,n){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serializeArgsInClient(n),a=this.freeResources(),e.next=4,t.call(n.sessionId,"CoreFreeResources",r);case 4:return o=e.sent,e.abrupt("return",a+o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(v.default)},264:function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return y}));var r=n(6),a=n(29),o=n(86),i=n(85),c=n(106),s=n(429);var u={stringArray:i.types.array(i.types.string),stringArrayMap:i.types.map(i.types.array(i.types.string)),numberMap:i.types.map(i.types.number),boolean:i.types.boolean,color:i.types.refinement("Color",i.types.string,(function(){return!0})),integer:i.types.integer,number:i.types.number,string:i.types.string,text:i.types.string,fileLocation:c.FileLocation,frozen:i.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},d=function(e){return{views:{get valueJSON(){return e.value}}}},f=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},p={fileLocation:f,number:d,integer:d,boolean:d,frozen:f,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,n){e.value[t]=n}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)},addToKey:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.push(n)},removeAtKeyIndex:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.splice(n,1)},setAtKeyIndex:function(t,n,r){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[n]=r}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)}}}}},g=i.types.refinement("JexlString",i.types.string,(function(e){return e.startsWith("jexl:")}));var m=n(568);function h(e){return Array.isArray(e)&&0===e.length}function b(e,t,n){var d,f={};if(n.explicitlyTyped&&(f.type=i.types.optional(i.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(f[n.explicitIdentifier]=i.types.identifier,d=n.explicitIdentifier):(f.id=i.types.identifier,d="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(f[n.implicitIdentifier]=c.ElementId,d=n.implicitIdentifier):(f.id=c.ElementId,d="id"));var b={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((function(t){var n=Object(a.a)(t,2),r=n[0],o=n[1];if(Object(i.isType)(o)&&Object(i.isLateType)(o)||Object(m.e)(o))f[r]=o;else if("string"===typeof o||"number"===typeof o)b[r]=o;else{if("object"!==typeof o)throw new Error('invalid configuration schema definition, "'.concat(r,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!o.type)throw new Error("no type set for config slot ".concat(e,".").concat(r));try{f[r]=function(e,t){var n=t.description,r=void 0===n?"":n,a=t.model,o=t.type,c=t.defaultValue,d=t.contextVariable,f=void 0===d?[]:d;if(!o)throw new Error("type name required");if(a||(a=u[o]),!a)throw new Error('no builtin config slot type "'.concat(o,"\", and no 'model' param provided"));if(void 0===c)throw new Error("no 'defaultValue' provided");var m="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),h=i.types.model(m,{name:i.types.literal(e),description:i.types.literal(r),type:i.types.literal(o),value:i.types.optional(i.types.union(g,a),c)}).volatile((function(){return{contextVariable:f}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){if(e.isCallback){var t=Object(i.getEnv)(e).pluginManager;return t||"undefined"!==typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),Object(s.a)(String(e.value),null===t||void 0===t?void 0:t.jexl)}return{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===typeof t&&t.name===e?t:{name:e,description:r,type:o,value:t}})).postProcessSnapshot((function(e){return"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=c},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(n){}if(e.value=c,e.isCallback){if(!(o in l))throw new Error("no fallbackDefault defined for type ".concat(o));e.value=l[o]}}}}}));p[o]&&(h=h.extend(p[o]));var b=i.types.optional(h,{name:e,type:o,description:r,value:c});return Object.defineProperty(b,"isJBrowseConfigurationSlot",{value:!0}),b}(r,o)}catch(c){throw new Error("invalid config slot definition for ".concat(e,".").concat(r,": ").concat(c))}}}));var v=i.types.model("".concat(e,"ConfigurationSchema"),f).actions((function(e){return{setSubschema:function(t,n){if(!Object(m.e)(f[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var r=Object(i.isStateTreeNode)(n)?n:f[t].create(n);return e[t]=r,r}}}));Object.keys(b).length&&(v=v.volatile((function(){return b}))),n.actions&&(v=v.actions(n.actions)),n.views&&(v=v.views(n.views)),n.extend&&(v=v.extend(n.extend));var y=d?Object(r.a)({},d,"placeholderId"):{},O=n.explicitlyTyped?Object(o.a)({type:e},y):y,w=Object(i.getSnapshot)(v.create(O));return v=v.postProcessSnapshot((function(e){for(var t,n={},r=!0,o=0,i=Object.entries(e);o<i.length;o++){var c=Object(a.a)(i[o],2),s=c[0],u=c[1];r&&("object"===typeof w[s]&&"object"===typeof u?JSON.stringify(w[s])!==JSON.stringify(u)&&(r=!1):w[s]!==u&&(r=!1)),void 0!==u&&void 0===b[s]&&("object"!==typeof(t=u)||Array.isArray(t)||null===t||0!==Object.keys(t).length)&&!h(u)&&(n[s]=u)}return r?{}:n})),n.preProcessSnapshot&&(v=v.preProcessSnapshot(n.preProcessSnapshot)),i.types.optional(v,O)}function v(e,t,n){var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var r=t,a=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(r=Object(o.a)(Object(o.a)({},n.baseConfiguration.jbrowseSchemaDefinition),r),delete(a=Object(o.a)(Object(o.a)({},n.baseConfiguration.jbrowseSchemaOptions||{}),n)).baseConfiguration),{schemaDefinition:r,options:a}}(e,t,n),a=r.schemaDefinition,i=r.options,c=b(e,a,i);return c.isJBrowseConfigurationSchema=!0,c.jbrowseSchemaDefinition=a,c.jbrowseSchemaOptions=i,c}function y(e){return i.types.union(i.types.reference(e),e)}},265:function(e,t,n){"use strict";n.r(t),n.d(t,"namedColorToHex",(function(){return o})),n.d(t,"isNamedColor",(function(){return i})),n.d(t,"contrastingTextColor",(function(){return c})),n.d(t,"emphasize",(function(){return u})),n.d(t,"makeContrasting",(function(){return l}));var r=n(839),a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return a[e]}function i(e){return!!a[e]}function c(e){return s(e)>.5?"black":"white"}function s(e){var t=o(e);return Object(r.getLuminance)(t||e)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15,n=o(e);return Object(r.emphasize)(n||e,t)}function l(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=o(e)||e,i=o(t)||t,c=s(i),u=Object(r.getContrastRatio)(a,i),l=a,d=.05;u<n;)a=c>.5?Object(r.darken)(l,d):Object(r.lighten)(l,d),d+=.05,u=Object(r.getContrastRatio)(a,i);return a}},277:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(11),a=n(81),o=n(88),i=n(89),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.displayName=void 0,r.description=void 0,r.url=void 0,r.configEditorComponent=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.displayName=e.displayName,r.description=e.description,r.url=e.url,r.configEditorComponent=e.configEditorComponent,!r.stateModel)throw new Error("no stateModel defined for connection ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema defined for connection ".concat(r.name));return r}return Object(r.a)(n)}(n(192).a)},285:function(e,t,n){"use strict";var r=n(86),a=n(12),o=n(85),i=n(82),c=n(106),s=n(577),u=n(819),l=o.types.model("Base1DView",{id:c.ElementId,displayedRegions:o.types.array(c.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:o.types.optional(o.types.number,0),minimumBlockWidth:o.types.optional(o.types.number,0)}).volatile((function(){return{features:void 0,volatileWidth:0}})).actions((function(e){return{setDisplayedRegions:function(t){e.displayedRegions=Object(o.cast)(t)},setBpPerPx:function(t){e.bpPerPx=t},setVolatileWidth:function(t){e.volatileWidth=t}}})).views((function(e){return{get width(){return e.volatileWidth},get assemblyNames(){return Object(a.a)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},pxToBp:function(t){var n=0,a=(e.offsetPx+t)*e.bpPerPx,i=e.displayedRegions.length;if(a<0){var c=e.displayedRegions[0],s=a;return Object(r.a)(Object(r.a)({},Object(o.getSnapshot)(c)),{},{oob:!0,coord:c.reversed?Math.floor(c.end-s)+1:Math.floor(c.start+s)+1,offset:s,index:0})}for(var u=e.interRegionPaddingWidth*e.bpPerPx,l=e.minimumBlockWidth*e.bpPerPx,d=0;d<e.displayedRegions.length;d+=1){var f=e.displayedRegions[d],p=f.end-f.start,g=a-n;if(p+n>a&&n<=a)return Object(r.a)(Object(r.a)({},Object(o.getSnapshot)(f)),{},{oob:!1,offset:g,coord:f.reversed?Math.floor(f.end-g)+1:Math.floor(f.start+g)+1,index:d});f.end-f.start>l&&g/e.bpPerPx>0&&g/e.bpPerPx<this.width?n+=p+u:n+=p}if(a>=n){var m=e.displayedRegions[i-1],h=a-n+(m.end-m.start);return Object(r.a)(Object(r.a)({},Object(o.getSnapshot)(m)),{},{oob:!0,offset:h,coord:m.reversed?Math.floor(m.end-h)+1:Math.floor(m.start+h)+1,index:i-1})}return{coord:0,index:0,start:0,refName:"",oob:!0,assemblyName:"",offset:0,reversed:!1}}}})).views((function(e){return{get dynamicBlocks(){return Object(s.a)(e)},get staticBlocks(){return Object(u.a)(e)},get currBp(){return this.dynamicBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},bpToPx:function(t){var n,r=t.refName,a=t.coord,o=t.regionNumber;return null===(n=Object(i.viewBpToPx)({refName:r,coord:a,regionNumber:o,self:e}))||void 0===n?void 0:n.offsetPx}}})).actions((function(e){return{setFeatures:function(t){e.features=t},zoomToDisplayedRegions:function(e,t){if(void 0!==e&&void 0!==t){if(e.refName===t.refName&&e.index===t.index&&t.offset<e.offset||e.index>t.index){var n=[t,e];e=n[0],t=n[1]}var r={start:e.start,end:e.end,index:e.index,offset:e.offset},a={start:t.start,end:t.end,index:t.index,offset:t.offset};if(!r||!a)throw new Error("regions not found");this.moveTo(r,a)}},showAllRegions:function(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var o=t.index+1;o<n.index;o+=1)r+=e.displayedRegions[o].end-e.displayedRegions[o].start;r+=n.offset}this.zoomTo(r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)));for(var i=0,c=0;c<e.displayedRegions.length;c+=1){var s=e.displayedRegions[c];if(t.index===c){i+=t.offset;break}i+=s.end-s.start}e.offsetPx=Math.round(i/e.bpPerPx)+e.interRegionPaddingWidth*t.index},zoomOut:function(){this.zoomTo(2*e.bpPerPx)},zoomIn:function(){this.zoomTo(e.bpPerPx/2)},zoomTo:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2,r=t;if(r!==e.bpPerPx){var a=e.bpPerPx;e.bpPerPx=r,e.offsetPx=Object(i.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset)}},scrollTo:function(t){var n=Object(i.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt:function(t,n,r){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll:function(t){var n=e.offsetPx,r=Object(i.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}}}));t.a=l},286:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return f}));var r=n(88),a=n(89),o=n(86),i=n(81),c=n(11),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(i.a)(this,e),this.blocks=t}return Object(c.a)(e,[{key:"push",value:function(e){if(e instanceof d&&this.blocks.length){var t=this.blocks[this.blocks.length-1];if(t instanceof d)return void t.push(e)}this.blocks.push(e)}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRegions",value:function(){return this.blocks.map((function(e){return e.toRegion()}))}},{key:"map",value:function(e,t){return this.blocks.map(e,t)}},{key:"forEach",value:function(e,t){return this.blocks.forEach(e,t)}},{key:"length",get:function(){return this.blocks.length}},{key:"totalWidthPx",get:function(){return this.blocks.length?this.blocks.map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"totalWidthPxWithoutBorders",get:function(){return this.blocks.length?this.blocks.filter((function(e){return"boundary"!==e.variant})).map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"offsetPx",get:function(){return this.blocks.length?this.blocks[0].offsetPx:0}},{key:"contentBlocks",get:function(){return this.blocks.filter((function(e){return e instanceof l}))}},{key:"totalBp",get:function(){return this.contentBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}]),e}(),u=function(){function e(t){Object(i.a)(this,e),this.regionNumber=void 0,this.reversed=void 0,this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,this.offsetPx=void 0,this.widthPx=0,this.variant=void 0,this.isLeftEndOfDisplayedRegion=void 0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key,this.offsetPx=t.offsetPx}return Object(c.a)(e,[{key:"renameReference",value:function(e){return this.refName&&e!==this.refName?new this.constructor(Object(o.a)(Object(o.a)({},this),{},{refName:e})):this}},{key:"toRegion",value:function(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}]),e}(),l=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n)}(u),d=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).widthPx=void 0,r.elidedBlockCount=0,r.widthPx=e.widthPx,r}return Object(c.a)(n,[{key:"push",value:function(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}]),n}(u),f=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n)}(u)},287:function(e,t,n){"use strict";var r=n(1),a=n.n(r),o=n(84),i=n(79),c=n(51),s=n(1645),u=n(1633),l=Object(c.a)((function(){return{importFormEntry:{minWidth:180}}})),d=Object(o.observer)((function(e){var t=e.session,n=e.onChange,r=e.selected,o=l(),c=t.assemblyNames,d=t.assemblyManager,f=c.length?"":"No configured assemblies";return a.a.createElement(s.a,{select:!0,label:"Assembly",variant:"outlined",margin:"normal",helperText:f||"Select assembly to view",value:f?"":r,inputProps:{"data-testid":"assembly-selector"},onChange:function(e){return n(e.target.value)},error:!!f,disabled:!!f,className:o.importFormEntry},c.map((function(e){var t=d.get(e),n=t?Object(i.getConf)(t,"displayName"):"";return a.a.createElement(u.a,{key:e,value:e},n||e)})))}));t.a=d},328:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return j})),n.d(t,"b",(function(){return x}));var r,a,o,i=n(83),c=n(12),s=n(29),u=n(81),l=n(11),d=n(80),f=n.n(d),p=n(1),g=n.n(p),m=n(426),h=n.n(m),b=n(427),v=n.n(b),y=n(795),O="function"===typeof OffscreenCanvas,w=n.n(y).a,j=function(){function e(t,n){Object(u.a)(this,e),this.width=t,this.height=n,this.commands=[],this.currentFont="12px Courier New, monospace"}return Object(l.a)(e,[{key:"strokeStyle",set:function(e){e!==this.currentStrokeStyle&&(this.commands.push({type:"strokeStyle",style:e}),this.currentStrokeStyle=e)}},{key:"fillStyle",set:function(e){e!==this.currentFillStyle&&(this.commands.push({type:"fillStyle",style:e}),this.currentFillStyle=e)}},{key:"font",set:function(e){this.currentFont=e,this.commands.push({type:"font",style:e})}},{key:"arc",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arc",args:t})}},{key:"arcTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"arcTo",args:t})}},{key:"bezierCurveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"bezierCurveTo",args:t})}},{key:"beginPath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"beginPath",args:t})}},{key:"clearRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clearRect",args:t})}},{key:"clip",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"clip",args:t})}},{key:"closePath",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"closePath",args:t})}},{key:"createLinearGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createLinearGradient",args:t})}},{key:"createPattern",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createPattern",args:t})}},{key:"createRadialGradient",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"createRadialGradient",args:t})}},{key:"drawFocusIfNeeded",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawFocusIfNeeded",args:t})}},{key:"drawImage",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"drawImage",args:t})}},{key:"ellipse",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"ellipse",args:t})}},{key:"fill",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fill",args:t})}},{key:"fillRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],a=t[1],o=t[2],i=t[3];if(!(r>this.width||r+o<0)){var c=Math.max(r,0),s=o-(c-r);this.commands.push({type:"fillRect",args:[c,a,s,i]})}}},{key:"fillText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"fillText",args:t})}},{key:"lineTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"lineTo",args:t})}},{key:"measureText",value:function(e){var t=+this.currentFont.match(/\d+/)[0];return{width:t/2*e.length,height:t}}},{key:"moveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"moveTo",args:t})}},{key:"quadraticCurveTo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"quadraticCurveTo",args:t})}},{key:"rect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rect",args:t})}},{key:"restore",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"restore",args:t})}},{key:"rotate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"rotate",args:t})}},{key:"save",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"save",args:t})}},{key:"setLineDash",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setLineDash",args:t})}},{key:"setTransform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"setTransform",args:t})}},{key:"scale",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"scale",args:t})}},{key:"stroke",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"stroke",args:t})}},{key:"strokeRect",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeRect",args:t})}},{key:"strokeText",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"strokeText",args:t})}},{key:"transform",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"transform",args:t})}},{key:"translate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.commands.push({type:"translate",args:t})}}]),e}();function k(e){var t=v()(e);return{hex:t.hex(),opacity:t.alpha()}}var x=function(){function e(t,n){Object(u.a)(this,e),this.width=t,this.height=n}return Object(l.a)(e,[{key:"getContext",value:function(e){if("2d"!==e)throw new Error("unknown type ".concat(e));return this.context=new j(this.width,this.height),this.context}},{key:"getSerializedSvg",value:function(){var e,t,n,r,a=[],o=[];return this.context.commands.forEach((function(i,u){if("font"===i.type&&i.style){var l=function(e){var t,n=null,r=null,a="normal",o="normal",i="normal",c="normal",s=e.split(/\s+/);e:for(;t=s.shift();)switch(t){case"normal":break;case"italic":case"oblique":a=t;break;case"small-caps":i=t;break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":o=t;break;default:if(!r){var u=t.split("/");r=u[0],u.length>1&&(c=u[1]);break}n=t,s.length&&(n+=" ".concat(s.join(" ")));break e}return{fontStyle:a,fontVariant:i,fontWeight:o,fontSize:r,lineHeight:c,fontFamily:n}}(i.style),d=l.fontStyle,f=l.fontFamily,p=l.fontSize;r={fontStyle:d,fontFamily:f,fontSize:p}}if("fillStyle"===i.type&&i.style&&(e=i.style),"strokeStyle"===i.type&&i.style&&(t=i.style),"fillRect"===i.type){var m=Object(s.a)(i.args,4),b=m[0],v=m[1],y=m[2],O=m[3],w=k(e),j=w.hex,x=w.opacity,C=Math.min(v,v+O),S=Math.abs(O);o.push(g.a.createElement("rect",{key:u,fill:j,fillOpacity:1!==x?x:void 0,x:b.toFixed(3),y:C.toFixed(3),width:y.toFixed(3),height:S.toFixed(3)}))}if("fillText"===i.type){var T=Object(s.a)(i.args,3),E=T[0],M=T[1],R=T[2],P=k(e),A=P.hex,N=P.opacity;o.push(g.a.createElement("text",Object.assign({key:u,fill:A,fillOpacity:1!==N?N:void 0,x:M.toFixed(3),y:R.toFixed(3)},r),E))}if("beginPath"===i.type&&(a=[]),"moveTo"===i.type&&a.push(i.args),"lineTo"===i.type&&a.push(i.args),i.type,"fill"===i.type){for(var L,I=(L=h()()).moveTo.apply(L,Object(c.a)(a[0])),F=1;F<a.length;F++){var D;I=(D=I).lineTo.apply(D,Object(c.a)(a[F]))}I.end();var B=k(e),V=B.hex,z=B.opacity;o.push(g.a.createElement("path",{key:u,fill:V,d:I,fillOpacity:1!==z?z:void 0}))}if("stroke"===i.type){for(var W,U=(W=h()()).moveTo.apply(W,Object(c.a)(a[0])),q=1;q<a.length;q++){var H;U=(H=U).lineTo.apply(H,Object(c.a)(a[q]))}U.end();var _=k(t),G=_.hex,J=_.opacity;o.push(g.a.createElement("path",{key:u,fill:"none",stroke:G,fillOpacity:1!==J?J:void 0,d:U}))}"rotate"===i.type&&(n=180*i.args[0]/Math.PI)})),n?g.a.createElement("g",{transform:"rotate(".concat(n,")")},[].concat(o)):g.a.createElement(g.a.Fragment,null,[].concat(o))}}]),e}();if(O)r=function(e,t){return new OffscreenCanvas(e,t)},a=window.createImageBitmap||self.createImageBitmap,o=window.ImageBitmap||self.ImageBitmap;else if(w){var C=n(1234),S=C.createCanvas,T=C.Image;r=S,a=function(){var e=Object(i.a)(f.a.mark((function e(t){var n,r,a=arguments;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.length<=1||!(a.length-1)){e.next=2;break}throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");case 2:return n=t.toDataURL(),r=new T,e.abrupt("return",new Promise((function(e,t){r.onload=function(){return e(r)},r.onerror=t,r.src=n})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=T}else r=function(e,t){return new x(e,t)},a=function(e){return e.context},o="string"},329:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(83),a=n(80),o=n.n(a),i=n(1),c=n.n(i),s=n(328),u=n(82);function l(e,t,n,r){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(o.a.mark((function e(t,n,r,a){var i,l,d,f,p,g,m,h,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.exportSVG,l=r.highResolutionScaling,d=void 0===l?1:l,!i||i.rasterizeLayers){e.next=7;break}return f=new s.b(t,n),p=f.getContext("2d"),e.next=6,a(p);case 6:return e.abrupt("return",{reactElement:f.getSerializedSvg()});case 7:if(!i||!i.rasterizeLayers){e.next=32;break}return 4,g=Object(s.d)(Math.ceil(4*t),4*n),(m=g.getContext("2d")).scale(4,4),e.next=14,a(m);case 14:if(e.t0=c.a,e.t1=t,e.t2=n,!g.convertToBlob){e.next=27;break}return e.t4=u.blobToDataURL,e.next=21,g.convertToBlob({type:"image/png"});case 21:return e.t5=e.sent,e.next=24,(0,e.t4)(e.t5);case 24:e.t3=e.sent,e.next=28;break;case 27:e.t3=g.toDataURL();case 28:return e.t6=e.t3,e.t7={width:e.t1,height:e.t2,xlinkHref:e.t6},e.t8=e.t0.createElement.call(e.t0,"image",e.t7),e.abrupt("return",{reactElement:e.t8});case 32:return h=Object(s.d)(Math.ceil(t*d),n*d),(b=h.getContext("2d")).scale(d,d),e.next=37,a(b);case 37:return e.next=39,Object(s.e)(h);case 39:return e.t9=e.sent,e.abrupt("return",{imageData:e.t9});case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},333:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(11),a=n(81),o=n(88),i=n(89),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).AdapterClass=void 0,r.configSchema=void 0,r.description=void 0,r.description=e.description,r.configSchema=e.configSchema,r.AdapterClass=e.AdapterClass,!r.AdapterClass)throw new Error("no AdapterClass defined for adapter type ".concat(r.name));return r}return Object(r.a)(n)}(n(192).a)},343:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(29),a=n(103),o=n(81),i=n(11),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,e),this.SubLayoutClass=t,this.subLayouts=new Map,this.subLayoutConstructorArgs={},this.subLayouts=new Map,this.subLayoutConstructorArgs=n}return Object(i.a)(e,[{key:"getSublayout",value:function(e){var t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}},{key:"addRect",value:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,r,a,o)}},{key:"discardRange",value:function(e,t,n){var r=this.subLayouts.get(e);return r&&r.discardRange(t,n)}},{key:"toJSON",value:function(){var e,t={},n=Object(a.a)(this.subLayouts.entries());try{for(n.s();!(e=n.n()).done;){var o=Object(r.a)(e.value,2),i=o[0],c=o[1];t[i]=c.toJSON()}}catch(s){n.e(s)}finally{n.f()}return t}}]),e}()},344:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(11),a=n(81),o=n(88),i=n(89),c=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(a.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n)}(n(232).default)},345:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return s}));var r=n(88),a=n(89),o=n(81),i=n(11),c=function(){function e(t){Object(o.a)(this,e),this.label=void 0,this.renderingComponent=void 0,this.displayString=void 0,this.matchedAttribute=void 0,this.matchedObject=void 0,this.textSearchAdapter=void 0,this.relevance=void 0,this.trackId=void 0,this.score=void 0,this.locString=void 0,this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1}return Object(i.a)(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"getLocation",value:function(){return this.locString||this.label}}]),e}(),s=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var r,a;return Object(o.a)(this,n),(a=t.call(this,e)).refName=void 0,a.refName=null!==(r=e.refName)&&void 0!==r?r:"",a}return Object(i.a)(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(c)},373:function(e,t,n){"use strict";n.r(t),n.d(t,"useStyles",(function(){return K})),n.d(t,"BaseCard",(function(){return $})),n.d(t,"FieldName",(function(){return Z})),n.d(t,"BasicValue",(function(){return ee})),n.d(t,"SimpleValue",(function(){return te})),n.d(t,"BaseCoreDetails",(function(){return ae})),n.d(t,"Attributes",(function(){return ie})),n.d(t,"BaseAttributes",(function(){return ce})),n.d(t,"FeatureDetails",(function(){return se}));var r=n(2),a=n(86),o=n(12),i=n(29),c=n(1),s=n.n(c),u=n(818),l=n(1639),d=n(1641),f=n(1638),p=n(1643),g=n(1636),m=n(1658),h=n(573),b=n.n(h),v=n(51),y=n(437),O=n(84),w=n(26),j=n(1257),k=n.n(j),x=n(79),C=n(82),S=n(435),T=n(83),E=n(80),M=n.n(E),R=n(1757),P=n(1633),A=n(1635),N=n(1260),L=n(337),I=n.n(L);function F(e,t){return e.map((function(e){return t.slice(e.start,e.end)})).join("")}function D(e){return"".concat(e.start,"-").concat(e.end)}function B(e){return e.filter((function(e,t,n){return!t||D(e)!==D(n[t-1])}))}function V(e,t){return e.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{start:t-e.end,end:t-e.start})})).sort((function(e,t){return e.start-t.start}))}var z=Object(v.a)((function(e){return{button:{margin:e.spacing(1)}}})),W="rgb(220,220,180)",U="rgba(250,200,200)";function q(e){var t=e.cds,n=e.sequence;return s.a.createElement("span",{style:{background:W}},F(t,n))}function H(e){for(var t=e.cds,n=e.sequence,r=e.codonTable,a=F(t,n),o="",i=0;i<a.length;i+=3)o+=r[a.slice(i,i+3)]||"&";return s.a.createElement("span",{style:{background:"rgb(220,160,220)"}},o)}function _(e){var t=e.utr,n=e.cds,r=e.exons,a=e.sequence,i=e.upstream,c=e.downstream,u=e.includeIntrons,l=e.collapseIntron,d=n.length?[].concat(Object(o.a)(n),Object(o.a)(t)).sort((function(e,t){return e.start-t.start})):r;return s.a.createElement(s.a.Fragment,null,i?s.a.createElement("span",{style:{background:U}},i):null,d.filter((function(e){return e.start!==e.end})).map((function(e,t){var n,r=a.slice(e.end,null===(n=d[t+1])||void 0===n?void 0:n.start);return s.a.createElement(s.a.Fragment,{key:JSON.stringify(e)},s.a.createElement("span",{style:{background:"CDS"===e.type?W:"rgb(200,240,240)"}},a.slice(e.start,e.end)),u&&t<d.length-1?s.a.createElement("span",{style:{background:undefined}},l&&r.length>20?"".concat(r.slice(0,10),"...").concat(r.slice(-10)):r):null)})),c?s.a.createElement("span",{style:{background:U}},c):null)}var G=s.a.forwardRef((function(e,t){var n=e.feature,r=e.mode,i=e.sequence,c=i.seq,u=i.upstream,l=void 0===u?"":u,d=i.downstream,f=void 0===d?"":d,p=n.subfeatures,g=Object(C.generateCodonTable)(C.defaultCodonTable);if(!p)return null;var m=p.sort((function(e,t){return e.start-t.start})).map((function(e){return Object(a.a)(Object(a.a)({},e),{},{start:e.start-n.start,end:e.end-n.start})})),h=B(m.filter((function(e){return"CDS"===e.type}))),b=B(m.filter((function(e){return e.type.match(/utr/i)}))),v=B(m.filter((function(e){return"exon"===e.type})));if(!b.length&&h.length&&v.length&&(b=function(e,t){var n=e[0],r=e[e.length-1],i=t.findIndex((function(e){return e.end>=n.start&&e.start<=n.start})),c=t.findIndex((function(e){return e.end>=r.end&&e.start<=r.end})),s=t[c],u=t[i],l=[].concat(Object(o.a)(t.slice(0,i)),[{start:u.start,end:n.start}]).map((function(e){return Object(a.a)(Object(a.a)({},e),{},{type:"five_prime_UTR"})})),d=[{start:r.end,end:s.end}].concat(Object(o.a)(t.slice(c+1))).map((function(e){return Object(a.a)(Object(a.a)({},e),{},{type:"three_prime_UTR"})}));return[].concat(Object(o.a)(l),Object(o.a)(d))}(h,v)),-1===n.strand){var y=[Object(C.revcom)(c),Object(C.revcom)(f),Object(C.revcom)(l)];l=y[1],f=y[2],h=V(h,(c=y[0]).length),v=V(v,c.length),b=V(b,c.length)}return s.a.createElement("div",{ref:t,"data-testid":"sequence_panel"},s.a.createElement("div",{style:{fontFamily:"monospace",wordWrap:"break-word",maxWidth:600}},">".concat(n.name||n.id||"unknown","-").concat(r,"\n"),"cds"===r?s.a.createElement(q,{cds:h,sequence:c}):"cdna"===r?s.a.createElement(_,{exons:v,cds:h,utr:b,sequence:c}):"protein"===r?s.a.createElement(H,{cds:h,codonTable:g,sequence:c}):"gene"===r?s.a.createElement(_,{exons:v,cds:h,utr:b,sequence:c,includeIntrons:!0}):"gene_collapsed_intron"===r?s.a.createElement(_,{exons:v,cds:h,sequence:c,utr:b,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===r?s.a.createElement(_,{exons:v,cds:h,sequence:c,utr:b,upstream:l,downstream:f,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===r?s.a.createElement(_,{exons:v,cds:h,sequence:c,utr:b,upstream:l,downstream:f,includeIntrons:!0,collapseIntron:!0}):s.a.createElement("div",null,"Unknown type")))}));function J(e){var t,n=e.model,r=e.feature,a=z(),o=r,u=null===(t=o.subfeatures)||void 0===t?void 0:t.find((function(e){return"CDS"===e.type})),l=Object(c.useRef)(null),d=Object(N.a)(),p=d.ref,m=d.inView,h=Object(c.useState)(),b=Object(i.a)(h,2),v=b[0],y=b[1],O=Object(c.useState)(),w=Object(i.a)(O,2),j=w[0],k=w[1],S=Object(c.useState)(u?"cds":"cdna"),E=Object(i.a)(S,2),L=E[0],F=E[1],D=Object(c.useState)(!1),B=Object(i.a)(D,2),V=B[0],W=B[1],U=Object(c.useState)(!1),q=Object(i.a)(U,2),H=q[0],_=q[1];Object(c.useEffect)((function(){var e,t=!1;if(!n||!m)return function(){};var a=Object(C.getSession)(n),o=a.assemblyManager,c=a.rpcManager,s=(null===(e=n.view)||void 0===e?void 0:e.assemblyNames)||[],u=Object(i.a)(s,1)[0];function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=Object(T.a)(M.a.mark((function e(t,n,r){var a,s,l,d,f,p;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.waitForAssembly(u);case 2:if(a=e.sent){e.next=5;break}throw new Error("assembly not found");case 5:return s="getSequence",e.next=8,c.call(s,"CoreGetFeatures",{adapterConfig:Object(x.getConf)(a,["sequence","adapter"]),sessionId:s,region:{start:t,end:n,refName:a.getCanonicalRefName(r)}});case 8:if(l=e.sent,d=l,f=Object(i.a)(d,1),p=f[0]){e.next=12;break}throw new Error("sequence not found for feature with refName:".concat(r));case 12:return e.abrupt("return",p.get("seq"));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(T.a)(M.a.mark((function e(){var n,a,o,i,c,s,u;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=(n=r).start,o=n.end,i=n.refName,e.next=4,l(a,o,i);case 4:return c=e.sent,e.next=7,l(Math.max(0,a-500),a,i);case 7:return s=e.sent,e.next=10,l(o,o+500,i);case 10:u=e.sent,t||y({seq:c,upstream:s,downstream:u}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),k(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))(),function(){t=!0}}),[r,m,n]);var J=!v;return s.a.createElement("div",{ref:p},s.a.createElement(R.a,{value:L,onChange:function(e){return F(e.target.value)}},u?s.a.createElement(P.a,{value:"cds"},"CDS"):null,u?s.a.createElement(P.a,{value:"protein"},"Protein"):null,s.a.createElement(P.a,{value:"gene"},"Gene w/ introns"),s.a.createElement(P.a,{value:"gene_collapsed_intron"},"Gene w/ 10bp of intron"),s.a.createElement(P.a,{value:"gene_updownstream"},"Gene w/ 500bp up+down stream"),s.a.createElement(P.a,{value:"gene_updownstream_collapsed_intron"},"Gene w/ 500bp up+down stream w/ 10bp intron"),s.a.createElement(P.a,{value:"cdna"},"cDNA")),s.a.createElement(A.a,{className:a.button,type:"button",variant:"contained",onClick:function(){var e=l.current;e&&(I()(e.textContent||"",{format:"text/plain"}),W(!0),setTimeout((function(){return W(!1)}),1e3))}},V?"Copied to clipboard!":"Copy as plaintext"),s.a.createElement(g.a,{title:"Note that 'Copy as HTML' can retain the colors but cannot be pasted into some programs like notepad that only expect plain text"},s.a.createElement(A.a,{className:a.button,type:"button",variant:"contained",onClick:function(){var e=l.current;e&&(I()(e.innerHTML,{format:"text/html"}),_(!0),setTimeout((function(){return _(!1)}),1e3))}},H?"Copied to clipboard!":"Copy as HTML")),s.a.createElement("div",{"data-testid":"feature_sequence"},j?s.a.createElement(f.a,{color:"error"},"".concat(j)):J?s.a.createElement("div",null,"Loading gene sequence..."):v?s.a.createElement(G,{ref:l,feature:o,mode:L,sequence:v}):s.a.createElement("div",null,"No sequence found")))}var X=["id"],Y=["length","position","subfeatures","uniqueId","exonFrames","parentId","thickStart","thickEnd"],Q=["name","start","end","strand","refName","description","type"],K=Object(v.a)((function(e){return{expansionPanelDetails:{display:"block",padding:e.spacing(1)},expandIcon:{color:"#FFFFFF"},field:{display:"flex",flexWrap:"wrap"},fieldDescription:{"&:hover":{background:"yellow"}},fieldName:{wordBreak:"break-all",minWidth:"90px",borderBottom:"1px solid #0003",background:e.palette.grey[200],marginRight:e.spacing(1),padding:e.spacing(.5)},fieldValue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),overflow:"auto"},fieldSubvalue:{wordBreak:"break-word",maxHeight:300,padding:e.spacing(.5),background:e.palette.grey[100],border:"1px solid ".concat(e.palette.grey[300]),boxSizing:"border-box",overflow:"auto"}}}));function $(e){var t=e.children,n=e.title,r=e.defaultExpanded,a=void 0===r||r,o=K(),u=Object(c.useState)(a),g=Object(i.a)(u,2),m=g[0],h=g[1];return s.a.createElement(l.a,{expanded:m,onChange:function(){return h((function(e){return!e}))},TransitionProps:{unmountOnExit:!0}},s.a.createElement(d.a,{expandIcon:s.a.createElement(b.a,{className:o.expandIcon})},s.a.createElement(f.a,{variant:"button"}," ",n)),s.a.createElement(p.a,{className:o.expansionPanelDetails},t))}var Z=function(e){var t=e.description,n=e.name,r=e.prefix,a=void 0===r?[]:r,i=e.width,c=K(),u=[].concat(Object(o.a)(a),[n]).join(".");return t?s.a.createElement(g.a,{title:t,placement:"left"},s.a.createElement("div",{className:Object(w.a)(c.fieldDescription,c.fieldName)},u)):s.a.createElement("div",{className:c.fieldName,style:{width:i}},u)},ee=function(e){var t=e.value,n=K();return s.a.createElement("div",{className:n.fieldValue},s.a.isValidElement(t)?t:s.a.createElement(S.a,{html:k()(t)?JSON.stringify(t):String(t)}))},te=function(e){var t=e.name,n=e.value,r=e.description,a=e.prefix,o=e.width,i=K();return null!==n&&void 0!==n?s.a.createElement("div",{className:i.field},s.a.createElement(Z,{prefix:a,description:r,name:t,width:o}),s.a.createElement(ee,{value:n})):null},ne=function(e){var t=e.name,n=e.value,r=e.description,a=e.prefix,i=void 0===a?[]:a,c=K();return s.a.createElement(s.a.Fragment,null,1===n.length?k()(n[0])?s.a.createElement(ie,{attributes:n[0],prefix:[].concat(Object(o.a)(i),[t])}):s.a.createElement("div",{className:c.field},s.a.createElement(Z,{prefix:i,description:r,name:t}),s.a.createElement(ee,{value:n[0]})):n.every((function(e){return k()(e)}))?n.map((function(e,n){return s.a.createElement(ie,{key:JSON.stringify(e)+"-"+n,attributes:e,prefix:[].concat(Object(o.a)(i),[t+"-"+n])})})):s.a.createElement("div",{className:c.field},s.a.createElement(Z,{prefix:i,description:r,name:t}),n.map((function(e,t){return s.a.createElement("div",{key:JSON.stringify(e)+"-"+t,className:c.fieldSubvalue},s.a.createElement(ee,{value:e}))}))))};function re(e){var t=e.feature,n=t,r=n.refName,o=n.start,c=n.end,u=n.strand,l={"-1":"-",0:"",1:"+"},d=l[u]?"(".concat(l[u],")"):"",f=(o+1).toLocaleString("en-US"),p=c.toLocaleString("en-US"),g=r?"".concat(r,":"):"",m=Object(a.a)(Object(a.a)({},t),{},{length:(c-o).toLocaleString("en-US"),position:"".concat(g).concat(f,"..").concat(p," ").concat(d)});return s.a.createElement(s.a.Fragment,null,["Position","Description","Name","Length","Type"].map((function(e){return[e,m[e.toLowerCase()]]})).filter((function(e){var t=Object(i.a)(e,2)[1];return null!==t&&void 0!==t})).map((function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return s.a.createElement(te,{key:n,name:n,value:r})})))}var ae=function(e){return s.a.createElement($,Object.assign({},e,{title:"Primary data"}),s.a.createElement(re,e))},oe=function(e){var t=e.value,n=e.prefix,c=e.name,u=Object.keys(t[0]).sort(),l=new Set(u);if(t.forEach((function(e){return Object.keys(e).forEach((function(e){return l.add(e)}))})),l.size<u.length+5){var d,f=Object.entries(t).map((function(e){var t=Object(i.a)(e,2),n=t[0],o=t[1],c=o.id,s=Object(r.a)(o,X);return Object(a.a)({id:n,identifier:c},s)}));l.has("id")?(l.delete("id"),d=["identifier"].concat(Object(o.a)(l))):d=Object(o.a)(l);var p=d.map((function(e){return{field:e,width:Math.max.apply(Math,Object(o.a)(f.map((function(t){var n=String(t[e]);return Math.min(Math.max(Object(C.measureText)(n,14)+50,80),1e3)}))))}}));return s.a.createElement(s.a.Fragment,null,s.a.createElement(Z,{prefix:n,name:c}),s.a.createElement("div",{style:{height:20*Math.min(f.length,100)+50+(f.length<100?0:50),width:"100%"}},s.a.createElement(y.DataGrid,{disableSelectionOnClick:!0,rowHeight:20,headerHeight:25,rows:f,rowsPerPageOptions:[],hideFooterRowCount:!0,hideFooterSelectedRowCount:!0,columns:p,hideFooter:f.length<100})))}return null};var ie=function e(t){var n=t.attributes,r=t.omit,a=void 0===r?[]:r,c=t.descriptions,u=t.formatter,l=void 0===u?function(e){return e}:u,d=t.prefix,f=void 0===d?[]:d,p=[].concat(Object(o.a)(a),Y),g=function(e,t){var n=[];return e.forEach((function(e,r){var a=[].concat(Object(o.a)(t),[e[0]]).join(".");n.push(Object(C.measureText)(a,12))})),Math.ceil(Math.max.apply(Math,n))+10}(Object.entries(n).filter((function(e){var t=Object(i.a)(e,2),n=t[0];return void 0!==t[1]&&!p.includes(n)})),f),m=g<=170?g:170;return s.a.createElement(s.a.Fragment,null,Object.entries(n).filter((function(e){var t=Object(i.a)(e,2),n=t[0];return void 0!==t[1]&&!p.includes(n)})).map((function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];if(Array.isArray(a)&&a.length>2&&a.every((function(e){return k()(e)})))return s.a.createElement(oe,{key:r,prefix:f,name:r,value:a});var u=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.forEach((function(e){n&&(n=n[e])})),"string"===typeof n?n:"string"===typeof(null===(t=n)||void 0===t?void 0:t.Description)?n.Description:void 0}([].concat(Object(o.a)(f),[r]),c);return Array.isArray(a)?s.a.createElement(ne,{key:r,name:r,value:a,description:u,prefix:f}):k()(a)?s.a.createElement(e,{omit:p,key:r,attributes:a,descriptions:c,prefix:[].concat(Object(o.a)(f),[r])}):s.a.createElement(te,{key:r,name:r,value:l(a,r),description:u,prefix:f,width:m})})))},ce=function(e){var t=e.feature;return s.a.createElement($,Object.assign({},e,{title:"Attributes"}),s.a.createElement(ie,Object.assign({},e,{attributes:t})))};var se=function e(t){var n,r=t.omit,a=void 0===r?[]:r,i=t.model,c=t.feature,l=t.depth,d=void 0===l?0:l,p=c.name,g=void 0===p?"":p,h=c.id,b=void 0===h?"":h,v=c.type,y=void 0===v?"":v,O=c.subfeatures,w=Object(C.getSession)(i),j=Object(x.getConf)(w,["featureDetails","sequenceTypes"])||["mRNA","transcript"];return s.a.createElement($,{title:[(n=g||b,n.length>20?"".concat(n.slice(0,20),"..."):n),y].filter((function(e){return!!e})).join(" - ")},s.a.createElement(f.a,null,"Core details"),s.a.createElement(re,t),s.a.createElement(m.a,null),s.a.createElement(f.a,null,"Attributes"),s.a.createElement(ie,Object.assign({attributes:c},t,{omit:[].concat(Object(o.a)(a),Q)})),j.includes(c.type)?s.a.createElement(u.ErrorBoundary,{FallbackComponent:function(e){var t=e.error;return s.a.createElement(f.a,{color:"error"},"Failed to fetch sequence for feature: ","".concat(t))}},s.a.createElement(J,t)):null,null!==O&&void 0!==O&&O.length?s.a.createElement($,{title:"Subfeatures",defaultExpanded:!j.includes(c.type)},O.map((function(t){return s.a.createElement(e,{key:JSON.stringify(t),feature:t,model:i,depth:d+1})}))):null)},ue=Object(O.observer)((function(e){var t=e.model,n=t.featureData;if(!n)return null;var r,a=JSON.parse(JSON.stringify(n));return r=a,0===Object.keys(r).length?null:s.a.createElement(se,{model:t,feature:a})}));t.default=ue},424:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return h})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return y})),n.d(t,"c",(function(){return O}));var r=n(83),a=n(11),o=n(81),i=n(88),c=n(89),s=n(661),u=n(80),l=n.n(u),d=n(111),f=n(792),p=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).code=void 0,e}return Object(a.a)(n)}(Object(s.a)(Error));function g(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw v()}}function m(e){return new Promise((function(t){return setTimeout(t,e)}))}function h(e){return b.apply(this,arguments)}function b(){return(b=Object(r.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(1);case 2:g(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){if("undefined"!==typeof DOMException)return new DOMException("aborted","AbortError");var e=new p("aborted");return e.code="ERR_ABORTED",e}function y(e){return e?Object(f.a)(e,"abort"):d.a.create()}function O(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!e.message.match(/\b(aborted|AbortError)\b/i))}},429:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(796),a={};function o(e,t){var n="nosig|".concat(e);if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var o=e.split("jexl:")[1],i=t?t.compile("".concat(o)):Object(r.a)().compile("".concat(o));a[n]=i}return a[n]}},431:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(11),a=n(81),o=n(88),i=n(89),c=n(192),s=n(204),u=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var r;if(Object(a.a)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,!r.stateModel)throw new Error("no stateModel defined for internet account type ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for internet account type ".concat(r.name));if(!Object(s.getDefaultValue)(r.configSchema).type){var o=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(o," is not explicitlyTyped"))}return r}return Object(r.a)(n)}(c.a)},435:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(1),a=n.n(r),o=n(1258),i=n.n(o),c=n(808),s=n.n(c),u=new RegExp(["a","b","br","code","div","em","h1","h2","h3","h4","h5","h6","i","img","li","p","pre","span","small","strong","table","tbody","td","tfoot","th","thead","tr","u","ul"].map((function(e){return"<".concat(e,"\\b[^>]*>")})).join("|"),"i");function l(e){var t,n=e.html,r=(t=n,u.test(t)?n:i()(n));return a.a.createElement("div",{dangerouslySetInnerHTML:{__html:s.a.sanitize(r)}})}},439:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(29),a=n(81),o=n(11),i=n(82),c=n(1266),s=n.n(c),u=function(){function e(t){var n=t.rectangles,o=t.totalHeight,i=t.maxHeightReached;Object(a.a)(this,e),this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rbush=void 0,this.rectangles=new Map(Object.entries(n)),this.totalHeight=o,this.maxHeightReached=i,this.rbush=new s.a;for(var c=0,u=Object.entries(n);c<u.length;c++){var l=Object(r.a)(u[c],2),d=l[0],f=l[1];this.rbush.insert({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],name:d})}}return Object(o.a)(e,[{key:"addRect",value:function(e){var t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}},{key:"getRectangles",value:function(){return this.rectangles}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"collides",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getByCoord",value:function(e,t){var n={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(n)?this.rbush.search(n)[0].name:void 0}},{key:"getByID",value:function(e){return this.rectangles.get(e)}},{key:"addRectToBitmap",value:function(e,t){throw new Error("Method not implemented.")}},{key:"discardRange",value:function(e,t){throw new Error("Method not implemented.")}},{key:"serializeRegion",value:function(e){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{rectangles:Object(i.objectFromEntries)(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1}}}]),e}()},440:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(81),a=n(11),o=n(429),i=function(){function e(t){var n=t.filters,a=void 0===n?[]:n;Object(r.a)(this,e),this.filterChain=void 0,this.filterChain=a.map((function(e){if("string"===typeof e)return{expr:Object(o.a)(e),string:e};throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}return Object(a.a)(e,[{key:"passes",value:function(){for(var e=0;e<this.filterChain.length;e+=1)if(!this.filterChain[e].expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}},{key:"toJSON",value:function(){return{filters:this.filterChain.map((function(e){return e.string}))}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()},442:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(51),i=Object(o.a)((function(e){return{message:{border:"1px solid black",background:"#f88",overflow:"auto",maxHeight:200,margin:e.spacing(1),padding:e.spacing(1)},errorBox:{background:"lightgrey",border:"1px solid black",margin:20}}}));t.default=function(e){var t=e.error,n=i(),r="",o="".concat(t),c="is not assignable",s=o.indexOf(c);if(-1!==s){var u=o.slice(0,s+c.length),l=u.match(/.*at path "(.*)" snapshot `(.*)` is not assignable/m);l&&(o="Failed to load element at ".concat(l[1],"...Failed element had snapshot"),r=l[2]);var d=u.match(/.*snapshot `(.*)` is not assignable/);d&&(o="Failed to load element...Failed element had snapshot",r=d[1])}return a.a.createElement("div",{className:n.message},o.slice(0,1e4),r?a.a.createElement("pre",{className:n.errorBox},JSON.stringify(JSON.parse(r),null,2)):null)}},444:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(86),a=n(83),o=n(81),i=n(11),c=n(142),s=n(132),u=n(88),l=n(89),d=n(80),f=n.n(d),p=n(258),g=n(807),m=n(256),h=n(255),b=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=Object(a.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArgsInClient",value:function(e){var t=Object(r.a)(Object(r.a)({},e),{},{displayModel:{}});return Object(c.a)(Object(s.a)(n.prototype),"serializeArgsInClient",this).call(this,t)}},{key:"deserializeResultsInClient",value:function(e,t){var a=Object(c.a)(Object(s.a)(n.prototype),"deserializeResultsInClient",this).call(this,e,t);return Object(r.a)(Object(r.a)({},a),{},{blockKey:t.blockKey})}},{key:"renderInClient",value:function(){var e=Object(a.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"ComparativeRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"getFeatures",value:function(){var e=Object(a.a)(f.a.mark((function e(t){var n,a,o,i,c,s,u,l,d=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,a=t.sessionId,o=t.adapterConfig,e.next=3,Object(h.b)(this.pluginManager,a,o);case 3:if(i=e.sent,c=i.dataAdapter,s=[],(s=t.regions)&&0!==s.length){e.next=10;break}return console.warn("no regions supplied to comparative renderer"),e.abrupt("return",[]);case 10:return u=s.map((function(e){var t=Object(r.a)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),l=c.getFeaturesInMultipleRegions(u,{signal:n}),e.abrupt("return",l.pipe(Object(p.a)((function(e){return d.featurePassesFilters(t,e)})),Object(g.a)()).toPromise());case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(m.default)},445:function(e,t,n){"use strict";var r=n(85),a=n(106),o=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string)}).volatile((function(){return{width:800}})).views((function(){return{menuItems:function(){return[]}}})).actions((function(e){return{setDisplayName:function(t){e.displayName=t},setWidth:function(t){e.width=t}}}));t.a=o},454:function(e,t,n){"use strict";function r(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),o=Math.pow(10,a);o<r&&!((o*=2)>=r);)o*=2.5;var i=(o=Math.max(o,5))/e,c=0;return!(o%10)&&i/10>=n?c=o/10:!(o%5)&&i/5>=n?c=o/5:!(o%2)&&i/2>=n&&(c=o/2),{majorPitch:o,minorPitch:c}}function a(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=r(n,60,15),c=e,s=t;if(null===c||null===s)return[];if(n<0){var u=[s,c];c=u[0],s=u[1]}c-=Math.abs(20*n)-1,s+=Math.abs(20*n)+1;for(var l=i.minorPitch||i.majorPitch,d=0,f=[],p=Math.ceil(c/l)*l;p<s;p+=l)o&&p%(2*i.majorPitch)?(f.push({type:"minor",base:p-1,index:d}),d+=1):!a||p%(2*i.majorPitch)||(f.push({type:"major",base:p-1,index:d}),d+=1);return f}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}))},455:function(e,t,n){"use strict";var r=n(12),a=n(86),o=n(83),i=n(29),c=n(80),s=n.n(c),u=n(1),l=n.n(u),d=n(84),f=n(82),p=n(345),g=n(1637),m=n(1645),h=n(61),b=n(1685),v=n(1642),y=n(1638),O=n(1314),w=n.n(O),j=n(961),k=n(589),x=n.n(k),C=n(862),S=Object(u.lazy)((function(){return n.e(73).then(n.bind(null,1443))}));var T=function(e){var t=e.style;return l.a.createElement(g.a,Object.assign({},e,{style:{width:"fit-content",minWidth:Math.min(+((null===t||void 0===t?void 0:t.width)||0),200),background:"white"},placement:"bottom-start"}))};t.a=Object(d.observer)((function(e){var t=e.model,n=e.showHelp,c=void 0===n||n,d=e.onSelect,g=e.assemblyName,O=e.style,k=e.fetchResults,E=e.value,M=e.minWidth,R=void 0===M?200:M,P=e.TextFieldProps,A=void 0===P?{}:P,N=Object(f.getSession)(t),L=N.assemblyManager,I=Object(u.useState)(!1),F=Object(i.a)(I,2),D=F[0],B=F[1],V=Object(u.useState)(!0),z=Object(i.a)(V,2),W=z[0],U=z[1],q=Object(u.useState)(!1),H=Object(i.a)(q,2),_=H[0],G=H[1],J=Object(u.useState)(""),X=Object(i.a)(J,2),Y=X[0],Q=X[1],K=Object(u.useState)(""),$=Object(i.a)(K,2),Z=$[0],ee=$[1],te=Object(u.useState)(),ne=Object(i.a)(te,2),re=ne[0],ae=ne[1],oe=Object(f.useDebounce)(Y,300),ie=t.coarseVisibleLocStrings,ce=t.hasDisplayedRegions,se=g?L.get(g):void 0,ue=(null===se||void 0===se?void 0:se.regions)||[],le=Object(u.useMemo)((function(){return ue.map((function(e){return{result:new p.a({refName:e.refName,label:e.refName,matchedAttribute:"refName"})}}))}),[ue]);Object(u.useEffect)((function(){var e=!0;return Object(o.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,""!==oe&&g){t.next=3;break}return t.abrupt("return");case 3:return U(!1),t.next=6,k(oe);case 6:n=t.sent,e&&(ae(Object(C.a)(n,(function(e){return e.getDisplayString()})).map((function(e){return{result:e}}))),U(!0)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e&&N.notify("".concat(t.t0),"error");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))(),function(){e=!1}}),[g,k,oe,N,t]);var de=ie||E||"",fe=Math.min(Math.max(Object(f.measureText)(de,16)+45,R),550);return l.a.createElement(l.a.Fragment,null,l.a.createElement(j.a,{id:"refNameAutocomplete-".concat(t.id),"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,PopperComponent:T,disabled:!g,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:Object(a.a)(Object(a.a)({},O),{},{width:fe}),value:de,loading:!W,inputValue:Z,onInputChange:function(e,t){return ee(t)},loadingText:"loading results",open:D,onOpen:function(){return B(!0)},onClose:function(){B(!1),U(!0),ce&&(Q(""),ae(void 0))},onChange:function(e,t){t&&g&&(d("string"===typeof t?new p.b({label:t}):t.result),ee(de))},options:null!==re&&void 0!==re&&re.length?re:le,getOptionDisabled:function(e){return"limitOption"===(null===e||void 0===e?void 0:e.group)},filterOptions:function(e,t){var n=function(e,t){return e.filter((function(e){var n=e.result;return n.getLabel().toLowerCase().includes(t)||n.matchedObject}))}(e,t.inputValue.toLocaleLowerCase());return[].concat(Object(r.a)(n.slice(0,100)),Object(r.a)(n.length>100?[{group:"limitOption",result:new p.b({label:"keep typing for more results"})}]:[]))},renderInput:function(e){var t=A.helperText,n=A.InputProps,r=void 0===n?{}:n;return l.a.createElement(m.a,Object.assign({onBlur:function(){ee(de)}},e,A,{helperText:t,InputProps:Object(a.a)(Object(a.a)(Object(a.a)({},e.InputProps),r),{},{endAdornment:l.a.createElement(l.a.Fragment,null,0===ue.length?l.a.createElement(h.a,{color:"inherit",size:20}):l.a.createElement(b.a,{position:"end",style:{marginRight:7}},l.a.createElement(w.a,null),c?l.a.createElement(v.a,{onClick:function(){return G(!0)}},l.a.createElement(x.a,null)):null),e.InputProps.endAdornment)}),placeholder:"Search for location",onChange:function(e){Q(e.target.value)}}))},renderOption:function(e){var t=e.result,n=t.getRenderingComponent();return n&&l.a.isValidElement(n)?n:l.a.createElement(y.a,{noWrap:!0},t.getDisplayString())},getOptionLabel:function(e){return("string"===typeof e?e:e.result.getLabel())||""}}),_?l.a.createElement(u.Suspense,{fallback:l.a.createElement("div",null)},l.a.createElement(S,{handleClose:function(){return G(!1)}})):null)}))},457:function(e,t,n){"use strict";(function(e,r){var a=n(83),o=n(80),i=n.n(o),c=n(79),s=n(117),u=n(82),l=n(1331),d=n.n(l),f=n(867),p=n.n(f),g=n(85);function m(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function h(){return"object"===typeof self&&self.self===self&&self||"object"===typeof e&&e.global===e&&e||this}t.a=function(e){return g.types.compose("OAuthInternetAccount",s.InternetAccount,g.types.model("OAuthModel",{type:g.types.literal("OAuthInternetAccount"),configuration:Object(c.ConfigurationReference)(e)})).volatile((function(){var e=h(),t=new Uint8Array(32);return e.crypto.getRandomValues(t),{codeVerifierPKCE:m(r.from(t).toString("base64"))}})).views((function(e){return{get authEndpoint(){return Object(c.getConf)(e,"authEndpoint")},get tokenEndpoint(){return Object(c.getConf)(e,"tokenEndpoint")},get needsPKCE(){return Object(c.getConf)(e,"needsPKCE")},get clientId(){return Object(c.getConf)(e,"clientId")},get scopes(){return Object(c.getConf)(e,"scopes")},get responseType(){return Object(c.getConf)(e,"responseType")},get hasRefreshToken(){return Object(c.getConf)(e,"hasRefreshToken")},get refreshTokenKey(){return"".concat(e.internetAccountId,"-refreshToken")}}})).actions((function(e){return{storeRefreshToken:function(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken:function(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:function(){return localStorage.getItem(e.refreshTokenKey)},exchangeAuthorizationForAccessToken:function(t,n){var r=this;return Object(a.a)(i.a.mark((function a(){var o,c,s,u,l;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o={code:t,grant_type:"authorization_code",client_id:e.clientId,code_verifier:e.codeVerifierPKCE,redirect_uri:n},c=new URLSearchParams(Object.entries(o)),a.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.toString()});case 4:if((s=a.sent).ok){a.next=16;break}return a.prev=6,a.next=9,s.text();case 9:u=a.sent,a.next=15;break;case 12:a.prev=12,a.t0=a.catch(6),u="";case 15:throw new Error("Failed to obtain token from endpoint: ".concat(s.status," (").concat(s.statusText,")").concat(u?" (".concat(u,")"):""));case 16:return a.next=18,s.json();case 18:return(l=a.sent).refresh_token&&r.storeRefreshToken(l.refresh_token),a.abrupt("return",l.access_token);case 21:case"end":return a.stop()}}),a,null,[[6,12]])})))()},exchangeRefreshForAccessToken:function(t){return Object(a.a)(i.a.mark((function n(){var r,a,o,c,s;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={grant_type:"refresh_token",refresh_token:t,client_id:e.clientId},a=new URLSearchParams(Object.entries(r)),n.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});case 4:if((o=n.sent).ok){n.next=17;break}return e.removeToken(),n.prev=7,n.next=10,o.text();case 10:c=n.sent,n.next=16;break;case 13:n.prev=13,n.t0=n.catch(7),c="";case 16:throw new Error("Network response failure \u2014 ".concat(o.status," (").concat(o.statusText,") ").concat(c?" (".concat(c,")"):""));case 17:return n.next=19,o.json();case 19:return s=n.sent,n.abrupt("return",s.access_token);case 21:case"end":return n.stop()}}),n,null,[[7,13]])})))()}}})).actions((function(e){var t;return{addMessageChannel:function(e,n){var r=this;t=function(t){r.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel:function(){window.removeEventListener("message",t)},finishOAuthWindow:function(t,n,r){var o=this;return Object(a.a)(i.a.mark((function a(){var c,s,u,l,d,f,p,g,m,h;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.data.name==="JBrowseAuthWindow-".concat(e.internetAccountId)){a.next=2;break}return a.abrupt("return",o.deleteMessageChannel());case 2:if(!(c=t.data.redirectUri).includes("access_token")){a.next=12;break}if(s=c.replace("#","?"),u=new URL(s).search,l=new URLSearchParams(u),d=l.get("access_token")){a.next=10;break}return a.abrupt("return",r(new Error("Error with token endpoint")));case 10:return e.storeToken(d),a.abrupt("return",n(d));case 12:if(!c.includes("code")){a.next=34;break}if(f=new URL(c),p=f.search,g=new URLSearchParams(p),m=g.get("code")){a.next=19;break}return a.abrupt("return",r(new Error("Error with authorization endpoint")));case 19:return a.prev=19,a.next=22,e.exchangeAuthorizationForAccessToken(m,f.origin+f.pathname);case 22:return h=a.sent,e.storeToken(h),a.abrupt("return",n(h));case 27:if(a.prev=27,a.t0=a.catch(19),!(a.t0 instanceof Error)){a.next=33;break}return a.abrupt("return",r(a.t0));case 33:return a.abrupt("return",r(new Error(String(a.t0))));case 34:if(!c.includes("access_denied")){a.next=36;break}return a.abrupt("return",r(new Error("OAuth flow was cancelled")));case 36:o.deleteMessageChannel();case 37:case"end":return a.stop()}}),a,null,[[19,27]])})))()},useEndpointForAuthorization:function(t,r){var o=this;return Object(a.a)(i.a.mark((function a(){var c,s,l,f,g,h,b,v,y,O,w;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=u.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,s={client_id:e.clientId,redirect_uri:c,response_type:e.responseType||"code"},e.scopes&&(s.scope=e.scopes),e.needsPKCE&&(l=e.codeVerifierPKCE,f=m(p.a.stringify(d()(l))),s.code_challenge=f,s.code_challenge_method="S256"),e.hasRefreshToken&&(s.token_access_type="offline"),g=new URLSearchParams(Object.entries(s)),(h=new URL(e.authEndpoint)).search=g.toString(),b="JBrowseAuthWindow-".concat(e.internetAccountId),!u.isElectron){a.next=19;break}return v=n(1332),y=v.ipcRenderer,a.next=14,y.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:s,url:h.toString()});case 14:O=a.sent,w=new MessageEvent("message",{data:{name:b,redirectUri:O}}),o.finishOAuthWindow(w,t,r),a.next=21;break;case 19:"width=500,height=600,left=0,top=0",window.open(h,b,"width=500,height=600,left=0,top=0");case 21:case"end":return a.stop()}}),a)})))()},getTokenFromUser:function(t,n){var r=this;return Object(a.a)(i.a.mark((function a(){var o;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(o=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=7;break}return a.t0=t,a.next=5,e.exchangeRefreshForAccessToken(o);case 5:a.t1=a.sent,(0,a.t0)(a.t1);case 7:r.addMessageChannel(t,n),r.useEndpointForAuthorization(t,n);case 9:case"end":return a.stop()}}),a)})))()}}}))}}).call(this,n(123),n(99).Buffer)},461:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(86),a=n(29),o=n(12),i=n(81),c=n(11),s=n(213),u=function(){function e(t){Object(i.a)(this,e),this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}return Object(c.a)(e,[{key:"get",value:function(e){return"samples"===e?this.variant.SAMPLES:this.data[e]||this.variant[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat(Object(o.a)(Object.keys(this.data)),Object(o.a)(Object.keys(this.variant)),["samples"])}},{key:"id",value:function(){return this._id}},{key:"dataFromVariant",value:function(e){var t=e.REF,n=e.ALT,r=e.POS,o=e.CHROM,i=e.INFO,c=e.ID,s=r-1,u=this._getSOTermAndDescription(t,n),l=Object(a.a)(u,2),d=l[0],f=l[1],p=null===n||void 0===n?void 0:n.some((function(e){return"<TRA>"===e}));return{refName:o,start:s,end:(null===n||void 0===n?void 0:n.some((function(e){return-1!==e.indexOf("<")})))&&i.END&&!p?+i.END[0]:s+t.length,description:f,type:d,name:null===c||void 0===c?void 0:c.join(","),aliases:c&&c.length>1?e.ID.slice(1):void 0}}},{key:"_getSOTermAndDescription",value:function(e,t){var n=this;if(!t||t===[])return["remark","no alternative alleles"];var r=new Set,i=new Set;if(t.forEach((function(t){var o=n._getSOAndDescFromAltDefs(e,t),c=Object(a.a)(o,2),s=c[0],u=c[1];if(!s){var l=n._getSOAndDescByExamination(e,t),d=Object(a.a)(l,2);s=d[0],u=d[1]}s&&u&&(r.add(s),i.add(u))})),i.size>1){var c=new Set(Object(o.a)(i).map((function(e){var t=e.split("->");return t[1]?t[0]:e}))),s=Object(o.a)(c).map((function(e){var t=Object(o.a)(i).map((function(t){var n=t.split("-> ");return n[1]&&n[0]===e?n[1]:""})).filter((function(e){return!!e}));return t.length?e+"-> "+t.join(","):Object(o.a)(i).join(",")}));i=new Set(s)}return r.size?[Object(o.a)(r).join(","),Object(o.a)(i).join(",")]:[void 0,void 0]}},{key:"_getSOAndDescFromAltDefs",value:function(t,n){if("string"===typeof n&&!n.startsWith("<"))return[void 0,void 0];var r=e._altTypeToSO[n];if(!r&&this.parser.getMetadata("ALT",n)&&(r="sequence_variant"),r)return[r,n];var a=n.split(":");return a.length>1?this._getSOAndDescFromAltDefs(t,"<".concat(a.slice(0,a.length-1).join(":"),">")):[void 0,void 0]}},{key:"_getSOAndDescByExamination",value:function(e,t){return Object(s.b)(t)?["breakend",t]:1===e.length&&1===t.length?["SNV",this._makeDescriptionString("SNV",e,t)]:"<INS>"===t?["insertion",t]:"<DEL>"===t||"<INV>"===t?["deletion",t]:"<TRA>"===t?["translocation",t]:t.includes("<")?["sv",t]:e.length===t.length?e.split("").reverse().join("")===t?["inversion",this._makeDescriptionString("inversion",e,t)]:["substitution",this._makeDescriptionString("substitution",e,t)]:e.length<=t.length?["insertion",this._makeDescriptionString("insertion",e,t)]:e.length>t.length?["deletion",this._makeDescriptionString("deletion",e,t)]:["indel",this._makeDescriptionString("indel",e,t)]}},{key:"_makeDescriptionString",value:function(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}},{key:"toJSON",value:function(){return Object(r.a)(Object(r.a)(Object(r.a)({uniqueId:this._id},this.variant),this.data),{},{samples:this.variant.SAMPLES})}}]),e}();u._altTypeToSO={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"}},463:function(e,t,n){"use strict";var r=n(29),a=n(103),o=n(81),i=n(11),c=n(80),s=n.n(c),u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(o.a)(this,t),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}return Object(i.a)(t,[{key:"_set",value:function(e,t){this.cache.set(e,t),this._size+=1,this._size>=this.maxSize&&(this._size=0,this.oldCache=this.cache,this.cache=new Map)}},{key:"get",value:function(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){var t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}},{key:"set",value:function(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}},{key:"has",value:function(e){return this.cache.has(e)||this.oldCache.has(e)}},{key:"peek",value:function(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}},{key:"delete",value:function(e){var t=this.cache.delete(e);return t&&(this._size-=1),this.oldCache.delete(e)||t}},{key:"clear",value:function(){this.cache.clear(),this.oldCache.clear(),this._size=0}},{key:"keys",value:s.a.mark((function e(){var t,n,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return o=Object(r.a)(n.value,1),i=o[0],e.next=7,i;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"values",value:s.a.mark((function e(){var t,n,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)(this),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return o=Object(r.a)(n.value,2),i=o[1],e.next=7,i;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:e,value:s.a.mark((function e(){var t,n,o,i,c,u,l,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(a.a)(this.cache),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return o=n.value,e.next=7,o;case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:i=Object(a.a)(this.oldCache),e.prev=18,i.s();case 20:if((c=i.n()).done){e.next=28;break}if(u=c.value,l=Object(r.a)(u,1),d=l[0],this.cache.has(d)){e.next=26;break}return e.next=26,u;case 26:e.next=20;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(18),i.e(e.t1);case 33:return e.prev=33,i.f(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[1,11,14,17],[18,30,33,36]])}))},{key:"size",get:function(){var e,t=0,n=Object(a.a)(this.oldCache.keys());try{for(n.s();!(e=n.n()).done;){var r=e.value;this.cache.has(r)||(t+=1)}}catch(o){n.e(o)}finally{n.f()}return this._size+t}}]),t}(Symbol.iterator);t.a=u},568:function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"f",(function(){return f}));var r=n(12),a=n(85),o=n(204);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify(Object(a.getSnapshot)(e)));if("string"===typeof t){var r=e[t];if(!r&&Object(a.isStateTreeNode)(e)&&Object(a.isMapType)(Object(a.getType)(e))&&(r=e.get(t)),!r)return;if(r.expr){var o=r.expr.evalSync(n);return Object(a.isStateTreeNode)(o)?JSON.parse(JSON.stringify(Object(a.getSnapshot)(o))):o}return Object(a.isStateTreeNode)(r)?JSON.parse(JSON.stringify(Object(a.getSnapshot)(r))):r}var c=t[0];if(t.length>1){var s=t.slice(1),u=e[c];if(!u&&Object(a.isStateTreeNode)(e)&&Object(a.isMapType)(Object(a.getType)(e))&&(u=e.get(c)),!u)return;return i(u,s,n)}return i(e,c,n)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var r=e,a=r.configuration;if(d(a))return i(a,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if(Object(a.isType)(e)&&(e=Object(o.resolveLateType)(e),Object(a.isUnionType)(e))){var t=[];return Object(o.getUnionSubTypes)(e).forEach((function(e){var n=s(e=Object(o.resolveLateType)(e));n.length||(n=[Object(o.getDefaultValue)(e).type]);if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push.apply(t,Object(r.a)(n))})),t}return[]}function u(e){if(Object(a.isType)(e)){if(Object(a.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if(Object(a.isLateType)(e))return!0}return!1}function l(e){return!!Object(a.isType)(e)&&(!!u(e)||(Object(a.isUnionType)(e)?Object(o.getUnionSubTypes)(e).every((function(e){return l(e)||"undefined"===e.name})):!(!Object(a.isOptionalType)(e)||!l(Object(o.getSubType)(e)))||(!(!Object(a.isArrayType)(e)||!l(Object(o.getSubType)(e)))||!(!Object(a.isMapType)(e)||!l(Object(o.getSubType)(e))))))}function d(e){return Object(a.isStateTreeNode)(e)&&l(Object(a.getType)(e))}function f(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},577:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(29),a=n(229),o=n(82),i=n(286);function c(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e.offsetPx,s=e.displayedRegions,u=e.bpPerPx,l=e.width,d=e.minimumBlockWidth,f=e.interRegionPaddingWidth;if(!l)throw new Error("view has no width, cannot calculate displayed blocks");var p=new i.a,g=0,m=c,h=m+l;return s.forEach((function(e,b){var v=e.assemblyName,y=e.refName,O=e.start,w=e.end,j=e.reversed,k=g+(w-O)/u,x=(w-O)/u;if(g<h&&k>m){var C,S,T,E,M,R=Object(a.b)(m,h,g,k),P=Object(r.a)(R,2),A=P[0],N=P[1];j?(C=Math.max(O,w-(N-g)*u),T=(S=w-(A-g)*u)===w,E=C===O,M=g+(w-S)/u):(T=(C=(A-g)*u+O)===O,E=(S=Math.min(w,(N-g)*u+O))===w,M=g+(C-O)/u);var L={assemblyName:v,refName:y,start:C,end:S,reversed:j,offsetPx:M,parentRegion:e,regionNumber:b,widthPx:(S-C)/u,isLeftEndOfDisplayedRegion:T,isRightEndOfDisplayedRegion:E,key:""};L.key="".concat(Object(o.assembleLocString)(L),"-").concat(b).concat(j?"-reversed":""),t&&0===p.length&&T&&p.push(new i.d({key:"".concat(L.key,"-beforeFirstRegion"),widthPx:-c,offsetPx:L.offsetPx+c,variant:"boundary"})),n&&x<d?p.push(new i.c(L)):p.push(new i.b(L)),t&&(x>=d&&L.isRightEndOfDisplayedRegion&&b<s.length-1&&(p.push(new i.d({key:"".concat(L.key,"-rightpad"),widthPx:f,offsetPx:L.offsetPx+L.widthPx})),g+=f),b===s.length-1&&L.isRightEndOfDisplayedRegion&&(M=L.offsetPx+L.widthPx,p.push(new i.d({key:"".concat(L.key,"-afterLastRegion"),widthPx:l-M+c,offsetPx:M,variant:"boundary"}))))}g+=(w-O)/u})),p}},579:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(103),a=n(29),o=n(81),i=n(11),c=n(82),s=1e4;function u(e,t,n,r){return t>=n&&r>=e}var l=function(){function e(){Object(o.a)(this,e),this.padding=void 0,this.allFilled=void 0,this.widthLimit=void 0,this.rowState=void 0,this.padding=1,this.widthLimit=1e6}return Object(i.a)(e,[{key:"setAllFilled",value:function(e){this.allFilled=e}},{key:"getItemAt",value:function(e){if(this.allFilled)return this.allFilled;if(this.rowState&&void 0!==this.rowState.min&&!(e<this.rowState.min)&&!(e>=this.rowState.max)){var t=e-this.rowState.offset;return this.rowState.bits[t]}}},{key:"isRangeClear",value:function(e,t){if(this.allFilled)return!1;if(!this.rowState)return!0;var n=this.rowState,r=n.min,a=n.max;if(t<=r||e>=a)return!0;for(var o=Math.min(a,t),i=Math.max(r,e);i<t&&i<o;i+=1)if(this.getItemAt(i))return!1;return!0}},{key:"initialize",value:function(e,t){var n=t-e;return{offset:e-n,min:e,max:t,bits:new Array(3*n)}}},{key:"addRect",value:function(e,t){var n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));var a=n-this.rowState.offset,o=r-this.rowState.offset,i=this.rowState.bits.length;if(o>=this.rowState.bits.length){var c=o+1;this.rowState.bits.length+c>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):c>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(c)))}if(n<this.rowState.offset){var s=Math.min(i-a,this.rowState.offset);this.rowState.bits.length+s>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=new Array(s).concat(this.rowState.bits),this.rowState.offset-=s)}(o=r-this.rowState.offset)-(a=n-this.rowState.offset)>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(o-a," bits in a single row."),e,t);for(var u=a;u<o;u+=1)this.rowState.bits[u]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}},{key:"discardRange",value:function(e,t){if(!this.allFilled&&this.rowState&&!(t<=this.rowState.min||e>=this.rowState.max))if(e<=this.rowState.min&&t>=this.rowState.max)this.rowState=void 0;else{if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-s&&this.rowState.bits.length>this.rowState.max+s-this.rowState.offset){var n=this.rowState.min-this.rowState.offset,r=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(n,this.rowState.bits.length-r),this.rowState.offset+=n}else if(this.rowState.offset<this.rowState.min-s){var a=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,a),this.rowState.offset+=a}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+s){var o=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=o}for(var i=Math.max(this.rowState.min,e)-this.rowState.offset,c=Math.min(t,this.rowState.max)-this.rowState.offset,u=i;u>=0&&u<c;u+=1)this.rowState.bits[u]=void 0}}}]),e}(),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pitchX,r=void 0===n?10:n,a=t.pitchY,i=void 0===a?10:a,c=t.maxHeight,s=void 0===c?1e4:c,u=t.hardRowLimit,l=void 0===u?1e4:u,d=t.displayMode,f=void 0===d?"normal":d;Object(o.a)(this,e),this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=r,this.pitchY=i,this.hardRowLimit=l,this.maxHeightReached=!1,this.displayMode=f,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(s/this.pitchY),this.pTotalHeight=0}return Object(i.a)(e,[{key:"addRect",value:function(e,t,n,r,a){var o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);var i=Math.floor(t/this.pitchX),c=Math.floor(n/this.pitchX),s=Math.ceil(r/this.pitchY),u={id:e,l:i,r:c,top:null,h:s,originalHeight:r,data:a},l=this.maxHeight-s,d=0;if("collapse"!==this.displayMode){for(;d<=l&&this.collides(u,d);d+=1);if(d>l)return u.top=null,this.rectangles.set(e,u),this.maxHeightReached=!0,null}return u.top=d,this.addRectToBitmap(u),this.rectangles.set(e,u),this.pTotalHeight=Math.max(this.pTotalHeight||0,d+s),d*this.pitchY}},{key:"collides",value:function(e,t){for(var n=this.bitmap,r=t+e.h,a=t;a<r;a+=1){var o=n[a];if(o&&!o.isRangeClear(e.l,e.r))return!0}return!1}},{key:"autovivifyRow",value:function(e,t){var n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new l,e[t]=n}return n}},{key:"addRectToBitmap",value:function(e){if(null!==e.top){var t=e.data||e.id,n=this.bitmap,r=e.top+e.h;if(e.r-e.l>2e4)for(var a=e.top;a<r;a+=1)this.autovivifyRow(n,a).setAllFilled(t);else for(var o=e.top;o<r;o+=1)this.autovivifyRow(n,o).addRect(e,t)}}},{key:"discardRange",value:function(e,t){for(var n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),a=this.bitmap,o=0;o<a.length;o+=1){var i=a[o];i&&i.discardRange(n,r)}}},{key:"hasSeen",value:function(e){return this.rectangles.has(e)}},{key:"getByCoord",value:function(e,t){var n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(r){var a=Math.floor(e/this.pitchX);return r.getItemAt(a)}}},{key:"getByID",value:function(e){var t=this.rectangles.get(e);if(t){var n=t.top*this.pitchY;return[t.l*this.pitchX,n,t.r*this.pitchX,n+t.originalHeight]}}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}},{key:"totalHeight",get:function(){return this.getTotalHeight()}},{key:"getRectangles",value:function(){var e=this;return new Map(Array.from(this.rectangles.entries()).map((function(t){var n=Object(a.a)(t,2),r=n[0],o=n[1],i=o.l,c=o.r,s=o.originalHeight,u=(o.top||0)*e.pitchY,l=u+s;return[r,[i*e.pitchX,u,c*e.pitchX,l]]})))}},{key:"serializeRegion",value:function(e){var t,n={},o=!1,i=Object(r.a)(this.rectangles.entries());try{for(i.s();!(t=i.n()).done;){var c=Object(a.a)(t.value,2),s=c[0],l=c[1],d=l.l,f=l.r,p=l.originalHeight,g=l.top;if(null===l.top)o=!0;else{var m=(g||0)*this.pitchY,h=m+p,b=d*this.pitchX,v=f*this.pitchX;u(e.start,e.end,b-this.pitchX,v+this.pitchX)&&(n[s]=[b,m,v,h])}}}catch(y){i.e(y)}finally{i.f()}return{rectangles:n,totalHeight:this.getTotalHeight(),maxHeightReached:o}}},{key:"toJSON",value:function(){return{rectangles:Object(c.objectFromEntries)(this.getRectangles()),totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}]),e}()},582:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(2),a=n(1644),o=n(1),i=n.n(o),c=n(32),s=n(108),u=n(82),l=["theme","html","RenderingComponent"];function d(e){var t=Object(o.useRef)(null),n=e.theme,d=e.html,f=e.RenderingComponent,p=Object(r.a)(e,l),g=Object(s.createJBrowseTheme)(n);return Object(o.useEffect)((function(){var e=t.current;return e&&(e&&Object(c.unmountComponentAtNode)(e),e.innerHTML=d,Object(u.rIC)((function(){Object(c.hydrate)(i.a.createElement(a.a,{theme:g},i.a.createElement(f,p)),e)}),{timeout:300})),function(){e&&Object(c.unmountComponentAtNode)(e)}}),[d,g,p,f]),i.a.createElement("div",{ref:t,"data-html-size":d.length,className:"ssr-container"})}},583:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(103),a=n(81),o=n(11),i=n(82),c=function(){function e(t,n,r,o,c,s){if(Object(a.a)(this,e),this.name=t,this.left=n,this.top=r,this.width=o,this.height=c,this.data=s,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,i.inDevelopment&&("string"!==typeof t||"number"!==typeof n||Number.isNaN(n)||"number"!==typeof r||Number.isNaN(r)||"number"!==typeof o||Number.isNaN(o)||"number"!==typeof c||Number.isNaN(c)))throw new TypeError("invalid SceneGraph arguments");this.children=new Map,this.absoluteCache={dirty:!0}}return Object(o.a)(e,[{key:"addChild",value:function(t,n,r,a,o,i){var c;if(!((c=t instanceof e?t:new e(t,n,r,a,o,i))instanceof e))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(c.name))throw new Error('child named "'.concat(c.name,'" already exists'));c.parent=this;var s=c.absolute,u=s.left,l=s.right,d=s.top,f=s.bottom;return void 0!==u&&void 0!==l&&void 0!==d&&void 0!==f&&(this.expand(u,l,d,f),this.children.set(c.name,c)),c}},{key:"getSubRecord",value:function(e){return this.children.get(e)}},{key:"expand",value:function(e,t,n,r){var a=this.absolute,o=a.left,i=a.right,c=a.top,s=a.bottom;if(void 0!==o&&e<o){var u=o-e;this.width+=u,this.left-=u}if(void 0!==i&&t>i&&(this.width+=t-i),void 0!==c&&n<c){var l=c-n;this.height+=l,this.top-=l}void 0!==s&&r>s&&(this.height+=r-s),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}},{key:"walkParents",value:function(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}},{key:"walkChildren",value:function(e){var t,n=Object(r.a)(this.children.values());try{for(n.s();!(t=n.n()).done;){var a=t.value;e(a),a.walkChildren(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"absolute",get:function(){if(this.absoluteCache.dirty){var e=0,t=0;this.walkParents((function(n){e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}},{key:"move",value:function(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((function(e){e.absoluteCache.dirty=!0}));var n=this.absolute,r=n.left,a=n.right,o=n.top,i=n.bottom;void 0!==r&&void 0!==a&&void 0!==o&&void 0!==i&&this.expand(r,a,o,i)}}]),e}()},585:function(e,t,n){"use strict";function r(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function a(e,t,n){return r(e,t)||r(e,n)}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o}));var o={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}}},587:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var r=n(86),a=n(1),o=n.n(a),i=n(51),c=n(84),s=Object(i.a)((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),u=Object(c.observer)((function(e){var t=e.block,n=e.children,r=s(),a=t.widthPx;return o.a.createElement("div",{style:{width:a},className:r.contentBlock},n)}));function l(e){var t=e.width,n=s();return o.a.createElement("div",{className:n.elidedBlock,style:{width:t}})}function d(e){var t=e.boundary,n=e.width,a=e.style,i=void 0===a?{}:a,c=s();return o.a.createElement("div",{style:Object(r.a)(Object(r.a)({},i),{},{width:n}),className:t?c.boundaryPaddingBlock:c.interRegionPaddingBlock})}},590:function(e,t,n){"use strict";var r=n(12),a=n(83),o=n(80),i=n.n(o),c=n(1),s=n.n(c),u=n(84),l=n(51),d=n(140),f=n(13),p=n(345),g=n(82),m=n(455),h=n(862),b=n(197),v=Object(l.a)((function(){return{headerRefName:{minWidth:100}}}));t.a=Object(u.observer)((function(e){var t=e.model,n=e.showHelp,o=v(),c=Object(d.a)(),u=Object(g.getSession)(t),l=u.textSearchManager,y=u.assemblyManager,O=t.assemblyNames,w=t.rankSearchResults,j=O[0],k=y.get(j),x=t.searchScope(j);function C(e,t){return S.apply(this,arguments)}function S(){return(S=Object(a.a)(i.a.mark((function e(t,n){var a,o,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l||console.warn("No text search manager"),e.next=3,null===l||void 0===l?void 0:l.search({queryString:t,searchType:n},x,w);case 3:return o=e.sent,c=null===k||void 0===k||null===(a=k.allRefNames)||void 0===a?void 0:a.filter((function(e){return e.startsWith(t)})).map((function(e){return new p.b({label:e})})).slice(0,10),e.abrupt("return",Object(h.a)([].concat(Object(r.a)(c||[]),Object(r.a)(o||[])),(function(e){return e.getId()})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(a.a)(i.a.mark((function e(n){var r,a,o,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getTrackId(),a=n.getLocation(),o=n.getLabel(),e.prev=3,null===k||void 0===k||null===(c=k.allRefNames)||void 0===c||!c.includes(a)){e.next=8;break}t.navToLocString(a),e.next=19;break;case 8:return e.next=10,C(o,"exact");case 10:if(!((s=e.sent)&&s.length>1)){e.next=16;break}return t.setSearchResults(s,o.toLowerCase()),e.abrupt("return");case 16:1===(null===s||void 0===s?void 0:s.length)&&(a=s[0].getLocation(),r=s[0].getTrackId());case 17:t.navToLocString(a,j),r&&t.showTrack(r);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),console.error(e.t0),u.notify("".concat(e.t0),"warning");case 25:case"end":return e.stop()}}),e,null,[[3,21]])})))).apply(this,arguments)}return s.a.createElement(m.a,{showHelp:n,onSelect:function(e){return T.apply(this,arguments)},assemblyName:j,fetchResults:C,model:t,TextFieldProps:{variant:"outlined",className:o.headerRefName,style:{margin:b.e,minWidth:"175px"},InputProps:{style:{padding:0,height:b.g,background:Object(f.a)(c.palette.background.paper,.8)}}}})}))},595:function(e,t,n){"use strict";var r=n(29),a=n(1),o=n.n(a),i=n(82),c=n(51),s=n(814),u=n(1646),l=n(1648),d=n(84),f=Object(c.a)({error:{color:"red",fontSize:"0.8em"}}),p=Object(a.lazy)((function(){return Promise.all([n.e(17),n.e(43)]).then(n.bind(null,1561))}));t.a=Object(d.observer)((function(e){var t=e.slot,n=f(),c=Object(a.useState)(JSON.stringify(t.value,null,"  ")),d=Object(r.a)(c,2),g=d[0],m=d[1],h=Object(a.useState)(),b=Object(r.a)(h,2),v=b[0],y=b[1],O=Object(i.useDebounce)(g,400);return Object(a.useEffect)((function(){try{t.set(JSON.parse(O)),y(void 0)}catch(e){y(e.message)}}),[O]),o.a.createElement(o.a.Fragment,null,v?o.a.createElement("p",{className:n.error},v):null,o.a.createElement(s.a,{error:v},o.a.createElement(u.a,{shrink:!0,htmlFor:"callback-editor"},t.name),o.a.createElement(o.a.Suspense,{fallback:o.a.createElement("div",null)},o.a.createElement(p,{contents:g,setContents:m})),o.a.createElement(l.a,null,t.description)))}))},598:function(e,t,n){"use strict";function r(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.pxToBp(e),a=r.assemblyName,o=r.refName,i=r.start,c=r.offset,s=r.oob,u=Math.floor(i+c);return s?"out of bounds":"".concat(n?"{"+a+"}":"").concat(o,":").concat(u.toLocaleString("en-US"))}function a(e,t,n){var r=[],a=e.slice(0).sort((function(e,t){var n=e.end-e.start;return t.end-t.start-n})),o=new Array(Math.round(t));return a.forEach((function(e){var a=e.key,i=e.offsetPx,c=Math.round(t-i+n),s=[Math.max(c-12,0),c];0===c||o.slice.apply(o,s).some(Boolean)?r.push(a):o.fill.apply(o,[!0].concat(s))})),r}function o(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),o=Math.pow(10,a);o<r&&!((o*=2)>=r);)o*=2.5;var i=(o=Math.max(o,5))/e,c=0;return!(o%10)&&i/10>=n?c=o/10:!(o%5)&&i/5>=n?c=o/5:!(o%2)&&i/2>=n&&(c=o/2),{majorPitch:o,minorPitch:c}}function i(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[],i=o(t,60,15),c=i.minorPitch||i.majorPitch,s=0;s<e.length;s++)for(var u=e[s],l=u.start,d=u.end,f=u.refName,p=0,g=l,m=d,h=Math.ceil(g/c)*c;h<m;h+=c)r&&h%i.majorPitch?(a.push({type:"minor",base:h-1,index:p,refName:f}),p+=1):n&&Math.abs(h-u.start)>i.minorPitch&&(a.push({type:"major",base:h-1,index:p,refName:f}),p+=1);return a}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return i}))},657:function(e,t,n){"use strict";n.d(t,"d",(function(){return q})),n.d(t,"b",(function(){return W})),n.d(t,"c",(function(){return U})),n.d(t,"a",(function(){return L}));var r=n(83),a=n(81),o=n(11),i=n(88),c=n(89),s=n(80),u=n.n(s),l=n(1),d=n(107),f=n(82),p=n(120),g=n(205),m=n(1337),h=n.n(m),b=n(86),v=n(103),y=n(85),O=n(106),w=n(79),j=n(117),k=n(29);function x(e,t,n,r,a){var o=Math.abs(e-n);if(!(o>r)){o===r&&a.push([t,e]);var i=Math.sqrt(r*r-o*o);a.push([t-i,e]),a.push([t+i,e])}}function C(e,t,n,r,a){var o=Math.abs(e-t);if(!(o>r)){o===r&&a.push([e,n]);var i=Math.sqrt(r*r-o*o);a.push([e,n-i]),a.push([e,n+i])}}function S(e,t){var n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];var r=function(e,t){var n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}var T=2*Math.PI;var E=function(){function e(t,n,r,o){Object(a.a)(this,e),this.region=n,this.radianWidth=o,this.key=void 0,this.offsetRadians=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.flipped=void 0;var i=t.bpPerRadian;this.key=Object(f.assembleLocString)(n),this.offsetRadians=r,this.bpPerRadian=i,this.flipped=!1,this.startRadians=this.offsetRadians,this.endRadians=n.widthBp/this.bpPerRadian+this.offsetRadians,Object.freeze(this)}return Object(o.a)(e,[{key:"bpToXY",value:function(e,t){var n=(this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start)/this.bpPerRadian+this.offsetRadians;return Object(f.polarToCartesian)(t,n)}},{key:"toJSON",value:function(){return Object(f.objectFromEntries)(Object.entries(this))}}]),e}();function M(e,t){var n,r,a,o,i=Object(k.a)(e.visibleSection.theta,2),c=i[0],s=i[1];return n=t.offsetRadians+e.offsetRadians,r=t.radianWidth,a=c,o=s-c,!(r<=0||o<=0)&&(r+1e-4>=T||o+1e-4>=T||(n=(n%T+T)%T+T)<(a=(a%T+T)%T+T)+o&&n+r>a||n<(a-=T)+o&&n+r>a||n<(a+=T+T)+o&&n+r>a)}function R(e){return y.types.compose(j.BaseViewModel,y.types.model("CircularView",{type:y.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:2e6,tracks:y.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:y.types.optional(y.types.refinement("trackHeight",y.types.number,(function(e){return e>=40})),400),minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,displayedRegions:y.types.array(O.Region),scrollX:0,scrollY:0,trackSelectorType:"hierarchical"}).volatile((function(){return{width:0}})).views((function(e){return{get staticSlices(){return function(e){var t,n=[],r=0,a=Object(v.a)(e.elidedRegions);try{for(a.s();!(t=a.n()).done;){var o=t.value,i=o.widthBp/e.bpPerRadian+e.spacingPx/e.pxPerRadian;n.push(new E(e,o,r,i)),r+=i}}catch(c){a.e(c)}finally{a.f()}return n}(e)},get visibleStaticSlices(){return this.staticSlices.filter(M.bind(this,e))},get visibleSection(){return function(e,t,n){var r=Object(k.a)(e,4),a=r[0],o=r[1],i=r[2],c=r[3],s=Object(k.a)(t,2),u=s[0],l=s[1];if(o-=u,i-=l,c-=l,(a-=u)<0&&o>0&&i<0&&c>0){for(var d=[[a,i],[o,i],[a,c],[o,c]],f=-1/0,p=0;p<d.length;p+=1){var g=Object(k.a)(d[p],2),m=g[0],h=g[1],b=Math.sqrt(m*m+h*h);b>f&&(f=b)}return{rho:[0,Math.min(n,f)],theta:[0,2*Math.PI]}}var v=[[a,i],[o,i],[a,c],[o,c]];C(a,0,0,n,v),C(o,0,0,n,v),x(i,0,0,n,v),x(c,0,0,n,v),-a<n&&v.push([a,0]),o<n&&v.push([o,0]),-i<n&&v.push([0,i]),c<n&&v.push([0,c]);for(var y=a>=0?-1:1,O=1/0,w=-1/0,j=1/0,T=-1/0,E=0;E<v.length;E+=1){var M=Object(k.a)(v[E],2),R=M[0],P=M[1];if(R>=a&&R<=o&&P>=i&&P<=c){var A=S(R*y,P*y),N=Object(k.a)(A,2),L=N[0],I=N[1];L<=n+.001&&(I<j&&L>1e-4&&(j=I),I>T&&L>1e-4&&(T=I),L<O&&(O=L),L>w&&(w=L))}}return-1===y&&(j+=Math.PI,T+=Math.PI),j>2*Math.PI&&T>2*Math.PI&&(j-=2*Math.PI,T-=2*Math.PI),{rho:[O,Math.min(n,w)],theta:[j,T]}}([e.scrollX,e.scrollX+e.width,e.scrollY,e.scrollY+e.height],this.centerXY,this.radiusPx)},get circumferencePx(){var t,n=0,r=Object(v.a)(this.elidedRegions);try{for(r.s();!(t=r.n()).done;){n+=t.value.widthBp}}catch(a){r.e(a)}finally{r.f()}return n/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){var t,n=0,r=Object(v.a)(e.displayedRegions);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a.end-a.start}}catch(o){r.e(o)}finally{r.f()}return n},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){var t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){var e=2*Math.PI*this.maximumRadiusPx;return Object(f.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){var t=[];e.displayedRegions.forEach((function(n){var r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){var a=t[t.length-1];a&&a.elided?(a.regions.push(Object(b.a)({},n)),a.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[Object(b.a)({},n)]})}else t.push(Object(b.a)(Object(b.a)({},n),{},{widthBp:r}))}));for(var n=0;n<t.length;n+=1){var r=t[n];r.elided&&1===r.regions.length&&(delete r.elided,t[n]=Object(b.a)(Object(b.a)({},r),r.regions[0]))}return t},get assemblyNames(){var t=[];return e.displayedRegions.forEach((function(e){t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){var t=Object(f.getSession)(e).assemblyManager;return this.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))}}})).volatile((function(){return{error:void 0}})).actions((function(t){return{setWidth:function(e){return t.width=Math.max(e,100),t.width},setHeight:function(e){return t.height=Math.max(e,40),t.height},resizeHeight:function(e){var n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth:function(e){var n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton:function(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton:function(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton:function(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton:function(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx:function(e){t.bpPerPx=Object(f.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust:function(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView:function(){Object(y.getParent)(t,2).removeView(t)},setDisplayedRegions:function(e){var n=0===t.displayedRegions.length;t.displayedRegions=Object(y.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=Object(f.getSession)(t);if(Object(f.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setError:function(e){console.error(e),t.error=e},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),o=Object(y.resolveIdentifier)(a,Object(y.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),u=o.displays.find((function(e){return s.includes(e.type)})),l=i.stateModel.create(Object(b.a)(Object(b.a)({},r),{},{type:o.type,configuration:o,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},addTrackConf:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type,o=Object(w.readConfObject)(n,"name"),i=e.getTrackType(a);if(!i)throw new Error("unknown track type ".concat(n.type));var c=e.getViewType(t.type),s=c.displayTypes.map((function(e){return e.name})),u=n.displays.find((function(e){return s.includes(e.type)})),l=i.stateModel.create(Object(b.a)(Object(b.a)({},r),{},{name:o,type:a,configuration:n,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(y.resolveIdentifier)(r,Object(y.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===a}));return Object(d.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length},toggleFitToWindowLock:function(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow}}})))}var P=function(e){var t=e.lib,n=t.react,r=n.useState,a=n.useEffect,o=t["@material-ui/core/styles"].makeStyles,i=t["mobx-react"].observer,c=o((function(e){return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:e.palette.primary.light},"25%":{stroke:e.palette.secondary.light},"50%":{stroke:e.palette.tertiary.light},"75%":{stroke:e.palette.quaternary.light},"100%":{stroke:e.palette.primary.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}));return i((function(e){var t=e.model.renderProps.radius,o=c(),i=r(!1),s=Object(k.a)(i,2),u=s[0],l=s[1];return a((function(){var e=setTimeout((function(){return l(!0)}),400);return function(){return clearTimeout(e)}})),u?n.createElement("g",null,n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}}))),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),n.createElement("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),n.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},"Loading\u2026"),n.createElement("circle",{className:o.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})):null}))},A=function(e){var t=e.jbrequire,n=t("react"),r=t("@material-ui/core/styles").makeStyles,a=t("mobx-react").observer,o=r({errorMessage:{},errorBackground:{},errorText:{}});return a((function(e){var t=e.model,r=t.renderProps.radius,a=t.error,i=o();return n.createElement("g",{className:i.errorMessage},n.createElement("defs",null,n.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},n.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}}))),n.createElement("circle",{className:i.errorBackground,cx:"0",cy:"0",r:r,fill:"#ffb4b4"}),n.createElement("circle",{className:i.errorPattern,cx:"0",cy:"0",r:r,fill:"url(#diagonalHatch)"}),n.createElement("text",{className:i.errorText,x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},String(a)))}))},N=function(e){var t=e.jbrequire,n=t("react"),r=t("mobx-state-tree").isAlive,a=n.useEffect,o=n.useRef,i=t("mobx-react"),c=i.observer,s=(i.PropTypes,t("react-dom")),u=s.unmountComponentAtNode,l=s.hydrate,d=t("@jbrowse/core/util").rIC;return c((function(e){var t=e.model,i=t.data,c=t.html,s=t.filled,f=t.renderingComponent,p=o(null);return a((function(){var e=p.current;return e&&s&&(e&&e.innerHTML&&(e.style.display="none",u(e)),e.style.outline="none",e.innerHTML=c,d((function(){if(r(t)){var a=n.createElement(f,Object(b.a)(Object(b.a)({},i),t.renderProps()),null);d((function(){r(t)&&l(a,e)}))}}))),function(){e&&u(e)}})),n.createElement("g",{ref:p})}))},L=function(e){var t=e.lib,n=e.load,r=t.react,a=t["mobx-react"],o=a.observer,i=(a.PropTypes,n(P)),c=n(A),s=n(N);return o((function(e){var t=e.display;return t.error?r.createElement(c,{model:t}):t.filled?r.createElement(s,{model:t}):r.createElement(i,{model:t})}))},I=n(344),F=n(119),D=n(105),B=n(2),V=["html"],z=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util/tracks").getRpcSessionId,a=t("@jbrowse/core/util").getContainingView,o=t("@jbrowse/core/util").getSession;function i(){return(i=Object(r.a)(u.a.mark((function e(t,n,r){var a,o,i,c,s,l,d,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:if(a=t.rendererType,o=t.rpcManager,i=t.cannotBeRenderedReason,c=t.renderArgs,s=t.renderProps,!i){e.next=5;break}return e.abrupt("return",{message:i});case 5:if(t.renderProps.radius&&t.renderArgs.regions&&t.renderArgs.regions.length){e.next=7;break}return e.abrupt("return",{message:"Skipping render"});case 7:if(r.isCompatibleWithRenderer(a)){e.next=9;break}throw new Error("renderer ".concat(a.name," is not compatible with this display type"));case 9:return e.next=11,a.renderInClient(o,Object(b.a)(Object(b.a)(Object(b.a)({},c),s),{},{signal:n}));case 11:return l=e.sent,d=l.html,f=Object(B.a)(l,V),e.abrupt("return",{html:d,data:f,renderingComponent:a.ReactComponent});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{renderReactionData:function(e){var t,r=a(e),i=e.rendererType;return{rendererType:i,rpcManager:o(r).rpcManager,renderProps:e.renderProps(),renderArgs:{assemblyName:null===(t=r.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:JSON.parse(JSON.stringify(e.adapterConfig)),rendererType:i.name,regions:JSON.parse(JSON.stringify(r.displayedRegions)),blockDefinitions:e.blockDefinitions,sessionId:n(e),timeout:1e6}}},renderReactionEffect:function(e,t,n){return i.apply(this,arguments)}}},W=y.types.compose("BaseChordDisplay",j.BaseDisplay,y.types.model({bezierRadiusRatio:.1,assemblyName:y.types.maybe(y.types.string)})).volatile((function(){return{filled:!1,reactElement:void 0,data:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}})).actions((function(e){var t=Object(y.getEnv)(e).pluginManager,n=e;return{onChordClick:function(r){Object(w.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}})).views((function(e){return{get blockDefinitions(){var t=Object(f.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;var n=JSON.parse(JSON.stringify(t));return n.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(t){var n,r=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),n},renderProps:function(){var t=Object(f.getContainingView)(e);return Object(b.a)(Object(b.a)({},Object(D.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick})},get rendererType(){var t=e,n=Object(y.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},isCompatibleWithRenderer:function(e){return!!(e instanceof I.a)},get selectedFeatureId(){if(Object(y.isAlive)(e)){var t=Object(f.getSession)(e);if(t){var n=t.selection;return Object(F.b)(n)?n.id():void 0}}}}})).actions((function(e){return{renderStarted:function(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess:function(t){var n=t.message,r=t.data,a=t.reactElement,o=t.renderingComponent;n?(e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=o)},renderError:function(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap:function(t){e.refNameMap=t}}})).actions((function(e){var t=Object(y.getEnv)(e).pluginManager.jbrequire(z),n=t.renderReactionData,a=t.renderReactionEffect;return{afterAttach:function(){Object(f.makeAbortableReaction)(e,n,a,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),Object(f.makeAbortableReaction)(e,(function(){return{assemblyNames:Object(D.getTrackAssemblyNames)(e.parentTrack),adapter:Object(w.getConf)(Object(y.getParent)(e,2),"adapter"),assemblyManager:Object(f.getSession)(e).assemblyManager}}),function(){var t=Object(r.a)(u.a.mark((function t(n,r){var a,o,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.assemblyNames,o=n.adapter,i=n.assemblyManager,t.abrupt("return",i.getRefNameMapForAdapter(o,a[0],{signal:r,sessionId:Object(D.getRpcSessionId)(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(function(){}),(function(t){e.setRefNameMap(t)}),(function(t){console.error(t),e.setError(t)}))}}})),U=Object(w.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),q=function(e){Object(i.a)(s,e);var t=Object(c.a)(s);function s(){var e;Object(a.a)(this,s);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CircularViewPlugin",e}return Object(o.a)(s,[{key:"install",value:function(e){e.addViewType((function(){return new g.a({ReactComponent:Object(l.lazy)((function(){return n.e(23).then(n.bind(null,1753))})),stateModel:R(e),name:"CircularView"})})),e.addToExtensionPoint("LaunchView-CircularView",function(){var e=Object(r.a)(u.a.mark((function e(t){var n,r,a,o,i,c,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,t.loc,a=t.tracks,o=void 0===a?[]:a,i=n.assemblyManager,c=n.addView("CircularView",{}),e.next=5,Object(d.when)((function(){return c.initialized}));case 5:if(r){e.next=7;break}throw new Error("No assembly provided when launching circular genome view");case 7:return e.next=9,i.waitForAssembly(r);case 9:if(s=e.sent){e.next=12;break}throw new Error('Assembly "'.concat(r,'" not found when launching circular genome view'));case 12:c.setDisplayedRegions(s.regions||[]),o.forEach((function(e){return c.showTrack(e)}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"configure",value:function(e){Object(f.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:h.a,onClick:function(e){e.addView("CircularView",{})}})}}]),s}(p.a)},658:function(e,t,n){"use strict";n.d(t,"b",(function(){return W})),n.d(t,"a",(function(){return z}));var r=n(81),a=n(11),o=n(88),i=n(89),c=n(1),s=n(127),u=n(172),l=n(120),d=n(84),f=n(85),p=n(79),g=n(106),m=function(e){return f.types.model("ConfigurationEditorWidget",{id:g.ElementId,type:f.types.literal("ConfigurationEditorWidget"),target:f.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{setTarget:function(t){e.target=t}}}))},h=Object(p.ConfigurationSchema)("ConfigurationEditorWidget",{}),b=Object(d.observer)((function(e){var t=e.model;if(t&&t.target){if(t.target.type)return"".concat(t.target.type," settings");if(Object(f.isStateTreeNode)(t.target)){var n=Object(f.getType)(t.target);if(n&&n.name)return"".concat(n.name.replace("ConfigurationSchema","")," settings")}}return"Settings"})),v=n(103),y=n(12),O=n(83),w=n(80),j=n.n(w),k=n(116),x=n(119),C=n(125),S=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e,a,o){var i;Object(r.a)(this,n),(i=t.call(this,e,a,o)).features=void 0;var c=Object(p.readConfObject)(e,"features");return i.features=n.makeFeatures(c||[]),i}return Object(a.a)(n,[{key:"getRefNames",value:function(){var e=Object(O.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(y.a)(this.features.keys()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){var e=Object(O.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Array.from(this.features.values()).map((function(e){return{refName:e[0].get("refName"),aliases:e[0].get("aliases")}})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,r=e.start,a=e.end;return Object(C.ObservableCreate)(function(){var e=Object(O.a)(j.a.mark((function e(o){var i,c,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=t.features.get(n)||[],c=0;c<i.length;c++)(s=i[c]).get("end")>r&&s.get("start")<a&&o.next(s);o.complete();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}],[{key:"makeFeatures",value:function(e){for(var t=new Map,n=0;n<e.length;n+=1)if(e[n]){var r=this.makeFeature(e[n]),a=r.get("refName"),o=t.get(a);o||(o=[],t.set(a,o)),o.push(r)}var i,c=Object(v.a)(t.values());try{for(c.s();!(i=c.n()).done;){i.value.sort((function(e,t){return e.get("start")-t.get("start")}))}}catch(s){c.e(s)}finally{c.f()}return t}},{key:"makeFeature",value:function(e){return new x.a(e)}}]),n}(k.BaseFeatureDataAdapter),T=n(29),E=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e,a,o){var i;Object(r.a)(this,n),(i=t.call(this,e,a,o)).features=void 0;var c=Object(p.readConfObject)(e,"features");return i.features=S.makeFeatures(c||[]),i}return Object(a.a)(n,[{key:"getRegions",value:function(){var e=Object(O.a)(j.a.mark((function e(){var t,n,r,a,o,i,c,s,u,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(v.a)(this.features);try{for(n.s();!(r=n.n()).done;){a=Object(T.a)(r.value,2),o=a[0],i=a[1],c=void 0,s=Object(v.a)(i);try{for(s.s();!(u=s.n()).done;)l=u.value,c&&c.end>=l.get("start")&&c.start<=l.get("end")?c.end=l.get("end"):(c&&t.push(c),c={refName:o,start:l.get("start"),end:l.get("end")})}catch(d){s.e(d)}finally{s.f()}c&&t.push(c)}}catch(d){n.e(d)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(k.BaseAdapter),M=n(86),R=n(142),P=n(132),A=n(807),N=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"getFeatures",value:function(e){var t=this,r=Object(R.a)(Object(P.a)(n.prototype),"getFeatures",this);return Object(C.ObservableCreate)(function(){var n=Object(O.a)(j.a.mark((function n(a){var o,i;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.call(t,e).pipe(Object(A.a)()).toPromise();case 2:o=n.sent,i=o[0],a.next(new x.a(Object(M.a)(Object(M.a)({},i.toJSON()),{},{uniqueId:"".concat(i.id(),":").concat(e.start,"-").concat(e.end),end:e.end,start:e.start,seq:i.get("seq").slice(Math.max(e.start-i.get("start"),0),Math.max(e.end-i.get("start"),0))}))),a.complete();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"getRegions",value:function(){var e=Object(O.a)(j.a.mark((function e(){var t,n,r,a,o,i,c,s,u,l;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=Object(v.a)(this.features);try{for(n.s();!(r=n.n()).done;){a=Object(T.a)(r.value,2),o=a[0],i=a[1],c=void 0,s=Object(v.a)(i);try{for(s.s();!(u=s.n()).done;)l=u.value,c&&c.end>=l.get("start")&&c.start<=l.get("end")?c.end=l.get("end"):(c&&t.push(c),c={refName:o,start:l.get("start"),end:l.get("end")})}catch(d){s.e(d)}finally{s.f()}c&&t.push(c)}}catch(d){n.e(d)}finally{n.f()}return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(S),L=Object(p.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),I=Object(p.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),F=Object(p.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),D=n(104),B=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"getRefNameAliases",value:function(){var e=Object(O.a)(j.a.mark((function e(){var t,n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=Object(p.readConfObject)(this.config,"location")).uri&&"/path/to/my/aliases.txt"!==t.uri){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Object(D.openLocation)(t).readFile("utf8");case 5:return n=e.sent,r=Object(p.readConfObject)(this.config,"refNameColumn"),e.abrupt("return",n.trim().split("\n").filter((function(e){return!!e&&!e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=t.splice(r,1);return{refName:Object(T.a)(n,1)[0],aliases:t}})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){var e=Object(O.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(k.BaseAdapter),V=Object(p.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0}),z=(n(595),Object(c.lazy)((function(){return Promise.all([n.e(35),n.e(44)]).then(n.bind(null,1744))}))),W=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).name="ConfigurationPlugin",e}return Object(a.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.a({name:"FromConfigAdapter",configSchema:L,AdapterClass:S,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new s.a({name:"FromConfigRegionsAdapter",configSchema:I,AdapterClass:E,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new s.a({name:"FromConfigSequenceAdapter",configSchema:F,AdapterClass:N,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new s.a({name:"RefNameAliasAdapter",configSchema:V,AdapterClass:B,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addWidgetType((function(){return new u.a({name:"ConfigurationEditorWidget",HeadingComponent:b,configSchema:h,stateModel:m(e),ReactComponent:z})}))}}]),n}(l.a)},660:function(e,t,n){"use strict";var r=n(12),a=n(86),o=n(29),i=n(2),c=n(1),s=n.n(c),u=n(1636),l=n(656),d=n(1646),f=n(1263),p=n(1633),g=n(1648),m=n(1672),h=n(1770),b=n(84),v=n(177),y=n(441),O=n.n(y),w=n(51),j=n(814),k=n(1635),x=n(1638),C=n(82),S=n(105);function T(e){return"blobId"in e}var E=Object(w.a)((function(e){return{filename:{marginLeft:e.spacing(1)}}}));var M=function(e){var t=E(),n=e.location,r=e.setLocation,a=n&&(T(n)&&n.name||function(e){return"localPath"in e}(n)&&n.localPath),o=n&&T(n)&&!Object(S.getBlob)(n.blobId);return s.a.createElement(l.a,{display:"flex",flexDirection:"row",alignItems:"center"},s.a.createElement(l.a,null,s.a.createElement(j.a,{fullWidth:!0},s.a.createElement(k.a,{variant:"outlined",component:"label"},"Choose File",s.a.createElement("input",{type:"file",hidden:!0,onChange:function(e){var t=e.target,n=t&&t.files&&t.files[0];n&&(C.isElectron?r({localPath:n.path,locationType:"LocalPathLocation"}):r(Object(S.storeBlobLocation)({blob:n})))}})))),s.a.createElement(l.a,null,s.a.createElement(x.a,{component:"span",className:t.filename,color:a?"initial":"textSecondary"},a||"No file chosen"),o?s.a.createElement(x.a,{color:"error"},"(need to reload)"):null))},R=n(1645);var P=Object(b.observer)((function(e){var t=e.location,n=e.setLocation,r=e.label;return s.a.createElement(s.a.Fragment,null,s.a.createElement(R.a,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:t&&Object(v.p)(t)?t.uri:"",label:r||"Enter URL",onChange:function(e){n({uri:e.target.value.trim(),locationType:"UriLocation"})}}))})),A=["title","children"];function N(e){var t=e.title,n=e.children,r=Object(i.a)(e,A);return s.a.createElement(u.a,{title:t||""},s.a.createElement(m.a,r,n))}function L(e,t){return"string"===typeof e&&e.length>t?"".concat(e.substring(0,t),"\u2026"):e}var I=Object(b.observer)((function(e){var t=e.location,n=e.name,i=e.description,u=e.rootModel,b=e.setLocation,y=!t||Object(v.p)(t)?"url":"file",w=Object(c.useState)(t&&"internetAccountId"in t&&t.internetAccountId?t.internetAccountId:y),j=Object(o.a)(w,2),k=j[0],x=j[1],C=Object(v.d)(u)?u.internetAccounts.slice():[],S=Object(c.useState)(C.slice(0,2)),T=Object(o.a)(S,2),E=T[0],R=T[1],A=Object(c.useState)(C.slice(2)),I=Object(o.a)(A,2),F=I[0],D=I[1],B=Object(c.useState)(null),V=Object(o.a)(B,2),z=V[0],W=V[1],U=C.find((function(e){return e.internetAccountId===k})),q=function(e){b(Object(a.a)(Object(a.a)({},e),{},{internetAccountId:U?U.internetAccountId:void 0}))};t&&U&&Object(v.p)(t)&&t.internetAccountId!==U.internetAccountId&&q(t);var H=s.a.createElement(P,Object.assign({},e,{setLocation:q,label:null===U||void 0===U?void 0:U.selectorLabel}));if("file"===k&&(H=s.a.createElement(M,e)),null!==U&&void 0!==U&&U.SelectorComponent){var _=U.SelectorComponent;H=s.a.createElement(_,Object.assign({},e,{setLocation:q}))}return s.a.createElement(s.a.Fragment,null,s.a.createElement(l.a,{display:"flex"},s.a.createElement(d.a,{shrink:!0},n)),s.a.createElement(l.a,{display:"flex",flexDirection:"row"},s.a.createElement(l.a,null,s.a.createElement(h.a,{value:k,exclusive:!0,onChange:function(e,n){n&&x(n),Object(v.p)(t)&&q(t)},"aria-label":"file, url, or account picker"},new URLSearchParams(window.location.search).get("adminKey")?null:s.a.createElement(m.a,{value:"file","aria-label":"local file"},"File"),s.a.createElement(m.a,{value:"url","aria-label":"url"},"URL"),E.map((function(e){var t=e.internetAccountId,n=e.toggleContents,r=e.name;return s.a.createElement(N,{key:t,value:t,"aria-label":r,title:r},"string"===typeof n?L(n,5):n||L(r,5))})),F.length?s.a.createElement(m.a,{onClick:function(e){return W(e.target)},selected:!1},"More",s.a.createElement(O.a,null)):null),s.a.createElement(f.a,{open:Boolean(z),anchorEl:z,onClose:function(){return W(null)},getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},null===F||void 0===F?void 0:F.map((function(e,t){return s.a.createElement(p.a,{key:e.internetAccountId,value:e.internetAccountId,onClick:function(){var n=E[E.length-1];R([].concat(Object(r.a)(E.slice(0,E.length-1)),[e])),D([n].concat(Object(r.a)(F.slice(0,t)),Object(r.a)(F.slice(t+1)))),x(e.internetAccountId),W(null)}},e.name)}))))),H,s.a.createElement(g.a,null,i))}));t.a=I},69:function(e,t,n){"use strict";n.r(t),n.d(t,"Loader",(function(){return up}));var r={};n.r(r),n.d(r,"CoreGetRefNames",(function(){return H})),n.d(r,"CoreGetFileInfo",(function(){return _})),n.d(r,"CoreGetMetadata",(function(){return G})),n.d(r,"CoreGetFeatures",(function(){return J})),n.d(r,"CoreFreeResources",(function(){return X})),n.d(r,"CoreEstimateRegionStats",(function(){return Y})),n.d(r,"CoreRender",(function(){return Q}));var a={};n.r(a),n.d(a,"getScale",(function(){return Be})),n.d(a,"getOrigin",(function(){return Ve})),n.d(a,"getNiceDomain",(function(){return ze}));var o=n(12),i=n(83),c=n(86),s=n(2),u=n(29),l=n(80),d=n.n(l),f=(n(969),n(972),n(973),n(974),n(975),n(976),n(977),n(978),n(979),n(980),n(981),n(982),n(983),n(984),n(985),n(986),n(987),n(988),n(989),n(990),n(991),n(992),n(993),n(995),n(996),n(404),n(997),n(998),n(999),n(1e3),n(1001),n(1002),n(1003),n(1004),n(1005),n(1006),n(1007),n(1008),n(1009),n(1011),n(1013),n(1014),n(1015),n(1016),n(1017),n(1018),n(1019),n(1020),n(1021),n(1022),n(1023),n(1024),n(1026),n(1027),n(1028),n(1030),n(1031),n(1032),n(1033),n(1034),n(1035),n(1036),n(1037),n(1038),n(1039),n(1041),n(1042),n(1043),n(1044),n(1045),n(1046),n(1047),n(1048),n(1049),n(1050),n(1051),n(1052),n(1053),n(1054),n(1055),n(1056),n(1057),n(1058),n(1059),n(1060),n(1061),n(1062),n(1063),n(1064),n(1065),n(1066),n(1067),n(1068),n(1069),n(1070),n(1071),n(1073),n(1074),n(1075),n(1076),n(1083),n(1084),n(1085),n(1087),n(1088),n(1089),n(1090),n(1091),n(1092),n(1093),n(1094),n(1095),n(1096),n(1097),n(1098),n(761),n(1099),n(1100),n(1101),n(1102),n(1103),n(1104),n(1105),n(762),n(1106),n(1107),n(1108),n(1109),n(1110),n(1111),n(1113),n(1114),n(1115),n(1116),n(1117),n(1118),n(1119),n(1120),n(1121),n(1122),n(1123),n(1124),n(1125),n(1126),n(1127),n(1128),n(1129),n(1130),n(1131),n(1132),n(1134),n(1135),n(1136),n(1137),n(1138),n(1139),n(1140),n(1141),n(1142),n(1143),n(1144),n(1145),n(1148),n(1149),n(1150),n(1151),n(1152),n(1153),n(1154),n(1155),n(1156),n(1157),n(1158),n(1159),n(1160),n(1161),n(1162),n(1163),n(1164),n(1165),n(1166),n(1167),n(1168),n(1169),n(1170),n(1171),n(1173),n(1174),n(1175),n(1176),n(1178),n(771),n(1)),p=n.n(f),g=n(103),m=n(81),h=n(11),b=n(85),v=n(247),y=n(127),O=n(182),w=n(149),j=n(205),k=n(172),x=n(277),C=n(248),S=n(431),T=n(333),E=n(79),M=n(120),R=n(953),P=n(88),A=n(89),N=n(106),L=Object(E.ConfigurationSchema)("BaseFeatureWidget",{});function I(e){return b.types.model("BaseFeatureWidget",{id:N.ElementId,type:b.types.literal("BaseFeatureWidget"),featureData:b.types.frozen(),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var F=n(142),D=n(132),B=n(807),V=n(255),z=n(256),W=n(116),U=n(82),q=n(119),H=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetRefNames",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,o=r.adapterConfig,e.next=6,Object(V.b)(this.pluginManager,a,o);case 6:if(i=e.sent,!((c=i.dataAdapter)instanceof W.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",c.getRefNames(r));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),_=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetInfo",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,o=r.adapterConfig,e.next=6,Object(V.b)(this.pluginManager,a,o);case 6:return i=e.sent,c=i.dataAdapter,e.abrupt("return",Object(W.isFeatureAdapter)(c)?c.getHeader(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),G=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetMetadata",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,o=r.adapterConfig,e.next=6,Object(V.b)(this.pluginManager,a,o);case 6:return i=e.sent,c=i.dataAdapter,e.abrupt("return",Object(W.isFeatureAdapter)(c)?c.getMetadata(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),J=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreGetFeatures",e}return Object(h.a)(n,[{key:"deserializeReturn",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r,a){var o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.a)(Object(D.a)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:return o=e.sent,e.abrupt("return",o.map((function(e){return new q.a(e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,s,u,l,f,p,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.signal,o=r.sessionId,i=r.adapterConfig,s=r.region,u=r.opts,e.next=6,Object(V.b)(this.pluginManager,o,i);case 6:if(l=e.sent,f=l.dataAdapter,Object(W.isFeatureAdapter)(f)){e.next=10;break}return e.abrupt("return",[]);case 10:return p=f.getFeatures(s,Object(c.a)(Object(c.a)({},u),{},{signal:a})),e.next=13,p.pipe(Object(B.a)()).toPromise();case 13:return g=e.sent,e.abrupt("return",g.map((function(e){return e.toJSON()})));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),X=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreFreeResources",e}return Object(h.a)(n,[{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,n+=Object(V.a)(t),this.pluginManager.getRendererTypes().forEach((function(e){var t=e.freeResources();t&&(n+=t)})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),Y=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreEstimateRegionStats",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(a=this.pluginManager.rootModel)||void 0===a||null===(o=a.session)||void 0===o?void 0:o.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,Object(U.renameRegionsIfNeeded)(i,Object(c.a)(Object(c.a)({},t),{},{filters:t.filters&&t.filters.toJSON().filters}));case 5:return s=e.sent,e.abrupt("return",Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,s,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,o=r.sessionId,i=r.regions,e.next=6,Object(V.b)(this.pluginManager,o,a);case 6:if(c=e.sent,!((s=c.dataAdapter)instanceof W.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",s.estimateRegionsStats(i,r));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),Q=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="CoreRender",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=null===(a=this.pluginManager.rootModel)||void 0===a||null===(o=a.session)||void 0===o?void 0:o.assemblyManager)){e.next=7;break}return e.next=4,Object(U.renameRegionsIfNeeded)(i,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:return c=e.t0,e.next=11,Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,c,r);case 11:if(s=e.sent,"MainThreadRpcDriver"!==r){e.next=14;break}return e.abrupt("return",s);case 14:return u=t.rendererType,l=K(u,this.pluginManager.getRendererType(u)),e.abrupt("return",l.serializeArgsInClient(s));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(o=(a=r).sessionId,i=a.rendererType,c=a.signal,o){e.next=8;break}throw new Error("must pass a unique session id");case 8:if(Object(U.checkAbortSignal)(c),s=K(i,this.pluginManager.getRendererType(i)),"MainThreadRpcDriver"!==n){e.next=16;break}return e.next=13,s.render(r);case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,s.renderInWorker(r);case 18:e.t0=e.sent;case 19:return u=e.t0,Object(U.checkAbortSignal)(c),e.abrupt("return",u);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r,a){var o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.a)(Object(D.a)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(o=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",o);case 5:return i=r.rendererType,c=K(i,this.pluginManager.getRendererType(i)),e.abrupt("return",c.deserializeResultsInClient(o,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(C.a);function K(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof z.default))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var $=n(104),Z=Object(E.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0}),ee=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"getData",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=Object(E.readConfObject)(this.config,"cytobandLocation")).uri&&"/path/to/cytoband.txt.gz"!==t.uri){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Object($.openLocation)(t).readFile("utf8");case 5:return n=e.sent,e.abrupt("return",n.split("\n").filter((function(e){return!!e.trim()})).map((function(e){var t=e.split("\t"),n=Object(u.a)(t,5),r=n[0],a=n[1],o=n[2],i=n[3],c=n[4];return new q.a({uniqueId:e,refName:r,start:+a,end:+o,name:i,type:c})})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(W.BaseAdapter),te=function(e){Object(P.a)(a,e);var t=Object(A.a)(a);function a(){var e;Object(m.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).name="CorePlugin",e}return Object(h.a)(a,[{key:"install",value:function(e){Object.values(r).forEach((function(t){e.addRpcMethod((function(){return new t(e)}))})),e.addAdapterType((function(){return new y.a({name:"CytobandAdapter",configSchema:Z,AdapterClass:ee})})),e.addWidgetType((function(){return new k.a({name:"BaseFeatureWidget",heading:"Feature details",configSchema:L,stateModel:I(e),ReactComponent:Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,373))}))})}))}}]),a}(M.a),ne=n(796),re=function(){function e(){Object(m.a)(this,e),this.phaseCallbacks=new Map,this.phaseOrder=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.phaseOrder=n}return Object(h.a)(e,[{key:"add",value:function(e,t){if(!this.phaseOrder.includes(e))throw new Error("unknown phase ".concat(e));var n=this.phaseCallbacks.get(e);n||(n=[],this.phaseCallbacks.set(e,n)),n.push(t)}},{key:"run",value:function(){var e=this;this.phaseOrder.forEach((function(t){var n=e.phaseCallbacks.get(t);n&&n.forEach((function(e){return e()}))}))}}]),e}(),ae=function(){function e(t,n){Object(m.a)(this,e),this.typeName=t,this.baseClass=n,this.registeredTypes={}}return Object(h.a)(e,[{key:"add",value:function(e,t){this.registeredTypes[e]=t}},{key:"has",value:function(e){return e in this.registeredTypes}},{key:"get",value:function(e){if(!this.has(e))throw new Error("".concat(this.typeName," '").concat(e,"' not found, perhaps its plugin is not loaded or its plugin has not added it."));return this.registeredTypes[e]}},{key:"all",value:function(){return Object.values(this.registeredTypes)}}]),e}(),oe=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(m.a)(this,e),this.plugins=[],this.jexl=Object(ne.a)(),this.pluginMetadata={},this.runtimePluginDefinitions=[],this.elementCreationSchedule=new re("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account"),this.rendererTypes=new ae("RendererType",v.default),this.adapterTypes=new ae("AdapterType",y.a),this.textSearchAdapterTypes=new ae("TextSearchAdapterType",T.a),this.trackTypes=new ae("TrackType",O.a),this.displayTypes=new ae("DisplayType",w.a),this.connectionTypes=new ae("ConnectionType",x.a),this.viewTypes=new ae("ViewType",j.a),this.widgetTypes=new ae("WidgetType",k.a),this.rpcMethods=new ae("RpcMethodType",C.a),this.internetAccountTypes=new ae("InternetAccountType",S.a),this.configured=!1,this.rootModel=void 0,this.extensionPoints=new Map,this.jbrequireCache=new Map,this.lib=R.a,this.load=function(e){return t.jbrequireCache.has(e)||t.jbrequireCache.set(e,e(t)),t.jbrequireCache.get(e)},this.jbrequire=function(e){if("string"===typeof e){var n=t.lib[e];if(!n)throw new TypeError("No jbrequire re-export defined for package '".concat(e,"'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally."));return n}if("function"===typeof e)return t.load(e);if(e.default)return t.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")},this.addPlugin({plugin:new te,metadata:{isCore:!0}}),n.forEach((function(e){t.addPlugin(e)}))}return Object(h.a)(e,[{key:"pluginConfigurationSchemas",value:function(){var e={};return this.plugins.forEach((function(t){t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}},{key:"addPlugin",value:function(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");var t=e instanceof M.a?[e,{}]:[e.plugin,e.metadata],n=Object(u.a)(t,2),r=n[0],a=n[1],o=void 0===a?{}:a;if(this.plugins.includes(r))throw new Error("plugin already installed");return this.pluginMetadata[r.name]=o,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),r.install(this),this.plugins.push(r),this}},{key:"getPlugin",value:function(e){return this.plugins.find((function(t){return t.name===e}))}},{key:"hasPlugin",value:function(e){return void 0!==this.getPlugin(e)}},{key:"createPluggableElements",value:function(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),delete this.elementCreationSchedule),this}},{key:"setRootModel",value:function(e){this.rootModel=e}},{key:"configure",value:function(){var e=this;if(this.configured)throw new Error("already configured");return this.plugins.forEach((function(t){return t.configure(e)})),this.configured=!0,this}},{key:"getElementTypeRecord",value:function(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;default:throw new Error("invalid element type '".concat(e,"'"))}}},{key:"addElementType",value:function(e,t){var n=this;if("function"!==typeof t)throw new Error("must provide a callback function that returns the new type object");var r=this.getElementTypeRecord(e);return this.elementCreationSchedule&&this.elementCreationSchedule.add(e,(function(){var a=t(n);if(!a.name)throw new Error("cannot add a ".concat(e," with no name"));if(r.has(a.name))throw new Error("".concat(e," ").concat(a.name," already registered, cannot register it again"));a=n.evaluateExtensionPoint("Core-extendPluggableElement",a),r.add(a.name,a)})),this}},{key:"getElementType",value:function(e,t){return this.getElementTypeRecord(e).get(t)}},{key:"getElementTypesInGroup",value:function(e){return this.getElementTypeRecord(e).all()}},{key:"pluggableMstType",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b.types.maybe(b.types.null),r=this.getElementTypeRecord(e).all().map((function(e){return e[t]})).filter((function(e){return Object(b.isType)(e)&&Object(b.isModelType)(e)}));return 0===r.length?(console.warn("No JBrowse pluggable types found matching ('".concat(e,"','").concat(t,"')")),n):b.types.union.apply(b.types,Object(o.a)(r))}},{key:"pluggableConfigSchemaType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"configSchema",n=this.getElementTypeRecord(e).all().map((function(e){return e[t]})).filter((function(e){return Object(E.isBareConfigurationSchemaType)(e)}));return 0===n.length&&n.push(Object(E.ConfigurationSchema)("Null",{})),b.types.union.apply(b.types,Object(o.a)(n))}},{key:"getRendererType",value:function(e){return this.rendererTypes.get(e)}},{key:"getRendererTypes",value:function(){return this.rendererTypes.all()}},{key:"getAdapterType",value:function(e){return this.adapterTypes.get(e)}},{key:"getTextSearchAdapterType",value:function(e){return this.textSearchAdapterTypes.get(e)}},{key:"getTrackType",value:function(e){return this.trackTypes.get(e)}},{key:"getDisplayType",value:function(e){return this.displayTypes.get(e)}},{key:"getViewType",value:function(e){return this.viewTypes.get(e)}},{key:"getWidgetType",value:function(e){return this.widgetTypes.get(e)}},{key:"getConnectionType",value:function(e){return this.connectionTypes.get(e)}},{key:"getRpcMethodType",value:function(e){return this.rpcMethods.get(e)}},{key:"getInternetAccountType",value:function(e){return this.internetAccountTypes.get(e)}},{key:"addRendererType",value:function(e){return this.addElementType("renderer",e)}},{key:"addAdapterType",value:function(e){return this.addElementType("adapter",e)}},{key:"addTextSearchAdapterType",value:function(e){return this.addElementType("text search adapter",e)}},{key:"addTrackType",value:function(e){var t=this;return this.addElementType("track",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.trackType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addDisplayType",value:function(e){return this.addElementType("display",e)}},{key:"addViewType",value:function(e){var t=this;return this.addElementType("view",(function(){var n=e(t);return t.getElementTypesInGroup("display").forEach((function(e){e.viewType!==n.name||n.displayTypes.includes(e)||n.addDisplayType(e)})),n}))}},{key:"addWidgetType",value:function(e){return this.addElementType("widget",e)}},{key:"addConnectionType",value:function(e){return this.addElementType("connection",e)}},{key:"addRpcMethod",value:function(e){return this.addElementType("rpc method",e)}},{key:"addInternetAccountType",value:function(e){return this.addElementType("internet account",e)}},{key:"addToExtensionPoint",value:function(e,t){var n=this.extensionPoints.get(e);n||(n=[],this.extensionPoints.set(e,n)),n.push(t)}},{key:"evaluateExtensionPoint",value:function(e,t){var n=this.extensionPoints.get(e),r=t;if(n){var a,o=Object(g.a)(n);try{for(o.s();!(a=o.n()).done;){var i=a.value;try{r=i(r)}catch(c){console.error(c)}}}catch(s){o.e(s)}finally{o.f()}}return r}},{key:"evaluateAsyncExtensionPoint",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.extensionPoints.get(t),a=n,!r){e.next=27;break}o=Object(g.a)(r),e.prev=4,o.s();case 6:if((i=o.n()).done){e.next=19;break}return c=i.value,e.prev=8,e.next=11,c(a);case 11:a=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),console.error(e.t0);case 17:e.next=6;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(4),o.e(e.t1);case 24:return e.prev=24,o.f(),e.finish(24);case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,this,[[4,21,24,27],[8,14]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),ie=n(84),ce=n(818),se=n(949),ue=n(108),le=(n(1308),n(1309),n(449)),de=n.n(le),fe=n(330),pe=n.n(fe);function ge(){return(ge=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,f,p,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,"https://analytics.jbrowse.org/api/v1",a=t.jbrowse.tracks.filter((function(e){return(Object(E.readConfObject)(e,"assemblyNames")||[]).length>1})).length,o=Object.keys(localStorage).filter((function(e){return e.includes("localSaved-")})).length,i=t.jbrowse,c=t.session,s=t.version,u=i.tracks,l=i.assemblies,f=i.plugins,p={ver:s,"plugins-count":(null===f||void 0===f?void 0:f.length)||0,"plugin-names":null===f||void 0===f?void 0:f.map((function(e){return e.name})).join(","),"assemblies-count":l.length,"tracks-count":u.length,"session-tracks-count":(null===c||void 0===c?void 0:c.sessionTracks.length)||0,"open-views":(null===c||void 0===c?void 0:c.views.length)||0,"synteny-tracks-count":a,"saved-sessions-count":o,"existing-session-param-type":(null===r||void 0===r?void 0:r.split("-")[0])||"none","scn-h":window.screen.height,"scn-w":window.screen.width,"win-h":window.innerHeight,"win-w":window.innerWidth,electron:U.isElectron,loadTime:(Date.now()-n)/1e3,jb2:!0},u.forEach((function(e){var t="track-types-".concat(e.type);p[t]=p[t]+1||1})),null===c||void 0===c||c.sessionTracks.forEach((function(e){var t="sessionTrack-types-".concat(e.type);p[t]=p[t]+1||1})),g=Object.keys(p).map((function(e){return"".concat(e,"=").concat(p[e])})).join("&"),e.next=12,fetch("".concat("https://analytics.jbrowse.org/api/v1","?").concat(g));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),console.error("Failed to write analytics to AWS.",e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}function me(){return(me=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"UA-7115575-5",a={"tracks-count":t.jbrowse.tracks.length,ver:t.version,electron:U.isElectron,loadTime:Date.now()-n,pluginNames:(null===(r=t.jbrowse.plugins)||void 0===r?void 0:r.map((function(e){return e.name})))||""},o="(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){",o+="(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),",o+="m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)",o+="})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');",o+="ga('create', '".concat("UA-7115575-5","', 'auto', 'jbrowseTracker');"),i={},"tracks-count ver electron loadTime pluginNames","tracks-count ver electron loadTime pluginNames".split(/\s+/).forEach((function(e,t){i["dimension".concat(t+1)]=a[e]})),i.metric1=Math.round(a.loadTime),o+="ga('jbrowseTracker.send', 'pageview',".concat(JSON.stringify(i),");"),(c=document.createElement("script")).innerHTML=o,document.getElementsByTagName("head")[0].appendChild(c);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e,t,n){e&&!Object(E.readConfObject)(e.jbrowse.configuration,"disableAnalytics")&&(function(e,t,n){ge.apply(this,arguments)}(e,t,n),function(e,t){me.apply(this,arguments)}(e,t))}var be=n(38),ve=n(235),ye=function(e){return b.types.late((function(){return Object(E.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},Oe=function(e){e.addAdapterType((function(){return new y.a({name:"CramAdapter",configSchema:e.load(ye),getAdapterClass:function(){return Promise.all([n.e(0),n.e(16),n.e(37)]).then(n.bind(null,1767)).then((function(e){return e.default}))}})}))},we=b.types.late((function(){return Object(E.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:Object(E.ConfigurationSchema)("BamIndex",{indexType:{model:b.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),chunkSizeLimit:{type:"number",defaultValue:1e8},fetchSizeLimit:{type:"number",defaultValue:5e6},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),je=function(e){e.addAdapterType((function(){return new y.a({name:"BamAdapter",configSchema:we,getAdapterClass:function(){return Promise.all([n.e(0),n.e(6),n.e(51)]).then(n.bind(null,958)).then((function(e){return e.default}))}})}))},ke=b.types.late((function(){return Object(E.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",defaultValue:""},htsgetTrackId:{type:"string",defaultValue:""},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),xe=function(e){e.addAdapterType((function(){return new y.a({name:"HtsgetBamAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},configSchema:ke,getAdapterClass:function(){return Promise.all([n.e(0),n.e(6),n.e(36)]).then(n.bind(null,1704)).then((function(e){return e.default}))}})}))},Ce=function(e){return b.types.late((function(){return Object(E.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},Se=n(1310),Te=function(e){e.addAdapterType((function(){return new y.a({name:"SNPCoverageAdapter",adapterMetadata:{category:null,displayName:null,hiddenFromGUI:!0,description:null},getAdapterClass:function(){return Promise.resolve().then(n.bind(null,1310)).then((function(e){return e.default}))},configSchema:Ce(e),adapterCapabilities:Se.capabilities})}))},Ee=Object(E.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0}),Me=n(117),Re=n(232),Pe=n(329),Ae=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(h.a)(n,[{key:"render",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,s,l,f,p,g,m=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:return r=e.sent,a=t.height,o=t.regions,i=t.bpPerPx,s=Object(u.a)(o,1),l=s[0],f=(l.end-l.start)/i,e.next=8,Object(Pe.a)(f,a,t,(function(e){return m.draw(e,Object(c.a)(Object(c.a)({},t),{},{features:r}))}));case 8:return p=e.sent,e.next=11,Object(F.a)(Object(D.a)(n.prototype),"render",this).call(this,Object(c.a)(Object(c.a)(Object(c.a)({},t),p),{},{features:r,height:a,width:f}));case 11:return g=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)(Object(c.a)({},g),p),{},{features:r,height:a,width:f}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Re.default);var Ne=Object(ie.observer)((function(e){var t=e.regions,n=e.features,r=e.bpPerPx,a=e.width,o=e.height,i=e.onMouseLeave,c=void 0===i?function(){}:i,s=e.onMouseMove,l=void 0===s?function(){}:s,d=e.onFeatureClick,m=void 0===d?function(){}:d,h=Object(u.a)(t,1)[0],b=Object(f.useRef)(null);function v(e){var t=0;b.current&&(t=b.current.getBoundingClientRect().left);var o,i,c=e-t,s=h.reversed?a-c:c,u=h.start+r*s,l=Object(g.a)(n.values());try{for(l.s();!(i=l.n()).done;){var d=i.value;if(u<=d.get("end")&&u>=d.get("start")){o=d;break}}}catch(f){l.e(f)}finally{l.f()}return o}return p.a.createElement("div",{ref:b,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t=v(e.clientX);l(e,t?t.id():void 0)},onClick:function(e){var t=v(e.clientX);m(e,t?t.id():void 0)},onMouseLeave:function(e){return c(e)},role:"presentation",className:"WiggleRendering",style:{overflow:"visible",position:"relative",height:o}},p.a.createElement(ue.PrerenderedCanvas,e))})),Le=Object(E.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Ie=n(1608),Fe=n(1771),De=n(1701);function Be(e){var t,n=e.domain,r=void 0===n?[]:n,a=e.range,o=void 0===a?[]:a,i=e.scaleType,c=e.pivotValue,s=e.inverted,l=Object(u.a)(r,2),d=l[0],f=l[1];if(void 0===d||void 0===f)throw new Error("invalid domain");if("linear"===i)t=Object(Ie.a)();else if("log"===i)(t=Object(Fe.a)()).base(2);else{if("quantize"!==i)throw new Error("undefined scaleType");t=Object(De.a)()}t.domain(void 0!==c?[d,c,f]:[d,f]),t.nice();var p=Object(u.a)(o,2),g=p[0],m=p[1];if(void 0===g||void 0===m)throw new Error("invalid range");return t.range(s?o.slice().reverse():o),t}function Ve(e){return"log"===e?1:0}function ze(e){var t=e.scaleType,n=e.domain,r=e.bounds,a=Object(u.a)(r,2),o=a[0],i=a[1],c=Object(u.a)(n,2),s=c[0],l=c[1];if("linear"===t&&(l<0&&(l=0),s>0&&(s=0)),"log"===t&&(0===s||s>1)&&(s=1),void 0===s||void 0===l)throw new Error("invalid domain supplied to stats function");void 0!==o&&o!==Number.MIN_VALUE&&(s=o),void 0!==i&&i!==Number.MAX_VALUE&&(l=i);var d=function(e){if("linear"===e)return Object(Ie.a)();if("log"===e){var t=Object(Fe.a)();return t.base(2),t}if("quantize"===e)return Object(De.a)();throw new Error("undefined scaleType ".concat(e))}(t);return d.domain([s,l]),d.nice(),d.domain()}var We=Object(E.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},highlightColor:{type:"color",description:"the color of highlights over the wiggle track",defaultValue:"rgba(255,255,0,0.5)"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},renderType:{type:"stringEnum",model:b.types.enumeration("Rendering type",["xyplot","density","line"]),description:"The type of rendering for wiggle data to use",defaultValue:"xyplot"},filled:{type:"boolean",description:"fill in histogram",defaultValue:!0},bicolorPivot:{type:"stringEnum",model:b.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"},summaryScoreMode:{type:"stringEnum",model:b.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{explicitlyTyped:!0}),Ue=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.regions,o=t.bpPerPx,i=t.scaleOpts,s=t.height,l=t.config,d=Object(u.a)(a,1)[0],f=Object(E.readConfObject)(l,"bicolorPivot"),p=Object(E.readConfObject)(l,"bicolorPivotValue"),m=Object(E.readConfObject)(l,"negColor"),h=Object(E.readConfObject)(l,"posColor");if("#f0f"===Object(E.readConfObject)(l,"color")){var b=Be("none"!==f?Object(c.a)(Object(c.a)({},i),{},{pivotValue:p,range:[m,"white",h]}):Object(c.a)(Object(c.a)({},i),{},{range:["white",h]}));n=function(e){return b(e.get("score"))}}else n=function(e){return Object(E.readConfObject)(l,"color",{feature:e})};var v,y=Object(g.a)(r.values());try{for(y.s();!(v=y.n()).done;){var O=v.value,w=Object(U.featureSpanPx)(O,d,o),j=Object(u.a)(w,2),k=j[0],x=j[1]-k+.3;e.fillStyle=n(O),e.fillRect(k,0,x,s)}}catch(C){y.e(C)}finally{y.f()}}}]),n}(Ae),qe=Object(E.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:We,explicitlyTyped:!0}),He=n(133);var _e=n(105),Ge=n(107),Je=n(864),Xe=n(51),Ye=n(13),Qe=n(1628),Ke=n(1738);function $e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return+(+e).toPrecision(6)}var Ze=function(e){return e.toLocaleString("en-US")},et=Object(Xe.a)((function(e){return{tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:Object(Ye.a)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:0,cursor:"default",position:"absolute",pointerEvents:"none"}};var t})),tt=p.a.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),o=[n.get("refName"),r===a?Ze(r):"".concat(Ze(r),"..").concat(Ze(a))].filter((function(e){return!!e})).join(":");return void 0!==n.get("summary")?p.a.createElement("div",{ref:t},o,p.a.createElement("br",null),"Max: ",$e(n.get("maxScore")),p.a.createElement("br",null),"Avg: ",$e(n.get("score")),p.a.createElement("br",null),"Min: ",$e(n.get("minScore"))):p.a.createElement("div",{ref:t},o,p.a.createElement("br",null),"".concat($e(n.get("score"))))})),nt=Object(ie.observer)((function(e){var t=e.model,n=e.height,r=e.clientMouseCoord,a=e.offsetMouseCoord,o=e.clientRect,i=e.TooltipContents,s=t.featureUnderMouse,l=Object(f.useState)(0),d=Object(u.a)(l,2),g=d[0],m=d[1],h=Object(f.useState)(null),b=Object(u.a)(h,2),v=b[0],y=b[1],O=et(),w=Object(f.useMemo)((function(){return{getBoundingClientRect:function(){var e=r[0]+g/2+20,t=(null===o||void 0===o?void 0:o.top)||0;return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[null===o||void 0===o?void 0:o.top,r,g]),j=Object(Ke.a)(w,v),k=j.styles,x=j.attributes;return s?p.a.createElement(p.a.Fragment,null,p.a.createElement(Qe.a,null,p.a.createElement("div",Object.assign({ref:y,className:O.tooltip,style:Object(c.a)(Object(c.a)({},k.popper),{},{zIndex:1e5})},x.popper),p.a.createElement(i,{ref:function(e){m((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},feature:s}))),p.a.createElement("div",{className:O.hoverVertical,style:{left:a[0],height:n-2*st}})):null})),rt=Object(ie.observer)((function(e){return p.a.createElement(nt,Object.assign({TooltipContents:tt},e))})),at=Object(ie.observer)((function(e){var t=e.model,n=e.orientation,r=t.ticks;return r?p.a.createElement(Je.Axis,Object.assign({},r,{shadow:2,format:function(e){return e},style:{orient:"left"===n?Je.LEFT:Je.RIGHT}})):null})),ot=Object(ie.observer)((function(e){var t=e.model,n=t.stats,r=t.height,a=t.needsScalebar,o="overlapping"===Object(U.getContainingView)(t).trackLabels?Object(U.measureText)(Object(E.getConf)(Object(U.getContainingTrack)(t),"name"),12.8)+100:50;return p.a.createElement("div",null,p.a.createElement(He.b,e),n&&a?p.a.createElement("svg",{style:{position:"absolute",top:0,left:o,pointerEvents:"none",height:r,width:50}},p.a.createElement(at,{model:t})):null)})),it=Object(f.lazy)((function(){return n.e(84).then(n.bind(null,1707))})),ct=Object(f.lazy)((function(){return Promise.all([n.e(4),n.e(83)]).then(n.bind(null,1708))})),st=5,ut=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),lt=function(e,t){return b.types.compose("LinearWiggleDisplay",He.a,b.types.model({type:b.types.literal("LinearWiggleDisplay"),configuration:Object(E.ConfigurationReference)(t),selectedRendering:b.types.optional(b.types.string,""),resolution:b.types.optional(b.types.number,1),fill:b.types.maybe(b.types.boolean),color:b.types.maybe(b.types.string),posColor:b.types.maybe(b.types.string),negColor:b.types.maybe(b.types.string),summaryScoreMode:b.types.maybe(b.types.string),rendererTypeNameState:b.types.maybe(b.types.string),scale:b.types.maybe(b.types.string),autoscale:b.types.maybe(b.types.string),displayCrossHatches:b.types.maybe(b.types.boolean),constraints:b.types.optional(b.types.model({max:b.types.maybe(b.types.number),min:b.types.maybe(b.types.number)}),{})})).volatile((function(){return{statsReady:!1,message:void 0,stats:{scoreMin:0,scoreMax:50},statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){var n=t.scoreMin,r=t.scoreMax;e.stats={scoreMin:n,scoreMax:r},e.statsReady=!0},setColor:function(t){e.color=t},setPosColor:function(t){e.posColor=t},setNegColor:function(t){e.negColor=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=Object(U.getSession)(e);Object(U.isSelectionContainer)(n)&&n.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){e.fill=t},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get TooltipComponent(){return rt},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeName(){var t=e.rendererTypeNameState||Object(E.getConf)(e,"defaultRendering"),n=ut.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},get filters(){},get scaleType(){return e.scale||Object(E.getConf)(e,"scaleType")},get maxScore(){var t=e.constraints.max;return void 0!==t?t:Object(E.getConf)(e,"maxScore")},get minScore(){var t=e.constraints.min;return void 0!==t?t:Object(E.getConf)(e,"minScore")}}})).views((function(e){return{get rendererConfig(){var t=Object(E.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},t),{},{filled:e.fill,scaleType:e.scaleType,displayCrossHatches:e.displayCrossHatches,summaryScoreMode:e.summaryScoreMode},e.color?{color:e.color}:{}),e.negColor?{negColor:e.negColor}:{}),e.posColor?{posColor:e.posColor}:{}),Object(b.getEnv)(e))}}})).views((function(e){var t=[0,0];return{get filled(){return"undefined"!==typeof e.fill?e.fill:Object(E.readConfObject)(e.rendererConfig,"filled")},get summaryScoreModeSetting(){return e.summaryScoreMode||Object(E.readConfObject)(e.rendererConfig,"summaryScoreMode")},get domain(){var n=e.stats,r=e.scaleType,a=e.minScore,o=e.maxScore,i=ze({domain:[n.scoreMin,n.scoreMax],bounds:[a,o],scaleType:r});return"log"===r&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:Object(E.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){return e.autoscale||Object(E.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){return e.displayCrossHatches||Object(E.readConfObject)(e.rendererConfig,"displayCrossHatches")}}})).views((function(e){return{get ticks(){var t=e.scaleType,n=e.domain,r=e.height,a=Object(E.getConf)(e,"minimalTicks"),o=Be({scaleType:t,domain:n,range:[r-st,st],inverted:Object(E.getConf)(e,"inverted")}),i=Object(Je.axisPropsFromTickScale)(o,4);return r<100||a?Object(c.a)(Object(c.a)({},i),{},{values:n}):i}}})).views((function(t){var n=t.renderProps;return{renderProps:function(){var e=n();return Object(c.a)(Object(c.a)({},e),{},{notReady:e.notReady||!t.statsReady,rpcDriverName:t.rpcDriverName,displayModel:t,config:t.rendererConfig,scaleOpts:t.scaleOpts,resolution:t.resolution,height:t.height,ticks:t.ticks,displayCrossHatches:t.displayCrossHatches,filters:t.filters})},get adapterCapabilities(){return e.getAdapterType(t.adapterTypeName).adapterCapabilities},get hasResolution(){return this.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return this.adapterCapabilities.includes("hasGlobalStats")}}})).views((function(e){var t=e.trackMenuItems;return{trackMenuItems:function(){return[].concat(Object(o.a)(t()),Object(o.a)(e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(t){return{label:t,onClick:function(){return e.setSummaryScoreMode(t)}}}))}]:[]),Object(o.a)(e.canHaveFill?[{label:e.filled?"Turn off histogram fill":"Turn on histogram fill",onClick:function(){e.setFill(!e.filled)}}]:[]),[{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:function(){e.toggleLogScale()}},{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:function(){e.toggleCrossHatches()}}],Object(o.a)(Object.keys(Object(E.getConf)(e,"renderers")||{}).length>1?[{label:"Renderer type",subMenu:Object(o.a)(ut.keys()).map((function(t){return{label:t,onClick:function(){return e.setRendererType(t)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat(Object(o.a)(e.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(t){var n=Object(u.a)(t,2),r=n[0];return{label:n[1],onClick:function(){e.setAutoscale(r)}}}))},{label:"Set min/max score",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[it,{model:e,handleClose:t}]}))}},{label:"Set color",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[ct,{model:e,handleClose:t}]}))}}])}}})).actions((function(e){var t=e.reload,n=e.renderSvg;function r(e){return a.apply(this,arguments)}function a(){return(a=Object(i.a)(d.a.mark((function t(n){var r,a,o,i,s,u,l,f,p,g,m,h,v,y,O,w,j,k;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=Object(U.getSession)(e),a=r.rpcManager,o=Object(E.getConf)(e,"numStdDev")||3,i=e.adapterConfig,s=e.autoscaleType,u=Object(_e.getRpcSessionId)(e),l=Object(c.a)({sessionId:u,adapterConfig:i,statusCallback:function(t){Object(b.isAlive)(e)&&e.setMessage(t)}},n),"global"!==s&&"globalsd"!==s){t.next=11;break}return t.next=8,a.call(u,"WiggleGetGlobalStats",l);case 8:return f=t.sent,p=f.scoreMin,g=f.scoreMean,m=f.scoreStdDev,t.abrupt("return","globalsd"===s?Object(c.a)(Object(c.a)({},f),{},{scoreMin:p>=0?0:g-o*m,scoreMax:g+o*m}):f);case 11:if("local"!==s&&"localsd"!==s){t.next=18;break}return h=Object(U.getContainingView)(e),v=h.dynamicBlocks,y=h.bpPerPx,t.next=15,a.call(u,"WiggleGetMultiRegionStats",Object(c.a)(Object(c.a)({},l),{},{regions:v.contentBlocks.map((function(e){var t=e.start,n=e.end;return Object(c.a)(Object(c.a)({},JSON.parse(JSON.stringify(e))),{},{start:Math.floor(t),end:Math.ceil(n)})})),bpPerPx:y}));case 15:return O=t.sent,w=O.scoreMin,j=O.scoreMean,k=O.scoreStdDev,t.abrupt("return","localsd"===s?Object(c.a)(Object(c.a)({},O),{},{scoreMin:w>=0?0:j-o*k,scoreMax:j+o*k}):O);case 18:if("zscale"!==s){t.next=20;break}return t.abrupt("return",a.call(u,"WiggleGetGlobalStats",l));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{reload:function(){return Object(i.a)(d.a.mark((function n(){var a,o;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setError(),a=new AbortController,n.prev=2,n.next=5,r({signal:a.signal,filters:e.filters});case 5:o=n.sent,Object(b.isAlive)(e)&&(e.updateStats(o),t()),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),e.setError(n.t0);case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))()},afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function t(){var n,a,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=new AbortController,a=Object(U.getContainingView)(e),e.setLoading(n),a.initialized){t.next=6;break}return t.abrupt("return");case 6:if(e.estimatedStatsReady){t.next=8;break}return t.abrupt("return");case 8:if(!e.regionTooLarge){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,r({signal:n.signal,filters:e.filters});case 12:o=t.sent,Object(b.isAlive)(e)&&e.updateStats(o),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),!Object(U.isAbortException)(t.t0)&&Object(b.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 19:case"end":return t.stop()}}),t,null,[[0,16]])}))),{delay:1e3}))},renderSvg:function(t){return Object(i.a)(d.a.mark((function r(){var a,o,i,c;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Ge.when)((function(){return e.statsReady&&!!e.regionCannotBeRenderedText}));case 2:return a=e.needsScalebar,o=e.stats,i=Object(U.getContainingView)(e),c=i.offsetPx,r.t0=p.a,r.t1=p.a.Fragment,r.t2=p.a,r.t3={id:"snpcov"},r.next=10,n(t);case 10:return r.t4=r.sent,r.t5=r.t2.createElement.call(r.t2,"g",r.t3,r.t4),r.t6=a&&o?p.a.createElement("g",{transform:"translate(".concat(Math.max(-c,0),")")},p.a.createElement(at,{model:e,orientation:"left"})):null,r.abrupt("return",r.t0.createElement.call(r.t0,r.t1,null,r.t5,r.t6));case 14:case"end":return r.stop()}}),r)})))()}}}))},dt=n(427),ft=n.n(dt),pt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.bpPerPx,o=t.regions,i=t.scaleOpts,s=t.height,l=t.config,d=t.ticks,f=t.displayCrossHatches,p=Object(u.a)(o,1)[0],m=(p.end-p.start)/a,h=st,b=s-2*h,v=Object(E.readConfObject)(l,"bicolorPivotValue"),y=Object(E.readConfObject)(l,"negColor"),O=Object(E.readConfObject)(l,"posColor"),w=Object(E.readConfObject)(l,"filled"),j=Object(E.readConfObject)(l,"clipColor"),k=Object(E.readConfObject)(l,"highlightColor"),x=Object(E.readConfObject)(l,"summaryScoreMode"),C=Be(Object(c.a)(Object(c.a)({},i),{},{range:[0,b]})),S=Ve(i.scaleType),T=C.domain(),M=Object(u.a)(T,2),R=M[0],P=M[1],A=function(e){return b-(C(e)||0)+h},N=function(e){return A(S)-A(e)},L="#f0f"===Object(E.readConfObject)(l,"color")?function(e,t){return t<v?y:O}:function(e,t){return Object(E.readConfObject)(l,"color",{feature:e})},I=R<v&&P>v,F=Object(g.a)(r.values());try{for(F.s();!(n=F.n()).done;){var D=n.value,B=Object(U.featureSpanPx)(D,p,a),V=Object(u.a)(B,2),z=V[0],W=V[1],q=D.get("score"),H=D.get("maxScore"),_=D.get("minScore"),G=q<R,J=q>P,X=W-z+.4,Y=D.get("summary");if("max"===x)q=Y?H:q,e.fillStyle=L(D,q),e.fillRect(z,A(q),X,w?N(q):1);else if("min"===x)q=Y?_:q,e.fillStyle=L(D,q),e.fillRect(z,A(q),X,w?N(q):1);else if("whiskers"===x){var Q=L(D,q);Y&&(e.fillStyle=I?L(D,H):ft()(Q).lighten(.6).toString(),e.fillRect(z,A(H),X,w?N(H)-N(q):1)),e.fillStyle=I&&Y?ft()(L(D,H)).mix(ft()(L(D,_))):Q,e.fillRect(z,A(q),X,w?N(q)-(Y?N(_):0):1),Y&&(e.fillStyle=I?L(D,_):ft()(Q).darken(.6).toString(),e.fillRect(z,A(_),X,w?N(_):1))}else e.fillStyle=L(D,q),e.fillRect(z,A(q),X,w?N(q):1);J?(e.fillStyle=j,e.fillRect(z,0,X,4)):G&&"log"!==i.scaleType&&(e.fillStyle=j,e.fillRect(z,s-4,X,4)),D.get("highlighted")&&(e.fillStyle=k,e.fillRect(z,0,X,b))}}catch(K){F.e(K)}finally{F.f()}f&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",d.values.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(A(t))),e.lineTo(m,Math.round(A(t))),e.stroke()})))}}]),n}(Ae),gt=Object(E.ConfigurationSchema)("XYPlotRenderer",{},{baseConfiguration:We,explicitlyTyped:!0}),mt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.regions,o=t.bpPerPx,i=t.scaleOpts,s=t.height,l=t.ticks.values,d=t.displayCrossHatches,f=t.config,p=Object(u.a)(a,1)[0],m=(p.end-p.start)/o,h=st,b=s-2*h,v=Object(E.readConfObject)(f,"clipColor"),y=Object(E.readConfObject)(f,"highlightColor"),O=Be(Object(c.a)(Object(c.a)({},i),{},{range:[0,b]})),w=O.domain(),j=Object(u.a)(w,2),k=j[0],x=j[1],C=function(e){return b-O(e)+h},S="#f0f"===Object(E.readConfObject)(f,"color")?function(){return"grey"}:function(e){return Object(E.readConfObject)(f,"color",{feature:e})};e.strokeStyle="grey",e.moveTo(0,C(0)),e.lineTo(m,C(0)),e.stroke();var T,M=Object(g.a)(r.values());try{for(M.s();!(T=M.n()).done;){var R=T.value,P=Object(U.featureSpanPx)(R,p,o),A=Object(u.a)(P,2),N=A[0],L=A[1],I=R.get("score"),F=I<k,D=I>x,B=L-N+.3,V=S(R);e.strokeStyle=V,e.beginPath(),p.reversed?(e.moveTo(L,C("undefined"!==typeof n?n:I)),e.lineTo(L,C(I)),e.lineTo(N,C(I))):(e.moveTo(N,C("undefined"!==typeof n?n:I)),e.lineTo(N,C(I)),e.lineTo(L,C(I))),e.stroke(),n=I,D?(e.fillStyle=v,e.fillRect(N,0,B,4)):F&&"log"!==i.scaleType&&(e.fillStyle=v,e.fillRect(N,b-4,B,b)),R.get("highlighted")&&(e.fillStyle=y,e.fillRect(N,0,B,b))}}catch(z){M.e(z)}finally{M.f()}d&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",l.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(C(t))),e.lineTo(m,Math.round(C(t))),e.stroke()})))}}]),n}(Ae),ht=Object(E.ConfigurationSchema)("LinePlotRenderer",{},{baseConfiguration:We,explicitlyTyped:!0}),bt=n(440),vt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="WiggleGetGlobalStats",e}return Object(h.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.a)(Object(D.a)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)({},a),{},{filters:t.filters?new bt.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,o=r.sessionId,e.next=6,Object(V.b)(this.pluginManager,o,a);case 6:return i=e.sent,c=i.dataAdapter,e.abrupt("return",c.getGlobalStats(r));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),yt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="WiggleGetMultiRegionStats",e}return Object(h.a)(n,[{key:"deserializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.a)(Object(D.a)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)({},a),{},{filters:t.filters?new bt.a({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(a=this.pluginManager.rootModel)||void 0===a||null===(o=a.session)||void 0===o?void 0:o.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,Object(U.renameRegionsIfNeeded)(i,Object(c.a)(Object(c.a)({},t),{},{filters:t.filters&&t.filters.toJSON().filters}));case 5:return s=e.sent,e.abrupt("return",Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,s,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.regions,o=r.adapterConfig,i=r.sessionId,e.next=6,Object(V.b)(this.pluginManager,i,o);case 6:if(c=e.sent,!((s=c.dataAdapter)instanceof W.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",s.getMultiRegionStats(a,r));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),Ot=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:ot,XYPlotRendererReactComponent:Ne,XYPlotRenderer:pt,xyPlotRendererConfigSchema:gt,utils:a,WiggleBaseRenderer:Ae,linearWiggleDisplayModelFactory:lt},e}return Object(h.a)(r,[{key:"install",value:function(e){e.addTrackType((function(){var t=Object(E.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:Object(Me.createBaseTrackConfig)(e)});return new O.a({name:"QuantitativeTrack",configSchema:t,stateModel:Object(Me.createBaseTrackModel)(e,"QuantitativeTrack",t)})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return Object(E.ConfigurationSchema)("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:b.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:b.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:b.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:Object(E.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:He.d,explicitlyTyped:!0})}(e);return new w.a({name:"LinearWiggleDisplay",configSchema:t,stateModel:lt(e,t),trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:ot})})),e.addAdapterType((function(){return new y.a({name:"BigWigAdapter",configSchema:Le,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:function(){return Promise.all([n.e(0),n.e(5),n.e(82)]).then(n.bind(null,1705)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigWigAdapter",o=Object(_e.getFileName)(t),i={type:a,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BigWigAdapter"===t?"QuantitativeTrack":e(t)}})),e.addRendererType((function(){return new Ue({name:"DensityRenderer",ReactComponent:Ne,configSchema:qe,pluginManager:e})})),e.addRendererType((function(){return new mt({name:"LinePlotRenderer",ReactComponent:Ne,configSchema:ht,pluginManager:e})})),e.addRendererType((function(){return new pt({name:"XYPlotRenderer",ReactComponent:Ne,configSchema:gt,pluginManager:e})})),e.addRpcMethod((function(){return new vt(e)})),e.addRpcMethod((function(){return new yt(e)}))}}]),r}(M.a),wt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"draw",value:function(e,t){var n=t.features,r=t.regions,a=t.bpPerPx,i=t.displayCrossHatches,s=t.modificationTagMap,l=void 0===s?{}:s,d=t.scaleOpts,f=t.height,p=t.theme,g=t.config,m=t.ticks,h=Object(ue.createJBrowseTheme)(p),b=Object(u.a)(r,1)[0],v=(b.end-b.start)/a,y=st,O=f-2*y;if(d.domain){var w,j=Object(c.a)(Object(c.a)({},d),{},{range:[0,O]}),k=Be(j),x=Be(Object(c.a)(Object(c.a)({},j),{},{range:[0,O],scaleType:"linear"})),C=Be(Object(c.a)(Object(c.a)({},j),{},{range:[0,O/2],scaleType:"linear"})),S=Ve(d.scaleType),T=Ve("linear"),M=Object(E.readConfObject)(g,"indicatorThreshold"),R=Object(E.readConfObject)(g,"drawInterbaseCounts"),P=Object(E.readConfObject)(g,"drawArcs"),A=Object(E.readConfObject)(g,"drawIndicators"),N=function(e){return O-(k(e)||0)+y},L=function(e){return O-(x(e)||0)+y},I=function(e){return O-(C(e)||0)+y},F=function(e){return L(T)-L(e)},D=function(e){return I(T)-I(e)},B={A:h.palette.bases.A.main,C:h.palette.bases.C.main,G:h.palette.bases.G.main,T:h.palette.bases.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red",meth:"red",unmeth:"blue",ref:"lightgrey"},V=Object(o.a)(n.values()),z=V.filter((function(e){return"skip"!==e.get("type")})),W=V.filter((function(e){return"skip"===e.get("type")}));e.fillStyle=B.total;for(var q=0;q<z.length;q++){var H=z[q],_=Object(U.featureSpanPx)(H,b,a),G=Object(u.a)(_,2),J=G[0],X=G[1]-J+.3,Y=H.get("score");e.fillRect(J,N(Y),X,(w=Y,N(S)-N(w)))}for(var Q=0,K=b.reversed?1/a:0,$=0;$<z.length;$++){for(var Z=z[$],ee=Object(U.featureSpanPx)(Z,b,a),te=Object(u.a)(ee,2),ne=te[0],re=te[1],ae=Z.get("snpinfo"),oe=Math.max(re-ne+.3,1),ie=ae.total,ce=Object.keys(ae.cov).sort(),se=0,le=0;le<ce.length;le++){var de=ce[le],fe=ae.cov[de].total;e.fillStyle=B[de]||l[de.replace("mod_","")]||"#888",e.fillRect(ne,L(fe+se),oe,F(fe)),se+=fe}var pe=Object.keys(ae.noncov);if(R)for(var ge=0,me=0;me<pe.length;me++){var he=pe[me],be=ae.noncov[he].total;e.fillStyle=B[he],e.fillRect(ne-.6+K,4.5+D(ge),1.2,D(be)),ge+=be}if(A){for(var ve=0,ye=0,Oe="",we=0;we<pe.length;we++){var je=pe[we],ke=ae.noncov[je].total;ve+=ke,ke>ye&&(ye=ke,Oe=je)}var xe=Math.max(ie,Q);if(ve>xe*M&&xe>7){e.fillStyle=B[Oe],e.beginPath();var Ce=ne+K;e.moveTo(Ce-3.5,0),e.lineTo(Ce+3.5,0),e.lineTo(Ce,4.5),e.fill()}}Q=ie}if(P)for(var Se=0;Se<W.length;Se++){var Te=W[Se],Ee=Object(U.bpSpanPx)(Te.get("start"),Te.get("end"),b,a),Me=Object(u.a)(Ee,2),Re=Me[0],Pe=Me[1];e.beginPath();var Ae=Te.get("strand"),Ne=Te.get("xs"),Le="rgba(255,200,200,0.7)",Ie="rgba(200,200,255,0.7)";e.strokeStyle="+"===Ne?Le:"-"===Ne?Ie:1===Ae?Le:-1===Ae?Ie:"rgba(200,200,200,0.7)",e.lineWidth=Math.log(Te.get("score")+1),e.moveTo(Re,O-2*y),e.bezierCurveTo(Re,0,Pe,0,Pe,O-2*y),e.stroke()}i&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",m.values.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(N(t))),e.lineTo(v,Math.round(N(t))),e.stroke()})))}}}]),n}(Ae),jt=Object(E.ConfigurationSchema)("SNPCoverageRenderer",{},{baseConfiguration:Ee,explicitlyTyped:!0});function kt(e){e.addRendererType((function(){return new wt({name:"SNPCoverageRenderer",ReactComponent:Ne,configSchema:jt,pluginManager:e})}))}var xt=n(254),Ct=n(229),St=n(585),Tt=n(578),Et=n.n(Tt),Mt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).sortedBy=void 0,r.showSoftClip=!1,r.cachedLayout=void 0,r.config=e.config,r}return Object(h.a)(n,[{key:"cachedLayoutIsValid",value:function(e){return Object(F.a)(Object(D.a)(n.prototype),"cachedLayoutIsValid",this).call(this,e)&&this.showSoftClip===e.showSoftClip&&Et()(this.sortedBy,e.sortedBy)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:Object(E.readConfObject)(this.config),filters:this.filters,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}]),n}(xt.LayoutSession);function Rt(e){return{A:e.palette.bases.A.main,C:e.palette.bases.C.main,G:e.palette.bases.G.main,T:e.palette.bases.T.main,deletion:"#808080"}}var Pt={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"};function At(e){return!["methylation","modifications"].includes(e||"")}var Nt=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(h.a)(n,[{key:"getCharWidthHeight",value:function(e){return{charWidth:e.measureText("A").width,charHeight:e.measureText("M").width}}},{key:"layoutFeature",value:function(e){var t=e.feature,n=e.layout,r=e.bpPerPx,a=e.region,o=e.showSoftClip,i=e.heightPx,c=e.displayMode,s=0,l=0;if(o){var d=t.get("mismatches");if(t.get("seq"))for(var f=0;f<d.length;f+=1){var p=d[f],g=p.type,m=p.start,h=p.cliplen,b=void 0===h?0:h;"softclip"===g&&(0===m?s=b:l=b)}}var v=Object(U.bpSpanPx)(t.get("start")-s,t.get("end")+l,a,r),y=Object(u.a)(v,2),O=y[0],w=y[1];if("compact"===c&&(i/=3),t.get("refName")!==a.refName)throw new Error("feature ".concat(t.id()," is not on the current region's reference sequence ").concat(a.refName));var j=n.addRect(t.id(),t.get("start")-s,t.get("end")+l,i);return null===j?null:{feature:t,leftPx:O,rightPx:w,topPx:"collapse"===c?0:j,heightPx:i}}},{key:"getExpandedRegion",value:function(e,t){var n=t.config,r=t.showSoftClip,a=Object(E.readConfObject)(n,"maxClippingSize"),o=e.start,i=e.end,s=i-o,u=Math.max(s,r?Math.round(a):0);return Object(c.a)(Object(c.a)({},e),{},{start:Math.floor(Math.max(o-u,0)),end:Math.ceil(i+u)})}},{key:"colorByOrientation",value:function(e,t){return Pt[this.getOrientation(e,t)||"color_nostrand"]}},{key:"getOrientation",value:function(e,t){var n=Object(E.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[St.c[n][e.get("pair_orientation")]]}},{key:"colorByInsertSize",value:function(e,t){return e.get("is_paired")&&e.get("seq_id")!==e.get("next_seq_id")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}},{key:"colorByStranded",value:function(e,t){var n=e.get("flags"),r=e.get("strand");if(1&n){var a=64&n?-1:1;return 2&n?r*a===1?"color_rev_strand":"color_fwd_strand":e.get("multi_segment_next_segment_unmapped")?r*a===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("seq_id")===e.get("next_seq_id")?r*a===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return 1===r?"color_fwd_strand":"color_rev_strand"}},{key:"colorByPerBaseQuality",value:function(e,t,n,r,a){for(var o=t.feature,i=t.topPx,c=t.heightPx,s=(o.get("qual")||"").split(" ").map((function(e){return+e})),l=Object(ve.parseCigar)(o.get("CIGAR")),d=1/a,f=o.get("start"),p=0,g=0,m=0;m<s.length;p+=2,m++){var h=+l[p],b=l[p+1];if("S"===b||"I"===b)m+=h;else if("D"===b||"N"===b)g+=h;else if("M"===b||"X"===b||"="===b){for(var v=0;v<h;v++){var y=s[m+v];e.fillStyle="hsl(".concat(255===y?150:1.5*y,",55%,50%)");var O=Object(U.bpSpanPx)(f+g+v,f+g+v+1,r,a),w=Object(u.a)(O,1)[0];e.fillRect(w,i,d+.5,c)}g+=h}}}},{key:"colorByModifications",value:function(e,t,n,r,a,o){for(var i=t.feature,c=t.topPx,s=t.heightPx,l=o.modificationTagMap,d=void 0===l?{}:l,f=Object(St.b)(i,"MM","Mm")||"",p=Object(St.b)(i,"ML","Ml")||[],m=p?("string"===typeof p?p.split(",").map((function(e){return+e})):p).map((function(e){return e/255})):Object(St.b)(i,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),h=i.get("CIGAR"),b=i.get("start"),v=i.get("end"),y=i.get("seq"),O=i.get("strand"),w=Object(ve.parseCigar)(h),j=Object(ve.getModificationPositions)(f,y,O),k=0,x=0;x<j.length;x++){var C,S=j[x],T=S.type,E=S.positions,M=d[T]||"black",R=ft()(M),P=Object(g.a)(Object(ve.getNextRefPos)(w,E));try{for(P.s();!(C=P.n()).done;){var A=C.value;if(A>=0&&b+A<v){var N=Object(U.bpSpanPx)(b+A,b+A+1,r,a),L=Object(u.a)(N,2),I=L[0],F=L[1];e.fillStyle=R.alpha(m[k]+.1).hsl().string(),e.fillRect(I,c,F-I+.5,s)}k++}}catch(D){P.e(D)}finally{P.f()}}}},{key:"colorByMethylation",value:function(e,t,n,r,a,o){var i=o.regionSequence,c=t.feature,s=t.topPx,l=t.heightPx,d=Object(St.b)(c,"MM","Mm")||"";if(!i)throw new Error("region sequence required for methylation");for(var f=c.get("CIGAR"),p=c.get("start"),m=c.get("end"),h=c.get("seq"),b=c.get("strand"),v=Object(ve.parseCigar)(f),y=r.start,O=r.end,w=new Array(O-y).fill(0),j=Object(ve.getModificationPositions)(d,h,b),k=0;k<j.length;k++){var x=j[k],C=x.type,S=x.positions;if("m"===C&&S){var T,E=Object(g.a)(Object(ve.getNextRefPos)(v,S));try{for(E.s();!(T=E.n()).done;){var M=T.value+p-y;M>=0&&M<w.length&&(w[M]=1)}}catch(Y){E.e(Y)}finally{E.f()}}}for(var R=p;R<m;R++){var P=R-y;if(P>=0&&P<w.length){var A=i[P].toLowerCase(),N=i[P+1].toLowerCase();if(a>2){if("c"===A&&"g"===N){var L=y+P,I=Object(U.bpSpanPx)(L,L+2,r,a),F=Object(u.a)(I,2),D=F[0],B=F[1];w[P]||w[P+1]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(D,s,B-D+.5,l)}}else if("c"===A&&"g"===N){var V=y+P,z=Object(U.bpSpanPx)(V,V+1,r,a),W=Object(u.a)(z,2),q=W[0],H=W[1];w[P]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(q,s,H-q+.5,l);var _=Object(U.bpSpanPx)(V+1,V+2,r,a),G=Object(u.a)(_,2),J=G[0],X=G[1];w[P+1]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(J,s,X-J+.5,l)}}}}},{key:"drawRect",value:function(e,t,n){var r=n.regions,a=n.bpPerPx,o=t.heightPx,i=t.topPx,c=t.feature,s=Object(u.a)(r,1)[0],l=Object(U.bpSpanPx)(c.get("start"),c.get("end"),s,a),d=Object(u.a)(l,2),f=d[0],p=d[1],g=s.reversed?-1:1,m=c.get("strand")*g;a<10?-1===m?(e.beginPath(),e.moveTo(f-5,i+o/2),e.lineTo(f,i+o),e.lineTo(p,i+o),e.lineTo(p,i),e.lineTo(f,i),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(f,i),e.lineTo(f,i+o),e.lineTo(p,i+o),e.lineTo(p+5,i+o/2),e.lineTo(p,i),e.closePath(),e.fill()):e.fillRect(f,i,p-f,o)}},{key:"drawAlignmentRect",value:function(e,t,n){var r=n.defaultColor,a=n.config,o=n.bpPerPx,i=n.regions,c=n.colorBy,s=n.colorTagMap,u=void 0===s?{}:s,l=c||{},d=l.tag,f=void 0===d?"":d,p=l.type,g=void 0===p?"":p,m=t.feature,h=i[0];switch(g){case"insertSize":e.fillStyle=this.colorByInsertSize(m,a);break;case"strand":e.fillStyle=-1===m.get("strand")?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":e.fillStyle="hsl(".concat(m.get("mq"),",50%,50%)");break;case"pairOrientation":e.fillStyle=this.colorByOrientation(m,a);break;case"stranded":e.fillStyle=Pt[this.colorByStranded(m,a)];break;case"xs":case"tag":var b=m.get("tags"),v=b?b[f]:m.get(f);if("XS"===f||"TS"===f){e.fillStyle=Pt[{"-":"color_rev_strand","+":"color_fwd_strand"}[v]||"color_nostrand"]}if("ts"===f){var y={"-":-1===m.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===m.get("strand")?"color_rev_strand":"color_fwd_strand"};e.fillStyle=Pt[y[v]||"color_nostrand"]}else{var O=u[v];e.fillStyle=O||Pt.color_nostrand}break;case"insertSizeAndPairOrientation":break;default:e.fillStyle=r?"#c8c8c8":Object(E.readConfObject)(a,"color",{feature:m})}switch(this.drawRect(e,t,n),g){case"perBaseQuality":this.colorByPerBaseQuality(e,t,a,h,o);break;case"modifications":this.colorByModifications(e,t,a,h,o,n);break;case"methylation":this.colorByMethylation(e,t,a,h,o,n)}}},{key:"drawMismatches",value:function(e,t,n,r,a,o){var i=o.minSubfeatureWidth,c=o.largeInsertionIndicatorScale,s=o.mismatchAlpha,l=o.drawSNPs,d=void 0===l||l,f=o.drawIndels,p=void 0===f||f,g=o.charWidth,m=o.charHeight,h=n.bpPerPx,b=n.regions,v=t.heightPx,y=t.topPx,O=t.feature,w=Object(u.a)(b,1)[0],j=O.get("start"),k=Math.min(1/h,2),x=Math.max(i,k),C=O.get("mismatches"),S=m-2;function T(e,t){var n=e;return s&&void 0!==t.qual&&(n=ft()(e).alpha(Math.min(1,t.qual/50)).hsl().string()),n}for(var E=w.reversed?1/h+1:-1,M=0;M<C.length;M+=1){var R=C[M],P=j+R.start,A=R.length,N=R.base,L=Object(U.bpSpanPx)(P,P+A,w,h),I=Object(u.a)(L,2),F=I[0],D=I[1],B=Math.max(i,Math.abs(F-D));if("mismatch"===R.type&&d){var V=a[R.base]||"#888";e.fillStyle=T(V,R),e.fillRect(F,y,B,v),B>=g&&v>=S&&(e.fillStyle=T(r.palette.getContrastText(V),R),e.fillText(N,F+(B-g)/2+1,y+v))}else if("deletion"===R.type&&p){var z=a.deletion;e.fillStyle=z,e.fillRect(F,y,B,v);var W="".concat(R.length),q=e.measureText(W);B>=q.width&&v>=S&&(e.fillStyle=r.palette.getContrastText(z),e.fillText(W,F+(D-F)/2-q.width/2,y+v))}else if("insertion"===R.type&&p){e.fillStyle="purple";var H=F+E,_=+R.base||R.length,G=Math.max(i,Math.min(1.2,1/h));_<10&&(e.fillRect(H,y,G,v),1/h>=g&&(e.fillRect(H-G,y,3*G,1),e.fillRect(H-G,y+v-1,3*G,1)),1/h>=g&&v>=S&&e.fillText("(".concat(R.base,")"),H+3,y+v))}else if("hardclip"===R.type||"softclip"===R.type){e.fillStyle="hardclip"===R.type?"red":"blue";var J=F+E;e.fillRect(J,y,x,v),1/h>=g&&(e.fillRect(J-x,y,3*x,1),e.fillRect(J-x,y+v-1,3*x,1)),B>=g&&v>=S&&e.fillText("(".concat(R.base,")"),J+3,y+v)}else if("skip"===R.type&&F+B>0){var X=B-(h>10?1.5:0);e.clearRect(F,y,X,v),e.fillStyle="#333",e.fillRect(Math.max(0,F),y+v/2-1,X+(F<0?F:0),2)}}if(p)for(var Y=0;Y<C.length;Y+=1){var Q=C[Y],K=j+Q.start,$=Q.length,Z=Object(U.bpSpanPx)(K,K+$,w,h),ee=Object(u.a)(Z,1)[0],te=+Q.base||Q.length,ne="".concat(te);if("insertion"===Q.type&&te>=10)if(h>c)e.fillStyle="purple",e.fillRect(ee-1,y,2,v);else if(v>m){var re=e.measureText(ne);e.fillStyle="purple",e.fillRect(ee-re.width/2-5,y,re.width+10,v),e.fillStyle="white",e.fillText(ne,ee-re.width/2,y+v)}else{e.fillStyle="purple",e.fillRect(ee-2,y,4,v)}}}},{key:"drawSoftClipping",value:function(e,t,n,r,a){var o=t.feature,i=t.topPx,c=t.heightPx,s=n.regions,l=n.bpPerPx,d=Object(u.a)(s,1)[0],f=Object(E.readConfObject)(r,"minSubfeatureWidth"),p=o.get("mismatches"),g=o.get("seq"),m=this.getCharWidthHeight(e),h=m.charWidth,b=m.charHeight,v={A:a.palette.bases.A.main,C:a.palette.bases.C.main,G:a.palette.bases.G.main,T:a.palette.bases.T.main,deletion:"#808080"};g&&p.filter((function(e){return"softclip"===e.type})).forEach((function(t){for(var n=t.cliplen||0,r=o.get("start"),s=0===t.start?r-n:r+t.start,p=0;p<n;p+=1){var m=g.charAt(p+t.start);if(!m)return;var y=Object(U.bpSpanPx)(s+p,s+p+1,d,l),O=Object(u.a)(y,2),w=O[0],j=O[1],k=Math.max(f,Math.abs(w-j)),x=v[m]||"#000000";e.fillStyle=x,e.fillRect(w,i,k,c),k>=h&&c>=b-5&&(e.fillStyle=a.palette.getContrastText(x),e.fillText(m,w+(k-h)/2+1,i+c))}}))}},{key:"makeImageData",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i,s,u,l,f,p,g,m,h,b,v,y,O=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layout,o=r.config,i=r.showSoftClip,s=r.colorBy,u=r.theme,l=Object(E.readConfObject)(o,"mismatchAlpha"),f=Object(E.readConfObject)(o,"minSubfeatureWidth"),p=Object(E.readConfObject)(o,"largeInsertionIndicatorScale"),g="#f0f"===Object(E.readConfObject)(o,"color"),m=Object(ue.createJBrowseTheme)(u),h=Rt(m),a){e.next=9;break}throw new Error("layout required");case 9:if(a.addRect){e.next=11;break}throw new Error("invalid layout object");case 11:t.font="bold 10px Courier New,monospace",b=this.getCharWidthHeight(t),v=b.charWidth,y=b.charHeight,n.forEach((function(e){null!==e&&(O.drawAlignmentRect(t,e,Object(c.a)(Object(c.a)({},r),{},{defaultColor:g})),O.drawMismatches(t,e,r,m,h,{mismatchAlpha:l,drawSNPs:At(null===s||void 0===s?void 0:s.type),drawIndels:At(null===s||void 0===s?void 0:s.type),largeInsertionIndicatorScale:p,minSubfeatureWidth:f,charWidth:v,charHeight:y}),i&&O.drawSoftClipping(t,e,r,o,m))}));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"layoutFeats",value:function(e){var t=this,n=e.layout,r=e.features,a=e.sortedBy,o=e.config,i=e.bpPerPx,c=e.showSoftClip,s=e.regions,l=Object(u.a)(s,1)[0];if(!n)throw new Error("layout required");if(!n.addRect)throw new Error("invalid layout object");var d=null!==a&&void 0!==a&&a.type&&l.start===a.pos?function(e,t){var n=Array.from(e.values()),r=[],a=[],o=t.pos,i=t.type;n.forEach((function(e){var t=e,n=t.get("start"),i=t.get("end");Object(Ct.a)(o-1,o,n,i)?r.push(e):a.push(e)}));var c=!!n.length&&n[0].get("tags");switch(i){case"Start location":r.sort((function(e,t){return e.get("start")-t.get("start")}));break;case"tag":var s=t.tag,u=function(e,t){return c?e.get("tags")[t]:e.get(t)};r[0]&&"string"===typeof u(r[0],s)?r.sort((function(e,t){return u(t,s).localeCompare(u(e,s))})):r.sort((function(e,t){return(u(t,s)||0)-(u(e,s)||0)}));break;case"Base pair":var l=[];r.forEach((function(e){e.get("mismatches").forEach((function(t){var n=e.get("start")+t.start+1,r="insertion"===t.type||"softclip"===t.type?0:t.length;o>=n&&o<n+r&&l.push([e.id(),t])}))}));var d=new Map(l);r.sort((function(e,t){var n=d.get(e.id()),r=d.get(t.id()),a=r&&r.base.toUpperCase(),o=n&&n.base.toUpperCase();return a===o&&"*"===a?n.length-r.length:(a?a.charCodeAt(0):0)-(o?o.charCodeAt(0):0)}));break;case"Read strand":r.sort((function(e,t){return e.get("strand")<=t.get("strand")?1:-1}))}return new Map(r.concat(a).map((function(e){return[e.id(),e]})))}(r,a):r,f=Object(E.readConfObject)(o,"height"),p=Object(E.readConfObject)(o,"displayMode");return Object(U.iterMap)(d.values(),(function(e){return t.layoutFeature({feature:e,layout:n,bpPerPx:i,region:l,showSoftClip:c,heightPx:f,displayMode:p})}),d.size)}},{key:"render",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,s,l,f,p,g,m,h,b,v,y,O,w,j,k,x,C,S,T,E,M=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.sessionId,a=t.bpPerPx,o=t.regions,i=t.adapterConfig,s=i.sequenceAdapter,e.next=4,this.getFeatures(t);case 4:if(l=e.sent,f=this.createLayoutInWorker(t),p=this.layoutFeats(Object(c.a)(Object(c.a)({},t),{},{features:l,layout:f})),g=Object(u.a)(o,1),m=g[0],b=m.end,v=m.start,y=m.originalRefName,O=m.refName,!s){e.next=18;break}return e.next=12,Object(V.b)(this.pluginManager,r,s);case 12:return j=e.sent,k=j.dataAdapter,e.next=16,k.getFeatures(Object(c.a)(Object(c.a)({},m),{},{refName:y||O,end:m.end+1})).pipe(Object(B.a)()).toPromise();case 16:x=e.sent,h=null===(w=x[0])||void 0===w?void 0:w.get("seq");case 18:return C=(b-v)/a,S=Math.max(f.getTotalHeight(),1),e.next=22,Object(Pe.a)(C,S,t,(function(e){return M.makeImageData(e,p,Object(c.a)(Object(c.a)({},t),{},{layout:f,features:l,regionSequence:h}))}));case 22:return T=e.sent,e.next=25,Object(F.a)(Object(D.a)(n.prototype),"render",this).call(this,Object(c.a)(Object(c.a)(Object(c.a)({},t),T),{},{features:l,layout:f,height:S,width:C}));case 25:return E=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)(Object(c.a)({},E),T),{},{features:l,layout:f,height:S,width:C,maxHeightReached:f.maxHeightReached}));case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(e){return new Mt(e)}}]),n}(xt.default);var Lt=Object(ie.observer)((function(e){var t=e.onMouseMove,n=e.blockKey,r=e.displayModel,a=e.width,o=e.height,i=e.regions,c=e.bpPerPx,s=e.sortedBy,l=e.colorBy,d=r.selectedFeatureId,g=r.featureIdUnderMouse,m=r.contextMenuFeature,h=Object(u.a)(i,1)[0],b=Object(f.useRef)(null),v=Object(f.useState)(!1),y=Object(u.a)(v,2),O=y[0],w=y[1],j=Object(f.useState)(!1),k=Object(u.a)(j,2),x=k[0],C=k[1];function S(e){O&&C(!0);var o=0,i=0,s=b.current;if(s){var u=s.getBoundingClientRect();o=u.left,i=u.top}o=e.clientX-o,i=e.clientY-i;var l=h.reversed?a-o:o,d=h.start+c*l,f=r.getFeatureOverlapping(n,d,i);t&&t(e,f)}function T(t,n){var r=e["onFeature".concat(t)],a=e["on".concat(t)];r&&g?r(n,g):a&&a(n,g)}Object(f.useEffect)((function(){var e,t,a=b.current;if(a){var o=a.getContext("2d");if(o){o.clearRect(0,0,a.width,a.height);var i=d?null===(e=r.getFeatureByID)||void 0===e?void 0:e.call(r,n,d):void 0;if(i){var s=Object(u.a)(i,4),l=s[0],f=s[1],p=s[2],v=s[3],y=Object(U.bpSpanPx)(l,p,h,c),O=Object(u.a)(y,2),w=O[0],j=O[1],k=Math.round(f),x=Math.round(v-f);o.shadowColor="#222266",o.shadowBlur=10,o.lineJoin="bevel",o.lineWidth=2,o.strokeStyle="#00b8ff",o.strokeRect(w-2,k-2,j-w+4,x+4),o.clearRect(w,k,j-w,x)}var C=g||(null===m||void 0===m?void 0:m.id()),S=C?null===(t=r.getFeatureByID)||void 0===t?void 0:t.call(r,n,C):void 0;if(S){var T=Object(u.a)(S,4),E=T[0],M=T[1],R=T[2],P=T[3],A=Object(U.bpSpanPx)(E,R,h,c),N=Object(u.a)(A,2),L=N[0],I=N[1],F=Math.round(M),D=Math.round(P-M);o.fillStyle="#0003",o.fillRect(L,F,I-L,D)}}}}),[c,h,n,d,r,g,m]);var E=Math.ceil(a);return p.a.createElement("div",{className:"PileupRendering","data-testid":"pileup-".concat(s||l?"".concat((null===s||void 0===s?void 0:s.type)||"").concat((null===l||void 0===l?void 0:l.type)||"").concat((null===l||void 0===l?void 0:l.tag)||""):"normal"),style:{position:"relative",width:E,height:o}},p.a.createElement(ue.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})),p.a.createElement("canvas",{"data-testid":"pileup_overlay_canvas",width:E,height:o+100,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:b,onMouseDown:function(e){return function(e){w(!0),C(!1),T("MouseDown",e)}(e)},onMouseEnter:function(e){return function(e){T("MouseEnter",e)}(e)},onMouseOut:function(e){return function(e){T("MouseOut",e),T("MouseLeave",e)}(e)},onMouseOver:function(e){return function(e){T("MouseOver",e)}(e)},onMouseUp:function(e){return function(e){w(!1),T("MouseUp",e)}(e)},onMouseLeave:function(e){return function(e){T("MouseOut",e),T("MouseLeave",e)}(e)},onMouseMove:function(e){return S(e)},onClick:function(e){return function(e){x||T("Click",e)}(e)},onContextMenu:function(e){return function(e){T("ContextMenu",e)}(e)},onFocus:function(){},onBlur:function(){}}))})),It=Object(E.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:b.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orienation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:b.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px",defaultValue:0},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function Ft(e){e.addRendererType((function(){return new Nt({name:"PileupRenderer",ReactComponent:Lt,configSchema:It,pluginManager:e})}))}var Dt=function(e){var t=e.getDisplayType("LinearPileupDisplay").configSchema,n=e.getDisplayType("LinearSNPCoverageDisplay").configSchema;return Object(E.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:t,snpCoverageDisplay:n},{baseConfiguration:He.d,explicitlyTyped:!0})},Bt=function(e,t){return b.types.compose("LinearAlignmentsDisplay",Me.BaseDisplay,b.types.model({PileupDisplay:b.types.maybe(e.getDisplayType("LinearPileupDisplay").stateModel),SNPCoverageDisplay:b.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:b.types.literal("LinearAlignmentsDisplay"),configuration:Object(E.ConfigurationReference)(t),height:250,showCoverage:!0,showPileup:!0,userFeatureScreenDensity:b.types.maybe(b.types.number)})).volatile((function(){return{scrollTop:0}})).actions((function(e){return{toggleCoverage:function(){e.showCoverage=!e.showCoverage},togglePileup:function(){e.showPileup=!e.showPileup},setScrollTop:function(t){e.scrollTop=t},setSNPCoverageHeight:function(t){e.snpCovHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get pileupDisplayConfig(){var t=Object(E.getConf)(e,"pileupDisplay"),n=Object(U.getContainingTrack)(e);return Object(c.a)(Object(c.a)({},t),{},{type:"LinearPileupDisplay",name:"".concat(Object(E.getConf)(n,"name")," pileup"),displayId:"".concat(e.configuration.displayId,"_pileup_xyz")})},getFeatureByID:function(t,n){return e.PileupDisplay.getFeatureByID(t,n)},searchFeatureByID:function(t){return e.PileupDisplay.searchFeatureByID(t)},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get sortedByPosition(){return e.PileupDisplay.sortedByPosition},get sortedByRefName(){return e.PileupDisplay.sortedByRefName},get snpCoverageDisplayConfig(){var t=Object(E.getConf)(e,"snpCoverageDisplay"),n=Object(U.getContainingTrack)(e);return Object(c.a)(Object(c.a)({},t),{},{type:"LinearSNPCoverageDisplay",name:"".concat(Object(E.getConf)(n,"name")," snp coverage"),displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")})},trackMenuItems:function(){return[].concat(Object(o.a)(t()),[{type:"subMenu",label:"Pileup settings",subMenu:e.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:e.SNPCoverageDisplay.trackMenuItems()}])}}})).actions((function(e){return{setSNPCoverageDisplay:function(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setUserFeatureScreenDensity:function(t){e.PileupDisplay.setUserFeatureScreenDensity(t),e.SNPCoverageDisplay.setUserFeatureScreenDensity(t)},setPileupDisplay:function(t){e.PileupDisplay={type:"LinearPileupDisplay",configuration:t}},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n}}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)((function(){e.SNPCoverageDisplay?Et()(e.snpCoverageDisplayConfig,Object(b.getSnapshot)(e.SNPCoverageDisplay.configuration))||(e.SNPCoverageDisplay.setHeight(e.snpCovHeight),e.SNPCoverageDisplay.setConfig(e.snpCoverageDisplayConfig)):e.setSNPCoverageDisplay(e.snpCoverageDisplayConfig),e.PileupDisplay?Et()(e.pileupDisplayConfig,Object(b.getSnapshot)(e.PileupDisplay.configuration))||e.PileupDisplay.setConfig(e.pileupDisplayConfig):e.setPileupDisplay(e.pileupDisplayConfig),e.PileupDisplay.filterBy&&!Et()(Object(b.getSnapshot)(e.PileupDisplay.filterBy),Object(b.getSnapshot)(e.SNPCoverageDisplay.filterBy))&&e.SNPCoverageDisplay.setFilterBy(Object(b.getSnapshot)(e.PileupDisplay.filterBy)),e.PileupDisplay.colorBy&&!Et()(Object(b.getSnapshot)(e.PileupDisplay.colorBy),e.SNPCoverageDisplay.colorBy?Object(b.getSnapshot)(e.SNPCoverageDisplay.colorBy):{})&&e.SNPCoverageDisplay.setColorBy(Object(b.getSnapshot)(e.PileupDisplay.colorBy))}))),Object(b.addDisposer)(e,Object(Ge.autorun)((function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)})))},renderSvg:function(t){return Object(i.a)(d.a.mark((function n(){var r;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height-e.SNPCoverageDisplay.height,n.next=3,Object(Ge.when)((function(){return e.PileupDisplay.ready}));case 3:return n.t0=p.a,n.t1=p.a.Fragment,n.t2=p.a,n.next=8,e.SNPCoverageDisplay.renderSvg(t);case 8:return n.t3=n.sent,n.t4=n.t2.createElement.call(n.t2,"g",null,n.t3),n.t5=p.a,n.t6={transform:"translate(0 ".concat(e.SNPCoverageDisplay.height,")")},n.next=14,e.PileupDisplay.renderSvg(Object(c.a)(Object(c.a)({},t),{},{overrideHeight:r}));case 14:return n.t7=n.sent,n.t8=n.t5.createElement.call(n.t5,"g",n.t6,n.t7),n.abrupt("return",n.t0.createElement.call(n.t0,n.t1,null,n.t4,n.t8));case 17:case"end":return n.stop()}}),n)})))()}}}))},Vt=Object(Xe.a)((function(){return{resizeHandle:{height:2,position:"absolute",zIndex:2}}}));var zt=Object(ie.observer)((function(e){var t=e.model,n=t.PileupDisplay,r=t.SNPCoverageDisplay,a=t.showPileup,o=t.showCoverage,i=Vt(),c=r.height;return p.a.createElement("div",{"data-testid":"display-".concat(Object(E.getConf)(t,"displayId")),style:{position:"relative"}},o?p.a.createElement(p.a.Fragment,null,p.a.createElement("div",{"data-testid":"Blockset-snpcoverage"},p.a.createElement(r.RenderingComponent,{model:r})),p.a.createElement(ue.ResizeHandle,{onDrag:function(e){return r.setHeight(r.height+e),e},className:i.resizeHandle,style:{top:c}})):null,a?p.a.createElement("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:o?r.height:0}},p.a.createElement(n.RenderingComponent,{model:n})):null)})),Wt=function(e){e.addDisplayType((function(){var t=Dt(e);return new w.a({name:"LinearAlignmentsDisplay",configSchema:t,stateModel:Bt(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:zt})}))};var Ut=function(e){return e.toLocaleString("en-US")},qt=p.a.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),o=n.get("refName"),i=n.get("snpinfo"),c=[o,r===a?Ut(r):"".concat(Ut(r),"..").concat(Ut(a))].filter((function(e){return!!e})).join(":"),s=null===i||void 0===i?void 0:i.total;return p.a.createElement("div",{ref:t},p.a.createElement("table",null,p.a.createElement("caption",null,c),p.a.createElement("thead",null,p.a.createElement("tr",null,p.a.createElement("th",null,"Base"),p.a.createElement("th",null,"Count"),p.a.createElement("th",null,"% of Total"),p.a.createElement("th",null,"Strands"),p.a.createElement("th",null,"Source"))),p.a.createElement("tbody",null,p.a.createElement("tr",null,p.a.createElement("td",null,"Total"),p.a.createElement("td",null,s),p.a.createElement("td",null)),Object.entries(i).map((function(e){var t=Object(u.a)(e,2),n=t[0],r=t[1];return Object.entries(r).map((function(e){var t=Object(u.a)(e,2),r=t[0],a=t[1],o=a.strands;return p.a.createElement("tr",{key:r},p.a.createElement("td",null,r.toUpperCase()),p.a.createElement("td",null,a.total),p.a.createElement("td",null,"total"===r||"skip"===r?"---":"".concat(Math.floor(a.total/(s||a.total||1)*100),"%")),p.a.createElement("td",null,o[-1]?"".concat(o[-1],"(-)"):"",o[1]?"".concat(o[1],"(+)"):""),p.a.createElement("td",null,n))}))})))))})),Ht=Object(ie.observer)((function(e){var t=e.model.featureUnderMouse;return t&&"skip"===t.get("type")?null:p.a.createElement(nt,Object.assign({TooltipContents:qt},e))}));function _t(e,t,n,r){return Gt.apply(this,arguments)}function Gt(){return(Gt=Object(i.a)(d.a.mark((function e(t,n,r,a){var o,i,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Object(U.getSession)(t),i=o.rpcManager,s=t.adapterConfig,u=Object(_e.getRpcSessionId)(t),e.next=5,i.call(Object(_e.getRpcSessionId)(t),"PileupGetGlobalValueForTag",Object(c.a)({adapterConfig:s,tag:n.tag,sessionId:u,regions:r.contentBlocks},a));case 5:return l=e.sent,e.abrupt("return",l);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e,t,n,r,a){return Xt.apply(this,arguments)}function Xt(){return(Xt=Object(i.a)(d.a.mark((function e(t,n,r,a,o){var i,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(U.getSession)(t),s=i.rpcManager,u=Object(_e.getRpcSessionId)(t),e.next=4,s.call(u,"PileupGetVisibleModifications",Object(c.a)({adapterConfig:n,tag:r.tag,sessionId:u,regions:a.contentBlocks},o));case 4:return l=e.sent,e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yt=new Map([["snpcoverage","SNPCoverageRenderer"]]),Qt=function(e,t){return b.types.compose("LinearSNPCoverageDisplay",lt(e,t),b.types.model({type:b.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:b.types.maybe(b.types.boolean),drawIndicators:b.types.maybe(b.types.boolean),drawArcs:b.types.maybe(b.types.boolean),filterBy:b.types.optional(b.types.model({flagInclude:b.types.optional(b.types.number,0),flagExclude:b.types.optional(b.types.number,1540),readName:b.types.maybe(b.types.string),tagFilter:b.types.maybe(b.types.model({tag:b.types.string,value:b.types.string}))}),{}),colorBy:b.types.maybe(b.types.model({type:b.types.string,tag:b.types.maybe(b.types.string)}))})).volatile((function(){return{modificationTagMap:Ge.observable.map({})}})).actions((function(e){return{setConfig:function(t){e.configuration=t},setFilterBy:function(t){e.filterBy=Object(b.cast)(t)},setColorBy:function(t){e.colorBy=Object(b.cast)(t)},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"],r=0;t.forEach((function(t){if(!e.modificationTagMap.has(t)){var a=n[r++];e.modificationTagMap.set(t,a)}}))}}})).views((function(e){var t=e.renderProps;return{get rendererConfig(){var t=Object(E.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(c.a)(Object(c.a)({},t),{},{drawInterbaseCounts:void 0===e.drawInterbaseCounts?t.drawInterbaseCounts:e.drawInterbaseCounts,drawIndicators:void 0===e.drawIndicators?t.drawIndicators:e.drawIndicators,drawArcs:void 0===e.drawArcs?t.drawArcs:e.drawArcs}),Object(b.getEnv)(e))},get drawArcsSetting(){return void 0!==e.drawArcs?e.drawArcs:Object(E.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){return void 0!==e.drawInterbaseCounts?e.drawInterbaseCounts:Object(E.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return void 0!==e.drawIndicators?e.drawIndicators:Object(E.readConfObject)(this.rendererConfig,"drawIndicators")},get modificationsReady(){var t;return"modifications"!==(null===(t=e.colorBy)||void 0===t?void 0:t.type)||Object.keys(JSON.parse(JSON.stringify(e.modificationTagMap))).length>0},renderProps:function(){var n=t();return Object(c.a)(Object(c.a)({},n),{},{notReady:n.notReady||!this.modificationsReady,filters:e.filters,modificationTagMap:JSON.parse(JSON.stringify(e.modificationTagMap)),colorBy:e.colorBy?Object(b.getSnapshot)(e.colorBy):void 0})}}})).actions((function(e){return{toggleDrawIndicators:function(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts:function(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs:function(){e.drawArcs=!e.drawArcsSetting},afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function t(){var n,r,a,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.colorBy,r=Object(U.getContainingView)(e),a=r.staticBlocks,"modifications"!==(null===n||void 0===n?void 0:n.type)){t.next=8;break}return t.next=6,Jt(e,Object(E.getConf)(e.parentTrack,"adapter"),n,a);case 6:o=t.sent,e.updateModificationColorMap(o);case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),{delay:1e3}))}}})).views((function(e){var t=e.trackMenuItems;return{get TooltipComponent(){return Ht},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:Object(E.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return Yt.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:function(){return[]},trackMenuItems:function(){return[].concat(Object(o.a)(t()),[{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:function(){e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:function(){e.toggleDrawInterbaseCounts()}},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:function(){e.toggleDrawArcs()}}])},get filters(){var t=[];if(e.filterBy){var n=e.filterBy,r=n.flagInclude,a=n.flagExclude,o=n.tagFilter,i=n.readName;if(t=["jexl:get(feature,'snpinfo') != undefined ? true : "+"((get(feature,'flags')&".concat(r,")==").concat(r,") && ")+"!((get(feature,'flags')&".concat(a,"))")],o){var c=o.tag,s=o.value;t.push("jexl:get(feature,'snpinfo') != undefined ? true : "+'"'.concat(s,"\" =='*' ? getTag(feature,\"").concat(c,'") != undefined : ')+'getTag(feature,"'.concat(c,'") == "').concat(s,'"'))}i&&t.push("jexl:get(feature,'snpinfo') != undefined ? true : "+"get(feature,'name') == \"".concat(i,'"'))}return new bt.a({filters:t})}}}))};function Kt(e){e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("SNPCoverageRenderer").configSchema;return Object(E.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:b.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:b.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:Object(E.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:t})},{baseConfiguration:He.d,explicitlyTyped:!0})}(e);return new w.a({name:"LinearSNPCoverageDisplay",configSchema:t,stateModel:Qt(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:ot})}))}var $t=function(e){var t=e.getRendererType("PileupRenderer").configSchema,n=e.getRendererType("SvgFeatureRenderer").configSchema;return Object(E.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:b.types.enumeration("Rendering",["pileup","svg"]),defaultValue:"pileup"},renderers:Object(E.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:t,SvgFeatureRenderer:n}),renderer:"",maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:b.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:Object(He.f)(e),explicitlyTyped:!0})},Zt=n(591),en=n.n(Zt),tn=n(184),nn=n(337),rn=n.n(nn),an=n(588),on=n.n(an),cn=n(865),sn=n.n(cn),un=n(1330),ln=n.n(un),dn=n(866),fn=n.n(dn),pn=n(1638);var gn=Object(ie.observer)((function(e){var t=e.model,n=t.sortedBy;return n?p.a.createElement("div",{"data-testid":"blurb-".concat(t.sortedBy),style:{backgroundColor:"white"}},p.a.createElement(pn.a,{color:"secondary",variant:"caption"},t.sortedBy?"Sorted by ".concat(n.type.toLowerCase()," at ").concat(n.refName,":").concat(n.pos):null)):null})),mn=["uniqueId"],hn=Object(f.lazy)((function(){return n.e(53).then(n.bind(null,1709))})),bn=Object(f.lazy)((function(){return n.e(54).then(n.bind(null,1710))})),vn=Object(f.lazy)((function(){return n.e(57).then(n.bind(null,1711))})),yn=Object(f.lazy)((function(){return n.e(55).then(n.bind(null,1712))})),On=Object(f.lazy)((function(){return n.e(56).then(n.bind(null,1713))})),wn=Object(f.lazy)((function(){return n.e(52).then(n.bind(null,1714))})),jn=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]),kn=function(e){return b.types.compose("LinearPileupDisplay",He.a,b.types.model({type:b.types.literal("LinearPileupDisplay"),configuration:Object(E.ConfigurationReference)(e),showSoftClipping:!1,featureHeight:b.types.maybe(b.types.number),noSpacing:b.types.maybe(b.types.boolean),fadeLikelihood:b.types.maybe(b.types.boolean),trackMaxHeight:b.types.maybe(b.types.number),mismatchAlpha:b.types.maybe(b.types.boolean),sortedBy:b.types.maybe(b.types.model({type:b.types.string,pos:b.types.number,tag:b.types.maybe(b.types.string),refName:b.types.string,assemblyName:b.types.string})),colorBy:b.types.maybe(b.types.model({type:b.types.string,tag:b.types.maybe(b.types.string),extra:b.types.frozen()})),filterBy:b.types.optional(b.types.model({flagInclude:b.types.optional(b.types.number,0),flagExclude:b.types.optional(b.types.number,1540),readName:b.types.maybe(b.types.string),tagFilter:b.types.maybe(b.types.model({tag:b.types.string,value:b.types.string}))}),{})})).volatile((function(){return{colorTagMap:Ge.observable.map({}),modificationTagMap:Ge.observable.map({}),ready:!1}})).actions((function(e){return{setReady:function(t){e.ready=t},setMaxHeight:function(t){e.trackMaxHeight=t},setFeatureHeight:function(t){e.featureHeight=t},setNoSpacing:function(t){e.noSpacing=t},setColorScheme:function(t){e.colorTagMap=Ge.observable.map({}),e.colorBy=Object(b.cast)(t),e.ready=!1},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"];t.forEach((function(t){if(!e.modificationTagMap.has(t)){var r=Object(o.a)(e.modificationTagMap.keys()).length,a=n[r];e.modificationTagMap.set(t,a)}}))},updateColorTagMap:function(t){var n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((function(t){if(!e.colorTagMap.has(t)){var r=Object(o.a)(e.colorTagMap.keys()).length,a=n[r];e.colorTagMap.set(t,a)}}))}}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function t(){var n,r,a,o,i,s,u,l,f,p,g;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=Object(U.getSession)(e),r=n.rpcManager,a=e.sortedBy,o=e.colorBy,i=Object(U.getContainingView)(e),null===o||void 0===o||!o.tag){t.next=9;break}return t.next=7,_t(e,o,i.staticBlocks);case 7:s=t.sent,e.updateColorTagMap(s);case 9:if("modifications"!==(null===o||void 0===o?void 0:o.type)){t.next=14;break}return t.next=12,Jt(e,Object(E.getConf)(e.parentTrack,["adapter"]),o,i.staticBlocks);case 12:u=t.sent,e.updateModificationColorMap(u);case 14:if(!a){t.next=23;break}return l=a.pos,f=a.refName,p=a.assemblyName,g={start:l,end:l+1,refName:f,assemblyName:p},t.next=19,e.rendererType.renderInClient(r,Object(c.a)({assemblyName:p,regions:[g],adapterConfig:e.adapterConfig,rendererType:e.rendererType.name,sessionId:Object(_e.getRpcSessionId)(e),timeout:1e6},e.renderProps()));case 19:e.setReady(!0),e.setCurrBpPerPx(i.bpPerPx),t.next=24;break;case 23:e.setReady(!0);case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 30:case"end":return t.stop()}}),t,null,[[0,26]])}))),{delay:1e3}))},selectFeature:function(t){var n=Object(U.getSession)(e);if(Object(U.isSessionModelWithWidgets)(n)){var r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:Object(U.getContainingView)(e)});n.showWidget(r)}n.setSelection(t)},clearSelected:function(){e.sortedBy=void 0},copyFeatureToClipboard:function(t){var n=t.toJSON(),r=(n.uniqueId,Object(s.a)(n,mn)),a=Object(U.getSession)(e);rn()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")},toggleSoftClipping:function(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha:function(){e.mismatchAlpha=!e.mismatchAlpha},setConfig:function(t){e.configuration=t},setSortedBy:function(t,n){var r=Object(U.getContainingView)(e).centerLineInfo;if(r){var a=r.refName,o=r.assemblyName,i=r.offset,c=Math.round(i)+1,s=a;c<0||(e.sortedBy={type:t,pos:c,refName:s,assemblyName:o,tag:n},e.ready=!1)}},setFilterBy:function(t){e.filterBy=Object(b.cast)(t)}}})).actions((function(e){var t=e.reload;return{reload:function(){e.clearSelected(),t()}}})).views((function(e){return{get maxHeight(){var t=Object(E.getConf)(e,["renderers",e.rendererTypeName])||{};return void 0!==e.trackMaxHeight?e.trackMaxHeight:t.maxHeight},get rendererConfig(){var t=Object(E.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create(Object(c.a)(Object(c.a)({},t),{},{height:e.featureHeight,noSpacing:e.noSpacing,maxHeight:this.maxHeight,mismatchAlpha:e.mismatchAlpha}),Object(b.getEnv)(e))},get featureHeightSetting(){return e.featureHeight||Object(E.readConfObject)(this.rendererConfig,"height")},get mismatchAlphaSetting(){return void 0!==e.mismatchAlpha?e.mismatchAlpha:Object(E.readConfObject)(this.rendererConfig,"mismatchAlpha")}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{get rendererTypeName(){var t=Object(E.getConf)(e,"defaultRendering"),n=jn.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},contextMenuItems:function(){var t=e.contextMenuFeature,n=t?[{label:"Open feature details",icon:on.a,onClick:function(){e.clearFeatureSelection(),t&&e.selectFeature(t)}},{label:"Copy info to clipboard",icon:tn.b,onClick:function(){t&&e.copyFeatureToClipboard(t)}}]:[];return n},get DisplayBlurb(){return gn},get filters(){var t=[],n=e.filterBy,r=n.flagInclude,a=n.flagExclude,o=n.tagFilter,i=n.readName;if(t=["jexl:((get(feature,'flags')&".concat(r,")==").concat(r,") && !(get(feature,'flags')&").concat(a,")")],o){var c=o.tag,s=o.value;t.push('jexl:"'.concat(s,"\" =='*' ? getTag(feature,\"").concat(c,'") != undefined : getTag(feature,"').concat(c,'") == "').concat(s,'"'))}return i&&t.push("jexl:get(feature,'name') == \"".concat(i,'"')),new bt.a({filters:t})},renderProps:function(){var t=Object(U.getContainingView)(e),r=e.colorTagMap,a=e.modificationTagMap,o=e.sortedBy,i=e.colorBy,s=e.rpcDriverName,u=n();return Object(c.a)(Object(c.a)({},u),{},{notReady:u.notReady||!e.ready||o&&e.currBpPerPx!==t.bpPerPx,rpcDriverName:s,displayModel:e,sortedBy:o,colorBy:i,colorTagMap:JSON.parse(JSON.stringify(r)),modificationTagMap:JSON.parse(JSON.stringify(a)),filters:this.filters,showSoftClip:e.showSoftClipping,config:e.rendererConfig})},trackMenuItems:function(){return[].concat(Object(o.a)(t()),[{label:"Show soft clipping",icon:en.a,type:"checkbox",checked:e.showSoftClipping,onClick:function(){e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Sort by",icon:sn.a,disabled:e.showSoftClipping,subMenu:[].concat(Object(o.a)(["Start location","Read strand","Base pair"].map((function(t){return{label:t,onClick:function(){return e.setSortedBy(t)}}}))),[{label:"Sort by tag...",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[vn,{model:e,handleClose:t}]}))}},{label:"Clear sort",onClick:function(){return e.clearSelected()}}])},{label:"Color scheme",icon:ln.a,subMenu:[{label:"Normal",onClick:function(){e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:function(){e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:function(){e.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:function(){e.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:function(){e.setColorScheme({type:"perBaseQuality"})}},{label:"Modifications or methylation",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[wn,{model:e,handleClose:t}]}))}},{label:"Insert size",onClick:function(){e.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:function(){e.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[hn,{model:e,handleClose:t}]}))}}]},{label:"Filter by",icon:fn.a,onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[bn,{model:e,handleClose:t}]}))}},{label:"Set feature height",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[yn,{model:e,handleClose:t}]}))}},{label:"Set max height",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[On,{model:e,handleClose:t}]}))}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:function(){e.toggleMismatchAlpha()}}])}}}))};function xn(e){e.addDisplayType((function(){var t=$t(e);return new w.a({name:"LinearPileupDisplay",configSchema:t,stateModel:kn(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:He.b})}))}function Cn(e){e.addTrackType((function(){var t=function(e){return Object(E.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:Object(Me.createBaseTrackConfig)(e)})}(e),n=new O.a({name:"AlignmentsTrack",configSchema:t,stateModel:Object(Me.createBaseTrackModel)(e,"AlignmentsTrack",t)}),r=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(r),n}))}var Sn=Object(E.ConfigurationSchema)("AlignmentsFeatureWidget",{});function Tn(e){return b.types.model("AlignmentsFeatureWidget",{id:N.ElementId,type:b.types.literal("AlignmentsFeatureWidget"),featureData:b.types.frozen(),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}function En(e){e.addWidgetType((function(){return new k.a({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:Sn,stateModel:Tn(e),ReactComponent:Object(f.lazy)((function(){return n.e(50).then(n.bind(null,1715))}))})}))}var Mn=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="PileupGetGlobalValueForTag",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.pluginManager.rootModel,i=null===o||void 0===o||null===(a=o.session)||void 0===a?void 0:a.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.next=6,Object(U.renameRegionsIfNeeded)(i,t);case 6:return c=e.sent,e.abrupt("return",Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,c,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,i,c,s,u,l,f,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,c=r.regions,s=r.tag,e.next=6,Object(V.b)(this.pluginManager,i,a);case 6:return u=e.sent.dataAdapter,l=u.getFeaturesInMultipleRegions(c),e.next=10,l.pipe(Object(B.a)()).toPromise();case 10:return f=e.sent,p=new Set,f.forEach((function(e){var t=e.get("tags"),n=t?t[s]:e.get(s);void 0!==n&&p.add("".concat(n))})),e.abrupt("return",Object(o.a)(p));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),Rn=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="PileupGetVisibleModifications",e}return Object(h.a)(n,[{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.pluginManager.rootModel,i=null===o||void 0===o||null===(a=o.session)||void 0===a?void 0:a.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.next=6,Object(U.renameRegionsIfNeeded)(i,t);case 6:return c=e.sent,e.abrupt("return",Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,c,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,i,c,s,u,l,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,c=r.regions,e.next=6,Object(V.b)(this.pluginManager,i,a);case 6:return s=e.sent.dataAdapter,u=s.getFeaturesInMultipleRegions(c),e.next=10,u.pipe(Object(B.a)()).toPromise();case 10:return l=e.sent,f=new Set,l.forEach((function(e){var t=Object(St.b)(e,"MM","Mm")||"";void 0!==t&&Object(ve.getModificationTypes)(t).forEach((function(e){return f.add(e)}))})),e.abrupt("return",Object(o.a)(f));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.a),Pn=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="AlignmentsPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){[je,Oe,xn,Kt,Cn,Te,xe,Ft,kt,Wt,En].map((function(t){return t(e)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="CramAdapter",o=Object(_e.getFileName)(t),i={type:a,cramLocation:t,craiLocation:n||Object(_e.makeIndex)(t,".crai")};return/\.cram$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BamAdapter",o=Object(_e.getFileName)(t),i=n&&Object(_e.getFileName)(n),c={type:a,bamLocation:t,index:{location:n||Object(_e.makeIndex)(t,".bai"),indexType:Object(_e.makeIndexType)(i,"CSI","BAI")}};return/\.bam$/i.test(o)&&!r||r===a?c:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)}})),e.addRpcMethod((function(){return new Mn(e)})),e.addRpcMethod((function(){return new Rn(e)}))}}]),n}(M.a),An=Object(E.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"code"},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!1}},{baseConfiguration:Me.BaseInternetAccountConfig,explicitlyTyped:!0}),Nn=n(457),Ln=Object(E.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:Me.BaseInternetAccountConfig,explicitlyTyped:!0}),In=n(1635),Fn=n(1666),Dn=n(1670),Bn=n(1669),Vn=n(1671),zn=n(1645),Wn=function(e){var t=e.internetAccountId,n=e.handleClose,r=Object(f.useState)(""),a=Object(u.a)(r,2),o=a[0],i=a[1];return p.a.createElement(p.a.Fragment,null,p.a.createElement(Fn.a,{open:!0,maxWidth:"xl","data-testid":"externalToken-form"},p.a.createElement(Bn.a,null,"Enter Token for ",t),p.a.createElement(Dn.a,{style:{display:"flex",flexDirection:"column"}},p.a.createElement(zn.a,{required:!0,label:"Enter Token",variant:"outlined",inputProps:{"data-testid":"entry-externalToken"},onChange:function(e){i(e.target.value)},margin:"dense"})),p.a.createElement(Vn.a,null,p.a.createElement(In.a,{variant:"contained",color:"primary",type:"submit",disabled:!o,onClick:function(){o&&n(o)}},"Add"),p.a.createElement(In.a,{variant:"contained",color:"primary",onClick:function(){n()}},"Cancel"))))},Un=function(e){return b.types.compose("ExternalTokenInternetAccount",Me.InternetAccount,b.types.model({type:b.types.literal("ExternalTokenInternetAccount"),configuration:Object(E.ConfigurationReference)(e)})).views((function(e){return{get validateWithHEAD(){return Object(E.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){Object(b.getRoot)(e).session.queueDialog((function(r){return[Wn,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return Object(i.a)(d.a.mark((function r(){var a,o,i;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((o=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,o.text();case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),i="";case 16:throw new Error("Token could not be validated \u2014 ".concat(o.status," (").concat(o.statusText,")").concat(i?" (".concat(i,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))},qn=Object(E.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:Me.BaseInternetAccountConfig,explicitlyTyped:!0}),Hn=function(e){var t=e.internetAccountId,n=e.handleClose,r=Object(f.useState)(""),a=Object(u.a)(r,2),o=a[0],i=a[1],c=Object(f.useState)(""),s=Object(u.a)(c,2),l=s[0],d=s[1];return p.a.createElement(p.a.Fragment,null,p.a.createElement(Fn.a,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic"},p.a.createElement(Bn.a,null,"Log In for ",t),p.a.createElement("form",{onSubmit:function(e){o&&l?n(btoa("".concat(o,":").concat(l))):n(),e.preventDefault()}},p.a.createElement(Dn.a,{style:{display:"flex",flexDirection:"column"}},p.a.createElement(zn.a,{required:!0,label:"Username",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-username"},onChange:function(e){i(e.target.value)},margin:"dense"}),p.a.createElement(zn.a,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-password"},onChange:function(e){d(e.target.value)},margin:"dense"})),p.a.createElement(Vn.a,null,p.a.createElement(In.a,{variant:"contained",color:"primary",type:"submit"},"Submit"),p.a.createElement(In.a,{variant:"contained",color:"default",type:"submit",onClick:function(){n()}},"Cancel")))))},_n=function(e){return b.types.compose("HTTPBasicInternetAccount",Me.InternetAccount,b.types.model({type:b.types.literal("HTTPBasicInternetAccount"),configuration:Object(E.ConfigurationReference)(e)})).views((function(e){return{get validateWithHEAD(){return Object(E.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){Object(b.getRoot)(e).session.queueDialog((function(r){return[Hn,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return Object(i.a)(d.a.mark((function r(){var a,o,i;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((o=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,o.text();case 10:i=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),i="";case 16:throw new Error("Error validating token \u2014 ".concat(o.status," (").concat(o.statusText,")").concat(i?" (".concat(i,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))},Gn=Object(E.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!0}},{baseConfiguration:An,explicitlyTyped:!0}),Jn=n(1624),Xn={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};function Yn(e){return p.a.createElement(Jn.a,e,p.a.createElement("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"}))}function Qn(e){return Kn.apply(this,arguments)}function Kn(){return(Kn=Object(i.a)(d.a.mark((function e(t){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(o){r=void 0}r&&(a=r.error[".tag"],n=Xn[a]||a)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var $n=function(e){return b.types.compose("DropboxOAuthInternetAccount",Object(Nn.a)(An),b.types.model({type:b.types.literal("DropboxOAuthInternetAccount"),configuration:Object(E.ConfigurationReference)(e)})).views((function(){return{get toggleContents(){return p.a.createElement(Yn,null)},get selectorLabel(){return"Enter Dropbox share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=Object(i.a)(d.a.mark((function n(r,a){var o,i,s,u;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return o=n.sent,(i=e.addAuthHeaderToInit(Object(c.a)(Object(c.a)({},a),{},{method:"POST"}),o)).headers.append("Dropbox-API-Arg",JSON.stringify({url:r})),n.next=7,fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",i);case 7:if((s=n.sent).ok){n.next=13;break}return n.next=11,Qn(s);case 11:throw u=n.sent,new Error(u);case 13:return n.abrupt("return",s);case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},validateToken:function(t,n){var r=this;return Object(i.a)(d.a.mark((function a(){var o,i,c,s;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});case 2:if((o=a.sent).ok){a.next=15;break}if(!(i=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=11;break}return e.removeRefreshToken(),a.next=9,e.exchangeRefreshForAccessToken(i);case 9:return c=a.sent,a.abrupt("return",r.validateToken(c,n));case 11:return a.next=13,Qn(o);case 13:throw s=a.sent,new Error("Token could not be validated. ".concat(s));case 15:return a.abrupt("return",t);case 16:case"end":return a.stop()}}),a)})))()}}}))},Zn=Object(E.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:An,explicitlyTyped:!0}),er=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e,r){var a;return Object(m.a)(this,n),(a=t.call(this,e,r)).statsPromise=void 0,a.statsPromise=a.fetch(e,{metadataOnly:!0}).then((function(e){return e.json()})),a}return Object(h.a)(n,[{key:"fetch",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(F.a)(Object(D.a)(n.prototype),"fetch",this).call(this,t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.statsPromise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}($.RemoteFileWithRangeCache);function tr(e){return p.a.createElement(Jn.a,e,p.a.createElement("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"}))}function nr(e){return rr.apply(this,arguments)}function rr(){return(rr=Object(i.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(a){r=void 0}r&&(n=r.error.message)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var ar=function(e){return b.types.compose("GoogleDriveOAuthInternetAccount",Object(Nn.a)(An),b.types.model({type:b.types.literal("GoogleDriveOAuthInternetAccount"),configuration:Object(E.ConfigurationReference)(e)})).views((function(){return{get toggleContents(){return p.a.createElement(tr,null)},get selectorLabel(){return"Enter Google Drive share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=Object(i.a)(d.a.mark((function n(r,a){var o,i,s,u,l,f,p;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=String(r).match(/[-\w]{25,}/),i=new URL("https://www.googleapis.com/drive/v3/files/".concat(o)),s=new URLSearchParams,null!==a&&void 0!==a&&a.metadataOnly?s.append("fields","size"):s.append("alt","media"),i.search=s.toString(),n.next=7,e.getToken(t);case 7:return u=n.sent,l=e.addAuthHeaderToInit(Object(c.a)(Object(c.a)({},a),{},{method:"GET",credentials:"same-origin"}),u),n.next=11,fetch(i.toString(),l);case 11:if((f=n.sent).ok){n.next=17;break}return n.next=15,nr(f);case 15:throw p=n.sent,new Error(p);case 17:return n.abrupt("return",f);case 18:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},openLocation:function(e){return new er(e.uri,{fetch:this.getFetcher(e)})},validateToken:function(e,t){return Object(i.a)(d.a.mark((function n(){var r,a,o;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.uri.match(/[-\w]{25,}/),n.next=3,fetch("https://www.googleapis.com/drive/v3/files/".concat(r),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((a=n.sent).ok){n.next=9;break}return n.next=7,nr(a);case 7:throw o=n.sent,new Error("Token could not be validated. ".concat(o));case 9:return n.abrupt("return",e);case 10:case"end":return n.stop()}}),n)})))()}}}))},or=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="AuthenticationPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addInternetAccountType((function(){return new S.a({name:"OAuthInternetAccount",configSchema:An,stateModel:Object(Nn.a)(An)})})),e.addInternetAccountType((function(){return new S.a({name:"ExternalTokenInternetAccount",configSchema:Ln,stateModel:Un(Ln)})})),e.addInternetAccountType((function(){return new S.a({name:"HTTPBasicInternetAccount",configSchema:qn,stateModel:_n(qn)})})),e.addInternetAccountType((function(){return new S.a({name:"DropboxOAuthInternetAccount",configSchema:Gn,stateModel:$n(Gn)})})),e.addInternetAccountType((function(){return new S.a({name:"GoogleDriveOAuthInternetAccount",configSchema:Zn,stateModel:ar(Zn)})}))}}]),n}(M.a),ir=Object(E.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0}),cr=Object(E.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:Object(E.ConfigurationSchema)("TabixIndex",{indexType:{model:b.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),sr=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="BedPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"BigBedAdapter",configSchema:ir,getAdapterClass:function(){return Promise.all([n.e(0),n.e(5),n.e(8),n.e(39)]).then(n.bind(null,1716)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigBedAdapter",o=Object(_e.getFileName)(t),i={type:a,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addAdapterType((function(){return new y.a({name:"BedTabixAdapter",configSchema:cr,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(8),n.e(38)]).then(n.bind(null,1717)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BedTabixAdapter",o=Object(_e.getFileName)(t),i=n&&Object(_e.getFileName)(n);return/\.bed\.b?gz$/i.test(o)||r===a?{type:a,bedGzLocation:t,index:{location:n||Object(_e.makeIndex)(t,".tbi"),indexType:Object(_e.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)}}))}}]),r}(M.a),ur=Object(E.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),lr=b.types.model("BreakpointAlignmentsWidget",{id:N.ElementId,type:b.types.literal("BreakpointAlignmentsWidget"),featureData:b.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),dr=n(861),fr=n(213);function pr(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.filter((function(e){return t.includes(e)})),r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];return 0===a.length?n:pr.apply(void 0,[n].concat(a))}function gr(e){var t=b.types.model("BreakpointSplitView",{type:b.types.literal("BreakpointSplitView"),height:b.types.optional(b.types.refinement("viewHeight",b.types.number,(function(e){return e>=40})),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:b.types.array(e.getViewType("LinearGenomeView").stateModel)}).volatile((function(){return{width:800}})).views((function(e){return{get matchedTracks(){return pr.apply(void 0,Object(o.a)(e.views.map((function(e){return e.tracks.map((function(e){return e.configuration.trackId}))}))))},menuItems:function(){e.views.map((function(e,t){var n;return[t,null===(n=e.menuItems)||void 0===n?void 0:n.call(e)]})).filter((function(e){return!!e[1]})).map((function(e){return{label:"View ".concat(e[0]," Menu"),subMenu:e[1]}}))},get viewDividerHeight(){return 3},getMatchedTracks:function(t){return e.views.map((function(e){return e.getTrack(t)})).filter((function(e){return!!e}))},hasPairedReads:function(e){return this.getTrackFeatures(e).find((function(e){return 64&e.get("flags")}))},hasTranslocations:function(e){return this.getTrackFeatures(e).find((function(e){return"translocation"===e.get("type")}))},getTrackFeatures:function(e){var t;return new dr.a((null===(t=this.getMatchedTracks(e))||void 0===t?void 0:t.map((function(e){return e.displays[0].features})))||[])},getMatchedTranslocationFeatures:function(e){var t,n=this.getTrackFeatures(e),r=[],a=new Set,o=Object(g.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;a.has(i.id())||"<TRA>"===i.get("ALT")[0]&&r.push([i]),a.add(i.id())}}catch(c){o.e(c)}finally{o.f()}return r},getMatchedBreakendFeatures:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,o=Object(g.a)(n.values());try{var i=function(){var e=t.value;if(!a.has(e.id())&&"breakend"===e.get("type")){var n=e.get("ALT");null===n||void 0===n||n.forEach((function(t){var n="".concat(e.get("refName"),":").concat(e.get("start")+1),a=Object(fr.b)(t);a&&(r[n]?r[n].push(e):r[a.MatePosition]=[e])}))}a.add(e.id())};for(o.s();!(t=o.n()).done;)i()}catch(c){o.e(c)}finally{o.f()}return Object.values(r).filter((function(e){return e.length>1}))},getMatchedAlignmentFeatures:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,o=Object(g.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value,c=i.id(),s=4&i.get("flags");if(!a.has(c)&&!s){var u=i.get("name");r[u]||(r[u]=[]),r[u].push(i)}a.add(i.id())}}catch(l){o.e(l)}finally{o.f()}return Object.values(r).filter((function(e){return e.length>1}))},getBadlyPairedAlignments:function(e){var t,n=this.getTrackFeatures(e),r={},a=new Set,o=Object(g.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value,c=i.get("flags"),s=i.id(),u=4&c,l=2&c;if(!a.has(s)&&!l&&!u){var d=i.get("name");r[d]||(r[d]=[]),r[d].push(i)}a.add(i.id())}}catch(f){o.e(f)}finally{o.f()}return Object.values(r).filter((function(e){return e.length>1}))},getMatchedFeaturesInLayout:function(e,t){var n=this.getMatchedTracks(e),r=function(e,t){return e.displays[0].searchFeatureByID(t.id())};return t.map((function(e){return e.map((function(e){var t=n.findIndex((function(t){return r(t,e)})),a=r(n[t],e);return{feature:e,layout:a,level:t}}))}))}}})).actions((function(e){return{afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(b.onAction)(e,(function(n){var r=n.name,a=n.path,o=n.args;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(r)&&a&&t.onSubviewAction(r,a,o)}})))},onSubviewAction:function(t,n,r){e.views.forEach((function(e){var a=Object(b.getPath)(e);a.lastIndexOf(n)!==a.length-n.length&&e[t](null===r||void 0===r?void 0:r[0])}))},setWidth:function(t){e.width=t,e.views.forEach((function(e){return e.setWidth(t)}))},removeView:function(t){e.views.remove(t)},closeView:function(){Object(b.getParent)(e,2).removeView(e)},toggleInteract:function(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks:function(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews:function(){e.linkViews=!e.linkViews}}}));return{stateModel:b.types.compose(Me.BaseViewModel,t)}}var mr=n(426),hr=n.n(mr),br=[0,1,2,3],vr=br[1],yr=br[3];function Or(e,t,n){return((e.bpToPx({refName:t,coord:n})||{}).offsetPx||0)-e.offsetPx}function wr(e,t,n,r,a){var o,i=r[t].displays[0],c=i.height,s=0,u=i.showCoverage,l=i.SNPCoverageDisplay;return l&&u&&(s=l.height+5),Object(U.clamp)(a[vr]-i.scrollTop+((o=a)[yr]-o[vr])/2+s,0,c)+function(e,t,n){var r=e[n].trackRefs[t];return(null===r||void 0===r?void 0:r.getBoundingClientRect().top)||0}(n,e,t)+i.scrollTop}var jr=function(e){var t=Object(f.useState)(),n=Object(u.a)(t,2)[1];Object(f.useEffect)((function(){n(e)}),[e])},kr=[0,1,2,3],xr=kr[0],Cr=kr[2],Sr=Object(ie.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,o=t.showIntraviewLinks,i=Object(U.getSession)(t).assemblyManager,c=Object(U.getSession)(t),s=Object(b.getSnapshot)(t);jr(s);var l=i.get(a[0].assemblyNames[0]),d=t.getTrackFeatures(n),g=t.hasPairedReads(n)?t.getBadlyPairedAlignments(n):t.getMatchedAlignmentFeatures(n),m=t.getMatchedFeaturesInLayout(n,g);m.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))}));var h=Object(f.useState)(),v=Object(u.a)(h,2),y=v[0],O=v[1],w=0;if(r.current){var j=r.current.getBoundingClientRect();w=j.top}return l?p.a.createElement("g",{stroke:"#333",fill:"none","data-testid":m.length?"".concat(n,"-loaded"):n},m.map((function(e){for(var t=[],r=function(r){var i=e[r],s=i.layout,u=i.feature,f=i.level,g=e[r+1],m=g.layout,h=g.feature,b=g.level;if(!s||!m)return console.warn("received null layout for a overlay feature"),{v:null};if(!o&&f===b)return{v:null};var v=u.get("refName"),j=h.get("refName"),k=l.getCanonicalRefName(v),x=l.getCanonicalRefName(j);if(!k||!x)throw new Error("unable to find ref for ".concat(k||x));var C=Or(a[f],k,s[-1===u.get("strand")?xr:Cr]),S=Or(a[b],x,m[-1===h.get("strand")?Cr:xr]),T=a[f].pxToBp(C).reversed,E=a[b].pxToBp(S).reversed,M=a.map((function(e){return e.getTrack(n)})),R=wr(n,f,a,M,s)-w,P=wr(n,b,a,M,m)-w,A=hr()().moveTo(C,R).curveTo(C+200*u.get("strand")*(T?-1:1),R,S-200*h.get("strand")*(E?-1:1),P,S,P).end(),N="".concat(u.id(),"-").concat(h.id());t.push(p.a.createElement("path",{d:A,key:N,"data-testid":"r1",strokeWidth:y===N?5:1,onClick:function(){var e,t,n=null===(e=c.addWidget)||void 0===e?void 0:e.call(c,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(d.get(u.id())||{toJSON:function(){}}).toJSON(),feature2:(d.get(h.id())||{toJSON:function(){}}).toJSON()}});null===(t=c.showWidget)||void 0===t||t.call(c,n)},onMouseOver:function(){return O(N)},onMouseOut:function(){return O(void 0)}}))},i=0;i<e.length-1;i+=1){var s=r(i);if("object"===typeof s)return s.v}return t}))):null}));var Tr=Object(ie.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,o=Object(U.getSession)(t),i=o.assemblyManager,c=t.getTrackFeatures(n),s=t.getMatchedBreakendFeatures(n),l=t.getMatchedFeaturesInLayout(n,s),d=Object(f.useState)(),g=Object(u.a)(d,2),m=g[0],h=g[1],v=Object(b.getSnapshot)(t);jr(v);var y=i.get(a[0].assemblyNames[0]);if(!y)return null;var O=0;if(r.current){var w=r.current.getBoundingClientRect();O=w.top}return p.a.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":l.length?"".concat(n,"-loaded"):n},l.map((function(e){for(var t=[],r=function(r){var i=e[r],s=i.layout,u=i.feature,l=i.level,d=e[r+1],f=d.layout,g=d.feature,b=d.level,v=u.id(),w=function(e,t){var n={},r=e.get("ALT");return null===r||void 0===r||r.map((function(e){return Object(fr.b)(e)})).filter((function(e){return!!e})).forEach((function(e){return n[e.MatePosition]=e})),n["".concat(t.get("refName"),":").concat(t.get("start")+1)]}(u,g);if(!s||!f)return{v:null};var j=u.get("refName"),k=g.get("refName"),x=y.getCanonicalRefName(j),C=y.getCanonicalRefName(k);if(!x||!C)throw new Error("unable to find ref for ".concat(x||C));var S=Or(a[l],x,s[0]),T=Or(a[b],C,f[0]),E=a[l].pxToBp(S).reversed,M=a[b].pxToBp(T).reversed,R=a.map((function(e){return e.getTrack(n)})),P=wr(n,l,a,R,s)-O,A=wr(n,b,a,R,f)-O;if(w){var N=hr()().moveTo(S-20*("left"===w.Join?-1:1)*(E?-1:1),P).lineTo(S,P).lineTo(T,A).lineTo(T-20*("left"===w.MateDirection?1:-1)*(M?-1:1),A).end();t.push(p.a.createElement("path",{d:N,key:JSON.stringify(N),strokeWidth:v===m?10:5,onClick:function(){var e,t,n=null===(e=o.addWidget)||void 0===e?void 0:e.call(o,"VariantFeatureWidget","variantFeature",{featureData:c.get(v)});null===(t=o.showWidget)||void 0===t||t.call(o,n)},onMouseOver:function(){return h(v)},onMouseOut:function(){return h(void 0)}}))}else console.warn("the relevant ALT allele was not found, cannot render")},i=0;i<e.length-1;i+=1){var s=r(i);if("object"===typeof s)return s.v}return t})))})),Er=n(1642),Mr=n(1333),Rr=n.n(Mr),Pr=n(1334),Ar=n.n(Pr),Nr=n(1335),Lr=n.n(Nr),Ir=n(1336),Fr=n.n(Ir),Dr=n(459),Br=n.n(Dr),Vr=n(460),zr=n.n(Vr),Wr=Object(Xe.a)((function(e){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1}}})),Ur=Object(ie.observer)((function(e){var t=e.model;return p.a.createElement(Er.a,{onClick:function(){return t.toggleInteract()},title:"Toggle interacting with the overlay"},t.interactToggled?p.a.createElement(Rr.a,null):p.a.createElement(Ar.a,null))})),qr=Object(ie.observer)((function(e){var t=e.model;return p.a.createElement(Er.a,{onClick:function(){return t.toggleLinkViews()},title:"Toggle linked scrolls and behavior across views"},t.linkViews?p.a.createElement(Br.a,{color:"secondary"}):p.a.createElement(zr.a,{color:"secondary"}))})),Hr=Object(ie.observer)((function(e){var t=e.model;return p.a.createElement(Er.a,{onClick:t.toggleIntraviewLinks,title:"Toggle rendering intraview links"},t.showIntraviewLinks?p.a.createElement(Lr.a,{color:"secondary"}):p.a.createElement(Fr.a,{color:"secondary"}))})),_r=Object(ie.observer)((function(e){var t=e.model,n=Wr();return p.a.createElement("div",{className:n.headerBar},p.a.createElement(qr,{model:t}),p.a.createElement(Ur,{model:t}),p.a.createElement(Hr,{model:t}),p.a.createElement("div",{className:n.spacer}))})),Gr=Object(ie.observer)((function(e){var t=e.model,n=e.trackConfigId,r=e.parentRef,a=t.views,o=Object(U.getSession)(t),i=t.getMatchedTranslocationFeatures(n),c=t.getTrackFeatures(n),s=t.getMatchedFeaturesInLayout(n,i),l=Object(f.useState)(),d=Object(u.a)(l,2),g=d[0],m=d[1],h=Object(b.getSnapshot)(t);if(jr(h),!o.assemblyManager.get(a[0].assemblyNames[0]))return null;var v=0;if(r.current){var y=r.current.getBoundingClientRect();v=y.top}return a.length<2?null:p.a.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":s.length?"".concat(n,"-loaded"):n},s.map((function(e){for(var t=[],r=function(r){var i=e[r],s=i.layout,l=i.feature,d=i.level,f=0===d?1:0,h=l.id();if(!s)return{v:null};var b=l.get("INFO"),y=b.CHR2[0],O=b.END[0],w=b.STRANDS[0].split(""),j=Object(u.a)(w,2),k=j[0],x=j[1],C=Or(a[f],y,O);if(C){var S=[C,0,C+1,0],T=Or(a[d],l.get("refName"),s[0]),E=C,M=a[d].pxToBp(T).reversed,R=a[f].pxToBp(E).reversed,P=a.map((function(e){return e.getTrack(n)})),A=wr(n,d,a,P,s)-v,N=wr(n,f,a,P,S)-v,L=hr()().moveTo(T-20*("+"===k?1:-1)*(M?-1:1),A).lineTo(T,A).lineTo(E,N).lineTo(E-20*("+"===x?1:-1)*(R?-1:1),N).end();t.push(p.a.createElement("path",{d:L,key:JSON.stringify(L),strokeWidth:h===g?10:5,onClick:function(){var e,t,n=null===(e=o.addWidget)||void 0===e?void 0:e.call(o,"VariantFeatureWidget","variantFeature",{featureData:(c.get(h)||{toJSON:function(){}}).toJSON()});null===(t=o.showWidget)||void 0===t||t.call(o,n)},onMouseOver:function(){return m(h)},onMouseOut:function(){return m(void 0)}}))}},i=0;i<e.length;i+=1){var s=r(i);if("object"===typeof s)return s.v}return t})))})),Jr=Object(Xe.a)((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:"3px",background:"magenta"},viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}},content:{gridArea:"1/1"}}})),Xr=Object(ie.observer)((function(e){var t=e.model,n=e.trackConfigId,r=t.getMatchedTracks(n);return"PileupTrack"===r[0].type||"AlignmentsTrack"===r[0].type?p.a.createElement(Sr,e):"VariantTrack"===r[0].type?t.hasTranslocations(n)?p.a.createElement(Gr,e):p.a.createElement(Tr,e):null})),Yr=Object(ie.observer)((function(e){var t=e.model,n=Jr(),r=t.views,a=Object(b.getEnv)(t).pluginManager,o=Object(f.useRef)(null);return p.a.createElement("div",null,p.a.createElement(_r,{model:t}),p.a.createElement("div",{className:n.container},p.a.createElement("div",{className:n.content},p.a.createElement("div",{style:{position:"relative"}},r.map((function(e,t){var o=a.getViewType(e.type).ReactComponent,i=p.a.createElement(o,{key:e.id,model:e});return t===r.length-1?i:[i,p.a.createElement("div",{key:"".concat(e.id,"-divider"),className:n.viewDivider})]})))),p.a.createElement("div",{className:n.overlay},p.a.createElement("svg",{ref:o,style:{width:"100%",zIndex:10,pointerEvents:t.interactToggled?void 0:"none"}},t.matchedTracks.map((function(e){return p.a.createElement(Xr,{parentRef:o,key:e,model:t,trackConfigId:e})}))))))})),Qr=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"snapshotFromBreakendFeature",value:function(e,t){var n,r,a=null===(n=e.get("ALT"))||void 0===n?void 0:n[0],o=a?Object(fr.b)(a):void 0,i=e.get("start"),s=t.displayedRegions[0].assemblyName,u=Object(U.getSession)(t).assemblyManager.get(s);if(!u)throw new Error("assembly ".concat(s," not found"));if(!u.regions)throw new Error("assembly ".concat(s," regions not loaded"));var l,d=u.getCanonicalRefName,f=d(e.get("refName")),p=u.regions.find((function(e){return e.refName===String(f)})),g=0,m=0;if("<TRA>"===a){var h=e.get("INFO");r=h.END[0]-1,l=d(h.CHR2[0])}else if(o){var b=o.MatePosition.split(":");r=+b[1]-1,l=d(b[0]),"left"===o.Join&&(g=-1),"left"===o.MateDirection&&(m=-1)}else if(e.get("mate")){var v=e.get("mate");l=d(v.refName),r=v.start}if(!l)return console.warn("unable to resolve mate refName ".concat(l," in reference genome")),{};var y=u.regions.find((function(e){return e.refName===String(l)}));if(!p||!y)return console.warn("unable to find the refName for the top or bottom of the breakpoint view"),{};var O=[Object(c.a)({},p),Object(c.a)({},p)],w=[Object(c.a)({},y),Object(c.a)({},y)];return O[0].end=i+g,O[1].start=i+g,w[0].end=r+m,w[1].start=r+m,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:O,hideHeader:!0,bpPerPx:10,offsetPx:(p.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:w,hideHeader:!0,bpPerPx:10,offsetPx:(y.start+r)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail")}}}]),n}(j.a),Kr=function(e){var t=(0,e.load)(gr).stateModel;return new Qr({name:"BreakpointSplitView",stateModel:t,ReactComponent:Yr})},$r=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="BreakpointSplitViewPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(Kr)})),e.addWidgetType((function(){return new k.a({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:ur,stateModel:lr,ReactComponent:Object(f.lazy)((function(){return n.e(58).then(n.bind(null,1718))}))})}))}},{key:"configure",value:function(){}}]),r}(M.a),Zr=n(657),ea=n(658),ta=n(253),na=n(125),ra=n(152);function aa(e){return 31===e[0]&&139===e[1]&&8===e[2]}var oa=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).setupP=void 0,e}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object($.openLocation)(this.getConf("pafLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!aa(r=e.sent)){e.next=10;break}return e.next=7,Object(ra.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return o=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",o.split("\n").filter((function(e){return!!e})).map((function(e){var t=e.split("\t"),n=Object(ta.a)(t),r=n[0],a=n[2],o=n[3],i=n[4],s=n[5],u=n[7],l=n[8],d=n[9],f=n[10],p=n[11],g=n.slice(12),m=Object.fromEntries(g.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));return{tname:s,tstart:+u,tend:+l,qname:r,qstart:+a,qend:+o,strand:"-"===i?-1:1,extra:Object(c.a)({numMatches:+d,blockLen:+f,mappingQual:+p},m)}})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyNames",value:function(){var e=this.getConf("assemblyNames");0===e.length&&(e=[this.getConf("queryAssembly"),this.getConf("targetAssembly")]);return e}},{key:"getRefNames",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,r,a,o,i,c,s,u=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>0&&void 0!==u[0]?u[0]:{},r=null===(t=n.regions)||void 0===t?void 0:t[0].assemblyName,e.next=4,this.setup();case 4:if(a=e.sent,-1===(o=this.getAssemblyNames().indexOf(r))){e.next=10;break}for(i=new Set,c=0;c<a.length;c++)s=a[c],0===o?i.add(s.qname):i.add(s.tname);return e.abrupt("return",Array.from(i));case 10:return console.warn("Unable to do ref renaming on adapter"),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(na.ObservableCreate)(function(){var r=Object(i.a)(d.a.mark((function r(a){var o,i,s,u,l,f,p,g,m,h,b,v,y,O;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:if(o=r.sent,i=t.getAssemblyNames(),s=e.assemblyName,-1!==(u=i.indexOf(s)))for(l=0;l<o.length;l++)f=o[l],p=0,g=0,m="",h="",b=0,v=0,0===u?(p=f.qstart,g=f.qend,m=f.qname,h=f.tname,b=f.tstart,v=f.tend):(p=f.tstart,g=f.tend,m=f.tname,h=f.qname,b=f.qstart,v=f.qend),y=f.extra,O=f.strand,m===e.refName&&Object(Ct.a)(e.start,e.end,p,g)&&a.next(new q.a(Object(c.a)({uniqueId:"".concat(l),start:p,end:g,refName:m,strand:O,assemblyName:s,syntenyId:l,mate:{start:b,end:v,refName:h}},y)));a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(W.BaseFeatureDataAdapter);oa.capabilities=["getFeatures","getRefNames"];var ia=Object(E.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0});function ca(e){return 31===e[0]&&139===e[1]&&8===e[2]}function sa(e){return new Map(e.split("\n").filter((function(e){return!!e||e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=Object(u.a)(t,6),r=n[0],a=n[1],o=n[2],i=n[3];return[i,{refName:r,start:+a,end:+o,score:+n[4],name:i,strand:"-"===n[5]?-1:1}]})))}function ua(e,t){return la.apply(this,arguments)}function la(){return(la=Object(i.a)(d.a.mark((function e(t,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if(r=e.sent,e.t0=new TextDecoder("utf8",{fatal:!0}),!ca(r)){e.next=10;break}return e.next=7,Object(ra.unzip)(r);case 7:e.t1=e.sent,e.next=11;break;case 10:e.t1=r;case 11:return e.t2=e.t1,e.abrupt("return",e.t0.decode.call(e.t0,e.t2));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var da=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).setupP=void 0,e}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c,s,l,f,p,g,m,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConf("assemblyNames"),r=this.pluginManager,a=Object($.openLocation)(this.getConf("bed1Location"),r),o=Object($.openLocation)(this.getConf("bed2Location"),r),i=Object($.openLocation)(this.getConf("mcscanAnchorsLocation"),r),e.next=7,Promise.all([a,o,i].map((function(e){return ua(e,t)})));case 7:return c=e.sent,s=Object(u.a)(c,3),l=s[0],f=s[1],p=s[2],g=sa(l),m=sa(f),h=p.split("\n").filter((function(e){return!!e&&"###"!==e})).map((function(e,t){var n=e.split("\t"),r=Object(u.a)(n,3),a=r[0],o=r[1],i=r[2],c=g.get(a),s=m.get(o);if(!c||!s)throw new Error("feature not found, ".concat(a," ").concat(o," ").concat(c," ").concat(s));return[c,s,+i,t]})),e.abrupt("return",{assemblyNames:n,feats:h});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(na.ObservableCreate)(function(){var r=Object(i.a)(d.a.mark((function r(a){var o,i,s,l;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:o=r.sent,i=o.assemblyNames,s=o.feats,-1!==(l=i.indexOf(e.assemblyName))&&s.forEach((function(t){var n=Object(u.a)(t,4),r=n[0],o=n[1],i=n[2],s=n[3],d=1===l?[o,r]:[r,o],f=Object(u.a)(d,2),p=f[0],g=f[1];p.refName===e.refName&&Object(U.doesIntersect2)(e.start,e.end,p.start,p.end)&&a.next(new q.a(Object(c.a)(Object(c.a)({},p),{},{uniqueId:"".concat(l,"-").concat(s),syntenyId:s,score:i,mate:g})))})),a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(W.BaseFeatureDataAdapter);da.capabilities=["getFeatures","getRefNames"];var fa=Object(E.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),pa=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).setupP=void 0,e}return Object(h.a)(n,[{key:"setup",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c,s,l,f,p,g,m,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConf("assemblyNames"),r=this.pluginManager,a=Object($.openLocation)(this.getConf("bed1Location"),r),o=Object($.openLocation)(this.getConf("bed2Location"),r),i=Object($.openLocation)(this.getConf("mcscanSimpleAnchorsLocation"),r),e.next=7,Promise.all([a,o,i].map((function(e){return ua(e,t)})));case 7:return c=e.sent,s=Object(u.a)(c,3),l=s[0],f=s[1],p=s[2],g=sa(l),m=sa(f),h=p.split("\n").filter((function(e){return!!e&&"###"!==e})).map((function(e,t){var n=e.split("\t"),r=Object(u.a)(n,6),a=r[0],o=r[1],i=r[2],c=r[3],s=r[4],l=r[5],d=g.get(a),f=g.get(o),p=m.get(i),h=m.get(c);if(!d||!f||!p||!h)throw new Error("feature not found, ".concat(a," ").concat(o," ").concat(i," ").concat(c," ").concat(d," ").concat(f," ").concat(p," ").concat(h));return[d,f,p,h,+s,"-"===l?-1:1,t]})),e.abrupt("return",{assemblyNames:n,feats:h});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(na.ObservableCreate)(function(){var r=Object(i.a)(d.a.mark((function r(a){var o,i,s,l;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:o=r.sent,i=o.assemblyNames,s=o.feats,-1!==(l=i.indexOf(e.assemblyName))&&s.forEach((function(t){var n=Object(u.a)(t,7),r=n[0],o=n[1],i=n[2],s=n[3],d=n[4],f=n[5],p=n[6],g={refName:r.refName,start:Math.min(r.start,o.start),end:Math.max(r.end,o.end)},m={refName:i.refName,start:Math.min(i.start,s.start),end:Math.max(i.end,s.end)};if(1===l){var h=[g,m];m=h[0],g=h[1]}g.refName===e.refName&&Object(U.doesIntersect2)(g.start,g.end,e.start,e.end)&&a.next(new q.a(Object(c.a)(Object(c.a)({},g),{},{uniqueId:"".concat(p),syntenyId:p,score:d,strand:f,mate:m})))})),a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(W.BaseFeatureDataAdapter);pa.capabilities=["getFeatures","getRefNames"];var ga=Object(E.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});function ma(e){return 31===e[0]&&139===e[1]&&8===e[2]}var ha=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object($.openLocation)(this.getConf("outLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!ma(r=e.sent)){e.next=10;break}return e.next=7,Object(ra.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return o=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",o.split("\n").filter((function(e){return!!e})).map((function(e){var t=e.split(" ");if(t.length<9)throw new Error("improperly formatted line: "+e);var n=Object(u.a)(t,10),r=n[0],a=n[2],o=n[3],i=n[4];return{tname:n[5],tstart:+n[7],tend:+n[8],qname:r,qstart:+a,qend:+o,strand:"-"===i?-1:1,extra:{mappingQual:+n[9]}}})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(oa),ba=Object(E.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0});function va(e){return 31===e[0]&&139===e[1]&&8===e[2]}function ya(e){for(var t="",n="",r=0,a=0,o=0,i=0,c=0,s=0,u=[],l=0,d=0,f=!1,p=[],g=new RegExp(/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/),m=0;m<e.length;m++){var h=e[m],b=g.exec(h);if(null===b){if(f){var v=h.split(" ");if(7===v.length){var y=+v[0],O=+v[1],w=+v[2],j=+v[3];c=y<O&&w<j||y>O&&w>j?1:-1,o=+(y<O?y:O)-1,i=+(O>y?O:y),r=+(w<j?w:j)-1,a=+(j>w?j:w),l=d=0,s=+v[4],u=[]}else if(1===v.length){var k=+v[0];if(0===k){var x=0,C=[];if(i-o-l!==a-r-d)throw new Error("inconsistent alignment on line ".concat(m));u.push(i-o-l<<4);for(var S=0;S<u.length;++S){var T=u[S]>>4;x+=T,C.push(T+"MID".charAt(15&u[S]))}p.push({qname:n,qstart:r,qend:a,tname:t,tstart:o,tend:i,strand:c,extra:{numMatches:x-s,blockLen:x,mappingQual:0,NM:s,cg:C.join("")}})}else if(k>0){var E=k-1;l+=E+1,d+=E,E>0&&u.push(E<<4),u.length>0&&2===(15&u[u.length-1])?u[u.length-1]+=16:u.push(18)}else{var M=-k-1;l+=M,d+=M+1,M>0&&u.push(M<<4),u.length>0&&1===(15&u[u.length-1])?u[u.length-1]+=16:u.push(17)}}}}else t=b[1],n=b[2],f=!0}return p}var Oa=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object($.openLocation)(this.getConf("deltaLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!va(r=e.sent)){e.next=10;break}return e.next=7,Object(ra.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return o=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",ya(o.split("\n").filter((function(e){return!!e}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(oa),wa=Object(E.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0});function ja(e){return 31===e[0]&&139===e[1]&&8===e[2]}function ka(e,t,n,r,a,o,i,c,s){return{qname:e,qstart:t,qend:n,tname:a,tstart:o,tend:i,strand:"-"===r?-1:1,extra:{numMatches:s,blockLen:Math.max(n-t,i-o),mappingQual:0,cg:c}}}function xa(e){for(var t="",n=0,r=0,a="",o="",i="",c=0,s=0,u=0,l="",d=[],f=0;f<e.length;f++){var p=e[f].replace(/ /g,"\t").split("\t");if("chain"===p[0]){if(l&&d.push(ka(a,c,s,i,t,n,r,l,u)),t=p[2],n=+p[5],r=+p[6],a=p[7],o=p[8],i=p[9],c=+p[10],s=+p[11],"-"===i){var g=c;c=+o-s,s=+o-g}u=0,l=""}else{var m=+p[0]||0,h=p.length>1?+p[1]:0,b=p.length>2?+p[2]:0;0!==m&&(u+=+m,l+=m+"M"),0!==b&&(l+=b+"I"),0!==h&&(l+=h+"D")}}return l&&ka(a,c,s,i,t,n,r,l,u),d}var Ca=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"setupPre",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object($.openLocation)(this.getConf("chainLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!ja(r=e.sent)){e.next=10;break}return e.next=7,Object(ra.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return o=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",xa(o.split("\n").filter((function(e){return!!e}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(oa),Sa=Object(E.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Ta=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="ComparativeAdaptersPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new y.a({name:"PAFAdapter",configSchema:ia,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:oa})}))}(e),function(e){e.addAdapterType((function(){return new y.a({name:"DeltaAdapter",configSchema:wa,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:Oa})}))}(e),function(e){e.addAdapterType((function(){return new y.a({name:"ChainAdapter",configSchema:Sa,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:Ca})}))}(e),function(e){e.addAdapterType((function(){return new y.a({name:"MCScanAnchorsAdapter",configSchema:fa,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:da})}))}(e),function(e){e.addAdapterType((function(){return new y.a({name:"MCScanSimpleAnchorsAdapter",configSchema:ga,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:pa})}))}(e),function(e){e.addAdapterType((function(){return new y.a({name:"MashMapAdapter",configSchema:ba,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:ha})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="PAFAdapter",o=Object(_e.getFileName)(t);return/\.paf/i.test(o)||r===a?{type:a,pafLocation:t}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"PAFAdapter"===t?"SyntenyTrack":e(t)}}))}}]),n}(M.a),Ea=Object(E.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:Me.baseConnectionConfig});"ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9".split(/\r?\n/);function Ma(){return(Ma=Object(i.a)(d.a.mark((function e(t){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object($.openLocation)(t).readFile("utf8");case 3:return r=e.sent,e.next=6,n.e(1).then(n.t.bind(null,1575,7));case 6:return a=e.sent,o=a.HubFile,e.abrupt("return",new o(r));case 11:throw e.prev=11,e.t0=e.catch(0),new Error("Not a valid hub.txt file, got error: '".concat(e.t0,"'"));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function Ra(e){return Pa.apply(this,arguments)}function Pa(){return(Pa=Object(i.a)(d.a.mark((function e(t){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object($.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(1).then(n.t.bind(null,1575,7));case 5:return a=e.sent,o=a.GenomesFile,e.abrupt("return",new o(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Aa(e){return Na.apply(this,arguments)}function Na(){return(Na=Object(i.a)(d.a.mark((function e(t){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object($.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(1).then(n.t.bind(null,1575,7));case 5:return a=e.sent,o=a.TrackDbFile,e.abrupt("return",new o(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function La(e,t,n,r){var a=[];return e.forEach((function(o,i){var c=Array.from(o.keys()),s=["superTrack","compositeTrack","container","view"];if(!c.some((function(e){return s.includes(e)}))){var l=[],d=i;do{if(d=e.get(d).get("parent")){var f=d.split(" ");d=Object(u.a)(f,1)[0],l.push(e.get(d))}}while(d);l.reverse();var p=function(e,t,n,r,a){var o=e.get("type");o||(o=r.get(e.get("parent")).get("type"));var i,c,s=o.split(" ")[0];"bam"===s&&e.get("bigDataUrl").toLowerCase().endsWith("cram")&&(s="cram");i=n.uri?{uri:new URL(e.get("bigDataUrl"),n.uri).href,locationType:"UriLocation"}:{localPath:e.get("bigDataUrl"),locationType:"LocalPathLocation"};switch(s){case"bam":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".bai"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:i,index:{location:c}}};case"bed":case"bed5FloatScore":case"bedGraph":case"bedRnaElements":case"broadPeak":case"coloredExon":case"gvf":case"ld2":case"narrowPeak":case"peptideMapping":case"wig":case"wigMaf":case"halSnake":return Object(_e.generateUnsupportedTrackConf)(e.get("shortLabel"),s,t);case"bigBarChart":case"bigChain":case"bigInteract":case"bigMaf":case"bigPsl":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":case"bigGenePred":case"bigNarrowPeak":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:i}};case"bigWig":return{type:"QuantitativeTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:i}};case"cram":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".crai"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".crai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:i,craiLocation:c,sequenceAdapter:a}};case"vcfTabix":return c=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".tbi"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".tbi"),locationType:"LocalPathLocation"},{type:"VariantTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:i,index:{location:c}}};case"hic":return{type:"HicTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:i}};default:return Object(_e.generateUnknownTrackConf)(e.get("shortLabel"),s,t)}}(o,l.map((function(e){return e.get("shortLabel")})),t,e,r);p.trackId="ucsc-trackhub-".concat(Object(U.objectHash)(p)),p.assemblyNames=[n],a.push(p)}})),a}function Ia(e){return b.types.compose("UCSCTrackHubConnection",Object(Me.BaseConnectionModelFactory)(e),b.types.model({configuration:Object(E.ConfigurationReference)(Ea),type:b.types.literal("UCSCTrackHubConnection")}).actions((function(e){return{connect:function(){var t=Object(E.getConf)(e,"name"),n=Object(E.getConf)(e,"hubTxtLocation"),r=Object(U.getSession)(e);(function(e){return Ma.apply(this,arguments)})(n).then((function(e){var t=n.uri?{uri:new URL(e.get("genomesFile"),n.uri).href,locationType:"UriLocation"}:{localPath:e.get("genomesFile"),locationType:"LocalPathLocation"};return Promise.all([e,Ra(t)])})).then((function(a){var o,i=Object(u.a)(a,2),c=i[0],s=i[1],l=[],d=Object(g.a)(s);try{var f=function(){var a=Object(u.a)(o.value,2),i=a[0],s=a[1],d=Object(E.getConf)(e,"assemblyNames");if(d.length>0&&!d.includes(i))return"break";var f=r.assemblies.find((function(e){return Object(E.readConfObject)(e,"name")===i}));if(!f)throw new Error('Cannot find assembly for "'.concat(i,'" from the genomes file for connection "').concat(t,'"'));var p=n.uri?{uri:new URL(s.get("trackDb"),new URL(c.get("genomesFile"),n.uri)).href,locationType:"UriLocation"}:{localPath:s.get("trackDb"),locationType:"LocalPathLocation"};l.push(Promise.all([p,Aa(p),i,f]))};for(d.s();!(o=d.n()).done;){if("break"===f())break}}catch(p){d.e(p)}finally{d.f()}return Promise.all([].concat(l))})).then((function(t){var n,r=Object(g.a)(t);try{for(r.s();!(n=r.n()).done;){var a=Object(u.a)(n.value,4),o=a[0],i=a[1],c=a[2],s=a[3],l=La(i,o,c,Object(E.readConfObject)(s,["sequence","adapter"]));e.addTrackConfs(l)}}catch(d){r.e(d)}finally{r.f()}})).catch((function(t){console.error(t),r.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(t,'"'),"error"),r.breakConnection(e.configuration)}))}}})))}function Fa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function Da(e){return b.types.model("AddTrackModel",{id:N.ElementId,type:b.types.literal("AddTrackWidget"),view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:""}})).actions((function(e){return{setAdapterHint:function(t){e.adapterHint=t},setTrackSource:function(t){e.trackSource=t},setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},setAssembly:function(t){e.altAssemblyName=t},setTrackName:function(t){e.altTrackName=t},setTrackType:function(t){e.altTrackType=t},clearData:function(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0}}})).views((function(e){return{get trackAdapter(){var t=e.trackData,n=e.indexTrackData,r=e.adapterHint;return t?Object(_e.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?Object(_e.getFileName)(e.trackData):"")},get isFtp(){var t,n,r=e.trackData,a=e.indexTrackData;return!!(null!==a&&void 0!==a&&null!==(t=a.uri)&&void 0!==t&&t.startsWith("ftp://")||null!==r&&void 0!==r&&null!==(n=r.uri)&&void 0!==n&&n.startsWith("ftp://"))},get isRelativeTrackUrl(){var t,n=null===(t=e.trackData)||void 0===t?void 0:t.uri;return!!n&&!Fa(n)},get isRelativeIndexUrl(){var t,n=null===(t=e.indexTrackData)||void 0===t?void 0:t.uri;return!!n&&!Fa(n)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var t,n;return null===(t=e.trackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get indexHttp(){var t,n;return null===(t=e.indexTrackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){var e;return(null===(e=this.trackAdapter)||void 0===e?void 0:e.type)===_e.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||(this.trackAdapter?Object(_e.guessTrackType)(this.trackAdapter.type,e):"")}}})).views((function(e){return{get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}}))}var Ba=Object(E.ConfigurationSchema)("AddTrackWidget",{}),Va=b.types.model("AddConnectionModel",{id:N.ElementId,type:b.types.literal("AddConnectionWidget")}),za=Object(E.ConfigurationSchema)("AddConnectionWidget",{}),Wa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return!!e.find((function(e){return t.includes(e)}))};function Ua(e){if(!e.trackId)throw new Error("not a track");return Object(E.readConfObject)(e,"name")||"Reference sequence (".concat(Object(E.readConfObject)(Object(b.getParent)(e),"name"),")")}function qa(e,t,n){var r={children:[]},a=e.filterText,i=e.view;return t.filter((function(e){return function(e,t){var n=Ua(t),r=Object(E.readConfObject)(t,"category")||[],a=e.toLowerCase();return!!n.toLowerCase().includes(a)||r.filter((function(e){return!!e.toLowerCase().includes(a)})).length}(a,e)})).forEach((function(e){var t=Object(o.a)(Object(E.readConfObject)(e,"category")||[]);e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");for(var a=r,c=function(e){var r=t[e],o=a.children.find((function(e){return e.name===r})),i=t.slice(0,e+1).join(",");if(o)a=o;else{var c={children:[],name:r,id:i,isOpenByDefault:!n.get(i)};a.children.push(c),a=c}},s=0;s<t.length;s++)c(s);a.children.splice(a.children.findIndex((function(e){return e.children.length})),0,{id:e.trackId,name:Ua(e),conf:e,checked:!!i.tracks.find((function(t){return t.configuration===e})),children:[]})})),r.children}var Ha=function(e){return b.types.model("HierarchicalTrackSelectorWidget",{id:N.ElementId,type:b.types.literal("HierarchicalTrackSelectorWidget"),collapsed:b.types.map(b.types.boolean),filterText:"",view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setView:function(t){e.view=t},toggleCategory:function(t){e.collapsed.set(t,!e.collapsed.get(t))},clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}})).views((function(t){return{getRefSeqTrackConf:function(n){var r=Object(U.getSession)(t).assemblyManager.get(n),a=null===r||void 0===r?void 0:r.configuration.sequence,o=e.getViewType(t.view.type);if(a){var i,c=Object(g.a)(a.displays);try{var s=function(){var e=i.value;if(o.displayTypes.find((function(t){return t.name===e.type})))return{v:a}};for(c.s();!(i=c.n()).done;){var u=s();if("object"===typeof u)return u.v}}catch(l){c.e(l)}finally{c.f()}}},trackConfigurations:function(n){if(!t.view)return[];var r=Object(U.getSession)(t),a=r.tracks,i=r.assemblyManager.get(n);if(!i)return[];var c=t.getRefSeqTrackConf(n);return(c?[c]:[]).concat(Object(o.a)(a.filter((function(e){var t=Object(E.readConfObject)(e,"assemblyNames"),n=i.allAliases;return Wa(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return Wa(r,a)}))))},get assemblyNames(){return t.view?t.view.assemblyNames:[]},connectionTrackConfigurations:function(n,r){if(!t.view)return[];var a=r.tracks,o=Object(U.getSession)(t).assemblyManager.get(n);return o&&o.initialized?a.filter((function(e){var t=Object(E.readConfObject)(e,"assemblyNames"),n=o.allAliases;return Wa(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return Wa(r,a)})):[]},hierarchy:function(e){var n=this,r=qa(t,t.trackConfigurations(e),t.collapsed),a=Object(U.getSession)(t),i=a.connectionInstances.filter((function(t){var n=Object(E.readConfObject)(t.configuration,"assemblyNames");return 0===n.length||n.includes(e)})).map((function(t,r){var o=a.connections[r];return{id:o.connectionId,name:Object(E.readConfObject)(o,"name"),children:n.connectionHierarchy(e,t),state:{expanded:!0}}}));return{name:"Root",id:"Root",children:[{name:"Tracks",id:"Tracks",children:r}].concat(Object(o.a)(i))}},connectionHierarchy:function(e,n){return qa(t,t.connectionTrackConfigurations(e,n),t.collapsed)},allTracksInCategoryPath:function(e,n,r){var a=n?t.connectionHierarchy(n):t.hierarchy(r);e.forEach((function(e){a=a.get(e)||new Map}));var o={};return a.forEach((function(n,r){n.trackId?o[n.trackId]=n:o=Object.assign(o,t.allTracksInCategoryPath(e.concat([r])))})),o}}}))},_a=Object(E.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});n(955);function Ga(e){return b.types.model("PluginStoreModel",{id:N.ElementId,type:b.types.literal("PluginStoreWidget"),filterText:"",view:b.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}}))}var Ja=Object(E.ConfigurationSchema)("PluginStoreWidget",{}),Xa=Object(f.lazy)((function(){return n.e(65).then(n.bind(null,1763))})),Ya=Object(f.lazy)((function(){return n.e(29).then(n.bind(null,1745))})),Qa=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="DataManagementPlugin",e.exports={AssemblyManager:Ya,SetDefaultSession:Xa},e}return Object(h.a)(r,[{key:"install",value:function(e){e.addConnectionType((function(){return new x.a({name:"UCSCTrackHubConnection",configSchema:Ea,stateModel:Ia(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})})),e.addWidgetType((function(){return new k.a({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:_a,stateModel:Ha(e),ReactComponent:Object(f.lazy)((function(){return Promise.all([n.e(20),n.e(46)]).then(n.bind(null,1719))}))})})),e.addWidgetType((function(){return new k.a({name:"AddTrackWidget",heading:"Add a track",configSchema:Ba,stateModel:Da(e),ReactComponent:Object(f.lazy)((function(){return n.e(60).then(n.bind(null,1754))}))})})),e.addWidgetType((function(){return new k.a({name:"AddConnectionWidget",heading:"Add a connection",configSchema:za,stateModel:Va,ReactComponent:Object(f.lazy)((function(){return n.e(45).then(n.bind(null,1755))}))})})),e.addWidgetType((function(){return new k.a({name:"PluginStoreWidget",heading:"Plugin store",configSchema:Ja,stateModel:Ga(e),ReactComponent:Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,955))}))})}))}},{key:"configure",value:function(e){}}]),r}(M.a),Ka=n(598),$a=n(445),Za=n(289),eo=n.n(Za),to=n(285),no=n(577),ro=to.a.extend((function(e){var t=Ge.observable.box(1);return{views:{get dynamicBlocks(){return Object(no.a)(e,!1,!1)},get scaleFactor(){return t.get()}},actions:{setScaleFactor:function(e){t.set(e)}}}})),ao=ro.extend((function(e){return{views:{get width(){return Object(b.getParent)(e).viewWidth}}}})),oo=ro.extend((function(e){return{views:{get width(){return Object(b.getParent)(e).viewHeight}}}}));function io(e){return b.types.compose($a.a,b.types.model("DotplotView",{id:N.ElementId,type:b.types.literal("DotplotView"),headerHeight:0,height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:b.types.array(b.types.string),hview:b.types.optional(ao,{}),vview:b.types.optional(oo,{}),tracks:b.types.array(e.pluggableMstType("track","stateModel")),viewTrackConfigs:b.types.array(e.pluggableConfigSchemaType("track")),viewAssemblyConfigs:b.types.array(b.types.frozen())})).volatile((function(){return{volatileWidth:void 0,volatileError:void 0,borderX:100,borderY:100}})).views((function(e){return{get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}})).views((function(e){return{get assemblyErrors(){var t=Object(U.getSession)(e).assemblyManager;return e.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=e.assemblyNames,n=Object(U.getSession)(e).assemblyManager;return t.every((function(e){var t,r;return null===(t=null===(r=n.get(e))||void 0===r?void 0:r.initialized)||void 0===t||t}))}}})).views((function(e){return{get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){var t=e.hview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:Object(Ka.c)(r.contentBlocks,a)},get vticks(){var t=e.vview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:Object(Ka.c)(r.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps:function(){return Object(c.a)(Object(c.a)({},Object(_e.getParentRenderProps)(e)),{},{highResolutionScaling:Object(E.getConf)(Object(U.getSession)(e),"highResolutionScaling")})}}})).actions((function(t){return{clearView:function(){t.hview.setDisplayedRegions([]),t.vview.setDisplayedRegions([]),t.assemblyNames=Object(b.cast)([])},setBorderX:function(e){t.borderX=e},setBorderY:function(e){t.borderY=e},setWidth:function(e){return t.volatileWidth=e,t.volatileWidth},setHeight:function(e){return t.height=e,t.height},setError:function(e){t.volatileError=e},closeView:function(){Object(b.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},zoomOutButton:function(){t.hview.zoomOut(),t.vview.zoomOut()},zoomInButton:function(){t.hview.zoomIn(),t.vview.zoomIn()},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=Object(U.getSession)(t),n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),o=Object(b.resolveIdentifier)(a,Object(b.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var s=e.getViewType(t.type),u=o.displays.find((function(e){return!!s.displayTypes.find((function(t){return t.name===e.type}))}));if(!u)throw new Error("could not find a compatible display for view type ".concat(t.type));var l=i.stateModel.create(Object(c.a)(Object(c.a)({},r),{},{type:o.type,configuration:o,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(b.resolveIdentifier)(r,Object(b.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===a}));return Object(Ge.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames:function(e,n){t.assemblyNames=Object(b.cast)([e,n])},setViews:function(e){t.hview=Object(b.cast)(e[0]),t.vview=Object(b.cast)(e[1])},getCoords:function(e,n){var r=Object(U.minmax)(n[0],e[0]),a=Object(u.a)(r,2),o=a[0],i=a[1],c=Object(U.minmax)(n[1],e[1]),s=Object(u.a)(c,2),l=s[0],d=s[1];return Math.abs(i-o)>3&&Math.abs(d-l)>3?[t.hview.pxToBp(o),t.hview.pxToBp(i),t.vview.pxToBp(t.viewHeight-l),t.vview.pxToBp(t.viewHeight-d)]:void 0},zoomIn:function(e,n){var r=this.getCoords(e,n);if(r){var a=Object(u.a)(r,4),o=a[0],i=a[1],c=a[2],s=a[3];t.hview.moveTo(o,i),t.vview.moveTo(s,c)}},onDotplotView:function(e,n){var r=this.getCoords(e,n);if(r){var a=Object(u.a)(r,4),o=a[0],i=a[1],s=a[2],l=a[3],d=Object(U.getSession)(t),f=ro.create(Object(c.a)(Object(c.a)({},Object(b.getSnapshot)(t.hview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0})),p=ro.create(Object(c.a)(Object(c.a)({},Object(b.getSnapshot)(t.vview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0}));f.setVolatileWidth(t.hview.width),p.setVolatileWidth(t.vview.width),f.moveTo(o,i),p.moveTo(l,s),f.zoomTo(f.bpPerPx/(t.width/t.hview.width),0),p.zoomTo(p.bpPerPx/(t.width/t.vview.width),0);var g=t.tracks.map((function(e){return e.configuration.displays.find((function(e){return"LinearSyntenyDisplay"===e.type}))})).filter((function(e){return!!e})).map((function(e){var t=Object(b.getParent)(e,2);return{type:Object(b.getParent)(e,2).type,configuration:t,displays:[{type:e.type,configuration:e}]}})),m={type:"LinearSyntenyView",views:[Object(c.a)(Object(c.a)({type:"LinearGenomeView"},Object(b.getSnapshot)(f)),{},{tracks:[],hideHeader:!0}),Object(c.a)(Object(c.a)({type:"LinearGenomeView"},Object(b.getSnapshot)(p)),{},{tracks:[],hideHeader:!0})],tracks:g};d.addView("LinearSyntenyView",m)}}}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)((function(){var t=Object(U.getSession)(e);if(void 0!==e.volatileWidth&&!e.initialized){var n=[e.viewWidth,e.viewHeight],r=[e.hview,e.vview];e.assemblyNames.forEach((function(a,o){var i=t.assemblyManager.get(a);if(i){i.error&&e.setError(i.error);var c=i.regions;if(c&&c.length){var s=c;s&&Object(Ge.transaction)((function(){var e=r[o];e.setDisplayedRegions(s),e.setBpPerPx(e.totalBp/n[o])}))}}}))}}),{delay:1e3})),Object(b.addDisposer)(e,Object(Ge.autorun)((function(){var t=e.vview,n=e.hview;if(void 0!==e.volatileWidth){var r=t.dynamicBlocks.contentBlocks,a=n.dynamicBlocks.contentBlocks,o=function(e){return Object(U.measureText)(e.slice(0,30))},i=a.reduce((function(e,t){return Math.max(e,o(t.refName))}),0),c=r.reduce((function(e,t){return Math.max(e,o(t.refName))}),0);e.setBorderY(Math.max(i+10,100)),e.setBorderX(Math.max(c+10,100))}})))},squareView:function(){var t=e.hview,n=e.vview,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(o.coord,o.refName,o.index)},squareViewProportional:function(){var t=e.hview,n=e.vview,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,o=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(o.coord,o.refName,o.index),n.setBpPerPx(a),n.centerAt(i.coord,i.refName,i.index)}}})).views((function(e){return{menuItems:function(){var t=Object(U.getSession)(e);return[{label:"Return to import form",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[ue.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:eo.a},{label:"Square view - same bp per pixel",onClick:function(){return e.squareView()}},{label:"Rectangular view - same total bp",onClick:function(){return e.squareView()}}].concat(Object(o.a)(Object(U.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:tn.c}]:[]))},get error(){return e.volatileError||e.assemblyErrors}}}))}var co=n(452),so=n.n(co),uo=n(1686),lo=Object(Xe.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function fo(){var e=Object(f.useState)(!1),t=Object(u.a)(e,2),n=t[0],r=t[1],a=lo();return Object(f.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}}),[]),n?p.a.createElement("div",{"data-testid":"loading-synteny",className:a.loading},p.a.createElement(pn.a,null,"Loading \u2026"),p.a.createElement(uo.a,null)):null}function po(e){var t=e.messageText,n=lo();return p.a.createElement("div",{className:n.blockMessage},p.a.createElement(pn.a,null,t))}function go(e){var t=e.error,n=lo();return p.a.createElement("div",{className:n.blockError},p.a.createElement(pn.a,null,t.message))}var mo=Object(ie.observer)((function(e){var t=e.model,n=e.style;return t.error?p.a.createElement(go,{error:t.error,"data-testid":"reload_button"}):t.message?p.a.createElement(po,{messageText:t.message}):t.filled?p.a.createElement("div",{style:n},t.reactElement):p.a.createElement(fo,null)})),ho=Object(ie.observer)((function(e){var t=e.model,n=e.children,r=t.data||{},a=r.offsetX,o=void 0===a?0:a,i=r.offsetY,c=void 0===i?0:i,s=Object(U.getContainingView)(t),u=s.vview.offsetPx-c,l=-(s.hview.offsetPx-o);return p.a.createElement("div",{style:{position:"relative"}},p.a.createElement(t.ReactComponent2,Object.assign({},e,{style:{position:"absolute",top:u,left:l}})),n)})),bo=["reactElement"],vo=function(e){e.addDisplayType((function(){var t=function(e){return Object(E.ConfigurationSchema)("DotplotDisplay",{renderer:b.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new w.a({name:"DotplotDisplay",configSchema:t,stateModel:yo(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:ho})}))};function yo(e){return b.types.compose("DotplotDisplay",Me.BaseDisplay,b.types.model({type:b.types.literal("DotplotDisplay"),configuration:Object(E.ConfigurationReference)(e)}).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:mo}}))).views((function(e){return{get rendererTypeName(){return Object(E.getConf)(e,["renderer","type"])},renderProps:function(){return Object(c.a)(Object(c.a)({},Object(_e.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}}})).actions((function(e){var t;return{afterAttach:function(){Object(U.makeAbortableReaction)(e,(function(){return function(e){var t=Object(U.getSession)(e).rpcManager,n=e.rendererType,r=e.adapterConfig,a=Object(U.getContainingView)(e);if(Object(E.readConfObject)(e.configuration),Object(b.getSnapshot)(a),a.initialized){var o=a.viewWidth,i=a.viewHeight,s=a.borderSize,u=a.borderX,l=a.borderY;return{rendererType:n,rpcManager:t,renderProps:Object(c.a)(Object(c.a)({},e.renderProps()),{},{view:so()(Object(b.getSnapshot)(a)),width:o,height:i,borderSize:s,borderX:u,borderY:l,adapterConfig:r,rendererType:n.name,sessionId:Object(_e.getRpcSessionId)(e),timeout:1e6})}}return}(e)}),(function(e){return e?function(e){return Oo.apply(this,arguments)}(e):void 0}),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){if(void 0!==n){var r=n.data,a=n.reactElement,o=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=o,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function Oo(){return(Oo=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,e.next=5,n.renderInClient(r,a);case 5:return o=e.sent,i=o.reactElement,c=Object(s.a)(o,bo),e.abrupt("return",{reactElement:i,data:c,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wo=Object(ie.observer)((function(e){return p.a.createElement(ue.PrerenderedCanvas,e)})),jo=Object(E.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default or colorBy:callback",defaultValue:"black",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"black"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:b.types.enumeration("colorBy",["identity","mappingQuality","strand","default","callback"]),description:'Color by. Setting "identity" (similar to D-GENIES, use thresholds and thresholds palette to define colors for this setting), setting "mappingQuality" (uses mapping quality from PAF, some adapters don\'t have this setting), setting "strand" colors negative alignments with negColor and positive alignments with posColor, default uses the \'color\' field, callback uses the \'color\' field as a callback',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0}),ko=n(328),xo=n(444),Co=ve.parseCigar;function So(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.arc(t,n,a/2,0,2*Math.PI),r?e.fill():e.stroke()}var To=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager){e.next=3;break}throw new Error("No assembly manager provided");case 3:return e.next=5,Object(U.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:t.view.hview.displayedRegions,adapterConfig:t.adapterConfig});case 5:return t.view.hview.displayedRegions=e.sent.regions,e.next=8,Object(U.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:t.view.vview.displayedRegions,adapterConfig:t.adapterConfig});case 8:return t.view.vview.displayedRegions=e.sent.regions,e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"makeImageData",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,s,l,f,p,g,m,h,v,y,O,w,j,k,x,C,S,T,M,R;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.highResolutionScaling,a=void 0===r?1:r,o=t.width,i=t.height,s=t.config,l=t.views,f=Object(ko.d)(Math.ceil(o*a),i*a),p=f.getContext("2d"),g=Object(E.readConfObject)(s,"color"),m=Object(E.readConfObject)(s,"posColor"),h=Object(E.readConfObject)(s,"negColor"),v=Object(E.readConfObject)(s,"colorBy"),y=Object(E.readConfObject)(s,"lineWidth"),p.lineWidth=y,p.scale(a,a),O=Object(u.a)(l,2),w=O[0],j=O[1],k=w.dynamicBlocks.contentBlocks[0].offsetPx,x=j.dynamicBlocks.contentBlocks[0].offsetPx,C=[],S=w.bpPerPx,T=j.bpPerPx,M=Object(c.a)(Object(c.a)({},Object(b.getSnapshot)(w)),{},{width:w.width}),R=Object(c.a)(Object(c.a)({},Object(b.getSnapshot)(j)),{},{width:j.width}),null===(n=w.features)||void 0===n||n.forEach((function(e){var t,n,r,a,o,c=e.get("start"),u=e.get("end"),l=e.get("strand")||1,d=e.get("refName"),f=e.get("mate"),b=f.refName;if(-1===l){var O=[c,u];u=O[0],c=O[1]}if("identity"===v){for(var w=e.get("numMatches")/e.get("blockLen"),j=Object(E.readConfObject)(s,"thresholds"),P=Object(E.readConfObject)(s,"thresholdsPalette"),A=0;A<j.length;A++)if(w>+j[A]){o=P[A];break}}else if("mappingQuality"===v){var N=e.get("mappingQual");o="hsl(".concat(N,",50%,50%)")}else"strand"===v?o=-1===l?h:m:"default"===v?o=g:"callback"===v&&(o=Object(E.readConfObject)(s,"color",{feature:e}));p.fillStyle=o,p.strokeStyle=o;var L=null===(t=Object(U.viewBpToPx)({self:M,refName:d,coord:c}))||void 0===t?void 0:t.offsetPx,I=null===(n=Object(U.viewBpToPx)({self:M,refName:d,coord:u}))||void 0===n?void 0:n.offsetPx,F=null===(r=Object(U.viewBpToPx)({self:R,refName:b,coord:f.start}))||void 0===r?void 0:r.offsetPx,D=null===(a=Object(U.viewBpToPx)({self:R,refName:b,coord:f.end}))||void 0===a?void 0:a.offsetPx;if(void 0!==L&&void 0!==I&&void 0!==F&&void 0!==D){var B=L-k,V=I-k,z=F-x,W=D-x;if(Math.abs(B-V)<=4&&Math.abs(z-W)<=4)So(p,B,i-z,!0,y);else{var q=B,H=z,_=e.get("cg")||e.get("CIGAR");if(_){var G=Co(_);p.beginPath(),p.moveTo(q,i-H);for(var J=0;J<G.length;J+=2){var X=+G[J],Y=G[J+1];"M"===Y||"="===Y||"X"===Y?(q+=X/S*l,H+=X/T):"D"===Y||"N"===Y?q+=X/S*l:"I"===Y&&(H+=X/T)}p.lineTo(q,i-H),p.stroke()}else p.beginPath(),p.moveTo(B,i-z),p.lineTo(V,i-W),p.stroke()}}else C.length<=5&&C.push("feature at ".concat(d,":").concat(c,"-").concat(u," ").concat(b,":").concat(f.start,"-").concat(f.end," not plotted, fell outside of range ").concat(L," ").concat(I," ").concat(F," ").concat(D))})),C.length&&console.warn(C.length>5?"Many features fell outside the boundaries of the contigs...sample":C,C.join("\n")),e.abrupt("return",Object(ko.e)(f));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,s,u,l,f,p,g,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,a=t.height,o=t.view,i=o.hview,s=o.vview,u=[r,a],l=[i,s].map((function(e,t){var n=ro.create(e);return n.setVolatileWidth(u[t]),n})),f=l[0],e.next=6,this.getFeatures(Object(c.a)(Object(c.a)({},t),{},{regions:f.dynamicBlocks.contentBlocks}));case 6:return p=e.sent,f.setFeatures(p),e.next=10,this.makeImageData(Object(c.a)(Object(c.a)({},t),{},{views:l}));case 10:return g=e.sent,e.next=13,Object(F.a)(Object(D.a)(n.prototype),"render",this).call(this,Object(c.a)(Object(c.a)({},t),{},{height:a,width:r,imageData:g}));case 13:return m=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)({},m),{},{imageData:g,height:a,width:r,offsetX:l[0].dynamicBlocks.blocks[0].offsetPx,offsetY:l[1].dynamicBlocks.blocks[0].offsetPx}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(xo.a),Eo=n(237),Mo=n.n(Eo),Ro=n(1351),Po=n.n(Ro),Ao=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="ComparativeRender",e}return Object(h.a)(n,[{key:"renameRegionsIfNeeeded",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.renameRegionsIfNeeded(t));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r){var a,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rendererType,o=this.pluginManager.getRendererType(a),e.t0=this,e.next=5,Object(F.a)(Object(D.a)(n.prototype),"serializeArguments",this).call(this,t,r);case 5:return e.t1=e.sent,e.t2=o,e.next=9,e.t0.renameRegionsIfNeeeded.call(e.t0,e.t1,e.t2);case 9:return i=e.sent,e.abrupt("return","MainThreadRpcDriver"===r?i:o.serializeArgsInClient(i));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(o=(a=r).sessionId,i=a.rendererType,c=a.signal,o){e.next=8;break}throw new Error("must pass a unique session id");case 8:if(Object(U.checkAbortSignal)(c),s=this.pluginManager.getRendererType(i)){e.next=12;break}throw new Error('renderer "'.concat(i,'" not found'));case 12:if(s.ReactComponent){e.next=14;break}throw new Error("renderer ".concat(i," has no ReactComponent, it may not be completely implemented yet"));case 14:if("MainThreadRpcDriver"!==n){e.next=20;break}return e.next=17,s.render(r);case 17:e.t0=e.sent,e.next=23;break;case 20:return e.next=22,s.renderInWorker(r);case 22:e.t0=e.sent;case 23:return u=e.t0,Object(U.checkAbortSignal)(c),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r,a){var o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(F.a)(Object(D.a)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(o=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",o);case 5:if(i=r.rendererType,c=this.pluginManager.getRendererType(i)){e.next=9;break}throw new Error('renderer "'.concat(i,'" not found'));case 9:if(c.ReactComponent){e.next=11;break}throw new Error("renderer ".concat(i," has no ReactComponent, it may not be completely implemented yet"));case 11:return e.abrupt("return",c.deserializeResultsInClient(o,r));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(C.a),No=ve.parseCigar;function Lo(e){for(var t=No(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"D"!==o&&"N"!==o&&(n+=a)}return n}function Io(e){for(var t=No(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"H"!==o&&"S"!==o&&"D"!==o&&"N"!==o&&(n+=a)}return n}function Fo(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}function Do(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}function Bo(e,t){var n=Object(U.getSession)(t);try{var r=e.get("CIGAR"),a=Fo(r,1),i=e.get("flags"),c=e.get("strand"),s=e.get("name"),l="".concat(s,"_assembly_").concat(Date.now()),d=t.parentTrack,f=Object(E.getConf)(d,"assemblyNames"),p=Object(u.a)(f,1)[0],g=[p,l],m="track-".concat(Date.now()),h="".concat(s,"_vs_").concat(p),b=(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}(e,"SA")||"").split(";").filter((function(e){return!!e})).map((function(t,n){var r=t.split(","),a=Object(u.a)(r,4),o=a[0],i=a[1],l=a[2],d=a[3],f=function(e){for(var t=No(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"H"!==o&&"S"!==o&&"I"!==o&&(n+=a)}return n}(d),g=Lo(d),m=Io(d),h="-"===l?-1:1,b=Fo(d,h*c),v=+i-1;return{refName:o,start:v,end:v+f,seqLength:g,clipPos:b,CIGAR:d,assemblyName:p,strand:c*h,uniqueId:"".concat(e.id(),"_SA").concat(n),mate:{start:b,end:b+m,refName:s}}})),v=e.toJSON();v.strand=1,v.mate={refName:s,start:a,end:a+Io(r)};var y=Lo(2048&i?b[0].CIGAR:r),O=[v].concat(Object(o.a)(b));O.sort((function(e,t){return e.clipPos-t.clipPos}));var w=O.reduce((function(e,t){return e+t.end-t.start}),0);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:w/800,displayedRegions:Do(O.map((function(e,t){return{start:e.start,end:e.end,refName:e.refName,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:y/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:l,start:0,end:y,refName:s}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:g,adapter:{type:"FromConfigAdapter",features:O},trackId:m,name:h}],viewAssemblyConfigs:[{name:l,sequence:{type:"ReferenceSequenceTrack",trackId:"".concat(s,"_").concat(Date.now()),adapter:{type:"FromConfigSequenceAdapter",features:[e.toJSON()]}}}],assemblyNames:g,tracks:[{configuration:m,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(m,"-DotplotDisplay")}]}],displayName:"".concat(s," vs ").concat(p)})}catch(j){console.error(j),n.notify("".concat(j),"error")}}var Vo=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="DotplotPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new j.a({name:"DotplotView",stateModel:io(e),ReactComponent:Object(f.lazy)((function(){return n.e(28).then(n.bind(null,1749))}))})}))}(e),vo(e),function(e){e.addRendererType((function(){return new To({name:"DotplotRenderer",configSchema:jo,ReactComponent:wo,pluginManager:e})}))}(e),e.addRpcMethod((function(){return new Ao(e)})),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearPileupDisplay"===e.name){var t=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature;return n?[].concat(Object(o.a)(t()),[{label:"Dotplot of read vs ref",icon:Mo.a,onClick:function(){return Bo(n,e)}}]):t()}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){Object(U.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:Po.a,onClick:function(e){e.addView("DotplotView",{})}})}}]),r}(M.a),zo=Object(E.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Wo=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="GTFPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"GtfAdapter",configSchema:zo,getAdapterClass:function(){return Promise.all([n.e(3),n.e(18),n.e(68)]).then(n.bind(null,1764)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="GtfAdapter",o=Object(_e.getFileName)(t),i={type:a,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(o)&&!r||r===a?i:e(t,n,r)}}))}}]),r}(M.a),Uo=Object(E.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:Object(E.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:b.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),qo=Object(E.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Ho=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="GFF3Plugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"Gff3TabixAdapter",configSchema:Uo,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(7),n.e(67)]).then(n.bind(null,1720)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3TabixAdapter",o=Object(_e.getFileName)(t),i=n&&Object(_e.getFileName)(n);return/\.gff3?\.b?gz$/i.test(o)||r===a?{type:a,bamLocation:t,gffGzLocation:t,index:{location:n||Object(_e.makeIndex)(t,".tbi"),indexType:Object(_e.makeIndexType)(i,"CSI","TBI")}}:e(t,n,r)}})),e.addAdapterType((function(){return new y.a({name:"Gff3Adapter",configSchema:qo,getAdapterClass:function(){return Promise.all([n.e(3),n.e(7),n.e(66)]).then(n.bind(null,1721)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3Adapter",o=Object(_e.getFileName)(t),i={type:a,gffLocation:t};return/\.gff3?$/i.test(o)&&!r||r===a?i:e(t,n,r)}}))}}]),r}(M.a),_o=Object(E.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0}),Go=n(345),Jo=n(1352),Xo=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e,r,a){var o;Object(m.a)(this,n),(o=t.call(this,e,r,a)).httpMap=void 0,o.tracksNames=void 0;var i=Object(E.readConfObject)(e,"namesIndexLocation");if(!i)throw new Error("must provide namesIndexLocation");return o.httpMap=new Jo.a({url:i.baseUri?new URL(i.uri,i.baseUri).href:i.uri}),o}return Object(h.a)(n,[{key:"loadIndexFile",value:function(){var e=Object(i.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpMap.getBucket(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchIndex",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.searchType,r=t.queryString,e.t0=this.tracksNames,e.t0){e.next=6;break}return e.next=5,this.httpMap.getTrackNames();case 5:e.t0=e.sent;case 6:return a=e.t0,e.next=9,this.loadIndexFile(r.toLowerCase());case 9:if(!(o=e.sent)[r]){e.next=12;break}return e.abrupt("return",this.formatResults(o[r],a,n));case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"formatResults",value:function(e,t,n){return[].concat(Object(o.a)("exact"===n?[]:e.prefix.map((function(e){return new Go.b({label:"object"===typeof e?e.name:e,matchedAttribute:"name",matchedObject:{result:e}})}))),Object(o.a)(e.exact.map((function(e){var n=e[0],r=e[1],a=e[3],o=e[4],i=e[5],c="".concat(a||n,":").concat(o,"-").concat(i);return new Go.b({locString:c,label:n,matchedAttribute:"name",matchedObject:e,trackId:t[r]})})))).filter((function(e){return"too many matches"!==e.getLabel()}))}},{key:"freeResources",value:function(){}}]),n}(W.BaseAdapter),Yo=Object(E.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Qo=Object(E.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:Me.baseConnectionConfig}),Ko=n(6),$o=n(875),Zo=n.n($o),ei=n(1353),ti=n.n(ei);function ni(e){return e&&e.label&&"string"===typeof e.label}function ri(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?ri(e[a],t[a]):"undefined"!==typeof e[a]&&"undefined"===typeof t[a]||(e[a]=t[a])}return e}function ai(e){if(!e||"object"!==typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(Array.isArray(e))for(t=[],n=0,r=e.length;n<r;++n)n in e&&(t[n]=ai(e[n]));else t=e.constructor?new e.constructor:{};return function(e,t,n){var r,a,o={};for(r in t)a=t[r],r in e&&(e[r]===a||r in o&&o[r]===a)||(e[r]=n?n(a):a);return e}(t,e,ai)}function oi(e,t){if("string"===typeof e){var n;try{n=JSON.parse(e)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return ci(n,t)}return ci(e,t)}function ii(e,t){var n;try{n=function(e,t){var n,r,a,o,i=[],c={tracks:{}};function s(){var e;if(void 0!==a)try{var s=a.match(/^json:(.+)/i);if(e=s?JSON.parse(s[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(a)?parseFloat(a.replace(/,/g,"")):a,!n)throw new Error("Error parsing in section ".concat(i.join(" - ")));var u=i.concat(n).join(".");if("+="===r){var l=Zo()(c,u);l?Array.isArray(l)||(l=[l]):l=[],l.push(e),e=l}"true"===e&&(e=!0),"false"===e&&(e=!1),ti()(c,u,e)}catch(d){throw new Error("syntax error".concat(t?" in ".concat(t):"").concat(o?" at line ".concat(o-1):""))}}return e.split("\n").forEach((function(e,t){o=t+1;var c,l=e.replace(/^\s*#.+/,"");if(c=l.match(/^\s*\[([^\]]+)/))s(),n=void 0,a=void 0,1===(i=c[1].trim().split(/\s*\.\s*/)).length&&"general"===i[0].toLowerCase()&&(i=[]);else if(c=l.match(void 0===a?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/)){s(),n=c[1].trim().split(/\s*\.\s*/);var d=c,f=Object(u.a)(d,3);r=f[2],function(e){if("include"===e)return!0;return!1}(i.concat(n).join("."))&&(r="+="),a=c[3].trim()}else void 0!==n&&(c=l.match(/^\s{0,4}\+\s*(.+)/))?(s(),r="+=",a=c[1].trim()):void 0!==a&&(c=l.match(/^\s+(\S.*)/))?a+=a.length?" ".concat(c[1].trim()):c[1].trim():(s(),n=void 0,a=void 0)})),s(),c}(e,t)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return ci(n,t)}function ci(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(ni(e.tracks))e.tracks=[e.tracks];else{for(var n=[],r=0,a=Object.keys(e.tracks);r<a.length;r++){var i=a[r],s=e.tracks[i];ni(s)?n.push(s):n.push(Object(c.a)({label:i},s))}e.tracks=n}var u,l=e.trackMetadata;if(l&&l.sources){if("string"===typeof l.sources&&(l.sources=[l.sources]),(u=l.sources)&&u.url&&"string"===typeof u.url&&(l.sources=[l.sources]),!Array.isArray(l.sources)){for(var d=[],f=0,p=Object.keys(l.sources);f<p.length;f++){var g=p[f],m=l.sources[g];"name"in m||(m.name=g),d.push(m)}l.sources=d}l.sources=l.sources.map((function(e){if("string"===typeof e){var t={url:e},n=e.match(/\.(\w+)$/);return n&&(t.type=n[1].toLowerCase()),t}return e}))}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){var h=[];e.tracks&&h.push.apply(h,Object(o.a)(e.tracks)),e.stores&&h.push.apply(h,Object(o.a)(Object.values(e.stores))),e.names&&h.push(e.names),h.forEach((function(t){t.baseUrl||(t.baseUrl=e.baseUrl||"/")})),e.refSeqs&&"string"===typeof e.refSeqs&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach((function(t){if(t.config){var n=t.config;delete t.config,t=Object(c.a)(Object(c.a)({},n),t)}var r;t.store||(r="FeatureTrack"===t.type?"JBrowse/View/Track/HTMLFeatures":"ImageTrack"===t.type?"JBrowse/View/Track/FixedImage":"ImageTrack.Wiggle"===t.type?"JBrowse/View/Track/FixedImage/Wiggle":"SequenceTrack"===t.type?"JBrowse/View/Track/Sequence":si("JBrowse/View/Track",t.type),t.type=r,ui(e,t),t.histograms&&(t.histograms.baseUrl||(t.histograms.baseUrl=t.baseUrl),ui(e,t.histograms)))})),e}function si(e,t){return t?(t.includes("/")||(t="".concat(e,"/").concat(t)),t=t.replace(/^\//,"")):""}function ui(e,t){var n,r=t.urlTemplate,a=void 0===r?"":r;if(n=t.storeClass?si("JBrowse/Store",t.storeClass):function(e,t){return e?e.type&&e.type.includes("/FixedImage")?"JBrowse/Store/TiledImage/Fixed".concat(0===e.backendVersion?"_v0":""):/\.jsonz?$/i.test(t)?"JBrowse/Store/SeqFeature/NCList".concat(0===e.backendVersion?"_v0":""):/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}(t,a),n){var o=Object(c.a)(Object(c.a)({},t),{},{type:n});"JBrowse/Store/Sequence/StaticChunked"!==n&&"JBrowse/Store/Sequence/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/BgzipIndexedFasta"!==n&&"JBrowse/Store/SeqFeature/TwoBit"!==n&&"JBrowse/Store/Sequence/TwoBit"!==n&&!t.useAsRefSeqStore||e.stores&&e.stores.refseqs?o.name="store".concat(Object(U.objectHash)(o)):o.name="refseqs",e.stores||(e.stores={}),e.stores[o.name]=o,t.store=o.name}else console.warn("Unable to determine an appropriate data store to use with track '".concat(t.label,"', please explicitly specify a storeClass in the configuration."))}function li(e){return void 0!==e.uri}function di(e){return void 0!==e.localPath}function fi(){return fi=Object(i.a)(d.a.mark((function e(){var t,n,r,a,o,i,c,s,u,l,f,p,g,m,h=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:{uri:"",locationType:"UriLocation"},n=h.length>1&&void 0!==h[1]?h[1]:{include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r=h.length>2&&void 0!==h[2]?h[2]:{uri:"",locationType:"UriLocation"},a="uri"in t?"uri":"localPath",o=JSON.parse(JSON.stringify(t)),i="",li(t)&&(i=t.uri),di(t)&&(i=t.localPath),i.endsWith("/")&&(o[a]=i.slice(0,i.length-1)),!(li(r)&&r.uri||di(r)&&r.localPath)){e.next=35;break}c="uri"in r?"uri":"localPath",s="",li(r)&&(s=r.uri),di(r)&&(s=r.localPath),s.endsWith("/")&&(s=s.slice(0,s.length-1)),u={},l=0,f=["jbrowse.conf","jbrowse_conf.json"];case 17:if(!(l<f.length)){e.next=33;break}return p=f[l],g=null,e.prev=20,e.next=23,mi(Object(Ko.a)({},c,"".concat(s,"/").concat(p)));case 23:g=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(20),console.error("tried to access ".concat(s,"/").concat(p,", but failed"));case 29:u=vi(u,g)||{};case 30:l++,e.next=17;break;case 33:return o[a]&&(u.dataRoot=o[a]),e.abrupt("return",pi(u));case 35:return m=ci(n,window.location.href),o[a]&&(m.dataRoot=o[a]),e.abrupt("return",pi(m));case 38:case"end":return e.stop()}}),e,null,[[20,26]])}))),fi.apply(this,arguments)}function pi(e){return gi.apply(this,arguments)}function gi(){return gi=Object(i.a)(d.a.mark((function e(t){var n,r,a,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:xi,r=ri(ai(n),t),e.next=4,Oi(r);case 4:return ki(a=vi(a=e.sent,t)||a,a),Ci(a),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),gi.apply(this,arguments)}function mi(e){return hi.apply(this,arguments)}function hi(){return(hi=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object($.openLocation)(t).readFile("utf8");case 2:if(n=e.sent,!li(t)){e.next=5;break}return e.abrupt("return",bi(n,t.uri));case 5:if(!di(t)){e.next=7;break}return e.abrupt("return",bi(n,t.localPath));case 7:return e.abrupt("return",bi(n));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.trim().startsWith("{")?oi(e,t):ii(e,t)}function vi(e,t){if(null===t)return null;null===e&&(e={});for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("tracks"===a&&a in e){var o=e[a]||[],i=t[a]||[];if(!Array.isArray(o)||!Array.isArray(i))throw new Error("Track config has not been properly regularized: ".concat(o," ").concat(i));e[a]=yi(o||[],i||[])}else"datasets"!==a&&a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?e[a]=ri(e[a],t[a]):"dataRoot"===a?(void 0===e[a]||"data"===e[a]&&void 0!==t[a])&&(e[a]=t[a]):void 0!==e[a]&&void 0===t[a]||(e[a]=t[a])}return e}function yi(e,t){if(!t.length)return e;var n={};return e.forEach((function(e,t){e.index=t,n[e.label]=e})),t.forEach((function(t){var r=n[t.label];r?vi(r,t):e.push(t)})),e}function Oi(e){return wi.apply(this,arguments)}function wi(){return wi=Object(i.a)(d.a.mark((function e(t){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return r=Object(i.a)(d.a.mark((function e(r,a){var o,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.sourceUrl||r.baseUrl){e.next=3;break}throw new Error("Could not determine source URL: ".concat(JSON.stringify(r)));case 3:if(c=vi(ai(a),r)){e.next=6;break}throw new Error("Problem merging configs");case 6:return s=ki(ji(r.include||[]),c),delete r.include,u=s.map(function(){var e=Object(i.a)(d.a.mark((function e(r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.cacheBuster=t.cacheBuster,e.next=3,mi({uri:new URL(r.url,o).href,locationType:"UriLocation"});case 3:return a=e.sent,e.abrupt("return",n(a,c));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(u);case 11:return e.sent.forEach((function(e){r=vi(r,e)||r})),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)},n=function(e,t){return r.apply(this,arguments)},t=ai(t),e.abrupt("return",n(t,{}));case 4:case"end":return e.stop()}}),e)}))),wi.apply(this,arguments)}function ji(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return"string"===typeof e&&(e={url:e}),"format"in e||(e.format=e.url.endsWith(".conf")?"conf":"JB_json"),"JB_json"!==e.format||"version"in e||(e.version=1),e}))):[]}function ki(e,t){if(!e)return e;if(Array.isArray(e))for(var n=0;n<e.length;n+=1)e[n]=ki(e[n],t);else if("object"===typeof e)for(var r=e,a=0,o=Object.keys(r);a<o.length;a++){var i=o[a];r[i]=ki(r[i],t)}else if("string"===typeof e)return function(e,t){var n=this;return e.replace(/\{([\w\s.]+)\}/g,(function(e,r){r=r.replace(/\s+/g,"");var a=Zo()(t,r);if(void 0!==a)return"function"===typeof a?a(r):a;if(t.callback){var o=t.callback.call(n,r);if(void 0!==o)return o}return e}))}(e,t);return e}var xi={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function Ci(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}function Si(e,t,n){var r={trackId:Object(U.objectHash)(e),name:e.key||e.label},a=e.metadata&&(e.metadata.description||e.metadata.Description);a&&(r.description=a);var o=e.category||e.metadata&&e.metadata.category;r.category=o?o.split(/\s*\/\s*/):[];var i=e.storeClass;if(!e.urlTemplate){if(!i||!i.endsWith("FromConfig")){var s=e.key||e.label;return console.warn('Could not import JBrowse1 track "'.concat(s,'" because it does not have a "urlTemplate" or is not a "FromConfig" track')),Object(_e.generateUnsupportedTrackConf)(r.name,s,r.category)}return function(e,t){var n=(e.features||[]).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.refName=e.seq_id,t.uniqueId="".concat(e.seq_id,":").concat(e.start,"-").concat(e.end,":").concat(e.name||""),t}));return t.adapter={type:"FromConfigAdapter",features:n},t.type="FeatureTrack",t}(e,r)}var u=function(e){return new URL(e,"".concat(t,"/")).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}")},l=u(e.urlTemplate);if(i){if("JBrowse/Store/SeqFeature/BAM"===i){var d={type:"BamAdapter",bamLocation:{uri:l,locationType:"UriLocation"}};return e.baiUrlTemplate?d.index={location:{uri:u(e.baiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?d.index={location:{uri:u(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:d.index={location:{uri:"".concat(l,".bai"),locationType:"UriLocation"}},Object(c.a)(Object(c.a)({},r),{},{type:"AlignmentsTrack",adapter:d})}if("JBrowse/Store/SeqFeature/CRAM"===i){var f={type:"CramAdapter",cramLocation:{uri:l,locationType:"UriLocation"},sequenceAdapter:n};return e.craiUrlTemplate?f.craiLocation={uri:u(e.craiUrlTemplate),locationType:"UriLocation"}:f.craiLocation={uri:"".concat(l,".crai"),locationType:"UriLocation"},Object(c.a)(Object(c.a)({},r),{},{type:"AlignmentsTrack",adapter:f})}if("JBrowse/Store/SeqFeature/NCList"===i)return Object(c.a)(Object(c.a)({},r),{},{type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:l,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/BigWig"===i||"JBrowse/Store/BigWig"===i)return e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density"),Object(c.a)(Object(c.a)({},r),{},{type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:l,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/VCFTabix"===i){var p={type:"VcfTabixAdapter",vcfGzLocation:{uri:l,locationType:"UriLocation"}};return e.tbiUrlTemplate?p.index={location:{uri:u(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?p.index={location:{uri:u(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:p.index={location:{uri:"".concat(l,".tbi"),locationType:"UriLocation"}},Object(c.a)(Object(c.a)({},r),{},{type:"VariantTrack",adapter:p})}if("JBrowse/Store/SeqFeature/VCFTribble"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"VCFTribble (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/GFF3"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"GFF3 (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/BigBed"===i)return Object(c.a)(Object(c.a)({},r),{},{type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:l,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/GFF3Tabix"===i){var g={type:"Gff3TabixAdapter",gffGzLocation:{uri:l,locationType:"UriLocation"}};return e.tbiUrlTemplate?g.index={location:{uri:u(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?g.index={location:{uri:u(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:g.index={location:{uri:"".concat(l,".tbi"),locationType:"UriLocation"}},Object(c.a)(Object(c.a)({},r),{},{type:"FeatureTrack",adapter:g})}if("JBrowse/Store/SeqFeature/BED"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"BED (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/BEDTabix"===i){var m={type:"BedTabixAdapter",bedGzLocation:{uri:l,locationType:"UriLocation"}};return e.tbiUrlTemplate?m.index={location:{uri:u(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?m.index={location:{uri:u(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:m.index={location:{uri:"".concat(l,".tbi"),locationType:"UriLocation"}},Object(c.a)(Object(c.a)({},r),{},{type:"FeatureTrack",adapter:m})}if("JBrowse/Store/SeqFeature/GTF"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"GTF (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/StaticChunked"===i||"JBrowse/Store/Sequence/StaticChunked"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"StaticChunked (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/UnindexedFasta"===i)return Object(_e.generateUnsupportedTrackConf)(r.name,"UnindexedFasta (".concat(l,")"),r.category);if("JBrowse/Store/SeqFeature/IndexedFasta"===i){var h={type:"IndexedFastaAdapter",fastaLocation:{uri:l,locationType:"UriLocation"}};return e.faiUrlTemplate?h.faiLocation={uri:u(e.faiUrlTemplate),locationType:"UriLocation"}:h.faiLocation={uri:"".concat(l,".fai"),locationType:"UriLocation"},Object(c.a)(Object(c.a)({},r),{},{type:"SequenceTrack",adapter:h})}if("JBrowse/Store/SeqFeature/BgzipIndexedFasta"===i){var b={type:"BgzipFastaAdapter",fastaLocation:{uri:l,locationType:"UriLocation"}};return e.faiUrlTemplate?b.faiLocation={uri:u(e.faiUrlTemplate),locationType:"UriLocation"}:b.faiLocation={uri:"".concat(l,".fai"),locationType:"UriLocation"},e.gziUrlTemplate?b.gziLocation={uri:u(e.gziUrlTemplate),locationType:"UriLocation"}:b.gziLocation={uri:"".concat(l,".gzi"),locationType:"UriLocation"},Object(c.a)(Object(c.a)({},r),{},{type:"ReferenceSequenceTrack",adapter:b})}if("JBrowse/Store/SeqFeature/TwoBit"===i)return Object(c.a)(Object(c.a)({},r),{},{type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:l,locationType:"UriLocation"}}})}if(r.adapter=Object(_e.guessAdapter)({uri:l,locationType:"UriLocation"},void 0,l),!r.adapter)throw new Error("Could not determine adapter");return r.adapter.type===_e.UNSUPPORTED?Object(_e.generateUnsupportedTrackConf)(r.name,l,r.category):r.adapter.type===_e.UNKNOWN?Object(_e.generateUnknownTrackConf)(r.name,l,r.category):(r.type=Object(_e.guessTrackType)(r.adapter.type),"QuantitativeTrack"===r.type&&(e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density")),r)}var Ti=function(e){return b.types.compose("JBrowse1Connection",Object(Me.BaseConnectionModelFactory)(e),b.types.model({configuration:Object(E.ConfigurationReference)(Qo),type:b.types.literal("JBrowse1Connection")}).actions((function(e){return{connect:function(){var t=Object(E.readConfObject)(e.configuration,"dataDirLocation"),n=Object(U.getSession)(e);(function(){return fi.apply(this,arguments)})(t).then((function(t){var r=Object(E.readConfObject)(e.configuration,"assemblyNames")[0];if(!r)throw new Error("assembly name required for JBrowse 1 connection");var a=n.assemblies.find((function(e){return Object(E.readConfObject)(e,"name")===r})),o=Object(E.readConfObject)(a,["sequence","adapter"]),i=t.tracks.map((function(e){var n=Si(e,t.dataRoot,o);return n.assemblyNames=[r],n}));e.setTrackConfs(i)})).catch((function(t){console.error(t),n.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'". Please make sure you have entered a valid location. The error that was thrown is: "').concat(t,'"'),"error"),n.breakConnection(e.configuration)}))}}})))},Ei=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="LegacyJBrowsePlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"NCListAdapter",configSchema:_o,getAdapterClass:function(){return Promise.all([n.e(19),n.e(70)]).then(n.bind(null,1765)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="NCListAdapter",o=Object(_e.getFileName)(t);return/trackData.jsonz?$/i.test(o)||r===a?{type:a,rootUrlTemplate:t}:e(t,n,r)}})),e.addTextSearchAdapterType((function(){return new T.a({name:"JBrowse1TextSearchAdapter",configSchema:Yo,AdapterClass:Xo,description:"A JBrowse 1 text search adapter"})})),e.addConnectionType((function(){return new x.a({name:"JBrowse1Connection",configSchema:Qo,stateModel:Ti(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})}))}}]),r}(M.a),Mi=n(1356),Ri=n.n(Mi),Pi=Object(Xe.a)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function Ai(){var e=Object(f.useState)(!1),t=Object(u.a)(e,2),n=t[0],r=t[1],a=Pi();return Object(f.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}})),n?p.a.createElement("div",{"data-testid":"loading-synteny",className:a.loading},"Loading \u2026",p.a.createElement(uo.a,null)):null}function Ni(e){var t=e.messageText,n=Pi();return p.a.createElement("div",{className:n.blockMessage},t)}function Li(e){var t=e.error,n=Pi();return p.a.createElement("div",{className:n.blockError},t.message)}var Ii=Object(ie.observer)((function(e){var t=e.model;return t.error?p.a.createElement(Li,{error:t.error}):t.message?p.a.createElement(Ni,{messageText:t.message}):t.filled?t.reactElement:p.a.createElement(Ai,null)})),Fi=function(e){var t=e.model,n=e.children;return p.a.createElement("div",null,p.a.createElement(t.ReactComponent2,e),n)};Fi.defaultProps={children:null};var Di=Object(ie.observer)(Fi),Bi=["reactElement"];function Vi(e){return Object(E.ConfigurationSchema)("LinearComparativeDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:He.d,explicitlyTyped:!0})}function zi(e){return b.types.compose("LinearComparativeDisplay",Me.BaseDisplay,b.types.model({type:b.types.literal("LinearComparativeDisplay"),configuration:Object(E.ConfigurationReference)(e),height:100})).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:Ii}})).views((function(e){return{get rendererTypeName(){return Object(E.getConf)(e,["renderer","type"])},renderProps:function(){return{rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2}}}})).actions((function(e){var t;return{afterAttach:function(){Object(U.makeAbortableReaction)(e,Wi,Ui,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){var r=n.data,a=n.reactElement,o=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=o,t=void 0},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function Wi(e){var t=Object(U.getSession)(e).rpcManager,n=e,r=n.rendererType;Object(E.readConfObject)(e.configuration);var a=e.adapterConfig,o=Object(U.getContainingView)(e),i=Object(_e.getRpcSessionId)(e);return Object(b.getSnapshot)(o),{rendererType:r,rpcManager:t,renderProps:Object(c.a)(Object(c.a)({},n.renderProps()),{},{view:so()(Object(b.getSnapshot)(o)),adapterConfig:a,rendererType:r.name,sessionId:i,timeout:1e6})}}function Ui(e){return qi.apply(this,arguments)}function qi(){return(qi=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,e.next=5,n.renderInClient(r,a);case 5:return o=e.sent,i=o.reactElement,c=Object(s.a)(o,Bi),e.abrupt("return",{reactElement:i,data:c,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hi(e){return b.types.compose("LinearComparativeView",$a.a,b.types.model({id:N.ElementId,type:b.types.literal("LinearComparativeView"),height:400,trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,middleComparativeHeight:100,tracks:b.types.array(e.pluggableMstType("track","stateModel")),views:b.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:b.types.array(e.pluggableConfigSchemaType("track"))})).volatile((function(){return{headerHeight:0,width:800}})).views((function(e){return{get highResolutionScaling(){return 2},get initialized(){return e.views.length>0},get refNames(){return e.views.map((function(e){return Object(o.a)(new Set(e.staticBlocks.map((function(e){return e.refName}))))}))},get assemblyNames(){return Object(o.a)(new Set(e.views.map((function(e){return e.assemblyNames})).flat()))}}})).actions((function(t){return{afterAttach:function(){var e=this;Object(b.addDisposer)(t,Object(b.onAction)(t,(function(n){if(t.linkViews){var r=n.name,a=n.path,o=n.args;["horizontalScroll","zoomTo","setScaleFactor","showTrack","hideTrack","toggleTrack"].includes(r)&&a&&e.onSubviewAction(r,a,o)}})))},beforeDestroy:function(){var e=Object(U.getSession)(t);t.assemblyNames.forEach((function(t){var n;t.endsWith("-temp")&&(null===(n=e.removeAssembly)||void 0===n||n.call(e,t))}))},onSubviewAction:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.views.forEach((function(t){var a=Object(b.getPath)(t);a.lastIndexOf(n)!==a.length-n.length&&t[e](r[0])}))},setWidth:function(e){t.width=e,t.views.forEach((function(t){return t.setWidth(e)}))},setHeight:function(e){t.height=e},setViews:function(e){t.views=Object(b.cast)(e)},removeView:function(e){t.views.remove(e)},closeView:function(){Object(b.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},setMiddleComparativeHeight:function(e){return t.middleComparativeHeight=e,t.middleComparativeHeight},toggleLinkViews:function(){t.linkViews=!t.linkViews},activateTrackSelector:function(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));var e=Object(U.getSession)(t);if(Object(U.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),o=Object(b.resolveIdentifier)(a,Object(b.getRoot)(t),n),i=e.getTrackType(o.type);if(!i)throw new Error("unknown track type ".concat(o.type));var s=e.getViewType(t.type),u=s.displayTypes.map((function(e){return e.name})),l=o.displays.find((function(e){return u.includes(e.type)}));if(!l)throw new Error("could not find a compatible display for view type ".concat(t.type));t.tracks.push(i.stateModel.create(Object(c.a)(Object(c.a)({},r),{},{type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]})))},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=Object(b.resolveIdentifier)(r,Object(b.getRoot)(t),n),o=t.tracks.filter((function(e){return e.configuration===a}));return Object(Ge.transaction)((function(){return o.forEach((function(e){return t.tracks.remove(e)}))})),o.length},squareView:function(){var e=t.views.map((function(e){return e.bpPerPx})),n=e.reduce((function(e,t){return e+t}),0)/e.length;t.views.forEach((function(e){var t=e.pxToBp(e.width/2);e.setNewView(n,e.offsetPx),e.centerAt(t.coord,t.refName,t.index)}))},clearView:function(){t.views=Object(b.cast)([])}}})).views((function(e){return{menuItems:function(){var t=[];return e.views.forEach((function(e,n){var r;null!==(r=e.menuItems)&&void 0!==r&&r.call(e)&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems()})})),t.push({label:"Return to import form",onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[ue.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:eo.a}),t.push({label:"Open track selector",onClick:e.activateTrackSelector,icon:tn.c}),t}}}))}var _i=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearComparativeView",stateModel:t(Hi),ReactComponent:Object(f.lazy)((function(){return n.e(71).then(n.bind(null,959))}))})},Gi=function(e){e.addDisplayType((function(){var t=function(e){return Object(E.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},renderer:b.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"LinearSyntenyRenderer"}),middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Vi(e),explicitlyTyped:!0})}(e);return new w.a({name:"LinearSyntenyDisplay",configSchema:t,stateModel:Ji(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:Di})}))};function Ji(e){return b.types.compose("LinearSyntenyDisplay",zi(e),b.types.model({type:b.types.literal("LinearSyntenyDisplay"),configuration:Object(E.ConfigurationReference)(e)})).views((function(e){return{renderProps:function(){var t=Object(U.getContainingView)(e);return{rpcDriverName:e.rpcDriverName,displayModel:e,config:Object(E.getConf)(e,"renderer"),width:t.width,height:t.middleComparativeHeight}},get rendererTypeName(){return e.configuration.renderer.type},get adapterConfig(){return Object(c.a)({name:e.parentTrack.configuration.adapter.type,assemblyNames:Object(E.getConf)(e,"assemblyNames")},Object(E.getConf)(e.parentTrack,"adapter"))},get trackIds(){return Object(E.getConf)(e,"trackIds")}}}))}var Xi=d.a.mark(Qi);function Yi(e,t){return e?0:t}function Qi(){var e,t,n,r,a,o,i,c=arguments;return d.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:e=c.length>0&&void 0!==c[0]?c[0]:[],t=c.length>1&&void 0!==c[1]?c[1]:[],n=c.length>2?c[2]:void 0,r=0,a=0;case 5:if(!(r<e.length&&a<t.length)){s.next=22;break}if(o=n(e[r]),i=n(t[a]),!(o<i)){s.next=12;break}r++,s.next=20;break;case 12:if(!(i<o)){s.next=16;break}a++,s.next=20;break;case 16:return s.next=18,[e[r],t[a]];case 18:r++,a++;case 20:s.next=5;break;case 22:case"end":return s.stop()}}),Xi)}var Ki=[0,1,2,3],$i=Ki[0],Zi=Ki[2],ec=ve.parseCigar;function tc(e,t){var n;return(null===(n=Object(U.viewBpToPx)(Object(c.a)(Object(c.a)({},t),{},{self:e})))||void 0===n?void 0:n.offsetPx)||0}var nc=Object(ie.observer)((function(e){var t=e.height,n=e.width,r=e.displayModel,a=e.highResolutionScaling,o=void 0===a?1:a,i=e.features,s=e.trackIds,l=Object(f.useRef)(null),d=function(e){if("type"in e&&Object(b.isAlive)(e)){var t=Object(U.getContainingView)(e),n=Object(E.getConf)(e,["renderer","color"]),r=Object(U.getSession)(e);return{color:n,session:r,parentView:t,assemblyManager:r.assemblyManager}}return{}}(r),m=d.color,h=d.assemblyManager,v=d.parentView,y=Object(f.useMemo)((function(){return function(e,t){for(var n=[],r=0;r<e.length;r++)for(var a=r;a<e.length;a++)if(r!==a){var o,i=Object(g.a)(Qi(e[r],e[a],(function(e){return e.get("syntenyId")})));try{for(i.s();!(o=i.n()).done;){var c=Object(u.a)(o.value,2),s=c[0],l=c[1],d=s.get("start"),f=s.get("end"),p=l.get("start"),m=l.get("end");if(-1===s.get("strand")){var h=[d,f];f=h[0],d=h[1]}var b=null===t||void 0===t?void 0:t.get(s.get("assemblyName")),v=null===t||void 0===t?void 0:t.get(l.get("assemblyName")),y=s.get("refName"),O=l.get("refName");n.push([{feature:s,level:r,refName:(null===b||void 0===b?void 0:b.getCanonicalRefName(s.get("refName")))||y,layout:[d,0,f,10]},{feature:l,level:a,refName:(null===v||void 0===v?void 0:v.getCanonicalRefName(s.get("refName")))||O,layout:[p,0,m,10]}])}}catch(w){i.e(w)}finally{i.f()}}return n}(i.map((function(e){return e.map((function(e){return new q.a(e)})).sort((function(e,t){return e.get("syntenyId")-t.get("syntenyId")}))})),h)}),[i,h]),O=null===v||void 0===v?void 0:v.drawCurves,w=null===v||void 0===v?void 0:v.views,j=null===w||void 0===w?void 0:w.map((function(e){return e.offsetPx}));return Object(f.useEffect)((function(){if(l.current&&j&&w&&Object(b.isAlive)(r)){var e=l.current.getContext("2d");if(e){e.resetTransform(),e.scale(o,o),e.clearRect(0,0,n,t),e.fillStyle=m,e.strokeStyle=m;var a=w.map((function(e){return Object(c.a)(Object(c.a)({},Object(b.getSnapshot)(e)),{},{width:e.width,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth})}));y.forEach((function(n){for(var r=0;r<n.length-1;r+=1){var o=n[r],i=o.layout,c=o.feature,s=o.level,u=o.refName,l=n[r+1],d=l.layout,f=l.feature,p=l.level,g=l.refName,m=a[s],h=a[p];if(!i||!d)return void console.warn("received null layout for a overlay feature");if(s!==p){var b=c.get("end")-c.get("start"),v=f.get("end")-f.get("start");b<m.bpPerPx||h.bpPerPx,0;var y=tc(m,{refName:u,coord:i[$i]})-j[s],w=tc(m,{refName:u,coord:i[Zi]})-j[s],k=tc(h,{refName:g,coord:d[$i]})-j[p],x=tc(h,{refName:g,coord:d[Zi]})-j[p],C=Yi(s<p,t),S=Yi(p<s,t),T=(S-C)/2;if(b<m.bpPerPx||v<h.bpPerPx)e.beginPath(),e.moveTo(y,C),O?e.bezierCurveTo(y,T,k,T,k,S):e.lineTo(k,S),e.stroke();else{var E=y,M=k,R=y<w?1:-1,P=k<x?1:-1,A=c.get("cg")||c.get("CIGAR");if(A)for(var N=ec(A),L=0;L<N.length;L+=2){var I=+N[L],F=N[L+1],D=E,B=M;"M"===F||"="===F?(e.fillStyle="#f003",E+=I/a[0].bpPerPx*R,M+=I/a[1].bpPerPx*P):"X"===F?(e.fillStyle="brown",E+=I/a[0].bpPerPx*R,M+=I/a[1].bpPerPx*P):"D"===F?(e.fillStyle="#00f3",E+=I/a[0].bpPerPx*R):"N"===F?(e.fillStyle="#0a03",E+=I/a[0].bpPerPx*R):"I"===F&&(e.fillStyle="#ff03",M+=I/a[1].bpPerPx*P),(Math.abs(D-E)>.5||Math.abs(B-M)>.5)&&(e.beginPath(),e.moveTo(D,C),e.lineTo(E,C),O?e.bezierCurveTo(E,T,M,T,M,S):e.lineTo(M,S),e.lineTo(B,S),O?e.bezierCurveTo(B,T,D,T,D,C):e.lineTo(D,C),e.closePath(),e.fill())}else e.beginPath(),e.moveTo(y,C),e.lineTo(w,C),O?e.bezierCurveTo(w,T,x,T,x,S):e.lineTo(x,S),e.lineTo(k,S),O?e.bezierCurveTo(k,T,y,T,y,C):e.lineTo(y,C),e.closePath(),e.fill()}}}}))}}}),[r,o,s,n,w,j,O,m,t,y]),p.a.createElement("canvas",{ref:l,"data-testid":"synteny_canvas",style:{width:n,height:t},width:n*o,height:t*o})})),rc=Object(E.ConfigurationSchema)("LinearSyntenyRenderer",{color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"rgb(255,100,100,0.3)"}},{explicitlyTyped:!0}),ac=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager){e.next=3;break}throw new Error("No assembly manager provided");case 3:o=t.view.views,i=0;case 5:if(!(i<o.length)){e.next=13;break}return c=o[i],e.next=9,Object(U.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:c.displayedRegions,adapterConfig:t.adapterConfig});case 9:c.displayedRegions=e.sent.regions;case 10:i++,e.next=5;break;case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,s,u,l=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,r=t.view.views,a=r.map((function(e){var t=to.a.create(e);return t.setVolatileWidth(n),t})),e.next=4,Promise.all(a.map((function(e){return l.getFeatures(Object(c.a)(Object(c.a)({},t),{},{regions:e.staticBlocks.contentBlocks}))})));case 4:for(o=e.sent,i=JSON.parse(JSON.stringify(o)),s=0;s<i.length;s++)for(u=0;u<i[s].length;u++)i[s][u]._level=s;return e.abrupt("return",{reactElement:p.a.createElement(this.ReactComponent,Object(c.a)(Object(c.a)({},t),{},{features:o})),features:i});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(xo.a),oc=n(349),ic=n.n(oc),cc=n(877);function sc(e){return b.types.compose(Hi(e),b.types.model("LinearSyntenyView",{type:b.types.literal("LinearSyntenyView"),drawCurves:!1}).actions((function(e){return{toggleCurves:function(){e.drawCurves=!e.drawCurves}}}))).views((function(e){var t=e.menuItems;return{menuItems:function(){return[].concat(Object(o.a)(t()),[{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:ic.a},{label:e.linkViews?"Unlink views":"Link views",onClick:e.toggleLinkViews,icon:e.linkViews?zr.a:Br.a},{label:e.drawCurves?"Use straight lines":"Use curved lines",onClick:e.toggleCurves,icon:e.drawCurves?cc.b:cc.a}])}}}))}var uc=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearSyntenyView",stateModel:t(sc),ReactComponent:Object(f.lazy)((function(){return n.e(40).then(n.bind(null,1768))}))})},lc=n(61),dc=n(1652),fc=n(1747),pc=n(113),gc=n.n(pc),mc=ve.parseCigar;function hc(e){for(var t=mc(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"D"!==o&&"N"!==o&&(n+=a)}return n}function bc(e){for(var t=mc(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"H"!==o&&"S"!==o&&"D"!==o&&"N"!==o&&(n+=a)}return n}function vc(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}var yc=Object(Xe.a)((function(e){return{root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Oc(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function wc(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}function jc(e){var t=yc(),n=e.track,r=e.feature,a=e.handleClose,s=Object(f.useState)("0"),l=Object(u.a)(s,2),g=l[0],m=l[1],h=Object(f.useState)(),b=Object(u.a)(h,2),v=b[0],y=b[1],O=Object(f.useState)(),w=Object(u.a)(O,2),j=w[0],k=w[1],x=Object(f.useState)(!1),C=Object(u.a)(x,2),S=C[0],T=C[1],M=+g;return Object(f.useEffect)((function(){var e=!1;return Object(i.a)(d.a.mark((function t(){var a,o,i,c,s,l,f,p,g,m,h,b;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(2048&r.get("flags"))){t.next=19;break}return a=Oc(r,"SA")||"",o=a.split(";")[0],i=o.split(","),c=Object(u.a)(i,2),s=c[0],l=c[1],f=Object(U.getSession)(n),p=f.rpcManager,g=Object(E.getConf)(n,"adapter"),m=Object(_e.getRpcSessionId)(n),t.next=10,p.call(m,"CoreGetFeatures",{adapterConfig:g,sessionId:m,region:{refName:s,start:+l-1,end:+l}});case 10:if(h=t.sent,!(b=h.find((function(e){return e.get("name")===r.get("name")&&!(2048&e.get("flags"))})))){t.next=16;break}e||k(b),t.next=17;break;case 16:throw new Error("primary feature not found");case 17:t.next=20;break;case 19:k(r);case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(0),console.error(t.t0),y(t.t0);case 26:case"end":return t.stop()}}),t,null,[[0,22]])})))(),function(){e=!0}}),[r,n]),p.a.createElement(Fn.a,{open:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},p.a.createElement(Bn.a,{id:"alert-dialog-title"},"Set window size",p.a.createElement(Er.a,{"aria-label":"close",className:t.closeButton,onClick:a},p.a.createElement(gc.a,null))),p.a.createElement(Dn.a,null,j?p.a.createElement("div",{className:t.root},p.a.createElement(pn.a,null,"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."),v?p.a.createElement(pn.a,{color:"error"},"".concat(v)):null,p.a.createElement(zn.a,{value:M,onChange:function(e){return m(e.target.value)},label:"Set window size"}),p.a.createElement(dc.a,{control:p.a.createElement(fc.a,{checked:S,onChange:function(){return T((function(e){return!e}))}}),label:"Show qual track"})):p.a.createElement("div",null,p.a.createElement(pn.a,null,"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."),p.a.createElement(lc.a,null))),p.a.createElement(Vn.a,null,p.a.createElement(In.a,{variant:"contained",color:"secondary",onClick:a},"Cancel"),p.a.createElement(In.a,{variant:"contained",color:"primary",onClick:function(){try{var e;if(!j)return;var t=j,r=Object(U.getSession)(n),i=Object(U.getContainingView)(n),s=t.get("CIGAR"),l=vc(s,1),d=t.get("flags"),f=t.get("qual"),p=t.get("strand"),g=Oc(t,"SA")||"",m=t.get("name"),h="".concat(m,"_assembly_").concat(Date.now()),b=Object(E.getConf)(n,"assemblyNames"),v=Object(u.a)(b,1)[0],O=[v,h],w="track-".concat(Date.now()),k="".concat(m,"_vs_").concat(v),x=r.assemblyManager.get(v),C=g.split(";").filter((function(e){return!!e})).map((function(e,n){var r=e.split(","),a=Object(u.a)(r,4),o=a[0],i=a[1],c=a[2],s=a[3],l=function(e){for(var t=mc(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],o=t[r+1];"H"!==o&&"S"!==o&&"I"!==o&&(n+=a)}return n}(s),d=hc(s),f=bc(s),g="-"===c?-1:1,h=vc(s,g*p),b=+i-1;return{refName:o,start:b,end:b+l,seqLength:d,clipPos:h,CIGAR:s,assemblyName:v,strand:p*g,uniqueId:"".concat(t.id(),"_SA").concat(n),mate:{start:h,end:h+f,refName:m}}})),T=t.toJSON();T.clipPos=l,T.strand=1,T.mate={refName:m,start:l,end:l+bc(s)};var R=hc(2048&d?C[0].CIGAR:s),P=[T].concat(Object(o.a)(C));P.forEach((function(e,t){e.refName=(null===x||void 0===x?void 0:x.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),P.sort((function(e,t){return e.clipPos-t.clipPos}));var A=t.get("seq"),N=P.concat(P.map((function(e){return e.mate}))),L=2*M,I=P.reduce((function(e,t){return e+t.end-t.start+L}),0),F="".concat(m,"_").concat(Date.now()),D=Object(E.getConf)(x,"sequence"),B=wc(P.map((function(e){return Object(c.a)(Object(c.a)({},e),{},{start:Math.max(0,e.start-M),end:e.end+M,assemblyName:v})})));null===(e=r.addAssembly)||void 0===e||e.call(r,{name:"".concat(h),sequence:{type:"ReferenceSequenceTrack",trackId:F,assemblyNames:[h],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:R,seq:A,refName:m,uniqueId:"".concat(Math.random())}]}}}),r.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:I/i.width,displayedRegions:B,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[v],configuration:D.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(F,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:R/i.width,displayedRegions:[{assemblyName:h,start:0,end:R,refName:m}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:F,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(F,"-LinearReferenceSequenceDisplay")}]}].concat(Object(o.a)(S?[{id:"".concat(Math.random()),type:"QuantitativeTrack",configuration:{trackId:"qualTrack",assemblyNames:[h],name:"Read quality",type:"QuantitativeTrack",adapter:{type:"FromConfigAdapter",noAssemblyManager:!0,features:f.split(" ").map((function(e,t){return{start:t,end:t+1,refName:m,score:+e,uniqueId:"feat_".concat(t)}}))}},displays:[{id:"".concat(Math.random()),type:"LinearWiggleDisplay",height:100}]}]:[]))}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:O,adapter:{type:"FromConfigAdapter",features:N},trackId:w,name:k}],tracks:[{configuration:w,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(w,"-LinearSyntenyDisplay")}]}],displayName:"".concat(m," vs ").concat(v)}),a()}catch(V){console.error(V),y(V)}}},"Submit")))}var kc=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="LinearComparativeViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(_i)})),e.addViewType((function(){return e.jbrequire(uc)})),function(e){e.addRendererType((function(){return new ac({name:"LinearSyntenyRenderer",configSchema:rc,ReactComponent:nc,pluginManager:e})}))}(e),function(e){e.addDisplayType((function(){var t=Vi(e);return new w.a({name:"LinearComparativeDisplay",configSchema:t,stateModel:zi(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:Di})}))}(e),Gi(e),function(e){e.addTrackType((function(){var t=Object(E.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:Object(Me.createBaseTrackConfig)(e)});return new O.a({name:"SyntenyTrack",configSchema:t,stateModel:Object(Me.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearPileupDisplay"===e.name){var t=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature;return n?[].concat(Object(o.a)(t()),[{label:"Linear read vs ref",icon:Mo.a,onClick:function(){Object(U.getSession)(e).queueDialog((function(t){return[jc,{track:Object(U.getContainingTrack)(e),feature:n,handleClose:t}]}))}}]):t()}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){Object(U.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Ri.a,onClick:function(e){e.addView("LinearSyntenyView",{})}})}}]),n}(M.a);var xc=n(264);function Cc(e){return b.types.compose("LinearLollipopDisplay",He.a,b.types.model({type:b.types.literal("LinearLollipopDisplay"),configuration:Object(xc.a)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:function(){return Object(c.a)(Object(c.a)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var Sc=n(265);function Tc(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.y,o=r.data,i=o.anchorX,c=o.radiusPx,s=o.score,u=Object(E.readConfObject)(n,"innerColor",{feature:t}),l=String(s),d=1.1*(2*c/l.length);return d<12?null:p.a.createElement("text",{style:{fontSize:d,fill:Object(Sc.contrastingTextColor)(u)},x:i,y:a+c-d/2.4,textAnchor:"middle",dominantBaseline:"hanging"},l)}function Ec(e){var t=function(t){var n=e.onFeatureMouseDown,r=e.feature;if(n)return n(t,r.id())},n=function(t){var n=e.onFeatureMouseEnter,r=e.feature;if(n)return n(t,r.id())},r=function(t){var n=e.onFeatureMouseOut,r=e.feature;if(n)return n(t,r.id())},a=function(t){var n=e.onFeatureMouseOver,r=e.feature;if(n)return n(t,r.id())},o=function(t){var n=e.onFeatureMouseUp,r=e.feature;if(n)return n(t,r.id())},i=function(t){var n=e.onFeatureMouseLeave,r=e.feature;if(n)return n(t,r.id())},c=function(t){var n=e.onFeatureMouseMove,r=e.feature;if(n)return n(t,r.id())},s=function(t){var n=e.onFeatureClick,r=e.feature;if(n)return t.stopPropagation(),n(t,r.id())},u=e.feature,l=e.config,d=e.layoutRecord,f=d.anchorLocation,g=d.y,m=d.data,h=m.radiusPx,b=m.score,v=e.selectedFeatureId,y={fill:Object(E.readConfObject)(l,"strokeColor",{feature:u})};String(v)===String(u.id())&&(y.fill="red");var O={fill:Object(E.readConfObject)(l,"innerColor",{feature:u})},w=Object(E.readConfObject)(l,"strokeWidth",{feature:u});return p.a.createElement("g",{"data-testid":u.id()},p.a.createElement("title",null,Object(E.readConfObject)(l,"caption",{feature:u})),p.a.createElement("circle",{cx:f,cy:g+h,r:h,style:y,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:o,onMouseLeave:i,onMouseMove:c,onClick:s,onFocus:a,onBlur:r}),h-w<=2?null:p.a.createElement("circle",{cx:f,cy:g+h,r:h-w,style:O,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:o,onMouseLeave:i,onMouseMove:c,onClick:s,onFocus:a,onBlur:r}),p.a.createElement(Tc,Object.assign({},e,{score:b})))}Ec.defaultProps={selectedFeatureId:void 0,onFeatureMouseDown:void 0,onFeatureMouseEnter:void 0,onFeatureMouseOut:void 0,onFeatureMouseOver:void 0,onFeatureMouseUp:void 0,onFeatureMouseLeave:void 0,onFeatureMouseMove:void 0,onFeatureClick:void 0};var Mc=Object(ie.observer)(Ec);function Rc(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.anchorLocation,o=r.y,i=r.data.radiusPx,c=e.selectedFeatureId,s={fill:Object(E.readConfObject)(n,"bodyColor",{feature:t})};return String(c)===String(t.id())&&(s.fill="red"),p.a.createElement("line",{x1:a,y1:0,x2:a,y2:o+2*i,stroke:Object(E.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:Object(E.readConfObject)(n,"stickWidth",{feature:t})})}Rc.defaultProps={selectedFeatureId:void 0};var Pc=Object(ie.observer)(Rc);function Ac(e){var t=function(t){var n=e.onMouseEnter;if(n)return n(t)},n=function(t){var n=e.onMouseLeave;if(n)return n(t)};function r(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.layout,o=Math.abs(t.get("end")+t.get("start"))/2,i=Object(U.bpToPx)(o,r,n),c=Object(E.readConfObject)(e.config,"radius",{feature:t});c||console.error(new Error("lollipop radius ".concat(c," configured for feature ").concat(t.id()))),a.add(t.id(),i,2*c,2*c,{featureId:t.id(),anchorX:i,radiusPx:c,score:Object(E.readConfObject)(e.config,"score",{feature:t})})}var a,o=e.regions,i=e.bpPerPx,c=e.layout,s=e.config,l=e.features,d=e.displayModel.selectedFeatureId,f=Object(u.a)(o,1)[0],m=[],h=[],b=Object(g.a)(l.values());try{for(b.s();!(a=b.n()).done;){r({feature:a.value,bpPerPx:i,region:f,config:s,layout:c})}}catch(M){b.e(M)}finally{b.f()}var v,y=Object(g.a)(c.getLayout(s).values());try{for(y.s();!(v=y.n()).done;){var O=v.value,w=l.get(O.data.featureId);h.push(p.a.createElement(Pc,Object.assign({},e,{layoutRecord:O,feature:w,key:"stick-".concat(w.id()),selectedFeatureId:d})))}}catch(M){y.e(M)}finally{y.f()}var j,k=Object(g.a)(c.getLayout(s).values());try{for(k.s();!(j=k.n()).done;){var x=j.value,C=l.get(x.data.featureId);h.push(p.a.createElement(Mc,Object.assign({},e,{layoutRecord:x,feature:C,key:"body-".concat(C.id()),selectedFeatureId:d})))}}catch(M){k.e(M)}finally{k.f()}var S=(f.end-f.start)/i,T=c.getTotalHeight();return p.a.createElement("svg",{className:"LollipopRendering",width:S,height:T,style:{position:"relative"},onMouseDown:function(t){var n=e.onMouseDown;if(n)return n(t)},onMouseUp:function(t){var n=e.onMouseUp;if(n)return n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:function(t){var n=e.onMouseOver;if(n)return n(t)},onMouseOut:function(t){var n=e.onMouseOut;if(n)return n(t)},onFocus:t,onBlur:n,onClick:function(t){var n=e.onClick;if(n)return n(t)}},m,h)}Ac.defaultProps={displayModel:{},features:new Map,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onClick:void 0};var Nc=Object(ie.observer)(Ac),Lc=Object(E.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0}),Ic=n(343),Fc=function(){function e(t){var n=t.width;if(Object(m.a)(this,e),this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!n)throw new Error("width required to make a new FloatingLayout");this.width=n}return Object(h.a)(e,[{key:"add",value:function(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a}),this.layoutDirty=!0}},{key:"getLayout",value:function(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");for(var t=Object(E.readConfObject)(e,"minStickLength"),n=this.items.sort((function(e,t){return e.data.score-t.data.score})),r=0,a=Array(n.length),o=0;o<n.length;o+=1){for(var i=n[o],s=i.anchorLocation,l=i.width,d=i.height,f=s-l/2,p=f+l,g=t,m=g+d,h=0;h<o;h+=1){var b=Object(u.a)(a[h],2)[1],v=b.x,y=b.y,O=v+b.width,w=y+b.height;Object(Ct.a)(v,O,f,p)&&Object(Ct.a)(y,w,g,m)&&(m=(g=w)+d,h=-1)}a[o]=[i.uniqueId,Object(c.a)(Object(c.a)({},i),{},{x:f,y:g})],m>r&&(r=m)}return this.totalHeight=r,this.layout=new Map(a),this.layoutDirty=!1,this.layout}},{key:"getTotalHeight",value:function(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}},{key:"serializeRegion",value:function(){return this.toJSON()}},{key:"toJSON",value:function(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:Object(o.a)(this.getLayout()),totalHeight:this.getTotalHeight()}}}],[{key:"fromJSON",value:function(){throw new Error("not supported")}}]),e}(),Dc=function(){function e(t){var n=t.pairs,r=t.totalHeight;Object(m.a)(this,e),this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(n),this.totalHeight=r}return Object(h.a)(e,[{key:"add",value:function(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}},{key:"getLayout",value:function(){return this.layout}},{key:"getTotalHeight",value:function(){return this.totalHeight}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}(),Bc=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"makeLayout",value:function(){var e=this.regions[0],t=(e.end-e.start)/this.bpPerPx;return new Ic.a(Fc,{width:t})}},{key:"layoutIsValid",value:function(){return!1}}]),n}(xt.LayoutSession),Vc=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"createSession",value:function(e){return new Bc(e)}},{key:"deserializeLayoutInClient",value:function(e){return new Dc(e)}}]),n}(xt.default),zc=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="LollipopPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new Vc({name:"LollipopRenderer",ReactComponent:Nc,configSchema:Lc,pluginManager:e})})),e.addDisplayType((function(){var t=function(e){return Object(E.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:He.d,explicitlyTyped:!0})}(e);return new w.a({name:"LinearLollipopDisplay",configSchema:t,stateModel:Cc(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:He.b})}))}}]),n}(M.a);function Wc(e,t){var n=t.getPlugin("LinearGenomeViewPlugin").exports.BaseLinearDisplay;return b.types.compose("LinearArcDisplay",n,b.types.model({type:b.types.literal("LinearArcDisplay"),configuration:Object(xc.a)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"staticBlocks"},get renderDelay(){return 500},renderProps:function(){return Object(c.a)(Object(c.a)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var Uc=n(1357);var qc=Object(ie.observer)((function(e){var t,n=function(t,n){var r=e.onFeatureClick;if(r)return r(t,n)},r=e.features,a=e.config,o=e.regions,i=e.blockKey,c=e.bpPerPx,s=e.displayModel.selectedFeatureId,l=Object(u.a)(o,1)[0],d=[],f=Object(g.a)(r.values());try{var m=function(){var e=t.value,r=Object(U.bpSpanPx)(e.get("start"),e.get("end"),l,c),o=Object(u.a)(r,2),f=o[0],g=o[1],m=e.id(),h=i+"-"+m,b=Object(E.readConfObject)(a,"color",{feature:e}),v="black";s&&String(s)===String(e.id())&&(b=v="red");var y=Object(E.readConfObject)(a,"label",{feature:e}),O=Object(E.readConfObject)(a,"caption",{feature:e}),w=Object(E.readConfObject)(a,"thickness",{feature:e})||1,j=Object(E.readConfObject)(a,"height",{feature:e})||100,k=p.a.createRef(),x=20+Object(U.measureText)(null===O||void 0===O?void 0:O.toString()),C=.5,S=0+C*j*.75+.375*j+0;d.push(p.a.createElement("g",{key:h,onClick:function(e){return n(e,m)}},p.a.createElement("path",{id:h,d:"M ".concat(f," 0 C ").concat(f," ").concat(j,", ").concat(g," ").concat(j,", ").concat(g," 0"),stroke:b,strokeWidth:w,fill:"transparent",onClick:function(e){return n(e,m)},ref:k,pointerEvents:"stroke"}),p.a.createElement(Uc.a,{triggerRef:k},p.a.createElement("rect",{x:12,y:0,width:x,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),p.a.createElement("text",{x:22,y:14,fontSize:10,fill:"white",textLength:x-20},O)),p.a.createElement("text",{x:f+(g-f)/2,y:S+3,style:{stroke:"white",strokeWidth:"0.6em"}},y),p.a.createElement("text",{x:f+(g-f)/2,y:S+3,style:{stroke:v}},y)))};for(f.s();!(t=f.n()).done;)m()}catch(b){f.e(b)}finally{f.f()}var h=(l.end-l.start)/c;return p.a.createElement("svg",{className:"ArcRendering",width:h,height:500,style:{outline:"none",position:"relative"}},d)})),Hc=Object(E.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue"},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')"},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50"},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]}},{explicitlyTyped:!0}),_c=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n)}(Re.default),Gc=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="ArcRenderer",e}return Object(h.a)(n,[{key:"install",value:function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.BaseLinearDisplayComponent;e.addRendererType((function(){return new _c({name:"ArcRenderer",ReactComponent:qc,configSchema:Hc,pluginManager:e})})),e.addDisplayType((function(){var n=function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.baseLinearDisplayConfigSchema;return Object(E.ConfigurationSchema)("LinearArcDisplay",{renderer:b.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new w.a({name:"LinearArcDisplay",configSchema:n,stateModel:Wc(n,e),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:t})})),e.jexl.addFunction("logThickness",(function(e,t){return Math.log(e.get(t)+1)}))}}]),n}(M.a),Jc=n(589),Xc=n.n(Jc),Yc=n(878),Qc=n.n(Yc),Kc=Object(E.ConfigurationSchema)("AboutWidget",{}),$c=b.types.model("AboutWidget",{id:N.ElementId,type:b.types.literal("AboutWidget")}),Zc=Object(E.ConfigurationSchema)("HelpWidget",{}),es=b.types.model("HelpWidget",{id:N.ElementId,type:b.types.literal("HelpWidget")}),ts=Object(E.ConfigurationSchema)("ImportSessionWidget",{}),ns=b.types.model("ImportSessionWidget",{id:N.ElementId,type:b.types.literal("ImportSessionWidget")}),rs=Object(E.ConfigurationSchema)("SessionManager",{}),as=b.types.model("SessionManager",{id:N.ElementId,type:b.types.literal("SessionManager")}),os=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="MenusPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addWidgetType((function(){return new k.a({name:"AboutWidget",heading:"About",configSchema:Kc,stateModel:$c,ReactComponent:Object(f.lazy)((function(){return n.e(74).then(n.bind(null,1722))}))})})),e.addWidgetType((function(){return new k.a({name:"HelpWidget",heading:"Help",configSchema:Zc,stateModel:es,ReactComponent:Object(f.lazy)((function(){return n.e(75).then(n.bind(null,1723))}))})})),e.addWidgetType((function(){return new k.a({name:"ImportSessionWidget",heading:"Import session",configSchema:ts,stateModel:ns,ReactComponent:Object(f.lazy)((function(){return Promise.all([n.e(26),n.e(47)]).then(n.bind(null,1724))}))})})),e.addWidgetType((function(){return new k.a({name:"SessionManager",heading:"Sessions",configSchema:rs,stateModel:as,ReactComponent:Object(f.lazy)((function(){return n.e(30).then(n.bind(null,1725))}))})}))}},{key:"configure",value:function(e){Object(U.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:Qc.a,onClick:function(e){var t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:Xc.a,onClick:function(e){var t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}]),r}(M.a),is=n(1358),cs=n.n(is),ss=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e,r,a){var o;return Object(m.a)(this,n),(o=t.call(this,e,r,a)).endpoint=void 0,o.queryTemplate=void 0,o.refNamesQueryTemplate=void 0,o.additionalQueryParams=void 0,o.configRefNames=void 0,o.refNames=void 0,o.endpoint=Object(E.readConfObject)(e,"endpoint").uri,o.queryTemplate=Object(E.readConfObject)(e,"queryTemplate"),o.additionalQueryParams=Object(E.readConfObject)(e,"additionalQueryParams"),o.refNamesQueryTemplate=Object(E.readConfObject)(e,"refNamesQueryTemplate"),o.configRefNames=Object(E.readConfObject)(e,"refNames"),o}return Object(h.a)(n,[{key:"getRefNames",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,r,a,o=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},!this.refNames){e.next=3;break}return e.abrupt("return",this.refNames);case 3:if(n=[],!this.refNamesQueryTemplate){e.next=12;break}return r=encodeURIComponent(this.refNamesQueryTemplate),e.next=8,this.querySparql(r,t);case 8:a=e.sent,n=this.resultsToRefNames(a),e.next=13;break;case 12:this.configRefNames&&(n=this.configRefNames);case 13:return this.refNames=n,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(na.ObservableCreate)(function(){var r=Object(i.a)(d.a.mark((function r(a){var o,i,c;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=encodeURIComponent(cs()(t.queryTemplate,e)),i=e.refName,r.next=4,t.querySparql(o,n);case 4:c=r.sent,t.resultsToFeatures(c,i).forEach((function(e){a.next(e)})),a.complete();case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"querySparql",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",this.additionalQueryParams.length&&(r="&".concat(this.additionalQueryParams.join("&"))),a=n&&n.signal,e.next=5,fetch("".concat(this.endpoint,"?query=").concat(t).concat(r),{headers:{accept:"application/json,application/sparql-results+json"},signal:a});case 5:return o=e.sent,e.abrupt("return",o.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resultsToRefNames",value:function(e){var t=((e||{}).results||{}).bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((function(e){return e.refName.value}))}},{key:"resultsToFeatures",value:function(e,t){var n=((e||{}).results||{}).bindings||[];if(!n.length)return[];var r=e.head.vars;["start","end","uniqueId"].forEach((function(e){r.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));var a={};n.forEach((function(e){var n=[{}];r.forEach((function(t){if(t in e){for(var r=e[t].value,a=0;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>n.length-1;)n.push({});n[a][t]=r}})),n.forEach((function(e,r){var o=e.uniqueId;r<n.length-1&&(n[r+1].parentUniqueId=o),a[o]={data:Object(c.a)(Object(c.a)({},e),{},{uniqueId:o,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0})}}))}));for(var i=0,s=Object.entries(a);i<s.length;i++){var l=Object(u.a)(s[i],2),d=l[0],f=l[1],p=f.data.parentUniqueId;if(delete f.data.parentUniqueId,p){var m=a[p];if(m)m.data.subfeatures||(m.data.subfeatures=[]),m.data.subfeatures.push(Object(c.a)(Object(c.a)({},f.data),{},{uniqueId:d})),delete a[d];else{var h,b=Object.values(a).map((function(e){return e.data.subfeatures})).filter((function(e){return!!e})).flat(),v=!1,y=Object(g.a)(b);try{for(y.s();!(h=y.n()).done;){var O=h.value;if(O&&O.uniqueId===p){O.subfeatures||(O.subfeatures=[]),O.subfeatures.push(Object(c.a)(Object(c.a)({},f.data),{},{uniqueId:d})),delete a[d],v=!0;break}O&&O.subfeatures&&b.push.apply(b,Object(o.a)(O.subfeatures))}}catch(w){y.e(w)}finally{y.f()}v||console.error("Could not find parentID ".concat(p))}}}return Object.keys(a).map((function(e){return new q.a(Object(c.a)(Object(c.a)({},a[e].data),{},{uniqueId:e,subfeatures:a[e].data.subfeatures}))}))}},{key:"hasDataForRefName",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:if(!(r=e.sent).length||r.includes(t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(W.BaseFeatureDataAdapter),us=Object(E.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0}),ls=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="RdfPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"SPARQLAdapter",configSchema:us,AdapterClass:ss})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="SPARQLAdapter",o=Object(_e.getFileName)(t);return/\/sparql$/i.test(o)||r===a?{type:a,endpoint:t}:e(t,n,r)}}))}}]),n}(M.a),ds=Object(E.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0}),fs=Object(E.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0});function ps(e){for(var t=e.codonTable,n=e.seq,r=e.frame,a=e.bpPerPx,o=e.region,i=e.height,c=e.y,s=e.reverse,u=void 0!==s&&s,l=e.theme,d=a,f=3-o.start%3,g=(r+f+3)%3,m=n.slice(g),h=[],b=0;b<m.length;b+=3){var v=m.slice(b,b+3),y=u?Object(U.revcom)(v):v,O=t[y]||"";h.push({letter:O,codon:y.toUpperCase()})}var w=1/d*3,j=0===o.start?0:w,k=1/a>=12,x=(o.end-o.start)/a,C=["#d8d8d8","#adadad","#8f8f8f"].reverse();return p.a.createElement(p.a.Fragment,null,h.map((function(e,t){var n=o.reversed?x-(w*(t+1)+g/d-j):w*t+g/d-j,a=e.letter,s=e.codon;return p.a.createElement(p.a.Fragment,{key:"".concat(t,"-").concat(a)},p.a.createElement("rect",{x:n,y:c,width:k?w:w+.7,height:i,stroke:k?"#555":"none",fill:U.defaultStarts.includes(s)?l.palette.startCodon:U.defaultStops.includes(s)?l.palette.stopCodon:C[Math.abs(r)]}),k?p.a.createElement("text",{x:n+w/2,y:c+i/2,dominantBaseline:"middle",textAnchor:"middle"},a):null)})))}function gs(e){var t=e.bpPerPx,n=e.region,r=e.feature,a=e.theme,o=e.height,i=e.seq,c=e.y,s=1/t>=12,l=Object(U.bpSpanPx)(r.get("start"),r.get("end"),n,t),d=Object(u.a)(l,2),f=d[0],g=d[1],m=n.reversed,h=r.get("end")-r.get("start"),b=Math.max((g-f)/h,.8);return p.a.createElement(p.a.Fragment,null,i.split("").map((function(e,t){var n=a.palette.bases[e.toUpperCase()],r=m?g-(t+1)*b:f+t*b;return p.a.createElement(p.a.Fragment,{key:t},p.a.createElement("rect",{x:r,y:c,width:b,height:o,fill:n?n.main:"#aaa",stroke:s?"#555":"none"}),s?p.a.createElement("text",{x:r+b/2,y:c+o/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?Object(Sc.contrastingTextColor)(n.main):"black"},e):null)})))}var ms=function(e){var t=e.regions,n=e.theme,r=e.features,a=void 0===r?new Map:r,i=e.showReverse,c=e.showForward,s=e.showTranslation,l=e.bpPerPx,d=Object(u.a)(t,1)[0],f=Object(ue.createJBrowseTheme)(n),g=Object(U.generateCodonTable)(U.defaultCodonTable),m=Object(o.a)(a.values())[0];if(!m)return null;var h=m.get("seq");if(!h)return null;var b=-20;return p.a.createElement(p.a.Fragment,null,s&&(d.reversed?i:c)?[2,1,0].map((function(e){return p.a.createElement(ps,{key:"translation-".concat(e),seq:h,y:b+=20,codonTable:g,frame:e,bpPerPx:l,region:d,theme:f,height:20,reverse:d.reversed})})):null,c?p.a.createElement(gs,{height:20,y:b+=20,feature:m,region:d,seq:d.reversed?Object(U.complement)(h):h,bpPerPx:l,theme:f}):null,i?p.a.createElement(gs,{height:20,y:b+=20,feature:m,region:d,seq:d.reversed?h:Object(U.complement)(h),bpPerPx:l,theme:f}):null,s&&(d.reversed?c:i)?[0,-1,-2].map((function(e){return p.a.createElement(ps,{key:"rev-translation-".concat(e),seq:h,y:b+=20,codonTable:g,frame:e,bpPerPx:l,region:d,theme:f,height:20,reverse:!d.reversed})})):null)},hs=function(e){var t=e.exportSVG,n=e.width,r=e.totalHeight,a=e.children;return t?p.a.createElement(p.a.Fragment,null,a):p.a.createElement("svg",{"data-testid":"sequence_track",width:n,height:r,style:{width:n,height:r}},a)};var bs=Object(ie.observer)((function(e){var t=e.regions,n=e.bpPerPx,r=Object(u.a)(t,1)[0],a=(r.end-r.start)/n;return p.a.createElement(hs,Object.assign({},e,{totalHeight:200,width:a}),p.a.createElement(ms,e))})),vs=Object(E.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),ys=Object(E.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Os=Object(E.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:vs},{explicitIdentifier:"displayId",explicitlyTyped:!0});var ws=Object(E.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0}),js=function(e){return Object(E.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})},ks=function(e){return{configSchema:e.load(js),getAdapterClass:function(){return n.e(77).then(n.bind(null,1729)).then((function(e){return e.default}))}}};var xs=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(h.a)(n,[{key:"getExpandedRegion",value:function(e){return Object(c.a)(Object(c.a)({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),n}(Re.default),Cs=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="SequencePlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"TwoBitAdapter",configSchema:ws,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return Promise.all([n.e(0),n.e(21),n.e(78)]).then(n.bind(null,1726)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="TwoBitAdapter",o=Object(_e.getFileName)(t),i={type:a,twoBitLocation:t};return/\.2bit$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new y.a({name:"ChromSizesAdapter",configSchema:fs,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return n.e(76).then(n.bind(null,1727)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new y.a({name:"IndexedFastaAdapter",configSchema:ys,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return n.e(25).then(n.bind(null,947)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="IndexedFastaAdapter",o=Object(_e.getFileName)(t),i={type:a,fastaLocation:t,faiLocation:n||Object(_e.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new y.a({name:"BgzipFastaAdapter",configSchema:ds,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return n.e(22).then(n.bind(null,1728)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BgzipFastaAdapter",o=Object(_e.getFileName)(t),i={type:a,faiLocation:Object(_e.makeIndex)(t,".fai"),gziLocation:Object(_e.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new y.a(Object(c.a)({name:"GCContentAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}},e.load(ks)))})),e.addTrackType((function(){var t=function(e){return Object(E.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:b.types.array(e.pluggableConfigSchemaType("display")),metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,o=void 0===a?[]:a;return"placeholderId"!==n.trackId&&(o.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||o.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))),Object(c.a)(Object(c.a)({},n),{},{displays:o})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}(e);return new O.a({name:"ReferenceSequenceTrack",configSchema:t,stateModel:Object(Me.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})})),e.addDisplayType((function(){var e,t=(e=Os,b.types.compose("LinearReferenceSequenceDisplay",He.a,b.types.model({type:b.types.literal("LinearReferenceSequenceDisplay"),configuration:Object(E.ConfigurationReference)(e),showForward:b.types.optional(b.types.boolean,!0),showReverse:b.types.optional(b.types.boolean,!0),showTranslation:b.types.optional(b.types.boolean,!0),height:180})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=e.showForward,r=e.showReverse,a=e.showTranslation;return Object(c.a)(Object(c.a)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer,showForward:n,showReverse:r,showTranslation:a})},regionCannotBeRendered:function(){var t=Object(U.getContainingView)(e);if(t&&t.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation}}})).views((function(e){return{trackMenuItems:function(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){e.toggleShowTranslation()}}]}}})));return{name:"LinearReferenceSequenceDisplay",configSchema:Os,stateModel:t,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:He.b}})),e.addRendererType((function(){return new xs({name:"DivSequenceRenderer",ReactComponent:bs,configSchema:vs,pluginManager:e})}))}}]),r}(M.a),Ss=n(583),Ts=n(25),Es=n.n(Ts);function Ms(e){var t=e.text,n=e.x,r=e.y,a=e.color,o=void 0===a?"black":a,i=e.fontHeight,c=void 0===i?13:i,s=e.featureWidth,u=void 0===s?0:s,l=e.reversed,d=e.allowedWidthExpansion,f=e.fontWidthScaleFactor,g=c*(void 0===f?.6:f),m=u&&d?u+d:1/0,h=Object(U.measureText)(t,c);return p.a.createElement("text",{x:l?n+u-h:n,y:r+c,style:{fontSize:c,fill:o,cursor:"default"}},h>m?"".concat(t.slice(0,m/g),"..."):t)}function Rs(e){var t=e.feature,n=e.rootLayout,r=e.selected,a=e.config,o=e.name,i=e.shouldShowName,c=e.description,s=e.shouldShowDescription,u=e.fontHeight,l=e.allowedWidthExpansion,d=e.reversed,f=n.getSubRecord(String(t.id())),g=f.data.GlyphComponent,m=[p.a.createElement(g,Object.assign({key:"glyph-".concat(t.id())},e,{feature:t,featureLayout:f,selected:r}))];return i&&m.push(p.a.createElement(Ms,{key:"glyph-name-".concat(t.id()),text:o,x:n.getSubRecord("nameLabel").absolute.left,y:n.getSubRecord("nameLabel").absolute.top,color:Object(E.readConfObject)(a,["labels","nameColor"],{feature:t}),fontHeight:u,reversed:d,featureWidth:f.width,allowedWidthExpansion:l})),s&&m.push(p.a.createElement(Ms,{key:"glyph-description-".concat(t.id()),text:c,x:n.getSubRecord("descriptionLabel").absolute.left,y:n.getSubRecord("descriptionLabel").absolute.top,color:Object(E.readConfObject)(a,["labels","descriptionColor"],{feature:t}),fontHeight:u,featureWidth:f.width,reversed:d,allowedWidthExpansion:l})),p.a.createElement("g",null,m)}Rs.defaultProps={reversed:!1,selected:!1,name:"",shouldShowName:!1,description:"",shouldShowDescription:!1,fontHeight:void 0,allowedWidthExpansion:void 0};var Ps=Object(ie.observer)(Rs),As=["rect","region","bpPerPx"],Ns=["displayModel","blockKey","region","bpPerPx","movedDuringLastMouseDown"];function Ls(e){var t=e.rect,n=e.region,r=e.bpPerPx,a=Object(s.a)(e,As);if(!t)return null;var o=Object(u.a)(t,4),i=o[0],c=o[1],l=o[2],d=o[3],f=Object(U.bpSpanPx)(i,l,n,r),g=Object(u.a)(f,2),m=g[0],h=g[1],b=Math.round(c),v=(n.end-n.start)/r,y=Math.round(d-c),O=h-m;if(m+O<0)return null;var w=Math.max(m,0),j=w-m,k=Math.max(1,Math.min(O-j,v));return p.a.createElement("rect",Object.assign({x:w-2,y:b-2,width:k+4,height:y+4},a))}var Is=Object(ie.observer)((function(e){var t,n,r=e.displayModel,a=e.blockKey,o=e.region,i=e.bpPerPx,c=e.movedDuringLastMouseDown,u=Object(s.a)(e,Ns),l=r.selectedFeatureId,d=r.featureIdUnderMouse,f=r.contextMenuFeature,g=d||(null===f||void 0===f?void 0:f.id());function m(e){var t=u.onFeatureMouseOut;if(t&&g)return t(e,g)}function h(e){var t=u.onFeatureMouseOver;if(t&&g)return t(e,g)}return p.a.createElement(p.a.Fragment,null,g?p.a.createElement(Ls,{rect:null===(t=r.getFeatureByID)||void 0===t?void 0:t.call(r,a,g),region:o,bpPerPx:i,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){var t=u.onFeatureMouseDown;if(t&&g)return t(e,g)},onMouseEnter:function(e){var t=u.onFeatureMouseEnter;if(t&&g)return t(e,g)},onMouseOut:m,onMouseOver:h,onMouseUp:function(e){var t=u.onFeatureMouseUp;if(t&&g)return t(e,g)},onMouseLeave:function(e){var t=u.onFeatureMouseLeave;if(t&&g)return t(e,g)},onMouseMove:function(e){var t=u.onFeatureMouseMove;if(t&&g)return t(e,g)},onClick:function(e){if(!c){var t=u.onFeatureClick;if(t&&g)return e.stopPropagation(),t(e,g)}},onContextMenu:function(e){var t=u.onFeatureContextMenu;if(t&&g)return t(e,g)},onFocus:h,onBlur:m,"data-testid":g}):null,l?p.a.createElement(Ls,{rect:null===(n=r.getFeatureByID)||void 0===n?void 0:n.call(r,a,l),region:o,bpPerPx:i,stroke:"#00b8ff",fill:"none"}):null)}));function Fs(e){var t,n=e.feature,r=e.region,a=e.config,o=e.featureLayout,i=e.selected,c=e.bpPerPx,s=(r.end-r.start)/c,u=Object(E.readConfObject)(a,"color1",{feature:n});try{t=Object(Sc.emphasize)(u,.3)}catch(O){t=u}var l=Object(E.readConfObject)(a,"color2",{feature:n}),d=o.absolute,f=d.left,g=d.top,m=d.width,h=d.height;if(f+m<0)return null;var b=Math.max(f,0),v=b-f,y=Math.max(1,Math.min(m-v,s));return p.a.createElement("rect",{"data-testid":"box-".concat(n.id()),x:b,y:g,width:y,height:h,fill:i?t:u,stroke:i?l:void 0})}Fs.defaultProps={selected:!1};var Ds=Object(ie.observer)(Fs);function Bs(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.config,o=e.featureLayout,i=e.selected,c=e.reversed,s=(r.end-r.start)/n,u=Math.max(o.absolute.width,1),l=o.absolute.left,d=o.absolute,f=d.top,g=d.height;Zs(t)&&(f+=.175*g,g*=.65);var m,h=t.get("strand")*(c?-1:1),b=Zs(t)?Object(E.readConfObject)(a,"color3",{feature:t}):Object(E.readConfObject)(a,"color1",{feature:t});try{m=Object(Sc.emphasize)(b,.3)}catch(j){m=b}var v=Object(E.readConfObject)(a,"color2",{feature:t});if(l+u<0)return null;var y=Math.max(l,0),O=y-l,w=Math.max(1,Math.min(u-O,s));return p.a.createElement(p.a.Fragment,null,p.a.createElement("rect",{"data-testid":t.id(),stroke:i?v:void 0,fill:i?m:b,x:y,y:f,width:w,height:g}),h<0&&0===O?p.a.createElement("polygon",{stroke:i?v:void 0,fill:i?m:b,points:[[l,f],[l-g/2,f+g/2],[l,f+g]]}):null,h>0&&y+w<s?p.a.createElement("polygon",{stroke:i?v:void 0,fill:i?m:b,points:[[y+w,f],[y+w+g/2,f+g/2],[y+w,f+g]]}):null)}Bs.defaultProps={selected:!1,reversed:!1};var Vs=Object(ie.observer)(Bs);function zs(e){var t,n=e.feature,r=e.featureLayout,a=e.selected,o=e.config,i=e.reversed,c=e.subfeatures||n.get("subfeatures"),s=Object(E.readConfObject)(o,"color2",{feature:n});try{t=Object(Sc.emphasize)(s,.3)}catch(b){t=s}var u=r.absolute,l=u.left,d=u.top,f=u.width,g=u.height,m=[[l,d+g/2],[l+f,d+g/2]],h=n.get("strand");return h&&m.push([l+f-g/4,d+g/4],[l+f-g/4,d+g/4*3],[l+f,d+g/2]),p.a.createElement(p.a.Fragment,null,p.a.createElement("polyline",{"data-testid":n.id(),transform:h&&(!i&&h<0||i&&h>0)?"rotate(180,".concat(l+f/2,",").concat(d+g/2,")"):void 0,points:m,stroke:a?t:s}),c.map((function(t){var n=String(t.id()),o=r.getSubRecord(n);if(!o)return null;var i=o.data.GlyphComponent;return p.a.createElement(i,Object.assign({key:"glyph-".concat(n)},e,{feature:t,featureLayout:o,selected:a}))})))}zs.defaultProps={selected:!1,reversed:!1};var Ws=Object(ie.observer)(zs);function Us(e){var t=_s(e.feature,e.config);return p.a.createElement(Ws,Object.assign({},e,{subfeatures:t}))}function qs(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=Object(E.readConfObject)(t,e);if("string"==typeof n&&(n=n.split(/\s*,\s*/)),Array.isArray(n)){var r=n.map((function(e){return e.toLowerCase()}));return function(e){return r.includes(e.get("type").toLowerCase())}}return"function"===typeof n?n:function(){return!0}}("subParts",t)(e)}function Hs(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function _s(e,t){var n=e.get("subfeatures");if(!n||!n.length)return[];var r=!!n.find((function(e){return Hs(e)})),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||Object(E.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){for(var n,r,a=Object(o.a)(t),i=1/0,c=-1/0,s=[],u=0;u<a.length;u++){var l=a[u].get("type");/^cds/i.test(l)?(i>a[u].get("start")&&(i=a[u].get("start")),c<a[u].get("end")&&(c=a[u].get("end"))):/exon/i.test(l)?s.push(a[u]):Hs(a[u])&&(n=a[u].get("start")===e.get("start"),r=a[u].get("end")===e.get("end"))}if(!(s.length&&i<1/0&&c>-1/0))return a;s.sort((function(e,t){return e.get("start")-t.get("start")}));var d,f,p=e.get("strand");if(!n)for(var g=0;g<s.length&&!((d=s[g].get("start"))>=i);g++){f=i>s[g].get("end")?s[g].get("end"):i;var m=p>=0?"five_prime_UTR":"three_prime_UTR";a.unshift(new q.a({parent:e,id:"".concat(e.id(),"_").concat(m,"_").concat(g),data:{start:d,end:f,strand:p,type:m}}))}if(!r)for(var h=s.length-1;h>=0&&!((f=s[h].get("end"))<=c);h--){d=c<s[h].get("start")?s[h].get("start"):c;var b=p>=0?"three_prime_UTR":"five_prime_UTR";a.push(new q.a({parent:e,id:"".concat(e.id(),"_").concat(b,"_").concat(h),data:{start:d,end:f,strand:p,type:b}}))}return a}(e,n)),n.filter((function(e){return qs(e,t)}))}Us.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,o=e.config,i=e.extraGlyphs,c=Ks({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i});return $s({layout:c,subfeatures:_s(n,o),bpPerPx:r,reversed:a,config:o,extraGlyphs:i}),c};var Gs=Object(ie.observer)(Us);function Js(e){var t=e.feature,n=e.featureLayout,r=e.selected;return p.a.createElement(p.a.Fragment,null,t.get("subfeatures").map((function(t){var a=String(t.id()),o=n.getSubRecord(a),i=o.data.GlyphComponent;return p.a.createElement(i,Object.assign({key:"glyph-".concat(a)},e,{feature:t,featureLayout:o,selected:r}))})))}Js.defaultProps={selected:!1,reversed:!1},Js.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,o=e.config,i=e.extraGlyphs,c=Ks({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}),s=Object(E.readConfObject)(o,"displayMode");if("reducedRepresentation"!==s){var u=n.get("subfeatures")||[],l=0;u.forEach((function(e){var t=Ys(e,i),n=Object(E.readConfObject)(o,"height",{feature:e});(t.layOut||Qs)({layout:c,feature:e,bpPerPx:r,reversed:a,config:o,extraGlyphs:i}).move(0,l),l+="collapse"===s?0:("compact"===s?n/3:n)+2}))}return c};var Xs=Object(ie.observer)(Js);function Ys(e,t){var n=e.get("type"),r=e.get("strand"),a=e.get("subfeatures");if(a){if(a.find((function(e){return!!e.get("subfeatures")})))return Xs;return["mRNA","transcript"].includes(n)&&a.find((function(e){return"CDS"===e.get("type")}))?Gs:Ws}if(t){var o,i=Object(g.a)(t);try{for(i.s();!(o=i.n()).done;){var c=o.value;if(!0===c.validator(e))return c.glyph}}catch(s){i.e(s)}finally{i.f()}}return[1,-1].includes(r)?Vs:Ds}function Qs(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,o=e.config,i=e.extraGlyphs,c=Object(E.readConfObject)(o,"displayMode"),s=Ks({layout:t,feature:n,bpPerPx:r,reversed:a,config:o,extraGlyphs:i});return"reducedRepresentation"!==c&&$s({layout:s,subfeatures:n.get("subfeatures")||[],bpPerPx:r,reversed:a,config:o,extraGlyphs:i}),s}function Ks(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,o=e.config,i=e.extraGlyphs,c=Object(E.readConfObject)(o,"displayMode"),s="reducedRepresentation"===c?Vs:Ys(n,i),u=n.parent(),l=0;u&&(l=a?(u.get("end")-n.get("end"))/r:(n.get("start")-u.get("start"))/r);var d=Object(E.readConfObject)(o,"height",{feature:n}),f=(n.get("end")-n.get("start"))/r,p=t.parent,g=p?p.top:0;return t.addChild(String(n.id()),l,"collapse"===c?0:g,f,"compact"===c?d/2:d,{GlyphComponent:s})}function $s(e){var t=e.layout,n=e.subfeatures,r=e.bpPerPx,a=e.reversed,o=e.config,i=e.extraGlyphs;n.forEach((function(e){(Ys(e,i).layOut||Qs)({layout:t,feature:e,bpPerPx:r,reversed:a,config:o,extraGlyphs:i})}))}function Zs(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}var eu={position:"relative"};function tu(e){var t,n,r,a,o,i,c=e.feature,s=e.bpPerPx,u=e.region,l=e.config,d=e.displayMode,f=e.layout,g=e.extraGlyphs,m=u.reversed,h=c.get(m?"end":"start"),b=Object(U.bpToPx)(h,u,s),v="compact"!==d&&"collapsed"!==d,y=new Ss.a("root",0,0,0,0),O=(Ys(c,g).layOut||Qs)({layout:y,feature:c,bpPerPx:s,reversed:m,config:l,extraGlyphs:g});if(v){var w=Object(E.readConfObject)(l,"showLabels"),j=Object(E.readConfObject)(l,"showDescriptions");o=Object(E.readConfObject)(l,["labels","fontSize"],{feature:c}),i=Object(E.readConfObject)(l,"maxFeatureGlyphExpansion")||0,r=Object(E.readConfObject)(l,["labels","name"],{feature:c})||"",t=/\S/.test(r)&&w,a=Object(E.readConfObject)(l,["labels","description"],{feature:c})||"",n=/\S/.test(a)&&w&&j;var k=0;t&&(k=Math.round(Math.min(Object(U.measureText)(r,o),y.width+i))+2,y.addChild("nameLabel",0,O.bottom+2,k,o));var x=0;if(n){var C=t?y.getSubRecord("nameLabel"):O;x=Math.round(Math.min(Object(U.measureText)(a,o),y.width+i))+2,y.addChild("descriptionLabel",0,C.bottom+2,x,o)}}var S=f.addRect(c.id(),c.get("start"),c.get("start")+y.width*s,y.height);return null===S?null:(y.move(b,S),p.a.createElement(Ps,Object.assign({key:"svg-feature-".concat(c.id()),feature:c,layout:f,rootLayout:y,bpPerPx:s,config:l,name:String(r),shouldShowName:t,description:String(a),shouldShowDescription:n,fontHeight:o,allowedWidthExpansion:i,reversed:u.reversed},e)))}var nu=Object(ie.observer)((function(e){var t,n=e.features,r=e.isFeatureDisplayed,a=[],o=Object(g.a)(n.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;r(i)&&a.push(p.a.createElement(tu,Object.assign({key:i.id(),feature:i},e)))}}catch(c){o.e(c)}finally{o.f()}return p.a.createElement(p.a.Fragment,null,a)}));function ru(e){var t=e.layout,n=e.blockKey,r=e.regions,a=e.bpPerPx,o=e.features,i=e.config,c=e.displayModel,s=e.exportSVG,l=e.featureDisplayHandler,d=r||[],g=Object(u.a)(d,1)[0],m=(g.end-g.start)/a,h=Object(E.readConfObject)(i,"displayMode"),b=Object(f.useRef)(),v=Object(f.useState)(!1),y=Object(u.a)(v,2),O=y[0],w=y[1],j=Object(f.useState)(!1),k=Object(u.a)(j,2),x=k[0],C=k[1],S=Object(f.useState)(0),T=Object(u.a)(S,2),M=T[0],R=T[1],P=e.onMouseOut,A=e.onMouseDown,N=e.onMouseLeave,L=e.onMouseEnter,I=e.onMouseOver,F=e.onMouseMove,D=e.onMouseUp,B=e.onClick,V=Object(f.useCallback)((function(e){w(!0),C(!1);if(A)return A(e)}),[A]),z=Object(f.useCallback)((function(e){w(!1);if(D)return D(e)}),[D]),W=Object(f.useCallback)((function(e){if(L)return L(e)}),[L]),U=Object(f.useCallback)((function(e){if(N)return N(e)}),[N]),q=Object(f.useCallback)((function(e){if(I)return I(e)}),[I]),H=Object(f.useCallback)((function(e){if(P)return P(e)}),[P]),_=Object(f.useCallback)((function(e){O&&C(!0);var t=0,r=0;b.current&&(t=b.current.getBoundingClientRect().left,r=b.current.getBoundingClientRect().top),t=e.clientX-t,r=e.clientY-r;var o=g.reversed?m-t:t,i=g.start+a*o,s=c.getFeatureOverlapping(n,i,r);F&&F(e,s)}),[n,a,O,F,g.reversed,g.start,c,m]),G=Object(f.useCallback)((function(e){x||B&&B(e)}),[x,B]);return Object(f.useEffect)((function(){R(t.getTotalHeight())}),[t]),s?p.a.createElement(nu,Object.assign({features:o,displayMode:h,isFeatureDisplayed:l},e,{region:g})):p.a.createElement("div",{style:eu},p.a.createElement("svg",{ref:b,className:"SvgFeatureRendering","data-testid":"svgfeatures",width:m,height:M+100,onMouseDown:V,onMouseUp:z,onMouseEnter:W,onMouseLeave:U,onMouseOver:q,onMouseOut:H,onMouseMove:_,onFocus:W,onBlur:U,onClick:G,style:{display:"block"}},p.a.createElement(nu,Object.assign({features:o,displayMode:h},e,{region:g,movedDuringLastMouseDown:x,isFeatureDisplayed:l})),p.a.createElement(Is,Object.assign({},e,{region:g}))))}nu.propTypes={features:Es.a.oneOfType([Es.a.instanceOf(Map),Es.a.arrayOf(Es.a.shape())]),layout:Es.a.shape({addRect:Es.a.func.isRequired,getTotalHeight:Es.a.func.isRequired}).isRequired,extraGlyphs:Es.a.arrayOf(Es.a.shape({glyph:Es.a.elementType.isRequired,validator:Es.a.func.isRequired})),isFeatureDisplayed:Es.a.func},nu.defaultProps={features:[],extraGlyphs:[],isFeatureDisplayed:function(){return!0}},ru.defaultProps={displayModel:{},exportSVG:void 0,features:new Map,blockKey:void 0,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onMouseMove:void 0,onClick:void 0,onContextMenu:void 0,onFeatureClick:void 0,onFeatureContextMenu:void 0,extraGlyphs:[],featureDisplayHandler:function(){return!0}};var au=Object(ie.observer)(ru),ou=Object(E.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"black",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:Object(E.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"black",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:b.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0}),iu=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(h.a)(n)}(xt.default),cu=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="SVGPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new iu({name:"SvgFeatureRenderer",ReactComponent:au,configSchema:ou,pluginManager:e})}))}}]),n}(M.a),su=Object(E.ConfigurationSchema)("TheTrackHubRegistryConnection",{trackDbId:{type:"string",defaultValue:"",description:"id of the trackDb in The Track Hub Registry"}},{baseConfiguration:Me.baseConnectionConfig});function uu(e,t,n){var r=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.members)return Object.values(t.members).map((function(r){return e(r,t.shortLabel?n.concat([t.shortLabel]):n)})).flat();return t.categories=n,[t]}({members:e._source.configuration});return r.map((function(r){var a=function(e,t,n){var r=e.type.split(" ")[0].toLowerCase();"bam"===r&&e.bigDataUrl.toLowerCase().endsWith("cram")&&(r="cram");var a,o=e.bigDataUrl,i={uri:new URL(o,t).href,locationType:"UriLocation"},c=e.categories;switch(r){case"bam":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href,locationType:"UriLocation"}:e.bigDataIndex?{localPath:e.bigDataIndex,locationType:"LocalPathLocation"}:{localPath:"".concat(e.bigDataUrl,".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BamAdapter",bamLocation:i,index:{location:a}}};case"bed":case"bed5floatscore":case"bedgraph":case"bedrnaelements":case"bigbarchart":case"bigchain":case"biginteract":case"bigmaf":case"bigpsl":case"broadpeak":case"coloredexon":case"gvf":case"ld2":case"narrowpeak":case"peptidemapping":case"vcftabix":case"wig":case"wigmaf":return Object(_e.generateUnsupportedTrackConf)(e.shortLabel,r,c);case"bigbed":return{type:"FeatureTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigBedAdapter",bigBedLocation:i}};case"bigwig":return{type:"QuantitativeTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"BigWigAdapter",bigWigLocation:i}};case"cram":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href,locationType:"UriLocation"}:e.bigDataIndex?{localPath:e.bigDataIndex,locationType:"LocalPathLocation"}:{localPath:"".concat(e.bigDataUrl,".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:c,adapter:{type:"CramAdapter",bamLocation:i,index:{location:a},sequenceAdapter:n}};default:throw new Error("Unsupported track type: ".concat(r))}}(r,e._source.hub.url,n);return a.trackId="trackhub-registry-".concat(Object(U.objectHash)(a)),a.assemblyNames=[t],a}))}var lu=function(e){return b.types.compose("TheTrackHubRegistryConnection",Object(Me.BaseConnectionModelFactory)(e),b.types.model({type:b.types.literal("TheTrackHubRegistryConnection"),configuration:Object(E.ConfigurationReference)(su)}).actions((function(e){return{connect:function(t){e.clear();var n=Object(E.readConfObject)(t,"trackDbId");fetch("https://www.trackhubregistry.org/api/search/trackdb/".concat(n)).then((function(e){return e.json()})).then((function(t){var n=t._source.assembly.name,r=Object(U.getSession)(e).assemblyManager.get(n).configuration,a=Object(E.readConfObject)(r,["sequence","adapter"]);e.setTrackConfs(uu(t,n,a))})).catch((function(e){console.error(e)}))}}})))},du=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="TrackHubRegistryPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addConnectionType((function(){return new x.a({name:"TheTrackHubRegistryConnection",configSchema:su,configEditorComponent:Object(f.lazy)((function(){return Promise.all([n.e(1),n.e(34)]).then(n.bind(null,1756))})),stateModel:lu(e),displayName:"The Track Hub Registry",description:"A hub from The Track Hub Registry",url:"//trackhubregistry.org/"})}))}}]),r}(M.a),fu=n(952),pu=n(1360),gu=n.n(pu),mu=n(1359),hu=n.n(mu),bu=n(429),vu=n(348),yu=n.n(vu);function Ou(e,t){var n=t.DataCellReactComponent,r=void 0===n?null:n,a=t.FilterModelType,o=void 0===a?null:a,i=t.compare,c=t.displayName,s=void 0===c?void 0:c,u=t.categoryName,l=void 0===u?void 0:u;return b.types.model("ColumnDataType".concat(e),{type:b.types.literal(e)}).volatile((function(){return{DataCellReactComponent:r,FilterModelType:o,displayName:s||e,categoryName:l}})).views((function(){return{compare:i,get hasFilter(){return!!o}}}))}var wu=n(204),ju=n(1757),ku=n(1633),xu=n(1685),Cu=Object(Xe.a)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),Su=Object(ie.observer)((function(e){var t=e.filterModel,n=Cu(),r=Object(wu.getEnumerationValues)(Object(wu.getSubType)(Object(wu.getPropertyType)(Object(b.getType)(t),"operation")));return p.a.createElement(p.a.Fragment,null,p.a.createElement(ju.a,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return p.a.createElement(ku.a,{key:e,value:e},e)})))," ",p.a.createElement(zn.a,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:function(e){return t.setLocString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:p.a.createElement(xu.a,{className:n.textFilterControlAdornment,position:"end"},p.a.createElement(Er.a,{"aria-label":"clear filter",onClick:function(){return t.setLocString("")},color:"secondary"},p.a.createElement(yu.a,null)))}}))})),Tu=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],Eu={"overlaps with":function(e,t){return e.refName===t.refName&&Object(Ct.a)(e.start,e.end,t.start,t.end)},"contained within":function(e,t){return e.refName===t.refName&&Object(Ct.c)(e.start,e.end,t.start,t.end)},"fully contains":function(e,t){return e.refName===t.refName&&Object(Ct.c)(t.start,t.end,e.start,e.end)},"does not overlap":function(e,t){return!Eu["overlaps with"](e,t)},"not contained within":function(e,t){return!Eu["contained within"](e,t)},"does not contain":function(e,t){return!Eu["fully contains"](e,t)}},Mu=b.types.model("ColumnLocStringFilter",{type:b.types.literal("LocString"),columnNumber:b.types.integer,locString:"",operation:b.types.optional(b.types.enumeration(Tu),Tu[0])}).views((function(e){return{get locStringIsInvalid(){if(e.locString){var t=e.parsedLocString;return!t||""===t.refName||"number"!==typeof t.start||"number"!==typeof t.end||t.start>t.end}return!1},get parsedLocString(){var t=Object(U.getSession)(e),n=Object(b.getParent)(e,3).spreadsheet.assemblyName;try{return Object(U.parseLocString)(e.locString,(function(e){return t.assemblyManager.isValidRefName(e,n)}))}catch(r){return}},get predicate(){if(!e.locString||e.locStringIsInvalid)return function(){return!0};var t=e.parsedLocString,n=e.operation,r=e.columnNumber;return function(e,a){var o=a.cellsWithDerived[r];if(!o||!o.text||!o.extendedData)return!1;var i=o.extendedData;if(!i.refName)return!1;var c=Eu[n];if(!c)throw new Error('"'.concat(n,'" not implemented in location filter'));return c(i,t)}}}})).actions((function(e){return{setLocString:function(t){e.locString=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:Su}}));function Ru(){return(Ru=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,f,p,g,m,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(U.getSession)(t),o=a.assemblyManager,i=t.assemblyName,c=Object(b.getParent)(t),s=c.id,e.next=6,o.waitForAssembly(i);case 6:if(u=e.sent,e.prev=7,l=Object(U.parseLocString)(r.text,(function(e){return o.isValidRefName(e,t.assemblyName)})),f=l.refName,p=u.getCanonicalRefName(f),g=u.regions.find((function(e){return e.refName===p})),m="".concat(s,"_").concat(i),h=a.views.find((function(e){return e.id===m}))){e.next=19;break}return h=a.addView("LinearGenomeView",{displayName:i,id:m}),e.next=18,Object(U.when)((function(){return h.initialized}));case 18:h.setDisplayedRegions([JSON.parse(JSON.stringify(g))]);case 19:h.navToLocString(r.text),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),a.notify("".concat(e.t0),"error");case 25:case"end":return e.stop()}}),e,null,[[7,22]])})))).apply(this,arguments)}var Pu=Object(ie.observer)((function(e){var t=e.cell,n=e.columnNumber,r=e.spreadsheet;return p.a.createElement("a",{onClick:function(e){e.preventDefault(),function(e,t,n){Ru.apply(this,arguments)}(r,n,t)},title:"open a new linear genome view here",href:"#link"},t.text)})),Au=Ou("LocString",{categoryName:"Location",displayName:"Full location",compare:function(e,t){return Object(U.compareLocs)(e.extendedData,t.extendedData)},FilterModelType:Mu,DataCellReactComponent:Pu}),Nu=["equals","contains","does not contain","does not equal","starts with","ends with"],Lu={contains:function(e,t){return-1!==e.toLowerCase().indexOf(t)},equals:function(e,t){return e.toLowerCase()===t},"starts with":function(e,t){return 0===e.toLowerCase().indexOf(t)},"ends with":function(e,t){var n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":function(e,t){return!Lu.contains(e,t)},"does not equal":function(e,t){return!Lu.equals(e,t)}},Iu=Object(Xe.a)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),Fu=Object(ie.observer)((function(e){var t=e.filterModel,n=Iu(),r=Object(wu.getEnumerationValues)(Object(wu.getSubType)(Object(wu.getPropertyType)(Object(b.getType)(t),"operation")));return p.a.createElement(p.a.Fragment,null,p.a.createElement(ju.a,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return p.a.createElement(ku.a,{key:e,value:e},e)})))," ",p.a.createElement(zn.a,{label:"text",value:t.stringToFind,onChange:function(e){return t.setString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:p.a.createElement(xu.a,{className:n.textFilterControlAdornment,position:"end"},p.a.createElement(Er.a,{"aria-label":"clear filter",onClick:function(){return t.setString("")},color:"secondary"},p.a.createElement(yu.a,null)))}}))})),Du=b.types.model("ColumnTextFilter",{type:b.types.literal("Text"),columnNumber:b.types.integer,stringToFind:"",operation:b.types.optional(b.types.enumeration(Nu),Nu[0])}).views((function(e){return{get predicate(){var t=e.stringToFind,n=e.columnNumber,r=e.operation;if(!t)return function(){return!0};var a=t.toLowerCase();return function(e,t){var o=t.cellsWithDerived[n];if(!o||!o.text)return!1;var i=Lu[r];if(!i)throw new Error('"'.concat(r,'" not implemented in location filter'));return i(o.text,a)}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:Fu}})),Bu=Ou("Text",{compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:Du}),Vu=Ou("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:b.types.compose(Du,b.types.model({type:b.types.literal("LocRef")}))}),zu=["equals","greater than","less than","between","not between"],Wu={equals:function(e,t){return e===t},"greater than":function(e,t){return e>t},"less than":function(e,t){return e<t},between:function(e,t,n){return e>t&&e<n},"not between":function(e,t,n){return!Wu.between(e,t,n)}},Uu=Object(Xe.a)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),qu=Object(ie.observer)((function(e){var t=e.filterModel,n=Uu(),r=zu;return p.a.createElement(p.a.Fragment,null,p.a.createElement(ju.a,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))}},r.map((function(e){return p.a.createElement(ku.a,{key:e,value:e},e)})))," ",p.a.createElement(zn.a,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:function(e){t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:p.a.createElement(p.a.Fragment,null," and ",p.a.createElement(zn.a,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:function(e){return t.setSecondNumber(parseFloat(e.target.value))},className:n.textFilterControl})))})),Hu=b.types.model("ColumnNumberFilter",{type:b.types.literal("Number"),columnNumber:b.types.integer,firstNumber:b.types.maybe(b.types.number),secondNumber:b.types.maybe(b.types.number),operation:b.types.optional(b.types.enumeration(zu),zu[0])}).views((function(e){return{get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};var t=e.firstNumber,n=e.secondNumber,r=e.operation,a=e.columnNumber;return function(e,o){var i=o.cellsWithDerived[a];if(!i||!i.text)return!1;var c=parseFloat(i.text);if("number"!==typeof c)return!1;var s=Wu[r];if(!s)throw new Error('"'.concat(r,'" not implemented in location filter'));return s(c,t,n)}}}})).actions((function(e){return{setFirstNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.firstNumber=void 0:e.firstNumber=t},setSecondNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.secondNumber=void 0:e.secondNumber=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:qu}})),_u={Number:Ou("Number",{compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:Hu}),Text:Bu,LocString:Au,LocRef:Vu,LocStart:Ou("LocStart",{categoryName:"Location",displayName:"Start",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:b.types.compose(Hu,b.types.model({type:b.types.literal("LocStart")}))}),LocEnd:Ou("LocEnd",{categoryName:"Location",displayName:"End",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:b.types.compose(Hu,b.types.model({type:b.types.literal("LocEnd")}))})},Gu=Object.values(_u),Ju=b.types.union.apply(b.types,Object(o.a)(Gu)),Xu=b.types.union.apply(b.types,Object(o.a)(Gu.map((function(e){return e.create({type:e.properties.type.value}).FilterModelType})).filter((function(e){return!!e})))),Yu=b.types.model("SpreadsheetCell",{text:b.types.string,extendedData:b.types.maybe(b.types.frozen())}),Qu=b.types.model("SpreadsheetRow",{id:b.types.identifier,cells:b.types.array(Yu),extendedData:b.types.maybe(b.types.frozen()),isSelected:!1}).actions((function(e){return{toggleSelect:function(){e.isSelected=!e.isSelected},unSelect:function(){e.isSelected=!1},select:function(){e.isSelected=!0},setExtendedData:function(t){e.extendedData=t}}})).views((function(e){return{get cellsWithDerived(){var t=Object(b.getParent)(e,3).columns,n=0;return t.map((function(t){return t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]}))}}})),Ku=b.types.model("StaticRowSet",{isLoaded:b.types.literal(!0),rows:b.types.array(Qu)}).views((function(e){return{get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){var t=Object(b.getParent)(e);return e.rows.slice().sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((function(e){return e.isSelected}))},get selectedFilteredRows(){var t=Object(b.getParent)(e),n=Object(b.getParent)(t).filterControls;return this.selectedRows.filter((function(e){return n.rowPassesFilters(t,e)}))},get sortedFilteredRows(){var t=Object(b.getParent)(e),n=Object(b.getParent)(t).filterControls;return e.rows.filter((function(e){return n.rowPassesFilters(t,e)})).sort(t.rowSortingComparisonFunction)}}})).actions((function(e){return{unselectAll:function(){e.rows.forEach((function(e){return e.unSelect()}))}}})),$u=b.types.model("ColumnDefinition",{name:b.types.maybe(b.types.string),dataType:b.types.optional(Ju,(function(){return{type:"Text"}})),isDerived:!1,derivationFunctionText:b.types.maybe(b.types.string)}).views((function(e){return{get expr(){if(e.isDerived)return Object(bu.a)(String(e.derivationFunctionText),Object(b.getEnv)(e).pluginManager.jexl)}}})),Zu=b.types.model("Spreadsheet",{rowSet:b.types.optional(Ku,(function(){return Ku.create()})),columns:b.types.array($u),columnDisplayOrder:b.types.array(b.types.number),hasColumnNames:!1,sortColumns:b.types.array(b.types.model("SortColumns",{columnNumber:b.types.number,descending:!1}).actions((function(e){return{switchDirection:function(){e.descending=!e.descending}}}))),assemblyName:b.types.maybe(b.types.string)}).volatile((function(){return{defaultDataType:_u.Text,rowMenuPosition:null,isLoaded:!1}})).views((function(e){return{get initialized(){var t,n=Object(U.getSession)(e),r=e.assemblyName;return!!r&&(null===(t=n.assemblyManager.get(r))||void 0===t?void 0:t.initialized)},get hideRowSelection(){return Object(b.getParent)(e).hideRowSelection},get dataTypeChoices(){return Object.keys(_u).map((function(e){var t=_u[e].create({type:e});return{typeName:e,displayName:t.displayName,categoryName:t.categoryName}}))},rowSortingComparisonFunction:function(t,n){for(var r=0;r<e.sortColumns.length;r+=1){var a=e.sortColumns[r],o=a.columnNumber,i=a.descending,c=e.columns[o].dataType.compare(t.cellsWithDerived[o],n.cellsWithDerived[o]);if(c)return i?-c:c}return 0}}})).actions((function(e){return{afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function n(){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(U.getSession)(e),a=r.assemblyManager,n.prev=2,!e.assemblyName){n.next=7;break}return n.next=6,a.waitForAssembly(e.assemblyName);case 6:t.setLoaded(!0);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),r.notify("failed to load assembly ".concat(e.assemblyName," ").concat(n.t0),"error");case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))))},setLoaded:function(t){e.isLoaded=t},setRowMenuPosition:function(t){e.rowMenuPosition=t},setSortColumns:function(t){t&&(e.sortColumns=t)},setColumnType:function(t,n){e.columns[t].dataType={type:n}},unselectAll:function(){return e.rowSet.unselectAll()}}})),el=3e7,tl=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],nl={CSV:function(){return n.e(10).then(n.bind(null,296)).then((function(e){return e.parseCsvBuffer}))},TSV:function(){return n.e(10).then(n.bind(null,296)).then((function(e){return e.parseTsvBuffer}))},VCF:function(){return n.e(42).then(n.bind(null,1732)).then((function(e){return e.parseVcfBuffer}))},BED:function(){return n.e(9).then(n.bind(null,1733)).then((function(e){return e.parseBedBuffer}))},BEDPE:function(){return n.e(9).then(n.bind(null,1733)).then((function(e){return e.parseBedPEBuffer}))},"STAR-Fusion":function(){return n.e(41).then(n.bind(null,1734)).then((function(e){return e.parseSTARFusionBuffer}))}},rl=new RegExp("\\.(".concat(tl.join("|"),")(\\.gz)?$"),"i"),al=b.types.model("SpreadsheetImportWizard",{fileType:b.types.optional(b.types.enumeration(tl),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:b.types.maybe(b.types.string)}).volatile((function(){return{fileTypes:tl,fileSource:void 0,error:void 0,loading:!1}})).views((function(e){return{get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return Object(b.getParent)(e).readyToDisplay},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName:function(t,n){return Object(U.getSession)(e).assemblyManager.isValidRefName(t,n)}}})).actions((function(e){return{setSelectedAssemblyName:function(t){e.selectedAssemblyName=t},setFileSource:function(t){if(e.fileSource=t,e.error=void 0,e.fileSource){var n=e.fileName;if(n){var r=rl.exec(n);r&&r[1]&&("tsv"===r[1]&&n.includes("star-fusion")?e.fileType="STAR-Fusion":e.fileType=r[1].toUpperCase())}}},toggleHasColumnNameLine:function(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber:function(t){t>0&&(e.columnNameLineNumber=t)},setFileType:function(t){e.fileType=t},setError:function(t){console.error(t),e.loading=!1,e.error=t},setLoaded:function(){e.loading=!1,e.error=void 0},cancelButton:function(){e.error=void 0,Object(b.getParent)(e).setDisplayMode()},import:function(t){var r=this;return Object(i.a)(d.a.mark((function a(){var o,i,c,s,u,l,f;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.fileSource){a.next=2;break}return a.abrupt("return");case 2:if(!e.loading){a.next=4;break}throw new Error("Cannot import, load already in progress");case 4:return e.selectedAssemblyName=t,e.loading=!0,o=e.fileType,a.next=9,nl[o]();case 9:if(i=a.sent){a.next=12;break}throw new Error("cannot open files of type '".concat(e.fileType,"'"));case 12:return a.next=14,Promise.resolve().then(n.bind(null,152));case 14:return c=a.sent,s=c.unzip,u=Object(b.getEnv)(e),l=u.pluginManager,f=Object($.openLocation)(e.fileSource,l),a.prev=18,a.next=21,f.stat();case 21:if(!(a.sent.size>el)){a.next=24;break}throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."));case 24:a.next=29;break;case 26:a.prev=26,a.t0=a.catch(18),console.warn(a.t0);case 29:return a.next=31,f.readFile().then((function(t){return e.requiresUnzip?s(t):t})).then((function(t){return i(t,e)})).then((function(t){r.setLoaded(),Object(b.getParent)(e).displaySpreadsheet(t)}));case 31:case"end":return a.stop()}}),a,null,[[18,26]])})))()}}})),ol=b.types.model("RowFullTextFilter",{type:b.types.literal("RowFullText"),stringToFind:""}).views((function(e){return{get predicate(){var t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){for(var r=n.cellsWithDerived,a=0;a<r.length;a+=1){var o=r[a];if(o.text&&o.text.toLowerCase().includes(t))return!0}return!1}):function(){return!0}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},clear:function(){e.stringToFind=""}}})),il=b.types.model("SpreadsheetFilterControls",{rowFullText:b.types.optional(ol,(function(){return{type:"RowFullText",stringToFind:""}})),columnFilters:b.types.array(Xu)}).views((function(e){return{get filters(){return[e.rowFullText].concat(Object(o.a)(e.columnFilters)).filter((function(e){return!!e}))},setRowFullTextFilter:function(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters:function(e,t){for(var n=0;n<this.filters.length;n+=1)if(!this.filters[n].predicate(e,t))return!1;return!0}}})).actions((function(e){return{addBlankColumnFilter:function(t){var n=Object(b.getParent)(e).spreadsheet.columns[t].dataType;e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:function(t){return e.columnFilters.remove(t)},clearAllFilters:function(){e.columnFilters.clear(),e.rowFullText.clear()}}})),cl=[{label:"Toggle select",icon:hu.a,onClick:function(e,t){var n,r=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==r&&t.rowSet.rows[r-1].toggleSelect()}}],sl=b.types.model("SpreadsheetView",{type:b.types.literal("SpreadsheetView"),offsetPx:0,height:b.types.optional(b.types.refinement("SpreadsheetViewHeight",b.types.number,(function(e){return e>=40})),440),hideViewControls:!1,hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:b.types.optional(il,(function(){return il.create({})})),mode:b.types.optional(b.types.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:b.types.optional(al,(function(){return al.create()})),spreadsheet:b.types.maybe(Zu)}).volatile((function(){return{width:400,rowMenuItems:cl}})).views((function(e){return{get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!Object(b.getEnv)(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){var t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){var t,n=null===(t=e.spreadsheet)||void 0===t?void 0:t.assemblyName;if(n){var r=Object(U.getSession)(e).assemblies;return null===r||void 0===r?void 0:r.find((function(e){return Object(E.readConfObject)(e,"name")===n}))}}}})).actions((function(e){return{setRowMenuItems:function(t){e.rowMenuItems=t},setWidth:function(t){return e.width=t,e.width},setHeight:function(t){return e.height=t>40?t:40,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},resizeWidth:function(t){var n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet:function(t){e.filterControls.clearAllFilters(),e.spreadsheet=Object(b.cast)(t),e.mode="display"},setImportMode:function(){e.mode="import"},setDisplayMode:function(){e.readyToDisplay&&(e.mode="display")},closeView:function(){Object(b.getParent)(e,2).removeView(e)}}})),ul=b.types.compose(Me.BaseViewModel,sl),ll=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="SpreadsheetViewPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addViewType((function(){return new j.a({name:"SpreadsheetView",stateModel:ul,ReactComponent:Object(f.lazy)((function(){return n.e(27).then(n.bind(null,1740))}))})}))}},{key:"configure",value:function(e){Object(U.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:gu.a,onClick:function(e){e.addView("SpreadsheetView",{})}})}}]),r}(M.a),dl=n(177),fl=n(1361),pl=n.n(fl),gl=function(e){var t=e.jbrequire,n=t("mobx-react"),r=n.observer,a=(n.PropTypes,t("react")),o=t("@material-ui/core/IconButton"),i=t("@material-ui/core/styles").makeStyles,c=t("@material-ui/core/Grid"),s=t("@material-ui/core/FormControlLabel"),u=t("@material-ui/core/Checkbox"),l=t("@jbrowse/core/ui").ResizeHandle,d=t("@material-ui/core/colors").grey,f={width:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"},p=i((function(e){return{root:{marginBottom:e.spacing(1),background:"white",overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,background:d[200]},viewControls:{margin:0},viewsContainer:{display:"flex"},spreadsheetViewContainer:{borderRight:[["1px","solid",d[400]]],overflow:"hidden"},circularViewOptions:{padding:e.spacing(1),background:d[200]}}})),g=r((function(e){var t=e.model,n=p();return a.createElement(c,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center"},a.createElement(c,{item:!0},a.createElement(o,{onClick:function(){return t.setImportMode()},className:n.iconButton,title:"open a tabular file","data-testid":"sv_inspector_view_open",color:"secondary"},a.createElement(eo.a,null))))})),m=r((function(e){var t=e.svInspector,n=p();return a.createElement(c,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight}},a.createElement(c,{item:!0},a.createElement(s,{control:a.createElement(u,{className:n.rowSelector,checked:t.onlyDisplayRelevantRegionsInCircularView,onClick:function(e){return t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}}),label:"show only regions with data"})))}));return r((function(e){var t=e.model,n=p(),r=t.resizeHeight,o=t.dragHandleHeight,i=t.SpreadsheetViewReactComponent,s=t.CircularViewReactComponent,u=t.showCircularView;return a.createElement("div",{className:n.root,"data-testid":t.id},a.createElement(c,{container:!0,direction:"row",className:n.header},a.createElement(c,{item:!0},a.createElement(g,{model:t}))),a.createElement("div",{className:n.viewsContainer},a.createElement("div",{className:n.spreadsheetViewContainer},a.createElement(i,{model:t.spreadsheetView})),u?a.createElement(a.Fragment,null,a.createElement(l,{onDrag:function(e){var n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,style:f}),a.createElement("div",{className:n.circularViewContainer,style:{width:t.circularView.width}},a.createElement(m,{svInspector:t}),a.createElement(s,{model:t.circularView}))):null),a.createElement(l,{onDrag:r,style:{height:o,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}}))}))},ml=n(600),hl=n.n(ml);function bl(e,t,n,r,a,o){var i={};return e.forEach((function(e,r){if(!t.includes(r)){var a=n.cells[r].text;"Number"===e.dataType.type&&(a=parseFloat(a)),i[e.name]=a}})),Object(c.a)(Object(c.a)({},i),{},{uniqueId:"sv-inspector-adhoc-".concat(o),refName:r.refName,start:r.start,end:r.end,mate:{refName:a.refName,start:a.start,end:a.end}})}function vl(e,t,n,r){var a=e.columns,o=e.columnDisplayOrder,i={};o.forEach((function(e){var t=a[e];i[t.dataType.type]||(i[t.dataType.type]=[]),i[t.dataType.type].push(e)}));var c=i.LocString||[],s=i.LocStart||[],u=i.LocEnd||[],l=i.LocRef||[];return c.length>=2?function(e,t,n,r,a){var o=Object(U.parseLocString)(n.cells[t[0]].text,a),i=Object(U.parseLocString)(n.cells[t[1]].text,a);return bl(e,[t[0],t[1]],n,o,i,r)}(a,c,n,t,r):l.length>=2&&s.length>=2&&u.length>=2?function(e,t,n,r,a,o){var i=function(e){return a.cells[e].text},c={refName:i(t[0]),start:parseInt(i(n[0]),10)-1,end:parseInt(i(r[0]),10)},s={refName:i(t[1]),start:parseInt(i(n[1]),10)-1,end:parseInt(i(r[1]),10)};return bl(e,[t[0],n[0],r[0],t[1],n[1],r[1]],a,c,s,o)}(a,l,s,u,n,t):void 0}function yl(e,t,n,r){if(n.extendedData){if(n.extendedData.vcfFeature)return n.extendedData.vcfFeature;if(n.extendedData.feature)return n.extendedData.feature}var a=vl(t.spreadsheet,r,n,e.assemblyManager.isValidRefName);if(a)return a}function Ol(e,t,n,r,a){var o=Object(b.getEnv)(e).pluginManager,i=Object(U.getSession)(t),c=yl(i,n,r,a);if(c){var s=new q.a(c);i.setSelection(s);var u=o.getViewType("BreakpointSplitView"),l=e.circularView;return u.snapshotFromBreakendFeature(s,l)}}function wl(e,t,n){var r=Object(U.getSession)(t);r.setSelection(e);var a=Object(U.getContainingView)(t),o=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,a);o.views[0].offsetPx-=a.width/2+100,o.views[1].offsetPx-=a.width/2+100,o.featureData=e.data,r.addView("BreakpointSplitView",o)}var jl=function(e){var t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=b.types.model("SvInspectorView",{type:b.types.literal("SvInspectorView"),dragHandleHeight:4,height:b.types.optional(b.types.refinement("SvInspectorViewHeight",b.types.number,(function(e){return e>=400})),500),onlyDisplayRelevantRegionsInCircularView:!1,mode:b.types.optional(b.types.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:b.types.optional(t.stateModel,(function(){return t.stateModel.create({type:"SpreadsheetView",hideViewControls:!0,hideVerticalResizeHandle:!0})})),circularView:b.types.optional(n.stateModel,(function(){return n.stateModel.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})}))}).volatile((function(){return{width:800}})).views((function(t){return{get selectedRows(){return t.spreadsheetView.rowSet.selectedRows},get assemblyName(){var e=t.spreadsheetView.assembly;if(e)return Object(E.readConfObject)(e,"name")},get showCircularView(){return"display"===t.spreadsheetView.mode},get featuresAdapterConfigSnapshot(){var e=Object(U.getSession)(t);return{type:"FromConfigAdapter",features:(t.spreadsheetView.outputRows||[]).map((function(n,r){return yl(e,t.spreadsheetView,n,r)})).filter((function(e){return Boolean(e)}))}},get featuresRefNamesP(){return new(0,e.getAdapterType("FromConfigAdapter").AdapterClass)(t.featuresAdapterConfigSnapshot).getRefNames()},get featuresCircularTrackConfiguration(){return e.jexl.addFunction("defaultOnChordClick",wl),{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(t.id),name:"features from tabular data",adapter:t.featuresAdapterConfigSnapshot,assemblyNames:[t.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(t.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}})).volatile((function(){return{SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52}})).actions((function(e){return{afterAttach:function(){Object(b.addDisposer)(e,Object(Ge.autorun)((function(){if(e.showCircularView){var t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),Object(b.addDisposer)(e,Object(Ge.autorun)((function(){e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function t(){var n,r,a,o,i,c,s,u,l,f;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.assemblyName,r=e.onlyDisplayRelevantRegionsInCircularView,a=e.circularView,o=e.featuresRefNamesP,i=a.tracks,c=Object(U.getSession)(e),!n){t.next=8;break}return t.next=6,c.assemblyManager.waitForAssembly(n);case 6:(s=t.sent)?(u=s.getCanonicalRefName,l=s.regions,f=void 0===l?[]:l,r?1===i.length&&o.then((function(e){var t=new Set(e.map((function(e){return u(e)||e}))),n=f.filter((function(e){return t.has(e.refName)}));a.setDisplayedRegions(JSON.parse(JSON.stringify(n)))})).catch((function(e){return a.setError(e)})):a.setDisplayedRegions(f)):a.setDisplayedRegions([]);case 8:case"end":return t.stop()}}),t)}))),{name:"SvInspectorView displayed regions bind"})),Object(b.addDisposer)(e,Object(Ge.reaction)((function(){return{generatedTrackConf:e&&e.featuresCircularTrackConfiguration,assemblyName:e&&e.assemblyName}}),(function(t){if(t){var n=t.assemblyName,r=t.generatedTrackConf;e.circularView.tracks.length&&e.circularView.tracks.forEach((function(t){e.circularView.hideTrack(t.configuration.trackId)})),n&&r&&e.circularView.addTrackConf(r,{assemblyName:n})}}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),Object(b.addDisposer)(e,Object(Ge.autorun)((function(){e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:hl.a,disabled:function(t,n,r,a){return!function(e,t,n,r,a){try{var o=Ol(e,t,n,r,a);return Boolean(o)}catch(i){return console.error("Unable to open breakpoint split view from table row",i),!1}}(e,t,n,a,r)},onClick:function(t,n,r,a){!function(e,t,n,r,a){var o=Ol(e,t,n,r,a);if(o){var i=e.circularView;o.views[0].offsetPx-=i.width/2+100,o.views[1].offsetPx-=i.width/2+100,Object(U.getSession)(t).addView("BreakpointSplitView",o)}}(e,t,n,a,r)}}])})))},setWidth:function(t){e.width=t},setHeight:function(t){return e.height=t>400?t:400,e.height},resizeHeight:function(t){var n=e.height;return e.setHeight(e.height+t)-n},setImportMode:function(){e.spreadsheetView.setImportMode()},setDisplayMode:function(){e.spreadsheetView.setDisplayMode()},closeView:function(){Object(b.getParent)(e,2).removeView(e)},setDisplayedRegions:function(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView:function(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}}));return{stateModel:b.types.compose(Me.BaseViewModel,r)}},kl=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/ViewType"),r=t(gl);return new n({name:"SvInspectorView",stateModel:t(jl).stateModel,ReactComponent:r})},xl=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="SvInspectorViewPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(kl)}))}},{key:"configure",value:function(e){Object(dl.c)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:pl.a,onClick:function(e){e.addView("SvInspectorView",{})}})}}]),n}(M.a);var Cl=Object(ie.observer)((function(e){var t=e.width,n=e.height,r=Math.ceil(t);return p.a.createElement("div",{className:"PileupRendering",style:{position:"relative",width:r,height:n}},p.a.createElement(ue.PrerenderedCanvas,Object.assign({},e,{style:{position:"absolute",left:0,top:0}})))})),Sl=Object(E.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0}),Tl=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).supportsSVG=!0,e}return Object(h.a)(n,[{key:"makeImageData",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,c,s,u,l,f,p,g,m,h,b,v,y,O,w,j,k,x,C,S,T,M,R,P;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.features,a=n.config,o=n.bpPerPx,i=n.signal,c=n.resolution,s=n.sessionId,u=n.adapterConfig,e.next=3,Object(V.b)(this.pluginManager,s,u);case 3:return l=e.sent,f=l.dataAdapter,e.next=7,f.getResolution(o/c);case 7:if(p=e.sent,g=p/(o*Math.sqrt(2)),m=ft()(Object(E.readConfObject)(a,"baseColor")),!r.length){e.next=34;break}return h=r[0].bin1,b=0,v=0,y=0,e.next=17,Object(U.abortBreakPoint)(i);case 17:for(O=0;O<r.length;O++)w=r[O],j=w.bin1,k=w.bin2,x=w.counts,b=Math.max(x,b),v=Math.min(Math.min(j,k),v),y=Math.max(Math.max(j,k),y);return e.next=20,Object(U.abortBreakPoint)(i);case 20:t.rotate(-Math.PI/4),C=Date.now(),S=0;case 23:if(!(S<r.length)){e.next=34;break}if(T=r[S],M=T.bin1,R=T.bin2,P=T.counts,t.fillStyle=Object(E.readConfObject)(a,"color",{count:P,maxScore:b,baseColor:m}),t.fillRect((M-h)*g,(R-h)*g,g,g),!(+Date.now()-C>400)){e.next=31;break}return e.next=30,Object(U.abortBreakPoint)(i);case 30:C=+Date.now();case 31:S++,e.next=23;break;case 34:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,s,l,f,p,g,m,h=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.config,a=t.regions,o=t.bpPerPx,i=Object(u.a)(a,1),s=i[0],l=(s.end-s.start)/o,f=Object(E.readConfObject)(r,"maxHeight"),e.next=6,this.getFeatures(t);case 6:return p=e.sent,e.next=9,Object(Pe.a)(l,f,t,(function(e){return h.makeImageData(e,Object(c.a)(Object(c.a)({},t),{},{features:p}))}));case 9:return g=e.sent,e.next=12,Object(F.a)(Object(D.a)(n.prototype),"render",this).call(this,Object(c.a)(Object(c.a)(Object(c.a)({},t),g),{},{features:p,region:t.regions[0],height:f,width:l}));case 12:return m=e.sent,e.abrupt("return",Object(c.a)(Object(c.a)(Object(c.a)({},m),g),{},{height:f,width:l}));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.regions,r=t.sessionId,a=t.adapterConfig,e.next=3,Object(V.b)(this.pluginManager,r,a);case 3:return o=e.sent,i=o.dataAdapter,e.next=7,i.getFeatures(n[0],t).pipe(Object(B.a)()).toPromise();case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(z.default),El=function(e){var t=e.getRendererType("HicRenderer").configSchema;return Object(E.ConfigurationSchema)("LinearHicDisplay",{renderer:t},{baseConfiguration:He.d,explicitlyTyped:!0})},Ml=function(e){return b.types.compose("LinearHicDisplay",He.a,b.types.model({type:b.types.literal("LinearHicDisplay"),configuration:Object(E.ConfigurationReference)(e),resolution:b.types.optional(b.types.number,1)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps:function(){var n=e.rendererType.configSchema.create(Object(E.getConf)(e,"renderer")||{},Object(b.getEnv)(e));return Object(c.a)(Object(c.a)({},t()),{},{config:n,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution})}}})).actions((function(e){return{setResolution:function(t){e.resolution=t}}})).views((function(e){var t=e.trackMenuItems;return{trackMenuItems:function(){return[].concat(Object(o.a)(t()),[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/2)}}]}])}}}))},Rl=Object(E.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Pl=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="HicPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addAdapterType((function(){return new y.a({name:"HicAdapter",configSchema:Rl,getAdapterClass:function(){return Promise.all([n.e(24),n.e(69)]).then(n.bind(null,1735)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="HicAdapter",o=Object(_e.getFileName)(t),i={type:a,hicLocation:t};return/\.hic/i.test(o)&&!r||r===a?i:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"HicAdapter"===t?"HicTrack":e(t)}})),e.addRendererType((function(){return new Tl({name:"HicRenderer",ReactComponent:Cl,configSchema:Sl,pluginManager:e})})),e.addTrackType((function(){var t=Object(E.ConfigurationSchema)("HicTrack",{},{baseConfiguration:Object(Me.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new O.a({name:"HicTrack",configSchema:t,stateModel:Object(Me.createBaseTrackModel)(e,"HicTrack",t)})})),e.addDisplayType((function(){var t=El(e);return new w.a({name:"LinearHicDisplay",configSchema:t,stateModel:Ml(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:He.b})}))}},{key:"configure",value:function(e){e.jexl.addFunction("alpha",(function(e,t){return e.alpha(t)})),e.jexl.addFunction("hsl",(function(e){return e.hsl()})),e.jexl.addFunction("colorString",(function(e){return e.string()}))}}]),r}(M.a),Al=n(1362),Nl=n.n(Al);function Ll(e){try{return decodeURIComponent(e)}catch(t){return e}}function Il(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,r-n)>0?"...":"")+e.slice(Math.max(0,r-n),r+t.length+n).trim()+(r+t.length<e.length?"...":"")}var Fl=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e,r,a){var o;Object(m.a)(this,n),(o=t.call(this,e,r,a)).indexingAttributes=void 0,o.trixJs=void 0,o.tracksNames=void 0;var i=Object(E.readConfObject)(e,"ixFilePath"),c=Object(E.readConfObject)(e,"ixxFilePath");if(!i)throw new Error("must provide out.ix");if(!c)throw new Error("must provide out.ixx");return o.trixJs=new Nl.a(Object($.openLocation)(c),Object($.openLocation)(i),1500),o}return Object(h.a)(n,[{key:"searchIndex",value:function(){var e=Object(i.a)(d.a.mark((function e(t){var n,r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryString.toLowerCase(),r=n.split(" "),e.next=4,this.trixJs.search(n);case 4:if(a=e.sent,o=a.filter((function(e){var t=Object(u.a)(e,2)[1];return r.every((function(e){return Ll(t).toLowerCase().includes(e)}))})).map((function(e){var t=Object(u.a)(e,2),n=t[0],r=t[1],a=JSON.parse(r.replace(/\|/g,",")),o=a.map((function(e){return Ll(e)})),i=Object(ta.a)(o),c=i[0],s=i[1],l=i.slice(2),d=l.findIndex((function(e){return!!e})),f=l.map((function(e){return e.toLowerCase()})).findIndex((function(e){return-1!==e.indexOf(n.toLowerCase())})),p=l[d],g=l[f],m=-1!==f?Il(g,n):void 0,h=Il(p,n),b=m&&h.toLowerCase()!==m.toLowerCase()?"".concat(h," (").concat(m,")"):h;return new Go.b({locString:c,label:p,displayString:b,matchedObject:a.map((function(e){return decodeURIComponent(e)})),trackId:s})})),"exact"!==t.searchType){e.next=8;break}return e.abrupt("return",o.filter((function(e){return e.getLabel().toLowerCase()===t.queryString.toLowerCase()})));case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(W.BaseAdapter),Dl=Object(E.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Bl=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){var e;Object(m.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="TrixPlugin",e}return Object(h.a)(n,[{key:"install",value:function(e){e.addTextSearchAdapterType((function(){return new T.a({name:"TrixTextSearchAdapter",configSchema:Dl,AdapterClass:Fl,description:"Trix adapter"})}))}}]),n}(M.a),Vl=n(1365),zl=n.n(Vl),Wl=n(1364),Ul=n.n(Wl),ql=(n(954),b.types.compose(N.Region,b.types.model("Label",{label:b.types.optional(b.types.string,"")})).actions((function(e){return{setLabel:function(t){e.label=t}}})));function Hl(e){return b.types.model("GridBookmarkModel",{id:N.ElementId,type:b.types.literal("GridBookmarkWidget"),view:b.types.safeReference(e.pluggableMstType("view","stateModel")),bookmarkedRegions:b.types.array(ql),modelSelectedAssembly:""}).actions((function(e){return{importBookmarks:function(t){e.bookmarkedRegions=Object(b.cast)(e.bookmarkedRegions.concat(t))},addBookmark:function(t){e.bookmarkedRegions.push(t)},removeBookmark:function(t){e.bookmarkedRegions.splice(t,1)},clearAllBookmarks:function(){e.bookmarkedRegions.clear()},updateBookmarkLabel:function(t,n){var r;null===(r=e.bookmarkedRegions[t])||void 0===r||r.setLabel(n)},setSelectedAssembly:function(t){e.modelSelectedAssembly=t}}})).views((function(e){return{get selectedAssembly(){return e.modelSelectedAssembly||(e.bookmarkedRegions.length?e.bookmarkedRegions[0].assemblyName:"")},get assemblies(){return Object(o.a)(new Set(e.bookmarkedRegions.map((function(e){return e.assemblyName}))))}}}))}var _l=Object(E.ConfigurationSchema)("GridBookmarkWidget",{}),Gl=function(e){Object(P.a)(r,e);var t=Object(A.a)(r);function r(){var e;Object(m.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="GridBookmarkPlugin",e}return Object(h.a)(r,[{key:"install",value:function(e){e.addWidgetType((function(){return new k.a({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:_l,stateModel:Hl(e),ReactComponent:Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,954))}))})})),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearGenomeView"===e.name){var t=e.stateModel.extend((function(e){var t=e.menuItems,n=e.rubberBandMenuItems;return{actions:{activateBookmarkWidget:function(){var t=Object(U.getSession)(e);if(Object(U.isSessionModelWithWidgets)(t)){var n=t.widgets.get("GridBookmark");return n||(n=t.addWidget("GridBookmarkWidget","GridBookmark",{view:e})),t.showWidget(n),n}throw new Error("Could not open bookmark widget")},bookmarkCurrentRegion:function(){var t=e.getSelectedRegions(e.leftOffset,e.rightOffset)[0],n=Object(U.getSession)(e);if(Object(U.isSessionModelWithWidgets)(n)){var r=n.widgets,a=r.get("GridBookmark");a||(this.activateBookmarkWidget(),a=r.get("GridBookmark")),a.addBookmark(t)}}},views:{menuItems:function(){return[].concat(Object(o.a)(t()),[{type:"divider"},{label:"Open bookmark widget",icon:Ul.a,onClick:e.activateBookmarkWidget},{label:"Bookmark current region",icon:zl.a,onClick:e.bookmarkCurrentRegion}])},rubberBandMenuItems:function(){return[].concat(Object(o.a)(n()),[{label:"Bookmark region",icon:zl.a,onClick:function(){var t=e.leftOffset,n=e.rightOffset,r=e.getSelectedRegions(t,n)[0],a=Object(U.getSession)(e);if(Object(U.isSessionModelWithWidgets)(a)){var o=a.widgets,i=o.get("GridBookmark");i||(e.activateBookmarkWidget(),i=o.get("GridBookmark")),i.addBookmark(r)}}}])}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){}}]),r}(M.a),Jl=[cu,He.e,Pn,or,sr,Zr.d,ea.b,Qa,Vo,Wo,Ho,Ei,kc,zc,Gc,os,ls,Cs,du,fu.b,Ot,ll,xl,$r,Pl,Bl,Gl,Ta],Xl=n(1644),Yl=n(1681),Ql=n(1673),Kl=n(814),$l=n(860),Zl=n(1748),ed=n(1658),td=n(1373),nd=n.n(td),rd=n(1372),ad=n.n(rd),od=n(462),id=n.n(od);function cd(e){var t=0;switch(e.length%4){case 3:t=1;break;case 2:t=2;break;case 0:t=0;break;default:throw new Error("base64 not a valid length")}return e+"=".repeat(t)}function sd(e){return ud.apply(this,arguments)}function ud(){return(ud=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=cd(t.replace(/-/g,"+").replace(/_/g,"/")),e.next=3,Promise.resolve().then(n.t.bind(null,1289,7));case 3:return a=e.sent,o=a.toByteArray,e.next=7,Promise.resolve().then(n.t.bind(null,596,7));case 7:return i=e.sent,c=i.inflate,s=o(r),u=c(s),e.abrupt("return",(new TextDecoder).decode(u));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ld(e){return dd.apply(this,arguments)}function dd(){return(dd=Object(i.a)(d.a.mark((function e(t){var r,a,o,i,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),e.next=3,Promise.resolve().then(n.t.bind(null,596,7));case 3:return a=e.sent,o=a.deflate,e.next=7,Promise.resolve().then(n.t.bind(null,1289,7));case 7:return i=e.sent,c=i.fromByteArray,s=o(r),u=c(s),l=u.indexOf("="),e.abrupt("return",l>0?u.slice(0,l).replace(/\+/g,"-").replace(/\//g,"_"):u.replace(/\+/g,"-").replace(/\//g,"_"));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fd=n(1366),pd=n.n(fd),gd=n(1371),md=n.n(gd);function hd(e){return window.btoa(Array.from(window.crypto.getRandomValues(new Uint8Array(2*e))).map((function(e){return String.fromCharCode(e)})).join("")).replace(/[+/]/g,"").substring(0,e)}var bd=function(e,t){return pd.a.encrypt(e,t).toString()},vd=function(e,t){return pd.a.decrypt(e,t).toString(md.a)};function yd(e){try{return JSON.parse(e).message}catch(t){return e}}function Od(e,t,n){return wd.apply(this,arguments)}function wd(){return(wd=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i,c,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ld(JSON.stringify(t));case 2:return a=e.sent,o=hd(5),i=bd(a,o),(c=new FormData).append("session",i),c.append("dateShared","".concat(Date.now())),c.append("referer",r),e.next=11,fetch("".concat(n,"share"),{method:"POST",mode:"cors",body:c});case 11:if((s=e.sent).ok){e.next=17;break}return e.next=15,s.text();case 15:throw u=e.sent,new Error(yd(u));case 17:return e.next=19,s.json();case 19:return l=e.sent,e.abrupt("return",{json:l,encryptedSession:i,password:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jd(e,t,n,r){return kd.apply(this,arguments)}function kd(){return(kd=Object(i.a)(d.a.mark((function e(t,n,r,a){var o,i,c,s,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.split("share-")[1],i="".concat(t,"?sessionId=").concat(o),e.next=4,fetch(i,{signal:a});case 4:if((c=e.sent).ok){e.next=10;break}return e.next=8,c.text();case 8:throw s=e.sent,new Error(yd(s));case 10:return e.next=12,c.json();case 12:return u=e.sent,e.abrupt("return",vd(u.session,r));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var xd=Object(Xe.a)((function(e){return{shareDiv:{textAlign:"center",paddingLeft:"2px"},shareButton:{"&:hover":{backgroundColor:Object(Ye.a)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})),Cd="jbrowse-shareURL";function Sd(e){var t=xd(),n=e.onClose,r=e.open,a=e.currentSetting,o=Object(f.useState)(a),i=Object(u.a)(o,2),c=i[0],s=i[1],l=Object(f.useState)(!1),d=Object(u.a)(l,2),g=d[0],m=d[1],h=function(){localStorage.setItem(Cd,c),n(c)};return p.a.createElement(p.a.Fragment,null,p.a.createElement(Fn.a,{onClose:h,open:r},p.a.createElement(Bn.a,null,"Configure session sharing",h?p.a.createElement(Er.a,{className:t.closeButton,onClick:h},p.a.createElement(gc.a,null)):null),p.a.createElement(Dn.a,null,p.a.createElement(Ql.a,null,"Select between generating long or short URLs for the session sharing",p.a.createElement(Er.a,{onClick:function(){return m(!0)}},p.a.createElement(ad.a,null))),p.a.createElement(Kl.a,{component:"fieldset"},p.a.createElement($l.a,{value:c,onChange:function(e){var t=e.target.value;s(t)}},p.a.createElement(dc.a,{value:"short",control:p.a.createElement(Zl.a,null),label:"Short URL"}),p.a.createElement(dc.a,{value:"long",control:p.a.createElement(Zl.a,null),label:"Long URL"}))))),p.a.createElement(Td,{open:g,onClose:function(){m(!1)}}))}function Td(e){var t=xd(),n=e.onClose,r=e.open,a=function(){n()};return p.a.createElement(Fn.a,{onClose:a,open:r},p.a.createElement(Bn.a,{id:"simple-dialog-title"},"Info about session URLs",n?p.a.createElement(Er.a,{className:t.closeButton,onClick:a},p.a.createElement(gc.a,null)):null),p.a.createElement(Dn.a,null,p.a.createElement(Ql.a,null,"Because everything about the JBrowse session is encoded in the URL (e.g. state of the tracks, views, features selected, etc.) the sessions can get very long. Therefore, we created a URL shortener, both as a convenience and because long URLs can break some programs. Note that both the long and short URLs encode the same data, but due to long URLs causing problems with some programs, we recommend sharing short URLs."),p.a.createElement(Ql.a,null,'We generate the short URLs in a secure manner which involves encrypting the session on the client side with a random password string and uploading them to a central database. Then the random password is added to the URL but is not uploaded to the central database, making these short URLs effectively "end-to-end encrypted"'),p.a.createElement(Ql.a,null,"Only users with a share link can read the session.")))}var Ed=Object(ie.observer)((function(e){var t=e.handleClose,n=e.session,r=xd(),a=Object(f.useState)(""),o=Object(u.a)(a,2),c=o[0],s=o[1],l=Object(f.useState)(""),g=Object(u.a)(l,2),m=g[0],h=g[1],v=Object(f.useState)(!0),y=Object(u.a)(v,2),O=y[0],w=y[1],j=Object(f.useState)(),k=Object(u.a)(j,2),x=k[0],C=k[1],S=Object(f.useState)(!1),T=Object(u.a)(S,2),E=T[0],M=T[1],R=n.shareURL,P=localStorage.getItem(Cd)||"short",A=Object(b.getSnapshot)(n);return Object(f.useEffect)((function(){var e=!1;return Object(i.a)(d.a.mark((function t(){var n,r,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("short"!==P){t.next=16;break}return t.prev=1,w(!0),n=new URL(window.location.href),t.next=6,Od(A,R,n.href);case 6:r=t.sent,e||((a=new URLSearchParams(n.search)).set("session","share-".concat(r.json.sessionId)),a.set("password",r.password),n.search=a.toString(),s(n.href)),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),C(t.t0);case 13:return t.prev=13,w(!1),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})))(),function(){e=!0}}),[P,R,A]),Object(f.useEffect)((function(){var e=!1;return Object(i.a)(d.a.mark((function t(){var r,a,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ld(JSON.stringify(Object(b.getSnapshot)(n)));case 3:r=t.sent,a=new URL(window.location.href),(o=new URLSearchParams(a.search)).set("session","encoded-".concat(r)),a.search=o.toString(),e||h(a.toString()),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),C(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))(),function(){e=!0}}),[n]),p.a.createElement(p.a.Fragment,null,p.a.createElement(Fn.a,{maxWidth:"xl",open:!0,onClose:t,"data-testid":"share-dialog"},p.a.createElement(Bn.a,null,"JBrowse Shareable Link",t?p.a.createElement(Er.a,{className:r.closeButton,onClick:t},p.a.createElement(gc.a,null)):null),p.a.createElement(ed.a,null),p.a.createElement(Dn.a,null,p.a.createElement(Ql.a,null,"Copy the URL below to share your current JBrowse session.",p.a.createElement(Er.a,{onClick:function(){return M(!0)}},p.a.createElement(id.a,null))),"short"===P?x?p.a.createElement(pn.a,{color:"error"},"".concat(x)):O?p.a.createElement(pn.a,null,"Generating short URL..."):p.a.createElement(zn.a,{label:"URL",value:c,InputProps:{readOnly:!0},inputProps:{"data-testid":"share-url-text"},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()},"data-testid":"share-url-field"}):p.a.createElement(zn.a,{label:"URL",value:m,InputProps:{readOnly:!0},variant:"filled",style:{width:"100%"},onClick:function(e){e.target.select()}})),p.a.createElement(Vn.a,null,p.a.createElement(In.a,{onClick:function(){rn()(c||m.toString()),n.notify("Copied to clipboard","success")},color:"primary",startIcon:p.a.createElement(tn.b,null),disabled:"short"===P&&O},"Copy URL to Clipboard"),p.a.createElement(In.a,{onClick:t,color:"primary",autoFocus:!0},"Close"))),p.a.createElement(Sd,{open:E,onClose:function(){M(!1)},currentSetting:P}))})),Md=Object(ie.observer)((function(e){var t=Object(f.useState)(!1),n=Object(u.a)(t,2),r=n[0],a=n[1],o=e.session,c=xd();return p.a.createElement("div",{className:c.shareDiv},p.a.createElement(In.a,{"data-testid":"share_button",onClick:Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a(!0));case 1:case"end":return e.stop()}}),e)}))),size:"small",color:"inherit",startIcon:p.a.createElement(nd.a,null),classes:{root:c.shareButton}},"Share"),r?p.a.createElement(Ed,{handleClose:function(){a(!1)},session:o}):null)}));var Rd=Object(ie.observer)((function(e){var t=e.pluginManager.rootModel,n=t,r=n.isAssemblyEditing,a=n.isDefaultSessionEditing,o=n.setDefaultSessionEditing,i=n.setAssemblyEditing;return p.a.createElement(p.a.Fragment,null,r?p.a.createElement(Ya,{rootModel:t,onClose:function(){return i(!1)}}):null,a?p.a.createElement(Xa,{rootModel:t,onClose:function(){return o(!1)}}):null)})),Pd=Object(ie.observer)((function(e){var t=e.pluginManager,n=Object(se.c)("adminKey",se.b),r=Object(u.a)(n,1)[0],a=Object(se.c)("adminServer",se.b),o=Object(u.a)(a,1)[0],c=Object(se.c)("config",se.b),s=Object(u.a)(c,1)[0],l=Object(se.c)("session",se.b),g=Object(u.a)(l,2)[1],m=t.rootModel,h=m||{},v=h.error,y=h.jbrowse,O=null===m||void 0===m?void 0:m.session,w=O.id;if(Object(f.useEffect)((function(){g("local-".concat(w)),window.JBrowseRootModel=m,window.JBrowseSession=O}),[w,m,O,g]),Object(f.useEffect)((function(){y&&Object(b.onSnapshot)(y,function(){var e=Object(i.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=9;break}return e.next=3,fetch(o||"/updateConfig",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({adminKey:r,configPath:s,config:t})});case 3:if((n=e.sent).ok){e.next=9;break}return e.next=7,n.text();case 7:a=e.sent,O&&O.notify("Admin server error: ".concat(n.status," (").concat(n.statusText,") ").concat(a||""));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[y,O,r,o,s]),v)throw v;if(!m)throw new Error("No rootModel found");if(!O)throw new Error("No session found");var j=Object(E.getConf)(m.jbrowse,"theme");return p.a.createElement(Xl.a,{theme:Object(ue.createJBrowseTheme)(j)},p.a.createElement(Yl.a,null),p.a.createElement(ue.App,{session:O,HeaderButtons:p.a.createElement(Md,{session:O})}),r?p.a.createElement(Rd,{pluginManager:t}):null)})),Ad=Pd,Nd=n(453),Ld=n(1374),Id=n.n(Ld),Fd=n(176),Dd=n.n(Fd),Bd=n(463),Vd=["signal","statusCallback"],zd=["rgb(153, 102, 0)","rgb(102, 102, 0)","rgb(153, 153, 30)","rgb(204, 0, 0)","rgb(255, 0, 0)","rgb(255, 0, 204)","rgb(165, 132, 132)","rgb(204, 122, 0)","rgb(178, 142, 0)","rgb(153, 153, 0)","rgb(122, 153, 0)","rgb(0, 165, 0)","rgb(53, 128, 0)","rgb(0, 0, 204)","rgb(96, 145, 242)","rgb(107, 142, 178)","rgb(0, 165, 165)","rgb(122, 153, 153)","rgb(153, 0, 204)","rgb(204, 51, 255)","rgb(173, 130, 216)","rgb(102, 102, 102)","rgb(145, 145, 145)","rgb(142, 142, 142)","rgb(142, 142, 107)","rgb(96, 163, 48)"];function Wd(e,t,n,r){return Ud.apply(this,arguments)}function Ud(){return(Ud=Object(i.a)(d.a.mark((function e(t,n,r,a){var o,i,s,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.sessionId,e.next=3,Object(U.when)((function(){return Boolean(t.regions&&t.refNameAliases)}),{signal:a,name:"when assembly ready"});case 3:return e.next=5,t.rpcManager.call(o,"CoreGetRefNames",Object(c.a)({adapterConfig:n,signal:a},r),{timeout:1e6});case 5:if(i=e.sent,t.refNameAliases){e.next=9;break}throw new Error("error loading assembly ".concat(t.name,"'s refNameAliases"));case 9:return s=Object.fromEntries(i.map((function(e){return qd(e),[t.getCanonicalRefName(e),e]}))),l=Object.fromEntries(Object.entries(s).map((function(e){var t=Object(u.a)(e,2),n=t[0];return[t[1],n]}))),e.abrupt("return",{forwardMap:s,reverseMap:l});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qd(e){if(!e.match(/[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*/))throw new Error('Encountered invalid refName: "'.concat(e,'"'))}function Hd(e,t){var n=new Dd.a({cache:new Bd.a({maxSize:1e3}),fill:function(e,t,n){return Object(i.a)(d.a.mark((function r(){var a,o,i;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.adapterConf,o=e.self,i=e.options,r.abrupt("return",Wd(o,a,Object(c.a)(Object(c.a)({},i),{},{statusCallback:n}),t));case 2:case"end":return r.stop()}}),r)})))()}});return b.types.model({configuration:b.types.safeReference(e)}).volatile((function(){return{error:void 0,regions:void 0,refNameAliases:void 0,cytobands:void 0}})).views((function(e){return{get initialized(){return!!e.refNameAliases},get name(){return Object(E.getConf)(e,"name")},get aliases(){return Object(E.getConf)(e,"aliases")},hasName:function(e){return this.allAliases.includes(e)},get allAliases(){return[this.name].concat(Object(o.a)(this.aliases))},get refNames(){var t;return null===(t=e.regions)||void 0===t?void 0:t.map((function(e){return e.refName}))},get allRefNames(){return e.refNameAliases?Object.keys(e.refNameAliases):void 0},get rpcManager(){return Object(b.getParent)(e,2).rpcManager},get refNameColors(){var t=Object(E.getConf)(e,"refNameColors");return 0===t.length?zd:t}}})).views((function(e){return{getCanonicalRefName:function(t){if(!e.refNameAliases)throw new Error("aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called");return e.refNameAliases[t]},getRefNameColor:function(t){var n,r=null===(n=e.refNames)||void 0===n?void 0:n.findIndex((function(e){return e===t}));if(void 0!==r&&-1!==r)return e.refNameColors[r%e.refNameColors.length]},isValidRefName:function(t){if(!e.refNameAliases)throw new Error("isValidRefName cannot be called yet, the assembly has not finished loading");return!!this.getCanonicalRefName(t)}}})).actions((function(e){return{setLoading:function(){},setLoaded:function(e){var t=e.adapterRegionsWithAssembly,n=e.refNameAliases,r=e.cytobands;this.setRegions(t),this.setRefNameAliases(n),this.setCytobands(r)},setError:function(t){console.error(t),e.error=t},setRegions:function(t){e.regions=t},setRefNameAliases:function(t){e.refNameAliases=t},setCytobands:function(t){e.cytobands=t},afterAttach:function(){Object(U.makeAbortableReaction)(e,function(e){return function(t){if(t.configuration){var n=t.configuration,r=n.sequence,a=n.refNameAliases,o=n.cytobands,i=r.adapter,c=null===a||void 0===a?void 0:a.adapter,s=null===o||void 0===o?void 0:o.adapter;return{sequenceAdapterConfig:i,assemblyName:t.name,refNameAliasesAdapterConfig:c,cytobandAdapterConfig:s,pluginManager:e}}}}(t),_d,{name:"".concat(e.name," assembly loading"),fireImmediately:!0},this.setLoading,this.setLoaded,this.setError)}}})).views((function(e){return{getAdapterMapEntry:function(t,r){r.signal;var a=r.statusCallback,o=Object(s.a)(r,Vd);if(!r.sessionId)throw new Error("sessionId is required");var i=function(e){return Id()(e)}(t);return n.get(i,{adapterConf:t,self:e,options:o},void 0,a)},getRefNameMapForAdapter:function(e,t){var n=this;return Object(i.a)(d.a.mark((function r(){var a;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&t.sessionId){r.next=2;break}throw new Error("sessionId is required");case 2:return r.next=4,n.getAdapterMapEntry(e,t);case 4:return a=r.sent,r.abrupt("return",a.forwardMap);case 6:case"end":return r.stop()}}),r)})))()},getReverseRefNameMapForAdapter:function(e,t){var n=this;return Object(i.a)(d.a.mark((function r(){var a;return d.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getAdapterMapEntry(e,t);case 2:return a=r.sent,r.abrupt("return",a.reverseMap);case 4:case"end":return r.stop()}}),r)})))()}}}))}function _d(e,t){return Gd.apply(this,arguments)}function Gd(){return(Gd=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i,s,u,l,f,p,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return r=t.sequenceAdapterConfig,a=t.assemblyName,o=t.refNameAliasesAdapterConfig,i=t.cytobandAdapterConfig,s=t.pluginManager,e.next=5,Kd(r,s,n);case 5:return u=e.sent,l=u.map((function(e){return qd(e.refName),Object(c.a)(Object(c.a)({},e),{},{assemblyName:a})})),f={},e.next=10,Jd(o,s,n);case 10:return p=e.sent,e.next=13,Yd(i,s);case 13:return g=e.sent,p.forEach((function(e){var t=e.refName;e.aliases.forEach((function(e){qd(e),f[e]=t}))})),l.forEach((function(e){f[e.refName]=e.refName})),e.abrupt("return",{adapterRegionsWithAssembly:l,refNameAliases:f,cytobands:g});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jd(e,t,n){return Xd.apply(this,arguments)}function Xd(){return(Xd=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.getAdapterType(t.type),e.next=3,null===(a=o.getAdapterClass)||void 0===a?void 0:a.call(o);case 3:return i=e.sent,c=new i(t,void 0,n),e.abrupt("return",c.getRefNameAliases({signal:r}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yd(e,t){return Qd.apply(this,arguments)}function Qd(){return(Qd=Object(i.a)(d.a.mark((function e(t,n){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.getAdapterType(t.type),e.next=3,r.getAdapterClass();case 3:return a=e.sent,o=new a(t,void 0,n),e.abrupt("return",o.getData());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kd(e,t,n){return $d.apply(this,arguments)}function $d(){return($d=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.getAdapterType(t.type),e.next=3,a.getAdapterClass();case 3:return o=e.sent,i=new o(t,void 0,n),e.abrupt("return",i.getRegions({signal:r}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zd(e,t){var n=Hd(e,t);return b.types.model({assemblies:b.types.array(n)}).views((function(e){return{get:function(t){return e.assemblies.find((function(e){return e.hasName(t)}))},get assemblyNamesList(){return this.assemblyList.map((function(e){return e.name}))},get assemblyList(){var t=Object(b.getParent)(e),n=t.jbrowse.assemblies,r=t.session,a=(r=void 0===r?{}:r).sessionAssemblies,i=void 0===a?[]:a;return[].concat(Object(o.a)(n),Object(o.a)(i))},get rpcManager(){return Object(b.getParent)(e).rpcManager},get pluginManager(){return Object(b.getParent)(e).pluginManager},get allPossibleRefNames(){var t,n=[],r=Object(g.a)(e.assemblies);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!a.allRefNames)return;n=n.concat(a.allRefNames)}}catch(o){r.e(o)}finally{r.f()}return n}}})).views((function(e){return{waitForAssembly:function(t){return Object(i.a)(d.a.mark((function n(){var r;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}throw new Error("no assembly name supplied to waitForAssembly");case 2:if(!(r=e.get(t))){n.next=9;break}return n.next=6,Object(U.when)((function(){return Boolean(r.regions&&r.refNameAliases)||!!r.error}));case 6:if(!r.error){n.next=8;break}throw r.error;case 8:return n.abrupt("return",r);case 9:return n.abrupt("return",void 0);case 10:case"end":return n.stop()}}),n)})))()},getRefNameMapForAdapter:function(t,n,r){return Object(i.a)(d.a.mark((function a(){var o;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(U.when)((function(){return Boolean(e.get(n))}),{signal:r.signal,name:"when assembly ready"});case 2:if(!(o=e.get(n))){a.next=5;break}return a.abrupt("return",o.getRefNameMapForAdapter(t,r));case 5:return a.abrupt("return",void 0);case 6:case"end":return a.stop()}}),a)})))()},getReverseRefNameMapForAdapter:function(t,n,r){return Object(i.a)(d.a.mark((function a(){var o;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(U.when)((function(){return Boolean(e.get(n))}),{signal:r.signal,name:"when assembly ready"});case 2:if(!(o=e.get(n))){a.next=5;break}return a.abrupt("return",o.getReverseRefNameMapForAdapter(t,r));case 5:return a.abrupt("return",void 0);case 6:case"end":return a.stop()}}),a)})))()},isValidRefName:function(t,n){if(n){var r=e.get(n);if(r)return r.isValidRefName(t);throw new Error("isValidRefName for ".concat(n," failed, assembly does not exist"))}if(!e.allPossibleRefNames)throw new Error("isValidRefName not available, assemblyManager has not yet finished loading. If you are looking for a refname in a specific assembly, pass assembly argument");return e.allPossibleRefNames.includes(t)}}})).actions((function(e){return{removeAssembly:function(t){e.assemblies.remove(t)},afterAttach:function(){var t=this;Object(b.addDisposer)(e,Object(Ge.reaction)((function(){return e.assemblyList}),(function(n){e.assemblies.forEach((function(e){e.configuration||t.removeAssembly(e)})),n.forEach((function(n){-1===e.assemblies.findIndex((function(e){return e.name===Object(E.readConfObject)(n,"name")}))&&t.addAssembly(n)}))}),{fireImmediately:!0,name:"assemblyManagerAfterAttach"}))},addAssembly:function(t){e.assemblies.push({configuration:t})},replaceAssembly:function(t,n){e.assemblies[t]=Object(b.cast)({configuration:n})}}}))}var ef=function(e){return Object(E.ConfigurationSchema)("BaseAssembly",{aliases:{type:"stringArray",defaultValue:[],description:"Other possible names for the assembly"},sequence:e.getTrackType("ReferenceSequenceTrack").configSchema,refNameColors:{type:"stringArray",defaultValue:[],description:"Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence."},refNameAliases:Object(E.ConfigurationSchema)("RefNameAliases",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:function(e){return e.adapter?e:{adapter:{type:"RefNameAliasAdapter"}}}}),cytobands:Object(E.ConfigurationSchema)("Cytoband",{adapter:e.pluggableConfigSchemaType("adapter")},{preProcessSnapshot:function(e){return e.adapter?e:{adapter:{type:"CytobandAdapter"}}}}),displayName:{type:"string",defaultValue:"",description:'A human readable display name for the assembly e.g. "Homo sapiens (hg38)" while the assembly name may just be "hg38"'}},{explicitIdentifier:"name"})},tf=Object(E.ConfigurationSchema)("MainThreadRpcDriver",{},{explicitlyTyped:!0}),nf=Object(E.ConfigurationSchema)("WebWorkerRpcDriver",{},{explicitlyTyped:!0}),rf=Object(E.ConfigurationSchema)("ElectronRpcDriver",{},{explicitlyTyped:!0}),af=Object(E.ConfigurationSchema)("RpcOptions",{defaultDriver:{type:"string",description:"the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend",defaultValue:"MainThreadRpcDriver"},drivers:b.types.optional(b.types.map(b.types.union(tf,nf,rf)),{MainThreadRpcDriver:{type:"MainThreadRpcDriver"}})},{actions:function(e){return{addDriverConfig:function(t,n){e.drivers.set(t,n)}}}}),of=n(1381),cf=n.n(of),sf=n(800);function uf(e){return"function"!==typeof e&&!(e instanceof Error)}function lf(e,t,n){return df.apply(this,arguments)}function df(){return(df=Object(i.a)(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){!function e(){setTimeout(Object(i.a)(d.a.mark((function o(){return d.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t.call("ping",[],{timeout:2*n,rpcDriverClassName:r});case 3:e(),o.next=9;break;case 6:o.prev=6,o.t0=o.catch(0),a(o.t0);case 9:case"end":return o.stop()}}),o,null,[[0,6]])}))),n)}()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ff=function(){function e(t){Object(m.a)(this,e),this.driver=t,this.worker=void 0}return Object(h.a)(e,[{key:"getWorker",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.worker){e.next=6;break}return e.next=3,this.driver.makeWorker(t);case 3:lf(r=e.sent,this.driver.maxPingTime,n).catch((function(e){a.worker&&(console.error("worker did not respond, killing and generating new one"),console.error(e),a.worker.destroy(),a.worker.status="killed",a.worker.error=e,a.worker=void 0)})),this.worker=r;case 6:return e.abrupt("return",this.worker);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),pf=function(){function e(t){Object(m.a)(this,e),this.name=void 0,this.lastWorkerAssignment=-1,this.workerAssignments=new Map,this.workerCount=0,this.workerPool=void 0,this.maxPingTime=3e4,this.workerCheckFrequency=5e3,this.config=void 0,this.config=t.config}return Object(h.a)(e,[{key:"filterArgs",value:function(e,t,n){var r=this;if(Array.isArray(e))return e.filter(uf).map((function(e){return r.filterArgs(e,t,n)}));if("object"===typeof e&&null!==e){if(e instanceof AbortSignal)return Object(sf.c)(e,this.remoteAbort.bind(this,t,n));if(Object(b.isStateTreeNode)(e)&&!Object(b.isAlive)(e))throw new Error("dead state tree node passed to RPC call");return e instanceof File?e:Object(U.objectFromEntries)(Object.entries(e).filter((function(e){return uf(e[1])})).map((function(e){var a=Object(u.a)(e,2),o=a[0],i=a[1];return[o,r.filterArgs(i,t,n)]})))}return e}},{key:"remoteAbort",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker(n,t);case 2:e.sent.call(r,{signalId:a},{timeout:1e6,rpcDriverClassName:this.name});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"createWorkerPool",value:function(){var e=this,t=function(){var e="undefined"!==typeof window,t=e&&"hardwareConcurrency"in window.navigator;return e&&t?window.navigator.hardwareConcurrency:1}(),n=this.workerCount||Math.max(1,Math.ceil((t-2)/3));return Object(o.a)(new Array(n)).map((function(){return new ff(e)}))}},{key:"getWorkerPool",value:function(){if(!this.workerPool){var e=this.createWorkerPool();return this.workerPool=e,e}return this.workerPool}},{key:"getWorker",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r,a,o,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getWorkerPool(),void 0===(a=this.workerAssignments.get(t))&&(o=(this.lastWorkerAssignment+1)%r.length,this.workerAssignments.set(t,o),this.lastWorkerAssignment=o,a=o),i=r[a].getWorker(n,this.name)){e.next=6;break}throw new Error("no web workers registered for RPC");case 6:return e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r,a){var o,i,s,u,l,f,p,g,m,h,b=this,v=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=v.length>4&&void 0!==v[4]?v[4]:{},n){e.next=3;break}throw new TypeError("sessionId is required");case 3:return i=!1,e.next=6,this.getWorker(n,t);case 6:return s=e.sent,u=t.getRpcMethodType(r),e.next=10,u.serializeArguments(a,this.name);case 10:return l=e.sent,f=this.filterArgs(l,t,n),p=s.call(r,f,Object(c.a)({timeout:3e5,statusCallback:a.statusCallback,rpcDriverClassName:this.name},o)).finally((function(){i=!0})),m=new Promise((function(e,t){g=setInterval((function(){"killed"===s.status?t(new Error("operation timed out, worker process stopped responding, ".concat(s.error))):i&&e(!0)}),b.workerCheckFrequency)})).finally((function(){clearInterval(g)})),h=Promise.race([p,m]),e.abrupt("return",u.deserializeReturn(h,a,this.name));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),e}(),gf=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(h.a)(n,[{key:"destroy",value:function(){this.workers[0].terminate()}},{key:"call",value:function(){var e=Object(i.a)(d.a.mark((function e(t,r,a){var o,i,s,u,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.statusCallback,i=a.rpcDriverClassName,s="message-".concat(pe.a.generate()),u=function(e){o&&o(e)},this.on(s,u),e.next=6,Object(F.a)(Object(D.a)(n.prototype),"call",this).call(this,t,Object(c.a)(Object(c.a)({},r),{},{channel:s,rpcDriverClassName:i}),a);case 6:return l=e.sent,this.off(s,u),e.abrupt("return",l);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(cf.a.Client),mf=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e,r){var a;return Object(m.a)(this,n),(a=t.call(this,e)).workerBootConfiguration=r,a.name="WebWorkerRpcDriver",a.WorkerClass=void 0,a.WorkerClass=e.WorkerClass,a}return Object(h.a)(n,[{key:"makeWorker",value:function(){var e=Object(i.a)(d.a.mark((function e(){var t,n,r=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new gf({workers:[new this.WorkerClass]}),n=new Promise((function(e,n){t.workers[0].onmessage=function(a){"ready"===a.data?e(t):"readyForConfig"===a.data?t.workers[0].postMessage(r.workerBootConfiguration):n()}})),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(pf),hf=function(){function e(){Object(m.a)(this,e)}return Object(h.a)(e,[{key:"destroy",value:function(){}},{key:"call",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n){var r=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>2&&void 0!==r[2]?r[2]:{},e.abrupt("return",void 0);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),bf=function(e){Object(P.a)(n,e);var t=Object(A.a)(n);function n(e){var r;return Object(m.a)(this,n),(r=t.call(this,e)).name="MainThreadRpcDriver",r.makeWorker=void 0,r.makeWorker=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new hf);case 1:case"end":return e.stop()}}),e)}))),r}return Object(h.a)(n,[{key:"call",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r,a){var o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new TypeError("sessionId is required");case 2:return o=t.getRpcMethodType(r),e.next=5,o.serializeArguments(a,this.name);case 5:return i=e.sent,e.next=8,o.execute(i,this.name);case 8:return c=e.sent,e.abrupt("return",o.deserializeReturn(c,a,this.name));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()}]),n}(pf),vf={WebWorkerRpcDriver:mf,MainThreadRpcDriver:bf},yf=function(){function e(t,n,r){if(Object(m.a)(this,e),this.pluginManager=t,this.mainConfiguration=n,this.backendConfigurations=r,this.driverObjects=void 0,!n)throw new Error("RpcManager requires at least a main configuration");this.driverObjects=new Map}return Object(h.a)(e,[{key:"getDriver",value:function(e){var t=this.driverObjects.get(e);if(t)return t;var n=this.backendConfigurations[e],r=vf[e];if(!r)throw new Error('requested RPC driver "'.concat(e,'" is not installed'));if(!n)throw new Error('requested RPC driver "'.concat(e,'" is missing config'));var a=new r(n,{plugins:this.pluginManager.runtimePluginDefinitions});return this.driverObjects.set(e,a),a}},{key:"getDriverForCall",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.rpcDriverName||Object(E.readConfObject)(this.mainConfiguration,"defaultDriver"),e.abrupt("return",this.getDriver(a));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"call",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r){var a,o,i=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.length>3&&void 0!==i[3]?i[3]:{},t){e.next=3;break}throw new Error("sessionId is required");case 3:return e.next=5,this.getDriverForCall(t,n,r);case 5:return o=e.sent,e.abrupt("return",o.call(this.pluginManager,t,n,r,a));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();yf.configSchema=af;var Of=function(){function e(t){Object(m.a)(this,e),this.pluginManager=t,this.adapterCache=void 0,this.adapterCache=new Bd.a({maxSize:15})}return Object(h.a)(e,[{key:"loadTextSearchAdapters",value:function(e){var t=this;return this.relevantAdapters(e).map((function(e){var n=Object(E.readConfObject)(e,"textSearchAdapterId");if(t.adapterCache.has(n))return t.adapterCache.get(n);var r=new(0,t.pluginManager.getTextSearchAdapterType(e.type).AdapterClass)(e,void 0,t.pluginManager);return t.adapterCache.set(n,r),r}))}},{key:"relevantAdapters",value:function(e){var t,n=null===(t=this.pluginManager.rootModel)||void 0===t?void 0:t.jbrowse,r=n.aggregateTextSearchAdapters,a=n.tracks,i=e.assemblyName;return[].concat(Object(o.a)(this.getAdaptersWithAssembly(i,r)),Object(o.a)(this.getAdaptersWithAssembly(i,a.map((function(e){return Object(E.readConfObject)(e,["textSearching","textSearchAdapter"])})))))}},{key:"getAdaptersWithAssembly",value:function(e,t){return t.filter((function(t){var n;return null===(n=Object(E.readConfObject)(t,"assemblyNames"))||void 0===n?void 0:n.includes(e)}))}},{key:"search",value:function(){var e=Object(i.a)(d.a.mark((function e(t,n,r){var a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.loadTextSearchAdapters(n),e.next=3,Promise.all(a.map((function(e){return e.searchIndex(t)})));case 3:return o=e.sent,e.abrupt("return",this.sortResults(o.flat(),r));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sortResults",value:function(e,t){return t(e.sort((function(e,t){return-t.getLabel().localeCompare(e.getLabel())}))).sort((function(e,t){return e.getScore()-t.getScore()}))}}]),e}(),wf=n(1390),jf=n.n(wf),kf=n(885),xf=n.n(kf),Cf=n(593),Sf=n.n(Cf),Tf=n(879),Ef=n.n(Tf),Mf=n(1391),Rf=n.n(Mf),Pf=n(1389),Af=n.n(Pf),Nf=n(1388),Lf=n.n(Nf);function If(e,t,n){var r=b.types.model("JBrowseWeb",{configuration:Object(E.ConfigurationSchema)("Root",Object(c.a)({rpc:yf.configSchema,highResolutionScaling:{type:"number",defaultValue:2},shareURL:{type:"string",defaultValue:"https://share.jbrowse.org/api/v1/"},featureDetails:Object(E.ConfigurationSchema)("FeatureDetails",{sequenceTypes:{type:"stringArray",defaultValue:["mRNA","transcript"]}}),disableAnalytics:{type:"boolean",defaultValue:!1},theme:{type:"frozen",defaultValue:{}},logoPath:{type:"fileLocation",defaultValue:{uri:"",locationType:"UriLocation"}}},e.pluginConfigurationSchemas())),plugins:b.types.array(b.types.frozen()),assemblies:b.types.array(n),tracks:b.types.array(e.pluggableConfigSchemaType("track")),internetAccounts:b.types.array(e.pluggableConfigSchemaType("internet account")),aggregateTextSearchAdapters:b.types.array(e.pluggableConfigSchemaType("text search adapter")),connections:b.types.array(e.pluggableConfigSchemaType("connection")),defaultSession:b.types.optional(b.types.frozen(t),{name:"New session"})}).views((function(e){return{get assemblyNames(){return e.assemblies.map((function(e){return Object(E.readConfObject)(e,"name")}))},get rpcManager(){return Object(b.getParent)(e).rpcManager}}})).actions((function(e){return{afterCreate:function(){var t=[];e.assemblyNames.forEach((function(e){if(!e)throw new Error('Encountered an assembly with no "name" defined');if(t.includes(e))throw new Error("Found two assemblies with the same name: ".concat(e));t.push(e)}))},addAssemblyConf:function(t){var n=t.name;if(!n)throw new Error('Can\'t add assembly with no "name"');var r=e.assemblies.find((function(e){return e.name===n}));if(r)return r;var a=e.assemblies.push(Object(c.a)(Object(c.a)({},t),{},{sequence:Object(c.a)({type:"ReferenceSequenceTrack",trackId:"".concat(n,"-").concat(Date.now())},t.sequence||{})}));return e.assemblies[a-1]},removeAssemblyConf:function(t){var n=e.assemblies.find((function(e){return e.name===t}));n&&e.assemblies.remove(n)},addTrackConf:function(t){var n=t.type;if(!n)throw new Error("unknown track type ".concat(n));var r=e.tracks.find((function(e){return e.trackId===t.trackId}));if(r)return r;var a=e.tracks.push(t);return e.tracks[a-1]},addDisplayConf:function(t,n){var r=n.type;if(!r)throw new Error("unknown display type ".concat(r));var a=e.tracks.find((function(e){return e.trackId===t}));if(!a)throw new Error("could not find track with id ".concat(t));return a.addDisplayConf(n)},addConnectionConf:function(t){var n=t.type;if(!n)throw new Error("unknown connection type ".concat(n));var r=e.connections.push(t);return e.connections[r-1]},deleteConnectionConf:function(t){var n=e.connections.findIndex((function(e){return e.id===t.id}));if(-1!==n)return e.connections.splice(n,1)},deleteTrackConf:function(t){var n=t.trackId,r=e.tracks.findIndex((function(e){return e.trackId===n}));if(-1!==r)return e.tracks.splice(r,1)},setDefaultSessionConf:function(t){var n;if(!(n=Object(b.getParent)(e).session.name===t.name?Object(b.getSnapshot)(t):Object(Ge.toJS)(t)).name)throw new Error("unable to set default session to ".concat(n.name));e.defaultSession=Object(b.cast)(n)},addPlugin:function(t){e.plugins.push(t),Object(b.getRoot)(e).setPluginsUpdated(!0)},removePlugin:function(t){e.plugins=Object(b.cast)(e.plugins.filter((function(e){return e.url!==t.url||e.umdUrl!==t.umdUrl||e.cjsUrl!==t.cjsUrl||e.esmUrl!==t.esmUrl}))),Object(b.getParent)(e).setPluginsUpdated(!0)},addInternetAccountConf:function(t){var n=t.type;if(!n)throw new Error("unknown internetAccount type ".concat(n));var r=e.internetAccounts.push(t);return e.internetAccounts[r-1]},deleteInternetAccountConf:function(t){var n=e.internetAccounts.findIndex((function(e){return e.id===t.id}));if(-1!==n)return e.internetAccounts.splice(n,1)}}}));return b.types.snapshotProcessor(r,{postProcessor:function(e){return function e(t,n){for(var r in t)r===n?delete t[r]:"object"===typeof t[r]&&e(t[r],n);return t}(so()(e),"baseUri")}})}window.getSnapshot=b.getSnapshot,window.resolveIdentifier=b.resolveIdentifier;var Ff=n(1387),Df=n.n(Ff);function Bf(e){return e.extend((function(){return function(e){return{views:{get snackbarMessages(){return e}},actions:{notify:function(e,t){var n=this;this.pushSnackbarMessage(e,t),"info"!==t&&"success"!==t||setTimeout((function(){n.removeSnackbarMessage(e)}),5e3)},pushSnackbarMessage:function(t,n){return e.push([t,n])},popSnackbarMessage:function(){return e.pop()},removeSnackbarMessage:function(t){var n=e.find((function(e){return e[0]===t}));n&&e.remove(n)}}}}(Ge.observable.array())}))}var Vf=n(257),zf=n.n(Vf),Wf=["connectionInstances"],Uf=Object(f.lazy)((function(){return n.e(49).then(n.bind(null,1736))}));function qf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.types.frozen(),n=128,r=b.types.model("JBrowseWebSessionModel",{id:b.types.optional(b.types.identifier,pe()()),name:b.types.string,margin:0,drawerWidth:b.types.optional(b.types.refinement(b.types.integer,(function(e){return e>=n})),384),views:b.types.array(e.pluggableMstType("view","stateModel")),widgets:b.types.map(e.pluggableMstType("widget","stateModel")),activeWidgets:b.types.map(b.types.safeReference(e.pluggableMstType("widget","stateModel"))),connectionInstances:b.types.array(e.pluggableMstType("connection","stateModel")),sessionTracks:b.types.array(e.pluggableConfigSchemaType("track")),sessionConnections:b.types.array(e.pluggableConfigSchemaType("connection")),sessionAssemblies:b.types.array(t),sessionPlugins:b.types.array(b.types.frozen()),minimized:b.types.optional(b.types.boolean,!1),drawerPosition:b.types.optional(b.types.string,localStorage.getItem("drawerPosition")||"right")}).volatile((function(){return{selection:void 0,task:void 0,queueOfDialogs:Ge.observable.array([])}})).views((function(e){return{get DialogComponent(){if(e.queueOfDialogs.length){var t=e.queueOfDialogs[0];return t&&t[0]}},get DialogProps(){if(e.queueOfDialogs.length){var t=e.queueOfDialogs[0];return t&&t[1]}},get shareURL(){return Object(E.getConf)(Object(b.getParent)(e).jbrowse,"shareURL")},get rpcManager(){return Object(b.getParent)(e).jbrowse.rpcManager},get configuration(){return Object(b.getParent)(e).jbrowse.configuration},get assemblies(){return Object(b.getParent)(e).jbrowse.assemblies},get assemblyNames(){return Object(b.getParent)(e).jbrowse.assemblyNames},get tracks(){return[].concat(Object(o.a)(e.sessionTracks),Object(o.a)(Object(b.getParent)(e).jbrowse.tracks))},get textSearchManager(){return Object(b.getParent)(e).textSearchManager},get connections(){return[].concat(Object(o.a)(e.sessionConnections),Object(o.a)(Object(b.getParent)(e).jbrowse.connections))},get adminMode(){return Object(b.getParent)(e).adminMode},get savedSessions(){return Object(b.getParent)(e).savedSessions},get previousAutosaveId(){return Object(b.getParent)(e).previousAutosaveId},get savedSessionNames(){return Object(b.getParent)(e).savedSessionNames},get history(){return Object(b.getParent)(e).history},get menus(){return Object(b.getParent)(e).menus},get assemblyManager(){return Object(b.getParent)(e).assemblyManager},get version(){return Object(b.getParent)(e).version},renderProps:function(){return{theme:Object(E.readConfObject)(this.configuration,"theme")}},get visibleWidget(){if(Object(b.isAlive)(e))return Array.from(e.activeWidgets.values())[e.activeWidgets.size-1]},getReferring:function(t){var n=[];return Object(b.walk)(Object(b.getParent)(e),(function(e){if(Object(b.isModelType)(Object(b.getType)(e))){var r=Object(b.getMembers)(e);Object.entries(r.properties).forEach((function(r){var a=Object(u.a)(r,2),o=a[0],i=a[1];Object(b.isReferenceType)(i)&&e[o]===t&&n.push({node:e,key:o})}))}})),n}}})).actions((function(t){return{setDrawerPosition:function(e){t.drawerPosition=e,localStorage.setItem("drawerPosition",e)},queueDialog:function(e){var n=e((function(){t.queueOfDialogs.shift()})),r=Object(u.a)(n,2),a=r[0],o=r[1];t.queueOfDialogs.push([a,o])},setName:function(e){t.name=e},addAssembly:function(e){var n=t.sessionAssemblies.find((function(t){return t.name===e.name}));if(n)return console.warn("Assembly ".concat(e.name," was already existing")),n;t.sessionAssemblies.push(e)},addSessionPlugin:function(e){if(t.sessionPlugins.find((function(t){return t.name===e.name})))throw new Error("session plugin cannot be installed twice");t.sessionPlugins.push(e),Object(b.getRoot)(t).setPluginsUpdated(!0)},removeAssembly:function(e){var n=t.sessionAssemblies.findIndex((function(t){return t.name===e}));-1!==n&&t.sessionAssemblies.splice(n,1)},removeSessionPlugin:function(e){t.sessionPlugins=Object(b.cast)(t.sessionPlugins.filter((function(t){return t.url!==e.url||t.umdUrl!==e.umdUrl||t.cjsUrl!==e.cjsUrl||t.esmUrl!==e.esmUrl}))),Object(b.getParent)(t).setPluginsUpdated(!0)},makeConnection:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type;if(!a)throw new Error("track configuration has no `type` listed");var o=Object(E.readConfObject)(n,"name"),i=e.getConnectionType(a);if(!i)throw new Error("unknown connection type ".concat(a));var s=Object(c.a)(Object(c.a)({},r),{},{name:o,type:a,configuration:n}),u=t.connectionInstances.push(s);return t.connectionInstances[u-1]},removeReferring:function(e,n,r,a){var o=this;e.forEach((function(e){var i=e.node,c=!1;try{var s="open track(s)",u=Object(U.getContainingView)(i);r.push((function(){return u.hideTrack(n.trackId)})),c=!0,a[s]||(a[s]=0),a[s]+=1}catch(d){}if(t.widgets.has(i.id)){var l="configuration editor widget(s)";r.push((function(){return o.hideWidget(i)})),c=!0,a[l]||(a[l]=0),a[l]+=1}if(!c)throw new Error("Error when closing this connection, the following node is still referring to a track configuration: ".concat(JSON.stringify(Object(b.getSnapshot)(i))))}))},prepareToBreakConnection:function(e){var n=this,r=[],a={},o=Object(E.readConfObject)(e,"name"),i=t.connectionInstances.find((function(e){return e.name===o}));if(i){i.tracks.forEach((function(e){var o=t.getReferring(e);n.removeReferring(o,e,r,a)}));return[function(){r.forEach((function(e){return e()})),n.breakConnection(e)},a]}},breakConnection:function(e){var n=Object(E.readConfObject)(e,"name"),r=t.connectionInstances.find((function(e){return e.name===n}));t.connectionInstances.remove(r)},deleteConnection:function(e){var n;if(t.adminMode&&(n=Object(b.getParent)(t).jbrowse.deleteConnectionConf(e)),!n){var r=e.connectionId,a=t.sessionConnections.findIndex((function(e){return e.connectionId===r}));if(-1===a)return;return t.sessionConnections.splice(a,1)}return n},updateDrawerWidth:function(e){if(e===t.drawerWidth)return t.drawerWidth;var r=e;return r<n&&(r=n),t.drawerWidth=r,r},resizeDrawer:function(e){"left"===t.drawerPosition&&(e*=-1);var n=t.drawerWidth;return n-this.updateDrawerWidth(n-e)},addView:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.getElementType("view",n);if(!a)throw new Error("unknown view type ".concat(n));var o=t.views.push(Object(c.a)(Object(c.a)({},r),{},{type:n}));return t.views[o-1]},removeView:function(e){var n,r=Object(g.a)(t.activeWidgets);try{for(r.s();!(n=r.n()).done;){var a=Object(u.a)(n.value,2)[1];a.view&&a.view.id===e.id&&this.hideWidget(a)}}catch(o){r.e(o)}finally{r.f()}t.views.remove(e)},addAssemblyConf:function(e){return Object(b.getParent)(t).jbrowse.addAssemblyConf(e)},addTrackConf:function(e){if(t.adminMode)return Object(b.getParent)(t).jbrowse.addTrackConf(e);var n=e.trackId,r=e.type;if(!r)throw new Error("unknown track type ".concat(r));var a=t.sessionTracks.find((function(e){return e.trackId===n}));if(a)return a;var o=t.sessionTracks.push(e);return t.sessionTracks[o-1]},deleteTrackConf:function(e){var n=[],r=t.getReferring(e);if(this.removeReferring(r,e,n,{}),n.forEach((function(e){return e()})),t.adminMode)return Object(b.getParent)(t).jbrowse.deleteTrackConf(e);var a=e.trackId,o=t.sessionTracks.findIndex((function(e){return e.trackId===a}));return-1!==o?t.sessionTracks.splice(o,1):void 0},addConnectionConf:function(e){if(t.adminMode)return Object(b.getParent)(t).jbrowse.addConnectionConf(e);var n=e.connectionId,r=e.type;if(!r)throw new Error("unknown connection type ".concat(r));var a=t.sessionTracks.find((function(e){return e.connectionId===n}));if(a)return a;var o=t.sessionConnections.push(e);return t.sessionConnections[o-1]},addLinearGenomeViewOfAssembly:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addViewOfAssembly("LinearGenomeView",e,t)},addViewOfAssembly:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.assemblies.find((function(e){return Object(E.readConfObject)(e,"name")===n}));if(!a)throw new Error('Could not add view of assembly "'.concat(n,'", assembly name not found'));return r.displayRegionsFromAssemblyName=Object(E.readConfObject)(a,"name"),this.addView(e,r)},addViewFromAnotherView:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object(c.a)({},n);return r.displayedRegions=Object(b.getSnapshot)(t.displayedRegions),this.addView(e,r)},addWidget:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{type:n},i=e.getElementType("widget",n);if(!i)throw new Error("unknown widget type ".concat(n));var s=Object(c.a)(Object(c.a)({},a),{},{id:r,type:n,configuration:o});return t.widgets.set(r,s),t.widgets.get(r)},showWidget:function(e){t.activeWidgets.has(e.id)&&t.activeWidgets.delete(e.id),t.activeWidgets.set(e.id,e),t.minimized=!1},hasWidget:function(e){return t.activeWidgets.has(e.id)},hideWidget:function(e){t.activeWidgets.delete(e.id)},minimizeWidgetDrawer:function(){t.minimized=!0},showWidgetDrawer:function(){t.minimized=!1},hideAllWidgets:function(){t.activeWidgets.clear()},setSelection:function(e){t.selection=e},clearSelection:function(){t.selection=void 0},clearConnections:function(){t.connectionInstances.length=0},addSavedSession:function(e){return Object(b.getParent)(t).addSavedSession(e)},removeSavedSession:function(e){return Object(b.getParent)(t).removeSavedSession(e)},renameCurrentSession:function(e){return Object(b.getParent)(t).renameCurrentSession(e)},duplicateCurrentSession:function(){return Object(b.getParent)(t).duplicateCurrentSession()},activateSession:function(e){return Object(b.getParent)(t).activateSession(e)},setDefaultSession:function(){return Object(b.getParent)(t).setDefaultSession()},saveSessionToLocalStorage:function(){return Object(b.getParent)(t).saveSessionToLocalStorage()},loadAutosaveSession:function(){return Object(b.getParent)(t).loadAutosaveSession()},setSession:function(e){return Object(b.getParent)(t).setSession(e)}}})).actions((function(e){return{editConfiguration:function(t){if(!Object(E.isConfigurationModel)(t))throw new Error("must pass a configuration model to editConfiguration");var n=e,r=n.addWidget("ConfigurationEditorWidget","configEditor",{target:t});n.showWidget(r)},editTrackConfiguration:function(t){if(!e.adminMode&&-1===e.sessionTracks.indexOf(t))throw new Error("Can't edit the configuration of a non-session track");this.editConfiguration(t)}}})).views((function(e){return{getTrackActionMenuItems:function(t){var n=e,r=n.adminMode||n.sessionTracks.find((function(e){return e.trackId===t.trackId})),a="ReferenceSequenceTrack"===Object(E.readConfObject)(t,"type");return[{label:"About track",onClick:function(){n.queueDialog((function(e){return[Uf,{config:t,handleClose:e}]}))},icon:Qc.a},{label:"Settings",disabled:!r,onClick:function(){n.editTrackConfiguration(t)},icon:id.a},{label:"Delete track",disabled:!r||a,onClick:function(){n.deleteTrackConf(t)},icon:zf.a},{label:"Copy track",disabled:a,onClick:function(){var e=JSON.parse(JSON.stringify(Object(b.getSnapshot)(t))),r=Date.now();e.trackId+="-".concat(r),e.displays.forEach((function(e){e.displayId+="-".concat(r)})),n.adminMode||(e.trackId+="-sessionTrack",e.category=void 0),e.name+=" (copy)",n.addTrackConf(e)},icon:xf.a}]}}}));return b.types.snapshotProcessor(Bf(r),{preProcessor:function(e){if(e){var t=e||{},n=t.connectionInstances,r=Object(s.a)(t,Wf);if(!Array.isArray(n))return r}return e}})}function Hf(e,t){if(void 0!==e)if(Object(b.isArrayType)(t))!function(){var t=e,n=Object(b.getChildType)(e);if(Object(b.isReferenceType)(n))for(var r=function(e){Object(b.isValidReference)((function(){return t[e]}))?e+=1:t.splice(e,1),a=e},a=0;a<t.length;)r(a);t.forEach((function(e){Hf(e,n)}))}();else if(Object(b.isMapType)(t))!function(){var t=e,n=Object(b.getChildType)(t);if(Object(b.isReferenceType)(n)){var r=function(e){Object(b.isValidReference)((function(){return t.get(e)}))||t.delete(e)};for(var a in t.keys())r(a)}t.forEach((function(e){Hf(e,n)}))}();else if(Object(b.isModelType)(t)){var n=Object(b.getPropertyMembers)(e).properties;Object.entries(n).forEach((function(t){var n=Object(u.a)(t,2),r=n[0],a=n[1];Hf(e[r],a)}))}}function _f(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ef(e),r=qf(e,n),a=Zd(n,e);return b.types.model("Root",{jbrowse:If(e,r,n),configPath:b.types.maybe(b.types.string),session:b.types.maybe(r),assemblyManager:a,version:b.types.maybe(b.types.string),internetAccounts:b.types.array(e.pluggableMstType("internet account","stateModel")),isAssemblyEditing:!1,isDefaultSessionEditing:!1}).volatile((function(t){return{pluginsUpdated:!1,rpcManager:new yf(e,t.jbrowse.configuration.rpc,{WebWorkerRpcDriver:{WorkerClass:Df.a},MainThreadRpcDriver:{}}),savedSessionsVolatile:Ge.observable.map({}),textSearchManager:new Of(e),pluginManager:e,error:void 0}})).views((function(e){return{get savedSessions(){return Array.from(e.savedSessionsVolatile.values())},localStorageId:function(t){return"localSaved-".concat(t,"-").concat(e.configPath)},get autosaveId(){return"autosave-".concat(e.configPath)},get previousAutosaveId(){return"previousAutosave-".concat(e.configPath)}}})).views((function(e){return{get savedSessionNames(){return e.savedSessions.map((function(e){return e.name}))},get currentSessionId(){var e,t=new URL(window.location.href),n=new URLSearchParams(t.search);return null===n||void 0===n||null===(e=n.get("session"))||void 0===e?void 0:e.split("local-")[1]}}})).actions((function(t){return{afterCreate:function(){var e=this;Object.entries(localStorage).filter((function(e){var t=Object(u.a)(e,2),n=t[0];t[1];return n.startsWith("localSaved-")})).filter((function(e){var n=Object(u.a)(e,2),r=n[0];n[1];return-1!==r.indexOf(t.configPath||"undefined")})).forEach((function(e){var n=Object(u.a)(e,2),r=n[0],a=n[1];try{var o=JSON.parse(a).session;t.savedSessionsVolatile.set(r,o)}catch(i){console.error("bad session encountered",r,a)}})),Object(b.addDisposer)(t,Object(Ge.autorun)((function(){var e,n=Object(g.a)(t.savedSessionsVolatile.entries());try{for(n.s();!(e=n.n()).done;){var r=Object(u.a)(e.value,2)[1];try{var a=t.localStorageId(r.name);localStorage.setItem(a,JSON.stringify({session:r}))}catch(o){"22"!==o.code&&"1024"!==o.code||alert('Local storage is full! Please use the "Open sessions" panel to remove old sessions')}}}catch(i){n.e(i)}finally{n.f()}}))),Object(b.addDisposer)(t,Object(Ge.autorun)((function(){if(t.session){var e=Object(b.getSnapshot)(t.session)||{name:"empty"};sessionStorage.setItem("current",JSON.stringify({session:e})),localStorage.setItem("autosave-".concat(t.configPath),JSON.stringify({session:Object(c.a)(Object(c.a)({},e),{},{name:"".concat(e.name,"-autosaved")})})),t.pluginsUpdated&&window.location.reload()}}),{delay:400})),Object(b.addDisposer)(t,Object(Ge.autorun)((function(){t.jbrowse.internetAccounts.forEach((function(t){e.initializeInternetAccount(t.internetAccountId)}))})))},setSession:function(e){var n=t.session;if(t.session=Object(b.cast)(e),t.session)try{Hf(t.session,Object(b.getType)(t.session))}catch(r){throw t.session=n,r}},initializeInternetAccount:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("internet account"),o=Object(b.resolveIdentifier)(a,t,n),i=e.getInternetAccountType(o.type);if(!i)throw new Error("unknown internet account type ".concat(o.type));var s=i.stateModel.create(Object(c.a)(Object(c.a)({},r),{},{type:o.type,configuration:o}));return t.internetAccounts.push(s),s},createEphemeralInternetAccount:function(n){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;try{r=new URL(o).origin}catch(d){}var i=n.split("-"),s={type:i[0],internetAccountId:n,name:i.slice(1).join("-"),description:"",domains:r?[r]:[]},u=e.getInternetAccountType(s.type),l=u.stateModel.create(Object(c.a)(Object(c.a)({},a),{},{type:s.type,configuration:s}));return t.internetAccounts.push(l),l},setAssemblyEditing:function(e){t.isAssemblyEditing=e},setDefaultSessionEditing:function(e){t.isDefaultSessionEditing=e},setPluginsUpdated:function(e){t.pluginsUpdated=e},setDefaultSession:function(){var e=t.jbrowse.defaultSession,n=Object(c.a)(Object(c.a)({},e),{},{name:"".concat(e.name," ").concat((new Date).toLocaleString())});this.setSession(n)},renameCurrentSession:function(e){if(t.session){var n=JSON.parse(JSON.stringify(Object(b.getSnapshot)(t.session)));n.name=e,this.setSession(n)}},addSavedSession:function(e){var n=t.localStorageId(e.name);t.savedSessionsVolatile.set(n,e)},removeSavedSession:function(e){var n=t.localStorageId(e.name);localStorage.removeItem(n),t.savedSessionsVolatile.delete(n)},duplicateCurrentSession:function(){if(t.session){var e=JSON.parse(JSON.stringify(Object(b.getSnapshot)(t.session))),n="".concat(t.session.name," (copy)");if(t.savedSessionNames.includes(n)){var r=2;do{n="".concat(t.session.name," (copy ").concat(r,")"),r+=1}while(t.savedSessionNames.includes(n))}e.name=n,this.setSession(e)}},activateSession:function(e){var n=t.localStorageId(e),r=localStorage.getItem(n);if(!r)throw new Error("Can't activate session ".concat(e,", it is not in the savedSessions"));this.setSession(JSON.parse(r).session)},saveSessionToLocalStorage:function(){if(t.session){var e=t.localStorageId(t.session.name);t.savedSessionsVolatile.set(e,Object(b.getSnapshot)(t.session))}},loadAutosaveSession:function(){var e=localStorage.getItem(t.previousAutosaveId),n=e?JSON.parse(e).session:{},r=n.name;n.name="".concat(r.replace("-autosaved",""),"-restored"),this.setSession(n)},setError:function(e){t.error=e},findAppropriateInternetAccount:function(e){var n=e.internetAccountId;if(n){var r=t.internetAccounts.find((function(e){return e.internetAccountId===n}));if(r)return r}var a,o=Object(g.a)(t.internetAccounts);try{for(o.s();!(a=o.n()).done;){var i=a.value;if(i.handlesLocation(e))return i}}catch(c){o.e(c)}finally{o.f()}return n?this.createEphemeralInternetAccount(n,{},e.uri):null}}})).volatile((function(e){return{history:{},menus:[{label:"File",menuItems:[{label:"New session",icon:Mo.a,onClick:function(t){var n=localStorage.getItem(e.autosaveId);n&&localStorage.setItem(e.previousAutosaveId,n),t.setDefaultSession()}},{label:"Import session\u2026",icon:Ef.a,onClick:function(e){var t=e.addWidget("ImportSessionWidget","importSessionWidget");e.showWidget(t)}},{label:"Export session",icon:Sf.a,onClick:function(e){var t=new Blob([JSON.stringify({session:Object(b.getSnapshot)(e)},null,2)],{type:"text/plain;charset=utf-8"});Object(Nd.saveAs)(t,"session.json")}},{label:"Open session\u2026",icon:eo.a,onClick:function(e){var t=e.addWidget("SessionManager","sessionManager");e.showWidget(t)}},{label:"Save session",icon:Lf.a,onClick:function(t){e.saveSessionToLocalStorage(),t.notify('Saved session "'.concat(t.name,'"'),"success")}},{label:"Duplicate session",icon:xf.a,onClick:function(e){e.duplicateCurrentSession&&e.duplicateCurrentSession()}},{type:"divider"},{label:"Open track...",icon:Af.a,onClick:function(e){if(0===e.views.length)e.notify("Please open a view to add a track first");else if(e.views.length>=1){var t=e.addWidget("AddTrackWidget","addTrackWidget",{view:e.views[0].id});e.showWidget(t),e.views.length>1&&e.notify("This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right")}}},{label:"Open connection...",icon:tn.a,onClick:function(e){var t=e.addWidget("AddConnectionWidget","addConnectionWidget");e.showWidget(t)}},{type:"divider"},{label:"Return to splash screen",icon:jf.a,onClick:function(){e.setSession(void 0)}}]}].concat(Object(o.a)(t?[{label:"Admin",menuItems:[{label:"Open assembly manager",icon:id.a,onClick:function(){e.setAssemblyEditing(!0)}},{label:"Set default session",icon:id.a,onClick:function(){e.setDefaultSessionEditing(!0)}}]}]:[]),[{label:"Add",menuItems:[]},{label:"Tools",menuItems:[{label:"Plugin store",icon:Rf.a,onClick:function(){if(e.session){var t=e.session.addWidget("PluginStoreWidget","pluginStoreWidget");e.session.showWidget(t)}}}]}]),adminMode:t}})).actions((function(e){return{setHistory:function(t){e.history=t},setMenus:function(t){e.menus=t},appendMenu:function(t){return e.menus.push({label:t,menuItems:[]})},insertMenu:function(t,n){return e.menus.splice((n<0?e.menus.length:0)+n,0,{label:t,menuItems:[]}),e.menus.length},appendToMenu:function(t,n){var r=e.menus.find((function(e){return e.label===t}));return r?r.menuItems.push(n):(e.menus.push({label:t,menuItems:[n]}),1)},insertInMenu:function(t,n,r){var a=e.menus.find((function(e){return e.label===t}));if(!a)return e.menus.push({label:t,menuItems:[n]}),1;var o=r<0?a.menuItems.length+r:r;return a.menuItems.splice(o,0,n),a.menuItems.length},appendToSubMenu:function(t,n){var r=e.menus.find((function(e){return e.label===t[0]}));if(!r){var a=this.appendMenu(t[0]);r=e.menus[a-1]}var o=r.menuItems,i=[t[0]];return t.slice(1).forEach((function(e){i.push(e);var t=o.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=o.push({label:e,subMenu:[]});t=o[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(i,'" is not a subMenu'));o=t.subMenu})),o.push(n)},insertInSubMenu:function(t,n,r){var a=e.menus.find((function(e){return e.label===t[0]}));if(!a){var o=this.appendMenu(t[0]);a=e.menus[o-1]}var i=a.menuItems,c=[t[0]];return t.slice(1).forEach((function(e){c.push(e);var t=i.find((function(t){return"label"in t&&t.label===e}));if(!t){var n=i.push({label:e,subMenu:[]});t=i[n-1]}if(!("subMenu"in t))throw new Error('"'.concat(e,'" in path "').concat(c,'" is not a subMenu'));i=t.subMenu})),i.splice(r,0,n),i.length}}}))}var Gf=n(1392);function Jf(){return Xf.apply(this,arguments)}function Xf(){return(Xf=Object(i.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.location=window.location.pathname;case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yf=n(1393);function Qf(e,t){if("object"===typeof e)for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n];"object"===typeof e[a]?Qf(e[a],t):"uri"===a&&(e.baseUri=t.href)}}function Kf(e,t,n){var r=e.configuration;return(void 0===r?{}:r)[t]||n}function $f(){return Zf.apply(this,arguments)}function Zf(){return(Zf=Object(i.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://jbrowse.org/plugin-store/plugins.json");case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("HTTP ".concat(t.status," ").concat(t.statusText," fetching plugins"));case 5:return e.abrupt("return",t.json());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ep(e){return tp.apply(this,arguments)}function tp(){return(tp=Object(i.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$f();case 2:return n=e.sent,e.abrupt("return",t.every((function(e){return Object(Yf.d)(e)?Boolean(n.plugins.find((function(t){return Object(Yf.d)(t)&&("url"in t&&"url"in e&&t.url===e.url||"umdUrl"in t&&"umdUrl"in e&&t.umdUrl===e.umdUrl)}))):Object(Yf.c)(e)?Boolean(n.plugins.find((function(t){return Object(Yf.c)(t)&&t.esmUrl===e.esmUrl}))):!!Object(Yf.b)(e)&&Boolean(n.plugins.find((function(t){return Object(Yf.b)(t)&&t.cjsUrl===e.cjsUrl})))})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var np=b.types.model({configPath:b.types.maybe(b.types.string),sessionQuery:b.types.maybe(b.types.string),password:b.types.maybe(b.types.string),adminKey:b.types.maybe(b.types.string),loc:b.types.maybe(b.types.string),sessionTracks:b.types.maybe(b.types.string),assembly:b.types.maybe(b.types.string),tracks:b.types.maybe(b.types.string)}).volatile((function(){return{blankSession:!1,sessionTriaged:void 0,shareWarningOpen:!1,configSnapshot:void 0,sessionSnapshot:void 0,sessionSpec:void 0,runtimePlugins:[],sessionPlugins:[],sessionError:void 0,configError:void 0,bc1:window.BroadcastChannel&&new window.BroadcastChannel("jb_request_session"),bc2:window.BroadcastChannel&&new window.BroadcastChannel("jb_respond_session")}})).views((function(e){return{get isSharedSession(){var t;return!(null===(t=e.sessionQuery)||void 0===t||!t.startsWith("share-"))},get isSpecSession(){var t;return!(null===(t=e.sessionQuery)||void 0===t||!t.startsWith("spec-"))},get isJb1StyleSession(){return!!e.loc},get isEncodedSession(){var t;return!(null===(t=e.sessionQuery)||void 0===t||!t.startsWith("encoded-"))},get isJsonSession(){var t;return!(null===(t=e.sessionQuery)||void 0===t||!t.startsWith("json-"))},get isLocalSession(){var t;return!(null===(t=e.sessionQuery)||void 0===t||!t.startsWith("local-"))},get ready(){return Boolean(this.isSessionLoaded&&!e.configError)},get error(){return e.configError||e.sessionError},get isSessionLoaded(){return Boolean(e.sessionError||e.sessionSnapshot||e.blankSession||e.sessionSpec)},get isConfigLoaded(){return Boolean(e.configError||e.configSnapshot)},get sessionTracksParsed(){return e.sessionTracks?JSON.parse(e.sessionTracks):[]}}})).actions((function(e){return{setSessionQuery:function(t){e.sessionQuery=t},setConfigError:function(t){e.configError=t},setSessionError:function(t){e.sessionError=t},setRuntimePlugins:function(t){e.runtimePlugins=t},setSessionPlugins:function(t){e.sessionPlugins=t},setConfigSnapshot:function(t){e.configSnapshot=t},setBlankSession:function(t){e.blankSession=t},setSessionTriaged:function(t){e.sessionTriaged=t},setSessionSnapshotSuccess:function(t){e.sessionSnapshot=t}}})).actions((function(e){return{fetchPlugins:function(t){return Object(i.a)(d.a.mark((function n(){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(r=new Yf.a(t.plugins)).installGlobalReExports(window),n.next=5,r.load();case 5:a=n.sent,e.setRuntimePlugins(Object(o.a)(a)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},fetchSessionPlugins:function(t){return Object(i.a)(d.a.mark((function n(){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,(r=new Yf.a(t.sessionPlugins||[])).installGlobalReExports(window),n.next=5,r.load();case 5:a=n.sent,e.setSessionPlugins(Object(o.a)(a)),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),console.error(n.t0),e.setConfigError(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})))()},setSessionSnapshot:function(t,n){var r=this;return Object(i.a)(d.a.mark((function a(){var o,i;return d.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,o=t.sessionPlugins,i=void 0===o?[]:o,a.next=4,ep(i);case 4:if(!a.sent&&!n){a.next=11;break}return a.next=8,r.fetchSessionPlugins(t);case 8:e.setSessionSnapshotSuccess(t),a.next=12;break;case 11:e.setSessionTriaged({snap:t,origin:"session",reason:i});case 12:a.next=18;break;case 14:a.prev=14,a.t0=a.catch(0),console.error(a.t0),e.setConfigError(a.t0);case 18:case"end":return a.stop()}}),a,null,[[0,14]])})))()},fetchConfig:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r,a,o,i,c,s;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.configPath,a=void 0===r?"config.json":r,n.next=3,Object($.openLocation)({uri:a,locationType:"UriLocation"}).readFile("utf8");case 3:if(o=n.sent,i=JSON.parse(o),c=new URL(a,window.location.href),Qf(i,c),c.hostname===window.location.hostname){n.next=21;break}return s=i.plugins||[],n.next=11,ep(s);case 11:if(n.sent){n.next=16;break}e.setSessionTriaged({snap:i,origin:"config",reason:s}),n.next=19;break;case 16:return n.next=18,t.fetchPlugins(i);case 18:e.setConfigSnapshot(i);case 19:n.next=24;break;case 21:return n.next=23,t.fetchPlugins(i);case 23:e.setConfigSnapshot(i);case 24:case"end":return n.stop()}}),n)})))()},fetchSessionStorageSession:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r,a,o,i,s;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=sessionStorage.getItem("current"),a=e.sessionQuery.replace("local-",""),!r){n.next=8;break}if(o=JSON.parse(r).session||{},a!==o.id){n.next=8;break}return n.next=7,t.setSessionSnapshot(o);case 7:return n.abrupt("return");case 8:if(!e.bc1){n.next=22;break}return e.bc1.postMessage(a),i=new Promise((function(t,n){e.bc2&&(e.bc2.onmessage=function(e){t(e.data)}),setTimeout((function(){return n()}),1e3)})),n.prev=11,n.next=14,i;case 14:return s=n.sent,n.next=17,e.setSessionSnapshot(Object(c.a)(Object(c.a)({},s),{},{id:pe()()}));case 17:return n.abrupt("return");case 20:n.prev=20,n.t0=n.catch(11);case 22:throw new Error("Local storage session not found");case 23:case"end":return n.stop()}}),n,null,[[11,20]])})))()},fetchSharedSession:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"https://share.jbrowse.org/api/v1/",n.next=3,jd("".concat(Kf(e.configSnapshot,"shareURL","https://share.jbrowse.org/api/v1/"),"load"),e.sessionQuery||"",e.password||"");case 3:return r=n.sent,n.t0=JSON,n.next=7,sd(r);case 7:return n.t1=n.sent,a=n.t0.parse.call(n.t0,n.t1),n.next=11,t.setSessionSnapshot(Object(c.a)(Object(c.a)({},a),{},{id:pe()()}));case 11:case"end":return n.stop()}}),n)})))()},decodeEncodedUrlSession:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=JSON,n.next=3,sd(e.sessionQuery.replace("encoded-",""));case 3:return n.t1=n.sent,r=n.t0.parse.call(n.t0,n.t1),n.next=7,t.setSessionSnapshot(Object(c.a)(Object(c.a)({},r),{},{id:pe()()}));case 7:case"end":return n.stop()}}),n)})))()},decodeSessionSpec:function(){e.sessionQuery&&(e.sessionSpec=JSON.parse(e.sessionQuery.replace("spec-","")))},decodeJb1StyleSession:function(){var t=e.loc,n=e.tracks,r=e.assembly,a=e.sessionTracksParsed;t&&(e.sessionSpec={sessionTracks:a,views:[{type:"LinearGenomeView",tracks:null===n||void 0===n?void 0:n.split(","),sessionTracks:a,loc:t,assembly:r}]})},decodeJsonUrlSession:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=JSON.parse(e.sessionQuery.replace("json-","")),n.next=3,t.setSessionSnapshot(Object(c.a)(Object(c.a)({},r.session),{},{id:pe()()}));case 3:case"end":return n.stop()}}),n)})))()},afterCreate:function(){var t=this;return Object(i.a)(d.a.mark((function n(){var r,a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{r=e.configPath,(a=localStorage.getItem("autosave-".concat(r)))&&localStorage.setItem("previousAutosave-".concat(r),a)}catch(o){console.error("failed to create previousAutosave",o)}return n.prev=1,n.next=4,t.fetchConfig();case 4:n.next=11;break;case 6:return n.prev=6,n.t0=n.catch(1),console.error(n.t0),e.setConfigError(n.t0),n.abrupt("return");case 11:Object(b.addDisposer)(e,Object(Ge.autorun)(Object(i.a)(d.a.mark((function n(){var r,a,o,i,c,s,u;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=e.isLocalSession,a=e.isEncodedSession,o=e.isSpecSession,i=e.isSharedSession,c=e.isJsonSession,s=e.isJb1StyleSession,u=e.sessionQuery,e.configSnapshot){n.next=4;break}return n.abrupt("return");case 4:if(!i){n.next=9;break}return n.next=7,t.fetchSharedSession();case 7:n.next=37;break;case 9:if(!o){n.next=13;break}t.decodeSessionSpec(),n.next=37;break;case 13:if(!s){n.next=17;break}t.decodeJb1StyleSession(),n.next=37;break;case 17:if(!a){n.next=22;break}return n.next=20,t.decodeEncodedUrlSession();case 20:n.next=37;break;case 22:if(!c){n.next=27;break}return n.next=25,t.decodeJsonUrlSession();case 25:n.next=37;break;case 27:if(!r){n.next=32;break}return n.next=30,t.fetchSessionStorageSession();case 30:n.next=37;break;case 32:if(!u){n.next=36;break}throw new Error("unrecognized session format");case 36:e.setBlankSession(!0);case 37:e.bc1&&(e.bc1.onmessage=function(t){var n=JSON.parse(sessionStorage.getItem("current")||"{}").session||{};n.id===t.data&&e.bc2&&e.bc2.postMessage(n)}),n.next=44;break;case 40:n.prev=40,n.t0=n.catch(0),console.error(n.t0),e.setSessionError(n.t0);case 44:case"end":return n.stop()}}),n,null,[[0,40]])})))));case 12:case"end":return n.stop()}}),n,null,[[1,6]])})))()}}}));var rp=["config"],ap=Object(f.lazy)((function(){return n.e(32).then(n.bind(null,1702))})),op=Object(f.lazy)((function(){return n.e(31).then(n.bind(null,1703))})),ip=Object(f.lazy)((function(){return Promise.resolve().then(n.bind(null,442))})),cp=Object(f.lazy)((function(){return n.e(33).then(n.bind(null,1741))}));function sp(){return p.a.createElement("div",null,p.a.createElement("h4",null,"Configuration not found. You may have arrived here if you requested a config that does not exist or you have not set up your JBrowse yet."),p.a.createElement("p",null,"If you want to complete your setup, visit our"," ",p.a.createElement("a",{href:"https://jbrowse.org/jb2/docs/quickstart_web"},"Quick start guide")),U.inDevelopment?p.a.createElement(p.a.Fragment,null,p.a.createElement("div",null,"Sample JBrowse configs:"),p.a.createElement("ul",null,[["test_data/volvox/config.json","Volvox sample data"],["test_data/config.json","Human basic"],["test_data/config_demo.json","Human sample data"],["test_data/tomato/config.json","Tomato SVs"],["test_data/breakpoint/config.json","Breakpoint"],["test_data/config_dotplot.json","Grape/Peach dotplot"],["test_data/config_synteny_grape_peach.json","Grape/Peach synteny"],["test_data/yeast_synteny/config.json","Yeast synteny"],["test_data/config_many_contigs.json","Many contigs"],["test_data/config_honeybee.json","Honeybee"],["test_data/config_wormbase.json","Wormbase"],["test_data/wgbs/config.json","WGBS methylation"]].map((function(e){var t=Object(u.a)(e,2),n=t[0],r=t[1],a=window.location,o=a.href,i=a.search,l=de.a.parse(i),d=(l.config,Object(s.a)(l,rp)),f=o.split("?")[0],g=de.a.stringify(Object(c.a)(Object(c.a)({},d),{},{config:n}));return p.a.createElement("li",{key:r},p.a.createElement("a",{href:"".concat(f,"?").concat(g)},r))})))):p.a.createElement(p.a.Fragment,null,p.a.createElement("div",null,"Sample JBrowse config:"),p.a.createElement("ul",null,p.a.createElement("li",null,p.a.createElement("a",{href:"?config=test_data/volvox/config.json"},"Volvox sample data")))))}function up(e){var t=e.initialTimestamp,n=void 0===t?Date.now():t,r=function(e){return null===e?void 0:e},a=se.b,o=Object(se.c)("config",a),i=Object(u.a)(o,1)[0],c=Object(se.c)("session",a),s=Object(u.a)(c,1)[0],l=Object(se.c)("adminKey",a),d=Object(u.a)(l,1)[0],g=Object(se.c)("password",a),m=Object(u.a)(g,2),h=m[0],b=m[1],v=Object(se.c)("loc",a),y=Object(u.a)(v,2),O=y[0],w=y[1],j=Object(se.c)("sessionTracks",a),k=Object(u.a)(j,2),x=k[0],C=k[1],S=Object(se.c)("assembly",a),T=Object(u.a)(S,2),E=T[0],M=T[1],R=Object(se.c)("tracks",a),P=Object(u.a)(R,2),A=P[0],N=P[1],L=np.create({configPath:r(i),sessionQuery:r(s),password:r(h),adminKey:r(d),loc:r(O),assembly:r(E),tracks:r(A),sessionTracks:r(x)});return Object(f.useEffect)((function(){w(void 0),N(void 0),M(void 0),b(void 0),C(void 0)}),[M,w,N,b,C]),p.a.createElement(pp,{loader:L,initialTimestamp:n,initialSessionQuery:s})}var lp=function(e){var t=e.loader,n=e.handleClose;return p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null)},p.a.createElement(ap,{onConfirm:Object(i.a)(d.a.mark((function e(){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(JSON.stringify(t.sessionTriaged.snap)),e.next=3,t.setSessionSnapshot(Object(c.a)(Object(c.a)({},r),{},{id:pe()()}),!0);case 3:n();case 4:case"end":return e.stop()}}),e)}))),onCancel:function(){t.setBlankSession(!0),n()},reason:t.sessionTriaged.reason}))},dp=function(e){var t=e.err;return p.a.createElement(p.a.Fragment,null,p.a.createElement(sp,null),"".concat(t).match(/HTTP 404 fetching config.json/)?p.a.createElement("div",{style:{margin:8,padding:8,border:"1px solid black",background:"#9f9"}},"No config.json found. If you want to learn how to complete your setup, visit our"," ",p.a.createElement("a",{href:"https://jbrowse.org/jb2/docs/quickstart_web"},"Quick start guide")):p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null,"Loading...")},p.a.createElement(ip,{error:t})))};function fp(e){var t=e.loader,n=e.handleClose;return p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null)},p.a.createElement(op,{onConfirm:Object(i.a)(d.a.mark((function e(){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(JSON.stringify(t.sessionTriaged.snap)),e.next=3,t.fetchPlugins(r);case 3:t.setConfigSnapshot(Object(c.a)(Object(c.a)({},r),{},{id:pe()()})),n();case 5:case"end":return e.stop()}}),e)}))),onCancel:function(){Jf(),n()},reason:t.sessionTriaged.reason}))}var pp=Object(ie.observer)((function(e){var t=e.loader,n=e.initialTimestamp,r=e.initialSessionQuery,a=t.sessionError,s=t.configError,l=t.ready,g=t.shareWarningOpen,m=Object(f.useState)(),h=Object(u.a)(m,2),b=h[0],v=h[1],y=Object(f.useState)(),O=Object(u.a)(y,2),w=O[0],j=O[1];Object(f.useEffect)((function(){try{var e=t.runtimePlugins,s=t.sessionPlugins,u=t.adminKey,f=t.configSnapshot,p=t.sessionSnapshot,m=t.configPath,h=t.sessionSpec;if(l){var b=new oe([].concat(Object(o.a)(Jl.map((function(e){return{plugin:new e,metadata:{isCore:!0}}}))),Object(o.a)(e.map((function(e){var t=e.plugin,n=e.definition;return{plugin:new t,definition:n,metadata:{url:n.url}}}))),Object(o.a)(s.map((function(e){var t=e.plugin,n=e.definition;return{plugin:new t,definition:n,metadata:{url:n.url}}})))));b.createPluggableElements();var y=_f(b,!!u);if(f){var O,w,k,x=y.create({jbrowse:f,assemblyManager:{},version:Gf.a,configPath:m},{pluginManager:b});x.jbrowse.configuration.rpc.addDriverConfig("WebWorkerRpcDriver",{type:"WebWorkerRpcDriver"}),null!==(O=t.configSnapshot)&&void 0!==O&&null!==(w=O.configuration)&&void 0!==w&&null!==(k=w.rpc)&&void 0!==k&&k.defaultDriver||x.jbrowse.configuration.rpc.defaultDriver.set("WebWorkerRpcDriver");var C=function(){};try{var S,T;a?(x.setDefaultSession(),x.session&&x.session.notify("Error loading session: ".concat(a,'. If you\n                received this URL from another user, request that they send you\n                a session generated with the "Share" button instead of copying\n                and pasting their URL'))):p&&!g?x.setSession(p):h?C=function(e,t){var n=e.views,r=e.sessionTracks;return Object(i.a)(d.a.mark((function e(){var a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.rootModel){e.next=3;break}throw new Error("rootModel not initialized");case 3:return e.prev=3,a.setSession({name:"New session ".concat((new Date).toLocaleString())}),r.forEach((function(e){return a.session.addTrackConf(e)})),e.next=8,Promise.all(n.map((function(e){return t.evaluateAsyncExtensionPoint("LaunchView-"+e.type,Object(c.a)(Object(c.a)({},e),{},{session:a.session}))})));case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error(e.t0),null===(o=a.session)||void 0===o||o.notify("".concat(e.t0));case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))}(h,b):null!==(S=x.jbrowse.defaultSession)&&void 0!==S&&null!==(T=S.views)&&void 0!==T&&T.length&&x.setDefaultSession()}catch(R){var E;x.setDefaultSession();var M="".concat(R).replace("[mobx-state-tree] ","").replace(/\(.+/,"");null===(E=x.session)||void 0===E||E.notify("Session could not be loaded. ".concat(M.length>1e3?"".concat(M.slice(0,1e3),"...see more in console"):M)),console.error(R)}he(x,n,r),b.setRootModel(x),b.configure(),v(b),C()}}}catch(R){j(R),console.error(R)}}),[t,g,l,a,n,r]);var k,x=s||w;return x?p.a.createElement(dp,{err:x}):t.sessionTriaged?"session"===t.sessionTriaged.origin?p.a.createElement(lp,{loader:t,handleClose:function(){return t.setSessionTriaged(void 0)}}):p.a.createElement(fp,{loader:t,handleClose:function(){return t.setSessionTriaged(void 0)}}):b?null!==(k=b.rootModel)&&void 0!==k&&k.session?p.a.createElement(Ad,{pluginManager:b}):p.a.createElement(f.Suspense,{fallback:p.a.createElement("div",null,"Loading...")},p.a.createElement(cp,{rootModel:b.rootModel,onFactoryReset:Jf})):p.a.createElement(be.a,null)})),gp=function(e){return p.a.createElement(ue.FatalErrorDialog,Object.assign({resetButtonText:"Reset Session",onFactoryReset:Jf},e))};t.default=function(e){var t=e.initialTimestamp;return p.a.createElement(ce.ErrorBoundary,{FallbackComponent:gp},p.a.createElement(se.a,null,p.a.createElement(up,{initialTimestamp:t})))}},79:function(e,t,n){"use strict";n.r(t);var r=n(264);n.d(t,"ConfigurationSchema",(function(){return r.b})),n.d(t,"ConfigurationReference",(function(){return r.a}));var a=n(568);n.d(t,"readConfObject",(function(){return a.g})),n.d(t,"getConf",(function(){return a.a})),n.d(t,"getTypeNamesFromExplicitlyTypedUnion",(function(){return a.b})),n.d(t,"isBareConfigurationSchemaType",(function(){return a.c})),n.d(t,"isConfigurationSchemaType",(function(){return a.e})),n.d(t,"isConfigurationModel",(function(){return a.d})),n.d(t,"isConfigurationSlotType",(function(){return a.f}))},793:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var r=n(83),a=n(80),o=n.n(a),i=n(107),c=n(424);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.timeout,r=t.signal,a=t.name;return new Promise((function(t,o){var s,u=!1,l=Object(i.when)(e),d=function(){};n&&(s=setTimeout((function(){u||(u=!0,l.cancel(),o(new Error("timed out waiting for ".concat(a||"whenPresent"))))}),n),d=function(){return s&&clearTimeout(s)}),r&&r.addEventListener("abort",(function(){u||(u=!0,l.cancel(),d(),o(Object(c.d)()))})),l.then((function(){u||(u=!0,d(),t(!0))})).catch((function(e){u||(u=!0,d(),o(e))}))}))}function u(e){return l.apply(this,arguments)}function l(){return l=Object(r.a)(o.a.mark((function e(t){var n,r=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,s((function(){var e=t();return void 0!==e&&null!==e}),n);case 3:return e.abrupt("return",t());case 4:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}},796:function(e,t,n){"use strict";var r=n(1246),a=n.n(r);t.a=function(){var e=new a.a.Jexl;return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("parent",(function(e){return e.parent()})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("endsWith",(function(e,t,n){return e.endsWith(t,n)})),e.addFunction("padEnd",(function(e,t,n){return e.padEnd(t,n)})),e.addFunction("padStart",(function(e,t,n){return e.padStart(t,n)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,n){return e.replace(t,n)})),e.addFunction("replaceAll",(function(e,t,n){return e.replaceAll(t,n)})),e.addFunction("slice",(function(e,t,n){return e.slice(t,n)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("substring",(function(e,t,n){return e.substring(t,n)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e}},800:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var r=0,a=new WeakMap;function o(e,t){var n=a.get(e);return n||(r+=1,a.set(e,r),n=r,e.addEventListener("abort",(function(){var n=a.get(e);void 0!==n&&t("signalAbort",n)}))),{abortSignalId:n}}function i(e){return"object"===typeof e&&null!==e&&"abortSignalId"in e&&"number"===typeof e.abortSignalId}var c=new Map;function s(e){var t=e.abortSignalId,n=c.get(t);return n||(n=new AbortController,c.set(t,n)),n.signal}},805:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return f}));var r=n(83),a=n(86),o=n(80),i=n.n(o),c=n(335);function s(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0===n?0:(a?r=t/n-e*e/(n*n):(r=t-e*e/n,n>1&&(r/=n-1)),r<0?0:Math.sqrt(r))}function u(e){return Object(a.a)(Object(a.a)({},e),{},{scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:s(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered})}function l(e,t){return d.apply(this,arguments)}function d(){return(d=Object(r.a)(i.a.mark((function e(t,n){var r,a,o,s,l,d,f,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.start,a=t.end,e.next=3,n.pipe(Object(c.a)((function(e,t){var n=t.get("score");return e.scoreMax=Math.max(e.scoreMax,t.get("summary")?t.get("maxScore"):n),e.scoreMin=Math.min(e.scoreMin,t.get("summary")?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,e}),{scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0})).toPromise();case 3:return o=e.sent,s=o.scoreMin,l=o.scoreMax,d=o.scoreSum,f=o.scoreSumSquares,p=o.featureCount,e.abrupt("return",u({scoreMax:l,scoreMin:s,scoreSum:d,scoreSumSquares:f,featureCount:p,basesCovered:a-r+1}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},806:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(82);function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Object.keys(e),o=0;o<n.length;o++){var i=n[o];if(t.length>5e3)break;"object"===typeof e[i]&&e[i]?t+=a(e[i],t):t+="".concat(i,"-").concat(e[i],";")}return Object(r.hashCode)(t)}},819:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(82),a=n(286);function o(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"undefined"!==typeof window&&window.innerWidth||e.width,c=e.offsetPx,s=e.displayedRegions,u=e.bpPerPx,l=e.minimumBlockWidth,d=e.interRegionPaddingWidth,f=c*u,p=(c+i)*u,g=i,m=Math.ceil(g*u),h=0,b=new a.a;return s.forEach((function(e,c){var g=e.assemblyName,v=e.refName,y=e.start,O=e.end,w=e.reversed,j=Math.ceil((O-y)/m),k=Math.floor((p-h)/m)+o;k>=j&&(k=j-1);var x=Math.floor((f-h)/m)-o;x<0&&(x=0);for(var C=(O-y)/u,S=x;S<=k;S+=1){var T=void 0,E=void 0,M=void 0,R=void 0;w?(T=Math.max(y,O-(S+1)*m),M=(E=O-S*m)===O,R=T===y):(M=(T=y+S*m)===y,R=(E=Math.min(O,y+(S+1)*m))===O);var P={assemblyName:g,refName:v,start:T,end:E,reversed:w,offsetPx:(h+S*m)/u,parentRegion:e,regionNumber:c,widthPx:(E-T)/u,isLeftEndOfDisplayedRegion:M,isRightEndOfDisplayedRegion:R,key:""};P.key="".concat(Object(r.assembleLocString)(P),"-").concat(c).concat(w?"-reversed":""),t&&0===c&&0===S&&b.push(new a.d({key:"".concat(P.key,"-beforeFirstRegion"),widthPx:i,offsetPx:P.offsetPx-i,variant:"boundary"})),n&&C<l?b.push(new a.c(P)):b.push(new a.b(P)),t&&(C>=l&&P.isRightEndOfDisplayedRegion&&c<s.length-1&&(h+=d*u,b.push(new a.d({key:"".concat(P.key,"-rightpad"),widthPx:d,offsetPx:P.offsetPx+P.widthPx}))),c===s.length-1&&P.isRightEndOfDisplayedRegion&&(h+=d*u,b.push(new a.d({key:"".concat(P.key,"-afterLastRegion"),widthPx:i,offsetPx:P.offsetPx+P.widthPx,variant:"boundary"}))))}h+=O-y})),b}},82:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"inDevelopment",(function(){return x})),n.d(t,"inProduction",(function(){return C})),n.d(t,"useDebounce",(function(){return S})),n.d(t,"useDebouncedCallback",(function(){return T})),n.d(t,"findParentThat",(function(){return E})),n.d(t,"springAnimate",(function(){return M})),n.d(t,"findParentThatIs",(function(){return R})),n.d(t,"getSession",(function(){return P})),n.d(t,"getContainingView",(function(){return A})),n.d(t,"getContainingTrack",(function(){return N})),n.d(t,"getContainingDisplay",(function(){return L})),n.d(t,"assembleLocString",(function(){return I})),n.d(t,"parseLocStringOneBased",(function(){return F})),n.d(t,"parseLocString",(function(){return D})),n.d(t,"compareLocs",(function(){return B})),n.d(t,"compareLocStrings",(function(){return V})),n.d(t,"clamp",(function(){return z})),n.d(t,"bpToPx",(function(){return U})),n.d(t,"radToDeg",(function(){return _})),n.d(t,"degToRad",(function(){return G})),n.d(t,"polarToCartesian",(function(){return J})),n.d(t,"cartesianToPolar",(function(){return X})),n.d(t,"featureSpanPx",(function(){return Y})),n.d(t,"bpSpanPx",(function(){return Q})),n.d(t,"objectFromEntries",(function(){return K})),n.d(t,"iterMap",(function(){return $})),n.d(t,"mergeConfigs",(function(){return Z})),n.d(t,"findLastIndex",(function(){return ee})),n.d(t,"makeAbortableReaction",(function(){return te})),n.d(t,"renameRegionIfNeeded",(function(){return ne})),n.d(t,"renameRegionsIfNeeded",(function(){return re})),n.d(t,"minmax",(function(){return oe})),n.d(t,"stringify",(function(){return ie})),n.d(t,"isElectron",(function(){return ce})),n.d(t,"revcom",(function(){return se})),n.d(t,"complement",(function(){return ue})),n.d(t,"blobToDataURL",(function(){return le})),n.d(t,"rIC",(function(){return de})),n.d(t,"measureText",(function(){return fe})),n.d(t,"defaultStarts",(function(){return pe})),n.d(t,"defaultStops",(function(){return ge})),n.d(t,"defaultCodonTable",(function(){return me})),n.d(t,"generateCodonTable",(function(){return he})),n.d(t,"updateStatus",(function(){return be})),n.d(t,"hashCode",(function(){return ye})),n.d(t,"objectHash",(function(){return Oe})),n.d(t,"bytesForRegions",(function(){return we})),n.d(t,"viewBpToPx",(function(){return ke})),n.d(t,"getBpDisplayStr",(function(){return xe}));var r=n(86),a=n(83),o=n(103),i=n(12),c=n(29),s=n(80),u=n.n(s),l=n(85),d=n(107),f=n(558),p=n.n(f),g=n(1),m=n(790),h=n.n(m),b=n(119);n.d(t,"SimpleFeature",(function(){return b.a})),n.d(t,"isFeature",(function(){return b.b}));var v=n(177),y=n(424);n.d(t,"isViewContainer",(function(){return v.q})),n.d(t,"isSessionModel",(function(){return v.i})),n.d(t,"isSessionModelWithConfigEditing",(function(){return v.j})),n.d(t,"isSessionWithAddTracks",(function(){return v.l})),n.d(t,"isSessionModelWithWidgets",(function(){return v.k})),n.d(t,"isSessionWithSessionPlugins",(function(){return v.m})),n.d(t,"isSelectionContainer",(function(){return v.h})),n.d(t,"isViewModel",(function(){return v.r})),n.d(t,"isTrackModel",(function(){return v.n})),n.d(t,"isDisplayModel",(function(){return v.f})),n.d(t,"isTrackViewModel",(function(){return v.o})),n.d(t,"isAppRootModel",(function(){return v.d})),n.d(t,"isAbstractMenuManager",(function(){return v.c})),n.d(t,"isUriLocation",(function(){return v.p})),n.d(t,"AuthNeededError",(function(){return v.a})),n.d(t,"RetryError",(function(){return v.b})),n.d(t,"isAuthNeededException",(function(){return v.e})),n.d(t,"isRetryException",(function(){return v.g})),n.d(t,"checkAbortSignal",(function(){return y.b})),n.d(t,"abortBreakPoint",(function(){return y.a})),n.d(t,"makeAbortError",(function(){return y.d})),n.d(t,"observeAbortSignal",(function(){return y.e})),n.d(t,"isAbortException",(function(){return y.c}));var O=n(793);n.d(t,"when",(function(){return O.a})),n.d(t,"whenPresent",(function(){return O.b}));var w=n(229);n.d(t,"intersection2",(function(){return w.b})),n.d(t,"doesIntersect2",(function(){return w.a})),n.d(t,"isContainedWithin",(function(){return w.c}));var j=n(328);n.d(t,"createCanvas",(function(){return j.d})),n.d(t,"createImageBitmap",(function(){return j.e})),n.d(t,"ImageBitmapType",(function(){return j.a})),n.d(t,"PonyfillOffscreenContext",(function(){return j.c})),n.d(t,"PonyfillOffscreenCanvas",(function(){return j.b}));var k=n(329);n.d(t,"renderToAbstractCanvas",(function(){return k.a})),Object.fromEntries||p.a.shim();var x="object"===typeof e&&Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})&&!1,C=!x;function S(e,t){var n=Object(g.useState)(e),r=Object(c.a)(n,2),a=r[0],o=r[1];return Object(g.useEffect)((function(){var n=setTimeout((function(){o(e)}),t);return function(){clearTimeout(n)}}),[e,t]),a}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=Object(g.useRef)(),r=Object(g.useRef)();function a(){r.current&&clearTimeout(r.current)}return Object(g.useEffect)((function(){return a}),[]),function(){for(var o=arguments.length,c=new Array(o),s=0;s<o;s++)c[s]=arguments[s];n.current=c,a(),r.current=setTimeout((function(){n.current&&e.apply(void 0,Object(i.a)(n.current))}),t)}}function E(e,t){if(!Object(l.hasParent)(e))throw new Error("node does not have parent");for(var n=Object(l.getParent)(e);n&&Object(l.isAlive)(n);){if(t(n))return n;if(!Object(l.hasParent)(n))break;n=Object(l.getParent)(n)}throw new Error("no matching node found")}function M(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:170,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:26,s=1;function u(e){var l=Date.now(),d=e.lastPosition,f=e.lastTime||l,p=e.lastVelocity||0;l>f+64&&(f=l);for(var g=Math.floor(l-f),m=0;m<g;++m){d+=1*(p+=1*((-i*(d-t)+-c*p)/s)/1e3)/1e3}var h=Math.abs(p)<=o,b=0===i||Math.abs(t-d)<=o;h&&b?(n(t),a()):(n(d),r=requestAnimationFrame((function(){return u({lastPosition:d,lastTime:l,lastVelocity:p})})))}return o||(o=Math.abs(t-e)/1e3),[function(){return u({lastPosition:e})},function(){return cancelAnimationFrame(r)}]}function R(e,t){return E(e,t)}function P(e){try{return R(e,v.i)}catch(t){throw new Error("no session model found!")}}function A(e){try{return R(e,v.r)}catch(t){throw new Error("no containing view found")}}function N(e){try{return R(e,v.n)}catch(t){throw new Error("no containing track found")}}function L(e){try{return R(e,v.f)}catch(t){throw new Error("no containing display found")}}function I(e){var t,n,r=e.assemblyName,a=e.refName,o=e.start,i=e.end,c=e.reversed,s=r?"{".concat(r,"}"):"";t=void 0!==o?":".concat((o+1).toLocaleString("en-US")):void 0!==i?":1":"",n=void 0!==i?void 0!==o&&o+1===i?"":"..".concat(i.toLocaleString("en-US")):void 0!==o?"..":"";var u="";return c&&(u="[rev]"),"".concat(s).concat(a).concat(t).concat(n).concat(u)}function F(e,t){if(!e)throw new Error("no location string provided, could not parse");var n=!1;e.endsWith("[rev]")&&(n=!0,e=e.replace(/\[rev\]$/,""));var r=(e=e.replace(/\s/,"")).match(/(\{(.+)\})?(.+)/);if(!r)throw new Error('invalid location string: "'.concat(e,'"'));var a=Object(c.a)(r,4),o=a[2],i=a[3];if(!o&&i.startsWith("{}"))throw new Error('no assembly name was provided in location "'.concat(i,'"'));var s=i.lastIndexOf(":");if(-1===s){if(t(i,o))return{assemblyName:o,refName:i,reversed:n};throw new Error('Unknown reference sequence "'.concat(i,'"'))}var u=i.slice(0,s),l=i.slice(s+1);if(t(u,o)&&t(i,o))throw new Error('ambiguous location string: "'.concat(e,'"'));if(t(u,o)){if(!l)return{assemblyName:o,refName:u,reversed:n};var d=l.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)(-?(\d+|\d{1,3}(,\d{3})*))$/),f=l.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)?$/);if(d){var p=Object(c.a)(d,6),g=p[1],m=p[5];if(void 0!==g&&void 0!==m)return{assemblyName:o,refName:u,start:+g.replace(/,/g,""),end:+m.replace(/,/g,""),reversed:n}}else{if(!f)throw new Error('could not parse range "'.concat(l,'" on location "').concat(e,'"'));var h=Object(c.a)(f,5),b=h[1],v=h[4];if(void 0!==b)return v?{assemblyName:o,refName:u,start:+b.replace(/,/g,""),reversed:n}:{assemblyName:o,refName:u,start:+b.replace(/,/g,""),end:+b.replace(/,/g,""),reversed:n}}}else if(t(i,o))return{assemblyName:o,refName:i,reversed:n};throw new Error('unknown reference sequence name in location "'.concat(e,'"'))}function D(e,t){var n=F(e,t);return"number"===typeof n.start&&(n.start-=1),n}function B(e,t){var n=e.assemblyName||t.assemblyName?(e.assemblyName||"").localeCompare(t.assemblyName||""):0;if(n)return n;var r=e.refName||t.refName?(e.refName||"").localeCompare(t.refName||""):0;if(r)return r;if(void 0!==e.start&&void 0!==t.start){var a=e.start-t.start;if(a)return a}if(void 0!==e.end&&void 0!==t.end){var o=e.end-t.end;if(o)return o}return 0}function V(e,t,n){return B(D(e,n),D(t,n))}function z(e,t,n){return e<t?t:e>n?n:e}function W(e){return Math.round(10*e)/10}function U(e,t,n){return t.reversed?W((t.end-e)/n):W((e-t.start)/n)}var q=180/Math.PI,H=Math.PI/180;function _(e){return e*q%360}function G(e){return e*H%(2*Math.PI)}function J(e,t){return[e*Math.cos(t),e*Math.sin(t)]}function X(e,t){return[Math.sqrt(e*e+t*t),Math.atan(t/e)]}function Y(e,t,n){return Q(e.get("start"),e.get("end"),t,n)}function Q(e,t,n,r){var a=U(e,n,r),o=U(t,n,r);return n.reversed?[o,a]:[a,o]}var K=Object.fromEntries.bind(Object);function $(e,t,n){var r,a=n?new Array(n):[],i=0,c=Object(o.a)(e);try{for(c.s();!(r=c.n()).done;){var s=r.value;a[i]=t(s),i+=1}}catch(u){c.e(u)}finally{c.f()}return a}function Z(e,t){var n=h()(e,t);return t.defaultSession?n.defaultSession=t.defaultSession:e.defaultSession&&(n.defaultSession=e.defaultSession),n}function ee(e,t){for(var n=e.length;n--;)if(t(e[n],n,e))return n;return-1}function te(e,t,n,r,o,i,c){var s;function f(t){Object(y.c)(t)||(Object(l.isAlive)(e)?c(t):console.error(t))}var p=Object(d.reaction)((function(){try{return t(e)}catch(n){return void f(n)}}),function(){var t=Object(a.a)(u.a.mark((function t(r,a){var c,d;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s&&!s.signal.aborted&&s.abort(),Object(l.isAlive)(e)){t.next=3;break}return t.abrupt("return");case 3:return s=new AbortController,o(c=s),t.prev=6,t.next=9,n(r,c.signal,e,a);case 9:d=t.sent,Object(y.b)(c.signal),Object(l.isAlive)(e)&&i(d),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(6),c&&!c.signal.aborted&&c.abort(),f(t.t0);case 18:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,n){return t.apply(this,arguments)}}(),r);Object(l.addDisposer)(e,p),Object(l.addDisposer)(e,(function(){s&&!s.signal.aborted&&s.abort()}))}function ne(e,t){if(Object(l.isStateTreeNode)(t)&&!Object(l.isAlive)(t))return t;if(t&&e&&e[t.refName]){var n=e[(t=Object(l.isStateTreeNode)(t)?Object(r.a)({},Object(l.getSnapshot)(t)):Object(r.a)({},t)).refName];if(n)return Object(r.a)(Object(r.a)({},t),{},{refName:n,originalRefName:t.refName})}return t}function re(e,t){return ae.apply(this,arguments)}function ae(){return ae=Object(a.a)(u.a.mark((function e(t,n){var o,i,c,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.regions,i=void 0===o?[]:o,c=n.adapterConfig,n.sessionId){e.next=3;break}throw new Error("sessionId is required");case 3:return s=i.map((function(e){return e.assemblyName})),e.t0=Object,e.next=7,Promise.all(s.map(function(){var e=Object(a.a)(u.a.mark((function e(r){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,t.getRefNameMapForAdapter(c,r,n);case 3:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return e.t1=e.sent,l=e.t0.fromEntries.call(e.t0,e.t1),e.abrupt("return",Object(r.a)(Object(r.a)({},n),{},{regions:i.map((function(e,t){return ne(l[s[t]],e)}))}));case 10:case"end":return e.stop()}}),e)}))),ae.apply(this,arguments)}function oe(e,t){return[Math.min(e,t),Math.max(e,t)]}function ie(e){var t=e.refName,n=e.coord,r=e.oob;return"".concat(t,":").concat(n.toLocaleString("en-US")).concat(r?" (out of bounds)":"")}var ce=/electron/i.test("undefined"!==typeof navigator?navigator.userAgent:"");function se(e){return ue(e).split("").reverse().join("")}var ue=function(){var e=/[ACGT]/gi,t={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};return function(n){return n.replace(e,(function(e){return t[e]||""}))}}();function le(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}var de="undefined"===typeof jest?"undefined"!==typeof window&&window.requestIdleCallback?window.requestIdleCallback:function(e){return setTimeout((function(){return e()}),1)}:function(e){return e()};function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625],r=.5279276315789471;return String(e).split("").map((function(e){return e.charCodeAt(0)<n.length?n[e.charCodeAt(0)]:r})).reduce((function(e,t){return t+e}),0)*t}var pe=["ATG"],ge=["TAA","TAG","TGA"],me={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function he(e){var t={};return Object.keys(e).forEach((function(n){for(var r=e[n],a=[],o=0;o<3;o++){var i=n.charAt(o);a[o]=[],a[o][0]=i.toUpperCase(),a[o][1]=i.toLowerCase()}for(var c=0;c<2;c++)for(var s=a[0][c],u=0;u<2;u++)for(var l=a[1][u],d=0;d<2;d++){var f=a[2][d];t[s+l+f]=r}})),t}function be(e,t,n){return ve.apply(this,arguments)}function ve(){return(ve=Object(a.a)(u.a.mark((function e(t,n,r){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(t),e.next=3,r();case 3:return a=e.sent,n(""),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}function Oe(e){return"".concat(ye(JSON.stringify(e)))}function we(e,t){return je.apply(this,arguments)}function je(){return(je=Object(a.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return n.blocksForRange(e.refName,e.start,e.end)})));case 2:return r=e.sent,e.abrupt("return",r.flat().map((function(e){return{start:e.minv.blockPosition,end:e.maxv.blockPosition+65535}})).reduce((function(e,t){return e+t.end-t.start}),0));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(e){var t=e.refName,n=e.coord,r=e.regionNumber,a=e.self,o=0,i=a.interRegionPaddingWidth*a.bpPerPx,c=a.minimumBlockWidth*a.bpPerPx,s=a.displayedRegions.findIndex((function(e,s){var u=e.end-e.start;return t===e.refName&&n>=e.start&&n<=e.end&&(!r||r===s)?(o+=e.reversed?e.end-n:n-e.start,!0):(u>c&&o/a.bpPerPx>=0&&o/a.bpPerPx<a.width?o+=u+i:o+=u,!1)}));if(a.displayedRegions[s])return{index:s,offsetPx:Math.round(o/a.bpPerPx)}}function xe(e){return Math.floor(e/1e6)>0?"".concat(parseFloat((e/1e6).toPrecision(3)),"Mbp"):Math.floor(e/1e3)>0?"".concat(parseFloat((e/1e3).toPrecision(3)),"Kbp"):"".concat(Math.floor(e),"bp")}}.call(this,n(148))},830:function(e,t){},861:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(103),a=n(81),o=n(11),i=n(80),c=n.n(i),s=function(e){function t(e){Object(a.a)(this,t),this.submaps=e}return Object(o.a)(t,[{key:"has",value:function(e){var t,n=Object(r.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){if(t.value.has(e))return!0}}catch(a){n.e(a)}finally{n.f()}return!1}},{key:"get",value:function(e){var t,n=Object(r.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.has(e))return a.get(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"values",value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(r.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,this.get(a);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"keys",value:c.a.mark((function(){var e,t,n,a,o,i,s,u,l,d;return c.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:e=new Set,t=Object(r.a)(this.submaps.values());try{for(t.s();!(n=t.n()).done;){a=n.value,o=Object(r.a)(a.keys());try{for(o.s();!(i=o.n()).done;)s=i.value,e.add(s)}catch(f){o.e(f)}finally{o.f()}}}catch(f){t.e(f)}finally{t.f()}u=Object(r.a)(e),c.prev=4,u.s();case 6:if((l=u.n()).done){c.next=12;break}return d=l.value,c.next=10,d;case 10:c.next=6;break;case 12:c.next=17;break;case 14:c.prev=14,c.t0=c.catch(4),u.e(c.t0);case 17:return c.prev=17,u.f(),c.finish(17);case 20:case"end":return c.stop()}}),e,this,[[4,14,17,20]])}))},{key:"find",value:function(e){var t,n=Object(r.a)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var a,o=t.value,i=Object(r.a)(o.values());try{for(i.s();!(a=i.n()).done;){var c=a.value;if(e(c))return c}}catch(s){i.e(s)}finally{i.f()}}}catch(s){n.e(s)}finally{n.f()}}},{key:e,value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(r.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,[a,this.get(a)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"entries",value:c.a.mark((function e(){var t,n,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(r.a)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return a=n.value,e.next=7,[a,this.get(a)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))}]),t}(Symbol.iterator)},862:function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.filter((function(e,n,r){return n===r.findIndex((function(n){return t(n)===t(e)}))}))}n.d(t,"a",(function(){return r}))},877:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n(1),a=n.n(r),o=n(1624);function i(e){return a.a.createElement(o.a,e,a.a.createElement("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"}))}function c(e){return a.a.createElement(o.a,e,a.a.createElement("path",{fill:"currentColor",d:"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z"}))}},951:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(51),i=n(1638),c=n(1630),s=n(1635),u=n(184),l=n(84),d=n(13),f=n(1682),p=n(590),g=n(1319),m=n.n(g),h=n(1318),b=n.n(h),v=n(197),y=n(960),O=n(29),w=n(1642),j=n(1762),k=n(346),x=n.n(k),C=n(456),S=n.n(C),T=Object(o.a)({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});var E=Object(l.observer)((function(e){var t=e.model,n=T(),o=t.maxBpPerPx,i=t.minBpPerPx,c=t.bpPerPx,s=t.scaleFactor,u=Object(r.useState)(100*-Math.log2(c)),l=Object(O.a)(u,2),d=l[0],f=l[1];return Object(r.useEffect)((function(){f(100*-Math.log2(c))}),[f,c]),a.a.createElement("div",{className:n.container},a.a.createElement(w.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*c)},disabled:c>=o-1e-4||1!==s,color:"secondary"},a.a.createElement(S.a,null)),a.a.createElement(j.a,{className:n.slider,value:d,min:100*-Math.log2(o),max:100*-Math.log2(i),onChange:function(e,t){return f(t)},onChangeCommitted:function(){return t.zoomTo(Math.pow(2,-d/100))},disabled:1!==s}),a.a.createElement(w.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:c<=i+1e-4||1!==s,color:"secondary"},a.a.createElement(x.a,null)))})),M=Object(o.a)((function(e){return{headerBar:{height:v.a,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:Object(d.a)(e.palette.background.paper,.8),height:v.g,margin:v.e},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),R=Object(l.observer)((function(e){var t=e.model,n=M();return a.a.createElement(s.a,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",color:"secondary"},a.a.createElement(u.c,{className:n.buttonSpacer}))}));function P(e){var t=e.model,n=M();return a.a.createElement(a.a.Fragment,null,a.a.createElement(s.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)}},a.a.createElement(b.a,null)),a.a.createElement(s.a,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)}},a.a.createElement(m.a,null)))}var A=Object(l.observer)((function(e){var t=e.model,n=M(),r=t.coarseTotalBp;return a.a.createElement(i.a,{variant:"body2",color:"textSecondary",className:n.bp},Math.round(r).toLocaleString("en-US")," bp")})),N=function(e){var t=e.model,n=M();return a.a.createElement("div",{className:n.headerBar},a.a.createElement(R,{model:t}),a.a.createElement("div",{className:n.spacer}),a.a.createElement(f.a,{row:!0,className:n.headerForm},a.a.createElement(P,{model:t}),a.a.createElement(p.a,{model:t})),a.a.createElement(A,{model:t}),a.a.createElement(E,{model:t}),a.a.createElement("div",{className:n.spacer}))},L=Object(l.observer)((function(e){var t=e.model;return t.hideHeaderOverview?a.a.createElement(N,{model:t}):a.a.createElement(y.c,{model:t},a.a.createElement(N,{model:t}))})),I=n(85),F=n(79),D=n(108),B=n(82),V=n(26),z=n(12),W=n(580),U=n.n(W),q=n(1320),H=n.n(q),_=n(113),G=n.n(_),J=Object(o.a)((function(e){return{root:{background:Object(d.a)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),X=a.a.forwardRef((function(e,t){var n,r=J(),o=a.a.useState(null),s=Object(O.a)(o,2),u=s[0],l=s[1],d=e.track,f=e.className,p=Object(B.getContainingView)(d),g=Object(B.getSession)(d),m=d.configuration,h=Object(F.getConf)(d,"trackId"),b=function(){l(null)},v=Object(F.getConf)(d,"name");"ReferenceSequenceTrack"===Object(F.getConf)(d,"type")&&(v="Reference Sequence",g.assemblies.forEach((function(e){e.sequence===m&&(v="Reference Sequence (".concat(Object(F.readConfObject)(e,"name"),")"))})));var y=[].concat(Object(z.a)(null===(n=g.getTrackActionMenuItems)||void 0===n?void 0:n.call(g,m)),Object(z.a)(d.trackMenuItems())).sort((function(e,t){return(t.priority||0)-(e.priority||0)}));return a.a.createElement(a.a.Fragment,null,a.a.createElement(c.a,{ref:t,className:Object(V.a)(f,r.root)},a.a.createElement("span",{draggable:!0,className:r.dragHandle,onDragStart:function(e){var t=e.target;t.parentNode&&(e.dataTransfer.setDragImage(t.parentNode,20,20),p.setDraggingTrackId(d.id))},onDragEnd:function(){p.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(p.id,"-").concat(h)},a.a.createElement(H.a,{className:r.dragHandleIcon})),a.a.createElement(w.a,{onClick:function(){return p.hideTrack(h)},className:r.iconButton,title:"close this track",color:"secondary"},a.a.createElement(G.a,null)),a.a.createElement(i.a,{variant:"body1",component:"span",className:r.trackName},v),a.a.createElement(w.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){l(e.currentTarget)},className:r.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!y.length},a.a.createElement(U.a,null))),a.a.createElement(D.Menu,{anchorEl:u,onMenuItemClick:function(e,t){t(),b()},open:Boolean(u),onClose:b,menuItems:y}))})),Y=Object(l.observer)(X),Q=Object(o.a)((function(e){return{root:{},resizeHandle:{height:v.c,zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3,borderRadius:e.shape.borderRadius},trackLabel:{zIndex:3,margin:e.spacing(1)},trackLabelInline:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}}));var K=Object(l.observer)((function(e){var t=e.model,n=e.track,o=Q(),i=n.displays[0],s=t.id,u=t.trackLabels,l=t.horizontalScroll,d=t.draggingTrackId,f=t.moveTrack,p=i.height,g=Object(F.getConf)(n,"trackId"),m=Object(r.useRef)(null);Object(r.useEffect)((function(){return m.current&&(t.trackRefs[g]=m.current),function(){delete t.trackRefs[g]}}),[t.trackRefs,g]);var h=Object(B.useDebouncedCallback)((function(){void 0!==d&&Object(I.isAlive)(i)&&d!==i.id&&f(d,n.id)}),100),b=i.RenderingComponent,v=i.DisplayBlurb,y=void 0!==d&&d!==i.id;return a.a.createElement("div",{className:o.root},a.a.createElement(c.a,{variant:"outlined",className:o.trackRenderingContainer,style:{height:p},onScroll:function(e){var t=e.target;i.setScrollTop(t.scrollTop)},onDragEnter:h,"data-testid":"trackRenderingContainer-".concat(s,"-").concat(g),role:"presentation"},"hidden"!==u?a.a.createElement(Y,{track:n,className:Object(V.a)(o.trackLabel,"overlapping"===u?o.trackLabelOverlap:o.trackLabelInline)}):null,a.a.createElement("div",{ref:m,style:{transform:"scaleX(".concat(t.scaleFactor,")")}},a.a.createElement(b,{model:i,blockState:{},onHorizontalScroll:l})),v?a.a.createElement("div",{style:{position:"absolute",left:0,top:i.height-20}},a.a.createElement(v,{model:i})):null),a.a.createElement("div",{className:o.overlay,style:{height:i.height,background:y?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:h}),a.a.createElement(D.ResizeHandle,{onDrag:i.resizeHeight,className:o.resizeHandle}))})),$=n(863),Z=n.n($),ee=n(839),te=n(1626),ne=n(1636),re=Object(o.a)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?Object(ee.alpha)(e.palette.tertiary.main,.7):Object(ee.alpha)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),ae=Object(l.observer)((function(e){var t=e.model,n=e.coordX,r=re();return a.a.createElement(ne.a,{open:!0,placement:"top",title:Object(B.stringify)(t.pxToBp(n)),arrow:!0},a.a.createElement("div",{className:r.guide,style:{left:n,background:"red"}}))}));function oe(e){var t=e.model,n=e.ControlComponent,o=void 0===n?a.a.createElement("div",null):n,c=Object(r.useState)(),s=Object(O.a)(c,2),u=s[0],l=s[1],d=Object(r.useState)(),f=Object(O.a)(d,2),p=f[0],g=f[1],m=Object(r.useState)(),h=Object(O.a)(m,2),b=h[0],v=h[1],y=Object(r.useState)(),w=Object(O.a)(y,2),j=w[0],k=w[1],x=Object(r.useRef)(null),C=Object(r.useRef)(null),S=re(),T=void 0!==u&&void 0===b,E=t.setOffsets,M=t.pxToBp;function R(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-e.target.getBoundingClientRect().left;l(t),g(t)}function P(e){var t=e.target;k(e.clientX-t.getBoundingClientRect().left)}function A(){k(void 0),t.setOffsets(void 0,void 0)}function N(){v(void 0),l(void 0),g(void 0)}Object(r.useEffect)((function(){function e(e){if(x.current&&T){var t=e.clientX-x.current.getBoundingClientRect().left;g(t)}}function t(e){if(void 0!==u&&x.current){var t=e.clientX,n=e.clientY,r=t-x.current.getBoundingClientRect().left;v({offsetX:r,clientX:t,clientY:n});var a=function(e){if(void 0!==u){var t=u,n=e;if(n<t){var r=[n,t];t=r[0],n=r[1]}return{leftOffset:M(t),rightOffset:M(n)}}}(r),o=a.leftOffset,i=a.rightOffset;E(o,i),k(void 0)}}return T?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[u,T,b,E,M]),Object(r.useEffect)((function(){!T&&void 0!==p&&void 0!==u&&Math.abs(p-u)<=3&&N()}),[T,p,u,t.bpPerPx]);var L=Boolean(b);if(void 0===u)return a.a.createElement(a.a.Fragment,null,void 0!==j?a.a.createElement(ae,{model:t,coordX:j}):null,a.a.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:x,onMouseDown:R,onMouseOut:A,onMouseMove:P},o));var I=b?b.offsetX:p||0,F=I<u?I:u,V=Math.abs(I-u),z=t.pxToBp(F),W=t.pxToBp(F+V),U=Math.ceil(V*t.bpPerPx);return a.a.createElement(a.a.Fragment,null,C.current?a.a.createElement(a.a.Fragment,null,a.a.createElement(te.a,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},a.a.createElement(i.a,null,Object(B.stringify)(z))),a.a.createElement(te.a,{className:S.popover,classes:{paper:S.paper},open:!0,anchorEl:C.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},a.a.createElement(i.a,null,Object(B.stringify)(W)))):null,a.a.createElement("div",{ref:C,className:S.rubberBand,style:{left:F,width:V}},a.a.createElement(i.a,{variant:"h6",className:S.rubberBandText},U.toLocaleString("en-US")," bp")),a.a.createElement("div",{"data-testid":"rubberBand_controls",className:S.rubberBandControl,role:"presentation",ref:x,onMouseDown:R,onMouseOut:A,onMouseMove:P},o),b?a.a.createElement(D.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:b.clientX,top:b.clientY},onMenuItemClick:function(e,t){t(),N()},open:L,onClose:N,menuItems:t.rubberBandMenuItems()}):null)}oe.defaultProps={ControlComponent:a.a.createElement("div",null)};var ie=Object(l.observer)(oe),ce=n(86),se=n(2),ue=n(286),le=n(587),de=n(454),fe=["model","style","className"],pe=Object(o.a)((function(e){return{scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),ge=Object(l.observer)((function(e){var t=e.model,n=pe(),r=0;return t.staticBlocks.forEach((function(e,n){e.offsetPx-t.offsetPx<0&&(r=n)})),a.a.createElement(a.a.Fragment,null,t.staticBlocks.map((function(e,o){return e instanceof ue.b&&(e.isLeftEndOfDisplayedRegion||o===r)?a.a.createElement(i.a,{key:"refLabel-".concat(e.key,"-").concat(o),style:{left:o===r?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:o===r?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName)},e.refName):null})))})),me=Object(l.observer)((function(e){var t=e.model,n=pe();return a.a.createElement(a.a.Fragment,null,t.staticBlocks.map((function(e,r){if(e instanceof ue.b){var o=Object(de.b)(e.start,e.end,t.bpPerPx,!0,!1);return a.a.createElement(le.a,{key:"".concat(e.key,"-").concat(r),block:e},o.map((function(r){if("major"===r.type){var o=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx,c=(r.base+1).toLocaleString("en-US");return a.a.createElement("div",{key:r.base,className:n.tick,style:{left:o}},c?a.a.createElement(i.a,{className:n.majorTickLabel},c):null)}return null})))}return e instanceof ue.c?a.a.createElement(le.b,{key:e.key,width:e.widthPx}):e instanceof ue.d?a.a.createElement(le.c,{key:e.key,width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),he=a.a.forwardRef((function(e,t){var n=e.model,r=e.style,o=e.className,i=Object(se.a)(e,fe),s=pe(),u=n.staticBlocks.offsetPx-n.offsetPx;return a.a.createElement(c.a,Object.assign({"data-resizer":"true",className:Object(V.a)(s.scaleBarContainer,o),variant:"outlined",ref:t,style:r},i),a.a.createElement("div",{className:s.scaleBarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0}},a.a.createElement("div",{className:s.scaleBar,style:Object(ce.a)({left:u-1,width:n.staticBlocks.totalWidthPx},r)},a.a.createElement(me,{model:n}))),a.a.createElement(ge,{model:n}))})),be=Object(l.observer)(he),ve=Object(o.a)((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.hint},minorTick:{background:e.palette.divider}}})),ye=Object(l.observer)((function(e){var t=e.model,n=ve();return a.a.createElement(a.a.Fragment,null,t.staticBlocks.map((function(e,r){if(e instanceof ue.b){var o=Object(de.b)(e.start,e.end,t.bpPerPx);return a.a.createElement(le.a,{key:"".concat(e.key,"-").concat(r),block:e},o.map((function(r){var o=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx;return a.a.createElement("div",{key:r.base,className:Object(V.a)(n.tick,"major"===r.type||"labeledMajor"===r.type?n.majorTick:n.minorTick),style:{left:o}})})))}return e instanceof ue.c?a.a.createElement(le.b,{key:e.key,width:e.widthPx}):e instanceof ue.d?a.a.createElement(le.c,{key:e.key,width:e.widthPx,boundary:"boundary"===e.variant}):null})))}));var Oe=Object(l.observer)((function(e){var t=e.model,n=ve(),r=t.staticBlocks.offsetPx-t.offsetPx;return a.a.createElement("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0}},a.a.createElement("div",{className:n.verticalGuidesContainer,style:{left:r,width:t.staticBlocks.totalWidthPx}},a.a.createElement(ye,{model:t})))})),we=Object(o.a)((function(){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));var je=Object(l.observer)((function(e){var t=e.model,n=t.bpPerPx,o=t.centerLineInfo,i=t.trackHeights,c=t.tracks,s=t.width,u=Object(r.useRef)(null),l=we(),d=s/2;return c.length?a.a.createElement("div",{"data-testid":"centerline_container",className:l.centerLineContainer,role:"presentation",ref:u,style:{left:"".concat(d,"px"),width:Math.max(1/n,1)}},o&&a.a.createElement("div",{"data-testid":"centerline_text",className:l.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:i}},o.refName,":"," ",Math.max(Math.round(o.offset)+1,0))):null})),ke=Object(o.a)((function(e){return{tracksContainer:{position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden"},spacer:{position:"relative",height:v.c}}}));var xe=Object(l.observer)((function(e){var t=e.children,n=e.model,o=ke(),i=Object(r.useRef)(0),c=Object(r.useRef)(!1),s=Object(r.useRef)(),u=Object(r.useRef)(null),l=Object(r.useRef)(0),d=Object(r.useState)(!1),f=Object(O.a)(d,2),p=f[0],g=f[1];return Object(r.useEffect)((function(){var e=function(){};function t(e){e.preventDefault();var t=e.clientX-l.current;t&&(c.current||(c.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(-t),c.current=!1,l.current=e.clientX}))))}function r(){l.current=0,p&&g(!1)}return p&&(window.addEventListener("mousemove",t,!0),window.addEventListener("mouseup",r,!0),e=function(){window.removeEventListener("mousemove",t,!0),window.removeEventListener("mouseup",r,!0)}),e}),[n,p,l]),Object(r.useEffect)((function(){var e=u.current;function t(e){var t=Z()(e);!0===e.ctrlKey?(e.preventDefault(),i.current+=t.pixelY/500,n.setScaleFactor(i.current<0?1-i.current:1/(1+i.current)),s.current&&clearTimeout(s.current),s.current=setTimeout((function(){n.setScaleFactor(1),n.zoomTo(i.current>0?n.bpPerPx*(1+i.current):n.bpPerPx/(1-i.current)),i.current=0}),300)):(Math.abs(t.pixelX)>Math.abs(2*t.pixelY)&&e.preventDefault(),i.current+=t.pixelX,c.current||(c.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(i.current),i.current=0,c.current=!1}))))}return e?(e.addEventListener("wheel",t),function(){e.removeEventListener("wheel",t)}):function(){}}),[n]),a.a.createElement("div",{ref:u,role:"presentation",className:o.tracksContainer,onMouseDown:function(e){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(l.current=e.clientX,g(!0))},onMouseUp:function(e){e.preventDefault(),g(!1)},onMouseLeave:function(e){e.preventDefault()}},a.a.createElement(Oe,{model:n}),n.showCenterLine?a.a.createElement(je,{model:n}):null,a.a.createElement(ie,{model:n,ControlComponent:a.a.createElement(be,{model:n,style:{height:v.d,boxSizing:"border-box"}})}),a.a.createElement("div",{className:o.spacer}),t)})),Ce=n(83),Se=n(80),Te=n.n(Se),Ee=n(1680),Me=n(1683),Re=n(61),Pe=n(442),Ae=n(345),Ne=n(287),Le=n(455),Ie=Object(r.lazy)((function(){return Promise.resolve().then(n.bind(null,1325))})),Fe=Object(o.a)((function(e){return{importFormContainer:{padding:e.spacing(2)},button:{margin:e.spacing(2)}}})),De=Object(l.observer)((function(e){var t,n=e.model,o=Fe(),i=Object(B.getSession)(n),c=i.assemblyNames,u=i.assemblyManager,l=i.textSearchManager,d=n.rankSearchResults,f=n.isSearchDialogDisplayed,p=n.error,g=Object(r.useState)(c[0]),m=Object(O.a)(g,2),h=m[0],b=m[1],v=Object(r.useState)(p),y=Object(O.a)(v,2),w=y[0],j=y[1],k=n.searchScope(h),x=u.get(h),C=c.length?null===x||void 0===x?void 0:x.error:"No configured assemblies",S=(null===x||void 0===x?void 0:x.regions)||[],T=C||w,E=Object(r.useState)(),M=Object(O.a)(E,2),R=M[0],P=M[1],A=R||new Ae.b({label:null===(t=S[0])||void 0===t?void 0:t.refName}),N=null===A||void 0===A?void 0:A.getLocation();function L(e,t){return I.apply(this,arguments)}function I(){return(I=Object(Ce.a)(Te.a.mark((function e(t,n){var r,a,o;return Te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l||console.warn("No text search manager"),e.next=3,null===l||void 0===l?void 0:l.search({queryString:t,searchType:n},k,d);case 3:return a=e.sent,o=null===x||void 0===x||null===(r=x.allRefNames)||void 0===r?void 0:r.filter((function(e){return e.startsWith(t)})).map((function(e){return new Ae.b({label:e})})).slice(0,10),e.abrupt("return",[].concat(Object(z.a)(o||[]),Object(z.a)(a||[])));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=Object(Ce.a)(Te.a.mark((function e(t){var r,a,o,c;return Te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A){e.next=2;break}return e.abrupt("return");case 2:if(r=A.getTrackId(),a=t||A.getLocation()||"",e.prev=4,null===x||void 0===x||null===(o=x.allRefNames)||void 0===o||!o.includes(a)){e.next=9;break}n.navToLocString(a,h),e.next=20;break;case 9:return e.next=11,L(t,"exact");case 11:if(!((c=e.sent)&&c.length>1)){e.next=17;break}return n.setSearchResults(c,t.toLowerCase()),e.abrupt("return");case 17:1===(null===c||void 0===c?void 0:c.length)&&(a=c[0].getLocation(),r=c[0].getTrackId());case 18:n.navToLocString(a,h),r&&n.showTrack(r);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),console.error(e.t0),i.notify("".concat(e.t0),"warning");case 26:case"end":return e.stop()}}),e,null,[[4,22]])})))).apply(this,arguments)}return a.a.createElement("div",null,T?a.a.createElement(Pe.default,{error:T}):null,a.a.createElement(Ee.a,{className:o.importFormContainer},a.a.createElement("form",{onSubmit:function(e){return e.preventDefault()}},a.a.createElement(Me.a,{container:!0,spacing:1,justifyContent:"center",alignItems:"center"},a.a.createElement(Me.a,{item:!0},a.a.createElement(Ne.a,{onChange:function(e){j(void 0),b(e)},session:i,selected:h})),a.a.createElement(Me.a,{item:!0},h?T?a.a.createElement(G.a,{style:{color:"red"}}):N?a.a.createElement(Le.a,{fetchResults:L,model:n,assemblyName:C?void 0:h,value:N,minWidth:270,onSelect:function(e){return P(e)},TextFieldProps:{margin:"normal",variant:"outlined",helperText:"Enter sequence name, feature name, or location"}}):a.a.createElement(Re.a,{role:"progressbar",size:20,disableShrink:!0}):null),a.a.createElement(Me.a,{item:!0}),a.a.createElement(Me.a,{item:!0},a.a.createElement(s.a,{type:"submit",disabled:!N,className:o.button,onClick:function(){n.setError(void 0),N&&function(e){F.apply(this,arguments)}(N)},variant:"contained",color:"primary"},"Open"),a.a.createElement(s.a,{disabled:!N,className:o.button,onClick:function(){n.setError(void 0),n.showAllRegionsInAssembly(h)},variant:"contained",color:"secondary"},"Show all regions in assembly"))))),f?a.a.createElement(Ie,{model:n,optAssemblyName:h,handleClose:function(){return n.setSearchResults(void 0,void 0)}}):null)})),Be=De,Ve=n(592),ze=n.n(Ve),We=n(233),Ue=Object(l.observer)((function(e){var t=e.model,n=t.bpPerPx,o=t.maxBpPerPx,i=t.minBpPerPx,s=t.scaleFactor,u=Object(r.useState)(),l=Object(O.a)(u,2),d=l[0],f=l[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(c.a,{style:{background:"#aaa7"}},a.a.createElement(w.a,{color:"secondary",onClick:function(e){f(e.currentTarget)}},a.a.createElement(ze.a,null)),a.a.createElement(w.a,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*n)},disabled:n>=o-1e-4||1!==s,color:"secondary"},a.a.createElement(S.a,null)),a.a.createElement(w.a,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:n<=i+1e-4||1!==s,color:"secondary"},a.a.createElement(x.a,null))),a.a.createElement(We.a,{anchorEl:d,open:Boolean(d),onMenuItemClick:function(e,t){t(),f(void 0)},onClose:function(){f(void 0)},menuItems:t.menuItems()}))})),qe=n(1666),He=n(1669),_e=n(1658),Ge=n(1670),Je=n(1645),Xe=n(1671),Ye=n(453),Qe=n(337),Ke=n.n(Qe);function $e(e){return e.map((function(e){return">".concat(e.header,"\n").concat(e.seq.replace(/(.{1,80})/g,"$1\n").trimEnd())})).join("\n")}var Ze=n(593),et=n.n(Ze),tt=Object(o.a)((function(e){return{loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}}));function nt(e,t,n){return rt.apply(this,arguments)}function rt(){return(rt=Object(Ce.a)(Te.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,d,f,p;return Te.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Object(B.getSession)(t),o=t.leftOffset,i=t.rightOffset,o&&i){e.next=4;break}throw new Error("no offsets on model to use for range");case 4:if(o.assemblyName===i.assemblyName){e.next=6;break}throw new Error("not able to fetch sequences from multiple assemblies");case 6:if(c=a.rpcManager,s=a.assemblyManager,u=o.assemblyName||i.assemblyName||"",l=s.get(u)){e.next=11;break}throw new Error("assembly ".concat(u," not found"));case 11:return d=Object(F.getConf)(l,["sequence","adapter"]),f="getSequence",e.next=15,Promise.all(n.map((function(e){return c.call(f,"CoreGetFeatures",{adapterConfig:d,region:e,sessionId:f,signal:r})})));case 15:return p=e.sent,e.abrupt("return",p.map((function(e){return e[0]})));case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var at=Object(l.observer)((function(e){var t=e.model,n=e.handleClose,o=tt(),c=Object(B.getSession)(t),l=Object(r.useState)(),d=Object(O.a)(l,2),f=d[0],p=d[1],g=Object(r.useState)(),m=Object(O.a)(g,2),h=m[0],b=m[1],v=Boolean(void 0===h),y=t.leftOffset,j=t.rightOffset,k=Object(r.useMemo)((function(){return t.getSelectedRegions(y,j)}),[t,y,j]);Object(r.useEffect)((function(){var e=!0,n=new AbortController;return Object(Ce.a)(Te.a.mark((function r(){var a;return Te.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(k.length>0)){r.next=8;break}return r.next=4,nt(t,k,n.signal);case 4:a=r.sent,e&&b($e(a.filter((function(e){return!!e})).map((function(e){var t=e.get("seq"),n=e.get("refName"),r=e.get("start")+1,a=e.get("end"),o="".concat(n,":").concat(r,"-").concat(a);if((null===t||void 0===t?void 0:t.length)!==a-r+1)throw new Error("".concat(o," returned ").concat(t.length.toLocaleString()," bases, but should have returned ").concat((a-r).toLocaleString()));return{header:o,seq:t}})))),r.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),e&&p(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))(),function(){n.abort(),e=!1}}),[t,c,k,b]);var x=!!h&&h.length>1e6;return a.a.createElement(qe.a,{"data-testid":"sequence-dialog",maxWidth:"xl",open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},a.a.createElement(He.a,{id:"alert-dialog-title"},"Reference sequence",n?a.a.createElement(w.a,{"data-testid":"close-seqDialog",className:o.closeButton,onClick:function(){n(),t.setOffsets(void 0,void 0)}},a.a.createElement(G.a,null)):null),a.a.createElement(_e.a,null),a.a.createElement(Ge.a,null,f?a.a.createElement(i.a,{color:"error"},"".concat(f)):null,v&&!f?a.a.createElement(Ee.a,null,"Retrieving reference sequence...",a.a.createElement(Re.a,{style:{marginLeft:10},size:20,disableShrink:!0})):null,a.a.createElement(Je.a,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,rows:5,disabled:x,className:o.dialogContent,fullWidth:!0,value:x?"Reference sequence too large to display, use the download FASTA button":h,InputProps:{readOnly:!0,classes:{input:o.textAreaFont}}})),a.a.createElement(Xe.a,null,a.a.createElement(s.a,{onClick:function(){Ke()(h||""),c.notify("Copied to clipboard","success")},disabled:v||!!f||x,color:"primary",startIcon:a.a.createElement(u.b,null)},"Copy to clipboard"),a.a.createElement(s.a,{onClick:function(){var e=new Blob([h||""],{type:"text/x-fasta;charset=utf-8"});Object(Ye.saveAs)(e,"jbrowse_ref_seq.fa")},disabled:v||!!f,color:"primary",startIcon:a.a.createElement(et.a,null)},"Download FASTA"),a.a.createElement(s.a,{onClick:n,color:"primary",autoFocus:!0},"Close")))})),ot=n(1325),it=Object(o.a)((function(e){return{note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}})),ct=Object(l.observer)((function(e){var t=e.model,n=t.tracks,r=t.error,o=t.hideHeader,l=t.initialized,d=t.hasDisplayedRegions,f=it();return l||r?!d||r?a.a.createElement(Be,{model:t}):a.a.createElement("div",{style:{position:"relative"}},t.seqDialogDisplayed?a.a.createElement(at,{model:t,handleClose:function(){t.setSequenceDialogOpen(!1)}}):null,t.isSearchDialogDisplayed?a.a.createElement(ot.default,{model:t,handleClose:function(){t.setSearchResults(void 0,void 0)}}):null,o?a.a.createElement("div",{style:{position:"absolute",right:0,zIndex:1001}},a.a.createElement(Ue,{model:t})):a.a.createElement(L,{model:t}),a.a.createElement(xe,{model:t},n.length?n.map((function(e){return a.a.createElement(K,{key:e.id,model:t,track:e})})):a.a.createElement(c.a,{variant:"outlined",className:f.note},a.a.createElement(i.a,null,"No tracks active."),a.a.createElement(s.a,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3},startIcon:a.a.createElement(u.c,null)},"Open track selector")))):a.a.createElement(i.a,{className:f.dots,variant:"h5"},"Loading")}));t.default=ct},952:function(e,t,n){"use strict";n.d(t,"b",(function(){return _})),n.d(t,"a",(function(){return H.a}));var r=n(81),a=n(11),o=n(88),i=n(89),c=n(1),s=n.n(c),u=n(79),l=n(127),d=n(149),f=n(117),p=n(182),g=n(172),m=n(120),h=n(133),b=n(657),v=n(86),y=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t("@jbrowse/core/configuration"),a=r.ConfigurationSchema,o=r.ConfigurationReference,i=t("@jbrowse/core/util").getContainingView,c=t("@jbrowse/core/util/tracks").getParentRenderProps,s=a("ChordVariantDisplay",{renderer:n.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:b.c,explicitlyTyped:!0});return{stateModel:n.compose("ChordVariantDisplay",b.b,n.model({type:n.literal("ChordVariantDisplay"),configuration:o(s)})).views((function(e){return{get rendererTypeName(){return e.configuration.renderer.type},renderProps:function(){var t=i(e);return Object(v.a)(Object(v.a)({},c(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick})}}})),configSchema:s}},O=function(e){var t=e.lib,n=e.load,r=t["@jbrowse/core/pluggableElementTypes/DisplayType"],a=n(y),o=a.stateModel;return new r({name:"ChordVariantDisplay",configSchema:a.configSchema,stateModel:o,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:Object(b.a)(e)})};var w=n(83),j=n(80),k=n.n(j),x=n(105),C=n(82),S=n(85),T=function(e){return S.types.compose("LinearVariantDisplay",Object(h.g)(e),S.types.model({type:S.types.literal("LinearVariantDisplay"),configuration:Object(u.ConfigurationReference)(e)})).actions((function(e){return{selectFeature:function(t){return Object(w.a)(k.a.mark((function n(){var r,a,o,i,c,s,l;return k.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=Object(C.getSession)(e),!Object(C.isSessionModelWithWidgets)(r)){n.next=11;break}return a=r.rpcManager,o=Object(x.getRpcSessionId)(e),i=Object(C.getContainingTrack)(e),c=Object(u.getConf)(i,"adapter"),n.next=8,a.call(o,"CoreGetMetadata",{adapterConfig:c});case 8:s=n.sent,l=r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:Object(C.getContainingView)(e),descriptions:s}),r.showWidget(l);case 11:r.setSelection(t);case 12:case"end":return n.stop()}}),n)})))()}}}))},E=n(344),M=n(103),R=n(12),P=n(29),A=n(84),N=n(106),L=n(213);function I(e,t){var n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}var F=Object(A.observer)((function(e){var t,n,r,a,o=e.feature,i=e.blocksForRefs,c=e.radius,l=e.config,d=e.bezierRadius,f=e.selected,p=e.onClick,g=i[o.get("refName")];if(!g)return null;if(o.get("INFO")){var m=o.get("INFO").SVTYPE||[];n=Object(P.a)(m,1)[0]}else o.get("mate")&&(n="mate");var h=null===(t=o.get("ALT"))||void 0===t?void 0:t[0],b=h&&Object(L.b)(h);if(b){var v=b.MatePosition.split(":");r=+v[1],a=i[v[0]]}else if("<TRA>"===h){var y,O,w,j,k=null===(y=o.get("INFO"))||void 0===y||null===(O=y.CHR2)||void 0===O?void 0:O[0],x=null===(w=o.get("INFO"))||void 0===w||null===(j=w.END)||void 0===j?void 0:j[0];r=parseInt(x,10),a=i[k]}else if("mate"===n){var S=o.get("mate"),T=S.refName;r=S.start,a=i[T]}if(a){var E=o.get("start"),M=I(g,E),A=I(a,r),N=Object(C.polarToCartesian)(c,M),F=Object(C.polarToCartesian)(c,A),D=Object(C.polarToCartesian)(d,(A+M)/2),B=f?Object(u.readConfObject)(l,"strokeColorSelected",{feature:o}):Object(u.readConfObject)(l,"strokeColor",{feature:o}),V=Object(u.readConfObject)(l,"strokeColorHover",{feature:o});return s.a.createElement("path",{"data-testid":"chord-".concat(o.id()),d:["M"].concat(Object(R.a)(N),["Q"],Object(R.a)(D),Object(R.a)(F)).join(" "),style:{stroke:B},onClick:function(e){return p(o,g.region,a.region,e)},onMouseOver:function(e){f||(e.target.style.stroke=V,e.target.style.strokeWidth=3)},onMouseOut:function(e){f||(e.target.style.stroke=B,e.target.style.strokeWidth=1)}})}return null}));function D(e){var t,n=e.features,r=e.config,a=e.displayModel,o=e.blockDefinitions,i=e.radius,u=e.bezierRadius,l=e.displayModel.selectedFeatureId,d=e.onChordClick,f=Object(c.useMemo)((function(){var e={};return o.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(n){e[n.refName]=t}))})),e}),[o]),p=[],g=Object(M.a)(n);try{for(g.s();!(t=g.n()).done;){var m=Object(P.a)(t.value,2),h=m[0],b=m[1],v=String(l)===String(b.id());p.push(s.a.createElement(F,{key:h,feature:b,config:r,displayModel:a,radius:i,bezierRadius:u,blocksForRefs:f,selected:v,onClick:d}))}}catch(O){g.e(O)}finally{g.f()}var y="chords-".concat(a.id);return s.a.createElement("g",{id:y,"data-testid":"structuralVariantChordRenderer"},s.a.createElement("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(y," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),p)}D.defaultProps={displayModel:void 0,selectedFeatureId:"",onChordClick:void 0};var B=Object(A.observer)(D),V=function(e){var t=Object(u.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});return new E.a({name:"StructuralVariantChordRenderer",ReactComponent:B,configSchema:t,pluginManager:e})},z=Object(u.ConfigurationSchema)("VariantFeatureWidget",{});function W(e){return S.types.model("VariantFeatureWidget",{id:N.ElementId,type:S.types.literal("VariantFeatureWidget"),view:S.types.safeReference(e.pluggableMstType("view","stateModel")),featureData:S.types.frozen(),descriptions:S.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var U=Object(u.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:Object(u.ConfigurationSchema)("VcfIndex",{indexType:{model:S.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0}),q=Object(u.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),H=n(461),_=function(e){Object(o.a)(s,e);var t=Object(i.a)(s);function s(){var e;Object(r.a)(this,s);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).name="VariantsPlugin",e}return Object(a.a)(s,[{key:"install",value:function(e){e.addAdapterType((function(){return new l.a({name:"VcfTabixAdapter",configSchema:U,getAdapterClass:function(){return Promise.all([n.e(0),n.e(2),n.e(81)]).then(n.bind(null,1730)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfTabixAdapter",o=Object(x.getFileName)(t),i=n&&Object(x.getFileName)(n),c={type:a,vcfGzLocation:t,index:{location:n||Object(x.makeIndex)(t,".tbi"),indexType:Object(x.makeIndexType)(i,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(o)&&!r||r===a?c:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t)}})),e.addAdapterType((function(){return new l.a({name:"VcfAdapter",configSchema:q,getAdapterClass:function(){return Promise.all([n.e(3),n.e(80)]).then(n.bind(null,1731)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfAdapter",o=Object(x.getFileName)(t);return/\.vcf$/i.test(o)||r===a?{type:a,vcfLocation:t}:e(t,n,r)}})),e.addRendererType((function(){return e.jbrequire(V)})),e.addTrackType((function(){var t=Object(u.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:Object(f.createBaseTrackConfig)(e)});return new p.a({name:"VariantTrack",configSchema:t,stateModel:Object(f.createBaseTrackModel)(e,"VariantTrack",t)})})),e.addDisplayType((function(){return e.jbrequire(O)})),e.addDisplayType((function(){var t=function(e){var t=Object(h.f)(e);return Object(u.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new d.a({name:"LinearVariantDisplay",configSchema:t,stateModel:T(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:h.b})})),e.addWidgetType((function(){return new g.a({name:"VariantFeatureWidget",heading:"Feature details",configSchema:z,stateModel:W(e),ReactComponent:Object(c.lazy)((function(){return n.e(79).then(n.bind(null,1766))}))})}))}}]),s}(m.a)},953:function(e,t,n){"use strict";var r={};n.r(r),n.d(r,"BoxRendererType",(function(){return le.default})),n.d(r,"CircularChordRendererType",(function(){return de.a})),n.d(r,"ComparativeServerSideRendererType",(function(){return fe.a})),n.d(r,"FeatureRendererType",(function(){return pe.default})),n.d(r,"ServerSideRenderedContent",(function(){return ge.a})),n.d(r,"ServerSideRendererType",(function(){return me.default})),n.d(r,"baseConnectionConfig",(function(){return he.baseConnectionConfig})),n.d(r,"BaseConnectionModelFactory",(function(){return he.BaseConnectionModelFactory})),n.d(r,"BaseViewModel",(function(){return he.BaseViewModel})),n.d(r,"BaseDisplay",(function(){return he.BaseDisplay})),n.d(r,"InternetAccount",(function(){return he.InternetAccount})),n.d(r,"BaseInternetAccountConfig",(function(){return he.BaseInternetAccountConfig})),n.d(r,"createBaseTrackModel",(function(){return he.createBaseTrackModel})),n.d(r,"createBaseTrackConfig",(function(){return he.createBaseTrackConfig})),n.d(r,"AdapterType",(function(){return ee.a})),n.d(r,"ConnectionType",(function(){return te.a})),n.d(r,"RendererType",(function(){return ne.default})),n.d(r,"WidgetType",(function(){return re.a})),n.d(r,"TrackType",(function(){return ae.a})),n.d(r,"DisplayType",(function(){return oe.a})),n.d(r,"ViewType",(function(){return ie.a})),n.d(r,"RpcMethodType",(function(){return ce.a})),n.d(r,"InternetAccountType",(function(){return se.a})),n.d(r,"TextSearchAdapterType",(function(){return ue.a}));var a={};n.r(a),n.d(a,"GranularRectLayout",(function(){return je.a})),n.d(a,"MultiLayout",(function(){return ke.a})),n.d(a,"PrecomputedLayout",(function(){return xe.a})),n.d(a,"PrecomputedMultiLayout",(function(){return Pe})),n.d(a,"SceneGraph",(function(){return Ae.a}));var o={};n.r(o),n.d(o,"red",(function(){return Be.a})),n.d(o,"pink",(function(){return ze.a})),n.d(o,"purple",(function(){return Ue.a})),n.d(o,"deepPurple",(function(){return He.a})),n.d(o,"indigo",(function(){return Ge.a})),n.d(o,"blue",(function(){return Xe.a})),n.d(o,"lightBlue",(function(){return Qe.a})),n.d(o,"cyan",(function(){return $e.a})),n.d(o,"teal",(function(){return et.a})),n.d(o,"green",(function(){return nt.a})),n.d(o,"lightGreen",(function(){return at.a})),n.d(o,"lime",(function(){return it.a})),n.d(o,"yellow",(function(){return st.a})),n.d(o,"amber",(function(){return lt.a})),n.d(o,"orange",(function(){return ft.a})),n.d(o,"deepOrange",(function(){return gt.a})),n.d(o,"brown",(function(){return ht.a})),n.d(o,"grey",(function(){return vt.a})),n.d(o,"blueGrey",(function(){return Ot.a}));var i=n(1),c=n.n(i),s=n(32),u=n(107),l=n(85),d=n(84),f=n(25),p=n.n(f),g=n(95),m=n(63),h=n(110),b=n(1624),v=n(655),y=n(437),O=n(656),w=n(1635),j=n(1674),k=n(1675),x=n(1677),C=n(1747),S=n(1680),T=n(1666),E=n(1647),M=n(814),R=n(1652),P=n(1682),A=n(1683),N=n(1684),L=n(1642),I=n(1685),F=n(1686),D=n(1654),B=n(1662),V=n(1263),z=n(1633),W=n(1748),U=n(860),q=n(1757),H=n(1663),_=n(1664),G=n(1645),J=n(1636),X=n(1638),Y=n(1672),Q=n(1770),K=n(116),$=n(373),Z=n(285),ee=n(127),te=n(277),ne=n(247),re=n(172),ae=n(182),oe=n(149),ie=n(205),ce=n(248),se=n(431),ue=n(333),le=n(254),de=n(344),fe=n(444),pe=n(232),ge=n(582),me=n(256),he=n(117),be=n(79),ve=n(120),ye=n(108),Oe=n(82),we=n(265),je=n(579),ke=n(343),xe=n(439),Ce=n(29),Se=n(88),Te=n(89),Ee=n(11),Me=n(81),Re=Object(Ee.a)((function e(){throw Object(Me.a)(this,e),new Error("invalid layout name")})),Pe=function(e){Object(Se.a)(n,e);var t=Object(Te.a)(n);function n(e){var r;return Object(Me.a)(this,n),r=t.call(this,Re),Object.entries(e).forEach((function(e){var t=Object(Ce.a)(e,2),n=t[0],a=t[1];r.subLayouts.set(n,new xe.a(a))})),r}return Object(Ee.a)(n)}(ke.a),Ae=n(583),Ne=n(105),Le=n(104),Ie=n(204),Fe=n(125),De=n(840),Be=n.n(De),Ve=n(841),ze=n.n(Ve),We=n(842),Ue=n.n(We),qe=n(843),He=n.n(qe),_e=n(844),Ge=n.n(_e),Je=n(845),Xe=n.n(Je),Ye=n(846),Qe=n.n(Ye),Ke=n(847),$e=n.n(Ke),Ze=n(848),et=n.n(Ze),tt=n(849),nt=n.n(tt),rt=n(850),at=n.n(rt),ot=n(851),it=n.n(ot),ct=n(852),st=n.n(ct),ut=n(853),lt=n.n(ut),dt=n(854),ft=n.n(dt),pt=n(855),gt=n.n(pt),mt=n(856),ht=n.n(mt),bt=n(857),vt=n.n(bt),yt=n(858),Ot=n.n(yt),wt=n(106),jt={mobx:u,"mobx-state-tree":l,react:c.a,"react-dom":s,"mobx-react":d,"prop-types":p.a,"@material-ui/core":m,"@material-ui/core/SvgIcon":b.a,"@material-ui/core/utils":h,"@material-ui/lab":v,"@mui/x-data-grid":y,"@material-ui/data-grid":y,"@material-ui/core/colors":o,"@material-ui/core/styles":g,"@material-ui/core/Box":O.a,"@material-ui/core/Button":w.a,"@material-ui/core/ButtonGroup":j.a,"@material-ui/core/Card":k.a,"@material-ui/core/CardContent":x.a,"@material-ui/core/Container":S.a,"@material-ui/core/Checkbox":C.a,"@material-ui/core/Dialog":T.a,"@material-ui/core/FormGroup":P.a,"@material-ui/core/FormLabel":E.a,"@material-ui/core/FormControl":M.a,"@material-ui/core/FormControlLabel":R.a,"@material-ui/core/Grid":A.a,"@material-ui/core/Icon":N.a,"@material-ui/core/IconButton":L.a,"@material-ui/core/InputAdornment":I.a,"@material-ui/core/LinearProgress":F.a,"@material-ui/core/ListItemIcon":D.a,"@material-ui/core/ListItemText":B.a,"@material-ui/core/Menu":V.a,"@material-ui/core/MenuItem":z.a,"@material-ui/core/RadioGroup":U.a,"@material-ui/core/Radio":W.a,"@material-ui/core/Select":q.a,"@material-ui/core/Snackbar":H.a,"@material-ui/core/SnackbarContent":_.a,"@material-ui/core/TextField":G.a,"@material-ui/core/Tooltip":J.a,"@material-ui/core/Typography":X.a,"@material-ui/lab/ToggleButton":Y.a,"@material-ui/lab/ToggleButtonGroup":Q.a,"@jbrowse/core/Plugin":ve.a,"@jbrowse/core/pluggableElementTypes":r,"@jbrowse/core/pluggableElementTypes/ViewType":ie.a,"@jbrowse/core/pluggableElementTypes/AdapterType":ee.a,"@jbrowse/core/pluggableElementTypes/DisplayType":oe.a,"@jbrowse/core/pluggableElementTypes/TrackType":ae.a,"@jbrowse/core/pluggableElementTypes/WidgetType":re.a,"@jbrowse/core/pluggableElementTypes/models":he,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":me,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":de.a,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":le,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":pe,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":ne,"@jbrowse/core/configuration":be,"@jbrowse/core/util/types/mst":wt,"@jbrowse/core/ui":ye,"@jbrowse/core/util":Oe,"@jbrowse/core/util/color":we,"@jbrowse/core/util/layouts":a,"@jbrowse/core/util/tracks":Ne,"@jbrowse/core/util/Base1DViewModel":Z.a,"@jbrowse/core/util/io":Le,"@jbrowse/core/util/mst-reflection":Ie,"@jbrowse/core/util/rxjs":Fe,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":$,"@jbrowse/core/data_adapters/BaseAdapter":K};["mobx","mobx-state-tree","react","react-dom","mobx-react","prop-types","@material-ui/core","@material-ui/core/SvgIcon","@material-ui/core/utils","@material-ui/lab","@mui/x-data-grid","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"].forEach((function(e){if(!(e in jt))throw new Error("ReExports/modules is missing ".concat(e))}));var kt=jt;t.a=kt},954:function(e,t,n){"use strict";n.r(t);var r=n(12),a=n(86),o=n(2),i=n(29),c=n(1),s=n.n(c),u=n(84),l=n(51),d=n(1687),f=n(1642),p=n(1635),g=n(1638),m=n(437),h=n(82),b=n(257),v=n.n(b),y=n(1363),O=n.n(y),w=n(814),j=n(1757),k=n(1633),x=Object(l.a)((function(){return{container:{display:"flex",flexDirection:"row",margin:5},selectText:{marginRight:8,marginTop:10},flexItem:{marginRight:8}}}));var C=Object(u.observer)((function(e){var t=e.model,n=x(),r=t.assemblies,a=t.selectedAssembly,o=t.setSelectedAssembly,i=0===r.length;return s.a.createElement("div",{className:n.container},s.a.createElement(g.a,{className:n.selectText},"Select assembly:"),s.a.createElement(w.a,{className:n.flexItem,disabled:i},s.a.createElement(j.a,{value:function(e){return"all"===e?"all":r.includes(e)?e:"none"}(a),onChange:function(e){return o(e.target.value)}},s.a.createElement(k.a,{value:"none",key:"no-assembly"},"none"),s.a.createElement(k.a,{value:"all",key:"all-assemblies"},"all"),r.map((function(e){return s.a.createElement(k.a,{value:e,key:e},e)})))))})),S=n(1666),T=n(1669),E=n(1670),M=n(1671),R=n(113),P=n.n(R),A=Object(l.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15}}}));var N=Object(u.observer)((function(e){var t=e.rowNumber,n=e.model,r=e.onClose,a=A(),o=n.removeBookmark;return s.a.createElement(S.a,{open:void 0!==t,onClose:r},s.a.createElement(T.a,null,"Delete bookmark",s.a.createElement(f.a,{className:a.closeDialog,"aria-label":"close-dialog",onClick:r},s.a.createElement(P.a,null))),s.a.createElement(E.a,null,s.a.createElement(g.a,null,"Remove"," ",s.a.createElement("code",null,void 0!==t?Object(h.assembleLocString)(n.bookmarkedRegions[t]):"")," ","?")),s.a.createElement(M.a,null,s.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){r()}},"Cancel"),s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){void 0!==t&&(o(t),r())}},"Confirm")))})),L=n(593),I=n.n(L),F=n(83),D=n(80),B=n.n(D),V=n(453);function z(){return(z=Object(F.a)(B.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,d,f,p,g;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.selectedAssembly,o=n.find((function(e){return"LinearGenomeView"===e.type&&e.assemblyNames[0]===a})),!o){e.next=6;break}o.navToLocString(t),e.next=28;break;case 6:return i=Object(h.getSession)(r),c=i.assemblyManager,e.next=10,c.waitForAssembly(a);case 10:if(!(s=e.sent)){e.next=28;break}return e.prev=12,u=Object(h.parseLocString)(t,(function(e){return i.assemblyManager.isValidRefName(e,a)})),l=u.refName,d=s.regions,f=s.getCanonicalRefName(l),d&&(p=d.find((function(e){return e.refName===f}))),g=i.addView("LinearGenomeView",{displayName:a}),e.next=21,Object(h.when)((function(){return g.initialized}));case 21:g.setDisplayedRegions([JSON.parse(JSON.stringify(p))]),g.navToLocString(t),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),i.notify("".concat(e.t0),"error");case 28:case"end":return e.stop()}}),e,null,[[12,25]])})))).apply(this,arguments)}var W=Object(l.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},flexItem:{margin:5},flexContainer:{display:"flex",justifyContent:"space-evenly",width:200}}}));var U=Object(u.observer)((function(e){var t=e.model,n=W(),r=Object(c.useState)(!1),a=Object(i.a)(r,2),o=a[0],u=a[1],l=Object(c.useState)("BED"),d=Object(i.a)(l,2),m=d[0],b=d[1],v=t.bookmarkedRegions;return s.a.createElement(s.a.Fragment,null,s.a.createElement(p.a,{startIcon:s.a.createElement(I.a,null),onClick:function(){return u(!0)}},"Download"),s.a.createElement(S.a,{open:o,onClose:function(){return u(!1)}},s.a.createElement(T.a,null,s.a.createElement(f.a,{className:n.closeDialog,"aria-label":"close-dialog",onClick:function(){return u(!1)}},s.a.createElement(P.a,null))),s.a.createElement(E.a,null,s.a.createElement(g.a,null,"Format to download"),s.a.createElement(j.a,{className:n.flexItem,"data-testid":"selectFileType",value:m,onChange:function(e){return b(e.target.value)}},s.a.createElement(k.a,{value:"BED"},"BED"),s.a.createElement(k.a,{value:"TSV"},"TSV"))),s.a.createElement(M.a,null,s.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){return u(!1)}},"Cancel"),s.a.createElement(p.a,{className:n.flexItem,"data-testid":"dialogDownload",variant:"contained",color:"primary",startIcon:s.a.createElement(I.a,null),onClick:function(){!function(e,t,n){var r,a=n.selectedAssembly,o="TSV"===t?"chrom\tstart\tend\tlabel\tassembly_name\tcoord_range\n":"",i=e.map((function(e){var n=e.label,r=""===n?".":n,o=Object(h.assembleLocString)(e);return"BED"===t?e.assemblyName===a||"all"===a?"".concat(e.refName,"\t").concat(e.start,"\t").concat(e.end,"\t").concat(r.slice(0,255),"\n"):"":"".concat(e.refName,"\t").concat(e.start+1,"\t").concat(e.end,"\t").concat(r,"\t").concat(e.assemblyName,"\t").concat(o,"\n")})).reduce((function(e,t){return e+t}),o),c=new Blob([i||""],{type:"BED"===t?"text/x-bed;charset=utf-8":"text/tab-separated-values;charset=utf-8"});r="BED"===t?"jbrowse_bookmarks_".concat(a,".bed"):"jbrowse_bookmarks.tsv",Object(V.saveAs)(c,r)}(v,m,t),u(!1)}},"Download"))))})),q=n(287),H=n(108),_=n(104),G=n(879),J=n.n(G),X=Object(l.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},flexItem:{margin:5}}}));var Y=Object(u.observer)((function(e){var t=e.model,n=e.assemblyName,r=X(),a=Object(h.getSession)(t),o=a.assemblyNames,u=Object(c.useState)(!1),l=Object(i.a)(u,2),d=l[0],m=l[1],b=Object(c.useState)(),v=Object(i.a)(b,2),y=v[0],O=v[1],w=Object(c.useState)(),j=Object(i.a)(w,2),k=j[0],x=j[1],C=Object(c.useState)(n||o[0]),R=Object(i.a)(C,2),A=R[0],N=R[1];return s.a.createElement(s.a.Fragment,null,s.a.createElement(p.a,{startIcon:s.a.createElement(J.a,null),onClick:function(){return m(!0)}},"Import"),s.a.createElement(S.a,{open:d,onClose:function(){return m(!1)},maxWidth:"xl"},s.a.createElement(T.a,null,"Import bookmarks",s.a.createElement(f.a,{className:r.closeDialog,"aria-label":"close-dialog",onClick:function(){return m(!1)}},s.a.createElement(P.a,null))),s.a.createElement(E.a,null,s.a.createElement(g.a,null,"Choose a BED format file to import. The first 4 columns will be used"),s.a.createElement(H.FileSelector,{location:y,setLocation:O,name:"File"}),s.a.createElement(g.a,null,"Select assembly that your data belongs to"),s.a.createElement(q.a,{onChange:function(e){return N(e)},session:a,selected:A}),k?s.a.createElement(g.a,{color:"error",variant:"h6"},"".concat(k)):null),s.a.createElement(M.a,null,s.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){return m(!1)}},"Cancel"),s.a.createElement(p.a,{className:r.flexItem,"data-testid":"dialogImport",variant:"contained",color:"primary",disabled:!y,startIcon:s.a.createElement(J.a,null),onClick:Object(F.a)(B.a.mark((function e(){var n,r;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Object(_.openLocation)(y).readFile("utf8");case 5:n=e.sent,r=n.split("\n").filter((function(e){return!!e.trim()})).filter((function(e){return!e.startsWith("#")&&!e.startsWith("track")&&!e.startsWith("browser")})).map((function(e){var t=e.split("\t"),n=Object(i.a)(t,4),r=n[0],a=n[1],o=n[2],c=n[3];return{assemblyName:A,refName:r,start:+a,end:+o,label:"."===c?void 0:c}})),t.importBookmarks(r),m(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),x(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))},"Import"))))})),Q=n(866),K=n.n(Q),$=Object(l.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15}}}));var Z=Object(u.observer)((function(e){var t=e.model,n=$(),r=Object(c.useState)(!1),a=Object(i.a)(r,2),o=a[0],u=a[1],l=t.clearAllBookmarks;return s.a.createElement(s.a.Fragment,null,s.a.createElement(p.a,{startIcon:s.a.createElement(K.a,null),"aria-label":"clear bookmarks",onClick:function(){return u(!0)}},"Clear"),s.a.createElement(S.a,{open:o,onClose:function(){return u(!1)}},s.a.createElement(T.a,null,"Clear bookmarks",s.a.createElement(f.a,{className:n.closeDialog,"aria-label":"close-dialog",onClick:function(){return u(!1)}},s.a.createElement(P.a,null))),s.a.createElement(E.a,null,s.a.createElement(g.a,null,"Clear all bookmarks? Note this will clear bookmarks for all assemblies")),s.a.createElement(M.a,null,s.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){u(!1)}},"Cancel"),s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){l(),u(!1)}},"Confirm"))))})),ee=["assemblyName"],te=Object(l.a)((function(){return{link:{cursor:"pointer"}}})),ne=function(e,t){return Math.min(Math.max(Object(h.measureText)(String(e[t]),14)+20,80),1e3)},re=Object(u.observer)((function(e){var t=e.compact,n=e.model,u=te(),l=Object(c.useState)(),p=Object(i.a)(l,2),g=p[0],b=p[1],y=n.bookmarkedRegions,O=n.selectedAssembly,w=Object(h.getSession)(n).views,j=y.toJS().filter((function(e){return"all"===O||e.assemblyName===O})).map((function(e,t){e.assemblyName;var n=Object(o.a)(e,ee);return Object(a.a)(Object(a.a)({},e),{},{id:t,delete:t,locString:Object(h.assembleLocString)("all"===O?e:n)})})),k=[{field:"locString",headerName:"bookmark link",width:Math.max.apply(Math,Object(r.a)(j.map((function(e){return ne(e,"locString")})))),renderCell:function(e){var t=e.value;return s.a.createElement(d.a,{className:u.link,onClick:function(e){!function(e,t,n){z.apply(this,arguments)}(t,w,n),e.preventDefault()}},t)}},{field:"label",width:Math.max(100,Math.max.apply(Math,Object(r.a)(j.map((function(e){return ne(e,"label")}))))),editable:!0},{field:"delete",width:30,renderCell:function(e){var t=e.value;return s.a.createElement(f.a,{"data-testid":"deleteBookmark","aria-label":"delete",onClick:function(){null!==t&&void 0!==t&&b(+t)}},s.a.createElement(v.a,null))}}];return s.a.createElement(s.a.Fragment,null,s.a.createElement(m.DataGrid,{rows:j,rowHeight:t?25:void 0,headerHeight:t?25:void 0,columns:k,onCellEditCommit:function(e){var t=e.value,r=e.id;n.updateBookmarkLabel(r,t)},disableSelectionOnClick:!0}),s.a.createElement(N,{rowNumber:g,model:n,onClose:function(){return b(void 0)}}))}));t.default=Object(u.observer)((function(e){var t=e.model,n=t.selectedAssembly,r=Object(c.useState)(!1),a=Object(i.a)(r,2),o=a[0],u=a[1];return s.a.createElement(s.a.Fragment,null,s.a.createElement(C,{model:t}),s.a.createElement(U,{model:t}),s.a.createElement(Y,{model:t,assemblyName:n}),s.a.createElement(Z,{model:t}),s.a.createElement(p.a,{startIcon:s.a.createElement(O.a,null),onClick:function(){return u(!o)}},"Compact"),s.a.createElement("div",{style:{margin:12}},s.a.createElement(g.a,null,"Note: you can double click the ",s.a.createElement("code",null,"label")," field to add your own custom notes")),s.a.createElement("div",{style:{height:750,width:"100%"}},s.a.createElement(re,{model:t,compact:o})))}))},955:function(e,t,n){"use strict";n.r(t);var r=n(83),a=n(29),o=n(80),i=n.n(o),c=n(1),s=n.n(c),u=n(84),l=n(85),d=n(51),f=n(1638),p=n(1635),g=n(1645),m=n(1685),h=n(1642),b=n(1639),v=n(1641),y=n(82),O=n(573),w=n.n(O),j=n(348),k=n.n(j),x=n(1350),C=n.n(x),S=n(1632),T=n(1636),E=n(1666),M=n(1669),R=n(1670),P=n(1671),A=n(1634),N=n(113),L=n.n(N),I=n(1348),F=n.n(I),D=n(177),B=Object(d.a)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},lockedPluginTooltip:{marginRight:"0.5rem"}}}));function V(){var e=B();return s.a.createElement(T.a,{className:e.lockedPluginTooltip,title:"This plugin was installed by an administrator, you cannot remove it."},s.a.createElement(F.a,null))}function z(e){var t=e.onClose,n=e.plugin,r=B();return s.a.createElement(E.a,{open:!0,onClose:function(){return t()}},s.a.createElement(M.a,null,s.a.createElement(h.a,{className:r.closeDialog,"aria-label":"close-dialog",onClick:function(){return t()}},s.a.createElement(L.a,null))),s.a.createElement(R.a,null,s.a.createElement(f.a,null,"Please confirm that you want to remove ",n,". Note: if any resources in this session still use this plugin, it may cause your session to crash"),s.a.createElement(P.a,null,s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){window.setTimeout((function(){t(n)}),500)}},"Confirm"),s.a.createElement(p.a,{variant:"contained",color:"secondary",onClick:function(){t()}},"Cancel"))))}var W=Object(u.observer)((function(e){var t=e.plugin,n=e.model,r=e.pluginManager,o=Object(c.useState)(),i=Object(a.a)(o,2),u=i[0],d=i[1],p=Object(y.getSession)(n),g=p.sessionPlugins,m=null===g||void 0===g?void 0:g.some((function(e){return r.pluginMetadata[t.name].url===e.url})),b=Object(l.getParent)(n,3),v=b.jbrowse,O=b.adminMode;return s.a.createElement(s.a.Fragment,null,u?s.a.createElement(z,{plugin:u,onClose:function(e){if(e){var n=r.pluginMetadata[t.name];O?v.removePlugin(n):Object(D.m)(p)&&p.removeSessionPlugin(n)}d(void 0)}}):null,s.a.createElement(A.a,{key:t.name},O||m?s.a.createElement(h.a,{"aria-label":"removePlugin","data-testid":"removePlugin-".concat(t.name),onClick:function(){return d(t.name)}},s.a.createElement(L.a,null)):s.a.createElement(V,null),s.a.createElement(f.a,null,t.name)))}));var U=Object(u.observer)((function(e){var t=e.pluginManager,n=e.model,r=t.plugins,a=r.filter((function(e){var n;return null===(n=t.pluginMetadata[e.name])||void 0===n?void 0:n.isCore})).map((function(e){return e.name})),o=r.filter((function(e){return!a.includes(e.name)}));return s.a.createElement(S.a,null,o.length?o.filter((function(e){return e.name.toLowerCase().includes(n.filterText.toLowerCase())})).map((function(e){return s.a.createElement(W,{key:e.name,plugin:e,model:n,pluginManager:t})})):s.a.createElement(f.a,null,"No plugins currently installed"))})),q=n(1675),H=n(1677),_=n(1687),G=n(1676),J=n(1349),X=n.n(J),Y=n(237),Q=n.n(Y),K=n(874),$=n.n(K),Z=Object(d.a)((function(){return{card:{margin:"1em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center",margin:"0.4em 0em"}}}));var ee=Object(u.observer)((function(e){var t=e.plugin,n=e.model,r=e.adminMode,o=Z(),i=Object(y.getSession)(n),u=Object(l.getEnv)(n).pluginManager,d=Boolean(u.runtimePluginDefinitions.find((function(e){return e.url===t.url}))),g=Object(c.useState)(!1),m=Object(a.a)(g,2),h=m[0],b=m[1],v=d||h,O=Object(l.getParent)(n,3).jbrowse;return s.a.createElement(q.a,{variant:"outlined",key:t.name,className:o.card},s.a.createElement(H.a,null,s.a.createElement("div",{className:o.dataField},s.a.createElement(f.a,{variant:"h5"},s.a.createElement(_.a,{href:"".concat(t.location,"#readme"),target:"_blank",rel:"noopener"},t.name))),s.a.createElement("div",{className:o.dataField},s.a.createElement(X.a,{style:{marginRight:"0.5em"}}),s.a.createElement(f.a,null,t.authors.join(", "))),s.a.createElement(f.a,{className:o.bold},"Description:"),s.a.createElement(f.a,null,t.description)),s.a.createElement(G.a,null,s.a.createElement(p.a,{variant:"contained",color:"primary",disabled:v,startIcon:d?s.a.createElement($.a,null):s.a.createElement(Q.a,null),onClick:function(){r?O.addPlugin({name:t.name,url:t.url}):Object(D.m)(i)&&i.addSessionPlugin(t),b(!0)}},d?"Installed":"Install")))})),te=n(6),ne=n(26),re=n(1673),ae=n(1640),oe=Object(d.a)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1)},dialogContent:{display:"flex",flexDirection:"column"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"}}}));var ie=Object(u.observer)((function(e){var t=e.open,n=e.onClose,r=e.model,o=oe(),i=Object(c.useState)(""),u=Object(a.a)(i,2),d=u[0],f=u[1],m=Object(c.useState)(""),b=Object(a.a)(m,2),v=b[0],y=b[1],O=Object(c.useState)(""),j=Object(a.a)(O,2),k=j[0],x=j[1],C=Object(c.useState)(""),S=Object(a.a)(C,2),T=S[0],A=S[1],N=Object(c.useState)(!1),I=Object(a.a)(N,2),F=I[0],D=I[1];function B(e){var t=e.target,n=t.name,r=t.value;"umdName"===n&&f(r),"umdUrl"===n&&y(r),"esmUrl"===n&&x(r),"cjsUrl"===n&&A(r)}var V=Object(l.getRoot)(r).jbrowse,z=Boolean(d&&v||k||T);function W(){if(z){var e={};d&&v&&(e.name=d,e.umdUrl=v),k&&(e.esmUrl=k),T&&(e.cjsUrl=T),V.addPlugin(e)}}function U(){f(""),y(""),x(""),A(""),n()}return s.a.createElement(E.a,{open:t,onClose:U},s.a.createElement(M.a,null,"Add custom plugin",s.a.createElement(h.a,{size:"medium",className:o.closeButton,onClick:function(){return n()}},s.a.createElement(L.a,null))),s.a.createElement("form",{onSubmit:W},s.a.createElement(R.a,{className:o.dialogContent},s.a.createElement(re.a,null,"Enter the name of the plugin and its URL. The name should match what is defined in the plugin's build."),s.a.createElement(g.a,{id:"umd-name-input",name:"umdName",label:"Plugin name",variant:"outlined",value:d,onChange:B}),s.a.createElement(g.a,{id:"umd-url-input",name:"umdUrl",label:"Plugin URL",variant:"outlined",value:v,onChange:B}),s.a.createElement(re.a,{onClick:function(){D(!F)}},s.a.createElement(h.a,{className:Object(ne.a)(o.expand,Object(te.a)({},o.expandOpen,F)),"aria-expanded":F,"aria-label":"show more"},s.a.createElement(w.a,null)),"Advanced options"),s.a.createElement(ae.a,{in:F},s.a.createElement("div",{className:o.dialogContent},s.a.createElement(re.a,null,"The above fields assume that the plugin is built in UMD format. If your plugin is in another format, or you have additional builds you want to add (such as a CJS build for using NodeJS APIs in desktop), you can enter the URLs for those builds below."),s.a.createElement(g.a,{id:"esm-url-input",name:"esmUrl",label:"ESM build URL",variant:"outlined",value:k,onChange:B}),s.a.createElement(g.a,{id:"cjs-url-input",name:"cjsUrl",label:"CJS build URL",variant:"outlined",value:T,onChange:B})))),s.a.createElement(P.a,null,s.a.createElement(p.a,{variant:"contained",onClick:U},"Cancel"),s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:W,disabled:!z},"Submit"))))})),ce=Object(d.a)((function(e){return{root:{margin:e.spacing(1)},expandIcon:{color:"#fff"},adminBadge:{margin:"0.5em",borderRadius:3,backgroundColor:"#FFB11D",padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"0.5em",display:"flex",justifyContent:"center"}}}));t.default=Object(u.observer)((function(e){var t=e.model,n=ce(),o=Object(c.useState)(),u=Object(a.a)(o,2),d=u[0],O=u[1],j=Object(c.useState)(),x=Object(a.a)(j,2),S=x[0],T=x[1],E=Object(c.useState)(!1),M=Object(a.a)(E,2),R=M[0],P=M[1],A=Object(y.getSession)(t).adminMode,N=Object(l.getEnv)(t).pluginManager;return Object(c.useEffect)((function(){var e=new AbortController,t=e.signal;return Object(r.a)(i.a.mark((function e(){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://jbrowse.org/plugin-store/plugins.json",{signal:t});case 3:if((n=e.sent).ok){e.next=9;break}return e.next=7,n.text();case 7:throw r=e.sent,new Error("Failed to fetch plugin data: ".concat(n.status," ").concat(n.statusText," ").concat(r));case 9:return e.next=11,n.json();case 11:a=e.sent,t.aborted||O(a.plugins),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),T(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))(),function(){e.abort()}}),[]),s.a.createElement("div",{className:n.root},A&&s.a.createElement(s.a.Fragment,null,!y.isElectron&&s.a.createElement("div",{className:n.adminBadge},s.a.createElement(C.a,{style:{marginRight:"0.3em"}}),s.a.createElement(f.a,null,"You are using the ",s.a.createElement("code",null,"admin-server"),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store.")),s.a.createElement("div",{className:n.customPluginButton},s.a.createElement(p.a,{variant:"contained",color:"primary",onClick:function(){return P(!0)}},"Add custom plugin")),s.a.createElement(ie,{open:R,onClose:function(){return P(!1)},model:t})),s.a.createElement(g.a,{label:"Filter plugins",value:t.filterText,onChange:function(e){return t.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:s.a.createElement(m.a,{position:"end"},s.a.createElement(h.a,{color:"secondary",onClick:function(){return t.clearFilterText()}},s.a.createElement(k.a,null)))}}),s.a.createElement(b.a,{defaultExpanded:!0},s.a.createElement(v.a,{expandIcon:s.a.createElement(w.a,{className:n.expandIcon})},s.a.createElement(f.a,{variant:"h5"},"Installed plugins")),s.a.createElement("div",{style:{margin:"1em"}},s.a.createElement(U,{pluginManager:N,model:t}))),s.a.createElement(b.a,{defaultExpanded:!0},s.a.createElement(v.a,{expandIcon:s.a.createElement(w.a,{className:n.expandIcon})},s.a.createElement(f.a,{variant:"h5"},"Available plugins")),S?s.a.createElement(f.a,{color:"error"},"".concat(S)):d?d.filter((function(e){return!!(y.isElectron||e.esmUrl||e.url||e.umdUrl)&&e.name.toLowerCase().includes(t.filterText.toLowerCase())})).map((function(e){return s.a.createElement(ee,{key:e.name,plugin:e,model:t,adminMode:!!A})})):s.a.createElement(f.a,null,"Loading...")))}))},960:function(e,t,n){"use strict";n.d(t,"a",(function(){return E})),n.d(t,"b",(function(){return C}));var r=n(29),a=n(86),o=n(1),i=n.n(o),c=n(51),s=n(140),u=n(13),l=n(1638),d=n(84),f=n(26),p=n(285),g=n(82),m=n(286),h=n(197),b=n(454),v=n(1636),y=n(1626),O=Object(c.a)((function(e){var t=e.palette,n=t.tertiary,r=t.primary;return{rubberBand:{height:"100%",background:n?Object(u.a)(n.main,.7):Object(u.a)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:n?n.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),w=Object(d.observer)((function(e){var t,n=e.model,r=e.open,a=e.guideX,o=e.overview,c=O(),s=n.cytobandOffset,u=Object(g.getSession)(n).assemblyManager,l=o.pxToBp(a-s),d=u.get(l.assemblyName),f=null===d||void 0===d||null===(t=d.cytobands)||void 0===t?void 0:t.find((function(e){return l.coord>e.get("start")&&l.coord<e.get("end")&&l.refName===d.getCanonicalRefName(e.get("refName"))}));return i.a.createElement(v.a,{open:r,placement:"top",title:[Object(g.stringify)(l),null===f||void 0===f?void 0:f.get("name")].join(" "),arrow:!0},i.a.createElement("div",{className:c.guide,style:{left:a}}))}));function j(e){var t=e.model,n=e.overview,a=e.ControlComponent,c=void 0===a?i.a.createElement("div",null):a,s=t.cytobandOffset,u=Object(o.useState)(),d=Object(r.a)(u,2),f=d[0],p=d[1],m=Object(o.useState)(),b=Object(r.a)(m,2),v=b[0],j=b[1],k=Object(o.useState)(),x=Object(r.a)(k,2),C=x[0],S=x[1],T=Object(o.useRef)(null),E=Object(o.useRef)(null),M=O(),R=void 0!==f;function P(e){e.preventDefault(),e.stopPropagation(),T.current&&p(e.clientX-T.current.getBoundingClientRect().left)}function A(e){T.current&&S(e.clientX-T.current.getBoundingClientRect().left)}function N(){S(void 0)}if(Object(o.useEffect)((function(){function e(e){var t=T.current;if(t&&R){var n=e.clientX-t.getBoundingClientRect().left;j(n)}}function r(){if(T.current&&void 0!==f&&void 0!==v&&Math.abs(v-f)>3&&t.zoomToDisplayedRegions(n.pxToBp(f-s),n.pxToBp(v-s)),T.current&&void 0!==f&&void 0===v){var e=n.pxToBp(f-s);t.centerAt(Math.round(e.coord),e.refName,e.index)}p(void 0),j(void 0),void 0!==f&&S(void 0)}function a(e){"Escape"===e.key&&(p(void 0),j(void 0))}return R?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",r,!0),window.addEventListener("keydown",a,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",r,!0),window.removeEventListener("keydown",a,!0)}):function(){}}),[R,v,f,t,n,s]),void 0===f)return i.a.createElement("div",{style:{position:"relative"}},void 0!==C?i.a.createElement(w,{model:t,open:!R,overview:n,guideX:C}):null,i.a.createElement("div",{className:M.rubberBandControl,role:"presentation",ref:T,onMouseDown:P,onMouseOut:N,onMouseMove:A},c));var L,I,F=f||0,D=0;if(void 0!==f&&void 0!==v&&(F=v<f?v:f,D=v-f),f&&(L=n.pxToBp(f-s),I=n.pxToBp(f+D-s),v&&v<f)){var B=[I,L];L=B[0],I=B[1]}return i.a.createElement("div",{style:{position:"relative"}},E.current?i.a.createElement(i.a.Fragment,null,i.a.createElement(y.a,{className:M.popover,classes:{paper:M.paper},open:!0,anchorEl:E.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},i.a.createElement(l.a,null,L?Object(g.stringify)(L):"")),i.a.createElement(y.a,{className:M.popover,classes:{paper:M.paper},open:!0,anchorEl:E.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},i.a.createElement(l.a,null,I?Object(g.stringify)(I):""))):null,i.a.createElement("div",{ref:E,className:M.rubberBand,style:{left:F,width:Math.abs(D),height:h.b}}),i.a.createElement("div",{"data-testid":"rubberBand_controls",className:M.rubberBandControl,role:"presentation",ref:T,onMouseDown:P,onMouseOut:N,onMouseMove:A},c))}j.defaultProps={ControlComponent:i.a.createElement("div",null)};var k=Object(d.observer)(j),x=Object(c.a)((function(e){return{scaleBar:{height:h.b},scaleBarBorder:{border:"1px solid"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:h.b},scaleBarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scaleBarLabel:{height:h.b,width:1,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{position:"absolute",height:h.b,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:h.a,position:"relative"},overviewSvg:{width:"100%",position:"absolute"}}})),C=Object(d.observer)((function(e){var t=e.model,n=e.overview,r=e.useOffset,o=void 0===r||r,c=Object(s.a)(),l=Number(o),d=t.interRegionPaddingWidth,f=t.offsetPx,p=t.dynamicBlocks,g=t.cytobandOffset,m=p.contentBlocks,b=p.totalWidthPxWithoutBorders,v=c.palette,y=v.tertiary,O=v.primary,w=y?y.light:O.light;if(!m.length)return null;var j=m[0],k=m[m.length-1],x=(n.bpToPx(Object(a.a)(Object(a.a)({},j),{},{coord:j.reversed?j.end:j.start}))||0)+g*l,C=(n.bpToPx(Object(a.a)(Object(a.a)({},k),{},{coord:k.reversed?k.start:k.end}))||0)+g*l,S=Math.max(0,-f),T=S+b+m.length*d/2,E=[[S,h.a],[T,h.a],[C,0],[x,0]];return i.a.createElement("polygon",{points:E.toString(),fill:Object(u.a)(w,.3),stroke:Object(u.a)(w,.8)})}));function S(e,t,n,r,a){return"M"+e+","+t+"h"+(n-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-n)+"z"}var T={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},E=Object(d.observer)((function(e){var t,n=e.overview,a=e.block,o=e.assembly,c=a.offsetPx,s=a.reversed,u=null===o||void 0===o||null===(t=o.cytobands)||void 0===t?void 0:t.map((function(e){return{refName:o.getCanonicalRefName(e.get("refName")),start:e.get("start"),end:e.get("end"),type:e.get("type")}})).filter((function(e){return e.refName===a.refName})).map((function(e){var t=e.refName,r=e.start,a=e.end,o=e.type;return[n.bpToPx({refName:t,coord:r}),n.bpToPx({refName:t,coord:a}),o]})),l=u||[],d=s?l.length-1:0,f=s?0:l.length-1,p=!0;return u?i.a.createElement("g",{transform:"translate(-".concat(c,")")},u.map((function(e,t){var n,a,o,c,s,u=Object(r.a)(e,3),l=u[0],g=u[1],m=u[2],b="".concat(l,"-").concat(g,"-").concat(m);return"acen"===m&&p?(p=!1,i.a.createElement("polygon",{key:b,points:[[l,0],[g,h.b/2],[l,h.b]].toString(),fill:T[m]})):"acen"!==m||p?d===t?i.a.createElement("path",{key:b,d:(n=Math.min(l,g),a=0,o=Math.abs(g-l),c=h.b,s=8,"M"+(n+s)+","+a+"h"+(o-s)+"v"+c+"h"+(s-o)+"a"+s+","+s+" 0 0 1 "+-s+","+-s+"v"+(2*s-c)+"a"+s+","+s+" 0 0 1 "+s+","+-s+"z"),fill:T[m]}):f===t?i.a.createElement("path",{key:b,d:S(Math.min(l,g),0,Math.abs(g-l)-2,h.b,8),fill:T[m]}):i.a.createElement("rect",{key:b,x:Math.min(l,g),y:0,width:Math.abs(g-l),height:h.b,fill:T[m]}):i.a.createElement("polygon",{key:b,points:[[l,h.b/2],[g,0],[g,h.b]].toString(),fill:T[m]})}))):null})),M=Object(d.observer)((function(e){for(var t=e.scale,n=e.model,r=e.block,a=e.overview,o=x(),c=n.cytobandOffset,s=n.showCytobands,u=r.start,d=r.end,p=r.reversed,m=r.refName,h=r.assemblyName,v=Object(b.a)(t,120,15).majorPitch,y=Object(g.getSession)(n).assemblyManager.get(h),O=null===y||void 0===y?void 0:y.getRefNameColor(m),w=[],j=0;j<Math.floor((d-u)/v);j++){var k=(j+1)*v;w.push(p?d-k:u+k)}return i.a.createElement("div",null,i.a.createElement(l.a,{style:{left:r.offsetPx+3,color:s?"black":O},className:o.scaleBarRefName},m),i.a.createElement("div",{className:Object(f.a)(o.scaleBarContig,s?void 0:p?o.scaleBarContigReverse:o.scaleBarContigForward,s?void 0:o.scaleBarBorder),style:{left:r.offsetPx+c,width:r.widthPx,borderColor:O}},s?null:w.map((function(e,n){return i.a.createElement(l.a,{key:"".concat(JSON.stringify(r),"-").concat(e,"-").concat(n),className:o.scaleBarLabel,variant:"body2",style:{left:(n+1)*v/t,pointerEvents:"none",color:O}},e.toLocaleString("en-US"))})),s?i.a.createElement("svg",{style:{width:"100%"}},i.a.createElement(E,{overview:a,assembly:y,block:r})):null))})),R=Object(d.observer)((function(e){var t=e.model,n=e.scale,r=e.overview,o=x(),c=Object(s.a)(),l=t.dynamicBlocks,d=t.showCytobands,f=t.cytobandOffset,p=l.contentBlocks,g=r.dynamicBlocks,h=c.palette,b=h.tertiary,v=h.primary,y=b?b.light:v.light;if(!p.length)return null;var O=p[0],w=r.bpToPx(Object(a.a)(Object(a.a)({},O),{},{coord:O.reversed?O.end:O.start}))||0,j=p[p.length-1],k=r.bpToPx(Object(a.a)(Object(a.a)({},j),{},{coord:j.reversed?j.start:j.end}))||0,C=d?"#f00":y,S=d?.1:.3;return i.a.createElement("div",{className:o.scaleBar},i.a.createElement("div",{className:o.scaleBarVisibleRegion,style:{width:k-w,left:w+f,background:Object(u.a)(C,S),borderColor:C}}),g.map((function(e,a){return e instanceof m.b?i.a.createElement(M,{scale:n,block:e,model:t,overview:r,key:"".concat(JSON.stringify(e),"-").concat(a)}):i.a.createElement("div",{key:"".concat(JSON.stringify(e),"-").concat(a),className:o.scaleBarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}})})))}));t.c=Object(d.observer)((function(e){var t=e.model,n=e.children,r=x(),a=t.totalBp,o=t.width,c=t.cytobandOffset,s=t.displayedRegions,u=p.a.create({displayedRegions:JSON.parse(JSON.stringify(s)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),l=o-c;u.setVolatileWidth(l),u.showAllRegions();var d=a/(l-2*(s.length-1));return i.a.createElement("div",null,i.a.createElement(k,{model:t,overview:u,ControlComponent:i.a.createElement(R,{model:t,overview:u,scale:d})}),i.a.createElement("div",{className:r.overview},i.a.createElement("svg",{height:h.a,className:r.overviewSvg},i.a.createElement(C,{model:t,overview:u})),n))}))}}]);
//# sourceMappingURL=14.2931c6a5.chunk.js.map