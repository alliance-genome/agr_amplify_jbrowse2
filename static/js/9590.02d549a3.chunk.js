"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9590],{39590:(e,t,i)=>{i.d(t,{doAfterAttach:()=>l});var o=i(88196),a=i(31211),n=i(17925),s=i(1828),r=i(99247),f=i(35950);function l(e){(0,o.addDisposer)(e,(0,r.autorun)((()=>{const t=(0,a.getContainingView)(e);if(!t.initialized)return;const i=e.mainCanvas?.getContext("2d"),o=e.cigarClickMapCanvas?.getContext("2d");if(!i||!o)return;const n=t.middleComparativeHeight,s=t.width;i.clearRect(0,0,s,n),o.clearRect(0,0,s,n),(0,f.Bf)(e,i,o)}))),(0,o.addDisposer)(e,(0,r.autorun)((()=>{(0,a.getContainingView)(e).initialized&&(0,f.z8)(e)}))),(0,o.addDisposer)(e,(0,r.reaction)((()=>{const t=(0,a.getContainingView)(e);return{bpPerPx:t.views.map((e=>e.bpPerPx)),displayedRegions:JSON.stringify(t.views.map((e=>e.displayedRegions))),features:e.features,initialized:t.initialized}}),(({initialized:t})=>{if(!t)return;const{assemblyManager:i}=(0,a.getSession)(e),r=(0,a.getContainingView)(e).views.map((e=>({...(0,o.getSnapshot)(e),width:e.width,staticBlocks:e.staticBlocks,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth}))),f=[],l=e.features||[];for(const e of l){const t=e.get("mate");let o=e.get("start"),a=e.get("end");const l=t.start,c=t.end;-1===e.get("strand")&&([a,o]=[o,a]);const d=i?.get(e.get("assemblyName")),h=i?.get(t.assemblyName),g=e.get("refName"),m=t.refName,b=d?.getCanonicalRefName(g)||g,u=h?.getCanonicalRefName(m)||m,p=r[0],v=r[1],w=(0,n.R)({self:p,refName:b,coord:o}),C=(0,n.R)({self:p,refName:b,coord:a}),M=(0,n.R)({self:v,refName:u,coord:l}),P=(0,n.R)({self:v,refName:u,coord:c});if(void 0===w||void 0===C||void 0===M||void 0===P)continue;const x=e.get("CIGAR");f.push({p11:w,p12:C,p21:M,p22:P,f:e,cigar:s.MismatchParser.parseCigar(x)})}e.setFeatPositions(f)}),{fireImmediately:!0}))}},35950:(e,t,i)=>{i.d(t,{EU:()=>s,z8:()=>g,Bf:()=>h,zv:()=>d});var o=i(31211);function a({feature:e,ctx:t,offsets:i,cb:a,height:s,drawCurves:r,oobLimit:f,viewWidth:l,hideTiny:c}){const{p11:d,p12:h,p21:g,p22:m}=e,b=d.offsetPx-i[0],u=h.offsetPx-i[0],p=g.offsetPx-i[1],v=m.offsetPx-i[1],w=Math.abs(u-b),C=Math.abs(v-p),M=s,P=(M-0)/2,x=Math.min(p,v),T=Math.max(p,v);(0,o.doesIntersect2)(x,T,-f,l+f)&&(w<=1&&C<=1?c||(t.beginPath(),t.moveTo(b,0),r?t.bezierCurveTo(b,P,p,P,p,M):t.lineTo(p,M),t.stroke()):(n(t,b,u,0,v,p,M,P,r),a(t)))}function n(e,t,i,o,a,n,s,r,f){f?function(e,t,i,o,a,n,s,r){const f=Math.abs(t-i),l=Math.abs(t-i);if(f<5&&l<5&&i<t&&Math.abs(t-a)>100){const e=t;t=i,i=e}e.beginPath(),e.moveTo(t,o),e.lineTo(i,o),e.bezierCurveTo(i,r,a,r,a,s),e.lineTo(n,s),e.bezierCurveTo(n,r,t,r,t,o),e.closePath(),e.fill()}(e,t,i,o,a,n,s,r):function(e,t,i,o,a,n,s){e.beginPath(),e.moveTo(t,o),e.lineTo(i,o),e.lineTo(a,s),e.lineTo(n,s),e.closePath(),e.fill()}(e,t,i,o,a,n,s)}const s=16581375;function r(e){return`rgb(${Math.floor(e/65025)%255},${Math.floor(e/255)%255},${e%255})`}const f={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},l=3,c=1600;function d(e,t,i,o){return Math.floor((255*e*255+255*t+i-1)/o)}function h(e,t,i){const d=(0,o.getContainingView)(e),h=d.drawCurves,g=d.drawCIGAR,m=d.middleComparativeHeight,b=d.width,u=d.views.map((e=>e.bpPerPx));i&&(i.imageSmoothingEnabled=!1),t.beginPath();const p=e.featPositions,v=d.views.map((e=>e.offsetPx)),w=Math.floor(s/p.length);t.fillStyle=f.M,t.strokeStyle=f.M;for(const{p11:e,p12:i,p21:o,p22:a}of p){const n=e.offsetPx-v[0],s=i.offsetPx-v[0],r=o.offsetPx-v[1],f=a.offsetPx-v[1],d=Math.abs(s-n),g=Math.abs(f-r),u=0,p=m,w=(p-u)/2;d<=l&&g<=l&&r<b+c&&r>-c&&(t.moveTo(n,u),h?t.bezierCurveTo(n,w,r,w,r,p):t.lineTo(r,p))}t.stroke(),t.fillStyle=f.M,t.strokeStyle=f.M;for(const{p11:e,p12:a,p21:w,p22:C,f:M,cigar:P}of p){const p=e.offsetPx-v[0],x=a.offsetPx-v[0],T=w.offsetPx-v[1],y=C.offsetPx-v[1],k=Math.abs(x-p),R=Math.abs(y-T),S=Math.min(T,y),N=Math.max(T,y),z=0,I=m,W=(I-z)/2;if(!(k<=l&&R<=l)&&(0,o.doesIntersect2)(S,N,-c,d.width+c)){const e=M.get("strand"),o=-1===e?x:p,a=o<(-1===e?p:x)?1:-1,l=(T<y?1:-1)*e;let c=o,d=-1===e?y:T;if(P?.length&&g){let e=!1,o=0,g=0;const m=Math.floor(s/P.length);for(let s=0;s<P.length;s+=2){const p=s*m+1,v=+P[s],w=P[s+1];e||(o=c,g=d);const C=v/u[0],M=v/u[1];if("M"===w||"="===w||"X"===w?(c+=C*a,d+=M*l):"D"===w||"N"===w?c+=C*a:"I"===w&&(d+=M*l),!(Math.max(o,g,c,d)<0||Math.min(o,g,c,d)>b)){const a=s<P.length-2;Math.abs(c-o)<=1&&Math.abs(d-g)<=1&&a?e=!0:(e=!1,t.fillStyle=f[e&&C>1||M>1?w:"M"],n(t,o,c,z,d,g,I,W,h),i&&(i.fillStyle=r(p),n(i,o,c,z,d,g,I,W,h)))}}}else n(t,p,x,z,y,T,I,W,h)}}const C=e.clickMapCanvas?.getContext("2d");if(C){C.imageSmoothingEnabled=!1,C.clearRect(0,0,b,m);for(let e=0;e<p.length;e++){const t=p[e],i=e*w+1;C.fillStyle=r(i),a({cb:e=>e.fill(),feature:t,ctx:C,drawCurves:h,offsets:v,oobLimit:c,viewWidth:d.width,hideTiny:!0,height:m})}}}function g(e){const{clickId:t,mouseoverId:i}=e,n=(0,o.getContainingView)(e),s=n.drawCurves,r=n.middleComparativeHeight,f=n.width,l=e.mouseoverCanvas?.getContext("2d"),d=n.views.map((e=>e.offsetPx));if(!l)return;l.resetTransform(),l.scale(1,1),l.clearRect(0,0,f,r);const h=e.featMap[i||""];h&&(l.fillStyle="rgb(0,0,0,0.1)",a({cb:e=>e.fill(),feature:h,ctx:l,oobLimit:c,viewWidth:n.width,drawCurves:s,offsets:d,height:r}));const g=e.featMap[t||""];g&&(l.strokeStyle="rgb(0, 0, 0, 0.9)",a({cb:e=>e.stroke(),feature:g,ctx:l,oobLimit:c,viewWidth:n.width,drawCurves:s,offsets:d,height:r}))}}}]);
//# sourceMappingURL=9590.02d549a3.chunk.js.map