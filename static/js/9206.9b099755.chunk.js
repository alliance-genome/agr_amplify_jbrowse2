"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[9206,9870],{43334:(e,t,s)=>{s.d(t,{A:()=>i});class i extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,s]of e)this.onEviction(t,s.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const s=t.get(e);return this._getItemValue(e,s)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,s)&&(yield e)}for(const e of this.cache){const[t,s]=e;!1===this._deleteIfExpired(t,s)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:s=this.maxAge}={}){const i="number"==typeof s&&s!==Number.POSITIVE_INFINITY?Date.now()+s:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],s=t.length-e;s<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(s>0&&this._emitEvictions(t.slice(0,s)),this.oldCache=new Map(t.slice(s)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,s]=e;!1===this._deleteIfExpired(t,s)&&(yield[t,s.value])}for(const e of this.oldCache){const[t,s]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,s)&&(yield[t,s.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,a]=s;!1===this._deleteIfExpired(i,a)&&(yield[i,a.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const s=e[t],[i,a]=s;this.cache.has(i)||!1===this._deleteIfExpired(i,a)&&(yield[i,a.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[s,i]of this.entriesAscending())e.call(t,i,s,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}},79206:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var i=s(71616),a=s(99834),n=s(69870);const h=class extends n.default{async setupPre(){const e=this.getConf("fastaLocation"),t=this.getConf("faiLocation"),s=this.getConf("gziLocation"),n={fasta:(0,a.openLocation)(e,this.pluginManager),fai:(0,a.openLocation)(t,this.pluginManager),gzi:(0,a.openLocation)(s,this.pluginManager)};return{fasta:new i.tP(n)}}}},69870:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var i=s(71616),a=s(46377),n=s(99834),h=s(66885),c=s(99546),o=s(5742),r=s.n(o),l=s(43334);const d=class extends a.BaseSequenceAdapter{seqCache=new(r())({cache:new l.A({maxSize:200}),fill:async(e,t)=>{const{refName:s,start:i,end:a,fasta:n}=e;return n.getSequence(s,i,a,{...e,signal:t})}});async getRefNames(e){const{fasta:t}=await this.setup();return t.getSequenceNames(e)}async getRegions(e){const{fasta:t}=await this.setup(),s=await t.getSequenceSizes(e);return Object.keys(s).map((e=>({refName:e,start:0,end:s[e]})))}async setupPre(){const e=this.getConf("fastaLocation"),t=this.getConf("faiLocation");return{fasta:new i.BL({fasta:(0,n.openLocation)(e,this.pluginManager),fai:(0,n.openLocation)(t,this.pluginManager)})}}async getHeader(){const e=this.getConf("metadataLocation");return""===e.uri||"/path/to/fa.metadata.yaml"===e.uri?null:(0,n.openLocation)(e,this.pluginManager).readFile("utf8")}async setup(){return this.setupP||(this.setupP=this.setupPre().catch((e=>{throw this.setupP=void 0,e}))),this.setupP}getFeatures(e,t){const{refName:s,start:i,end:a}=e;return(0,h.ObservableCreate)((async e=>{const{fasta:n}=await this.setup(),h=await n.getSequenceSize(s,t),o=void 0!==h?Math.min(h,a):a,r=[],l=128e3,d=i-i%l,f=a+(l-a%l);for(let e=d;e<f;e+=l){const i={refName:s,start:e,end:e+l};r.push(this.seqCache.get(JSON.stringify(i),{...i,fasta:n},t?.signal))}const u=(await Promise.all(r)).join("").slice(i-d).slice(0,a-i);u&&e.next(new c.SimpleFeature({id:`${s} ${i}-${o}`,data:{refName:s,start:i,end:o,seq:u}})),e.complete()}))}freeResources(){}}}}]);
//# sourceMappingURL=9206.9b099755.chunk.js.map