"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[3199],{98335:(e,t,l)=>{l.d(t,{A:()=>i});var a=l(7552),n=l(75785),s=l(66684);const o=(0,n.n9)()((e=>({resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.action.disabled,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}})));function r({left:e,scrollLeft:t,idx:l,onDrag:n,onMouseDown:r}){const{classes:i}=o(),c=(0,a.useCallback)(((e,t)=>n(e,t,l)),[l,n]);return a.createElement(a.Fragment,null,a.createElement(s.A,{onDrag:c,onMouseDown:r,vertical:!0,className:i.hiddenTick,style:{left:e-t-2.5}}),a.createElement("div",{style:{left:e-t},className:i.tick}))}function i({widths:e,setWidths:t,checkbox:l,scrollLeft:n=0}){const{classes:s}=o(),i=[],[c,d]=(0,a.useState)();let m=l?52:0;for(let t=0;t<e.length;t++){const l=e[t];i[t]=l+m,m+=l}return a.createElement("div",{className:s.resizeBar},i.map(((l,s)=>a.createElement(r,{key:s,onMouseDown:()=>{d([...e])},left:s===i.length-1?l-3:l,onDrag:(l,a,n)=>{const s=[...e];s[n]=Math.max(c[n]-a,50),t(s)},idx:s,scrollLeft:n}))))}},20194:(e,t,l)=>{l.d(t,{X:()=>n});var a=l(7552);function n(){const e=(0,a.useRef)(null),[t,l]=(0,a.useState)(0);return(0,a.useEffect)((()=>{const t=setInterval((()=>{const t=e.current?.querySelector(".MuiDataGrid-virtualScroller");t&&l(t.scrollLeft)}),100);return()=>{clearInterval(t)}}),[]),{ref:e,scrollLeft:t}}},53199:(e,t,l)=>{l.r(t),l.d(t,{default:()=>I});var a=l(7552),n=l(68446),s=l(75785),o=l(99546),r=l(9937),i=l(23758),c=l(87731),d=l(61131),m=l(92179),u=l(20194),b=l(98335),h=l(66395),f=l(84495);const k=(0,a.lazy)((()=>l.e(4773).then(l.bind(l,84773)))),g=(0,s.n9)()((()=>({link:{cursor:"pointer"},cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}))),w=(0,n.observer)((function({model:e}){const{classes:t,cx:l}=g(),{ref:n,scrollLeft:s}=(0,u.X)(),{bookmarks:r,bookmarksWithValidAssemblies:i,selectedAssemblies:w,selectedBookmarks:p}=e,y=(0,o.getSession)(e),v=new Set(w),A=r.filter((e=>v.has(e.assemblyName))).map(((e,t)=>{const{assemblyName:l,...a}=e;return{...e,id:t,assemblyName:l,locString:(0,o.assembleLocString)(a),correspondingObj:e}})),[E,S]=(0,a.useState)([50,Math.max((0,o.measureText)("Bookmark link",12)+30,(0,o.measureGridWidth)(A.map((e=>e.locString)))),Math.max((0,o.measureText)("Label",12)+30,(0,o.measureGridWidth)(A.map((e=>e.label)))),Math.max((0,o.measureText)("Assembly",12)+30,(0,o.measureGridWidth)(A.map((e=>e.assemblyName)))),100]);return a.createElement("div",{ref:n},a.createElement(b.A,{widths:E,setWidths:S,scrollLeft:s}),a.createElement(d.zh,{autoHeight:!0,density:"compact",rows:A,columns:[{...m.f,width:E[0]},{field:"locString",headerName:"Bookmark link",width:E[1],renderCell:({value:n,row:s})=>a.createElement(c.A,{className:l(t.link,t.cell),href:"#",onClick:async t=>{t.preventDefault();const{views:l}=y;await(0,f.Jn)(n,s.assemblyName,l,e)}},n)},{field:"label",headerName:"Label",width:E[2],editable:!0},{field:"assemblyName",headerName:"Assembly",width:E[3]},{field:"highlight",headerName:"Highlight",width:E[4],renderCell:({value:t,row:l})=>a.createElement(h.default,{color:t||"black",onChange:t=>{e.updateBookmarkHighlight(l,t)}})}],onCellDoubleClick:({row:t})=>{(0,o.getSession)(e).queueDialog((l=>[k,{onClose:l,model:e,dialogRow:t}]))},processRowUpdate:t=>{const l=A[t.id];return e.updateBookmarkLabel(l,t.label),t},onProcessRowUpdateError:e=>y.notify(e.message,"error"),checkboxSelection:!0,onRowSelectionModelChange:t=>{i.length>0&&e.setSelectedBookmarks(t.map((e=>({...A[e]}))))},rowSelectionModel:p.map((e=>e.id)),disableRowSelectionOnClick:!0}))}));var p=l(48171),y=l(17125),v=l(98360),A=l(28172),E=l(29629),S=l(32808),C=l(81453);const x=(0,n.observer)((function({model:e}){const{validAssemblies:t,selectedAssemblies:l}=e,n=0===t.size,s="Select assemblies",o="select-assemblies-label",r=new Set(l),i=[...t].every((e=>r.has(e)));return a.createElement(p.A,{disabled:n,fullWidth:!0},a.createElement(y.A,{id:o},s),a.createElement(v.A,{labelId:o,multiple:!0,value:l,onChange:t=>e.setSelectedAssemblies([...t.target.value]),input:a.createElement(A.A,{label:s}),renderValue:e=>e.join(", ")},a.createElement(E.A,{onClickCapture:t=>{i?e.setSelectedAssemblies([]):e.setSelectedAssemblies(void 0),t.preventDefault()}},a.createElement(S.A,{checked:i,indeterminate:!i&&l.length>0}),a.createElement(C.A,{primary:"Select all"})),[...t].map((e=>a.createElement(E.A,{key:e,value:e},a.createElement(S.A,{checked:l.includes(e)}),a.createElement(C.A,{primary:e}))))))}));var N=l(91318),D=l(57118),L=l(54042),B=l(27820),_=l(88766),$=l(50450),z=l(78126);const M=(0,a.lazy)((()=>l.e(5746).then(l.bind(l,5746)))),T=(0,a.lazy)((()=>Promise.all([l.e(3011),l.e(3425)]).then(l.bind(l,23425)))),W=(0,a.lazy)((()=>l.e(419).then(l.bind(l,20419)))),q=(0,a.lazy)((()=>l.e(772).then(l.bind(l,70772)))),V=(0,a.lazy)((()=>l.e(1326).then(l.bind(l,11326)))),j=(0,a.lazy)((()=>l.e(1811).then(l.bind(l,71811)))),G=(0,s.n9)()({flex:{display:"flex"}}),I=(0,n.observer)((function({model:e}){const{classes:t}=G();return e?a.createElement("div",null,a.createElement(r.A,{severity:"info"},"Click and type within the ",a.createElement("strong",null,"label")," field to annotate your bookmark. Double click the ",a.createElement("strong",null,"label")," field to do so within a dialog."),a.createElement("div",{className:t.flex},a.createElement(i.A,{"data-testid":"grid_bookmark_menu",menuItems:[{label:"Export",icon:D.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[M,{onClose:t,model:e}]))}},{label:"Import",icon:L.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[T,{model:e,onClose:t}]))}},{label:"Delete",icon:z.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[j,{model:e,onClose:t}]))}},{label:"Share",icon:$.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[W,{model:e,onClose:t}]))}},{label:"Edit colors",icon:_.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[V,{model:e,onClose:t}]))}},{label:"Settings",icon:B.A,onClick:()=>{(0,o.getSession)(e).queueDialog((t=>[q,{model:e,onClose:t}]))}}]},a.createElement(N.A,null)),a.createElement(x,{model:e})),a.createElement(w,{model:e})):null}))},84495:(e,t,l)=>{l.d(t,{Jn:()=>s,LP:()=>r,eW:()=>i,fU:()=>o});var a=l(45465),n=l(99546);async function s(e,t,l,a){const s=(0,n.getSession)(a);try{let n=l.find((e=>e.id===s.focusedViewId));if(n?.assemblyNames[0]!==t&&(n=l.find((e=>"LinearGenomeView"===e.type&&e.assemblyNames[0]===t))),!n){const e=`${a.id}_${t}`;n=s.addView("LinearGenomeView",{id:e})}await n.navToLocString(e,t)}catch(e){console.error(e),s.notify(`${e}`,"error")}}function o(e,t){const{selectedBookmarks:l,bookmarksWithValidAssemblies:s}=t,o=0===l.length?s:l;if("BED"===e){const e="",t={};o.forEach((e=>{const{label:l}=e,a=""===l?".":l,n=`${e.refName}\t${e.start}\t${e.end}\t${a}\n`;t[e.assemblyName]?t[e.assemblyName].push(n):t[e.assemblyName]=[n]}));for(const l in t){const n=t[l].reduce(((e,t)=>e+t),e),s=new Blob([n||""],{type:"text/x-bed;charset=utf-8"}),o=`jbrowse_bookmarks_${l}.bed`;(0,a.saveAs)(s,o)}}else{const e="chrom\tstart\tend\tlabel\tassembly_name\tcoord_range\n",t=o.map((e=>{const{label:t}=e,l=""===t?".":t,a=(0,n.assembleLocString)(e);return`${e.refName}\t${e.start+1}\t${e.end}\t${l}\t${e.assemblyName}\t${a}\n`})).reduce(((e,t)=>e+t),e),l=new Blob([t||""],{type:"text/tab-separated-values;charset=utf-8"}),s="jbrowse_bookmarks.tsv";(0,a.saveAs)(l,s)}}async function r(e){const t=function(e){let t=0;switch(e.length%4){case 3:t=1;break;case 2:t=2;break;case 0:t=0;break;default:throw new Error("base64 not a valid length")}return e+"=".repeat(t)}(e.replaceAll("-","+").replaceAll("_","/")),{toByteArray:a}=await Promise.resolve().then(l.t.bind(l,47130,19)),{inflate:n}=await l.e(7864).then(l.t.bind(l,57864,23)),s=n(a(t));return(new TextDecoder).decode(s)}async function i(e){const t=(new TextEncoder).encode(e),{deflate:a}=await l.e(7864).then(l.t.bind(l,57864,23)),{fromByteArray:n}=await Promise.resolve().then(l.t.bind(l,47130,19)),s=n(a(t)),o=s.indexOf("=");return o>0?s.slice(0,o).replaceAll("+","-").replaceAll("/","_"):s.replaceAll("+","-").replaceAll("/","_")}}}]);
//# sourceMappingURL=3199.1011ff95.chunk.js.map