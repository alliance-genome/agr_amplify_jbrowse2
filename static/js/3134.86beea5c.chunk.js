"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[3134],{83134:function(e,t,r){r.r(t),r.d(t,{default:function(){return J}});var n=r(41361),s=r(33028),a=r(34795),c=r(96234),i=r(59740),o=r(77162),u=r.n(o),l=r(30969),h=r(33528),p=r(94103),f=r(80975),x=r(22714),b=r(28224),d=r(75654),j=r(55788),g=r(317),v=r(93717),m=r(18189),Z=r(81073),y=r(36174),w=r(8118),k=r(34122),S=r(14721),L=r(23957),T=r(34808),C=r(32343),E=r(25399),_=r(67897),M=r(35167),R=r.n(M),U=r(37574);var z=function(e){var t=(0,l.useState)(null),r=(0,c.Z)(t,2),n=r[0],s=r[1],i=(0,l.useState)(null),o=(0,c.Z)(i,2),x=o[0],b=o[1],d=e.hub,j=d.url,g=d.longLabel,v=d.shortLabel;return(0,l.useEffect)((function(){function e(){return(e=(0,a.Z)(u().mark((function e(){var t,r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,h.openLocation)({uri:j,locationType:"UriLocation"}),e.next=4,r.readFile("utf8");case 4:t=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),b((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Error retrieving hub"})," ",e.t0.message," ",(0,U.jsx)("br",{}),j]})),e.abrupt("return");case 11:try{n=new w.HubFile(t),s(n)}catch(a){b((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Could not parse genomes file:"})," ",(0,U.jsx)("br",{}),a.message," ",(0,U.jsx)("br",{}),j]}))}case 12:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[j]),x?(0,U.jsx)(k.Z,{children:(0,U.jsx)(L.Z,{children:(0,U.jsx)(f.Z,{color:"error",children:x})})}):n?(0,U.jsxs)(k.Z,{children:[(0,U.jsx)(T.Z,{title:v}),(0,U.jsx)(L.Z,{children:(0,U.jsx)("div",{__dangerouslySetInnerHTML:R().sanitize(g)})}),(0,U.jsxs)(S.Z,{children:[(0,U.jsx)(C.Z,{href:"mailto:".concat(n.get("email")),rel:"noopener noreferrer",target:"_blank",color:"secondary",children:(0,U.jsx)(E.Z,{})}),n.get("descriptionUrl")?(0,U.jsx)(C.Z,{href:new URL(n.get("descriptionUrl"),new URL(j)).href,rel:"noopener noreferrer",target:"_blank",children:(0,U.jsx)(_.Z,{color:"secondary"})}):null]})]}):(0,U.jsx)(p.Z,{variant:"query"})},A=r(98302),H=r(57071),N=r(1720),F=r(43175),I=(0,x.Z)((function(e){return{formControl:{minWidth:192,marginLeft:e.spacing(2),marginRight:e.spacing(2)}}}));var O=function(e){var t=e.selectList,r=e.selectedItem,n=e.handleSelect,s=e.label,a=e.helpText,c=I();return(0,U.jsxs)(b.Z,{className:c.formControl,children:[(0,U.jsx)(H.Z,{children:s}),(0,U.jsx)(F.Z,{value:r,onChange:n,children:t.map((function(e){var t,r;return e.name&&(t=e.name,r="".concat(e.name," (").concat(e.synonyms.join(" "),")")),(0,U.jsx)(N.Z,{value:t||e,children:r||e},r||e)}))}),(0,U.jsx)(A.Z,{children:r?"":a})]})},q=["children"];function P(e){var t=e.status;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(p.Z,{variant:"query"}),(0,U.jsx)(f.Z,{children:t})]})}function B(e){return(0,e.children)((0,i.Z)(e,q))}var D=(0,x.Z)((function(e){return{hubList:{maxHeight:400,overflowY:"auto"},genomeSelector:{marginTop:e.spacing(1)}}}));var J=function(e){var t=e.model,r=e.setModelReady,i=(0,l.useState)(null),o=(0,c.Z)(i,2),p=o[0],x=o[1],w=(0,l.useState)(null),k=(0,c.Z)(w,2),S=k[0],L=k[1],T=(0,l.useState)(""),C=(0,c.Z)(T,2),E=C[0],_=C[1],M=(0,l.useState)(""),R=(0,c.Z)(M,2),A=R[0],H=R[1],N=(0,l.useState)(new Map),F=(0,c.Z)(N,2),I=F[0],q=F[1],J=(0,l.useState)(!1),V=(0,c.Z)(J,2),W=V[0],G=V[1],Y=(0,l.useState)(""),K=(0,c.Z)(Y,2),Q=K[0],X=K[1],$=D();function ee(e,t){return te.apply(this,arguments)}function te(){return(te=(0,a.Z)(u().mark((function e(t,r){var s,a,c,i,o,l,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 10,s=r?new Map:new Map(I),a=Math.floor(I.size/10)+1,e.next=5,se("https://www.trackhubregistry.org/api/search",{page:a,entries_per_page:10},{body:JSON.stringify({assembly:A}),signal:t});case 5:if(!(c=e.sent)){e.next=38;break}i=(0,n.Z)(c.items),e.prev=8,i.s();case 10:if((o=i.n()).done){e.next=28;break}if(!(l=o.value).hub.url.startsWith("ftp://")){e.next=16;break}l.error="JBrowse cannot add connections from FTP sources",e.next=25;break;case 16:return p=(0,h.openLocation)({uri:l.hub.url,locationType:"UriLocation"}),e.prev=17,e.next=20,p.stat();case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(17),l.error=e.t0.message;case 25:s.set(l.id,l);case 26:e.next=10;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(8),i.e(e.t1);case 33:return e.prev=33,i.f(),e.finish(33);case 36:q(s),s.size===c.total_entries&&G(!0);case 38:case"end":return e.stop()}}),e,null,[[8,30,33,36],[17,22]])})))).apply(this,arguments)}function re(e){return ne.apply(this,arguments)}function ne(){return ne=(0,a.Z)(u().mark((function e(t){var r,n,s,a,c=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:{},n=c.length>2&&void 0!==c[2]?c[2]:{},a=Object.keys(r).map((function(e){return"".concat(e,"=").concat(r[e])})).join(";"),e.prev=3,e.next=6,fetch("".concat(t).concat(a?"?".concat(a):""),n);case 6:s=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),(0,Z.isAbortException)(e.t0)||x((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Network connection error."})," ",(0,U.jsx)("br",{}),e.t0.message," ",(0,U.jsx)("br",{}),t]})),e.abrupt("return",null);case 13:if(s.ok){e.next=16;break}return x((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Error connecting to the URL."})," ",(0,U.jsx)("br",{}),s.status,": ",s.statusText," ",(0,U.jsx)("br",{}),t]})),e.abrupt("return",null);case 16:return e.abrupt("return",s.json());case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),ne.apply(this,arguments)}function se(e){return ae.apply(this,arguments)}function ae(){return ae=(0,a.Z)(u().mark((function e(t){var r,n,a,c,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},n=i.length>2&&void 0!==i[2]?i[2]:{},c=Object.keys(r).map((function(e){return"".concat(e,"=").concat(r[e])})).join(";"),e.prev=3,e.next=6,fetch("".concat(t).concat(c?"?".concat(c):""),(0,s.Z)((0,s.Z)({},n),{},{method:"POST"}));case 6:a=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),(0,Z.isAbortException)(e.t0)||x((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Network connection error."})," ",(0,U.jsx)("br",{}),e.t0.message," ",(0,U.jsx)("br",{}),t]})),e.abrupt("return",null);case 13:if(a.ok){e.next=16;break}return x((0,U.jsxs)("span",{children:[(0,U.jsx)("strong",{children:"Error connecting to the URL."})," ",(0,U.jsx)("br",{}),a.status,": ",a.statusText," ",(0,U.jsx)("br",{}),t]})),e.abrupt("return",null);case 16:return e.abrupt("return",a.json());case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),ae.apply(this,arguments)}(0,l.useEffect)((function(){r(!!Q)}),[Q,r]),(0,l.useEffect)((function(){var e=new AbortController,t=e.signal;function r(){return(r=(0,a.Z)(u().mark((function e(){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re("https://www.trackhubregistry.org/api/info/ping",void 0,{signal:t});case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(1===r.ping){e.next=8;break}return x("Registry is not available"),e.abrupt("return");case 8:return e.next=10,re("https://www.trackhubregistry.org/api/info/assemblies",void 0,{signal:t});case 10:(n=e.sent)&&L(n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){r.apply(this,arguments)}(),function(){e.abort()}}),[]),(0,l.useEffect)((function(){var e=new AbortController,t=e.signal;return p||(A&&!I.size?ee(t,!0):I.size&&!W&&ee(t)),function(){e.abort()}}));var ce=[(0,U.jsx)(f.Z,{variant:"h6",children:"The Track Hub Registry"},"heading")];if(p)return ce.push((0,U.jsx)(f.Z,{color:"error",children:p},"errorMessage")),(0,U.jsx)("div",{children:ce});if(!S)return ce.push((0,U.jsx)(P,{status:"Connecting to registry..."},"queryStatus")),(0,U.jsx)("div",{children:ce});var ie=Object.keys(S).sort().filter((function(e){return e.toLowerCase().includes("sapiens")}));if(ce.push((0,U.jsx)(O,{selectList:ie,selectedItem:E,handleSelect:function(e){_(e.target.value),H(""),q(new Map),X(""),G(!1)},label:"Species",helpText:"Select a species"},"speciesSelect")),E){var oe=S[E].filter((function(e){return!("GRCh37"===e.name&&"hg38"===e.synonyms[0])}));ce.push((0,U.jsx)(O,{selectList:oe,selectedItem:A,handleSelect:function(e){H(e.target.value),q(new Map),X(""),G(!1)},label:"Assembly",helpText:"Select an assembly"},"assemblySelect"))}return A&&(ce.push((0,U.jsx)("div",{children:(0,U.jsxs)(b.Z,{children:[(0,U.jsx)(d.Z,{children:"Hubs:"}),(0,U.jsx)("div",{className:$.hubList,children:(0,U.jsx)(j.Z,{value:Q,onChange:function(e){var r=e.target.value;X(r),t.target.name.set(I.get(r).hub.shortLabel),t.target.assemblyNames.set([A]),t.target.trackDbId.set(r)},children:Array.from(I.values()).filter((function(e){return e.assembly.name===A||e.assembly.synonyms.includes(A)})).map((function(e){var t=e.error,r=e.id,n=e.hub,a=n.shortLabel,c=n.longLabel;return(0,U.jsx)(B,{value:r,children:function(e){return(0,U.jsx)(g.ZP,{title:t||(0,U.jsx)(y.Z,{html:c}),placement:"left",interactive:!0,children:(0,U.jsx)(v.Z,(0,s.Z)({value:r,label:(0,U.jsx)(y.Z,{html:a}),disabled:Boolean(t),control:(0,U.jsx)(m.Z,{})},e),r)})}},r)}))})})]})},"hubSelect")),W||ce.push((0,U.jsx)(P,{status:"Retrieving hubs"},"hubStatus"))),Q&&ce.push((0,U.jsx)(z,{hub:I.get(Q).hub},"hubDetails")),(0,U.jsx)(U.Fragment,{children:ce})}},25399:function(e,t,r){var n=r(14859),s=r(93291);t.Z=void 0;var a=s(r(30969)),c=(0,n(r(87131)).default)(a.createElement("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"}),"Email");t.Z=c}}]);
//# sourceMappingURL=3134.86beea5c.chunk.js.map