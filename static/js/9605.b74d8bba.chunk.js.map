{"version":3,"file":"static/js/9605.b74d8bba.chunk.js","mappings":"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","sources":["../../../plugins/wiggle/src/BigWigAdapter/BigWigAdapter.ts"],"sourcesContent":["import { BigWig } from '@gmod/bbi'\nimport {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { updateStatus, Feature } from '@jbrowse/core/util'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { rectifyStats, UnrectifiedFeatureStats } from '@jbrowse/core/util/stats'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nexport default class BigWigAdapter extends BaseFeatureDataAdapter {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private setupP?: Promise<{ bigwig: BigWig; header: any }>\n\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  private async setupPre(opts?: BaseOptions) {\n    const { statusCallback = () => {} } = opts || {}\n    const bigwig = new BigWig({\n      filehandle: openLocation(\n        this.getConf('bigWigLocation'),\n        this.pluginManager,\n      ),\n    })\n    const header = await updateStatus(\n      'Downloading bigwig header',\n      statusCallback,\n      () => bigwig.getHeader(opts),\n    )\n    return { bigwig, header }\n  }\n\n  async setup(opts?: BaseOptions) {\n    if (!this.setupP) {\n      this.setupP = this.setupPre(opts).catch(e => {\n        this.setupP = undefined\n        throw e\n      })\n    }\n    return this.setupP\n  }\n\n  public async getRefNames(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return Object.keys(header.refsByName)\n  }\n\n  public async refIdToName(refId: number) {\n    const { header } = await this.setup()\n    return header.refsByNumber[refId]?.name\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const { header } = await this.setup(opts)\n    return rectifyStats(header.totalSummary as UnrectifiedFeatureStats)\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    const { refName, start, end } = region\n    const {\n      bpPerPx = 0,\n      signal,\n      resolution = 1,\n      statusCallback = () => {},\n    } = opts\n    return ObservableCreate<Feature>(async observer => {\n      statusCallback('Downloading bigwig data')\n      const source = this.getConf('source')\n      const { bigwig } = await this.setup(opts)\n      const feats = await bigwig.getFeatures(refName, start, end, {\n        ...opts,\n        basesPerSpan: bpPerPx / resolution,\n      })\n\n      for (let i = 0; i < feats.length; i++) {\n        const data = feats[i]\n        if (source) {\n          // @ts-ignore\n          data.source = source\n        }\n        const uniqueId = `${source}:${region.refName}:${data.start}-${data.end}`\n        // @ts-ignore\n        data.refName = refName\n        data.uniqueId = uniqueId\n        observer.next({\n          // @ts-ignore\n          get: (str: string) => (data as Record<string, unknown>)[str],\n          id: () => uniqueId,\n          // @ts-ignore\n          toJSON: () => data,\n        })\n      }\n      observer.complete()\n    }, signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async estimateRegionsStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["BigWigAdapter","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","setupP","_createClass","key","value","_setupPre","_asyncToGenerator","_regeneratorRuntime","mark","_callee","opts","_ref$statusCallback","statusCallback","bigwig","header","wrap","_context","prev","next","BigWig","filehandle","openLocation","this","getConf","pluginManager","updateStatus","getHeader","sent","abrupt","stop","_x","_setup","_callee2","_this2","_context2","setupPre","catch","e","undefined","_x2","_getRefNames","_callee3","_yield$this$setup","_context3","setup","Object","keys","refsByName","_x3","_refIdToName","_callee4","refId","_header$refsByNumber$","_yield$this$setup2","_context4","refsByNumber","name","_x4","_getGlobalStats","_callee5","_yield$this$setup3","_context5","rectifyStats","totalSummary","_x5","region","_this3","refName","start","end","_opts$bpPerPx","bpPerPx","signal","_opts$resolution","resolution","_opts$statusCallback","ObservableCreate","_ref2","_callee6","observer","source","_yield$_this3$setup","feats","_loop","i","_context7","getFeatures","_objectSpread","basesPerSpan","data","uniqueId","_context6","get","str","id","toJSON","delegateYield","complete","_x6","_estimateRegionsStats","_callee7","_regions","_context8","featureDensity","_x7","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}