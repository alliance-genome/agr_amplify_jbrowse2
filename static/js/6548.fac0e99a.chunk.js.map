{"version":3,"file":"static/js/6548.fac0e99a.chunk.js","mappings":"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","sources":["../../../plugins/gccontent/src/GCContentAdapter/GCContentAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { firstValueFrom } from 'rxjs'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, Region } from '@jbrowse/core/util'\nimport { toArray } from 'rxjs/operators'\n\nexport default class extends BaseFeatureDataAdapter {\n  private gcMode = 'content'\n\n  public static capabilities = ['hasLocalStats']\n\n  public async configure() {\n    const adapter = await this.getSubAdapter?.(this.getConf('sequenceAdapter'))\n    if (!adapter) {\n      throw new Error('Error getting subadapter')\n    }\n    return adapter.dataAdapter as BaseFeatureDataAdapter\n  }\n\n  public async getRefNames() {\n    const adapter = await this.configure()\n    return adapter.getRefNames()\n  }\n\n  public getFeatures(query: Region, opts: BaseOptions) {\n    return ObservableCreate<Feature>(async observer => {\n      const sequenceAdapter = await this.configure()\n      const windowSize = this.getConf('windowSize')\n      const windowDelta = this.getConf('windowDelta')\n      const hw = windowSize === 1 ? 1 : windowSize / 2 // Half the window size\n      const f = windowSize === 1\n\n      let { start: queryStart, end: queryEnd } = query\n      queryStart = Math.max(0, queryStart - hw)\n      queryEnd += hw\n\n      if (queryEnd < 0 || queryStart > queryEnd) {\n        observer.complete()\n        return\n      }\n\n      const ret = sequenceAdapter.getFeatures(\n        {\n          ...query,\n          start: queryStart,\n          end: queryEnd,\n        },\n        opts,\n      )\n      const feats = await firstValueFrom(ret.pipe(toArray()))\n      const residues = feats[0]?.get('seq') || ''\n\n      for (let i = hw; i < residues.length - hw; i += windowDelta) {\n        const r = f ? residues[i] : residues.slice(i - hw, i + hw)\n        let nc = 0\n        let ng = 0\n        let len = 0\n        for (const letter of r) {\n          if (letter === 'c' || letter === 'C') {\n            nc++\n          } else if (letter === 'g' || letter === 'G') {\n            ng++\n          }\n          if (letter !== 'N') {\n            len++\n          }\n        }\n        const pos = queryStart\n        let score\n        if (this.gcMode === 'content') {\n          score = (ng + nc) / (len || 1)\n        } else if (this.gcMode === 'skew') {\n          score = (ng - nc) / (ng + nc || 1)\n        }\n\n        observer.next(\n          new SimpleFeature({\n            uniqueId: `${this.id}_${pos + i}`,\n            start: pos + i,\n            end: pos + i + windowDelta,\n            score,\n          }),\n        )\n      }\n      observer.complete()\n    })\n  }\n\n  /**\n   * called to provide a hint that data tied to a certain region\n   * will not be needed for the foreseeable future and can be purged\n   * from caches, etc\n   */\n  public freeResources(/* { region } */) {}\n}\n"],"names":["_default","_BaseFeatureDataAdapt","_inherits","_super","_createSuper","_this","_classCallCheck","_len","arguments","length","args","Array","_key","call","apply","concat","gcMode","_createClass","key","value","_configure","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$getSubAdapter","adapter","wrap","_context","prev","next","this","getSubAdapter","getConf","sent","Error","abrupt","dataAdapter","stop","_getRefNames","_callee2","_context2","configure","getRefNames","query","opts","_this2","ObservableCreate","_ref","_callee3","observer","_feats$","sequenceAdapter","windowSize","windowDelta","hw","f","queryStart","queryEnd","ret","feats","residues","i","r","nc","ng","len","_iterator","_step","letter","pos","score","_context3","start","end","Math","max","complete","getFeatures","_objectSpread","firstValueFrom","pipe","toArray","get","slice","_createForOfIteratorHelper","s","n","done","err","e","SimpleFeature","uniqueId","id","_x","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}