"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[3422],{23422:function(e,n,t){t.r(n),t.d(n,{default:function(){return se}});var o=t(96234),r=t(33028),i=t(30969),c=t(90550),l=t(23014),a=t(12956),s=t(48082),d=t(2689),u=t(53276),f=t(81073),h=t(3715),g=t(37574),v=(0,u.ZL)()((function(e){return{fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}}})),m=(0,c.observer)((function(e){var n=e.model,t=v().classes,r=(0,f.getSession)(n),c=(0,i.useState)(null),l=(0,o.Z)(c,2),u=l[0],m=l[1];function x(){m(null)}var k=(0,f.isSessionModelWithConnections)(r),p=(0,f.isSessionWithAddTracks)(r);return(0,g.jsx)(g.Fragment,{children:p||k?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(a.Z,{color:"secondary",className:t.fab,onClick:function(e){return m(e.currentTarget)},children:(0,g.jsx)(h.Z,{})}),(0,g.jsxs)(s.Z,{anchorEl:u,open:Boolean(u),onClose:function(){return m(null)},children:[k?(0,g.jsx)(d.Z,{onClick:function(){x(),(0,f.isSessionModelWithWidgets)(r)&&r.showWidget(r.addWidget("AddConnectionWidget","addConnectionWidget"))},children:"Add connection"}):null,p?(0,g.jsx)(d.Z,{onClick:function(){x(),(0,f.isSessionModelWithWidgets)(r)&&r.showWidget(r.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))},children:"Add track"}):null]})]}):null})})),x=t(32723),k=t(41361),p=t(26119),C=t(33359),b=t(94551),j=t(76770),Z=t(97475),y=t(5713),S=t(28722);function T(e){return((null===e||void 0===e?void 0:e.children.map((function(e){return e.children.length?T(e):e.conf})))||[]).flat(1/0)}function W(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map;e.id&&e.children.length&&n.set(e.id,e);var t,o=(0,k.Z)(e.children);try{for(o.s();!(t=o.n()).done;){W(t.value,n)}}catch(r){o.e(r)}finally{o.f()}return n}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}var L=(0,u.ZL)()((function(e){return{contrastColor:{color:e.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}}}));function M(e){var n=e.isOpen,t=e.setOpen,r=e.data,c=L().classes,l=(0,i.useState)(null),a=(0,o.Z)(l,2),s=a[0],d=a[1],u=r.name,f=r.model,h=r.id,v=r.tree,m=r.toggleCollapse;return(0,g.jsxs)("div",{className:c.accordionText,onClick:function(){s||(m(h),t(!n))},children:[(0,g.jsxs)(C.Z,{children:[n?(0,g.jsx)(Z.Z,{}):(0,g.jsx)(y.Z,{}),u,(0,g.jsx)(b.Z,{onClick:function(e){d(e.currentTarget),e.stopPropagation()},className:c.contrastColor,children:(0,g.jsx)(S.Z,{})})]}),s?(0,g.jsx)(j.Z,{anchorEl:s,menuItems:[{label:"Add to selection",onClick:function(){var e=W(v).get(h);f.addToSelection(T(e))}},{label:"Remove from selection",onClick:function(){var e=W(v).get(h);f.removeFromSelection(T(e))}},{label:"Show all tracks",onClick:function(){var e,n,t=(0,k.Z)((null===(e=W(v).get(h))||void 0===e?void 0:e.children)||[]);try{for(t.s();!(n=t.n()).done;){var o=n.value;o.children.length||f.view.showTrack(o.id)}}catch(r){t.e(r)}finally{t.f()}}},{label:"Hide all tracks",onClick:function(){var e,n,t=(0,k.Z)((null===(e=W(v).get(h))||void 0===e?void 0:e.children)||[]);try{for(t.s();!(n=t.n()).done;){var o=n.value;o.children.length||f.view.hideTrack(o.id)}}catch(r){t.e(r)}finally{t.f()}}}],onMenuItemClick:function(e,n){n(),d(null)},open:Boolean(s),onClose:function(){return d(null)}}):null]})}var A=t(68079),I=t(6779),N=t(49884),B=t(88876),F=t(36174),E=t(9077),O=(0,u.ZL)()((function(e){return{compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:e.palette.action.selected}}}}));function H(e){var n,t,r=e.data,c=O().classes,l=r.checked,a=r.conf,s=r.model,d=r.drawerPosition,u=r.id,h=r.name,v=r.onChange,m=r.selected,x=(0,i.useState)(),k=(0,o.Z)(x,2),p=k[0],C=k[1],Z=a&&(0,E.readConfObject)(a,["description"])||"";return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(I.Z,{title:Z+(m?" (in selection)":""),placement:"left"===d?"right":"left",children:(0,g.jsx)(N.Z,{className:c.checkboxLabel,control:(0,g.jsx)(B.Z,{className:c.compactCheckbox,checked:l,onChange:function(){return v(u)},disabled:w(h),inputProps:{"data-testid":"htsTrackEntry-".concat(u)}}),label:(0,g.jsx)("div",{"data-testid":"htsTrackLabel-".concat(u),style:{background:m?"#cccc":void 0},children:(0,g.jsx)(F.Z,{html:h})})})}),(0,g.jsx)(b.Z,{onClick:function(e){return C({target:e.currentTarget,id:u,conf:a})},style:{padding:0},"data-testid":"htsTrackEntryMenu-".concat(u),children:(0,g.jsx)(S.Z,{})}),p?(0,g.jsx)(j.Z,{anchorEl:null===p||void 0===p?void 0:p.target,menuItems:[].concat((0,A.Z)((null===(n=(t=(0,f.getSession)(s)).getTrackActionMenuItems)||void 0===n?void 0:n.call(t,p.conf))||[]),[{label:"Add to selection",onClick:function(){return s.addToSelection([p.conf])}}],(0,A.Z)(m?[{label:"Remove from selection",onClick:function(){return s.removeFromSelection([p.conf])}}]:[])),onMenuItemClick:function(e,n){n(),C(void 0)},open:Boolean(p),onClose:function(){return C(void 0)}}):null]})}var P=(0,u.ZL)()((function(e){return{accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}}}));function D(e){var n=e.data,t=e.isOpen,o=e.style,r=e.setOpen,i=n.isLeaf,c=n.nestingLevel,l=P().classes,a=10*c+(i?10:0);return(0,g.jsxs)("div",{style:o,className:i?void 0:l.accordionBase,children:[new Array(c).fill(0).map((function(e,n){return(0,g.jsx)("div",{style:{left:10*n+4,height:null===o||void 0===o?void 0:o.height},className:l.nestingLevelMarker},"mark-".concat(n))})),(0,g.jsx)("div",{className:i?void 0:l.accordionCard,style:{marginLeft:a,whiteSpace:"nowrap",width:"100%"},children:(0,g.jsx)("div",{className:i?void 0:l.accordionColor,children:i?(0,g.jsx)(H,{data:n}):(0,g.jsx)(M,{isOpen:t,data:n,setOpen:r})})})]})}function R(e,n,t,o){var i=!!e.conf,c=!!o[e.id];return{data:(0,r.Z)((0,r.Z)({defaultHeight:i?22:40,isLeaf:i,isOpenByDefault:!0,nestingLevel:n,selected:c},e),t),nestingLevel:n,node:e}}var _=(0,c.observer)((function(e){var n=e.height,t=e.tree,o=e.model,r=o.filterText,c=o.selection,l=o.view,a=(0,i.useRef)(null),s=(0,f.getSession)(o).drawerPosition,d=(0,i.useMemo)((function(){return Object.fromEntries(c.map((function(e){return[e.trackId,e]})))}),[c]),u=(0,i.useMemo)((function(){return{onChange:function(e){return l.toggleTrack(e)},toggleCollapse:function(e){return o.toggleCategory(e)},tree:t,model:o,drawerPosition:s}}),[l,o,s,t]),h=(0,i.useCallback)((0,x.Z)().mark((function e(){var n,o,r,i,c,l,a;return(0,x.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,k.Z)(t.children),e.prev=1,n.s();case 3:if((o=n.n()).done){e.next=9;break}return r=o.value,e.next=7,R(r,0,u,d);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return void(e.next=20);case 20:i=e.sent,c=(0,k.Z)(i.node.children),e.prev=22,c.s();case 24:if((l=c.n()).done){e.next=30;break}return a=l.value,e.next=28,R(a,i.nestingLevel+1,u,d);case 28:e.next=24;break;case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(22),c.e(e.t1);case 35:return e.prev=35,c.f(),e.finish(35);case 38:e.next=17;break;case 40:case"end":return e.stop()}}),e,null,[[1,11,14,17],[22,32,35,38]])})),[t,u,d]);return(0,i.useEffect)((function(){a.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})}),[t,r]),(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(p.qF,{ref:a,treeWalker:h,height:n,children:D})})})),z=t(87006),U=t(4953),q=t(72097),G=t(44181),J=t(67619),K=t(4109),Q=(0,i.lazy)((function(){return Promise.all([t.e(1306),t.e(1540)]).then(t.bind(t,61540))})),V=(0,i.lazy)((function(){return t.e(9485).then(t.bind(t,99485))})),X=(0,i.lazy)((function(){return t.e(1782).then(t.bind(t,11782))})),Y=(0,i.lazy)((function(){return t.e(9242).then(t.bind(t,19242))})),$=(0,c.observer)((function(e){var n=e.model,t=(0,f.getSession)(n),r=(0,i.useState)(),c=(0,o.Z)(r,2),l=c[0],a=c[1],s=(0,i.useState)(),d=(0,o.Z)(s,2),u=d[0],h=d[1],v=(0,i.useState)(!1),m=(0,o.Z)(v,2),x=m[0],k=m[1],p=(0,i.useState)(!1),C=(0,o.Z)(p,2),b=C[0],j=C[1];function Z(e,n){var r,i=(0,E.readConfObject)(e,"name"),c=null===(r=t.prepareToBreakConnection)||void 0===r?void 0:r.call(t,e);if(c){var l=(0,o.Z)(c,2),s=l[0],d=l[1];Object.keys(d).length>0?a({connectionConf:e,safelyBreakConnection:s,dereferenceTypeCount:d,name:i}):s()}n&&h({name:i,connectionConf:e})}return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(J.Z,{menuItems:[].concat((0,A.Z)((0,f.isSessionWithAddTracks)(t)?[{label:"Add track...",onClick:function(){(0,f.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:n.view.id}))}}]:[]),(0,A.Z)((0,f.isSessionModelWithConnections)(t)?[{label:"Turn on/off connections...",onClick:function(){return k(!0)}}]:[]),(0,A.Z)((0,f.isSessionModelWithConnectionEditing)(t)?[{label:"Add connection...",onClick:function(){(0,f.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:function(){return j(!0)}}]:[]),[{type:"divider"},{label:"Sort tracks by name",type:"checkbox",checked:n.activeSortTrackNames,onClick:function(){return n.setSortTrackNames(!n.activeSortTrackNames)}},{label:"Sort categories by name",type:"checkbox",checked:n.activeSortCategories,onClick:function(){return n.setSortCategories(!n.activeSortCategories)}},{type:"divider"}],(0,A.Z)(n.hasAnySubcategories?[{label:"Collapse subcategories",onClick:function(){return n.collapseSubCategories()}}]:[]),[{label:"Collapse top-level categories",onClick:function(){return n.collapseTopLevelCategories()}},{label:"Expand all categories",onClick:function(){return n.expandAllCategories()}}]),children:(0,g.jsx)(K.Z,{})}),(0,g.jsxs)(i.Suspense,{fallback:(0,g.jsx)(i.Fragment,{}),children:[l?(0,g.jsx)(Q,{modalInfo:l,onClose:function(){return a(void 0)}}):null,u?(0,g.jsx)(V,{handleClose:function(){return h(void 0)},deleteDialogDetails:u,session:t}):null,b?(0,g.jsx)(X,{handleClose:function(){return j(!1)},breakConnection:Z,session:t}):null,x?(0,g.jsx)(Y,{handleClose:function(){return k(!1)},session:t,breakConnection:Z}):null]})]})})),ee=t(68187),ne=(0,i.lazy)((function(){return Promise.all([t.e(6962),t.e(9563),t.e(8399),t.e(6352)]).then(t.bind(t,56896))})),te=(0,u.ZL)()((function(e){return{searchBox:{margin:e.spacing(2)},menuIcon:{marginRight:e.spacing(1),marginBottom:0}}})),oe=(0,c.observer)((function(e){var n=e.model,t=n.filterText,o=te().classes;return(0,g.jsx)(z.Z,{className:o.searchBox,label:"Filter tracks",value:t,onChange:function(e){return n.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:(0,g.jsx)(U.Z,{position:"end",children:(0,g.jsx)(b.Z,{onClick:function(){return n.clearFilterText()},children:(0,g.jsx)(G.Z,{})})})}})})),re=(0,c.observer)((function(e){var n=e.model,t=e.setHeaderHeight,r=te().classes,c=(0,i.useState)(!1),l=(0,o.Z)(c,2),a=l[0],s=l[1];return(0,g.jsxs)("div",{ref:function(e){return t((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)},"data-testid":"hierarchical_track_selector",children:[(0,g.jsxs)("div",{style:{display:"flex"},children:[(0,g.jsx)($,{model:n}),(0,g.jsx)(ee.Z,{model:n}),(0,g.jsx)(oe,{model:n}),(0,g.jsx)(q.Z,{className:r.menuIcon,onClick:function(){return s(!0)},children:"Open faceted selector"})]}),(0,g.jsx)(i.Suspense,{fallback:(0,g.jsx)("div",{}),children:a?(0,g.jsx)(ne,{handleClose:function(){return s(!1)},model:n}):null})]})})),ie=function(e){var n=e.tree,t=e.model,o=e.offset;return"undefined"===typeof jest?(0,g.jsx)(l.ZP,{disableWidth:!0,children:function(e){return(0,g.jsx)(_,{height:(e.height||o)-o,model:t,tree:n})}}):(0,g.jsx)(_,{height:9e3,model:t,tree:n})},ce=function(e){var n=e.overrideDimensions,t=e.children;return n?(0,g.jsx)("div",{style:(0,r.Z)({},n),children:t}):(0,g.jsx)(g.Fragment,{children:t})},le=(0,c.observer)((function(e){var n=e.model,t=e.toolbarHeight,o=e.overrideDimensions;return(0,g.jsxs)(ce,{overrideDimensions:o,children:[(0,g.jsx)(ae,{model:n,toolbarHeight:t}),(0,g.jsx)(m,{model:n})]})})),ae=(0,c.observer)((function(e){var n=e.model,t=e.toolbarHeight,r=void 0===t?0:t,c=(0,i.useState)(0),l=(0,o.Z)(c,2),a=l[0],s=l[1];return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(re,{model:n,setHeaderHeight:s}),(0,g.jsx)(ie,{tree:n.hierarchy,model:n,offset:r+a})]})})),se=le},68187:function(e,n,t){var o=t(33028),r=t(68079),i=t(96234),c=t(30969),l=t(94551),a=t(72488),s=t(53276),d=t(90550),u=t(76770),f=t(81073),h=t(64698),g=t(37574),v=(0,s.ZL)()((function(e){return{searchBox:{margin:e.spacing(2)},menuIcon:{marginRight:e.spacing(1),marginBottom:0}}})),m=(0,d.observer)((function(e){var n=e.model,t=v().classes,s=n.selection,d=(0,f.getEnv)(n).pluginManager,m=(0,f.getSession)(n),x=(0,c.useState)(),k=(0,i.Z)(x,2),p=k[0],C=k[1],b=d.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:m});return(0,g.jsxs)(g.Fragment,{children:[s.length?(0,g.jsx)(l.Z,{className:t.menuIcon,onClick:function(e){return C(e.currentTarget)},children:(0,g.jsx)(a.Z,{badgeContent:s.length,color:"primary",children:(0,g.jsx)(h.Z,{})})}):null,(0,g.jsx)(u.Z,{anchorEl:p,open:Boolean(p),onMenuItemClick:function(e,n){n(),C(void 0)},onClose:function(){return C(void 0)},menuItems:[{label:"Clear",onClick:function(){return n.clearSelection()}}].concat((0,r.Z)(b.map((function(e){return(0,o.Z)((0,o.Z)({},e),"onClick"in e?{onClick:function(){return e.onClick(n)}}:{})}))))})]})}));n.Z=m}}]);
//# sourceMappingURL=3422.cb596da3.chunk.js.map