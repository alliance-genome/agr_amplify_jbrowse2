{"version":3,"file":"static/js/9018.aa278cce.chunk.js","mappings":"8VAcA,SAASA,EAAYC,GACnB,IAAMC,EAAWD,EAAIE,MAAMF,EAAIG,YAAY,KAAO,GAClD,OAAOF,EAASC,MAAM,EAAGD,EAASE,YAAY,KAChD,CAAC,IAOoBC,EAAkB,qGAkGN,OAlGM,4EAOrC,+FAC0C,GAAlCC,EAAgBC,KAAKD,cACR,CAAD,qBACV,IAAIE,MAAM,8BAA6B,OAY9C,OAVGC,EAAWF,KAAKG,QAAQ,eACf,QAAT,EAACD,SAAQ,OAAR,EAAUE,SACPC,EAAUL,KAAKG,QAAQ,WAC7BD,EAAWG,EAAQC,KAAI,SAAAC,GAAK,MAAK,CAC/BC,KAAM,gBACNC,OAAQhB,EAAYc,GACpBG,eAAgB,CACdhB,IAAKa,GAER,KACF,kBAEMI,QAAQC,IAEbV,EAASI,IAAG,yCAAC,WAAOO,GAAS,4FACAd,EAAcc,GAAK,OAChC,OADRC,EAAW,OACdA,YAAW,mCAEZL,OAAQI,EAAKE,MAAQD,EAAYE,IAC9BH,GAAI,IACPC,YAAAA,KAAW,2CAEd,mDARW,MASb,gDACF,kDApCoC,IAsCrC,kEACA,WAAyBG,GAAkB,8FAClBjB,KAAKkB,cAAa,OAA3B,OAARC,EAAQ,gBACSR,QAAQC,IAC7BO,EAASb,KAAI,SAAAc,GAAC,OAAIA,EAAEN,YAAYO,YAAYJ,EAAK,KAClD,OAFa,OAARK,EAAQ,iCAGH,IAAIC,IAAID,EAASE,UAAO,gDACpC,mDAPD,IAOC,qEAED,WAA4BP,GAAkB,kGACrBjB,KAAKkB,cAAa,OAA3B,OAARC,EAAQ,gBAENR,QAAQC,IAEZO,EAASb,KAAI,SAAAmB,GAAG,eAAkC,QAAlC,GAAI,EAAAA,EAAIX,aAAYY,sBAAc,aAA9B,SAAiCT,EAAK,KAC3D,OAG6C,OAP1CU,EAAK,OAKTC,QAAO,SAAAC,GAAC,QAAMA,CAAC,IACXC,GAAWC,EAAAA,EAAAA,KAAIJ,EAAMrB,KAAI,SAAA0B,GAAC,OAAIA,EAAEF,QAAQ,KACxCG,GAAWC,EAAAA,EAAAA,KAAIP,EAAMrB,KAAI,SAAA0B,GAAC,OAAIA,EAAEC,QAAQ,KAAE,kBACzC,CAAEH,SAAAA,EAAUG,SAAAA,IAAU,gDAC9B,mDAbA,IAaA,yBAED,SAAmBE,GAA2C,IAAD,OAA1BlB,EAAmB,uDAAG,CAAC,EACxD,OAAOmB,EAAAA,EAAAA,kBAAgB,yCAAU,WAAMC,GAAQ,4FACtB,EAAKnB,cAAa,OAAnCC,EAAQ,OACdmB,EAAAA,EAAAA,WAAM,GAAD,OACAnB,EAASb,KAAI,SAAAmB,GAAG,OACjBA,EAAIX,YAAYyB,YAAYJ,EAAQlB,GAAMuB,MACxClC,EAAAA,EAAAA,IAAI,SAAAmC,GAAC,OAEHA,EAAEC,IAAI,UACFD,EACA,IAAIE,EAAAA,eAAc,kBACbF,EAAEG,UAAQ,IACbC,SAAUpB,EAAIhB,OAAS,IAAMgC,EAAEzB,KAC/BP,OAAQgB,EAAIhB,SACZ,IAET,MAEHqC,UAAUT,GAAS,2CACtB,mDAlBsB,GAkBpBpB,EAAK8B,OACV,GAEA,2EACA,WAA2BC,GAAkB,+FACpC,CAAEC,eAAgB,IAAG,2CAC7B,mDAHD,IAMA,iEACA,yGACyBjD,KAAKkB,cAAa,OAA3B,OAARC,EAAQ,yBACPA,EAASb,KAAI,YAAc,EAAXQ,YAAH,IAAgBL,EAAM,EAANA,OAAQM,EAAI,EAAJA,KAASmC,GAAI,2BACvDnC,KAAMN,EACN0C,OAAQpC,GACLmC,EAAI,KACN,gDACJ,kDARD,IAQC,2BAED,WAA8B,KAAC,EAlGM,CAASE,EAAAA,wBAA3BtD,EACLuD,aAAe,CAC3B,gBACA,gBACA,iB","sources":["../../../plugins/wiggle/src/MultiWiggleAdapter/MultiWiggleAdapter.ts"],"sourcesContent":["import {\n  BaseFeatureDataAdapter,\n  BaseOptions,\n} from '@jbrowse/core/data_adapters/BaseAdapter'\nimport { AugmentedRegion as Region } from '@jbrowse/core/util/types'\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs'\nimport { SimpleFeature, Feature, min, max } from '@jbrowse/core/util'\nimport { merge } from 'rxjs'\nimport { map } from 'rxjs/operators'\n\ninterface WiggleOptions extends BaseOptions {\n  resolution?: number\n}\n\nfunction getFilename(uri: string) {\n  const filename = uri.slice(uri.lastIndexOf('/') + 1)\n  return filename.slice(0, filename.lastIndexOf('.'))\n}\n\ninterface AdapterEntry {\n  dataAdapter: BaseFeatureDataAdapter\n  [key: string]: unknown\n}\n\nexport default class MultiWiggleAdapter extends BaseFeatureDataAdapter {\n  public static capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n  ]\n\n  public async getAdapters(): Promise<AdapterEntry[]> {\n    const getSubAdapter = this.getSubAdapter\n    if (!getSubAdapter) {\n      throw new Error('no getSubAdapter available')\n    }\n    let subConfs = this.getConf('subadapters')\n    if (!subConfs?.length) {\n      const entries = this.getConf('bigWigs') as string[]\n      subConfs = entries.map(entry => ({\n        type: 'BigWigAdapter',\n        source: getFilename(entry),\n        bigWigLocation: {\n          uri: entry,\n        },\n      }))\n    }\n\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      subConfs.map(async (conf: any) => {\n        const dataAdapter = (await getSubAdapter(conf))\n          .dataAdapter as BaseFeatureDataAdapter\n        return {\n          source: conf.name || dataAdapter.id,\n          ...conf,\n          dataAdapter,\n        }\n      }),\n    )\n  }\n\n  // note: can't really have dis-agreeing refNames\n  public async getRefNames(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const allNames = await Promise.all(\n      adapters.map(a => a.dataAdapter.getRefNames(opts)),\n    )\n    return [...new Set(allNames.flat())]\n  }\n\n  public async getGlobalStats(opts?: BaseOptions) {\n    const adapters = await this.getAdapters()\n    const stats = (\n      await Promise.all(\n        // @ts-ignore\n        adapters.map(adp => adp.dataAdapter.getGlobalStats?.(opts)),\n      )\n    ).filter(f => !!f)\n    const scoreMin = min(stats.map(s => s.scoreMin))\n    const scoreMax = max(stats.map(s => s.scoreMax))\n    return { scoreMin, scoreMax }\n  }\n\n  public getFeatures(region: Region, opts: WiggleOptions = {}) {\n    return ObservableCreate<Feature>(async observer => {\n      const adapters = await this.getAdapters()\n      merge(\n        ...adapters.map(adp =>\n          adp.dataAdapter.getFeatures(region, opts).pipe(\n            map(p =>\n              // add source field if it does not exist\n              p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: adp.source + '-' + p.id(),\n                    source: adp.source,\n                  }),\n            ),\n          ),\n        ),\n      ).subscribe(observer)\n    }, opts.signal)\n  }\n\n  // always render bigwig instead of calculating a feature density for it\n  async estimateRegionsStats(_regions: Region[]) {\n    return { featureDensity: 0 }\n  }\n\n  // in another adapter type, this could be dynamic depending on region or\n  // something, but it is static for this particular multi-wiggle adapter type\n  async getSources() {\n    const adapters = await this.getAdapters()\n    return adapters.map(({ dataAdapter, source, name, ...rest }) => ({\n      name: source,\n      __name: name,\n      ...rest,\n    }))\n  }\n\n  public freeResources(): void {}\n}\n"],"names":["getFilename","uri","filename","slice","lastIndexOf","MultiWiggleAdapter","getSubAdapter","this","Error","subConfs","getConf","length","entries","map","entry","type","source","bigWigLocation","Promise","all","conf","dataAdapter","name","id","opts","getAdapters","adapters","a","getRefNames","allNames","Set","flat","adp","getGlobalStats","stats","filter","f","scoreMin","min","s","scoreMax","max","region","ObservableCreate","observer","merge","getFeatures","pipe","p","get","SimpleFeature","toJSON","uniqueId","subscribe","signal","_regions","featureDensity","rest","__name","BaseFeatureDataAdapter","capabilities"],"sourceRoot":""}