"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[1343],{11343:function(e,t,r){r.d(t,{$:function(){return fe},S5:function(){return pe}});var n=r(96234),a=r(41361),i=r(33028),s=r(32723),o=r(34795),u=r(9249),c=r(87371),f=r(45754),h=r(13820),l=function(){function e(t,r){(0,u.Z)(this,e),this.blockPosition=t,this.dataPosition=r}return(0,c.Z)(e,[{key:"toString",value:function(){return"".concat(this.blockPosition,":").concat(this.dataPosition)}},{key:"compareTo",value:function(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}],[{key:"min",value:function(){for(var e,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(;!e;t+=1)e=n[t];for(;t<n.length;t+=1)e.compareTo(n[t])>0&&(e=n[t]);return e}}]),e}();function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])throw new Error("big-endian virtual file offsets not implemented");return new l(1099511627776*e[t+7]+4294967296*e[t+6]+16777216*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}var v=function(){function e(t,r,n,a){(0,u.Z)(this,e),this.minv=t,this.maxv=r,this.bin=n,this._fetchedSize=a}return(0,c.Z)(e,[{key:"toUniqueString",value:function(){return"".concat(this.minv,"..").concat(this.maxv," (bin ").concat(this.bin,", fetchedSize ").concat(this.fetchedSize(),")")}},{key:"toString",value:function(){return this.toUniqueString()}},{key:"compareTo",value:function(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}},{key:"fetchedSize",value:function(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}]),e}(),p=r(62094),b=r.n(p);function y(e){return new Promise((function(t){return setTimeout(t,e)}))}function k(e){if(e&&e.aborted){if("undefined"===typeof DOMException){var t=new Error("aborted");throw t.code="ERR_ABORTED",t}throw new DOMException("aborted","AbortError")}}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"aborted"in e?{signal:e}:e}function m(e,t){var r,n=[];if(0===e.length)return e;e.sort((function(e,t){var r=e.minv.blockPosition-t.minv.blockPosition;return 0===r?e.minv.dataPosition-t.minv.dataPosition:r}));var i,s,o,u=(0,a.Z)(e);try{for(u.s();!(i=u.n()).done;){var c=i.value;(!t||c.maxv.compareTo(t)>0)&&(void 0===r?(n.push(c),r=c):(s=r,(o=c).minv.blockPosition-s.maxv.blockPosition<65e3&&o.maxv.blockPosition-s.minv.blockPosition<5e6?c.maxv.compareTo(r.maxv)>0&&(r.maxv=c.maxv):(n.push(c),r=c)))}}catch(f){u.e(f)}finally{u.f()}return n}function x(e,t){return{lineCount:function(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw new Error("integer overflow");return e.toNumber()}(b().fromBytesLE(Array.prototype.slice.call(e,t,t+8),!0))}}function w(e,t){return e?e.compareTo(t)>0?t:e:t}var _=(0,c.Z)((function e(t){var r=t.filehandle,n=t.renameRefSeq,a=void 0===n?function(e){return e}:n;(0,u.Z)(this,e),this.filehandle=r,this.renameRefSeq=a}));function Z(e,t){return e-e%t}function E(e,t){return[[0,0],[1+(e>>26),1+((t-=1)>>26)],[9+(e>>23),9+(t>>23)],[73+(e>>20),73+(t>>20)],[585+(e>>17),585+(t>>17)],[4681+(e>>14),4681+(t>>14)]]}var I=function(e){(0,f.Z)(r,e);var t=(0,h.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,c.Z)(r,[{key:"lineCount",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r){var n,a,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parse(r);case 2:return i=e.sent,e.abrupt("return",(null===(a=null===(n=i.indices[t])||void 0===n?void 0:n.stats)||void 0===a?void 0:a.lineCount)||0);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_parse",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i,o,u,c,f,h,l,p,b,y,k,g,m,_,Z,E,I,S;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.filehandle.readFile(t);case 2:if(21578050===(r=e.sent).readUInt32LE(0)){e.next=5;break}throw new Error("Not a BAI file");case 5:n=r.readInt32LE(4),5,a=37449,i=8,u=new Array(n),c=0;case 11:if(!(c<n)){e.next=46;break}f=r.readInt32LE(i),h=void 0,i+=4,l={},p=0;case 17:if(!(p<f)){e.next=38;break}if(b=r.readUInt32LE(i),i+=4,b!==a+1){e.next=26;break}h=x(r,(i+=4)+16),i+=32,e.next=35;break;case 26:if(!(b>a+1)){e.next=30;break}throw new Error("bai index contains too many bins, please use CSI");case 30:for(y=r.readInt32LE(i),i+=4,k=new Array(y),g=0;g<y;g++)m=d(r,i),_=d(r,i+=8),i+=8,o=w(o,m),k[g]=new v(m,_,b);l[b]=k;case 35:p+=1,e.next=17;break;case 38:for(Z=r.readInt32LE(i),i+=4,E=new Array(Z),I=0;I<Z;I++)S=d(r,i),i+=8,o=w(o,S),E[I]=S;u[c]={binIndex:l,linearIndex:E,stats:h};case 43:c++,e.next=11;break;case 46:return e.abrupt("return",{bai:!0,firstDataLine:o,maxBlockSize:65536,indices:u,refCount:n});case 47:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n){var a,o,u,c,f,h,l,d,v,p,b,y,k,g,m,x=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:{},o=16384,u=void 0!==r,e.next=5,this.parse(a);case 5:if(c=e.sent,f=c.indices[t]){e.next=9;break}return e.abrupt("return",[]);case 9:if(h=f.linearIndex,l=void 0===h?[]:h,d=f.stats,0!==l.length){e.next=12;break}return e.abrupt("return",[]);case 12:if(v=void 0===n?(l.length-1)*o:(s=n)-s%(w=o)+w,p=void 0===r?0:Z(r,o),b=new Array(u?(v-p)/o:l.length-1),y=l[l.length-1].blockPosition,!(v>(l.length-1)*o)){e.next=18;break}throw new Error("query outside of range of linear index");case 18:for(k=l[p/o].blockPosition,g=p/o,m=0;g<v/o;g++,m++)b[m]={score:l[g+1].blockPosition-k,start:g*o,end:g*o+o},k=l[g+1].blockPosition;return e.abrupt("return",b.map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{score:e.score*((null===d||void 0===d?void 0:d.lineCount)||0)/y})})));case 21:case"end":return e.stop()}var s,w}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"blocksForRange",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,i){var o,u,c,f,h,l,d,v,p,b,y,k,g,x,w,_,Z,I,S,C,P,L=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=L.length>3&&void 0!==L[3]?L[3]:{},r<0&&(r=0),e.next=4,this.parse(o);case 4:if(u=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(c=u.indices[t]){e.next=10;break}return e.abrupt("return",[]);case 10:f=E(r,i),h=[],l=(0,a.Z)(f);try{for(l.s();!(d=l.n()).done;)for(v=(0,n.Z)(d.value,2),p=v[0],b=v[1],y=p;y<=b;y++)if(c.binIndex[y]){k=c.binIndex[y],g=(0,a.Z)(k);try{for(g.s();!(x=g.n()).done;)w=x.value,h.push(w)}catch(s){g.e(s)}finally{g.f()}}}catch(s){l.e(s)}finally{l.f()}for(_=c.linearIndex.length,I=Math.min(r>>14,_-1),S=Math.min(i>>14,_-1),C=I;C<=S;++C)(P=c.linearIndex[C])&&(!Z||P.compareTo(Z)<0)&&(Z=P);return e.abrupt("return",m(h,Z));case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var t,r=this,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.setupP||(this.setupP=this._parse(t).catch((function(e){throw r.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.next=3,this.parse(r);case 3:return a=e.sent,e.abrupt("return",!!(null===(n=a.indices[t])||void 0===n?void 0:n.binIndex));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(_),S=r(68079),C=r(98288),P=r(30249),L=r(61418),T=r(69621),A=r(59706),R=r(73794),q=r.n(R),M=r(16959),F=r(18973),U=r(64926),N=r.n(U),B=r(97779),j=r.n(B);function D(e,t){return Math.floor(e/Math.pow(2,t))}var O=function(e){(0,f.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).maxBinNumber=0,e.depth=0,e.minShift=0,e}return(0,c.Z)(r,[{key:"lineCount",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r){var n,a,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parse(r);case 2:return i=e.sent,e.abrupt("return",(null===(a=null===(n=i.indices[t])||void 0===n?void 0:n.stats)||void 0===a?void 0:a.lineCount)||0);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"parseAuxData",value:function(e,t){var r=e.readInt32LE(t),n=65536&r?"zero-based-half-open":"1-based-closed",a={0:"generic",1:"SAM",2:"VCF"}[15&r];if(!a)throw new Error("invalid Tabix preset format flags ".concat(r));var s={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},o=e.readInt32LE(t+16),u=o?String.fromCharCode(o):"",c=e.readInt32LE(t+20),f=e.readInt32LE(t+24);return(0,i.Z)({columnNumbers:s,coordinateType:n,metaValue:o,metaChar:u,skipLines:c,format:a,formatFlags:r},function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},r=0,n=0,a=[],i={},s=0;s<e.length;s+=1)if(!e[s]){if(n<s){var o=e.toString("utf8",n,s);o=t(o),a[r]=o,i[o]=r}n=s+1,r+=1}return{refNameToId:i,refIdToName:a}}(e.subarray(t+28,t+28+f),this.renameRefSeq))}},{key:"_parse",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,o,u,c,f,h,l,p,b,y,k,g,m,_,Z,E,I,S;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.filehandle.readFile(t);case 2:return r=e.sent,e.next=5,(0,M.unzip)(r);case 5:if(21582659!==(n=e.sent).readUInt32LE(0)){e.next=10;break}a=1,e.next=15;break;case 10:if(38359875!==n.readUInt32LE(0)){e.next=14;break}a=2,e.next=15;break;case 14:throw new Error("Not a CSI file");case 15:for(this.minShift=n.readInt32LE(4),this.depth=n.readInt32LE(8),this.maxBinNumber=((1<<3*(this.depth+1))-1)/7,o=n.readInt32LE(12),u=o>=30?this.parseAuxData(n,16):void 0,c=n.readInt32LE(16+o),f=16+o+4,l=new Array(c),p=0;p<c;p++){for(b=n.readInt32LE(f),f+=4,y={},k=void 0,g=0;g<b;g++)if(m=n.readUInt32LE(f),f+=4,m>this.maxBinNumber)k=x(n,f+28),f+=44;else{for(h=w(h,d(n,f)),f+=8,_=n.readInt32LE(f),f+=4,Z=new Array(_),E=0;E<_;E+=1)I=d(n,f),S=d(n,f+=8),f+=8,h=w(h,I),Z[E]=new v(I,S,m);y[m]=Z}l[p]={binIndex:y,stats:k}}return e.abrupt("return",(0,i.Z)({csiVersion:a,firstDataLine:h,indices:l,refCount:c,csi:!0,maxBlockSize:65536},u));case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"blocksForRange",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,i){var o,u,c,f,h,d,v,p,b,y,k,g,x,w,_,Z=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Z.length>3&&void 0!==Z[3]?Z[3]:{},r<0&&(r=0),e.next=4,this.parse(o);case 4:if(u=e.sent,c=null===u||void 0===u?void 0:u.indices[t]){e.next=8;break}return e.abrupt("return",[]);case 8:if(0!==(f=this.reg2bins(r,i)).length){e.next=11;break}return e.abrupt("return",[]);case 11:h=[],d=(0,a.Z)(f);try{for(d.s();!(v=d.n()).done;)for(p=(0,n.Z)(v.value,2),b=p[0],y=p[1],k=b;k<=y;k++)if(c.binIndex[k]){g=c.binIndex[k],x=(0,a.Z)(g);try{for(x.s();!(w=x.n()).done;)_=w.value,h.push(_)}catch(s){x.e(s)}finally{x.f()}}}catch(s){d.e(s)}finally{d.f()}return e.abrupt("return",m(h,new l(0,0)));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){(e-=1)<1&&(e=1),t>Math.pow(2,50)&&(t=Math.pow(2,34)),t-=1;for(var r,n=0,a=0,i=this.minShift+3*this.depth,s=[];n<=this.depth;i-=3,a+=(r=3*n,1*Math.pow(2,r)),n+=1){var o=a+D(e,i),u=a+D(t,i);if(u-o+s.length>this.maxBinNumber)throw new Error("query ".concat(e,"-").concat(t," is too large for current binning scheme (shift ").concat(this.minShift,", depth ").concat(this.depth,"), try a smaller query or a coarser index binning scheme"));s.push([o,u])}return s}},{key:"parse",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var t,r=this,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.setupP||(this.setupP=this._parse(t).catch((function(e){throw r.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.next=3,this.parse(r);case 3:return a=e.sent,e.abrupt("return",!!(null===(n=a.indices[t])||void 0===n?void 0:n.binIndex));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(_),z=1,H=2,G=4,V=8,Q=16,X=32,Y=64,W=128,J=256,K=512,$=1024,ee=2048,te="=ACMGRSVTWYHKDBN".split(""),re="MIDNSHP=X???????".split(""),ne=function(){function e(t){(0,u.Z)(this,e),this.data={},this._tagList=[],this._allTagsParsed=!1;var r=t.bytes,n=t.fileOffset,a=r.byteArray,i=r.start;this.data={},this.bytes=r,this._id=n,this._refID=a.readInt32LE(i+4),this.data.start=a.readInt32LE(i+8),this.flags=(4294901760&a.readInt32LE(i+16))>>16}return(0,c.Z)(e,[{key:"get",value:function(e){return this[e]?(this.data[e]||(this.data[e]=this[e]()),this.data[e]):this._get(e.toLowerCase())}},{key:"end",value:function(){return this.get("start")+this.get("length_on_ref")}},{key:"seq_id",value:function(){return this._refID}},{key:"_get",value:function(e){return e in this.data||(this.data[e]=this._parseTag(e)),this.data[e]}},{key:"_tags",value:function(){var e=this;this._parseAllTags();var t=["seq"];this.isSegmentUnmapped()||t.push("start","end","strand","score","qual","MQ","CIGAR","length_on_ref","template_length"),this.isPaired()&&t.push("next_segment_position","pair_orientation"),t=t.concat(this._tagList||[]);for(var r=0,n=Object.keys(this.data);r<n.length;r++){var a=n[r];"_"!==a[0]&&"next_seq_id"!==a&&t.push(a)}var i={};return t.filter((function(t){if(t in e.data&&void 0===e.data[t]||"CG"===t||"cg"===t)return!1;var r=t.toLowerCase(),n=i[r];return i[r]=!0,!n}))}},{key:"parent",value:function(){}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"id",value:function(){return this._id}},{key:"mq",value:function(){var e=(65280&this.get("_bin_mq_nl"))>>8;return 255===e?void 0:e}},{key:"score",value:function(){return this.get("mq")}},{key:"qual",value:function(){var e;return null===(e=this.qualRaw())||void 0===e?void 0:e.join(" ")}},{key:"qualRaw",value:function(){if(!this.isSegmentUnmapped()){var e=this.bytes,t=e.start,r=e.byteArray,n=t+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes"),a=this.get("seq_length");return r.subarray(n,n+a)}}},{key:"strand",value:function(){return this.isReverseComplemented()?-1:1}},{key:"multi_segment_next_segment_strand",value:function(){if(!this.isMateUnmapped())return this.isMateReverseComplemented()?-1:1}},{key:"name",value:function(){return this.get("_read_name")}},{key:"_read_name",value:function(){var e=this.get("_l_read_name"),t=this.bytes,r=t.byteArray,n=t.start;return r.toString("ascii",n+36,n+36+e-1)}},{key:"_parseTag",value:function(e){if(!this._allTagsParsed){for(var t,r=this.bytes,n=r.byteArray,a=r.start,i=this._tagOffset||a+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes")+this.get("seq_length"),s=this.bytes.end;i<s&&t!==e;){var o=String.fromCharCode(n[i],n[i+1]);t=o.toLowerCase();var u=String.fromCharCode(n[i+2]);i+=3;var c=void 0;switch(u){case"A":c=String.fromCharCode(n[i]),i+=1;break;case"i":c=n.readInt32LE(i),i+=4;break;case"I":c=n.readUInt32LE(i),i+=4;break;case"c":c=n.readInt8(i),i+=1;break;case"C":c=n.readUInt8(i),i+=1;break;case"s":c=n.readInt16LE(i),i+=2;break;case"S":c=n.readUInt16LE(i),i+=2;break;case"f":c=n.readFloatLE(i),i+=4;break;case"Z":case"H":for(c="";i<=s;){var f=n[i++];if(0===f)break;c+=String.fromCharCode(f)}break;case"B":c="";var h=n[i++],l=String.fromCharCode(h),d=n.readInt32LE(i);if(i+=4,"i"===l)if("CG"===o)for(var v=0;v<d;v++){var p=n.readInt32LE(i);c+=(p>>4)+re[15&p],i+=4}else for(var b=0;b<d;b++)c+=n.readInt32LE(i),b+1<d&&(c+=","),i+=4;if("I"===l)if("CG"===o)for(var y=0;y<d;y++){var k=n.readUInt32LE(i);c+=(k>>4)+re[15&k],i+=4}else for(var g=0;g<d;g++)c+=n.readUInt32LE(i),g+1<d&&(c+=","),i+=4;if("s"===l)for(var m=0;m<d;m++)c+=n.readInt16LE(i),m+1<d&&(c+=","),i+=2;if("S"===l)for(var x=0;x<d;x++)c+=n.readUInt16LE(i),x+1<d&&(c+=","),i+=2;if("c"===l)for(var w=0;w<d;w++)c+=n.readInt8(i),w+1<d&&(c+=","),i+=1;if("C"===l)for(var _=0;_<d;_++)c+=n.readUInt8(i),_+1<d&&(c+=","),i+=1;if("f"===l)for(var Z=0;Z<d;Z++)c+=n.readFloatLE(i),Z+1<d&&(c+=","),i+=4;break;default:console.warn("Unknown BAM tag type '".concat(u,"', tags may be incomplete")),c=void 0,i=s}if(this._tagOffset=i,this._tagList.push(o),t===e)return c;this.data[t]=c}this._allTagsParsed=!0}}},{key:"_parseAllTags",value:function(){this._parseTag("")}},{key:"_parseCigar",value:function(e){return e.match(/\d+\D/g).map((function(e){return[e.match(/\D/)[0].toUpperCase(),Number.parseInt(e,10)]}))}},{key:"isPaired",value:function(){return!!(this.flags&z)}},{key:"isProperlyPaired",value:function(){return!!(this.flags&H)}},{key:"isSegmentUnmapped",value:function(){return!!(this.flags&G)}},{key:"isMateUnmapped",value:function(){return!!(this.flags&V)}},{key:"isReverseComplemented",value:function(){return!!(this.flags&Q)}},{key:"isMateReverseComplemented",value:function(){return!!(this.flags&X)}},{key:"isRead1",value:function(){return!!(this.flags&Y)}},{key:"isRead2",value:function(){return!!(this.flags&W)}},{key:"isSecondary",value:function(){return!!(this.flags&J)}},{key:"isFailedQc",value:function(){return!!(this.flags&K)}},{key:"isDuplicate",value:function(){return!!(this.flags&$)}},{key:"isSupplementary",value:function(){return!!(this.flags&ee)}},{key:"cigar",value:function(){if(!this.isSegmentUnmapped()){var e=this.bytes,t=e.byteArray,r=e.start,n=this.get("_n_cigar_op"),a=r+36+this.get("_l_read_name"),i=this.get("seq_length"),s="",o=0,u=t.readInt32LE(a),c=u>>4,f=re[15&u];if("S"===f&&c===i)return a+=4,c=(u=t.readInt32LE(a))>>4,"N"!==(f=re[15&u])&&console.warn("CG tag with no N tag"),this.data.length_on_ref=c,this.get("CG");for(var h=0;h<n;++h)s+=(c=(u=t.readInt32LE(a))>>4)+(f=re[15&u]),"H"!==f&&"S"!==f&&"I"!==f&&(o+=c),a+=4;return this.data.length_on_ref=o,s}}},{key:"_flags",value:function(){}},{key:"length_on_ref",value:function(){return this.data.length_on_ref||this.get("cigar"),this.data.length_on_ref}},{key:"_n_cigar_op",value:function(){return 65535&this.get("_flag_nc")}},{key:"_l_read_name",value:function(){return 255&this.get("_bin_mq_nl")}},{key:"_seq_bytes",value:function(){return this.get("seq_length")+1>>1}},{key:"getReadBases",value:function(){return this.seq()}},{key:"seq",value:function(){for(var e=this.bytes,t=e.byteArray,r=e.start+36+this.get("_l_read_name")+4*this.get("_n_cigar_op"),n=this.get("_seq_bytes"),a=this.get("seq_length"),i="",s=0,o=0;o<n;++o){var u=t[r+o];i+=te[(240&u)>>4],++s<a&&(i+=te[15&u],s++)}return i}},{key:"getPairOrientation",value:function(){if(!this.isSegmentUnmapped()&&!this.isMateUnmapped()&&this._refID===this._next_refid()){var e=this.isReverseComplemented()?"R":"F",t=this.isMateReverseComplemented()?"R":"F",r=" ",n=" ";this.isRead1()?(r="1",n="2"):this.isRead2()&&(r="2",n="1");var a=[];return this.template_length()>0?(a[0]=e,a[1]=r,a[2]=t,a[3]=n):(a[2]=e,a[3]=r,a[0]=t,a[1]=n),a.join("")}return""}},{key:"_bin_mq_nl",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+12)}},{key:"_flag_nc",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+16)}},{key:"seq_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+20)}},{key:"_next_refid",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+24)}},{key:"_next_pos",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+28)}},{key:"template_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+32)}},{key:"toJSON",value:function(){for(var e={},t=0,r=Object.keys(this);t<r.length;t++){var n=r[t];"_"!==n.charAt(0)&&"bytes"!==n&&(e[n]=this[n])}return e}}]),e}(),ae=r(46840);function ie(e){var t,r=e.split(/\r?\n/),i=[],s=(0,a.Z)(r);try{for(s.s();!(t=s.n()).done;){var o=t.value.split(/\t/),u=(0,ae.Z)(o),c=u[0],f=u.slice(1);c&&i.push({tag:c.slice(1),data:f.map((function(e){var t=e.split(":",2),r=(0,n.Z)(t,2);return{tag:r[0],value:r[1]}}))})}}catch(h){s.e(h)}finally{s.f()}return i}var se=21840194;function oe(e){return ue.apply(this,arguments)}function ue(){return(ue=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i,o,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=!1,a=!1,e.prev=3,o=(0,T.Z)(t);case 5:return e.next=7,o.next();case 7:if(!(n=!(u=e.sent).done)){e.next=13;break}c=u.value,r=r.concat(c);case 10:n=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),a=!0,i=e.t0;case 19:if(e.prev=19,e.prev=20,!n||null==o.return){e.next=24;break}return e.next=24,o.return();case 24:if(e.prev=24,!a){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",r);case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var ce=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"read",value:function(){throw new Error("never called")}},{key:"stat",value:function(){throw new Error("never called")}},{key:"readFile",value:function(){throw new Error("never called")}},{key:"close",value:function(){throw new Error("never called")}}]),e}(),fe=function(){function e(t){var r=this,n=t.bamFilehandle,a=t.bamPath,c=t.bamUrl,f=t.baiPath,h=t.baiFilehandle,l=t.baiUrl,d=t.csiPath,v=t.csiFilehandle,p=t.csiUrl,b=t.htsget,y=t.yieldThreadTime,k=void 0===y?100:y,g=t.renameRefSeqs,m=void 0===g?function(e){return e}:g;if((0,u.Z)(this,e),this.htsget=!1,this.featureCache=new(N())({cache:new(j())({maxSize:50}),fill:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,n){var a,o,u,c,f,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.chunk,o=t.opts,e.next=3,r._readChunk({chunk:a,opts:(0,i.Z)((0,i.Z)({},o),{},{signal:n})});case 3:return u=e.sent,c=u.data,f=u.cpositions,h=u.dpositions,e.abrupt("return",r.readBamFeatures(c,f,h,a));case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),this.renameRefSeq=m,n)this.bam=n;else if(a)this.bam=new F.S9(a);else if(c)this.bam=new F.kC(c);else{if(!b)throw new Error("unable to initialize bam");this.htsget=!0,this.bam=new ce}if(v)this.index=new O({filehandle:v});else if(d)this.index=new O({filehandle:new F.S9(d)});else if(p)this.index=new O({filehandle:new F.kC(p)});else if(h)this.index=new I({filehandle:h});else if(f)this.index=new I({filehandle:new F.S9(f)});else if(l)this.index=new I({filehandle:new F.kC(l)});else if(a)this.index=new I({filehandle:new F.S9("".concat(a,".bai"))});else if(c)this.index=new I({filehandle:new F.kC("".concat(c,".bai"))});else{if(!b)throw new Error("unable to infer index format");this.htsget=!0}this.yieldThreadTime=k}return(0,c.Z)(e,[{key:"getHeaderPre",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i,o,u,c,f,h,l,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g(t),this.index){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.index.parse(r);case 5:if(n=e.sent,!(a=n.firstDataLine?n.firstDataLine.blockPosition+65535:void 0)){e.next=17;break}return o=a+65536,e.next=11,this.bam.read(A.Buffer.alloc(o),0,o,0,r);case 11:if((u=e.sent).bytesRead){e.next=14;break}throw new Error("Error reading header");case 14:i=u.buffer.subarray(0,Math.min(u.bytesRead,a)),e.next=20;break;case 17:return e.next=19,this.bam.readFile(r);case 19:i=e.sent;case 20:return e.next=22,(0,M.unzip)(i);case 22:if((c=e.sent).readInt32LE(0)===se){e.next=25;break}throw new Error("Not a BAM file");case 25:return f=c.readInt32LE(4),this.header=c.toString("utf8",8,8+f),e.next=29,this._readRefSeqs(f+8,65535,r);case 29:return h=e.sent,l=h.chrToIndex,d=h.indexToChr,this.chrToIndex=l,this.indexToChr=d,e.abrupt("return",ie(this.header));case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(e){var t=this;return this.headerP||(this.headerP=this.getHeaderPre(e).catch((function(e){throw t.headerP=void 0,e}))),this.headerP}},{key:"getHeaderText",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var t,r=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getHeader(t);case 3:return e.abrupt("return",this.header);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_readRefSeqs",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n){var a,i,o,u,c,f,h,l,d,v,p,b,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>r)){e.next=2;break}return e.abrupt("return",this._readRefSeqs(t,2*r,n));case 2:return a=r+65536,e.next=5,this.bam.read(A.Buffer.alloc(a),0,r,0,n);case 5:if(i=e.sent,o=i.bytesRead,u=i.buffer,o){e.next=10;break}throw new Error("Error reading refseqs from header");case 10:return e.next=12,(0,M.unzip)(u.subarray(0,Math.min(o,r)));case 12:c=e.sent,f=c.readInt32LE(t),h=t+4,l={},d=[],v=0;case 18:if(!(v<f)){e.next=31;break}if(p=c.readInt32LE(h),b=this.renameRefSeq(c.toString("utf8",h+4,h+4+p-1)),y=c.readInt32LE(h+p+4),l[b]=v,d.push({refName:b,length:y}),!((h=h+8+p)>c.length)){e.next=28;break}return console.warn("BAM header is very big.  Re-fetching ".concat(r," bytes.")),e.abrupt("return",this._readRefSeqs(t,2*r,n));case 28:v+=1,e.next=18;break;case 31:return e.abrupt("return",{chrToIndex:l,indexToChr:d});case 32:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getRecordsForRange",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n,a){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",oe(this.streamRecordsForRange(t,r,n,a)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"streamRecordsForRange",value:function(e,t,r,n){var a=this;return(0,C.Z)((0,s.Z)().mark((function i(){var o,u,c;return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,P.Z)(a.getHeader(n));case 2:if(void 0!==(u=null===(o=a.chrToIndex)||void 0===o?void 0:o[e])&&a.index){i.next=8;break}return i.next=6,[];case 6:i.next=12;break;case 8:return i.next=10,(0,P.Z)(a.index.blocksForRange(u,t-1,r,n));case 10:return c=i.sent,i.delegateYield((0,L.Z)((0,T.Z)(a._fetchChunkFeatures(c,u,t,r,n)),P.Z),"t0",12);case 12:case"end":return i.stop()}}),i)})))()}},{key:"_fetchChunkFeatures",value:function(e,t,r,n){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(0,C.Z)((0,s.Z)().mark((function u(){var c,f,h,l,d,v,p,b,y,g,m;return(0,s.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:c=o.viewAsPairs,f=[],h=!1,l=(0,a.Z)(e),s.prev=4,l.s();case 6:if((d=l.n()).done){s.next=41;break}return v=d.value,s.next=10,(0,P.Z)(i.featureCache.get(v.toString(),{chunk:v,opts:o},o.signal));case 10:p=s.sent,b=[],y=(0,a.Z)(p),s.prev=13,y.s();case 15:if((g=y.n()).done){s.next=26;break}if((m=g.value).seq_id()!==t){s.next=24;break}if(!(m.get("start")>=n)){s.next=23;break}return h=!0,s.abrupt("break",26);case 23:m.get("end")>=r&&b.push(m);case 24:s.next=15;break;case 26:s.next=31;break;case 28:s.prev=28,s.t0=s.catch(13),y.e(s.t0);case 31:return s.prev=31,y.f(),s.finish(31);case 34:return f.push(b),s.next=37,b;case 37:if(!h){s.next=39;break}return s.abrupt("break",41);case 39:s.next=6;break;case 41:s.next=46;break;case 43:s.prev=43,s.t1=s.catch(4),l.e(s.t1);case 46:return s.prev=46,l.f(),s.finish(46);case 49:if(k(o.signal),!c){s.next=53;break}return s.next=53,i.fetchPairs(t,f,o);case 53:case"end":return s.stop()}}),u,null,[[4,43,46,49],[13,28,31,34]])})))()}},{key:"fetchPairs",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,i){var u,c,f,h,l,d,v,p,b,y,k,g,m=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=i.pairAcrossChr,c=i.maxInsertSize,f=void 0===c?2e5:c,h={},l={},r.map((function(e){var t,r={},i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){var s=t.value,o=s.name(),u=s.id();r[o]||(r[o]=0),r[o]++,l[u]=1}}catch(p){i.e(p)}finally{i.f()}for(var c=0,f=Object.entries(r);c<f.length;c++){var d=(0,n.Z)(f[c],2),v=d[0];1===d[1]&&(h[v]=!0)}})),d=[],r.map((function(e){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var s=r.value,o=s.name(),c=s.get("start"),l=s._next_pos(),v=s._next_refid();m.index&&h[o]&&(u||v===t&&Math.abs(c-l)<f)&&d.push(m.index.blocksForRange(v,l,l+1,i))}}catch(p){n.e(p)}finally{n.f()}})),v=new Map,e.next=9,Promise.all(d);case 9:p=e.sent,b=(0,a.Z)(p.flat());try{for(b.s();!(y=b.n()).done;)k=y.value,v.has(k.toString())||v.set(k.toString(),k)}catch(x){b.e(x)}finally{b.f()}return e.next=14,Promise.all((0,S.Z)(v.values()).map(function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,o,u,c,f,d,v,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m._readChunk({chunk:t,opts:i});case 2:return r=e.sent,n=r.data,o=r.cpositions,u=r.dpositions,c=r.chunk,f=[],e.t0=a.Z,e.next=11,m.readBamFeatures(n,o,u,c);case 11:e.t1=e.sent,d=(0,e.t0)(e.t1);try{for(d.s();!(v=d.n()).done;)p=v.value,h[p.get("name")]&&!l[p.id()]&&f.push(p)}catch(x){d.e(x)}finally{d.f()}return e.abrupt("return",f);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:return g=e.sent,e.abrupt("return",g.flat());case 16:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_readRegion",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r){var n,a,i,o,u=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:{},e.next=3,this.bam.read(A.Buffer.alloc(r),0,r,t,n);case 3:return a=e.sent,i=a.bytesRead,o=a.buffer,e.abrupt("return",o.subarray(0,Math.min(i,r)));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_readChunk",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a,i,o,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.chunk,n=t.opts,e.next=3,this._readRegion(r.minv.blockPosition,r.fetchedSize(),n);case 3:return a=e.sent,e.next=6,(0,M.unzipChunkSlice)(a,r);case 6:return i=e.sent,o=i.buffer,u=i.cpositions,c=i.dpositions,e.abrupt("return",{data:o,cpositions:u,dpositions:c,chunk:r});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBamFeatures",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n,a){var i,o,u,c,f,h,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,o=[],u=0,c=+Date.now();case 4:if(!(i+4<t.length)){e.next=18;break}if(f=t.readInt32LE(i),h=i+4+f-1,n){for(;i+a.minv.dataPosition>=n[u++];);u--}if(!(h<t.length)){e.next=15;break}if(l=new ne({bytes:{byteArray:t,start:i,end:h},fileOffset:r.length>0?256*r[u]+(i-n[u])+a.minv.dataPosition+1:q().signed(t.slice(i,h))}),o.push(l),!(this.yieldThreadTime&&+Date.now()-c>this.yieldThreadTime)){e.next=15;break}return e.next=14,y(1);case 14:c=+Date.now();case 15:i=h+1,e.next=4;break;case 18:return e.abrupt("return",o);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null===(r=this.chrToIndex)||void 0===r?void 0:r[t],e.abrupt("return",void 0!==a&&(null===(n=this.index)||void 0===n?void 0:n.hasRefSeq(a)));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lineCount",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(r=this.chrToIndex)||void 0===r?void 0:r[t],e.abrupt("return",void 0!==n&&this.index?this.index.lineCount(n):0);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n){var a,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.index.parse();case 4:return i=null===(a=this.chrToIndex)||void 0===a?void 0:a[t],e.abrupt("return",void 0===i?[]:this.index.indexCov(i,r,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"blocksForRange",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t,r,n,a){var i,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.index){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.index.parse();case 4:return o=null===(i=this.chrToIndex)||void 0===i?void 0:i[t],e.abrupt("return",void 0===o?[]:this.index.blocksForRange(o,r,n,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()}]),e}(),he=r(59740),le=["referer"];function de(e,t){return ve.apply(this,arguments)}function ve(){return ve=(0,o.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var n,a,o,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url,a=t.headers,!n.startsWith("data:")){e.next=5;break}return e.abrupt("return",A.Buffer.from(n.split(",")[1],"base64"));case 5:return a.referer,o=(0,he.Z)(a,le),e.next=8,fetch(n,(0,i.Z)((0,i.Z)({},r),{},{headers:(0,i.Z)((0,i.Z)({},null===r||void 0===r?void 0:r.headers),o)}));case 8:if((u=e.sent).ok){e.next=17;break}return e.t0=Error,e.t1="HTTP ".concat(u.status," fetching ").concat(n,": "),e.next=14,u.text();case 14:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 17:return e.t4=A.Buffer,e.next=20,u.arrayBuffer();case 20:return e.t5=e.sent,e.abrupt("return",e.t4.from.call(e.t4,e.t5));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return n=e.sent,e.t0=A.Buffer,e.next=6,Promise.all(n.map((function(e){return(0,M.unzip)(e)})));case 6:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 8:case"end":return e.stop()}}),e)}))),ve.apply(this,arguments)}var pe=function(e){(0,f.Z)(r,e);var t=(0,h.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,{htsget:!0})).baseUrl=e.baseUrl,n.trackId=e.trackId,n}return(0,c.Z)(r,[{key:"streamRecordsForRange",value:function(e,t,r,n){var a=this;return(0,C.Z)((0,s.Z)().mark((function o(){var u,c,f,h,l,d,v;return(0,s.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(c="".concat(a.baseUrl,"/").concat(a.trackId),f="".concat(c,"?referenceName=").concat(e,"&start=").concat(t,"&end=").concat(r,"&format=BAM"),void 0!==(h=null===(u=a.chrToIndex)||void 0===u?void 0:u[e])){s.next=8;break}return s.next=6,[];case 6:s.next=26;break;case 8:return s.next=10,(0,P.Z)(fetch(f,(0,i.Z)({},n)));case 10:if((l=s.sent).ok){s.next=19;break}return s.t0=Error,s.t1="HTTP ".concat(l.status," fetching ").concat(f,": "),s.next=16,(0,P.Z)(l.text());case 16:throw s.t2=s.sent,s.t3=s.t1.concat.call(s.t1,s.t2),new s.t0(s.t3);case 19:return s.next=21,(0,P.Z)(l.json());case 21:return d=s.sent,s.next=24,(0,P.Z)(de(d.htsget.urls.slice(1),n));case 24:return v=s.sent,s.delegateYield((0,L.Z)((0,T.Z)(a._fetchChunkFeatures([{buffer:v,_fetchedSize:void 0,bin:0,compareTo:function(){return 0},toUniqueString:function(){return"".concat(e,"_").concat(t,"_").concat(r)},fetchedSize:function(){return 0},minv:{dataPosition:0,blockPosition:0,compareTo:function(){return 0}},maxv:{dataPosition:Number.MAX_SAFE_INTEGER,blockPosition:0,compareTo:function(){return 0}},toString:function(){return"".concat(e,"_").concat(t,"_").concat(r)}}],h,t,r,n)),P.Z),"t4",26);case 26:case"end":return s.stop()}}),o)})))()}},{key:"_readChunk",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.chunk).buffer){e.next=3;break}throw new Error("expected chunk.buffer in htsget");case 3:return e.abrupt("return",{data:r.buffer,cpositions:[],dpositions:[],chunk:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(){var t,r,i,o,u,c,f,h,l,d,v,p,b,y,k,g,m,x,w,_,Z,E=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.length>0&&void 0!==E[0]?E[0]:{},r="".concat(this.baseUrl,"/").concat(this.trackId,"?referenceName=na&class=header"),e.next=4,fetch(r,t);case 4:if((i=e.sent).ok){e.next=13;break}return e.t0=Error,e.t1="HTTP ".concat(i.status," fetching ").concat(r,": "),e.next=10,i.text();case 10:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 13:return e.next=15,i.json();case 15:return o=e.sent,e.next=18,de(o.htsget.urls,t);case 18:if((u=e.sent).readInt32LE(0)===se){e.next=21;break}throw new Error("Not a BAM file");case 21:c=u.readInt32LE(4),f=u.toString("utf8",8,8+c),h=ie(f),l=[],d={},v=h.filter((function(e){return"SQ"===e.tag})),p=(0,a.Z)(v.entries());try{for(p.s();!(b=p.n()).done;){y=(0,n.Z)(b.value,2),k=y[0],g=y[1],m="",x=0,w=(0,a.Z)(g.data);try{for(w.s();!(_=w.n()).done;)"SN"===(Z=_.value).tag?m=Z.value:"LN"===Z.tag&&(x=+Z.value)}catch(s){w.e(s)}finally{w.f()}d[m]=k,l[k]={refName:m,length:x}}}catch(s){p.e(s)}finally{p.f()}return this.chrToIndex=d,this.indexToChr=l,e.abrupt("return",h);case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(fe)},16922:function(e,t,r){var n=r(53100).default,a=r(98870).default,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(41699),o=i(r(53847)),u=i(r(1528)),c=function(){function e(t){var r=t.fill,a=t.cache;if(n(this,e),"function"!==typeof r)throw new TypeError("must pass a fill function");if("object"!==typeof a)throw new TypeError("must pass a cache object");if("function"!==typeof a.get||"function"!==typeof a.set||"function"!==typeof a.delete)throw new TypeError("cache must implement get(key), set(key, val), and and delete(key)");this.cache=a,this.fillCallback=r}return a(e,[{key:"evict",value:function(e,t){this.cache.get(e)===t&&this.cache.delete(e)}},{key:"fill",value:function(e,t,r,n){var a=this,i=new o.default,s=new u.default;s.addCallback(n);var c={aborter:i,promise:this.fillCallback(t,i.signal,(function(e){s.callback(e)})),settled:!1,statusReporter:s,get aborted(){return this.aborter.signal.aborted}};c.aborter.addSignal(r),c.aborter.signal.addEventListener("abort",(function(){c.settled||a.evict(e,c)})),c.promise.then((function(){c.settled=!0}),(function(){c.settled=!0,a.evict(e,c)})).catch((function(e){throw console.error(e),e})),this.cache.set(e,c)}},{key:"has",value:function(e){return this.cache.has(e)}},{key:"get",value:function(t,r,n,a){if(!n&&r instanceof s.AbortSignal)throw new TypeError("second get argument appears to be an AbortSignal, perhaps you meant to pass `null` for the fill data?");var i=this.cache.get(t);return i?i.aborted&&!i.settled?(this.evict(t,i),this.get(t,r,n,a)):i.settled?i.promise:(i.aborter.addSignal(n),i.statusReporter.addCallback(a),e.checkSinglePromise(i.promise,n)):(this.fill(t,r,n,a),e.checkSinglePromise(this.cache.get(t).promise,n))}},{key:"delete",value:function(e){var t=this.cache.get(e);t&&(t.settled||t.aborter.abort(),this.cache.delete(e))}},{key:"clear",value:function(){for(var e=this.cache.keys(),t=0,r=e.next();!r.done;r=e.next())this.delete(r.value),t+=1;return t}}],[{key:"isAbortException",value:function(e){return"AbortError"===e.name||"ERR_ABORTED"===e.code||"AbortError: aborted"===e.message||"Error: aborted"===e.message}},{key:"checkSinglePromise",value:function(e,t){function r(){if(t&&t.aborted)throw Object.assign(new Error("aborted"),{code:"ERR_ABORTED"})}return e.then((function(e){return r(),e}),(function(e){throw r(),e}))}}]),e}();t.default=c},53847:function(e,t,r){var n=r(98870).default,a=r(53100).default;Object.defineProperty(t,"__esModule",{value:!0});var i=r(41699),s=n((function e(){a(this,e)})),o=function(){function e(){a(this,e),this.signals=new Set,this.abortController=new i.AbortController}return n(e,[{key:"addSignal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s;if(this.signal.aborted)throw new Error("cannot add a signal, already aborted!");this.signals.add(t),t.aborted?this.handleAborted(t):"function"===typeof t.addEventListener&&t.addEventListener("abort",(function(){e.handleAborted(t)}))}},{key:"handleAborted",value:function(e){this.signals.delete(e),0===this.signals.size&&this.abortController.abort()}},{key:"signal",get:function(){return this.abortController.signal}},{key:"abort",value:function(){this.abortController.abort()}}]),e}();t.default=o},1528:function(e,t,r){var n=r(53100).default,a=r(98870).default;Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){n(this,e),this.callbacks=new Set}return a(e,[{key:"addCallback",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.callbacks.add(e),e(this.currentMessage)}},{key:"callback",value:function(e){this.currentMessage=e,this.callbacks.forEach((function(t){t(e)}))}}]),e}();t.default=i},41699:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.AbortSignal=t.AbortController=void 0;var n=r(10395),a=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r.g)return r.g;throw new Error("unable to locate global object")},i="undefined"===typeof a().AbortController?n.AbortController:a().AbortController;t.AbortController=i;var s="undefined"===typeof a().AbortController?n.AbortSignal:a().AbortSignal;t.AbortSignal=s},64926:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(16922));t.default=a.default},85693:function(e,t,r){function n(e,t){this.v=e,this.k=t}r.d(t,{Z:function(){return n}})},61418:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(85693);function a(e){var t={},r=!1;function a(t,a){return r=!0,a=new Promise((function(r){r(e[t](a))})),{done:!1,value:new n.Z(a,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):a("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return a("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):a("return",e)}),t}},69621:function(e,t,r){function n(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new a(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function a(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return a=function(e){this.s=e,this.n=e.next},a.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new a(e)}r.d(t,{Z:function(){return n}})},30249:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(85693);function a(e){return new n.Z(e,0)}},98288:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(85693);function a(e){var t,r;function a(t,r){try{var s=e[t](r),o=s.value,u=o instanceof n.Z;Promise.resolve(u?o.v:o).then((function(r){if(u){var n="return"===t?"return":"next";if(!o.k||r.done)return a(n,r);r=e[n](r).value}i(s.done?"return":"normal",r)}),(function(e){a("throw",e)}))}catch(c){i("throw",c)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise((function(i,s){var o={key:e,arg:n,resolve:i,reject:s,next:null};r?r=r.next=o:(t=r=o,a(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}function i(e){return function(){return new a(e.apply(this,arguments))}}a.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)}}}]);
//# sourceMappingURL=1343.9e541994.chunk.js.map