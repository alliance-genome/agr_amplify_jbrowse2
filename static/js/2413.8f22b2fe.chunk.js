"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[2413,3180],{90375:(e,t,n)=>{n.d(t,{Z:()=>s});var l=n(66204),r=n(38684),a=n(54560);const o=(0,r.ZL)()((e=>({resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.action.disabled,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}})));function i({left:e,scrollLeft:t,idx:n,onDrag:r,onMouseDown:i}){const{classes:s}=o(),c=(0,l.useCallback)(((e,t)=>r(e,t,n)),[n,r]);return l.createElement(l.Fragment,null,l.createElement(a.Z,{onDrag:c,onMouseDown:i,vertical:!0,className:s.hiddenTick,style:{left:e-t-2.5}}),l.createElement("div",{style:{left:e-t},className:s.tick}))}function s({widths:e,setWidths:t,checkbox:n,scrollLeft:r=0}){const{classes:a}=o(),s=[],[c,d]=(0,l.useState)();let u=n?52:0;for(let t=0;t<e.length;t++){const n=e[t];s[t]=n+u,u+=n}return l.createElement("div",{className:a.resizeBar},s.map(((n,a)=>l.createElement(i,{key:a,onMouseDown:()=>{d([...e])},left:a===s.length-1?n-3:n,onDrag:(n,l,r)=>{const a=[...e];a[r]=Math.max(c[r]-l,50),t(a)},idx:a,scrollLeft:r}))))}},13577:(e,t,n)=>{n.d(t,{x:()=>r});var l=n(66204);function r(){const e=(0,l.useRef)(null),[t,n]=(0,l.useState)(0);return(0,l.useEffect)((()=>{const t=setInterval((()=>{const t=e.current?.querySelector(".MuiDataGrid-virtualScroller");t&&n(t.scrollLeft)}),100);return()=>{clearInterval(t)}}),[]),{ref:e,scrollLeft:t}}},23748:(e,t,n)=>{n.r(t),n.d(t,{default:()=>z});var l=n(66204),r=n(29520),a=n(35421),o=n(80846),i=n(99247),s=n(88196),c=n(23155),d=n(84081),u=n(83734),m=n(90375),f=n(90872),h=n(13577),p=n(38684),g=n(93840),w=n(46338),v=n(81799),E=n(49140),b=n(92292),k=n(98313),Z=n(74912);function C({model:e}){const{faceted:t}=e,[n,r]=(0,l.useState)(null),{showOptions:o,showFilters:i,showSparse:s,useShoppingCart:c}=t;return l.createElement(l.Fragment,null,l.createElement(g.ZP,{container:!0,spacing:4,alignItems:"center"},l.createElement(g.ZP,{item:!0},l.createElement(w.Z,{label:"Search...",value:t.filterText,onChange:e=>t.setFilterText(e.target.value),InputProps:{endAdornment:l.createElement(v.Z,{position:"end"},l.createElement(E.Z,{onClick:()=>t.setFilterText("")},l.createElement(b.Z,null)))}})),l.createElement(g.ZP,{item:!0},l.createElement(E.Z,{onClick:e=>r(e.currentTarget)},l.createElement(k.Z,null))),l.createElement(g.ZP,{item:!0},l.createElement(Z.Z,{model:e}))),l.createElement(a.Menu,{anchorEl:n,open:!!n,onClose:()=>r(null),onMenuItemClick:(e,t)=>{t(),r(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>t.setUseShoppingCart(!c),type:"checkbox",checked:c},{label:"Show sparse metadata columns",onClick:()=>t.setShowSparse(!s),checked:s,type:"checkbox"},{label:"Show facet filters",onClick:()=>t.setShowFilters(!i),checked:i,type:"checkbox"},{label:"Show extra table options",onClick:()=>t.setShowOptions(!o),checked:o,type:"checkbox"}]}))}var S=n(23540),x=n(94926),y=n(80013),L=n(32339),M=n(41997),T=n(97916);const R=(0,p.ZL)()((e=>({facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}})));function N({onClick:e}){return l.createElement(S.Z,{title:"Clear selection on this facet filter"},l.createElement(E.Z,{onClick:()=>e(),size:"small"},l.createElement(b.Z,null)))}function F({visible:e,onClick:t}){return l.createElement(S.Z,{title:"Minimize/expand this facet filter"},l.createElement(E.Z,{onClick:()=>t(),size:"small"},e?l.createElement(M.Z,null):l.createElement(T.Z,null)))}const H=(0,o.observer)((function({column:e,vals:t,width:n,model:r}){const{classes:a}=R(),[o,i]=(0,l.useState)(!0),{faceted:s}=r,{filters:c}=s;return l.createElement(x.Z,{key:e.field,className:a.facet,style:{width:n}},l.createElement("div",{style:{display:"flex"}},l.createElement(y.Z,null,e.field),l.createElement(N,{onClick:()=>r.faceted.setFilter(e.field,[])}),l.createElement(F,{visible:o,onClick:()=>i(!o)})),o?l.createElement(L.Z,{multiple:!0,native:!0,className:a.select,value:c.get(e.field)||[],onChange:t=>{s.setFilter(e.field,[...t.target.options].filter((e=>e.selected)).map((e=>e.value)))}},t.sort(((e,t)=>e[0].localeCompare(t[0]))).map((([e,t])=>l.createElement("option",{key:e,value:e},(0,f.coarseStripHTML)(e)," (",t,")")))):null)})),I=(0,o.observer)((function({rows:e,columns:t,width:n,model:r}){const{faceted:a}=r,{filters:o}=a,i=t.slice(1),s=new Map(i.map((e=>[e.field,new Map]))),c=a.filters.keys(),d=i.map((e=>e.field)),u=new Set;for(const e of c)o.get(e)?.length&&u.add(e);for(const e of d)u.add(e);let m=e;for(const e of u){const t=s.get(e);for(const n of m){const l=`${n[e]||""}`,r=t.get(l);l&&(void 0===r?t.set(l,1):t.set(l,r+1))}const n=o.get(e)?.length?new Set(o.get(e)):void 0;m=m.filter((t=>void 0===n||n.has(t[e])))}return l.createElement("div",null,i.map((e=>l.createElement(H,{key:e.field,vals:[...s.get(e.field)],column:e,width:n,model:r}))))}));var D=n(74150);const O=(0,p.ZL)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),P=.75,W=(0,o.observer)((function({model:e}){const{classes:t}=O(),{view:n,selection:r,faceted:o}=e,{rows:p,panelWidth:g,showFilters:w,useShoppingCart:v,showOptions:E,filteredRows:b,filteredNonMetadataKeys:k,filteredMetadataKeys:Z,visible:S,widths:x}=o,{pluginManager:y}=(0,f.getEnv)(e),{ref:L,scrollLeft:M}=(0,h.x)(),T=n.tracks,R=(0,f.useDebounce)(x,200),N=[{field:"name",hideable:!1,renderCell:n=>{const{value:r,row:a}=n,{id:o,conf:i}=a;return l.createElement("div",{className:t.cell},l.createElement(u.Z,{html:r}),l.createElement(D.Z,{id:o,conf:i,trackId:o,model:e}))},width:R.name??100},...k.map((e=>({field:e,width:R[e]??100,renderCell:e=>{const n=e.value;return n?l.createElement(u.Z,{className:t.cell,html:n}):""}}))),...Z.map((e=>({field:`metadata.${e}`,headerName:["name",...k].includes(e)?`${e} (from metadata)`:e,width:R["metadata."+e]??100,valueGetter:t=>t.row.metadata[e],renderCell:n=>{const r=n.row.metadata[e];return r?l.createElement(u.Z,{className:t.cell,html:r}):""}})))],F=new Set(T.map((e=>e.configuration.trackId)));return l.createElement(l.Fragment,null,l.createElement(C,{model:e}),l.createElement("div",{ref:L,style:{display:"flex",overflow:"hidden",height:window.innerHeight*P,width:window.innerWidth*P}},l.createElement("div",{style:{height:window.innerHeight*P,width:window.innerWidth*P-(w?g:0)}},l.createElement(m.Z,{checkbox:!0,widths:Object.values(x).map((e=>e??100)),setWidths:e=>o.setWidths(Object.fromEntries(Object.entries(x).map(((t,n)=>[t[0],e[n]])))),scrollLeft:M}),l.createElement(c._$,{rows:b,columnVisibilityModel:S,onColumnVisibilityModelChange:e=>o.setVisible(e),columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:t=>{if(v){const n=(0,s.getRoot)(e),l=y.pluggableConfigSchemaType("track");e.setSelection(t.map((e=>(0,s.resolveIdentifier)(l,n,e))))}else{const l=F,r=new Set(t);(0,i.transaction)((()=>{[...l].filter((e=>!r.has(e))).map((e=>n.hideTrack(e))),[...r].filter((e=>!l.has(e))).map((t=>{n.showTrack(t),e.addToRecentlyUsed(t)}))}))}},rowSelectionModel:v?r.map((e=>e.trackId)):[...F],slots:{toolbar:E?d.n:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:N,rowHeight:25})),w?l.createElement(l.Fragment,null,l.createElement(a.ResizeHandle,{vertical:!0,onDrag:e=>o.setPanelWidth(g-e),className:t.resizeHandle}),l.createElement("div",{style:{width:g,overflowY:"auto",overflowX:"hidden"}},l.createElement(I,{model:e,width:g-10,rows:p,columns:N}))):null))})),z=(0,o.observer)((function(e){const{handleClose:t}=e;return l.createElement(a.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector"},l.createElement(r.Z,null,l.createElement(W,e)))}))},6816:(e,t,n)=>{n.d(t,{d:()=>c});var l=n(66204),r=n(52682),a=n(76734),o=n(26074),i=n(43188);function s(e){return e.substring(2).toLowerCase()}function c(e){const{children:t,disableReactTree:n=!1,mouseEvent:c="onClick",onClickAway:d,touchEvent:u="onTouchEnd"}=e,m=l.useRef(!1),f=l.useRef(null),h=l.useRef(!1),p=l.useRef(!1);l.useEffect((()=>(setTimeout((()=>{h.current=!0}),0),()=>{h.current=!1})),[]);const g=(0,r.Z)(t.ref,f),w=(0,a.Z)((e=>{const t=p.current;p.current=!1;const l=(0,o.Z)(f.current);if(!h.current||!f.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,l))return;if(m.current)return void(m.current=!1);let r;r=e.composedPath?e.composedPath().indexOf(f.current)>-1:!l.documentElement.contains(e.target)||f.current.contains(e.target),r||!n&&t||d(e)})),v=e=>n=>{p.current=!0;const l=t.props[e];l&&l(n)},E={ref:g};return!1!==u&&(E[u]=v(u)),l.useEffect((()=>{if(!1!==u){const e=s(u),t=(0,o.Z)(f.current),n=()=>{m.current=!0};return t.addEventListener(e,w),t.addEventListener("touchmove",n),()=>{t.removeEventListener(e,w),t.removeEventListener("touchmove",n)}}}),[w,u]),!1!==c&&(E[c]=v(c)),l.useEffect((()=>{if(!1!==c){const e=s(c),t=(0,o.Z)(f.current);return t.addEventListener(e,w),()=>{t.removeEventListener(e,w)}}}),[w,c]),(0,i.jsx)(l.Fragment,{children:l.cloneElement(t,E)})}},96987:(e,t,n)=>{n.d(t,{Z:()=>h});var l=n(55559),r=n(30984),a=n(66204),o=n(56317),i=n(58029),s=n(57369),c=n(61125),d=n(41666),u=n(43188);const m=["className","component","disableGutters","variant"],f=(0,c.ZP)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableGutters&&t.gutters,t[n.variant]]}})((({theme:e,ownerState:t})=>(0,r.Z)({position:"relative",display:"flex",alignItems:"center"},!t.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}},"dense"===t.variant&&{minHeight:48})),(({theme:e,ownerState:t})=>"regular"===t.variant&&e.mixins.toolbar)),h=a.forwardRef((function(e,t){const n=(0,s.Z)({props:e,name:"MuiToolbar"}),{className:a,component:c="div",disableGutters:h=!1,variant:p="regular"}=n,g=(0,l.Z)(n,m),w=(0,r.Z)({},n,{component:c,disableGutters:h,variant:p}),v=(e=>{const{classes:t,disableGutters:n,variant:l}=e,r={root:["root",!n&&"gutters",l]};return(0,i.Z)(r,d.N,t)})(w);return(0,u.jsx)(f,(0,r.Z)({as:c,className:(0,o.Z)(v.root,a),ref:t,ownerState:w},g))}))},41666:(e,t,n)=>{n.d(t,{N:()=>a,Z:()=>o});var l=n(58109),r=n(95201);function a(e){return(0,r.Z)("MuiToolbar",e)}const o=(0,l.Z)("MuiToolbar",["root","gutters","regular","dense"])}}]);
//# sourceMappingURL=2413.8f22b2fe.chunk.js.map