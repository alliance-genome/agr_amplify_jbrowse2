{"version":3,"file":"static/js/6602.c915ebe6.chunk.js","mappings":"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","sources":["../../../packages/core/PluginLoader.ts","../../../packages/core/rpc/remoteAbortSignals.ts","../../../packages/core/ui/AssemblySelector.tsx","../../../packages/core/ui/CascadingMenu.tsx","../../../packages/core/ui/Dialog.tsx","../../../packages/core/ui/EditableTypography.tsx","../../../packages/core/ui/ErrorMessage.tsx","../../../packages/core/ui/FactoryResetDialog.tsx","../../../packages/core/ui/Icons.tsx","../../../packages/core/ui/Logo.tsx","../../../packages/core/ui/Menu.tsx","../../../packages/core/ui/ResizeHandle.tsx","../../../packages/core/ui/ReturnToImportFormDialog.tsx","../../../packages/core/ui/SanitizedHTML.tsx","../../../packages/core/ui/theme.ts","../../../packages/core/ui/FileSelector/FileSelector.tsx","../../../packages/core/ui/PrerenderedCanvas.tsx","../../../packages/core/ui/Tooltip.tsx","../../../packages/core/util/QuickLRU.js","../../../packages/core/util/index.ts","../../../packages/core/util/types/mst.ts","../../../packages/product-core/src/Session/BaseSession.ts","../../../packages/product-core/src/Session/Connections.ts","../../../plugins/data-management/src/index.ts","../../../packages/core/ui/Snackbar.tsx","../../../packages/core/ui/DropDownMenu.tsx","../../../packages/core/ui/AppLogo.tsx","../../../packages/app-core/src/ui/App/AppToolbar.tsx","../../../packages/app-core/src/ui/App/ViewLauncher.tsx","../../../packages/app-core/src/ui/App/ViewMenu.tsx","../../../packages/app-core/src/ui/App/ViewContainerTitle.tsx","../../../packages/app-core/src/ui/App/ViewHeader.tsx","../../../packages/app-core/src/ui/App/ViewContainer.tsx","../../../packages/app-core/src/ui/App/ViewPanel.tsx","../../../packages/app-core/src/ui/App/DialogQueue.tsx","../../../packages/app-core/src/ui/App/AppFab.tsx","../../../packages/app-core/src/ui/App/App.tsx","../../../packages/core/util/TimeTraveller.ts","../../../packages/core/rpc/baseRpcConfig.ts","../../../packages/core/rpc/webWorkerRpcConfig.ts","../../../packages/core/rpc/mainThreadRpcConfig.ts","../../../packages/core/rpc/configSchema.ts","../../../packages/core/rpc/BaseRpcDriver.ts","../../../packages/core/rpc/WebWorkerRpcDriver.ts","../../../packages/core/rpc/MainThreadRpcDriver.ts","../../../packages/core/rpc/RpcManager.ts","components/ShareButton.tsx","components/JBrowse.tsx","SessionLoader.ts","components/StartScreenErrorMessage.tsx","../../../packages/core/assemblyManager/assemblyConfigSchema.ts","../../../packages/core/TextSearch/TextSearchManager.ts","makeWorkerInstance.ts","jbrowseModel.ts","../../../packages/core/assemblyManager/assembly.ts","../../../packages/core/assemblyManager/assemblyManager.ts","rootModel/rootModel.ts","../../../packages/app-core/src/JBrowseModel/index.ts","../../../packages/app-core/src/JBrowseConfig/index.ts","../../../packages/product-core/src/RootModel/FormatDetails.ts","../../../packages/product-core/src/RootModel/FormatAbout.ts","../../../packages/product-core/src/RootModel/HierarchicalConfig.ts","../../../packages/product-core/src/RootModel/BaseRootModel.ts","../../../packages/product-core/src/RootModel/InternetAccounts.ts","../../../packages/app-core/src/HistoryManagement/index.ts","../../../packages/app-core/src/RootMenu/index.ts","../../../packages/product-core/src/Session/ReferenceManagement.ts","../../../packages/product-core/src/Session/DrawerWidgets.ts","../../../packages/web-core/src/BaseWebSession/index.ts","../../../packages/product-core/src/Session/DialogQueue.ts","../../../packages/product-core/src/Session/Themes.ts","../../../packages/product-core/src/Session/MultipleViews.ts","../../../packages/product-core/src/Session/SessionTracks.ts","../../../packages/product-core/src/Session/Tracks.ts","../../../packages/app-core/src/Assemblies/SessionAssembliesMixin.ts","../../../packages/app-core/src/Assemblies/TemporaryAssembliesMixin.ts","../../../packages/web-core/src/SessionConnections.ts","../../../packages/app-core/src/AppFocus/index.ts","../../../packages/core/ui/SnackbarModel.ts","sessionModel/index.ts","createPluginManager.ts","../../../packages/core/util/analytics.ts","components/Loader.tsx","factoryReset.ts","sessionSharing.ts","util.ts"],"sourcesContent":["import domLoadScript from 'load-script'\n\n// locals\nimport Plugin, { PluginConstructor } from './Plugin'\nimport ReExports from './ReExports'\nimport { isElectron } from './util'\n\nexport interface UMDLocPluginDefinition {\n  umdLoc: {\n    uri: string\n    baseUri?: string\n  }\n  name: string\n}\n\nexport interface UMDUrlPluginDefinition {\n  umdUrl: string\n  name: string\n}\n\nexport interface LegacyUMDPluginDefinition {\n  url: string\n  name: string\n}\n\ntype UMDPluginDefinition = UMDLocPluginDefinition | UMDUrlPluginDefinition\n\nexport function isUMDPluginDefinition(\n  def: PluginDefinition,\n): def is UMDPluginDefinition | LegacyUMDPluginDefinition {\n  return (\n    ((def as UMDUrlPluginDefinition).umdUrl !== undefined ||\n      (def as LegacyUMDPluginDefinition).url !== undefined ||\n      (def as UMDLocPluginDefinition).umdLoc !== undefined) &&\n    (def as LegacyUMDPluginDefinition | UMDPluginDefinition).name !== undefined\n  )\n}\n\nexport interface ESMLocPluginDefinition {\n  esmLoc: { uri: string; baseUri?: string }\n}\nexport interface ESMUrlPluginDefinition {\n  esmUrl: string\n}\n\nexport type ESMPluginDefinition =\n  | ESMLocPluginDefinition\n  | ESMUrlPluginDefinition\n\nexport function isESMPluginDefinition(\n  def: PluginDefinition,\n): def is ESMPluginDefinition {\n  return (\n    (def as ESMUrlPluginDefinition).esmUrl !== undefined ||\n    (def as ESMLocPluginDefinition).esmLoc !== undefined\n  )\n}\n\nexport interface CJSPluginDefinition {\n  cjsUrl: string\n}\n\nfunction promisifiedLoadScript(src: string) {\n  return new Promise((resolve, reject) => {\n    domLoadScript(src, (err, script) => {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(script.src)\n      }\n    })\n  })\n}\n\nasync function loadScript(scriptUrl: string) {\n  if (!isInWebWorker()) {\n    return promisifiedLoadScript(scriptUrl)\n  }\n\n  // @ts-expect-error\n  if (globalThis?.importScripts) {\n    // @ts-expect-error\n    await globalThis.importScripts(scriptUrl)\n    return\n  }\n  throw new Error(\n    'cannot figure out how to load external JS scripts in this environment',\n  )\n}\n\nexport function isCJSPluginDefinition(\n  def: PluginDefinition,\n): def is CJSPluginDefinition {\n  return (def as CJSPluginDefinition).cjsUrl !== undefined\n}\n\nexport interface PluginDefinition\n  extends Partial<UMDUrlPluginDefinition>,\n    Partial<UMDLocPluginDefinition>,\n    Partial<LegacyUMDPluginDefinition>,\n    Partial<ESMLocPluginDefinition>,\n    Partial<ESMUrlPluginDefinition>,\n    Partial<CJSPluginDefinition> {}\n\nexport interface PluginRecord {\n  plugin: PluginConstructor\n  definition: PluginDefinition\n}\n\nexport interface LoadedPlugin {\n  default: PluginConstructor\n}\n\nexport function pluginDescriptionString(pluginDefinition: PluginDefinition) {\n  if (isUMDPluginDefinition(pluginDefinition)) {\n    return `UMD plugin ${pluginDefinition.name}`\n  }\n  if (isESMPluginDefinition(pluginDefinition)) {\n    return `ESM plugin ${\n      (pluginDefinition as ESMUrlPluginDefinition).esmUrl ||\n      (pluginDefinition as ESMLocPluginDefinition).esmLoc?.uri\n    }`\n  }\n  if (isCJSPluginDefinition(pluginDefinition)) {\n    return `CJS plugin ${pluginDefinition.cjsUrl}`\n  }\n  return 'unknown plugin'\n}\n\nfunction isInWebWorker() {\n  return Boolean('WorkerGlobalScope' in globalThis)\n}\n\nexport default class PluginLoader {\n  definitions: PluginDefinition[] = []\n\n  fetchESM?: (url: string) => Promise<LoadedPlugin>\n  fetchCJS?: (url: string) => Promise<LoadedPlugin>\n\n  constructor(\n    defs: PluginDefinition[] = [],\n    args?: {\n      fetchESM?: (url: string) => Promise<LoadedPlugin>\n      fetchCJS?: (url: string) => Promise<LoadedPlugin>\n    },\n  ) {\n    this.fetchESM = args?.fetchESM\n    this.fetchCJS = args?.fetchCJS\n    this.definitions = JSON.parse(JSON.stringify(defs))\n  }\n\n  async loadCJSPlugin(def: CJSPluginDefinition, baseUri?: string) {\n    const parsedUrl = new URL(def.cjsUrl, baseUri)\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `Cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    if (!this.fetchCJS) {\n      throw new Error('No fetchCJS callback provided')\n    }\n\n    return this.fetchCJS(parsedUrl.href)\n  }\n\n  async loadESMPlugin(def: ESMPluginDefinition, baseUri?: string) {\n    const parsedUrl =\n      'esmUrl' in def\n        ? new URL(def.esmUrl, baseUri)\n        : new URL(def.esmLoc.uri, def.esmLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n\n    if (!this.fetchESM) {\n      throw new Error(`No ESM fetcher installed`)\n    }\n    const plugin = await this.fetchESM(parsedUrl.href)\n\n    if (!plugin) {\n      throw new Error(`Could not load ESM plugin: ${parsedUrl}`)\n    }\n    return plugin\n  }\n\n  async loadUMDPlugin(\n    def: UMDPluginDefinition | LegacyUMDPluginDefinition,\n    baseUri?: string,\n  ) {\n    const parsedUrl =\n      'url' in def\n        ? new URL(def.url, baseUri)\n        : 'umdUrl' in def\n          ? new URL(def.umdUrl, baseUri)\n          : new URL(def.umdLoc.uri, def.umdLoc.baseUri)\n\n    if (parsedUrl.protocol !== 'http:' && parsedUrl.protocol !== 'https:') {\n      throw new Error(\n        `cannot load plugins using protocol \"${parsedUrl.protocol}\"`,\n      )\n    }\n    const moduleName = def.name\n    const umdName = `JBrowsePlugin${moduleName}`\n    if (typeof jest === 'undefined') {\n      await loadScript(parsedUrl.href)\n    } else {\n      // @ts-expect-error\n      globalThis[umdName] = { default: Plugin }\n    }\n\n    // @ts-expect-error\n    const plugin = globalThis[umdName] as\n      | { default: PluginConstructor }\n      | undefined\n    if (!plugin) {\n      throw new Error(\n        `Failed to load UMD bundle for ${moduleName}, ${umdName} is undefined`,\n      )\n    }\n    return plugin\n  }\n\n  async loadPlugin(def: PluginDefinition, baseUri?: string) {\n    let plugin: LoadedPlugin\n    if (isElectron && isCJSPluginDefinition(def)) {\n      plugin = await this.loadCJSPlugin(def, baseUri)\n    } else if (isESMPluginDefinition(def)) {\n      plugin = await this.loadESMPlugin(def, baseUri)\n    } else if (isUMDPluginDefinition(def)) {\n      plugin = await this.loadUMDPlugin(def, baseUri)\n    } else if (!isElectron && isCJSPluginDefinition(def)) {\n      throw new Error(\n        `CommonJS plugin found, but not in a NodeJS environment: ${JSON.stringify(\n          def,\n        )}`,\n      )\n    } else {\n      throw new Error(`Could not determine plugin type: ${JSON.stringify(def)}`)\n    }\n    if (!plugin.default) {\n      throw new Error(\n        `${pluginDescriptionString(\n          def,\n        )} does not have a default export, cannot load`,\n      )\n    }\n    return plugin.default\n  }\n\n  installGlobalReExports(target: WindowOrWorkerGlobalScope) {\n    // @ts-expect-error\n    target.JBrowseExports = Object.fromEntries(\n      Object.entries(ReExports).map(([moduleName, module]) => {\n        return [moduleName, module]\n      }),\n    )\n  }\n\n  async load(baseUri?: string) {\n    return Promise.all(\n      this.definitions.map(async definition => ({\n        plugin: await this.loadPlugin(definition, baseUri),\n        definition,\n      })),\n    )\n  }\n}\n","/* ---------------- for the RPC client ----------------- */\n\nlet abortSignalCounter = 0\nexport interface RemoteAbortSignal {\n  abortSignalId: number\n}\nconst abortSignalIds = new WeakMap<AbortSignal, number>() // map of abortsignal => numerical ID\n\n/**\n * assign an ID to the given abort signal and return a plain object\n * representation\n *\n * @param signal - the signal to serialize\n * @param callfunc - function used to call\n *  a remote method, will be called like callfunc('signalAbort', signalId)\n */\nexport function serializeAbortSignal(\n  signal: AbortSignal,\n  callfunc: (name: string, abortSignalId: number) => void,\n): RemoteAbortSignal {\n  let abortSignalId = abortSignalIds.get(signal)\n  if (!abortSignalId) {\n    abortSignalCounter += 1\n    abortSignalIds.set(signal, abortSignalCounter)\n    abortSignalId = abortSignalCounter\n    signal.addEventListener('abort', () => {\n      const signalId = abortSignalIds.get(signal)\n      if (signalId !== undefined) {\n        callfunc('signalAbort', signalId)\n      }\n    })\n  }\n  return { abortSignalId }\n}\n\n/* ---------------- for the RPC server ----------------- */\n\n/**\n * test whether a given object\n * @param thing - the thing to test\n * @returns true if the thing is a remote abort signal\n */\nexport function isRemoteAbortSignal(\n  thing: unknown,\n): thing is RemoteAbortSignal {\n  return (\n    typeof thing === 'object' &&\n    thing !== null &&\n    'abortSignalId' in thing &&\n    typeof thing.abortSignalId === 'number'\n  )\n}\n\n// the server side keeps a set of surrogate abort controllers that can be\n// aborted based on ID\nconst surrogateAbortControllers = new Map<number, AbortController>() // numerical ID => surrogate abort controller\n\n/**\n * deserialize the result of serializeAbortSignal into an AbortSignal\n *\n * @param signal -\n * @returns an abort signal that corresponds to the given ID\n */\nexport function deserializeAbortSignal({\n  abortSignalId,\n}: RemoteAbortSignal): AbortSignal {\n  let surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n  if (!surrogateAbortController) {\n    surrogateAbortController = new AbortController()\n    surrogateAbortControllers.set(abortSignalId, surrogateAbortController)\n  }\n  return surrogateAbortController.signal\n}\n\n/**\n * fire an abort signal from a remote abort signal ID\n *\n * @param abortSignalId -\n */\nexport function remoteAbort(props: { signalId: number }) {\n  const { signalId: abortSignalId } = props\n  const surrogateAbortController = surrogateAbortControllers.get(abortSignalId)\n\n  if (surrogateAbortController) {\n    surrogateAbortController.abort()\n  }\n}\n\nexport function remoteAbortRpcHandler() {\n  return {\n    signalAbort: remoteAbort,\n  }\n}\n","import React, { useState, useEffect } from 'react'\nimport {\n  TextField,\n  MenuItem,\n  InputProps as IIP,\n  TextFieldProps as TFP,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\n// locals\nimport { getConf } from '../configuration'\nimport { useLocalStorage, AbstractSessionModel } from '../util'\n\nconst useStyles = makeStyles()({\n  importFormEntry: {\n    minWidth: 180,\n  },\n})\n\nconst AssemblySelector = observer(function ({\n  session,\n  onChange,\n  selected,\n  InputProps,\n  TextFieldProps,\n  localStorageKey,\n  helperText = 'Select assembly to view',\n}: {\n  session: AbstractSessionModel\n  helperText?: string\n  onChange: (arg: string) => void\n  selected?: string\n  localStorageKey?: string\n  InputProps?: IIP\n  TextFieldProps?: TFP\n}) {\n  const { classes } = useStyles()\n  const { assemblyNames, assemblyManager } = session\n\n  // constructs a localstorage key based on host/path/config to help\n  // remember. non-config assists usage with e.g. embedded apps\n  const config = new URLSearchParams(window.location.search).get('config')\n  const [lastSelected, setLastSelected] =\n    typeof jest === 'undefined' && localStorageKey\n      ? useLocalStorage(\n          `lastAssembly-${[\n            window.location.host + window.location.pathname,\n            config,\n            localStorageKey,\n          ].join('-')}`,\n          selected,\n        )\n      : useState(selected)\n\n  const selection = assemblyNames.includes(lastSelected || '')\n    ? lastSelected\n    : selected\n\n  useEffect(() => {\n    if (selection && selection !== selected) {\n      onChange(selection)\n    }\n  }, [selection, onChange, selected])\n\n  const error = assemblyNames.length ? '' : 'No configured assemblies'\n  return (\n    <TextField\n      select\n      label=\"Assembly\"\n      variant=\"outlined\"\n      helperText={error || helperText}\n      value={selection || ''}\n      inputProps={{ 'data-testid': 'assembly-selector' }}\n      onChange={event => setLastSelected(event.target.value)}\n      error={!!error}\n      InputProps={InputProps}\n      disabled={!!error}\n      className={classes.importFormEntry}\n      {...TextFieldProps}\n    >\n      {assemblyNames.map(name => {\n        const assembly = assemblyManager.get(name)\n        const displayName = assembly ? getConf(assembly, 'displayName') : ''\n        return (\n          <MenuItem key={name} value={name}>\n            {displayName || name}\n          </MenuItem>\n        )\n      })}\n    </TextField>\n  )\n})\n\nexport default AssemblySelector\n","import React, { useContext, useMemo } from 'react'\nimport {\n  Divider,\n  ListItemIcon,\n  ListItemText,\n  ListSubheader,\n  Menu,\n  MenuItem,\n  PopoverOrigin,\n  SvgIconProps,\n} from '@mui/material'\nimport { MenuItem as JBMenuItem, MenuItemEndDecoration } from './Menu'\nimport {\n  bindHover,\n  bindFocus,\n  bindMenu,\n  usePopupState,\n  PopupState,\n} from 'material-ui-popup-state/hooks'\nimport HoverMenu from 'material-ui-popup-state/HoverMenu'\nimport ChevronRight from '@mui/icons-material/ChevronRight'\n\nconst CascadingContext = React.createContext({\n  parentPopupState: null,\n  rootPopupState: null,\n} as { parentPopupState: PopupState | null; rootPopupState: PopupState | null })\n\nfunction CascadingMenuItem({\n  onClick,\n  closeAfterItemClick,\n  ...props\n}: {\n  closeAfterItemClick: boolean\n  onClick?: Function\n  disabled?: boolean\n  children: React.ReactNode\n}) {\n  const { rootPopupState } = useContext(CascadingContext)\n  if (!rootPopupState) {\n    throw new Error('must be used inside a CascadingMenu')\n  }\n\n  return (\n    <MenuItem\n      {...props}\n      onClick={event => {\n        if (closeAfterItemClick) {\n          rootPopupState.close()\n        }\n        onClick?.(event)\n      }}\n    />\n  )\n}\n\nfunction CascadingSubmenu({\n  title,\n  Icon,\n  inset,\n  popupId,\n  ...props\n}: {\n  children: React.ReactNode\n  title: React.ReactNode\n  onMenuItemClick: Function\n  Icon: React.ComponentType<SvgIconProps> | undefined\n\n  inset: boolean\n  menuItems: JBMenuItem[]\n  popupId: string\n}) {\n  const { parentPopupState } = useContext(CascadingContext)\n  const popupState = usePopupState({\n    popupId,\n    variant: 'popover',\n    parentPopupState,\n  })\n  return (\n    <>\n      <MenuItem {...bindHover(popupState)} {...bindFocus(popupState)}>\n        {Icon ? (\n          <ListItemIcon>\n            <Icon />\n          </ListItemIcon>\n        ) : null}\n        <ListItemText primary={title} inset={inset} />\n        <ChevronRight />\n      </MenuItem>\n      <CascadingSubmenuHover\n        {...props}\n        anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'left' }}\n        popupState={popupState}\n      />\n    </>\n  )\n}\n\nfunction CascadingSubmenuHover({\n  popupState,\n  onMenuItemClick,\n  menuItems,\n  classes,\n  ...props\n}: {\n  classes?: Record<string, string>\n  popupState: PopupState\n  anchorOrigin: PopoverOrigin\n  transformOrigin: PopoverOrigin\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n}) {\n  const { rootPopupState } = useContext(CascadingContext)\n  const context = useMemo(\n    () => ({\n      rootPopupState: rootPopupState || popupState,\n      parentPopupState: popupState,\n    }),\n    [rootPopupState, popupState],\n  )\n\n  return (\n    <CascadingContext.Provider value={context}>\n      <HoverMenu {...props} {...bindMenu(popupState)} />\n    </CascadingContext.Provider>\n  )\n}\n\nfunction CascadingMenu({\n  popupState,\n  onMenuItemClick,\n  menuItems,\n  ...props\n}: {\n  popupState: PopupState\n  onMenuItemClick: Function\n  menuItems: JBMenuItem[]\n}) {\n  const { rootPopupState } = useContext(CascadingContext)\n  const context = useMemo(\n    () => ({\n      rootPopupState: rootPopupState || popupState,\n      parentPopupState: popupState,\n    }),\n    [rootPopupState, popupState],\n  )\n\n  return (\n    <CascadingContext.Provider value={context}>\n      <Menu {...props} {...bindMenu(popupState)} />\n    </CascadingContext.Provider>\n  )\n}\n\nfunction EndDecoration({ item }: { item: JBMenuItem }) {\n  if ('subMenu' in item) {\n    return <MenuItemEndDecoration type=\"subMenu\" />\n  } else if (item.type === 'checkbox' || item.type === 'radio') {\n    return (\n      <MenuItemEndDecoration\n        type={item.type}\n        checked={item.checked}\n        disabled={item.disabled}\n      />\n    )\n  }\n  return null\n}\n\nfunction CascadingMenuList({\n  onMenuItemClick,\n  closeAfterItemClick,\n  menuItems,\n  ...props\n}: {\n  menuItems: JBMenuItem[]\n  closeAfterItemClick: boolean\n  onMenuItemClick: Function\n}) {\n  function handleClick(callback: Function) {\n    return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n      onMenuItemClick(event, callback)\n    }\n  }\n\n  const hasIcon = menuItems.some(m => 'icon' in m && m.icon)\n  return (\n    <>\n      {menuItems.map((item, idx) => {\n        return 'subMenu' in item ? (\n          <CascadingSubmenu\n            key={`subMenu-${item.label}-${idx}`}\n            popupId={`subMenu-${item.label}`}\n            title={item.label}\n            Icon={item.icon}\n            inset={hasIcon && !item.icon}\n            onMenuItemClick={onMenuItemClick}\n            menuItems={item.subMenu}\n          >\n            <CascadingMenuList\n              {...props}\n              closeAfterItemClick={closeAfterItemClick}\n              onMenuItemClick={onMenuItemClick}\n              menuItems={item.subMenu}\n            />\n          </CascadingSubmenu>\n        ) : item.type === 'divider' ? (\n          <Divider key={`divider-${idx}`} component=\"li\" />\n        ) : item.type === 'subHeader' ? (\n          <ListSubheader key={`subHeader-${item.label}-${idx}`}>\n            {item.label}\n          </ListSubheader>\n        ) : (\n          <CascadingMenuItem\n            key={`${item.label}-${idx}`}\n            closeAfterItemClick={closeAfterItemClick}\n            onClick={'onClick' in item ? handleClick(item.onClick) : undefined}\n            disabled={Boolean(item.disabled)}\n          >\n            {item.icon ? (\n              <ListItemIcon>\n                <item.icon />\n              </ListItemIcon>\n            ) : null}{' '}\n            <ListItemText\n              primary={item.label}\n              secondary={item.subLabel}\n              inset={hasIcon && !item.icon}\n            />\n            <div style={{ flexGrow: 1, minWidth: 10 }} />\n            <EndDecoration item={item} />\n          </CascadingMenuItem>\n        )\n      })}\n    </>\n  )\n}\n\nfunction CascadingMenuChildren(props: {\n  onMenuItemClick: Function\n  closeAfterItemClick?: boolean\n  menuItems: JBMenuItem[]\n  popupState: PopupState\n}) {\n  const { closeAfterItemClick = true, ...rest } = props\n  return (\n    <CascadingMenu {...rest}>\n      <CascadingMenuList {...rest} closeAfterItemClick={closeAfterItemClick} />\n    </CascadingMenu>\n  )\n}\n\nexport default CascadingMenuChildren\n","import React from 'react'\nimport {\n  Dialog as MUIDialog,\n  DialogTitle,\n  DialogProps,\n  Divider,\n  IconButton,\n  ScopedCssBaseline,\n  ThemeProvider,\n  createTheme,\n  useTheme,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\nimport { ErrorBoundary } from 'react-error-boundary'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\n// locals\nimport ErrorMessage from './ErrorMessage'\n\nconst useStyles = makeStyles()(theme => ({\n  closeButton: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n    color: theme.palette.grey[500],\n  },\n}))\n\nfunction DialogError({ error }: { error: unknown }) {\n  return (\n    <div style={{ width: 800, margin: 40 }}>\n      <ErrorMessage error={error} />\n    </div>\n  )\n}\n\ninterface Props extends DialogProps {\n  header?: React.ReactNode\n}\n\nconst Dialog = observer(function (props: Props) {\n  const { classes } = useStyles()\n  const { title, header, children, onClose } = props\n  const theme = useTheme()\n\n  return (\n    <MUIDialog {...props}>\n      <ScopedCssBaseline>\n        {React.isValidElement(header) ? (\n          <>{header}</>\n        ) : (\n          <DialogTitle>\n            {title}\n            {onClose ? (\n              <IconButton\n                className={classes.closeButton}\n                onClick={() => {\n                  // @ts-expect-error\n                  onClose()\n                }}\n              >\n                <CloseIcon />\n              </IconButton>\n            ) : null}\n          </DialogTitle>\n        )}\n        <Divider />\n\n        <ErrorBoundary FallbackComponent={DialogError}>\n          <ThemeProvider\n            theme={createTheme(theme, {\n              components: {\n                MuiInputBase: {\n                  styleOverrides: {\n                    input: {\n                      // xref https://github.com/GMOD/jbrowse-components/pull/3666\n                      boxSizing: 'content-box!important' as 'content-box',\n                    },\n                  },\n                },\n              },\n            })}\n          >\n            {children}\n          </ThemeProvider>\n        </ErrorBoundary>\n      </ScopedCssBaseline>\n    </MUIDialog>\n  )\n})\n\nexport default Dialog\n","import React, { useEffect, useState } from 'react'\nimport { InputBase, Typography, TypographyProps, useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport useMeasure from '@jbrowse/core/util/useMeasure'\n\ntype Variant = TypographyProps['variant']\n\ntype EditableTypographyClassKey =\n  | 'input'\n  | 'inputBase'\n  | 'inputRoot'\n  | 'inputFocused'\n\nconst useStyles = makeStyles()(theme => ({\n  input: {},\n  inputBase: {},\n  typography: {\n    top: 6,\n    left: 2,\n    position: 'absolute',\n    whiteSpace: 'nowrap',\n    visibility: 'hidden',\n  },\n  inputRoot: {\n    padding: theme.spacing(0.5),\n  },\n  inputFocused: {\n    borderStyle: 'solid',\n    borderWidth: 2,\n  },\n}))\n\ninterface Props {\n  value: string\n  setValue: (value: string) => void\n  variant: Variant\n  classes?: Partial<Record<EditableTypographyClassKey, string>>\n}\n\n// using forwardRef so that MUI Tooltip can wrap this component\nconst EditableTypography = React.forwardRef<HTMLDivElement, Props>(\n  function EditableTypography2(props, ref) {\n    const { value, setValue, variant, ...other } = props\n    const [ref2, { width }] = useMeasure()\n    const [editedValue, setEditedValue] = useState<string>()\n    const [inputNode, setInputNode] = useState<HTMLInputElement | null>(null)\n    const [blur, setBlur] = useState(false)\n\n    useEffect(() => {\n      if (blur) {\n        inputNode?.blur()\n        setBlur(false)\n      }\n    }, [blur, inputNode])\n\n    // possibly tss-react does not understand the passing of props to\n    // useStyles, but it appears to work\n    // @ts-expect-error\n    const { classes } = useStyles(props, { props })\n    const theme = useTheme()\n\n    const val = editedValue === undefined ? value : editedValue\n\n    return (\n      <div {...other} ref={ref}>\n        <div style={{ position: 'relative' }}>\n          <Typography\n            ref={ref2}\n            component=\"span\"\n            variant={variant}\n            className={classes.typography}\n          >\n            {val}\n          </Typography>\n        </div>\n        <InputBase\n          inputRef={node => setInputNode(node)}\n          className={classes.inputBase}\n          inputProps={{\n            style: {\n              width,\n              ...(variant && variant !== 'inherit'\n                ? theme.typography[variant]\n                : {}),\n            },\n          }}\n          classes={{\n            input: classes.input,\n            root: classes.inputRoot,\n            focused: classes.inputFocused,\n          }}\n          value={val}\n          onChange={event => setEditedValue(event.target.value)}\n          onKeyDown={event => {\n            if (event.key === 'Enter') {\n              inputNode?.blur()\n            } else if (event.key === 'Escape') {\n              setEditedValue(undefined)\n              setBlur(true)\n            }\n          }}\n          onBlur={() => {\n            setValue(editedValue || value || '')\n            setEditedValue(undefined)\n          }}\n        />\n      </div>\n    )\n  },\n)\n\nexport default EditableTypography\n","import React from 'react'\n\nfunction parseError(str: string) {\n  let snapshotError = ''\n  const findStr = 'is not assignable'\n  const idx = str.indexOf(findStr)\n  if (idx !== -1) {\n    const trim = str.slice(0, idx + findStr.length)\n    // best effort to make a better error message than the default\n    // mobx-state-tree\n\n    // case 1. element has a path\n    const match = trim.match(\n      /.*at path \"(.*)\" snapshot `(.*)` is not assignable/m,\n    )\n    if (match) {\n      str = `Failed to load element at ${match[1]}...Failed element had snapshot`\n      snapshotError = match[2]\n    }\n\n    // case 2. element has no path\n    const match2 = trim.match(/.*snapshot `(.*)` is not assignable/)\n    if (match2) {\n      str = `Failed to load element...Failed element had snapshot`\n      snapshotError = match2[1]\n    }\n  }\n  return snapshotError\n}\n\nconst ErrorMessage = ({ error }: { error: unknown }) => {\n  const str = `${error}`\n  const snapshotError = parseError(str)\n  return (\n    <div\n      style={{\n        padding: 4,\n        margin: 4,\n        overflow: 'auto',\n        maxHeight: 200,\n        background: '#f88',\n        border: '1px solid black',\n      }}\n    >\n      {str.slice(0, 10000)}\n      {snapshotError ? (\n        <pre\n          style={{\n            background: 'lightgrey',\n            border: '1px solid black',\n            margin: 20,\n          }}\n        >\n          {JSON.stringify(JSON.parse(snapshotError), null, 2)}\n        </pre>\n      ) : null}\n    </div>\n  )\n}\n\nexport default ErrorMessage\n","import React from 'react'\nimport {\n  Button,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n} from '@mui/material'\nimport Dialog from '@jbrowse/core/ui/Dialog'\n\nexport default function FactoryResetDialog({\n  onClose,\n  open,\n  onFactoryReset,\n}: {\n  onClose: () => void\n  open: boolean\n  onFactoryReset: Function\n}) {\n  function handleDialogClose(action?: string) {\n    if (action === 'reset') {\n      onFactoryReset()\n    }\n    onClose()\n  }\n\n  return (\n    <Dialog title=\"Reset\" onClose={() => handleDialogClose()} open={open}>\n      <DialogContent>\n        <DialogContentText>\n          Are you sure you want to reset? This will restore the default\n          configuration.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => handleDialogClose()} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          onClick={() => handleDialogClose('reset')}\n          color=\"primary\"\n          variant=\"contained\"\n        >\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n","import SvgIcon, { SvgIconProps } from '@mui/material/SvgIcon'\nimport React from 'react'\n\n// Icons below come from https://material.io/resources/icons/?icon=line_style&style=baseline\nexport function ContentCopy(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\" />\n    </SvgIcon>\n  )\n}\n\n// https://materialdesignicons.com/ text-search icon\nexport function Indexing(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19.31 18.9L22.39 22L21 23.39L17.88 20.32C17.19 20.75 16.37 21 15.5 21C13 21 11 19 11 16.5C11 14 13 12 15.5 12C18 12 20 14 20 16.5C20 17.38 19.75 18.21 19.31 18.9M15.5 19C16.88 19 18 17.88 18 16.5C18 15.12 16.88 14 15.5 14C14.12 14 13 15.12 13 16.5C13 17.88 14.12 19 15.5 19M21 4V6H3V4H21M3 16V14H9V16H3M3 11V9H21V11H18.97C17.96 10.37 16.77 10 15.5 10C14.23 10 13.04 10.37 12.03 11H3Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentCut(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z\" />\n    </SvgIcon>\n  )\n}\n\nexport function ContentPaste(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z\" />\n    </SvgIcon>\n  )\n}\n\n//  format-list-checkbox from https://materialdesignicons.com/\nexport function TrackSelector(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z\" />\n    </SvgIcon>\n  )\n}\n\n//  content-save-edit from https://materialdesignicons.com/\nexport function SaveAs(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M10,19L10.14,18.86C8.9,18.5 8,17.36 8,16A3,3 0 0,1 11,13C12.36,13 13.5,13.9 13.86,15.14L20,9V7L16,3H4C2.89,3 2,3.9 2,5V19A2,2 0 0,0 4,21H10V19M4,5H14V9H4V5M20.04,12.13C19.9,12.13 19.76,12.19 19.65,12.3L18.65,13.3L20.7,15.35L21.7,14.35C21.92,14.14 21.92,13.79 21.7,13.58L20.42,12.3C20.31,12.19 20.18,12.13 20.04,12.13M18.07,13.88L12,19.94V22H14.06L20.12,15.93L18.07,13.88Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  content-save from https://materialdesignicons.com/\nexport function Save(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z\"\n      />\n    </SvgIcon>\n  )\n}\n\n//  dna from https://materialdesignicons.com/\nexport function DNA(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path\n        fill=\"currentColor\"\n        d=\"M4,2H6V4C6,5.44 6.68,6.61 7.88,7.78C8.74,8.61 9.89,9.41 11.09,10.2L9.26,11.39C8.27,10.72 7.31,10 6.5,9.21C5.07,7.82 4,6.1 4,4V2M18,2H20V4C20,6.1 18.93,7.82 17.5,9.21C16.09,10.59 14.29,11.73 12.54,12.84C10.79,13.96 9.09,15.05 7.88,16.22C6.68,17.39 6,18.56 6,20V22H4V20C4,17.9 5.07,16.18 6.5,14.79C7.91,13.41 9.71,12.27 11.46,11.16C13.21,10.04 14.91,8.95 16.12,7.78C17.32,6.61 18,5.44 18,4V2M14.74,12.61C15.73,13.28 16.69,14 17.5,14.79C18.93,16.18 20,17.9 20,20V22H18V20C18,18.56 17.32,17.39 16.12,16.22C15.26,15.39 14.11,14.59 12.91,13.8L14.74,12.61M7,3H17V4L16.94,4.5H7.06L7,4V3M7.68,6H16.32C16.08,6.34 15.8,6.69 15.42,7.06L14.91,7.5H9.07L8.58,7.06C8.2,6.69 7.92,6.34 7.68,6M9.09,16.5H14.93L15.42,16.94C15.8,17.31 16.08,17.66 16.32,18H7.68C7.92,17.66 8.2,17.31 8.58,16.94L9.09,16.5M7.06,19.5H16.94L17,20V21H7V20L7.06,19.5Z\"\n      />\n    </SvgIcon>\n  )\n}\n\nexport function Cable(props: SvgIconProps) {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z\" />\n    </SvgIcon>\n  )\n}\n","import React from 'react'\n\ntype LogoVariant = 'color' | 'black' | 'white'\n\ninterface LogoProps {\n  variant?: LogoVariant\n}\n\nfunction getColors(variant?: LogoVariant) {\n  if (variant === 'black') {\n    return {\n      midnight: '#808080',\n      forrest: '#666666',\n      grape: '#4d4d4d',\n      mandarin: '#333333',\n      gray: '#1a1a1a',\n    }\n  }\n  if (variant === 'white') {\n    return {\n      midnight: '#ffffff',\n      forrest: '#e6e6e6',\n      grape: '#cccccc',\n      mandarin: '#b3b3b3',\n      gray: '#999999',\n    }\n  }\n  return {\n    midnight: '#0d233f',\n    forrest: '#135560',\n    grape: '#721e63',\n    mandarin: '#ffb11d',\n    gray: '#dadada',\n  }\n}\n\nexport function Logomark({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 175 175\">\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nexport function LogoFull({ variant }: LogoProps) {\n  return (\n    <svg viewBox=\"0 0 641 175\">\n      <Text variant={variant} />\n      <Icon variant={variant} />\n    </svg>\n  )\n}\n\nfunction Icon({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <>\n      <path\n        style={{ fill: colors.midnight }}\n        d=\"M120.5,57.5c.168,0,.333.012.5.013V40.506c-.167,0-.333-.006-.5-.006a98.325,98.325,0,0,0-77.4,37.565q-2.664,3.378-5.023,6.994l14.206,9.327Q54.043,91.709,56,89.179A81.363,81.363,0,0,1,120.5,57.5Z\"\n      />\n      <path\n        style={{ fill: colors.forrest }}\n        d=\"M148.668,86.223c.308.133.6.283.908.42l6.746-15.618c-.153-.067-.3-.143-.454-.21a81.36,81.36,0,0,0-71.777,3.5q-2.8,1.544-5.469,3.309l9.249,14.054A63.93,63.93,0,0,1,148.668,86.223Z\"\n      />\n      <path\n        style={{ fill: colors.grape }}\n        d=\"M170.894,109.37A63.929,63.929,0,0,0,113.4,88.861l2.336,15.474a48.456,48.456,0,0,1,44.322,15.42c.111.125.214.255.324.381l11.16-10C171.323,109.879,171.118,109.62,170.894,109.37Z\"\n      />\n      <path\n        style={{ fill: colors.mandarin }}\n        d=\"M150.921,150.314c.04.163.07.326.107.489l16.509-4.058c-.039-.163-.067-.326-.107-.489A48.457,48.457,0,0,0,135.575,111.8l-5.515,15.591A32.466,32.466,0,0,1,150.921,150.314Z\"\n      />\n      <path\n        style={{ fill: colors.gray }}\n        d=\"M134.1,138.129l-9.779,13.213a32.486,32.486,0,0,1,7.823,14.463l15.147.852c.012-.166.032-.331.041-.5A32.464,32.464,0,0,0,134.1,138.129Z\"\n      />\n    </>\n  )\n}\n\nfunction Text({ variant }: LogoProps) {\n  const colors = getColors(variant)\n  return (\n    <g\n      aria-label=\"JBrowse\"\n      transform=\"translate(213.084 144.241)\"\n      style={{ fill: colors.midnight }}\n    >\n      <path d=\"m 26.355,-71.505 v 54.075 2.835 q 0,6.825 -0.42,10.185 -0.735,5.67 -2.835,9.135 -3.255,5.355 -8.505,8.4 -4.83,2.73 -11.55,3.57 L 1.47,11.76 Q 7.35,10.185 9.24,4.2 10.605,-0.105 10.605,-9.975 v -5.565 -55.965 q 1.785,0 4.62,0.315 2.835,0.21 3.255,0.21 1.785,0 2.94,-0.105 4.515,-0.42 4.935,-0.42 z\" />\n      <path d=\"m 60.68836,-65.415 v 24.78 h 3.255 q 2.94,0 4.935,-0.525 2.1,-0.525 3.885,-2.1 2.31,-1.995 3.36,-4.83 1.155,-2.835 1.155,-6.09 0,-5.565 -2.94,-8.61 -2.94,-3.045 -8.295,-3.045 -2.52,0 -5.355,0.42 z m 0,30.87 V -6.09 h 5.25 q 4.725,0 8.505,-3.675 3.885,-3.78 3.885,-10.08 0,-8.19 -4.62,-11.655 -4.095,-3.045 -13.02,-3.045 z M 44.93836,0 v -71.505 h 27.09 q 9.135,0 14.385,3.255 6.51,3.99 6.51,12.6 0,7.035 -5.25,11.655 -4.62,4.095 -11.97,5.145 v 0.945 q 7.56,0.735 12.285,3.99 6.615,4.62 6.615,13.335 0,10.185 -7.98,15.75 -6.93,4.83 -17.43,4.83 z\" />\n      <path d=\"M 109.44281,0.525 V -50.4 q 1.785,0.21 3.99,0.42 2.31,0.105 3.255,0.105 2.31,0 4.2,-0.21 1.89,-0.21 3.045,-0.315 v 13.02 q 1.89,-6.51 5.46,-9.87 4.41,-4.095 11.655,-4.095 -0.315,2.73 -0.42,6.825 -0.105,3.99 -0.105,7.455 l -0.945,0.84 q -0.945,-0.735 -2.415,-1.05 -1.47,-0.315 -2.94,-0.315 -3.57,0 -6.195,1.89 -2.52,1.785 -3.465,5.04 -0.42,1.155 -0.525,3.15 -0.105,1.89 -0.105,4.515 v 4.515 19.005 q -1.785,-0.21 -2.625,-0.21 -3.675,-0.315 -4.62,-0.315 -2.31,0 -4.2,0.21 -1.89,0.21 -3.045,0.315 z\" />\n      <path d=\"m 173.77337,1.47 q -11.655,0 -18.585,-6.825 -6.93,-6.825 -6.93,-18.48 0,-12.6 6.72,-20.055 6.825,-7.455 18.9,-7.455 11.97,0 18.9,6.72 6.93,6.72 6.93,18.48 0,12.285 -6.72,19.74 -7.14,7.875 -19.215,7.875 z m 0.735,-48.09 q -5.88,0 -8.505,6.51 -2.205,5.565 -2.205,15.96 0,8.19 1.47,12.915 2.415,7.98 8.505,7.98 5.565,0 8.19,-7.875 2.205,-6.51 2.205,-16.695 0,-8.505 -2.1,-13.23 -2.52,-5.565 -7.56,-5.565 z\" />\n      <path d=\"m 222.03563,-50.4 10.5,36.015 q 3.675,-11.235 5.67,-17.85 2.415,-8.085 5.04,-18.165 1.05,0.105 3.045,0.315 2.1,0.21 2.835,0.21 1.995,0 3.15,-0.105 1.26,-0.21 2.73,-0.42 l 10.71,36.015 q 5.88,-17.43 10.71,-36.015 l 4.2,0.315 4.095,-0.315 q -5.145,13.125 -9.135,24.57 -5.04,14.28 -8.505,26.355 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.205,-0.105 -1.89,0 -3.36,0.21 -1.365,0.21 -2.31,0.315 l -10.605,-34.755 q -4.41,13.65 -6.72,21.105 -2.31,7.35 -4.095,13.65 -1.89,-0.21 -3.36,-0.42 -1.365,-0.105 -2.31,-0.105 -1.995,0 -3.465,0.21 -1.365,0.21 -2.31,0.315 -3.78,-12.81 -5.04,-17.01 -2.205,-7.245 -5.46,-17.01 -2.835,-8.4 -5.88,-16.905 1.575,0 4.305,0.315 2.73,0.21 3.36,0.21 1.47,0 4.305,-0.21 2.835,-0.315 3.465,-0.315 z\" />\n      <path d=\"m 292.84172,-12.81 h 2.625 q 1.47,4.095 4.62,6.51 3.15,2.415 7.35,2.415 2.94,0 5.46,-1.785 2.625,-1.89 2.625,-4.62 0,-3.885 -6.195,-6.615 -10.395,-4.62 -11.655,-5.46 -6.405,-4.515 -6.405,-12.285 0,-7.77 5.25,-12.18 5.25,-4.515 12.81,-4.515 3.99,0 8.085,1.365 4.095,1.26 7.14,3.57 l -2.52,9.24 h -2.94 q -0.63,-3.57 -3.57,-6.195 -2.835,-2.625 -6.405,-2.625 -3.15,0 -5.46,1.575 -2.31,1.47 -2.31,4.515 0,3.885 6.405,6.51 10.185,4.095 11.865,5.25 6.405,4.41 6.405,12.81 0,7.455 -5.46,12.18 -5.355,4.62 -14.805,4.62 -8.19,0 -14.49,-4.305 z\" />\n      <path d=\"m 349.61228,-29.925 h 15.54 q 0,-6.51 -1.05,-10.395 -1.68,-6.3 -5.88,-6.3 -5.04,0 -7.14,6.195 -1.47,4.305 -1.47,10.5 z m 30.03,5.04 h -30.03 q 0,9.135 3.045,13.86 3.57,5.67 11.55,5.67 3.255,0 6.405,-1.26 3.15,-1.26 5.88,-3.465 l 1.26,0.945 -2.31,5.88 q -6.72,4.725 -15.015,4.725 -12.915,0 -19.635,-7.245 -6.72,-7.245 -6.72,-20.37 0,-11.235 6.405,-18.165 6.51,-7.035 17.64,-7.035 11.655,0 16.905,7.56 4.62,6.615 4.62,18.9 z\" />\n    </g>\n  )\n}\n","import React, { useEffect, useRef, useState } from 'react'\nimport {\n  Divider,\n  Grow,\n  ListItemIcon,\n  ListItemText,\n  ListSubheader,\n  MenuProps as MUIMenuProps,\n  MenuItem as MUIMenuItem,\n  MenuItemProps,\n  MenuList,\n  Paper,\n  Popover,\n  PopoverProps,\n  SvgIconProps,\n} from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\n// icons\nimport ArrowRightIcon from '@mui/icons-material/ArrowRight'\nimport CheckBoxIcon from '@mui/icons-material/CheckBox'\nimport CheckBoxOutlineBlankIcon from '@mui/icons-material/CheckBoxOutlineBlank'\nimport RadioButtonCheckedIcon from '@mui/icons-material/RadioButtonChecked'\nimport RadioButtonUncheckedIcon from '@mui/icons-material/RadioButtonUnchecked'\n\n// other\nimport { findLastIndex } from '../util'\n\nconst useStyles = makeStyles()({\n  paper: {\n    position: 'fixed',\n    overflowY: 'auto',\n    overflowX: 'hidden',\n    // So we see the popover when it's empty.\n    minWidth: 16,\n    minHeight: 16,\n    maxWidth: 'calc(100% - 32px)',\n    maxHeight: 'calc(100% - 32px)',\n    top: 0,\n    left: 0,\n    // We disable the focus ring for mouse, touch and keyboard users.\n    outline: 0,\n  },\n  menuItemEndDecoration: {\n    padding: 0,\n    margin: 0,\n    height: 16,\n  },\n})\n\ninterface MenuItemEndDecorationSubMenuProps {\n  type: 'subMenu'\n}\n\ninterface MenuItemEndDecorationSelectorProps {\n  type: 'checkbox' | 'radio'\n  checked: boolean\n  disabled?: boolean\n}\n\ntype MenuItemEndDecorationProps =\n  | MenuItemEndDecorationSubMenuProps\n  | MenuItemEndDecorationSelectorProps\n\nexport function MenuItemEndDecoration(props: MenuItemEndDecorationProps) {\n  const { classes } = useStyles()\n  const { type } = props\n  let checked\n  let disabled\n  if ('checked' in props) {\n    ;({ checked, disabled } = props)\n  }\n  let icon\n  switch (type) {\n    case 'subMenu': {\n      icon = <ArrowRightIcon color=\"action\" />\n      break\n    }\n    case 'checkbox': {\n      if (checked) {\n        const color = disabled ? 'inherit' : undefined\n        icon = <CheckBoxIcon color={color} />\n      } else {\n        icon = <CheckBoxOutlineBlankIcon color=\"action\" />\n      }\n      break\n    }\n    case 'radio': {\n      if (checked) {\n        const color = disabled ? 'inherit' : undefined\n        icon = <RadioButtonCheckedIcon color={color} />\n      } else {\n        icon = <RadioButtonUncheckedIcon color=\"action\" />\n      }\n      break\n    }\n    // No default\n  }\n  return <div className={classes.menuItemEndDecoration}>{icon}</div>\n}\n\nexport interface MenuDivider {\n  priority?: number\n  type: 'divider'\n}\n\nexport interface MenuSubHeader {\n  type: 'subHeader'\n  priority?: number\n  label: string\n}\n\nexport interface BaseMenuItem {\n  id?: string // used as react key if provided\n  label: React.ReactNode\n  priority?: number\n  subLabel?: string\n  icon?: React.ComponentType<SvgIconProps>\n  disabled?: boolean\n}\n\nexport interface NormalMenuItem extends BaseMenuItem {\n  type?: 'normal'\n  onClick: Function\n}\n\nexport interface CheckboxMenuItem extends BaseMenuItem {\n  type: 'checkbox'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface RadioMenuItem extends BaseMenuItem {\n  type: 'radio'\n  checked: boolean\n  onClick: Function\n}\n\nexport interface SubMenuItem extends BaseMenuItem {\n  type?: 'subMenu'\n  subMenu: MenuItem[]\n}\n\nexport type MenuItem =\n  | MenuDivider\n  | MenuSubHeader\n  | NormalMenuItem\n  | CheckboxMenuItem\n  | RadioMenuItem\n  | SubMenuItem\n\ntype AnchorElProp = MUIMenuProps['anchorEl']\ntype OpenProp = MUIMenuProps['open']\ntype OnCloseProp = MUIMenuProps['onClose']\n\ninterface MenuPageProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n  anchorEl?: AnchorElProp\n  open: OpenProp\n  onClose: OnCloseProp\n  top?: boolean\n}\n\ntype MenuItemStyleProp = MenuItemProps['style']\n\nfunction checkIfValid(m: MenuItem) {\n  return m.type !== 'divider' && m.type !== 'subHeader' && !m.disabled\n}\nfunction findNextValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  const idx = menuItems.slice(currentIdx + 1).findIndex(checkIfValid)\n  if (idx === -1) {\n    return idx\n  }\n  return currentIdx + 1 + idx\n}\n\nfunction findPreviousValidIdx(menuItems: MenuItem[], currentIdx: number) {\n  return findLastIndex(menuItems.slice(0, currentIdx), checkIfValid)\n}\n\nconst MenuPage = React.forwardRef<HTMLDivElement, MenuPageProps>(\n  function MenuPage2(props, ref) {\n    const [subMenuAnchorEl, setSubMenuAnchorEl] = useState<HTMLElement>()\n    const [openSubMenuIdx, setOpenSubMenuIdx] = useState<number>()\n    const [isSubMenuOpen, setIsSubMenuOpen] = useState(false)\n    const [selectedMenuItemIdx, setSelectedMenuItemIdx] = useState<number>()\n    const [position, setPosition] = useState<{\n      top?: number\n      left?: number\n    }>()\n    const paperRef = useRef<HTMLDivElement | null>(null)\n    const { classes } = useStyles()\n\n    const {\n      menuItems,\n      onMenuItemClick,\n      open,\n      onClose,\n      anchorEl,\n      top = false,\n    } = props\n\n    useEffect(() => {\n      if (!open) {\n        setSubMenuAnchorEl(undefined)\n        setOpenSubMenuIdx(undefined)\n      }\n    }, [open])\n\n    useEffect(() => {\n      const shouldSubMenuBeOpen = open && Boolean(subMenuAnchorEl)\n      let timer: ReturnType<typeof setTimeout>\n      if (shouldSubMenuBeOpen && !isSubMenuOpen) {\n        timer = setTimeout(() => {\n          setIsSubMenuOpen(true)\n        }, 300)\n      } else if (!shouldSubMenuBeOpen && isSubMenuOpen) {\n        timer = setTimeout(() => {\n          setIsSubMenuOpen(false)\n        }, 300)\n      }\n      return () => {\n        clearTimeout(timer)\n      }\n    }, [isSubMenuOpen, open, subMenuAnchorEl])\n\n    useEffect(() => {\n      if (anchorEl) {\n        const rect = (anchorEl as HTMLElement).getBoundingClientRect()\n        if (position) {\n          if (\n            rect.top !== position.top ||\n            rect.left + rect.width !== position.left\n          ) {\n            setPosition({ top: rect.top, left: rect.left + rect.width })\n          }\n        } else {\n          setPosition({ top: rect.top, left: rect.left + rect.width })\n        }\n      } else if (!position) {\n        setPosition({})\n      }\n    }, [position, anchorEl])\n\n    const hasIcon = menuItems.some(\n      menuItem => 'icon' in menuItem && menuItem.icon,\n    )\n    const menuItemStyle: MenuItemStyleProp = {}\n\n    function handleClick(callback: Function) {\n      return (event: React.MouseEvent<HTMLLIElement, MouseEvent>) => {\n        onMenuItemClick(event, callback)\n      }\n    }\n\n    const ListContents = (\n      <>\n        <MenuList autoFocusItem={open && !isSubMenuOpen} dense>\n          {menuItems\n            .sort((a, b) => (b.priority || 0) - (a.priority || 0))\n            .map((menuItem, idx) => {\n              if (menuItem.type === 'divider') {\n                return <Divider key={`divider-${idx}`} component=\"li\" />\n              }\n              if (menuItem.type === 'subHeader') {\n                return (\n                  <ListSubheader key={`subHeader-${menuItem.label}-${idx}`}>\n                    {menuItem.label}\n                  </ListSubheader>\n                )\n              }\n              let icon = null\n              let endDecoration = null\n              if (menuItem.icon) {\n                const Icon = menuItem.icon\n                icon = (\n                  <ListItemIcon>\n                    <Icon />\n                  </ListItemIcon>\n                )\n              }\n              if ('subMenu' in menuItem) {\n                endDecoration = <MenuItemEndDecoration type=\"subMenu\" />\n              } else if (\n                menuItem.type === 'checkbox' ||\n                menuItem.type === 'radio'\n              ) {\n                endDecoration = (\n                  <MenuItemEndDecoration\n                    type={menuItem.type}\n                    checked={menuItem.checked}\n                    disabled={menuItem.disabled}\n                  />\n                )\n              }\n              const onClick =\n                'onClick' in menuItem\n                  ? handleClick(menuItem.onClick)\n                  : undefined\n              return (\n                <MUIMenuItem\n                  key={menuItem.id || String(menuItem.label)}\n                  style={menuItemStyle}\n                  selected={idx === selectedMenuItemIdx}\n                  onClick={onClick}\n                  onMouseMove={e => {\n                    if (e.currentTarget !== document.activeElement) {\n                      e.currentTarget.focus()\n                      setSelectedMenuItemIdx(idx)\n                    }\n                    if ('subMenu' in menuItem) {\n                      if (openSubMenuIdx !== idx) {\n                        setSubMenuAnchorEl(e.currentTarget)\n                        setOpenSubMenuIdx(idx)\n                      }\n                    } else {\n                      setSubMenuAnchorEl(undefined)\n                      setOpenSubMenuIdx(undefined)\n                    }\n                  }}\n                  onKeyDown={e => {\n                    switch (e.key) {\n                      case 'ArrowLeft':\n                      case 'Escape': {\n                        onClose && onClose(e, 'escapeKeyDown')\n\n                        break\n                      }\n                      case 'ArrowUp': {\n                        setSelectedMenuItemIdx(\n                          findPreviousValidIdx(menuItems, idx),\n                        )\n\n                        break\n                      }\n                      case 'ArrowDown': {\n                        const a = findNextValidIdx(menuItems, idx)\n                        setSelectedMenuItemIdx(a)\n\n                        break\n                      }\n                      default: {\n                        if (\n                          'subMenu' in menuItem &&\n                          (e.key === 'ArrowRight' || e.key === 'Enter')\n                        ) {\n                          setSubMenuAnchorEl(e.currentTarget)\n                          setOpenSubMenuIdx(idx)\n                          setIsSubMenuOpen(true)\n                        }\n                      }\n                    }\n                  }}\n                  disabled={Boolean(menuItem.disabled)}\n                >\n                  {icon}\n                  <ListItemText\n                    primary={menuItem.label}\n                    secondary={menuItem.subLabel}\n                    inset={hasIcon && !menuItem.icon}\n                  />\n                  {endDecoration}\n                </MUIMenuItem>\n              )\n            })}\n        </MenuList>\n        {menuItems.map((menuItem, idx) => {\n          let subMenu = null\n          if ('subMenu' in menuItem) {\n            subMenu = (\n              <MenuPage\n                key={menuItem.id || String(menuItem.label)}\n                anchorEl={subMenuAnchorEl}\n                open={isSubMenuOpen && openSubMenuIdx === idx}\n                onClose={() => {\n                  setIsSubMenuOpen(false)\n                  setSubMenuAnchorEl(undefined)\n                }}\n                onMenuItemClick={onMenuItemClick}\n                menuItems={menuItem.subMenu}\n              />\n            )\n          }\n          return subMenu\n        })}\n      </>\n    )\n\n    return top ? (\n      ListContents\n    ) : (\n      <Grow in={open} style={{ transformOrigin: `0 0 0` }} ref={ref}>\n        <Paper\n          elevation={8}\n          ref={paperRef}\n          className={classes.paper}\n          style={{ ...position }}\n        >\n          {ListContents}\n        </Paper>\n      </Grow>\n    )\n  },\n)\n\ninterface MenuProps extends PopoverProps {\n  menuItems: MenuItem[]\n  onMenuItemClick: (\n    event: React.MouseEvent<HTMLLIElement, MouseEvent>,\n    callback: Function,\n  ) => void\n}\n\nfunction Menu(props: MenuProps) {\n  const { open, onClose, menuItems, onMenuItemClick, ...other } = props\n\n  return (\n    <Popover\n      open={open}\n      onClose={onClose}\n      BackdropProps={{ invisible: true }}\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'right',\n        ...other.anchorOrigin,\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: 'left',\n        ...other.transformOrigin,\n      }}\n      {...other}\n    >\n      <MenuPage\n        open={open}\n        onClose={onClose}\n        menuItems={menuItems}\n        onMenuItemClick={onMenuItemClick}\n        top\n      />\n    </Popover>\n  )\n}\n\nexport default Menu\n","import React, { useEffect, useState, useRef } from 'react'\nimport { makeStyles } from 'tss-react/mui'\n\nconst useStyles = makeStyles()({\n  horizontalHandle: {\n    cursor: 'row-resize',\n    width: '100%',\n  },\n  verticalHandle: {\n    cursor: 'col-resize',\n    height: '100%',\n  },\n  flexbox_verticalHandle: {\n    cursor: 'col-resize',\n    alignSelf: 'stretch', // the height: 100% is actually unable to function inside flexbox\n  },\n  flexbox_horizontalHandle: {\n    cursor: 'row-resize',\n    alignSelf: 'stretch', // similar to above\n  },\n})\n\nfunction ResizeHandle({\n  onDrag,\n  vertical = false,\n  flexbox = false,\n  className: originalClassName,\n  onMouseDown,\n  ...props\n}: {\n  onDrag: (lastFrameDistance: number, totalDistance: number) => number | void\n  onMouseDown?: (event: React.MouseEvent) => void\n  vertical?: boolean\n  flexbox?: boolean\n  className?: string\n  [props: string]: unknown\n}) {\n  const [mouseDragging, setMouseDragging] = useState(false)\n  const initialPosition = useRef(0)\n  const prevPos = useRef(0)\n  const { classes, cx } = useStyles()\n\n  useEffect(() => {\n    function mouseMove(event: MouseEvent) {\n      event.preventDefault()\n      const pos = vertical ? event.clientX : event.clientY\n      const totalDistance = initialPosition.current - pos\n      const lastFrameDistance = pos - prevPos.current\n      prevPos.current = pos\n      onDrag(lastFrameDistance, totalDistance)\n    }\n\n    function mouseUp() {\n      setMouseDragging(false)\n    }\n    if (mouseDragging) {\n      window.addEventListener('mousemove', mouseMove, true)\n      window.addEventListener('mouseup', mouseUp, true)\n      return () => {\n        window.removeEventListener('mousemove', mouseMove, true)\n        window.removeEventListener('mouseup', mouseUp, true)\n      }\n    }\n    return () => {}\n  }, [mouseDragging, onDrag, vertical])\n\n  let className\n  if (flexbox) {\n    className = vertical\n      ? classes.flexbox_verticalHandle\n      : classes.flexbox_horizontalHandle\n  } else if (vertical) {\n    className = classes.verticalHandle\n  } else {\n    className = classes.horizontalHandle\n  }\n\n  return (\n    <div\n      data-resizer=\"true\"\n      onMouseDown={event => {\n        event.preventDefault()\n        const pos = vertical ? event.clientX : event.clientY\n        initialPosition.current = pos\n        prevPos.current = pos\n        setMouseDragging(true)\n        onMouseDown?.(event)\n      }}\n      className={cx(className, originalClassName)}\n      {...props}\n    />\n  )\n}\n\nexport default ResizeHandle\n","import React from 'react'\nimport { observer } from 'mobx-react'\nimport { Button, DialogActions, DialogContent, Typography } from '@mui/material'\nimport Dialog from './Dialog'\n\nconst ReturnToImportFormDialog = observer(function ({\n  model,\n  handleClose,\n}: {\n  model: { clearView: () => void }\n  handleClose: () => void\n}) {\n  return (\n    <Dialog maxWidth=\"xl\" open onClose={handleClose} title=\"Reference sequence\">\n      <DialogContent>\n        <Typography>\n          Are you sure you want to return to the import form? This will lose\n          your current view\n        </Typography>\n      </DialogContent>\n      <DialogActions>\n        <Button\n          onClick={() => {\n            model.clearView()\n            handleClose()\n          }}\n          variant=\"contained\"\n          color=\"primary\"\n          autoFocus\n        >\n          OK\n        </Button>\n        <Button\n          onClick={() => handleClose()}\n          color=\"secondary\"\n          variant=\"contained\"\n        >\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nexport default ReturnToImportFormDialog\n","import React from 'react'\nimport escapeHTML from 'escape-html'\nimport dompurify from 'dompurify'\nimport { linkify } from '../util'\n\n// source https://github.com/sindresorhus/html-tags/blob/master/html-tags.json\n// with some random uncommon ones removed. note: we just use this to run the content\n// through dompurify without escaping if we see an htmlTag from this list\n// otherwise we escape angle brackets and things prematurely because it might be\n// something like <TRA> in VCF. Ref #657\nconst htmlTags = [\n  'a',\n  'b',\n  'br',\n  'code',\n  'div',\n  'em',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'i',\n  'img',\n  'li',\n  'p',\n  'pre',\n  'span',\n  'small',\n  'strong',\n  'table',\n  'tbody',\n  'sup',\n  'sub',\n  'td',\n  'tfoot',\n  'th',\n  'thead',\n  'tr',\n  'u',\n  'ul',\n]\n\nlet added = false\n\n// adapted from is-html\n// https://github.com/sindresorhus/is-html/blob/master/index.js\nconst full = new RegExp(htmlTags.map(tag => `<${tag}\\\\b[^>]*>`).join('|'), 'i')\nfunction isHTML(str: string) {\n  return full.test(str)\n}\n\n// note this is mocked during testing, see\n// packages/__mocks__/@jbrowse/core/ui/SanitizedHTML something about dompurify\n// behavior causes errors during tests, was seen in\n// products/jbrowse-web/src/tests/Connection.test.tsx test (can delete mock to\n// see)\n//\nexport default function SanitizedHTML({\n  html: pre,\n  className,\n}: {\n  className?: string\n  html: string\n}) {\n  // try to add links to the text first\n  const html = linkify(pre)\n  const value = isHTML(html) ? html : escapeHTML(html)\n  if (!added) {\n    added = true\n    // see https://github.com/cure53/DOMPurify/issues/317\n    // only have to add this once, and can't do it globally because dompurify\n    // not yet initialized at global scope\n    dompurify.addHook(\n      'afterSanitizeAttributes',\n      (node: {\n        tagName: string\n        setAttribute: (arg0: string, arg1: string) => void\n      }) => {\n        if (node.tagName === 'A') {\n          node.setAttribute('rel', 'noopener noreferrer')\n          node.setAttribute('target', '_blank')\n        }\n      },\n    )\n  }\n\n  return (\n    <span\n      className={className}\n      // eslint-disable-next-line react/no-danger\n      dangerouslySetInnerHTML={{\n        __html: dompurify.sanitize(value),\n      }}\n    />\n  )\n}\n","import { blue, green, red, grey, orange } from '@mui/material/colors'\nimport { createTheme, ThemeOptions } from '@mui/material/styles'\nimport type { PaletteAugmentColorOptions } from '@mui/material/styles/createPalette'\nimport deepmerge from 'deepmerge'\n\ndeclare module '@mui/material/styles/createPalette' {\n  interface Palette {\n    tertiary: Palette['primary']\n    quaternary: Palette['primary']\n    stopCodon?: string\n    startCodon?: string\n    bases: {\n      A: Palette['primary']\n      C: Palette['primary']\n      G: Palette['primary']\n      T: Palette['primary']\n    }\n  }\n  interface PaletteOptions {\n    tertiary?: PaletteOptions['primary']\n    quaternary?: PaletteOptions['primary']\n    stopCodon?: string\n    startCodon?: string\n    bases?: {\n      A?: PaletteOptions['primary']\n      C?: PaletteOptions['primary']\n      G?: PaletteOptions['primary']\n      T?: PaletteOptions['primary']\n    }\n  }\n}\n\nconst midnight = '#0D233F'\nconst grape = '#721E63'\nconst forest = '#135560'\nconst mandarin = '#FFB11D'\n\nconst refTheme = createTheme()\n\nfunction stockTheme() {\n  return {\n    palette: {\n      mode: undefined,\n      primary: { main: midnight },\n      secondary: { main: grape },\n      tertiary: refTheme.palette.augmentColor({ color: { main: forest } }),\n      quaternary: refTheme.palette.augmentColor({ color: { main: mandarin } }),\n      stopCodon: '#e22',\n      startCodon: '#3e3',\n      bases: {\n        A: refTheme.palette.augmentColor({ color: green }),\n        C: refTheme.palette.augmentColor({ color: blue }),\n        G: refTheme.palette.augmentColor({ color: orange }),\n        T: refTheme.palette.augmentColor({ color: red }),\n      },\n    },\n    components: {\n      MuiLink: {\n        styleOverrides: {\n          // the default link color uses theme.palette.primary.main which is\n          // very bad with dark mode+midnight primary\n          //\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          root: ({ theme }: any) => ({\n            color: theme.palette.tertiary.main,\n          }),\n        },\n      },\n    },\n  }\n}\n\nfunction getDefaultTheme() {\n  return {\n    name: 'Default (from config)',\n    ...stockTheme(),\n  }\n}\n\nfunction getLightStockTheme() {\n  return {\n    name: 'Light (stock)',\n    ...stockTheme(),\n  }\n}\n\nfunction getDarkStockTheme() {\n  return {\n    name: 'Dark (stock)',\n    palette: {\n      mode: 'dark',\n      primary: { main: midnight },\n      secondary: { main: grape },\n      tertiary: refTheme.palette.augmentColor({ color: { main: forest } }),\n      quaternary: refTheme.palette.augmentColor({ color: { main: mandarin } }),\n      stopCodon: '#e22',\n      startCodon: '#3e3',\n      bases: {\n        A: refTheme.palette.augmentColor({ color: green }),\n        C: refTheme.palette.augmentColor({ color: blue }),\n        G: refTheme.palette.augmentColor({ color: orange }),\n        T: refTheme.palette.augmentColor({ color: red }),\n      },\n    },\n    components: {\n      MuiAppBar: {\n        defaultProps: {\n          enableColorOnDark: true,\n        },\n        styleOverrides: {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          primary: (props: any) => {\n            return props.theme.palette.primary.main\n          },\n        },\n      },\n    },\n  }\n}\n\nfunction getDarkMinimalTheme() {\n  return {\n    name: 'Dark (minimal)',\n    palette: {\n      mode: 'dark' as const,\n      primary: { main: grey[700] },\n      secondary: { main: grey[800] },\n      tertiary: refTheme.palette.augmentColor({ color: { main: grey[900] } }),\n      quaternary: refTheme.palette.augmentColor({ color: { main: mandarin } }),\n      stopCodon: '#e22',\n      startCodon: '#3e3',\n      bases: {\n        A: refTheme.palette.augmentColor({ color: green }),\n        C: refTheme.palette.augmentColor({ color: blue }),\n        G: refTheme.palette.augmentColor({ color: orange }),\n        T: refTheme.palette.augmentColor({ color: red }),\n      },\n    },\n  }\n}\n\nfunction getMinimalTheme() {\n  return {\n    name: 'Light (minimal)',\n    palette: {\n      primary: { main: grey[900] },\n      secondary: { main: grey[800] },\n      tertiary: refTheme.palette.augmentColor({ color: { main: grey[900] } }),\n      quaternary: refTheme.palette.augmentColor({ color: { main: mandarin } }),\n      stopCodon: '#e22',\n      startCodon: '#3e3',\n      bases: {\n        A: refTheme.palette.augmentColor({ color: green }),\n        C: refTheme.palette.augmentColor({ color: blue }),\n        G: refTheme.palette.augmentColor({ color: orange }),\n        T: refTheme.palette.augmentColor({ color: red }),\n      },\n    },\n  }\n}\n\nexport const defaultThemes = {\n  default: getDefaultTheme(),\n  lightStock: getLightStockTheme(),\n  lightMinimal: getMinimalTheme(),\n  darkMinimal: getDarkMinimalTheme(),\n  darkStock: getDarkStockTheme(),\n} as ThemeMap\n\nfunction createDefaultProps(theme?: ThemeOptions): ThemeOptions {\n  return {\n    components: {\n      MuiButton: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n        styleOverrides: {\n          // the default button, especially when not using variant=contained, uses\n          // theme.palette.primary.main for text which is very bad with dark\n          // mode+midnight primary\n          //\n          // keeps text secondary for darkmode, uses\n          // a text-like coloring to ensure contrast\n          // xref https://stackoverflow.com/a/72546130/2129219\n          //\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          root: (props: any) => {\n            const { theme } = props\n            return theme.palette.mode === 'dark'\n              ? {\n                  color: theme.palette.text.primary,\n                }\n              : undefined\n          },\n        },\n      },\n      MuiAccordion: {\n        defaultProps: {\n          disableGutters: true,\n          TransitionProps: { timeout: 150 },\n        },\n      },\n      MuiFilledInput: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiFormControl: {\n        defaultProps: {\n          margin: 'dense' as const,\n          size: 'small' as const,\n        },\n      },\n      MuiFormHelperText: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n\n      MuiIconButton: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiInputBase: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiAutocomplete: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiInputLabel: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiToolbar: {\n        defaultProps: {\n          variant: 'dense' as const,\n        },\n      },\n      MuiListItem: {\n        defaultProps: {\n          dense: true,\n        },\n      },\n      MuiOutlinedInput: {\n        defaultProps: {\n          margin: 'dense' as const,\n        },\n      },\n      MuiFab: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n        styleOverrides: {\n          secondary: {\n            // @ts-expect-error\n            backgroundColor: theme?.palette?.quaternary?.main,\n          },\n        },\n      },\n      MuiTable: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n      MuiPopover: {\n        defaultProps: {\n          transitionDuration: 0,\n        },\n      },\n      MuiMenu: {\n        defaultProps: {\n          transitionDuration: 0,\n        },\n      },\n      MuiMenuItem: {\n        defaultProps: {\n          dense: true,\n        },\n      },\n\n      MuiTextField: {\n        defaultProps: {\n          margin: 'dense' as const,\n          variant: 'standard' as const,\n        },\n      },\n      MuiLink: {\n        styleOverrides: {\n          // the default link color uses theme.palette.primary.main which is\n          // very bad with dark mode+midnight primary\n          root: ({ theme }) => ({\n            color: theme.palette.text.secondary,\n          }),\n        },\n      },\n      MuiCheckbox: {\n        styleOverrides: {\n          // the default checkbox-when-checked color uses\n          // theme.palette.primary.main which is very bad with dark\n          // mode+midnight primary\n          //\n          // keeps the forest-green checkbox by default but for darkmode, uses\n          // a text-like coloring to ensure contrast\n          // xref https://stackoverflow.com/a/72546130/2129219\n          root: ({ theme }) => {\n            return theme.palette.mode === 'dark'\n              ? {\n                  color: theme.palette.text.secondary,\n                  '&.Mui-checked': {\n                    color: theme.palette.text.secondary,\n                  },\n                }\n              : undefined\n          },\n        },\n      },\n      MuiRadio: {\n        styleOverrides: {\n          // the default checkbox-when-checked color uses\n          // theme.palette.primary.main which is very bad with dark\n          // mode+midnight primary\n          //\n          // keeps the forest-green checkbox by default but for darkmode, uses\n          // a text-like coloring to ensure contrast\n          // xref https://stackoverflow.com/a/72546130/2129219\n          root: ({ theme }) => {\n            return theme.palette.mode === 'dark'\n              ? {\n                  color: theme.palette.text.secondary,\n                  '&.Mui-checked': {\n                    color: theme.palette.text.secondary,\n                  },\n                }\n              : undefined\n          },\n        },\n      },\n      MuiFormLabel: {\n        styleOverrides: {\n          // the default checkbox-when-checked color uses\n          // theme.palette.primary.main which is very bad with dark\n          // mode+midnight primary\n          //\n          // keeps the forest-green checkbox by default but for darkmode, uses\n          // a text-like coloring to ensure contrast\n          // xref https://stackoverflow.com/a/72546130/2129219\n          //\n\n          root: ({ theme }) => {\n            return theme.palette.mode === 'dark'\n              ? {\n                  color: theme.palette.text.secondary,\n                  '&.Mui-focused': {\n                    color: theme.palette.text.secondary,\n                  },\n                }\n              : undefined\n          },\n        },\n      },\n      MuiAccordionSummary: {\n        styleOverrides: {\n          root: {\n            // @ts-expect-error\n            backgroundColor: theme?.palette?.tertiary?.main,\n          },\n          content: {\n            // @ts-expect-error\n            color: theme?.palette?.tertiary?.contrastText,\n          },\n        },\n      },\n      MuiToggleButtonGroup: {\n        defaultProps: {\n          size: 'small' as const,\n        },\n      },\n    },\n  }\n}\n\nexport function createJBrowseBaseTheme(theme?: ThemeOptions): ThemeOptions {\n  return deepmerge(\n    {\n      palette: theme?.palette,\n      typography: { fontSize: 12 },\n      spacing: 4,\n      ...createDefaultProps(theme),\n    },\n    theme || {},\n  )\n}\n\ntype ThemeMap = Record<string, ThemeOptions>\n\nexport function createJBrowseTheme(\n  configTheme: ThemeOptions = {},\n  themes = defaultThemes,\n  themeName = 'default',\n) {\n  return createTheme(\n    createJBrowseBaseTheme(\n      themeName === 'default'\n        ? deepmerge(themes.default, augmentTheme(configTheme))\n        : augmentThemePlus(themes[themeName]) || themes.default,\n    ),\n  )\n}\n\nfunction augmentTheme(theme: ThemeOptions = {}) {\n  if (theme?.palette?.tertiary) {\n    theme = deepmerge(theme, {\n      palette: {\n        tertiary: refTheme.palette.augmentColor(\n          'color' in theme.palette.tertiary\n            ? (theme.palette.tertiary as PaletteAugmentColorOptions)\n            : { color: theme.palette.tertiary },\n        ),\n      },\n    })\n  }\n\n  if (theme?.palette?.quaternary) {\n    theme = deepmerge(theme, {\n      palette: {\n        quaternary: refTheme.palette.augmentColor(\n          'color' in theme.palette.quaternary\n            ? (theme.palette.quaternary as PaletteAugmentColorOptions)\n            : { color: theme.palette.quaternary },\n        ),\n      },\n    })\n  }\n\n  return theme\n}\n\n// creates some blank quaternary/tertiary colors if unsupplied by a user theme\nfunction augmentThemePlus(theme: ThemeOptions = {}) {\n  theme = augmentTheme(theme)\n  if (!theme?.palette?.quaternary) {\n    theme = deepmerge(theme, {\n      palette: {\n        quaternary: refTheme.palette.augmentColor({ color: { main: '#aaa' } }),\n      },\n    })\n  }\n  if (!theme?.palette?.tertiary) {\n    theme = deepmerge(theme, {\n      palette: {\n        tertiary: refTheme.palette.augmentColor({ color: { main: '#aaa' } }),\n      },\n    })\n  }\n  return theme\n}\n","import React, { useCallback, useEffect, useState } from 'react'\nimport { observer } from 'mobx-react'\nimport {\n  Box,\n  FormHelperText,\n  InputLabel,\n  Menu,\n  MenuItem,\n  Tooltip,\n  ToggleButtonGroup,\n  ToggleButton,\n  ToggleButtonProps,\n} from '@mui/material'\n\n// locals\nimport {\n  FileLocation,\n  AbstractRootModel,\n  isUriLocation,\n  isAppRootModel,\n} from '../../util/types'\nimport LocalFileChooser from './LocalFileChooser'\nimport UrlChooser from './UrlChooser'\n\n// icons\nimport ArrowDropDownIcon from '@mui/icons-material/ArrowDropDown'\nimport { notEmpty } from '../../util'\n\nfunction ToggleButtonWithTooltip(props: ToggleButtonProps) {\n  const { title, children, ...other } = props\n  return (\n    <Tooltip title={title || ''}>\n      <ToggleButton {...other}>{children}</ToggleButton>\n    </Tooltip>\n  )\n}\n\nfunction shorten(str: string, len: number) {\n  if (typeof str === 'string' && str.length > len) {\n    return `${str.slice(0, Math.max(0, len))}…`\n  }\n  return str\n}\n\nconst FileSelector = observer(function (props: {\n  location?: FileLocation\n  setLocation: (param: FileLocation) => void\n  setName?: (str: string) => void\n  name?: string\n  description?: string\n  rootModel?: AbstractRootModel\n}) {\n  const { location, name, description, rootModel, setLocation } = props\n  const fileOrUrl = !location || isUriLocation(location) ? 'url' : 'file'\n  const [toggleButtonValue, setToggleButtonValue] = useState(\n    location && 'internetAccountId' in location && location.internetAccountId\n      ? location.internetAccountId\n      : fileOrUrl,\n  )\n  const accts = isAppRootModel(rootModel) ? [...rootModel.internetAccounts] : []\n  const numShown = 2\n  const [shownAccts, setShownAccts] = useState(accts.slice(0, numShown))\n  const [hiddenAccts, setHiddenAccts] = useState(accts.slice(numShown))\n  const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null)\n\n  const selectedAcct = accts.find(\n    i => i.internetAccountId === toggleButtonValue,\n  )\n\n  const setLocationWithAcct = useCallback(\n    (location: FileLocation) => {\n      setLocation({\n        ...location,\n        ...(isUriLocation(location)\n          ? { internetAccountId: selectedAcct?.internetAccountId }\n          : {}),\n      })\n    },\n    [setLocation, selectedAcct],\n  )\n\n  useEffect(() => {\n    // if you swap account selection after inputting url\n    if (\n      selectedAcct &&\n      isUriLocation(location) &&\n      location.internetAccountId !== selectedAcct.internetAccountId\n    ) {\n      setLocationWithAcct(location)\n    }\n  }, [location, selectedAcct, setLocationWithAcct])\n\n  let locationInput = (\n    <UrlChooser\n      {...props}\n      setLocation={setLocationWithAcct}\n      label={selectedAcct?.selectorLabel}\n    />\n  )\n  if (toggleButtonValue === 'file') {\n    locationInput = <LocalFileChooser {...props} />\n  }\n  if (selectedAcct?.SelectorComponent) {\n    const { SelectorComponent } = selectedAcct\n    locationInput = (\n      <SelectorComponent {...props} setLocation={setLocationWithAcct} />\n    )\n  }\n\n  return (\n    <>\n      <Box display=\"flex\">\n        <InputLabel shrink>{name}</InputLabel>\n      </Box>\n      <Box display=\"flex\" flexDirection=\"row\">\n        <Box>\n          <ToggleButtonGroup\n            value={toggleButtonValue}\n            exclusive\n            onChange={(_event, newState) => {\n              if (newState) {\n                setToggleButtonValue(newState)\n              }\n              if (isUriLocation(location)) {\n                setLocationWithAcct(location)\n              }\n            }}\n            aria-label=\"file, url, or account picker\"\n          >\n            {new URLSearchParams(window.location.search).get(\n              'adminKey',\n            ) ? null : (\n              <ToggleButton value=\"file\" aria-label=\"local file\">\n                File\n              </ToggleButton>\n            )}\n            <ToggleButton value=\"url\" aria-label=\"url\">\n              URL\n            </ToggleButton>\n            {shownAccts.map(({ internetAccountId, toggleContents, name }) => (\n              <ToggleButtonWithTooltip\n                key={internetAccountId}\n                value={internetAccountId}\n                aria-label={name}\n                title={name}\n              >\n                {typeof toggleContents === 'string'\n                  ? shorten(toggleContents, 5)\n                  : toggleContents || shorten(name, 5)}\n              </ToggleButtonWithTooltip>\n            ))}\n            {hiddenAccts.length > 0 ? (\n              // @ts-expect-error\n              <ToggleButton\n                onClick={event => setAnchorEl(event.target as HTMLElement)}\n                selected={false}\n              >\n                More\n                <ArrowDropDownIcon />\n              </ToggleButton>\n            ) : null}\n          </ToggleButtonGroup>\n\n          <Menu\n            open={Boolean(anchorEl)}\n            anchorEl={anchorEl}\n            onClose={() => setAnchorEl(null)}\n            anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n            transformOrigin={{ vertical: 'top', horizontal: 'center' }}\n          >\n            {hiddenAccts?.map((acct, idx) => (\n              <MenuItem\n                key={acct.internetAccountId}\n                value={acct.internetAccountId}\n                onClick={() => {\n                  const prev = shownAccts.at(-1)\n                  setShownAccts([...shownAccts.slice(0, -1), acct])\n                  setHiddenAccts(\n                    [\n                      prev,\n                      ...hiddenAccts.slice(0, idx),\n                      ...hiddenAccts.slice(idx + 1),\n                    ].filter(notEmpty),\n                  )\n                  setToggleButtonValue(acct.internetAccountId)\n                  setAnchorEl(null)\n                }}\n              >\n                {acct.name}\n              </MenuItem>\n            ))}\n          </Menu>\n        </Box>\n      </Box>\n      {locationInput}\n      <FormHelperText>{description}</FormHelperText>\n    </>\n  )\n})\n\nexport default FileSelector\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport React, { useState, useRef, useEffect } from 'react'\nimport { drawImageOntoCanvasContext } from '../util/offscreenCanvasPonyfill'\n\nfunction PrerenderedCanvas(props: {\n  width: number\n  height: number\n  highResolutionScaling?: number\n  style?: any\n  imageData?: any\n  showSoftClip?: boolean\n  blockKey?: string\n}) {\n  const {\n    width,\n    height,\n    highResolutionScaling = 1,\n    style = {},\n    imageData,\n    blockKey,\n    showSoftClip,\n  } = props\n  const [done, setDone] = useState(false)\n\n  const featureCanvas = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    if (!imageData) {\n      return\n    }\n    const canvas = featureCanvas.current\n    if (!canvas) {\n      return\n    }\n    const context = canvas.getContext('2d')\n    if (!context) {\n      return\n    }\n    drawImageOntoCanvasContext(imageData, context)\n    setDone(true)\n  }, [imageData])\n\n  const softClipString = showSoftClip ? '_softclipped' : ''\n  const blockKeyStr = blockKey ? '_' + blockKey : ''\n  const testId = `prerendered_canvas${softClipString}${blockKeyStr}${\n    done ? '_done' : ''\n  }`\n  return (\n    <canvas\n      data-testid={testId}\n      ref={featureCanvas}\n      width={width * highResolutionScaling}\n      height={height * highResolutionScaling}\n      style={{ width, height, ...style }}\n    />\n  )\n}\n\nexport default PrerenderedCanvas\n","import React, { useEffect, useState } from 'react'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { Feature } from '../util'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nconst useStyles = makeStyles()({\n  hoverLabel: {\n    border: '1px solid black',\n    position: 'absolute',\n    background: '#fffa',\n    pointerEvents: 'none',\n    zIndex: 10000,\n  },\n})\n\nconst Tooltip = observer(function ({\n  offsetX,\n  offsetY,\n  configuration,\n  feature,\n  timeout = 300,\n}: {\n  offsetX: number\n  offsetY: number\n  configuration: AnyConfigurationModel\n  feature?: Feature\n  timeout?: number\n}) {\n  const { classes } = useStyles()\n  const [shown, setShown] = useState(false)\n  useEffect(() => {\n    // only show the loading message after short timeout to prevent excessive\n    // flickering\n    const handle = setTimeout(() => setShown(true), timeout)\n    return () => clearTimeout(handle)\n  })\n  if (feature && shown) {\n    const text = readConfObject(configuration, 'mouseover', { feature })\n    return (\n      <div\n        className={classes.hoverLabel}\n        style={{ left: offsetX, top: offsetY }}\n      >\n        {text}\n      </div>\n    )\n  }\n  return null\n})\n\nexport default Tooltip\n","// vendored from quick-lru@6.1.1, didn't like being compiled as a 'pure-esm' nodejs dependency\n// the license is reproduced below https://github.com/sindresorhus/quick-lru/blob/main/license\n// MIT License\n\n// Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\nexport default class QuickLRU extends Map {\n  constructor(options = {}) {\n    super()\n\n    if (!(options.maxSize && options.maxSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    if (typeof options.maxAge === 'number' && options.maxAge === 0) {\n      throw new TypeError('`maxAge` must be a number greater than 0')\n    }\n\n    // TODO: Use private class fields when ESLint supports them.\n    this.maxSize = options.maxSize\n    this.maxAge = options.maxAge || Number.POSITIVE_INFINITY\n    this.onEviction = options.onEviction\n    this.cache = new Map()\n    this.oldCache = new Map()\n    this._size = 0\n  }\n\n  // TODO: Use private class methods when targeting Node.js 16.\n  _emitEvictions(cache) {\n    if (typeof this.onEviction !== 'function') {\n      return\n    }\n\n    for (const [key, item] of cache) {\n      this.onEviction(key, item.value)\n    }\n  }\n\n  _deleteIfExpired(key, item) {\n    if (typeof item.expiry === 'number' && item.expiry <= Date.now()) {\n      if (typeof this.onEviction === 'function') {\n        this.onEviction(key, item.value)\n      }\n\n      return this.delete(key)\n    }\n\n    return false\n  }\n\n  _getOrDeleteIfExpired(key, item) {\n    const deleted = this._deleteIfExpired(key, item)\n    if (deleted === false) {\n      return item.value\n    }\n  }\n\n  _getItemValue(key, item) {\n    return item.expiry ? this._getOrDeleteIfExpired(key, item) : item.value\n  }\n\n  _peek(key, cache) {\n    const item = cache.get(key)\n\n    return this._getItemValue(key, item)\n  }\n\n  _set(key, value) {\n    this.cache.set(key, value)\n    this._size++\n\n    if (this._size >= this.maxSize) {\n      this._size = 0\n      this._emitEvictions(this.oldCache)\n      this.oldCache = this.cache\n      this.cache = new Map()\n    }\n  }\n\n  _moveToRecent(key, item) {\n    this.oldCache.delete(key)\n    this._set(key, item)\n  }\n\n  *_entriesAscending() {\n    for (const item of this.oldCache) {\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield item\n        }\n      }\n    }\n\n    for (const item of this.cache) {\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield item\n      }\n    }\n  }\n\n  get(key) {\n    if (this.cache.has(key)) {\n      const item = this.cache.get(key)\n\n      return this._getItemValue(key, item)\n    }\n\n    if (this.oldCache.has(key)) {\n      const item = this.oldCache.get(key)\n      if (this._deleteIfExpired(key, item) === false) {\n        this._moveToRecent(key, item)\n        return item.value\n      }\n    }\n  }\n\n  set(key, value, { maxAge = this.maxAge } = {}) {\n    const expiry =\n      typeof maxAge === 'number' && maxAge !== Number.POSITIVE_INFINITY\n        ? Date.now() + maxAge\n        : undefined\n    if (this.cache.has(key)) {\n      this.cache.set(key, {\n        value,\n        expiry,\n      })\n    } else {\n      this._set(key, { value, expiry })\n    }\n  }\n\n  has(key) {\n    if (this.cache.has(key)) {\n      return !this._deleteIfExpired(key, this.cache.get(key))\n    }\n\n    if (this.oldCache.has(key)) {\n      return !this._deleteIfExpired(key, this.oldCache.get(key))\n    }\n\n    return false\n  }\n\n  peek(key) {\n    if (this.cache.has(key)) {\n      return this._peek(key, this.cache)\n    }\n\n    if (this.oldCache.has(key)) {\n      return this._peek(key, this.oldCache)\n    }\n  }\n\n  delete(key) {\n    const deleted = this.cache.delete(key)\n    if (deleted) {\n      this._size--\n    }\n\n    return this.oldCache.delete(key) || deleted\n  }\n\n  clear() {\n    this.cache.clear()\n    this.oldCache.clear()\n    this._size = 0\n  }\n\n  resize(newSize) {\n    if (!(newSize && newSize > 0)) {\n      throw new TypeError('`maxSize` must be a number greater than 0')\n    }\n\n    const items = [...this._entriesAscending()]\n    const removeCount = items.length - newSize\n    if (removeCount < 0) {\n      this.cache = new Map(items)\n      this.oldCache = new Map()\n      this._size = items.length\n    } else {\n      if (removeCount > 0) {\n        this._emitEvictions(items.slice(0, removeCount))\n      }\n\n      this.oldCache = new Map(items.slice(removeCount))\n      this.cache = new Map()\n      this._size = 0\n    }\n\n    this.maxSize = newSize\n  }\n\n  *keys() {\n    for (const [key] of this) {\n      yield key\n    }\n  }\n\n  *values() {\n    for (const [, value] of this) {\n      yield value\n    }\n  }\n\n  *[Symbol.iterator]() {\n    for (const item of this.cache) {\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield [key, value.value]\n      }\n    }\n\n    for (const item of this.oldCache) {\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield [key, value.value]\n        }\n      }\n    }\n  }\n\n  *entriesDescending() {\n    let items = [...this.cache]\n    for (let i = items.length - 1; i >= 0; --i) {\n      const item = items[i]\n      const [key, value] = item\n      const deleted = this._deleteIfExpired(key, value)\n      if (deleted === false) {\n        yield [key, value.value]\n      }\n    }\n\n    items = [...this.oldCache]\n    for (let i = items.length - 1; i >= 0; --i) {\n      const item = items[i]\n      const [key, value] = item\n      if (!this.cache.has(key)) {\n        const deleted = this._deleteIfExpired(key, value)\n        if (deleted === false) {\n          yield [key, value.value]\n        }\n      }\n    }\n  }\n\n  *entriesAscending() {\n    for (const [key, value] of this._entriesAscending()) {\n      yield [key, value.value]\n    }\n  }\n\n  get size() {\n    if (!this._size) {\n      return this.oldCache.size\n    }\n\n    let oldCacheSize = 0\n    for (const key of this.oldCache.keys()) {\n      if (!this.cache.has(key)) {\n        oldCacheSize++\n      }\n    }\n\n    return Math.min(this._size + oldCacheSize, this.maxSize)\n  }\n\n  entries() {\n    return this.entriesAscending()\n  }\n\n  forEach(callbackFunction, thisArgument = this) {\n    for (const [key, value] of this.entriesAscending()) {\n      callbackFunction.call(thisArgument, value, key, this)\n    }\n  }\n\n  get [Symbol.toStringTag]() {\n    return JSON.stringify([...this.entriesAscending()])\n  }\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { useEffect, useRef, useState } from 'react'\nimport isObject from 'is-object'\nimport PluginManager from '../PluginManager'\nimport {\n  addDisposer,\n  getParent,\n  getSnapshot,\n  getEnv as getEnvMST,\n  isAlive,\n  isStateTreeNode,\n  hasParent,\n  IAnyStateTreeNode,\n  IStateTreeNode,\n  Instance,\n} from 'mobx-state-tree'\nimport { reaction, IReactionPublic, IReactionOptions } from 'mobx'\nimport { Feature } from './simpleFeature'\nimport {\n  isSessionModel,\n  isDisplayModel,\n  isViewModel,\n  isTrackModel,\n  AssemblyManager,\n  Region,\n  TypeTestedByPredicate,\n} from './types'\nimport { Region as MUIRegion } from './types/mst'\nimport { isAbortException, checkAbortSignal } from './aborting'\nimport { BaseBlock } from './blockTypes'\nimport { isUriLocation } from './types'\n\n// has to be the full path and not the relative path to get the jest mock\nimport useMeasure from '@jbrowse/core/util/useMeasure'\nimport { colord } from './colord'\nexport * from './types'\nexport * from './aborting'\nexport * from './when'\nexport * from './range'\nexport * from './dedupe'\n\nexport * from './offscreenCanvasPonyfill'\nexport * from './offscreenCanvasUtils'\n\nexport function useDebounce<T>(value: T, delay: number) {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(() => {\n    const handle = setTimeout(() => {\n      setDebouncedValue(value)\n    }, delay)\n    return () => {\n      clearTimeout(handle)\n    }\n  }, [value, delay])\n\n  return debouncedValue\n}\n\n// used in ViewContainer files to get the width\nexport function useWidthSetter(\n  view: { setWidth: (arg: number) => void },\n  padding: string,\n) {\n  const [ref, { width }] = useMeasure()\n  useEffect(() => {\n    if (width && isAlive(view)) {\n      // sets after a requestAnimationFrame\n      // https://stackoverflow.com/a/58701523/2129219\n      // avoids ResizeObserver loop error being shown during development\n      requestAnimationFrame(() =>\n        view.setWidth(width - Number.parseInt(padding, 10) * 2),\n      )\n    }\n  }, [padding, view, width])\n  return ref\n}\n\n// https://stackoverflow.com/questions/56283920/\nexport function useDebouncedCallback<T>(\n  callback: (...args: T[]) => void,\n  wait = 400,\n) {\n  // track args & timeout handle between calls\n  const argsRef = useRef<T[]>()\n  const timeout = useRef<ReturnType<typeof setTimeout>>()\n\n  function cleanup() {\n    if (timeout.current) {\n      clearTimeout(timeout.current)\n    }\n  }\n\n  // make sure our timeout gets cleared if our consuming component gets\n  // unmounted\n  useEffect(() => cleanup, [])\n\n  return function debouncedCallback(...args: T[]) {\n    // capture latest args\n    argsRef.current = args\n\n    // clear debounce timer\n    cleanup()\n\n    // start waiting again\n    timeout.current = setTimeout(() => {\n      if (argsRef.current) {\n        callback(...argsRef.current)\n      }\n    }, wait)\n  }\n}\n\n/**\n * find the first node in the hierarchy that matches the given predicate\n */\nexport function findParentThat(\n  node: IAnyStateTreeNode,\n  predicate: (thing: IAnyStateTreeNode) => boolean,\n) {\n  if (!hasParent(node)) {\n    throw new Error('node does not have parent')\n  }\n  let currentNode: IAnyStateTreeNode | undefined = getParent<any>(node)\n  while (currentNode && isAlive(currentNode)) {\n    if (predicate(currentNode)) {\n      return currentNode\n    }\n    if (hasParent(currentNode)) {\n      currentNode = getParent<any>(currentNode)\n    } else {\n      break\n    }\n  }\n  throw new Error('no matching node found')\n}\n\ninterface Animation {\n  lastPosition: number\n  lastTime?: number\n  lastVelocity?: number\n}\n\n// based on https://github.com/react-spring/react-spring/blob/cd5548a987383b8023efd620f3726a981f9e18ea/src/animated/FrameLoop.ts\nexport function springAnimate(\n  fromValue: number,\n  toValue: number,\n  setValue: (value: number) => void,\n  onFinish = () => {},\n  precision = 0,\n  tension = 170,\n  friction = 26,\n) {\n  const mass = 1\n  if (!precision) {\n    precision = Math.abs(toValue - fromValue) / 1000\n  }\n\n  let animationFrameId: number\n\n  function update(animation: Animation) {\n    const time = Date.now()\n    let position = animation.lastPosition\n    let lastTime = animation.lastTime || time\n    let velocity = animation.lastVelocity || 0\n    // If we lost a lot of frames just jump to the end.\n    if (time > lastTime + 64) {\n      lastTime = time\n    }\n    // http://gafferongames.com/game-physics/fix-your-timestep/\n    const numSteps = Math.floor(time - lastTime)\n    for (let i = 0; i < numSteps; ++i) {\n      const force = -tension * (position - toValue)\n      const damping = -friction * velocity\n      const acceleration = (force + damping) / mass\n      velocity += (acceleration * 1) / 1000\n      position += (velocity * 1) / 1000\n    }\n    const isVelocity = Math.abs(velocity) <= precision\n    const isDisplacement =\n      tension !== 0 ? Math.abs(toValue - position) <= precision : true\n    const endOfAnimation = isVelocity && isDisplacement\n    if (endOfAnimation) {\n      setValue(toValue)\n      onFinish()\n    } else {\n      setValue(position)\n      animationFrameId = requestAnimationFrame(() =>\n        update({\n          lastPosition: position,\n          lastTime: time,\n          lastVelocity: velocity,\n        }),\n      )\n    }\n  }\n\n  return [\n    () => update({ lastPosition: fromValue }),\n    () => cancelAnimationFrame(animationFrameId),\n  ]\n}\n\n/**\n * find the first node in the hierarchy that matches the given 'is' typescript\n * type guard predicate\n */\nexport function findParentThatIs<T extends (a: IAnyStateTreeNode) => boolean>(\n  node: IAnyStateTreeNode,\n  predicate: T,\n): TypeTestedByPredicate<T> {\n  return findParentThat(node, predicate)\n}\n\n/**\n * get the current JBrowse session model, starting at any node in the state\n * tree\n */\nexport function getSession(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isSessionModel)\n  } catch (e) {\n    throw new Error('no session model found!')\n  }\n}\n\n/**\n * get the state model of the view in the state tree that contains the given\n * node\n */\nexport function getContainingView(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isViewModel)\n  } catch (e) {\n    throw new Error('no containing view found')\n  }\n}\n\n/**\n * get the state model of the view in the state tree that contains the given\n * node\n */\nexport function getContainingTrack(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isTrackModel)\n  } catch (e) {\n    throw new Error('no containing track found')\n  }\n}\n\n/**\n * get the state model of the display in the state tree that contains the given\n * node\n */\nexport function getContainingDisplay(node: IAnyStateTreeNode) {\n  try {\n    return findParentThatIs(node, isDisplayModel)\n  } catch (e) {\n    throw new Error('no containing display found')\n  }\n}\n\n/**\n * Assemble a 1-based \"locString\" from an interbase genomic location\n * @param region - Region\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 100 })\n * // ↳ 'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 })\n * // ↳ '{hg19}chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1' })\n * // ↳ 'chr1'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0 })\n * // ↳ 'chr1:1..'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', end: 100 })\n * // ↳ 'chr1:1..100'\n * ```\n * @example\n * ```ts\n * assembleLocString({ refName: 'chr1', start: 0, end: 1 })\n * // ↳ 'chr1:1'\n * ```\n */\nexport function assembleLocString(region: ParsedLocString) {\n  return assembleLocStringFast(region, toLocale)\n}\n\n// same as assembleLocString above, but does not perform toLocaleString which\n// can slow down the speed of block calculations which use assembleLocString\n// for block.key\nexport function assembleLocStringFast(\n  region: ParsedLocString,\n  cb = (n: number): string | number => n,\n) {\n  const { assemblyName, refName, start, end, reversed } = region\n  const assemblyNameString = assemblyName ? `{${assemblyName}}` : ''\n  let startString\n  if (start !== undefined) {\n    startString = `:${cb(start + 1)}`\n  } else if (end !== undefined) {\n    startString = ':1'\n  } else {\n    startString = ''\n  }\n  let endString\n  if (end !== undefined) {\n    endString = start !== undefined && start + 1 === end ? '' : `..${cb(end)}`\n  } else {\n    endString = start !== undefined ? '..' : ''\n  }\n  let rev = ''\n  if (reversed) {\n    rev = '[rev]'\n  }\n  return `${assemblyNameString}${refName}${startString}${endString}${rev}`\n}\n\nexport interface ParsedLocString {\n  assemblyName?: string\n  refName: string\n  start?: number\n  end?: number\n  reversed?: boolean\n}\n\nexport function parseLocStringOneBased(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n): ParsedLocString {\n  if (!locString) {\n    throw new Error('no location string provided, could not parse')\n  }\n  let reversed = false\n  if (locString.endsWith('[rev]')) {\n    reversed = true\n    locString = locString.replace(/\\[rev]$/, '')\n  }\n  // remove any whitespace\n  locString = locString.replace(/\\s/, '')\n  // refNames can have colons, ref https://samtools.github.io/hts-specs/SAMv1.pdf Appendix A\n  const assemblyMatch = locString.match(/({(.+)})?(.+)/)\n  if (!assemblyMatch) {\n    throw new Error(`invalid location string: \"${locString}\"`)\n  }\n  const [, , assemblyName, location] = assemblyMatch\n  if (!assemblyName && location.startsWith('{}')) {\n    throw new Error(`no assembly name was provided in location \"${location}\"`)\n  }\n  const lastColonIdx = location.lastIndexOf(':')\n  if (lastColonIdx === -1) {\n    if (isValidRefName(location, assemblyName)) {\n      return { assemblyName, refName: location, reversed }\n    }\n    throw new Error(`Unknown reference sequence \"${location}\"`)\n  }\n  const prefix = location.slice(0, lastColonIdx)\n  const suffix = location.slice(lastColonIdx + 1)\n  if (\n    isValidRefName(prefix, assemblyName) &&\n    isValidRefName(location, assemblyName)\n  ) {\n    throw new Error(`ambiguous location string: \"${locString}\"`)\n  } else if (isValidRefName(prefix, assemblyName)) {\n    if (suffix) {\n      // see if it's a range\n      const rangeMatch = suffix.match(\n        /^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)(-?(\\d+|\\d{1,3}(,\\d{3})*))$/,\n      )\n      // see if it's a single point\n      const singleMatch = suffix.match(/^(-?(\\d+|\\d{1,3}(,\\d{3})*))(\\.\\.|-)?$/)\n      if (rangeMatch) {\n        const [, start, , , , end] = rangeMatch\n        if (start !== undefined && end !== undefined) {\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replaceAll(',', ''),\n            end: +end.replaceAll(',', ''),\n            reversed,\n          }\n        }\n      } else if (singleMatch) {\n        const [, start, , , separator] = singleMatch\n        if (start !== undefined) {\n          if (separator) {\n            // indefinite end\n            return {\n              assemblyName,\n              refName: prefix,\n              start: +start.replaceAll(',', ''),\n              reversed,\n            }\n          }\n          return {\n            assemblyName,\n            refName: prefix,\n            start: +start.replaceAll(',', ''),\n            end: +start.replaceAll(',', ''),\n            reversed,\n          }\n        }\n      } else {\n        throw new Error(\n          `could not parse range \"${suffix}\" on location \"${locString}\"`,\n        )\n      }\n    } else {\n      return { assemblyName, refName: prefix, reversed }\n    }\n  } else if (isValidRefName(location, assemblyName)) {\n    return { assemblyName, refName: location, reversed }\n  }\n  throw new Error(`unknown reference sequence name in location \"${locString}\"`)\n}\n\n/**\n * Parse a 1-based location string into an interbase genomic location\n * @param locString - Location string\n * @param isValidRefName - Function that checks if a refName exists in the set\n * of all known refNames, or in the set of refNames for an assembly if\n * assemblyName is given\n * @example\n * ```ts\n * parseLocString('chr1:1..100', isValidRefName)\n * // ↳ { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1-100', isValidRefName)\n * // ↳ { refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString(`{hg19}chr1:1..100`, isValidRefName)\n * // ↳ { assemblyName: 'hg19', refName: 'chr1', start: 0, end: 100 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1', isValidRefName)\n * // ↳ { refName: 'chr1' }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1', isValidRefName)\n * // ↳ { refName: 'chr1', start: 0, end: 1 }\n * ```\n * @example\n * ```ts\n * parseLocString('chr1:1..', isValidRefName)\n * // ↳ { refName: 'chr1', start: 0}\n * ```\n */\nexport function parseLocString(\n  locString: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const parsed = parseLocStringOneBased(locString, isValidRefName)\n  if (typeof parsed.start === 'number') {\n    parsed.start -= 1\n  }\n  return parsed\n}\n\nexport function compareLocs(locA: ParsedLocString, locB: ParsedLocString) {\n  const assemblyComp =\n    locA.assemblyName || locB.assemblyName\n      ? (locA.assemblyName || '').localeCompare(locB.assemblyName || '')\n      : 0\n  if (assemblyComp) {\n    return assemblyComp\n  }\n\n  const refComp =\n    locA.refName || locB.refName\n      ? (locA.refName || '').localeCompare(locB.refName || '')\n      : 0\n  if (refComp) {\n    return refComp\n  }\n\n  if (locA.start !== undefined && locB.start !== undefined) {\n    const startComp = locA.start - locB.start\n    if (startComp) {\n      return startComp\n    }\n  }\n  if (locA.end !== undefined && locB.end !== undefined) {\n    const endComp = locA.end - locB.end\n    if (endComp) {\n      return endComp\n    }\n  }\n  return 0\n}\n\nexport function compareLocStrings(\n  a: string,\n  b: string,\n  isValidRefName: (refName: string, assemblyName?: string) => boolean,\n) {\n  const locA = parseLocString(a, isValidRefName)\n  const locB = parseLocString(b, isValidRefName)\n  return compareLocs(locA, locB)\n}\n\n/**\n * Ensure that a number is at least min and at most max.\n *\n * @param num -\n * @param min -\n * @param  max -\n */\nexport function clamp(num: number, min: number, max: number) {\n  if (num < min) {\n    return min\n  }\n  if (num > max) {\n    return max\n  }\n  return num\n}\n\nfunction roundToNearestPointOne(num: number) {\n  return Math.round(num * 10) / 10\n}\n\n/**\n * @param bp -\n * @param region -\n * @param bpPerPx -\n */\nexport function bpToPx(\n  bp: number,\n  {\n    reversed,\n    end = 0,\n    start = 0,\n  }: { start?: number; end?: number; reversed?: boolean },\n  bpPerPx: number,\n) {\n  return roundToNearestPointOne((reversed ? end - bp : bp - start) / bpPerPx)\n}\n\nconst oneEightyOverPi = 180 / Math.PI\nconst piOverOneEighty = Math.PI / 180\nexport function radToDeg(radians: number) {\n  return (radians * oneEightyOverPi) % 360\n}\nexport function degToRad(degrees: number) {\n  return (degrees * piOverOneEighty) % (2 * Math.PI)\n}\n\n/**\n * @returns [x, y]\n */\nexport function polarToCartesian(rho: number, theta: number) {\n  return [rho * Math.cos(theta), rho * Math.sin(theta)] as [number, number]\n}\n\n/**\n * @param x - the x\n * @param y - the y\n * @returns [rho, theta]\n */\nexport function cartesianToPolar(x: number, y: number) {\n  const rho = Math.sqrt(x * x + y * y)\n  const theta = Math.atan(y / x)\n  return [rho, theta] as [number, number]\n}\n\nexport function featureSpanPx(\n  feature: Feature,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  return bpSpanPx(feature.get('start'), feature.get('end'), region, bpPerPx)\n}\n\nexport function bpSpanPx(\n  leftBp: number,\n  rightBp: number,\n  region: { start: number; end: number; reversed?: boolean },\n  bpPerPx: number,\n): [number, number] {\n  const start = bpToPx(leftBp, region, bpPerPx)\n  const end = bpToPx(rightBp, region, bpPerPx)\n  return region.reversed ? [end, start] : [start, end]\n}\n\n// do an array map of an iterable\nexport function iterMap<T, U>(\n  iter: Iterable<T>,\n  func: (arg: T) => U,\n  sizeHint?: number,\n) {\n  const results = Array.from<U>({ length: sizeHint || 0 })\n  let counter = 0\n  for (const item of iter) {\n    results[counter] = func(item)\n    counter += 1\n  }\n  return results\n}\n\n/**\n * Returns the index of the last element in the array where predicate is true,\n * and -1 otherwise.\n * Based on https://stackoverflow.com/a/53187807\n *\n * @param array - The source array to search in\n *\n * @param predicate - find calls predicate once for each element of the array, in\n * descending order, until it finds one where predicate returns true.\n *\n * @returns findLastIndex returns element index where predicate is true.\n * Otherwise, findLastIndex returns -1.\n */\nexport function findLastIndex<T>(\n  array: T[],\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): number {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return l\n    }\n  }\n  return -1\n}\n\nexport function findLast<T>(\n  array: T[],\n  predicate: (value: T, index: number, obj: T[]) => boolean,\n): T | undefined {\n  let l = array.length\n  while (l--) {\n    if (predicate(array[l], l, array)) {\n      return array[l]\n    }\n  }\n  return undefined\n}\n\n/**\n * makes a mobx reaction with the given functions, that calls actions on the\n * model for each stage of execution, and to abort the reaction function when\n * the model is destroyed.\n *\n * Will call startedFunction(signal), successFunction(result), and\n * errorFunction(error) when the async reaction function starts, completes, and\n * errors respectively.\n *\n * @param self -\n * @param dataFunction -\n * @param asyncReactionFunction -\n * @param reactionOptions -\n * @param startedFunction -\n * @param successFunction -\n * @param errorFunction -\n */\nexport function makeAbortableReaction<T, U, V>(\n  self: T,\n  dataFunction: (arg: T) => U,\n  asyncReactionFunction: (\n    arg: U | undefined,\n    signal: AbortSignal,\n    model: T,\n    handle: IReactionPublic,\n  ) => Promise<V>,\n  // @ts-expect-error\n  reactionOptions: IReactionOptions,\n  startedFunction: (aborter: AbortController) => void,\n  successFunction: (arg: V) => void,\n  errorFunction: (err: unknown) => void,\n) {\n  let inProgress: AbortController | undefined\n\n  function handleError(error: unknown) {\n    if (!isAbortException(error)) {\n      if (isAlive(self)) {\n        errorFunction(error)\n      } else {\n        console.error(error)\n      }\n    }\n  }\n\n  addDisposer(\n    self,\n    reaction(\n      () => {\n        try {\n          return dataFunction(self)\n        } catch (e) {\n          handleError(e)\n          return undefined\n        }\n      },\n      async (data, mobxReactionHandle) => {\n        if (inProgress && !inProgress.signal.aborted) {\n          inProgress.abort()\n        }\n\n        if (!isAlive(self)) {\n          return\n        }\n        inProgress = new AbortController()\n\n        const thisInProgress = inProgress\n        startedFunction(thisInProgress)\n        try {\n          const result = await asyncReactionFunction(\n            data,\n            thisInProgress.signal,\n            self,\n            // @ts-expect-error\n            mobxReactionHandle,\n          )\n          checkAbortSignal(thisInProgress.signal)\n          if (isAlive(self)) {\n            successFunction(result)\n          }\n        } catch (e) {\n          if (thisInProgress && !thisInProgress.signal.aborted) {\n            thisInProgress.abort()\n          }\n          handleError(e)\n        }\n      },\n      reactionOptions,\n    ),\n  )\n  addDisposer(self, () => {\n    if (inProgress && !inProgress.signal.aborted) {\n      inProgress.abort()\n    }\n  })\n}\n\nexport function renameRegionIfNeeded(\n  refNameMap: Record<string, string>,\n  region: Region | Instance<typeof MUIRegion>,\n): Region & { originalRefName?: string } {\n  if (isStateTreeNode(region) && !isAlive(region)) {\n    return region\n  }\n\n  if (region && refNameMap?.[region.refName]) {\n    // clone the region so we don't modify it\n    region = isStateTreeNode(region)\n      ? { ...getSnapshot(region) }\n      : { ...region }\n\n    // modify it directly in the container\n    const newRef = refNameMap[region.refName]\n    if (newRef) {\n      return { ...region, refName: newRef, originalRefName: region.refName }\n    }\n  }\n  return region\n}\n\nexport async function renameRegionsIfNeeded<\n  ARGTYPE extends {\n    assemblyName?: string\n    regions?: Region[]\n    signal?: AbortSignal\n    adapterConfig: unknown\n    sessionId: string\n    statusCallback?: (arg: string) => void\n  },\n>(assemblyManager: AssemblyManager, args: ARGTYPE) {\n  const { regions = [], adapterConfig } = args\n  if (!args.sessionId) {\n    throw new Error('sessionId is required')\n  }\n\n  const assemblyNames = regions.map(region => region.assemblyName)\n  const assemblyMaps = Object.fromEntries(\n    await Promise.all(\n      [...new Set(assemblyNames)].map(async assemblyName => {\n        return [\n          assemblyName,\n          await assemblyManager.getRefNameMapForAdapter(\n            adapterConfig,\n            assemblyName,\n            args,\n          ),\n        ]\n      }),\n    ),\n  )\n\n  return {\n    ...args,\n    regions: regions.map((region, i) =>\n      // note: uses assemblyNames defined above since region could be dead now\n      renameRegionIfNeeded(assemblyMaps[assemblyNames[i]], region),\n    ),\n  }\n}\n\nexport function minmax(a: number, b: number) {\n  return [Math.min(a, b), Math.max(a, b)]\n}\n\nexport function shorten(name: string, max = 70, short = 30) {\n  return name.length > max\n    ? name.slice(0, short) + '...' + name.slice(-short)\n    : name\n}\n\nexport function stringify(\n  {\n    refName,\n    coord,\n    assemblyName,\n    oob,\n  }: {\n    assemblyName?: string\n    coord: number\n    refName?: string\n    oob?: boolean\n  },\n  useAssemblyName?: boolean,\n) {\n  return [\n    assemblyName && useAssemblyName ? `{${assemblyName}}` : '',\n    refName\n      ? `${shorten(refName)}:${toLocale(coord)}${oob ? ' (out of bounds)' : ''}`\n      : '',\n  ].join('')\n}\n\n// this is recommended in a later comment in\n// https://github.com/electron/electron/issues/2288 for detecting electron in a\n// renderer process, which is the one that has node enabled for us\n//\n// const isElectron = process.versions.electron\n// const i2 = process.versions.hasOwnProperty('electron')\nexport const isElectron = /electron/i.test(\n  typeof navigator !== 'undefined' ? navigator.userAgent : '',\n)\n\nexport function revcom(seqString: string) {\n  return reverse(complement(seqString))\n}\n\nexport function reverse(seqString: string) {\n  return seqString.split('').reverse().join('')\n}\n\nexport const complement = (() => {\n  const complementRegex = /[ACGT]/gi\n\n  // from bioperl: tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/\n  // generated with:\n  // perl -MJSON -E '@l = split \"\",\"acgtrymkswhbvdnxACGTRYMKSWHBVDNX\"; print to_json({ map { my $in = $_; tr/acgtrymkswhbvdnxACGTRYMKSWHBVDNX/tgcayrkmswdvbhnxTGCAYRKMSWDVBHNX/; $in => $_ } @l})'\n  const complementTable = {\n    S: 'S',\n    w: 'w',\n    T: 'A',\n    r: 'y',\n    a: 't',\n    N: 'N',\n    K: 'M',\n    x: 'x',\n    d: 'h',\n    Y: 'R',\n    V: 'B',\n    y: 'r',\n    M: 'K',\n    h: 'd',\n    k: 'm',\n    C: 'G',\n    g: 'c',\n    t: 'a',\n    A: 'T',\n    n: 'n',\n    W: 'W',\n    X: 'X',\n    m: 'k',\n    v: 'b',\n    B: 'V',\n    s: 's',\n    H: 'D',\n    c: 'g',\n    D: 'H',\n    b: 'v',\n    R: 'Y',\n    G: 'C',\n  } as Record<string, string>\n\n  return (seqString: string) => {\n    return seqString.replaceAll(complementRegex, m => complementTable[m] || '')\n  }\n})()\n\n// requires immediate execution in jest environment, because (hypothesis) it\n// otherwise listens for prerendered_canvas but reads empty pixels, and doesn't\n// get the contents of the canvas\nexport const rIC =\n  typeof jest === 'undefined'\n    ? typeof window !== 'undefined' && window.requestIdleCallback\n      ? window.requestIdleCallback\n      : (cb: Function) => setTimeout(() => cb(), 1)\n    : (cb: Function) => cb()\n\n// prettier-ignore\nconst widths = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2796875,0.2765625,0.3546875,0.5546875,0.5546875,0.8890625,0.665625,0.190625,0.3328125,0.3328125,0.3890625,0.5828125,0.2765625,0.3328125,0.2765625,0.3015625,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.5546875,0.2765625,0.2765625,0.584375,0.5828125,0.584375,0.5546875,1.0140625,0.665625,0.665625,0.721875,0.721875,0.665625,0.609375,0.7765625,0.721875,0.2765625,0.5,0.665625,0.5546875,0.8328125,0.721875,0.7765625,0.665625,0.7765625,0.721875,0.665625,0.609375,0.721875,0.665625,0.94375,0.665625,0.665625,0.609375,0.2765625,0.3546875,0.2765625,0.4765625,0.5546875,0.3328125,0.5546875,0.5546875,0.5,0.5546875,0.5546875,0.2765625,0.5546875,0.5546875,0.221875,0.240625,0.5,0.221875,0.8328125,0.5546875,0.5546875,0.5546875,0.5546875,0.3328125,0.5,0.2765625,0.5546875,0.5,0.721875,0.5,0.5,0.5,0.3546875,0.259375,0.353125,0.5890625]\n\n// xref https://gist.github.com/tophtucker/62f93a4658387bb61e4510c37e2e97cf\nexport function measureText(str: unknown, fontSize = 10) {\n  const avg = 0.5279276315789471\n  const s = String(str)\n  let total = 0\n  for (let i = 0; i < s.length; i++) {\n    const code = s.charCodeAt(i)\n    total += widths[code] ?? avg\n  }\n  return total * fontSize\n}\n\nexport const defaultStarts = ['ATG']\nexport const defaultStops = ['TAA', 'TAG', 'TGA']\nexport const defaultCodonTable = {\n  TCA: 'S',\n  TCC: 'S',\n  TCG: 'S',\n  TCT: 'S',\n  TTC: 'F',\n  TTT: 'F',\n  TTA: 'L',\n  TTG: 'L',\n  TAC: 'Y',\n  TAT: 'Y',\n  TAA: '*',\n  TAG: '*',\n  TGC: 'C',\n  TGT: 'C',\n  TGA: '*',\n  TGG: 'W',\n  CTA: 'L',\n  CTC: 'L',\n  CTG: 'L',\n  CTT: 'L',\n  CCA: 'P',\n  CCC: 'P',\n  CCG: 'P',\n  CCT: 'P',\n  CAC: 'H',\n  CAT: 'H',\n  CAA: 'Q',\n  CAG: 'Q',\n  CGA: 'R',\n  CGC: 'R',\n  CGG: 'R',\n  CGT: 'R',\n  ATA: 'I',\n  ATC: 'I',\n  ATT: 'I',\n  ATG: 'M',\n  ACA: 'T',\n  ACC: 'T',\n  ACG: 'T',\n  ACT: 'T',\n  AAC: 'N',\n  AAT: 'N',\n  AAA: 'K',\n  AAG: 'K',\n  AGC: 'S',\n  AGT: 'S',\n  AGA: 'R',\n  AGG: 'R',\n  GTA: 'V',\n  GTC: 'V',\n  GTG: 'V',\n  GTT: 'V',\n  GCA: 'A',\n  GCC: 'A',\n  GCG: 'A',\n  GCT: 'A',\n  GAC: 'D',\n  GAT: 'D',\n  GAA: 'E',\n  GAG: 'E',\n  GGA: 'G',\n  GGC: 'G',\n  GGG: 'G',\n  GGT: 'G',\n}\n\n/**\n * take CodonTable above and generate larger codon table that includes all\n * permutations of upper and lower case nucleotides\n */\nexport function generateCodonTable(table: any) {\n  const tempCodonTable: Record<string, string> = {}\n  Object.keys(table).forEach(codon => {\n    const aa = table[codon]\n    const nucs: string[][] = []\n    for (let i = 0; i < 3; i++) {\n      const nuc = codon.charAt(i)\n      nucs[i] = []\n      nucs[i][0] = nuc.toUpperCase()\n      nucs[i][1] = nuc.toLowerCase()\n    }\n    for (let i = 0; i < 2; i++) {\n      const n0 = nucs[0][i]\n      for (let j = 0; j < 2; j++) {\n        const n1 = nucs[1][j]\n        for (let k = 0; k < 2; k++) {\n          const n2 = nucs[2][k]\n          const triplet = n0 + n1 + n2\n          tempCodonTable[triplet] = aa\n        }\n      }\n    }\n  })\n  return tempCodonTable\n}\n\n// call statusCallback with current status and clear when finished\nexport async function updateStatus<U>(\n  msg: string,\n  cb: (arg: string) => void,\n  fn: () => U | Promise<U>,\n) {\n  cb(msg)\n  const res = await fn()\n  cb('')\n  return res\n}\n\nexport function hashCode(str: string) {\n  let hash = 0\n  if (str.length === 0) {\n    return hash\n  }\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i)\n    hash = (hash << 5) - hash + chr\n    hash |= 0 // Convert to 32bit integer\n  }\n  return hash\n}\n\nexport function objectHash(obj: Record<string, any>) {\n  return `${hashCode(JSON.stringify(obj))}`\n}\n\ninterface VirtualOffset {\n  blockPosition: number\n}\ninterface Block {\n  minv: VirtualOffset\n  maxv: VirtualOffset\n}\n\nexport async function bytesForRegions(\n  regions: Region[],\n  index: {\n    blocksForRange: (\n      ref: string,\n      start: number,\n      end: number,\n    ) => Promise<Block[]>\n  },\n) {\n  const blockResults = await Promise.all(\n    regions.map(r => index.blocksForRange(r.refName, r.start, r.end)),\n  )\n\n  return blockResults\n    .flat()\n    .map(block => ({\n      start: block.minv.blockPosition,\n      end: block.maxv.blockPosition + 65535,\n    }))\n    .reduce((a, b) => a + b.end - b.start, 0)\n}\n\nexport interface ViewSnap {\n  bpPerPx: number\n  interRegionPaddingWidth: number\n  minimumBlockWidth: number\n  width: number\n  offsetPx: number\n  staticBlocks: { contentBlocks: BaseBlock[]; blocks: BaseBlock[] }\n  displayedRegions: (IStateTreeNode & {\n    start: number\n    end: number\n    refName: string\n    reversed: boolean\n    assemblyName: string\n  })[]\n}\n\n// supported adapter types by text indexer\n//  ensure that this matches the method found in @jbrowse/text-indexing/util\nexport function isSupportedIndexingAdapter(type: string) {\n  return [\n    'Gff3TabixAdapter',\n    'VcfTabixAdapter',\n    'Gff3Adapter',\n    'VcfAdapter',\n  ].includes(type)\n}\n\nexport function getBpDisplayStr(totalBp: number) {\n  let str\n  if (Math.floor(totalBp / 1_000_000) > 0) {\n    str = `${Number.parseFloat((totalBp / 1_000_000).toPrecision(3))}Mbp`\n  } else if (Math.floor(totalBp / 1_000) > 0) {\n    str = `${Number.parseFloat((totalBp / 1_000).toPrecision(3))}Kbp`\n  } else {\n    str = `${toLocale(Math.floor(totalBp))}bp`\n  }\n  return str\n}\n\nexport function toLocale(n: number) {\n  return n.toLocaleString('en-US')\n}\n\nexport function getTickDisplayStr(totalBp: number, bpPerPx: number) {\n  return Math.floor(bpPerPx / 1_000) > 0\n    ? `${toLocale(Number.parseFloat((totalBp / 1_000_000).toFixed(2)))}M`\n    : `${toLocale(Math.floor(totalBp))}`\n}\n\nexport function getViewParams(model: IAnyStateTreeNode, exportSVG?: boolean) {\n  // @ts-expect-error\n  const { dynamicBlocks, staticBlocks, offsetPx } = getContainingView(model)\n  const b = dynamicBlocks?.contentBlocks[0] || {}\n  const staticblock = staticBlocks?.contentBlocks[0] || {}\n  const staticblock1 = staticBlocks?.contentBlocks[1] || {}\n  return {\n    offsetPx: exportSVG ? 0 : offsetPx - staticblock.offsetPx,\n    offsetPx1: exportSVG ? 0 : offsetPx - staticblock1.offsetPx,\n    start: b.start as number,\n    end: b.end as number,\n  }\n}\n\nexport function getLayoutId({\n  sessionId,\n  layoutId,\n}: {\n  sessionId: string\n  layoutId: string\n}) {\n  return sessionId + '-' + layoutId\n}\n\n// Hook from https://usehooks.com/useLocalStorage/\nexport function useLocalStorage<T>(key: string, initialValue: T) {\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    if (typeof window === 'undefined') {\n      return initialValue\n    }\n    try {\n      const item = window.localStorage.getItem(key)\n      return item ? JSON.parse(item) : initialValue\n    } catch (error) {\n      console.error(error)\n      return initialValue\n    }\n  })\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      const valueToStore =\n        value instanceof Function ? value(storedValue) : value\n      setStoredValue(valueToStore)\n      if (typeof window !== 'undefined') {\n        window.localStorage.setItem(key, JSON.stringify(valueToStore))\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  }\n  return [storedValue, setValue] as const\n}\n\nexport function getUriLink(value: { uri: string; baseUri?: string }) {\n  const { uri, baseUri = '' } = value\n  let href\n  try {\n    href = new URL(uri, baseUri).href\n  } catch (e) {\n    href = uri\n  }\n  return href\n}\n\nexport function getStr(obj: unknown) {\n  return isObject(obj)\n    ? isUriLocation(obj)\n      ? getUriLink(obj)\n      : JSON.stringify(obj)\n    : String(obj)\n}\n\n// tries to measure grid width without HTML tags included\nexport function coarseStripHTML(s: string) {\n  return s.replaceAll(/(<([^>]+)>)/gi, '')\n}\n\n// based on autolink-js, license MIT\nexport function linkify(s: string) {\n  const pattern =\n    /(^|[\\s\\n]|<[A-Za-z]*\\/?>)((?:https?|ftp):\\/\\/[\\-A-Z0-9+\\u0026\\u2019@#\\/%?=()~_|!:,.;]*[\\-A-Z0-9+\\u0026@#\\/%=~()_|])/gi\n  return s.replaceAll(pattern, '$1<a href=\\'$2\\' target=\"_blank\">$2</a>')\n}\n\n// heuristic measurement for a column of a @mui/x-data-grid, pass in values from a column\nexport function measureGridWidth(\n  elements: unknown[],\n  args?: {\n    minWidth?: number\n    fontSize?: number\n    maxWidth?: number\n    padding?: number\n    stripHTML?: boolean\n  },\n) {\n  const {\n    padding = 30,\n    minWidth = 80,\n    fontSize = 12,\n    maxWidth = 1000,\n    stripHTML = false,\n  } = args || {}\n  return max(\n    elements\n      .map(element => getStr(element))\n      .map(str => (stripHTML ? coarseStripHTML(str) : str))\n      .map(str => measureText(str, fontSize))\n      .map(n => Math.min(Math.max(n + padding, minWidth), maxWidth)),\n  )\n}\n\nexport function getEnv(obj: any) {\n  return getEnvMST<{ pluginManager: PluginManager }>(obj)\n}\n\nexport function localStorageGetItem(item: string) {\n  return typeof localStorage !== 'undefined'\n    ? localStorage.getItem(item)\n    : undefined\n}\n\nexport function localStorageSetItem(str: string, item: string) {\n  return typeof localStorage !== 'undefined'\n    ? localStorage.setItem(str, item)\n    : undefined\n}\n\nexport function max(arr: number[], init = -Infinity) {\n  let max = init\n  for (const entry of arr) {\n    max = entry > max ? entry : max\n  }\n  return max\n}\n\nexport function min(arr: number[], init = Infinity) {\n  let min = init\n  for (const entry of arr) {\n    min = entry < min ? entry : min\n  }\n  return min\n}\n\nexport function sum(arr: number[]) {\n  let sum = 0\n  for (const entry of arr) {\n    sum += entry\n  }\n  return sum\n}\n\nexport function avg(arr: number[]) {\n  return sum(arr) / arr.length\n}\n\nexport function groupBy<T>(array: Iterable<T>, predicate: (v: T) => string) {\n  const result = {} as Record<string, T[] | undefined>\n  for (const value of array) {\n    const entry = (result[predicate(value)] ||= [])\n    entry.push(value)\n  }\n  return result\n}\n\nexport function notEmpty<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined\n}\n\nexport function mergeIntervals<T extends { start: number; end: number }>(\n  intervals: T[],\n  w = 5000,\n) {\n  // test if there are at least 2 intervals\n  if (intervals.length <= 1) {\n    return intervals\n  }\n\n  const stack = []\n  let top = null\n\n  // sort the intervals based on their start values\n  intervals = intervals.sort((a, b) => a.start - b.start)\n\n  // push the 1st interval into the stack\n  stack.push(intervals[0])\n\n  // start from the next interval and merge if needed\n  for (let i = 1; i < intervals.length; i++) {\n    // get the top element\n\n    top = stack.at(-1)!\n\n    // if the current interval doesn't overlap with the\n    // stack top element, push it to the stack\n    if (top.end + w < intervals[i].start - w) {\n      stack.push(intervals[i])\n    }\n    // otherwise update the end value of the top element\n    // if end of current interval is higher\n    else if (top.end < intervals[i].end) {\n      top.end = Math.max(top.end, intervals[i].end)\n      stack.pop()\n      stack.push(top)\n    }\n  }\n\n  return stack\n}\n\ninterface BasicFeature {\n  end: number\n  start: number\n  refName: string\n}\n\n// hashmap of refName->array of features\ntype FeaturesPerRef = Record<string, BasicFeature[]>\n\nexport function gatherOverlaps(regions: BasicFeature[]) {\n  const memo = {} as FeaturesPerRef\n  for (const x of regions) {\n    if (!memo[x.refName]) {\n      memo[x.refName] = []\n    }\n    memo[x.refName].push(x)\n  }\n\n  return Object.values(memo).flatMap(group =>\n    mergeIntervals(group.sort((a, b) => a.start - b.start)),\n  )\n}\n\nexport {\n  default as SimpleFeature,\n  type Feature,\n  type SimpleFeatureSerialized,\n  isFeature,\n} from './simpleFeature'\n\nexport function stripAlpha(str: string) {\n  const c = colord(str)\n  return c.alpha(1).toHex()\n}\n\nexport { blobToDataURL } from './blobToDataURL'\n","import { types } from 'mobx-state-tree'\nimport propTypes from 'prop-types'\nimport { PropTypes as MxPropTypes } from 'mobx-react'\n\nimport { nanoid } from '../nanoid'\n\nexport const ElementId = types.optional(types.identifier, () => nanoid())\n\n// PropTypes that are useful when working with instances of these in react components\nexport const PropTypes = {\n  Region: propTypes.shape({\n    refName: propTypes.string.isRequired,\n    start: propTypes.number.isRequired,\n    end: propTypes.number.isRequired,\n  }),\n  ConfigSchema: MxPropTypes.objectOrObservableObject,\n  Feature: propTypes.shape({\n    get: propTypes.func.isRequired,\n    id: propTypes.func.isRequired,\n  }),\n}\n\nexport const NoAssemblyRegion = types\n  .model('NoAssemblyRegion', {\n    refName: types.string,\n    start: types.number,\n    end: types.number,\n    reversed: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setRefName(newRefName: string): void {\n      self.refName = newRefName\n    },\n  }))\n\nexport const Region = types.compose(\n  'Region',\n  NoAssemblyRegion,\n  types.model({\n    assemblyName: types.string,\n  }),\n)\n\nexport const LocalPathLocation = types.model('LocalPathLocation', {\n  locationType: types.literal('LocalPathLocation'),\n  localPath: types.string,\n})\n\n// like how blobId is used to get a blob map\nexport const BlobLocation = types.model('BlobLocation', {\n  locationType: types.literal('BlobLocation'),\n  name: types.string,\n  blobId: types.string,\n})\n\nexport const UriLocationRaw = types.model('UriLocation', {\n  locationType: types.literal('UriLocation'),\n  uri: types.string,\n  baseUri: types.maybe(types.string),\n\n  internetAccountId: types.maybe(types.string),\n\n  // auths information (such as tokens) needed for using this resource.\n  // if provided, these must be completely sufficient for using it\n  internetAccountPreAuthorization: types.maybe(\n    types.model('InternetAccountPreAuthorization', {\n      internetAccountType: types.string,\n      authInfo: types.frozen(),\n    }),\n  ),\n})\n\nexport const UriLocation = types.snapshotProcessor(UriLocationRaw, {\n  postProcessor: snap => {\n    // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n    const { baseUri, ...rest } = snap as Omit<typeof snap, symbol>\n    if (!baseUri) {\n      return rest\n    }\n    return snap\n  },\n})\n\nexport const FileLocation = types.snapshotProcessor(\n  types.union(LocalPathLocation, UriLocation, BlobLocation),\n  {\n    // @ts-expect-error\n    preProcessor(snap) {\n      if (!snap) {\n        return undefined\n      }\n\n      // @ts-expect-error\n      // xref https://github.com/mobxjs/mobx-state-tree/issues/1524 for Omit\n      const { locationType, ...rest } = snap as Omit<typeof snap, symbol>\n      if (!locationType) {\n        // @ts-expect-error\n        const { uri, localPath, blob } = rest\n        let locationType = ''\n        if (uri !== undefined) {\n          locationType = 'UriLocation'\n        } else if (localPath !== undefined) {\n          locationType = 'LocalPathLocation'\n        } else if (blob !== undefined) {\n          locationType = 'BlobLocation'\n        }\n\n        return { ...rest, locationType }\n      }\n      return snap\n    },\n  },\n)\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  IAnyStateTreeNode,\n  Instance,\n  getParent,\n  isStateTreeNode,\n  types,\n} from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\n\n// locals\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel'\nimport { ElementId } from '@jbrowse/core/util/types/mst'\n\n/**\n * #stateModel BaseSessionModel\n * base session shared by **all** JBrowse products. Be careful what you include\n * here, everything will use it.\n */\nexport function BaseSessionModel<\n  ROOT_MODEL_TYPE extends BaseRootModelType,\n  JB_CONFIG_SCHEMA extends AnyConfigurationSchemaType,\n>(_pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      id: ElementId,\n      /**\n       * #property\n       */\n      name: types.string,\n      /**\n       * #property\n       */\n      margin: 0,\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       * this is the globally \"selected\" object. can be anything. code that\n       * wants to deal with this should examine it to see what kind of thing it\n       * is.\n       */\n      selection: undefined as unknown,\n      /**\n       * #volatile\n       * this is the globally \"hovered\" object. can be anything. code that\n       * wants to deal with this should examine it to see what kind of thing it\n       * is.\n       */\n      hovered: undefined as unknown,\n    }))\n    .views(self => ({\n      get root() {\n        return getParent<ROOT_MODEL_TYPE>(self)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get jbrowse() {\n        return self.root.jbrowse\n      },\n      /**\n       * #getter\n       */\n      get rpcManager() {\n        return self.root.rpcManager\n      },\n      /**\n       * #getter\n       */\n      get configuration(): Instance<JB_CONFIG_SCHEMA> {\n        return this.jbrowse.configuration\n      },\n      /**\n       * #getter\n       */\n      get adminMode() {\n        return self.root.adminMode\n      },\n\n      /**\n       * #getter\n       */\n      get textSearchManager() {\n        return self.root.textSearchManager\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblies(): Instance<BaseAssemblyConfigSchema>[] {\n        return self.jbrowse.assemblies\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * set the global selection, i.e. the globally-selected object. can be a\n       * feature, a view, just about anything\n       */\n      setSelection(thing: unknown) {\n        self.selection = thing\n      },\n\n      /**\n       * #action\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n      /**\n       * #action\n       */\n      setHovered(thing: unknown) {\n        self.hovered = thing\n      },\n    }))\n}\n\n/** Session mixin MST type for the most basic session */\nexport type BaseSessionType = ReturnType<typeof BaseSessionModel>\n\n/** Instance of the most basic possible session */\nexport type BaseSession = Instance<BaseSessionType>\n\n/** Type guard for BaseSession */\nexport function isBaseSession(thing: IAnyStateTreeNode): thing is BaseSession {\n  return 'id' in thing && 'name' in thing && 'root' in thing\n}\n\n/** Type guard for whether a thing is JBrowse session */\nexport function isSession(thing: unknown): thing is BaseSession {\n  return isStateTreeNode(thing) && isBaseSession(thing)\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { IAnyStateTreeNode, Instance, types } from 'mobx-state-tree'\nimport { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport { BaseConnectionModel } from '@jbrowse/core/pluggableElementTypes/models/BaseConnectionModelFactory'\n\n// locals\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel'\nimport type { SessionWithReferenceManagementType } from './ReferenceManagement'\nimport { isBaseSession } from './BaseSession'\n\n/**\n * #stateModel ConnectionManagementSessionMixin\n */\nexport function ConnectionManagementSessionMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType(\n          'connection',\n          'stateModel',\n        ) as BaseConnectionModel,\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.connections\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const type = configuration.type as string\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connectionInstances.push({\n          ...initialSnapshot,\n          name,\n          // @ts-expect-error unsure why ts doesn't like `type` here, but is\n          // needed\n          type,\n          configuration,\n        })\n        return self.connectionInstances[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const root = self as typeof self &\n          Instance<SessionWithReferenceManagementType>\n        const callbacksToDeref: Function[] = []\n        const derefTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          return undefined\n        }\n        for (const track of connection.tracks) {\n          const ref = root.getReferring(track)\n          root.removeReferring(ref, track, callbacksToDeref, derefTypeCount)\n        }\n        return [\n          () => {\n            callbacksToDeref.forEach(cb => cb())\n            this.breakConnection(configuration)\n          },\n          derefTypeCount,\n        ]\n      },\n\n      /**\n       * #action\n       */\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          throw new Error(`no connection found with name ${name}`)\n        }\n        self.connectionInstances.remove(connection)\n      },\n\n      /**\n       * #action\n       */\n      deleteConnection(configuration: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.deleteConnectionConf(configuration)\n      },\n\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.addConnectionConf(connectionConf)\n      },\n\n      /**\n       * #action\n       */\n      clearConnections() {\n        self.connectionInstances.clear()\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that has connections */\nexport type SessionWithConnectionsType = ReturnType<\n  typeof ConnectionManagementSessionMixin\n>\n\n/** Instance of a session that has connections: `connectionInstances`,\n * `makeConnection()`, etc. */\nexport type SessionWithConnections = Instance<SessionWithConnectionsType>\n\n/** Type guard for SessionWithConnections */\nexport function isSessionWithConnections(\n  session: IAnyStateTreeNode,\n): session is SessionWithConnections {\n  return isBaseSession(session) && 'connectionInstances' in session\n}\n","import { lazy } from 'react'\nimport Plugin from '@jbrowse/core/Plugin'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport UCSCTrackHubConnectionF from './ucsc-trackhub'\nimport AddTrackWidgetF from './AddTrackWidget'\n\nimport AddConnectionWidgetF from './AddConnectionWidget'\nimport PluginStoreWidgetF from './PluginStoreWidget'\nimport HierarchicalTrackSelectorWidgetF from './HierarchicalTrackSelectorWidget'\n\nconst AssemblyManager = lazy(() => import('./AssemblyManager'))\n\nexport default class extends Plugin {\n  name = 'DataManagementPlugin'\n\n  exports = {\n    AssemblyManager,\n  }\n\n  install(pluginManager: PluginManager) {\n    UCSCTrackHubConnectionF(pluginManager)\n    AddTrackWidgetF(pluginManager)\n    HierarchicalTrackSelectorWidgetF(pluginManager)\n    AddConnectionWidgetF(pluginManager)\n    PluginStoreWidgetF(pluginManager)\n  }\n\n  configure(_pluginManager: PluginManager) {}\n}\n\nexport { AssemblyManager }\n\nexport { type AddTrackModel } from './AddTrackWidget/model'\nexport { type HierarchicalTrackSelectorModel } from './HierarchicalTrackSelectorWidget'\n","import React from 'react'\nimport {\n  Alert,\n  Button,\n  IconButton,\n  Snackbar as MUISnackbar,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\n\n// locals\nimport { AbstractSessionModel } from '../util'\nimport { SnackbarMessage } from './SnackbarModel'\n\ninterface SnackbarSession extends AbstractSessionModel {\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => void\n}\n\nconst Snackbar = observer(function ({ session }: { session: SnackbarSession }) {\n  const { snackbarMessages } = session\n  const latestMessage = snackbarMessages.at(-1)\n\n  const handleClose = (_event: unknown, reason?: string) => {\n    if (reason !== 'clickaway') {\n      session.popSnackbarMessage()\n    }\n  }\n  return !!latestMessage ? (\n    <MUISnackbar\n      open\n      onClose={handleClose}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n    >\n      <Alert\n        onClose={handleClose}\n        action={\n          latestMessage.action ? (\n            <>\n              <Button\n                color=\"inherit\"\n                onClick={e => {\n                  latestMessage.action?.onClick()\n                  handleClose(e)\n                }}\n              >\n                {latestMessage.action.name}\n              </Button>\n              <IconButton color=\"inherit\" onClick={handleClose}>\n                <CloseIcon />\n              </IconButton>\n            </>\n          ) : null\n        }\n        severity={latestMessage.level || 'warning'}\n      >\n        {latestMessage.message}\n      </Alert>\n    </MUISnackbar>\n  ) : null\n})\n\nexport default Snackbar\n","import React, { useRef, useState } from 'react'\nimport { Button, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport ArrowDropDown from '@mui/icons-material/ArrowDropDown'\n\nimport Menu, { MenuItem } from './Menu'\n\nconst useStyles = makeStyles()(theme => ({\n  buttonRoot: {\n    '&:hover': {\n      backgroundColor: alpha(\n        theme.palette.primary.contrastText,\n        theme.palette.action.hoverOpacity,\n      ),\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nconst DropDownMenu = observer(function ({\n  menuTitle,\n  session,\n  menuItems,\n}: {\n  menuTitle: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  session: any\n  menuItems: MenuItem[]\n}) {\n  const [open, setOpen] = useState(false)\n  const anchorEl = useRef(null)\n  const { classes } = useStyles()\n\n  function handleClose() {\n    setOpen(false)\n  }\n\n  return (\n    <>\n      <Button\n        ref={anchorEl}\n        onClick={() => setOpen(!open)}\n        color=\"inherit\"\n        data-testid=\"dropDownMenuButton\"\n        classes={{ root: classes.buttonRoot }}\n      >\n        {menuTitle}\n        <ArrowDropDown />\n      </Button>\n      <Menu\n        anchorEl={anchorEl.current}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'left' }}\n        onMenuItemClick={(_event, callback) => {\n          callback(session)\n          handleClose()\n        }}\n        open={open}\n        onClose={handleClose}\n        menuItems={menuItems}\n      />\n    </>\n  )\n})\n\nexport default DropDownMenu\n","import React from 'react'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\n// ui elements\nimport { LogoFull } from './Logo'\n\nconst Logo = observer(function ({\n  session,\n}: {\n  session: { configuration: AnyConfigurationModel }\n}) {\n  const { configuration } = session\n  const logoPath = readConfObject(configuration, 'logoPath')\n  return logoPath?.uri ? (\n    <img src={logoPath.uri} alt=\"Custom logo\" />\n  ) : (\n    <LogoFull variant=\"white\" />\n  )\n})\n\nexport default Logo\n","import React from 'react'\nimport { Toolbar, Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { SessionWithDrawerWidgets } from '@jbrowse/core/util'\nimport DropDownMenu from '@jbrowse/core/ui/DropDownMenu'\nimport EditableTypography from '@jbrowse/core/ui/EditableTypography'\nimport AppLogo from '@jbrowse/core/ui/AppLogo'\nimport { MenuItem as JBMenuItem } from '@jbrowse/core/ui/Menu'\nimport { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\n\nconst useStyles = makeStyles()(theme => ({\n  grow: {\n    flexGrow: 1,\n  },\n  inputBase: {\n    color: theme.palette.primary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.secondary.main,\n    backgroundColor: theme.palette.primary.light,\n  },\n}))\n\ntype AppSession = SessionWithDrawerWidgets & {\n  savedSessionNames: string[]\n  menus: { label: string; menuItems: JBMenuItem[] }[]\n  renameCurrentSession: (arg: string) => void\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nconst AppToolbar = observer(function ({\n  session,\n  HeaderButtons = <div />,\n}: {\n  HeaderButtons?: React.ReactElement\n  session: AppSession\n}) {\n  const { classes } = useStyles()\n  const { savedSessionNames, name, menus } = session\n\n  return (\n    <Toolbar>\n      {menus.map(menu => (\n        <DropDownMenu\n          key={menu.label}\n          menuTitle={menu.label}\n          menuItems={menu.menuItems}\n          session={session}\n        />\n      ))}\n      <div className={classes.grow} />\n      <Tooltip title=\"Rename Session\" arrow>\n        <EditableTypography\n          value={name}\n          setValue={newName => {\n            if (savedSessionNames?.includes(newName)) {\n              session.notify(\n                `Cannot rename session to \"${newName}\", a saved session with that name already exists`,\n                'warning',\n              )\n            } else {\n              session.renameCurrentSession(newName)\n            }\n          }}\n          variant=\"body1\"\n          classes={{\n            inputBase: classes.inputBase,\n            inputRoot: classes.inputRoot,\n            inputFocused: classes.inputFocused,\n          }}\n        />\n      </Tooltip>\n      {HeaderButtons}\n      <div className={classes.grow} />\n      <div style={{ width: 150, maxHeight: 48 }}>\n        <AppLogo session={session} />\n      </div>\n    </Toolbar>\n  )\n})\n\nexport default AppToolbar\n","import React, { useState } from 'react'\nimport {\n  Button,\n  FormControl,\n  MenuItem,\n  Paper,\n  Select,\n  Typography,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { makeStyles } from 'tss-react/mui'\n\n// locals\nimport { getEnv, SessionWithDrawerWidgets } from '@jbrowse/core/util'\n\n// ui elements\nimport { MenuItem as JBMenuItem } from '@jbrowse/core/ui/Menu'\nimport { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\n\ntype AppSession = SessionWithDrawerWidgets & {\n  savedSessionNames: string[]\n  menus: { label: string; menuItems: JBMenuItem[] }[]\n  renameCurrentSession: (arg: string) => void\n  snackbarMessages: SnackbarMessage[]\n  popSnackbarMessage: () => unknown\n}\n\nconst useStyles = makeStyles()(theme => ({\n  selectPaper: {\n    padding: theme.spacing(4),\n  },\n}))\n\nconst ViewLauncher = observer(({ session }: { session: AppSession }) => {\n  const { classes } = useStyles()\n  const { pluginManager } = getEnv(session)\n  const viewTypes = pluginManager.getElementTypeRecord('view').all()\n  const [value, setValue] = useState(viewTypes[0]?.name)\n  return (\n    <Paper className={classes.selectPaper}>\n      <Typography>Select a view to launch</Typography>\n      <FormControl style={{ margin: 2 }}>\n        <Select value={value} onChange={event => setValue(event.target.value)}>\n          {viewTypes.map(({ displayName, name }) => (\n            <MenuItem key={name} value={name}>\n              {displayName}\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n      <FormControl style={{ margin: 2 }}>\n        <Button\n          onClick={() => session.addView(value, {})}\n          variant=\"contained\"\n          color=\"primary\"\n        >\n          Launch view\n        </Button>\n      </FormControl>\n    </Paper>\n  )\n})\n\nexport default ViewLauncher\n","import React from 'react'\nimport {\n  SvgIconProps,\n  IconButtonProps as IconButtonPropsType,\n} from '@mui/material'\nimport { observer } from 'mobx-react'\nimport { AbstractSessionModel, getSession } from '@jbrowse/core/util'\nimport CascadingMenuButton from '@jbrowse/core/ui/CascadingMenuButton'\nimport { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// icons\nimport MenuIcon from '@mui/icons-material/Menu'\nimport ArrowDownward from '@mui/icons-material/ArrowDownward'\nimport ArrowUpward from '@mui/icons-material/ArrowUpward'\n\nconst ViewMenu = observer(function ({\n  model,\n  IconProps,\n}: {\n  model: IBaseViewModel\n  IconButtonProps?: IconButtonPropsType\n  IconProps: SvgIconProps\n}) {\n  const { menuItems } = model\n  const session = getSession(model) as AbstractSessionModel & {\n    moveViewDown: (arg: string) => void\n    moveViewUp: (arg: string) => void\n  }\n\n  const items = [\n    ...(session.views.length > 1\n      ? [\n          {\n            label: 'Move view up',\n            icon: ArrowUpward,\n            onClick: () => session.moveViewUp(model.id),\n          },\n          {\n            label: 'Move view down',\n            icon: ArrowDownward,\n            onClick: () => session.moveViewDown(model.id),\n          },\n        ]\n      : []),\n\n    // <=1.3.3 didn't use a function, so check as value also\n    ...((typeof menuItems === 'function' ? menuItems() : menuItems) || []),\n  ]\n\n  return items.length ? (\n    <CascadingMenuButton menuItems={items} data-testid=\"view_menu_icon\">\n      <MenuIcon {...IconProps} fontSize=\"small\" />\n    </CascadingMenuButton>\n  ) : null\n})\nexport default ViewMenu\n","import React from 'react'\nimport { Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\n\n// locals\nimport EditableTypography from '@jbrowse/core/ui/EditableTypography'\nimport { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes'\n\nconst useStyles = makeStyles()(theme => ({\n  input: {\n    paddingBottom: 0,\n    paddingTop: 2,\n  },\n  inputBase: {\n    color: theme.palette.secondary.contrastText,\n  },\n  inputRoot: {\n    '&:hover': {\n      backgroundColor: theme.palette.secondary.light,\n    },\n  },\n  inputFocused: {\n    borderColor: theme.palette.primary.main,\n    backgroundColor: theme.palette.secondary.light,\n  },\n}))\nconst ViewContainerTitle = observer(function ({\n  view,\n}: {\n  view: IBaseViewModel\n}) {\n  const { classes } = useStyles()\n  return (\n    <Tooltip title=\"Rename view\" arrow>\n      <EditableTypography\n        value={\n          view.displayName ||\n          // @ts-expect-error\n          `${view.assemblyNames?.join(',') || 'Untitled view'}${\n            view.minimized ? ' (minimized)' : ''\n          }`\n        }\n        setValue={val => view.setDisplayName(val)}\n        variant=\"body2\"\n        classes={{\n          input: classes.input,\n          inputBase: classes.inputBase,\n          inputRoot: classes.inputRoot,\n          inputFocused: classes.inputFocused,\n        }}\n      />\n    </Tooltip>\n  )\n})\n\nexport default ViewContainerTitle\n","import React, { useEffect, useRef } from 'react'\nimport { IconButton } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\n\n// icons\nimport CloseIcon from '@mui/icons-material/Close'\nimport MinimizeIcon from '@mui/icons-material/Minimize'\nimport AddIcon from '@mui/icons-material/Add'\nimport KeyboardArrowRightIcon from '@mui/icons-material/KeyboardArrowRight'\n\n// locals\nimport ViewMenu from './ViewMenu'\nimport ViewContainerTitle from './ViewContainerTitle'\nimport { getSession } from '@jbrowse/core/util'\n\nconst useStyles = makeStyles()(theme => ({\n  icon: {\n    color: theme.palette.secondary.contrastText,\n  },\n  grow: {\n    flexGrow: 1,\n  },\n  viewHeader: {\n    display: 'flex',\n  },\n  viewTitle: {\n    display: 'flex',\n    alignItems: 'center',\n  },\n}))\n\nconst ViewButtons = observer(function ({\n  view,\n  onClose,\n  onMinimize,\n}: {\n  view: IBaseViewModel\n  onClose: () => void\n  onMinimize: () => void\n}) {\n  const { classes } = useStyles()\n  return (\n    <>\n      <IconButton data-testid=\"minimize_view\" onClick={onMinimize}>\n        {view.minimized ? (\n          <AddIcon className={classes.icon} fontSize=\"small\" />\n        ) : (\n          <MinimizeIcon className={classes.icon} fontSize=\"small\" />\n        )}\n      </IconButton>\n      <IconButton data-testid=\"close_view\" onClick={onClose}>\n        <CloseIcon className={classes.icon} fontSize=\"small\" />\n      </IconButton>\n    </>\n  )\n})\n\nconst ViewHeader = observer(function ({\n  view,\n  onClose,\n  onMinimize,\n}: {\n  view: IBaseViewModel\n  onClose: () => void\n  onMinimize: () => void\n}) {\n  const { classes } = useStyles()\n  const scrollRef = useRef<HTMLDivElement>(null)\n  const session = getSession(view)\n\n  // scroll the view into view when first mounted. note: this effect will run\n  // only once, because of the empty array second param\n  useEffect(() => {\n    scrollRef.current?.scrollIntoView?.({ block: 'center' })\n  }, [])\n  return (\n    <div ref={scrollRef} className={classes.viewHeader}>\n      <ViewMenu model={view} IconProps={{ className: classes.icon }} />\n      <div className={classes.grow} />\n      <div className={classes.viewTitle}>\n        {session.focusedViewId === view.id ? (\n          <KeyboardArrowRightIcon className={classes.icon} fontSize=\"small\" />\n        ) : null}\n        <ViewContainerTitle view={view} />\n      </div>\n      <div className={classes.grow} />\n      <ViewButtons onClose={onClose} onMinimize={onMinimize} view={view} />\n    </div>\n  )\n})\n\nexport default ViewHeader\n","import React, { useEffect } from 'react'\nimport { Paper, useTheme } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { getSession, useWidthSetter } from '@jbrowse/core/util'\nimport { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes/models'\nimport { SessionWithFocusedViewAndDrawerWidgets } from '@jbrowse/core/util'\n\n// locals\nimport ViewHeader from './ViewHeader'\n\nconst useStyles = makeStyles()(theme => ({\n  viewContainer: {\n    overflow: 'hidden',\n    margin: theme.spacing(0.5),\n    padding: `0 ${theme.spacing(1)} ${theme.spacing(1)}`,\n  },\n  focusedView: {\n    background: theme.palette.secondary.main,\n  },\n  unfocusedView: {\n    background: theme.palette.secondary.dark,\n  },\n}))\n\nconst ViewContainer = observer(function ({\n  view,\n  onClose,\n  onMinimize,\n  children,\n}: {\n  view: IBaseViewModel\n  onClose: () => void\n  onMinimize: () => void\n  children: React.ReactNode\n}) {\n  const theme = useTheme()\n  const ref = useWidthSetter(view, theme.spacing(1))\n  const { classes, cx } = useStyles()\n  const session = getSession(view) as SessionWithFocusedViewAndDrawerWidgets\n\n  useEffect(() => {\n    function handleSelectView(e: Event) {\n      if (e.target instanceof Element) {\n        if (ref?.current && ref.current.contains(e.target)) {\n          session.setFocusedViewId(view.id)\n        }\n      }\n    }\n\n    document.addEventListener('mousedown', handleSelectView)\n    document.addEventListener('keydown', handleSelectView)\n    return () => {\n      document.removeEventListener('mousedown', handleSelectView)\n      document.removeEventListener('keydown', handleSelectView)\n    }\n  }, [ref, session, view])\n\n  return (\n    <Paper\n      ref={ref}\n      elevation={12}\n      className={cx(\n        classes.viewContainer,\n        session.focusedViewId === view.id\n          ? classes.focusedView\n          : classes.unfocusedView,\n      )}\n    >\n      <ViewHeader view={view} onClose={onClose} onMinimize={onMinimize} />\n      <Paper>{children}</Paper>\n    </Paper>\n  )\n})\n\nexport default ViewContainer\n","import React, { Suspense } from 'react'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport { observer } from 'mobx-react'\n\n// locals\nimport {\n  getEnv,\n  AbstractViewModel,\n  SessionWithDrawerWidgets,\n} from '@jbrowse/core/util'\nimport { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\n\n// ui elements\nimport ErrorMessage from '@jbrowse/core/ui/ErrorMessage'\nimport LoadingEllipses from '@jbrowse/core/ui/LoadingEllipses'\nimport { MenuItem as JBMenuItem } from '@jbrowse/core/ui/Menu'\n\n// locals\nimport ViewContainer from './ViewContainer'\n\ntype AppSession = SessionWithDrawerWidgets & {\n  savedSessionNames: string[]\n  menus: { label: string; menuItems: JBMenuItem[] }[]\n  snackbarMessages: SnackbarMessage[]\n  renameCurrentSession: (arg: string) => void\n  popSnackbarMessage: () => unknown\n}\n\nconst ViewPanel = observer(function ({\n  view,\n  session,\n}: {\n  view: AbstractViewModel\n  session: AppSession\n}) {\n  const { pluginManager } = getEnv(session)\n  const viewType = pluginManager.getViewType(view.type)\n  if (!viewType) {\n    throw new Error(`unknown view type ${view.type}`)\n  }\n  const { ReactComponent } = viewType\n  return (\n    <ViewContainer\n      view={view}\n      onClose={() => session.removeView(view)}\n      onMinimize={() => view.setMinimized(!view.minimized)}\n    >\n      {!view.minimized ? (\n        <ErrorBoundary\n          FallbackComponent={({ error }) => <ErrorMessage error={error} />}\n        >\n          <Suspense fallback={<LoadingEllipses variant=\"h6\" />}>\n            <ReactComponent model={view} session={session} />\n          </Suspense>\n        </ErrorBoundary>\n      ) : (\n        false\n      )}\n    </ViewContainer>\n  )\n})\n\nexport default ViewPanel\n","import React, { Suspense } from 'react'\nimport { observer } from 'mobx-react'\n\n// locals\nimport { SessionWithDrawerWidgets } from '@jbrowse/core/util'\n\nconst DialogQueue = observer(function ({\n  session,\n}: {\n  session: SessionWithDrawerWidgets\n}) {\n  const { DialogComponent, DialogProps } = session\n  return (\n    <>\n      {DialogComponent ? (\n        <Suspense fallback={<React.Fragment />}>\n          <DialogComponent {...DialogProps} />\n        </Suspense>\n      ) : null}\n    </>\n  )\n})\n\nexport default DialogQueue\n","import React from 'react'\nimport { Fab, Tooltip } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { SessionWithDrawerWidgets } from '@jbrowse/core/util'\n\n// icons\nimport LaunchIcon from '@mui/icons-material/Launch'\n\nconst useStyles = makeStyles()(theme => ({\n  left: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    left: theme.spacing(2),\n  },\n  right: {\n    zIndex: 10000,\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n  },\n}))\n\nconst AppFab = observer(function ({\n  session,\n}: {\n  session: SessionWithDrawerWidgets\n}) {\n  const { minimized, activeWidgets, drawerPosition } = session\n  const { classes } = useStyles()\n\n  return activeWidgets.size > 0 && minimized ? (\n    <Tooltip title=\"Open drawer widget\">\n      <Fab\n        className={drawerPosition === 'right' ? classes.right : classes.left}\n        color=\"primary\"\n        data-testid=\"drawer-maximize\"\n        onClick={() => session.showWidgetDrawer()}\n      >\n        <LaunchIcon />\n      </Fab>\n    </Tooltip>\n  ) : null\n})\n\nexport default AppFab\n","import React, { Suspense, lazy } from 'react'\nimport { AppBar } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { SessionWithFocusedViewAndDrawerWidgets } from '@jbrowse/core/util'\nimport Snackbar from '@jbrowse/core/ui/Snackbar'\nimport { SnackbarMessage } from '@jbrowse/core/ui/SnackbarModel'\nimport { MenuItem as JBMenuItem } from '@jbrowse/core/ui/Menu'\n\n// locals\nimport AppToolbar from './AppToolbar'\nimport ViewLauncher from './ViewLauncher'\nimport ViewPanel from './ViewPanel'\nimport DialogQueue from './DialogQueue'\nimport AppFab from './AppFab'\n\nconst DrawerWidget = lazy(() => import('./DrawerWidget'))\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    display: 'grid',\n    height: '100vh',\n    width: '100%',\n    colorScheme: theme.palette.mode,\n  },\n  appContainer: {\n    gridColumn: 'main',\n    display: 'grid',\n    gridTemplateRows: '[menubar] min-content [components] auto',\n    height: '100vh',\n  },\n  viewContainer: {\n    overflowY: 'auto',\n    gridRow: 'components',\n  },\n  appBar: {\n    flexGrow: 1,\n    gridRow: 'menubar',\n  },\n}))\n\ninterface Props {\n  HeaderButtons?: React.ReactElement\n  session: SessionWithFocusedViewAndDrawerWidgets & {\n    savedSessionNames: string[]\n    menus: { label: string; menuItems: JBMenuItem[] }[]\n    renameCurrentSession: (arg: string) => void\n    snackbarMessages: SnackbarMessage[]\n    popSnackbarMessage: () => unknown\n  }\n}\n\nconst LazyDrawerWidget = observer(function (props: Props) {\n  const { session } = props\n  return (\n    <Suspense fallback={<React.Fragment />}>\n      <DrawerWidget session={session} />\n    </Suspense>\n  )\n})\n\nconst ViewContainer = observer(function (props: Props) {\n  const { session } = props\n  const { views } = session\n  const { classes } = useStyles()\n  return (\n    <div className={classes.viewContainer}>\n      {views.length > 0 ? (\n        views.map(view => (\n          <ViewPanel key={`view-${view.id}`} view={view} session={session} />\n        ))\n      ) : (\n        <ViewLauncher {...props} />\n      )}\n\n      {/* blank space at the bottom of screen allows scroll */}\n      <div style={{ height: 300 }} />\n    </div>\n  )\n})\n\nconst App = observer(function (props: Props) {\n  const { session } = props\n  const { classes } = useStyles()\n  const { minimized, visibleWidget, drawerWidth, drawerPosition } = session\n  const drawerVisible = visibleWidget && !minimized\n  const d = drawerVisible ? `[drawer] ${drawerWidth}px` : undefined\n  const grid =\n    drawerPosition === 'right' ? ['[main] 1fr', d] : [d, '[main] 1fr']\n\n  return (\n    <div\n      className={classes.root}\n      style={{ gridTemplateColumns: grid?.filter(f => !!f).join(' ') }}\n    >\n      {drawerVisible && drawerPosition === 'left' ? (\n        <LazyDrawerWidget session={session} />\n      ) : null}\n      <DialogQueue session={session} />\n      <div className={classes.appContainer}>\n        <AppBar className={classes.appBar} position=\"static\">\n          <AppToolbar {...props} />\n        </AppBar>\n        <ViewContainer {...props} />\n      </div>\n      <AppFab session={session} />\n\n      {drawerVisible && drawerPosition === 'right' ? (\n        <LazyDrawerWidget session={session} />\n      ) : null}\n\n      <Snackbar session={session} />\n    </div>\n  )\n})\n\nexport { App }\n","// adapted from https://github.com/mobxjs/mobx-state-tree/blob/master/packages/mst-middlewares/src/time-traveller.ts\nimport {\n  types,\n  resolvePath,\n  getEnv,\n  onSnapshot,\n  getSnapshot,\n  applySnapshot,\n  IDisposer,\n  IAnyStateTreeNode,\n} from 'mobx-state-tree'\n\nconst MAX_HISTORY_LENGTH = 20\n\nfunction debounce(func: (...args: unknown[]) => void, timeout = 300) {\n  let timer: ReturnType<typeof setTimeout>\n  return (...args: unknown[]) => {\n    clearTimeout(timer)\n    timer = setTimeout(() => func(...args), timeout)\n  }\n}\n\nconst TimeTraveller = types\n  .model('TimeTraveller', {\n    undoIdx: -1,\n    targetPath: '',\n  })\n  .volatile(() => ({\n    history: [] as unknown[],\n    notTrackingUndo: false,\n  }))\n  .views(self => ({\n    get canUndo() {\n      return self.undoIdx > 0 && !self.notTrackingUndo\n    },\n    get canRedo() {\n      return self.undoIdx < self.history.length - 1 && !self.notTrackingUndo\n    },\n  }))\n  .actions(self => {\n    let targetStore: IAnyStateTreeNode\n    let snapshotDisposer: IDisposer\n    let skipNextUndoState = false\n\n    return {\n      // allows user code to (temporarily) stop tracking undo states\n      stopTrackingUndo() {\n        self.notTrackingUndo = true\n      },\n      // allows user code to resume tracking undo states\n      resumeTrackingUndo() {\n        self.notTrackingUndo = false\n      },\n      addUndoState(todos: unknown) {\n        if (self.notTrackingUndo) {\n          return\n        }\n        if (skipNextUndoState) {\n          // skip recording if this state was caused by undo / redo\n          skipNextUndoState = false\n          return\n        }\n        self.history.splice(self.undoIdx + 1)\n        self.history.push(todos)\n        if (self.history.length > MAX_HISTORY_LENGTH) {\n          self.history.shift()\n        }\n        self.undoIdx = self.history.length - 1\n      },\n\n      beforeDestroy() {\n        snapshotDisposer()\n      },\n      initialize() {\n        targetStore = self.targetPath\n          ? resolvePath(self, self.targetPath)\n          : getEnv(self).targetStore\n\n        if (!targetStore) {\n          throw new Error(\n            'Failed to find target store for TimeTraveller. Please provide `targetPath` property, or a `targetStore` in the environment',\n          )\n        }\n\n        snapshotDisposer = onSnapshot(\n          targetStore,\n          debounce((snapshot: unknown) => this.addUndoState(snapshot), 300),\n        )\n        if (self.history.length === 0) {\n          this.addUndoState(getSnapshot(targetStore))\n        }\n      },\n      undo() {\n        self.undoIdx--\n        skipNextUndoState = true\n        applySnapshot(targetStore, self.history[self.undoIdx])\n      },\n      redo() {\n        self.undoIdx++\n        skipNextUndoState = true\n        applySnapshot(targetStore, self.history[self.undoIdx])\n      },\n    }\n  })\n\nexport default TimeTraveller\n","import { ConfigurationSchema } from '../configuration'\n\n/**\n * #config BaseRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst BaseRpcDriverConfigSchema = ConfigurationSchema(\n  'BaseRpcDriver',\n  {\n    /**\n     * #slot\n     */\n    workerCount: {\n      type: 'number',\n      description:\n        'The number of workers to use. If 0 (the default) JBrowse will decide how many workers to use.',\n      defaultValue: 0,\n    },\n  },\n  { explicitlyTyped: true },\n)\nexport default BaseRpcDriverConfigSchema\n","import { ConfigurationSchema } from '../configuration'\nimport BaseRpcDriverConfigSchema from './baseRpcConfig'\n\n/**\n * #config WebWorkerRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst WebWorkerRpcDriverConfigSchema = ConfigurationSchema(\n  'WebWorkerRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default WebWorkerRpcDriverConfigSchema\n","import { ConfigurationSchema } from '../configuration'\nimport BaseRpcDriverConfigSchema from './baseRpcConfig'\n\n/**\n * #config MainThreadRpcDriver\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nconst MainThreadRpcDriverConfigSchema = ConfigurationSchema(\n  'MainThreadRpcDriver',\n  {},\n  {\n    /**\n     * #baseConfiguration\n     */\n    baseConfiguration: BaseRpcDriverConfigSchema,\n    explicitlyTyped: true,\n  },\n)\nexport default MainThreadRpcDriverConfigSchema\n","import { types } from 'mobx-state-tree'\nimport { ConfigurationSchema } from '../configuration'\nimport WebWorkerRpcDriverConfigSchema from './webWorkerRpcConfig'\nimport MainThreadRpcDriverConfigSchema from './mainThreadRpcConfig'\n\n/**\n * #config RpcOptions\n */\nfunction x() {} // eslint-disable-line @typescript-eslint/no-unused-vars\n\nexport default ConfigurationSchema(\n  'RpcOptions',\n  {\n    /**\n     * #slot\n     */\n    defaultDriver: {\n      type: 'string',\n      description:\n        'the RPC driver to use for tracks and tasks that are not configured to use a specific RPC backend',\n      defaultValue: 'MainThreadRpcDriver',\n    },\n    /**\n     * #slot\n     */\n    drivers: types.optional(\n      types.map(\n        types.union(\n          MainThreadRpcDriverConfigSchema,\n          WebWorkerRpcDriverConfigSchema,\n        ),\n      ),\n      {\n        MainThreadRpcDriver: { type: 'MainThreadRpcDriver' },\n        WebWorkerRpcDriver: { type: 'WebWorkerRpcDriver' },\n      },\n    ),\n  },\n  {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    actions: (self: any) => ({\n      addDriverConfig(configName: string, configSnapshot: { type: string }) {\n        self.drivers.set(configName, configSnapshot)\n      },\n    }),\n  },\n)\n","import { isAlive, isStateTreeNode } from 'mobx-state-tree'\nimport { clamp } from '../util'\nimport { serializeAbortSignal } from './remoteAbortSignals'\nimport PluginManager from '../PluginManager'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nexport interface WorkerHandle {\n  status?: string\n  error?: Error\n  on?: (channel: string, callback: (message: string) => void) => void\n  off?: (channel: string, callback: (message: string) => void) => void\n  destroy(): void\n  call(\n    functionName: string,\n    args?: unknown,\n    options?: {\n      statusCallback?(message: string): void\n      timeout?: number\n      rpcDriverClassName: string\n    },\n  ): Promise<unknown>\n}\n\nexport interface RpcDriverConstructorArgs {\n  config: AnyConfigurationModel\n}\n\nfunction isClonable(thing: unknown) {\n  return !(typeof thing === 'function') && !(thing instanceof Error)\n}\n\n// watches the given worker object, returns a promise that will be rejected if\n// the worker times out\nexport async function watchWorker(\n  worker: WorkerHandle,\n  pingTime: number,\n  rpcDriverClassName: string,\n) {\n  // after first ping succeeds, apply wait for timeout\n  while (true) {\n    await worker.call('ping', [], {\n      timeout: pingTime * 2,\n      rpcDriverClassName,\n    })\n    await new Promise(resolve => setTimeout(resolve, pingTime))\n  }\n}\n\nfunction detectHardwareConcurrency() {\n  const mainThread = typeof window !== 'undefined'\n  const canDetect = mainThread && 'hardwareConcurrency' in window.navigator\n  if (mainThread && canDetect) {\n    return window.navigator.hardwareConcurrency\n  }\n  return 1\n}\nclass LazyWorker {\n  workerP?: Promise<WorkerHandle> | undefined\n\n  constructor(public driver: BaseRpcDriver) {}\n\n  async getWorker() {\n    if (!this.workerP) {\n      this.workerP = this.driver\n        .makeWorker()\n        .then(worker => {\n          watchWorker(worker, this.driver.maxPingTime, this.driver.name).catch(\n            error => {\n              if (worker) {\n                console.error(\n                  'worker did not respond, killing and generating new one',\n                )\n                console.error(error)\n                worker.destroy()\n                worker.status = 'killed'\n                worker.error = error\n                this.workerP = undefined\n              }\n            },\n          )\n          return worker\n        })\n        .catch(e => {\n          this.workerP = undefined\n          throw e\n        })\n    }\n    return this.workerP\n  }\n}\n\nexport default abstract class BaseRpcDriver {\n  abstract name: string\n\n  private lastWorkerAssignment = -1\n\n  private workerAssignments = new Map<string, number>() // sessionId -> worker number\n\n  abstract makeWorker(): Promise<WorkerHandle>\n\n  private workerPool?: LazyWorker[]\n\n  maxPingTime = 30000\n\n  workerCheckFrequency = 5000\n\n  config: AnyConfigurationModel\n\n  constructor(args: RpcDriverConstructorArgs) {\n    this.config = args.config\n  }\n\n  // filter the given object and just remove any non-clonable things from it\n  filterArgs<THING_TYPE>(thing: THING_TYPE, sessionId: string): THING_TYPE {\n    if (Array.isArray(thing)) {\n      return thing\n        .filter(thing => isClonable(thing))\n        .map(t => this.filterArgs(t, sessionId)) as unknown as THING_TYPE\n    }\n    if (typeof thing === 'object' && thing !== null) {\n      // AbortSignals are specially handled\n      if (thing instanceof AbortSignal) {\n        return serializeAbortSignal(\n          thing,\n          this.remoteAbort.bind(this, sessionId),\n        ) as unknown as THING_TYPE\n      }\n\n      if (isStateTreeNode(thing) && !isAlive(thing)) {\n        throw new Error('dead state tree node passed to RPC call')\n      }\n\n      // special case, don't try to iterate the file's subelements as the\n      // object entries below would\n      if (thing instanceof File) {\n        return thing\n      }\n\n      return Object.fromEntries(\n        Object.entries(thing)\n          .filter(e => isClonable(e[1]))\n          .map(([k, v]) => [k, this.filterArgs(v, sessionId)]),\n      ) as THING_TYPE\n    }\n    return thing\n  }\n\n  async remoteAbort(sessionId: string, functionName: string, signalId: number) {\n    const worker = await this.getWorker(sessionId)\n    await worker.call(\n      functionName,\n      { signalId },\n      { timeout: 1000000, rpcDriverClassName: this.name },\n    )\n  }\n\n  createWorkerPool(): LazyWorker[] {\n    const hardwareConcurrency = detectHardwareConcurrency()\n\n    const workerCount =\n      readConfObject(this.config, 'workerCount') ||\n      clamp(1, Math.max(1, hardwareConcurrency - 1), 5)\n\n    const workers = []\n    for (let i = 0; i < workerCount; i++) {\n      workers.push(new LazyWorker(this))\n    }\n    return workers\n  }\n\n  getWorkerPool() {\n    if (!this.workerPool) {\n      const res = this.createWorkerPool()\n      this.workerPool = res\n      return res // making this several steps makes TS happy\n    }\n    return this.workerPool\n  }\n\n  async getWorker(sessionId: string): Promise<WorkerHandle> {\n    const workers = this.getWorkerPool()\n    let workerNumber = this.workerAssignments.get(sessionId)\n    if (workerNumber === undefined) {\n      const workerAssignment = (this.lastWorkerAssignment + 1) % workers.length\n      this.workerAssignments.set(sessionId, workerAssignment)\n      this.lastWorkerAssignment = workerAssignment\n      workerNumber = workerAssignment\n    }\n\n    return workers[workerNumber].getWorker()\n  }\n\n  async call(\n    pluginManager: PluginManager,\n    sessionId: string,\n    functionName: string,\n    args: { statusCallback?: (message: string) => void },\n    options = {},\n  ) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    let done = false\n    const unextendedWorker = await this.getWorker(sessionId)\n    const worker = pluginManager.evaluateExtensionPoint(\n      'Core-extendWorker',\n      unextendedWorker,\n    ) as WorkerHandle\n    const rpcMethod = pluginManager.getRpcMethodType(functionName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const filteredAndSerializedArgs = this.filterArgs(serializedArgs, sessionId)\n\n    // now actually call the worker\n    const callP = worker\n      .call(functionName, filteredAndSerializedArgs, {\n        timeout: 5 * 60 * 1000, // 5 minutes\n        statusCallback: args.statusCallback,\n        rpcDriverClassName: this.name,\n        ...options,\n      })\n      .finally(() => {\n        done = true\n      })\n\n    // check every 5 seconds to see if the worker has been killed, and\n    // reject the killedP promise if it has\n    let killedCheckInterval: ReturnType<typeof setInterval>\n    const killedP = new Promise((resolve, reject) => {\n      killedCheckInterval = setInterval(() => {\n        // must've been killed\n        if (worker.status === 'killed') {\n          reject(\n            new Error(\n              `operation timed out, worker process stopped responding, ${worker.error}`,\n            ),\n          )\n        } else if (done) {\n          resolve(true)\n        }\n      }, this.workerCheckFrequency)\n    }).finally(() => {\n      clearInterval(killedCheckInterval)\n    })\n\n    // the result is a race between the actual result promise, and the \"killed\"\n    // promise. the killed promise will only actually win if the worker was\n    // killed before the call could return\n    const resultP = Promise.race([callP, killedP])\n    return rpcMethod.deserializeReturn(resultP, args, this.name)\n  }\n}\n","import Rpc from 'librpc-web-mod'\nimport { deserializeError } from 'serialize-error'\n\n// locals\nimport { nanoid } from '../util/nanoid'\nimport BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport { PluginDefinition } from '../PluginLoader'\n\ninterface WebWorkerRpcDriverConstructorArgs extends RpcDriverConstructorArgs {\n  makeWorkerInstance: () => Worker\n}\n\ninterface Options {\n  statusCallback?: (arg0: string) => void\n  rpcDriverClassName: string\n}\n\nclass WebWorkerHandle extends Rpc.Client {\n  destroy(): void {\n    this.workers[0].terminate()\n  }\n\n  async call(funcName: string, args: Record<string, unknown>, opts: Options) {\n    const { statusCallback, rpcDriverClassName } = opts\n    const channel = `message-${nanoid()}`\n    const listener = (message: string) => {\n      statusCallback?.(message)\n    }\n    this.on(channel, listener)\n    const result = await super.call(\n      funcName,\n      { ...args, channel, rpcDriverClassName },\n      opts,\n    )\n    this.off(channel, listener)\n    return result\n  }\n}\n\nexport default class WebWorkerRpcDriver extends BaseRpcDriver {\n  name = 'WebWorkerRpcDriver'\n\n  makeWorkerInstance: () => Worker\n\n  constructor(\n    args: WebWorkerRpcDriverConstructorArgs,\n    public workerBootConfiguration: {\n      plugins: PluginDefinition[]\n      windowHref: string\n    },\n  ) {\n    super(args)\n    this.makeWorkerInstance = args.makeWorkerInstance\n  }\n\n  async makeWorker() {\n    // note that we are making a Rpc.Client connection with a worker pool of\n    // one for each worker, because we want to do our own state-group-aware\n    // load balancing rather than using librpc's builtin round-robin\n    const instance = this.makeWorkerInstance()\n\n    // @ts-ignore this is used to avoid warning in jbrowse-web startup\n    // (because this file is referred to via src, declare.d.ts file is in\n    // e.g. products/jbrowse-web)\n    const worker = new WebWorkerHandle({ workers: [instance] })\n    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\n    if (isSafari) {\n      // xref https://github.com/GMOD/jbrowse-components/issues/3245\n      // eslint-disable-next-line no-console\n      console.log(\n        'console logging the webworker handle avoids the track going into an infinite loading state, this is a hacky workaround for safari',\n        instance,\n      )\n    }\n\n    // send the worker its boot configuration using info from the pluginManager\n    return new Promise((resolve: (w: WebWorkerHandle) => void, reject) => {\n      const listener = (e: MessageEvent) => {\n        switch (e.data.message) {\n          case 'ready': {\n            resolve(worker)\n            worker.workers[0].removeEventListener('message', listener)\n            break\n          }\n          case 'readyForConfig': {\n            worker.workers[0].postMessage({\n              message: 'config',\n              config: this.workerBootConfiguration,\n            })\n            break\n          }\n          case 'error': {\n            reject(deserializeError(e.data.error))\n            break\n          }\n          // No default\n        }\n      }\n      worker.workers[0].addEventListener('message', listener)\n    })\n  }\n}\n","import BaseRpcDriver, { RpcDriverConstructorArgs } from './BaseRpcDriver'\nimport PluginManager from '../PluginManager'\n\nclass DummyHandle {\n  destroy(): void {}\n\n  async call(\n    _functionName: string,\n    _filteredArgs?: {},\n    _options = {},\n  ): Promise<unknown> {\n    return undefined\n  }\n}\n\n/**\n * Stub RPC driver class that runs RPC functions in-band in the main thread.\n *\n * @param rpcFuncs - object containing runnable rpc functions\n */\nexport default class MainThreadRpcDriver extends BaseRpcDriver {\n  name = 'MainThreadRpcDriver'\n\n  makeWorker: () => Promise<DummyHandle>\n\n  constructor(args: RpcDriverConstructorArgs) {\n    super(args)\n    this.makeWorker = async (): Promise<DummyHandle> => new DummyHandle()\n  }\n\n  async call(pm: PluginManager, sessionId: string, funcName: string, args: {}) {\n    if (!sessionId) {\n      throw new TypeError('sessionId is required')\n    }\n    const rpcMethod = pm.getRpcMethodType(funcName)\n    const serializedArgs = await rpcMethod.serializeArguments(args, this.name)\n    const result = await rpcMethod.execute(serializedArgs, this.name)\n    return rpcMethod.deserializeReturn(result, args, this.name)\n  }\n}\n","import PluginManager from '../PluginManager'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\nimport rpcConfigSchema from './configSchema'\nimport WebWorkerRpcDriver from './WebWorkerRpcDriver'\nimport MainThreadRpcDriver from './MainThreadRpcDriver'\n\ntype DriverClass = WebWorkerRpcDriver | MainThreadRpcDriver\ninterface BackendConfigurations {\n  WebWorkerRpcDriver?: Omit<\n    ConstructorParameters<typeof WebWorkerRpcDriver>[0],\n    'config'\n  >\n  MainThreadRpcDriver?: Omit<\n    ConstructorParameters<typeof MainThreadRpcDriver>[0],\n    'config'\n  >\n}\nconst DriverClasses = {\n  WebWorkerRpcDriver,\n  MainThreadRpcDriver,\n}\n\nexport default class RpcManager {\n  static configSchema = rpcConfigSchema\n\n  driverObjects: Map<string, DriverClass>\n\n  constructor(\n    public pluginManager: PluginManager,\n    public mainConfiguration: AnyConfigurationModel,\n    public backendConfigurations: BackendConfigurations,\n  ) {\n    if (!mainConfiguration) {\n      throw new Error('RpcManager requires at least a main configuration')\n    }\n    this.driverObjects = new Map()\n  }\n\n  getDriver(backendName: keyof typeof DriverClasses) {\n    const driver = this.driverObjects.get(backendName)\n    if (driver) {\n      return driver\n    }\n    let newDriver\n    const config = this.mainConfiguration.drivers.get('WebWorkerRpcDriver')\n    if (backendName === 'MainThreadRpcDriver') {\n      const backendConfiguration =\n        this.backendConfigurations.MainThreadRpcDriver\n\n      if (!backendConfiguration) {\n        throw new Error(\n          `requested RPC driver \"${backendName}\" is missing config`,\n        )\n      }\n      newDriver = new MainThreadRpcDriver({ ...backendConfiguration, config })\n    } else if (backendName === 'WebWorkerRpcDriver') {\n      const backendConfiguration = this.backendConfigurations.WebWorkerRpcDriver\n      if (!backendConfiguration) {\n        throw new Error(\n          `requested RPC driver \"${backendName}\" is missing config`,\n        )\n      }\n      newDriver = new WebWorkerRpcDriver(\n        { ...backendConfiguration, config },\n        {\n          plugins: this.pluginManager.runtimePluginDefinitions,\n          windowHref: window.location.href,\n        },\n      )\n    } else {\n      throw new Error(`requested RPC driver \"${backendName}\" is not installed`)\n    }\n    this.driverObjects.set(backendName, newDriver)\n    return newDriver\n  }\n\n  async getDriverForCall(\n    _sessionId: string,\n    _functionName: string,\n    args: { rpcDriverName?: string },\n  ) {\n    const backendName =\n      args.rpcDriverName ||\n      readConfObject(this.mainConfiguration, 'defaultDriver')\n\n    return this.getDriver(backendName)\n  }\n\n  async call(sessionId: string, functionName: string, args: {}, opts = {}) {\n    if (!sessionId) {\n      throw new Error('sessionId is required')\n    }\n    const driverForCall = await this.getDriverForCall(\n      sessionId,\n      functionName,\n      args,\n    )\n    return driverForCall.call(\n      this.pluginManager,\n      sessionId,\n      functionName,\n      args,\n      opts,\n    )\n  }\n}\n","import React, { useState, lazy } from 'react'\nimport { observer } from 'mobx-react'\nimport { Button, alpha } from '@mui/material'\nimport { makeStyles } from 'tss-react/mui'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\n\n// icons\nimport ShareIcon from '@mui/icons-material/Share'\n\nconst useStyles = makeStyles()(theme => ({\n  shareDiv: {\n    textAlign: 'center',\n    paddingLeft: '2px',\n  },\n  shareButton: {\n    backgroundColor: alpha(\n      theme.palette.primary.contrastText,\n      theme.palette.action.hoverOpacity,\n    ),\n    '&:hover': {\n      '@media (hover: none)': {\n        backgroundColor: 'transparent',\n      },\n    },\n  },\n}))\n\nconst ShareDialog = lazy(() => import('./ShareDialog'))\n\nconst ShareButton = observer(function (props: {\n  session: AbstractSessionModel & { shareURL: string }\n}) {\n  const [open, setOpen] = useState(false)\n  const { session } = props\n  const { classes } = useStyles()\n\n  return (\n    <div className={classes.shareDiv}>\n      <Button\n        onClick={async () => setOpen(true)}\n        size=\"small\"\n        color=\"inherit\"\n        startIcon={<ShareIcon />}\n        classes={{ root: classes.shareButton }}\n      >\n        Share\n      </Button>\n      {open ? (\n        <React.Suspense fallback={<React.Fragment />}>\n          <ShareDialog handleClose={() => setOpen(false)} session={session} />\n        </React.Suspense>\n      ) : null}\n    </div>\n  )\n})\n\nexport default ShareButton\n","import React, { useEffect } from 'react'\nimport { observer } from 'mobx-react'\nimport { onSnapshot } from 'mobx-state-tree'\nimport { useQueryParam, StringParam } from 'use-query-params'\nimport { CssBaseline, ThemeProvider } from '@mui/material'\n\n// core\nimport { App } from '@jbrowse/app-core'\nimport PluginManager from '@jbrowse/core/PluginManager'\n\n// locals\nimport ShareButton from './ShareButton'\nimport { WebSessionModel } from '../sessionModel'\n\nconst JBrowse = observer(function ({\n  pluginManager,\n}: {\n  pluginManager: PluginManager\n}) {\n  const [adminKey] = useQueryParam('adminKey', StringParam)\n  const [adminServer] = useQueryParam('adminServer', StringParam)\n  const [configPath] = useQueryParam('config', StringParam)\n  const [, setSessionId] = useQueryParam('session', StringParam)\n  const { rootModel } = pluginManager\n  const { error, jbrowse } = rootModel || {}\n  const session = rootModel?.session as WebSessionModel\n  const currentSessionId = session.id\n\n  useEffect(() => {\n    setSessionId(`local-${currentSessionId}`, 'replaceIn')\n    // @ts-expect-error\n    window.JBrowseRootModel = rootModel\n    // @ts-expect-error\n    window.JBrowseSession = session\n  }, [currentSessionId, rootModel, session, setSessionId])\n\n  useEffect(() => {\n    if (!jbrowse || !adminKey) {\n      return\n    }\n    return onSnapshot(jbrowse, async snapshot => {\n      try {\n        const response = await fetch(adminServer || `/updateConfig`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            adminKey,\n            configPath,\n            config: snapshot,\n          }),\n        })\n        if (!response.ok) {\n          const message = await response.text()\n          throw new Error(`HTTP ${response.status} (${message})`)\n        }\n      } catch (e) {\n        session?.notify(`Admin server error: ${e}`)\n      }\n    })\n  }, [jbrowse, session, adminKey, adminServer, configPath])\n\n  if (error) {\n    throw error\n  }\n  if (!rootModel) {\n    throw new Error('No rootModel found')\n  }\n  if (!session) {\n    throw new Error('No session found')\n  }\n\n  return (\n    <ThemeProvider theme={session.theme}>\n      <CssBaseline />\n      <App\n        session={session}\n        HeaderButtons={<ShareButton session={session} />}\n      />\n    </ThemeProvider>\n  )\n})\n\nexport default JBrowse\n","import { types, addDisposer, Instance } from 'mobx-state-tree'\nimport { autorun } from 'mobx'\nimport PluginLoader, {\n  PluginDefinition,\n  PluginRecord,\n} from '@jbrowse/core/PluginLoader'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { openLocation } from '@jbrowse/core/util/io'\nimport { nanoid } from '@jbrowse/core/util/nanoid'\n\n// locals\nimport { readSessionFromDynamo } from './sessionSharing'\nimport { addRelativeUris, checkPlugins, fromUrlSafeB64, readConf } from './util'\n\nexport interface SessionTriagedInfo {\n  snap: unknown\n  origin: string\n  reason: PluginDefinition[]\n}\n\nconst SessionLoader = types\n  .model({\n    configPath: types.maybe(types.string),\n    sessionQuery: types.maybe(types.string),\n    password: types.maybe(types.string),\n    adminKey: types.maybe(types.string),\n    loc: types.maybe(types.string),\n    sessionTracks: types.maybe(types.string),\n    assembly: types.maybe(types.string),\n    tracks: types.maybe(types.string),\n    initialTimestamp: types.number,\n  })\n  .volatile(() => ({\n    sessionTriaged: undefined as SessionTriagedInfo | undefined,\n    configSnapshot: undefined as Record<string, unknown> | undefined,\n    sessionSnapshot: undefined as Record<string, unknown> | undefined,\n    sessionSpec: undefined as Record<string, unknown> | undefined,\n    blankSession: false,\n    runtimePlugins: [] as PluginRecord[],\n    sessionPlugins: [] as PluginRecord[],\n    sessionError: undefined as unknown,\n    configError: undefined as unknown,\n    bc1:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_request_session'),\n    bc2:\n      window.BroadcastChannel &&\n      new window.BroadcastChannel('jb_respond_session'),\n  }))\n  .views(self => ({\n    get isSharedSession() {\n      return !!self.sessionQuery?.startsWith('share-')\n    },\n\n    get isSpecSession() {\n      return !!self.sessionQuery?.startsWith('spec-')\n    },\n\n    get isJb1StyleSession() {\n      return !!self.loc\n    },\n\n    get isEncodedSession() {\n      return !!self.sessionQuery?.startsWith('encoded-')\n    },\n\n    get isJsonSession() {\n      return !!self.sessionQuery?.startsWith('json-')\n    },\n\n    get isLocalSession() {\n      return !!self.sessionQuery?.startsWith('local-')\n    },\n\n    get ready() {\n      return Boolean(this.isSessionLoaded && !self.configError)\n    },\n\n    get error() {\n      return self.configError || self.sessionError\n    },\n\n    get isSessionLoaded() {\n      return Boolean(\n        self.sessionError ||\n          self.sessionSnapshot ||\n          self.blankSession ||\n          self.sessionSpec,\n      )\n    },\n    get isConfigLoaded() {\n      return Boolean(self.configError || self.configSnapshot)\n    },\n\n    get sessionTracksParsed() {\n      return self.sessionTracks ? JSON.parse(self.sessionTracks) : []\n    },\n  }))\n  .actions(self => ({\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,\n    setSessionQuery(session?: any) {\n      self.sessionQuery = session\n    },\n    setConfigError(error: unknown) {\n      self.configError = error\n    },\n    setSessionError(error: unknown) {\n      self.sessionError = error\n    },\n    setRuntimePlugins(plugins: PluginRecord[]) {\n      self.runtimePlugins = plugins\n    },\n    setSessionPlugins(plugins: PluginRecord[]) {\n      self.sessionPlugins = plugins\n    },\n    setConfigSnapshot(snap: Record<string, unknown>) {\n      self.configSnapshot = snap\n    },\n\n    setBlankSession(flag: boolean) {\n      self.blankSession = flag\n    },\n    setSessionTriaged(args?: SessionTriagedInfo) {\n      self.sessionTriaged = args\n    },\n    setSessionSnapshotSuccess(snap: Record<string, unknown>) {\n      self.sessionSnapshot = snap\n    },\n  }))\n  .actions(self => ({\n    async fetchPlugins(config: { plugins: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(config.plugins, {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        })\n        pluginLoader.installGlobalReExports(window)\n        const runtimePlugins = await pluginLoader.load(window.location.href)\n        self.setRuntimePlugins([...runtimePlugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n    async fetchSessionPlugins(snap: { sessionPlugins?: PluginDefinition[] }) {\n      try {\n        const pluginLoader = new PluginLoader(snap.sessionPlugins || [], {\n          fetchESM: url => import(/* webpackIgnore:true */ url),\n        })\n        pluginLoader.installGlobalReExports(window)\n        const plugins = await pluginLoader.load(window.location.href)\n        self.setSessionPlugins([...plugins])\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    // passed\n    async setSessionSnapshot(\n      snap: { sessionPlugins?: PluginDefinition[]; id: string },\n      userAcceptedConfirmation?: boolean,\n    ) {\n      try {\n        const { sessionPlugins = [] } = snap\n        const sessionPluginsAllowed = await checkPlugins(sessionPlugins)\n        if (sessionPluginsAllowed || userAcceptedConfirmation) {\n          await this.fetchSessionPlugins(snap)\n          self.setSessionSnapshotSuccess(snap)\n        } else {\n          self.setSessionTriaged({\n            snap,\n            origin: 'session',\n            reason: sessionPlugins,\n          })\n        }\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n      }\n    },\n\n    async fetchConfig() {\n      // @ts-expect-error\n      // eslint-disable-next-line no-underscore-dangle\n      let { configPath = window.__jbrowseConfigPath || 'config.json' } = self\n\n      // @ts-expect-error\n      // eslint-disable-next-line no-underscore-dangle\n      if (window.__jbrowseCacheBuster) {\n        configPath += `?rand=${Math.random()}`\n      }\n\n      const text = await openLocation({\n        uri: configPath,\n        locationType: 'UriLocation',\n      }).readFile('utf8')\n      const config = JSON.parse(text)\n      const configUri = new URL(configPath, window.location.href)\n      addRelativeUris(config, configUri)\n\n      // cross origin config check\n      if (configUri.hostname !== window.location.hostname) {\n        const configPlugins = config.plugins || []\n        const configPluginsAllowed = await checkPlugins(configPlugins)\n        if (!configPluginsAllowed) {\n          return self.setSessionTriaged({\n            snap: config,\n            origin: 'config',\n            reason: configPlugins,\n          })\n        }\n      }\n      await this.fetchPlugins(config)\n      self.setConfigSnapshot(config)\n    },\n\n    async fetchSessionStorageSession() {\n      const sessionStr = sessionStorage.getItem('current')\n      const query = self.sessionQuery!.replace('local-', '')\n\n      // check if\n      if (sessionStr) {\n        const sessionSnap = JSON.parse(sessionStr).session || {}\n        if (query === sessionSnap.id) {\n          return this.setSessionSnapshot(sessionSnap)\n        }\n      }\n\n      if (self.bc1) {\n        self.bc1.postMessage(query)\n        try {\n          const result = await new Promise<Record<string, unknown>>(\n            (resolve, reject) => {\n              if (self.bc2) {\n                self.bc2.onmessage = msg => {\n                  resolve(msg.data)\n                }\n              }\n              setTimeout(() => reject(), 1000)\n            },\n          )\n          return this.setSessionSnapshot({ ...result, id: nanoid() })\n        } catch (e) {\n          // the broadcast channels did not find the session in another tab\n          // clear session param, so just ignore\n        }\n      }\n      throw new Error('Local storage session not found')\n    },\n\n    async fetchSharedSession() {\n      const defaultURL = 'https://share.jbrowse.org/api/v1/'\n      const decryptedSession = await readSessionFromDynamo(\n        // @ts-expect-error\n        `${readConf(self.configSnapshot, 'shareURL', defaultURL)}load`,\n        self.sessionQuery || '',\n        self.password || '',\n      )\n\n      const session = JSON.parse(await fromUrlSafeB64(decryptedSession))\n      await this.setSessionSnapshot({ ...session, id: nanoid() })\n    },\n\n    async decodeEncodedUrlSession() {\n      const session = JSON.parse(\n        // @ts-expect-error\n        await fromUrlSafeB64(self.sessionQuery.replace('encoded-', '')),\n      )\n      await this.setSessionSnapshot({ ...session, id: nanoid() })\n    },\n\n    decodeSessionSpec() {\n      if (!self.sessionQuery) {\n        return\n      }\n      self.sessionSpec = JSON.parse(self.sessionQuery.replace('spec-', ''))\n    },\n\n    decodeJb1StyleSession() {\n      const { loc, tracks, assembly, sessionTracksParsed: sessionTracks } = self\n      if (loc) {\n        self.sessionSpec = {\n          sessionTracks,\n          views: [\n            {\n              type: 'LinearGenomeView',\n              tracks: tracks?.split(','),\n              sessionTracks,\n              loc,\n              assembly,\n            },\n          ],\n        }\n      }\n    },\n\n    async decodeJsonUrlSession() {\n      // @ts-expect-error\n      const session = JSON.parse(self.sessionQuery.replace('json-', ''))\n      await this.setSessionSnapshot({ ...session.session, id: nanoid() })\n    },\n\n    async afterCreate() {\n      try {\n        // rename the current autosave from previously loaded jbrowse session\n        // into previousAutosave on load\n        const { configPath } = self\n        const lastAutosave = localStorage.getItem(`autosave-${configPath}`)\n        if (lastAutosave) {\n          localStorage.setItem(`previousAutosave-${configPath}`, lastAutosave)\n        }\n      } catch (e) {\n        console.error('failed to create previousAutosave', e)\n      }\n\n      try {\n        // fetch config\n        await this.fetchConfig()\n      } catch (e) {\n        console.error(e)\n        self.setConfigError(e)\n        return\n      }\n\n      addDisposer(\n        self,\n        autorun(async () => {\n          try {\n            const {\n              isLocalSession,\n              isEncodedSession,\n              isSpecSession,\n              isSharedSession,\n              isJsonSession,\n              isJb1StyleSession,\n              sessionQuery,\n              configSnapshot,\n            } = self\n            if (!configSnapshot) {\n              return\n            }\n\n            if (self.bc1) {\n              self.bc1.onmessage = msg => {\n                const r =\n                  JSON.parse(sessionStorage.getItem('current') || '{}')\n                    .session || {}\n                if (r.id === msg.data && self.bc2) {\n                  self.bc2.postMessage(r)\n                }\n              }\n            }\n\n            if (isSharedSession) {\n              await this.fetchSharedSession()\n            } else if (isSpecSession) {\n              this.decodeSessionSpec()\n            } else if (isJb1StyleSession) {\n              this.decodeJb1StyleSession()\n            } else if (isEncodedSession) {\n              await this.decodeEncodedUrlSession()\n            } else if (isJsonSession) {\n              await this.decodeJsonUrlSession()\n            } else if (isLocalSession) {\n              await this.fetchSessionStorageSession()\n            } else if (sessionQuery) {\n              // if there was a sessionQuery and we don't recognize it\n              throw new Error('unrecognized session format')\n            } else {\n              // placeholder for session loaded, but none found\n              self.setBlankSession(true)\n            }\n          } catch (e) {\n            console.error(e)\n            self.setSessionError(e)\n          }\n        }),\n      )\n    },\n  }))\n\nexport type SessionLoaderModel = Instance<typeof SessionLoader>\n\nexport default SessionLoader\n\ninterface ViewSpec {\n  type: string\n  tracks?: string[]\n  assembly: string\n  loc: string\n}\n\n// use extension point named e.g. LaunchView-LinearGenomeView to initialize an\n// LGV session\nexport function loadSessionSpec(\n  {\n    views,\n    sessionTracks = [],\n  }: {\n    views: ViewSpec[]\n    sessionTracks: unknown[]\n  },\n  pluginManager: PluginManager,\n) {\n  return async () => {\n    const { rootModel } = pluginManager\n    if (!rootModel) {\n      throw new Error('rootModel not initialized')\n    }\n    try {\n      // @ts-expect-error\n      rootModel.setSession({\n        name: `New session ${new Date().toLocaleString()}`,\n      })\n\n      // @ts-expect-error\n      sessionTracks.forEach(track => rootModel.session.addTrackConf(track))\n\n      await Promise.all(\n        views.map(view =>\n          pluginManager.evaluateAsyncExtensionPoint('LaunchView-' + view.type, {\n            ...view,\n            session: rootModel.session,\n          }),\n        ),\n      )\n    } catch (e) {\n      console.error(e)\n      rootModel.session?.notify(`${e}`)\n    }\n  }\n}\n","import React from 'react'\nimport { ErrorMessage } from '@jbrowse/core/ui'\nimport NoConfigMessage from './NoConfigMessage'\n\nexport default function StartScreenErrorMessage({ error }: { error: unknown }) {\n  return (\n    <>\n      {`${error}`.match(/HTTP 404 fetching config.json/) ? (\n        <div>\n          <h1>It worked!</h1>\n          <p\n            style={{\n              margin: 8,\n              padding: 8,\n              background: '#9f9',\n              border: '1px solid green',\n            }}\n          >\n            JBrowse 2 is installed. Your next step is to add and configure an\n            assembly. Follow our{' '}\n            <a href=\"https://jbrowse.org/jb2/docs/quickstart_web/\">\n              quick start guide\n            </a>{' '}\n            to continue or browse the sample data{' '}\n            <a href=\"?config=test_data/volvox/config.json\">here</a>.\n          </p>\n          {process.env.NODE_ENV === 'development' ? <NoConfigMessage /> : null}\n        </div>\n      ) : (\n        <div>\n          <h1>JBrowse Error</h1>\n          <ErrorMessage error={error} />\n        </div>\n      )}\n    </>\n  )\n}\n","import { ConfigurationSchema } from '../configuration'\nimport PluginManager from '../PluginManager'\n\n/**\n * #config BaseAssembly\n * #category assemblyManagement\n * This corresponds to the assemblies section of the config\n */\nfunction assemblyConfigSchema(pluginManager: PluginManager) {\n  return ConfigurationSchema(\n    'BaseAssembly',\n    {\n      /**\n       * #slot\n       * aliases are \"reference name aliases\" e.g. aliases for hg38 might be \"GRCh38\"\n       */\n      aliases: {\n        type: 'stringArray',\n        defaultValue: [],\n        description: 'Other possible names for the assembly',\n      },\n\n      /**\n       * #slot\n       * sequence refers to a reference sequence track that has an adapter containing,\n       * importantly, a sequence adapter such as IndexedFastaAdapter\n       */\n      sequence: pluginManager.getTrackType('ReferenceSequenceTrack')\n        .configSchema,\n\n      /**\n       * #slot\n       */\n      refNameColors: {\n        type: 'stringArray',\n        defaultValue: [],\n        description:\n          'Define custom colors for each reference sequence. Will cycle through this list if there are not enough colors for every sequence.',\n      },\n\n      refNameAliases: ConfigurationSchema(\n        'RefNameAliases',\n        {\n          /**\n           * #slot refNameAliases.adapter\n           * refNameAliases help resolve e.g. chr1 and 1 as the same entity\n           * the data for refNameAliases are fetched from an adapter, that is\n           * commonly a tsv like chromAliases.txt from UCSC or similar\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow refNameAliases to be unspecified\n            // @ts-expect-error\n            if (!snap.adapter) {\n              return { adapter: { type: 'RefNameAliasAdapter' } }\n            }\n            return snap\n          },\n        },\n      ),\n      cytobands: ConfigurationSchema(\n        'Cytoband',\n        {\n          /**\n           * #slot cytobands.adapter\n           * cytoband data is fetched from an adapter, and can be displayed by a\n           * view type as ideograms\n           */\n          adapter: pluginManager.pluggableConfigSchemaType('adapter'),\n        },\n        {\n          preProcessSnapshot: snap => {\n            // allow cytoBand to be unspecified\n            // @ts-expect-error\n            if (!snap.adapter) {\n              return { adapter: { type: 'CytobandAdapter' } }\n            }\n            return snap\n          },\n        },\n      ),\n\n      /**\n       * #slot\n       */\n      displayName: {\n        type: 'string',\n        defaultValue: '',\n        description:\n          'A human readable display name for the assembly e.g. \"Homo sapiens (hg38)\" while the assembly name may just be \"hg38\"',\n      },\n    },\n    {\n      /**\n       * #identifier name\n       * the name acts as a unique identifier in the config, so it cannot be duplicated.\n       * it usually a short human readable \"id\" like hg38, but you can also optionally\n       * customize the assembly \"displayName\" config slot\n       */\n      explicitIdentifier: 'name',\n    },\n  )\n}\n\nexport default assemblyConfigSchema\nexport type BaseAssemblyConfigSchema = ReturnType<typeof assemblyConfigSchema>\n","import BaseResult from './BaseResults'\nimport PluginManager from '../PluginManager'\nimport QuickLRU from '../util/QuickLRU'\nimport {\n  BaseTextSearchAdapter,\n  BaseTextSearchArgs,\n} from '../data_adapters/BaseAdapter'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\n\nexport interface SearchScope {\n  includeAggregateIndexes: boolean\n  assemblyName: string\n  tracks?: string[]\n}\n\nexport default class TextSearchManager {\n  adapterCache = new QuickLRU<string, BaseTextSearchAdapter>({\n    maxSize: 15,\n  })\n\n  constructor(public pluginManager: PluginManager) {}\n\n  loadTextSearchAdapters(searchScope: SearchScope) {\n    const pm = this.pluginManager\n    return this.relevantAdapters(searchScope).map(conf => {\n      const adapterId = readConfObject(conf, 'textSearchAdapterId')\n      const r = this.adapterCache.get(adapterId)\n      if (r) {\n        return r\n      } else {\n        const { AdapterClass } = pm.getTextSearchAdapterType(conf.type)\n        const a = new AdapterClass(conf, undefined, pm) as BaseTextSearchAdapter\n        this.adapterCache.set(adapterId, a)\n        return a\n      }\n    })\n  }\n\n  relevantAdapters(searchScope: SearchScope) {\n    const pm = this.pluginManager\n    const { aggregateTextSearchAdapters } = pm.rootModel?.jbrowse as {\n      aggregateTextSearchAdapters: AnyConfigurationModel[]\n    }\n    const { tracks } = pm.rootModel?.session as {\n      tracks: AnyConfigurationModel[]\n    }\n\n    const { assemblyName } = searchScope\n\n    return [\n      ...this.getAdaptersWithAssembly(\n        assemblyName,\n        aggregateTextSearchAdapters,\n      ),\n      ...this.getTrackAdaptersWithAssembly(assemblyName, tracks),\n    ]\n  }\n\n  getAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ): AnyConfigurationModel[] {\n    return confs.filter(\n      c => readConfObject(c, 'assemblyNames')?.includes(assemblyName),\n    )\n  }\n\n  getTrackAdaptersWithAssembly(\n    assemblyName: string,\n    confs: AnyConfigurationModel[],\n  ) {\n    return confs\n      .filter(\n        conf =>\n          readConfObject(conf, [\n            'textSearching',\n            'textSearchAdapter',\n            'assemblyNames',\n          ])?.includes(assemblyName),\n      )\n      .map(\n        conf => conf.textSearching.textSearchAdapter as AnyConfigurationModel,\n      )\n  }\n\n  /**\n   * Returns list of relevant results given a search query and options\n   * @param args - search options/arguments include: search query\n   * limit of results to return, searchType...prefix | full | exact\", etc.\n   */\n  async search(\n    args: BaseTextSearchArgs,\n    searchScope: SearchScope,\n    rankFn: (results: BaseResult[]) => BaseResult[],\n  ) {\n    const adapters = this.loadTextSearchAdapters(searchScope)\n    const results = await Promise.all(adapters.map(a => a.searchIndex(args)))\n    return this.sortResults(results.flat(), rankFn)\n  }\n\n  /**\n   * Returns array of revelevant and sorted results\n   * @param results - array of results from all text search adapters\n   * @param rankFn - function that updates results scores\n   * based on more relevance\n   */\n  sortResults(\n    results: BaseResult[],\n    rankFn: (results: BaseResult[]) => BaseResult[],\n  ) {\n    return rankFn(\n      results.sort((a, b) => -b.getLabel().localeCompare(a.getLabel())),\n    ).sort((r1, r2) => r1.getScore() - r2.getScore())\n  }\n}\n","// this is in a separate module here so it can be mocked out by jest. the\n// import.meta.url is not well recognized by jest and we use MainThreadRpc in\n// tests anyways right now\n//\n// note: this uses webpack 5 native worker modules\n//\n// see https://github.com/cmdcolin/cra-webpack5-web-worker-example for simple example\n// and docs https://webpack.js.org/guides/web-workers/\n//\n// also note: the craco config for webpack publicPath: 'auto' is needed for\n// these workers\nexport default function makeWorkerInstance() {\n  return new Worker(new URL('./rpcWorker', import.meta.url))\n}\n","import { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { JBrowseModelF } from '@jbrowse/app-core'\nimport { getSnapshot, resolveIdentifier, types } from 'mobx-state-tree'\nimport clone from 'clone'\n\n// locals\nimport { removeAttr } from './util'\n\n// poke some things for testing (this stuff will eventually be removed)\n// @ts-expect-error\nwindow.getSnapshot = getSnapshot\n// @ts-expect-error\nwindow.resolveIdentifier = resolveIdentifier\n\n/**\n * #stateModel JBrowseWebConfigModel\n * #category root\n * the rootModel.jbrowse state model for JBrowse Web\n */\nexport default function JBrowseWeb({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AnyConfigurationSchemaType\n}) {\n  return types.snapshotProcessor(\n    JBrowseModelF({ pluginManager, assemblyConfigSchema }),\n    {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      postProcessor(snapshot: Record<string, any>) {\n        return removeAttr(clone(snapshot), 'baseUri')\n      },\n    },\n  )\n}\n","import { getParent, types, Instance, IAnyType } from 'mobx-state-tree'\nimport jsonStableStringify from 'json-stable-stringify'\nimport AbortablePromiseCache from 'abortable-promise-cache'\n\n// locals\nimport { getConf, AnyConfigurationModel } from '../configuration'\nimport {\n  BaseOptions,\n  BaseRefNameAliasAdapter,\n  RegionsAdapter,\n} from '../data_adapters/BaseAdapter'\nimport PluginManager from '../PluginManager'\nimport { when, Region, Feature } from '../util'\nimport QuickLRU from '../util/QuickLRU'\nimport RpcManager from '../rpc/RpcManager'\n\nconst refNameRegex = new RegExp(\n  '[0-9A-Za-z!#$%&+./:;?@^_|~-][0-9A-Za-z!#$%&*+./:;=?@^_|~-]*',\n)\n\n// Based on the UCSC Genome Browser chromosome color palette:\n// https://github.com/ucscGenomeBrowser/kent/blob/a50ed53aff81d6fb3e34e6913ce18578292bc24e/src/hg/inc/chromColors.h\n// Some colors darkened to have at least a 3:1 contrast ratio on a white\n// background\nconst refNameColors = [\n  'rgb(153, 102, 0)',\n  'rgb(102, 102, 0)',\n  'rgb(153, 153, 30)',\n  'rgb(204, 0, 0)',\n  'rgb(255, 0, 0)',\n  'rgb(255, 0, 204)',\n  'rgb(165, 132, 132)', // originally 'rgb(255, 204, 204)'\n  'rgb(204, 122, 0)', // originally rgb(255, 153, 0)'\n  'rgb(178, 142, 0)', // originally 'rgb(255, 204, 0)'\n  'rgb(153, 153, 0)', // originally 'rgb(255, 255, 0)'\n  'rgb(122, 153, 0)', // originally 'rgb(204, 255, 0)'\n  'rgb(0, 165, 0)', // originally 'rgb(0, 255, 0)'\n  'rgb(53, 128, 0)',\n  'rgb(0, 0, 204)',\n  'rgb(96, 145, 242)', // originally 'rgb(102, 153, 255)'\n  'rgb(107, 142, 178)', // originally 'rgb(153, 204, 255)'\n  'rgb(0, 165, 165)', // originally 'rgb(0, 255, 255)'\n  'rgb(122, 153, 153)', // originally 'rgb(204, 255, 255)'\n  'rgb(153, 0, 204)',\n  'rgb(204, 51, 255)',\n  'rgb(173, 130, 216)', // originally 'rgb(204, 153, 255)'\n  'rgb(102, 102, 102)',\n  'rgb(145, 145, 145)', // originally 'rgb(153, 153, 153)'\n  'rgb(142, 142, 142)', // originally 'rgb(204, 204, 204)'\n  'rgb(142, 142, 107)', // originally 'rgb(204, 204, 153)'\n  'rgb(96, 163, 48)', // originally 'rgb(121, 204, 61)'\n]\n\nasync function loadRefNameMap(\n  assembly: Assembly,\n  adapterConfig: unknown,\n  options: BaseOptions,\n  signal?: AbortSignal,\n) {\n  const { sessionId } = options\n  await when(() => !!(assembly.regions && assembly.refNameAliases), {\n    signal,\n    name: 'when assembly ready',\n  })\n\n  const refNames = (await assembly.rpcManager.call(\n    sessionId || 'assemblyRpc',\n    'CoreGetRefNames',\n    {\n      adapterConfig,\n      signal,\n      ...options,\n    },\n    { timeout: 1000000 },\n  )) as string[]\n\n  const { refNameAliases } = assembly\n  if (!refNameAliases) {\n    throw new Error(`error loading assembly ${assembly.name}'s refNameAliases`)\n  }\n\n  const refNameMap = Object.fromEntries(\n    refNames.map(name => {\n      checkRefName(name)\n      return [assembly.getCanonicalRefName(name), name]\n    }),\n  )\n\n  // make the reversed map too\n  const reversed = Object.fromEntries(\n    Object.entries(refNameMap).map(([canonicalName, adapterName]) => [\n      adapterName,\n      canonicalName,\n    ]),\n  )\n\n  return {\n    forwardMap: refNameMap,\n    reverseMap: reversed,\n  }\n}\n\n// Valid refName pattern from https://samtools.github.io/hts-specs/SAMv1.pdf\nfunction checkRefName(refName: string) {\n  if (!refNameRegex.test(refName)) {\n    throw new Error(`Encountered invalid refName: \"${refName}\"`)\n  }\n}\n\nfunction getAdapterId(adapterConf: unknown) {\n  return jsonStableStringify(adapterConf)\n}\n\ntype RefNameAliases = Record<string, string | undefined>\n\ninterface CacheData {\n  adapterConf: unknown\n  self: Assembly\n  sessionId: string\n  options: BaseOptions\n}\n\nexport interface RefNameMap {\n  forwardMap: RefNameAliases\n  reverseMap: RefNameAliases\n}\n\nexport interface BasicRegion {\n  start: number\n  end: number\n  refName: string\n  assemblyName: string\n}\n\nexport interface Loading {\n  adapterRegionsWithAssembly: Region[]\n  refNameAliases: RefNameAliases\n  lowerCaseRefNameAliases: RefNameAliases\n  cytobands: Feature[]\n}\n\n/**\n * #stateModel Assembly\n */\nexport default function assemblyFactory(\n  assemblyConfigType: IAnyType,\n  pm: PluginManager,\n) {\n  const adapterLoads = new AbortablePromiseCache<CacheData, RefNameMap>({\n    cache: new QuickLRU({ maxSize: 1000 }),\n\n    // @ts-expect-error\n    async fill(\n      args: CacheData,\n      signal?: AbortSignal,\n      statusCallback?: (arg: string) => void,\n    ) {\n      const { adapterConf, self, options } = args\n      return loadRefNameMap(\n        self,\n        adapterConf,\n        { ...options, statusCallback },\n        signal,\n      )\n    },\n  })\n  return types\n    .model({\n      /**\n       * #property\n       */\n      configuration: types.safeReference(assemblyConfigType),\n    })\n    .volatile(() => ({\n      error: undefined as unknown,\n      loaded: false,\n      loadingP: undefined as Promise<void> | undefined,\n      volatileRegions: undefined as BasicRegion[] | undefined,\n      refNameAliases: undefined as RefNameAliases | undefined,\n      lowerCaseRefNameAliases: undefined as RefNameAliases | undefined,\n      cytobands: undefined as Feature[] | undefined,\n    }))\n    .views(self => ({\n      getConf(arg: string) {\n        return self.configuration ? getConf(self, arg) : undefined\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get initialized() {\n        // @ts-expect-error\n        self.load()\n        return !!self.refNameAliases\n      },\n      /**\n       * #getter\n       */\n      get name(): string {\n        return self.getConf('name') || ''\n      },\n      /**\n       * #getter\n       */\n      get regions() {\n        // @ts-expect-error\n        self.load()\n        return self.volatileRegions\n      },\n      /**\n       * #getter\n       */\n      get aliases(): string[] {\n        return self.getConf('aliases') || []\n      },\n      /**\n       * #getter\n       */\n      get displayName(): string | undefined {\n        return self.getConf('displayName')\n      },\n      /**\n       * #getter\n       */\n      hasName(name: string) {\n        return this.allAliases.includes(name)\n      },\n      /**\n       * #getter\n       */\n      get allAliases() {\n        return [this.name, ...this.aliases]\n      },\n      /**\n       * #getter\n       * note: lowerCaseRefNameAliases not included here: this allows the list\n       * of refnames to be just the \"normal casing\", but things like\n       * getCanonicalRefName can resolve a lower-case name if needed\n       */\n      get allRefNames() {\n        return !self.refNameAliases\n          ? undefined\n          : Object.keys(self.refNameAliases)\n      },\n      /**\n       * #getter\n       */\n      get lowerCaseRefNames() {\n        return !self.lowerCaseRefNameAliases\n          ? undefined\n          : Object.keys(self.lowerCaseRefNameAliases || {})\n      },\n\n      /**\n       * #getter\n       */\n      get allRefNamesWithLowerCase() {\n        return this.allRefNames && this.lowerCaseRefNames\n          ? [...new Set([...this.allRefNames, ...this.lowerCaseRefNames])]\n          : undefined\n      },\n      /**\n       * #getter\n       */\n      get rpcManager(): RpcManager {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self, 2).rpcManager\n      },\n      /**\n       * #getter\n       */\n      get refNameColors() {\n        const colors: string[] = self.getConf('refNameColors') || []\n        return colors.length === 0 ? refNameColors : colors\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get refNames() {\n        return self.regions?.map(region => region.refName)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getCanonicalRefName(refName: string) {\n        if (!self.refNameAliases || !self.lowerCaseRefNameAliases) {\n          throw new Error(\n            'aliases not loaded, we expect them to be loaded before getCanonicalRefName can be called',\n          )\n        }\n        return (\n          self.refNameAliases[refName] || self.lowerCaseRefNameAliases[refName]\n        )\n      },\n      /**\n       * #method\n       */\n      getRefNameColor(refName: string) {\n        if (!self.refNames) {\n          return undefined\n        }\n        const idx = self.refNames.indexOf(refName)\n        if (idx === -1) {\n          return undefined\n        }\n        return self.refNameColors[idx % self.refNameColors.length]\n      },\n      /**\n       * #method\n       */\n      isValidRefName(refName: string) {\n        if (!self.refNameAliases) {\n          throw new Error(\n            'isValidRefName cannot be called yet, the assembly has not finished loading',\n          )\n        }\n        return !!this.getCanonicalRefName(refName)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setLoaded({\n        adapterRegionsWithAssembly,\n        refNameAliases,\n        lowerCaseRefNameAliases,\n        cytobands,\n      }: Loading) {\n        self.loaded = true\n        this.setRegions(adapterRegionsWithAssembly)\n        this.setRefNameAliases(refNameAliases, lowerCaseRefNameAliases)\n        this.setCytobands(cytobands)\n      },\n      /**\n       * #action\n       */\n      setError(e: unknown) {\n        console.error(e)\n        self.error = e\n      },\n      /**\n       * #action\n       */\n      setRegions(regions: Region[]) {\n        self.volatileRegions = regions\n      },\n      /**\n       * #action\n       */\n      setRefNameAliases(aliases: RefNameAliases, lcAliases: RefNameAliases) {\n        self.refNameAliases = aliases\n        self.lowerCaseRefNameAliases = lcAliases\n      },\n      /**\n       * #action\n       */\n      setCytobands(cytobands: Feature[]) {\n        self.cytobands = cytobands\n      },\n      /**\n       * #action\n       */\n      setLoadingP(p?: Promise<void>) {\n        self.loadingP = p\n      },\n      /**\n       * #action\n       */\n      load() {\n        if (!self.loadingP) {\n          self.loadingP = this.loadPre().catch(e => {\n            this.setLoadingP(undefined)\n            this.setError(e)\n          })\n        }\n        return self.loadingP\n      },\n      /**\n       * #action\n       */\n      async loadPre() {\n        const conf = self.configuration\n        const refNameAliasesAdapterConf = conf?.refNameAliases?.adapter\n        const cytobandAdapterConf = conf?.cytobands?.adapter\n        const sequenceAdapterConf = conf?.sequence.adapter\n        const assemblyName = self.name\n\n        const regions = await getAssemblyRegions(sequenceAdapterConf, pm)\n        const adapterRegionsWithAssembly = regions.map(r => {\n          checkRefName(r.refName)\n          return { ...r, assemblyName }\n        })\n        const refNameAliases: RefNameAliases = {}\n\n        const ret = await getRefNameAliases(refNameAliasesAdapterConf, pm)\n        const cytobands = await getCytobands(cytobandAdapterConf, pm)\n        ret.forEach(({ refName, aliases }) => {\n          aliases.forEach(a => {\n            checkRefName(a)\n            refNameAliases[a] = refName\n          })\n        })\n        // add identity to the refNameAliases list\n        adapterRegionsWithAssembly.forEach(region => {\n          refNameAliases[region.refName] = region.refName\n        })\n\n        const lowerCaseRefNameAliases = Object.fromEntries(\n          Object.entries(refNameAliases).map(([key, val]) => [\n            key.toLowerCase(),\n            val,\n          ]),\n        )\n\n        this.setLoaded({\n          adapterRegionsWithAssembly,\n          refNameAliases,\n          lowerCaseRefNameAliases,\n          cytobands,\n        })\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getAdapterMapEntry(adapterConf: unknown, options: BaseOptions) {\n        const { signal, statusCallback, ...rest } = options\n        if (!options.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const adapterId = getAdapterId(adapterConf)\n        return adapterLoads.get(\n          adapterId,\n          {\n            adapterConf,\n            self: self as Assembly,\n            options: rest,\n          } as CacheData,\n\n          // signal intentionally not passed here, fixes issues like #2221.\n          // alternative fix #2540 was proposed but non-working currently\n          undefined,\n          statusCallback,\n        )\n      },\n\n      /**\n       * #method\n       * get Map of `canonical-name -> adapter-specific-name`\n       */\n      async getRefNameMapForAdapter(adapterConf: unknown, opts: BaseOptions) {\n        if (!opts?.sessionId) {\n          throw new Error('sessionId is required')\n        }\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.forwardMap\n      },\n\n      /**\n       * #method\n       * get Map of `adapter-specific-name -> canonical-name`\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        opts: BaseOptions,\n      ) {\n        const map = await this.getAdapterMapEntry(adapterConf, opts)\n        return map.reverseMap\n      },\n    }))\n}\n\nasync function getRefNameAliases(\n  config: AnyConfigurationModel,\n  pm: PluginManager,\n  signal?: AbortSignal,\n) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm) as BaseRefNameAliasAdapter\n  return adapter.getRefNameAliases({ signal })\n}\n\nasync function getCytobands(config: AnyConfigurationModel, pm: PluginManager) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm)\n\n  // @ts-expect-error\n  return adapter.getData()\n}\n\nasync function getAssemblyRegions(\n  config: AnyConfigurationModel,\n  pm: PluginManager,\n  signal?: AbortSignal,\n) {\n  const type = pm.getAdapterType(config.type)\n  const CLASS = await type.getAdapterClass()\n  const adapter = new CLASS(config, undefined, pm) as RegionsAdapter\n  return adapter.getRegions({ signal })\n}\n\nexport type AssemblyModel = ReturnType<typeof assemblyFactory>\nexport type Assembly = Instance<AssemblyModel>\n","import {\n  addDisposer,\n  cast,\n  getParent,\n  types,\n  Instance,\n  IAnyType,\n} from 'mobx-state-tree'\nimport { when } from '../util'\nimport { reaction } from 'mobx'\nimport { readConfObject, AnyConfigurationModel } from '../configuration'\nimport assemblyFactory, { Assembly } from './assembly'\nimport PluginManager from '../PluginManager'\nimport RpcManager from '../rpc/RpcManager'\n\n/**\n * #stateModel AssemblyManager\n */\nfunction assemblyManagerFactory(conf: IAnyType, pm: PluginManager) {\n  type Conf = Instance<typeof conf> // this is type any, try to narrow...\n  return types\n    .model({\n      /**\n       * #property\n       * this is automatically managed by an autorun which looks in the parent\n       * session.assemblies, session.sessionAssemblies, and\n       * session.temporaryAssemblies\n       */\n      assemblies: types.array(assemblyFactory(conf, pm)),\n    })\n    .views(self => ({\n      get assemblyNameMap() {\n        const obj = {} as Record<string, Assembly | undefined>\n        for (const assembly of self.assemblies) {\n          for (const name of assembly.allAliases) {\n            obj[name] = assembly\n          }\n        }\n        return obj\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      get(asmName: string) {\n        return self.assemblyNameMap[asmName]\n      },\n\n      /**\n       * #getter\n       */\n      get assemblyNamesList() {\n        return this.assemblyList.map(asm => asm.name)\n      },\n\n      /**\n       * #getter\n       * looks at jbrowse.assemblies, session.sessionAssemblies, and\n       * session.temporaryAssemblies to load from\n       */\n      get assemblyList() {\n        // name is the explicit identifier and can be accessed without getConf,\n        // hence the union with {name:string}\n        const {\n          jbrowse: { assemblies },\n          session: { sessionAssemblies = [], temporaryAssemblies = [] } = {},\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        } = getParent<any>(self)\n        return [\n          ...assemblies,\n          ...sessionAssemblies,\n          ...temporaryAssemblies,\n        ] as AnyConfigurationModel[]\n      },\n\n      get rpcManager(): RpcManager {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       * use this method instead of assemblyManager.get(assemblyName)\n       * to get an assembly with regions loaded\n       */\n      async waitForAssembly(assemblyName: string) {\n        if (!assemblyName) {\n          throw new Error('no assembly name supplied to waitForAssembly')\n        }\n        let assembly = self.get(assemblyName)\n        if (!assembly) {\n          try {\n            await when(() => Boolean(self.get(assemblyName)), { timeout: 1000 })\n            assembly = self.get(assemblyName)\n          } catch (e) {\n            // ignore\n          }\n        }\n\n        if (!assembly) {\n          return undefined\n        }\n        await assembly.load()\n        await when(\n          () =>\n            Boolean(assembly?.regions && assembly.refNameAliases) ||\n            !!assembly?.error,\n        )\n        if (assembly.error) {\n          throw assembly.error\n        }\n        return assembly\n      },\n\n      /**\n       * #method\n       */\n      async getRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string | undefined,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n\n      /**\n       * #method\n       */\n      async getReverseRefNameMapForAdapter(\n        adapterConf: unknown,\n        assemblyName: string | undefined,\n        opts: { signal?: AbortSignal; sessionId: string },\n      ) {\n        if (assemblyName) {\n          const asm = await this.waitForAssembly(assemblyName)\n          return asm?.getReverseRefNameMapForAdapter(adapterConf, opts)\n        }\n        return {}\n      },\n\n      /**\n       * #method\n       */\n      isValidRefName(refName: string, assemblyName: string) {\n        const assembly = self.get(assemblyName)\n        if (assembly) {\n          return assembly.isValidRefName(refName)\n        }\n        throw new Error(\n          `Failed to look up refName ${refName} on ${assemblyName} because assembly does not exist`,\n        )\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          reaction(\n            () => self.assemblyList,\n            assemblyConfs => {\n              self.assemblies.forEach(asm => {\n                if (!asm.configuration) {\n                  this.removeAssembly(asm)\n                }\n              })\n              assemblyConfs.forEach(conf => {\n                if (\n                  !self.assemblies.some(\n                    a => a.name === readConfObject(conf, 'name'),\n                  )\n                ) {\n                  this.addAssembly(conf)\n                }\n              })\n            },\n            { fireImmediately: true, name: 'assemblyManagerAfterAttach' },\n          ),\n        )\n      },\n\n      /**\n       * #action\n       * private: you would generally want to add to manipulate\n       * jbrowse.assemblies, session.sessionAssemblies, or\n       * session.temporaryAssemblies instead of using this directly\n       */\n      removeAssembly(asm: Assembly) {\n        self.assemblies.remove(asm)\n      },\n\n      /**\n       * #action\n       * private: you would generally want to add to manipulate\n       * jbrowse.assemblies, session.sessionAssemblies, or\n       * session.temporaryAssemblies instead of using this directly\n       *\n       * this can take an active instance of an assembly, in which case it is\n       * referred to, or it can take an identifier e.g. assembly name, which is\n       * used as a reference. snapshots cannot be used\n       */\n      addAssembly(configuration: Conf) {\n        self.assemblies.push({ configuration })\n      },\n\n      /**\n       * #action\n       * private: you would generally want to add to manipulate\n       * jbrowse.assemblies, session.sessionAssemblies, or\n       * session.temporaryAssemblies instead of using this directly\n       */\n      replaceAssembly(idx: number, configuration: Conf) {\n        self.assemblies[idx] = cast({ configuration })\n      },\n    }))\n}\n\nexport default assemblyManagerFactory\n","import { lazy } from 'react'\nimport {\n  addDisposer,\n  cast,\n  getSnapshot,\n  getType,\n  types,\n  IAnyStateTreeNode,\n  SnapshotIn,\n  Instance,\n  IAnyType,\n} from 'mobx-state-tree'\n\nimport { saveAs } from 'file-saver'\nimport { observable, autorun } from 'mobx'\nimport assemblyConfigSchemaFactory from '@jbrowse/core/assemblyManager/assemblyConfigSchema'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { AbstractSessionModel, SessionWithWidgets } from '@jbrowse/core/util'\nimport { MenuItem } from '@jbrowse/core/ui'\n\n// icons\nimport AddIcon from '@mui/icons-material/Add'\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport AppsIcon from '@mui/icons-material/Apps'\nimport FileCopyIcon from '@mui/icons-material/FileCopy'\nimport FolderOpenIcon from '@mui/icons-material/FolderOpen'\nimport GetAppIcon from '@mui/icons-material/GetApp'\nimport PublishIcon from '@mui/icons-material/Publish'\nimport ExtensionIcon from '@mui/icons-material/Extension'\nimport StorageIcon from '@mui/icons-material/Storage'\nimport SaveIcon from '@mui/icons-material/Save'\nimport UndoIcon from '@mui/icons-material/Undo'\nimport RedoIcon from '@mui/icons-material/Redo'\nimport { Cable } from '@jbrowse/core/ui/Icons'\n\n// other\nimport makeWorkerInstance from '../makeWorkerInstance'\nimport jbrowseWebFactory from '../jbrowseModel'\nimport { filterSessionInPlace } from '../util'\nimport packageJSON from '../../package.json'\nimport {\n  BaseSession,\n  BaseSessionType,\n  SessionWithDialogs,\n  InternetAccountsRootModelMixin,\n  BaseRootModelFactory,\n} from '@jbrowse/product-core'\nimport { HistoryManagementMixin, RootAppMenuMixin } from '@jbrowse/app-core'\nimport { hydrateRoot } from 'react-dom/client'\nimport { AssemblyManager } from '@jbrowse/plugin-data-management'\n\n// locals\nconst SetDefaultSession = lazy(() => import('../components/SetDefaultSession'))\nconst PreferencesDialog = lazy(() => import('../components/PreferencesDialog'))\n\nexport interface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\n\ntype AssemblyConfig = ReturnType<typeof assemblyConfigSchemaFactory>\ntype SessionModelFactory = (args: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AssemblyConfig\n}) => IAnyType\n\n/**\n * #stateModel JBrowseWebRootModel\n *\n * composed of\n * - BaseRootModel\n * - InternetAccountsMixin\n * - HistoryManagementMixin\n * - AppFocusMixin\n * - RootAppMenuMixin\n *\n * note: many properties of the root model are available through the session,\n * and we generally prefer using the session model (via e.g. getSession) over\n * the root model (via e.g. getRoot) in plugin code\n */\nexport default function RootModel({\n  pluginManager,\n  sessionModelFactory,\n  adminMode = false,\n}: {\n  pluginManager: PluginManager\n  sessionModelFactory: SessionModelFactory\n  adminMode?: boolean\n}) {\n  const assemblyConfigSchema = assemblyConfigSchemaFactory(pluginManager)\n  const jbrowseModelType = jbrowseWebFactory({\n    pluginManager,\n    assemblyConfigSchema,\n  })\n  const sessionModelType = sessionModelFactory({\n    pluginManager,\n    assemblyConfigSchema,\n  })\n  return types\n    .compose(\n      BaseRootModelFactory({\n        pluginManager,\n        jbrowseModelType,\n        sessionModelType,\n        assemblyConfigSchema,\n      }),\n      InternetAccountsRootModelMixin(pluginManager),\n      HistoryManagementMixin(),\n      RootAppMenuMixin(),\n    )\n    .props({\n      /**\n       * #property\n       */\n      configPath: types.maybe(types.string),\n    })\n    .volatile(self => ({\n      version: packageJSON.version,\n      hydrateFn: hydrateRoot,\n      pluginsUpdated: false,\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          WebWorkerRpcDriver: { makeWorkerInstance },\n          MainThreadRpcDriver: {},\n        },\n      ),\n      savedSessionsVolatile: observable.map<\n        string,\n        { name: string; [key: string]: unknown }\n      >({}),\n      textSearchManager: new TextSearchManager(pluginManager),\n      error: undefined as unknown,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get savedSessions() {\n        return [...self.savedSessionsVolatile.values()]\n      },\n      /**\n       * #method\n       */\n      localStorageId(name: string) {\n        return `localSaved-${name}-${self.configPath}`\n      },\n      /**\n       * #getter\n       */\n      get autosaveId() {\n        return `autosave-${self.configPath}`\n      },\n      /**\n       * #getter\n       */\n      get previousAutosaveId() {\n        return `previousAutosave-${self.configPath}`\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get savedSessionNames() {\n        return self.savedSessions.map(session => session.name)\n      },\n      /**\n       * #getter\n       */\n      get currentSessionId() {\n        const locationUrl = new URL(window.location.href)\n        const params = new URLSearchParams(locationUrl.search)\n        return params?.get('session')?.split('local-')[1]\n      },\n    }))\n\n    .actions(self => ({\n      afterCreate() {\n        for (const [key, val] of Object.entries(localStorage)\n          .filter(([key, _val]) => key.startsWith('localSaved-'))\n          .filter(([key]) => key.includes(self.configPath || 'undefined'))) {\n          try {\n            const { session } = JSON.parse(val)\n            self.savedSessionsVolatile.set(key, session)\n          } catch (e) {\n            console.error('bad session encountered', key, val)\n          }\n        }\n        addDisposer(\n          self,\n          autorun(() => {\n            for (const [, val] of self.savedSessionsVolatile.entries()) {\n              try {\n                const key = self.localStorageId(val.name)\n                localStorage.setItem(key, JSON.stringify({ session: val }))\n              } catch (e) {\n                // @ts-expect-error\n                if (e.code === '22' || e.code === '1024') {\n                  alert(\n                    'Local storage is full! Please use the \"Open sessions\" panel to remove old sessions',\n                  )\n                }\n              }\n            }\n          }),\n        )\n\n        addDisposer(\n          self,\n          autorun(\n            () => {\n              if (!self.session) {\n                return\n              }\n              const snapshot = getSnapshot(self.session as BaseSession) || {\n                name: 'empty',\n              }\n              const s = JSON.stringify\n              sessionStorage.setItem('current', s({ session: snapshot }))\n              localStorage.setItem(\n                `autosave-${self.configPath}`,\n                s({\n                  session: {\n                    ...snapshot,\n                    name: `${snapshot.name}-autosaved`,\n                  },\n                }),\n              )\n\n              // this check is not able to be modularized into it's own autorun\n              // at current time because it depends on session storage snapshot\n              // being set above\n              if (self.pluginsUpdated) {\n                window.location.reload()\n              }\n            },\n            { delay: 400 },\n          ),\n        )\n      },\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot?: SnapshotIn<BaseSessionType>) {\n        const oldSession = self.session\n        self.session = cast(sessionSnapshot)\n        if (self.session) {\n          // validate all references in the session snapshot\n          try {\n            filterSessionInPlace(self.session, getType(self.session))\n          } catch (error) {\n            // throws error if session filtering failed\n            self.session = oldSession\n            throw error\n          }\n        }\n      },\n\n      /**\n       * #action\n       */\n      setPluginsUpdated(flag: boolean) {\n        self.pluginsUpdated = flag\n      },\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        const { defaultSession } = self.jbrowse\n        const newSession = {\n          ...defaultSession,\n          name: `${defaultSession.name} ${new Date().toLocaleString()}`,\n        }\n\n        this.setSession(newSession)\n      },\n      /**\n       * #action\n       */\n      renameCurrentSession(sessionName: string) {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          snapshot.name = sessionName\n          this.setSession(snapshot)\n        }\n      },\n      /**\n       * #action\n       */\n      addSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        self.savedSessionsVolatile.set(key, session)\n      },\n      /**\n       * #action\n       */\n      removeSavedSession(session: { name: string }) {\n        const key = self.localStorageId(session.name)\n        localStorage.removeItem(key)\n        self.savedSessionsVolatile.delete(key)\n      },\n      /**\n       * #action\n       */\n      duplicateCurrentSession() {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          let newSnapshotName = `${self.session.name} (copy)`\n          if (self.savedSessionNames.includes(newSnapshotName)) {\n            let newSnapshotCopyNumber = 2\n            do {\n              newSnapshotName = `${self.session.name} (copy ${newSnapshotCopyNumber})`\n              newSnapshotCopyNumber += 1\n            } while (self.savedSessionNames.includes(newSnapshotName))\n          }\n          snapshot.name = newSnapshotName\n          this.setSession(snapshot)\n        }\n      },\n      /**\n       * #action\n       */\n      activateSession(name: string) {\n        const localId = self.localStorageId(name)\n        const newSessionSnapshot = localStorage.getItem(localId)\n        if (!newSessionSnapshot) {\n          throw new Error(\n            `Can't activate session ${name}, it is not in the savedSessions`,\n          )\n        }\n\n        this.setSession(JSON.parse(newSessionSnapshot).session)\n      },\n      /**\n       * #action\n       */\n      saveSessionToLocalStorage() {\n        if (self.session) {\n          const key = self.localStorageId(self.session.name)\n          self.savedSessionsVolatile.set(key, getSnapshot(self.session))\n        }\n      },\n      loadAutosaveSession() {\n        const previousAutosave = localStorage.getItem(self.previousAutosaveId)\n        const autosavedSession = previousAutosave\n          ? JSON.parse(previousAutosave).session\n          : {}\n        const { name } = autosavedSession\n        autosavedSession.name = `${name.replace('-autosaved', '')}-restored`\n        this.setSession(autosavedSession)\n      },\n      /**\n       * #action\n       */\n      setError(error?: unknown) {\n        self.error = error\n      },\n    }))\n    .volatile(self => ({\n      menus: [\n        {\n          label: 'File',\n          menuItems: [\n            {\n              label: 'New session',\n              icon: AddIcon,\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              onClick: (session: any) => {\n                const lastAutosave = localStorage.getItem(self.autosaveId)\n                if (lastAutosave) {\n                  localStorage.setItem(self.previousAutosaveId, lastAutosave)\n                }\n                session.setDefaultSession()\n              },\n            },\n            {\n              label: 'Import session…',\n              icon: PublishIcon,\n              onClick: (session: SessionWithWidgets) => {\n                const widget = session.addWidget(\n                  'ImportSessionWidget',\n                  'importSessionWidget',\n                )\n                session.showWidget(widget)\n              },\n            },\n            {\n              label: 'Export session',\n              icon: GetAppIcon,\n              onClick: (session: IAnyStateTreeNode) => {\n                const sessionBlob = new Blob(\n                  [JSON.stringify({ session: getSnapshot(session) }, null, 2)],\n                  { type: 'text/plain;charset=utf-8' },\n                )\n                saveAs(sessionBlob, 'session.json')\n              },\n            },\n            {\n              label: 'Open session…',\n              icon: FolderOpenIcon,\n              onClick: (session: SessionWithWidgets) => {\n                const widget = session.addWidget(\n                  'SessionManager',\n                  'sessionManager',\n                )\n                session.showWidget(widget)\n              },\n            },\n            {\n              label: 'Save session',\n              icon: SaveIcon,\n              onClick: (session: SessionWithWidgets) => {\n                self.saveSessionToLocalStorage()\n                session.notify(`Saved session \"${session.name}\"`, 'success')\n              },\n            },\n            {\n              label: 'Duplicate session',\n              icon: FileCopyIcon,\n              onClick: (session: AbstractSessionModel) => {\n                if (session.duplicateCurrentSession) {\n                  session.duplicateCurrentSession()\n                }\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Open track...',\n              icon: StorageIcon,\n              onClick: (session: SessionWithWidgets) => {\n                if (session.views.length === 0) {\n                  session.notify('Please open a view to add a track first')\n                } else if (session.views.length > 0) {\n                  const widget = session.addWidget(\n                    'AddTrackWidget',\n                    'addTrackWidget',\n                    { view: session.views[0].id },\n                  )\n                  session.showWidget(widget)\n                  if (session.views.length > 1) {\n                    session.notify(\n                      `This will add a track to the first view. Note: if you want to open a track in a specific view open the track selector for that view and use the add track (plus icon) in the bottom right`,\n                    )\n                  }\n                }\n              },\n            },\n            {\n              label: 'Open connection...',\n              icon: Cable,\n              onClick: (session: SessionWithWidgets) => {\n                session.showWidget(\n                  session.addWidget(\n                    'AddConnectionWidget',\n                    'addConnectionWidget',\n                  ),\n                )\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Return to splash screen',\n              icon: AppsIcon,\n              onClick: () => self.setSession(undefined),\n            },\n          ],\n        },\n        ...(adminMode\n          ? [\n              {\n                label: 'Admin',\n                menuItems: [\n                  {\n                    label: 'Open assembly manager',\n                    onClick: () =>\n                      self.session.queueDialog((onClose: () => void) => [\n                        AssemblyManager,\n                        { onClose, rootModel: self },\n                      ]),\n                  },\n                  {\n                    label: 'Set default session',\n                    onClick: () =>\n                      self.session.queueDialog((onClose: () => void) => [\n                        SetDefaultSession,\n                        { rootModel: self, onClose },\n                      ]),\n                  },\n                ],\n              },\n            ]\n          : []),\n        {\n          label: 'Add',\n          menuItems: [],\n        },\n        {\n          label: 'Tools',\n          menuItems: [\n            {\n              label: 'Undo',\n              icon: UndoIcon,\n              onClick: () => {\n                if (self.history.canUndo) {\n                  self.history.undo()\n                }\n              },\n            },\n            {\n              label: 'Redo',\n              icon: RedoIcon,\n              onClick: () => {\n                if (self.history.canRedo) {\n                  self.history.redo()\n                }\n              },\n            },\n            { type: 'divider' },\n            {\n              label: 'Plugin store',\n              icon: ExtensionIcon,\n              onClick: () => {\n                if (self.session) {\n                  self.session.showWidget(\n                    self.session.addWidget(\n                      'PluginStoreWidget',\n                      'pluginStoreWidget',\n                    ),\n                  )\n                }\n              },\n            },\n            {\n              label: 'Preferences',\n              icon: SettingsIcon,\n              onClick: () => {\n                if (self.session) {\n                  ;(self.session as SessionWithDialogs).queueDialog(\n                    handleClose => [\n                      PreferencesDialog,\n                      {\n                        session: self.session,\n                        handleClose,\n                      },\n                    ],\n                  )\n                }\n              },\n            },\n          ],\n        },\n      ] as Menu[],\n      adminMode,\n    }))\n}\n\nexport type WebRootModelType = ReturnType<typeof RootModel>\nexport type WebRootModel = Instance<WebRootModelType>\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport { cast, getParent, getSnapshot } from 'mobx-state-tree'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport { toJS } from 'mobx'\n\n// locals\nimport { JBrowseConfigF } from '../JBrowseConfig'\n\nexport function JBrowseModelF({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return JBrowseConfigF({ pluginManager, assemblyConfigSchema })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblyNames(): string[] {\n        return self.assemblies.map(assembly => readConfObject(assembly, 'name'))\n      },\n      /**\n       * #getter\n       */\n      get rpcManager(): RpcManager {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        return getParent<any>(self).rpcManager\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addAssemblyConf(conf: AnyConfigurationModel) {\n        const { name } = conf\n        if (!name) {\n          throw new Error('Can\\'t add assembly with no \"name\"')\n        }\n        if (self.assemblyNames.includes(name)) {\n          throw new Error(\n            `Can't add assembly with name \"${name}\", an assembly with that name already exists`,\n          )\n        }\n        const length = self.assemblies.push({\n          ...conf,\n          sequence: {\n            type: 'ReferenceSequenceTrack',\n            trackId: `${name}-${Date.now()}`,\n            ...conf.sequence,\n          },\n        })\n        return self.assemblies[length - 1]\n      },\n      /**\n       * #action\n       */\n      removeAssemblyConf(assemblyName: string) {\n        const toRemove = self.assemblies.find(a => a.name === assemblyName)\n        if (toRemove) {\n          self.assemblies.remove(toRemove)\n        }\n      },\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfigurationModel) {\n        const { type } = trackConf\n        if (!type) {\n          throw new Error(`unknown track type ${type}`)\n        }\n        const length = self.tracks.push(trackConf)\n        return self.tracks[length - 1]\n      },\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { type } = connectionConf\n        if (!type) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connections.push(connectionConf)\n        return self.connections[length - 1]\n      },\n      /**\n       * #action\n       */\n      deleteConnectionConf(configuration: AnyConfigurationModel) {\n        const elt = self.connections.find(conn => conn.id === configuration.id)\n        return self.connections.remove(elt)\n      },\n      /**\n       * #action\n       */\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const elt = self.tracks.find(t => t.trackId === trackConf.trackId)\n        return self.tracks.remove(elt)\n      },\n      /**\n       * #action\n       */\n      addPlugin(pluginDefinition: PluginDefinition) {\n        self.plugins.push(pluginDefinition)\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const rootModel = getParent<any>(self)\n        rootModel.setPluginsUpdated(true)\n      },\n      /**\n       * #action\n       */\n      removePlugin(pluginDefinition: PluginDefinition) {\n        self.plugins = cast(\n          self.plugins.filter(\n            plugin =>\n              plugin.url !== pluginDefinition.url ||\n              plugin.umdUrl !== pluginDefinition.umdUrl ||\n              plugin.cjsUrl !== pluginDefinition.cjsUrl ||\n              plugin.esmUrl !== pluginDefinition.esmUrl,\n          ),\n        )\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        getParent<any>(self).setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      setDefaultSessionConf(sessionConf: AnyConfigurationModel) {\n        const newDefault =\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          getParent<any>(self).session.name === sessionConf.name\n            ? getSnapshot(sessionConf)\n            : toJS(sessionConf)\n\n        if (!newDefault.name) {\n          throw new Error(`unable to set default session to ${newDefault.name}`)\n        }\n\n        self.defaultSession = cast(newDefault)\n      },\n      /**\n       * #action\n       */\n      addInternetAccountConf(internetAccountConf: AnyConfigurationModel) {\n        const { type } = internetAccountConf\n        if (!type) {\n          throw new Error(`unknown internetAccount type ${type}`)\n        }\n        const length = self.internetAccounts.push(internetAccountConf)\n        return self.internetAccounts[length - 1]\n      },\n      /**\n       * #action\n       */\n      deleteInternetAccountConf(configuration: AnyConfigurationModel) {\n        const elt = self.internetAccounts.find(a => a.id === configuration.id)\n        return self.internetAccounts.remove(elt)\n      },\n    }))\n}\n","import {\n  AnyConfigurationSchemaType,\n  ConfigurationSchema,\n} from '@jbrowse/core/configuration'\n\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  FormatAboutConfigSchemaFactory,\n  FormatDetailsConfigSchemaFactory,\n  HierarchicalConfigSchemaFactory,\n} from '@jbrowse/product-core'\nimport { types } from 'mobx-state-tree'\n\n/**\n * #config JBrowseRootConfig\n * #category root\n * configuration in a config.json/file.jbrowse\n */\nexport function JBrowseConfigF({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: AnyConfigurationSchemaType\n}) {\n  return types.model('JBrowseConfig', {\n    configuration: ConfigurationSchema('Root', {\n      /**\n       * #slot configuration.rpc\n       */\n      rpc: RpcManager.configSchema,\n\n      /**\n       * #slot configuration.highResolutionScaling\n       */\n      highResolutionScaling: {\n        type: 'number',\n        defaultValue: 2,\n      },\n\n      formatDetails: FormatDetailsConfigSchemaFactory(),\n      formatAbout: FormatAboutConfigSchemaFactory(),\n\n      /*\n       * #slot configuration.shareURL\n       */\n      shareURL: {\n        type: 'string',\n        defaultValue: 'https://share.jbrowse.org/api/v1/',\n      },\n      /**\n       * #slot configuration.disableAnalytics\n       */\n      disableAnalytics: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n\n      hierarchical: HierarchicalConfigSchemaFactory(),\n      /**\n       * #slot configuration.theme\n       */\n      theme: {\n        type: 'frozen',\n        defaultValue: {},\n      },\n      /**\n       * #slot configuration.extraThemes\n       */\n      extraThemes: {\n        type: 'frozen',\n        defaultValue: {},\n      },\n      /**\n       * #slot configuration.logoPath\n       */\n      logoPath: {\n        type: 'fileLocation',\n        defaultValue: { uri: '', locationType: 'UriLocation' },\n      },\n      ...pluginManager.pluginConfigurationSchemas(),\n    }),\n    /**\n     * #slot\n     * defines plugins of the format\n     * ```typescript\n     * type PluginDefinition=\n     *    { umdUrl: string, name:string } |\n     *    { url: string, name: string } |\n     *    { esmUrl: string } |\n     *    { cjsUrl: string } |\n     *    { umdLoc: { uri: string } } |\n     *    { esmLoc: { uri: string } } |\n     * ```\n     */\n    plugins: types.array(types.frozen<PluginDefinition>()),\n    /**\n     * #slot\n     * configuration of the assemblies in the instance, see BaseAssembly\n     */\n    assemblies: types.array(assemblyConfigSchema),\n    /**\n     * #slot\n     * track configuration is an array of track config schemas. multiple\n     * instances of a track can exist that use the same configuration\n     */\n    tracks: types.array(pluginManager.pluggableConfigSchemaType('track')),\n    /**\n     * #slot\n     * configuration for internet accounts, see InternetAccounts\n     */\n    internetAccounts: types.array(\n      pluginManager.pluggableConfigSchemaType('internet account'),\n    ),\n    /**\n     * #slot\n     */\n    aggregateTextSearchAdapters: types.array(\n      pluginManager.pluggableConfigSchemaType('text search adapter'),\n    ),\n\n    /**\n     * #slot\n     */\n    connections: types.array(\n      pluginManager.pluggableConfigSchemaType('connection'),\n    ),\n\n    /**\n     * #slot\n     */\n    defaultSession: types.optional(types.frozen(), {\n      name: `New Session`,\n    }),\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FormatDetails\n * generally exists on the tracks in the config.json or as a 'session' config as\n * configuration.formatDetails\n */\nexport function FormatDetailsConfigSchemaFactory() {\n  return ConfigurationSchema('FormatDetails', {\n    /**\n     * #slot configuration.formatDetails.feature\n     */\n    feature: {\n      type: 'frozen',\n      description: 'adds extra fields to the feature details',\n      defaultValue: {},\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot configuration.formatDetails.subfeatures\n     */\n    subfeatures: {\n      type: 'frozen',\n      description: 'adds extra fields to the subfeatures of a feature',\n      defaultValue: {},\n      contextVariable: ['feature'],\n    },\n    /**\n     * #slot configuration.formatDetails.depth\n     */\n    depth: {\n      type: 'number',\n      defaultValue: 2,\n      description:\n        'depth to iterate the formatDetails->subfeatures callback on subfeatures (used for example to only apply the callback to the first layer of subfeatures)',\n    },\n    /**\n     * #slot configuration.formatDetails.maxDepth\n     */\n    maxDepth: {\n      type: 'number',\n      defaultValue: 10000,\n      description: 'hide subfeatures greater than a certain depth',\n    },\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n/**\n * #config FormatAbout\n * generally exists on the config.json or root config as configuration.formatAbout\n */\nexport function FormatAboutConfigSchemaFactory() {\n  return ConfigurationSchema('FormatAbout', {\n    /**\n     * #slot configuration.formatAbout.config\n     */\n    config: {\n      type: 'frozen',\n      description: 'formats configuration object in about dialog',\n      defaultValue: {},\n      contextVariable: ['config'],\n    },\n    /**\n     * #slot configuration.formatAbout.hideUris\n     */\n\n    hideUris: {\n      type: 'boolean',\n      defaultValue: false,\n    },\n  })\n}\n","import { ConfigurationSchema } from '@jbrowse/core/configuration'\n\n/**\n * #config HierarchicalConfigSchema\n * generally exists on the config.json or root config as configuration.hierarchical\n */\nexport function HierarchicalConfigSchemaFactory() {\n  return ConfigurationSchema('hierarchical', {\n    sort: ConfigurationSchema('hierarchicalSort', {\n      /**\n       * #slot configuration.hierarchical.sort.trackNames\n       */\n      trackNames: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n      /**\n       * #slot configuration.hierarchical.sort.categories\n       */\n      categories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n    }),\n    defaultCollapsed: ConfigurationSchema('defaultCollapsed', {\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.categoryNames\n       */\n      categoryNames: {\n        type: 'stringArray',\n        defaultValue: [],\n      },\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.topLevelCategories\n       */\n      topLevelCategories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n      /**\n       * #slot configuration.hierarchical.defaultCollapsed.subCategories\n       */\n      subCategories: {\n        type: 'boolean',\n        defaultValue: false,\n      },\n    }),\n  })\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport assemblyManagerFactory, {\n  BaseAssemblyConfigSchema,\n} from '@jbrowse/core/assemblyManager'\nimport RpcManager from '@jbrowse/core/rpc/RpcManager'\nimport {\n  IAnyType,\n  Instance,\n  SnapshotIn,\n  cast,\n  getSnapshot,\n  isStateTreeNode,\n  types,\n} from 'mobx-state-tree'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\n\n/**\n * #stateModel BaseRootModel\n * #category root\n * factory function for the Base-level root model shared by all products\n */\nexport function BaseRootModelFactory({\n  pluginManager,\n  jbrowseModelType,\n  sessionModelType,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  jbrowseModelType: IAnyType\n  sessionModelType: IAnyType\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return types\n    .model('BaseRootModel', {\n      /**\n       * #property\n       * `jbrowse` is a mapping of the config.json into the in-memory state\n       * tree\n       */\n      jbrowse: jbrowseModelType,\n\n      /**\n       * #property\n       * `session` encompasses the currently active state of the app, including\n       * views open, tracks open in those views, etc.\n       */\n      session: types.maybe(sessionModelType),\n      /**\n       * #property\n       */\n      sessionPath: types.optional(types.string, ''),\n\n      /**\n       * #property\n       */\n      assemblyManager: types.optional(\n        assemblyManagerFactory(assemblyConfigSchema, pluginManager),\n        {},\n      ),\n    })\n    .volatile(self => ({\n      rpcManager: new RpcManager(\n        pluginManager,\n        self.jbrowse.configuration.rpc,\n        {\n          MainThreadRpcDriver: {},\n        },\n      ),\n\n      adminMode: false,\n      isAssemblyEditing: false,\n      error: undefined as unknown,\n      textSearchManager: new TextSearchManager(pluginManager),\n      pluginManager,\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setError(error: unknown) {\n        self.error = error\n      },\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot?: SnapshotIn<IAnyType>) {\n        self.session = cast(sessionSnapshot)\n      },\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        this.setSession(self.jbrowse.defaultSession)\n      },\n      /**\n       * #action\n       */\n      setSessionPath(path: string) {\n        self.sessionPath = path\n      },\n      /**\n       * #action\n       */\n      renameCurrentSession(newName: string) {\n        if (self.session) {\n          const snapshot = JSON.parse(JSON.stringify(getSnapshot(self.session)))\n          snapshot.name = newName\n          this.setSession(snapshot)\n        }\n      },\n      /**\n       * #action\n       */\n      setAssemblyEditing(flag: boolean) {\n        self.isAssemblyEditing = flag\n      },\n    }))\n}\n\nexport type BaseRootModelType = ReturnType<typeof BaseRootModelFactory>\nexport type BaseRootModel = Instance<BaseRootModelType>\n\n/** Type guard for checking if something is a JB root model */\nexport function isRootModel(thing: unknown): thing is BaseRootModelType {\n  return (\n    isStateTreeNode(thing) &&\n    'session' in thing &&\n    'jbrowse' in thing &&\n    'assemblyManager' in thing\n  )\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { UriLocation } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport { Instance, addDisposer, types } from 'mobx-state-tree'\nimport { BaseRootModel } from './BaseRootModel'\n\n/**\n * #stateModel InternetAccountsMixin\n * #category root\n */\nexport function InternetAccountsRootModelMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      internetAccounts: types.array(\n        pluginManager.pluggableMstType('internet account', 'stateModel'),\n      ),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      initializeInternetAccount(\n        internetAccountConfig: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const internetAccountType = pluginManager.getInternetAccountType(\n          internetAccountConfig.type,\n        )\n        if (!internetAccountType) {\n          throw new Error(\n            `unknown internet account type ${internetAccountConfig.type}`,\n          )\n        }\n\n        const length = self.internetAccounts.push({\n          ...initialSnapshot,\n          type: internetAccountConfig.type,\n          configuration: internetAccountConfig,\n        })\n        return self.internetAccounts[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      createEphemeralInternetAccount(\n        internetAccountId: string,\n        initialSnapshot = {},\n        url: string,\n      ) {\n        let hostUri\n\n        try {\n          hostUri = new URL(url).origin\n        } catch (e) {\n          // ignore\n        }\n        // id of a custom new internaccount is `${type}-${name}`\n        const internetAccountSplit = internetAccountId.split('-')\n        const configuration = {\n          type: internetAccountSplit[0],\n          internetAccountId: internetAccountId,\n          name: internetAccountSplit.slice(1).join('-'),\n          description: '',\n          domains: hostUri ? [hostUri] : [],\n        }\n        const type = pluginManager.getInternetAccountType(configuration.type)\n        const internetAccount = type.stateModel.create({\n          ...initialSnapshot,\n          type: configuration.type,\n          configuration,\n        })\n        self.internetAccounts.push(internetAccount)\n        return internetAccount\n      },\n      /**\n       * #action\n       */\n      findAppropriateInternetAccount(location: UriLocation) {\n        // find the existing account selected from menu\n        const selectedId = location.internetAccountId\n        if (selectedId) {\n          const selectedAccount = self.internetAccounts.find(account => {\n            return account.internetAccountId === selectedId\n          })\n          if (selectedAccount) {\n            return selectedAccount\n          }\n        }\n\n        // if no existing account or not found, try to find working account\n        for (const account of self.internetAccounts) {\n          const handleResult = account.handlesLocation(location)\n          if (handleResult) {\n            return account\n          }\n        }\n\n        // if still no existing account, create ephemeral config to use\n        return selectedId\n          ? this.createEphemeralInternetAccount(selectedId, {}, location.uri)\n          : null\n      },\n    }))\n    .actions(self => ({\n      afterCreate() {\n        addDisposer(\n          self,\n          autorun(() => {\n            const { jbrowse } = self as typeof self & BaseRootModel\n            jbrowse.internetAccounts.forEach(self.initializeInternetAccount)\n          }),\n        )\n      },\n    }))\n}\n\nexport type RootModelWithInternetAccountsType = ReturnType<\n  typeof InternetAccountsRootModelMixin\n>\nexport type RootModelWithInternetAccounts =\n  Instance<RootModelWithInternetAccountsType>\n","import TimeTraveller from '@jbrowse/core/util/TimeTraveller'\nimport type { BaseRootModel } from '@jbrowse/product-core'\nimport { autorun } from 'mobx'\nimport { addDisposer, types } from 'mobx-state-tree'\n\n/**\n * #stateModel HistoryManagementMixin\n * #category root\n */\nexport function HistoryManagementMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       * used for undo/redo\n       */\n      history: types.optional(TimeTraveller, { targetPath: '../session' }),\n    })\n    .actions(self => ({\n      afterCreate() {\n        document.addEventListener('keydown', e => {\n          if (\n            self.history.canRedo &&\n            // ctrl+shift+z or cmd+shift+z\n            (((e.ctrlKey || e.metaKey) && e.shiftKey && e.code === 'KeyZ') ||\n              // ctrl+y\n              (e.ctrlKey && !e.shiftKey && e.code === 'KeyY')) &&\n            document.activeElement?.tagName.toUpperCase() !== 'INPUT'\n          ) {\n            self.history.redo()\n          }\n          if (\n            self.history.canUndo &&\n            // ctrl+z or cmd+z\n            (e.ctrlKey || e.metaKey) &&\n            !e.shiftKey &&\n            e.code === 'KeyZ' &&\n            document.activeElement?.tagName.toUpperCase() !== 'INPUT'\n          ) {\n            self.history.undo()\n          }\n        })\n        addDisposer(\n          self,\n          autorun(() => {\n            const { session } = self as typeof self & BaseRootModel\n            if (session) {\n              // we use a specific initialization routine after session is\n              // created to get it to start tracking itself sort of related\n              // issue here\n              // https://github.com/mobxjs/mobx-state-tree/issues/1089#issuecomment-441207911\n              self.history.initialize()\n            }\n          }),\n        )\n      },\n    }))\n}\n","import { MenuItem } from '@jbrowse/core/ui/Menu'\nimport { types } from 'mobx-state-tree'\n\nexport interface Menu {\n  label: string\n  menuItems: MenuItem[]\n}\nexport function RootAppMenuMixin() {\n  return types.model({}).actions(s => {\n    const self = s as { menus: Menu[] }\n    return {\n      /**\n       * #action\n       */\n      setMenus(newMenus: Menu[]) {\n        self.menus = newMenus\n      },\n      /**\n       * #action\n       * Add a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @returns The new length of the top-level menus array\n       */\n      appendMenu(menuName: string) {\n        return self.menus.push({ label: menuName, menuItems: [] })\n      },\n      /**\n       * #action\n       * Insert a top-level menu\n       * @param menuName - Name of the menu to insert.\n       * @param position - Position to insert menu. If negative, counts from th\n       * end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the\n       * second-to-last one.\n       * @returns The new length of the top-level menus array\n       */\n      insertMenu(menuName: string, position: number) {\n        self.menus.splice(\n          (position < 0 ? self.menus.length : 0) + position,\n          0,\n          {\n            label: menuName,\n            menuItems: [],\n          },\n        )\n        return self.menus.length\n      },\n      /**\n       * #action\n       * Add a menu item to a top-level menu\n       * @param menuName - Name of the top-level menu to append to.\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the menu\n       */\n      appendToMenu(menuName: string, menuItem: MenuItem) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        return menu.menuItems.push(menuItem)\n      },\n      /**\n       * #action\n       * Insert a menu item into a top-level menu\n       * @param menuName - Name of the top-level menu to insert into\n       * @param menuItem - Menu item to insert\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the menu\n       */\n      insertInMenu(menuName: string, menuItem: MenuItem, position: number) {\n        const menu = self.menus.find(m => m.label === menuName)\n        if (!menu) {\n          self.menus.push({ label: menuName, menuItems: [menuItem] })\n          return 1\n        }\n        const insertPosition =\n          position < 0 ? menu.menuItems.length + position : position\n        menu.menuItems.splice(insertPosition, 0, menuItem)\n        return menu.menuItems.length\n      },\n      /**\n       * #action\n       * Add a menu item to a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to append.\n       * @returns The new length of the sub-menu\n       */\n      appendToSubMenu(menuPath: string[], menuItem: MenuItem) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        return subMenu.push(menuItem)\n      },\n      /**\n       * #action\n       * Insert a menu item into a sub-menu\n       * @param menuPath - Path to the sub-menu to add to, starting with the\n       * top-level menu (e.g. `['File', 'Insert']`).\n       * @param menuItem - Menu item to insert.\n       * @param position - Position to insert menu item. If negative, counts\n       * from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as\n       * the second-to-last one.\n       * @returns The new length of the sub-menu\n       */\n      insertInSubMenu(\n        menuPath: string[],\n        menuItem: MenuItem,\n        position: number,\n      ) {\n        let topMenu = self.menus.find(m => m.label === menuPath[0])\n        if (!topMenu) {\n          const idx = this.appendMenu(menuPath[0])\n          topMenu = self.menus[idx - 1]\n        }\n        let { menuItems: subMenu } = topMenu\n        const pathSoFar = [menuPath[0]]\n        menuPath.slice(1).forEach(menuName => {\n          pathSoFar.push(menuName)\n          let sm = subMenu.find(mi => 'label' in mi && mi.label === menuName)\n          if (!sm) {\n            const idx = subMenu.push({ label: menuName, subMenu: [] })\n            sm = subMenu[idx - 1]\n          }\n          if (!('subMenu' in sm)) {\n            throw new Error(\n              `\"${menuName}\" in path \"${pathSoFar}\" is not a subMenu`,\n            )\n          }\n          subMenu = sm.subMenu\n        })\n        subMenu.splice(position, 0, menuItem)\n        return subMenu.length\n      },\n    }\n  })\n}\n","/** MST props, views, actions, etc related to managing connections */\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  TrackViewModel,\n  getContainingView,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport {\n  IAnyStateTreeNode,\n  Instance,\n  getMembers,\n  getParent,\n  getSnapshot,\n  getType,\n  isModelType,\n  isReferenceType,\n  types,\n  walk,\n} from 'mobx-state-tree'\n\nimport type { BaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n// locals\nimport { isBaseSession } from './BaseSession'\n\nexport interface ReferringNode {\n  node: IAnyStateTreeNode\n  key: string\n}\n\n/**\n * #stateModel ReferenceManagementSessionMixin\n */\nexport function ReferenceManagementSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model('ReferenceManagementSessionMixin', {})\n    .views(self => ({\n      /**\n       * #method\n       * See if any MST nodes currently have a types.reference to this object.\n       *\n       * @param object - object\n       * @returns An array where the first element is the node referring\n       * to the object and the second element is they property name the node is\n       * using to refer to the object\n       */\n      getReferring(object: IAnyStateTreeNode) {\n        const refs: ReferringNode[] = []\n        walk(getParent(self), node => {\n          if (isModelType(getType(node))) {\n            const members = getMembers(node)\n            Object.entries(members.properties).forEach(([key, value]) => {\n              if (isReferenceType(value) && node[key] === object) {\n                refs.push({ node, key })\n              }\n            })\n          }\n        })\n        return refs\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      removeReferring(\n        referring: ReferringNode[],\n        track: BaseTrackConfig,\n        callbacks: Function[],\n        dereferenceTypeCount: Record<string, number>,\n      ) {\n        referring.forEach(({ node }) => {\n          let dereferenced = false\n          try {\n            // If a view is referring to the track config, remove the track\n            // from the view\n            const type = 'open track(s)'\n            const view = getContainingView(node) as TrackViewModel\n            callbacks.push(() => view.hideTrack(track.trackId))\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          } catch (err1) {\n            // ignore\n          }\n\n          if (isSessionModelWithWidgets(self) && self.widgets.has(node.id)) {\n            // If a configuration editor widget has the track config\n            // open, close the widget\n            const type = 'configuration editor widget(s)'\n            if (isSessionModelWithWidgets(self)) {\n              callbacks.push(() => self.hideWidget(node))\n            }\n            dereferenced = true\n            if (!dereferenceTypeCount[type]) {\n              dereferenceTypeCount[type] = 0\n            }\n            dereferenceTypeCount[type] += 1\n          }\n          if (!dereferenced) {\n            throw new Error(\n              `Error when closing this connection, the following node is still referring to a track configuration: ${JSON.stringify(\n                getSnapshot(node),\n              )}`,\n            )\n          }\n        })\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that manages multiple views */\nexport type SessionWithReferenceManagementType = ReturnType<\n  typeof ReferenceManagementSessionMixin\n>\n\n/** Instance of a session with MST reference management (`getReferring()`, `removeReferring()`)  */\nexport type SessionWithReferenceManagement =\n  Instance<SessionWithReferenceManagementType>\n\n/** Type guard for SessionWithReferenceManagement */\nexport function isSessionWithReferenceManagement(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithReferenceManagement {\n  return (\n    isBaseSession(thing) &&\n    'getReferring' in thing &&\n    typeof thing.getReferring === 'function' &&\n    'removeReferring' in thing &&\n    typeof thing.removeReferring === 'function'\n  )\n}\n","import {\n  IAnyStateTreeNode,\n  Instance,\n  addDisposer,\n  isAlive,\n  types,\n} from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport {\n  AnyConfigurationModel,\n  isConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { isBaseSession } from './BaseSession'\n\nconst minDrawerWidth = 128\n\n/**\n * #stateModel DrawerWidgetSessionMixin\n */\nexport function DrawerWidgetSessionMixin(pluginManager: PluginManager) {\n  const widgetStateModelType = pluginManager.pluggableMstType(\n    'widget',\n    'stateModel',\n  )\n  type WidgetStateModel = Instance<typeof widgetStateModelType>\n  return types\n    .model({\n      /**\n       * #property\n       */\n      drawerPosition: types.optional(\n        types.string,\n        () => localStorageGetItem('drawerPosition') || 'right',\n      ),\n      /**\n       * #property\n       */\n      drawerWidth: types.optional(\n        types.refinement(types.integer, width => width >= minDrawerWidth),\n        384,\n      ),\n      /**\n       * #property\n       */\n      widgets: types.map(widgetStateModelType),\n      /**\n       * #property\n       */\n      activeWidgets: types.map(types.safeReference(widgetStateModelType)),\n\n      /**\n       * #property\n       */\n      minimized: types.optional(types.boolean, false),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get visibleWidget() {\n        if (isAlive(self)) {\n          // returns most recently added item in active widgets\n          return [...self.activeWidgets.values()][self.activeWidgets.size - 1]\n        }\n        return undefined\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setDrawerPosition(arg: string) {\n        self.drawerPosition = arg\n        localStorage.setItem('drawerPosition', arg)\n      },\n\n      /**\n       * #action\n       */\n      updateDrawerWidth(drawerWidth: number) {\n        if (drawerWidth === self.drawerWidth) {\n          return self.drawerWidth\n        }\n        let newDrawerWidth = drawerWidth\n        if (newDrawerWidth < minDrawerWidth) {\n          newDrawerWidth = minDrawerWidth\n        }\n        self.drawerWidth = newDrawerWidth\n        return newDrawerWidth\n      },\n\n      /**\n       * #action\n       */\n      resizeDrawer(distance: number) {\n        if (self.drawerPosition === 'left') {\n          distance *= -1\n        }\n        const oldDrawerWidth = self.drawerWidth\n        const newDrawerWidth = this.updateDrawerWidth(oldDrawerWidth - distance)\n        return oldDrawerWidth - newDrawerWidth\n      },\n\n      /**\n       * #action\n       */\n      addWidget(\n        typeName: string,\n        id: string,\n        initialState = {},\n        conf?: unknown,\n      ) {\n        const typeDefinition = pluginManager.getElementType('widget', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown widget type ${typeName}`)\n        }\n        const data = {\n          ...initialState,\n          id,\n          type: typeName,\n          configuration: conf || { type: typeName },\n        }\n        self.widgets.set(id, data)\n        return self.widgets.get(id)\n      },\n\n      /**\n       * #action\n       */\n      showWidget(widget: WidgetStateModel) {\n        if (self.activeWidgets.has(widget.id)) {\n          self.activeWidgets.delete(widget.id)\n        }\n        self.activeWidgets.set(widget.id, widget)\n        self.minimized = false\n      },\n\n      /**\n       * #action\n       */\n      hasWidget(widget: WidgetStateModel) {\n        return self.activeWidgets.has(widget.id)\n      },\n\n      /**\n       * #action\n       */\n      hideWidget(widget: WidgetStateModel) {\n        self.activeWidgets.delete(widget.id)\n      },\n\n      /**\n       * #action\n       */\n      minimizeWidgetDrawer() {\n        self.minimized = true\n      },\n      /**\n       * #action\n       */\n      showWidgetDrawer() {\n        self.minimized = false\n      },\n      /**\n       * #action\n       */\n      hideAllWidgets() {\n        self.activeWidgets.clear()\n      },\n\n      /**\n       * #action\n       * opens a configuration editor to configure the given thing,\n       * and sets the current task to be configuring it\n       * @param configuration -\n       */\n      editConfiguration(configuration: AnyConfigurationModel) {\n        if (!isConfigurationModel(configuration)) {\n          throw new Error(\n            'must pass a configuration model to editConfiguration',\n          )\n        }\n        const editor = this.addWidget(\n          'ConfigurationEditorWidget',\n          'configEditor',\n          { target: configuration },\n        )\n        this.showWidget(editor)\n      },\n\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem('drawerPosition', self.drawerPosition)\n          }),\n        )\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that manages drawer widgets */\nexport type SessionWithDrawerWidgetsType = ReturnType<\n  typeof DrawerWidgetSessionMixin\n>\n\n/** Instance of a session that manages drawer widgets */\nexport type SessionWithDrawerWidgets = Instance<SessionWithDrawerWidgetsType>\n\n/** Type guard for SessionWithDrawerWidgets */\nexport function isSessionWithDrawerWidgets(\n  session: IAnyStateTreeNode,\n): session is SessionWithDrawerWidgets {\n  return (\n    isBaseSession(session) &&\n    'widgets' in session &&\n    'drawerPosition' in session\n  )\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { lazy } from 'react'\nimport clone from 'clone'\nimport { PluginDefinition } from '@jbrowse/core/PluginLoader'\nimport {\n  getConf,\n  AnyConfigurationModel,\n  readConfObject,\n  AnyConfiguration,\n} from '@jbrowse/core/configuration'\nimport { AssemblyManager, JBrowsePlugin } from '@jbrowse/core/util/types'\nimport addSnackbarToModel from '@jbrowse/core/ui/SnackbarModel'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport { autorun } from 'mobx'\nimport {\n  addDisposer,\n  cast,\n  getParent,\n  getSnapshot,\n  types,\n  SnapshotIn,\n  Instance,\n} from 'mobx-state-tree'\nimport TextSearchManager from '@jbrowse/core/TextSearch/TextSearchManager'\nimport { BaseTrackConfig } from '@jbrowse/core/pluggableElementTypes'\n\n// icons\nimport SettingsIcon from '@mui/icons-material/Settings'\nimport CopyIcon from '@mui/icons-material/FileCopy'\nimport DeleteIcon from '@mui/icons-material/Delete'\nimport InfoIcon from '@mui/icons-material/Info'\n\n// locals\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  DialogQueueSessionMixin,\n  DrawerWidgetSessionMixin,\n  MultipleViewsSessionMixin,\n  ReferenceManagementSessionMixin,\n  SessionTracksManagerSessionMixin,\n  ThemeManagerSessionMixin,\n} from '@jbrowse/product-core'\nimport {\n  AppFocusMixin,\n  SessionAssembliesMixin,\n  TemporaryAssembliesMixin,\n} from '@jbrowse/app-core'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\n// locals\nimport { WebSessionConnectionsMixin } from '../SessionConnections'\nimport { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\n\nconst AboutDialog = lazy(() => import('./AboutDialog'))\n\nexport function BaseWebSession({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  const sessionModel = types\n    .compose(\n      'WebCoreSessionModel',\n      types.compose(\n        'WebCoreSessionModelGroupA',\n        ReferenceManagementSessionMixin(pluginManager),\n        DrawerWidgetSessionMixin(pluginManager),\n        DialogQueueSessionMixin(pluginManager),\n        ThemeManagerSessionMixin(pluginManager),\n        MultipleViewsSessionMixin(pluginManager),\n      ),\n      types.compose(\n        'WebCoreSessionModelGroupB',\n        SessionTracksManagerSessionMixin(pluginManager),\n        SessionAssembliesMixin(pluginManager, assemblyConfigSchema),\n        TemporaryAssembliesMixin(pluginManager, assemblyConfigSchema),\n        WebSessionConnectionsMixin(pluginManager),\n        AppFocusMixin(),\n      ),\n    )\n    .props({\n      /**\n       * #property\n       */\n      margin: 0,\n      /**\n       * #property\n       */\n      sessionPlugins: types.array(types.frozen()),\n    })\n    .volatile((/* self */) => ({\n      /**\n       * #volatile\n       */\n      sessionThemeName: localStorageGetItem('themeName') || 'default',\n      /**\n       * #volatile\n       * this is the current \"task\" that is being performed in the UI.\n       * this is usually an object of the form\n       * `{ taskName: \"configure\", target: thing_being_configured }`\n       */\n      task: undefined,\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return [...self.sessionTracks, ...self.jbrowse.tracks]\n      },\n      /**\n       * #getter\n       */\n      get root() {\n        return getParent<any>(self)\n      },\n      /**\n       * #getter\n       * list of sessionAssemblies and jbrowse config assemblies, does not\n       * include temporaryAssemblies. basically the list to be displayed in a\n       * AssemblySelector dropdown\n       */\n      get assemblies(): Instance<BaseAssemblyConfigSchema[]> {\n        return [...self.jbrowse.assemblies, ...self.sessionAssemblies]\n      },\n      /**\n       * #getter\n       * list of config connections and session connections\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        return [...self.jbrowse.connections, ...self.sessionConnections]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setName(str: string) {\n        self.name = str\n      },\n    }))\n\n    .views(self => ({\n      /**\n       * #getter\n       * list of sessionAssemblies and jbrowse config assemblies, does not\n       * include temporaryAssemblies. basically the list to be displayed in a\n       * AssemblySelector dropdown\n       */\n      get assemblyNames() {\n        return self.assemblies.map(f => readConfObject(f, 'name') as string)\n      },\n      /**\n       * #getter\n       */\n      get version() {\n        return self.root.version\n      },\n      /**\n       * #getter\n       */\n      get shareURL() {\n        return getConf(self.jbrowse, 'shareURL')\n      },\n      /**\n       * #getter\n       */\n      get textSearchManager(): TextSearchManager {\n        return self.root.textSearchManager\n      },\n      /**\n       * #getter\n       */\n      get assemblyManager(): AssemblyManager {\n        return self.root.assemblyManager\n      },\n      /**\n       * #getter\n       */\n      get savedSessions() {\n        return self.root.savedSessions\n      },\n      /**\n       * #getter\n       */\n      get previousAutosaveId() {\n        return self.root.previousAutosaveId\n      },\n      /**\n       * #getter\n       */\n      get savedSessionNames() {\n        return self.root.savedSessionNames\n      },\n      /**\n       * #getter\n       */\n      get history() {\n        return self.root.history\n      },\n      /**\n       * #getter\n       */\n      get menus() {\n        return self.root.menus\n      },\n      /**\n       * #method\n       */\n      renderProps() {\n        return {\n          theme: self.theme,\n        }\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addAssemblyConf(conf: AnyConfiguration) {\n        self.jbrowse.addAssemblyConf(conf)\n      },\n      /**\n       * #action\n       */\n      addSessionPlugin(plugin: JBrowsePlugin) {\n        if (self.sessionPlugins.some(p => p.name === plugin.name)) {\n          throw new Error('session plugin cannot be installed twice')\n        }\n        self.sessionPlugins.push(plugin)\n        self.root.setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      removeSessionPlugin(pluginDefinition: PluginDefinition) {\n        self.sessionPlugins = cast(\n          self.sessionPlugins.filter(\n            plugin =>\n              plugin.url !== pluginDefinition.url ||\n              plugin.umdUrl !== pluginDefinition.umdUrl ||\n              plugin.cjsUrl !== pluginDefinition.cjsUrl ||\n              plugin.esmUrl !== pluginDefinition.esmUrl,\n          ),\n        )\n        getParent<any>(self).setPluginsUpdated(true)\n      },\n\n      /**\n       * #action\n       */\n      addSavedSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return self.root.addSavedSession(sessionSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      removeSavedSession(sessionSnapshot: { name: string }) {\n        return self.root.removeSavedSession(sessionSnapshot)\n      },\n\n      /**\n       * #action\n       */\n      renameCurrentSession(sessionName: string) {\n        return self.root.renameCurrentSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      duplicateCurrentSession() {\n        return self.root.duplicateCurrentSession()\n      },\n      /**\n       * #action\n       */\n      activateSession(sessionName: string) {\n        return self.root.activateSession(sessionName)\n      },\n\n      /**\n       * #action\n       */\n      setDefaultSession() {\n        return self.root.setDefaultSession()\n      },\n\n      /**\n       * #action\n       */\n      saveSessionToLocalStorage() {\n        return self.root.saveSessionToLocalStorage()\n      },\n\n      /**\n       * #action\n       */\n      loadAutosaveSession() {\n        return self.root.loadAutosaveSession()\n      },\n\n      /**\n       * #action\n       */\n      setSession(sessionSnapshot: SnapshotIn<typeof self>) {\n        return self.root.setSession(sessionSnapshot)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      editTrackConfiguration(configuration: AnyConfigurationModel) {\n        const { adminMode, sessionTracks } = self\n        if (!adminMode && !sessionTracks.includes(configuration)) {\n          throw new Error(\"Can't edit the configuration of a non-session track\")\n        }\n        self.editConfiguration(configuration)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #method\n       */\n      getTrackActionMenuItems(config: BaseTrackConfig) {\n        const { adminMode, sessionTracks } = self\n        const canEdit =\n          adminMode || sessionTracks.find(t => t.trackId === config.trackId)\n\n        // disable if it is a reference sequence track\n        const isRefSeq = config.type === 'ReferenceSequenceTrack'\n        return [\n          {\n            label: 'About track',\n            onClick: () => {\n              self.queueDialog(handleClose => [\n                AboutDialog,\n                { config, handleClose },\n              ])\n            },\n            icon: InfoIcon,\n          },\n          {\n            label: 'Settings',\n            disabled: !canEdit,\n            onClick: () => self.editTrackConfiguration(config),\n            icon: SettingsIcon,\n          },\n          {\n            label: 'Delete track',\n            disabled: !canEdit || isRefSeq,\n            onClick: () => self.deleteTrackConf(config),\n            icon: DeleteIcon,\n          },\n          {\n            label: 'Copy track',\n            disabled: isRefSeq,\n            onClick: () => {\n              interface Display {\n                displayId: string\n              }\n              const snap = clone(getSnapshot(config)) as {\n                [key: string]: unknown\n                displays: Display[]\n              }\n              const now = Date.now()\n              snap.trackId += `-${now}`\n              snap.displays.forEach(display => {\n                display.displayId += `-${now}`\n              })\n              // the -sessionTrack suffix to trackId is used as metadata for\n              // the track selector to store the track in a special category,\n              // and default category is also cleared\n              if (!self.adminMode) {\n                snap.trackId += '-sessionTrack'\n                snap.category = undefined\n              }\n              snap.name += ' (copy)'\n              self.addTrackConf(snap)\n            },\n            icon: CopyIcon,\n          },\n        ]\n      },\n    }))\n    .actions(self => ({\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem('drawerPosition', self.drawerPosition)\n            localStorageSetItem('themeName', self.themeName)\n          }),\n        )\n      },\n    }))\n\n  const extendedSessionModel = pluginManager.evaluateExtensionPoint(\n    'Core-extendSession',\n    sessionModel,\n  ) as typeof sessionModel\n\n  return types.snapshotProcessor(addSnackbarToModel(extendedSessionModel), {\n    // @ts-expect-error\n    preProcessor(snapshot) {\n      if (snapshot) {\n        // @ts-expect-error\n        const { connectionInstances, ...rest } = snapshot || {}\n        // connectionInstances schema changed from object to an array, so any\n        // old connectionInstances as object is in snapshot, filter it out\n        // https://github.com/GMOD/jbrowse-components/issues/1903\n        if (!Array.isArray(connectionInstances)) {\n          return rest\n        }\n      }\n      return snapshot\n    },\n  })\n}\n","/** MST mixin for managing a queue of dialogs at the level of the session */\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { DialogComponentType } from '@jbrowse/core/util'\nimport { IAnyStateTreeNode, Instance, types } from 'mobx-state-tree'\nimport { isBaseSession } from './BaseSession'\n\n/**\n * #stateModel DialogQueueSessionMixin\n */\nexport function DialogQueueSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model('DialogQueueSessionMixin', {})\n    .volatile(() => ({\n      queueOfDialogs: [] as [DialogComponentType, unknown][],\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get DialogComponent() {\n        return self.queueOfDialogs[0]?.[0]\n      },\n      /**\n       * #getter\n       */\n      get DialogProps() {\n        return self.queueOfDialogs[0]?.[1]\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      removeActiveDialog() {\n        self.queueOfDialogs = self.queueOfDialogs.slice(1)\n      },\n      /**\n       * #action\n       */\n      queueDialog(\n        cb: (doneCallback: () => void) => [DialogComponentType, unknown],\n      ) {\n        const [component, props] = cb(() => {\n          this.removeActiveDialog()\n        })\n        self.queueOfDialogs = [...self.queueOfDialogs, [component, props]]\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that has `queueOfDialogs`, etc. */\nexport type SessionWithDialogsType = ReturnType<typeof DialogQueueSessionMixin>\n\n/** Instance of a session that has dialogs */\nexport type SessionWithDialogs = Instance<SessionWithDialogsType>\n\n/** Type guard for SessionWithDialogs */\nexport function isSessionWithDialogs(\n  session: IAnyStateTreeNode,\n): session is SessionWithDialogs {\n  return isBaseSession(session) && 'queueOfDialogs' in session\n}\n","import {\n  IAnyStateTreeNode,\n  Instance,\n  addDisposer,\n  types,\n} from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { getConf } from '@jbrowse/core/configuration'\nimport { createJBrowseTheme, defaultThemes } from '@jbrowse/core/ui'\nimport { localStorageGetItem, localStorageSetItem } from '@jbrowse/core/util'\nimport { ThemeOptions } from '@mui/material'\nimport { autorun } from 'mobx'\n\n// locals\nimport { BaseSession } from './BaseSession'\n\ntype ThemeMap = Record<string, ThemeOptions>\n\n/**\n * #stateModel ThemeManagerSessionMixin\n */\nexport function ThemeManagerSessionMixin(_pluginManager: PluginManager) {\n  return types\n    .model({})\n    .volatile(() => ({\n      sessionThemeName: localStorageGetItem('themeName') || 'default',\n    }))\n    .views(s => ({\n      /**\n       * #method\n       */\n      allThemes(): ThemeMap {\n        const self = s as typeof s & BaseSession\n        const extraThemes = getConf(self.jbrowse, 'extraThemes')\n        return { ...defaultThemes, ...extraThemes }\n      },\n      /**\n       * #getter\n       */\n      get themeName() {\n        const { sessionThemeName } = s\n        const all = this.allThemes()\n        return all[sessionThemeName] ? sessionThemeName : 'default'\n      },\n      /**\n       * #getter\n       */\n      get theme() {\n        const self = s as typeof s & BaseSession\n        const configTheme = getConf(self.jbrowse, 'theme')\n        const all = this.allThemes()\n        return createJBrowseTheme(configTheme, all, this.themeName)\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      setThemeName(name: string) {\n        self.sessionThemeName = name\n      },\n      afterAttach() {\n        addDisposer(\n          self,\n          autorun(() => {\n            localStorageSetItem('themeName', self.themeName)\n          }),\n        )\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that supports theming */\nexport type SessionWithThemesType = ReturnType<typeof ThemeManagerSessionMixin>\n\n/** Instance of a session that has theming support */\nexport type SessionWithThemes = Instance<SessionWithThemesType>\n\n/** Type guard for SessionWithThemes */\nexport function isSessionWithThemes(\n  session: IAnyStateTreeNode,\n): session is SessionWithThemes {\n  return 'theme' in session\n}\n","import {\n  IAnyStateTreeNode,\n  Instance,\n  getSnapshot,\n  types,\n} from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { readConfObject } from '@jbrowse/core/configuration'\nimport { Region } from '@jbrowse/core/util'\nimport { DrawerWidgetSessionMixin } from './DrawerWidgets'\nimport { IBaseViewModel } from '@jbrowse/core/pluggableElementTypes'\nimport { IBaseViewModelWithDisplayedRegions } from '@jbrowse/core/pluggableElementTypes/models/BaseViewModel'\n\n// locals\nimport { BaseSessionModel, isBaseSession } from './BaseSession'\n\n/**\n * #stateModel MultipleViewsSessionMixin\n */\nexport function MultipleViewsSessionMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      BaseSessionModel(pluginManager),\n      DrawerWidgetSessionMixin(pluginManager),\n    )\n    .props({\n      /**\n       * #property\n       */\n      views: types.array(pluginManager.pluggableMstType('view', 'stateModel')),\n    })\n    .actions(self => ({\n      /**\n       * #action\n       */\n      moveViewUp(id: string) {\n        const idx = self.views.findIndex(v => v.id === id)\n\n        if (idx === -1) {\n          return\n        }\n        if (idx > 0) {\n          self.views.splice(idx - 1, 2, self.views[idx], self.views[idx - 1])\n        }\n      },\n      /**\n       * #action\n       */\n      moveViewDown(id: string) {\n        const idx = self.views.findIndex(v => v.id === id)\n\n        if (idx === -1) {\n          return\n        }\n\n        if (idx < self.views.length - 1) {\n          self.views.splice(idx, 2, self.views[idx + 1], self.views[idx])\n        }\n      },\n\n      /**\n       * #action\n       */\n      addView(typeName: string, initialState = {}) {\n        const typeDefinition = pluginManager.getElementType('view', typeName)\n        if (!typeDefinition) {\n          throw new Error(`unknown view type ${typeName}`)\n        }\n\n        const length = self.views.push({\n          ...initialState,\n          type: typeName,\n        })\n        return self.views[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      removeView(view: IBaseViewModel) {\n        for (const [, widget] of self.activeWidgets) {\n          if (widget.view && widget.view.id === view.id) {\n            self.hideWidget(widget)\n          }\n        }\n        self.views.remove(view)\n      },\n\n      /**\n       * #action\n       */\n      addLinearGenomeViewOfAssembly(assemblyName: string, initialState = {}) {\n        return this.addViewOfAssembly(\n          'LinearGenomeView',\n          assemblyName,\n          initialState,\n        )\n      },\n\n      /**\n       * #action\n       */\n      addViewOfAssembly(\n        viewType: string,\n        assemblyName: string,\n        initialState: Record<string, unknown> = {},\n      ) {\n        const asm = self.assemblies.find(\n          s => readConfObject(s, 'name') === assemblyName,\n        )\n        if (!asm) {\n          throw new Error(\n            `Could not add view of assembly \"${assemblyName}\", assembly name not found`,\n          )\n        }\n        return this.addView(viewType, {\n          ...initialState,\n          displayRegionsFromAssemblyName: readConfObject(asm, 'name'),\n        })\n      },\n\n      /**\n       * #action\n       */\n      addViewFromAnotherView(\n        viewType: string,\n        otherView: IBaseViewModelWithDisplayedRegions,\n        initialState: { displayedRegions?: Region[] } = {},\n      ) {\n        const state = { ...initialState }\n        state.displayedRegions = getSnapshot(otherView.displayedRegions)\n        return this.addView(viewType, state)\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that manages multiple views */\nexport type SessionWithMultipleViewsType = ReturnType<\n  typeof MultipleViewsSessionMixin\n>\n\n/** Instance of a session with multiple views */\nexport type SessionWithMultipleViews = Instance<SessionWithMultipleViewsType>\n\n/** Type guard for SessionWithMultipleViews */\nexport function isSessionWithMultipleViews(\n  session: IAnyStateTreeNode,\n): session is SessionWithMultipleViews {\n  return isBaseSession(session) && 'views' in session\n}\n","import { IAnyStateTreeNode, Instance, types } from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AnyConfiguration,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\n\n// locals\nimport { TracksManagerSessionMixin } from './Tracks'\nimport { isBaseSession } from './BaseSession'\n\n/**\n * #stateModel SessionTracksManagerSessionMixin\n */\nexport function SessionTracksManagerSessionMixin(pluginManager: PluginManager) {\n  return TracksManagerSessionMixin(pluginManager)\n    .named('SessionTracksManagerSessionMixin')\n    .props({\n      /**\n       * #property\n       */\n      sessionTracks: types.array(\n        pluginManager.pluggableConfigSchemaType('track'),\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return self.jbrowse.tracks\n      },\n    }))\n    .actions(self => {\n      const {\n        addTrackConf: superAddTrackConf,\n        deleteTrackConf: superDeleteTrackConf,\n      } = self\n      return {\n        /**\n         * #action\n         */\n        addTrackConf(trackConf: AnyConfiguration) {\n          if (self.adminMode) {\n            return superAddTrackConf(trackConf)\n          }\n          const { trackId, type } = trackConf as {\n            type: string\n            trackId: string\n          }\n          if (!type) {\n            throw new Error(`unknown track type ${type}`)\n          }\n          const track = self.sessionTracks.find(t => t.trackId === trackId)\n          if (track) {\n            return track\n          }\n          const length = self.sessionTracks.push(trackConf)\n          return self.sessionTracks[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        deleteTrackConf(trackConf: AnyConfigurationModel) {\n          // try to delete it in the main config if in admin mode\n          const found = superDeleteTrackConf(trackConf)\n          if (found) {\n            return found\n          }\n          // if not found or not in admin mode, try to delete it in the\n          // sessionTracks\n          const { trackId } = trackConf\n          const idx = self.sessionTracks.findIndex(t => t.trackId === trackId)\n          if (idx === -1) {\n            return undefined\n          }\n          return self.sessionTracks.splice(idx, 1)\n        },\n      }\n    })\n}\n\n/** Session mixin MST type for a session that has `sessionTracks` */\nexport type SessionWithSessionTracksType = ReturnType<\n  typeof SessionTracksManagerSessionMixin\n>\n\n/** Instance of a session that has `sessionTracks` */\nexport type SessionWithSessionTracks = Instance<SessionWithSessionTracksType>\n\n/** Type guard for SessionWithSessionTracks */\nexport function isSessionWithSessionTracks(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithSessionTracks {\n  return isBaseSession(thing) && 'sessionTracks' in thing\n}\n","import { IAnyStateTreeNode, Instance, types } from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AnyConfiguration,\n  AnyConfigurationModel,\n} from '@jbrowse/core/configuration'\nimport { BaseSessionModel, isBaseSession } from './BaseSession'\nimport { ReferenceManagementSessionMixin } from './ReferenceManagement'\n\n/**\n * #stateModel TracksManagerSessionMixin\n * composed of\n * - BaseSessionModel\n * - ReferenceManagementSessionMixin\n */\nexport function TracksManagerSessionMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'TracksManagerSessionMixin',\n      BaseSessionModel(pluginManager),\n      ReferenceManagementSessionMixin(pluginManager),\n    )\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get tracks(): AnyConfigurationModel[] {\n        return self.jbrowse.tracks\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      addTrackConf(trackConf: AnyConfiguration) {\n        return self.jbrowse.addTrackConf(trackConf)\n      },\n\n      /**\n       * #action\n       */\n      deleteTrackConf(trackConf: AnyConfigurationModel) {\n        const callbacksToDereferenceTrack: Function[] = []\n        const dereferenceTypeCount: Record<string, number> = {}\n        const referring = self.getReferring(trackConf)\n        self.removeReferring(\n          referring,\n          trackConf,\n          callbacksToDereferenceTrack,\n          dereferenceTypeCount,\n        )\n        callbacksToDereferenceTrack.forEach(cb => cb())\n        if (self.adminMode) {\n          return self.jbrowse.deleteTrackConf(trackConf)\n        }\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that has tracks */\nexport type SessionWithTracksType = ReturnType<typeof TracksManagerSessionMixin>\n\n/** Instance of a session that has tracks */\nexport type SessionWithTracks = Instance<SessionWithTracksType>\n\n/** Type guard for SessionWithTracks */\nexport function isSessionWithTracks(\n  thing: IAnyStateTreeNode,\n): thing is SessionWithTracks {\n  return isBaseSession(thing) && 'tracks' in thing\n}\n","import { types } from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfiguration } from '@jbrowse/core/configuration'\nimport { BaseSession } from '@jbrowse/product-core'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\n\n/**\n * #stateModel SessionAssembliesMixin\n * #category root\n */\nexport function SessionAssembliesMixin(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType: BaseAssemblyConfigSchema,\n) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      sessionAssemblies: types.array(assemblyConfigSchemasType),\n    })\n    .actions(s => {\n      const self = s as typeof s & BaseSession\n      return {\n        /**\n         * #action\n         */\n        addSessionAssembly(conf: AnyConfiguration) {\n          const asm = self.sessionAssemblies.find(f => f.name === conf.name)\n          if (asm) {\n            console.warn(`Assembly ${conf.name} already exists`)\n            return asm\n          }\n          const length = self.sessionAssemblies.push(conf)\n          return self.sessionAssemblies[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        removeSessionAssembly(assemblyName: string) {\n          const elt = self.sessionAssemblies.find(a => a.name === assemblyName)\n          if (elt) {\n            self.sessionAssemblies.remove(elt)\n          }\n        },\n      }\n    })\n}\n","import { types } from 'mobx-state-tree'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfiguration } from '@jbrowse/core/configuration'\nimport { BaseSession } from '@jbrowse/product-core'\n\n/**\n * #stateModel TemporaryAssembliesMixin\n * #category root\n */\nexport function TemporaryAssembliesMixin(\n  pluginManager: PluginManager,\n  assemblyConfigSchemasType = types.frozen(),\n) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      temporaryAssemblies: types.array(assemblyConfigSchemasType),\n    })\n\n    .actions(s => {\n      const self = s as typeof s & BaseSession\n      return {\n        /**\n         * #action\n         * used for read vs ref type assemblies.\n         */\n        addTemporaryAssembly(conf: AnyConfiguration) {\n          const asm = self.temporaryAssemblies.find(f => f.name === conf.name)\n          if (asm) {\n            console.warn(`Assembly ${conf.name} was already existing`)\n            return asm\n          }\n          const length = self.temporaryAssemblies.push(conf)\n          return self.temporaryAssemblies[length - 1]\n        },\n\n        /**\n         * #action\n         */\n        removeTemporaryAssembly(name: string) {\n          const elt = self.temporaryAssemblies.find(a => a.name === name)\n          if (elt) {\n            self.temporaryAssemblies.remove(elt)\n          }\n        },\n      }\n    })\n}\n","import { types } from 'mobx-state-tree'\n\nimport {\n  ConnectionManagementSessionMixin,\n  SessionWithSessionTracks,\n} from '@jbrowse/product-core'\nimport type { BaseSession } from '@jbrowse/product-core'\n\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\n\n/**\n * #stateModel WebSessionConnectionsMixin\n * #category session\n */\nexport function WebSessionConnectionsMixin(pluginManager: PluginManager) {\n  return types\n    .compose(\n      'SessionConnectionsManagement',\n      ConnectionManagementSessionMixin(pluginManager),\n      types.model({\n        /**\n         * #property\n         */\n        sessionConnections: types.array(\n          pluginManager.pluggableConfigSchemaType('connection'),\n        ),\n      }),\n    )\n    .actions(s => {\n      const self = s as typeof s & BaseSession & SessionWithSessionTracks\n      const superDeleteConnection = self.deleteConnection\n      const superAddConnectionConf = self.addConnectionConf\n      return {\n        addConnectionConf(connectionConf: BaseConnectionConfigModel) {\n          if (self.adminMode) {\n            return superAddConnectionConf(connectionConf)\n          }\n          const { connectionId, type } = connectionConf\n          if (!type) {\n            throw new Error(`unknown connection type ${type}`)\n          }\n          const connection = self.sessionTracks.find(\n            c => c.connectionId === connectionId,\n          )\n          if (connection) {\n            return connection\n          }\n          const length = self.sessionConnections.push(connectionConf)\n          return self.sessionConnections[length - 1]\n        },\n\n        deleteConnection(configuration: AnyConfigurationModel) {\n          let deletedConn\n          if (self.adminMode) {\n            deletedConn = superDeleteConnection(configuration)\n          }\n          if (!deletedConn) {\n            const { connectionId } = configuration\n            const idx = self.sessionConnections.findIndex(\n              c => c.connectionId === connectionId,\n            )\n            if (idx === -1) {\n              return undefined\n            }\n            return self.sessionConnections.splice(idx, 1)\n          }\n          return deletedConn\n        },\n      }\n    })\n}\n","import { types } from 'mobx-state-tree'\n\n/**\n * #stateModel AppFocusMixin\n * #category session\n */\nexport function AppFocusMixin() {\n  return types\n    .model({\n      /**\n       * #property\n       * used to keep track of which view is in focus\n       */\n      focusedViewId: types.maybe(types.string),\n    })\n    .actions(self => ({\n      setFocusedViewId(viewId: string) {\n        self.focusedViewId = viewId\n      },\n    }))\n}\n","import { IModelType, ModelProperties } from 'mobx-state-tree'\nimport { IObservableArray, observable } from 'mobx'\nimport { NotificationLevel, SnackAction } from '../util/types'\n\nexport interface SnackbarMessage {\n  message: string\n  level?: NotificationLevel\n  action?: SnackAction\n}\n\n/**\n * #stateModel SnackbarModel\n * #category session\n */\nfunction makeExtension(snackbarMessages: IObservableArray<SnackbarMessage>) {\n  return {\n    views: {\n      /**\n       * #getter\n       */\n      get snackbarMessages() {\n        return snackbarMessages\n      },\n    },\n    actions: {\n      /**\n       * #action\n       */\n      notify(message: string, level?: NotificationLevel, action?: SnackAction) {\n        this.pushSnackbarMessage(message, level, action)\n        if (level === 'info' || level === 'success') {\n          setTimeout(() => {\n            this.removeSnackbarMessage(message)\n          }, 5000)\n        }\n      },\n      /**\n       * #action\n       */\n      pushSnackbarMessage(\n        message: string,\n        level?: NotificationLevel,\n        action?: SnackAction,\n      ) {\n        return snackbarMessages.push({ message, level, action })\n      },\n      /**\n       * #action\n       */\n      popSnackbarMessage() {\n        return snackbarMessages.pop()\n      },\n      /**\n       * #action\n       */\n      removeSnackbarMessage(message: string) {\n        const element = snackbarMessages.find(f => f.message === message)\n        if (element) {\n          snackbarMessages.remove(element)\n        }\n      },\n    },\n  }\n}\n\nexport default function addSnackbarToModel<\n  PROPS extends ModelProperties,\n  OTHERS,\n>(\n  tree: IModelType<PROPS, OTHERS>,\n): IModelType<\n  PROPS,\n  OTHERS &\n    ReturnType<typeof makeExtension>['actions'] &\n    ReturnType<typeof makeExtension>['views']\n> {\n  return tree.extend(() => {\n    const snackbarMessages = observable.array<SnackbarMessage>()\n\n    return makeExtension(snackbarMessages)\n  })\n}\n","import { AbstractSessionModel } from '@jbrowse/core/util/types'\nimport { Instance } from 'mobx-state-tree'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\nimport { BaseWebSession } from '@jbrowse/web-core'\n\n/**\n * #stateModel JBrowseWebSessionModel\n * composed of\n * - SnackbarModel\n * - ReferenceManagementSessionMixin\n * - DrawerWidgetSessionMixin\n * - DialogQueueSessionMixin\n * - ThemeManagerSessionMixin\n * - MultipleViewsSessionMixin\n * - SessionTracksManagerSessionMixin\n * - SessionAssembliesMixin\n * - TemporaryAssembliesMixin\n * - WebSessionConnectionsMixin\n * - AppFocusMixin\n *\n */\nexport default function sessionModelFactory({\n  pluginManager,\n  assemblyConfigSchema,\n}: {\n  pluginManager: PluginManager\n  assemblyConfigSchema: BaseAssemblyConfigSchema\n}) {\n  return BaseWebSession({ pluginManager, assemblyConfigSchema })\n}\n\nexport type WebSessionModelType = ReturnType<typeof sessionModelFactory>\nexport type WebSessionModel = Instance<WebSessionModelType>\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction z(x: Instance<WebSessionModelType>): AbstractSessionModel {\n  // this function's sole purpose is to get typescript to check\n  // that the session model implements all of AbstractSessionModel\n  return x\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport { doAnalytics } from '@jbrowse/core/util/analytics'\n\n// locals\nimport JBrowseRootModelFactory from './rootModel/rootModel'\nimport sessionModelFactory from './sessionModel'\nimport corePlugins from './corePlugins'\nimport { SessionLoaderModel, loadSessionSpec } from './SessionLoader'\n\nexport function createPluginManager(self: SessionLoaderModel) {\n  // it is ready when a session has loaded and when there is no config\n  // error Assuming that the query changes self.sessionError or\n  // self.sessionSnapshot or self.blankSession\n  const pluginManager = new PluginManager([\n    ...corePlugins.map(P => ({\n      plugin: new P(),\n      metadata: { isCore: true },\n    })),\n    ...self.runtimePlugins.map(({ plugin: P, definition }) => ({\n      plugin: new P(),\n      definition,\n      metadata: { url: definition.url },\n    })),\n    ...self.sessionPlugins.map(({ plugin: P, definition }) => ({\n      plugin: new P(),\n      definition,\n      metadata: { url: definition.url },\n    })),\n  ])\n  pluginManager.createPluggableElements()\n  const RootModel = JBrowseRootModelFactory({\n    pluginManager,\n    sessionModelFactory,\n    adminMode: !!self.adminKey,\n  })\n\n  if (!self.configSnapshot) {\n    return undefined\n  }\n  const rootModel = RootModel.create(\n    {\n      jbrowse: self.configSnapshot,\n      configPath: self.configPath,\n    },\n    { pluginManager },\n  )\n\n  // @ts-expect-error\n  if (!self.configSnapshot?.configuration?.rpc?.defaultDriver) {\n    const { rpc } = rootModel.jbrowse.configuration\n    rpc.defaultDriver.set('WebWorkerRpcDriver')\n  }\n\n  let afterInitializedCb = () => {}\n\n  // in order: saves the previous autosave for recovery, tries to\n  // load the local session if session in query, or loads the default\n  // session\n  try {\n    if (self.sessionError) {\n      rootModel.setDefaultSession()\n      rootModel.session.notify(\n        `Error loading session: ${self.sessionError}. If you\n                received this URL from another user, request that they send you\n                a session generated with the \"Share\" button instead of copying\n                and pasting their URL`,\n      )\n    } else if (self.sessionSnapshot) {\n      rootModel.setSession(self.sessionSnapshot)\n    } else if (self.sessionSpec) {\n      // @ts-expect-error\n      afterInitializedCb = loadSessionSpec(self.sessionSpec, pluginManager)\n    } else if (rootModel.jbrowse.defaultSession?.views?.length) {\n      rootModel.setDefaultSession()\n    }\n  } catch (e) {\n    rootModel.setDefaultSession()\n    const str = `${e}`\n    const errorMessage = str\n      .replace('[mobx-state-tree] ', '')\n      .replace(/\\(.+/, '')\n    rootModel.session?.notify(\n      `Session could not be loaded. ${\n        errorMessage.length > 1000\n          ? `${errorMessage.slice(0, 1000)}...see more in console`\n          : errorMessage\n      }`,\n    )\n    console.error(e)\n  }\n\n  // send analytics\n  doAnalytics(rootModel, self.initialTimestamp, self.sessionQuery)\n\n  pluginManager.setRootModel(rootModel)\n  pluginManager.configure()\n  afterInitializedCb()\n  return pluginManager\n}\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { readConfObject } from '../configuration'\nimport { isElectron } from '../util'\n\ntype AnalyticsObj = Record<string, any>\n\ninterface Track {\n  type: string\n}\n\nexport async function writeAWSAnalytics(\n  rootModel: any,\n  initialTimeStamp: number,\n  sessionQuery?: string | null,\n) {\n  try {\n    const url = 'https://analytics.jbrowse.org/api/v1'\n\n    const multiAssemblyTracks = rootModel.jbrowse.tracks.filter(\n      (track: any) => (readConfObject(track, 'assemblyNames') || []).length > 1,\n    ).length\n\n    const savedSessionCount = Object.keys(localStorage).filter(name =>\n      name.includes('localSaved-'),\n    ).length\n\n    const { jbrowse: config, session, version: ver } = rootModel\n    const { tracks, assemblies, plugins } = config\n\n    // stats to be recorded in db\n    const stats: AnalyticsObj = {\n      ver,\n      'plugins-count': plugins?.length || 0,\n      'plugin-names': plugins?.map((p: any) => p.name).join(','),\n      'assemblies-count': assemblies.length,\n      'tracks-count': tracks.length,\n      'session-tracks-count': session?.sessionTracks.length || 0,\n      'open-views': session?.views.length || 0,\n      'synteny-tracks-count': multiAssemblyTracks,\n      'saved-sessions-count': savedSessionCount,\n\n      // field if existing session param in query before autogenerated param\n      'existing-session-param-type': sessionQuery?.split('-')[0] || 'none',\n\n      // screen geometry\n      'scn-h': window.screen.height,\n      'scn-w': window.screen.width,\n\n      // window geometry\n      'win-h': window.innerHeight,\n      'win-w': window.innerWidth,\n\n      electron: isElectron,\n      loadTime: (Date.now() - initialTimeStamp) / 1000,\n      jb2: true,\n    }\n\n    // stringifies the track type counts, gets processed in lambda\n    tracks.forEach((track: Track) => {\n      const key = `track-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // stringifies the session track type counts, gets processed in lambda\n    session?.sessionTracks.forEach((track: Track) => {\n      const key = `sessionTrack-types-${track.type}`\n      stats[key] = stats[key] + 1 || 1\n    })\n\n    // put stats into a query string for get request\n    const qs = Object.keys(stats)\n      .map(key => `${key}=${stats[key]}`)\n      .join('&')\n\n    await fetch(`${url}?${qs}`)\n  } catch (e) {\n    console.error('Failed to write analytics to AWS.', e)\n  }\n}\n\nexport async function writeGAAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n) {\n  const jbrowseUser = 'UA-7115575-5'\n  const stats: AnalyticsObj = {\n    'tracks-count': rootModel.jbrowse.tracks.length, // this is all possible tracks\n    ver: rootModel.version,\n    electron: isElectron,\n    loadTime: Date.now() - initialTimestamp,\n    pluginNames:\n      rootModel.jbrowse.plugins?.map((plugin: any) => plugin.name) || '',\n  }\n\n  // create script\n  let analyticsScript =\n    \"(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\"\n  analyticsScript +=\n    '(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),'\n  analyticsScript +=\n    'm=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)'\n  analyticsScript +=\n    \"})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');\"\n  analyticsScript += `ga('create', '${jbrowseUser}', 'auto', 'jbrowseTracker');`\n\n  const gaData: AnalyticsObj = {}\n  const googleDimensions = 'tracks-count ver electron loadTime pluginNames'\n\n  googleDimensions.split(/\\s+/).forEach((key, index) => {\n    gaData[`dimension${index + 1}`] = stats[key]\n  })\n\n  gaData.metric1 = Math.round(stats.loadTime)\n\n  analyticsScript += `ga('jbrowseTracker.send', 'pageview',${JSON.stringify(\n    gaData,\n  )});`\n\n  const analyticsScriptNode = document.createElement('script')\n  analyticsScriptNode.innerHTML = analyticsScript\n\n  document.getElementsByTagName('head')[0].append(analyticsScriptNode)\n}\n\nexport function doAnalytics(\n  rootModel: any,\n  initialTimestamp: number,\n  initialSessionQuery: string | null | undefined,\n) {\n  if (\n    rootModel &&\n    !readConfObject(rootModel.jbrowse.configuration, 'disableAnalytics')\n  ) {\n    // ok if these are unhandled\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    writeAWSAnalytics(rootModel, initialTimestamp, initialSessionQuery)\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    writeGAAnalytics(rootModel, initialTimestamp)\n  }\n}\n","import React, { lazy, useEffect, useState, Suspense } from 'react'\nimport { observer } from 'mobx-react'\nimport { ErrorBoundary } from 'react-error-boundary'\nimport {\n  StringParam,\n  QueryParamProvider,\n  useQueryParam,\n} from 'use-query-params'\nimport { WindowHistoryAdapter } from 'use-query-params/adapters/window'\nimport { FatalErrorDialog, LoadingEllipses } from '@jbrowse/core/ui'\nimport '@fontsource/roboto'\n\n// locals\nimport Loading from './Loading'\nimport JBrowse from './JBrowse'\nimport factoryReset from '../factoryReset'\nimport SessionLoader, {\n  SessionLoaderModel,\n  SessionTriagedInfo,\n} from '../SessionLoader'\nimport StartScreenErrorMessage from './StartScreenErrorMessage'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport { createPluginManager } from '../createPluginManager'\n\nconst ConfigWarningDialog = lazy(() => import('./ConfigWarningDialog'))\nconst SessionWarningDialog = lazy(() => import('./SessionWarningDialog'))\nconst StartScreen = lazy(() => import('./StartScreen'))\n\nexport function Loader({\n  initialTimestamp = Date.now(),\n}: {\n  initialTimestamp?: number\n}) {\n  // return value if defined, else convert null to undefined for use with\n  // types.maybe\n  const load = (param: string | null | undefined) =>\n    param === null ? undefined : param\n\n  const Str = StringParam\n\n  const [config] = useQueryParam('config', Str)\n  const [session] = useQueryParam('session', Str)\n  const [adminKey] = useQueryParam('adminKey', Str)\n  const [password, setPassword] = useQueryParam('password', Str)\n  const [loc, setLoc] = useQueryParam('loc', Str)\n  const [sessionTracks, setSessionTracks] = useQueryParam('sessionTracks', Str)\n  const [assembly, setAssembly] = useQueryParam('assembly', Str)\n  const [tracks, setTracks] = useQueryParam('tracks', Str)\n\n  const loader = SessionLoader.create({\n    configPath: load(config),\n    sessionQuery: load(session),\n    password: load(password),\n    adminKey: load(adminKey),\n    loc: load(loc),\n    assembly: load(assembly),\n    tracks: load(tracks),\n    sessionTracks: load(sessionTracks),\n    initialTimestamp,\n  })\n\n  useEffect(() => {\n    setLoc(undefined, 'replaceIn')\n    setTracks(undefined, 'replaceIn')\n    setAssembly(undefined, 'replaceIn')\n    setPassword(undefined, 'replaceIn')\n    setSessionTracks(undefined, 'replaceIn')\n  }, [setAssembly, setLoc, setTracks, setPassword, setSessionTracks])\n\n  return <Renderer loader={loader} />\n}\n\nconst SessionTriaged = observer(function ({\n  sessionTriaged,\n  loader,\n}: {\n  loader: SessionLoaderModel\n  sessionTriaged: SessionTriagedInfo\n}) {\n  return (\n    <Suspense fallback={<React.Fragment />}>\n      {sessionTriaged?.origin === 'session' ? (\n        <SessionWarningDialog\n          loader={loader}\n          handleClose={() => loader.setSessionTriaged(undefined)}\n        />\n      ) : (\n        <ConfigWarningDialog\n          loader={loader}\n          handleClose={() => loader.setSessionTriaged(undefined)}\n        />\n      )}\n    </Suspense>\n  )\n})\n\nconst PluginManagerLoaded = observer(function ({\n  pluginManager,\n}: {\n  pluginManager: PluginManager\n}) {\n  const { rootModel } = pluginManager\n  return !rootModel?.session ? (\n    <Suspense fallback={<LoadingEllipses />}>\n      <StartScreen rootModel={rootModel} onFactoryReset={factoryReset} />\n    </Suspense>\n  ) : (\n    <JBrowse pluginManager={pluginManager} />\n  )\n})\n\nconst Renderer = observer(function ({\n  loader,\n}: {\n  loader: SessionLoaderModel\n}) {\n  const { configError, ready, sessionTriaged } = loader\n  const [pluginManager, setPluginManager] = useState<PluginManager>()\n  const [error, setError] = useState<unknown>()\n\n  useEffect(() => {\n    let pm: PluginManager | undefined\n    try {\n      if (!ready) {\n        return\n      }\n      pm = createPluginManager(loader)\n      setPluginManager(pm)\n    } catch (e) {\n      console.error(e)\n      setError(e)\n    }\n  }, [loader, ready])\n\n  const err = configError || error\n  if (err) {\n    return <StartScreenErrorMessage error={err} />\n  } else if (sessionTriaged) {\n    return <SessionTriaged loader={loader} sessionTriaged={sessionTriaged} />\n  } else if (pluginManager) {\n    return <PluginManagerLoaded pluginManager={pluginManager} />\n  } else {\n    return <Loading />\n  }\n})\n\nfunction LoaderWrapper({ initialTimestamp }: { initialTimestamp: number }) {\n  return (\n    <ErrorBoundary\n      FallbackComponent={props => (\n        <FatalErrorDialog\n          {...props}\n          resetButtonText=\"Reset Session\"\n          onFactoryReset={factoryReset}\n        />\n      )}\n    >\n      <QueryParamProvider adapter={WindowHistoryAdapter}>\n        <Loader initialTimestamp={initialTimestamp} />\n      </QueryParamProvider>\n    </ErrorBoundary>\n  )\n}\n\nexport default LoaderWrapper\n","export default async function factoryReset() {\n  // @ts-expect-error\n  window.location = window.location.pathname\n}\n","import { toUrlSafeB64 } from './util'\n\n// from https://stackoverflow.com/questions/1349404/\nfunction generateUID(length: number) {\n  return window\n    .btoa(\n      [...window.crypto.getRandomValues(new Uint8Array(length * 2))]\n        .map(b => String.fromCharCode(b))\n        .join(''),\n    )\n    .replaceAll(/[+/]/g, '')\n    .slice(0, length)\n}\n\nconst encrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  return AES.encrypt(text, password).toString()\n}\n\nconst decrypt = async (text: string, password: string) => {\n  const AES = await import('crypto-js/aes')\n  const Utf8 = await import('crypto-js/enc-utf8')\n  const bytes = AES.decrypt(text, password)\n  return bytes.toString(Utf8)\n}\n\nfunction getErrorMsg(err: string) {\n  try {\n    const obj = JSON.parse(err)\n    return obj.message\n  } catch (e) {\n    return err\n  }\n}\n// writes the encrypted session, current datetime, and referer to DynamoDB\nexport async function shareSessionToDynamo(\n  session: unknown,\n  url: string,\n  referer: string,\n) {\n  const sess = await toUrlSafeB64(JSON.stringify(session))\n  const password = generateUID(5)\n  const encryptedSession = await encrypt(sess, password)\n\n  const data = new FormData()\n  data.append('session', encryptedSession)\n  data.append('dateShared', `${Date.now()}`)\n  data.append('referer', referer)\n\n  const response = await fetch(`${url}share`, {\n    method: 'POST',\n    mode: 'cors',\n    body: data,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n  const json = await response.json()\n  return {\n    json,\n    encryptedSession,\n    password,\n  }\n}\n\nexport async function readSessionFromDynamo(\n  baseUrl: string,\n  sessionQueryParam: string,\n  password: string,\n  signal?: AbortSignal,\n) {\n  const sessionId = sessionQueryParam.split('share-')[1]\n  const url = `${baseUrl}?sessionId=${encodeURIComponent(sessionId)}`\n  const response = await fetch(url, {\n    signal,\n  })\n\n  if (!response.ok) {\n    const err = await response.text()\n    throw new Error(getErrorMsg(err))\n  }\n\n  const json = await response.json()\n  return decrypt(json.session, password)\n}\n","import {\n  PluginDefinition,\n  isCJSPluginDefinition,\n  isESMPluginDefinition,\n  isUMDPluginDefinition,\n} from '@jbrowse/core/PluginLoader'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport {\n  getPropertyMembers,\n  getChildType,\n  isArrayType,\n  isModelType,\n  isReferenceType,\n  isValidReference,\n  isMapType,\n  types,\n  IAnyType,\n  IAnyStateTreeNode,\n  Instance,\n  SnapshotOut,\n} from 'mobx-state-tree'\n\n/**\n * Pad the end of a base64 string with \"=\" to make it valid\n * @param b64 - unpadded b64 string\n */\nexport function b64PadSuffix(b64: string): string {\n  let num = 0\n  const mo = b64.length % 4\n  switch (mo) {\n    case 3:\n      num = 1\n      break\n    case 2:\n      num = 2\n      break\n    case 0:\n      num = 0\n      break\n    default:\n      throw new Error('base64 not a valid length')\n  }\n  return b64 + '='.repeat(num)\n}\n\n/**\n * Decode and inflate a url-safe base64 to a string\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param b64 - a base64 string to decode and inflate\n */\nexport async function fromUrlSafeB64(b64: string) {\n  const originalB64 = b64PadSuffix(\n    b64.replaceAll('-', '+').replaceAll('_', '/'),\n  )\n  const { toByteArray } = await import('base64-js')\n  const { inflate } = await import('pako')\n  const bytes = toByteArray(originalB64)\n  const inflated = inflate(bytes)\n  return new TextDecoder().decode(inflated)\n}\n\n/**\n * Compress and encode a string as url-safe base64\n * See {@link https://en.wikipedia.org/wiki/Base64#URL_applications}\n * @param str-  a string to compress and encode\n */\nexport async function toUrlSafeB64(str: string) {\n  const bytes = new TextEncoder().encode(str)\n  const { deflate } = await import('pako')\n  const { fromByteArray } = await import('base64-js')\n  const deflated = deflate(bytes)\n  const encoded = fromByteArray(deflated)\n  const pos = encoded.indexOf('=')\n  return pos > 0\n    ? encoded.slice(0, pos).replaceAll('+', '-').replaceAll('/', '_')\n    : encoded.replaceAll('+', '-').replaceAll('/', '_')\n}\n\ntype MSTArray = Instance<ReturnType<typeof types.array>>\ntype MSTMap = Instance<ReturnType<typeof types.map>>\n\n// attempts to remove undefined references from the given MST model. can only actually\n// remove them from arrays and maps. throws MST undefined ref error if it encounters\n// undefined refs in model properties\nexport function filterSessionInPlace(node: IAnyStateTreeNode, type: IAnyType) {\n  // makes it work with session sharing\n  if (node === undefined) {\n    return\n  }\n  if (isArrayType(type)) {\n    const array = node as MSTArray\n    const childType = getChildType(node)\n    if (isReferenceType(childType)) {\n      // filter array elements\n      for (let i = 0; i < array.length; ) {\n        if (!isValidReference(() => array[i])) {\n          array.splice(i, 1)\n        } else {\n          i += 1\n        }\n      }\n    }\n    array.forEach(el => {\n      filterSessionInPlace(el, childType)\n    })\n  } else if (isMapType(type)) {\n    const map = node as MSTMap\n    const childType = getChildType(map)\n    if (isReferenceType(childType)) {\n      // filter the map members\n      for (const key in map.keys()) {\n        if (!isValidReference(() => map.get(key))) {\n          map.delete(key)\n        }\n      }\n    }\n    map.forEach(child => {\n      filterSessionInPlace(child, childType)\n    })\n  } else if (isModelType(type)) {\n    // iterate over children\n    const { properties } = getPropertyMembers(node)\n\n    Object.entries(properties).forEach(([pname, ptype]) => {\n      // @ts-ignore\n      filterSessionInPlace(node[pname], ptype)\n    })\n  }\n}\n\ntype Config = SnapshotOut<AnyConfigurationModel>\n\nexport function addRelativeUris(config: Config, base: URL) {\n  if (typeof config === 'object') {\n    for (const key of Object.keys(config)) {\n      if (typeof config[key] === 'object') {\n        addRelativeUris(config[key], base)\n      } else if (key === 'uri') {\n        config.baseUri = base.href\n      }\n    }\n  }\n}\n\nexport interface Root {\n  configuration?: Config\n}\n\n// raw readConf alternative for before conf is initialized\nexport function readConf({ configuration }: Root, attr: string, def: string) {\n  return configuration?.[attr] || def\n}\n\nexport async function fetchPlugins() {\n  const response = await fetch('https://jbrowse.org/plugin-store/plugins.json')\n  if (!response.ok) {\n    throw new Error(\n      `HTTP ${response.status} ${response.statusText} fetching plugins`,\n    )\n  }\n  return response.json() as Promise<{ plugins: PluginDefinition[] }>\n}\n\nexport async function checkPlugins(pluginsToCheck: PluginDefinition[]) {\n  if (pluginsToCheck.length === 0) {\n    return true\n  }\n  const storePlugins = await fetchPlugins()\n  return pluginsToCheck.every(p => {\n    if (isUMDPluginDefinition(p)) {\n      return storePlugins.plugins.some(\n        pp =>\n          isUMDPluginDefinition(p) &&\n          (('url' in pp && 'url' in p && p.url === pp.url) ||\n            ('umdUrl' in pp && 'umdUrl' in p && p.umdUrl === pp.umdUrl)),\n      )\n    }\n    if (isESMPluginDefinition(p)) {\n      return storePlugins.plugins.some(\n        pp =>\n          isESMPluginDefinition(p) && 'esmUrl' in p && p.esmUrl === pp.esmUrl,\n      )\n    }\n    if (isCJSPluginDefinition(p)) {\n      return storePlugins.plugins.some(\n        pp => isCJSPluginDefinition(p) && p.cjsUrl === pp.cjsUrl,\n      )\n    }\n    return false\n  })\n}\n\nexport function removeAttr(obj: Record<string, unknown>, attr: string) {\n  for (const prop in obj) {\n    if (prop === attr) {\n      delete obj[prop]\n    } else if (typeof obj[prop] === 'object') {\n      removeAttr(obj[prop] as Record<string, unknown>, attr)\n    }\n  }\n  return obj\n}\n"],"names":["isUMDPluginDefinition","def","undefined","umdUrl","url","umdLoc","name","isESMPluginDefinition","esmUrl","esmLoc","isCJSPluginDefinition","cjsUrl","pluginDescriptionString","pluginDefinition","uri","PluginLoader","definitions","constructor","defs","args","this","fetchESM","fetchCJS","JSON","parse","stringify","loadCJSPlugin","baseUri","parsedUrl","URL","protocol","Error","href","loadESMPlugin","plugin","loadUMDPlugin","moduleName","umdName","jest","async","scriptUrl","Boolean","globalThis","src","Promise","resolve","reject","domLoadScript","err","script","importScripts","loadScript","default","Plugin","loadPlugin","isElectron","installGlobalReExports","target","JBrowseExports","Object","fromEntries","entries","ReExports","map","module","load","all","definition","abortSignalCounter","abortSignalIds","WeakMap","serializeAbortSignal","signal","callfunc","abortSignalId","get","set","addEventListener","signalId","isRemoteAbortSignal","thing","surrogateAbortControllers","Map","deserializeAbortSignal","surrogateAbortController","AbortController","useStyles","makeStyles","importFormEntry","minWidth","observer","session","onChange","selected","InputProps","TextFieldProps","localStorageKey","helperText","classes","assemblyNames","assemblyManager","config","URLSearchParams","window","location","search","lastSelected","setLastSelected","useLocalStorage","host","pathname","join","useState","selection","includes","useEffect","error","length","React","TextField","_extends","select","label","variant","value","inputProps","event","disabled","className","assembly","displayName","getConf","MenuItem","key","CascadingContext","parentPopupState","rootPopupState","CascadingMenuItem","onClick","closeAfterItemClick","props","useContext","close","CascadingSubmenu","title","Icon","inset","popupId","popupState","usePopupState","bindHover","bindFocus","ListItemIcon","ListItemText","primary","ChevronRight","CascadingSubmenuHover","anchorOrigin","vertical","horizontal","transformOrigin","onMenuItemClick","menuItems","context","useMemo","Provider","HoverMenu","bindMenu","CascadingMenu","Menu","EndDecoration","item","MenuItemEndDecoration","type","checked","CascadingMenuList","hasIcon","some","m","icon","idx","subMenu","Divider","component","ListSubheader","callback","secondary","subLabel","style","flexGrow","rest","theme","closeButton","position","right","spacing","top","color","palette","grey","DialogError","width","margin","ErrorMessage","header","children","onClose","useTheme","MUIDialog","ScopedCssBaseline","DialogTitle","IconButton","CloseIcon","ErrorBoundary","FallbackComponent","ThemeProvider","createTheme","components","MuiInputBase","styleOverrides","input","boxSizing","inputBase","typography","left","whiteSpace","visibility","inputRoot","padding","inputFocused","borderStyle","borderWidth","ref","setValue","other","ref2","useMeasure","editedValue","setEditedValue","inputNode","setInputNode","blur","setBlur","val","Typography","InputBase","inputRef","node","root","focused","onKeyDown","onBlur","str","snapshotError","indexOf","trim","slice","findStr","match","match2","parseError","overflow","maxHeight","background","border","FactoryResetDialog","open","onFactoryReset","handleDialogClose","action","Dialog","DialogContent","DialogContentText","DialogActions","Button","ContentCopy","SvgIcon","d","Indexing","TrackSelector","Cable","getColors","midnight","forrest","grape","mandarin","gray","Logomark","viewBox","LogoFull","Text","colors","fill","transform","paper","overflowY","overflowX","minHeight","maxWidth","outline","menuItemEndDecoration","height","ArrowRightIcon","CheckBoxIcon","CheckBoxOutlineBlankIcon","RadioButtonCheckedIcon","RadioButtonUncheckedIcon","checkIfValid","MenuPage","subMenuAnchorEl","setSubMenuAnchorEl","openSubMenuIdx","setOpenSubMenuIdx","isSubMenuOpen","setIsSubMenuOpen","selectedMenuItemIdx","setSelectedMenuItemIdx","setPosition","paperRef","useRef","anchorEl","shouldSubMenuBeOpen","timer","setTimeout","clearTimeout","rect","getBoundingClientRect","menuItem","menuItemStyle","ListContents","MenuList","autoFocusItem","dense","sort","a","b","priority","endDecoration","MUIMenuItem","id","String","onMouseMove","e","currentTarget","document","activeElement","focus","currentIdx","findLastIndex","findPreviousValidIdx","findIndex","findNextValidIdx","Grow","in","Paper","elevation","Popover","BackdropProps","invisible","horizontalHandle","cursor","verticalHandle","flexbox_verticalHandle","alignSelf","flexbox_horizontalHandle","onDrag","flexbox","originalClassName","onMouseDown","mouseDragging","setMouseDragging","initialPosition","prevPos","cx","mouseMove","preventDefault","pos","clientX","clientY","totalDistance","current","lastFrameDistance","mouseUp","removeEventListener","model","handleClose","clearView","autoFocus","added","full","RegExp","tag","SanitizedHTML","html","pre","linkify","test","escapeHTML","dompurify","tagName","setAttribute","dangerouslySetInnerHTML","__html","forest","refTheme","stockTheme","mode","main","tertiary","augmentColor","quaternary","stopCodon","startCodon","bases","A","green","C","blue","G","orange","T","red","MuiLink","defaultThemes","lightStock","lightMinimal","darkMinimal","darkStock","MuiAppBar","defaultProps","enableColorOnDark","createDefaultProps","MuiButton","size","text","MuiAccordion","disableGutters","TransitionProps","timeout","MuiFilledInput","MuiFormControl","MuiFormHelperText","MuiIconButton","MuiAutocomplete","MuiInputLabel","MuiToolbar","MuiListItem","MuiOutlinedInput","MuiFab","backgroundColor","MuiTable","MuiPopover","transitionDuration","MuiMenu","MuiMenuItem","MuiTextField","MuiCheckbox","MuiRadio","MuiFormLabel","MuiAccordionSummary","content","contrastText","MuiToggleButtonGroup","createJBrowseBaseTheme","deepmerge","fontSize","createJBrowseTheme","configTheme","themes","themeName","augmentTheme","augmentThemePlus","ToggleButtonWithTooltip","Tooltip","ToggleButton","shorten","len","Math","max","description","rootModel","setLocation","fileOrUrl","isUriLocation","toggleButtonValue","setToggleButtonValue","internetAccountId","accts","isAppRootModel","internetAccounts","shownAccts","setShownAccts","hiddenAccts","setHiddenAccts","setAnchorEl","selectedAcct","find","i","setLocationWithAcct","useCallback","locationInput","UrlChooser","selectorLabel","LocalFileChooser","SelectorComponent","Box","display","InputLabel","shrink","flexDirection","ToggleButtonGroup","exclusive","_event","newState","toggleContents","ArrowDropDownIcon","acct","prev","at","filter","notEmpty","FormHelperText","highResolutionScaling","imageData","blockKey","showSoftClip","done","setDone","featureCanvas","canvas","getContext","drawImageOntoCanvasContext","testId","hoverLabel","pointerEvents","zIndex","offsetX","offsetY","configuration","feature","shown","setShown","handle","readConfObject","QuickLRU","options","super","maxSize","TypeError","maxAge","Number","POSITIVE_INFINITY","onEviction","cache","oldCache","_size","_emitEvictions","_deleteIfExpired","expiry","Date","now","delete","_getOrDeleteIfExpired","_getItemValue","_peek","_set","_moveToRecent","_entriesAscending","has","peek","deleted","clear","resize","newSize","items","removeCount","keys","values","Symbol","iterator","entriesDescending","entriesAscending","oldCacheSize","min","forEach","callbackFunction","thisArgument","call","toStringTag","useDebounce","delay","debouncedValue","setDebouncedValue","useWidthSetter","view","isAlive","requestAnimationFrame","setWidth","parseInt","useDebouncedCallback","wait","argsRef","cleanup","findParentThat","predicate","hasParent","currentNode","getParent","springAnimate","fromValue","toValue","onFinish","precision","tension","friction","animationFrameId","update","animation","time","lastPosition","lastTime","velocity","lastVelocity","numSteps","floor","isVelocity","abs","isDisplacement","cancelAnimationFrame","findParentThatIs","getSession","isSessionModel","getContainingView","isViewModel","getContainingTrack","isTrackModel","getContainingDisplay","isDisplayModel","assembleLocString","region","assembleLocStringFast","toLocale","cb","n","assemblyName","refName","start","end","reversed","assemblyNameString","startString","endString","rev","parseLocStringOneBased","locString","isValidRefName","endsWith","replace","assemblyMatch","startsWith","lastColonIdx","lastIndexOf","prefix","suffix","rangeMatch","singleMatch","replaceAll","separator","parseLocString","parsed","compareLocs","locA","locB","assemblyComp","localeCompare","refComp","startComp","endComp","compareLocStrings","clamp","num","bpToPx","bp","bpPerPx","round","oneEightyOverPi","PI","piOverOneEighty","radToDeg","radians","degToRad","degrees","polarToCartesian","rho","theta","cos","sin","cartesianToPolar","x","y","sqrt","atan","featureSpanPx","bpSpanPx","leftBp","rightBp","iterMap","iter","func","sizeHint","results","Array","from","counter","array","l","findLast","makeAbortableReaction","self","dataFunction","asyncReactionFunction","reactionOptions","startedFunction","successFunction","errorFunction","inProgress","handleError","isAbortException","console","addDisposer","reaction","data","mobxReactionHandle","aborted","abort","thisInProgress","result","checkAbortSignal","renameRegionIfNeeded","refNameMap","isStateTreeNode","newRef","getSnapshot","originalRefName","renameRegionsIfNeeded","regions","adapterConfig","sessionId","assemblyMaps","Set","getRefNameMapForAdapter","minmax","short","coord","oob","useAssemblyName","navigator","userAgent","revcom","seqString","reverse","complement","split","complementRegex","complementTable","S","w","r","N","K","Y","V","M","h","k","g","t","W","X","v","B","s","H","c","D","R","rIC","requestIdleCallback","widths","measureText","total","code","charCodeAt","defaultStarts","defaultStops","defaultCodonTable","TCA","TCC","TCG","TCT","TTC","TTT","TTA","TTG","TAC","TAT","TAA","TAG","TGC","TGT","TGA","TGG","CTA","CTC","CTG","CTT","CCA","CCC","CCG","CCT","CAC","CAT","CAA","CAG","CGA","CGC","CGG","CGT","ATA","ATC","ATT","ATG","ACA","ACC","ACG","ACT","AAC","AAT","AAA","AAG","AGC","AGT","AGA","AGG","GTA","GTC","GTG","GTT","GCA","GCC","GCG","GCT","GAC","GAT","GAA","GAG","GGA","GGC","GGG","GGT","generateCodonTable","table","tempCodonTable","codon","aa","nucs","nuc","charAt","toUpperCase","toLowerCase","n0","j","n1","n2","updateStatus","msg","fn","res","hashCode","hash","objectHash","obj","bytesForRegions","index","blocksForRange","flat","block","minv","blockPosition","maxv","reduce","isSupportedIndexingAdapter","getBpDisplayStr","totalBp","parseFloat","toPrecision","toLocaleString","getTickDisplayStr","toFixed","getViewParams","exportSVG","dynamicBlocks","staticBlocks","offsetPx","contentBlocks","staticblock","staticblock1","offsetPx1","getLayoutId","layoutId","initialValue","storedValue","setStoredValue","localStorage","getItem","valueToStore","Function","setItem","getUriLink","getStr","isObject","coarseStripHTML","measureGridWidth","elements","stripHTML","element","getEnv","getEnvMST","localStorageGetItem","localStorageSetItem","arr","init","entry","Infinity","sum","avg","groupBy","push","mergeIntervals","intervals","stack","pop","gatherOverlaps","memo","flatMap","group","stripAlpha","colord","alpha","toHex","ElementId","types","optional","identifier","nanoid","PropTypes","Region","propTypes","isRequired","ConfigSchema","MxPropTypes","objectOrObservableObject","Feature","NoAssemblyRegion","string","number","boolean","actions","setRefName","newRefName","compose","LocalPathLocation","locationType","literal","localPath","BlobLocation","blobId","UriLocationRaw","maybe","internetAccountPreAuthorization","internetAccountType","authInfo","frozen","UriLocation","snapshotProcessor","postProcessor","snap","FileLocation","union","preProcessor","blob","BaseSessionModel","_pluginManager","volatile","hovered","views","jbrowse","rpcManager","adminMode","textSearchManager","assemblies","setSelection","clearSelection","setHovered","isBaseSession","ConnectionManagementSessionMixin","pluginManager","connectionInstances","pluggableMstType","connections","makeConnection","initialSnapshot","getConnectionType","prepareToBreakConnection","callbacksToDeref","derefTypeCount","connection","track","tracks","getReferring","removeReferring","breakConnection","remove","deleteConnection","deleteConnectionConf","addConnectionConf","connectionConf","clearConnections","isSessionWithConnections","AssemblyManager","lazy","exports","install","UCSCTrackHubConnectionF","AddTrackWidgetF","HierarchicalTrackSelectorWidgetF","AddConnectionWidgetF","PluginStoreWidgetF","configure","snackbarMessages","latestMessage","reason","popSnackbarMessage","MUISnackbar","Alert","severity","level","message","buttonRoot","hoverOpacity","menuTitle","setOpen","ArrowDropDown","logoPath","alt","grow","light","borderColor","HeaderButtons","savedSessionNames","menus","Toolbar","menu","DropDownMenu","arrow","EditableTypography","newName","notify","renameCurrentSession","AppLogo","selectPaper","viewTypes","getElementTypeRecord","FormControl","Select","addView","IconProps","ArrowUpward","moveViewUp","ArrowDownward","moveViewDown","CascadingMenuButton","MenuIcon","paddingBottom","paddingTop","minimized","setDisplayName","viewHeader","viewTitle","alignItems","ViewButtons","onMinimize","AddIcon","MinimizeIcon","scrollRef","scrollIntoView","ViewMenu","focusedViewId","KeyboardArrowRightIcon","ViewContainerTitle","viewContainer","focusedView","unfocusedView","dark","handleSelectView","Element","contains","setFocusedViewId","ViewHeader","viewType","getViewType","ReactComponent","ViewContainer","removeView","setMinimized","Suspense","fallback","LoadingEllipses","DialogComponent","DialogProps","bottom","activeWidgets","drawerPosition","Fab","showWidgetDrawer","LaunchIcon","DrawerWidget","colorScheme","appContainer","gridColumn","gridTemplateRows","gridRow","appBar","LazyDrawerWidget","ViewPanel","ViewLauncher","App","visibleWidget","drawerWidth","drawerVisible","grid","gridTemplateColumns","f","DialogQueue","AppBar","AppToolbar","AppFab","Snackbar","undoIdx","targetPath","history","notTrackingUndo","canUndo","canRedo","targetStore","snapshotDisposer","skipNextUndoState","stopTrackingUndo","resumeTrackingUndo","addUndoState","todos","splice","shift","beforeDestroy","initialize","resolvePath","onSnapshot","debounce","snapshot","undo","applySnapshot","redo","ConfigurationSchema","workerCount","defaultValue","explicitlyTyped","baseConfiguration","BaseRpcDriverConfigSchema","defaultDriver","drivers","MainThreadRpcDriverConfigSchema","WebWorkerRpcDriverConfigSchema","MainThreadRpcDriver","WebWorkerRpcDriver","addDriverConfig","configName","configSnapshot","isClonable","LazyWorker","driver","getWorker","workerP","makeWorker","then","worker","pingTime","rpcDriverClassName","watchWorker","maxPingTime","catch","destroy","status","BaseRpcDriver","lastWorkerAssignment","workerAssignments","workerCheckFrequency","filterArgs","isArray","AbortSignal","remoteAbort","bind","File","functionName","createWorkerPool","hardwareConcurrency","mainThread","canDetect","detectHardwareConcurrency","workers","getWorkerPool","workerPool","workerNumber","workerAssignment","unextendedWorker","evaluateExtensionPoint","rpcMethod","getRpcMethodType","serializedArgs","serializeArguments","filteredAndSerializedArgs","callP","statusCallback","finally","killedCheckInterval","killedP","setInterval","clearInterval","resultP","race","deserializeReturn","WebWorkerHandle","Rpc","Client","terminate","funcName","opts","channel","listener","on","off","workerBootConfiguration","makeWorkerInstance","instance","log","postMessage","deserializeError","DummyHandle","_functionName","_filteredArgs","_options","pm","execute","RpcManager","static","rpcConfigSchema","mainConfiguration","backendConfigurations","driverObjects","getDriver","backendName","newDriver","backendConfiguration","plugins","runtimePluginDefinitions","windowHref","getDriverForCall","_sessionId","rpcDriverName","shareDiv","textAlign","paddingLeft","shareButton","ShareDialog","startIcon","ShareIcon","adminKey","useQueryParam","StringParam","adminServer","configPath","setSessionId","currentSessionId","JBrowseRootModel","JBrowseSession","response","fetch","method","headers","body","ok","CssBaseline","ShareButton","sessionQuery","password","loc","sessionTracks","initialTimestamp","sessionTriaged","sessionSnapshot","sessionSpec","blankSession","runtimePlugins","sessionPlugins","sessionError","configError","bc1","BroadcastChannel","bc2","isSharedSession","isSpecSession","isJb1StyleSession","isEncodedSession","isJsonSession","isLocalSession","ready","isSessionLoaded","isConfigLoaded","sessionTracksParsed","setSessionQuery","setConfigError","setSessionError","setRuntimePlugins","setSessionPlugins","setConfigSnapshot","setBlankSession","flag","setSessionTriaged","setSessionSnapshotSuccess","fetchPlugins","pluginLoader","import","fetchSessionPlugins","setSessionSnapshot","userAcceptedConfirmation","checkPlugins","origin","fetchConfig","__jbrowseConfigPath","__jbrowseCacheBuster","random","openLocation","readFile","configUri","addRelativeUris","hostname","configPlugins","fetchSessionStorageSession","sessionStr","sessionStorage","query","sessionSnap","onmessage","fetchSharedSession","decryptedSession","readSessionFromDynamo","readConf","fromUrlSafeB64","decodeEncodedUrlSession","decodeSessionSpec","decodeJb1StyleSession","decodeJsonUrlSession","afterCreate","lastAutosave","autorun","StartScreenErrorMessage","aliases","sequence","getTrackType","configSchema","refNameColors","refNameAliases","adapter","pluggableConfigSchemaType","preProcessSnapshot","cytobands","explicitIdentifier","TextSearchManager","adapterCache","loadTextSearchAdapters","searchScope","relevantAdapters","conf","adapterId","AdapterClass","getTextSearchAdapterType","aggregateTextSearchAdapters","getAdaptersWithAssembly","getTrackAdaptersWithAssembly","confs","textSearching","textSearchAdapter","rankFn","adapters","searchIndex","sortResults","getLabel","r1","r2","getScore","Worker","resolveIdentifier","refNameRegex","checkRefName","assemblyFactory","assemblyConfigType","adapterLoads","AbortablePromiseCache","adapterConf","when","refNames","getCanonicalRefName","forwardMap","reverseMap","canonicalName","adapterName","loadRefNameMap","safeReference","loaded","loadingP","volatileRegions","lowerCaseRefNameAliases","arg","initialized","hasName","allAliases","allRefNames","lowerCaseRefNames","allRefNamesWithLowerCase","getRefNameColor","setLoaded","adapterRegionsWithAssembly","setRegions","setRefNameAliases","setCytobands","setError","lcAliases","setLoadingP","p","loadPre","refNameAliasesAdapterConf","cytobandAdapterConf","sequenceAdapterConf","getAdapterType","getAdapterClass","getRegions","getAssemblyRegions","ret","getRefNameAliases","getData","getCytobands","getAdapterMapEntry","jsonStableStringify","getAdapterId","getReverseRefNameMapForAdapter","assemblyNameMap","asmName","assemblyNamesList","assemblyList","asm","sessionAssemblies","temporaryAssemblies","waitForAssembly","afterAttach","assemblyConfs","removeAssembly","addAssembly","fireImmediately","replaceAssembly","cast","SetDefaultSession","PreferencesDialog","RootModel","sessionModelFactory","assemblyConfigSchema","assemblyConfigSchemaFactory","jbrowseModelType","rpc","formatDetails","contextVariable","subfeatures","depth","maxDepth","formatAbout","hideUris","shareURL","disableAnalytics","hierarchical","trackNames","categories","defaultCollapsed","categoryNames","topLevelCategories","subCategories","extraThemes","pluginConfigurationSchemas","defaultSession","JBrowseConfigF","addAssemblyConf","trackId","removeAssemblyConf","toRemove","addTrackConf","trackConf","elt","conn","deleteTrackConf","addPlugin","setPluginsUpdated","removePlugin","setDefaultSessionConf","sessionConf","newDefault","toJS","addInternetAccountConf","internetAccountConf","deleteInternetAccountConf","JBrowseModelF","removeAttr","clone","jbrowseWebFactory","sessionModelType","sessionPath","assemblyManagerFactory","isAssemblyEditing","setSession","setDefaultSession","setSessionPath","path","setAssemblyEditing","BaseRootModelFactory","initializeInternetAccount","internetAccountConfig","getInternetAccountType","createEphemeralInternetAccount","hostUri","internetAccountSplit","domains","internetAccount","stateModel","create","findAppropriateInternetAccount","selectedId","selectedAccount","account","handlesLocation","InternetAccountsRootModelMixin","TimeTraveller","ctrlKey","metaKey","shiftKey","setMenus","newMenus","appendMenu","menuName","insertMenu","appendToMenu","insertInMenu","insertPosition","appendToSubMenu","menuPath","topMenu","pathSoFar","sm","mi","insertInSubMenu","version","packageJSON","hydrateFn","hydrateRoot","pluginsUpdated","savedSessionsVolatile","observable","savedSessions","localStorageId","autosaveId","previousAutosaveId","locationUrl","params","_val","alert","reload","oldSession","filterSessionInPlace","getType","newSession","sessionName","addSavedSession","removeSavedSession","removeItem","duplicateCurrentSession","newSnapshotName","newSnapshotCopyNumber","activateSession","localId","newSessionSnapshot","saveSessionToLocalStorage","loadAutosaveSession","previousAutosave","autosavedSession","PublishIcon","widget","addWidget","showWidget","GetAppIcon","sessionBlob","Blob","saveAs","FolderOpenIcon","SaveIcon","FileCopyIcon","StorageIcon","AppsIcon","queueDialog","UndoIcon","RedoIcon","ExtensionIcon","SettingsIcon","ReferenceManagementSessionMixin","object","refs","walk","isModelType","members","getMembers","properties","isReferenceType","referring","callbacks","dereferenceTypeCount","dereferenced","hideTrack","err1","isSessionModelWithWidgets","widgets","hideWidget","minDrawerWidth","DrawerWidgetSessionMixin","widgetStateModelType","refinement","integer","setDrawerPosition","updateDrawerWidth","newDrawerWidth","resizeDrawer","distance","oldDrawerWidth","typeName","initialState","getElementType","hasWidget","minimizeWidgetDrawer","hideAllWidgets","editConfiguration","isConfigurationModel","editor","AboutDialog","BaseWebSession","sessionModel","queueOfDialogs","removeActiveDialog","sessionThemeName","allThemes","setThemeName","addLinearGenomeViewOfAssembly","addViewOfAssembly","displayRegionsFromAssemblyName","addViewFromAnotherView","otherView","state","displayedRegions","MultipleViewsSessionMixin","callbacksToDereferenceTrack","TracksManagerSessionMixin","named","superAddTrackConf","superDeleteTrackConf","found","SessionTracksManagerSessionMixin","assemblyConfigSchemasType","addSessionAssembly","warn","removeSessionAssembly","addTemporaryAssembly","removeTemporaryAssembly","TemporaryAssembliesMixin","sessionConnections","superDeleteConnection","superAddConnectionConf","connectionId","deletedConn","WebSessionConnectionsMixin","viewId","task","setName","renderProps","addSessionPlugin","removeSessionPlugin","editTrackConfiguration","getTrackActionMenuItems","canEdit","isRefSeq","InfoIcon","DeleteIcon","displays","displayId","category","CopyIcon","extendedSessionModel","extend","pushSnackbarMessage","removeSnackbarMessage","createPluginManager","PluginManager","corePlugins","P","metadata","isCore","createPluggableElements","JBrowseRootModelFactory","afterInitializedCb","evaluateAsyncExtensionPoint","loadSessionSpec","errorMessage","initialSessionQuery","initialTimeStamp","multiAssemblyTracks","savedSessionCount","ver","stats","screen","innerHeight","innerWidth","electron","loadTime","jb2","qs","writeAWSAnalytics","pluginNames","analyticsScript","gaData","metric1","analyticsScriptNode","createElement","innerHTML","getElementsByTagName","append","writeGAAnalytics","doAnalytics","setRootModel","ConfigWarningDialog","SessionWarningDialog","StartScreen","Loader","param","Str","setPassword","setLoc","setSessionTracks","setAssembly","setTracks","loader","SessionLoader","Renderer","SessionTriaged","PluginManagerLoaded","JBrowse","factoryReset","setPluginManager","Loading","FatalErrorDialog","resetButtonText","QueryParamProvider","WindowHistoryAdapter","encrypt","toString","decrypt","AES","Utf8","getErrorMsg","shareSessionToDynamo","referer","sess","toUrlSafeB64","btoa","crypto","getRandomValues","Uint8Array","fromCharCode","encryptedSession","FormData","json","baseUrl","sessionQueryParam","encodeURIComponent","b64","originalB64","repeat","b64PadSuffix","toByteArray","inflate","inflated","TextDecoder","decode","bytes","TextEncoder","encode","deflate","fromByteArray","encoded","isArrayType","childType","getChildType","isValidReference","el","isMapType","child","getPropertyMembers","pname","ptype","base","attr","pluginsToCheck","storePlugins","statusText","every","pp","prop"],"sourceRoot":""}