"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8901],{8901:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(66204),a=n(80846),o=n(88196),s=n(38684),i=n(43663);const l=(0,s.ZL)()({overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}}}),c=(0,a.observer)((function({model:e}){const{classes:t}=l(),{matchedTracks:n,interactToggled:a}=e,o=(0,r.useRef)(null);return r.createElement("div",{className:t.overlay},r.createElement("svg",{ref:o,style:{width:"100%",zIndex:10,pointerEvents:a?void 0:"none"}},n.map((t=>r.createElement(i.Z,{parentRef:o,key:t.configuration.trackId,model:e,trackId:t.configuration.trackId})))))})),u=(0,s.ZL)()((e=>({viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},content:{gridArea:"1/1"}}))),d=(0,a.observer)((function({model:e}){const{classes:t}=u(),{views:n}=e,{pluginManager:a}=(0,o.getEnv)(e);return r.createElement("div",{className:t.content},r.createElement("div",{style:{position:"relative"}},n.map(((e,o)=>{const{ReactComponent:s}=a.getViewType(e.type),i=r.createElement(s,{key:e.id,model:e});return o===n.length-1?i:[i,r.createElement("div",{key:`${e.id}-divider`,className:t.viewDivider})]}))))})),g=(0,a.observer)((function({model:e}){const{classes:t}=u();return r.createElement("div",null,r.createElement("div",{className:t.container},r.createElement(d,{model:e}),r.createElement(c,{model:e})))}))},43663:(e,t,n)=>{n.d(t,{Z:()=>y});var r=n(66204),a=n(80846),o=n(88196),s=n(92368),i=n(31211),l=n(25086);function c(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function u(e,t){const n=e.get("ALT");if(n)return new Map(n?.map((e=>(0,l.I)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var d=n(10574);const[g,,f]=[0,1,2,3],m=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:l,showIntraviewLinks:u}=e,m=(0,s.Z)(),p=(0,i.getSession)(e),v=(0,o.getSnapshot)(e),{assemblyManager:h}=p,k=h.get(l[0].assemblyNames[0]);(0,d.Go)(v);const y=e.getTrackFeatures(t),w=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(y)),[y]),N=(0,r.useMemo)((()=>{const n=e.getMatchedFeaturesInLayout(t,w?function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.get("flags"),a=r.id(),o=4&e,s=2&e;if(!n.has(a)&&!s&&!o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(y):function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.id(),a=4&r.get("flags"),o=!!c(r,"SA");if(!n.has(e)&&!a&&o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(y));return w||n.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),n}),[y,t,w,e]),[T,E]=(0,r.useState)();let M=0;if(n.current){const e=n.current.getBoundingClientRect();M=e.top}return k?r.createElement("g",{stroke:m.palette.text.disabled,fill:"none","data-testid":N.length?`${t}-loaded`:t},N.map((e=>{const n=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:c}=e[o],{layout:m,feature:v,level:h}=e[o+1];if(!s||!m)return console.warn("received null layout for a overlay feature"),null;if(!u&&c===h)return null;const N=k.getCanonicalRefName(i.get("refName")),b=k.getCanonicalRefName(v.get("refName"));if(!N||!b)throw new Error(`unable to find ref for ${N||b}`);const O=i.get("strand"),S=v.get("strand"),L=s[-1===O?g:f],R=-1===S,C=w?m[R?g:f]:m[R?f:g],I=(0,d.mu)(l[c],N,L),W=(0,d.mu)(l[h],b,C),A=l[c].pxToBp(I).reversed,$=l[h].pxToBp(W).reversed,F=l.map((e=>e.getTrack(t))),B=(0,d.cO)(t,c,l,F,s,a)-M,J=(0,d.cO)(t,h,l,F,m,a)-M,x=["M",I,B,"C",I+200*i.get("strand")*(A?-1:1),B,W-200*v.get("strand")*($?-1:1)*(w?-1:1),J,W,J].join(" "),D=`${i.id()}-${v.id()}`;n.push(r.createElement("path",{d:x,key:D,"data-testid":"r1",strokeWidth:T===D?5:1,onClick:()=>{const e=p.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(y.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(y.get(v.id())||{toJSON:()=>{}}).toJSON()}});p.showWidget?.(e)},onMouseOver:()=>E(D),onMouseOut:()=>E(void 0)}))}return n}))):null})),[p]=[0,1,2,3],v=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,c=(0,i.getSession)(e),{assemblyManager:g}=c,f=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,n=new Set;for(const r of e.values()){if(!n.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const n=`${r.get("refName")}:${r.get("start")+1}`,a=(0,l.I)(e);if(a){const e=t.get(n);e?e.push(r):t.set(a.MatePosition||"none",[r])}}))}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[v,h]=(0,r.useState)(),k=(0,o.getSnapshot)(e);(0,d.Go)(k);const y=g.get(s[0].assemblyNames[0]);if(!y)return null;let w=0;if(n.current){const e=n.current.getBoundingClientRect();w=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const n=[];for(let o=0;o<e.length-1;o+=1){const{layout:i,feature:l,level:g}=e[o],{layout:m,feature:k,level:N}=e[o+1],T=l.id(),E=u(l,k);if(!i||!m)return null;const M=l.get("refName"),b=k.get("refName"),O=y.getCanonicalRefName(M),S=y.getCanonicalRefName(b);if(!O||!S)throw new Error(`unable to find ref for ${O||S}`);const L=(0,d.mu)(s[g],O,i[p]),R=(0,d.mu)(s[N],S,m[p]),C=s[g].pxToBp(L).reversed,I=s[N].pxToBp(R).reversed,W=s.map((e=>e.getTrack(t))),A=(0,d.cO)(t,g,s,W,i,a)-w,$=(0,d.cO)(t,N,s,W,m,a)-w;if(E){const e=["M",L-20*("left"===E.Join?-1:1)*(C?-1:1),A,"L",L,A,"L",R,$,"L",R-20*("left"===E.MateDirection?1:-1)*(I?-1:1),$].join(" ");n.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:T===v?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(T)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>h(T),onMouseOut:()=>h(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return n})))})),[h]=[0,1,2,3],k=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,u=e.getTrackFeatures(t),g=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],n=new Set;for(const r of e.values())n.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),n.add(r.id());return t}(u))),[u,t,e]),[f,m]=(0,r.useState)(),p=(0,o.getSnapshot)(e);if((0,d.Go)(p),!c.get(s[0].assemblyNames[0]))return null;let v=0;if(n.current){const e=n.current.getBoundingClientRect();v=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const n=[];for(const{layout:o,feature:i,level:c}of e){const e=0===c?1:0,g=i.id();if(!o)return null;const p=i.get("INFO"),k=p.CHR2[0],y=p.END[0],[w,N]=p.STRANDS[0].split(""),T=(0,d.mu)(s[e],k,y);if(T){const p=[T,0,T+1,0],k=(0,d.mu)(s[c],i.get("refName"),o[h]),y=T,E=s[c].pxToBp(k).reversed,M=s[e].pxToBp(y).reversed,b=s.map((e=>e.getTrack(t))),O=(0,d.cO)(t,c,s,b,o,a)-v,S=(0,d.cO)(t,e,s,b,p,a)-v,L=["M",k-20*("+"===w?1:-1)*(E?-1:1),O,"L",k,O,"L",y,S,"L",y-20*("+"===N?1:-1)*(M?-1:1),S].join(" ");n.push(r.createElement("path",{d:L,key:JSON.stringify(L),strokeWidth:g===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(u.get(g)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>m(g),onMouseOut:()=>m(void 0)}))}}return n})))})),y=(0,a.observer)((function(e){const{model:t,trackId:n}=e,a=t.getMatchedTracks(n);return"AlignmentsTrack"===a[0]?.type?r.createElement(m,e):"VariantTrack"===a[0]?.type?t.hasTranslocations(n)?r.createElement(k,e):r.createElement(v,e):null}))}}]);
//# sourceMappingURL=8901.68258ce3.chunk.js.map