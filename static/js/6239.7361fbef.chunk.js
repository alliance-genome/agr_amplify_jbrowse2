"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6239],{70833:function(e,t,r){r.d(t,{EU:function(){return o},z8:function(){return d},Bf:function(){return h},zv:function(){return u}});var n=r(27664);function a(e){var t=e.feature,r=e.ctx,a=e.offsets,o=e.cb,s=e.height,f=e.drawCurves,c=e.oobLimit,l=e.viewWidth,u=e.hideTiny,h=t.p11,d=t.p12,v=t.p21,p=t.p22,x=h.offsetPx-a[0],m=d.offsetPx-a[0],g=v.offsetPx-a[1],w=p.offsetPx-a[1],b=Math.abs(m-x),M=Math.abs(w-g),k=s,y=(k-0)/2,P=Math.min(g,w),S=Math.max(g,w);(0,n.doesIntersect2)(P,S,-c,l+c)&&(b<=1&&M<=1?u||(r.beginPath(),r.moveTo(x,0),f?r.bezierCurveTo(x,y,g,y,g,k):r.lineTo(g,k),r.stroke()):(i(r,x,m,0,w,g,k,y,f),o(r)))}function i(e,t,r,n,a,i,o,s,f){f?function(e,t,r,n,a,i,o,s){var f=Math.abs(t-r),c=Math.abs(t-r);if(f<5&&c<5&&r<t&&Math.abs(t-a)>100){var l=t;t=r,r=l}e.beginPath(),e.moveTo(t,n),e.lineTo(r,n),e.bezierCurveTo(r,s,a,s,a,o),e.lineTo(i,o),e.bezierCurveTo(i,s,t,s,t,n),e.closePath(),e.fill()}(e,t,r,n,a,i,o,s):function(e,t,r,n,a,i,o){e.beginPath(),e.moveTo(t,n),e.lineTo(r,n),e.lineTo(a,o),e.lineTo(i,o),e.closePath(),e.fill()}(e,t,r,n,a,i,o)}var o=16581375;function s(e){var t=Math.floor(e/65025)%255,r=Math.floor(e/255)%255,n=e%255;return"rgb(".concat(t,",").concat(r,",").concat(n,")")}var f={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"},c=3,l=1600;function u(e,t,r,n){return Math.floor((255*e*255+255*t+r-1)/n)}function h(e,t,r){var u,h=(0,n.getContainingView)(e),d=h.drawCurves,v=h.drawCIGAR,p=h.middleComparativeHeight,x=h.width,m=h.views.map((function(e){return e.bpPerPx}));r&&(r.imageSmoothingEnabled=!1),t.beginPath();var g=e.featPositions,w=h.views.map((function(e){return e.offsetPx})),b=Math.floor(o/g.length);t.fillStyle=f.M,t.strokeStyle=f.M;for(var M=0;M<g.length;M++){var k=g[M],y=k.p11,P=k.p12,S=k.p21,T=k.p22,j=y.offsetPx-w[0],C=P.offsetPx-w[0],Z=S.offsetPx-w[1],z=T.offsetPx-w[1],L=Math.abs(C-j),H=Math.abs(z-Z),R=p,I=(R-0)/2;L<=c&&H<=c&&Z<x+l&&Z>-l&&(t.moveTo(j,0),d?t.bezierCurveTo(j,I,Z,I,Z,R):t.lineTo(Z,R))}t.stroke(),t.fillStyle=f.M,t.strokeStyle=f.M;for(var N=0;N<g.length;N++){var B=g[N],W=B.p11,D=B.p12,E=B.p21,G=B.p22,_=B.f,U=B.cigar,V=W.offsetPx-w[0],X=D.offsetPx-w[0],A=E.offsetPx-w[1],J=G.offsetPx-w[1],O=Math.abs(X-V),F=Math.abs(J-A),Y=Math.min(A,J),q=Math.max(A,J),K=p,Q=(K-0)/2;if(!(O<=c&&F<=c)&&(0,n.doesIntersect2)(Y,q,-l,h.width+l)){var $=_.get("strand"),ee=-1===$?X:V,te=ee<(-1===$?V:X)?1:-1,re=(A<J?1:-1)*$,ne=ee,ae=-1===$?J:A;if(null!==U&&void 0!==U&&U.length&&v)for(var ie=!1,oe=0,se=0,fe=Math.floor(o/U.length),ce=0;ce<U.length;ce+=2){var le=ce*fe+1,ue=+U[ce],he=U[ce+1];ie||(oe=ne,se=ae);var de=ue/m[0],ve=ue/m[1];if("M"===he||"="===he||"X"===he?(ne+=de*te,ae+=ve*re):"D"===he||"N"===he?ne+=de*te:"I"===he&&(ae+=ve*re),!(Math.max(oe,se,ne,ae)<0||Math.min(oe,se,ne,ae)>x)){var pe=ce<U.length-2;Math.abs(ne-oe)<=1&&Math.abs(ae-se)<=1&&pe?ie=!0:(ie=!1,t.fillStyle=f[ie&&de>1||ve>1?he:"M"],i(t,oe,ne,0,ae,se,K,Q,d),r&&(r.fillStyle=s(le),i(r,oe,ne,0,ae,se,K,Q,d)))}}else i(t,V,X,0,J,A,K,Q,d)}}var xe=null===(u=e.clickMapCanvas)||void 0===u?void 0:u.getContext("2d");if(xe){xe.imageSmoothingEnabled=!1,xe.clearRect(0,0,x,p);for(var me=0;me<g.length;me++){var ge=g[me],we=me*b+1;xe.fillStyle=s(we),a({cb:function(e){return e.fill()},feature:ge,ctx:xe,drawCurves:d,offsets:w,oobLimit:l,viewWidth:h.width,hideTiny:!0,height:p})}}}function d(e){var t,r=e.clickId,i=e.mouseoverId,o=(0,n.getContainingView)(e),s=o.drawCurves,f=o.middleComparativeHeight,c=o.width,u=null===(t=e.mouseoverCanvas)||void 0===t?void 0:t.getContext("2d"),h=o.views.map((function(e){return e.offsetPx}));if(u){u.resetTransform(),u.scale(1,1),u.clearRect(0,0,c,f);var d=e.featMap[i||""];d&&(u.fillStyle="rgb(0,0,0,0.1)",a({cb:function(e){return e.fill()},feature:d,ctx:u,oobLimit:l,viewWidth:o.width,drawCurves:s,offsets:h,height:f}));var v=e.featMap[r||""];v&&(u.strokeStyle="rgb(0, 0, 0, 0.9)",a({cb:function(e){return e.stroke()},feature:v,ctx:u,oobLimit:l,viewWidth:o.width,drawCurves:s,offsets:h,height:f}))}}},6239:function(e,t,r){r.r(t),r.d(t,{renderToSvg:function(){return w}});var n=r(32723),a=r(33028),i=r(34795),o=(r(96902),r(93751)),s=r(30908),f=r(75717),c=r(27664),l=r(16151),u=r(17867),h=r(50209),d=r(88636),v=r(55707),p=r.n(v),x=r(29938);function m(e){var t=e.width,r=e.height,n=e.shift,a=(0,d.Z)();return(0,x.jsx)("rect",{width:t+2*n,height:r,fill:p()(a.palette.background.default).hex()})}var g=r(70833);function w(e,t){return b.apply(this,arguments)}function b(){return b=(0,i.Z)((0,n.Z)().mark((function e(t,r){var d,v,p,w,b,M,k,y,P,S,T,j,C,Z,z,L,H,R,I,N,B,W,D,E,G,_,U,V,X,A,J;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.when)((function(){return t.initialized}));case 2:return v=r.textHeight,p=void 0===v?18:v,w=r.headerHeight,b=void 0===w?30:w,M=r.rulerHeight,k=void 0===M?30:M,y=r.fontSize,P=void 0===y?13:y,S=r.trackLabels,T=void 0===S?"offset":S,j=r.Wrapper,C=void 0===j?function(e){var t=e.children;return(0,x.jsx)(x.Fragment,{children:t})}:j,Z=r.themeName,z=void 0===Z?"default":Z,L=(0,c.getSession)(t),H=null===(d=L.allThemes)||void 0===d?void 0:d.call(L)[z],R=t.width,I=t.views,N=t.middleComparativeHeight,B=t.tracks,W=50,D=b+k,E=I.map((function(e){return(0,h.hY)(e.tracks,p,T)+D})),G=(0,c.sum)(E)+N+100,e.next=12,Promise.all(I.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,Promise.all(t.tracks.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.displays[0],e.next=3,(0,f.when)((function(){return void 0===i.ready||i.ready}));case 3:return e.t0=t,e.next=6,i.renderSvg((0,a.Z)((0,a.Z)({},r),{},{theme:H}));case 6:return e.t1=e.sent,e.abrupt("return",{track:e.t0,result:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.t1=e.sent,e.abrupt("return",{view:e.t0,data:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return _=e.sent,e.next=15,Promise.all(B.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var i,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.displays[0],e.next=3,(0,f.when)((function(){return void 0===i.ready||i.ready}));case 3:return e.next=5,(0,c.renderToAbstractCanvas)(R,N,{exportSVG:r},(function(e){return(0,g.Bf)(i,e)}));case 5:if(!("imageData"in(o=e.sent))){e.next=10;break}throw new Error("found a canvas in svg export, probably a bug");case 10:if(!("canvasRecordedData"in o)){e.next=17;break}return e.next=13,(0,c.getSerializedSvg)((0,a.Z)((0,a.Z)({},o),{},{width:R,height:N}));case 13:return e.t0=e.sent,e.abrupt("return",{html:e.t0});case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:return U=e.sent,V=(0,c.max)(I.flatMap((function(e){return e.tracks.map((function(e){return(0,c.measureText)((0,l.getTrackName)(e.configuration,L),P)}))})),0)+40,A=R+(X="left"===T?V:0),J=(0,u.createJBrowseTheme)(H),e.abrupt("return",(0,s.renderToStaticMarkup)((0,x.jsx)(o.Z,{theme:(0,u.createJBrowseTheme)(H),children:(0,x.jsx)(C,{children:(0,x.jsxs)("svg",{width:R,height:G,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,A+2*W,G].toString(),children:[(0,x.jsx)(m,{width:A,height:G,shift:W}),(0,x.jsxs)("g",{transform:"translate(".concat(W," ").concat(P,")"),children:[(0,x.jsxs)("g",{transform:"translate(".concat(X,")"),children:[(0,x.jsx)("text",{x:0,fontSize:P,fill:J.palette.text.primary,children:I[0].assemblyNames.join(", ")}),(0,x.jsx)(h.Uc,{model:_[0].view,fontSize:P})]}),(0,x.jsx)(h.Ge,{textHeight:p,trackLabels:T,fontSize:P,model:_[0].view,displayResults:_[0].data,offset:D,trackLabelOffset:X})]}),(0,x.jsx)("defs",{children:(0,x.jsx)("clipPath",{id:"synclip",children:(0,x.jsx)("rect",{x:0,y:0,width:R,height:N})})}),(0,x.jsx)("g",{transform:"translate(".concat(W+X," ").concat(P+E[0],")"),clipPath:"url(#synclip)",children:U.map((function(e,t){return(0,x.jsx)(c.ReactRendering,{rendering:e},t)}))}),(0,x.jsxs)("g",{transform:"translate(".concat(W," ").concat(P+E[0]+N,")"),children:[(0,x.jsxs)("g",{transform:"translate(".concat(X,")"),children:[(0,x.jsx)("text",{x:0,fontSize:P,fill:J.palette.text.primary,children:I[1].assemblyNames.join(", ")}),(0,x.jsx)(h.Uc,{model:_[1].view,fontSize:P})]}),(0,x.jsx)(h.Ge,{textHeight:p,trackLabels:T,fontSize:P,model:_[1].view,displayResults:_[1].data,offset:D,trackLabelOffset:X})]})]})})})));case 21:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}}}]);
//# sourceMappingURL=6239.7361fbef.chunk.js.map