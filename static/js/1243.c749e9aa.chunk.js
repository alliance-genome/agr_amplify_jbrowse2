(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[1243],{56936:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return X}});var n={};r.r(n),r.d(n,{escape:function(){return x},escapeColumn:function(){return S},formatAttributes:function(){return L},formatComment:function(){return j},formatDirective:function(){return O},formatFeature:function(){return E},formatItem:function(){return q},formatSequence:function(){return I},parseAttributes:function(){return w},parseDirective:function(){return T},parseFeature:function(){return Z},unescape:function(){return y}});var a=r(32723),i=r(41361),s=r(34795),u=r(9249),c=r(87371),o=r(45754),f=r(13820),l=r(56798),h=r(59062),d=r(16979),p=r(65904),v=r(90872),m=r(31238),b=r(80753),g=r(68079),_=r(96234),k=["seq_name","source","featureType","start","end","score","strand","frame","attributes"];function y(e){return null===e?null:String(e).replace(/%([0-9A-Fa-f]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))}))}function C(e,t){return String(t).replace(e,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0".concat(t)),"%".concat(t)}))}function x(e){return C(/[\n;\r\t=%&,\x00-\x1f\x7f-\xff]/g,e)}function S(e){return C(/[\n\r\t%\x00-\x1f\x7f-\xff]/g,e)}function w(e){if(!e||!e.length||"."===e)return{};var t={};return e.replace(/\r?\n$/,"").slice(0,-1).split(";").forEach((function(e){var r;if(e){var n=e.trim().split(" ");if(n[1]&&n[1].length){n[0]=n[0].trim();var a=t[n[0].trim()];a||(a=[],t[n[0]]=a),(r=a).push.apply(r,(0,g.Z)(n[1].split(",").map((function(e){return e.trim()})).map(y)))}}})),t}function Z(e){var t=e.split("\t").map((function(e){return"."===e?null:e}));t[0]=y(t[0]),t[1]=y(t[1]),t[2]=y(t[2]),t[8]=w(t[8]);for(var r={},n=0;n<k.length;n+=1)r[k[n]]="."===t[n]?null:t[n];return null!==r.start&&(r.start=parseInt(r.start,10)),null!==r.end&&(r.end=parseInt(r.end,10)),null!==r.score&&(r.score=parseFloat(r.score,10)),null!=r.strand&&(r.strand=r.strand),r}function T(e){var t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;var r=t[1],n=t[2],a={directive:r};if(n.length&&(n=n.replace(/\r?\n$/,""),a.value=n),"sequence-region"===r){var i=n.split(/\s+/,3),s=(0,_.Z)(i,3),u=s[0],c=s[1],o=s[2];a.seq_id=u,a.start=c&&c.replace(/\D/g,""),a.end=o&&o.replace(/\D/g,"")}else if("genome-build"===r){var f=n.split(/\s+/,2),l=(0,_.Z)(f,2),h=l[0],d=l[1];a.source=h,a.buildname=d}return a}function L(e){var t=[];return Object.keys(e).forEach((function(r){var n,a=e[r];n=a.hasOwnProperty("toString")?x(a.toString()):Array.isArray(a.values)?a.values.map(x).join(","):Array.isArray(a)?a.map(x).join(","):x(a),t.push("".concat(x(r)," ").concat(n))})),t.length?t.join("; ").concat(";"):"."}var F=["-",".","+"];function D(e,t){for(var r=null===e.attributes||void 0===e.attributes?".":L(e.attributes),n=[],a=0;a<8;a+=1){var i=e[k[a]];n[a]=6===a?null===i||void 0===i?".":F[i+1]||i:null===i||void 0===i?".":S(String(i))}n[8]=r;var s="".concat(n.join("\t"),"\n");return t[s]?"":(t[s]=!0,s)}function A(e,t){if(Array.isArray(e))return e.map((function(e){return A(e,t)})).join("");var r=[D(e,t)];return["child_features","derived_features"].forEach((function(n){e[n]&&r.push.apply(r,(0,g.Z)(e[n].map((function(e){return A(e,t)}))))})),r.join("")}function E(e){return A(e,{})}function O(e){var t="##".concat(e.directive);return e.value&&(t+=" ".concat(e.value)),t+="\n"}function j(e){return"# ".concat(e.comment,"\n")}function I(e){return">".concat(e.id).concat(e.description?" ".concat(e.description):"","\n").concat(e.sequence,"\n")}function q(e){function t(e){return e[0]||e.attributes?E(e):e.directive?O(e):e.sequence?I(e):e.comment?j(e):"# (invalid item found during format)\n"}return Array.isArray(e)?e.map((function(e){return t(e)})):t(e)}var B={Parent:"child_features",Derives_from:"derived_features"},M=function(){function e(t){(0,u.Z)(this,e);var r=function(){};Object.assign(this,{featureCallback:t.featureCallback||r,endCallback:t.endCallback||r,commentCallback:t.commentCallback||r,errorCallback:t.errorCallback||r,directiveCallback:t.directiveCallback||r,sequenceCallback:t.sequenceCallback||r,bufferSize:void 0===t.bufferSize?1e3:t.bufferSize,_underConstructionTopLevel:[],_underConstructionById:{},_completedReferences:{},_underConstructionOrphans:{},eof:!1,lineNumber:0})}return(0,c.Z)(e,[{key:"addLine",value:function(e){if(!this.eof)if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))this._bufferLine(e);else{var t=/^\s*(#+)(.*)/.exec(e);if(t){var r=(0,_.Z)(t,3),n=r[1],a=r[2];if(3===n.length)this._emitAllUnderConstructionFeatures();else if(2===n.length){var i=T(e);this._emitItem(i)}else a=a.replace(/\s*/,""),this._emitItem({comment:a})}else if(!/^\s*$/.test(e)){var s=e.replace(/\r?\n?$/g,"");throw new Error("GTF parse error.  Cannot parse '".concat(s,"'."))}}}},{key:"_emitItem",value:function(e){e[0]?this.featureCallback(e):e.directive?this.directiveCallback(e):e.comment&&this.commentCallback(e)}},{key:"finish",value:function(){this._emitAllUnderConstructionFeatures(),this.endCallback()}},{key:"_enforceBufferSizeLimit",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=function t(r){r&&r[0]&&r[0].attributes&&r[0].attributes.ID&&r[0].attributes.ID[0]&&(r[0].attributes.ID.forEach((function(t){delete e._underConstructionById[t],delete e._completedReferences[t]})),r.forEach((function(e){e.child_features&&e.child_features.forEach((function(e){return t(e)})),e.derived_features&&e.derived_features.forEach((function(e){return t(e)}))})))};this._underConstructionTopLevel.length+t>this.bufferSize;){var n=this._underConstructionTopLevel.shift();this._emitItem(n),r(n)}}},{key:"_emitAllUnderConstructionFeatures",value:function(){if(this._underConstructionTopLevel.forEach(this._emitItem.bind(this)),this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},Object.values(this._underConstructionOrphans).filter((function(e){return Object.keys(e).length})).length)throw new Error("some features reference other features that do not exist in the file (or in the same '###' scope). ".concat(JSON.stringify(this._underConstructionOrphans)))}},{key:"_bufferLine",value:function(e){var t=this,r=Z(e);r.child_features=[],r.derived_features=[];var n,a=this.lineNumber,i="transcript"===r.featureType,s=i?r.attributes.transcript_id||[]:[a],u=i?[]:r.attributes.transcript_id||[],c=r.attributes.Derives_from||[];s.length||u.length||c.length?(u.forEach((function(e){t._underConstructionById[e]||t._bufferLine(function(e){var t=JSON.parse(JSON.stringify(e));return t.featureType="transcript",E(t)}(r))})),s.forEach((function(e){var a=t._underConstructionById[e];a?(a.push(r),n=a):(n=[r],t._enforceBufferSizeLimit(1),u.length||c.length||t._underConstructionTopLevel.push(n),t._underConstructionById[e]=n,t._resolveReferencesTo(n,e))})),this._resolveReferencesFrom(n||[r],{Parent:u,Derives_from:c},s)):this._emitItem([r])}},{key:"_resolveReferencesTo",value:function(e,t){var r=this._underConstructionOrphans[t];r&&Object.keys(r).forEach((function(t){var n=B[t]||t.toLowerCase();e.forEach((function(e){var a;(a=e[n]).push.apply(a,(0,g.Z)(r[t])),delete r[t]}))}))}},{key:"_parseError",value:function(e){this.eof=!0,this.errorCallback("".concat(this.lineNumber,": ").concat(e))}},{key:"_resolveReferencesFrom",value:function(e,t,r){var n=this;Object.entries(t).forEach((function(t){var a,i=(0,_.Z)(t,2),s=i[0];i[1].forEach((function(t){var i,u,c=n._underConstructionById[t];c?(u=e,(i=c)[0].start=Math.min(i[0].start,u[0].start),i[0].end=Math.max(i[0].end,u[0].end),a||(a=B[s]||s.toLowerCase()),r.filter((function(e){return function(e,t,r){var n=e[t];n||(n={},e[t]=n);var a=n[r]||!1;return n[r]=!0,a}(n._completedReferences,e,"".concat(s,",").concat(t))})).length||c.forEach((function(t){t[a].push(e)}))):(n._underConstructionOrphans[t]||(n._underConstructionOrphans[t]={}),n._underConstructionOrphans[t][s]||(n._underConstructionOrphans[t][s]=[]),n._underConstructionOrphans[t][s].push(e))}))}))}}]),e}(),z=r(15174),N=r(6495),R=r(3995),P=null;function W(e){R&&R.nextTick?R.nextTick(e):e()}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1},t,e);return e.parseAll&&(r.parseFeatures=!0,r.parseDirectives=!0,r.parseComments=!0,r.parseSequences=!0),r}var U=function(e){(0,o.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,u.Z)(this,r);var a=$(n);(e=t.call(this,{objectMode:!0})).encoding=n.encoding||"utf8",e.decoder=new N.s,e.textBuffer="";var i=e.push.bind((0,b.Z)(e));return e.parser=new M({featureCallback:a.parseFeatures?i:null,directiveCallback:a.parseDirectives?i:null,commentCallback:a.parseComments?i:null,sequenceCallback:a.parseSequences?i:null,errorCallback:function(t){return e.emit("error",t)},bufferSize:a.bufferSize}),e}return(0,c.Z)(r,[{key:"_addLine",value:function(e){var t=e.toString("utf8");t&&this.parser.addLine(t)}},{key:"_nextText",value:function(e){var t=this,r=(this.textBuffer+e).split(/\r?\n/);this.textBuffer=r.pop(),this.maxLineLength&&this.textBuffer.length>this.maxLineLength?this.emit("error",new Error("maximum line size exceeded")):r.forEach((function(e){return t._addLine(e)}))}},{key:"_transform",value:function(e,t,r){this._nextText(this.decoder.write(e)),W(r)}},{key:"_flush",value:function(e){this.decoder.end&&this._nextText(this.decoder.end()),null!=this.textBuffer&&this._addLine(this.textBuffer),this.parser.finish(),W(e)}}]),r}(z.Transform);function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({bufferSize:1e3},e);return new U(t)}var J=function(e){(0,o.Z)(r,e);var t=(0,f.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.Z)(this,r),(e=t.call(this,Object.assign(n,{objectMode:!0}))).linesSinceLastSyncMark=0,e.minLinesBetweenSyncMarks=n.minSyncLines||100,e.insertVersionDirective=n.insertVersionDirective||!1,e.haveWeEmittedData=!1,e.fastaMode=!1,e}return(0,c.Z)(r,[{key:"_transform",value:function(e,t,r){var n;if(!this.haveWeEmittedData&&this.insertVersionDirective&&"gtf"!==(e[0]||e).directive&&this.push("##gtf\n"),e.sequence&&!this.fastaMode&&(this.push("##FASTA\n"),this.fastaMode=!0),n=Array.isArray(e)?e.map(q).join(""):q(e),this.push(n),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)this.push("###\n"),this.linesSinceLastSyncMark=0;else{for(var a=0,i=0;i<n.length;i+=1)"\n"===n[i]&&(a+=1);this.linesSinceLastSyncMark+=a}this.haveWeEmittedData=!0,W(r)}}]),r}(z.Transform);var H={parseStream:V,parseFile:function(e,t){return P.createReadStream(e).pipe(V(t))},parseStringSync:function(e){if(!e)return[];var t=$(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),r=[],n=r.push.bind(r),a=new M({featureCallback:t.parseFeatures?n:null,directiveCallback:t.parseDirectives?n:null,commentCallback:t.parseComments?n:null,sequenceCallback:t.parseSequences?n:null,bufferSize:1/0,errorCallback:function(e){throw e}});return e.split(/\r?\n/).forEach(a.addLine.bind(a)),a.finish(),r},formatSync:function(e){var t=[],r=[];e.forEach((function(e){e.sequence?r.push(e):t.push(e)}));var n=t.map(q).join("");return r.length&&(n+="##FASTA\n",n+=r.map(I).join("")),n},formatStream:function(e){return new J(e)},formatFile:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.assign({insertVersionDirective:!1},r);return new Promise((function(r,a){e.pipe(new J(n)).on("end",(function(){return r(t)})).on("error",a).pipe(P.createWriteStream(t,{encoding:n.encoding||"utf8"}))}))},util:n},G=r(33028);function K(e){var t=(0,G.Z)({},e);t.start-=1,t.strand={"+":1,"-":-1,".":0,"?":void 0}[e.strand],t.phase=Number(e.frame),t.refName=e.seq_name,null===e.score&&delete t.score,null===e.frame&&delete t.score;for(var r=new Set(["start","end","seq_name","score","featureType","source","frame","strand"]),n=0,a=Object.keys(e.attributes);n<a.length;n++){var i=a[n],s=i.toLowerCase();if(r.has(s)&&(s+="2"),null!==e.attributes[i]){var u=e.attributes[i];Array.isArray(u)&&1===u.length&&(u="".concat(u[0]).replaceAll(/^"|"$/g,"")),t[s]=u}}return t.refName=t.seq_name,t.type=t.featureType,e.child_features&&e.child_features.length>0&&(t.subfeatures=e.child_features.flatMap((function(e){return e.map((function(e){return K(e)}))}))),delete t.child_features,delete t.data,delete t.derived_features,delete t._linehash,delete t.attributes,delete t.seq_name,delete t.featureType,delete t.frame,t.transcript_id&&(t.name=t.transcript_id),t}function Q(e){return 31===e[0]&&139===e[1]&&8===e[2]}var X=function(e){(0,o.Z)(r,e);var t=(0,f.Z)(r);function r(){var e;(0,u.Z)(this,r);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).gtfFeatures=void 0,e.intervalTrees={},e}return(0,c.Z)(r,[{key:"loadDataP",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,s,u,c,o,f,l,d,p,v,b=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=b.length>0&&void 0!==b[0]?b[0]:{},r=this.getConf("gtfLocation"),e.next=4,(0,h.openLocation)(r,this.pluginManager).readFile(t);case 4:if(!Q(n=e.sent)){e.next=11;break}return e.next=8,(0,m.unzip)(n);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=n;case 12:if(!((s=e.t0).length>536870888)){e.next=15;break}throw new Error("Data exceeds maximum string length (512MB)");case 15:u=new TextDecoder("utf8",{fatal:!0}).decode(s),c=u.split(/\n|\r\n|\r/).filter((function(e){return!!e&&!e.startsWith("#")})),o={},f=(0,i.Z)(c),e.prev=19,f.s();case 21:if((l=f.n()).done){e.next=31;break}if(!(d=l.value).startsWith("#")){e.next=25;break}return e.abrupt("continue",29);case 25:p=d.indexOf("\t"),v=d.slice(0,p),o[v]||(o[v]=[]),o[v].push(d);case 29:e.next=21;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(19),f.e(e.t1);case 36:return e.prev=36,f.f(),e.finish(36);case 39:return e.abrupt("return",{feats:o});case 40:case"end":return e.stop()}}),e,this,[[19,33,36,39]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,r=this,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.gtfFeatures||(this.gtfFeatures=this.loadDataP(t).catch((function(e){throw r.gtfFeatures=void 0,e}))),e.abrupt("return",this.gtfFeatures);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.loadData(t);case 3:return r=e.sent,n=r.feats,e.abrupt("return",Object.keys(n));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadFeatureIntervalTreeHelper",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,s,u,c,o,f,l,h,d=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadData();case 2:if(r=e.sent,n=r.feats,s=n[t]){e.next=7;break}return e.abrupt("return",void 0);case 7:u=H.parseStringSync(s.join("\n"),{parseFeatures:!0,parseComments:!1,parseDirectives:!1,parseSequences:!1}),c=new p.ZP,o=u.flat().map((function(e,r){return new v.SimpleFeature({data:K(e),id:"".concat(d.id,"-").concat(t,"-").concat(r)})})),f=(0,i.Z)(o);try{for(f.s();!(l=f.n()).done;)h=l.value,c.insert([h.get("start"),h.get("end")],h)}catch(a){f.e(a)}finally{f.f()}return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFeatureIntervalTree",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.intervalTrees[t]||(this.intervalTrees[t]=this.loadFeatureIntervalTreeHelper(t).catch((function(e){throw r.intervalTrees[t]=void 0,e}))),e.abrupt("return",this.intervalTrees[t]);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,d.ObservableCreate)(function(){var r=(0,s.Z)((0,a.Z)().mark((function r(n){var i,s,u,c;return(0,a.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i=e.start,s=e.end,u=e.refName,r.next=4,t.loadFeatureIntervalTree(u);case 4:null===(c=r.sent)||void 0===c||c.search([i,s]).forEach((function(e){return n.next(e)})),n.complete(),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),n.error(r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})));return function(e){return r.apply(this,arguments)}}(),r.signal)}},{key:"freeResources",value:function(){}}]),r}(l.BaseFeatureDataAdapter)},74854:function(){},66602:function(){}}]);
//# sourceMappingURL=1243.c749e9aa.chunk.js.map