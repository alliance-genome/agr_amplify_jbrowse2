"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2386,644],{32386:function(e,t,n){n.r(t),n.d(t,{default:function(){return m}});var r=n(32723),a=n(34795),u=n(9249),s=n(87371),c=n(45754),i=n(13820),o=n(32145),f=n(16959);function l(e,t,n,r,a,u,s,c,i){return{qname:e,qstart:t,qend:n,tname:a,tstart:u,tend:s,strand:"-"===r?-1:1,extra:{numMatches:i,blockLen:Math.max(n-t,s-u),mappingQual:0,cg:c}}}function p(e){for(var t="",n=0,r=0,a="",u="",s="",c=0,i=0,o=0,f="",p=[],h=0;h<e.length;h++){var m=e[h].replace(/ /g,"\t").split("\t");if("chain"===m[0]){if(f&&p.push(l(a,c,i,s,t,n,r,f,o)),t=m[2],n=+m[5],r=+m[6],a=m[7],u=m[8],s=m[9],c=+m[10],i=+m[11],"-"===s){var v=c;c=+u-i,i=+u-v}o=0,f=""}else{var d=+m[0]||0,g=m.length>1?+m[1]:0,b=m.length>2?+m[2]:0;0!==d&&(o+=+d,f+=d+"M"),0!==b&&(f+=b+"I"),0!==g&&(f+=g+"D")}}return f&&l(a,c,i,s,t,n,r,f,o),p}function h(e){return 31===e[0]&&139===e[1]&&8===e[2]}var m=function(e){(0,c.Z)(n,e);var t=(0,i.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"setupPre",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,o.openLocation)(this.getConf("chainLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!h(a=e.sent)){e.next=10;break}return e.next=7,(0,f.unzip)(a);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=a;case 11:if(!((u=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return s=new TextDecoder("utf8",{fatal:!0}).decode(u),e.abrupt("return",p(s.split(/\n|\r\n|\r/).filter((function(e){return!!e}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(n(19068).default)},19068:function(e,t,n){n.r(t),n.d(t,{default:function(){return O}});var r=n(33028),a=n(59740),u=n(32723),s=n(34795),c=n(9249),i=n(87371),o=n(45754),f=n(13820),l=n(82972),p=n(23995),h=n(32145),m=n(93824),v=n(99836),d=n(16959),g=n(24839),b=n(93069),x=n(95058),Z=n(42054),y=g.tr.getMismatches,k=function(e){(0,o.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,c.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"get",value:function(e){return"mismatches"===e?y(this.get("CIGAR")):(0,b.Z)((0,x.Z)(n.prototype),"get",this).call(this,e)}}]),n}(Z.SimpleFeature),w=n(44922),q=n(46840),N=n(96234);function M(e){for(var t={},n=0;n<e.length;n++){var r=e[n],a=r.qname+"-"+r.tname;t[a]||(t[a]={quals:[],len:[]}),t[a].quals.push(r.extra.mappingQual),t[a].len.push(r.extra.blockLen||1)}for(var u=Object.fromEntries(Object.entries(t).map((function(e){var t=(0,N.Z)(e,2),n=t[0],r=t[1];return[n,A((0,w.$R)(r.quals,r.len))]}))),s=0;s<e.length;s++){var c=e[s],i=c.qname+"-"+c.tname;c.extra.meanScore=u[i]}for(var o=1e4,f=0,l=0;l<e.length;l++){var p=e[l];o=Math.min(p.extra.meanScore||0,o),f=Math.max(p.extra.meanScore||0,f)}for(var h=0;h<e.length;h++){var m=e[h],v=m.extra.meanScore||0;m.extra.meanScore=(v-o)/(f-o)}return e}function A(e){var t=e.reduce((function(e,t){var n=(0,N.Z)(e,2),r=n[0],a=n[1],u=(0,N.Z)(t,2),s=u[0],c=u[1];return[r+s*c,a+c]}),[0,0]),n=(0,N.Z)(t,2);return n[0]/n[1]}function C(e){return e.split(/\n|\r\n|\r/).filter((function(e){return!!e})).map((function(e){var t=e.split("\t"),n=(0,q.Z)(t),a=n[0],u=n[2],s=n[3],c=n[4],i=n[5],o=n[7],f=n[8],l=n[9],p=n[10],h=n[11],m=n.slice(12),v=Object.fromEntries(m.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));return{tname:i,tstart:+o,tend:+f,qname:a,qstart:+u,qend:+s,strand:"-"===c?-1:1,extra:(0,r.Z)({numMatches:+l,blockLen:+p,mappingQual:+h},v)}}))}function D(e){for(var t=[],n=e.length-2;n>=0;n-=2){t.push(e[n]);var r=e[n+1];"D"===r?t.push("I"):"I"===r?t.push("D"):t.push(r)}return t}function I(e){return e.replaceAll("D","K").replaceAll("I","D").replaceAll("K","I")}var L=["numMatches","blockLen","cg"],F=g.tr.parseCigar,O=function(e){(0,o.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;(0,c.Z)(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return(e=t.call.apply(t,[this].concat(a))).setupP=void 0,e}return(0,i.Z)(n,[{key:"setup",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r,a,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.pluginManager,r=(0,h.openLocation)(this.getConf("pafLocation"),n),e.next=4,r.readFile(t);case 4:if(a=e.sent,!(0,w.lq)(a)){e.next=11;break}return e.next=8,(0,d.unzip)(a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=a;case 12:if(!((s=e.t0).length>536870888)){e.next=15;break}throw new Error("Data exceeds maximum string length (512MB)");case 15:return c=new TextDecoder("utf8",{fatal:!0}).decode(s),e.abrupt("return",C(c));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyNames",value:function(){var e=this.getConf("assemblyNames");return 0===e.length?[this.getConf("queryAssembly"),this.getConf("targetAssembly")]:e}},{key:"getRefNames",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,n,r,a,s,c,i,o=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},r=null===(t=n.regions)||void 0===t?void 0:t[0].assemblyName,e.next=4,this.setup(n);case 4:if(a=e.sent,-1===(s=this.getAssemblyNames().indexOf(r))){e.next=10;break}for(c=new Set,i=0;i<a.length;i++)c.add(0===s?a[i].qname:a[i].tname);return e.abrupt("return",Array.from(c));case 10:return console.warn("Unable to do ref renaming on adapter"),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.ObservableCreate)(function(){var c=(0,s.Z)((0,u.Z)().mark((function s(c){var i,o,f,l,h,m,d,g,b,x,Z,y,w,q,N,A,C,O,P,R,S,j,B,E,Q,_;return(0,u.Z)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,t.setup(n);case 2:for(i=u.sent,(o=n.config)&&"meanQueryIdentity"===(0,v.readConfObject)(o,"colorBy")&&(i=M(i)),f=t.getAssemblyNames(),l=f.indexOf(e.assemblyName),h=e.start,m=e.end,d=e.refName,g=e.assemblyName,-1===l&&(console.warn("".concat(g," not found in this adapter")),c.complete()),b=0;b<i.length;b++)x=i[b],Z=0,y=0,w="",q="",N=0,A=0,O=f[+!(C=0===l)],0===l?(Z=x.qstart,y=x.qend,w=x.qname,q=x.tname,N=x.tstart,A=x.tend):(Z=x.tstart,y=x.tend,w=x.tname,q=x.qname,N=x.qstart,A=x.qend),P=x.extra,R=x.strand,w===d&&(0,p.qY)(h,m,Z,y)&&(S=P.numMatches,j=void 0===S?0:S,B=P.blockLen,E=void 0===B?1:B,P.cg,Q=(0,a.Z)(P,L),_=P.cg,P.cg&&(C&&-1===R?_=D(F(P.cg)).join(""):C&&(_=I(P.cg))),c.next(new k((0,r.Z)((0,r.Z)({uniqueId:b+O,assemblyName:O,start:Z,end:y,type:"match",refName:w,strand:R},Q),{},{CIGAR:_,syntenyId:b,identity:j/E,numMatches:j,blockLen:E,mate:{start:N,end:A,refName:q,assemblyName:f[+C]}}))));c.complete();case 11:case"end":return u.stop()}}),s)})));return function(e){return c.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(l.BaseFeatureDataAdapter);O.capabilities=["getFeatures","getRefNames"]},44922:function(e,t,n){n.d(t,{$R:function(){return l},SN:function(){return i},lq:function(){return c},pJ:function(){return o}});var r=n(32723),a=n(34795),u=n(96234),s=n(16959);function c(e){return 31===e[0]&&139===e[1]&&8===e[2]}function i(e){return new Map(e.split(/\n|\r\n|\r/).filter((function(e){return!!e||e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=(0,u.Z)(t,6),r=n[0],a=n[1],s=n[2],c=n[3];return[c,{refName:r,start:+a,end:+s,score:+n[4],name:c,strand:"-"===n[5]?-1:1}]})))}function o(e,t){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if(a=e.sent,e.t0=new TextDecoder("utf8",{fatal:!0}),!c(a)){e.next=10;break}return e.next=7,(0,s.unzip)(a);case 7:e.t1=e.sent,e.next=11;break;case 10:e.t1=a;case 11:return e.t2=e.t1,e.abrupt("return",e.t0.decode.call(e.t0,e.t2));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e,t){return e.map((function(e,n){return[e,t[n]]}))}}}]);
//# sourceMappingURL=2386.1eac685f.chunk.js.map