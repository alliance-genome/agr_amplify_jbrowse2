{"version":3,"file":"static/js/1732.4df55078.chunk.js","mappings":"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","sources":["../../../packages/product-core/src/Session/BaseSession.ts","../../../packages/product-core/src/Session/Connections.ts","../../../plugins/data-management/src/AddConnectionWidget/components/ConfigureConnection.tsx","../../../plugins/data-management/src/AddConnectionWidget/components/ConnectionTypeSelect.tsx","../../../plugins/data-management/src/AddConnectionWidget/components/AddConnectionWidget.tsx"],"sourcesContent":["import { nanoid } from '@jbrowse/core/util/nanoid'\nimport PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  IAnyStateTreeNode,\n  Instance,\n  getParent,\n  isStateTreeNode,\n  types,\n} from 'mobx-state-tree'\nimport { AnyConfigurationSchemaType } from '@jbrowse/core/configuration'\nimport { BaseAssemblyConfigSchema } from '@jbrowse/core/assemblyManager'\n\n// locals\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel'\n\n/**\n * #stateModel BaseSessionModel\n * base session shared by **all** JBrowse products. Be careful what you include\n * here, everything will use it.\n */\nexport function BaseSessionModel<\n  ROOT_MODEL_TYPE extends BaseRootModelType,\n  JB_CONFIG_SCHEMA extends AnyConfigurationSchemaType,\n>(_pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      id: types.optional(types.identifier, nanoid()),\n      /**\n       * #property\n       */\n      name: types.string,\n      /**\n       * #property\n       */\n      margin: 0,\n    })\n    .volatile(() => ({\n      /**\n       * #volatile\n       * this is the globally \"selected\" object. can be anything. code that\n       * wants to deal with this should examine it to see what kind of thing it\n       * is.\n       */\n      selection: undefined as unknown,\n    }))\n    .views(self => ({\n      get root() {\n        return getParent<ROOT_MODEL_TYPE>(self)\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get jbrowse() {\n        return self.root.jbrowse\n      },\n      /**\n       * #getter\n       */\n      get rpcManager() {\n        return self.root.rpcManager\n      },\n      /**\n       * #getter\n       */\n      get configuration(): Instance<JB_CONFIG_SCHEMA> {\n        return this.jbrowse.configuration\n      },\n      /**\n       * #getter\n       */\n      get adminMode() {\n        return self.root.adminMode\n      },\n\n      /**\n       * #getter\n       */\n      get textSearchManager() {\n        return self.root.textSearchManager\n      },\n    }))\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get assemblies(): Instance<BaseAssemblyConfigSchema>[] {\n        return self.jbrowse.assemblies\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       * set the global selection, i.e. the globally-selected object. can be a\n       * feature, a view, just about anything\n       */\n      setSelection(thing: unknown) {\n        self.selection = thing\n      },\n\n      /**\n       * #action\n       * clears the global selection\n       */\n      clearSelection() {\n        self.selection = undefined\n      },\n    }))\n}\n\n/** Session mixin MST type for the most basic session */\nexport type BaseSessionType = ReturnType<typeof BaseSessionModel>\n\n/** Instance of the most basic possible session */\nexport type BaseSession = Instance<BaseSessionType>\n\n/** Type guard for BaseSession */\nexport function isBaseSession(thing: IAnyStateTreeNode): thing is BaseSession {\n  return 'id' in thing && 'name' in thing && 'root' in thing\n}\n\n/** Type guard for whether a thing is JBrowse session */\nexport function isSession(thing: unknown): thing is BaseSession {\n  return isStateTreeNode(thing) && isBaseSession(thing)\n}\n","import PluginManager from '@jbrowse/core/PluginManager'\nimport {\n  AnyConfigurationModel,\n  readConfObject,\n} from '@jbrowse/core/configuration'\nimport { IAnyStateTreeNode, Instance, types } from 'mobx-state-tree'\nimport { BaseConnectionConfigModel } from '@jbrowse/core/pluggableElementTypes/models/baseConnectionConfig'\nimport { BaseConnectionModel } from '@jbrowse/core/pluggableElementTypes/models/BaseConnectionModelFactory'\n\n// locals\nimport type { BaseRootModelType } from '../RootModel/BaseRootModel'\nimport type { SessionWithReferenceManagementType } from './ReferenceManagement'\nimport { isBaseSession } from './BaseSession'\n\n/**\n * #stateModel ConnectionManagementSessionMixin\n */\nexport function ConnectionManagementSessionMixin(pluginManager: PluginManager) {\n  return types\n    .model({\n      /**\n       * #property\n       */\n      connectionInstances: types.array(\n        pluginManager.pluggableMstType(\n          'connection',\n          'stateModel',\n        ) as BaseConnectionModel,\n      ),\n    })\n    .views(self => ({\n      /**\n       * #getter\n       */\n      get connections(): BaseConnectionConfigModel[] {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.connections\n      },\n    }))\n    .actions(self => ({\n      /**\n       * #action\n       */\n      makeConnection(\n        configuration: AnyConfigurationModel,\n        initialSnapshot = {},\n      ) {\n        const type = configuration.type as string\n        if (!type) {\n          throw new Error('track configuration has no `type` listed')\n        }\n        const name = readConfObject(configuration, 'name')\n        const connectionType = pluginManager.getConnectionType(type)\n        if (!connectionType) {\n          throw new Error(`unknown connection type ${type}`)\n        }\n        const length = self.connectionInstances.push({\n          ...initialSnapshot,\n          name,\n          // @ts-expect-error unsure why ts doesn't like `type` here, but is\n          // needed\n          type,\n          configuration,\n        })\n        return self.connectionInstances[length - 1]\n      },\n\n      /**\n       * #action\n       */\n      prepareToBreakConnection(configuration: AnyConfigurationModel) {\n        const root = self as typeof self &\n          Instance<SessionWithReferenceManagementType>\n        const callbacksToDeref: Function[] = []\n        const derefTypeCount: Record<string, number> = {}\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          return undefined\n        }\n        for (const track of connection.tracks) {\n          const ref = root.getReferring(track)\n          root.removeReferring(ref, track, callbacksToDeref, derefTypeCount)\n        }\n        return [\n          () => {\n            callbacksToDeref.forEach(cb => cb())\n            this.breakConnection(configuration)\n          },\n          derefTypeCount,\n        ]\n      },\n\n      /**\n       * #action\n       */\n      breakConnection(configuration: AnyConfigurationModel) {\n        const name = readConfObject(configuration, 'name')\n        const connection = self.connectionInstances.find(c => c.name === name)\n        if (!connection) {\n          throw new Error(`no connection found with name ${name}`)\n        }\n        self.connectionInstances.remove(connection)\n      },\n\n      /**\n       * #action\n       */\n      deleteConnection(configuration: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.deleteConnectionConf(configuration)\n      },\n\n      /**\n       * #action\n       */\n      addConnectionConf(connectionConf: AnyConfigurationModel) {\n        const { jbrowse } = self as typeof self & Instance<BaseRootModelType>\n        return jbrowse.addConnectionConf(connectionConf)\n      },\n\n      /**\n       * #action\n       */\n      clearConnections() {\n        self.connectionInstances.clear()\n      },\n    }))\n}\n\n/** Session mixin MST type for a session that has connections */\nexport type SessionWithConnectionsType = ReturnType<\n  typeof ConnectionManagementSessionMixin\n>\n\n/** Instance of a session that has connections: `connectionInstances`,\n * `makeConnection()`, etc. */\nexport type SessionWithConnections = Instance<SessionWithConnectionsType>\n\n/** Type guard for SessionWithConnections */\nexport function isSessionWithConnections(\n  session: IAnyStateTreeNode,\n): session is SessionWithConnections {\n  return isBaseSession(session) && 'connectionInstances' in session\n}\n","import React, { Suspense } from 'react'\nimport { observer } from 'mobx-react'\nimport { ConfigurationEditor } from '@jbrowse/plugin-config'\nimport { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\nimport { AnyConfigurationModel } from '@jbrowse/core/configuration'\nimport { AbstractSessionModel } from '@jbrowse/core/util'\nimport { LoadingEllipses } from '@jbrowse/core/ui'\n\nconst ConfigureConnection = observer(function ({\n  connectionType,\n  model,\n  session,\n}: {\n  connectionType: ConnectionType\n  model: AnyConfigurationModel\n  session: AbstractSessionModel\n}) {\n  const ConfigEditorComponent =\n    connectionType.configEditorComponent || ConfigurationEditor\n\n  return (\n    <Suspense fallback={<LoadingEllipses />}>\n      <ConfigEditorComponent model={{ target: model }} session={session} />\n    </Suspense>\n  )\n})\n\nexport default ConfigureConnection\n","import React, { useEffect } from 'react'\nimport { IconButton, MenuItem, TextField } from '@mui/material'\nimport { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\nimport { observer } from 'mobx-react'\n\n// icons\nimport OpenInNewIcon from '@mui/icons-material/OpenInNew'\n\nconst ConnectionTypeSelect = observer(function ConnectionTypeSelect({\n  connectionTypeChoices,\n  connectionType,\n  setConnectionType,\n}: {\n  connectionTypeChoices: ConnectionType[]\n  connectionType?: ConnectionType\n  setConnectionType: (c?: ConnectionType) => void\n}) {\n  const firstChoice = connectionTypeChoices[0]\n  useEffect(() => {\n    if (!connectionType) {\n      setConnectionType(firstChoice)\n    }\n  }, [connectionType, firstChoice, setConnectionType])\n\n  return (\n    <form autoComplete=\"off\">\n      {connectionType ? (\n        <TextField\n          value={connectionType.name}\n          label=\"connectionType\"\n          helperText={\n            connectionType.description ? (\n              <>\n                {connectionType.description}\n                {connectionType.url ? (\n                  <IconButton\n                    href={connectionType.url}\n                    rel=\"noopener noreferrer\"\n                    target=\"_blank\"\n                  >\n                    <OpenInNewIcon />\n                  </IconButton>\n                ) : null}\n              </>\n            ) : null\n          }\n          select\n          fullWidth\n          onChange={event =>\n            setConnectionType(\n              connectionTypeChoices.find(c => c.name === event.target.value),\n            )\n          }\n          variant=\"outlined\"\n        >\n          {connectionTypeChoices.map(c => (\n            <MenuItem key={c.name} value={c.name}>\n              {c.displayName || c.name}\n            </MenuItem>\n          ))}\n        </TextField>\n      ) : null}\n    </form>\n  )\n})\n\nexport default ConnectionTypeSelect\n","import React, { useMemo, useState } from 'react'\nimport { Button, Step, StepContent, StepLabel, Stepper } from '@mui/material'\nimport {\n  getSession,\n  getEnv,\n  isSessionModelWithWidgets,\n} from '@jbrowse/core/util'\nimport { makeStyles } from 'tss-react/mui'\nimport { observer } from 'mobx-react'\nimport { ConnectionType } from '@jbrowse/core/pluggableElementTypes'\n\n// locals\nimport ConfigureConnection from './ConfigureConnection'\nimport ConnectionTypeSelect from './ConnectionTypeSelect'\nimport { isSessionWithConnections } from '@jbrowse/product-core'\n\nconst useStyles = makeStyles()(theme => ({\n  root: {\n    marginTop: theme.spacing(1),\n  },\n  stepper: {\n    backgroundColor: theme.palette.background.default,\n  },\n  button: {\n    marginTop: theme.spacing(1),\n    marginRight: theme.spacing(1),\n  },\n  actionsContainer: {\n    marginBottom: theme.spacing(2),\n  },\n}))\n\nconst steps = ['Select a Connection Type', 'Configure Connection']\n\nconst AddConnectionWidget = observer(function ({ model }: { model: unknown }) {\n  const [connectionType, setConnectionType] = useState<ConnectionType>()\n  const [connectionId, setConnectionId] = useState<string>()\n  const [activeStep, setActiveStep] = useState(0)\n  const { classes } = useStyles()\n  const session = getSession(model)\n  const { pluginManager } = getEnv(session)\n\n  // useMemo is needed for react@18+mobx-react@9, previous code called configScema.create directly in a setConfigModel useState hook setter but this caused infinite loop\n  const configModel = useMemo(\n    () => connectionType?.configSchema.create({ connectionId }, getEnv(model)),\n    [connectionId, connectionType, model],\n  )\n\n  return (\n    <div className={classes.root}>\n      <Stepper\n        className={classes.stepper}\n        activeStep={activeStep}\n        orientation=\"vertical\"\n      >\n        {steps.map(label => (\n          <Step key={label}>\n            <StepLabel>{label}</StepLabel>\n            <StepContent>\n              {activeStep === 0 ? (\n                <ConnectionTypeSelect\n                  connectionTypeChoices={pluginManager.getConnectionElements()}\n                  connectionType={connectionType}\n                  setConnectionType={c => {\n                    setConnectionType(c)\n                    if (!c) {\n                      return\n                    }\n                    setConnectionId(`${c.name}-${Date.now()}`)\n                  }}\n                />\n              ) : connectionType && configModel ? (\n                <ConfigureConnection\n                  connectionType={connectionType}\n                  model={configModel}\n                  session={session}\n                />\n              ) : null}\n              <div className={classes.actionsContainer}>\n                <Button\n                  disabled={activeStep === 0}\n                  onClick={() => setActiveStep(activeStep - 1)}\n                  className={classes.button}\n                >\n                  Back\n                </Button>\n                <Button\n                  disabled={\n                    !(\n                      (activeStep === 0 && connectionType) ||\n                      (activeStep === 1 && configModel)\n                    )\n                  }\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={() => {\n                    if (activeStep === steps.length - 1) {\n                      if (configModel && isSessionWithConnections(session)) {\n                        const conf = session.addConnectionConf(configModel)\n                        session.makeConnection(conf)\n                      } else {\n                        session.notify('No config model to add')\n                      }\n\n                      if (isSessionModelWithWidgets(session)) {\n                        session.hideWidget(model)\n                      }\n                    } else {\n                      setActiveStep(activeStep + 1)\n                    }\n                  }}\n                  className={classes.button}\n                  data-testid=\"addConnectionNext\"\n                >\n                  {activeStep === steps.length - 1 ? 'Connect' : 'Next'}\n                </Button>\n              </div>\n            </StepContent>\n          </Step>\n        ))}\n      </Stepper>\n    </div>\n  )\n})\n\nexport default AddConnectionWidget\n"],"names":["BaseSessionModel","_pluginManager","types","model","id","optional","identifier","nanoid","name","string","margin","volatile","selection","undefined","views","self","root","getParent","jbrowse","rpcManager","configuration","this","adminMode","textSearchManager","assemblies","actions","setSelection","thing","clearSelection","isBaseSession","ConnectionManagementSessionMixin","pluginManager","connectionInstances","array","pluggableMstType","connections","makeConnection","initialSnapshot","arguments","length","type","Error","readConfObject","getConnectionType","concat","push","_objectSpread","prepareToBreakConnection","_this","callbacksToDeref","derefTypeCount","connection","find","c","_step","_iterator","_createForOfIteratorHelper","tracks","s","n","done","track","value","ref","getReferring","removeReferring","err","e","f","forEach","cb","breakConnection","remove","deleteConnection","deleteConnectionConf","addConnectionConf","connectionConf","clearConnections","clear","isSessionWithConnections","session","observer","_ref","connectionType","ConfigEditorComponent","configEditorComponent","ConfigurationEditor","_jsx","Suspense","fallback","LoadingEllipses","children","target","connectionTypeChoices","setConnectionType","firstChoice","useEffect","autoComplete","TextField","label","helperText","description","_jsxs","_Fragment","url","IconButton","href","rel","OpenInNewIcon","select","fullWidth","onChange","event","variant","map","MenuItem","displayName","useStyles","makeStyles","theme","marginTop","spacing","stepper","backgroundColor","palette","background","default","button","marginRight","actionsContainer","marginBottom","steps","_useState","useState","_useState2","_slicedToArray","_useState3","_useState4","connectionId","setConnectionId","_useState5","_useState6","activeStep","setActiveStep","classes","getSession","getEnv","configModel","useMemo","configSchema","create","className","Stepper","orientation","Step","StepLabel","StepContent","ConnectionTypeSelect","getConnectionElements","Date","now","ConfigureConnection","Button","disabled","onClick","color","conf","notify","isSessionModelWithWidgets","hideWidget"],"sourceRoot":""}