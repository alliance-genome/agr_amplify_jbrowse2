"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8078],{78078:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ee});var r=a(66204),n=a(80846),l=a(94926),s=a(32339),c=a(78781),o=a(35861),i=a(31211),d=a(80013),m=a(59602),p=a(63315),u=a(65404),g=a(64864),f=a(7146),k=a(32831),E=a(38684),h=a(88196),b=a(36349),y=a(66159),v=a(46338),Z=a(39780),N=a(70539),T=a(5930),w=a(43902),S=a(86636),x=a(60962),C=a(2331),A=a(75174),D=a(86600),I=a(74780),M=a(81799),P=a(49140),W=a(15971),O=a(97916);const L=(0,E.ZL)()((e=>({paper:{display:"flex",flexDirection:"column",padding:e.spacing(1)},card:{marginTop:e.spacing(1)}}))),j=(0,n.observer)((function({model:e}){const{classes:t}=L(),[a,n]=(0,r.useState)(""),[l,s]=(0,r.useState)(""),[c,o]=(0,r.useState)(["Name","ID"]),[i,d]=(0,r.useState)(["CDS","exon"]),m=[{label:"Indexing attributes",values:c},{label:"Feature types to exclude",values:i}];return(0,r.useEffect)((()=>{e.setTextIndexingConf({attributes:c,exclude:i})}),[e,c,i]),r.createElement(S.Z,{className:t.paper},r.createElement(x.Z,null,"Indexing configuration"),m.map(((e,m)=>r.createElement(C.Z,{raised:!0,key:e.label,className:t.card},r.createElement(A.Z,null,r.createElement(x.Z,null,e.label),r.createElement(D.Z,{disablePadding:!0},e.values.map(((t,a)=>r.createElement(I.ZP,{key:a,disableGutters:!0},r.createElement(v.Z,{value:t,InputProps:{endAdornment:r.createElement(M.Z,{position:"end"},r.createElement(P.Z,{onClick:()=>{const t=e.values.filter(((e,t)=>t!==a));0===m?o(t):d(t)}},r.createElement(W.Z,null)))}})))),r.createElement(I.ZP,{disableGutters:!0},r.createElement(v.Z,{value:0===m?a:l,placeholder:"add new",onChange:e=>{0===m?n(e.target.value):s(e.target.value)},InputProps:{endAdornment:r.createElement(M.Z,{position:"end"},r.createElement(P.Z,{onClick:()=>{0===m?(o([...c,a]),n("")):(d([...i,l]),s(""))},disabled:0===m?""===a:""===l,"data-testid":"stringArrayAdd-Feat"},r.createElement(O.Z,null)))}}))))))))})),B=(0,E.ZL)()((e=>({spacing:{marginBottom:e.spacing(3)}}))),U=(0,n.observer)((({model:e})=>{const{classes:t}=B(),{pluginManager:a}=(0,i.getEnv)(e),{trackType:n}=e,l=a.getTrackElements();return r.createElement(v.Z,{className:t.spacing,value:n,variant:"outlined",label:"Track type",helperText:"Select track type",select:!0,fullWidth:!0,onChange:t=>e.setTrackType(t.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"trackTypeSelect"}}},l.map((({name:e,displayName:t})=>r.createElement(c.Z,{key:e,value:e},t))))}));var F=a(84644);const J=(0,E.ZL)()((e=>({spacing:{marginBottom:e.spacing(3)}}))),_=(0,n.observer)((({model:e})=>{const{classes:t}=J(),{trackAdapter:a}=e,{pluginManager:n}=(0,i.getEnv)(e);return r.createElement(v.Z,{className:t.spacing,value:"UNKNOWN"!==a?.type?a?.type:"",label:"Adapter type",variant:"outlined",helperText:"Select an adapter type",select:!0,fullWidth:!0,onChange:t=>e.setAdapterHint(t.target.value),SelectProps:{SelectDisplayProps:{"data-testid":"adapterTypeSelect"}}},Object.entries(function(e){const t={};return e.forEach((e=>{const a=e.adapterMetadata?.category||"Default";t[a]||(t[a]=[]),t[a].push(e)})),t}(n.getAdapterElements().filter((e=>!e.adapterMetadata?.hiddenFromGUI)))).map((([e,t])=>[r.createElement(F.Z,{key:e},e),t.map((e=>r.createElement(c.Z,{key:e.name,value:e.name},e.displayName)))])))})),G=(0,E.ZL)()((e=>({spacing:{marginBottom:e.spacing(3)}})));function R({trackAdapter:e,trackType:t}){const{classes:a}=G(),{type:n,subadapter:l}=e;return"SNPCoverageAdapter"===n?r.createElement(d.Z,{className:a.spacing},"Selected ",r.createElement("code",null,t),". Using adapter ",r.createElement("code",null,n)," with subadapter ",r.createElement("code",null,l?.type),". Please enter a track name and, if necessary, update the track type."):r.createElement(d.Z,{className:a.spacing},"Using adapter ",r.createElement("code",null,n)," and guessing track type"," ",r.createElement("code",null,t),". Please enter a track name and, if necessary, update the track type.")}function q({model:e}){const{classes:t}=G();return r.createElement(r.Fragment,null,r.createElement(d.Z,{className:t.spacing},"JBrowse was not able to guess the adapter type for this data, but it may be in the list below. If not, you can"," ",r.createElement(y.Z,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse to see if they support this data type or"," ",r.createElement(y.Z,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type."),r.createElement(_,{model:e}))}const $=(0,n.observer)((function({model:e}){const{classes:t}=G(),[a,n]=(0,r.useState)(!0),s=(0,i.getSession)(e),{trackName:c,trackAdapter:o,trackType:m,warningMessage:p,adapterHint:u}=e;if((0,r.useEffect)((()=>{""===u&&o&&e.setAdapterHint(o.type)}),[u,o,o?.type,e]),e.unsupported)return r.createElement(d.Z,{className:t.spacing},"This version of JBrowse cannot display data of this type. It is possible, however, that there is a newer version that can display them. You can"," ",r.createElement(y.Z,{href:"https://github.com/GMOD/jbrowse-components/releases",target:"_blank",rel:"noopener noreferrer"},"check for new releases")," ","of JBrowse or"," ",r.createElement(y.Z,{href:"https://github.com/GMOD/jbrowse-components/issues/new",target:"_blank",rel:"noopener noreferrer"},"file an issue")," ","and add a feature request for this data type.");if(o?.type===T.UNKNOWN)return r.createElement(q,{model:e});if(!o?.type)return r.createElement(d.Z,null,"Could not recognize this data type.");const g=(0,i.isSupportedIndexingAdapter)(o?.type);return r.createElement("div",null,o?r.createElement(R,{trackAdapter:o,trackType:m}):null,p?r.createElement(d.Z,{style:{color:"orange"}},p):null,r.createElement(v.Z,{className:t.spacing,label:"trackName",helperText:"A name for this track",fullWidth:!0,value:c,onChange:t=>e.setTrackName(t.target.value),inputProps:{"data-testid":"trackNameInput"}}),r.createElement(_,{model:e}),r.createElement(U,{model:e}),r.createElement(w.AssemblySelector,{session:s,helperText:"Select assembly to add track to",selected:e.assembly,onChange:t=>e.setAssembly(t),TextFieldProps:{fullWidth:!0,SelectProps:{SelectDisplayProps:{"data-testid":"assemblyNameSelect"}}}}),i.isElectron&&g&&r.createElement(l.Z,null,r.createElement(Z.Z,{label:"Index track for text searching?",control:r.createElement(N.Z,{checked:a,onChange:t=>{n(t.target.checked),e.setTextIndexTrack(t.target.checked)}})})),i.isElectron&&a&&g?r.createElement(j,{model:e}):null)})),H=(0,E.ZL)()((e=>({paper:{padding:e.spacing(2)},spacer:{height:e.spacing(8)}}))),K=(0,n.observer)((function({model:e}){const{classes:t}=H(),a=(0,h.getRoot)(e);return r.createElement(S.Z,{className:t.paper},r.createElement(w.FileSelector,{name:"Main file",description:"",location:e.trackData,setLocation:e.setTrackData,setName:e.setTrackName,rootModel:a}),r.createElement("div",{className:t.spacer}),r.createElement(w.FileSelector,{name:"Index file",description:"(Optional) The URL of the index file is automatically inferred from the URL of the main file if it is not supplied.",location:e.indexTrackData,setLocation:e.setIndexTrackData,setName:e.setTrackName,rootModel:a}))})),z=(0,E.ZL)()((e=>({root:{marginTop:e.spacing(1)},stepper:{backgroundColor:e.palette.background.default},button:{marginRight:e.spacing(1)},actionsContainer:{marginTop:e.spacing(10),marginBottom:e.spacing(2)},alertContainer:{padding:`${e.spacing(2)}px 0px ${e.spacing(2)}px 0px`}}))),Y=["Enter track data","Confirm track type"],Q=(0,n.observer)((function({model:e}){const[t,a]=(0,r.useState)(0),{classes:n}=z(),{jobsManager:l}=(0,h.getRoot)(e),s=(0,i.getSession)(e),{assembly:c,trackAdapter:o,trackData:E,trackName:y,trackType:v,textIndexTrack:Z,textIndexingConf:N}=e,[T,w]=(0,r.useState)();async function S(){if(t!==Y.length-1)return void a(t+1);const r=[`${y.toLowerCase().replaceAll(" ","_")}-${Date.now()}`,s.adminMode?"":"-sessionTrack"].join(""),n=s.assemblyManager.get(c);if((0,i.isSessionWithAddTracks)(s))if(n&&o&&"UNKNOWN"!==o.type){if(s.addTrackConf({trackId:r,type:v,name:y,assemblyNames:[c],adapter:{...o,sequenceAdapter:(0,b.getConf)(n,["sequence","adapter"])}}),e.view.showTrack?.(r),i.isElectron&&Z&&(0,i.isSupportedIndexingAdapter)(o.type)){const e=y+"-index",t={indexingParams:{...N||{attributes:["Name","ID"],exclude:["CDS","exon"]},assemblies:[c],tracks:[r],indexType:"perTrack",name:e,timestamp:(new Date).toISOString()},name:e,cancelCallback:()=>l.abortJob()};l.queueJob(t)}e.clearData(),(0,i.isSessionModelWithWidgets)(s)&&s.hideWidget(e)}else w("Failed to add track.\nThe configuration of this file is not currently supported.");else w("Unable to add tracks to this model")}function x(){switch(t){case 0:return!E;case 1:return!(y&&v&&o?.type&&c);default:return!0}}return r.createElement("div",{className:n.root},r.createElement(m.Z,{className:n.stepper,activeStep:t,orientation:"vertical"},Y.map(((l,s)=>r.createElement(p.Z,{key:l},r.createElement(u.Z,null,l),r.createElement(g.Z,null,function(t){switch(t){case 0:return r.createElement(K,{model:e});case 1:return r.createElement($,{model:e});default:return r.createElement(d.Z,null,"Unknown step")}}(s),r.createElement("div",{className:n.actionsContainer},r.createElement(f.Z,{disabled:0===t,onClick:()=>{w(void 0),a(t-1)},className:n.button},"Back"),r.createElement(f.Z,{disabled:x(),variant:"contained",color:"primary",onClick:S,className:n.button,"data-testid":"addTrackNextButton"},t===Y.length-1?"Add":"Next")),T?r.createElement("div",{className:n.alertContainer},r.createElement(k.Z,{severity:"error"},T)):null))))))})),V=(0,E.ZL)()({textbox:{width:"100%"},submit:{marginTop:25,marginBottom:100,display:"block"}}),X=(0,n.observer)((function({model:e}){const{classes:t}=V(),[a,n]=(0,r.useState)(""),[l,s]=(0,r.useState)();return r.createElement("div",null,l?r.createElement(w.ErrorMessage,{error:l}):null,r.createElement(v.Z,{multiline:!0,rows:10,value:a,onChange:e=>n(e.target.value),placeholder:"Paste track config or array of track configs in JSON format",variant:"outlined",className:t.textbox}),r.createElement(f.Z,{variant:"contained",className:t.submit,onClick:()=>{try{s(void 0);const t=(0,i.getSession)(e),r=JSON.parse(a),n=Array.isArray(r)?r:[r];(0,i.isSessionWithAddTracks)(t)&&(0,i.isSessionModelWithWidgets)(t)&&(n.forEach((e=>t.addTrackConf(e))),n.forEach((t=>e.view.showTrack(t.trackId))),e.clearData(),t.hideWidget(e))}catch(e){console.error(e),s(e)}}},"Submit"))})),ee=(0,n.observer)((function({model:e}){const[t,a]=(0,r.useState)("Default add track workflow"),{pluginManager:n}=(0,i.getEnv)(e),d=n.getAddTrackWorkflowElements(),m={"Default add track workflow":Q,"Add track JSON":X,...Object.fromEntries(d.map((e=>[e.name,e.ReactComponent])))},p=m[t]?t:"Default add track workflow",u=m[p];return r.createElement(r.Fragment,null,r.createElement(l.Z,null,r.createElement(s.Z,{value:p,onChange:e=>a(e.target.value)},Object.keys(m).map((e=>r.createElement(c.Z,{key:e,value:e},e)))),r.createElement(o.Z,null,"Type of add track workflow")),r.createElement("br",null),r.createElement(u,{model:e}))}))}}]);
//# sourceMappingURL=8078.8bfa7033.chunk.js.map