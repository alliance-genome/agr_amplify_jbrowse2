"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[7348],{67348:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var r=n(7552),a=n(68446),o=n(36422),s=n(75785),i=n(35723);const l=(0,s.n9)()({overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}}}),c=(0,a.observer)((function({model:e}){const{classes:t}=l(),{matchedTracks:n,interactToggled:a}=e,o=(0,r.useRef)(null);return r.createElement("div",{className:t.overlay},r.createElement("svg",{ref:o,style:{width:"100%",zIndex:10,pointerEvents:a?void 0:"none"}},n.map((t=>r.createElement(i.A,{parentRef:o,key:t.configuration.trackId,model:e,trackId:t.configuration.trackId})))))})),d=(0,s.n9)()((e=>({viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},content:{gridArea:"1/1"}}))),u=(0,a.observer)((function({model:e}){const{classes:t}=d(),{views:n}=e,{pluginManager:a}=(0,o.getEnv)(e);return r.createElement("div",{className:t.content},r.createElement("div",{style:{position:"relative"}},n.map(((e,o)=>{const{ReactComponent:s}=a.getViewType(e.type),i=r.createElement(s,{key:e.id,model:e});return o===n.length-1?i:[i,r.createElement("div",{key:`${e.id}-divider`,className:t.viewDivider})]}))))})),g=(0,a.observer)((function({model:e}){const{classes:t}=d();return r.createElement("div",null,r.createElement("div",{className:t.container},r.createElement(u,{model:e}),r.createElement(c,{model:e})))}))},35723:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(7552),a=n(68446),o=n(36422),s=n(48231),i=n(99546),l=n(9502);function c(e,t){const n=e.get("tags");return n?n[t]:e.get(t)}function d(e,t){const n=e.get("ALT");if(n)return new Map(n?.map((e=>(0,l.h)(e))).filter(i.notEmpty).map((e=>[e.MatePosition,e]))).get(`${t.get("refName")}:${t.get("start")+1}`)}var u=n(49473);const[g,,f]=[0,1,2,3],m=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:l,showIntraviewLinks:d}=e,m=(0,s.A)(),p=(0,i.getSession)(e),v=(0,o.getSnapshot)(e),{assemblyManager:h}=p,k=h.get(l[0].assemblyNames[0]);(0,u.E6)(v);const y=e.getTrackFeatures(t),E=(0,r.useMemo)((()=>function(e){for(const t of e.values())if(1&t.get("flags"))return!0;return!1}(y)),[y]),T=(0,r.useMemo)((()=>{const n=e.getMatchedFeaturesInLayout(t,E?function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.get("flags"),a=r.id(),o=4&e,s=2&e;if(!n.has(a)&&!s&&!o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(y):function(e){const t=new Map,n=new Set;for(const r of e.values()){const e=r.id(),a=4&r.get("flags"),o=!!c(r,"SA");if(!n.has(e)&&!a&&o){const e=r.get("name");let n=t.get(e);n||(n=[],t.set(e,n)),n.push(r)}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(y));return E||n.forEach((e=>{e.sort(((e,t)=>e.feature.get("clipPos")-t.feature.get("clipPos")))})),n}),[y,t,E,e]),[w,N]=(0,r.useState)();let M=0;if(n.current){const e=n.current.getBoundingClientRect();M=e.top}return k?r.createElement("g",{stroke:m.palette.text.disabled,fill:"none","data-testid":T.length?`${t}-loaded`:t},T.map((e=>{const n=[];for(let o=0;o<e.length-1;o++){const{layout:s,feature:i,level:c}=e[o],{layout:m,feature:v,level:h}=e[o+1];if(!s||!m)return console.warn("received null layout for a overlay feature"),null;if(!d&&c===h)return null;const T=k.getCanonicalRefName(i.get("refName")),b=k.getCanonicalRefName(v.get("refName"));if(!T||!b)throw new Error(`unable to find ref for ${T||b}`);const S=i.get("strand"),O=v.get("strand"),R=s[-1===S?g:f],A=-1===O,C=E?m[A?g:f]:m[A?f:g],L=(0,u.Tp)(l[c],T,R),W=(0,u.Tp)(l[h],b,C),I=l[c].pxToBp(L).reversed,$=l[h].pxToBp(W).reversed,F=l.map((e=>e.getTrack(t))),B=(0,u.Ec)(t,c,l,F,s,a)-M,J=(0,u.Ec)(t,h,l,F,m,a)-M,x=["M",L,B,"C",L+200*i.get("strand")*(I?-1:1),B,W-200*v.get("strand")*($?-1:1)*(E?-1:1),J,W,J].join(" "),D=`${i.id()}-${v.id()}`;n.push(r.createElement("path",{d:x,key:D,"data-testid":"r1",strokeWidth:w===D?5:1,onClick:()=>{const e=p.addWidget?.("BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(y.get(i.id())||{toJSON:()=>{}}).toJSON(),feature2:(y.get(v.id())||{toJSON:()=>{}}).toJSON()}});p.showWidget?.(e)},onMouseOver:()=>N(D),onMouseOut:()=>N(void 0)}))}return n}))):null})),[p]=[0,1,2,3],v=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,c=(0,i.getSession)(e),{assemblyManager:g}=c,f=e.getTrackFeatures(t),m=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=new Map,n=new Set;for(const r of e.values()){if(!n.has(r.id())&&"breakend"===r.get("type")){const e=r.get("ALT");e?.forEach((e=>{const n=`${r.get("refName")}:${r.get("start")+1}`,a=(0,l.h)(e);if(a){const e=t.get(n);e?e.push(r):t.set(a.MatePosition||"none",[r])}}))}n.add(r.id())}return[...t.values()].filter((e=>e.length>1))}(f))),[f,t,e]),[v,h]=(0,r.useState)(),k=(0,o.getSnapshot)(e);(0,u.E6)(k);const y=g.get(s[0].assemblyNames[0]);if(!y)return null;let E=0;if(n.current){const e=n.current.getBoundingClientRect();E=e.top}return r.createElement("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":m.length?`${t}-loaded`:t},m.map((e=>{const n=[];for(let o=0;o<e.length-1;o+=1){const{layout:i,feature:l,level:g}=e[o],{layout:m,feature:k,level:T}=e[o+1],w=l.id(),N=d(l,k);if(!i||!m)return null;const M=l.get("refName"),b=k.get("refName"),S=y.getCanonicalRefName(M),O=y.getCanonicalRefName(b);if(!S||!O)throw new Error(`unable to find ref for ${S||O}`);const R=(0,u.Tp)(s[g],S,i[p]),A=(0,u.Tp)(s[T],O,m[p]),C=s[g].pxToBp(R).reversed,L=s[T].pxToBp(A).reversed,W=s.map((e=>e.getTrack(t))),I=(0,u.Ec)(t,g,s,W,i,a)-E,$=(0,u.Ec)(t,T,s,W,m,a)-E;if(N){const e=["M",R-20*("left"===N.Join?-1:1)*(C?-1:1),I,"L",R,I,"L",A,$,"L",A-20*("left"===N.MateDirection?1:-1)*(L?-1:1),$].join(" ");n.push(r.createElement("path",{d:e,"data-testid":"r2",key:JSON.stringify(e),strokeWidth:w===v?10:5,onClick:()=>{const e=c.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:f.get(w)?.toJSON()});c.showWidget?.(e)},onMouseOver:()=>h(w),onMouseOut:()=>h(void 0)}))}else console.warn("the relevant ALT allele was not found, cannot render")}return n})))})),[h]=[0,1,2,3],k=(0,a.observer)((function({model:e,trackId:t,parentRef:n,getTrackYPosOverride:a}){const{views:s}=e,l=(0,i.getSession)(e),{assemblyManager:c}=l,d=e.getTrackFeatures(t),g=(0,r.useMemo)((()=>e.getMatchedFeaturesInLayout(t,function(e){const t=[],n=new Set;for(const r of e.values())n.has(r.id())||"<TRA>"!==r.get("ALT")[0]||t.push([r]),n.add(r.id());return t}(d))),[d,t,e]),[f,m]=(0,r.useState)(),p=(0,o.getSnapshot)(e);if((0,u.E6)(p),!c.get(s[0].assemblyNames[0]))return null;let v=0;if(n.current){const e=n.current.getBoundingClientRect();v=e.top}return s.length<2?null:r.createElement("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":g.length?`${t}-loaded`:t},g.map((e=>{const n=[];for(const{layout:o,feature:i,level:c}of e){const e=0===c?1:0,g=i.id();if(!o)return null;const p=i.get("INFO"),k=p.CHR2[0],y=p.END[0],[E,T]=p.STRANDS[0].split(""),w=(0,u.Tp)(s[e],k,y);if(w){const p=[w,0,w+1,0],k=(0,u.Tp)(s[c],i.get("refName"),o[h]),y=w,N=s[c].pxToBp(k).reversed,M=s[e].pxToBp(y).reversed,b=s.map((e=>e.getTrack(t))),S=(0,u.Ec)(t,c,s,b,o,a)-v,O=(0,u.Ec)(t,e,s,b,p,a)-v,R=["M",k-20*("+"===E?1:-1)*(N?-1:1),S,"L",k,S,"L",y,O,"L",y-20*("+"===T?1:-1)*(M?-1:1),O].join(" ");n.push(r.createElement("path",{d:R,key:JSON.stringify(R),strokeWidth:g===f?10:5,onClick:()=>{const e=l.addWidget?.("VariantFeatureWidget","variantFeature",{featureData:(d.get(g)||{toJSON:()=>{}}).toJSON()});l.showWidget?.(e)},onMouseOver:()=>m(g),onMouseOut:()=>m(void 0)}))}}return n})))})),y=(0,a.observer)((function(e){const{model:t,trackId:n}=e,a=t.getMatchedTracks(n);return"AlignmentsTrack"===a[0]?.type?r.createElement(m,e):"VariantTrack"===a[0]?.type?t.hasTranslocations(n)?r.createElement(k,e):r.createElement(v,e):null}))}}]);
//# sourceMappingURL=7348.84057563.chunk.js.map