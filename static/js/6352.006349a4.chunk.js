"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[6352,8422],{93384:function(e,t,n){n.d(t,{Z:function(){return f}});var r=n(68079),i=n(96234),o=n(30969),a=n(53276),c=n(26737),u=n(37574),s=(0,a.ZL)()((function(e){return{resizeBar:{background:e.palette.action.disabledBackground,height:12,position:"relative",overflow:"hidden"},tick:{position:"absolute",height:"100%",pointerEvents:"none",background:e.palette.action.disabled,width:1},hiddenTick:{position:"absolute",height:"100%",width:5}}}));function l(e){var t=e.left,n=e.scrollLeft,r=e.idx,i=e.onDrag,a=e.onMouseDown,l=s().classes,f=(0,o.useCallback)((function(e,t){return i(e,t,r)}),[r,i]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.Z,{onDrag:f,onMouseDown:a,vertical:!0,className:l.hiddenTick,style:{left:t-n-2.5}}),(0,u.jsx)("div",{style:{left:t-n},className:l.tick})]})}function f(e){for(var t=e.widths,n=e.setWidths,a=e.checkbox,c=e.scrollLeft,f=void 0===c?0:c,d=s().classes,h=[],v=(0,o.useState)(),m=(0,i.Z)(v,2),p=m[0],g=m[1],Z=a?52:0,x=0;x<t.length;x++){var w=t[x];h[x]=w+Z,Z+=w}return(0,u.jsx)("div",{className:d.resizeBar,children:h.map((function(e,i){return(0,u.jsx)(l,{onMouseDown:function(){g((0,r.Z)(t))},left:i===h.length-1?e-3:e,onDrag:function(e,i,o){var a=(0,r.Z)(t);a[o]=Math.max(p[o]-i,50),n(a)},idx:i,scrollLeft:f},i)}))})}},34298:function(e,t,n){n.d(t,{x:function(){return o}});var r=n(96234),i=n(30969);function o(){var e=(0,i.useRef)(null),t=(0,i.useState)(0),n=(0,r.Z)(t,2),o=n[0],a=n[1];return(0,i.useEffect)((function(){var t=setInterval((function(){var t,n=null===(t=e.current)||void 0===t?void 0:t.querySelector(".MuiDataGrid-virtualScroller");n&&a(n.scrollLeft)}),100);return function(){clearInterval(t)}}),[]),{ref:e,scrollLeft:o}}},56896:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var r=n(33028),i=n(30969),o=n(59071),a=n(59767),c=n(90550),u=n(68079),s=n(56666),l=n(96234),f=n(94551),d=n(90689),h=n(40909),v=n(59563),m=n(88399),p=n(97891),g=n(36174),Z=n(76770),x=n(93384),w=n(81073),j=n(9077),b=n(34298),k=n(53276),S=n(28722),C=n(94957),y=n(3994),E=n(87006),M=n(4953),L=n(44181),T=n(37973),O=n(68187),R=n(37574);function W(e){var t=e.setFilterText,n=e.setUseShoppingCart,r=e.setShowSparse,o=e.setShowFilters,c=e.setShowOptions,u=e.showOptions,s=e.showSparse,d=e.showFilters,h=e.useShoppingCart,v=e.filterText,m=e.model,p=(0,i.useState)(null),g=(0,l.Z)(p,2),Z=g[0],x=g[1];return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(y.ZP,{container:!0,spacing:4,alignItems:"center",children:[(0,R.jsx)(y.ZP,{item:!0,children:(0,R.jsx)(E.Z,{label:"Search...",value:v,onChange:function(e){return t(e.target.value)},InputProps:{endAdornment:(0,R.jsx)(M.Z,{position:"end",children:(0,R.jsx)(f.Z,{onClick:function(){return t("")},children:(0,R.jsx)(L.Z,{})})})}})}),(0,R.jsx)(y.ZP,{item:!0,children:(0,R.jsx)(f.Z,{onClick:function(e){return x(e.currentTarget)},children:(0,R.jsx)(T.Z,{})})}),(0,R.jsx)(y.ZP,{item:!0,children:(0,R.jsx)(O.Z,{model:m})})]}),(0,R.jsx)(a.Menu,{anchorEl:Z,open:!!Z,onClose:function(){return x(null)},onMenuItemClick:function(e,t){t(),x(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:function(){return n(!h)},type:"checkbox",checked:h},{label:"Show sparse metadata columns",onClick:function(){return r(!s)},checked:s,type:"checkbox"},{label:"Show facet filters",onClick:function(){return o(!d)},checked:d,type:"checkbox"},{label:"Show extra table options",onClick:function(){return c(!u)},checked:u,type:"checkbox"}]})]})}var N=n(41361),I=n(87535),F=n(33359),H=n(6779),G=n(70983),D=n(20331),P=n(3715),z=(0,k.ZL)()((function(e){return{facet:{margin:0,marginLeft:e.spacing(2)},select:{marginBottom:e.spacing(2)}}}));function B(e){var t=e.column,n=e.vals,r=e.width,o=e.dispatch,a=e.filters,c=z().classes,s=(0,i.useState)(!0),d=(0,l.Z)(s,2),h=d[0],v=d[1];return(0,R.jsxs)(I.Z,{className:c.facet,style:{width:r},children:[(0,R.jsxs)("div",{style:{display:"flex"},children:[(0,R.jsx)(F.Z,{children:t.field}),(0,R.jsx)(H.Z,{title:"Clear selection on this facet filter",children:(0,R.jsx)(f.Z,{onClick:function(){return o({key:t.field,val:[]})},size:"small",children:(0,R.jsx)(L.Z,{})})}),(0,R.jsx)(H.Z,{title:"Minimize/expand this facet filter",children:(0,R.jsx)(f.Z,{onClick:function(){return v(!h)},size:"small",children:h?(0,R.jsx)(D.Z,{}):(0,R.jsx)(P.Z,{})})})]}),h?(0,R.jsx)(G.Z,{multiple:!0,native:!0,className:c.select,value:a[t.field],onChange:function(e){o({key:t.field,val:(0,u.Z)(e.target.options).filter((function(e){return e.selected})).map((function(e){return e.value}))})},children:n.sort((function(e,t){return e[0].localeCompare(t[0])})).map((function(e){var t=(0,l.Z)(e,2),n=t[0],r=t[1];return(0,R.jsxs)("option",{value:n,children:[n," (",r,")"]},n)}))}):null]},t.field)}function _(e){for(var t=e.rows,n=e.columns,r=e.dispatch,i=e.filters,o=e.width,a=n.slice(1),c=new Map(a.map((function(e){return[e.field,new Map]}))),s=Object.keys(i),l=a.map((function(e){return e.field})),f=new Set,d=0,h=s;d<h.length;d++){var v,m=h[d];null!==(v=i[m])&&void 0!==v&&v.length&&f.add(m)}var p,g=(0,N.Z)(l);try{for(g.s();!(p=g.n()).done;){var Z=p.value;f.add(Z)}}catch(k){g.e(k)}finally{g.f()}var x,w=t,j=(0,N.Z)(f);try{var b=function(){var e,t,n=x.value,r=c.get(n),o=(0,N.Z)(w);try{for(o.s();!(t=o.n()).done;){var a=t.value,u="".concat(a[n]||""),s=r.get(u);u&&(void 0===s?r.set(u,1):r.set(u,s+1))}}catch(k){o.e(k)}finally{o.f()}var l=null!==(e=i[n])&&void 0!==e&&e.length?new Set(i[n]):void 0;w=w.filter((function(e){return void 0===l||l.has(e[n])}))};for(j.s();!(x=j.n()).done;)b()}catch(k){j.e(k)}finally{j.f()}return(0,R.jsx)("div",{children:a.map((function(e){return(0,R.jsx)(B,{vals:(0,u.Z)(c.get(e.field)),column:e,width:o,dispatch:r,filters:i},e.field)}))})}var A=["category","adapter","description"],X=(0,k.ZL)()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}),U=.75,V=(0,c.observer)((function(e){var t,n,o=e.model,c=X().classes,k=o.view,y=o.selection,E=(0,w.getEnv)(o).pluginManager,M=(0,b.x)(),L=M.ref,T=M.scrollLeft,O=(0,i.useState)(""),N=(0,l.Z)(O,2),I=N[0],F=N[1],H=(0,w.useLocalStorage)("facet-showTableOptions",!1),G=(0,l.Z)(H,2),D=G[0],P=G[1],z=(0,i.useState)(),B=(0,l.Z)(z,2),V=B[0],Y=B[1],q=(0,i.useState)(!1),$=(0,l.Z)(q,2),J=$[0],K=$[1],Q=(0,w.useLocalStorage)("facet-showSparse",!1),ee=(0,l.Z)(Q,2),te=ee[0],ne=ee[1],re=(0,w.useLocalStorage)("facet-showFilters",!0),ie=(0,l.Z)(re,2),oe=ie[0],ae=ie[1],ce=(0,w.useLocalStorage)("facet-panelWidth",400),ue=(0,l.Z)(ce,2),se=ue[0],le=ue[1],fe=(0,w.getSession)(o),de=(0,w.useDebounce)(I,400),he=k.tracks,ve=(0,i.useReducer)((function(e,t){return(0,r.Z)((0,r.Z)({},e),{},(0,s.Z)({},t.key,t.val))}),{}),me=(0,l.Z)(ve,2),pe=me[0],ge=me[1],Ze=(0,i.useMemo)((function(){return o.trackConfigurations.filter((function(e){return(0,C.wB)(de,e,fe)})).map((function(e){var t,n,i=(0,j.readConfObject)(e,"metadata");return(0,r.Z)({id:e.trackId,conf:e,name:(0,p.getTrackName)(e,fe),category:null===(t=(0,j.readConfObject)(e,"category"))||void 0===t?void 0:t.join(", "),adapter:null===(n=(0,j.readConfObject)(e,"adapter"))||void 0===n?void 0:n.type,description:(0,j.readConfObject)(e,"description"),metadata:i},i)}))}),[o,de,fe]),xe=(0,i.useMemo)((function(){return A.filter((function(e){return!!te||Ze.map((function(t){return t[e]})).filter((function(e){return!!e})).length>5}))}),[te,Ze]),we=(0,i.useMemo)((function(){return(0,u.Z)(new Set(Ze.flatMap((function(e){return t=e.metadata,Object.entries(t).map((function(e){var t=(0,l.Z)(e,2),n=t[0];return"string"===typeof t[1]?n:""})).filter((function(e){return!!e}));var t})))).filter((function(e){return!!te||Ze.map((function(t){return t.metadata[e]})).filter((function(e){return!!e})).length>5}))}),[te,Ze]),je=(0,i.useMemo)((function(){return["name"].concat((0,u.Z)(xe),(0,u.Z)(we))}),[xe,we]),be=(0,i.useState)((0,r.Z)((0,r.Z)({name:(0,w.measureGridWidth)(Ze.map((function(e){return e.name})),{maxWidth:500,stripHTML:!0})+15},Object.fromEntries(xe.map((function(e){return[e,(0,w.measureGridWidth)(Ze.map((function(t){return t[e]})),{maxWidth:400,stripHTML:!0})]})))),Object.fromEntries(we.map((function(e){return[e,(0,w.measureGridWidth)(Ze.map((function(t){return t.metadata[e]})),{maxWidth:400,stripHTML:!0})]}))))),ke=(0,l.Z)(be,2),Se=ke[0],Ce=ke[1],ye=(0,i.useState)(Object.fromEntries(je.map((function(e){return[e,!0]})))),Ee=(0,l.Z)(ye,2),Me=Ee[0],Le=Ee[1];(0,i.useEffect)((function(){Le((function(e){return(0,r.Z)((0,r.Z)({},Object.fromEntries(je.map((function(e){return[e,!0]})))),e)}))}),[je]),(0,i.useEffect)((function(){Ce((function(e){return(0,r.Z)((0,r.Z)({name:e.name},Object.fromEntries(xe.filter((function(e){return Me[e]})).map((function(e){return[e,(0,w.measureGridWidth)(Ze.map((function(t){return t[e]})),{stripHTML:!0,maxWidth:400})]})))),Object.fromEntries(we.filter((function(e){return Me[e]})).map((function(e){return[e,(0,w.measureGridWidth)(Ze.map((function(t){return t.metadata[e]})),{stripHTML:!0,maxWidth:400})]}))))}))}),[we,Me,xe,te,Ze]);var Te=(0,w.useDebounce)(Se,200),Oe=[{field:"name",hideable:!1,renderCell:function(e){var t=e.value,n=e.id,r=e.row;return(0,R.jsxs)("div",{className:c.cell,children:[(0,R.jsx)(g.Z,{html:t}),(0,R.jsx)(f.Z,{onClick:function(e){return Y({target:e.currentTarget,id:n,conf:r.conf})},children:(0,R.jsx)(S.Z,{})})]})},width:null!==(t=Te.name)&&void 0!==t?t:100}].concat((0,u.Z)(xe.map((function(e){var t;return{field:e,width:null!==(t=Te[e])&&void 0!==t?t:100,renderCell:function(e){var t=e.value;return(0,R.jsx)("div",{className:c.cell,children:t?(0,R.jsx)(g.Z,{html:t}):""})}}}))),(0,u.Z)(we.map((function(e){var t;return{field:e,width:null!==(t=Te[e])&&void 0!==t?t:100,renderCell:function(e){var t=e.value;return(0,R.jsx)("div",{className:c.cell,children:t?(0,R.jsx)(g.Z,{html:t}):""})}}})))),Re=new Set(he.map((function(e){return e.configuration.trackId}))),We=Object.entries(pe).filter((function(e){return e[1].length>0})).map((function(e){var t=(0,l.Z)(e,2),n=t[0],r=t[1];return[n,new Set(r)]})),Ne=Ze.filter((function(e){return We.every((function(t){var n=(0,l.Z)(t,2),r=n[0];return n[1].has(e[r])}))}));return(0,R.jsxs)(R.Fragment,{children:[V?(0,R.jsx)(Z.Z,{anchorEl:null===V||void 0===V?void 0:V.target,menuItems:(null===(n=fe.getTrackActionMenuItems)||void 0===n?void 0:n.call(fe,V.conf))||[],onMenuItemClick:function(e,t){t(),Y(void 0)},open:!!V,onClose:function(){return Y(void 0)}}):null,(0,R.jsx)(W,{setShowSparse:ne,setShowFilters:ae,setShowOptions:P,setFilterText:F,setUseShoppingCart:K,showFilters:oe,showSparse:te,showOptions:D,filterText:I,useShoppingCart:J,model:o}),(0,R.jsxs)("div",{ref:L,style:{display:"flex",overflow:"hidden",height:window.innerHeight*U,width:window.innerWidth*U},children:[(0,R.jsxs)("div",{style:{height:window.innerHeight*U,width:window.innerWidth*U-(oe?se:0)},children:[(0,R.jsx)(x.Z,{checkbox:!0,widths:Object.values(Se).map((function(e){return null!==e&&void 0!==e?e:100})),setWidths:function(e){return Ce(Object.fromEntries(Object.entries(Se).map((function(t,n){return[t[0],e[n]]}))))},scrollLeft:T}),(0,R.jsx)(v._$,{rows:Ne,columnVisibilityModel:Me,onColumnVisibilityModelChange:function(e){return Le(e)},columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,onRowSelectionModelChange:function(e){if(J){var t=(0,h.getRoot)(o),n=E.pluggableConfigSchemaType("track"),r=e.map((function(e){return(0,h.resolveIdentifier)(n,t,e)}));o.setSelection(r)}else{var i=Re,a=new Set(e);(0,d.transaction)((function(){(0,u.Z)(i).filter((function(e){return!a.has(e)})).map((function(e){return k.hideTrack(e)})),(0,u.Z)(a).filter((function(e){return!i.has(e)})).map((function(e){return k.showTrack(e)}))}))}},rowSelectionModel:J?y.map((function(e){return e.trackId})):(0,u.Z)(Re),slots:{toolbar:D?m.n:null},slotProps:{toolbar:{printOptions:{disableToolbarButton:!0}}},columns:Oe,rowHeight:25})]}),oe?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(a.ResizeHandle,{vertical:!0,onDrag:function(e){return le(se-e)},style:{marginLeft:5,background:"grey",width:5}}),(0,R.jsx)("div",{style:{width:se,overflowY:"auto",overflowX:"hidden"},children:(0,R.jsx)(_,{width:se-10,rows:Ze,columns:Oe,dispatch:ge,filters:pe})})]}):null]})]})})),Y=(0,c.observer)((function(e){var t=e.handleClose;return(0,R.jsx)(a.Dialog,{open:!0,onClose:t,maxWidth:"xl",title:"Faceted track selector",children:(0,R.jsx)(o.Z,{children:(0,R.jsx)(V,(0,r.Z)({},e))})})}))},71127:function(e,t,n){n.d(t,{d:function(){return s}});var r=n(30969),i=n(14006),o=n(34604),a=n(4422),c=n(37574);function u(e){return e.substring(2).toLowerCase()}function s(e){var t=e.children,n=e.disableReactTree,s=void 0!==n&&n,l=e.mouseEvent,f=void 0===l?"onClick":l,d=e.onClickAway,h=e.touchEvent,v=void 0===h?"onTouchEnd":h,m=r.useRef(!1),p=r.useRef(null),g=r.useRef(!1),Z=r.useRef(!1);r.useEffect((function(){return setTimeout((function(){g.current=!0}),0),function(){g.current=!1}}),[]);var x=(0,i.Z)(t.ref,p),w=(0,o.Z)((function(e){var t=Z.current;Z.current=!1;var n=(0,a.Z)(p.current);!g.current||!p.current||"clientX"in e&&function(e,t){return t.documentElement.clientWidth<e.clientX||t.documentElement.clientHeight<e.clientY}(e,n)||(m.current?m.current=!1:(e.composedPath?e.composedPath().indexOf(p.current)>-1:!n.documentElement.contains(e.target)||p.current.contains(e.target))||!s&&t||d(e))})),j=function(e){return function(n){Z.current=!0;var r=t.props[e];r&&r(n)}},b={ref:x};return!1!==v&&(b[v]=j(v)),r.useEffect((function(){if(!1!==v){var e=u(v),t=(0,a.Z)(p.current),n=function(){m.current=!0};return t.addEventListener(e,w),t.addEventListener("touchmove",n),function(){t.removeEventListener(e,w),t.removeEventListener("touchmove",n)}}}),[w,v]),!1!==f&&(b[f]=j(f)),r.useEffect((function(){if(!1!==f){var e=u(f),t=(0,a.Z)(p.current);return t.addEventListener(e,w),function(){t.removeEventListener(e,w)}}}),[w,f]),(0,c.jsx)(r.Fragment,{children:r.cloneElement(t,b)})}},56277:function(e,t,n){var r=n(56666),i=n(31461),o=n(7896),a=n(30969),c=n(87023),u=n(26540),s=n(17363),l=n(45971),f=n(6856),d=n(37574),h=["className","component","disableGutters","variant"],v=(0,l.ZP)("div",{name:"MuiToolbar",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,!n.disableGutters&&t.gutters,t[n.variant]]}})((function(e){var t=e.theme,n=e.ownerState;return(0,o.Z)({position:"relative",display:"flex",alignItems:"center"},!n.disableGutters&&(0,r.Z)({paddingLeft:t.spacing(2),paddingRight:t.spacing(2)},t.breakpoints.up("sm"),{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}),"dense"===n.variant&&{minHeight:48})}),(function(e){var t=e.theme;return"regular"===e.ownerState.variant&&t.mixins.toolbar})),m=a.forwardRef((function(e,t){var n=(0,s.Z)({props:e,name:"MuiToolbar"}),r=n.className,a=n.component,l=void 0===a?"div":a,m=n.disableGutters,p=void 0!==m&&m,g=n.variant,Z=void 0===g?"regular":g,x=(0,i.Z)(n,h),w=(0,o.Z)({},n,{component:l,disableGutters:p,variant:Z}),j=function(e){var t=e.classes,n={root:["root",!e.disableGutters&&"gutters",e.variant]};return(0,u.Z)(n,f.N,t)}(w);return(0,d.jsx)(v,(0,o.Z)({as:l,className:(0,c.Z)(j.root,r),ref:t,ownerState:w},x))}));t.Z=m},6856:function(e,t,n){n.d(t,{N:function(){return o}});var r=n(62746),i=n(2975);function o(e){return(0,i.Z)("MuiToolbar",e)}var a=(0,r.Z)("MuiToolbar",["root","gutters","regular","dense"]);t.Z=a}}]);
//# sourceMappingURL=6352.006349a4.chunk.js.map