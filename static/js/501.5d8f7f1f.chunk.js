"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[501],{501:(e,t,r)=>{r.d(t,{Z:()=>x});var s={};r.r(s),r.d(s,{escape:()=>c,escapeColumn:()=>u,formatAttributes:()=>d,formatComment:()=>b,formatDirective:()=>_,formatFeature:()=>v,formatItem:()=>S,formatSequence:()=>C,parseAttributes:()=>l,parseDirective:()=>f,parseFeature:()=>h,unescape:()=>a});var n=r(98672),i=r(18842);function a(e){return e.replace(/%([0-9A-Fa-f]{2})/g,((e,t)=>String.fromCharCode(parseInt(t,16))))}function o(e,t){return String(t).replace(e,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase().padStart(2,"0")}`))}function c(e){return o(/[\n;\r\t=%&,\x00-\x1f\x7f-\xff]/g,e)}function u(e){return o(/[\n\r\t%\x00-\x1f\x7f-\xff]/g,e)}function l(e){if(!e||!e.length||"."===e)return{};const t={};return e.replace(/\r?\n$/,"").split(";").forEach((e=>{const r=e.split("=",2);if(!r[1]||!r[1].length)return;r[0]=r[0].trim();let s=t[r[0].trim()];s||(s=[],t[r[0]]=s),s.push(...r[1].split(",").map((e=>e.trim())).map(a))})),t}function h(e){const t=e.split("\t").map((e=>"."===e||""===e?null:e));return{seq_id:t[0]&&a(t[0]),source:t[1]&&a(t[1]),type:t[2]&&a(t[2]),start:null===t[3]?null:parseInt(t[3],10),end:null===t[4]?null:parseInt(t[4],10),score:null===t[5]?null:parseFloat(t[5]),strand:t[6],phase:t[7],attributes:null===t[8]?null:l(t[8])}}function f(e){const t=/^\s*##\s*(\S+)\s*(.*)/.exec(e);if(!t)return null;const[,r]=t;let[,,s]=t;const n={directive:r};if(s.length&&(s=s.replace(/\r?\n$/,""),n.value=s),"sequence-region"===r){const e=s.split(/\s+/,3);return{...n,seq_id:e[0],start:e[1]&&e[1].replace(/\D/g,""),end:e[2]&&e[2].replace(/\D/g,"")}}if("genome-build"===r){const[e,t]=s.split(/\s+/,2);return{...n,source:e,buildName:t}}return n}function d(e){const t=[];return Object.entries(e).forEach((([e,r])=>{if(!r)return;let s;s=r.hasOwnProperty("toString")?c(r.toString()):Array.isArray(r)?r.map(c).join(","):c(r),t.push(`${c(e)}=${s}`)})),t.length?t.join(";"):"."}function p(e,t){const r=null===e.attributes||void 0===e.attributes?".":d(e.attributes),s=`${[null===e.seq_id?".":u(e.seq_id),null===e.source?".":u(e.source),null===e.type?".":u(e.type),null===e.start?".":u(e.start),null===e.end?".":u(e.end),null===e.score?".":u(e.score),null===e.strand?".":u(e.strand),null===e.phase?".":u(e.phase),r].join("\t")}\n`;return t[s]?"":(t[s]=!0,s)}function m(e,t){if(Array.isArray(e))return e.map((e=>m(e,t))).join("");const r=[p(e,t)];var s;return void 0!==(s=e).child_features&&void 0!==s.derived_features&&r.push(...e.child_features.map((e=>m(e,t))),...e.derived_features.map((e=>m(e,t)))),r.join("")}function v(e){return m(e,{})}function _(e){let t=`##${e.directive}`;return e.value&&(t+=` ${e.value}`),t+="\n",t}function b(e){return`# ${e.comment}\n`}function C(e){return`>${e.id}${e.description?` ${e.description}`:""}\n${e.sequence}\n`}function S(e){function t(e){return"attributes"in e?v(e):"directive"in e?_(e):"sequence"in e?C(e):"comment"in e?b(e):"# (invalid item found during format)\n"}return Array.isArray(e)?e.map(t):t(e)}class k{constructor(e){this.seqCallback=e,this.currentSequence=void 0}addLine(e){const t=/^>\s*(\S+)\s*(.*)/.exec(e);t?(this._flush(),this.currentSequence={id:t[1],sequence:""},t[2]&&(this.currentSequence.description=t[2].trim())):this.currentSequence&&/\S/.test(e)&&(this.currentSequence.sequence+=e.replace(/\s/g,""))}_flush(){this.currentSequence&&this.seqCallback(this.currentSequence)}finish(){this._flush()}}class g{constructor(e){this.fastaParser=void 0,this.eof=!1,this.lineNumber=0,this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},this._underConstructionOrphans={};const t=()=>{};this.featureCallback=e.featureCallback||t,this.endCallback=e.endCallback||t,this.commentCallback=e.commentCallback||t,this.errorCallback=e.errorCallback||t,this.directiveCallback=e.directiveCallback||t,this.sequenceCallback=e.sequenceCallback||t,this.disableDerivesFromReferences=e.disableDerivesFromReferences||!1,this.bufferSize=void 0===e.bufferSize?1e3:e.bufferSize}addLine(e){if(this.fastaParser)return void this.fastaParser.addLine(e);if(this.eof)return;if(this.lineNumber+=1,/^\s*[^#\s>]/.test(e))return void this._bufferLine(e);const t=/^\s*(#+)(.*)/.exec(e);if(t){const[,r]=t;let[,,s]=t;if(3===r.length)this._emitAllUnderConstructionFeatures();else if(2===r.length){const t=f(e);t&&("FASTA"===t.directive?(this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new k(this.sequenceCallback)):this._emitItem(t))}else s=s.replace(/\s*/,""),this._emitItem({comment:s})}else if(/^\s*$/.test(e));else{if(!/^\s*>/.test(e)){const t=e.replace(/\r?\n?$/g,"");throw new Error(`GFF3 parse error.  Cannot parse '${t}'.`)}this._emitAllUnderConstructionFeatures(),this.eof=!0,this.fastaParser=new k(this.sequenceCallback),this.fastaParser.addLine(e)}}finish(){this._emitAllUnderConstructionFeatures(),this.fastaParser&&this.fastaParser.finish(),this.endCallback()}_emitItem(e){Array.isArray(e)?this.featureCallback(e):"directive"in e?this.directiveCallback(e):"comment"in e&&this.commentCallback(e)}_enforceBufferSizeLimit(e=0){const t=e=>{e&&Array.isArray(e)&&e[0].attributes&&e[0].attributes.ID&&e[0].attributes.ID[0]&&(e[0].attributes.ID.forEach((e=>{delete this._underConstructionById[e],delete this._completedReferences[e]})),e.forEach((e=>{e.child_features&&e.child_features.forEach((e=>t(e))),e.derived_features&&e.derived_features.forEach((e=>t(e)))})))};for(;this._underConstructionTopLevel.length+e>this.bufferSize;){const e=this._underConstructionTopLevel.shift();e&&(this._emitItem(e),t(e))}}_emitAllUnderConstructionFeatures(){if(this._underConstructionTopLevel.forEach(this._emitItem.bind(this)),this._underConstructionTopLevel=[],this._underConstructionById={},this._completedReferences={},Array.from(Object.values(this._underConstructionOrphans)).length)throw new Error(`some features reference other features that do not exist in the file (or in the same '###' scope). ${Object.keys(this._underConstructionOrphans)}`)}_bufferLine(e){var t,r,s;const n={...h(e),child_features:[],derived_features:[]},i=(null===(t=n.attributes)||void 0===t?void 0:t.ID)||[],a=(null===(r=n.attributes)||void 0===r?void 0:r.Parent)||[],o=this.disableDerivesFromReferences?[]:(null===(s=n.attributes)||void 0===s?void 0:s.Derives_from)||[];if(!i.length&&!a.length&&!o.length)return void this._emitItem([n]);let c;i.forEach((e=>{const t=this._underConstructionById[e];t?(t[t.length-1].type!==n.type&&this._parseError(`multi-line feature "${e}" has inconsistent types: "${n.type}", "${t[t.length-1].type}"`),t.push(n),c=t):(c=[n],this._enforceBufferSizeLimit(1),a.length||o.length||this._underConstructionTopLevel.push(c),this._underConstructionById[e]=c,this._resolveReferencesTo(c,e))})),this._resolveReferencesFrom(c||[n],{Parent:a,Derives_from:o},i)}_resolveReferencesTo(e,t){const r=this._underConstructionOrphans[t];r&&(e.forEach((e=>{e.child_features.push(...r.Parent)})),e.forEach((e=>{e.derived_features.push(...r.Derives_from)})),delete this._underConstructionOrphans[t])}_parseError(e){this.eof=!0,this.errorCallback(`${this.lineNumber}: ${e}`)}_resolveReferencesFrom(e,t,r){function s(e,t,r){let s=e[t];s||(s={},e[t]=s);const n=s[r]||!1;return s[r]=!0,n}t.Parent.forEach((t=>{const n=this._underConstructionById[t];if(n){const i="child_features";r.filter((e=>s(this._completedReferences,e,`Parent,${t}`))).length||n.forEach((t=>{t[i].push(e)}))}else{let r=this._underConstructionOrphans[t];r||(r={Parent:[],Derives_from:[]},this._underConstructionOrphans[t]=r),r.Parent.push(e)}})),t.Derives_from.forEach((t=>{const n=this._underConstructionById[t];if(n){const i="derived_features";r.filter((e=>s(this._completedReferences,e,`Derives_from,${t}`))).length||n.forEach((t=>{t[i].push(e)}))}else{let r=this._underConstructionOrphans[t];r||(r={Parent:[],Derives_from:[]},this._underConstructionOrphans[t]=r),r.Derives_from.push(e)}}))}}var y=r(48494);function D(e){y&&y.nextTick?y.nextTick(e):e()}function q(e){const t={encoding:"utf8",parseFeatures:!0,parseDirectives:!1,parseSequences:!0,parseComments:!1,bufferSize:1e3,disableDerivesFromReferences:!1,...e};return e.parseAll&&(t.parseFeatures=!0,t.parseDirectives=!0,t.parseComments=!0,t.parseSequences=!0),t}class A extends n.Transform{constructor(e={}){super({objectMode:!0}),this.textBuffer="";const t=q(e);this.encoding=e.encoding||"utf8",this.decoder=new i.s;const r=this.push.bind(this);this.parser=new g({featureCallback:t.parseFeatures?r:void 0,directiveCallback:t.parseDirectives?r:void 0,commentCallback:t.parseComments?r:void 0,sequenceCallback:t.parseSequences?r:void 0,errorCallback:e=>this.emit("error",e),bufferSize:t.bufferSize,disableDerivesFromReferences:t.disableDerivesFromReferences})}_addLine(e){e&&this.parser.addLine(e)}_nextText(e){const t=(this.textBuffer+e).split(/\r?\n/);this.textBuffer=t.pop()||"",t.forEach((e=>this._addLine(e)))}_transform(e,t,r){this._nextText(this.decoder.write(e)),D(r)}_flush(e){this.decoder.end&&this._nextText(this.decoder.end()),null!=this.textBuffer&&this._addLine(this.textBuffer),this.parser.finish(),D(e)}}class F extends n.Transform{constructor(e={}){super(Object.assign(e,{objectMode:!0})),this.linesSinceLastSyncMark=0,this.haveWeEmittedData=!1,this.fastaMode=!1,this.minLinesBetweenSyncMarks=e.minSyncLines||100,this.insertVersionDirective=e.insertVersionDirective||!1}_transform(e,t,r){let s;if(!this.haveWeEmittedData&&this.insertVersionDirective){const t=Array.isArray(e)?e[0]:e;"directive"in t&&"gff-version"!==t.directive&&this.push("##gff-version 3\n")}if("sequence"in e&&!this.fastaMode&&(this.push("##FASTA\n"),this.fastaMode=!0),s=Array.isArray(e)?e.map(S).join(""):S(e),this.push(s),this.linesSinceLastSyncMark>=this.minLinesBetweenSyncMarks)this.push("###\n"),this.linesSinceLastSyncMark=0;else{let e=0;for(let t=0;t<s.length;t+=1)"\n"===s[t]&&(e+=1);this.linesSinceLastSyncMark+=e}this.haveWeEmittedData=!0,D(r)}}const x={parseStream:function(e={}){return new A(e)},parseStringSync:function(e,t={}){if(!e)return[];const r=q(t),s=[],n=s.push.bind(s),i=new g({featureCallback:r.parseFeatures?n:void 0,directiveCallback:r.parseDirectives?n:void 0,commentCallback:r.parseComments?n:void 0,sequenceCallback:r.parseSequences?n:void 0,disableDerivesFromReferences:r.disableDerivesFromReferences||!1,bufferSize:1/0,errorCallback:e=>{throw e}});return e.split(/\r?\n/).forEach(i.addLine.bind(i)),i.finish(),s},formatSync:function(e){const t=[],r=[];e.forEach((e=>{"sequence"in e?r.push(e):t.push(e)}));let s=t.map(S).join("");return r.length&&(s+="##FASTA\n",s+=r.map(C).join("")),s},formatStream:function(e={}){return new F(e)},formatFile:function(e,t,r={}){const s={insertVersionDirective:!0,...r};return new Promise(((r,n)=>{e.pipe(new F(s)).on("end",(()=>r(null))).on("error",n).pipe(t)}))},util:s}}}]);
//# sourceMappingURL=501.5d8f7f1f.chunk.js.map