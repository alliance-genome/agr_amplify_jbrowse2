"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[8982],{78982:function(e,t,r){r.d(t,{Q:function(){return q},B:function(){return L}});var n=r(34795),a=r(9249),i=r(87371),s=r(45754),u=r(86906),c=r(77162),o=r.n(c),f=r(33028),l=r(56666),h=r(76254),p=r(89410),d=r.n(p),m=r(26700),g=r(49882).Buffer;function v(e){return g.from((0,m.inflate)(e))}var b=r(43245),k=r.n(b),w=function(){function e(t,r){(0,a.Z)(this,e),this.ranges=2===arguments.length?[{min:t,max:r}]:0 in t?Object.assign({},t):[t]}return(0,i.Z)(e,[{key:"min",value:function(){return this.ranges[0].min}},{key:"max",value:function(){return this.ranges[this.ranges.length-1].max}},{key:"contains",value:function(e){for(var t=0;t<this.ranges.length;t+=1){var r=this.ranges[t];if(r.min<=e&&r.max>=e)return!0}return!1}},{key:"isContiguous",value:function(){return this.ranges.length>1}},{key:"getRanges",value:function(){return this.ranges.map((function(t){return new e(t.min,t.max)}))}},{key:"toString",value:function(){return this.ranges.map((function(e){return"[".concat(e.min,"-").concat(e.max,"]")})).join(",")}},{key:"union",value:function(t){for(var r=this.getRanges().concat(t.getRanges()).sort(this.rangeOrder),n=[],a=r[0],i=1;i<r.length;i+=1){var s=r[i];s.min()>a.max()+1?(n.push(a),a=s):s.max()>a.max()&&(a=new e(a.min(),s.max()))}return n.push(a),1===n.length?n[0]:new e(n)}},{key:"intersection",value:function(t){for(var r=this,n=t,a=this.ranges(),i=n.ranges(),s=a.length,u=i.length,c=0,o=0,f=[];c<s&&o<u;){r=a[c],n=i[o];var l=Math.max(r.min(),n.min()),h=Math.min(r.max(),n.max());h>=l&&f.push(new e(l,h)),r.max()>n.max()?o+=1:c+=1}if(0===f.length)throw new Error("found range of length 0");return 1===f.length?f[0]:new e(f)}},{key:"coverage",value:function(){for(var e=0,t=this.ranges(),r=0;r<t.length;r+=1){var n=t[r];e+=n.max()-n.min()+1}return e}},{key:"rangeOrder",value:function(e,t){var r=e,n=t;return arguments.length<2&&(n=r,r=this),r.min()<n.min()?-1:r.min()>n.min()?1:r.max()<n.max()?-1:n.max()>r.max()?1:0}}]),e}(),y=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).code="ERR_ABORTED",n}return(0,i.Z)(r)}((0,r(25991).Z)(Error));function x(e){e.sort((function(e,t){return(0|e.offset)-(0|t.offset)}));for(var t,r,n=[],a=0;a<e.length;a+=1)t&&e[a].offset-r<=2e3?(t.length+=e[a].length-r+e[a].offset,t.blocks.push(e[a])):n.push(t={blocks:[e[a]],length:e[a].length,offset:e[a].offset}),r=t.offset+t.length;return n}function S(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var t=new y("aborted");throw t.code="ERR_ABORTED",t}}var Z=r(49882).Buffer;var B=function(){function e(t,r,i,s,u,c,f){var p=this;if((0,a.Z)(this,e),this.featureCache=new(d())({cache:new(k())({maxSize:1e3}),fill:function(){var e=(0,n.Z)(o().mark((function e(t,r){var n,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.length,a=t.offset,e.next=3,p.bbi.read(Z.alloc(n),0,n,a,{signal:r});case 3:return i=e.sent,s=i.buffer,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),!(i>=0))throw new Error("invalid cirTreeOffset!");if(!(s>0))throw new Error("invalid cirTreeLength!");this.cirTreeOffset=i,this.cirTreeLength=s,this.isCompressed=c,this.refsByName=r,this.isBigEndian=u,this.bbi=t,this.blockType=f,Object.assign(this,function(e){var t,r=e?"big":"little",n=(new h._).endianess(r).uint32("chromId").uint32("start").uint32("end").uint32("validCnt").float("minScore").float("maxScore").float("sumData").float("sumSqData"),a=(new h._).endianess(r).uint8("isLeaf").skip(1).uint16("cnt").choice({tag:"isLeaf",choices:{1:(new h._).array("blocksToFetch",{length:"cnt",type:(new h._).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").uint64("blockSize")}),0:(new h._).array("recurOffsets",{length:"cnt",type:(new h._).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset")})}}),i=(new h._).endianess(r).uint32("chromId").int32("start").int32("end").string("rest",{zeroTerminated:!0});return{bigWigParser:(new h._).endianess(r).skip(4).int32("blockStart").skip(4).uint32("itemStep").uint32("itemSpan").uint8("blockType").skip(1).uint16("itemCount").choice({tag:"blockType",choices:(t={},(0,l.Z)(t,3,(new h._).array("items",{length:"itemCount",type:(new h._).float("score")})),(0,l.Z)(t,2,(new h._).array("items",{length:"itemCount",type:(new h._).int32("start").float("score")})),(0,l.Z)(t,1,(new h._).array("items",{length:"itemCount",type:(new h._).int32("start").int32("end").float("score")})),t)}),bigBedParser:i,summaryParser:n,leafParser:a}}(u))}return(0,i.Z)(e,[{key:"readWigData",value:function(){var e=(0,n.Z)(o().mark((function e(t,r,a,i,s){var u,c,l,h,p,d,m,g,v,b,k,y,x,S,B,_,O=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=this.refsByName,c=this.bbi,l=this.cirTreeOffset,h=this.isBigEndian,p=s.signal,void 0===(d=u[t])&&i.complete(),m={chrId:d,start:r,end:a},this.cirTreePromise||(this.cirTreePromise=c.read(Z.alloc(48),0,48,l,{signal:p})),e.next=9,this.cirTreePromise;case 9:return g=e.sent,v=g.buffer,b=h?v.readUInt32BE(4):v.readUInt32LE(4),k=[],y=0,x=function(e,t,r){try{var n=e.slice(t),a=O.leafParser.parse(n).result;if(a.blocksToFetch&&(k=k.concat(a.blocksToFetch.filter(S).map((function(e){return{offset:e.blockOffset,length:e.blockSize}})))),a.recurOffsets){var s=a.recurOffsets.filter(S).map((function(e){return e.blockOffset}));s.length>0&&_(s,r+1)}}catch(u){i.error(u)}},S=function(e){var t=e.startChrom,n=e.startBase,i=e.endChrom,s=e.endBase;return(t<d||t===d&&n<=a)&&(i>d||i===d&&s>=r)},B=function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var a,u,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=r.max()-r.min(),u=r.min(),e.next=5,O.featureCache.get("".concat(a,"_").concat(u),{length:a,offset:u},p);case 5:for(c=e.sent,l=0;l<t.length;l+=1)r.contains(t[l])&&(x(c,t[l]-u,n),0===(y-=1)&&O.readFeatures(i,k,(0,f.Z)((0,f.Z)({},s),{},{request:m})));e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),i.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r,n){return e.apply(this,arguments)}}(),_=function(e,t){try{y+=e.length;for(var r=4+32*b,n=new w(e[0],e[0]+r),a=1;a<e.length;a+=1){var s=new w(e[a],e[a]+r);n=n.union(s)}n.getRanges().map((function(r){return B(e,r,t)}))}catch(u){i.error(u)}},e.abrupt("return",_([l+48],1));case 21:e.prev=21,e.t0=e.catch(0),i.error(e.t0);case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"parseSummaryBlock",value:function(t,r,n){for(var a=[],i=r;i<t.byteLength;){var s=this.summaryParser.parse(t.slice(i));a.push(s.result),i+=s.offset}var u=a;n&&(u=u.filter((function(e){return e.chromId===n.chrId})));var c=u.map((function(e){return{start:e.start,end:e.end,maxScore:e.maxScore,minScore:e.minScore,score:e.sumData/(e.validCnt||1),summary:!0}}));return n?c.filter((function(t){return e.coordFilter(t,n)})):c}},{key:"parseBigBedBlock",value:function(t,r,n,a){for(var i=[],s=r;s<t.byteLength;){var u=this.bigBedParser.parse(t.slice(s));u.result.uniqueId="bb-".concat(n+s),i.push(u.result),s+=u.offset}return a?i.filter((function(t){return e.coordFilter(t,a)})):i}},{key:"parseBigWigBlock",value:function(t,r,n){var a=t.slice(r),i=this.bigWigParser.parse(a).result,s=i.items,u=i.itemSpan,c=i.itemStep,o=i.blockStart,f=i.blockType;if(3===f)for(var l=0;l<s.length;l++)s[l].start=o+l*c,s[l].end=o+l*c+u;else if(2===f)for(var h=0;h<s.length;h++)s[h].end=s[h].start+u;return n?s.filter((function(t){return e.coordFilter(t,n)})):s}},{key:"readFeatures",value:function(){var e=(0,n.Z)(o().mark((function e(t,r){var a,i,s,u,c,f,l=this,h=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>2&&void 0!==h[2]?h[2]:{},e.prev=1,i=this.blockType,s=this.isCompressed,u=a.signal,c=a.request,f=x(r),S(u),e.next=8,Promise.all(f.map(function(){var e=(0,n.Z)(o().mark((function e(r){var n,a,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(u),n=r.length,a=r.offset,e.next=4,l.featureCache.get("".concat(n,"_").concat(a),r,u);case 4:f=e.sent,r.blocks.forEach((function(e){S(u);var n=e.offset-r.offset,a=f;switch(s&&(a=v(f.slice(n)),n=0),S(u),i){case"summary":t.next(l.parseSummaryBlock(a,n,c));break;case"bigwig":t.next(l.parseBigWigBlock(a,n,c));break;case"bigbed":t.next(l.parseBigBedBlock(a,n,256*e.offset,c));break;default:console.warn("Don't know what to do with ".concat(i))}}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:t.complete(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.error(e.t0);case 14:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"coordFilter",value:function(e,t){return e.start<t.end&&e.end>=t.start}}]),e}(),_=r(2877),O=r(45996),z=r(6694),E=r(49882).Buffer,C=-2003829722,T=-2021002517;function P(e){var t=e?"big":"little",r=(new h._).endianess(t).int32("magic").uint16("version").uint16("numZoomLevels").uint64("chromTreeOffset").uint64("unzoomedDataOffset").uint64("unzoomedIndexOffset").uint16("fieldCount").uint16("definedFieldCount").uint64("asOffset").uint64("totalSummaryOffset").uint32("uncompressBufSize").uint64("extHeaderOffset").array("zoomLevels",{length:"numZoomLevels",type:(new h._).uint32("reductionLevel").uint32("reserved").uint64("dataOffset").uint64("indexOffset")}),n=(new h._).endianess(t).uint64("basesCovered").double("scoreMin").double("scoreMax").double("scoreSum").double("scoreSumSquares");return{chromTreeParser:(new h._).endianess(t).uint32("magic").uint32("blockSize").uint32("keySize").uint32("valSize").uint64("itemCount"),totalSummaryParser:n,headerParser:r,isLeafNode:(new h._).endianess(t).uint8("isLeafNode").skip(1).uint16("cnt")}}var I=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.Z)(this,e),this.headerCache=new(d())({cache:new(k())({maxSize:1}),fill:function(){var e=(0,n.Z)(o().mark((function e(r,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getHeader((0,f.Z)((0,f.Z)({},r),{},{signal:n})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()});var i=r.filehandle,s=r.renameRefSeqs,u=r.path,c=r.url;if(this.renameRefSeqs=s||function(e){return e},i)this.bbi=i;else if(c)this.bbi=new _.RemoteFile(c);else{if(!u)throw new Error("no file given");this.bbi=new _.LocalFile(u)}}return(0,i.Z)(e,[{key:"getHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="aborted"in e?{signal:e}:e;return this.headerCache.get(JSON.stringify(t),t,t.signal)}},{key:"_getHeader",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getMainHeader(t);case 2:return r=e.sent,e.next=5,this._readChromTree(r,t);case 5:return n=e.sent,e.abrupt("return",(0,f.Z)((0,f.Z)({},r),n));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getMainHeader",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,i,s,u,c,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:2e3,e.next=3,this.bbi.read(E.alloc(r),0,r,0,t);case 3:if(n=e.sent,a=n.buffer,i=this._isBigEndian(a),s=P(i),(u=s.headerParser.parse(a).result).fileType=u.magic===T?"bigbed":"bigwig",!(u.asOffset>r||u.totalSummaryOffset>r)){e.next=11;break}return e.abrupt("return",this._getMainHeader(t,2*r));case 11:if(u.asOffset&&(u.autoSql=a.slice(u.asOffset,a.indexOf(0,u.asOffset)).toString("utf8")),!(u.totalSummaryOffset>r)){e.next=14;break}return e.abrupt("return",this._getMainHeader(t,2*r));case 14:return u.totalSummaryOffset&&(c=a.slice(u.totalSummaryOffset),u.totalSummary=s.totalSummaryParser.parse(c).result),e.abrupt("return",(0,f.Z)((0,f.Z)({},u),{},{isBigEndian:i}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isBigEndian",value:function(e){var t=e.readInt32LE(0);if(t===C||t===T)return!1;if((t=e.readInt32BE(0))===C||t===T)return!0;throw new Error("not a BigWig/BigBed file")}},{key:"_readChromTree",value:function(){var e=(0,n.Z)(o().mark((function e(t,r){var a,i,s,u,c,f,l,p,d,m,g,v,b,k=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.isBigEndian,i=a?"big":"little",s=[],u={},c=t.chromTreeOffset,f=t.unzoomedDataOffset;f%4!==0;)f+=1;return e.next=9,this.bbi.read(E.alloc(f-c),0,f-c,c,r);case 9:return l=e.sent,p=l.buffer,d=P(a),m=d.chromTreeParser.parse(p).result.keySize,g=(new h._).endianess(i).string("key",{stripNull:!0,length:m}).uint32("refId").uint32("refSize"),v=(new h._).endianess(i).skip(m).uint64("childOffset"),32,b=function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,i,f,l,h,m,w,y,x,S,Z,B,_,O;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=t)>=p.length)){e.next=3;break}throw new Error("reading beyond end of buffer");case 3:if(n=d.isLeafNode.parse(p.slice(r)),a=n.result,i=a.isLeafNode,f=a.cnt,r+=n.offset,!i){e.next=10;break}for(l=0;l<f;l+=1)h=g.parse(p.slice(r)),r+=h.offset,m=h.result,w=m.key,y=m.refId,x=m.refSize,S={name:w,id:y,length:x},u[k.renameRefSeqs(w)]=y,s[y]=S;e.next=14;break;case 10:for(Z=[],B=0;B<f;B+=1)_=v.parse(p.slice(r)),O=_.result.childOffset,r+=_.offset,O-=c,Z.push(b(O));return e.next=14,Promise.all(Z);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=19,b(32);case 19:return e.abrupt("return",{refsByName:u,refsByNumber:s});case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getUnzoomedView",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,i,s,u,c,f,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(t);case 2:return r=e.sent,n=r.unzoomedIndexOffset,a=r.zoomLevels,i=r.refsByName,s=r.uncompressBufSize,u=r.isBigEndian,c=r.fileType,f=a[0],l=f?f.dataOffset-n:4e3,e.abrupt("return",new B(this.bbi,i,n,l,u,s>0,c));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatureStream",value:function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var a,i,s,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{scale:1},e.next=3,this.getHeader(a);case 3:if(i=this.renameRefSeqs(t),!a.basesPerSpan){e.next=10;break}return e.next=7,this.getView(1/a.basesPerSpan,a);case 7:s=e.sent,e.next=19;break;case 10:if(!a.scale){e.next=16;break}return e.next=13,this.getView(a.scale,a);case 13:s=e.sent,e.next=19;break;case 16:return e.next=18,this.getView(1,a);case 18:s=e.sent;case 19:if(s){e.next=21;break}throw new Error("unable to get block view for data");case 21:return e.abrupt("return",new O.y((function(e){s.readWigData(i,r,n,e,a)})));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var a,i,s,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{scale:1},e.next=3,this.getFeatureStream(t,r,n,a);case 3:return i=e.sent,e.next=6,i.pipe((0,z.u)((function(e,t){return e.concat(t)}))).toPromise();case 6:return s=e.sent,e.abrupt("return",s||[]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}(),L=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"getView",value:function(){var e=(0,n.Z)(o().mark((function e(t,r){var n,a,i,s,u,c,f,l,h,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(r);case 2:n=e.sent,a=n.zoomLevels,i=n.refsByName,s=n.fileSize,u=n.isBigEndian,c=n.uncompressBufSize,f=1/t,l=a.length,s||(l-=1),h=l;case 12:if(!(h>=0)){e.next=20;break}if(!((p=a[h])&&p.reductionLevel<=2*f)){e.next=17;break}return d=h<a.length-1?a[h+1].dataOffset-p.indexOffset:s-4-p.indexOffset,e.abrupt("return",new B(this.bbi,i,p.indexOffset,d,u,c>0,"summary"));case 17:h-=1,e.next=12;break;case 20:return e.abrupt("return",this.getUnzoomedView(r));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(I),F=r(68079),N=r(23288),R=r(84040),H=r(49882).Buffer;function D(e){return e.filter((function(e){return!!e}))}var q=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).readIndicesCache=new(d())({cache:new(k())({maxSize:1}),fill:function(){var e=(0,n.Z)(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._readIndices((0,f.Z)((0,f.Z)({},t),{},{signal:r})));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),i}return(0,i.Z)(r,[{key:"readIndices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="aborted"in e?{signal:e}:e;return this.readIndicesCache.get(JSON.stringify(t),t,t.signal)}},{key:"getView",value:function(){var e=(0,n.Z)(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getUnzoomedView(r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_readIndices",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,i,s,u,c,f,l,p,d,m,g,v,b,k;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader(t);case 2:return r=e.sent,n=r.extHeaderOffset,a=r.isBigEndian,e.next=7,this.bbi.read(H.alloc(64),0,64,n);case 7:if(i=e.sent,s=i.buffer,u=a?"big":"little",c=(new h._).endianess(u).uint16("size").uint16("count").uint64("offset").parse(s).result,f=c.count,l=c.offset,0!==f){e.next=14;break}return e.abrupt("return",[]);case 14:return d=(p=20)*f,e.next=18,this.bbi.read(H.alloc(d),0,d,l);case 18:for(m=e.sent,g=m.buffer,v=(new h._).endianess(u).int16("type").int16("fieldcount").uint64("offset").skip(4).int16("field"),b=[],k=0;k<f;k+=1)b.push(v.parse(g.slice(k*p)).result);return e.abrupt("return",b);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchExtraIndexBlocks",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,a,i,s,u,c=this,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:{},e.next=3,this.getHeader(r);case 3:return a=e.sent,i=a.isBigEndian,e.next=7,this.readIndices(r);case 7:if((s=e.sent).length){e.next=10;break}return e.abrupt("return",[]);case 10:return u=s.map(function(){var e=(0,n.Z)(o().mark((function e(a){var s,u,l,p,d,m,g,v,b,k,w;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.offset,u=a.field,e.next=3,c.bbi.read(H.alloc(32),0,32,s,r);case 3:return l=e.sent,p=l.buffer,d=(new h._).endianess(i?"big":"little").int32("magic").int32("blockSize").int32("keySize").int32("valSize").uint64("itemCount"),m=d.parse(p).result,g=m.blockSize,v=m.keySize,b=m.valSize,k=(new h._).endianess(i?"big":"little").int8("nodeType").skip(1).int16("cnt").choice({tag:"nodeType",choices:{0:(new h._).array("leafkeys",{length:"cnt",type:(new h._).string("key",{length:v,stripNull:!0}).uint64("offset")}),1:(new h._).array("keys",{length:"cnt",type:(new h._).string("key",{length:v,stripNull:!0}).uint64("offset").uint32("length").uint32("reserved")})}}),w=function(){var e=(0,n.Z)(o().mark((function e(n){var a,i,s,l,h,p,d,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=4+g*(v+b),e.next=3,c.bbi.read(H.alloc(a),0,a,n,r);case 3:if(i=e.sent,s=i.buffer,!(l=k.parse(s).result).leafkeys){e.next=17;break}p=0;case 8:if(!(p<l.leafkeys.length)){e.next=16;break}if(d=l.leafkeys[p].key,!(t.localeCompare(d)<0&&h)){e.next=12;break}return e.abrupt("return",w(h));case 12:h=l.leafkeys[p].offset;case 13:p+=1,e.next=8;break;case 16:return e.abrupt("return",w(h));case 17:m=0;case 18:if(!(m<l.keys.length)){e.next=24;break}if(l.keys[m].key!==t){e.next=21;break}return e.abrupt("return",(0,f.Z)((0,f.Z)({},l.keys[m]),{},{field:u}));case 21:m+=1,e.next=18;break;case 24:return e.abrupt("return",void 0);case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),32,e.abrupt("return",w(s+32));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=D,e.next=14,Promise.all(u);case 14:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchExtraIndex",value:function(){var e=(0,n.Z)(o().mark((function e(t){var r,n,a,i,s,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:{},e.next=3,this.searchExtraIndexBlocks(t,r);case 3:if((n=e.sent).length){e.next=6;break}return e.abrupt("return",[]);case 6:return e.next=8,this.getUnzoomedView(r);case 8:return a=e.sent,i=n.map((function(e){return new O.y((function(t){a.readFeatures(t,[e],r)})).pipe((0,z.u)((function(e,t){return e.concat(t)})),(0,R.U)((function(t){for(var r=0;r<t.length;r+=1)t[r].field=e.field;return t})))})),e.next=12,N.T.apply(void 0,(0,F.Z)(i)).toPromise();case 12:return s=e.sent,e.abrupt("return",s.filter((function(e){return e.rest.split("\t")[e.field-3]===t})));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(I)}}]);
//# sourceMappingURL=8982.e48a7021.chunk.js.map