"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[895],{30895:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var l=n(66204),o=n(80846),a=n(87830),r=n(98402),c=n(54617),i=n(78781),s=n(38684),d=n(31211),m=n(97916);const u=(0,s.ZL)()((e=>({fab:{position:"absolute",bottom:e.spacing(6),right:e.spacing(6)}}))),g=(0,o.observer)((function({model:e}){const{classes:t}=u(),n=(0,d.getSession)(e),[o,a]=(0,l.useState)(null);function s(){a(null)}const g=(0,d.isSessionModelWithConnections)(n),k=(0,d.isSessionWithAddTracks)(n);return l.createElement(l.Fragment,null,k||g?l.createElement(l.Fragment,null,l.createElement(r.Z,{color:"secondary",className:t.fab,onClick:e=>a(e.currentTarget)},l.createElement(m.Z,null)),l.createElement(c.Z,{anchorEl:o,open:Boolean(o),onClose:()=>a(null)},g?l.createElement(i.Z,{onClick:()=>{s(),(0,d.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddConnectionWidget","addConnectionWidget"))}},"Add connection"):null,k?l.createElement(i.Z,{onClick:()=>{s(),(0,d.isSessionModelWithWidgets)(n)&&n.showWidget(n.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}},"Add track"):null)):null)}));var k=n(91993),h=n(80013),b=n(49140),C=n(7724),f=n(61961),p=n(18964),E=n(78890);function v(e){return"category"===e?.type?e.children.map((e=>"category"===e.type?v(e):e.conf)).flat(1/0):[]}function y(e,t=new Map){e.id&&e.children.length&&t.set(e.id,e);for(const n of e.children)y(n,t);return t}function Z(e=""){return e.endsWith("(Unsupported)")||e.endsWith("(Unknown)")}const S=(0,s.ZL)()((e=>({contrastColor:{color:e.palette.tertiary.contrastText},accordionText:{margin:"auto 0",width:"100%"}})));function T({isOpen:e,setOpen:t,data:n}){const{classes:o}=S(),[a,r]=(0,l.useState)(null),{menuItems:c=[],name:i,model:s,id:d,tree:m}=n;return l.createElement("div",{className:o.accordionText,onClick:()=>{a||(n.toggleCollapse(d),t(!e))}},l.createElement(h.Z,null,e?l.createElement(f.Z,null):l.createElement(p.Z,null),i,l.createElement(b.Z,{onClick:e=>{r(e.currentTarget),e.stopPropagation()},className:o.contrastColor},l.createElement(E.Z,null))),a?l.createElement(C.Z,{anchorEl:a,menuItems:[{label:"Add to selection",onClick:()=>{const e=y(m).get(d);s.addToSelection(v(e))}},{label:"Remove from selection",onClick:()=>{const e=y(m).get(d);s.removeFromSelection(v(e))}},{label:"Show all tracks",onClick:()=>{for(const e of y(m).get(d)?.children||[])"track"===e.type&&s.view.showTrack(e.trackId)}},{label:"Hide all tracks",onClick:()=>{for(const e of y(m).get(d)?.children||[])"track"===e.type&&s.view.hideTrack(e.trackId)}},...c],onMenuItemClick:(e,t)=>{t(),r(null)},open:Boolean(a),onClose:()=>r(null)}):null)}var w=n(23540),W=n(39780),x=n(70539),I=n(18510),M=n(36349),L=n(17783);const F=(0,s.ZL)()((e=>({compactCheckbox:{padding:0},checkboxLabel:{marginRight:0,"&:hover":{backgroundColor:e.palette.action.selected}},selected:{background:"#cccc"}})));function A({data:e}){const{classes:t}=F(),{checked:n,conf:o,model:a,drawerPosition:r,id:c,trackId:i,name:s,onChange:d,selected:m}=e,u=o&&(0,M.readConfObject)(o,"description")||"";return l.createElement(l.Fragment,null,l.createElement(w.Z,{title:u+(m?" (in selection)":""),placement:"left"===r?"right":"left"},l.createElement(W.Z,{className:t.checkboxLabel,control:l.createElement(x.Z,{className:t.compactCheckbox,checked:n,onChange:()=>d(i),disabled:Z(s),inputProps:{"data-testid":`htsTrackEntry-${c}`}}),label:l.createElement("div",{"data-testid":`htsTrackLabel-${c}`,style:{background:m?"#cccc":void 0}},l.createElement(I.Z,{html:s}))})),l.createElement(L.Z,{model:a,trackId:i,id:c,conf:o}))}const N=(0,s.ZL)()((e=>({accordionBase:{display:"flex"},accordionCard:{padding:3,cursor:"pointer",display:"flex"},nestingLevelMarker:{position:"absolute",borderLeft:"1.5px solid #555"},accordionColor:{background:e.palette.tertiary.main,color:e.palette.tertiary.contrastText,width:"100%",display:"flex",paddingLeft:5}})));function O({data:e,isOpen:t,style:n,setOpen:o}){const{isLeaf:a,nestingLevel:r}=e,{classes:c}=N(),i=10*r+(a?10:0);return l.createElement("div",{style:n,className:a?void 0:c.accordionBase},new Array(r).fill(0).map(((e,t)=>l.createElement("div",{key:`mark-${t}`,style:{left:10*t+4,height:n?.height},className:c.nestingLevelMarker}))),l.createElement("div",{className:a?void 0:c.accordionCard,style:{marginLeft:i,whiteSpace:"nowrap",width:"100%"}},l.createElement("div",{className:a?void 0:c.accordionColor},a?l.createElement(A,{data:e}):l.createElement(T,{isOpen:t,data:e,setOpen:o}))))}function B(e,t,n,l){const o="track"===e.type;return{data:{defaultHeight:o?22:40,isLeaf:o,isOpenByDefault:!0,nestingLevel:t,selected:!!o&&l[e.trackId],...e,...n},nestingLevel:t,node:e}}const P=(0,o.observer)((function({height:e,tree:t,model:n}){const{filterText:o,selection:a,view:r}=n,c=(0,l.useRef)(null),i=(0,d.getSession)(n),{drawerPosition:s}=i,m=(0,l.useMemo)((()=>Object.fromEntries(a.map((e=>[e.trackId,e])))),[a]),u=(0,l.useMemo)((()=>({onChange:e=>{r.toggleTrack(e)&&n.addToRecentlyUsed(e)},toggleCollapse:e=>n.toggleCategory(e),tree:t,model:n,drawerPosition:s})),[r,n,s,t]),g=(0,l.useCallback)((function*(){for(const e of t.children)yield B(e,0,u,m);for(;;){const e=yield;for(const t of e.node.children)yield B(t,e.nestingLevel+1,u,m)}}),[t,u,m]);return(0,l.useEffect)((()=>{c.current.recomputeTree({refreshNodes:!0,useDefaultHeight:!0})}),[t,o]),l.createElement(l.Fragment,null,l.createElement(k.qF,{ref:c,treeWalker:g,height:e},O))}));var R=n(46338),H=n(81799),D=n(92292),U=n(69522),j=n(9051);const z=(0,l.lazy)((()=>Promise.all([n.e(7395),n.e(3155),n.e(4081),n.e(7690)]).then(n.bind(n,31358)))),_=(0,l.lazy)((()=>n.e(1861).then(n.bind(n,1861)))),$=(0,l.lazy)((()=>n.e(683).then(n.bind(n,60683)))),q=(0,l.lazy)((()=>n.e(8535).then(n.bind(n,88535)))),G=(0,l.lazy)((()=>n.e(3608).then(n.bind(n,53608)))),J=(0,o.observer)((function({model:e}){const t=(0,d.getSession)(e),[n,o]=(0,l.useState)(),[a,r]=(0,l.useState)(),[c,i]=(0,l.useState)(!1),[s,m]=(0,l.useState)(!1),[u,g]=(0,l.useState)(!1);function k(e,n){const l=(0,M.readConfObject)(e,"name"),a=t.prepareToBreakConnection?.(e);if(a){const[t,n]=a;Object.keys(n).length>0?o({connectionConf:e,safelyBreakConnection:t,dereferenceTypeCount:n,name:l}):t()}n&&r({name:l,connectionConf:e})}return l.createElement(l.Fragment,null,l.createElement(U.Z,{menuItems:[{label:"Open faceted track selector",onClick:()=>{g(!0)}},...(0,d.isSessionWithAddTracks)(t)?[{label:"Add track...",onClick:()=>{(0,d.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddTrackWidget","addTrackWidget",{view:e.view.id}))}}]:[],{label:"Connections...",subMenu:[...(0,d.isSessionModelWithConnections)(t)?[{label:"Turn on/off connections...",onClick:()=>i(!0)}]:[],...(0,d.isSessionModelWithConnectionEditing)(t)?[{label:"Add connection...",onClick:()=>{(0,d.isSessionModelWithWidgets)(t)&&t.showWidget(t.addWidget("AddConnectionWidget","addConnectionWidget"))}},{label:"Delete connections...",onClick:()=>m(!0)}]:[]]},{label:"Sort...",type:"subMenu",subMenu:[{label:"Sort tracks by name",type:"checkbox",checked:e.activeSortTrackNames,onClick:()=>e.setSortTrackNames(!e.activeSortTrackNames)},{label:"Sort categories by name",type:"checkbox",checked:e.activeSortCategories,onClick:()=>e.setSortCategories(!e.activeSortCategories)}]},{label:"Collapse...",type:"subMenu",subMenu:[...e.hasAnySubcategories?[{label:"Collapse subcategories",onClick:()=>e.collapseSubCategories()}]:[],{label:"Collapse top-level categories",onClick:()=>e.collapseTopLevelCategories()},{label:"Expand all categories",onClick:()=>e.expandAllCategories()}]}]},l.createElement(j.Z,null)),l.createElement(l.Suspense,{fallback:l.createElement(l.Fragment,null)},n?l.createElement(_,{modalInfo:n,onClose:()=>o(void 0)}):null,a?l.createElement($,{handleClose:()=>r(void 0),deleteDialogDetails:a,session:t}):null,s?l.createElement(q,{handleClose:()=>m(!1),breakConnection:k,session:t}):null,c?l.createElement(G,{handleClose:()=>i(!1),session:t,breakConnection:k}):null,u?l.createElement(z,{handleClose:()=>g(!1),model:e}):null))}));var K=n(65429),Q=n(38465),V=n(47807),X=n(5930);const Y=(0,o.observer)((function({model:e,tracks:t,extraMenuItems:n,children:o,onClick:a}){const{view:r}=e,[c,i]=(0,l.useState)(!1),s=(0,d.getSession)(e);return r?l.createElement(U.Z,{closeAfterItemClick:!1,onClick:a,menuItems:[...t.map((t=>({type:"checkbox",label:l.createElement(l.Fragment,null,l.createElement(I.Z,{html:(0,X.getTrackName)(t,s)})," ",l.createElement(L.Z,{id:t.trackId,trackId:t.trackId,model:e,conf:t,setOpen:i,stopPropagation:!0})),checked:r.tracks.some((e=>e.configuration===t)),onClick:()=>{c||e.view.toggleTrack(t.trackId)&&e.addToRecentlyUsed(t.trackId)}}))),...n]},o):null})),ee=(0,s.ZL)()({smallBadge:{height:14},margin:{marginRight:10}}),te=(0,o.observer)((function({model:e}){const{classes:t}=ee(),{view:n,favoriteTracks:o}=e;return n?l.createElement(Y,{onClick:()=>e.setFavoritesCounter(0),tracks:o,model:e,extraMenuItems:o.length?[{type:"divider"},{label:"Clear favorites",onClick:()=>e.clearFavorites()}]:[{label:"No favorite tracks yet",onClick:()=>{}}]},l.createElement(w.Z,{title:"Favorite tracks"},l.createElement(Q.Z,{classes:{badge:t.smallBadge},color:"secondary",anchorOrigin:{vertical:"bottom",horizontal:"right"},className:t.margin,badgeContent:e.favoritesCounter},l.createElement(V.Z,null)))):null}));var ne=n(84561);const le=(0,s.ZL)()({smallBadge:{height:14}}),oe=(0,o.observer)((function({model:e}){const{classes:t}=le(),{view:n,recentlyUsedCounter:o,recentlyUsedTracks:a}=e;return n?l.createElement(Y,{onClick:()=>e.setRecentlyUsedCounter(0),model:e,tracks:a,extraMenuItems:a.length?[{type:"divider"},{label:"Clear recently used",onClick:()=>e.clearRecentlyUsed()}]:[{label:"No recently used",onClick:()=>{}}]},l.createElement(w.Z,{title:"Recently used tracks"},l.createElement(Q.Z,{classes:{badge:t.smallBadge},anchorOrigin:{vertical:"bottom",horizontal:"right"},color:"secondary",badgeContent:o},l.createElement(ne.Z,null)))):null})),ae=(0,s.ZL)()((e=>({searchBox:{margin:e.spacing(2)}}))),re=(0,o.observer)((function({model:e}){const{filterText:t}=e,{classes:n}=ae();return l.createElement(R.Z,{className:n.searchBox,label:"Filter tracks",value:t,onChange:t=>e.setFilterText(t.target.value),fullWidth:!0,InputProps:{endAdornment:l.createElement(H.Z,{position:"end"},l.createElement(b.Z,{onClick:()=>e.clearFilterText()},l.createElement(D.Z,null)))}})})),ce=(0,o.observer)((function({model:e,setHeaderHeight:t}){return l.createElement("div",{ref:e=>t(e?.getBoundingClientRect().height||0),"data-testid":"hierarchical_track_selector"},l.createElement("div",{style:{display:"flex"}},l.createElement(J,{model:e}),l.createElement(K.Z,{model:e}),l.createElement(re,{model:e}),l.createElement(oe,{model:e}),l.createElement(te,{model:e})))})),ie=({tree:e,model:t,offset:n})=>"undefined"==typeof jest?l.createElement(a.ZP,{disableWidth:!0},(o=>l.createElement(P,{height:(o.height||n)-n,model:t,tree:e}))):l.createElement(P,{height:9e3,model:t,tree:e}),se=({overrideDimensions:e,children:t})=>e?l.createElement("div",{style:{...e}},t):l.createElement(l.Fragment,null,t),de=(0,o.observer)((function({model:e,toolbarHeight:t,overrideDimensions:n}){return l.createElement(se,{overrideDimensions:n},l.createElement(me,{model:e,toolbarHeight:t}),l.createElement(g,{model:e}))})),me=(0,o.observer)((function({model:e,toolbarHeight:t=0}){const[n,o]=(0,l.useState)(0);return l.createElement(l.Fragment,null,l.createElement(ce,{model:e,setHeaderHeight:o}),l.createElement(ie,{tree:e.hierarchy,model:e,offset:t+n}))})),ue=de},65429:(e,t,n)=>{n.d(t,{Z:()=>s});var l=n(66204),o=n(38465),a=n(80846),r=n(31211),c=n(85577),i=n(69522);const s=(0,a.observer)((function({model:e}){const{selection:t}=e,{pluginManager:n}=(0,r.getEnv)(e),a=(0,r.getSession)(e),s=n.evaluateExtensionPoint("TrackSelector-multiTrackMenuItems",[],{session:a});return t.length?l.createElement(i.Z,{menuItems:[{label:"Clear",onClick:()=>e.clearSelection()},...s.map((t=>({...t,..."onClick"in t?{onClick:()=>t.onClick(e)}:{}})))]},l.createElement(o.Z,{badgeContent:t.length,color:"primary"},l.createElement(c.Z,null))):null}))},17783:(e,t,n)=>{n.d(t,{Z:()=>m});var l=n(66204),o=n(38684),a=n(31211),r=n(69522),c=n(78890),i=n(62670),s=n(38991);const d=(0,o.ZL)()({cascadingStyle:{padding:0}}),m=function({id:e,trackId:t,stopPropagation:n,model:o,setOpen:m,conf:u}){const{classes:g}=d();return l.createElement(r.Z,{className:g.cascadingStyle,stopPropagation:n,setOpen:m,"data-testid":`htsTrackEntryMenu-${e}`,menuItems:[...(0,a.getSession)(o).getTrackActionMenuItems?.(u)||[],o.isFavorite(t)?{label:"Remove from favorites",onClick:()=>o.removeFromFavorites(t),icon:i.Z}:{label:"Add to favorites",onClick:()=>o.addToFavorites(t),icon:s.Z},{label:"Add to selection",onClick:()=>o.addToSelection([u])},...o.isSelected(u)?[{label:"Remove from selection",onClick:()=>o.removeFromSelection([u])}]:[]]},l.createElement(c.Z,null))}}}]);
//# sourceMappingURL=895.e6ab0fb5.chunk.js.map