(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[8629],{63211:(e,t,r)=>{"use strict";r.d(t,{e$:()=>p,jS:()=>d});var n=r(88196),a=r(99247),o=r(91370),i=r.n(o),s=r(43800),l=r(90872),c=r(1502);const d=(0,s.ConfigurationSchema)("BaseFeatureWidget",{});function u(e,t,r,n=0,a={}){t<=n||e.subfeatures?.map((e=>{u(e,t,r,n+1,a),r(e)}))}function p(e){return n.types.model("BaseFeatureWidget",{id:c.ElementId,type:n.types.literal("BaseFeatureWidget"),featureData:n.types.frozen(),formattedFields:n.types.frozen(),unformattedFeatureData:n.types.frozen(),view:n.types.safeReference(e.pluggableMstType("view","stateModel")),track:n.types.safeReference(e.pluggableMstType("track","stateModel")),trackId:n.types.maybe(n.types.string),trackType:n.types.maybe(n.types.string),maxDepth:n.types.maybe(n.types.number)}).volatile((()=>({error:void 0}))).actions((e=>({setFeatureData(t){e.unformattedFeatureData=t},clearFeatureData(){e.featureData=void 0},setFormattedData(t){e.featureData=t},setExtra(t,r,n){e.trackId=r,e.trackType=t,e.maxDepth=n},setError(t){e.error=t}}))).actions((e=>({afterCreate(){(0,n.addDisposer)(e,(0,a.autorun)((()=>{try{const{unformattedFeatureData:t,track:r}=e,n=(0,l.getSession)(e);if(r&&e.setExtra(r.type,r.configuration.trackId,(0,s.getConf)(r,["formatDetails","maxDepth"])),t){const a=i()(t),o=(e,t)=>({...(0,s.getConf)(n,["formatDetails",e],{feature:t}),...(0,s.getConf)(r,["formatDetails",e],{feature:t})});r&&(a.__jbrowsefmt=o("feature",a),u(a,(0,s.getConf)(r,["formatDetails","depth"]),(e=>{e.__jbrowsefmt=o("subfeatures",e)}))),e.setFormattedData(a)}}catch(t){console.error(t),e.setError(t)}})))}}))).preProcessSnapshot((e=>{const{featureData:t,finalizedFeatureData:r,...n}=e;return{unformattedFeatureData:t,featureData:r,...n}})).postProcessSnapshot((e=>{const{unformattedFeatureData:t,featureData:r,...n}=e;return{finalizedFeatureData:JSON.parse(JSON.stringify(r,((e,t)=>void 0===t?null:t))),...n}}))}},27032:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class n{install(e){}configure(e){}configurationSchema=void 0}},58827:(e,t,r)=>{"use strict";r.d(t,{Z:()=>$});var n={};r.r(n),r.d(n,{CoreFreeResources:()=>D,CoreGetFeatureDensityStats:()=>B,CoreGetFeatureDetails:()=>M,CoreGetFeatures:()=>N,CoreGetFileInfo:()=>R,CoreGetMetadata:()=>E,CoreGetRefNames:()=>k,CoreRender:()=>L});var a=r(88196),o=r(14331),i=r(31640),s=r(5889),l=r(63048),c=r(59366),d=r(25077),u=r(66511),p=r(83015),m=r(99831),g=r(49368),f=r(75444),h=r(43800),y=r(90173),b=r(66204),w=r(63211),v=r(27032),C=r(93912),S=r(56798);class k extends p.Z{name="CoreGetRefNames";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=n,{dataAdapter:i}=await(0,C.uP)(r,a,o);return(0,S.isFeatureAdapter)(i)?i.getRefNames(n):[]}}var T=r(90872),x=r(96595);function P(e,t){if(!t)throw new Error(`renderer "${e}" not found`);if(!t.ReactComponent)throw new Error(`renderer ${e} has no ReactComponent, it may not be completely implemented yet`);if(!(t instanceof x.default))throw new TypeError("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}class M extends p.Z{name="CoreGetFeatureDetails";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,T.renameRegionsIfNeeded)(n,e),o=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return P(i,this.pluginManager.getRendererType(i)).serializeArgsInClient(o)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{rendererType:n,featureId:a}=r,o=P(n,this.pluginManager.getRendererType(n));return{feature:o.sessions[(0,T.getLayoutId)(e)]?.cachedLayout.layout.getDataByID(a)?.toJSON()}}}class E extends p.Z{name="CoreGetMetadata";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=n,{dataAdapter:i}=await(0,C.uP)(r,a,o);return(0,S.isFeatureAdapter)(i)?i.getMetadata(n):null}}class R extends p.Z{name="CoreGetInfo";async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{sessionId:a,adapterConfig:o}=n,{dataAdapter:i}=await(0,C.uP)(r,a,o);return(0,S.isFeatureAdapter)(i)?i.getHeader(n):null}}var A=r(40011),I=r(9762),F=r(85291);class N extends p.Z{name="CoreGetFeatures";async deserializeReturn(e,t,r){return(await super.deserializeReturn(e,t,r)).map((e=>new F.Z(e)))}async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,T.renameRegionsIfNeeded)(n,e);return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{signal:a,sessionId:o,adapterConfig:i,regions:s,opts:l}=n,{dataAdapter:c}=await(0,C.uP)(r,o,i);if(!(0,S.isFeatureAdapter)(c))throw new Error("Adapter does not support retrieving features");const d=c.getFeaturesInMultipleRegions(s,{...l,signal:a});return(await(0,I.z)(d.pipe((0,A.q)()))).map((e=>e.toJSON()))}}class L extends p.Z{name="CoreRender";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,T.renameRegionsIfNeeded)(n,e),o=await super.serializeArguments(a,t);if("MainThreadRpcDriver"===t)return o;const{rendererType:i}=e;return P(i,this.pluginManager.getRendererType(i)).serializeArgsInClient(o)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{sessionId:n,rendererType:a,signal:o}=r;if(!n)throw new Error("must pass a unique session id");(0,T.checkAbortSignal)(o);const i=P(a,this.pluginManager.getRendererType(a)),s="MainThreadRpcDriver"===t?await i.render(r):await i.renderInWorker(r);return(0,T.checkAbortSignal)(o),s}async deserializeReturn(e,t,r){const n=await super.deserializeReturn(e,t,r);if("MainThreadRpcDriver"===r)return n;const{rendererType:a}=t;return P(a,this.pluginManager.getRendererType(a)).deserializeResultsInClient(n,t)}}class D extends p.Z{name="CoreFreeResources";async execute(e){let t=0;return t+=(0,C.Yr)(e),this.pluginManager.getRendererTypes().forEach((e=>{const r=e.freeResources();r&&(t+=r)})),t}async serializeArguments(e,t){return e}}class B extends p.Z{name="CoreGetFeatureDensityStats";async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r.session.assemblyManager,a=await(0,T.renameRegionsIfNeeded)(n,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o,regions:i}=n,{dataAdapter:s}=await(0,C.uP)(r,o,a);if(!(0,S.isFeatureAdapter)(s))throw new Error("Adapter does not support retrieving features");return s.getMultiRegionFeatureDensityStats(i,n)}}var V=r(20592);const z=(0,h.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0});class O extends v.Z{name="CorePlugin";install(e){Object.values(n).forEach((t=>{e.addRpcMethod((()=>new t(e)))})),(e=>{e.addAdapterType((()=>new V.AdapterType({name:"CytobandAdapter",configSchema:z,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(2393)]).then(r.bind(r,82393)).then((e=>e.default))})))})(e),e.addWidgetType((()=>new d.Z({name:"BaseFeatureWidget",heading:"Feature details",configSchema:w.jS,stateModel:(0,w.e$)(e),ReactComponent:(0,b.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(3180)]).then(r.bind(r,44047))))})))}}var Z=r(15485);class j{phaseCallbacks=new Map;phaseOrder=[];constructor(...e){this.phaseOrder=e}add(e,t){if(!this.phaseOrder.includes(e))throw new Error(`unknown phase ${e}`);let r=this.phaseCallbacks.get(e);r||(r=[],this.phaseCallbacks.set(e,r)),r.push(t)}run(){this.phaseOrder.forEach((e=>{this.phaseCallbacks.get(e)?.forEach((e=>e()))}))}}class W{registeredTypes={};constructor(e,t){this.typeName=e,this.baseClass=t}add(e,t){this.registeredTypes[e]=t}has(e){return e in this.registeredTypes}get(e){if(!this.has(e))throw new Error(`${this.typeName} '${e}' not found, perhaps its plugin is not loaded or its plugin has not added it.`);return this.registeredTypes[e]}all(){return Object.values(this.registeredTypes)}}class ${plugins=[];jexl=(0,Z.Z)();pluginMetadata={};runtimePluginDefinitions=[];elementCreationSchedule=new j("renderer","adapter","text search adapter","display","track","connection","view","widget","rpc method","internet account","add track workflow");rendererTypes=new W("RendererType",o.default);adapterTypes=new W("AdapterType",i.Z);textSearchAdapterTypes=new W("TextSearchAdapterType",g.Z);trackTypes=new W("TrackType",s.Z);displayTypes=new W("DisplayType",l.Z);connectionTypes=new W("ConnectionType",u.Z);viewTypes=new W("ViewType",c.Z);widgetTypes=new W("WidgetType",d.Z);rpcMethods=new W("RpcMethodType",p.Z);addTrackWidgets=new W("AddTrackWorkflow",f.Z);internetAccountTypes=new W("InternetAccountType",m.Z);configured=!1;extensionPoints=new Map;constructor(e=[]){this.addPlugin({plugin:new O,metadata:{isCore:!0}}),e.forEach((e=>{this.addPlugin(e)}))}pluginConfigurationSchemas(){const e={};return this.plugins.forEach((t=>{t.configurationSchema&&(e[t.name]=t.configurationSchema)})),e}addPlugin(e){if(this.configured)throw new Error("JBrowse already configured, cannot add plugins");const[t,r={}]="install"in e&&"configure"in e?[e,{}]:[e.plugin,e.metadata];if(this.plugins.includes(t))throw new Error("plugin already installed");return this.pluginMetadata[t.name]=r,"definition"in e&&this.runtimePluginDefinitions.push(e.definition),t.install(this),this.plugins.push(t),this}getPlugin(e){return this.plugins.find((t=>t.name===e))}hasPlugin(e){return void 0!==this.getPlugin(e)}createPluggableElements(){return this.elementCreationSchedule&&(this.elementCreationSchedule.run(),delete this.elementCreationSchedule),this}setRootModel(e){this.rootModel=e}configure(){if(this.configured)throw new Error("already configured");return this.plugins.forEach((e=>e.configure(this))),this.configured=!0,this}getElementTypeRecord(e){switch(e){case"adapter":return this.adapterTypes;case"text search adapter":return this.textSearchAdapterTypes;case"connection":return this.connectionTypes;case"widget":return this.widgetTypes;case"renderer":return this.rendererTypes;case"display":return this.displayTypes;case"track":return this.trackTypes;case"view":return this.viewTypes;case"rpc method":return this.rpcMethods;case"internet account":return this.internetAccountTypes;case"add track workflow":return this.addTrackWidgets;default:throw new Error(`invalid element type '${e}'`)}}addElementType(e,t){if("function"!=typeof t)throw new Error("must provide a callback function that returns the new type object");const r=this.getElementTypeRecord(e);return this.elementCreationSchedule?.add(e,(()=>{const n=t(this);if(!n.name)throw new Error(`cannot add a ${e} with no name`);if(r.has(n.name))throw new Error(`${e} ${n.name} already registered, cannot register it again`);r.add(n.name,this.evaluateExtensionPoint("Core-extendPluggableElement",n))})),this}getElementType(e,t){return this.getElementTypeRecord(e).get(t)}getElementTypesInGroup(e){return this.getElementTypeRecord(e).all()}getTrackElements(){return this.getElementTypesInGroup("track")}getConnectionElements(){return this.getElementTypesInGroup("connection")}getAddTrackWorkflowElements(){return this.getElementTypesInGroup("add track workflow")}getRpcElements(){return this.getElementTypesInGroup("rpc method")}getDisplayElements(){return this.getElementTypesInGroup("display")}getAdapterElements(){return this.getElementTypesInGroup("adapter")}pluggableMstType(e,t,r=a.types.maybe(a.types.null)){const n=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,a.isType)(e)&&(0,a.isModelType)(e)));return 0===n.length&&"undefined"==typeof jest?(console.warn(`No pluggable types found matching ('${e}','${t}')`),r):a.types.union(...n)}pluggableConfigSchemaType(e,t="configSchema"){const r=this.getElementTypeRecord(e).all().map((e=>e[t])).filter((e=>(0,h.isBareConfigurationSchemaType)(e)));return 0===r.length&&r.push((0,h.ConfigurationSchema)("Null",{})),a.types.union(...r)}jbrequireCache=new Map;lib=y.Z;load=e=>(this.jbrequireCache.has(e)||this.jbrequireCache.set(e,e(this)),this.jbrequireCache.get(e));jbrequire=e=>{if("string"==typeof e){const t=this.lib[e];if(!t)throw new TypeError(`No jbrequire re-export defined for package '${e}'. If this package must be shared between plugins, add it to ReExports.js. If it does not need to be shared, just import it normally.`);return t}if("function"==typeof e)return this.load(e);if(e.default)return this.jbrequire(e.default);throw new TypeError("lib passed to jbrequire must be either a string or a function")};getRendererType(e){return this.rendererTypes.get(e)}getRendererTypes(){return this.rendererTypes.all()}getAdapterType(e){return this.adapterTypes.get(e)}getTextSearchAdapterType(e){return this.textSearchAdapterTypes.get(e)}getTrackType(e){return this.trackTypes.get(e)}getDisplayType(e){return this.displayTypes.get(e)}getViewType(e){return this.viewTypes.get(e)}getAddTrackWorkflow(e){return this.addTrackWidgets.get(e)}getWidgetType(e){return this.widgetTypes.get(e)}getConnectionType(e){return this.connectionTypes.get(e)}getRpcMethodType(e){return this.rpcMethods.get(e)}getInternetAccountType(e){return this.internetAccountTypes.get(e)}addRendererType(e){return this.addElementType("renderer",e)}addAdapterType(e){return this.addElementType("adapter",e)}addTextSearchAdapterType(e){return this.addElementType("text search adapter",e)}addTrackType(e){return this.addElementType("track",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.trackType!==t.name||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addDisplayType(e){return this.addElementType("display",e)}addViewType(e){return this.addElementType("view",(()=>{const t=e(this);return this.getElementTypesInGroup("display").forEach((e=>{e.viewType!==t.name&&e.viewType!==t.extendedName||t.displayTypes.includes(e)||t.addDisplayType(e)})),t}))}addWidgetType(e){return this.addElementType("widget",e)}addConnectionType(e){return this.addElementType("connection",e)}addRpcMethod(e){return this.addElementType("rpc method",e)}addInternetAccountType(e){return this.addElementType("internet account",e)}addAddTrackWorkflowType(e){return this.addElementType("add track workflow",e)}addToExtensionPoint(e,t){let r=this.extensionPoints.get(e);r||(r=[],this.extensionPoints.set(e,r)),r.push(t)}evaluateExtensionPoint(e,t,r){const n=this.extensionPoints.get(e);let a=t;if(n)for(const e of n)try{a=e(a,r)}catch(e){console.error(e)}return a}async evaluateAsyncExtensionPoint(e,t,r){const n=this.extensionPoints.get(e);let a=t;if(n)for(const e of n)try{a=await e(a,r)}catch(e){console.error(e)}return a}}},90173:(e,t,r)=>{"use strict";r.d(t,{Z:()=>de});var n=r(66204),a=r(43188),o=r.t(a,2),i=r(42457),s=r.t(i,2),l=r(99247),c=r(88196),d=r(80846),u=r(38684),p=r(97641),m=r.n(p),g=r(73330),f=r(92368),h=r(19797),y=r(90407),b=r(6857),w=r(40010),v=r(79618),C=r(56798),S=r(31996),k=r(20592),T=r(59366),x=r(31640),P=r(63048),M=r(5889),E=r(25077),R=r(72271),A=r(96595),I=r(25216),F=r(18930),N=r(90176),L=r(14331),D=r(43800),B=r(27032),V=r(35421),z=r(90872),O=r(71472),Z=r(19618),j=r(99512),W=r(59062),$=r(84535),H=r(16979),G=r(1502);const q=["mobx","mobx-state-tree","react","react/jsx-runtime","react-dom","mobx-react","@mui/x-data-grid","@mui/material/utils","@material-ui/core/utils","tss-react/mui","@material-ui/core","@mui/material","prop-types","@mui/material/styles","@material-ui/core/styles","@material-ui/core/Accordion","@material-ui/core/AccordionActions","@material-ui/core/AccordionDetails","@material-ui/core/Alert","@material-ui/core/AlertTitle","@material-ui/core/Autocomplete","@material-ui/core/Avatar","@material-ui/core/AvatarGroup","@material-ui/core/Backdrop","@material-ui/core/Badge","@material-ui/core/Box","@material-ui/core/Breadcrumbs","@material-ui/core/Button","@material-ui/core/ButtonGroup","@material-ui/core/Card","@material-ui/core/CardActions","@material-ui/core/CardActionArea","@material-ui/core/CardContent","@material-ui/core/CardHeader","@material-ui/core/CardMedia","@material-ui/core/CircularProgress","@material-ui/core/Collapse","@material-ui/core/ClickAwayListener","@material-ui/core/Chip","@material-ui/core/Checkbox","@material-ui/core/Container","@material-ui/core/Dialog","@material-ui/core/DialogActions","@material-ui/core/DialogTitle","@material-ui/core/DialogContent","@material-ui/core/DialogContentText","@material-ui/core/Divider","@material-ui/core/Drawer","@material-ui/core/Fab","@material-ui/core/Fade","@material-ui/core/FilledInput","@material-ui/core/FormLabel","@material-ui/core/FormControl","@material-ui/core/FormControlLabel","@material-ui/core/FormHelperText","@material-ui/core/FormGroup","@material-ui/core/Grid","@material-ui/core/Grow","@material-ui/core/Icon","@material-ui/core/IconButton","@material-ui/core/Input","@material-ui/core/InputBase","@material-ui/core/InputLabel","@material-ui/core/InputAdornment","@material-ui/core/Link","@material-ui/core/LinearProgress","@material-ui/core/List","@material-ui/core/ListItem","@material-ui/core/ListItemAvatar","@material-ui/core/ListItemSecondaryAction","@material-ui/core/ListItemIcon","@material-ui/core/ListSubheader","@material-ui/core/ListItemText","@material-ui/core/Menu","@material-ui/core/MenuItem","@material-ui/core/MenuList","@material-ui/core/Modal","@material-ui/core/NativeSelect","@material-ui/core/OutlinedInput","@material-ui/core/Pagination","@material-ui/core/PaginationItem","@material-ui/core/Paper","@material-ui/core/Popover","@material-ui/core/Popper","@material-ui/core/Portal","@material-ui/core/Radio","@material-ui/core/RadioGroup","@material-ui/core/Rating","@material-ui/core/ScopedCssBaseline","@material-ui/core/Select","@material-ui/core/Skeleton","@material-ui/core/Slider","@material-ui/core/Snackbar","@material-ui/core/SnackbarContent","@material-ui/core/SpeedDial","@material-ui/core/SpeedDialAction","@material-ui/core/SpeedDialIcon","@material-ui/core/Stack","@material-ui/core/Step","@material-ui/core/StepButton","@material-ui/core/StepConnector","@material-ui/core/StepLabel","@material-ui/core/StepIcon","@material-ui/core/Stepper","@material-ui/core/SvgIcon","@material-ui/core/Switch","@material-ui/core/Tab","@material-ui/core/Table","@material-ui/core/TableBody","@material-ui/core/TableCell","@material-ui/core/TableContainer","@material-ui/core/TableFooter","@material-ui/core/TableHead","@material-ui/core/TablePagination","@material-ui/core/TableRow","@material-ui/core/TableSortLabel","@material-ui/core/Tabs","@material-ui/core/TextField","@material-ui/core/TextareaAutosize","@material-ui/core/ToggleButton","@material-ui/core/ToggleButtonGroup","@material-ui/core/Toolbar","@material-ui/core/Tooltip","@material-ui/core/Typography","@mui/material/Accordion","@mui/material/AccordionActions","@mui/material/AccordionDetails","@mui/material/Alert","@mui/material/AlertTitle","@mui/material/Autocomplete","@mui/material/Avatar","@mui/material/AvatarGroup","@mui/material/Backdrop","@mui/material/Badge","@mui/material/Box","@mui/material/Breadcrumbs","@mui/material/Button","@mui/material/ButtonGroup","@mui/material/Card","@mui/material/CardActions","@mui/material/CardActionArea","@mui/material/CardContent","@mui/material/CardHeader","@mui/material/CardMedia","@mui/material/CircularProgress","@mui/material/Collapse","@mui/material/ClickAwayListener","@mui/material/Chip","@mui/material/Checkbox","@mui/material/Container","@mui/material/Dialog","@mui/material/DialogActions","@mui/material/DialogTitle","@mui/material/DialogContent","@mui/material/DialogContentText","@mui/material/Divider","@mui/material/Drawer","@mui/material/Fab","@mui/material/Fade","@mui/material/FilledInput","@mui/material/FormLabel","@mui/material/FormControl","@mui/material/FormControlLabel","@mui/material/FormHelperText","@mui/material/FormGroup","@mui/material/Grid","@mui/material/Grow","@mui/material/Icon","@mui/material/IconButton","@mui/material/Input","@mui/material/InputBase","@mui/material/InputLabel","@mui/material/InputAdornment","@mui/material/Link","@mui/material/LinearProgress","@mui/material/List","@mui/material/ListItem","@mui/material/ListItemAvatar","@mui/material/ListItemSecondaryAction","@mui/material/ListItemIcon","@mui/material/ListSubheader","@mui/material/ListItemText","@mui/material/Menu","@mui/material/MenuItem","@mui/material/MenuList","@mui/material/Modal","@mui/material/NativeSelect","@mui/material/OutlinedInput","@mui/material/Pagination","@mui/material/PaginationItem","@mui/material/Paper","@mui/material/Popover","@mui/material/Popper","@mui/material/Portal","@mui/material/Radio","@mui/material/RadioGroup","@mui/material/Rating","@mui/material/ScopedCssBaseline","@mui/material/Select","@mui/material/Skeleton","@mui/material/Slider","@mui/material/Snackbar","@mui/material/SnackbarContent","@mui/material/SpeedDial","@mui/material/SpeedDialAction","@mui/material/SpeedDialIcon","@mui/material/Stack","@mui/material/Step","@mui/material/StepButton","@mui/material/StepConnector","@mui/material/StepLabel","@mui/material/StepIcon","@mui/material/Stepper","@mui/material/SvgIcon","@mui/material/Switch","@mui/material/Tab","@mui/material/Table","@mui/material/TableBody","@mui/material/TableCell","@mui/material/TableContainer","@mui/material/TableFooter","@mui/material/TableHead","@mui/material/TablePagination","@mui/material/TableRow","@mui/material/TableSortLabel","@mui/material/Tabs","@mui/material/TextField","@mui/material/TextareaAutosize","@mui/material/ToggleButton","@mui/material/ToggleButtonGroup","@mui/material/Toolbar","@mui/material/Tooltip","@mui/material/Typography","@material-ui/lab/ToggleButton","@material-ui/lab/ToggleButtonGroup","@material-ui/lab/Autocomplete","@material-ui/lab/Alert","@material-ui/lab","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"];function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U.apply(this,arguments)}const _={Accordion:(0,n.lazy)((()=>r.e(1186).then(r.bind(r,61186)))),AccordionActions:(0,n.lazy)((()=>r.e(3318).then(r.bind(r,93318)))),AccordionDetails:(0,n.lazy)((()=>r.e(7977).then(r.bind(r,67977)))),Alert:(0,n.lazy)((()=>r.e(4415).then(r.bind(r,74415)))),AlertTitle:(0,n.lazy)((()=>r.e(8585).then(r.bind(r,48585)))),Autocomplete:(0,n.lazy)((()=>r.e(4866).then(r.bind(r,44866)))),Avatar:(0,n.lazy)((()=>r.e(2428).then(r.bind(r,42428)))),AvatarGroup:(0,n.lazy)((()=>r.e(7884).then(r.bind(r,67884)))),Backdrop:(0,n.lazy)((()=>r.e(5875).then(r.bind(r,25875)))),Badge:(0,n.lazy)((()=>r.e(405).then(r.bind(r,80405)))),Box:(0,n.lazy)((()=>r.e(2016).then(r.bind(r,52016)))),Breadcrumbs:(0,n.lazy)((()=>r.e(5200).then(r.bind(r,55200)))),Button:(0,n.lazy)((()=>r.e(3899).then(r.bind(r,13899)))),ButtonGroup:(0,n.lazy)((()=>r.e(6317).then(r.bind(r,46317)))),Card:(0,n.lazy)((()=>r.e(5446).then(r.bind(r,5446)))),CardActions:(0,n.lazy)((()=>r.e(9879).then(r.bind(r,39879)))),CardActionArea:(0,n.lazy)((()=>r.e(6585).then(r.bind(r,36585)))),CardContent:(0,n.lazy)((()=>r.e(12).then(r.bind(r,70012)))),CardHeader:(0,n.lazy)((()=>r.e(5224).then(r.bind(r,45224)))),CardMedia:(0,n.lazy)((()=>r.e(6466).then(r.bind(r,26466)))),CircularProgress:(0,n.lazy)((()=>r.e(9517).then(r.bind(r,89517)))),Collapse:(0,n.lazy)((()=>r.e(5638).then(r.bind(r,45638)))),ClickAwayListener:(0,n.lazy)((()=>r.e(7054).then(r.bind(r,57054)))),Chip:(0,n.lazy)((()=>r.e(5820).then(r.bind(r,5820)))),Checkbox:(0,n.lazy)((()=>r.e(4779).then(r.bind(r,34779)))),Container:(0,n.lazy)((()=>r.e(471).then(r.bind(r,471)))),Dialog:(0,n.lazy)((()=>r.e(3061).then(r.bind(r,73061)))),DialogActions:(0,n.lazy)((()=>r.e(2960).then(r.bind(r,12960)))),DialogTitle:(0,n.lazy)((()=>r.e(3257).then(r.bind(r,93257)))),DialogContent:(0,n.lazy)((()=>r.e(1032).then(r.bind(r,61032)))),DialogContentText:(0,n.lazy)((()=>r.e(5118).then(r.bind(r,5118)))),Divider:(0,n.lazy)((()=>r.e(8401).then(r.bind(r,98401)))),Drawer:(0,n.lazy)((()=>r.e(7657).then(r.bind(r,77657)))),Fab:(0,n.lazy)((()=>r.e(3790).then(r.bind(r,53790)))),Fade:(0,n.lazy)((()=>r.e(7314).then(r.bind(r,37314)))),FilledInput:(0,n.lazy)((()=>r.e(242).then(r.bind(r,10242)))),FormLabel:(0,n.lazy)((()=>r.e(8517).then(r.bind(r,98517)))),FormControl:(0,n.lazy)((()=>r.e(3085).then(r.bind(r,63085)))),FormControlLabel:(0,n.lazy)((()=>r.e(7505).then(r.bind(r,27505)))),FormHelperText:(0,n.lazy)((()=>r.e(441).then(r.bind(r,50441)))),FormGroup:(0,n.lazy)((()=>r.e(4888).then(r.bind(r,14888)))),Grid:(0,n.lazy)((()=>r.e(3932).then(r.bind(r,83932)))),Grow:(0,n.lazy)((()=>r.e(9943).then(r.bind(r,49943)))),Icon:(0,n.lazy)((()=>r.e(4681).then(r.bind(r,74681)))),IconButton:(0,n.lazy)((()=>r.e(2545).then(r.bind(r,52545)))),Input:(0,n.lazy)((()=>r.e(6629).then(r.bind(r,26629)))),InputBase:(0,n.lazy)((()=>r.e(9807).then(r.bind(r,9807)))),InputLabel:(0,n.lazy)((()=>r.e(7097).then(r.bind(r,97097)))),InputAdornment:(0,n.lazy)((()=>r.e(1099).then(r.bind(r,71099)))),Link:(0,n.lazy)((()=>r.e(5052).then(r.bind(r,65052)))),LinearProgress:(0,n.lazy)((()=>r.e(3787).then(r.bind(r,63787)))),List:(0,n.lazy)((()=>r.e(5795).then(r.bind(r,15795)))),ListItem:(0,n.lazy)((()=>r.e(5322).then(r.bind(r,75322)))),ListItemAvatar:(0,n.lazy)((()=>r.e(2171).then(r.bind(r,42171)))),ListItemSecondaryAction:(0,n.lazy)((()=>r.e(6377).then(r.bind(r,66377)))),ListItemIcon:(0,n.lazy)((()=>r.e(6451).then(r.bind(r,26451)))),ListSubheader:(0,n.lazy)((()=>r.e(5385).then(r.bind(r,85385)))),ListItemText:(0,n.lazy)((()=>r.e(6758).then(r.bind(r,56758)))),Menu:(0,n.lazy)((()=>r.e(5212).then(r.bind(r,85212)))),MenuItem:(0,n.lazy)((()=>r.e(7928).then(r.bind(r,77928)))),MenuList:(0,n.lazy)((()=>r.e(4511).then(r.bind(r,24511)))),Modal:(0,n.lazy)((()=>r.e(8976).then(r.bind(r,88976)))),NativeSelect:(0,n.lazy)((()=>r.e(8311).then(r.bind(r,98311)))),OutlinedInput:(0,n.lazy)((()=>r.e(3871).then(r.bind(r,53871)))),Pagination:(0,n.lazy)((()=>r.e(4446).then(r.bind(r,34446)))),PaginationItem:(0,n.lazy)((()=>r.e(6880).then(r.bind(r,46880)))),Paper:(0,n.lazy)((()=>r.e(4646).then(r.bind(r,63155)))),Popover:(0,n.lazy)((()=>r.e(7827).then(r.bind(r,97827)))),Popper:(0,n.lazy)((()=>r.e(333).then(r.bind(r,40333)))),Portal:(0,n.lazy)((()=>r.e(3419).then(r.bind(r,13419)))),Radio:(0,n.lazy)((()=>r.e(9793).then(r.bind(r,99793)))),RadioGroup:(0,n.lazy)((()=>r.e(8591).then(r.bind(r,88591)))),Rating:(0,n.lazy)((()=>r.e(1880).then(r.bind(r,31880)))),ScopedCssBaseline:(0,n.lazy)((()=>r.e(5963).then(r.bind(r,15963)))),Select:(0,n.lazy)((()=>r.e(2363).then(r.bind(r,12363)))),Skeleton:(0,n.lazy)((()=>r.e(5547).then(r.bind(r,65547)))),Slider:(0,n.lazy)((()=>r.e(3821).then(r.bind(r,83821)))),Snackbar:(0,n.lazy)((()=>Promise.all([r.e(2264),r.e(7486)]).then(r.bind(r,87486)))),SnackbarContent:(0,n.lazy)((()=>r.e(4974).then(r.bind(r,4974)))),SpeedDial:(0,n.lazy)((()=>r.e(6440).then(r.bind(r,96440)))),SpeedDialAction:(0,n.lazy)((()=>r.e(1567).then(r.bind(r,11567)))),SpeedDialIcon:(0,n.lazy)((()=>r.e(4034).then(r.bind(r,34034)))),Stack:(0,n.lazy)((()=>r.e(7415).then(r.bind(r,57415)))),Step:(0,n.lazy)((()=>r.e(3054).then(r.bind(r,73054)))),StepButton:(0,n.lazy)((()=>r.e(9065).then(r.bind(r,69065)))),StepConnector:(0,n.lazy)((()=>r.e(180).then(r.bind(r,180)))),StepLabel:(0,n.lazy)((()=>r.e(6279).then(r.bind(r,86279)))),StepIcon:(0,n.lazy)((()=>r.e(8554).then(r.bind(r,68554)))),Stepper:(0,n.lazy)((()=>r.e(3922).then(r.bind(r,63922)))),SvgIcon:(0,n.lazy)((()=>r.e(424).then(r.bind(r,81099)))),Switch:(0,n.lazy)((()=>r.e(1143).then(r.bind(r,31143)))),Tab:(0,n.lazy)((()=>r.e(7811).then(r.bind(r,97811)))),Table:(0,n.lazy)((()=>r.e(5897).then(r.bind(r,5897)))),TableBody:(0,n.lazy)((()=>r.e(6315).then(r.bind(r,86315)))),TableCell:(0,n.lazy)((()=>r.e(5759).then(r.bind(r,45759)))),TableContainer:(0,n.lazy)((()=>r.e(4014).then(r.bind(r,44014)))),TableFooter:(0,n.lazy)((()=>r.e(1081).then(r.bind(r,61081)))),TableHead:(0,n.lazy)((()=>r.e(1025).then(r.bind(r,91025)))),TablePagination:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(4144)]).then(r.bind(r,72198)))),TableRow:(0,n.lazy)((()=>r.e(1853).then(r.bind(r,81853)))),TableSortLabel:(0,n.lazy)((()=>r.e(4399).then(r.bind(r,74399)))),Tabs:(0,n.lazy)((()=>r.e(8600).then(r.bind(r,48600)))),TextField:(0,n.lazy)((()=>r.e(8053).then(r.bind(r,28053)))),TextareaAutosize:(0,n.lazy)((()=>r.e(7349).then(r.bind(r,87349)))),ToggleButton:(0,n.lazy)((()=>r.e(8364).then(r.bind(r,78364)))),ToggleButtonGroup:(0,n.lazy)((()=>r.e(317).then(r.bind(r,40317)))),Toolbar:(0,n.lazy)((()=>r.e(2763).then(r.bind(r,92763)))),Tooltip:(0,n.lazy)((()=>r.e(7387).then(r.bind(r,17387)))),Typography:(0,n.lazy)((()=>r.e(7782).then(r.bind(r,87782))))},J=Object.fromEntries(Object.entries(_).map((([e,t])=>{const r=n.forwardRef(((e,r)=>n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(t,U({},e,{ref:r})))));return r.displayName=e,[e,r]}))),X=Object.fromEntries(Object.entries(J).map((([e,t])=>["@material-ui/core/"+e,t]))),Y=Object.fromEntries(Object.entries(J).map((([e,t])=>["@mui/material/"+e,t]))),K=(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(5961)]).then(r.bind(r,14128)))),Q=(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(4484)]).then(r.bind(r,80853)))),ee=(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(3130)]).then(r.bind(r,58542)))),te={DataGrid:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.DataGrid}))))),GridActionsCellItem:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridActionsCellItem}))))),GridAddIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridAddIcon}))))),GridArrowDownwardIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridArrowDownwardIcon}))))),GridArrowUpwardIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridArrowUpwardIcon}))))),GridCellCheckboxForwardRef:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridCellCheckboxForwardRef}))))),GridCellCheckboxRenderer:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridCellCheckboxRenderer}))))),GridCheckCircleIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridCheckCircleIcon}))))),GridCheckIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridCheckIcon}))))),GridCloseIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridCloseIcon}))))),GridColumnHeaderSeparator:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridColumnHeaderSeparator}))))),GridColumnHeaderSortIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridColumnHeaderSortIcon}))))),GridColumnIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridColumnIcon}))))),GridColumnMenu:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridColumnMenu}))))),GridColumnMenuContainer:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridColumnMenuContainer}))))),GridDragIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridDragIcon}))))),GridExpandMoreIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridExpandMoreIcon}))))),GridFilterAltIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFilterAltIcon}))))),GridFilterForm:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFilterForm}))))),GridFilterListIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFilterListIcon}))))),GridFilterPanel:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFilterPanel}))))),GridFooter:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFooter}))))),GridFooterContainer:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridFooterContainer}))))),GridHeader:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridHeader}))))),GridHeaderCheckbox:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridHeaderCheckbox}))))),GridKeyboardArrowRight:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridKeyboardArrowRight}))))),GridLoadIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridLoadIcon}))))),GridLoadingOverlay:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridLoadingOverlay}))))),GridMenuIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridMenuIcon}))))),GridMoreVertIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridMoreVertIcon}))))),GridNoRowsOverlay:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridNoRowsOverlay}))))),GridOverlay:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridOverlay}))))),GridPagination:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridPagination}))))),GridPanel:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridPanel}))))),GridPanelWrapper:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridPanelWrapper}))))),GridPreferencesPanel:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridPreferencesPanel}))))),GridRemoveIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridRemoveIcon}))))),GridRoot:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridRoot}))))),GridRowCount:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridRowCount}))))),GridSaveAltIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridSaveAltIcon}))))),GridSearchIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridSearchIcon}))))),GridSelectedRowCount:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridSelectedRowCount}))))),GridSeparatorIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridSeparatorIcon}))))),GridTableRowsIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridTableRowsIcon}))))),GridToolbar:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbar}))))),GridToolbarColumnsButton:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarColumnsButton}))))),GridToolbarContainer:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarContainer}))))),GridToolbarDensitySelector:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarDensitySelector}))))),GridToolbarExport:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarExport}))))),GridToolbarExportContainer:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarExportContainer}))))),GridToolbarFilterButton:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridToolbarFilterButton}))))),GridTripleDotsVerticalIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridTripleDotsVerticalIcon}))))),GridViewHeadlineIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridViewHeadlineIcon}))))),GridViewStreamIcon:(0,n.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(7344)]).then(r.bind(r,11497)).then((e=>({default:e.GridViewStreamIcon})))))},re=Object.fromEntries(Object.entries(te).map((([e,t])=>{const r=n.forwardRef(((e,r)=>n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(t,U({},e,{ref:r})))));return r.displayName=e,[e,r]}))),ne=n.forwardRef(((e,t)=>n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(K,U({},e,{ref:t})))));ne.displayName="Attributes";const ae=n.forwardRef(((e,t)=>n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(Q,U({},e,{ref:t})))));ae.displayName="FeatureDetails";const oe=n.forwardRef(((e,t)=>n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(ee,U({},e,{ref:t})))));oe.displayName="BaseCard";const ie={mobx:l,"mobx-state-tree":c,react:n,"react/jsx-runtime":o,"react-dom":s,"mobx-react":d,"@mui/x-data-grid":{useGridApiContext:b.l,useGridApiRef:w.A,useGridRootProps:v.B,...re},"@mui/material/utils":y,"@material-ui/core/utils":y,"tss-react/mui":{makeStyles:u.ZL},"@material-ui/core":{...J,useTheme:f.Z,alpha:g.Fq,makeStyles:e=>{const t=(0,u.ZL)()(e);return()=>t().classes}},"@mui/material":{...J,alpha:g.Fq,useTheme:f.Z},"prop-types":m(),"@mui/material/styles":h,"@material-ui/core/styles":h,...X,...Y,"@material-ui/lab/ToggleButton":_.ToggleButton,"@material-ui/lab/ToggleButtonGroup":_.ToggleButtonGroup,"@material-ui/lab/Autocomplete":_.Autocomplete,"@material-ui/lab/Alert":_.Alert,"@material-ui/lab":{Alert:_.Alert,Autocomplete:_.Autocomplete,ToggleButton:_.ToggleButton,ToggleButtonGroup:_.ToggleButtonGroup},"@jbrowse/core/Plugin":B.Z,"@jbrowse/core/pluggableElementTypes":k,"@jbrowse/core/pluggableElementTypes/ViewType":T.Z,"@jbrowse/core/pluggableElementTypes/AdapterType":x.Z,"@jbrowse/core/pluggableElementTypes/DisplayType":P.Z,"@jbrowse/core/pluggableElementTypes/TrackType":M.Z,"@jbrowse/core/pluggableElementTypes/WidgetType":E.Z,"@jbrowse/core/pluggableElementTypes/models":R,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":A,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":I.Z,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":F,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":N,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":L,"@jbrowse/core/configuration":D,"@jbrowse/core/util/types/mst":G,"@jbrowse/core/ui":V,"@jbrowse/core/util":z,"@jbrowse/core/util/color":O,"@jbrowse/core/util/layouts":Z,"@jbrowse/core/util/tracks":j,"@jbrowse/core/util/Base1DViewModel":S.Z,"@jbrowse/core/util/io":W,"@jbrowse/core/util/mst-reflection":$,"@jbrowse/core/util/rxjs":H,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":{Attributes:ne,FeatureDetails:ae,BaseCard:oe},"@jbrowse/core/data_adapters/BaseAdapter":C},se=Object.keys(ie),le=se.filter((e=>!q.includes(e)));if(le.length>0)throw new Error(`The following modules are in the modules libs, but not the re-exports list: ${le.join(", ")}`);const ce=q.filter((e=>!se.includes(e)));if(ce.length)throw new Error(`The following modules are in the re-exports list, but not the modules libs: ${ce.join(", ")}`);const de=ie},45728:(e,t,r)=>{"use strict";r.d(t,{R:()=>a,Z:()=>n});class n{constructor(e){this.label=e.label,this.locString=e.locString,this.renderingComponent=e.renderingComponent,this.displayString=e.displayString,this.matchedAttribute=e.matchedAttribute,this.matchedObject=e.matchedObject,this.textSearchAdapter=e.textSearchAdapter,this.relevance=e.relevance,this.trackId=e.trackId,this.score=e.score||1,this.results=e.results||[]}getLabel(){return this.label}getDisplayString(){return this.displayString||this.label}getRenderingComponent(){return this.renderingComponent}getTrackId(){return this.trackId}getScore(){return this.score}updateScore(e){return this.score=e,this.score}getId(){return`${this.getLabel()}-${this.getLocation()}-${this.getTrackId()}`}hasLocation(){return!!this.locString}getLocation(){return this.locString}getComboResults(){return this.results}}class a extends n{constructor(e){super(e),this.refName=e.refName??""}getLocation(){return this.refName}}},98796:(e,t,r)=>{"use strict";r.d(t,{B:()=>h,c:()=>f});var n=r(88196),a=r(1502),o=r(88826),i=r(90872);const s={stringArray:n.types.array(n.types.string),stringArrayMap:n.types.map(n.types.array(n.types.string)),numberMap:n.types.map(n.types.number),boolean:n.types.boolean,color:n.types.refinement("Color",n.types.string,(function(){return!0})),integer:n.types.integer,number:n.types.number,string:n.types.string,text:n.types.string,fileLocation:a.FileLocation,frozen:n.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},c=e=>({views:{get valueJSON(){return e.value}}}),d=e=>({views:{get valueJSON(){return JSON.stringify(e.value)}}}),u={fileLocation:d,number:c,integer:c,boolean:c,frozen:d,stringArray:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t){e.value.push(t)},removeAtIndex(t){e.value.splice(t,1)},setAtIndex(t,r){e.value[t]=r}}}),stringArrayMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,r){e.value.set(t,r)},remove(t){e.value.delete(t)},addToKey(t,r){const n=e.value.get(t);if(!n)throw new Error(`${t} not found`);n.push(r)},removeAtKeyIndex(t,r){const n=e.value.get(t);if(!n)throw new Error(`${t} not found`);n.splice(r,1)},setAtKeyIndex(t,r,n){const a=e.value.get(t);if(!a)throw new Error(`${t} not found`);a[r]=n}}}),numberMap:e=>({views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add(t,r){e.value.set(t,r)},remove(t){e.value.delete(t)}}})},p=n.types.refinement("JexlString",n.types.string,(e=>e.startsWith("jexl:")));var m=r(5074);function g(e){return Array.isArray(e)&&0===e.length}function f(e,t,r){const{schemaDefinition:c,options:d}=function(e,t,r={}){if("string"!=typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");let n=t,a=r;return r.baseConfiguration?.jbrowseSchemaDefinition&&(n={...r.baseConfiguration.jbrowseSchemaDefinition,...n},a={...r.baseConfiguration.jbrowseSchemaOptions,...r},delete a.baseConfiguration),{schemaDefinition:n,options:a}}(e,t,r),f=function(e,t,r){const c={};let d;if(r.explicitlyTyped&&(c.type=n.types.optional(n.types.literal(e),e)),r.explicitIdentifier&&r.implicitIdentifier)throw new Error(`Cannot have both explicit and implicit identifiers in ${e}`);r.explicitIdentifier?"string"==typeof r.explicitIdentifier?(c[r.explicitIdentifier]=n.types.identifier,d=r.explicitIdentifier):(c.id=n.types.identifier,d="id"):r.implicitIdentifier&&("string"==typeof r.implicitIdentifier?(c[r.implicitIdentifier]=a.ElementId,d=r.implicitIdentifier):(c.id=a.ElementId,d="id"));const f={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:r}};Object.entries(t).forEach((([t,r])=>{if((0,n.isType)(r)&&(0,n.isLateType)(r)||(0,m.qN)(r))c[t]=r;else if("string"==typeof r||"number"==typeof r)f[t]=r;else{if("object"!=typeof r)throw new Error(`invalid configuration schema definition, "${t}" must be either a valid configuration slot definition, a constant, or a nested configuration schema`);if(!r.type)throw new Error(`no type set for config slot ${e}.${t}`);try{c[t]=function(e,{description:t="",model:r,type:a,defaultValue:c,contextVariable:d=[]}){if(!a)throw new Error("type name required");if(r||(r=s[a]),!r)throw new Error(`no builtin config slot type "${a}", and no 'model' param provided`);if(void 0===c)throw new Error("no 'defaultValue' provided");const m=`${e.charAt(0).toUpperCase()}${e.slice(1)}ConfigSlot`;let g=n.types.model(m,{name:n.types.literal(e),description:n.types.literal(t),type:n.types.literal(a),value:n.types.optional(n.types.union(p,r),c)}).volatile((()=>({contextVariable:d}))).views((e=>({get isCallback(){return String(e.value).startsWith("jexl:")}}))).views((e=>({get expr(){if(e.isCallback){const{pluginManager:t}=(0,i.getEnv)(e);return t||"undefined"!=typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,o.P)(String(e.value),t?.jexl)}return{evalSync:()=>e.value}},get valueJSON(){var t;if(!e.isCallback)return t=e.value,t?.toJSON?t.toJSON():`"${t}"`}}))).preProcessSnapshot((r=>"object"==typeof r&&r.name===e?r:{name:e,description:t,type:a,value:r})).postProcessSnapshot((e=>"object"==typeof e.value?JSON.stringify(e.value)!==JSON.stringify(c)?e.value:void 0:e.value!==c?e.value:void 0)).actions((e=>({set(t){e.value=t},reset(){e.value=c},convertToCallback(){e.isCallback||(e.value=`jexl:${e.valueJSON||"''"}`)},convertToValue(){if(e.isCallback){try{const t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(e){}if(e.value=c,e.isCallback){if(!(a in l))throw new Error(`no fallbackDefault defined for type ${a}`);e.value=l[a]}}}})));u[a]&&(g=g.extend(u[a]));const f=n.types.optional(g,{name:e,type:a,description:t,value:c});return Object.defineProperty(f,"isJBrowseConfigurationSlot",{value:!0}),f}(t,r)}catch(r){throw new Error(`invalid config slot definition for ${e}.${t}: ${r}`)}}}));let h=n.types.model(`${e}ConfigurationSchema`,c).actions((e=>({setSubschema(t,r){if(!(0,m.qN)(c[t]))throw new Error(`${t} is not a subschema, cannot replace`);const a=(0,n.isStateTreeNode)(r)?r:c[t].create(r);return e[t]=a,a}})));Object.keys(f).length&&(h=h.volatile((()=>f))),r.actions&&(h=h.actions(r.actions)),r.views&&(h=h.views(r.views)),r.extend&&(h=h.extend(r.extend));const y=d?{[d]:"placeholderId"}:{},b=r.explicitlyTyped?{type:e,...y}:y,w=(0,n.getSnapshot)(h.create(b));return h=h.postProcessSnapshot((e=>{const t={};let r=!0;for(const[a,o]of Object.entries(e))r&&("object"==typeof w[a]&&"object"==typeof o?JSON.stringify(w[a])!==JSON.stringify(o)&&(r=!1):w[a]!==o&&(r=!1)),void 0!==o&&void 0===f[a]&&("object"!=typeof(n=o)||Array.isArray(n)||null===n||0!==Object.keys(n).length)&&!g(o)&&(t[a]=o);var n;return r?{}:t})),r.preProcessSnapshot&&(h=h.preProcessSnapshot(r.preProcessSnapshot)),n.types.optional(h,b)}(e,c,d);return f.isJBrowseConfigurationSchema=!0,f.jbrowseSchemaDefinition=c,f.jbrowseSchemaOptions=d,f}function h(e){return n.types.union(n.types.reference(e),e)}},5074:(e,t,r)=>{"use strict";r.d(t,{G:()=>s,Pb:()=>l,bc:()=>i,mu:()=>u,pS:()=>o,qN:()=>c,yt:()=>d});var n=r(88196),a=r(84535);function o(e,t,r={}){if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,n.getSnapshot)(e)));if("string"==typeof t){let a=e[t];if(!a&&(0,n.isStateTreeNode)(e)&&(0,n.isMapType)((0,n.getType)(e))&&(a=e.get(t)),!a)return;if(a.expr){const e=a.expr.evalSync(r);return(0,n.isStateTreeNode)(e)?JSON.parse(JSON.stringify((0,n.getSnapshot)(e))):e}return(0,n.isStateTreeNode)(a)?JSON.parse(JSON.stringify((0,n.getSnapshot)(a))):a}if(Array.isArray(t)){const a=t[0];if(t.length>1){const i=t.slice(1);let s=e[a];return!s&&(0,n.isStateTreeNode)(e)&&(0,n.isMapType)((0,n.getType)(e))&&(s=e.get(a)),s?o(s,i,r):void 0}return o(e,a,r)}throw new TypeError("slotPath must be a string or array")}function i(e,t,r){if(!e)throw new TypeError("must provide a model object");const{configuration:n}=e;if(d(n))return o(n,t,r);throw new TypeError("cannot getConf on this model, it has no configuration")}function s(e){if((0,n.isType)(e)&&(e=(0,a.resolveLateType)(e),(0,n.isUnionType)(e))){const t=[];return(0,a.getUnionSubTypes)(e).forEach((e=>{let r=s(e=(0,a.resolveLateType)(e));if(r.length||(r=[(0,a.getDefaultValue)(e).type]),!r[0])throw new Error(`invalid config schema type ${e}`);t.push(...r)})),t}return[]}function l(e){if((0,n.isType)(e)){if((0,n.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,n.isLateType)(e))return!0}return!1}function c(e){return!!(0,n.isType)(e)&&(!!l(e)||((0,n.isUnionType)(e)?(0,a.getUnionSubTypes)(e).every((e=>c(e)||"undefined"===e.name)):!(!(0,n.isOptionalType)(e)||!c((0,a.getSubType)(e)))||!(!(0,n.isArrayType)(e)||!c((0,a.getSubType)(e)))||!(!(0,n.isMapType)(e)||!c((0,a.getSubType)(e)))))}function d(e){return(0,n.isStateTreeNode)(e)&&c((0,n.getType)(e))}function u(e){return"object"==typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},56798:(e,t,r)=>{"use strict";function n(e){return"getRegions"in e&&"getFeatures"in e}function a(e){return"getRegions"in e}function o(e){return"getFeatures"in e}function i(e){return"getRefNameAliases"in e}function s(e){return"searchIndex"in e}r.r(t),r.d(t,{BaseAdapter:()=>p,BaseFeatureDataAdapter:()=>w,BaseSequenceAdapter:()=>v,isFeatureAdapter:()=>o,isRefNameAliasAdapter:()=>i,isRegionsAdapter:()=>a,isSequenceAdapter:()=>n,isTextSearchAdapter:()=>s});var l=r(88196),c=r(43800),d=r(6416);const u=(0,c.ConfigurationSchema)("empty",{});class p{static capabilities=[];constructor(e=u.create(),t,r){if(this.config=e,this.getSubAdapter=t,this.pluginManager=r,"undefined"==typeof jest){const t=(0,l.isStateTreeNode)(e)?(0,l.getSnapshot)(e):e;this.id=`${(0,d.Z)(t)}`}else this.id="test"}getConf(e){return(0,c.readConfObject)(this.config,e)}}var m=r(46412),g=r(9762),f=r(40011),h=r(16979),y=r(90872),b=r(81025);class w extends p{async getHeader(e){return null}async getMetadata(e){return null}getFeaturesInRegion(e,t={}){return(0,h.ObservableCreate)((async r=>{const n=await this.hasDataForRefName(e.refName,t);(0,y.checkAbortSignal)(t.signal),n?this.getFeatures(e,t).subscribe(r):r.complete()}))}getFeaturesInMultipleRegions(e,t={}){return(0,m.T)(...e.map((e=>this.getFeaturesInRegion(e,t))))}async hasDataForRefName(e,t={}){return(await this.getRefNames(t)).includes(e)}async getRegionQuantitativeStats(e,t){const r=this.getFeatures(e,t);return(0,b.fK)(e,r)}async getMultiRegionQuantitativeStats(e=[],t){if(!e.length)return(0,b.fY)();const r=await Promise.all(e.map((e=>this.getRegionQuantitativeStats(e,t)))),n=(0,y.max)(r.map((e=>e.scoreMax))),a=(0,y.min)(r.map((e=>e.scoreMin))),o=(0,y.sum)(r.map((e=>e.scoreSum))),i=(0,y.sum)(r.map((e=>e.scoreSumSquares))),s=(0,y.sum)(r.map((e=>e.featureCount))),l=(0,y.sum)(r.map((e=>e.basesCovered)));return(0,b.I9)({scoreMin:a,scoreMax:n,featureCount:s,basesCovered:l,scoreSumSquares:i,scoreSum:o})}getRegionFeatureDensityStats(e,t){let r=+Date.now();const n=async(r,n)=>{const{start:o,end:i}=e,s=.75*o+.25*i,l=await(0,g.z)(this.getFeatures({...e,start:Math.max(0,Math.round(s-r/2)),end:Math.min(Math.round(s+r/2),i)},t).pipe((0,f.q)()));return a(r,{featureDensity:l.length/r},l.length,n)},a=async(t,a,o,i)=>{const s=e.end-e.start;if(o>=70||2*t>s)return a;if(i<=5e3){const e=+Date.now();return i+=e-r,r=e,n(2*t,i)}return console.warn("Stats estimation reached timeout, or didn't get enough features"),{featureDensity:Number.POSITIVE_INFINITY}};return n(1e3,0)}async getMultiRegionFeatureDensityStats(e,t){if(!e.length)throw new Error("No regions supplied");return this.getRegionFeatureDensityStats(e[0],t)}}class v extends w{async getMultiRegionFeatureDensityStats(){return{featureDensity:0}}}},93912:(e,t,r)=>{"use strict";r.d(t,{Yr:()=>i,uP:()=>o});var n=r(6416);let a={};async function o(e,t,r){const i=(s=r,`${(0,n.Z)(s)}`);var s;if(!a[i]){const n=r?.type;if(!n)throw new Error(`could not determine adapter type from adapter config snapshot ${JSON.stringify(r)}`);const s=e.getAdapterType(n);if(!s)throw new Error(`unknown data adapter type ${n}`);const l=s.configSchema.create(r,{pluginManager:e}),c=o.bind(null,e,t),{AdapterClass:d,getAdapterClass:u}=s,p=d||await u();if(!p)throw new Error("Failed to get adapter");const m=new p(l,c,e);a[i]={dataAdapter:m,sessionIds:new Set([t])}}const l=a[i];return l.sessionIds.add(t),l}function i(e){let t=0;const r=Object.keys(e);if(1===r.length&&"sessionId"===r[0]){const{sessionId:r}=e;Object.entries(a).forEach((([e,n])=>{n.sessionIds.delete(r),0===n.sessionIds.size&&(t+=1,delete a[e])}))}else Object.values(a).forEach((t=>{if(t.dataAdapter.freeResources){const r=e.regions||(e.region?[e.region]:[]);for(const e of r)void 0!==e.refName&&t.dataAdapter.freeResources(e)}else console.warn(t.dataAdapter,"does not implement freeResources")}));return t}},31640:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{constructor(e){if(super(e),"AdapterClass"in e)this.AdapterClass=e.AdapterClass,this.getAdapterClass=async()=>e.AdapterClass;else{if(!("getAdapterClass"in e))throw new Error(`no AdapterClass or getAdapterClass is defined for adapter type ${this.name}`);this.getAdapterClass=e.getAdapterClass}this.configSchema=e.configSchema,this.adapterCapabilities=e.adapterCapabilities||[],this.adapterMetadata=e.adapterMetadata}}},75444:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{constructor(e){if(super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel,!this.ReactComponent)throw new Error(`no ReactComponent defined for view ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for view ${this.name}`)}}},66511:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{constructor(e){if(super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,this.description=e.description,this.url=e.url,this.configEditorComponent=e.configEditorComponent,!this.stateModel)throw new Error(`no stateModel defined for connection ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema defined for connection ${this.name}`)}}},63048:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(28542),a=r(84535);class o extends n.Z{constructor(e){if(super(e),this.stateModel=e.stateModel,this.subDisplay=e.subDisplay,this.configSchema=e.configSchema,this.ReactComponent=e.ReactComponent,this.trackType=e.trackType,this.viewType=e.viewType,!this.stateModel)throw new Error(`no stateModel defined for display ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for display ${this.name}`);if(!this.ReactComponent)throw new Error(`no ReactComponent provided for display ${this.name}`);if(!this.trackType)throw new Error(`no trackType provided for display ${this.name}`);if(!this.viewType)throw new Error(`no viewType provided for display ${this.name}`);if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${e} is not explicitlyTyped`)}}}},99831:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(28542),a=r(84535);class o extends n.Z{constructor(e){if(super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,!this.stateModel)throw new Error(`no stateModel defined for internet account type ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for internet account type ${this.name}`);if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${e} is not explicitlyTyped`)}}}},28542:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class n{constructor(e){this.name=e.name||"UNKNOWN",this.maybeDisplayName=e.displayName}get displayName(){return this.maybeDisplayName||this.name}}},83015:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});const n=e=>"object"==typeof e&&null!==e,a=e=>n(e)&&!(e instanceof RegExp)&&!(e instanceof Error)&&!(e instanceof Date)&&!(globalThis.Blob&&e instanceof globalThis.Blob);function o(e,t,r=new WeakSet){if(r.has(e))return;r.add(e);const i=e=>e.forEach((e=>{t(e),n(e)&&o(e,t,r)}));Array.isArray(e)&&i(e);for(const n of Object.values(e))t(n),a(n)&&(Array.isArray(n)?i(n):o(n,t,r))}var i=r(28542),s=r(99512),l=r(55022),c=r(58062);class d extends i.Z{constructor(e){super({}),this.pluginManager=e}async serializeArguments(e,t){const r=(0,s.getBlobMap)();return await this.augmentLocationObjects(e,t),{...e,blobMap:r}}async serializeNewAuthArguments(e,t){const r=this.pluginManager.rootModel;if(!(0,l.dc)(r)||e.internetAccountPreAuthorization)return e;const n=r.findAppropriateInternetAccount(e);return n&&"MainThreadRpcDriver"!==t&&(e.internetAccountPreAuthorization=await n.getPreAuthorizationInformation(e)),e}async deserializeArguments(e,t){e.blobMap&&(0,s.setBlobMap)(e.blobMap);const{signal:r}=e;return{...e,signal:(0,c.k$)(r)?(0,c.ie)(r):void 0}}async serializeReturn(e,t,r){return e}async deserializeReturn(e,t,r){let n;try{n=await e}catch(e){if((0,l.PK)(e)){const t=this.pluginManager.rootModel?.createEphemeralInternetAccount(`HTTPBasicInternetAccount-${new URL(e.url).origin}`,{},e.url);throw new l.Ms("Retrying with created internet account",t.internetAccountId)}throw e}return n}async augmentLocationObjects(e,t){const r=[];o(e,(e=>{(0,l.hb)(e)&&r.push(e)}));for(const e of r)await this.serializeNewAuthArguments(e,t);return e}}},49368:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{constructor(e){if(super(e),this.description=e.description,this.configSchema=e.configSchema,this.AdapterClass=e.AdapterClass,!this.AdapterClass)throw new Error(`no AdapterClass defined for adapter type ${this.name}`)}}},5889:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(28542),a=r(84535);class o extends n.Z{displayTypes=[];constructor(e){if(super(e),this.stateModel=e.stateModel,this.configSchema=e.configSchema,!this.stateModel)throw new Error(`no stateModel defined for track ${this.name}`);if(!this.configSchema)throw new Error(`no configSchema provided for track ${this.name}`);if(!(0,a.getDefaultValue)(this.configSchema).type){const e=this.configSchema?this.configSchema.name:"UNKNOWN";throw new Error(`${e} is not explicitlyTyped`)}}addDisplayType(e){this.displayTypes.push(e)}}},59366:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{displayTypes=[];constructor(e){if(super(e),this.ReactComponent=e.ReactComponent,this.stateModel=e.stateModel,this.extendedName=e.extendedName,!this.ReactComponent)throw new Error(`no ReactComponent defined for view ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for view ${this.name}`)}addDisplayType(e){this.displayTypes.push(e)}}},25077:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(28542);class a extends n.Z{constructor(e){if(super(e),this.heading=e.heading,this.HeadingComponent=e.HeadingComponent,this.configSchema=e.configSchema,this.stateModel=e.stateModel,this.ReactComponent=e.ReactComponent,!this.ReactComponent)throw new Error(`no ReactComponent defined for widget ${this.name}`);if(!this.stateModel)throw new Error(`no stateModel defined for widget ${this.name}`)}}},20592:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AdapterType:()=>u.Z,AddTrackWorkflowType:()=>w.Z,BaseConnectionModelFactory:()=>d.BaseConnectionModelFactory,BaseDisplay:()=>d.BaseDisplay,BaseInternetAccountConfig:()=>d.BaseInternetAccountConfig,BaseViewModel:()=>d.BaseViewModel,BoxRendererType:()=>n.default,CircularChordRendererType:()=>o.Z,ComparativeServerSideRendererType:()=>a.Z,ConnectionType:()=>p.Z,DisplayType:()=>h.Z,FeatureRendererType:()=>s.default,InternetAccount:()=>d.InternetAccount,InternetAccountType:()=>y.Z,RendererType:()=>i.default,RpcMethodType:()=>b.Z,ServerSideRenderedContent:()=>l.Z,ServerSideRendererType:()=>c.default,TextSearchAdapterType:()=>v.Z,TrackType:()=>m.Z,ViewType:()=>f.Z,WidgetType:()=>g.Z,baseConnectionConfig:()=>d.baseConnectionConfig,createBaseTrackConfig:()=>d.createBaseTrackConfig,createBaseTrackModel:()=>d.createBaseTrackModel});var n=r(18930),a=r(52398),o=r(25216),i=r(14331),s=r(90176),l=r(97198),c=r(96595),d=r(72271),u=r(31640),p=r(66511),m=r(5889),g=r(25077),f=r(59366),h=r(63048),y=r(99831),b=r(83015),w=r(75444),v=r(49368)},77911:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(88196),a=r(1502);const o=n.types.model("BaseView",{id:a.ElementId,displayName:n.types.maybe(n.types.string),minimized:!1}).volatile((()=>({width:800}))).views((()=>({menuItems:()=>[]}))).actions((e=>({setDisplayName(t){e.displayName=t},setWidth(t){e.width=t},setMinimized(t){e.minimized=t}}))),i=o;o.props({displayedRegions:n.types.array(a.Region)})},72271:(e,t,r)=>{"use strict";r.r(t),r.d(t,{BaseConnectionModelFactory:()=>i,BaseDisplay:()=>u,BaseInternetAccountConfig:()=>m,BaseViewModel:()=>s.Z,InternetAccount:()=>f,baseConnectionConfig:()=>a,createBaseTrackConfig:()=>w,createBaseTrackModel:()=>b});var n=r(43800);const a=(0,n.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"});var o=r(88196);const i=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track")),configuration:(0,n.ConfigurationReference)(a)}).actions((()=>({connect(e){}}))).actions((e=>({afterAttach(){0===e.tracks.length&&e.connect(e.configuration)},addTrackConf(t){const r=e.tracks.push(t);return e.tracks[r-1]},addTrackConfs(t){const r=e.tracks.push(...t);return e.tracks.slice(r-1-t.length,r-1)},setTrackConfs:t=>(e.tracks=(0,o.cast)(t),e.tracks),clear(){}})))};var s=r(77911),l=r(99512),c=r(90872),d=r(1502);const u=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((()=>({rendererTypeName:"",error:void 0,message:void 0}))).views((e=>({get RenderingComponent(){const{pluginManager:t}=(0,c.getEnv)(e);return t.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,n.getConf)(this.parentTrack,"adapter")},get parentTrack(){let t=(0,o.getParent)(e);for(;!t.configuration||!(0,n.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error(`No parent track found for ${e.type} ${e.id}`);t=(0,o.getParent)(t)}return t},renderProps:()=>({...(0,l.getParentRenderProps)(e),notReady:(0,c.getContainingView)(e).minimized,rpcDriverName:e.rpcDriverName,displayModel:e}),get rendererType(){const{pluginManager:t}=(0,c.getEnv)(e),r=t.getRendererType(e.rendererTypeName);if(!r)throw new Error(`renderer "${e.rendererTypeName}" not found`);if(!r.ReactComponent)throw new Error(`renderer ${e.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`);return r},get DisplayMessageComponent(){},trackMenuItems:()=>[],get viewMenuActions(){return[]},regionCannotBeRendered:()=>null}))).actions((e=>({setMessage(t){e.message=t},setError(t){e.error=t},setRpcDriverName(t){e.rpcDriverName=t},reload(){}})));var p=r(59062);const m=(0,n.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0}),g="undefined"==typeof sessionStorage,f=o.types.model("InternetAccount",{id:d.ElementId,type:o.types.string,configuration:(0,n.ConfigurationReference)(m)}).views((e=>({get name(){return(0,n.getConf)(e,"name")},get description(){return(0,n.getConf)(e,"description")},get internetAccountId(){return(0,n.getConf)(e,"internetAccountId")},get authHeader(){return(0,n.getConf)(e,"authHeader")},get tokenType(){return(0,n.getConf)(e,"tokenType")},get domains(){return(0,n.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}))).views((e=>({handlesLocation:t=>e.domains.some((e=>t?.uri.includes(e))),get tokenKey(){return`${e.internetAccountId}-token`}}))).actions((e=>({getTokenFromUser(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken(t){sessionStorage.setItem(e.tokenKey,t)},removeToken(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:()=>sessionStorage.getItem(e.tokenKey),validateToken:async(e,t)=>e}))).actions((e=>{let t;return{async getToken(r){if(t)return t;let n=r?.internetAccountPreAuthorization?.authInfo?.token;if(n)return t=Promise.resolve(n),t;if(g)throw new Error("Did not get internet account pre-authorization info in worker");return n=e.retrieveToken(),n?(t=Promise.resolve(n),t):(t=new Promise(((t,r)=>e.getTokenFromUser((r=>{e.storeToken(r),t(r)}),(t=>{e.removeToken(),r(t)})))),t)}}})).actions((e=>({addAuthHeaderToInit:(t={},r)=>({...t,headers:new Headers({...t.headers,[e.authHeader]:e.tokenType?`${e.tokenType} ${r}`:r})}),async getPreAuthorizationInformation(t){const r=await e.getToken(t);let a;try{a=await e.validateToken(r,t)}catch(t){throw e.removeToken(),t}return{internetAccountType:e.type,authInfo:{token:a,configuration:(0,n.getConf)(e)}}}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit(n,a);return fetch(r,o)}}))).actions((e=>({openLocation:t=>new p.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})})));var h=r(99247),y=r(55022);function b(e,t,r){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:(0,n.ConfigurationReference)(r),minimized:!1,displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((t=>({get rpcSessionId(){return t.configuration?.trackId},get name(){return(0,n.getConf)(t,"name")},get textSearchAdapter(){return(0,n.getConf)(t,"textSearchAdapter")},get adapterType(){const r=(0,n.getConf)(t,"adapter");if(!r)throw new Error(`no adapter configuration provided for ${t.type}`);const a=e.getAdapterType(r.type);if(!a)throw new Error(`unknown adapter type ${r.type}`);return a},get viewMenuActions(){return t.displays.flatMap((e=>e.viewMenuActions))},get canConfigure(){const e=(0,c.getSession)(t),{sessionTracks:r,adminMode:n}=e;return(0,y.cX)(e)&&(n||r?.find((e=>e.trackId===t.configuration?.trackId)))}}))).actions((t=>({setMinimized(e){t.minimized=e},showDisplay(r,n={}){const a=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(a,(0,o.getRoot)(t),r),s=e.getDisplayType(i.type);if(!s)throw new Error(`unknown display type ${i.type}`);const l=s.stateModel.create({...n,type:i.type,configuration:i});t.displays.push(l)},hideDisplay(r){const n=e.pluggableConfigSchemaType("display"),a=(0,o.resolveIdentifier)(n,(0,o.getRoot)(t),r),i=t.displays.filter((e=>e.configuration===a));return(0,h.transaction)((()=>i.forEach((e=>t.displays.remove(e))))),i.length},replaceDisplay(r,n,a={}){const i=t.displays.findIndex((e=>e.configuration.displayId===r));if(-1===i)throw new Error(`could not find display id ${r} to replace`);const s=e.pluggableConfigSchemaType("display"),l=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),n);if(!e.getDisplayType(l.type))throw new Error(`unknown display type ${l.type}`);t.displays.splice(i,1,{...a,type:l.type,configuration:l})}}))).views((t=>({trackMenuItems(){const r=t.displays.flatMap((e=>e.trackMenuItems())),n=t.displays[0].configuration.displayId,a=function(e){const{pluginManager:t}=(0,c.getEnv)(e),r=(0,c.getContainingView)(e),n=t.getViewType(r.type),a=new Set(n.displayTypes.map((e=>e.name)));return e.configuration.displays.filter((e=>a.has(e.type)))}(t);return[...r,...a.length>1?[{type:"subMenu",label:"Display types",subMenu:a.map((r=>({type:"radio",label:e.getDisplayType(r.type).displayName,checked:r.displayId===n,onClick:()=>t.replaceDisplay(n,r.displayId)})))}]:[]]}})))}function w(e){return(0,n.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,n.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display")),formatDetails:(0,n.ConfigurationSchema)("FormatDetails",{feature:{type:"frozen",description:"adds extra fields to the feature details",defaultValue:{},contextVariable:["feature"]},subfeatures:{type:"frozen",description:"adds extra fields to the subfeatures of a feature",defaultValue:{},contextVariable:["feature"]},depth:{type:"number",defaultValue:2,description:"depth of subfeatures to iterate the formatter on formatDetails.subfeatures (e.g. you may not want to format the exon/cds subfeatures, so limited to 2"},maxDepth:{type:"number",defaultValue:99999,description:"Maximum depth to render subfeatures"}}),formatAbout:(0,n.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration object in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const r=e.evaluateExtensionPoint("Core-preProcessTrackConfig",JSON.parse(JSON.stringify(t))),{displays:n=[]}=r;if("placeholderId"!==r.trackId){const t=new Set(n.filter((e=>!!e)).map((e=>e.type)));e.getTrackType(r.type).displayTypes.forEach((e=>{t.has(e.name)||n.push({displayId:`${r.trackId}-${e.name}`,type:e.name})}))}return{...r,displays:n}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:r}=t;if(!r)throw new Error(`unknown display type ${r}`);const n=e.displays.find((e=>e?.displayId===t.displayId));if(n)return n;const a=e.displays.push(t);return e.displays[a-1]}})})}},18930:(e,t,r)=>{"use strict";r.r(t),r.d(t,{LayoutSession:()=>u,default:()=>p});var n=r(28926),a=r.n(n),o=r(42904),i=r(59612),s=r(54691),l=r(90176),c=r(90872),d=r(43800);class u{constructor(e){this.config=e.config,this.bpPerPx=e.bpPerPx,this.filters=e.filters,this.update(e)}update(e){Object.assign(this,e)}makeLayout(){return new i.Z(o.Z,{maxHeight:(0,d.readConfObject)(this.config,"maxHeight"),displayMode:(0,d.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,d.readConfObject)(this.config,"noSpacing")?1:3})}cachedLayoutIsValid(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&a()((0,d.readConfObject)(this.config),e.config)&&a()(this.filters,e.filters)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,d.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}class p extends l.default{sessions={};getWorkerSession(e){const t=(0,c.getLayoutId)(e);this.sessions[t]||(this.sessions[t]=this.createSession(e));const r=this.sessions[t];return r.update(e),r}getExpandedRegion(e,t){if(!e)return e;const{bpPerPx:r,config:n}=t,a=void 0===n?0:(0,d.readConfObject)(n,"maxFeatureGlyphExpansion");if(!a)return e;const o=Math.round(a*r);return{...e,start:Math.floor(Math.max(e.start-o,0)),end:Math.ceil(e.end+o)}}createSession(e){return new u(e)}async freeResourcesInClient(e,t){const{regions:r}=t,n=(0,c.getLayoutId)(t);let a=0;const o=this.sessions[n];return!r&&o&&(delete this.sessions[n],a=1),o&&r&&o.layout.discardRange(r[0].refName,r[0].start,r[0].end),a+await super.freeResourcesInClient(e,t)}deserializeLayoutInClient(e){return new s.Z(e)}deserializeResultsInClient(e,t){const r=this.deserializeLayoutInClient(e.layout);return super.deserializeResultsInClient({...e,layout:r},t)}createLayoutInWorker(e){const{regions:t}=e;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}serializeResultsInWorker(e,t){const r=super.serializeResultsInWorker(e,t),[n]=t.regions;return r.layout=e.layout.serializeRegion(this.getExpandedRegion(n,t)),r.layout.rectangles&&(r.features=r.features.filter((e=>Boolean(r.layout.rectangles[e.uniqueId])))),r.maxHeightReached=r.layout.maxHeightReached,r}async render(e){const t=e.layout||this.createLayoutInWorker(e);return{...await super.render({...e,layout:t}),layout:t}}}},25216:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var n=r(66204),a=r(90872),o=r(90176),i=r(80846),s=r(34599),l=r(35421),c=r(88196),d=r(42457);const u=(0,i.observer)((function(e){const{html:t,theme:r,RenderingComponent:o,...i}=e,d=(0,n.useRef)(null),u=(0,n.useRef)(),p=(0,c.getRoot)(e.displayModel).hydrateFn;return(0,n.useEffect)((()=>{const e=(0,a.rIC)((()=>{if(!d.current)return;const e=(0,l.createJBrowseTheme)(r);u.current=u.current??p(d.current,n.createElement(s.Z,{theme:e},n.createElement(o,i)))}));return()=>{clearTimeout(e);const t=u.current;u.current=void 0,setTimeout((()=>{t?.unmount()}))}}),[t,o,p,r,e,i]),n.createElement("g",{ref:d,dangerouslySetInnerHTML:{__html:t}})})),p=(0,i.observer)((function(e){const{html:t,RenderingComponent:r}=e,o=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const i=o.current;return i&&t&&(i.innerHTML&&(0,d.unmountComponentAtNode)(i),i.style.outline="none",i.innerHTML=t,(0,a.rIC)((()=>{(0,d.hydrate)(n.createElement(r,e),i)}))),()=>{i&&(0,d.unmountComponentAtNode)(i)}}),[t,r,e]),n.createElement("g",{ref:o})})),m=(0,i.observer)((function(e){return(0,c.getRoot)(e.displayModel).hydrateFn?n.createElement(u,e):n.createElement(p,e)}));function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},g.apply(this,arguments)}class f extends o.default{supportsSVG=!0;deserializeResultsInClient(e,t){const r=new Map(e.features.map((e=>a.SimpleFeature.fromJSON(e))).map((e=>[e.id(),e])));return t.exportSVG?{...e,features:r,blockKey:"circularChord",html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,features:r,blockKey:"circularChord",reactElement:n.createElement(m,g({},t,e,{features:r,RenderingComponent:this.ReactComponent}))}}}},52398:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(11569),a=r(40011),o=r(96595),i=r(93912),s=r(90872),l=r(9762);class c extends o.default{async renameRegionsIfNeeded(e){return e}serializeArgsInClient(e){const t={...e,displayModel:{}};return super.serializeArgsInClient(t)}deserializeResultsInClient(e,t){return{...super.deserializeResultsInClient(e,t),blockKey:t.blockKey}}async renderInClient(e,t){const r=await e.call(t.sessionId,"ComparativeRender",t);return"canvasRecordedData"in r&&(r.html=await(0,s.getSerializedSvg)(r),delete r.reactElement),r}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async getFeatures(e){const t=this.pluginManager,{sessionId:r,adapterConfig:o}=e,{dataAdapter:c}=await(0,i.uP)(t,r,o),d=e.regions;if(!d||0===d.length)return console.warn("no regions supplied to comparative renderer"),[];const u=d.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),p=await(0,l.z)(c.getFeaturesInMultipleRegions(u,e).pipe((0,n.h)((t=>this.featurePassesFilters(e,t))),(0,a.q)()));return(0,s.dedupe)(p,(e=>e.id()))}}},90176:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(40011),a=r(91370),o=r.n(a),i=r(9762),s=r(90872),l=r(85291),c=r(93912),d=r(96595),u=r(56798);class p extends d.default{serializeArgsInClient(e){const{displayModel:t,regions:r}=e,n={...e,displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:o()(r)};return super.serializeArgsInClient(n)}deserializeResultsInClient(e,t){const r=new Map(e.features.map((e=>l.Z.fromJSON(e))).map((e=>[e.id(),e])));return{...super.deserializeResultsInClient({...e,features:r},t),blockKey:t.blockKey,features:r}}serializeResultsInWorker(e,t){const r=super.serializeResultsInWorker(e,t),{features:n}=e;return{...r,features:(0,s.iterMap)(n.values(),(e=>e.toJSON()),n.size)}}getExpandedRegion(e,t){return e}async getFeatures(e){const t=this.pluginManager,{signal:r,regions:a,sessionId:o,adapterConfig:l}=e,{dataAdapter:d}=await(0,c.uP)(t,o,l);if(!(0,u.isFeatureAdapter)(d))throw new Error("Adapter does not support retrieving features");const p=new Map;if(!a||0===a.length)return p;const m=a.map((e=>{const t={...e};return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),g=m[0],f=1===m.length?d.getFeatures(this.getExpandedRegion(g,e),e):d.getFeaturesInMultipleRegions(m,e),h=await(0,i.z)(f.pipe((0,n.q)()));return(0,s.checkAbortSignal)(r),new Map(h.filter((t=>this.featurePassesFilters(e,t))).map((e=>[e.id(),e])))}featurePassesFilters(e,t){return!e.filters||e.filters.passes(t,e)}async render(e){const t=e.features||await this.getFeatures(e);return{...await super.render({...e,features:t}),features:t}}}},14331:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var n=r(66204),a=r(84535),o=r(28542);class i extends o.Z{supportsSVG=!0;constructor(e){if(super(e),this.ReactComponent=e.ReactComponent,this.configSchema=e.configSchema,this.pluginManager=e.pluginManager,!this.ReactComponent)throw new Error(`no ReactComponent defined for renderer ${this.name}`);if(!(0,a.getDefaultValue)(this.configSchema).type)throw new Error(`${this.name} config schema ${this.configSchema.name} is not explicitlyTyped`);if(!this.pluginManager)throw new Error(`no plugin manager defined for renderer ${this.name}`)}async render(e){return{reactElement:n.createElement(this.ReactComponent,e,null)}}freeResources(){return 0}}},97198:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var n=r(66204),a=r(34599),o=r(35421),i=r(80846),s=r(88196),l=r(42457),c=r(90872);const d=(0,i.observer)((function({theme:e,html:t,RenderingComponent:r,...i}){const l=(0,n.useRef)(null),d=(0,n.useRef)(),{hydrateFn:u}=(0,s.getRoot)(i.displayModel);return(0,n.useEffect)((()=>{const t=(0,c.rIC)((()=>{if(!l.current)return;const t=(0,o.createJBrowseTheme)(e);d.current=d.current??u(l.current,n.createElement(a.Z,{theme:t},n.createElement(r,i)))}));return()=>{clearTimeout(t);const e=d.current;d.current=void 0,setTimeout((()=>{e?.unmount()}))}}),[t,e,i,u,r]),n.createElement("div",{ref:l,dangerouslySetInnerHTML:{__html:t}})})),u=(0,i.observer)((function({theme:e,html:t,RenderingComponent:r,...i}){const s=(0,n.useRef)(null),d=(0,o.createJBrowseTheme)(e);return(0,n.useEffect)((()=>{const e=s.current;return e&&(e&&(0,l.unmountComponentAtNode)(e),e.innerHTML=t,(0,c.rIC)((()=>{(0,l.hydrate)(n.createElement(a.Z,{theme:d},n.createElement(r,i)),e)}))),()=>{e&&(0,l.unmountComponentAtNode)(e)}}),[t,d,i,r]),n.createElement("div",{ref:s})})),p=(0,i.observer)((function(e){return(0,s.getRoot)(e.displayModel).hydrateFn?n.createElement(d,e):n.createElement(u,e)}))},96595:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(66204),a=r(34599),o=r(9721),i=r(88196),s=r(90872),l=r(15974),c=r(35421),d=r(14331),u=r(97198);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p.apply(this,arguments)}class m extends d.default{serializeArgsInClient(e){return{...e,config:(0,i.isStateTreeNode)(e.config)?(0,i.getSnapshot)(e.config):e.config,filters:e.filters?.toJSON().filters}}deserializeResultsInClient(e,t){return t.exportSVG?{...e,html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}:{...e,reactElement:n.createElement(u.Z,p({},t,e,{RenderingComponent:this.ReactComponent}))}}deserializeArgsInWorker(e){const t={...e};return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=new l.Z({filters:e.filters}),t}serializeResultsInWorker(e,t){const r=(0,o.Dq)(n.createElement(a.Z,{theme:(0,c.createJBrowseTheme)(t.theme)},e.reactElement));return delete e.reactElement,{...e,html:r}}async renderInClient(e,t){const r=await e.call(t.sessionId,"CoreRender",t);return"canvasRecordedData"in r&&(r.html=await(0,s.getSerializedSvg)(r),delete r.reactElement),r}async renderInWorker(e){const{signal:t,statusCallback:r=(()=>{})}=e,n=this.deserializeArgsInWorker(e),a=await(0,s.updateStatus)("Rendering plot",r,(()=>this.render(n)));return(0,s.checkAbortSignal)(t),(0,s.updateStatus)("Serializing results",r,(()=>this.serializeResultsInWorker(a,n)))}async freeResourcesInClient(e,t){const r=this.serializeArgsInClient(t);return this.freeResources()+await e.call(t.sessionId,"CoreFreeResources",r)}}},15974:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(88826);class a{constructor({filters:e=[]}){this.filterChain=e.map((e=>{if("string"==typeof e)return{expr:(0,n.P)(e),string:e};throw new Error(`invalid inputFilter string "${e}"`)}))}passes(...e){for(const t of this.filterChain)if(!t.expr.evalSync({feature:e[0]}))return!1;return!0}toJSON(){return{filters:this.filterChain.map((e=>e.string))}}static fromJSON(e){return new a(e)}}},69282:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(66204),a=r(33681),o=r(49140),i=r(80846),s=r(82319);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}const c=(0,i.observer)((function({children:e,menuItems:t,closeAfterItemClick:r=!0,stopPropagation:i,setOpen:c,onClick:d,...u}){const p=(0,s.o_)({popupId:"viewMenu",variant:"popover"}),{onClick:m,onTouchStart:g,...f}=(0,s.vW)(p),{isOpen:h}=p;return(0,n.useEffect)((()=>{c?.(h)}),[h,c]),n.createElement(n.Fragment,null,n.createElement(o.Z,l({onClick:e=>{i&&e.stopPropagation(),m(e),d?.()},onTouchStart:e=>{i&&e.stopPropagation(),g(e),d?.()}},f,u,{disabled:0===t.length}),e),n.createElement(a.Z,l({},(0,s.ZW)(p),{onMenuItemClick:(e,t)=>t(),menuItems:t,closeAfterItemClick:r,popupState:p})))}))},59093:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var n=r(66204),a=r(7146),o=r(52940),i=r(76972),s=r(29520),l=r(62301),c=r(5146),d=r(86163);const u=({onFactoryReset:e,resetButtonText:t})=>{const[r,o]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement(a.Z,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:()=>o(!0)},t),n.createElement(c.default,{onClose:()=>o(!1),open:r,onFactoryReset:e}))};function p({componentStack:e,error:t="No error message provided",onFactoryReset:r,resetButtonText:c="Factory Reset"}){return n.createElement(o.Z,{maxWidth:"xl",open:!0},n.createElement(i.Z,null,"Fatal error"),n.createElement(s.Z,null,n.createElement(d.Z,{error:t}),n.createElement("pre",null,e)),n.createElement(l.Z,null,n.createElement(a.Z,{color:"secondary",variant:"contained",onClick:()=>window.location.reload()},"Refresh"),n.createElement(u,{onFactoryReset:r,resetButtonText:c})))}},77638:(e,t,r)=>{"use strict";r.d(t,{Z:()=>m});var n=r(66204),a=r(26481),o=r(94926),i=r(7146),s=r(80013),l=r(38684),c=r(90872),d=r(99512);function u(e){return"blobId"in e}const p=(0,l.ZL)()((e=>({filename:{marginLeft:e.spacing(1)}}))),m=function({location:e,setLocation:t}){const{classes:r}=p(),l=e&&(u(e)&&e.name||function(e){return"localPath"in e}(e)&&e.localPath),m=e&&u(e)&&!(0,d.getBlob)(e.blobId);return n.createElement(a.Z,{display:"flex",flexDirection:"row",alignItems:"center"},n.createElement(a.Z,null,n.createElement(o.Z,{fullWidth:!0},n.createElement(i.Z,{variant:"outlined",component:"label"},"Choose File",n.createElement("input",{type:"file",hidden:!0,onChange:({target:e})=>{const r=e?.files?.[0];r&&(c.isElectron?t({localPath:r.path,locationType:"LocalPathLocation"}):t((0,d.storeBlobLocation)({blob:r})))}})))),n.createElement(a.Z,null,n.createElement(s.Z,{component:"span",className:r.filename,color:l?"initial":"textSecondary"},l||"No file chosen"),m?n.createElement(s.Z,{color:"error"},"(need to reload)"):null))}},20197:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(66204),a=r(46338),o=r(80846),i=r(55022);const s=(0,o.observer)((function({location:e,setLocation:t,label:r}){return n.createElement(a.Z,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:e&&(0,i.hb)(e)?e.uri:"",label:r||"Enter URL",onChange:e=>{t({uri:e.target.value.trim(),locationType:"UriLocation"})}})}))},28164:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(66204),a=r(80013),o=r(38684),i=r(15654);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}const l=(0,o.ZL)()({dots:{"&::after":{display:"inline-block",content:'""',width:"1em",textAlign:"left",animation:`${i.F4`
      0% {
        content: '';
      }
      25% {
          content: '.';
      }
      50% {
        content: '..';
      }
      75% {
        content: '...';
      }
      `} 1.2s infinite ease-in-out`}}});function c({message:e,variant:t="body2",...r}){const{classes:o}=l();return n.createElement(a.Z,s({className:o.dots},r,{variant:t}),`${e||"Loading"}`)}},39092:(e,t,r)=>{"use strict";r.r(t),r.d(t,{category10:()=>n,dark2:()=>a,ggplot2Colors3:()=>u,ggplot2Colors4:()=>d,ggplot2Colors5:()=>c,ggplot2Colors6:()=>l,set1:()=>o,set2:()=>i,tableau10:()=>s});const n=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],o=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],i=["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],s=["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],l=["#F8766D","#B79F00","#00BA38","#00BFC4","#619CFF","#F564E3"],c=["#F8766D","#A3A500","#00BF7D","#00B0F6","#E76BF3"],d=["#F8766D","#7CAE00","#00BFC4","#C77CFF"],u=["#F8766D","#00BA38","#619CFF"]},56726:(e,t,r)=>{"use strict";r.d(t,{Ao:()=>a,R:()=>s,j4:()=>i});var n=r(88196);function a(e,t,r){if(!t||!r)return;const{width:n,interRegionPaddingWidth:a,displayedRegions:o,bpPerPx:i,minimumBlockWidth:s}=e,l=function(e,t,r){let n=0;const{displayedRegions:a}=e;if(t.index===r.index)n+=r.offset-t.offset;else{const e=a[t.index];if(n+=e.end-e.start-t.offset,r.index-t.index>=2)for(let e=t.index+1;e<r.index;e++){const t=a[e];n+=t.end-t.start}n+=r.offset}return n}(e,t,r);let c=0;for(let e=t.index;e<r.index;e++){const t=o[e];(t.end-t.start)/i>s&&c++}const d=l/(n-a*c),u=e.zoomTo(d);let p=0;d<u&&(p=(u-d)*e.width/2);let m=-p;for(let r=0;r<e.displayedRegions.length;r+=1){const n=e.displayedRegions[r];if(t.index===r){m+=t.offset;break}m+=n.end-n.start}e.scrollTo(Math.round(m/e.bpPerPx))}function o(e,t){return Math.floor(e.reversed?e.end-t:e.start+t)+1}function i(e,t){let r=0;const{bpPerPx:a,offsetPx:i,displayedRegions:s,interRegionPaddingWidth:l,staticBlocks:c}=e,d=c.contentBlocks,u=(i+t)*a;if(u<0){const e=s[0];return{...(0,n.getSnapshot)(e),oob:!0,coord:o(e,u),offset:u,index:0}}const p=l*a;let m=0;for(let e=0;e<s.length;e++){const t=s[e],a=t.end-t.start,i=u-r;if(a+r>u&&r<=u)return{...(0,n.getSnapshot)(t),oob:!1,offset:i,coord:o(t,i),index:e};d[m]?.regionNumber===e?(r+=a+p,m++):r+=a}if(u>=r&&s.length>0){const e=s.at(-1),t=u-r+(e.end-e.start);return{...(0,n.getSnapshot)(e),oob:!0,offset:t,coord:o(e,t),index:s.length-1}}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}}function s({refName:e,coord:t,regionNumber:r,self:n}){let a=0;const{interRegionPaddingWidth:o,bpPerPx:i,displayedRegions:s,staticBlocks:l}=n,c=l.contentBlocks,d=o*i;let u=0,p=0;for(;p<s.length;p++){const n=s[p],o=n.end-n.start;if(e===n.refName&&t>=n.start&&t<=n.end&&(!r||r===p)){a+=n.reversed?n.end-t:t-n.start;break}c[u]?.regionNumber===p?(a+=o+d,u++):a+=o}if(s[p])return{index:p,offsetPx:Math.round(a/i)}}},31996:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(88196),a=r(90872),o=r(1502),i=r(33322),s=r(4206),l=r(56726);const c=n.types.model("Base1DView",{id:o.ElementId,displayedRegions:n.types.array(o.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:n.types.optional(n.types.number,0),minimumBlockWidth:n.types.optional(n.types.number,0)}).volatile((()=>({features:void 0,volatileWidth:0}))).actions((e=>({setDisplayedRegions(t){e.displayedRegions=(0,n.cast)(t)},setBpPerPx(t){e.bpPerPx=t},setVolatileWidth(t){e.volatileWidth=t}}))).views((e=>({get width(){return e.volatileWidth},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((e=>e.end-e.start)).reduce(((e,t)=>e+t),0)}}))).views((e=>({get dynamicBlocks(){return(0,i.Z)(e)},get staticBlocks(){return(0,s.Z)(e)},get currBp(){return this.dynamicBlocks.map((e=>e.end-e.start)).reduce(((e,t)=>e+t),0)}}))).views((e=>({pxToBp:t=>(0,l.j4)(e,t),bpToPx:({refName:t,coord:r,regionNumber:n})=>(0,l.R)({refName:t,coord:r,regionNumber:n,self:e})?.offsetPx}))).actions((e=>({setFeatures(t){e.features=t},showAllRegions(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},zoomOut(){this.zoomTo(2*e.bpPerPx)},zoomIn(){this.zoomTo(e.bpPerPx/2)},zoomTo(t,r=e.width/2){const n=(0,a.clamp)(t,"minBpPerPx"in e?e.minBpPerPx:0,"maxBpPerPx"in e?e.maxBpPerPx:1/0),o=e.bpPerPx;return Math.abs(o-n)<1e-6?o:(e.bpPerPx=n,e.offsetPx=(0,a.clamp)(Math.round((e.offsetPx+r)*o/n-r),e.minOffset,e.maxOffset),e.bpPerPx)},scrollTo(t){const r=(0,a.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=r,r},centerAt(t,r,n){if(!r)return;const a=e.bpToPx({refName:r,coord:t,regionNumber:n});a&&this.scrollTo(Math.round(a-e.width/2))},scroll(t){const r=e.offsetPx,n=(0,a.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=n,n-r}}))).actions((e=>({moveTo(t,r){(0,l.Ao)(e,t,r)}})))},47685:(e,t,r)=>{"use strict";r.d(t,{ML:()=>s,N7:()=>c,O8:()=>i,fP:()=>l,zF:()=>d});var n=r(56371),a=r(28677);class o extends Error{}function i(e){if(e){if(!(e instanceof AbortSignal))throw new TypeError("must pass an AbortSignal");if(e.aborted)throw l()}}async function s(e){await(1,new Promise((e=>setTimeout(e,1)))),i(e)}function l(){if("undefined"!=typeof DOMException)return new DOMException("aborted","AbortError");const e=new o("aborted");return e.code="ERR_ABORTED",e}function c(e){return e?(0,a.R)(e,"abort"):n.y.create()}function d(e){return e instanceof Error&&("AbortError"===e.name||"ERR_ABORTED"===e.code||!!/\b(aborted|aborterror)\b/i.test(e.message))}},76258:(e,t,r)=>{"use strict";function n(e){const t=new FileReader;return new Promise(((r,n)=>{t.onload=e=>{e.target?r(e.target.result):n(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}r.d(t,{n:()=>n})},64019:(e,t,r)=>{"use strict";r.d(t,{Jw:()=>a,b0:()=>i,n2:()=>l,sh:()=>s});var n=r(90872);class a{constructor(e=[]){this.blocks=e}push(e){if(e instanceof s&&this.blocks.length>0){const t=this.blocks.at(-1);if(t instanceof s)return void t.push(e)}this.blocks.push(e)}getBlocks(){return this.blocks}getRegions(){return this.blocks.map((e=>e.toRegion()))}map(e,t){return this.blocks.map(e,t)}forEach(e,t){return this.blocks.forEach(e,t)}get length(){return this.blocks.length}get totalWidthPx(){return this.blocks.length>0?(0,n.sum)(this.blocks.map((e=>e.widthPx))):0}get totalWidthPxWithoutBorders(){return this.blocks.length>0?(0,n.sum)(this.blocks.filter((e=>"boundary"!==e.variant)).map((e=>e.widthPx))):0}get offsetPx(){return this.blocks.length>0?this.blocks[0].offsetPx:0}get contentBlocks(){return this.blocks.filter((e=>e instanceof i))}get totalBp(){return(0,n.sum)(this.contentBlocks.map((e=>e.end-e.start)))}}class o{widthPx=0;constructor(e){Object.assign(this,e),this.assemblyName=e.assemblyName,this.refName=e.refName,this.start=e.start,this.end=e.end,this.key=e.key,this.offsetPx=e.offsetPx}toRegion(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}class i extends o{}class s extends o{elidedBlockCount=0;constructor(e){super(e),this.widthPx=e.widthPx}push(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}class l extends o{}},33322:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var n=r(88196),a=r(19881),o=r(90872),i=r(64019);function s(e,t=!0,r=!0){const{offsetPx:s,displayedRegions:l,bpPerPx:c,width:d,minimumBlockWidth:u,interRegionPaddingWidth:p}=e;if(!d)throw new Error("view has no width, cannot calculate displayed blocks");const m=new i.Jw;let g=0;const f=s,h=f+d;for(let e=0;e<l.length;e++){const y=l[e],{assemblyName:b,refName:w,start:v,end:C,reversed:S}=y,k=g+(C-v)/c,T=(C-v)/c,x=(0,n.isStateTreeNode)(y)?(0,n.getSnapshot)(y):y;if(g<h&&k>f){const[n,y]=(0,a.U0)(f,h,g,k);let P,M,E,R,A;S?(P=Math.max(v,C-(y-g)*c),M=C-(n-g)*c,E=M===C,R=P===v,A=g+(C-M)/c):(P=(n-g)*c+v,M=Math.min(C,(y-g)*c+v),E=P===v,R=M===C,A=g+(P-v)/c);const I={assemblyName:b,refName:w,start:P,end:M,reversed:S,offsetPx:A,parentRegion:x,regionNumber:e,widthPx:(M-P)/c,isLeftEndOfDisplayedRegion:E,isRightEndOfDisplayedRegion:R,key:""};I.key=`${(0,o.assembleLocStringFast)(I)}-${e}${S?"-reversed":""}`,t&&0===m.length&&E&&m.push(new i.n2({key:`${I.key}-beforeFirstRegion`,widthPx:-s,offsetPx:I.offsetPx+s,variant:"boundary"})),r&&T<u?m.push(new i.sh(I)):m.push(new i.b0(I)),t&&(T>=u&&I.isRightEndOfDisplayedRegion&&e<l.length-1&&(m.push(new i.n2({key:`${I.key}-rightpad`,widthPx:p,offsetPx:I.offsetPx+I.widthPx})),g+=p),e===l.length-1&&I.isRightEndOfDisplayedRegion&&(A=I.offsetPx+I.widthPx,m.push(new i.n2({key:`${I.key}-afterLastRegion`,widthPx:d-A+s,offsetPx:A,variant:"boundary"}))))}g+=(C-v)/c}return m}},4206:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var n=r(88196),a=r(90872),o=r(64019);function i(e,t=!0,r=!0,i=0,s=800){const{offsetPx:l,displayedRegions:c,bpPerPx:d,minimumBlockWidth:u,interRegionPaddingWidth:p,width:m}=e,g=l*d,f=(l+m)*d,h=s,y=Math.ceil(h*d);let b=0;const w=new o.Jw;for(let e=0;e<c.length;e++){const l=c[e],{assemblyName:m,refName:h,start:v,end:C,reversed:S}=l,k=Math.ceil((C-v)/y),T=(0,n.isStateTreeNode)(l)?(0,n.getSnapshot)(l):l;let x=Math.floor((f-b)/y)+i;x>=k&&(x=k-1);let P=Math.floor((g-b)/y)-i;P<0&&(P=0);const M=(C-v)/d;for(let n=P;n<=x;n+=1){let i,l,g,f;S?(i=Math.max(v,C-(n+1)*y),l=C-n*y,g=l===C,f=i===v):(i=v+n*y,l=Math.min(C,v+(n+1)*y),g=i===v,f=l===C);const k={assemblyName:m,refName:h,start:i,end:l,reversed:S,offsetPx:(b+n*y)/d,parentRegion:T,regionNumber:e,widthPx:(l-i)/d,isLeftEndOfDisplayedRegion:g,isRightEndOfDisplayedRegion:f,key:""};k.key=`${(0,a.assembleLocStringFast)(k)}-${e}${S?"-reversed":""}`,t&&0===e&&0===n&&w.push(new o.n2({key:`${k.key}-beforeFirstRegion`,widthPx:s,offsetPx:k.offsetPx-s,variant:"boundary"})),r&&M<u?w.push(new o.sh(k)):w.push(new o.b0(k)),t&&(M>=u&&k.isRightEndOfDisplayedRegion&&e<c.length-1&&(b+=p*d,w.push(new o.n2({key:`${k.key}-rightpad`,widthPx:p,offsetPx:k.offsetPx+k.widthPx}))),e===c.length-1&&k.isRightEndOfDisplayedRegion&&(b+=p*d,w.push(new o.n2({key:`${k.key}-afterLastRegion`,widthPx:s,offsetPx:k.offsetPx+k.widthPx,variant:"boundary"}))))}b+=C-v}return w}},71472:(e,t,r)=>{"use strict";r.r(t),r.d(t,{contrastingTextColor:()=>s,emphasize:()=>c,isNamedColor:()=>i,makeContrasting:()=>d,namedColorToHex:()=>o});var n=r(73330);const a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function o(e){return a[e]}function i(e){return!!a[e]}function s(e){return l(e)>.5?"black":"white"}function l(e){const t=o(e);return(0,n.H3)(t||e)}function c(e,t=.15){const r=o(e);return(0,n._4)(r||e,t)}function d(e,t="white",r=3){let a=o(e)||e;const i=o(t)||t,s=l(i);let c=(0,n.mi)(a,i);const d=a;let u=.05;for(;c<r;)a=s>.5?(0,n._j)(d,u):(0,n.$n)(d,u),u+=.05,c=(0,n.mi)(a,i);return a}},622:(e,t,r)=>{"use strict";r.d(t,{V:()=>n.Vi});var n=r(26757),a=r(10649),o=r(83334);(0,n.l7)([a.Z,o.Z])},72160:(e,t,r)=>{"use strict";function n(e,t=JSON.stringify){const r=[],n=new Set;for(const a of e){const e=t(a);n.has(e)||(r.push(a),n.add(e))}return r}r.d(t,{D:()=>n})},6416:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(90872);function a(e,t=""){const r=Object.keys(e);for(const n of r){if(t.length>5e3)break;t+="object"==typeof e[n]&&e[n]?a(e[n],t):`${n}-${e[n]};`}return(0,n.hashCode)(t)}},59062:(e,t,r)=>{"use strict";r.r(t),r.d(t,{RemoteFileWithRangeCache:()=>d,getFetcher:()=>h,openLocation:()=>f,resolveUriLocation:()=>g});var n=r(90510),a=r(87475),o=r.n(a),i=r(70470),s=r(18390);const l={},c=new i.t({fetch:function(e,t,r,n={}){const a=l[e];if(!a)throw new Error(`fetch not registered for ${e}`);return a(e,t,r,n)},size:524288e3,chunkSize:131072,maxFetchSize:104857600,minimumTTL:864e5});class d extends n.kC{async fetch(e,t){l[String(e)]||(l[String(e)]=this.fetchBinaryRange.bind(this));const r=t?.headers;let n;if(r&&(r instanceof Headers?n=r.get("range"):Array.isArray(r)?[,n]=r.find((([e])=>"range"===e))||[void 0,void 0]:n=r.range),n){const r=/bytes=(\d+)-(\d+)/.exec(n);if(r){const[,n,a]=r,o=Number.parseInt(n,10),i=Number.parseInt(a,10),s=await c.getRange(e,o,i-o+1,{signal:t?.signal}),{headers:l}=s;return new Response(s.buffer,{status:206,headers:l})}}return super.fetch(e,t)}async fetchBinaryRange(e,t,r,n={}){const a=new Date,o={...n.headers,range:`bytes=${t}-${r}`},i=await super.fetch(e,{...n,headers:o}),l=new Date;if(206!==i.status){const n=`HTTP ${i.status} (${i.statusText}) when fetching ${e} bytes ${t}-${r}`,a=" (should be 206 for range requests)";throw new Error(`${n}${200===i.status?a:""}`)}const c={};for(const[e,t]of i.headers.entries())c[e]=t;const d=await i.arrayBuffer();return{headers:c,requestDate:a,responseDate:l,buffer:s.Buffer.from(d)}}}var u=r(55022),p=r(99512),m=r(90872);function g(e){return e.baseUri?{...e,uri:new URL(e.uri,e.baseUri).href}:e}function f(e,t){if(!e)throw new Error("must provide a location to openLocation");if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(o()||m.isElectron)return new n.S9(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){const t=(0,p.getBlob)(e.blobId);if(!t)throw new Error(`file ("${e.name}") was opened locally from a previous session. To restore it, go to track settings and reopen the file`);return new n.SH(t)}if((0,u.hb)(e)){if(!e.uri)throw new Error("No URI provided");const r=g(e);if(t){const n=y(e,t);if(n)return n.openLocation(r)}return new d(r.uri,{fetch:b})}throw new Error("invalid fileLocation")}function h(e,t){if(!(0,u.hb)(e))throw new Error(`Not a valid UriLocation: ${JSON.stringify(e)}`);if(t){const r=y(e,t);if(r)return r.getFetcher(e)}return b}function y(e,t){const{rootModel:r}=t;if(r&&(0,u.At)(r))return r.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}async function b(e,t){const r=await fetch(e,t);if(401===r.status&&r.headers.get("WWW-Authenticate")?.includes("Basic"))throw new u.yb("Accessing HTTPBasic resource without authentication",e.toString());return r}},15485:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(3119),a=r.n(n);function o(){const e=new(a().Jexl);return e.addFunction("get",((e,t)=>e.get(t))),e.addFunction("parent",(e=>e.parent())),e.addFunction("id",(e=>e.id())),e.addFunction("cast",(e=>e)),e.addFunction("log",(e=>(console.log(e),e))),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",((e,t)=>e.split(t))),e.addFunction("charAt",((e,t)=>e.charAt(t))),e.addFunction("charCodeAt",((e,t)=>e.charCodeAt(t))),e.addFunction("codePointAt",((e,t)=>e.codePointAt(t))),e.addFunction("startsWith",((e,t,r)=>e.startsWith(t,r))),e.addFunction("endsWith",((e,t,r)=>e.endsWith(t,r))),e.addFunction("padEnd",((e,t,r)=>e.padEnd(t,r))),e.addFunction("padStart",((e,t,r)=>e.padStart(t,r))),e.addFunction("repeat",((e,t)=>e.repeat(t))),e.addFunction("replace",((e,t,r)=>e.replace(t,r))),e.addFunction("replaceAll",((e,t,r)=>e.replaceAll(t,r))),e.addFunction("slice",((e,t,r)=>e.slice(t,r))),e.addFunction("startsWith",((e,t,r)=>e.startsWith(t,r))),e.addFunction("substring",((e,t,r)=>e.substring(t,r))),e.addFunction("toLowerCase",(e=>e.toLowerCase())),e.addFunction("toUpperCase",(e=>e.toUpperCase())),e.addFunction("trim",(e=>e.trim())),e.addFunction("trimEnd",(e=>e.trimEnd())),e.addFunction("trimStart",(e=>e.trimStart())),e.addFunction("getTag",((e,t)=>{const r=e.get("tags");return r?r[t]:e.get(t)})),e.addBinaryOp("&",15,((e,t)=>e&t)),e}},88826:(e,t,r)=>{"use strict";r.d(t,{P:()=>o});var n=r(15485);const a={};function o(e,t){const r=`nosig|${e}`;if(!a[r]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");const o=e.split("jexl:")[1],i=t?t.compile(`${o}`):(0,n.Z)().compile(`${o}`);a[r]=i}return a[r]}},42904:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});const n=1e4;function a(e,t,r,n){return t>=r&&n>=e}class o{padding=1;widthLimit=1e6;setAllFilled(e){this.allFilled=e}getItemAt(e){return this.allFilled?this.allFilled:void 0===this.rowState?.min||e<this.rowState.min||e>=this.rowState.max?void 0:this.rowState.bits[e-this.rowState.offset]}isRangeClear(e,t){if(this.allFilled)return!1;if(void 0===this.rowState||t<=this.rowState.min||e>=this.rowState.max)return!0;const{min:r,max:n,offset:a,bits:o}=this.rowState,i=Math.min(n,t)-a;let s=!0;for(let t=Math.max(r,e)-a;t<i&&s;t++)s=void 0===o[t];return s}initialize(e,t){const r=t-e;return{offset:e-r,min:e,max:t,bits:Array.from({length:3*r})}}addRect(e,t){const r=e.l,n=e.r+this.padding;this.rowState||(this.rowState=this.initialize(r,n));let a=r-this.rowState.offset,o=n-this.rowState.offset;const i=this.rowState.bits.length;if(o>=this.rowState.bits.length){const e=o+1;this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,n)):e>0&&(this.rowState.bits=[...this.rowState.bits,...Array.from({length:e})])}if(r<this.rowState.offset){const e=Math.min(i-a,this.rowState.offset);this.rowState.bits.length+e>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(r,n)):(this.rowState.bits=[...Array.from({length:e}),...this.rowState.bits],this.rowState.offset-=e)}o=n-this.rowState.offset,a=r-this.rowState.offset;const s=o-a;s>2e4&&console.warn(`Layout X pitch set too low, feature spans ${s} bits in a single row.`,e,t);for(let e=a;e<o;e+=1)this.rowState.bits[e]=t;r<this.rowState.min&&(this.rowState.min=r),n>this.rowState.max&&(this.rowState.max=n)}discardRange(e,t){if(this.allFilled)return;if(!this.rowState)return;if(t<=this.rowState.min||e>=this.rowState.max)return;if(e<=this.rowState.min&&t>=this.rowState.max)return void(this.rowState=void 0);if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-n&&this.rowState.bits.length>this.rowState.max+n-this.rowState.offset){const e=this.rowState.min-this.rowState.offset,t=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(e,this.rowState.bits.length-t),this.rowState.offset+=e}else if(this.rowState.offset<this.rowState.min-n){const e=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,e),this.rowState.offset+=e}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+n){const e=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=e}const r=Math.max(this.rowState.min,e)-this.rowState.offset,a=Math.min(t,this.rowState.max)-this.rowState.offset;for(let e=r;e>=0&&e<a;e+=1)this.rowState.bits[e]=void 0}}class i{constructor({pitchX:e=10,pitchY:t=10,maxHeight:r=1e4,hardRowLimit:n=1e4,displayMode:a="normal"}={}){this.pitchX=e,this.pitchY=t,this.hardRowLimit=n,this.maxHeightReached=!1,this.displayMode=a,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(r/this.pitchY),this.pTotalHeight=0}addRect(e,t,r,n,a){const o=this.rectangles.get(e);if(o)return null===o.top?null:(this.addRectToBitmap(o),o.top*this.pitchY);const i=Math.floor(t/this.pitchX),s=Math.floor(r/this.pitchX),l=Math.ceil(n/this.pitchY),c={id:e,l:i,r:s,top:null,h:l,originalHeight:n,data:a},d=this.maxHeight-l;let u=0;if("collapse"!==this.displayMode){for(;u<=d&&this.collides(c,u);u+=1);if(u>d)return c.top=null,this.rectangles.set(e,c),this.maxHeightReached=!0,null}return c.top=u,this.addRectToBitmap(c),this.rectangles.set(e,c),this.pTotalHeight=Math.max(this.pTotalHeight||0,u+l),u*this.pitchY}collides(e,t){const{bitmap:r}=this,n=t+e.h;for(let a=t;a<n;a+=1){const t=r[a];if(void 0!==t&&!t.isRangeClear(e.l,e.r))return!0}return!1}autovivifyRow(e,t){let r=e[t];if(!r){if(t>this.hardRowLimit)throw new Error(`layout hard limit (${this.hardRowLimit*this.pitchY}px) exceeded, aborting layout`);r=new o,e[t]=r}return r}addRectToBitmap(e){if(null===e.top)return;const t=e.id,r=e.top+e.h;if(e.r-e.l>2e4)for(let n=e.top;n<r;n+=1)this.autovivifyRow(this.bitmap,n).setAllFilled(t);else for(let n=e.top;n<r;n+=1)this.autovivifyRow(this.bitmap,n).addRect(e,t)}discardRange(e,t){const r=Math.floor(e/this.pitchX),n=Math.floor(t/this.pitchX),{bitmap:a}=this;for(const e of a)e&&e.discardRange(r,n)}hasSeen(e){return this.rectangles.has(e)}getByCoord(e,t){const r=Math.floor(t/this.pitchY),n=this.bitmap[r];if(!n)return;const a=Math.floor(e/this.pitchX);return n.getItemAt(a)}getByID(e){const t=this.rectangles.get(e);if(t){const e=t.top*this.pitchY;return[t.l*this.pitchX,e,t.r*this.pitchX,e+t.originalHeight]}}getDataByID(e){return this.rectangles.get(e)?.data}cleanup(){}getTotalHeight(){return this.pTotalHeight*this.pitchY}get totalHeight(){return this.getTotalHeight()}getRectangles(){return new Map([...this.rectangles.entries()].map((([e,t])=>{const{l:r,r:n,originalHeight:a,top:o}=t,i=(o||0)*this.pitchY,s=i+a;return[e,[r*this.pitchX,i,n*this.pitchX,s]]})))}serializeRegion(e){const t={};let r=!1;for(const[n,o]of this.rectangles.entries()){const{l:i,r:s,originalHeight:l,top:c}=o;if(null===o.top)r=!0;else{const r=(c||0)*this.pitchY,o=r+l,d=i*this.pitchX,u=s*this.pitchX;a(e.start,e.end,d-this.pitchX,u+this.pitchX)&&(t[n]=[d,r,u,o])}}return{rectangles:t,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:r}}toJSON(){return{rectangles:Object.fromEntries(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}},59612:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});class n{subLayouts=new Map;constructor(e,t={}){this.SubLayoutClass=e,this.subLayoutConstructorArgs=t}getDataByID(e){for(const t of this.subLayouts.values()){const r=t.getDataByID(e);if(r)return r}}getSublayout(e){let t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}addRect(e,t,r,n,a,o={}){return this.getSublayout(e).addRect(t,r,n,a,o)}discardRange(e,t,r){return this.subLayouts.get(e)?.discardRange(t,r)}toJSON(){const e={};for(const[t,r]of this.subLayouts.entries())e[t]=r.toJSON();return e}}},54691:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(52280),a=r.n(n);class o{constructor({rectangles:e,totalHeight:t,maxHeightReached:r}){this.rectangles=new Map(Object.entries(e)),this.totalHeight=t,this.maxHeightReached=r,this.rbush=new(a());for(const[t,r]of Object.entries(e))this.rbush.insert({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],name:t})}addRect(e){const t=this.rectangles.get(e);if(!t)throw new Error(`id ${e} not found in precomputed feature layout`);return t[1]}getRectangles(){return this.rectangles}getTotalHeight(){return this.totalHeight}collides(e,t){throw new Error("Method not implemented.")}getByCoord(e,t){const r={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(r)?this.rbush.search(r)[0].name:void 0}getByID(e){return this.rectangles.get(e)}addRectToBitmap(e,t){throw new Error("Method not implemented.")}discardRange(e,t){throw new Error("Method not implemented.")}serializeRegion(e){throw new Error("Method not implemented.")}toJSON(){return{rectangles:Object.fromEntries(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}},19618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GranularRectLayout:()=>n.Z,MultiLayout:()=>a.Z,PrecomputedLayout:()=>o.Z,PrecomputedMultiLayout:()=>s,SceneGraph:()=>l});var n=r(42904),a=r(59612),o=r(54691);class i{constructor(){throw new Error("invalid layout name")}}class s extends a.Z{constructor(e){super(i),Object.entries(e).forEach((([e,t])=>{this.subLayouts.set(e,new o.Z(t))}))}}class l{constructor(e,t,r,n,a,o){this.name=e,this.left=t,this.top=r,this.width=n,this.height=a,this.data=o,this.children=new Map,this.absoluteCache={dirty:!0}}addChild(e,t,r,n,a,o){const i=e instanceof l?e:new l(e,t,r,n,a,o);if(!(i instanceof l))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(i.name))throw new Error(`child named "${i.name}" already exists`);i.parent=this;const{left:s,right:c,top:d,bottom:u}=i.absolute;return void 0!==s&&void 0!==c&&void 0!==d&&void 0!==u&&(this.expand(s,c,d,u),this.children.set(i.name,i)),i}getSubRecord(e){return this.children.get(e)}expand(e,t,r,n){const{left:a,right:o,top:i,bottom:s}=this.absolute;if(void 0!==a&&e<a){const t=a-e;this.width+=t,this.left-=t}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==i&&r<i){const e=i-r;this.height+=e,this.top-=e}void 0!==s&&n>s&&(this.height+=n-s),this.parent&&this.parent.expand(e,t,r,n),this.absoluteCache.dirty=!0}get bottom(){return this.top+this.height}get right(){return this.left+this.width}walkParents(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}walkChildren(e){for(const t of this.children.values())e(t),t.walkChildren(e)}get absolute(){if(this.absoluteCache.dirty){let e=0,t=0;this.walkParents((r=>{e+=r.left,t+=r.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}move(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((e=>{e.absoluteCache.dirty=!0}));const{left:r,right:n,top:a,bottom:o}=this.absolute;void 0!==r&&void 0!==n&&void 0!==a&&void 0!==o&&this.expand(r,n,a,o)}}},84535:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getDefaultValue:()=>s,getEnumerationValues:()=>l,getPropertyType:()=>i,getSubType:()=>a,getUnionSubTypes:()=>o,resolveLateType:()=>c});var n=r(88196);function a(e){let t;if((0,n.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,n.isArrayType)(e)&&!(0,n.isMapType)(e)){if("function"==typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function o(e){if(!(0,n.isUnionType)(e))throw new TypeError("not an MST union type");const t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function i(e,t){return e.properties[t]}function s(e){if(!(0,n.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function l(e){return o(e).map((e=>e.value))}function c(e){return(0,n.isUnionType)(e)||(0,n.isArrayType)(e)||!(0,n.isLateType)(e)?e:e.getSubType()}},45466:(e,t,r)=>{"use strict";r.d(t,{x0:()=>n});let n=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"")},44632:(e,t,r)=>{"use strict";r.d(t,{Ck:()=>l,MC:()=>s,kv:()=>c,vL:()=>i});var n=r(87475),a=r.n(n),o=r(31182);let i,s,l;function c(e,t){e.serializedCommands?new o.CanvasSequence(e.serializedCommands).execute(t):t.drawImage(e,0,0)}const d="function"==typeof OffscreenCanvas,u=a();d?(i=(e,t)=>new OffscreenCanvas(e,t),s=window.createImageBitmap||self.createImageBitmap,l=window.ImageBitmap||self.ImageBitmap):u?(i=(...e)=>nodeCreateCanvas(...e),s=async(e,...t)=>{if(t.length>0)throw new Error("only one-argument uses of createImageBitmap are supported by the node offscreencanvas ponyfill");const r=e.toDataURL(),n=new nodeImage;return new Promise(((e,t)=>{n.onload=()=>e(n),n.onerror=t,n.src=r}))}):(i=(e,t)=>{const r=new o.CanvasSequence;return{width:e,height:t,getContext:()=>r}},s=async e=>{const t=e.getContext("2d");return{height:e.height,width:e.width,serializedCommands:t.toJSON(),containsNoTransferables:!0}},l=String)},55619:(e,t,r)=>{"use strict";r.d(t,{AN:()=>c,Cj:()=>s,E9:()=>l});var n=r(66204),a=r(31182),o=r(44632),i=r(76258);async function s(e,t,r,s){const{exportSVG:l,highResolutionScaling:c=1}=r;if(l){if(l.rasterizeLayers){const r=l.scale||c,a=(0,o.vL)(Math.ceil(e*r),t*r),d=a.getContext("2d");if(!d)throw new Error("2d canvas rendering not supported on this platform");return d.scale(r,r),{...await s(d),reactElement:n.createElement("image",{width:e,height:t,xlinkHref:"convertToBlob"in a?await(0,i.n)(await a.convertToBlob({type:"image/png"})):a.toDataURL("image/png")})}}{const e=new a.CanvasSequence;return{...await s(e),canvasRecordedData:e.toJSON()}}}{const r=c,n=(0,o.vL)(Math.ceil(e*r),t*r),a=n.getContext("2d");if(!a)throw new Error("2d canvas rendering not supported on this platform");return a.scale(r,r),{...await s(a),imageData:await(0,o.MC)(n)}}}async function l(e){const{width:t,height:n,canvasRecordedData:o}=e,i=new((await r.e(8112).then(r.t.bind(r,38112,23))).default)(t,n);return new a.CanvasSequence(o).execute(i),i.getSvg().innerHTML}function c({rendering:e}){return n.createElement(n.Fragment,null,n.isValidElement(e.reactElement)?e.reactElement:n.createElement("g",{dangerouslySetInnerHTML:{__html:e.html||""}}))}},19881:(e,t,r)=>{"use strict";function n(e,t,r,n){return t>r&&e<n&&n-r&&t-e?e>r?t<n?[e,t]:[e,n]:t<n?[r,t]:[r,n]:[]}function a(e,t,r,n){return t>r&&e<n}function o(e,t,r,n){return r<=e&&n>=t}r.d(t,{J7:()=>o,U0:()=>n,qY:()=>a})},16979:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ObservableCreate:()=>i});var n=r(56371),a=r(31628),o=r(90872);function i(e,t){return n.y.create((t=>{try{const r=e(t);r&&r.catch&&r.catch((e=>t.error(e)))}catch(e){t.error(e)}})).pipe((0,a.R)((0,o.observeAbortSignal)(t)))}},85291:(e,t,r)=>{"use strict";function n(e){return"object"==typeof e&&null!==e&&"function"==typeof e.get&&"function"==typeof e.id}function a(e){return"uniqueId"in e&&"object"!=typeof e.data}r.d(t,{T:()=>n,Z:()=>o});class o{constructor(e){a(e)?this.data=e:(this.data=e.data||{},this.parentHandle=e.parent);const t=a(e)?e.uniqueId:e.id;if(null==t)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(t),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error(`invalid feature data, end less than start. end: ${this.data.end} start: ${this.data.start}`);this.data.subfeatures&&(this.subfeatures=this.data.subfeatures?.map(((e,r)=>"function"!=typeof e.get?new o({id:e.uniqueId||`${t}-${r}`,data:{strand:this.data.strand,...e},parent:this}):e)))}get(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}set(e,t){this.data[e]=t}tags(){return Object.keys(this.data)}id(){return this.uniqueId}parent(){return this.parentHandle}children(){return this.get("subfeatures")}toJSON(){const e={...this.data,uniqueId:this.id()},t=this.parent();t&&(e.parentId=t.id());const r=this.children();return r&&(e.subfeatures=r.map((e=>e.toJSON()))),e}static fromJSON(e){return new o({...e})}}},81025:(e,t,r)=>{"use strict";r.d(t,{I9:()=>i,fK:()=>s,fY:()=>l});var n=r(9762),a=r(53570);function o(e,t,r,n=!1){if(0===r)return 0;let a;return n?a=t/r-e*e/(r*r):(a=t-e*e/r,r>1&&(a/=r-1)),a<0?0:Math.sqrt(a)}function i(e){return{...e,scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:o(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered}}async function s(e,t){const{start:r,end:o}=e,s={scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0};let l=!1;const{scoreMin:c,scoreMax:d,scoreSum:u,scoreSumSquares:p,featureCount:m}=await(0,n.z)(t.pipe((0,a.u)(((e,t)=>{const r=t.get("score"),n=t.get("summary"),{scoreMax:a,scoreMin:o}=e;return e.scoreMax=Math.max(a,n?t.get("maxScore"):r),e.scoreMin=Math.min(o,n?t.get("minScore"):r),e.scoreSum+=r,e.scoreSumSquares+=r*r,e.featureCount+=1,l=!0,e}),s)));return l?i({scoreMax:d,scoreMin:c,scoreSum:u,scoreSumSquares:p,featureCount:m,basesCovered:o-r+1}):{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}function l(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},99512:(e,t,r)=>{"use strict";r.r(t),r.d(t,{UNKNOWN:()=>c,UNSUPPORTED:()=>d,generateUnknownTrackConf:()=>k,generateUnsupportedTrackConf:()=>S,getBlob:()=>p,getBlobMap:()=>m,getFileName:()=>w,getParentRenderProps:()=>l,getRpcSessionId:()=>s,getTrackAssemblyNames:()=>i,getTrackName:()=>T,guessAdapter:()=>v,guessTrackType:()=>C,makeIndex:()=>y,makeIndexType:()=>b,setBlobMap:()=>g,storeBlobLocation:()=>h});var n=r(88196),a=r(90872),o=r(43800);function i(e){const t=(0,o.getConf)(e,"assemblyNames");if(!t){const t=(0,n.getParent)(e.configuration);if("sequence"in t)return[(0,o.readConfObject)(t,"name")]}return t}function s(e){let t;for(let r=e;!(0,n.isRoot)(r);r=(0,n.getParent)(r))"rpcSessionId"in r&&(t=r.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function l(e){for(let t=(0,n.getParent)(e);!(0,n.isRoot)(t);t=(0,n.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}const c="UNKNOWN",d="UNSUPPORTED";let u={};function p(e){return u[e]}function m(){return u}function g(e){u=e}let f=0;function h(e){if(e&&"blob"in e){const t=`b${+Date.now()}-${f++}`;return u[t]=e.blob,{name:e?.blob.name,blobId:t,locationType:"BlobLocation"}}return e}function y(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function b(e,t,r){return e?.toUpperCase().endsWith(t)?t:r}function w(e){const t="uri"in e?e.uri:void 0,r="localPath"in e?e.localPath:void 0,n="blobId"in e?e:void 0;return n?.name||t?.slice(t.lastIndexOf("/")+1)||r?.slice(r.lastIndexOf("/")+1)||""}function v(e,t,r,n){if(n){const{pluginManager:o}=(0,a.getEnv)(n),i=o.evaluateExtensionPoint("Core-guessAdapterForLocation",((e,t,r)=>{}))(e,t,r);if(i)return i}return{type:c}}function C(e,t){if(t){const r=(0,a.getSession)(t),n=(0,a.getEnv)(r).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",(e=>{}))(e);if(n)return n}return"FeatureTrack"}function S(e,t,r){const n={type:"FeatureTrack",name:`${e} (Unsupported)`,description:`Support not yet implemented for "${t}"`,category:r,trackId:""};return n.trackId=(0,a.objectHash)(n),n}function k(e,t,r){const n={type:"FeatureTrack",name:`${e} (Unknown)`,description:`Could not determine track type for "${t}"`,category:r,trackId:""};return n.trackId=(0,a.objectHash)(n),n}function T(e,t){const r=(0,o.readConfObject)(e,"name");if(!r&&"ReferenceSequenceTrack"===(0,o.readConfObject)(e,"type")){const r=t.assemblies.find((t=>t.sequence===e));return r?`Reference sequence (${(0,o.readConfObject)(r,"displayName")||(0,o.readConfObject)(r,"name")})`:"Reference sequence"}return r}},55022:(e,t,r)=>{"use strict";r.d(t,{At:()=>w,BQ:()=>a,J0:()=>v,Ms:()=>x,PK:()=>P,Um:()=>y,Z6:()=>M,_2:()=>u,_L:()=>s,cX:()=>i,d6:()=>f,dc:()=>b,fx:()=>S,gC:()=>d,gI:()=>c,gx:()=>l,hb:()=>C,k$:()=>o,ld:()=>k,uF:()=>p,yZ:()=>h,yb:()=>T,zL:()=>m,zN:()=>g});var n=r(88196);function a(e){return(0,n.isStateTreeNode)(e)&&"removeView"in e&&"addView"in e&&"views"in e}function o(e){return"object"==typeof e&&null!==e&&"rpcManager"in e&&"configuration"in e}function i(e){return o(e)&&"editConfiguration"in e}function s(e){return o(e)&&"addTrackConf"in e&&!e.disableAddTracks}function l(e){return o(e)&&"shareURL"in e&&!!e.shareURL}function c(e){return o(e)&&"widgets"in e}function d(e){return o(e)&&"makeConnection"in e}function u(e){return o(e)&&"addConnectionConf"in e}function p(e){return o(e)&&"sessionPlugins"in e}function m(e){return"object"==typeof e&&null!==e&&"selection"in e&&"setSelection"in e}function g(e){return"object"==typeof e&&null!==e&&"width"in e&&"setWidth"in e}function f(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.trackId}function h(e){return"object"==typeof e&&null!==e&&"configuration"in e&&e.configuration.displayId}function y(e){return"object"==typeof e&&null!==e&&"showTrack"in e&&"hideTrack"in e}function b(e){return"object"==typeof e&&null!==e&&"isAssemblyEditing"in e&&"findAppropriateInternetAccount"in e}function w(e){return"object"==typeof e&&null!==e&&"internetAccounts"in e&&"findAppropriateInternetAccount"in e}function v(e){return"object"==typeof e&&null!==e&&"appendMenu"in e&&"appendToSubMenu"in e}function C(e){return"object"==typeof e&&null!==e&&"uri"in e&&!!e.uri}function S(e){return"object"==typeof e&&null!==e&&"localPath"in e&&!!e.localPath}function k(e){return"object"==typeof e&&null!==e&&"blobId"in e&&!!e.blobId}class T extends Error{constructor(e,t){super(e),this.message=e,this.url=t,this.name="AuthNeededError",Object.setPrototypeOf(this,T.prototype)}}class x extends Error{constructor(e,t){super(e),this.message=e,this.internetAccountId=t,this.name="RetryError"}}function P(e){return e instanceof Error&&("AuthNeededError"===e.name||void 0!==e.url)}function M(e){return"RetryError"===e.name||void 0!==e.internetAccountId}},57440:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(66204);function a(){const e=(0,n.useRef)(null),[t,r]=(0,n.useState)({width:void 0,height:void 0});return(0,n.useEffect)((()=>{if(!e.current)return;const t="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:void 0;if(!t)return;const n=new t((e=>{r({width:e[0].contentRect.width,height:e[0].contentRect.height})}));return n.observe(e.current),()=>{n.disconnect()}}),[]),[e,t]}},45445:(e,t,r)=>{"use strict";r.d(t,{g:()=>o,q:()=>i});var n=r(99247),a=r(47685);function o(e,{timeout:t,signal:r,name:o}={}){return new Promise(((i,s)=>{let l=!1;const c=(0,n.when)(e);let d,u=()=>{};t&&(d=setTimeout((()=>{l||(l=!0,c.cancel(),s(new Error(`timed out waiting for ${o||"whenPresent"}`)))}),t),u=()=>d&&clearTimeout(d)),r&&r.addEventListener("abort",(()=>{l||(l=!0,c.cancel(),u(),s((0,a.fP)()))})),c.then((()=>{l||(l=!0,u(),i(!0))})).catch((e=>{l||(l=!0,u(),s(e))}))}))}async function i(e,t={}){return await o((()=>null!=e()),t),e()}},41814:(e,t,r)=>{"use strict";r.r(t),r.d(t,{cigarToMismatches:()=>u,featurizeSA:()=>P,getClip:()=>T,getLength:()=>S,getLengthOnRef:()=>C,getLengthSansClipping:()=>k,getMethBins:()=>h,getMismatches:()=>m,getModificationPositions:()=>y,getModificationProbabilities:()=>f,getModificationTypes:()=>b,getNextRefPos:()=>g,getOrientedCigar:()=>w,getOrientedMismatches:()=>v,getTag:()=>x,mdToMismatches:()=>p,parseCigar:()=>d});var n=r(90872),a=r(39395);const o=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi),i=new RegExp(/([A-Z])([-+])([^,.?]+)([.?])?/),s=new RegExp(/([MIDNSHPX=])/),l=new RegExp(/(\d+)[SH]$/),c=new RegExp(/^(\d+)([SH])/);function d(e=""){return e.split(s).slice(0,-1)}function u(e,t,r,n){let a=0,o=0;const i=[],s=r&&t;for(let l=0;l<e.length;l+=2){const c=+e[l],d=e[l+1];if("M"===d||"="===d||"E"===d){if(s)for(let e=0;e<c;e++)t[o+e].toUpperCase()!==r[a+e].toUpperCase()&&i.push({start:a+e,type:"mismatch",base:t[o+e],altbase:r[a+e],length:1});o+=c}if("I"===d)i.push({start:a,type:"insertion",base:`${c}`,length:0}),o+=c;else if("D"===d)i.push({start:a,type:"deletion",base:"*",length:c});else if("N"===d)i.push({start:a,type:"skip",base:"N",length:c});else if("X"===d){const e=t?.slice(o,o+c)||[],r=n?.slice(o,o+c)||[];for(let t=0;t<c;t++)i.push({start:a+t,type:"mismatch",base:e[t],qual:r[t],length:1});o+=c}else"H"===d?i.push({start:a,type:"hardclip",base:`H${c}`,cliplen:c,length:1}):"S"===d&&(i.push({start:a,type:"softclip",base:`S${c}`,cliplen:c,length:1}),o+=c);"I"!==d&&"S"!==d&&"H"!==d&&(a+=c)}return i}function p(e,t,r,n,a){let i={start:0,base:"",length:0,type:"mismatch"},s=0,l=0,c=0,d=0;const u=[],p=r.filter((e=>"skip"===e.type));function m(e){let r=l,n=c;for(let a=s;a<t.length&&n<=e;a+=2,s=a){const e=+t[a],o=t[a+1];"S"===o||"I"===o?r+=e:"D"===o||"P"===o||"N"===o?n+=e:"H"!==o&&(r+=e,n+=e)}return l=r,c=n,r-(n-e)}const g=e.match(o)||[];for(const e of g){const t=+e;if(Number.isNaN(t))if(e.startsWith("^"))i.start+=e.length-1;else for(let t=0;t<e.length;t+=1){for(i.length=1;d<p.length;){const e=p[d];if(!(i.start>=e.start))break;i.start+=e.length,d++}const t=m(i.start);i.base=n[t]||"X",i.qual=a?.[t],i.altbase=e,u.push(i),i={start:i.start+i.length,length:0,base:"",type:"mismatch"}}else i.start+=t}return u}function m(e,t,r,n,a){let o=[];const i=d(e);return e&&(o=o.concat(u(i,r,n,a))),t&&r&&(o=o.concat(p(t,i,o,r,a))),o}function*g(e,t){let r=0,n=0,a=0;for(let o=0;o<e.length&&a<t.length;o+=2){const i=+e[o],s=e[o+1];if("S"===s||"I"===s){for(let e=0;e<i&&a<t.length;e++)t[a]===r+e&&a++;r+=i}else if("D"===s||"N"===s)n+=i;else if("M"===s||"X"===s||"="===s){for(let e=0;e<i&&a<t.length;e++)t[a]===r+e&&(yield n+e,a++);r+=i,n+=i}}}function f(e){const t=(0,a.TN)(e,"ML","Ml")||[];return t?("string"==typeof t?t.split(",").map((e=>+e)):t).map((e=>e/255)):(0,a.TN)(e,"MP","Mp")?.split("").map((e=>e.charCodeAt(0)-33)).map((e=>Math.min(1,e/50)))}function h(e){const t=e.get("start"),r=e.get("end"),n=e.get("strand"),o=r-t,i=(0,a.TN)(e,"MM","Mm")||"",s=new Array(o),l=new Array(o),c=e.get("seq");if(c){const t=d(e.get("CIGAR")),r=f(e),a=y(i,c,n);let u=0;for(const{type:e,positions:n}of a)if("m"===e)for(const e of g(t,n)){const t=r?.[u]||0;u++,e>=0&&e<o&&(s[e]=1,l[e]=t)}}return{methBins:s,methProbs:l}}function y(e,t,r){const a=-1===r?(0,n.revcom)(t):t,o=e.split(";").filter((e=>!!e)),s=[];for(const e of o){const[t,...n]=e.split(","),o=t.match(i);if(!o)throw new Error("bad format for MM tag");const[,l,c,d]=o,u=d.split(/(\d+|.)/).filter((e=>!!e));"-"===c&&(console.warn("unsupported negative strand modifications"),s.push({type:"unsupported",positions:[]}));for(const e of u){let t=0;const o=[];for(const e of n){let n=+e;do{"N"!==l&&l!==a[t]||n--,t++}while(n>=0&&t<a.length);const i=t-1;o.push(-1===r?a.length-1-i:i)}-1===r&&o.sort(((e,t)=>e-t)),s.push({type:e,positions:o})}}return s}function b(e){return e.split(";").filter((e=>!!e)).flatMap((t=>{const[r]=t.split(","),n=r.match(i);if(!n)throw new Error(`bad format for MM tag: ${e}`);return n[3].split(/(\d+|.)/).filter((e=>!!e))}))}function w(e,t){if(e){const e=[];for(let r=0;r<t.length;r+=2){const n=t[r];let a=t[r+1];"D"===a?a="I":"I"===a&&(a="D"),e.push(n,a)}return e}return t}function v(e,t){const r=d(t);return u(e?w(e,r):r)}function C(e){const t=d(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"I"!==a&&(r+=n)}return r}function S(e){const t=d(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"D"!==a&&"N"!==a&&(r+=n)}return r}function k(e){const t=d(e);let r=0;for(let e=0;e<t.length;e+=2){const n=+t[e],a=t[e+1];"H"!==a&&"S"!==a&&"D"!==a&&"N"!==a&&(r+=n)}return r}function T(e,t){return-1===t?+(e.match(l)||[])[1]||0:+(e.match(c)||[])[1]||0}function x(e,t){const r=e.get("tags");return r?r[t]:e.get(t)}function P(e,t,r,n,a){return e?.split(";").filter((e=>!!e)).map(((e,o)=>{const[i,s,l,c]=e.split(","),d=C(c),u=S(c),p=k(c),m="-"===l?-1:1,g=T(c,(a?r:1)*m),f=+s-1;return{refName:i,start:f,end:f+d,seqLength:u,clipPos:g,CIGAR:c,strand:(a?r:1)*m,uniqueId:`${t}_SA${o}`,mate:{start:g,end:g+p,refName:n}}}))||[]}},45627:(e,t,r)=>{"use strict";r.d(t,{MismatchParser:()=>F,P1:()=>mt,ZP:()=>bt,Ct:()=>Ke});var n=r(27032),a=r(31640),o=r(43800);const i=(0,o.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",description:"size in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:{type:"frozen",description:"sequence data adapter",defaultValue:null}},{explicitlyTyped:!0}),s=e=>{e.addAdapterType((()=>new a.Z({name:"CramAdapter",displayName:"CRAM adapter",configSchema:i,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(3744),r.e(5192),r.e(794),r.e(484),r.e(6236)]).then(r.bind(r,78409)).then((e=>e.default))})))};var l=r(88196);const c=(0,o.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,o.ConfigurationSchema)("BamIndex",{indexType:{model:l.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",description:"size to fetch in bytes over which to display a warning to the user that too much data will be fetched",defaultValue:5e6},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),d=e=>{e.addAdapterType((()=>new a.Z({name:"BamAdapter",displayName:"BAM adapter",configSchema:c,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(9312),r.e(7843)]).then(r.bind(r,87843)).then((e=>e.default))})))},u=(0,o.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",description:"the base URL to fetch from",defaultValue:""},htsgetTrackId:{type:"string",description:"the trackId, which is appended to the base URL",defaultValue:""},sequenceAdapter:{type:"frozen",description:"sequence data adapter, used to calculate SNPs when BAM reads lacking MD tags",defaultValue:null}},{explicitlyTyped:!0}),p=e=>{e.addAdapterType((()=>new a.Z({name:"HtsgetBamAdapter",displayName:"Htsget BAM adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:u,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(9312),r.e(8015)]).then(r.bind(r,98015)).then((e=>e.default))})))},m=(0,o.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0});function g(e){e.addAdapterType((()=>new a.Z({name:"SNPCoverageAdapter",displayName:"SNPCoverage adapter",adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(3139).then(r.bind(r,13139)).then((e=>e.default)),configSchema:m})))}const f=(0,o.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0},color:{type:"color",description:"Background color for the SNPCoverage renderer",defaultValue:"#d3d3d3"}},{explicitlyTyped:!0});var h=r(35421),y=r(90872),b=r(42207);class w extends b.Aq{async draw(e,t){const{features:r,regions:n,bpPerPx:a,displayCrossHatches:i,modificationTagMap:s={},scaleOpts:l,height:c,theme:d,config:u,ticks:p}=t,m=(0,h.createJBrowseTheme)(d),[g]=n,f=(g.end-g.start)/a,w=b.Rv,v=c-2*w,{domain:C}=l;if(!C)return;const S={...l,range:[0,v]},k=(0,b.yZ)(S),T=(0,b.yZ)({...S,range:[0,v/2],scaleType:"linear"}),x=(0,b.P$)(l.scaleType),P=(0,b.P$)("linear"),M=(0,o.readConfObject)(u,"indicatorThreshold"),E=(0,o.readConfObject)(u,"drawInterbaseCounts"),R=(0,o.readConfObject)(u,"drawArcs"),A=(0,o.readConfObject)(u,"drawIndicators"),I=e=>v-(k(e)||0)+w,F=e=>I(x)-I(e),N=e=>v-(T(e)||0)+w,L=e=>N(P)-N(e),{bases:D}=m.palette,B={A:D.A.main,C:D.C.main,G:D.G.main,T:D.T.main,insertion:"purple",softclip:"blue",hardclip:"red",total:(0,o.readConfObject)(u,"color"),meth:"red",unmeth:"blue"},V=[...r.values()],z=V.filter((e=>"skip"!==e.get("type"))),O=V.filter((e=>"skip"===e.get("type")));e.fillStyle=B.total;for(const t of z){const[r,n]=(0,y.featureSpanPx)(t,g,a),o=n-r+.6,i=t.get("score");e.fillRect(r,I(i),o,F(i))}let Z=0;const j=g.reversed?1/a:0;for(const t of z){const[r,n]=(0,y.featureSpanPx)(t,g,a),o=t.get("score"),i=t.get("snpinfo"),l=Math.max(n-r,1),c=i.total,d=Object.keys(i.cov).sort();let u=0;for(const t of d){const{total:n}=i.cov[t];e.fillStyle=B[t]||s[t.replace("mod_","")]||"black";const a=F(o),c=I(o)+a;e.fillRect(Math.round(r),c-(n+u)/o*a,l,n/o*a),u+=n}const p=Object.keys(i.noncov),m=4.5;if(E){let t=0;for(const n of p){const{total:a}=i.noncov[n],o=.6;e.fillStyle=B[n],e.fillRect(r-o+j,m+L(t),2*o,L(a)),t+=a}}if(A){let t=0,n=0,a="";for(const e of p){const{total:r}=i.noncov[e];t+=r,r>n&&(n=r,a=e)}const o=Math.max(c,Z);if(t>o*M&&o>7){e.fillStyle=B[a],e.beginPath();const t=r+j;e.moveTo(t-3.5,0),e.lineTo(t+3.5,0),e.lineTo(t,m),e.fill()}}Z=c}if(R)for(const t of O){const[r,n]=(0,y.bpSpanPx)(t.get("start"),t.get("end"),g,a);e.beginPath();const o=t.get("strand"),i=t.get("xs"),s="rgba(255,200,200,0.7)",l="rgba(200,200,255,0.7)",c="rgba(200,200,200,0.7)";e.strokeStyle="+"===i?s:"-"===i?l:1===o?s:-1===o?l:c,e.lineWidth=Math.log(t.get("score")+1),e.moveTo(r,v-2*w),e.bezierCurveTo(r,0,n,0,n,v-2*w),e.stroke()}i&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",p.values.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(I(t))),e.lineTo(f,Math.round(I(t))),e.stroke()})))}}function v(e){e.addRendererType((()=>new w({name:"SNPCoverageRenderer",ReactComponent:b.Eh,configSchema:f,pluginManager:e})))}var C=r(18930),S=r(93912),k=r(28926),T=r.n(k);class x extends C.LayoutSession{showSoftClip=!1;constructor(e){super(e),this.config=e.config}cachedLayoutIsValid(e){return super.cachedLayoutIsValid(e)&&this.showSoftClip===e.showSoftClip&&T()(this.sortedBy,e.sortedBy)&&T()(this.filterBy,e.filterBy)}get layout(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,o.readConfObject)(this.config),filters:this.filters,filterBy:this.filterBy,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}var P=r(39395);function M(e,t,r,n,a,o,i){t+n<0||t>o||(i&&(e.fillStyle=i),e.fillRect(t,r,n,a))}function E(e){const{bases:t}=e.palette;return{A:t.A.main,C:t.C.main,G:t.G.main,T:t.T.main,deletion:"#808080"}}function R(){return{charWidth:(0,y.measureText)("A"),charHeight:(0,y.measureText)("M")-2}}var A=r(69349);function I({colorType:e,tag:t,feature:r,config:n,defaultColor:a,colorTagMap:i}){switch(e){case"insertSize":return function(e){return e.get("is_paired")&&e.get("refName")!==e.get("next_ref")?"#555":`hsl(${Math.abs(e.get("template_length"))/10},50%,50%)`}(r);case"strand":return function(e){return-1===e.get("strand")?"#8F8FD8":"#EC8B8B"}(r);case"mappingQuality":return function(e){return`hsl(${e.get("score")},50%,50%)`}(r);case"pairOrientation":return function(e,t){return A.If[function(e,t){const r=(0,o.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[P.uD[r][e.get("pair_orientation")]]}(e,t)||"color_nostrand"]}(r,n);case"stranded":return function(e){return A.If[function(e){const t=e.get("flags"),r=e.get("strand");if(1&t){const n=64&t?-1:1;return 2&t?r*n==1?"color_rev_strand":"color_fwd_strand":8&t?r*n==1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("refName")===e.get("next_ref")?r*n==1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return"color_unknown"}(e)]}(r);case"xs":case"tag":{const e=r.get("tags"),n=e?e[t]:r.get(t);return"XS"===t||"TS"===t?A.If[{"-":"color_rev_strand","+":"color_fwd_strand"}[n]||"color_nostrand"]:"ts"===t?A.If[{"-":-1===r.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===r.get("strand")?"color_rev_strand":"color_fwd_strand"}[n]||"color_nostrand"]:i[n]||A.If.color_nostrand}case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":return 16&r.get("flags")?"#c8dcc8":"#c8c8c8";default:return a?"lightgrey":(0,o.readConfObject)(n,"color",{feature:r})}}var F=r(41814),N=r(622);function L({ctx:e,feat:t,renderArgs:r,colorForBase:n,contrastForBase:a,charWidth:o,charHeight:i,defaultColor:s,canvasWidth:l}){const{config:c,bpPerPx:d,regions:u,colorBy:p,colorTagMap:m={}}=r,{tag:g="",type:f=""}=p||{},{feature:h}=t,b=u[0];switch(e.fillStyle=I({feature:h,config:c,tag:g,defaultColor:s,colorType:f,colorTagMap:m}),function({ctx:e,feat:t,renderArgs:r}){const{regions:n,bpPerPx:a}=r,{heightPx:o,topPx:i,feature:s}=t,[l]=n,c=s.get("start"),d=s.get("end"),[u,p]=(0,y.bpSpanPx)(c,d,l,a),m=l.reversed?-1:1,g=s.get("strand")*m;a<10&&o>5?-1===g?(e.beginPath(),e.moveTo(u-5,i+o/2),e.lineTo(u,i+o),e.lineTo(p,i+o),e.lineTo(p,i),e.lineTo(u,i),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(u,i),e.lineTo(u,i+o),e.lineTo(p,i+o),e.lineTo(p+5,i+o/2),e.lineTo(p,i),e.closePath(),e.fill()):e.fillRect(u,i,p-u,o)}({ctx:e,feat:t,renderArgs:r}),f){case"perBaseQuality":!function({ctx:e,feat:t,region:r,bpPerPx:n,canvasWidth:a}){const{feature:o,topPx:i,heightPx:s}=t,l=(o.get("qual")||"").split(" ").map((e=>+e)),c=(0,F.parseCigar)(o.get("CIGAR")),d=1/n,u=o.get("start");let p=0,m=0;for(let t=0;t<c.length;t+=2){const o=+c[t],g=c[t+1];if("S"===g||"I"===g)p+=o;else if("D"===g||"N"===g)m+=o;else if("M"===g||"X"===g||"="===g){for(let t=0;t<o;t++){const o=l[p+t],c=u+m+t;M(e,(0,y.bpSpanPx)(c,c+1,r,n)[0],i,d+.5,s,a,`hsl(${255===o?150:1.5*o},55%,50%)`)}p+=o,m+=o}}}({ctx:e,feat:t,region:b,bpPerPx:d,canvasWidth:l});break;case"perBaseLettering":!function({ctx:e,feat:t,region:r,bpPerPx:n,colorForBase:a,contrastForBase:o,charWidth:i,charHeight:s,canvasWidth:l}){const c=s-2,{feature:d,topPx:u,heightPx:p}=t,m=d.get("seq"),g=(0,F.parseCigar)(d.get("CIGAR")),f=1/n,h=d.get("start");let b=0,w=0;if(m)for(let t=0;t<g.length;t+=2){const s=+g[t],d=g[t+1];if("S"===d||"I"===d)b+=s;else if("D"===d||"N"===d)w+=s;else if("M"===d||"X"===d||"="===d){for(let t=0;t<s;t++){const s=m[b+t],d=h+w+t,[g]=(0,y.bpSpanPx)(d,d+1,r,n);M(e,g,u,f+.5,p,l,a[s]),f>=i&&p>=c&&(e.fillStyle=o[s],e.fillText(s,g+(f-i)/2+1,u+p))}b+=s,w+=s}}}({ctx:e,feat:t,region:b,bpPerPx:d,colorForBase:n,contrastForBase:a,charWidth:o,charHeight:i,canvasWidth:l});break;case"modifications":!function({ctx:e,feat:t,region:r,bpPerPx:n,renderArgs:a,canvasWidth:o}){const{feature:i,topPx:s,heightPx:l}=t,{modificationTagMap:c={}}=a,d=i.get("seq");if(!d)return;const u=(0,P.TN)(i,"MM","Mm")||"",p=i.get("CIGAR"),m=i.get("start"),g=i.get("strand"),f=(0,F.parseCigar)(p),h=(0,F.getModificationProbabilities)(i),b=(0,F.getModificationPositions)(u,d,g);let w=0;for(const{type:t,positions:a}of b){const i=c[t]||"black",d=(0,N.V)(i);for(const t of(0,F.getNextRefPos)(f,a)){const a=m+t,[c,u]=(0,y.bpSpanPx)(a,a+1,r,n),p=h?.[w]||0;M(e,c,s,u-c+.5,l,o,1!==p?d.alpha(p+.1).toHslString():i),w++}}}({ctx:e,feat:t,region:b,bpPerPx:d,renderArgs:r,canvasWidth:l});break;case"methylation":!function({ctx:e,feat:t,region:r,bpPerPx:n,renderArgs:a,canvasWidth:o}){const{regionSequence:i}=a,{feature:s,topPx:l,heightPx:c}=t;if(!i)throw new Error("region sequence required for methylation");if(!s.get("seq"))return;const d=s.get("start"),u=s.get("end"),{methBins:p,methProbs:m}=(0,F.getMethBins)(s);function g(e){if(p[e]){const t=m[e]||0;return(t>.5?(0,N.V)("red").alpha(2*(t-.5)):(0,N.V)("blue").alpha(1-2*t)).toHslString()}}for(let t=0;t<u-d;t++){const a=t+d,s=i[a-r.start+1]?.toLowerCase(),u=i[a-r.start+2]?.toLowerCase();if("c"===s&&"g"===u)if(n>2){const[i,s]=(0,y.bpSpanPx)(a,a+2,r,n);M(e,i,l,s-i+.5,c,o,g(t)||g(t+1)||"blue")}else{const[i,s]=(0,y.bpSpanPx)(a,a+1,r,n);M(e,i,l,s-i+.5,c,o,g(t)||"blue");const[d,u]=(0,y.bpSpanPx)(a+1,a+2,r,n);M(e,d,l,u-d+.5,c,o,g(t+1)||"blue")}}}({ctx:e,feat:t,region:b,bpPerPx:d,renderArgs:r,canvasWidth:l})}}function D({ctx:e,feat:t,renderArgs:r,minSubfeatureWidth:n,largeInsertionIndicatorScale:a,mismatchAlpha:o,charWidth:i,charHeight:s,colorForBase:l,contrastForBase:c,canvasWidth:d,drawSNPsMuted:u,drawIndels:p=!0}){const{bpPerPx:m,regions:g}=r,{heightPx:f,topPx:h,feature:b}=t,[w]=g,v=b.get("start"),C=Math.min(1/m,2),S=b.get("mismatches"),k=s-2,T=w.reversed?1/m+1:-1;if(S){for(const t of S){const r=v+t.start,a=t.length,s=t.base,[g,b]=(0,y.bpSpanPx)(r,r+a,w,m),S=Math.max(n,Math.abs(g-b));if("mismatch"===t.type){if(!u){const r=l[t.base]||"#888",n=o?void 0===t.qual?r:(0,N.V)(r).alpha(Math.min(1,t.qual/50)).toHslString():r;M(e,Math.round(g),h,S,f,d,n)}if(S>=i&&f>=k){const r=u?"black":c[t.base]||"black";e.fillStyle=o?void 0===t.qual?r:(0,N.V)(r).alpha(Math.min(1,t.qual/50)).toHslString():r,e.fillText(s,g+(S-i)/2+1,h+f)}}else if("deletion"===t.type&&p){M(e,g,h,Math.abs(g-b),f,d,l.deletion);const r=`${t.length}`,n=(0,y.measureText)(r,10);S>=n&&f>=k&&(e.fillStyle=c.deletion,e.fillText(r,(g+b)/2-n/2,h+f))}else if("insertion"===t.type&&p){e.fillStyle="purple";const r=g+T,n=+t.base||t.length,a=Math.max(0,Math.min(1.2,1/m));if(n<10&&(M(e,r,h,a,f,d,"purple"),1/m>=i&&f>=k)){const n=r-a;M(e,n,h,3*a,1,d),M(e,n,h+f-1,3*a,1,d),e.fillText(`(${t.base})`,r+3,h+f)}}else if("hardclip"===t.type||"softclip"===t.type){const r=g+T,a="hardclip"===t.type?"red":"blue",o=Math.max(n,C);if(M(e,r,h,o,f,d,a),1/m>=i&&f>=k){const n=r-o;M(e,n,h,3*o,1,d),M(e,n,h+f-1,3*o,1,d),e.fillText(`(${t.base})`,r+3,h+f)}}else if("skip"===t.type&&g+S>0){const t=S-(m>10?1.5:0);e.clearRect(g,h,t,f),M(e,Math.max(0,g),h+f/2-1,t+(g<0?g:0),2,d,"#333")}}if(p)for(const t of S){const r=v+t.start,n=t.length,[o]=(0,y.bpSpanPx)(r,r+n,w,m),i=+t.base||t.length,l=`${i}`;if("insertion"===t.type&&i>=10)if(m>a)M(e,o-1,h,2,f,d,"purple");else if(f>s){const t=(0,y.measureText)(l),r=5;M(e,o-t/2-r,h,t+2*r,f,d,"purple"),e.fillStyle="white",e.fillText(l,o-t/2,h+f)}else{const t=2;M(e,o-t,h,2*t,f,d,"purple")}}}}function B({ctx:e,feat:t,renderArgs:r,config:n,theme:a,colorForBase:i,canvasWidth:s}){const{feature:l,topPx:c,heightPx:d}=t,{regions:u,bpPerPx:p}=r,[m]=u,g=(0,o.readConfObject)(n,"minSubfeatureWidth"),f=l.get("mismatches"),h=l.get("seq"),{charWidth:b,charHeight:w}=R();if(!h||!f)return;const v=w-2;for(const t of f)if("softclip"===t.type){const r=t.cliplen||0,n=l.get("start"),o=0===t.start?n-r:n+t.start;for(let n=0;n<r;n+=1){const r=h.charAt(n+t.start);if(!r)return;const l=o+n,[u,f]=(0,y.bpSpanPx)(l,l+1,m,p),w=Math.max(g,f-u),C=i[r]||"#000000";e.fillStyle=C,M(e,u,c,w,d,s),w>=b&&d>=v&&(e.fillStyle=a.palette.getContrastText(C),e.fillText(r,u+(w-b)/2+1,c+d))}}}class V extends C.default{supportsSVG=!0;async fetchSequence(e){const{sessionId:t,regions:r,adapterConfig:n}=e,{sequenceAdapter:a}=n;if(!a)return;const o=this.pluginManager,{dataAdapter:i}=await(0,S.uP)(o,t,a),[s]=r;return(0,P.O)(s,i)}getExpandedRegion(e,t){const{config:r,showSoftClip:n}=t,{start:a,end:i}=e,s=(0,o.readConfObject)(r,"maxClippingSize"),l=n?Math.round(s):0;return{...e,start:Math.floor(Math.max(a-l,0)),end:Math.ceil(i+l)}}async render(e){const t=await this.getFeatures(e),r=this.createLayoutInWorker(e),{regions:n,bpPerPx:a}=e,[i]=n,s=function(e){const{layout:t,features:r,sortedBy:n,config:a,bpPerPx:i,showSoftClip:s,regions:l}=e,[c]=l;if(!t)throw new Error("layout required");if(!t.addRect)throw new Error("invalid layout object");const d=n?.type&&c.start===n.pos?((e,t)=>{const r=Array.from(e.values()),n=[],a=[],{pos:o,type:i}=t;r.forEach((e=>{const t=e,r=t.get("start"),i=t.get("end");(0,y.doesIntersect2)(o-1,o,r,i)?n.push(e):a.push(e)}));const s=!!r.length&&r[0].get("tags");switch(i){case"Start location":n.sort(((e,t)=>e.get("start")-t.get("start")));break;case"tag":{const e=t.tag,r=(e,t)=>s?e.get("tags")[t]:e.get(t);n[0]&&"string"==typeof r(n[0],e)?n.sort(((t,n)=>r(n,e).localeCompare(r(t,e)))):n.sort(((t,n)=>(r(n,e)||0)-(r(t,e)||0)));break}case"Base pair":{const e=[];n.forEach((t=>{t.get("mismatches").forEach((r=>{const n=t.get("start")+r.start+1,a="insertion"===r.type||"softclip"===r.type?0:r.length;o>=n&&o<n+a&&e.push([t.id(),r])}))}));const t=new Map(e);n.sort(((e,r)=>{const n=t.get(e.id()),a=t.get(r.id()),o=a?.base.toUpperCase(),i=n?.base.toUpperCase();return o===i&&"*"===o?n.length-a.length:(o?o.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break}case"Read strand":n.sort(((e,t)=>e.get("strand")<=t.get("strand")?1:-1))}return new Map([...n,...a].map((e=>[e.id(),e])))})(r,n):r,u=(0,o.readConfObject)(a,"height"),p=(0,o.readConfObject)(a,"displayMode");return(0,y.iterMap)(d.values(),(e=>function({feature:e,layout:t,bpPerPx:r,region:n,showSoftClip:a,heightPx:o,displayMode:i}){let s=0,l=0;if(a){const t=e.get("mismatches");if(e.get("seq"))for(const{type:e,start:r,cliplen:n=0}of t)"softclip"===e&&(0===r?s=n:l=n)}const[c,d]=(0,y.bpSpanPx)(e.get("start")-s,e.get("end")+l,n,r);if("compact"===i&&(o/=3),e.get("refName")!==n.refName)throw new Error(`feature ${e.id()} is not on the current region's reference sequence ${n.refName}`);const u=t.addRect(e.id(),e.get("start")-s,e.get("end")+l,o,e);return null===u?null:{feature:e,leftPx:c,rightPx:d,topPx:"collapse"===i?0:u,heightPx:o}}({feature:e,layout:t,bpPerPx:i,region:c,showSoftClip:s,heightPx:u,displayMode:p})),d.size)}({...e,features:t,layout:r}),l=t.size&&(0,P.ES)(e.colorBy?.type)?await this.fetchSequence(e):void 0,c=(i.end-i.start)/a,d=Math.max(r.getTotalHeight(),1),u=await(0,y.renderToAbstractCanvas)(c,d,e,(n=>function({ctx:e,layoutRecords:t,canvasWidth:r,renderArgs:n}){const{config:a,showSoftClip:i,colorBy:s,theme:l}=n,c=(0,o.readConfObject)(a,"mismatchAlpha"),d=(0,o.readConfObject)(a,"minSubfeatureWidth"),u=(0,o.readConfObject)(a,"largeInsertionIndicatorScale"),p="#f0f"===(0,o.readConfObject)(a,"color"),m=(0,h.createJBrowseTheme)(l),g=E(m),f=function(e){return Object.fromEntries(Object.entries(E(e)).map((([t,r])=>[t,e.palette.getContrastText(r)])))}(m);e.font="bold 10px Courier New,monospace";const{charWidth:y,charHeight:b}=R(),w=(v=s?.type,["methylation","modifications"].includes(v||""));var v;for(const o of t)L({ctx:e,feat:o,renderArgs:n,defaultColor:p,colorForBase:g,contrastForBase:f,charWidth:y,charHeight:b,canvasWidth:r}),D({ctx:e,feat:o,renderArgs:n,mismatchAlpha:c,drawSNPsMuted:w,drawIndels:!0,largeInsertionIndicatorScale:u,minSubfeatureWidth:d,charWidth:y,charHeight:b,colorForBase:g,contrastForBase:f,canvasWidth:r}),i&&B({ctx:e,feat:o,renderArgs:n,colorForBase:g,config:a,theme:m,canvasWidth:r})}({ctx:n,layoutRecords:s.filter(y.notEmpty),canvasWidth:c,renderArgs:{...e,layout:r,features:t,regionSequence:l}})));return{...await super.render({...e,...u,features:t,layout:r,height:d,width:c}),...u,features:new Map,layout:r,height:d,width:c,maxHeightReached:r.maxHeightReached}}createSession(e){return new x(e)}}const z=(0,o.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:l.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orientation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:l.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing/decreasing mismatch marker widths when zoomed out, e.g. 0 or 1",defaultValue:1},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});var O=r(66204),Z=r(80846);function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j.apply(this,arguments)}const W=(0,Z.observer)((function(e){const{onMouseMove:t,blockKey:r,displayModel:n,width:a,height:o,regions:i,bpPerPx:s,sortedBy:l,colorBy:c,filterBy:d}=e,{selectedFeatureId:u,featureIdUnderMouse:p,contextMenuFeature:m}=n,[g]=i,f=(0,O.useRef)(null),[b,w]=(0,O.useState)(!1),[v,C]=(0,O.useState)(!1);function S(t,r){const n=e[`onFeature${t}`],a=e[`on${t}`];n&&p?n(r,p):a&&a(r,p)}(0,O.useEffect)((()=>{const e=f.current;if(!e)return;const t=e.getContext("2d");if(!t)return;t.clearRect(0,0,e.width,e.height);const a=u?n.getFeatureByID?.(r,u):void 0;if(a){const[e,r,n,o]=a,[i,l]=(0,y.bpSpanPx)(e,n,g,s),c=Math.round(r),d=Math.round(o-r);t.shadowColor="#222266",t.shadowBlur=10,t.lineJoin="bevel",t.lineWidth=2,t.strokeStyle="#00b8ff",t.strokeRect(i-2,c-2,l-i+4,d+4),t.clearRect(i,c,l-i,d)}const o=p||m?.id(),i=o?n.getFeatureByID?.(r,o):void 0;if(i){const[e,r,n,a]=i,[o,l]=(0,y.bpSpanPx)(e,n,g,s),c=Math.round(r),d=Math.round(a-r);t.fillStyle="#0003",t.fillRect(o,c,l-o,d)}}),[s,g,r,u,n,p,m]);const k=Math.ceil(a);return O.createElement("div",{"data-testid":`pileup-${[l?.type,c?.type,c?.tag,d?.tagFilter?.tag].filter((e=>!!e)).join("-")}`,style:{position:"relative",width:k,height:o}},O.createElement(h.PrerenderedCanvas,j({},e,{style:{position:"absolute",left:0,top:0}})),O.createElement("canvas",{"data-testid":"pileup_overlay_canvas",width:k,height:o+100,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:f,onMouseDown:e=>function(e){w(!0),C(!1),S("MouseDown",e)}(e),onMouseEnter:e=>function(e){S("MouseEnter",e)}(e),onMouseOut:e=>function(e){S("MouseOut",e),S("MouseLeave",e)}(e),onMouseOver:e=>function(e){S("MouseOver",e)}(e),onMouseUp:e=>function(e){w(!1),S("MouseUp",e)}(e),onMouseLeave:e=>function(e){S("MouseOut",e),S("MouseLeave",e)}(e),onMouseMove:e=>function(e){if(!f.current)return;b&&C(!0);const o=f.current.getBoundingClientRect(),i=e.clientX-o.left,l=e.clientY-o.top,c=g.reversed?a-i:i,d=g.start+s*c;t?.(e,n.getFeatureOverlapping(r,d,l))}(e),onClick:e=>function(e){v||S("Click",e)}(e),onContextMenu:e=>function(e){S("ContextMenu",e)}(e),onFocus:()=>{},onBlur:()=>{}}))}));function $(e){e.addRendererType((()=>new V({name:"PileupRenderer",displayName:"Pileup renderer",ReactComponent:W,configSchema:z,pluginManager:e})))}var H=r(63048),G=r(4592),q=r(99247),U=r(72271);function _(e){return e.getDisplayElements().filter((e=>"LinearAlignmentsDisplay"===e.subDisplay?.type)).filter((e=>e.subDisplay?.lowerPanel))}function J(e,t){return T()(e?(0,l.getSnapshot)(e):void 0,t?(0,l.getSnapshot)(t):void 0)}function X(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;return t||(0,l.isAlive)(t)||r||(0,l.isAlive)(r)}const Y=function(e,t){return l.types.compose("LinearAlignmentsDisplay",U.BaseDisplay,function(e,t){const r=_(e).map((e=>e.stateModel));return l.types.model({PileupDisplay:l.types.maybe(l.types.union(...r)),SNPCoverageDisplay:l.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:l.types.literal("LinearAlignmentsDisplay"),configuration:(0,o.ConfigurationReference)(t),heightPreConfig:l.types.maybe(l.types.number),userFeatureScreenDensity:l.types.maybe(l.types.number),lowerPanelType:"LinearPileupDisplay"})}(e,t)).volatile((()=>({scrollTop:0}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setSNPCoverageHeight(t){e.snpCovHeight=t}}))).views((e=>({get height(){return e.heightPreConfig??(0,o.getConf)(e,"height")},get featureIdUnderMouse(){return e.PileupDisplay.featureIdUnderMouse||e.SNPCoverageDisplay.featureIdUnderMouse}}))).views((e=>({get pileupConf(){return{...(0,o.getConf)(e,"pileupDisplay"),type:e.lowerPanelType,displayId:`${e.configuration.displayId}_${e.lowerPanelType}_xyz`}},getFeatureByID:(t,r)=>e.PileupDisplay.getFeatureByID(t,r),searchFeatureByID:t=>e.PileupDisplay.searchFeatureByID?.(t),get features(){return e.PileupDisplay.features},get DisplayBlurb(){return e.PileupDisplay?.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get coverageConf(){return{...(0,o.getConf)(e,"snpCoverageDisplay"),displayId:`${e.configuration.displayId}_snpcoverage_xyz`}}}))).actions((e=>({setSNPCoverageDisplay(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setFeatureDensityStatsLimit(t){e.PileupDisplay.setFeatureDensityStatsLimit(t),e.SNPCoverageDisplay.setFeatureDensityStatsLimit(t)},setPileupDisplay(t){e.PileupDisplay={type:t.type||"LinearPileupDisplay",configuration:t}},setHeight:t=>(e.heightPreConfig=Math.max(t,20),e.heightPreConfig),setLowerPanelType(t){e.lowerPanelType=t},resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r}}))).actions((e=>({afterAttach(){(0,l.addDisposer)(e,(0,q.autorun)((()=>{const{SNPCoverageDisplay:t,PileupDisplay:r,coverageConf:n,pileupConf:a}=e;t?T()(n,(0,l.getSnapshot)(t.configuration))||(t.setHeight(e.snpCovHeight),t.setConfig(e.coverageConf)):e.setSNPCoverageDisplay(n),r&&e.lowerPanelType===r.type?T()(a,(0,l.getSnapshot)(r.configuration))||r.setConfig(e.pileupConf):e.setPileupDisplay(a),function(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;X(e)&&t.colorBy&&(J(t.colorBy,r.colorBy)||r.setColorBy((0,l.getSnapshot)(t.colorBy)))}(e),function(e){const{PileupDisplay:t,SNPCoverageDisplay:r}=e;X(e)&&t.filterBy&&(J(t.filterBy,r.filterBy)||r.setFilterBy((0,l.getSnapshot)(t.filterBy)))}(e)}))),(0,l.addDisposer)(e,(0,q.autorun)((()=>{e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)}))),(0,l.addDisposer)(e,(0,q.autorun)((()=>{e.PileupDisplay.setHeight(e.height-e.SNPCoverageDisplay.height)})))},async renderSvg(t){const r=e.height-e.SNPCoverageDisplay.height;return await(0,q.when)((()=>!e.PileupDisplay.renderProps().notReady&&!e.SNPCoverageDisplay.renderProps().notReady)),O.createElement(O.Fragment,null,O.createElement("g",null,await e.SNPCoverageDisplay.renderSvg(t)),O.createElement("g",{transform:`translate(0 ${e.SNPCoverageDisplay.height})`},await e.PileupDisplay.renderSvg({...t,overrideHeight:r})))}}))).views((t=>{const{trackMenuItems:r}=t;return{trackMenuItems(){if(!t.PileupDisplay)return[];const n=_(e).map((e=>({type:"radio",label:e.displayName,checked:e.name===t.PileupDisplay.type,onClick:()=>t.setLowerPanelType(e.name)})));return[...r(),{type:"subMenu",label:"Pileup settings",subMenu:t.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:t.SNPCoverageDisplay.trackMenuItems()},{type:"subMenu",label:"Replace lower panel with...",subMenu:n}]}}})).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...r}=e;return{heightPreConfig:t,...r}}))};var K=r(38684);const Q=(0,K.ZL)()({resizeHandle:{height:5,position:"absolute",zIndex:2}}),ee=(0,Z.observer)((function({model:e}){const{PileupDisplay:t,SNPCoverageDisplay:r}=e,{classes:n}=Q();if(!r)return null;const a=r.height??100;return O.createElement("div",{"data-testid":`display-${(0,o.getConf)(e,"displayId")}`,style:{position:"relative"}},O.createElement("div",{"data-testid":"Blockset-snpcoverage"},O.createElement(r.RenderingComponent,{model:r})),O.createElement(h.ResizeHandle,{onDrag:e=>(r.setHeight(r.height+e),e),className:n.resizeHandle,style:{top:a-4}}),O.createElement("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:a}},O.createElement(t.RenderingComponent,{model:t})))})),te=ee;function re(e){e.addDisplayType((()=>{const t=(r=e,(0,o.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:r.getDisplayType("LinearPileupDisplay").configSchema,snpCoverageDisplay:r.getDisplayType("LinearSNPCoverageDisplay").configSchema,height:{type:"number",defaultValue:250}},{baseConfiguration:G.fU,explicitlyTyped:!0}));var r;return new H.Z({name:"LinearAlignmentsDisplay",displayName:"Alignments display (combination)",configSchema:t,stateModel:Y(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:te})}))}var ne=r(15974);function ae(){return ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ae.apply(this,arguments)}const oe=e=>e.toLocaleString("en-US"),ie=(e,t)=>`${((e=0)=>+(+e).toFixed(1))(e/(t||1)*100)}%`,se=O.forwardRef((function({feature:e},t){const r=e.get("start"),n=e.get("end"),a=e.get("refName"),{refbase:o,all:i,total:s,ref:l,"-1":c,1:d,0:u,...p}=e.get("snpinfo"),m=[a,r===n?oe(r):`${oe(r)}..${oe(n)}`].filter((e=>!!e)).join(":");return O.createElement("div",{ref:t},O.createElement("table",null,O.createElement("caption",null,m),O.createElement("thead",null,O.createElement("tr",null,O.createElement("th",null,"Base"),O.createElement("th",null,"Count"),O.createElement("th",null,"% of Total"),O.createElement("th",null,"Strands"),O.createElement("th",null,"Source"))),O.createElement("tbody",null,O.createElement("tr",null,O.createElement("td",null,"Total"),O.createElement("td",null,i)),O.createElement("tr",null,O.createElement("td",null,"REF ",o?`(${o.toUpperCase()})`:""),O.createElement("td",null,l),O.createElement("td",null,ie(l,i)),O.createElement("td",null,c?`${c}(-)`:"",d?`${d}(+)`:""),O.createElement("td",null)),Object.entries(p).map((([e,t])=>Object.entries(t).map((([t,r])=>O.createElement("tr",{key:t},O.createElement("td",null,t.toUpperCase()),O.createElement("td",null,r.total),O.createElement("td",null,"total"===t||"skip"===t?"---":ie(r.total,i)),O.createElement("td",null,r[-1]?`${r[-1]}(-)`:"",r[1]?`${r[1]}(+)`:""),O.createElement("td",null,e)))))))))})),le=(0,Z.observer)((e=>{const{model:t}=e,{featureUnderMouse:r}=t;return r&&"skip"===r.get("type")?null:O.createElement(b.u,ae({TooltipContents:se},e))})),ce=le;var de=r(99512);async function ue(e,t,r,n,a){const{rpcManager:o}=(0,y.getSession)(e),i=(0,de.getRpcSessionId)(e);return await o.call(i,"PileupGetVisibleModifications",{adapterConfig:t,tag:r.tag,sessionId:i,regions:n.contentBlocks,...a})}const pe=l.types.model({flagInclude:l.types.optional(l.types.number,0),flagExclude:l.types.optional(l.types.number,1540),readName:l.types.maybe(l.types.string),tagFilter:l.types.maybe(l.types.model({tag:l.types.string,value:l.types.string}))}),me=new Map([["snpcoverage","SNPCoverageRenderer"]]),ge=function(e,t){return l.types.compose("LinearSNPCoverageDisplay",(0,b.LT)(e,t),l.types.model({type:l.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:l.types.maybe(l.types.boolean),drawIndicators:l.types.maybe(l.types.boolean),drawArcs:l.types.maybe(l.types.boolean),filterBy:l.types.optional(pe,{}),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string)})),jexlFilters:l.types.optional(l.types.array(l.types.string),[])})).volatile((()=>({modificationTagMap:q.observable.map({}),modificationsReady:!1}))).actions((e=>({setConfig(t){e.configuration=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setColorBy(t){e.colorBy=(0,l.cast)(t)},setJexlFilters(t){e.jexlFilters=(0,l.cast)(t)},updateModificationColorMap(t){t.forEach((t=>{e.modificationTagMap.has(t)||e.modificationTagMap.set(t,P.b4[t]||(0,P.p)())}))}}))).views((e=>{const{renderProps:t}=e;return{get rendererConfig(){const t=(0,o.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create({...t,drawInterbaseCounts:e.drawInterbaseCounts??t.drawInterbaseCounts,drawIndicators:e.drawIndicators??t.drawIndicators,drawArcs:e.drawArcs??t.drawArcs},(0,l.getEnv)(e))},get drawArcsSetting(){return e.drawArcs??(0,o.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){return e.drawInterbaseCounts??(0,o.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return e.drawIndicators??(0,o.readConfObject)(this.rendererConfig,"drawIndicators")},get autorunReady(){return(0,y.getContainingView)(e).initialized&&e.featureDensityStatsReady&&!e.regionTooLarge&&!e.error},get renderReady(){return!t().notReady&&e.modificationsReady},get ready(){return this.renderReady},renderProps(){const r=t(),{colorBy:n,filterBy:a,modificationTagMap:o}=e;return{...r,notReady:!this.ready,filters:e.filters,modificationTagMap:Object.fromEntries(o.toJSON()),colorBy:n?(0,l.getSnapshot)(n):void 0,filterBy:a?(0,l.getSnapshot)(a):void 0}}}})).actions((e=>({setModificationsReady(t){e.modificationsReady=t},toggleDrawIndicators(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs(){e.drawArcs=!e.drawArcsSetting}}))).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{if(e.setModificationsReady(!1),!e.autorunReady)return;const t=(0,y.getContainingView)(e),{staticBlocks:r}=t,{colorBy:n}=e;if("modifications"===n?.type){const t=(0,o.getConf)(e.parentTrack,"adapter"),a=await ue(e,t,n,r);(0,l.isAlive)(e)&&(e.updateModificationColorMap(a),e.setModificationsReady(!0))}else e.setModificationsReady(!0)}),{delay:1e3})}}))).views((e=>{const{trackMenuItems:t}=e;return{get TooltipComponent(){return ce},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,o.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return me.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:()=>[],trackMenuItems:()=>[...t(),{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:()=>e.toggleDrawIndicators()},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:()=>e.toggleDrawInterbaseCounts()},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:()=>e.toggleDrawArcs()}],get filters(){return new ne.Z({filters:e.jexlFilters})}}}))};function fe(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:l.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:l.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:e.getRendererType("SNPCoverageRenderer").configSchema})},{baseConfiguration:G.fU,explicitlyTyped:!0})}(e);return new H.Z({name:"LinearSNPCoverageDisplay",displayName:"SNPCoverage display",configSchema:t,stateModel:ge(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:b.Xl})}))}const he=(0,K.ZL)()((e=>({loading:{backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${e.palette.action.disabledBackground} 5px, ${e.palette.action.disabledBackground} 10px)`,position:"absolute",bottom:0,height:50,width:300,right:0,pointerEvents:"none",textAlign:"center"}}))),ye=(0,Z.observer)((function({model:e,children:t}){const{error:r,regionTooLarge:n}=e;return r?O.createElement(G.rK,{message:`${r}`,severity:"error",buttonText:"Reload",action:e.reload}):n?e.regionCannotBeRendered():O.createElement(be,{model:e},t)})),be=(0,Z.observer)((function({model:e,children:t}){const{drawn:r,loading:n}=e,a=(0,y.getContainingView)(e),o=(e.lastDrawnOffsetPx||0)-a.offsetPx;return O.createElement("div",{"data-testid":`drawn-${r}`},O.createElement("div",{style:{position:"absolute",left:o}},t),0!==o||n?O.createElement(we,{model:e}):null)})),we=(0,Z.observer)((function({model:e}){const{classes:t}=he(),{message:r}=e;return O.createElement("div",{className:t.loading},O.createElement(h.LoadingEllipses,{message:r}))})),ve=ye,Ce=(0,Z.observer)((function({model:e}){const t=(0,y.getContainingView)(e),r=Math.round(t.dynamicBlocks.totalWidthPx),n=e.height,a=(0,O.useCallback)((t=>{e.setRef(t)}),[e,r,n]);return O.createElement("canvas",{"data-testid":"arc-canvas",ref:a,style:{width:r,height:n,position:"absolute"},width:2*r,height:2*n})})),Se=(0,Z.observer)((function({model:e}){return O.createElement(ve,{model:e},O.createElement(Ce,{model:e}))})),ke=Se;var Te=r(20592),xe=r(32462),Pe=r(87234);const Me=(0,O.lazy)((()=>r.e(1475).then(r.bind(r,81475)))),Ee=function(e){return l.types.compose("LinearReadArcsDisplay",Te.BaseDisplay,(0,G.eW)(),(0,G.Ek)(),l.types.model({type:l.types.literal("LinearReadArcsDisplay"),configuration:(0,o.ConfigurationReference)(e),filterBy:l.types.optional(pe,{}),lineWidth:l.types.maybe(l.types.number),jitter:l.types.maybe(l.types.number),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string),extra:l.types.frozen()})),drawInter:!0,drawLongRange:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).actions((e=>({setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBy=(0,l.cast)(t)},setChainData(t){e.chainData=t},setDrawInter(t){e.drawInter=t},setDrawLongRange(t){e.drawLongRange=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setLineWidth(t){e.lineWidth=t},setJitter(t){e.jitter=t}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx},get lineWidthSetting(){return e.lineWidth??(0,o.getConf)(e,"lineWidth")},get jitterVal(){return e.jitter??(0,o.getConf)(e,"jitter")}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps:()=>({...r(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Filter by",icon:Pe.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[Me,{model:e,handleClose:t}]))}},{label:"Line width",subMenu:[{label:"Thin",onClick:()=>e.setLineWidth(1)},{label:"Bold",onClick:()=>e.setLineWidth(2)},{label:"Extra bold",onClick:()=>e.setLineWidth(5)}]},{label:"Jitter x-positions",subMenu:[{type:"checkbox",checked:0===e.jitterVal,label:"None",onClick:()=>e.setJitter(0)},{type:"checkbox",checked:2===e.jitterVal,label:"Small",onClick:()=>e.setJitter(2)},{type:"checkbox",checked:10===e.jitterVal,label:"Large",onClick:()=>e.setJitter(10)}]},{label:"Draw inter-region vertical lines",type:"checkbox",checked:e.drawInter,onClick:()=>e.setDrawInter(!e.drawInter)},{label:"Draw long range connections",type:"checkbox",checked:e.drawLongRange,onClick:()=>e.setDrawLongRange(!e.drawLongRange)},{label:"Color scheme",icon:xe.Z,subMenu:[{label:"Insert size ± 3σ and orientation",onClick:()=>e.setColorScheme({type:"insertSizeAndOrientation"})},{label:"Insert size ± 3σ",onClick:()=>e.setColorScheme({type:"insertSize"})},{label:"Orientation",onClick:()=>e.setColorScheme({type:"orientation"})},{label:"Insert size gradient",onClick:()=>e.setColorScheme({type:"gradient"})}]}]}})).views((e=>({async renderSvg(t){const{renderSvg:n}=await r.e(3880).then(r.bind(r,83880)),{drawFeats:a}=await r.e(6390).then(r.bind(r,26390));return n(e,t,a)}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(9070).then(r.bind(r,39070)),{drawFeats:n}=await r.e(6390).then(r.bind(r,26390));t(e,n)}catch(t){console.error(t),e.setError(t)}})()}})))};function Re(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearReadArcsDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},lineWidth:{type:"number",description:"set arc line width",defaultValue:1},jitter:{type:"number",description:"jitters the x position so e.g. if many reads map to exact same x position, jittering makes it easy to see that there are many of them",defaultValue:0},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,G.RH)(e),explicitlyTyped:!0})}(e);return new H.Z({name:"LinearReadArcsDisplay",displayName:"Arc display",configSchema:t,stateModel:Ee(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:ke})}))}const Ae=(0,Z.observer)((function({model:e}){const t=(0,y.getContainingView)(e),r=Math.round(t.dynamicBlocks.totalWidthPx),n=e.height,a=(0,O.useCallback)((t=>e.setRef(t)),[e,r,n]);return O.createElement("canvas",{"data-testid":"cloud-canvas",ref:a,style:{width:r,height:n,position:"absolute"},width:2*r,height:2*n})})),Ie=(0,Z.observer)((function({model:e}){return O.createElement(ve,{model:e},O.createElement(Ae,{model:e}))})),Fe=Ie,Ne=(0,O.lazy)((()=>r.e(1475).then(r.bind(r,81475)))),Le=function(e){return l.types.compose("LinearReadCloudDisplay",Te.BaseDisplay,(0,G.eW)(),(0,G.Ek)(),l.types.model({type:l.types.literal("LinearReadCloudDisplay"),configuration:(0,o.ConfigurationReference)(e),filterBy:l.types.optional(pe,{}),colorBy:l.types.maybe(l.types.model({type:l.types.string,tag:l.types.maybe(l.types.string),extra:l.types.frozen()})),drawSingletons:!0})).volatile((()=>({loading:!1,chainData:void 0,lastDrawnOffsetPx:void 0,lastDrawnBpPerPx:0,ref:null}))).actions((e=>({setDrawSingletons(t){e.drawSingletons=t},setLastDrawnOffsetPx(t){e.lastDrawnOffsetPx=t},setLastDrawnBpPerPx(t){e.lastDrawnBpPerPx=t},setLoading(t){e.loading=t},reload(){e.error=void 0},setRef(t){e.ref=t},setColorScheme(t){e.colorBy=(0,l.cast)(t)},setChainData(t){e.chainData=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)}}))).views((e=>({get drawn(){return void 0!==e.lastDrawnOffsetPx}}))).views((e=>{const{trackMenuItems:t,renderProps:n}=e;return{renderProps:()=>({...n(),notReady:!e.chainData}),trackMenuItems:()=>[...t(),{label:"Draw singletons",type:"checkbox",checked:e.drawSingletons,onClick:()=>e.setDrawSingletons(!e.drawSingletons)},{label:"Filter by",icon:Pe.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[Ne,{model:e,handleClose:t}]))}},{label:"Color scheme",icon:xe.Z,subMenu:[{label:"Insert size ± 3σ and orientation",onClick:()=>e.setColorScheme({type:"insertSizeAndOrientation"})},{label:"Insert size ± 3σ",onClick:()=>e.setColorScheme({type:"insertSize"})},{label:"Orientation",onClick:()=>e.setColorScheme({type:"orientation"})},{label:"Insert size gradient",onClick:()=>e.setColorScheme({type:"gradient"})}]}],async renderSvg(t){const{renderSvg:n}=await r.e(3880).then(r.bind(r,83880)),{drawFeats:a}=await r.e(6530).then(r.bind(r,36530));return n(e,t,a)}}})).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(9070).then(r.bind(r,39070)),{drawFeats:n}=await r.e(6530).then(r.bind(r,36530));t(e,n)}catch(t){console.error(t),e.setError(t)}})()}})))};function De(e){e.addDisplayType((()=>{const t=function(e){return(0,o.ConfigurationSchema)("LinearReadCloudDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},featureHeight:{type:"number",defaultValue:7},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,G.RH)(e),explicitlyTyped:!0})}(e);return new H.Z({name:"LinearReadCloudDisplay",displayName:"Read cloud display",configSchema:t,stateModel:Le(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},ReactComponent:Fe})}))}var Be=r(5889);function Ve(e){e.addTrackType((()=>{const t=(r=e,(0,o.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,Te.createBaseTrackConfig)(r)}));var r;const n=new Be.Z({name:"AlignmentsTrack",displayName:"Alignments track",configSchema:t,stateModel:(0,U.createBaseTrackModel)(e,"AlignmentsTrack",t)}),a=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(a),n}))}var ze=r(25077),Oe=r(63211);const Ze=(0,o.ConfigurationSchema)("AlignmentsFeatureWidget",{});function je(e){const t=(0,Oe.e$)(e);return l.types.compose(t,l.types.model("AlignmentsFeatureWidget",{type:l.types.literal("AlignmentsFeatureWidget")}))}function We(e){e.addWidgetType((()=>new ze.Z({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:Ze,stateModel:je(e),ReactComponent:(0,O.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(7001)]).then(r.bind(r,75439))))})))}var $e=r(40011),He=r(9762),Ge=r(83015);class qe extends Ge.Z{async serializeArguments(e,t){const{rootModel:r}=this.pluginManager,n=r?.session?.assemblyManager;if(!n)throw new Error("no assembly manager available");const a=await(0,y.renameRegionsIfNeeded)(n,e);return super.serializeArguments(a,t)}}class Ue extends qe{name="PileupGetReducedFeatures";async execute(e,t){const r=await this.deserializeArguments(e,t),{adapterConfig:n,sessionId:a,regions:o}=r,i=(await(0,S.uP)(this.pluginManager,a,n)).dataAdapter,s=await(0,He.z)(i.getFeaturesInMultipleRegions(o,r).pipe((0,$e.q)())),l=(0,y.dedupe)(s.map((e=>({id:e.id(),refName:e.get("refName"),name:e.get("name"),start:e.get("start"),strand:e.get("strand"),end:e.get("end"),flags:e.get("flags"),tlen:e.get("template_length"),pair_orientation:e.get("pair_orientation"),next_ref:e.get("next_ref"),next_pos:e.get("next_pos"),clipPos:e.get("clipPos"),SA:(0,P.h1)(e,"SA")}))),(e=>e.id)),c=l.filter((e=>2&e.flags&&!(256&e.flags)&&!(2048&e.flags))),d=c.length?function(e){const t=e.map((e=>Math.abs(e.tlen))),r=t.reduce(((e,t)=>e+t),0),n=t.map((e=>e*e)).reduce(((e,t)=>e+t),0),a=t.length,o=r/a,i=Math.sqrt((a*n-r*r)/(a*a));return{upper:o+4*i,lower:o-3*i,avg:o,sd:i}}(c):void 0,u=(0,y.groupBy)(l,(e=>e.name));return{chains:Object.values(u),stats:d,hasPaired:!!d,containsNoTransferables:!0}}}class _e extends qe{name="PileupGetVisibleModifications";async execute(e,t){const{adapterConfig:r,sessionId:n,regions:a}=await this.deserializeArguments(e,t),o=(await(0,S.uP)(this.pluginManager,n,r)).dataAdapter,i=await(0,He.z)(o.getFeaturesInMultipleRegions(a).pipe((0,$e.q)())),s=new Set;return i.forEach((e=>{(0,F.getModificationTypes)((0,P.TN)(e,"MM","Mm")||"").forEach((e=>s.add(e)))})),[...s]}}class Je extends qe{name="PileupGetGlobalValueForTag";async execute(e,t){const{adapterConfig:r,sessionId:n,regions:a,tag:o}=await this.deserializeArguments(e,t),i=(await(0,S.uP)(this.pluginManager,n,r)).dataAdapter.getFeaturesInMultipleRegions(a),s=await(0,He.z)(i.pipe((0,$e.q)()));return[...new Set(s.map((e=>(0,P.h1)(e,o))).filter((e=>void 0!==e)).map((e=>`${e}`)))]}}const Xe=e=>{e.addRpcMethod((()=>new Je(e))),e.addRpcMethod((()=>new _e(e))),e.addRpcMethod((()=>new Ue(e)))},Ye=e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="CramAdapter",o=(0,de.getFileName)(t),i={type:a,cramLocation:t,craiLocation:r||(0,de.makeIndex)(t,".crai")};return/\.cram$/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BamAdapter",o=(0,de.getFileName)(t),i=r&&(0,de.getFileName)(r),s={type:a,bamLocation:t,index:{location:r||(0,de.makeIndex)(t,".bai"),indexType:(0,de.makeIndexType)(i,"CSI","BAI")}};return/\.bam$/i.test(o)&&!n||n===a?s:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)))},Ke=function(e){return(0,o.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:l.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,o.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:e.getRendererType("PileupRenderer").configSchema}),maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:l.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,G.RH)(e),explicitlyTyped:!0})};var Qe=r(72241),et=r(72337),tt=r(43306),rt=r.n(tt),nt=r(24728),at=r(84059),ot=r(80013);const it=(0,Z.observer)((function({model:e}){const{sortedBy:t}=e;return t?O.createElement("div",{"data-testid":`blurb-${t}`},O.createElement(ot.Z,{color:"secondary",variant:"caption"},t?`Sorted by ${t.tag??t.type} at ${t.refName}:${t.pos}`:null)):null})),st=it,lt=(0,O.lazy)((()=>r.e(1475).then(r.bind(r,81475)))),ct=(0,O.lazy)((()=>r.e(6762).then(r.bind(r,63716)))),dt=(0,O.lazy)((()=>r.e(4655).then(r.bind(r,14655)))),ut=(0,O.lazy)((()=>r.e(5044).then(r.bind(r,5044)))),pt=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]);function mt(e){return l.types.compose(G.fV,l.types.model({configuration:(0,o.ConfigurationReference)(e),featureHeight:l.types.maybe(l.types.number),noSpacing:l.types.maybe(l.types.boolean),fadeLikelihood:l.types.maybe(l.types.boolean),trackMaxHeight:l.types.maybe(l.types.number),colorBy:A.zi,filterBy:l.types.optional(pe,{}),jexlFilters:l.types.optional(l.types.array(l.types.string),[])})).volatile((()=>({colorTagMap:q.observable.map({}),featureUnderMouseVolatile:void 0,tagsReady:!1}))).views((e=>({get autorunReady(){return(0,y.getContainingView)(e).initialized&&e.featureDensityStatsReady&&!e.regionTooLarge}}))).actions((e=>({setTagsReady(t){e.tagsReady=t},setMaxHeight(t){e.trackMaxHeight=t},setFeatureHeight(t){e.featureHeight=t},setNoSpacing(t){e.noSpacing=t},setColorScheme(t){e.colorTagMap=q.observable.map({}),e.colorBy=(0,l.cast)(t),t.tag&&(e.tagsReady=!1)},updateColorTagMap(t){const r=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((t=>{if(!e.colorTagMap.has(t)){const n=[...e.colorTagMap.keys()].length;e.colorTagMap.set(t,r[n])}}))},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t},selectFeature(t){const r=(0,y.getSession)(e);if((0,y.isSessionModelWithWidgets)(r)){const n=r.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,y.getContainingView)(e)});r.showWidget(n)}r.setSelection(t)},copyFeatureToClipboard(t){const{uniqueId:r,...n}=t.toJSON(),a=(0,y.getSession)(e);rt()(JSON.stringify(n,null,4)),a.notify("Copied to clipboard","success")},setConfig(t){e.configuration=t},setFilterBy(t){e.filterBy=(0,l.cast)(t)},setJexlFilters(t){e.jexlFilters=(0,l.cast)(t)}}))).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:r,trackMaxHeight:n,rendererTypeName:a}=e,i=(0,o.getConf)(e,["renderers",a])||{};return e.rendererType.configSchema.create({...i,...void 0!==t?{height:t}:{},...void 0!==r?{noSpacing:r}:{},...void 0!==n?{maxHeight:n}:{}},(0,y.getEnv)(e))}}))).views((e=>({get maxHeight(){return(0,o.readConfObject)(e.rendererConfig,"maxHeight")},get featureHeightSetting(){return(0,o.readConfObject)(e.rendererConfig,"height")},get featureUnderMouse(){return e.featureUnderMouseVolatile},renderReady:()=>e.tagsReady,get filters(){return new ne.Z({filters:e.jexlFilters})}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{get rendererTypeName(){const t=(0,o.getConf)(e,"defaultRendering"),r=pt.get(t);if(!r)throw new Error(`unknown alignments view name ${t}`);return r},contextMenuItems(){const t=e.contextMenuFeature;return t?[{label:"Open feature details",icon:at.Z,onClick:()=>{e.clearFeatureSelection(),t&&e.selectFeature(t)}},{label:"Copy info to clipboard",icon:nt.pt,onClick:()=>{t&&e.copyFeatureToClipboard(t)}}]:[]},get DisplayBlurb(){return st},renderPropsPre(){const{colorTagMap:t,colorBy:n,filterBy:a,rpcDriverName:o}=e,i=r();return{...i,notReady:i.notReady||!e.renderReady(),rpcDriverName:o,displayModel:e,colorBy:n?(0,l.getSnapshot)(n):void 0,filterBy:JSON.parse(JSON.stringify(a)),filters:e.filters,colorTagMap:Object.fromEntries(t.toJSON()),config:e.rendererConfig,async onFeatureClick(t,r){const n=(0,y.getSession)(e),{rpcManager:a}=n;try{const t=r||e.featureIdUnderMouse;if(t){const r=(0,de.getRpcSessionId)(e),{feature:n}=await a.call(r,"CoreGetFeatureDetails",{featureId:t,sessionId:r,layoutId:(0,y.getContainingView)(e).id,rendererType:"PileupRenderer"});n&&e.selectFeature(new y.SimpleFeature(n))}else e.clearFeatureSelection()}catch(e){console.error(e),n.notify(`${e}`)}},onClick(){e.clearFeatureSelection()},async onFeatureContextMenu(t,r){const n=(0,y.getSession)(e),{rpcManager:a}=n;try{const t=r||e.featureIdUnderMouse;if(t){const r=(0,de.getRpcSessionId)(e),{feature:n}=await a.call(r,"CoreGetFeatureDetails",{featureId:t,sessionId:r,layoutId:(0,y.getContainingView)(e).id,rendererType:"PileupRenderer"});n&&e.setContextMenuFeature(new y.SimpleFeature(n))}else e.clearFeatureSelection()}catch(e){console.error(e),n.notify(`${e}`)}}}},colorSchemeSubMenuItems:()=>[{label:"Normal",onClick:()=>e.setColorScheme({type:"normal"})},{label:"Mapping quality",onClick:()=>e.setColorScheme({type:"mappingQuality"})},{label:"Strand",onClick:()=>e.setColorScheme({type:"strand"})},{label:"Per-base quality",onClick:()=>e.setColorScheme({type:"perBaseQuality"})},{label:"Per-base lettering",onClick:()=>e.setColorScheme({type:"perBaseLettering"})},{label:"First-of-pair strand",onClick:()=>e.setColorScheme({type:"stranded"})},{label:"Color by tag...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[ct,{model:e,handleClose:t}]))}}],trackMenuItems:()=>[...t(),{label:"Filter by",icon:Pe.Z,onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[lt,{model:e,handleClose:t}]))}},{label:"Set feature height",subMenu:[{label:"Normal",onClick:()=>{e.setFeatureHeight(7),e.setNoSpacing(!1)}},{label:"Compact",onClick:()=>{e.setFeatureHeight(2),e.setNoSpacing(!0)}},{label:"Manually set height",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[dt,{model:e,handleClose:t}]))}}]},{label:"Set max height...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[ut,{model:e,handleClose:t}]))}}]}})).views((e=>({renderProps:()=>e.renderPropsPre()}))).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{const t=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{colorBy:r,tagsReady:n}=e,{staticBlocks:a}=t;if(r?.tag&&!n){const t=await async function(e,t,r,n){const{rpcManager:a}=(0,y.getSession)(e),{adapterConfig:o}=e,i=(0,de.getRpcSessionId)(e);return await a.call((0,de.getRpcSessionId)(e),"PileupGetGlobalValueForTag",{adapterConfig:o,tag:t.tag,sessionId:i,regions:r.contentBlocks})}(e,r,a);e.updateColorTagMap(t)}e.setTagsReady(!0)}),{delay:1e3}),(0,l.addDisposer)(e,(0,q.autorun)((async()=>{const t=(0,y.getSession)(e);try{const r=e.featureIdUnderMouse;if(e.featureUnderMouse?.id()!==r)if(r){const n=(0,de.getRpcSessionId)(e),a=(0,y.getContainingView)(e),{feature:o}=await t.rpcManager.call(n,"CoreGetFeatureDetails",{featureId:r,sessionId:n,layoutId:a.id,rendererType:"PileupRenderer"});e.featureIdUnderMouse===o?.uniqueId&&e.setFeatureUnderMouse(new y.SimpleFeature(o))}else e.setFeatureUnderMouse(void 0)}catch(e){console.error(e),t.notify(`${e}`,"error")}})))}})))}const gt=(0,O.lazy)((()=>r.e(7025).then(r.bind(r,17025)))),ft=(0,O.lazy)((()=>r.e(6151).then(r.bind(r,96151)))),ht=function(e){return l.types.compose("LinearPileupDisplay",mt(e),l.types.model({type:l.types.literal("LinearPileupDisplay"),configuration:(0,o.ConfigurationReference)(e),showSoftClipping:!1,mismatchAlpha:l.types.maybe(l.types.boolean),sortedBy:l.types.maybe(l.types.model({type:l.types.string,pos:l.types.number,tag:l.types.maybe(l.types.string),refName:l.types.string,assemblyName:l.types.string}))})).volatile((()=>({sortReady:!1,currSortBpPerPx:0,modificationTagMap:q.observable.map({}),modificationsReady:!1}))).actions((e=>({setCurrSortBpPerPx(t){e.currSortBpPerPx=t},updateModificationColorMap(t){t.forEach((t=>{e.modificationTagMap.has(t)||e.modificationTagMap.set(t,P.b4[t]||(0,P.p)())}))},setModificationsReady(t){e.modificationsReady=t},setSortReady(t){e.sortReady=t},clearSelected(){e.sortedBy=void 0},toggleSoftClipping(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha(){e.mismatchAlpha=!e.mismatchAlpha},setSortedBy(t,r){const{centerLineInfo:n}=(0,y.getContainingView)(e);if(!n)return;const{refName:a,assemblyName:o,offset:i}=n,s=Math.round(i)+1;s<0||!a||(e.sortReady=!1,e.sortedBy={type:t,pos:s,refName:a,assemblyName:o,tag:r})}}))).actions((e=>{const t=e.reload;return{reload(){e.clearSelected(),t()}}})).views((e=>({get rendererConfig(){const{featureHeight:t,noSpacing:r,trackMaxHeight:n,mismatchAlpha:a,rendererTypeName:i}=e,s=(0,o.getConf)(e,["renderers",i])||{};return e.rendererType.configSchema.create({...s,...void 0!==t?{height:t}:{},...void 0!==r?{noSpacing:r}:{},...void 0!==a?{mismatchAlpha:a}:{},...void 0!==n?{maxHeight:n}:{}},(0,y.getEnv)(e))}}))).views((e=>{const{renderReady:t}=e;return{get mismatchAlphaSetting(){return(0,o.readConfObject)(e.rendererConfig,"mismatchAlpha")},renderReady(){const r=(0,y.getContainingView)(e);return e.modificationsReady&&e.currSortBpPerPx===r.bpPerPx&&t()}}})).views((e=>{const{trackMenuItems:t,renderPropsPre:r,renderProps:n,colorSchemeSubMenuItems:a}=e;return{renderPropsPre(){const{sortedBy:t,showSoftClipping:n,modificationTagMap:a}=e;return{...r(),showSoftClip:n,sortedBy:t,modificationTagMap:Object.fromEntries(a.toJSON())}},renderProps(){const{sortReady:t}=e,r=n();return{...r,notReady:r.notReady||!t}},trackMenuItems:()=>[...t(),{label:"Show soft clipping",icon:Qe.Z,type:"checkbox",checked:e.showSoftClipping,onClick:()=>{e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Sort by",icon:et.Z,disabled:e.showSoftClipping,subMenu:[...["Start location","Read strand","Base pair"].map((t=>({label:t,onClick:()=>e.setSortedBy(t)}))),{label:"Sort by tag...",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[gt,{model:e,handleClose:t}]))}},{label:"Clear sort",onClick:()=>e.clearSelected()}]},{label:"Color scheme",subMenu:[{label:"Pair orientation",onClick:()=>e.setColorScheme({type:"pairOrientation"})},{label:"Modifications or methylation",onClick:()=>{(0,y.getSession)(e).queueDialog((t=>[ft,{model:e,handleClose:t}]))}},{label:"Insert size",onClick:()=>e.setColorScheme({type:"insertSize"})},...a()]},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:()=>e.toggleMismatchAlpha()}]}})).actions((e=>({afterAttach(){(0,P.$X)(e,(async()=>{const t=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{bpPerPx:r}=t;e.setCurrSortBpPerPx(r)}),{delay:1e3}),(0,P.$X)(e,(async()=>{const{rpcManager:t}=(0,y.getSession)(e),r=(0,y.getContainingView)(e);if(!e.autorunReady)return;const{sortedBy:n,adapterConfig:a,rendererType:o,sortReady:i}=e,{bpPerPx:s}=r;if(n&&(!i||e.currSortBpPerPx===r.bpPerPx)){const{pos:i,refName:s,assemblyName:l}=n;await e.rendererType.renderInClient(t,{assemblyName:l,regions:[{start:i,end:i+1,refName:s,assemblyName:l}],adapterConfig:a,rendererType:o.name,sessionId:(0,de.getRpcSessionId)(e),layoutId:r.id,timeout:1e6,...e.renderPropsPre()})}e.setCurrSortBpPerPx(s),e.setSortReady(!0)}),{delay:1e3}),(0,P.$X)(e,(async()=>{if(!e.autorunReady)return;const{parentTrack:t,colorBy:r}=e,{staticBlocks:n}=(0,y.getContainingView)(e);if("modifications"===r?.type){const a=(0,o.getConf)(t,["adapter"]),i=await ue(e,a,r,n);e.updateModificationColorMap(i)}e.setModificationsReady(!0)}))}})))};function yt(e){e.addDisplayType((()=>{const t=Ke(e);return new H.Z({name:"LinearPileupDisplay",displayName:"Pileup display",configSchema:t,stateModel:ht(t),subDisplay:{type:"LinearAlignmentsDisplay",lowerPanel:!0},trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:G.qb})}))}class bt extends n.Z{name="AlignmentsPlugin";install(e){[d,s,yt,fe,Ve,g,p,$,Xe,v,Re,De,re,We,Ye].map((t=>t(e)))}}},69349:(e,t,r)=>{"use strict";r.d(t,{If:()=>o,Wh:()=>s,k5:()=>l,uE:()=>c,ue:()=>i,zi:()=>d});var n=r(88196),a=r(39395);const o={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"purple",color_longinsert:"red",color_shortinsert:"pink",color_unknown:"grey"},i={color_fwd_strand_not_proper:"#CA6767",color_rev_strand_not_proper:"#7272AA",color_fwd_strand:"#DC2A2A",color_rev_strand:"#4141BA",color_fwd_missing_mate:"#921111",color_rev_missing_mate:"#111192",color_fwd_diff_chr:"#000000",color_rev_diff_chr:"#696969",color_pair_lr:"#8C8C8C",color_pair_rr:"#00005A",color_pair_rl:"#005A5A",color_pair_ll:"#005A00",color_nostrand:"#8C8C8C",color_interchrom:"#5A005A",color_longinsert:"#B30000",color_shortinsert:"#FF3A5C",color_unknown:"grey"};function s(e,t,r){const n=e.refName===t.refName,a=Math.abs(e.tlen||0);return n&&a>(r?.upper||0)?[o.color_longinsert,i.color_longinsert]:n&&a<(r?.lower||0)?[o.color_shortinsert,i.color_shortinsert]:n?void 0:[o.color_interchrom,i.color_interchrom]}function l(e,t,r){return s(e,t,r)||c(e)}function c(e){const t=a.uD.fr,r=a.oL[t[e.pair_orientation||""]];return[o[r]||o.color_unknown,i[r]||i.color_unknown]}const d=n.types.maybe(n.types.model({type:n.types.string,tag:n.types.maybe(n.types.string),extra:n.types.frozen()}))},39395:(e,t,r)=>{"use strict";r.d(t,{$X:()=>g,ES:()=>p,O:()=>u,TN:()=>l,b4:()=>m,h1:()=>s,oL:()=>d,p:()=>f,uD:()=>c});var n=r(40011),a=r(9762),o=r(88196),i=r(99247);function s(e,t){const r=e.get("tags");return void 0!==r?r[t]:e.get(t)}function l(e,t,r){return s(e,t)??s(e,r)}const c={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}},d={LR:"color_pair_lr",LL:"color_pair_ll",RR:"color_pair_rr",RL:"color_pair_rl"};async function u(e,t){const{start:r,end:o,originalRefName:i,refName:s}=e,l=await(0,a.z)(t.getFeatures({...e,refName:i||s,end:o+1,start:Math.max(0,r-1)}).pipe((0,n.q)()));return l[0]?.get("seq")}function p(e){return"methylation"===e}const m={m:"rgb(255,0,0)",h:"rgb(11, 132, 165)",o:"rgb(111, 78, 129)",f:"rgb(246, 200, 95)",c:"rgb(157, 216, 102)",g:"rgb(255, 160, 86)",e:"rgb(141, 221, 208)",b:"rgb(202, 71, 47)"};function g(e,t,r){(0,o.addDisposer)(e,(0,i.autorun)((async()=>{try{await t()}catch(t){(0,o.isAlive)(e)&&e.setError(t)}}),r))}function f(){return`hsl(${200*Math.random()}, 50%, 50%)`}},71416:(e,t,r)=>{"use strict";r.d(t,{Go:()=>c,cO:()=>l,mu:()=>s,wf:()=>d});var n=r(66204),a=r(90872);const[,o,,i]=[0,1,2,3];function s(e,t,r){return(e.bpToPx({refName:t,coord:r})?.offsetPx||0)-e.offsetPx}function l(e,t,r,n,s,l){const c=n[t].displays[0],d=c.height;let u=0;const{SNPCoverageDisplay:p}=c;p&&(u=p.height);const m=l?0:c.scrollTop;return(0,a.clamp)(s[o]-m+((g=s)[i]-g[o])/2+u,0,d)+function(e,t,r,n){return n?n(t,r):e[r].trackRefs[t]?.getBoundingClientRect().top||0}(r,e,t,l)+c.scrollTop;var g}const c=e=>{const[,t]=(0,n.useState)();(0,n.useEffect)((()=>{t(e)}),[e])};function d(e,t=[],r=[],...n){const a=new Set(r.map((t=>e(t)))),o=t.filter((t=>a.has(e(t))));return 0===n.length?o:d(e,o,...n)}},88309:(e,t,r)=>{"use strict";r.d(t,{lJ:()=>E,pL:()=>B,_U:()=>D,ZP:()=>V});var n=r(90872),a=r(27032),o=r(66204),i=r(59366),s=r(88196),l=r(1502),c=r(99247),d=r(78937),u=r(43800),p=r(72271),m=r(24728),g=r(20160),f=r(55680);function h(e,t,r,n,a){const o=Math.abs(e-r);if(o>n)return;o===n&&a.push([t,e]);const i=Math.sqrt(n*n-o*o);a.push([t-i,e],[t+i,e])}function y(e,t,r,n,a){const o=Math.abs(e-t);if(o>n)return;o===n&&a.push([e,r]);const i=Math.sqrt(n*n-o*o);a.push([e,r-i],[e,r+i])}function b(e,t){const r=Math.sqrt(e*e+t*t);if(0===r)return[0,0];const n=function(e,t){let r=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?r+=Math.PI:r-=Math.PI),r}(e,t);return[r,n]}const w=2*Math.PI;class v{constructor(e,t,r,a){this.region=t,this.offsetRadians=r,this.radianWidth=a;const{bpPerRadian:o}=e;this.key="regions"in t?JSON.stringify(t.regions):(0,n.assembleLocString)(t),this.bpPerRadian=o,this.flipped=!1,this.startRadians=r,this.endRadians=t.widthBp/this.bpPerRadian+r,Object.freeze(this)}bpToXY(e,t){let r;r=this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start;const a=r/this.bpPerRadian+this.offsetRadians;return(0,n.polarToCartesian)(t,a)}toJSON(){return Object.fromEntries(Object.entries(this))}}const C=(0,o.lazy)((()=>r.e(3990).then(r.bind(r,23990)))),S=function(e){return s.types.compose("CircularView",p.BaseViewModel,s.types.model({type:s.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:200,tracks:s.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:s.types.optional(s.types.refinement("trackHeight",s.types.number,(e=>e>=40)),400),displayedRegions:s.types.array(l.Region),scrollX:0,scrollY:0,minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,trackSelectorType:"hierarchical"})).volatile((()=>({volatileWidth:void 0,error:void 0}))).views((e=>({get width(){if(void 0===e.volatileWidth)throw new Error("wait for view to be initialized first before accessing width");return e.volatileWidth},get visibleSection(){const{scrollX:t,scrollY:r,width:n,height:a}=e;return function(e,t,r){let[n,a,o,i]=e;const[s,l]=t;if(n-=s,a-=s,o-=l,i-=l,n<0&&a>0&&o<0&&i>0){const e=[[n,o],[a,o],[n,i],[a,i]];let t=-1/0;for(const[r,n]of e){const e=Math.sqrt(r*r+n*n);e>t&&(t=e)}return{rho:[0,Math.min(r,t)],theta:[0,2*Math.PI]}}const c=[[n,o],[a,o],[n,i],[a,i]];y(n,0,0,r,c),y(a,0,0,r,c),h(o,0,0,r,c),h(i,0,0,r,c),-n<r&&c.push([n,0]),a<r&&c.push([a,0]),-o<r&&c.push([0,o]),i<r&&c.push([0,i]);const d=n>=0?-1:1;let u=1/0,p=-1/0,m=1/0,g=-1/0;for(const[e,t]of c)if(e>=n&&e<=a&&t>=o&&t<=i){const[n,a]=b(e*d,t*d);n<=r+.001&&(a<m&&n>1e-4&&(m=a),a>g&&n>1e-4&&(g=a),n<u&&(u=n),n>p&&(p=n))}return-1===d&&(m+=Math.PI,g+=Math.PI),m>2*Math.PI&&g>2*Math.PI&&(m-=2*Math.PI,g-=2*Math.PI),{rho:[u,Math.min(r,p)],theta:[m,g]}}([t,t+n,r,r+a],this.centerXY,this.radiusPx)},get circumferencePx(){let t=0;for(const e of this.elidedRegions)t+=e.widthBp;return t/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){let t=0;for(const r of e.displayedRegions)t+=r.end-r.start;return t},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){const t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){const e=2*Math.PI*this.maximumRadiusPx;return(0,n.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){const t=[];e.displayedRegions.forEach((r=>{const n=r.end-r.start;if(n/e.bpPerPx<e.minVisibleWidth){const e=t.at(-1);e?.elided?(e.regions.push({...r}),e.widthBp+=n):t.push({elided:!0,widthBp:n,regions:[{...r}]})}else t.push({...r,widthBp:n,elided:!1})}));for(let e=0;e<t.length;e+=1){const r=t[e];r.elided&&1===r.regions.length&&(t[e]={...r,...r.regions[0],elided:!1})}return t},get assemblyNames(){const t=[];return e.displayedRegions.forEach((e=>{t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){const{assemblyManager:t}=(0,n.getSession)(e);return void 0!==e.volatileWidth&&this.assemblyNames.every((e=>t.get(e)?.initialized))}}))).views((e=>({get staticSlices(){return function(e){const t=[];let r=0;const{bpPerRadian:n,spacingPx:a,pxPerRadian:o}=e;for(const i of e.elidedRegions){const s=i.widthBp/n+a/o;t.push(new v(e,i,r,s)),r+=s}return t}(e)}}))).views((e=>({get visibleStaticSlices(){return e.staticSlices.filter((t=>function(e,t){const{theta:[r,n]}=e.visibleSection;return a=t.offsetRadians+e.offsetRadians,i=r,s=n-r,!((o=t.radianWidth)<=0||s<=0)&&(o+1e-4>=w||s+1e-4>=w||(a=(a%w+w)%w+w)<(i=(i%w+w)%w+w)+s&&a+o>i||a<(i-=w)+s&&a+o>i||a<(i+=w+w)+s&&a+o>i);var a,o,i,s}(e,t)))}}))).actions((t=>({setWidth:e=>(t.volatileWidth=Math.max(e,100),t.volatileWidth),setHeight:e=>(t.height=Math.max(e,40),t.height),resizeHeight(e){const r=t.height,n=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),n-r},resizeWidth(e){const r=t.width,n=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),n-r},rotateClockwiseButton(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise(e=.17){t.offsetRadians+=e},rotateCounterClockwise(e=.17){t.offsetRadians-=e},zoomInButton(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx(e){t.bpPerPx=(0,n.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView(){(0,s.getParent)(t,2).removeView(t)},setDisplayedRegions(e){const r=0===t.displayedRegions.length;t.displayedRegions=(0,s.cast)(e),r?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector(){if("hierarchical"===t.trackSelectorType){const e=(0,n.getSession)(t);if((0,n.isSessionModelWithWidgets)(e)){const r=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(r),r}}throw new Error(`invalid track selector type ${t.trackSelectorType}`)},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setError(e){t.error=e},showTrack(r,n={}){const a=e.pluggableConfigSchemaType("track"),o=(0,s.resolveIdentifier)(a,(0,s.getRoot)(t),r),i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const l=e.getViewType(t.type),c=new Set(l.displayTypes.map((e=>e.name))),d=o.displays.find((e=>c.has(e.type))),u=i.stateModel.create({...n,type:o.type,configuration:o,displays:[{type:d.type,configuration:d}]});t.tracks.push(u)},addTrackConf(r,n={}){const{type:a}=r,o=(0,u.readConfObject)(r,"name"),i=e.getTrackType(a);if(!i)throw new Error(`unknown track type ${a}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=r.displays.find((e=>l.has(e.type)));t.tracks.push(i.stateModel.create({...n,name:o,type:a,configuration:r,displays:[{type:c.type,configuration:c}]}))},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,s.resolveIdentifier)(n,(0,s.getRoot)(t),r),o=t.tracks.filter((e=>e.configuration===a));return(0,c.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length},toggleFitToWindowLock(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow},async exportSvg(e={}){const{renderToSvg:n}=await r.e(4223).then(r.bind(r,64223)),a=await n(t,e),o=new Blob([a],{type:"image/svg+xml"});(0,d.saveAs)(o,e.filename||"image.svg")}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setDisplayedRegions([]),icon:g.Z},{label:"Export SVG",icon:f.Z,onClick:()=>{(0,n.getSession)(e).queueDialog((t=>[C,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:m.GD}]})))};var k=r(12190),T=r(80846);const x=(0,r(38684).ZL)()((e=>{const{primary:t,secondary:r,tertiary:n,quaternary:a}=e.palette;return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash 1.4s ease-in-out infinite, $colors 5.6s ease-in-out infinite"},"@keyframes colors":{"0%":{stroke:t.light},"25%":{stroke:r.light},"50%":{stroke:n.light},"75%":{stroke:a.light},"100%":{stroke:t.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}})),P=(0,T.observer)((function({model:{renderProps:{radius:e}}}){const{classes:t}=x(),[r,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const e=setTimeout((()=>n(!0)),400);return()=>clearTimeout(e)})),r?o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},o.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}}))),o.createElement("circle",{cx:"0",cy:"0",r:e,fill:"#f1f1f1"}),o.createElement("circle",{cx:"0",cy:"0",r:e,fill:"url(#diagonalHatch)"}),o.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},"Loading…"),o.createElement("circle",{className:t.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})):null})),M=(0,T.observer)((function({model:e}){const{renderProps:{radius:t},error:r}=e;return o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse"},o.createElement("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}}))),o.createElement("circle",{cx:"0",cy:"0",r:t,fill:"#ffb4b4"}),o.createElement("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),o.createElement("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle"},String(r)))})),E=(0,T.observer)((function({display:e}){return e.error?o.createElement(M,{model:e}):e.filled?e.reactElement:o.createElement(P,{model:e})}));var R=r(91370),A=r.n(R),I=r(25216),F=r(99512);function N(e){const t=(0,n.getContainingView)(e),{rendererType:r}=e,{rpcManager:a}=(0,n.getSession)(t);return{rendererType:r,rpcManager:a,renderProps:e.renderProps(),renderArgs:{assemblyName:t.displayedRegions[0]?.assemblyName,adapterConfig:A()(e.adapterConfig),rendererType:r.name,regions:A()(t.displayedRegions),blockDefinitions:e.blockDefinitions,sessionId:(0,F.getRpcSessionId)(e),timeout:1e6}}}async function L(e,t,r){if(!e)throw new Error("cannot render with no props");const{rendererType:n,rpcManager:a,cannotBeRenderedReason:o,renderArgs:i,renderProps:s,exportSVG:l}=e;if(o)return{message:o};if(!s.radius||!i.regions?.length)return{message:"Skipping render"};if(!r.isCompatibleWithRenderer(n))throw new Error(`renderer ${n.name} is not compatible with this display type`);const{html:c,...d}=await n.renderInClient(a,{...i,...s,exportSVG:l});return{html:c,data:d,reactElement:d.reactElement,renderingComponent:n.ReactComponent}}const D=(0,u.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),B=s.types.compose("BaseChordDisplay",p.BaseDisplay,s.types.model({bezierRadiusRatio:.1,assemblyName:s.types.maybe(s.types.string),configuration:(0,u.ConfigurationReference)(D)})).volatile((()=>({filled:!1,reactElement:void 0,data:void 0,html:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}))).actions((e=>{const{pluginManager:t}=(0,n.getEnv)(e),r=e;return{onChordClick(n){(0,u.getConf)(e,"onChordClick",{feature:n,track:r,pluginManager:t})}}})).views((e=>({get blockDefinitions(){const t=(0,n.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;const r=A()(t);return r.forEach((t=>{(t.region.elided?t.region.regions:[t.region]).forEach((t=>{const r=e.refNameMap?.[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),r},renderProps(){const t=(0,n.getContainingView)(e);return{...(0,F.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick}},get rendererType(){const t=e,{pluginManager:r}=(0,n.getEnv)(e),a=r.getRendererType(e.rendererTypeName);if(!a)throw new Error(`renderer "${t.rendererTypeName}" not found`);if(!a.ReactComponent)throw new Error(`renderer ${t.rendererTypeName} has no ReactComponent, it may not be completely implemented yet`);return a},isCompatibleWithRenderer:e=>!!(e instanceof I.Z),get selectedFeatureId(){if(!(0,s.isAlive)(e))return;const t=(0,n.getSession)(e);if(!t)return;const{selection:r}=t;return(0,n.isFeature)(r)?r.id():void 0}}))).actions((e=>({renderStarted(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess({message:t,data:r,reactElement:n,html:a,renderingComponent:o}){t?(e.filled=!1,e.message=t,e.reactElement=void 0,e.data=void 0,e.html=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=n,e.data=r,e.html=a,e.error=void 0,e.renderingComponent=o)},renderError(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.html=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap(t){e.refNameMap=t}}))).actions((e=>({afterAttach(){(0,n.makeAbortableReaction)(e,N,L,{name:`${e.type} ${e.id} rendering`,fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,n.makeAbortableReaction)(e,(()=>({assemblyNames:(0,F.getTrackAssemblyNames)(e.parentTrack),adapter:(0,u.getConf)((0,s.getParent)(e,2),"adapter"),assemblyManager:(0,n.getSession)(e).assemblyManager})),(async({assemblyNames:t,adapter:r,assemblyManager:n},a)=>n.getRefNameMapForAdapter(r,t[0],{signal:a,sessionId:(0,F.getRpcSessionId)(e)})),{name:`${e.type} ${e.id} getting refNames`,fireImmediately:!0},(()=>{}),(t=>e.setRefNameMap(t)),(t=>{console.error(t),e.setError(t)}))}}))).views((e=>({async renderSvg(t){const r=N(e),a=await L({...r,exportSVG:t,theme:t.theme||r.renderProps.theme},0,e);return o.createElement(n.ReactRendering,{rendering:a})}})));class V extends a.Z{name="CircularViewPlugin";install(e){(e=>{e.addViewType((()=>new i.Z({ReactComponent:(0,o.lazy)((()=>r.e(9790).then(r.bind(r,89790)))),stateModel:S(e),name:"CircularView",displayName:"Circular view"})))})(e),(e=>{e.addToExtensionPoint("LaunchView-CircularView",(async({session:e,assembly:t,tracks:r=[]})=>{const{assemblyManager:n}=e,a=e.addView("CircularView",{});if(await(0,c.when)((()=>a.initialized)),!t)throw new Error("No assembly provided when launching circular genome view");const o=await n.waitForAssembly(t);if(!o)throw new Error(`Assembly "${t}" not found when launching circular genome view`);a.setDisplayedRegions(o.regions||[]),r.forEach((e=>a.showTrack(e)))}))})(e)}configure(e){(0,n.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:k.Z,onClick:e=>{e.addView("CircularView",{})}})}}},24137:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var n=r(66204),a=r(60962),o=r(46338),i=r(38684),s=r(80846);const l='Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace',c=(0,i.ZL)()((e=>({error:{color:"red",fontSize:"0.8em"},callbackEditor:{fontFamily:l,fontSize:"12px",background:e.palette.background.default,width:800,marginTop:"16px",border:"1px solid rgba(0,0,0,0.42)"},callbackContainer:{width:"100%",overflowX:"auto"},textAreaFont:{fontFamily:l}}))),d=(0,s.observer)((function({slot:e}){const{classes:t}=c(),[r,i]=(0,n.useState)(JSON.stringify(e.value,null,2)),[s,l]=(0,n.useState)();return(0,n.useEffect)((()=>{try{l(void 0),e.set(JSON.parse(r))}catch(e){console.error({e}),l(e)}}),[r,e]),n.createElement(n.Fragment,null,s?n.createElement("p",{className:t.error},`${s}`):null,n.createElement("div",{className:t.callbackContainer},n.createElement(a.Z,{shrink:!0,htmlFor:"json-editor"},e.name),n.createElement(o.Z,{id:"json-editor",className:t.callbackEditor,value:r,helperText:e.description,multiline:!0,onChange:e=>i(e.target.value),style:{background:s?"#fdd":void 0},InputProps:{classes:{input:t.textAreaFont}}})))}))},93533:(e,t,r)=>{"use strict";r.d(t,{wP:()=>b,ZP:()=>w});var n=r(66204),a=r(27032),o=r(20592),i=r(43800);const s=(0,i.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),l=(0,i.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),c=(0,i.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),d=(0,i.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0});var u=r(88196),p=r(1502);const m=e=>u.types.model("ConfigurationEditorWidget",{id:p.ElementId,type:u.types.literal("ConfigurationEditorWidget"),target:u.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((e=>({setTarget(t){e.target=t}}))),g=(0,r(80846).observer)((function({model:e}){if(e?.target){if(e.target.type)return n.createElement(n.Fragment,null,`${e.target.type} settings`);if((0,u.isStateTreeNode)(e.target)){const t=(0,u.getType)(e.target);if(t?.name)return n.createElement(n.Fragment,null,`${t.name.replace("ConfigurationSchema","")} settings`)}}return n.createElement(n.Fragment,null,"Settings")})),f=g,h=(0,i.ConfigurationSchema)("ConfigurationEditorWidget",{}),y=(0,n.lazy)((()=>Promise.all([r.e(3457),r.e(6701)]).then(r.bind(r,86701))));r(24137);const b=(0,n.lazy)((()=>Promise.all([r.e(3457),r.e(6701)]).then(r.bind(r,86701)))),w=class extends a.Z{name="ConfigurationPlugin";install(e){(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigAdapter",configSchema:s,getAdapterClass:()=>r.e(7658).then(r.bind(r,97658)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigRegionsAdapter",configSchema:l,getAdapterClass:()=>r.e(26).then(r.bind(r,20026)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"FromConfigSequenceAdapter",configSchema:c,getAdapterClass:()=>r.e(9431).then(r.bind(r,79431)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),(e=>{e.addAdapterType((()=>new o.AdapterType({name:"RefNameAliasAdapter",configSchema:d,getAdapterClass:()=>r.e(9372).then(r.bind(r,99372)).then((e=>e.default)),adapterMetadata:{hiddenFromGUI:!0}})))})(e),function(e){e.addWidgetType((()=>new o.WidgetType({name:"ConfigurationEditorWidget",HeadingComponent:f,configSchema:h,stateModel:m(e),ReactComponent:y})))}(e)}}},19462:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var n=r(43800),a=r(20592),o=r(66204),i=r(88196),s=r(1502);const l=i.types.model("AddConnectionModel",{id:s.ElementId,type:i.types.literal("AddConnectionWidget")}),c=(0,n.ConfigurationSchema)("AddConnectionWidget",{}),d=e=>{e.addWidgetType((()=>new a.WidgetType({name:"AddConnectionWidget",heading:"Add a connection",configSchema:c,stateModel:l,ReactComponent:(0,o.lazy)((()=>Promise.all([r.e(5856),r.e(4550)]).then(r.bind(r,94550))))})))}},88654:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var n=r(43800),a=r(20592),o=r(66204),i=r(88196),s=r(1502),l=r(99512);function c(e=""){try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function d(e){return i.types.model("AddTrackModel",{id:s.ElementId,type:i.types.literal("AddTrackWidget"),view:i.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((()=>({trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0}))).actions((e=>({setAdapterHint(t){e.adapterHint=t},setTrackSource(t){e.trackSource=t},setTextIndexingConf(t){e.textIndexingConf=t},setTextIndexTrack(t){e.textIndexTrack=t},setTrackData(t){e.trackData=t},setIndexTrackData(t){e.indexTrackData=t},setAssembly(t){e.altAssemblyName=t},setTrackName(t){e.altTrackName=t},setTrackType(t){e.altTrackType=t},clearData(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!0}}))).views((e=>({get trackAdapter(){const{trackData:t,indexTrackData:r,adapterHint:n}=e;return t?(0,l.guessAdapter)(t,r,n,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,l.getFileName)(e.trackData):"")},get isFtp(){const{trackData:t,indexTrackData:r}=e;return!(!r?.uri?.startsWith("ftp://")&&!t?.uri?.startsWith("ftp://"))},get isRelativeTrackUrl(){const t=e.trackData?.uri;return!!t&&!c(t)},get isRelativeIndexUrl(){const t=e.indexTrackData?.uri;return!!t&&!c(t)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){return e.trackData?.uri?.startsWith("http://")},get indexHttp(){return e.indexTrackData?.uri?.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){return this.trackAdapter?.type===l.UNSUPPORTED},get assembly(){return e.altAssemblyName||e.view.assemblyNames?.[0]},get trackType(){return e.altTrackType||(this.trackAdapter?(0,l.guessTrackType)(this.trackAdapter.type,e):"")}}))).views((e=>({get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}})))}const u=(0,n.ConfigurationSchema)("AddTrackWidget",{}),p=e=>{e.addWidgetType((()=>new a.WidgetType({name:"AddTrackWidget",heading:"Add a track",configSchema:u,stateModel:d(e),ReactComponent:(0,o.lazy)((()=>Promise.all([r.e(5856),r.e(6235),r.e(9942)]).then(r.bind(r,39942))))})))}},13120:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>T});var n=r(88196),a=r(99247),o=r(43800),i=r(90872),s=r(1502),l=r(99512);function c(e=[],t=[]){if(e[0]===t[0])return!0;{const r=new Set(e);return t.some((e=>r.has(e)))}}function d(e,t,r){const n=(0,o.readConfObject)(t,"category")||[],a=e.toLowerCase();return(0,l.getTrackName)(t,r).toLowerCase().includes(a)||!!n.filter((e=>e.toLowerCase().includes(a))).length}function u(e,t){let r=!1;for(const n of e)n.children.length?u(n.children,t)&&t.push(n.id):r=!0;return r}function p(e,t){for(const r of e)r.children.length&&t.push(r.id)}function m(e,t){const{assemblyManager:r}=(0,i.getSession)(t),{pluginManager:n}=(0,i.getEnv)(t),{view:a}=t;if(!a)return[];const s=t.assemblyNames.map((e=>r.get(e))).filter(i.notEmpty);return e.filter((e=>{const t=(0,o.readConfObject)(e,"assemblyNames"),n=t?.map((e=>r.get(e))).filter(i.notEmpty);return a.trackSelectorAnyOverlap?c(n,s):function(e=[],t=[]){const r=new Set(e);return t.every((e=>r.has(e)))}(n,s)})).filter((e=>{const{displayTypes:t}=n.getViewType(a.type);return c(t.map((e=>e.name)),e.displays.map((e=>e.type)))}))}function g({model:e,trackConfs:t,extra:r,noCategories:n,menuItems:a}){const s={children:[]},{collapsed:c,filterText:u,activeSortTrackNames:p,activeSortCategories:m,view:g}=e;if(!g)return[];const f=(0,i.getSession)(e),h=g.tracks,y=t.filter((e=>d(u,e,f)));for(const e of function(e,t,r){const n=e.map((e=>[e,(0,o.readConfObject)(e,"name"),(0,o.readConfObject)(e,"category")?.[0]||"",(0,o.readConfObject)(e,"category")?.[1]||"",(0,o.readConfObject)(e,"category")?.[2]||""]));return t&&n.sort(((e,t)=>e[1].localeCompare(t[1]))),r&&n.sort(((e,t)=>e[2]!==t[2]?e[2].localeCompare(t[2]):e[3]!==t[3]?e[3].localeCompare(t[3]):e[4]!==t[4]?e[4].localeCompare(t[4]):0)),n.map((e=>e[0]))}(y,p,m)){const t=[...(0,o.readConfObject)(e,"category")||[]];e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");let i=s;if(!n)for(let e=0;e<t.length;e++){const n=t[e],o=i.children.find((e=>e.name===n)),s=[r,t.slice(0,e+1).join(",")].filter((e=>!!e)).join("-");if(o)i=o;else{const e={children:[],name:n,id:s,isOpenByDefault:!c.get(s),menuItems:a,type:"category"};i.children.push(e),i=e}}const d=i.children.findIndex((e=>e.children.length)),u=-1===d?i.children.length:d;i.children.splice(u,0,{id:[r,e.trackId].filter((e=>!!e)).join(","),trackId:e.trackId,name:(0,l.getTrackName)(e,f),conf:e,checked:h.some((t=>t.configuration===e)),children:[],type:"track"})}return s.children}function f(e,t,r){return e.filter((e=>t.map((t=>r(t,e))).filter((e=>!!e)).length>5))}const h=["category","adapter","description"];function y(){return void 0!==typeof window?[void 0!==typeof window?[window.location.host,window.location.pathname].join("-"):"empty",new URLSearchParams(window.location.search).get("config")].join("-"):"empty"}const b=()=>`favoriteTracks-${y()}}`,w=()=>`recentlyUsedTracks-${y()}}`;function v(e){return n.types.model("HierarchicalTrackSelectorWidget",{id:s.ElementId,type:n.types.literal("HierarchicalTrackSelectorWidget"),initialized:n.types.maybe(n.types.boolean),collapsed:n.types.map(n.types.boolean),sortTrackNames:n.types.maybe(n.types.boolean),sortCategories:n.types.maybe(n.types.boolean),view:n.types.safeReference(e.pluggableMstType("view","stateModel")),favorites:n.types.optional(n.types.array(n.types.string),(()=>JSON.parse((0,i.localStorageGetItem)(b())||"[]"))),recentlyUsed:n.types.optional(n.types.array(n.types.string),(()=>JSON.parse((0,i.localStorageGetItem)(w())||"[]"))),faceted:n.types.optional(n.types.model("FacetedModel",{filterText:n.types.optional(n.types.string,""),showSparse:n.types.optional(n.types.boolean,(()=>JSON.parse((0,i.localStorageGetItem)("facet-showSparse")||"false"))),showFilters:n.types.optional(n.types.boolean,(()=>JSON.parse((0,i.localStorageGetItem)("facet-showFilters")||"true"))),showOptions:n.types.optional(n.types.boolean,(()=>JSON.parse((0,i.localStorageGetItem)("facet-showTableOptions")||"false"))),panelWidth:n.types.optional(n.types.number,(()=>JSON.parse((0,i.localStorageGetItem)("facet-panelWidth")||"400")))}).volatile((()=>({visible:{},widths:{},useShoppingCart:!1,filters:a.observable.map()}))).actions((e=>({setFilter(t,r){e.filters.set(t,r)},setPanelWidth(t){e.panelWidth=t},setUseShoppingCart(t){e.useShoppingCart=t},setFilterText(t){e.filterText=t},setShowSparse(t){e.showSparse=t},setShowOptions(t){e.showOptions=t},setShowFilters(t){e.showFilters=t}}))).views((e=>({get allTrackConfigurations(){return(0,n.getParent)(e).allTrackConfigurations}}))).views((e=>({get rows(){const t=(0,i.getSession)(e),{allTrackConfigurations:r,filterText:n}=e;return r.filter((e=>d(n,e,t))).map((e=>{const r=(0,o.readConfObject)(e,"metadata");return{id:e.trackId,conf:e,name:(0,l.getTrackName)(e,t),category:(0,o.readConfObject)(e,"category")?.join(", "),adapter:(0,o.readConfObject)(e,"adapter")?.type,description:(0,o.readConfObject)(e,"description"),metadata:r}}))}}))).views((e=>({get filteredNonMetadataKeys(){return e.showSparse?h:f(h,e.rows,((e,t)=>e[t]))},get metadataKeys(){return[...new Set(e.rows.flatMap((e=>{return t=e.metadata,Object.entries(t).map((([e,t])=>"string"==typeof t?e:"")).filter((e=>!!e));var t})))]},get filteredMetadataKeys(){return e.showSparse?this.metadataKeys:f(this.metadataKeys,e.rows,((e,t)=>e.metadata[t]))},get fields(){return["name",...this.filteredNonMetadataKeys,...this.filteredMetadataKeys.map((e=>`metadata.${e}`))]},get filteredRows(){const t=[...e.filters.entries()].filter((e=>e[1].length>0)).map((([e,t])=>[e,new Set(t)]));return e.rows.filter((e=>t.every((([t,r])=>r.has(e[t])))))}}))).actions((e=>({setVisible(t){e.visible=t},setWidths(t){e.widths=t},afterAttach(){(0,n.addDisposer)(e,(0,a.autorun)((()=>{this.setVisible(Object.fromEntries(e.fields.map((e=>[e,!0]))))}))),(0,n.addDisposer)(e,(0,a.autorun)((()=>{this.setWidths({name:(0,i.measureGridWidth)(e.rows.map((e=>e.name)),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(e.filteredNonMetadataKeys.filter((t=>e.visible[t])).map((t=>[t,(0,i.measureGridWidth)(e.rows.map((e=>e[t])),{maxWidth:400,stripHTML:!0})]))),...Object.fromEntries(e.filteredMetadataKeys.filter((t=>e.visible["metadata."+t])).map((t=>["metadata."+t,(0,i.measureGridWidth)(e.rows.map((e=>e.metadata[t])),{maxWidth:400,stripHTML:!0})])))})})))}}))),{})}).volatile((()=>({selection:[],filterText:"",recentlyUsedCounter:0,favoritesCounter:0}))).views((e=>({get selectionSet(){return new Set(e.selection)},get favoritesSet(){return new Set(e.favorites)},get recentlyUsedSet(){return new Set(e.recentlyUsed)}}))).actions((e=>({setSortTrackNames(t){e.sortTrackNames=t},setSortCategories(t){e.sortCategories=t},setSelection(t){e.selection=t},addToSelection(t){e.selection=(0,i.dedupe)([...e.selection,...t],(e=>e.trackId))},removeFromSelection(t){const r=new Set(t);e.selection=e.selection.filter((e=>!r.has(e)))},clearSelection(){e.selection=[]},addToFavorites(t){e.favoritesCounter+=1,e.favorites.push(t)},removeFromFavorites(t){e.favorites.remove(t)},clearFavorites(){e.favorites.clear()},setRecentlyUsedCounter(t){e.recentlyUsedCounter=t},setFavoritesCounter(t){e.favoritesCounter=t},addToRecentlyUsed(t){e.recentlyUsedCounter+=1,e.recentlyUsed.includes(t)||(e.recentlyUsed.length>=10&&e.recentlyUsed.shift(),e.recentlyUsed.push(t))},clearRecentlyUsed(){e.recentlyUsed.clear()},setView(t){e.view=t},toggleCategory(t){e.collapsed.set(t,!e.collapsed.get(t))},setCategoryCollapsed(t,r){e.collapsed.set(t,r)},expandAllCategories(){e.collapsed.clear()},clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}}))).views((t=>({isSelected:e=>t.selectionSet.has(e),isFavorite:e=>t.favoritesSet.has(e),isRecentlyUsed:e=>t.recentlyUsedSet.has(e),getRefSeqTrackConf(r){const{assemblyManager:n}=(0,i.getSession)(t),a=n.get(r),o=a?.configuration.sequence,s=e.getViewType(t.view.type);if(o)for(const e of o.displays)if(s.displayTypes.some((t=>t.name===e.type)))return o}}))).views((e=>({get assemblyNames(){return e.view?.assemblyNames||[]}}))).views((e=>({get activeSortTrackNames(){return e.sortTrackNames??(0,o.getConf)((0,i.getSession)(e),["hierarchical","sort","trackNames"])},get activeSortCategories(){return e.sortCategories??(0,o.getConf)((0,i.getSession)(e),["hierarchical","sort","categories"])},get configAndSessionTrackConfigurations(){return[...e.assemblyNames.map((t=>e.getRefSeqTrackConf(t))),...m((0,i.getSession)(e).tracks,e)].filter(i.notEmpty)},get allTrackConfigurations(){const{connectionInstances:t=[]}=(0,i.getSession)(e);return[...this.configAndSessionTrackConfigurations,...t?.flatMap((e=>e.tracks))]}}))).views((e=>({get favoriteTracks(){return e.allTrackConfigurations.filter((t=>e.favoritesSet.has(t.trackId)))},get recentlyUsedTracks(){return e.allTrackConfigurations.filter((t=>e.recentlyUsedSet.has(t.trackId)))}}))).views((e=>({get allTracks(){const{connectionInstances:t=[]}=(0,i.getSession)(e);return[{group:"Tracks",tracks:e.configAndSessionTrackConfigurations,noCategories:!1,menuItems:[]},...t.flatMap((e=>({group:(0,o.getConf)(e,"name"),tracks:e.tracks,noCategories:!1,menuItems:[]})))]}}))).views((e=>({get hierarchy(){return{name:"Root",id:"Root",isOpenByDefault:!0,type:"category",children:e.allTracks.map((t=>({name:t.group,id:t.group,type:"category",isOpenByDefault:!e.collapsed.get(t.group),menuItems:t.menuItems,children:g({model:e,trackConfs:t.tracks,extra:t.group,noCategories:t.noCategories})})))}}}))).actions((e=>({collapseSubCategories(){const t=[];u(e.hierarchy.children,t);for(const r of t)e.setCategoryCollapsed(r,!0)},collapseTopLevelCategories(){const t=[];for(const r of e.hierarchy.children)r.children.length&&p(r.children,t);for(const r of t)e.setCategoryCollapsed(r,!0)}}))).actions((e=>({afterCreate(){if(!e.initialized){const t=(0,i.getSession)(e);(0,o.getConf)(t,["hierarchical","defaultCollapsed","topLevelCategories"])&&e.collapseTopLevelCategories(),(0,o.getConf)(t,["hierarchical","defaultCollapsed","subCategories"])&&e.collapseSubCategories();for(const r of(0,o.getConf)(t,["hierarchical","defaultCollapsed","categoryNames"]))e.collapsed.set(r,!0);e.initialized=!0}}}))).views((e=>({get hasAnySubcategories(){return e.allTracks.some((e=>e.tracks.some((e=>(0,o.readConfObject)(e,"category")?.length>1))))}}))).actions((e=>({afterAttach(){(0,n.addDisposer)(e,(0,a.autorun)((()=>{(0,i.localStorageSetItem)(b(),JSON.stringify(e.favorites)),(0,i.localStorageSetItem)(w(),JSON.stringify(e.recentlyUsed))})))}}))).postProcessSnapshot((e=>{const{favorites:t,recentlyUsed:r,...n}=e;return n}))}const C=(0,o.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{});var S=r(20592),k=r(66204);const T=e=>{e.addWidgetType((()=>new S.WidgetType({name:"HierarchicalTrackSelectorWidget",heading:"Available tracks",configSchema:C,stateModel:v(e),ReactComponent:(0,k.lazy)((()=>Promise.all([r.e(6924),r.e(9796)]).then(r.bind(r,39796))))})))}},58391:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var n=r(43800),a=r(20592),o=r(66204),i=r(88196),s=r(1502);function l(e){return i.types.model("PluginStoreModel",{id:s.ElementId,type:i.types.literal("PluginStoreWidget"),filterText:"",view:i.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((e=>({clearFilterText(){e.filterText=""},setFilterText(t){e.filterText=t}})))}const c=(0,n.ConfigurationSchema)("PluginStoreWidget",{}),d=e=>{e.addWidgetType((()=>new a.WidgetType({name:"PluginStoreWidget",heading:"Plugin store",configSchema:c,stateModel:l(e),ReactComponent:(0,o.lazy)((()=>r.e(8130).then(r.bind(r,28130))))})))}},72602:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var n=r(20592),a=r(72271),o=r(43800),i=r(88196);const s=(0,o.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:a.baseConnectionConfig});function l(e){return i.types.compose("UCSCTrackHubConnection",(0,a.BaseConnectionModelFactory)(e),i.types.model({configuration:(0,o.ConfigurationReference)(s),type:i.types.literal("UCSCTrackHubConnection")})).actions((e=>({async connect(){const{doConnect:t}=await r.e(9437).then(r.bind(r,59437));t(e)}})))}const c=e=>{e.addConnectionType((()=>new n.ConnectionType({name:"UCSCTrackHubConnection",configSchema:s,stateModel:l(e),displayName:"UCSC Track Hub",description:"A track or assembly hub in the Track Hub format",url:"//genome.ucsc.edu/goldenPath/help/hgTrackHubHelp.html#Intro"})))}},63008:(e,t,r)=>{"use strict";function n(e,t,r=!0){const{assemblyName:n,refName:a,start:o,offset:i,oob:s}=t.pxToBp(e),l=Math.floor(o+i);return s?"out of bounds":`${r?"{"+n+"}":""}${a}:${l.toLocaleString("en-US")}`}function a(e,t,r){const n=new Set,a=[...e].sort(((e,t)=>{const r=e.end-e.start;return t.end-t.start-r})),o=Array.from({length:Math.round(t)});for(const{key:e,offsetPx:i}of a){const a=Math.round(t-i+r),s=[Math.max(a-12,0),a];0===a||o.slice(...s).some(Boolean)?n.add(e):o.fill(!0,...s)}return n}function o(e,t,r=!0,n=!0){const a=[],o=function(e,t,r){const n=60*(e=Math.abs(e));let a=10**Number.parseInt(Number(n).toExponential().split(/e/i)[1],10);for(;a<n&&(a*=2,!(a>=n));)a*=2.5;a=Math.max(a,5);const o=a/e;let i=0;return!(a%10)&&o/10>=15?i=a/10:!(a%5)&&o/5>=15?i=a/5:!(a%2)&&o/2>=15&&(i=a/2),{majorPitch:a,minorPitch:i}}(t),i=o.minorPitch||o.majorPitch;for(const{start:t,end:s,refName:l}of e){let e=0;const c=t,d=s;for(let s=Math.floor(c/i)*i;s<Math.ceil(d/i)*i+1;s+=i)n&&s%o.majorPitch?(a.push({type:"minor",base:s-1,index:e,refName:l}),e+=1):r&&Math.abs(s-t)>o.minorPitch&&(a.push({type:"major",base:s-1,index:e,refName:l}),e+=1)}return a}r.d(t,{Cz:()=>o,F$:()=>a,c4:()=>n})},86394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var n=r(66204),a=r(31617),o=r(90228),i=r(80013),s=r(2331),l=r(75174),c=r(38684),d=r(80846),u=r(2266);const p=(0,d.observer)((function({job:e}){return n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},n.createElement("strong",null,"Name: "),e.name),e.statusMessage?n.createElement(i.Z,{variant:"body1"},n.createElement("strong",null,"Message: "),e.statusMessage):null))}));var m=r(26481),g=r(30734),f=r(90617),h=r(7146);const y=(0,d.observer)((function({job:e}){const[t,r]=(0,n.useState)(!1);return n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},n.createElement("strong",null,"Name: "),e.name),n.createElement(i.Z,{variant:"body1"},n.createElement("strong",null,"Message: "),e.statusMessage||"No message provided"),n.createElement(m.Z,{sx:{display:"flex",alignItems:"center",marginTop:10,marginBottom:10,marginLeft:10}},0===e.progressPct||100===e.progressPct?n.createElement(m.Z,{sx:{width:"100%"}},n.createElement(g.Z,{variant:"indeterminate"})):n.createElement(n.Fragment,null,n.createElement(m.Z,{sx:{width:"100%"}},n.createElement(g.Z,{variant:"determinate",value:e.progressPct})),n.createElement(m.Z,{sx:{m:1}},n.createElement(i.Z,null,`${Math.round(e.progressPct||0)}%`))))),e.cancelCallback?n.createElement(f.Z,null,n.createElement(h.Z,{variant:"contained",color:"inherit",disabled:t||0===e.progressPct,onClick:()=>{e.setStatusMessage("Aborted via cancel button"),e.cancelCallback&&e.cancelCallback(),r(!0)}},"Cancel")):null)})),b=(0,c.ZL)()((e=>({root:{margin:e.spacing(1)},expandIcon:{color:e.palette.tertiary.contrastText}}))),w=(0,d.observer)((function({model:e}){const{classes:t}=b(),{jobs:r,finished:c,queued:d,aborted:m}=e;return n.createElement("div",{className:t.root},n.createElement(a.Z,{defaultExpanded:!0},n.createElement(o.Z,{expandIcon:n.createElement(u.Z,{className:t.expandIcon})},n.createElement(i.Z,{variant:"h5"},"Running jobs")),r.length?r.map(((e,t)=>n.createElement(y,{job:e,key:`${JSON.stringify(e)}-${t}`}))):n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},"No running jobs")))),n.createElement(a.Z,{defaultExpanded:!0},n.createElement(o.Z,{expandIcon:n.createElement(u.Z,{className:t.expandIcon})},n.createElement(i.Z,{variant:"h5"},"Queued jobs")),d.length?d.map(((e,t)=>n.createElement(p,{job:e,key:`${JSON.stringify(e)}-${t}`}))):n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},"No queued jobs")))),n.createElement(a.Z,{defaultExpanded:!0},n.createElement(o.Z,{expandIcon:n.createElement(u.Z,{className:t.expandIcon})},n.createElement(i.Z,{variant:"h5"},"Completed jobs")),c.length?c.map(((e,t)=>n.createElement(p,{key:`${JSON.stringify(e)}-${t}`,job:e}))):n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},"No completed jobs")))),n.createElement(a.Z,{defaultExpanded:!0},n.createElement(o.Z,{expandIcon:n.createElement(u.Z,{className:t.expandIcon})},n.createElement(i.Z,{variant:"h5"},"Aborted jobs")),m.length?m.map(((e,t)=>n.createElement(p,{key:`${JSON.stringify(e)}-${t}`,job:e}))):n.createElement(s.Z,{variant:"outlined"},n.createElement(l.Z,null,n.createElement(i.Z,{variant:"body1"},"No aborted jobs")))))}))},19150:(e,t,r)=>{"use strict";r.d(t,{b0:()=>s,n2:()=>c,sh:()=>l});var n=r(66204),a=r(38684),o=r(80846);const i=(0,a.ZL)()((e=>({contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.disabled},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}))),s=(0,o.observer)((function({block:e,children:t}){const{classes:r}=i(),{widthPx:a}=e;return n.createElement("div",{style:{width:a},className:r.contentBlock},t)}));function l({width:e}){const{classes:t}=i();return n.createElement("div",{className:t.elidedBlock,style:{width:e}})}function c({boundary:e,width:t,style:r={}}){const{classes:a}=i();return n.createElement("div",{style:{...r,width:t},className:e?a.boundaryPaddingBlock:a.interRegionPaddingBlock})}},90482:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r(66204),a=r(7146),o=r(32831),i=r(23540);const s=(0,r(38684).ZL)()({ellipses:{textOverflow:"ellipsis",overflow:"hidden"}});function l({message:e,severity:t,buttonText:r,icon:l,action:c}){const{classes:d}=s(),u=c?n.createElement(a.Z,{"data-testid":"reload_button",onClick:c,startIcon:l},r):null;return n.createElement(o.Z,{severity:t,action:u,classes:{message:d.ellipses}},n.createElement(i.Z,{title:e},n.createElement("div",null,e)))}},57918:(e,t,r)=>{"use strict";r.d(t,{Z:()=>b,m:()=>w});var n=r(88196),a=r(43800),o=r(90872),i=r(1502),s=r(55022),l=r(99512),c=r(66204),d=r(38684),u=r(80846),p=r(35421),m=r(57985),g=r(90482);const f=(0,d.ZL)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"}}})),h=(0,u.observer)((({model:e})=>{const{classes:t}=f(),{status:r}=e,{message:a}=(0,n.getParent)(e,2),o=a||r;return c.createElement("div",{className:t.loading},c.createElement(p.LoadingEllipses,{message:o}))})),y=(0,u.observer)((function({model:e}){return e.error?c.createElement(g.Z,{message:`${e.error}`,severity:"error",buttonText:"reload",icon:c.createElement(m.Z,null),action:e.reload}):e.message?c.isValidElement(e.message)?e.message:c.createElement(g.Z,{message:`${e.message}`,severity:"info"}):e.filled?e.reactElement:c.createElement(h,{model:e})})),b=n.types.model("BlockState",{key:n.types.string,region:i.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((()=>({renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:y,renderProps:void 0}))).actions((e=>{let t;return{doReload(){e.reloadFlag=e.reloadFlag+1},afterAttach(){const t=(0,o.getContainingDisplay)(e);setTimeout((()=>{(0,n.isAlive)(e)&&(0,o.makeAbortableReaction)(e,w,v,{name:`${t.id}/${(0,o.assembleLocString)(e.region)} rendering`,delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)}),t.renderDelay)},setStatus(t){e.status=t},setLoading(r){void 0===t||t.signal.aborted||t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=r},setMessage(r){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=r,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered(r){if(!r)return;const{reactElement:n,features:a,layout:o,maxHeightReached:i,renderProps:s}=r;e.filled=!0,e.message=void 0,e.reactElement=n,e.features=a,e.layout=o,e.error=void 0,e.maxHeightReached=i,e.renderProps=s,t=void 0},setError(r){console.error(r),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=r,e.renderProps=void 0,t=void 0,(0,s.Z6)(r)&&this.reload()},reload(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=y,e.renderProps=void 0,(0,n.getParent)(e,2).reload()},beforeDestroy(){(async()=>{try{t&&!t.signal.aborted&&t.abort();const r=(0,o.getContainingDisplay)(e),{rpcManager:a}=(0,o.getSession)(e),{rendererType:i}=r,{renderArgs:s}=w((0,n.cast)(e));s&&await i.freeResourcesInClient(a,JSON.parse(JSON.stringify(s)))}catch(e){console.error("Error while destroying block",e)}})()}}}));function w(e,t){try{const r=t||(0,o.getContainingDisplay)(e),{assemblyManager:i,rpcManager:s}=(0,o.getSession)(r),{adapterConfig:c,rendererType:d,error:u,parentTrack:p}=r,m=(0,l.getTrackAssemblyNames)(p),g=e.region.assemblyName;if(!m.includes(g)&&!m.some((e=>i.get(e)?.hasName(g))))throw new Error(`region assembly (${g}) does not match track assemblies (${m})`);const f=r.renderProps(),{config:h}=f;(0,a.readConfObject)(h);const y=(0,l.getRpcSessionId)(r),b=(0,o.getContainingView)(r).id;return{rendererType:d,rpcManager:s,renderProps:f,cannotBeRenderedReason:r.regionCannotBeRendered(e.region),displayError:u,renderArgs:{statusCallback:t=>{(0,n.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[(0,n.getSnapshot)(e.region)],adapterConfig:c,rendererType:d.name,sessionId:y,layoutId:b,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(e){return{displayError:e}}}async function v(e,t,r){if(!e)return;const{rendererType:a,renderProps:i,rpcManager:s,renderArgs:l,cannotBeRenderedReason:c,displayError:d}=e;if(!(0,n.isAlive)(r))return;if(d)return void r.setError(d);if(c)return void r.setMessage(c);if(i.notReady)return;const{reactElement:u,features:p,layout:m,maxHeightReached:g}=await a.renderInClient(s,{...l,...i,viewParams:(0,o.getViewParams)(r),signal:t});return{reactElement:u,features:p,layout:m,maxHeightReached:g,renderProps:i}}},26809:(e,t,r)=>{"use strict";r.d(t,{Iy:()=>l,ej:()=>i,zv:()=>s});var n=r(90872),a=r(99512),o=r(88196);function i(e){let t;return t=Math.floor(e/1e6)>0?`${Number.parseFloat((e/1e6).toPrecision(3))} Mb`:Math.floor(e/1e3)>0?`${Number.parseFloat((e/1e3).toPrecision(3))} Kb`:`${Math.floor(e)} bytes`,t}function s(e,t){return`clip-${"undefined"==typeof jest?e:"jest"}-${t}`}async function l(e){const t=(0,n.getContainingView)(e).staticBlocks.contentBlocks,{rpcManager:r}=(0,n.getSession)(e),{adapterConfig:i}=e;if(!i)return{};const s=(0,a.getRpcSessionId)(e);return r.call(s,"CoreGetFeatureDensityStats",{sessionId:s,regions:t,adapterConfig:i,statusCallback:t=>{(0,o.isAlive)(e)&&e.setMessage(t)}})}},4635:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var n=r(66204),a=r(80846),o=r(39194),i=r(33846);function s(e,t,r,n,a){return"M"+e+","+t+"h"+(r-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(n-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-r)+"z"}function l(e,t,r,n,a){return"M"+(e+a)+","+t+"h"+(r-a)+"v"+n+"h"+(a-r)+"a"+a+","+a+" 0 0 1 "+-a+","+-a+"v"+(2*a-n)+"a"+a+","+a+" 0 0 1 "+a+","+-a+"z"}function c(e,t,r,n){return[[e,n/2],[e+r,0],[e+r,n]].toString()}const d={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},u=(0,a.observer)((function({overview:e,block:t,assembly:r}){const{offsetPx:a,reversed:u}=t,p=(0,i.wo)(r,t.refName),m=u?p.length-1:0,g=u?0:p.length-1,f=o.VH;let h=!1;return n.createElement("g",{transform:`translate(-${a})`},p.map(((t,r)=>{const a=JSON.stringify(t),{refName:o,type:i,start:u,end:p}=t,y=e.bpToPx({refName:o,coord:u})||0,b=e.bpToPx({refName:o,coord:p})||0,w=Math.min(y,b),v=Math.abs(b-y),C=d[i];return"acen"!==i||h?"acen"===i&&h?n.createElement("polygon",{key:a,points:c(y,0,v,f),fill:C}):m===r?n.createElement("path",{key:a,d:l(w,0,v,f,8),fill:C}):g===r?n.createElement("path",{key:a,d:s(w,0,v,f,8),fill:C}):n.createElement("rect",{key:a,x:w,y:0,width:v,height:f,fill:C}):(h=!0,n.createElement("polygon",{key:a,points:(S=y,k=v,T=f,[[S,0],[S+k,T/2],[S,T]].toString()),fill:C}));var S,k,T})))}))},38739:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>me});var n=r(66204),a=r(86636),o=r(80013),i=r(7146),s=r(38684),l=r(35421),c=r(90872),d=r(80846),u=r(24728),p=r(88196),m=r(76591),g=r(73330),f=r(49140),h=r(43800),y=r(99512),b=r(69282),w=r(98313),v=r(3206),C=r(41997),S=r(97916),k=r(4953);const T=(0,s.ZL)()({dragHandle:{cursor:"grab"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"}}),x=function({trackId:e,view:t,track:r}){const{classes:a}=T();return n.createElement("span",{draggable:!0,className:a.dragHandle,onDragStart:e=>{const n=e.currentTarget;if(n.parentNode){const a=n.parentNode;e.dataTransfer.setDragImage(a,20,20),t.setDraggingTrackId(r.id)}},onDragEnd:()=>t.setDraggingTrackId(void 0),"data-testid":`dragHandle-${t.id}-${e}`},n.createElement(k.Z,{className:a.dragHandleIcon,fontSize:"small"}))},P=(0,s.ZL)()((e=>({root:{background:(0,g.Fq)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}))),M=(0,d.observer)(n.forwardRef((function({track:e,className:t},r){const{classes:i,cx:s}=P(),d=(0,c.getContainingView)(e),u=(0,c.getSession)(e),p=e.configuration,m=e.minimized,g=(0,h.getConf)(e,"trackId"),k=(0,y.getTrackName)(p,u),T=[{label:m?"Restore track":"Minimize track",icon:m?S.Z:C.Z,onClick:()=>e.setMinimized(!m)},...u.getTrackActionMenuItems?.(p)||[],...e.trackMenuItems()].sort(((e,t)=>(t?.priority||0)-(e?.priority||0)));return n.createElement(a.Z,{ref:r,className:s(t,i.root)},n.createElement(x,{track:e,trackId:g,view:d}),n.createElement(f.Z,{onClick:()=>d.hideTrack(g),className:i.iconButton,title:"close this track"},n.createElement(v.Z,{fontSize:"small"})),n.createElement(o.Z,{variant:"body1",component:"span",className:i.trackName},n.createElement(l.SanitizedHTML,{html:[k,m?"(minimized)":""].filter((e=>!!e)).join(" ")})),n.createElement(b.Z,{menuItems:T,"data-testid":"track_menu_icon"},n.createElement(w.Z,{fontSize:"small"})))}))),E=(0,s.ZL)()({trackLabel:{zIndex:3},trackLabelOffset:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"}}),R=(0,d.observer)((function({track:e,view:t}){const{classes:r,cx:a}=E(),o=e.displays[0],{trackLabel:i,trackLabelOverlap:s,trackLabelOffset:l}=r,c="overlapping"!==t.trackLabelsSetting||o.prefersOffset?l:s;return"hidden"!==t.trackLabelsSetting?n.createElement(M,{track:e,className:a(i,c)}):null})),A=(0,s.ZL)()({renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}),I=(0,d.observer)((function({model:e,track:t,onDragEnter:r}){const{classes:a}=A(),o=t.displays[0],{height:i,RenderingComponent:s,DisplayBlurb:c}=o,d=(0,h.getConf)(t,"trackId"),u=(0,n.useRef)(null),p=t.minimized;return(0,n.useEffect)((()=>(u.current&&(e.trackRefs[d]=u.current),()=>{delete e.trackRefs[d]})),[e.trackRefs,d]),n.createElement("div",{className:a.trackRenderingContainer,style:{height:p?20:i},onScroll:e=>o.setScrollTop(e.currentTarget.scrollTop),onDragEnter:r,"data-testid":`trackRenderingContainer-${e.id}-${d}`},p?null:n.createElement(n.Fragment,null,n.createElement("div",{ref:u,className:a.renderingComponentContainer,style:{transform:`scaleX(${e.scaleFactor})`}},n.createElement(n.Suspense,{fallback:n.createElement(l.LoadingEllipses,null)},n.createElement(s,{model:o,onHorizontalScroll:e.horizontalScroll}))),c?n.createElement("div",{style:{position:"absolute",left:0,top:o.height-20}},n.createElement(c,{model:o})):null))})),F=(0,s.ZL)()({root:{marginTop:2},resizeHandle:{height:3,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3}}),N=(0,d.observer)((function({model:e,track:t}){const{classes:r}=F(),o=t.displays[0],{draggingTrackId:i}=e,s=(0,n.useRef)(null),d=void 0!==i&&i!==o.id,u=(0,c.useDebouncedCallback)((()=>{(0,p.isAlive)(o)&&d&&e.moveTrack(i,t.id)}),100);return n.createElement(a.Z,{ref:s,className:r.root,variant:"outlined",onClick:r=>{if(2===r.detail&&!t.displays[0].featureIdUnderMouse){const t=s.current?.getBoundingClientRect().left||0;e.zoomTo(e.bpPerPx/2,r.clientX-t,!0)}}},n.createElement(R,{track:t,view:e}),n.createElement(m.SV,{FallbackComponent:e=>n.createElement(l.ErrorMessage,{error:e.error})},n.createElement(I,{model:e,track:t,onDragEnter:u})),n.createElement("div",{className:r.overlay,style:{height:o.height,background:d?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:u}),n.createElement(l.ResizeHandle,{onDrag:o.resizeHeight,className:r.resizeHandle}))}));var L=r(39194),D=r(50236),B=r.n(D),V=r(33846);function z(e,t,r){const[a,o]=(0,n.useState)(),[i,s]=(0,n.useState)(),[l,c]=(0,n.useState)(),[d,u]=(0,n.useState)(),p=void 0!==a&&void 0===l;function m(t){if(r&&!t.shiftKey)return;t.preventDefault(),t.stopPropagation();const n=(0,V.c6)(t,e.current);o(n),s(n)}function g(t){r?t.shiftKey?u((0,V.c6)(t,e.current)):u(void 0):u((0,V.c6)(t,e.current))}function f(){u(void 0),t.setOffsets(void 0,void 0)}function h(){c(void 0),o(void 0),s(void 0)}function y(e,t){t(),h()}(0,n.useEffect)((()=>{function r(t){if(e.current&&p){const r=(0,V.c6)(t,e.current);s(r)}}function n(r){if(void 0!==a&&e.current){const{clientX:n,clientY:o}=r,i=(0,V.c6)(r,e.current);c({offsetX:i,clientX:n,clientY:o});const s=function(e){if(void 0===a)return;const r=Math.min(a,e),n=Math.max(a,e);return{leftOffset:t.pxToBp(r),rightOffset:t.pxToBp(n)}}(i);s&&t.setOffsets(s.leftOffset,s.rightOffset),u(void 0)}}return p?(window.addEventListener("mousemove",r),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",n)}):()=>{}}),[a,p,l,t,e]),(0,n.useEffect)((()=>{!p&&void 0!==i&&void 0!==a&&Math.abs(i-a)<=3&&h()}),[p,i,a]);const b=Boolean(l);if(void 0===a)return{open:b,guideX:d,mouseDown:m,mouseMove:g,mouseOut:f,handleMenuItemClick:y};{const e=l?l.offsetX:i||0,r=e<a?e:a,n=Math.abs(e-a);return{open:b,rubberbandOn:!0,mouseDown:m,mouseMove:g,mouseOut:f,handleClose:h,handleMenuItemClick:y,leftBpOffset:t.pxToBp(r),rightBpOffset:t.pxToBp(r+n),anchorPosition:l,numOfBpSelected:Math.ceil(n*t.bpPerPx),width:n,left:r}}}var O=r(23540);const Z=(0,s.ZL)()({guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}),j=(0,d.observer)((function({model:e,coordX:t}){const{classes:r}=Z();return n.createElement(O.Z,{open:!0,placement:"top",title:(0,c.stringify)(e.pxToBp(t)),arrow:!0},n.createElement("div",{className:r.guide,style:{left:t,background:"red"}}))}));var W=r(47451);const $=(0,s.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8}}),H=(0,d.observer)((function({model:e,ControlComponent:t=n.createElement("div",null)}){const r=(0,n.useRef)(null),{classes:a}=$(),{guideX:o,rubberbandOn:i,leftBpOffset:s,rightBpOffset:c,numOfBpSelected:d,width:u,left:p,anchorPosition:m,handleMenuItemClick:g,open:f,handleClose:h,mouseMove:y,mouseDown:b,mouseOut:w}=z(r,e);return n.createElement(n.Fragment,null,void 0!==o?n.createElement(j,{model:e,coordX:o}):i?n.createElement(W.Z,{leftBpOffset:s,rightBpOffset:c,numOfBpSelected:d,width:u,left:p}):null,m?n.createElement(l.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:m.clientX,top:m.clientY},onMenuItemClick:g,open:f,onClose:h,menuItems:e.rubberBandMenuItems()}):null,n.createElement("div",{"data-testid":"rubberband_controls",className:a.rubberbandControl,ref:r,onMouseDown:b,onMouseMove:y,onMouseOut:w},t))}));var G=r(64019),q=r(19150),U=r(22405);function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_.apply(this,arguments)}const J=(0,s.ZL)()((e=>({scalebarContainer:{overflow:"hidden",position:"relative"},scalebarZoomContainer:{position:"relative",zIndex:1},scalebar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:11,zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:11,position:"absolute",left:2,top:-1,fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}))),X=(0,d.observer)((({model:e})=>{const{classes:t}=J();let r=0;return e.staticBlocks.forEach(((t,n)=>{t.offsetPx-e.offsetPx<0&&(r=n)})),n.createElement(n.Fragment,null,e.staticBlocks.map(((a,i)=>a instanceof G.b0&&(a.isLeftEndOfDisplayedRegion||i===r)?n.createElement(o.Z,{key:`refLabel-${a.key}-${i}`,style:{left:i===r?Math.max(0,-e.offsetPx):a.offsetPx-e.offsetPx-1,paddingLeft:i===r?0:1},className:t.refLabel,"data-testid":`refLabel-${a.refName}`},a.refName):null)))})),Y=function({block:e,bpPerPx:t}){const{classes:r}=J(),{reversed:a,start:i,end:s}=e,l=(0,U.Cz)(i,s,t,!0,!1);return n.createElement(q.b0,{block:e},l.map((({type:e,base:l})=>{if("major"===e){const e=(a?s-l:l-i)/t,d=l+1;return n.createElement("div",{key:l,className:r.tick,style:{left:e}},d?n.createElement(o.Z,{className:r.majorTickLabel},(0,c.getTickDisplayStr)(d,t)):null)}return null})))},K=(0,d.observer)((({model:e})=>{const{staticBlocks:t,bpPerPx:r}=e;return n.createElement(n.Fragment,null,t.map(((e,t)=>{const{key:a,widthPx:o}=e,i=`${a}-${t}`;return e instanceof G.b0?n.createElement(Y,{key:i,block:e,bpPerPx:r}):e instanceof G.sh?n.createElement(q.sh,{key:i,width:o}):e instanceof G.n2?n.createElement(q.n2,{key:i,width:o,style:{background:"none"},boundary:"boundary"===e.variant}):null})))})),Q=(0,d.observer)(n.forwardRef((function({model:e,style:t,className:r,...o},i){const{classes:s,cx:l}=J(),c=e.staticBlocks.offsetPx-e.offsetPx;return n.createElement(a.Z,_({"data-resizer":"true",className:l(s.scalebarContainer,r),variant:"outlined",ref:i,style:t},o),n.createElement("div",{className:s.scalebarZoomContainer,style:{transform:1!==e.scaleFactor?`scaleX(${e.scaleFactor})`:void 0}},n.createElement("div",{className:s.scalebar,style:{left:c-1,width:e.staticBlocks.totalWidthPx,...t}},n.createElement(K,{model:e}))),n.createElement(X,{model:e}))}))),ee=(0,s.ZL)()((e=>({verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.action.disabled},minorTick:{background:e.palette.divider}})));function te({block:e,bpPerPx:t}){const{classes:r,cx:a}=ee(),o=(0,U.Cz)(e.start,e.end,t);return n.createElement(q.b0,{block:e},o.map((({type:o,base:i})=>{const s=(e.reversed?e.end-i:i-e.start)/t;return n.createElement("div",{key:i,className:a(r.tick,"major"===o||"labeledMajor"===o?r.majorTick:r.minorTick),style:{left:s}})})))}const re=(0,d.observer)((({model:e})=>{const{staticBlocks:t,bpPerPx:r}=e;return n.createElement(n.Fragment,null,t.map(((e,t)=>{const a=`${e.key}-${t}`;return e instanceof G.b0?n.createElement(te,{key:a,block:e,bpPerPx:r}):e instanceof G.sh?n.createElement(q.sh,{key:a,width:e.widthPx}):e instanceof G.n2?n.createElement(q.n2,{key:a,width:e.widthPx,boundary:"boundary"===e.variant}):null})))})),ne=(0,d.observer)((function({model:e}){const{classes:t}=ee(),r=e.staticBlocks.offsetPx-e.offsetPx;return n.createElement("div",{className:t.verticalGuidesZoomContainer,style:{transform:1!==e.scaleFactor?`scaleX(${e.scaleFactor})`:void 0}},n.createElement("div",{className:t.verticalGuidesContainer,style:{left:r,width:e.staticBlocks.totalWidthPx}},n.createElement(re,{model:e})))})),ae=(0,s.ZL)()((e=>({centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:`1px ${e.palette.action.active} dashed`,borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}))),oe=(0,d.observer)((function({model:e}){const{bpPerPx:t,centerLineInfo:r,trackHeights:a,tracks:o,width:i}=e,s=(0,n.useRef)(null),{classes:l}=ae(),c=i/2;return o.length?n.createElement("div",{"data-testid":"centerline_container",className:l.centerLineContainer,role:"presentation",ref:s,style:{left:`${c}px`,width:Math.max(1/t,1)}},r&&n.createElement("div",{"data-testid":"centerline_text",className:l.centerLineText,role:"presentation",style:{left:Math.max(1/t,1)+5,top:a}},r.refName,":"," ",Math.max(Math.round(r.offset)+1,0))):null})),ie=oe,se=(0,s.ZL)()({tracksContainer:{position:"relative",overflow:"hidden"}}),le=(0,d.observer)((function({children:e,model:t}){const{classes:r}=se(),{pluginManager:a}=(0,c.getEnv)(t),{mouseDown:o,mouseUp:i}=function(e){const[t,r]=(0,n.useState)(!1),a=(0,n.useRef)(!1),o=(0,n.useRef)(0);return(0,n.useEffect)((()=>{let n=()=>{};function i(t){t.preventDefault();const r=t.clientX-o.current;r&&(a.current||(a.current=!0,window.requestAnimationFrame((()=>{e.horizontalScroll(-r),a.current=!1,o.current=t.clientX}))))}function s(){o.current=0,t&&r(!1)}return t&&(window.addEventListener("mousemove",i,!0),window.addEventListener("mouseup",s,!0),n=()=>{window.removeEventListener("mousemove",i,!0),window.removeEventListener("mouseup",s,!0)}),n}),[e,t,o]),{mouseDown:function(e){if(e.shiftKey)return;const t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(o.current=e.clientX,r(!0))},mouseUp:function(e){e.preventDefault(),r(!1)}}}(t),s=(0,n.useRef)(null),{guideX:d,rubberbandOn:u,leftBpOffset:p,rightBpOffset:m,numOfBpSelected:g,width:f,left:h,anchorPosition:y,handleMenuItemClick:b,open:w,handleClose:v,mouseMove:C,mouseDown:S}=z(s,t,!0);!function(e,t){const r=(0,n.useRef)(0),a=(0,n.useRef)(),o=(0,n.useRef)(!1);(0,n.useEffect)((()=>{const n=e.current;function i(e){const i=B()(e);!0===e.ctrlKey?(e.preventDefault(),r.current+=i.pixelY/500,t.setScaleFactor(r.current<0?1-r.current:1/(1+r.current)),a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{t.setScaleFactor(1),t.zoomTo(r.current>0?t.bpPerPx*(1+r.current):t.bpPerPx/(1-r.current),e.clientX-(n?.getBoundingClientRect().left||0)),r.current=0}),300)):(Math.abs(i.pixelX)>Math.abs(2*i.pixelY)&&e.preventDefault(),r.current+=i.pixelX,o.current||(o.current=!0,window.requestAnimationFrame((()=>{t.horizontalScroll(r.current),r.current=0,o.current=!1}))))}return n?(n.addEventListener("wheel",i),()=>{n.removeEventListener("wheel",i)}):()=>{}}),[t,e])}(s,t);const k=a.evaluateExtensionPoint("LinearGenomeView-TracksContainerComponent",void 0,{model:t});return n.createElement("div",{ref:s,"data-testid":"trackContainer",className:r.tracksContainer,onMouseDown:e=>{o(e),S(e)},onMouseMove:C,onMouseUp:i},t.showGridlines?n.createElement(ne,{model:t}):null,t.showCenterLine?n.createElement(ie,{model:t}):null,void 0!==d?n.createElement(j,{model:t,coordX:d}):u?n.createElement(W.Z,{leftBpOffset:p,rightBpOffset:m,numOfBpSelected:g,width:f,left:h}):null,y?n.createElement(l.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:y.clientX,top:y.clientY},onMenuItemClick:b,open:w,onClose:v,menuItems:t.rubberBandMenuItems()}):null,n.createElement(H,{model:t,ControlComponent:n.createElement(Q,{model:t,style:{height:L.n8,boxSizing:"border-box"}})}),k,e)})),ce=(0,n.lazy)((()=>r.e(7297).then(r.bind(r,67297)))),de=(0,s.ZL)()((e=>({note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},rel:{position:"relative"},top:{zIndex:1e3}})));function ue({model:e}){const{classes:t}=de(),{hideNoTracksActive:r}=e;return n.createElement(a.Z,{className:t.note},r?n.createElement("div",{style:{height:"48px"}}):n.createElement(n.Fragment,null,n.createElement(o.Z,null,"No tracks active."),n.createElement(i.Z,{variant:"contained",color:"primary",onClick:()=>e.activateTrackSelector(),className:t.top,startIcon:n.createElement(u.GD,null)},"Open track selector")))}const pe=(0,d.observer)((({model:e})=>{const{tracks:t,error:r,initialized:a,hasDisplayedRegions:o}=e,i=(0,n.useRef)(null),s=(0,c.getSession)(e),{classes:d}=de();if((0,n.useEffect)((()=>{function t(t){t.target instanceof Element&&i?.current?.contains(t.target)&&s.setFocusedViewId?.(e.id)}return document.addEventListener("mousedown",t),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",t)}}),[s,e]),!a&&!r)return n.createElement(l.LoadingEllipses,{variant:"h6"});if(!o||r)return n.createElement(ce,{model:e});const u=e.MiniControlsComponent(),p=e.HeaderComponent();return n.createElement("div",{className:d.rel,ref:i,onMouseLeave:()=>s.setHovered(void 0),onMouseMove:t=>{const r=i.current;if(!r)return;const{tracks:n}=e,a=t.clientX-r.getBoundingClientRect().left,o=e.pxToBp(a),l=n.find((e=>e.displays[0].featureUnderMouse));s.setHovered({hoverPosition:o,hoverFeature:l})}},n.createElement(p,{model:e}),n.createElement(u,{model:e}),n.createElement(le,{model:e},t.length?t.map((t=>n.createElement(N,{key:t.id,model:e,track:t}))):n.createElement(ue,{model:e})))})),me=pe},41499:(e,t,r)=>{"use strict";r.d(t,{mg:()=>S,ZP:()=>x});var n=r(66204),a=r(92368),o=r(73330),i=r(80013),s=r(38684),l=r(80846),c=r(31996),d=r(90872),u=r(64019),p=r(39194),m=r(22405),g=r(23540),f=r(47451),h=r(33846);const y=(0,s.ZL)()({rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},rel:{position:"relative"}}),b=(0,l.observer)((function({model:e,open:t,guideX:r,overview:a}){const{classes:o}=y(),{cytobandOffset:i}=e,{assemblyManager:s}=(0,d.getSession)(e),l=a.pxToBp(r-i),c=s.get(l.assemblyName),u=c?.cytobands?.find((e=>l.coord>e.get("start")&&l.coord<e.get("end")&&l.refName===c.getCanonicalRefName(e.get("refName"))));return n.createElement(g.Z,{open:t,placement:"top",title:[(0,d.stringify)(l),u?.get("name")].join(" "),arrow:!0},n.createElement("div",{className:o.guide,style:{left:r}}))})),w=(0,l.observer)((function({model:e,overview:t,ControlComponent:r=n.createElement("div",null)}){const{cytobandOffset:a}=e,[o,i]=(0,n.useState)(),[s,l]=(0,n.useState)(),[c,u]=(0,n.useState)(),p=(0,n.useRef)(null),{classes:m}=y(),g=void 0!==o;function w(e){e.preventDefault(),e.stopPropagation(),i((0,h.c6)(e,p.current))}function v(e){u((0,h.c6)(e,p.current))}function C(){u(void 0)}if((0,n.useEffect)((()=>{function r(e){const t=p.current;t&&g&&l((0,h.c6)(e,t))}function n(){if(void 0!==o&&void 0!==s&&Math.abs(s-o)>3){const r=Math.min(o,s),n=Math.max(o,s);e.moveTo(t.pxToBp(r-a),t.pxToBp(n-a))}if(void 0!==o&&void 0===s){const r=t.pxToBp(o-a);r.refName?e.centerAt(Math.round(r.coord),r.refName,r.index):((0,d.getSession)(e).notify("unknown position clicked"),console.error("unknown position clicked",r))}i(void 0),l(void 0),void 0!==o&&u(void 0)}function c(e){"Escape"===e.key&&(i(void 0),l(void 0))}return g?(window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",n,!0),window.addEventListener("keydown",c,!0),()=>{window.removeEventListener("mousemove",r,!0),window.removeEventListener("mouseup",n,!0),window.removeEventListener("keydown",c,!0)}):()=>{}}),[g,s,o,e,t,a]),void 0===o)return n.createElement("div",{className:m.rel},void 0!==c?n.createElement(b,{model:e,open:!g,overview:t,guideX:c}):null,n.createElement("div",{className:m.rubberbandControl,ref:p,onMouseDown:w,onMouseOut:C,onMouseMove:v},r));let S,k,T=o||0,x=0;return void 0!==o&&void 0!==s&&(T=s<o?s:o,x=s-o),o&&(S=t.pxToBp(o-a),k=t.pxToBp(o+x-a),void 0!==s&&s<o&&([S,k]=[k,S])),n.createElement("div",{className:m.rel},S&&k?n.createElement(f.Z,{leftBpOffset:S,rightBpOffset:k,width:Math.abs(x),left:T}):null,n.createElement("div",{"data-testid":"rubberband_controls",className:m.rubberbandControl,ref:p,onMouseDown:w,onMouseOut:C,onMouseMove:v},r))}));var v=r(4635);const C=(0,s.ZL)()((e=>({scalebar:{height:p.VH},scalebarBorder:{border:"1px solid"},scalebarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:p.VH,overflow:"hidden"},scalebarContigForward:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarContigReverse:{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='${e.palette.divider}'/%3E%3C/svg%3E")`,backgroundRepeat:"repeat"},scalebarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scalebarLabel:{height:p.VH,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scalebarVisibleRegion:{position:"absolute",height:p.VH,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:p.Od,position:"relative"},overviewSvg:{pointerEvents:"none",width:"100%",position:"absolute"}}))),S=(0,l.observer)((function({model:e,overview:t,useOffset:r=!0}){const i=(0,a.Z)(),s=Number(r),{interRegionPaddingWidth:l,offsetPx:c,dynamicBlocks:d,cytobandOffset:u}=e,{contentBlocks:m,totalWidthPxWithoutBorders:g}=d,{tertiary:f,primary:h}=i.palette,y=f?f.light:h.light;if(!m.length)return null;const b=m.at(0),w=m.at(-1),v=(t.bpToPx({...b,coord:b.reversed?b.end:b.start})||0)+u*s,C=(t.bpToPx({...w,coord:w.reversed?w.start:w.end})||0)+u*s,S=Math.max(0,-c),k=S+g+m.length*l/2,T=[[S,p.Od],[k,p.Od],[C,0],[v,0]];return n.createElement("polygon",{points:T.toString(),fill:(0,o.Fq)(y,.3),stroke:(0,o.Fq)(y,.8)})})),k=(0,l.observer)((function({scale:e,model:t,block:r,overview:o}){const{classes:s,cx:l}=C(),c=(0,a.Z)(),{cytobandOffset:u,showCytobands:p}=t,{start:g,end:f,reversed:y,refName:b,assemblyName:w}=r,{majorPitch:S}=(0,m._S)(e,120,15),{assemblyManager:k}=(0,d.getSession)(t),T=k.get(w),x=T?.getRefNameColor(b),P=[];for(let e=0;e<Math.floor((f-g)/S);e++){const t=(e+1)*S;P.push(y?f-t:g+t)}const M=p&&(0,h.wo)(T,r.refName).length;return n.createElement("div",null,n.createElement(i.Z,{style:{left:r.offsetPx+3,color:M?c.palette.text.primary:x},className:s.scalebarRefName},b),n.createElement("div",{className:l(s.scalebarContig,M?void 0:y?s.scalebarContigReverse:s.scalebarContigForward,M?void 0:s.scalebarBorder),style:{left:r.offsetPx+u,width:r.widthPx,borderColor:x}},M?null:P.map(((t,a)=>n.createElement(i.Z,{key:`${JSON.stringify(r)}-${t}-${a}`,className:s.scalebarLabel,variant:"body2",style:{left:(a+1)*S/e,pointerEvents:"none",color:x}},(0,d.getTickDisplayStr)(t,o.bpPerPx)))),M?n.createElement("svg",{style:{width:"100%"}},n.createElement(v.Z,{overview:o,assembly:T,block:r})):null))})),T=(0,l.observer)((function({model:e,scale:t,overview:r}){const{classes:i}=C(),s=(0,a.Z)(),{dynamicBlocks:l,showCytobands:c,cytobandOffset:d}=e,p=l.contentBlocks,m=r.dynamicBlocks,{tertiary:g,primary:f}=s.palette,h=g?g.light:f.light;if(!p.length)return null;const y=p.at(0),b=p.at(-1),w=r.bpToPx({...y,coord:y.reversed?y.end:y.start})||0,v=r.bpToPx({...b,coord:b.reversed?b.start:b.end})||0,S=c?"#f00":h,T=c?.1:.3;return n.createElement("div",{className:i.scalebar},n.createElement("div",{className:i.scalebarVisibleRegion,style:{width:v-w,left:w+d,background:(0,o.Fq)(S,T),borderColor:S}}),m.map(((a,o)=>a instanceof u.b0?n.createElement(k,{scale:t,block:a,model:e,overview:r,key:`${JSON.stringify(a)}-${o}`}):n.createElement("div",{key:`${JSON.stringify(a)}-${o}`,className:i.scalebarContig,style:{width:a.widthPx,left:a.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}}))))})),x=(0,l.observer)((function({model:e,children:t}){const{classes:r}=C(),{totalBp:a,width:o,cytobandOffset:i,displayedRegions:s}=e,l=o-i,d=(0,n.useMemo)((()=>{const t=c.Z.create({displayedRegions:JSON.parse(JSON.stringify(s)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth});return t.setVolatileWidth(l),t.showAllRegions(),t}),[JSON.stringify(s),e.minimumBlockWidth,l,s]),u=a/(l-2*(s.length-1));return n.createElement("div",null,n.createElement(w,{model:e,overview:d,ControlComponent:n.createElement(T,{model:e,overview:d,scale:u})}),n.createElement("div",{className:r.overview},n.createElement("svg",{height:p.Od,className:r.overviewSvg},n.createElement(S,{model:e,overview:d})),t))}))},85084:(e,t,r)=>{"use strict";r.d(t,{Z:()=>b});var n=r(66204),a=r(80846),o=r(90872),i=r(45728),s=r(88895),l=r(46338),c=r(49140),d=r(81799),u=r(62655),p=r(98621);const m=(0,n.lazy)((()=>r.e(8940).then(r.bind(r,28940))));function g(){const[e,t]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement(c.Z,{onClick:()=>t(!0),size:"small"},n.createElement(p.Z,{fontSize:"small"})),e?n.createElement(n.Suspense,{fallback:n.createElement("div",null)},n.createElement(m,{handleClose:()=>t(!1)})):null)}function f({showHelp:e,endAdornment:t}){return n.createElement(n.Fragment,null,n.createElement(d.Z,{position:"end",style:{marginRight:7}},n.createElement(u.Z,{fontSize:"small"}),e?n.createElement(g,null):null),t)}function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h.apply(this,arguments)}function y({TextFieldProps:e,inputBoxVal:t,params:r,showHelp:a,setInputValue:o,setCurrentSearch:i}){const{helperText:s,InputProps:c={}}=e;return n.createElement(l.Z,h({onBlur:()=>o(t)},r,e,{size:"small",helperText:s,InputProps:{...r.InputProps,...c,endAdornment:n.createElement(f,{showHelp:a,endAdornment:r.InputProps.endAdornment})},placeholder:"Search for location",onChange:e=>i(e.target.value)}))}const b=(0,a.observer)((function({model:e,onSelect:t,assemblyName:r,style:a,fetchResults:l,onChange:c,value:d,showHelp:u=!0,minWidth:p=200,maxWidth:m=550,TextFieldProps:g={}}){const f=(0,o.getSession)(e),{assemblyManager:h}=f,[b,w]=(0,n.useState)(!1),[v,C]=(0,n.useState)(!0),[S,k]=(0,n.useState)(""),[T,x]=(0,n.useState)(""),[P,M]=(0,n.useState)(),E=(0,o.useDebounce)(S,300),R=r?h.get(r):void 0,{coarseVisibleLocStrings:A,hasDisplayedRegions:I}=e;(0,n.useEffect)((()=>{let e=!0;return(async()=>{try{if(""===E||!r)return;C(!1);const t=await l(E);e&&(C(!0),M(function(e){return Object.entries(function(e){const t={};for(const r of e){const e=r.getDisplayString();t[e]||(t[e]=[]),t[e].push(r)}return t}(e)).map((([e,t])=>1===t.length?{result:t[0]}:{result:new i.Z({displayString:e,results:t,label:e})}))}(t)))}catch(t){console.error(t),e&&f.notify(`${t}`,"error")}})(),()=>{e=!1}}),[r,l,E,f,e]);const F=A||d||"",N=Math.min(Math.max((0,o.measureText)(F,14)+100,p),m);return n.createElement(n.Fragment,null,n.createElement(s.Z,{"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,disabled:!r,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:{...a,width:N},value:F,loading:!v,inputValue:T,onInputChange:(e,t)=>{x(t),c?.(t)},loadingText:"loading results",open:b,onOpen:()=>w(!0),onClose:()=>{w(!1),C(!0),I&&(k(""),M(void 0))},onChange:(e,n)=>{n&&r&&(t?.("string"==typeof n?new i.Z({label:n}):n.result),x(F))},options:P?.length?P:R?.regions?.map((e=>({result:new i.R({refName:e.refName,label:e.refName,matchedAttribute:"refName"})})))||[],getOptionDisabled:e=>"limitOption"===e.group,filterOptions:(e,{inputValue:t})=>function(e,t){const r=(n=e,a=t.toLocaleLowerCase(),n.filter((({result:e})=>e.getLabel().toLowerCase().includes(a)||e.matchedObject)));var n,a;return[...r.slice(0,100),...r.length>100?[{group:"limitOption",result:new i.Z({label:"keep typing for more results"})}]:[]]}(e,t),renderInput:e=>n.createElement(y,{showHelp:u,params:e,inputBoxVal:F,TextFieldProps:g,setCurrentSearch:k,setInputValue:x}),getOptionLabel:e=>"string"==typeof e?e:e.result.getDisplayString()}))}))},47451:(e,t,r)=>{"use strict";r.d(t,{Z:()=>d});var n=r(66204),a=r(38684),o=r(73330),i=r(64883),s=r(80013),l=r(90872);const c=(0,a.ZL)()((e=>{const{primary:t,tertiary:r}=e.palette;return{rubberband:{height:"100%",background:r?(0,o.Fq)(r.light,.7):(0,o.Fq)(t.light,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:r?r.contrastText:t.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)}}}));function d({leftBpOffset:e,rightBpOffset:t,numOfBpSelected:r,left:a,width:o}){const d=(0,n.useRef)(null),{classes:u}=c();return n.createElement(n.Fragment,null,d.current?n.createElement(n.Fragment,null,n.createElement(i.ZP,{className:u.popover,classes:{paper:u.paper},open:!0,anchorEl:d.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0},n.createElement(s.Z,null,(0,l.stringify)(e))),n.createElement(i.ZP,{className:u.popover,classes:{paper:u.paper},open:!0,anchorEl:d.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0},n.createElement(s.Z,null,(0,l.stringify)(t)))):null,n.createElement("div",{ref:d,className:u.rubberband,style:{left:a,width:o}},r?n.createElement(s.Z,{variant:"h6",className:u.rubberbandText},(0,l.toLocale)(r)," bp"):null))}},33846:(e,t,r)=>{"use strict";r.d(t,{c6:()=>i,kx:()=>o,wo:()=>s});var n=r(90872),a=r(45728);async function o({queryString:e,searchType:t,searchScope:r,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},r,o)),c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new a.Z({label:e})));return(0,n.dedupe)([...c||[],...l||[]],(e=>e.getId()))}function i(e,t){return e.clientX-(t?.getBoundingClientRect().left||0)}function s(e,t){return e?.cytobands?.map((t=>({refName:e.getCanonicalRefName(t.get("refName"))||t.get("refName"),start:t.get("start"),end:t.get("end"),type:t.get("type")}))).filter((e=>e.refName===t))||[]}},39194:(e,t,r)=>{"use strict";r.d(t,{Od:()=>pe,VH:()=>me,I1:()=>oe.default,n8:()=>ge,N_:()=>ye,Rj:()=>Y,EE:()=>be,FX:()=>G,ZP:()=>ve});var n=r(66204),a=r(20592),o=r(43800),i=r(72271),s=r(1502),l=r(90872),c=r(33322),d=r(4206),u=r(99512),p=r(99247),m=r(88196),g=r(31996),f=r(56726),h=r(78937),y=r(91370),b=r.n(y),w=r(24728),v=r(5625),C=r(72241),S=r(8096),k=r(20160),T=r(55680),x=r(54378),P=r(84059),M=r(80846),E=r(86636),R=r(49140),A=r(41247),I=r(86987),F=r(69282),N=r(38684);const L=(0,N.ZL)()((e=>({background:{position:"absolute",right:0,zIndex:1001,background:e.palette.background.paper},focusedBackground:{background:e.palette.secondary.light,svg:{fill:e.palette.secondary.contrastText}}}))),D=(0,M.observer)((function({model:e}){const{classes:t,cx:r}=L(),{id:a,bpPerPx:o,maxBpPerPx:i,minBpPerPx:s,scaleFactor:c,hideHeader:d}=e,{focusedViewId:u}=(0,l.getSession)(e);return d?n.createElement(E.Z,{className:r(t.background,u===a?t.focusedBackground:void 0)},n.createElement(F.Z,{menuItems:e.menuItems()},n.createElement(I.Z,{fontSize:"small"})),n.createElement(R.Z,{"data-testid":"zoom_out",onClick:()=>e.zoom(2*o),disabled:o>=i-1e-4||1!==c},n.createElement(A.Z,{fontSize:"small"})),n.createElement(R.Z,{"data-testid":"zoom_in",onClick:()=>e.zoom(o/2),disabled:o<=s+1e-4||1!==c},n.createElement(x.Z,{fontSize:"small"}))):null}));var B=r(73330),V=r(7146),z=r(80013),O=r(53447),Z=r(41540),j=r(66778),W=r(41499),$=r(87879);const H=(0,N.ZL)()((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70,color:e.palette.text.secondary}}))),G=(0,M.observer)((function({model:e}){const{classes:t}=H(),{maxBpPerPx:r,minBpPerPx:a,bpPerPx:o,scaleFactor:i}=e,[s,l]=(0,n.useState)(100*-Math.log2(o));return(0,n.useEffect)((()=>{l(100*-Math.log2(o))}),[l,o]),n.createElement("div",{className:t.container},n.createElement(R.Z,{"data-testid":"zoom_out",onClick:()=>e.zoom(2*o),disabled:o>=r-1e-4||1!==i,size:"large"},n.createElement(A.Z,null)),n.createElement($.ZP,{size:"small",className:t.slider,value:s,min:100*-Math.log2(r),max:100*-Math.log2(a),onChange:(e,t)=>l(t),onChangeCommitted:()=>e.zoomTo(2**(-s/100)),disabled:1!==i}),n.createElement(R.Z,{"data-testid":"zoom_in",onClick:()=>e.zoom(e.bpPerPx/2),disabled:o<=a+1e-4||1!==i,size:"large"},n.createElement(x.Z,null)))}));var q=r(92368),U=r(85084),_=r(33846),J=r(26545);const X=(0,N.ZL)()((()=>({headerRefName:{minWidth:100}}))),Y=(0,M.observer)((function({model:e,showHelp:t}){const{classes:r}=X(),a=(0,q.Z)(),o=(0,l.getSession)(e),{textSearchManager:i,assemblyManager:s}=o,{assemblyNames:c,rankSearchResults:d}=e,u=c[0],p=s.get(u),m=e.searchScope(u);return n.createElement(U.Z,{showHelp:t,onSelect:async t=>{try{t.hasLocation()?await(0,J.Xp)({option:t,model:e,assemblyName:u}):t.results?.length?e.setSearchResults(t.results,t.getLabel()):p&&await(0,J.I8)({input:t.getLabel(),assembly:p,model:e})}catch(t){console.error(t),(0,l.getSession)(e).notify(`${t}`,"warning")}},assemblyName:u,fetchResults:e=>(0,_.kx)({queryString:e,searchScope:m,rankSearchResults:d,textSearchManager:i,assembly:p}),model:e,minWidth:175,TextFieldProps:{variant:"outlined",className:r.headerRefName,style:{margin:ye},InputProps:{style:{padding:0,height:be,background:(0,B.Fq)(a.palette.background.paper,.8)}}}})})),K=(0,N.ZL)()((e=>({headerBar:{display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:(0,B.Fq)(e.palette.background.paper,.8),color:e.palette.text.primary,margin:ye},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",marginLeft:e.spacing(4)},buttonSpacer:{marginRight:e.spacing(2)}}))),Q=(0,M.observer)((({model:e})=>{const{classes:t}=K();return n.createElement(R.Z,{onClick:e.activateTrackSelector,className:t.toggleButton,title:"Open track selector",value:"track_select"},n.createElement(w.GD,{className:t.buttonSpacer}))}));function ee({model:e}){const{classes:t}=K();return n.createElement(n.Fragment,null,n.createElement(V.Z,{variant:"outlined",className:t.panButton,onClick:()=>e.slide(-.9)},n.createElement(j.Z,null)),n.createElement(V.Z,{variant:"outlined",className:t.panButton,onClick:()=>e.slide(.9)},n.createElement(Z.Z,null)))}const te=(0,M.observer)((({model:e})=>{const{classes:t}=K(),{coarseTotalBp:r}=e;return n.createElement(z.Z,{variant:"body2",color:"textSecondary",className:t.bp},(0,l.getBpDisplayStr)(r))})),re=({model:e})=>{const{classes:t}=K();return n.createElement("div",{className:t.headerBar},n.createElement(Q,{model:e}),n.createElement("div",{className:t.spacer}),n.createElement(O.Z,{row:!0,className:t.headerForm},n.createElement(ee,{model:e}),n.createElement(Y,{model:e})),n.createElement(te,{model:e}),n.createElement(G,{model:e}),n.createElement("div",{className:t.spacer}))},ne=(0,M.observer)((({model:e})=>e.hideHeader?null:e.hideHeaderOverview?n.createElement(re,{model:e}):n.createElement(W.ZP,{model:e},n.createElement(re,{model:e}))));var ae=r(22405),oe=r(38739);r(26783);const ie=(0,n.lazy)((()=>Promise.resolve().then(r.bind(r,31547)))),se=(0,n.lazy)((()=>r.e(8900).then(r.bind(r,58900)))),le=(0,n.lazy)((()=>r.e(8404).then(r.bind(r,88404)))),ce=(0,n.lazy)((()=>r.e(6423).then(r.bind(r,6423)))),de=(0,n.lazy)((()=>r.e(9004).then(r.bind(r,79004))));function ue(e){if(!e.length)return"";const t=e.every((t=>t.assemblyName===e[0].assemblyName));return e.map((e=>(0,l.assembleLocString)({...e,start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))).join(" ")}const pe=48,me=20,ge=17,fe=3,he=2,ye=7,be=32;function we(e){return m.types.compose("LinearGenomeView",i.BaseViewModel,m.types.model({id:s.ElementId,type:m.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:m.types.array(s.Region),tracks:m.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,hideNoTracksActive:!1,trackSelectorType:m.types.optional(m.types.enumeration(["hierarchical"]),"hierarchical"),showCenterLine:m.types.optional(m.types.boolean,(()=>Boolean(JSON.parse((0,l.localStorageGetItem)("lgv-showCenterLine")||"false")))),showCytobandsSetting:m.types.optional(m.types.boolean,(()=>Boolean(JSON.parse((0,l.localStorageGetItem)("lgv-showCytobands")||"true")))),trackLabels:m.types.optional(m.types.string,(()=>(0,l.localStorageGetItem)("lgv-trackLabels")||"")),showGridlines:!0})).volatile((()=>({volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0}))).views((e=>({get trackLabelsSetting(){const t=(0,o.getConf)((0,l.getSession)(e),["LinearGenomeViewPlugin","trackLabels"]);return e.trackLabels||t},get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return he},get assemblyNames(){return[...new Set(e.displayedRegions.map((e=>e.assemblyName)))]}}))).views((e=>({MiniControlsComponent:()=>D,HeaderComponent:()=>ne,get assemblyErrors(){const{assemblyManager:t}=(0,l.getSession)(e),{assemblyNames:r}=e;return r.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,l.getSession)(e),{assemblyNames:r}=e;return r.every((e=>t.get(e)?.initialized))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get scaleBarHeight(){return ge+fe},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?pe:pe+me},get trackHeights(){return(0,l.sum)(e.tracks.map((e=>e.displays[0].height)))},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*fe},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return e.displayedRegions.reduce(((e,t)=>e+t.end-t.start),0)},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:()=>({...(0,u.getParentRenderProps)(e),bpPerPx:e.bpPerPx,highResolutionScaling:(0,o.getConf)((0,l.getSession)(e),"highResolutionScaling")}),searchScope:t=>({assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}),getTrack:t=>e.tracks.find((e=>e.configuration.trackId===t)),rankSearchResults(t){const r=new Set(e.tracks.map((e=>e.configuration.trackId)));for(const e of t)r.has(e.trackId)&&e.updateScore(e.getScore()+1);return t},rewriteOnClicks(t,r){r.forEach((r=>{if("subMenu"in r&&this.rewriteOnClicks(t,r.subMenu),"onClick"in r){const n=r.onClick;r.onClick=(...r)=>{e.tracks.forEach((e=>{e.type===t&&n.apply(e,[e,...r])}))}}}))},get trackTypeActions(){const t=new Map;return e.tracks.forEach((e=>{if(!t.get(e.type)){const r=b()(e.viewMenuActions);this.rewriteOnClicks(e.type,r),t.set(e.type,r)}})),t}}))).actions((t=>({setShowCytobands(e){t.showCytobandsSetting=e},setWidth(e){t.volatileWidth=e},setError(e){t.volatileError=e},toggleHeader(){t.hideHeader=!t.hideHeader},toggleHeaderOverview(){t.hideHeaderOverview=!t.hideHeaderOverview},toggleNoTracksActive(){t.hideNoTracksActive=!t.hideNoTracksActive},toggleShowGridlines(){t.showGridlines=!t.showGridlines},scrollTo(e){const r=(0,l.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=r,r},zoomTo(e,r=t.width/2,n=!1){const a=(0,l.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(a===t.bpPerPx)return a;const o=t.bpPerPx;return Math.abs(o-a)<1e-6?(console.warn("zoomTo bpPerPx rounding error"),o):(t.bpPerPx=a,this.scrollTo(Math.round((t.offsetPx+r)*o/a-(n?t.width/2:r))),a)},setOffsets(e,r){t.leftOffset=e,t.rightOffset=r},setSearchResults(e,r,n){(0,l.getSession)(t).queueDialog((a=>[de,{model:t,searchResults:e,searchQuery:r,handleClose:a,assemblyName:n}]))},setNewView(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip(){t.displayedRegions=(0,m.cast)([...t.displayedRegions].reverse().map((e=>({...e,reversed:!e.reversed})))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack(r,n={},a={}){const o=e.pluggableConfigSchemaType("track"),i=(0,m.resolveIdentifier)(o,(0,m.getRoot)(t),r);if(!i)throw new Error(`Could not resolve identifier "${r}"`);const s=e.getTrackType(i?.type);if(!s)throw new Error(`Unknown track type ${i.type}`);const l=e.getViewType(t.type),c=new Set(l.displayTypes.map((e=>e.name))),d=i.displays.find((e=>c.has(e.type)));if(!d)throw new Error(`Could not find a compatible display for view type ${t.type}`);const u=t.tracks.filter((e=>e.configuration===i));if(0===u.length){const e=s.stateModel.create({...n,type:i.type,configuration:i,displays:[{type:d.type,configuration:d,...a}]});return t.tracks.push(e),e}return u[0]},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,m.resolveIdentifier)(n,(0,m.getRoot)(t),r),o=t.tracks.filter((e=>e.configuration===a));return(0,p.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length}}))).actions((e=>({moveTrack(t,r){const n=e.tracks.findIndex((e=>e.id===t));if(-1===n)throw new Error(`Track ID ${t} not found`);const a=e.tracks.findIndex((e=>e.id===r));if(-1===a)throw new Error(`Track ID ${r} not found`);const o=(0,m.getSnapshot)(e.tracks[n]);e.tracks.splice(n,1),e.tracks.splice(a,0,o)},closeView(){const t=(0,l.getContainingView)(e);t?(0,l.isViewContainer)(t)&&t.removeView(e):(0,l.getSession)(e).removeView(e)},toggleTrack:t=>!e.hideTrack(t)&&(e.showTrack(t),!0),setTrackLabels(t){localStorage.setItem("lgv-trackLabels",t),e.trackLabels=t},toggleCenterLine(){e.showCenterLine=!e.showCenterLine},setDisplayedRegions(t){e.displayedRegions=(0,m.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,l.getSession)(e);if((0,l.isSessionModelWithWidgets)(t)){const r=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},getSelectedRegions(t,r){const n=(0,m.getSnapshot)(e),a=g.Z.create({...n,interRegionPaddingWidth:e.interRegionPaddingWidth});return a.setVolatileWidth(e.width),a.moveTo(t,r),a.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},afterDisplayedRegionsSet(t){e.afterDisplayedRegionsSetCallbacks.push(t)},horizontalScroll(t){const r=e.offsetPx;return e.scrollTo(e.offsetPx+t)-r},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(Math.round(t-e.width/2))},showAllRegions(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly(t){const r=(0,l.getSession)(e),{assemblyManager:n}=r;if(!t){const n=new Set(e.displayedRegions.map((e=>e.assemblyName)));if(n.size>1)return void r.notify("Can't perform operation with multiple assemblies currently");[t]=[...n]}const a=n.get(t);if(a){const{regions:t}=a;t&&(this.setDisplayedRegions(t),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId(t){e.draggingTrackId=t},setScaleFactor(t){e.scaleFactor=t},clearView(){this.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},async exportSvg(t={}){const{renderToSvg:n}=await Promise.resolve().then(r.bind(r,26783)),a=await n(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,h.saveAs)(o,t.filename||"image.svg")}}))).actions((e=>{let t=()=>{};return{slide:function(r){const[n,a]=(0,l.springAnimate)(e.offsetPx,e.offsetPx+e.width*r,e.scrollTo);t(),t=a,n()}}})).actions((e=>{let t=()=>{};return{zoom:function(r){if(e.zoomTo(e.bpPerPx),r<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||r>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)return;const n=e.bpPerPx/r,[a,o]=(0,l.springAnimate)(1,n,e.setScaleFactor,(()=>{e.zoomTo(r),e.setScaleFactor(1)}));t(),t=o,a()}}})).views((e=>({get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){const{assemblyManager:t}=(0,l.getSession)(e);return e.assemblyNames.some((e=>t.get(e)?.cytobands?.length))},get cytobandOffset(){return this.showCytobands?(0,l.measureText)(e.displayedRegions[0].refName,12)+15:0}}))).views((e=>({menuItems(){const{canShowCytobands:t,showCytobands:r}=e,n=(0,l.getSession)(e),a=[{label:"Return to import form",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[ie,{model:e,handleClose:t}]))},icon:k.Z},...(0,l.isSessionWithAddTracks)(n)?[{label:"Sequence search",onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[se,{model:e,handleClose:t}]))}}]:[],{label:"Export SVG",icon:T.Z,onClick:()=>{(0,l.getSession)(e).queueDialog((t=>[le,{model:e,handleClose:t}]))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:w.GD},{label:"Horizontally flip",icon:v.Z,onClick:e.horizontallyFlip},{label:"Show...",icon:C.Z,subMenu:[{label:"Show all regions in assembly",onClick:e.showAllRegionsInAssembly},{label:"Show center line",type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{label:"Show header",type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Show no tracks active button",type:"checkbox",checked:!e.hideNoTracksActive,onClick:e.toggleNoTracksActive},{label:"Show guidelines",type:"checkbox",checked:e.showGridlines,onClick:e.toggleShowGridlines},...t?[{label:"Show ideogram",type:"checkbox",checked:e.showCytobands,onClick:()=>e.setShowCytobands(!r)}]:[]]},{label:"Track labels",icon:S.Z,subMenu:[{label:"Overlapping",icon:C.Z,type:"radio",checked:"overlapping"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("overlapping")},{label:"Offset",icon:C.Z,type:"radio",checked:"offset"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("offset")},{label:"Hidden",icon:C.Z,type:"radio",checked:"hidden"===e.trackLabelsSetting,onClick:()=>e.setTrackLabels("hidden")}]}];for(const[t,r]of e.trackTypeActions.entries())r.length&&(a.push({type:"divider"},{type:"subHeader",label:t}),r.forEach((e=>a.push(e))));return a}}))).views((e=>{let t,r="";return{get staticBlocks(){const n=(0,d.Z)(e),a=JSON.stringify(n);return r!==a&&(t=n,r=a),t},get dynamicBlocks(){return(0,c.Z)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((e=>({...e,start:Math.floor(e.start),end:Math.ceil(e.end)})))},get visibleLocStrings(){return ue(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return ue(e.coarseDynamicBlocks)}}})).actions((e=>({setCoarseDynamicBlocks(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach(){(0,m.addDisposer)(e,(0,p.autorun)((()=>{e.initialized&&this.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150})),(0,m.addDisposer)(e,(0,p.autorun)((()=>{const t=e=>JSON.stringify(e),{showCytobandsSetting:r,showCenterLine:n}=e;"undefined"!=typeof localStorage&&(localStorage.setItem("lgv-showCytobands",t(r)),localStorage.setItem("lgv-showCenterLine",t(n)))})))}}))).actions((e=>({moveTo(t,r){(0,f.Ao)(e,t,r)},async navToLocString(t,r){const{assemblyNames:n}=e,{assemblyManager:a}=(0,l.getSession)(e),{isValidRefName:o}=a,i=r||n[0];return i&&await a.waitForAssembly(i),this.navToLocations((0,ae.nT)(t,i,o),i)},async navToSearchString({input:t,assembly:r}){await(0,J.I8)({input:t,assembly:r,model:e})},async navToLocations(t,r){const{assemblyManager:n}=(0,l.getSession)(e);await(0,p.when)((()=>void 0!==e.volatileWidth));const a=await(0,ae.Gc)(t,n,r);if(1===a.length){const t=a[0],{reversed:r,parentRegion:n,start:o,end:i}=t;e.setDisplayedRegions([{reversed:r,...n}]),this.navTo({...t,start:(0,l.clamp)(o??0,0,n.end),end:(0,l.clamp)(i??n.end,0,n.end)})}else e.setDisplayedRegions(a.map((e=>void 0===e.start?e.parentRegion:e))),e.showAllRegions()},navTo(e){this.navToMultiple([e])},navToMultiple(t){if(t.some((e=>void 0!==e.start&&void 0!==e.end&&e.start>e.end)))throw new Error("found start greater than end");const r=t.at(0),n=t.at(-1);if(!r||!n)return;const a=e.assemblyNames[0],{assemblyManager:o}=(0,l.getSession)(e),i=o.get(r.assemblyName||a),s=o.get(n.assemblyName||a),c=i?.getCanonicalRefName(r.refName)||r.refName,d=s?.getCanonicalRefName(n.refName)||n.refName,u=e.displayedRegions.find((e=>e.refName===c)),p=(0,l.findLast)(e.displayedRegions,(e=>e.refName===d));if(!u)throw new Error(`could not find a region with refName "${c}"`);if(!p)throw new Error(`could not find a region with refName "${d}"`);const m=void 0===r.start?u.start:r.start,g=void 0===r.end?u.end:r.end,f=void 0===n.start?p.start:n.start,h=void 0===n.end?p.end:n.end,y=e.displayedRegions.findIndex((e=>c===e.refName&&m>=e.start&&m<=e.end&&g<=e.end&&g>=e.start)),b=e.displayedRegions.findIndex((e=>d===e.refName&&f>=e.start&&f<=e.end&&h<=e.end&&h>=e.start));if(-1===y||-1===b)throw new Error(`could not find a region that contained "${t.map((e=>(0,l.assembleLocString)(e)))}"`);const w=e.displayedRegions[y],v=e.displayedRegions[b];this.moveTo({index:y,offset:w.reversed?w.end-g:m-w.start},{index:b,offset:v.reversed?v.end-f:h-v.start})}}))).views((e=>({rubberBandMenuItems:()=>[{label:"Zoom to region",icon:x.Z,onClick:()=>e.moveTo(e.leftOffset,e.rightOffset)},{label:"Get sequence",icon:P.Z,onClick:()=>(0,l.getSession)(e).queueDialog((t=>[ce,{model:e,handleClose:t}]))}],bpToPx:({refName:t,coord:r,regionNumber:n})=>(0,f.R)({refName:t,coord:r,regionNumber:n,self:e}),centerAt(t,r,n){const a=this.bpToPx({refName:r,coord:t,regionNumber:n});void 0!==a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},pxToBp:t=>(0,f.j4)(e,t),get centerLineInfo(){return e.displayedRegions.length>0?this.pxToBp(e.width/2):void 0}}))).actions((e=>({afterCreate(){function t(t){(0,l.getSession)(e).focusedViewId===e.id&&(t.ctrlKey||t.metaKey)&&("ArrowLeft"===t.code?(t.preventDefault(),e.slide(-.9)):"ArrowRight"===t.code?(t.preventDefault(),e.slide(.9)):"ArrowUp"===t.code&&1===e.scaleFactor?(t.preventDefault(),e.zoom(e.bpPerPx/2)):"ArrowDown"===t.code&&1===e.scaleFactor&&(t.preventDefault(),e.zoom(2*e.bpPerPx)))}document.addEventListener("keydown",t),(0,m.addDisposer)(e,(()=>{document.removeEventListener("keydown",t)}))}})))}function ve(e){e.addViewType((()=>new a.ViewType({name:"LinearGenomeView",displayName:"Linear genome view",stateModel:we(e),ReactComponent:(0,n.lazy)((()=>Promise.resolve().then(r.bind(r,38739))))})))}},26783:(e,t,r)=>{"use strict";r.d(t,{Uc:()=>C,Ge:()=>g,renderToSvg:()=>x,hY:()=>T});var n=r(66204),a=r(9721),o=r(99247),i=r(90872),s=r(34599),l=r(35421),c=r(92368);function d({width:e,height:t,shift:r}){const a=(0,c.Z)();return n.createElement("rect",{width:e+2*r,height:t,fill:(0,i.stripAlpha)(a.palette.background.default)})}var u=r(99512);function p({model:e,height:t}){const{dynamicBlocks:r,offsetPx:a,interRegionPaddingWidth:o}=e;return n.createElement(n.Fragment,null,r.contentBlocks.slice(1).map((e=>n.createElement("rect",{key:e.key,x:e.offsetPx-a-o,width:o,y:0,height:t,fill:"grey"}))))}function m({trackLabels:e,trackName:t,fontSize:r,trackLabelOffset:a,x:o}){const s=(0,c.Z)().palette.text.primary,l="overlay"===e?5:0,d="offset"===e?5:0,u=(0,i.coarseStripHTML)(t);return"none"!==e?n.createElement("g",null,"left"===e?n.createElement("text",{x:a-40,y:20,fill:s,fontSize:r,dominantBaseline:"hanging",textAnchor:"end"},u):n.createElement("text",{x:o+l,y:d,fill:s,fontSize:r,dominantBaseline:"hanging"},u)):null}function g({displayResults:e,model:t,offset:r,textHeight:a,fontSize:o,trackLabels:s="offset",trackLabelOffset:l=0}){const c=(0,i.getSession)(t),d="offset"===s?a:0;return n.createElement(n.Fragment,null,e.map((({track:e,result:a})=>{const i=r,g=e.configuration,f=(0,u.getTrackName)(g,c),h=e.displays[0],y=Math.max(-t.offsetPx,0);return r+=h.height+d,n.createElement("g",{key:g.trackId,transform:`translate(0 ${i})`},n.createElement("g",{transform:`translate(${l} ${d})`},n.createElement(p,{model:t,height:h.height}),a),n.createElement(m,{trackName:f,fontSize:o,trackLabels:s,trackLabelOffset:l,x:y}))})))}var f=r(31996),h=r(39194),y=r(4635),b=r(41499),w=r(22405);function v({start:e,end:t,bpPerPx:r,reversed:a=!1,major:o=!0,minor:s=!0,hideText:l=!1}){const d=(0,w.Cz)(e,t,r,o,s),u=(0,c.Z)(),p=(0,i.stripAlpha)(u.palette.text.secondary);return n.createElement(n.Fragment,null,d.map((o=>{const i=(a?t-o.base:o.base-e)/r;return n.createElement("line",{key:"tick-"+o.base,x1:i,x2:i,y1:0,y2:"major"===o.type?6:4,strokeWidth:1,stroke:p})})),l?null:d.filter((e=>"major"===e.type)).map((o=>{const s=(a?t-o.base:o.base-e)/r;return n.createElement("text",{key:`label-${o.base}`,x:s-3,y:18,fontSize:11,fill:p},(0,i.getTickDisplayStr)(o.base+1,r))})))}function C({model:e,fontSize:t}){const{dynamicBlocks:{contentBlocks:r},offsetPx:a,bpPerPx:o}=e,s=r.length<5,l=(0,c.Z)(),d=(0,i.stripAlpha)(l.palette.text.primary);return n.createElement(n.Fragment,null,n.createElement(p,{model:e,height:30}),r.map((e=>{const{start:r,end:i,key:l,reversed:c,offsetPx:u,refName:p,widthPx:m}=e,g=u-a,f=`clip-${l}`;return n.createElement("g",{key:l},n.createElement("defs",null,n.createElement("clipPath",{id:f},n.createElement("rect",{x:0,y:0,width:m,height:100}))),n.createElement("g",{transform:`translate(${g} 0)`},n.createElement("g",{clipPath:`url(#${f})`},n.createElement("text",{x:4,y:t,fontSize:t,fill:d},p),n.createElement("g",{transform:"translate(0 20)"},n.createElement(v,{hideText:!s,start:r,end:i,bpPerPx:o,reversed:c})))))})))}function S({model:e,fontSize:t}){const{offsetPx:r,dynamicBlocks:{totalWidthPxWithoutBorders:a,totalBp:o}}=e,s=(0,c.Z)(),l=(0,i.getBpDisplayStr)(o),d=Math.max(-r,0),u=d+a,p=(0,i.stripAlpha)(s.palette.text.secondary),m=d+(u-d)/2,g=t;return n.createElement(n.Fragment,null,n.createElement("line",{x1:d,x2:u,y1:10,y2:10,stroke:p}),n.createElement("line",{x1:d,x2:d,y1:5,y2:15,stroke:p}),n.createElement("line",{x1:u,x2:u,y1:5,y2:15,stroke:p}),n.createElement("text",{x:m,y:g,textAnchor:"middle",dominantBaseline:"hanging",fontSize:t,fill:p},l))}function k({model:e,fontSize:t,cytobandHeight:r,rulerHeight:a}){const{width:o,assemblyNames:s,showCytobands:l,displayedRegions:d}=e,{assemblyManager:u}=(0,i.getSession)(e),p=s.length>1?"":s[0],m=u.get(p),g=(0,c.Z)(),w=(0,i.stripAlpha)(g.palette.text.primary),v=f.Z.create({displayedRegions:JSON.parse(JSON.stringify(d)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),k=e.dynamicBlocks.contentBlocks;if(!k.length)return null;v.setVolatileWidth(o),v.showAllRegions();const T=v.dynamicBlocks.contentBlocks[0],x=k.at(0),P=k.at(-1),M=v.bpToPx({...x,coord:x.reversed?x.end:x.start})||0,E=v.bpToPx({...P,coord:P.reversed?P.start:P.end})||0,R=+l*r;return n.createElement("g",{id:"header"},n.createElement("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:t,fill:w},p),l?n.createElement("g",{transform:`translate(0 ${a})`},n.createElement(y.Z,{overview:v,assembly:m,block:T}),n.createElement("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(E-M,.5),height:h.VH-1,x:M,y:.5}),n.createElement("g",{transform:`translate(0,${h.VH})`},n.createElement(b.mg,{overview:v,model:e,useOffset:!1}))):null,n.createElement("g",{transform:`translate(0 ${t+R})`},n.createElement(S,{model:e,fontSize:t})),n.createElement("g",{transform:`translate(0 ${a+R})`},n.createElement(C,{model:e,fontSize:t})))}function T(e,t,r){return(0,i.sum)(e.map((e=>e.displays[0].height+(["none","left"].includes(r)?0:t))))}async function x(e,t){await(0,o.when)((()=>e.initialized));const{textHeight:r=18,headerHeight:c=40,rulerHeight:p=50,fontSize:m=13,cytobandHeight:f=100,trackLabels:h="offset",themeName:y="default",Wrapper:b=(({children:e})=>n.createElement(n.Fragment,null,e))}=t,w=(0,i.getSession)(e),v=w.allThemes?.()[y],{width:C,tracks:S,showCytobands:x}=e,P=c+p+ +x*f+10,M=T(S,r,h)+P+100,E=await Promise.all(S.map((async e=>{const r=e.displays[0];return await(0,o.when)((()=>!r.renderProps().notReady)),{track:e,result:await r.renderSvg({...t,theme:v})}}))),R=(0,i.max)(S.map((e=>(0,i.measureText)((0,u.getTrackName)(e.configuration,w),m))),0)+40,A="left"===h?R:0,I=C+A;return(0,a.uS)(n.createElement(s.Z,{theme:(0,l.createJBrowseTheme)(v)},n.createElement(b,null,n.createElement("svg",{width:I,height:M,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,I+100,M].toString()},n.createElement(d,{width:I,height:M,shift:50}),n.createElement("g",{transform:"translate(50 0)"},n.createElement("g",{transform:`translate(${A})`},n.createElement(k,{model:e,fontSize:m,rulerHeight:p,cytobandHeight:f})),n.createElement(g,{textHeight:r,fontSize:m,model:e,displayResults:E,offset:P,trackLabels:h,trackLabelOffset:A}))))))}},22405:(e,t,r)=>{"use strict";r.d(t,{Cz:()=>o,Gc:()=>i,_S:()=>a,nT:()=>s});var n=r(90872);function a(e,t,r){const n=t*(e=Math.abs(e));let a=10**Number.parseInt(Number(n).toExponential().split(/e/i)[1],10);for(;a<n&&(a*=2,!(a>=n));)a*=2.5;a=Math.max(a,5);const o=a/e;let i=0;return!(a%10)&&o/10>=r?i=a/10:!(a%5)&&o/5>=r?i=a/5:!(a%2)&&o/2>=r&&(i=a/2),{majorPitch:a,minorPitch:i}}function o(e,t,r,n=!0,o=!0){const i=a(r,60,15);let s=e,l=t;if(null===s||null===l)return[];r<0&&([s,l]=[l,s]),s-=Math.abs(20*r)-1,l+=Math.abs(20*r)+1;const c=i.minorPitch||i.majorPitch;let d=0;const u=[];for(let e=Math.floor(s/c)*c;e<Math.ceil(l/c)*c+1;e+=c)o&&e%(2*i.majorPitch)?(u.push({type:"minor",base:e-1,index:d}),d+=1):!n||e%(2*i.majorPitch)||(u.push({type:"major",base:e-1,index:d}),d+=1);return u}async function i(e=[],t,r){return Promise.all(e.map((async e=>{const n=e.assemblyName||r;if(!n)throw new Error("no assembly provided");const a=await t.waitForAssembly(n),{refName:o}=e;if(!a)throw new Error(`assembly ${n} not found`);const{regions:i}=a;if(!i)throw new Error(`regions not loaded yet for ${n}`);const s=a.getCanonicalRefName(e.refName);if(!s)throw new Error(`Could not find refName ${o} in ${a.name}`);const l=i.find((e=>e.refName===s));if(!l)throw new Error(`Could not find refName ${o} in ${n}`);return{...e,assemblyName:n,parentRegion:l}})))}function s(e,t,r){const a=e.split(/(\s+)/).map((e=>e.trim())).filter((e=>!!e));try{return a.map((e=>(0,n.parseLocString)(e,(e=>r(e,t)))))}catch(e){const[o,i,s]=a;if(`${e}`.match(/Unknown reference sequence/)&&Number.isInteger(+i)&&Number.isInteger(+s))return[(0,n.parseLocString)(o+":"+i+".."+s,(e=>r(e,t)))];throw e}}},4592:(e,t,r)=>{"use strict";r.d(t,{fV:()=>$,qb:()=>B,rK:()=>N.Z,Ek:()=>W,Uc:()=>Q.Uc,Ge:()=>Q.Ge,Rj:()=>U.Rj,eW:()=>O,fU:()=>l,ZP:()=>ee,RH:()=>_,l0:()=>Y,hY:()=>Q.hY});var n=r(27032),a=r(90872),o=r(43800),i=r(88196),s=r(19427);const l=(0,o.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"},height:{type:"number",defaultValue:100,description:"default height for the track"},mouseover:{type:"string",description:"text to display when the cursor hovers over a feature",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]}},{explicitIdentifier:"displayId"});var c=r(72271);class d{constructor(e){this.submaps=e}has(e){for(const t of this.submaps.values())if(t.has(e))return!0;return!1}get(e){for(const t of this.submaps.values())if(t.has(e))return t.get(e)}*values(){for(const e of this.keys())yield this.get(e)}*keys(){const e=new Set;for(const t of this.submaps.values())for(const r of t.keys())e.add(r);for(const t of e)yield t}find(e){for(const t of this.submaps.values())for(const r of t.values())if(e(r))return r}*[Symbol.iterator](){for(const e of this.keys())yield[e,this.get(e)]}*entries(){for(const e of this.keys())yield[e,this.get(e)]}}var u=r(99512),p=r(99247),m=r(84059),g=r(66204),f=r(80846),h=r(92368),y=r(38684),b=r(35421),w=r(64019),v=r(19150);const C=(0,y.ZL)()({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),S=(0,f.observer)((function({model:e}){const{classes:t}=C(),{blockDefinitions:r,blockState:n}=e;return g.createElement(g.Fragment,null,r.map((r=>{if(r instanceof w.b0){const a=n.get(r.key);return g.createElement(v.b0,{block:r,key:`${e.id}-${r.key}`},a&&a.ReactComponent?g.createElement(a.ReactComponent,{model:a}):null,a&&a.maxHeightReached?g.createElement("div",{className:t.heightOverflowed,style:{top:a.layout.getTotalHeight()-16,pointerEvents:"none",height:16}},"Max height reached"):null)}if(r instanceof w.sh)return g.createElement(v.sh,{key:`${e.id}-${r.key}`,width:r.widthPx});if(r instanceof w.n2)return g.createElement(v.n2,{key:r.key,width:r.widthPx,style:{background:"none"},boundary:"boundary"===r.variant});throw new Error(`invalid block type ${JSON.stringify(r)}`)})))})),k=(0,f.observer)((function({model:e}){const{classes:t}=C(),{blockDefinitions:r}=e,n=(0,a.getContainingView)(e);return g.createElement("div",{className:t.linearBlocks,style:{left:r.offsetPx-n.offsetPx}},g.createElement(S,{model:e}))})),T=k;var x=r(73330),P=r(70421),M=r(82889);function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},E.apply(this,arguments)}const R=(0,y.ZL)()((e=>({tooltip:{pointerEvents:"none",backgroundColor:(0,x.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:(1.4,Math.round(14e4)/1e5+"em"),maxWidth:300,wordWrap:"break-word"}}))),A=g.forwardRef((function({message:e},t){return g.createElement("div",{ref:t},g.isValidElement(e)?e:e?g.createElement(b.SanitizedHTML,{html:String(e)}):null)})),I=(0,f.observer)((({model:e,clientMouseCoord:t})=>{const{theme:r,classes:n}=R(),{featureUnderMouse:a}=e,[i,s]=(0,g.useState)(0),[l,c]=(0,g.useState)(null),d=(0,g.useMemo)((()=>({getBoundingClientRect:()=>{const e=t[0]+i/2+20,r=t[1];return{top:r,left:e,bottom:r,right:e,width:0,height:0,x:e,y:r,toJSON(){}}}})),[t,i]),{styles:u,attributes:p}=(0,M.D)(d,l),m=a?(0,o.getConf)(e,"mouseover",{feature:a}):void 0,f=r?.components?.MuiPopper;return a&&m?g.createElement(P.h,{container:f?.defaultProps?.container},g.createElement("div",E({ref:c,className:n.tooltip,style:{...u.popper,zIndex:1e5}},p.popper),g.createElement(A,{ref:e=>s(e?.getBoundingClientRect().width||0),message:m}))):null})),F=I;var N=r(90482);const L=(0,y.ZL)()({display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"}}),D=(0,f.observer)((function(e){const{classes:t}=L(),r=(0,h.Z)(),n=(0,g.useRef)(null),[a,i]=(0,g.useState)(),[s,l]=(0,g.useState)([0,0]),[c,d]=(0,g.useState)([0,0]),[u,p]=(0,g.useState)(),{model:m,children:f}=e,{TooltipComponent:y,DisplayMessageComponent:w,contextMenuItems:v,height:C,setContextMenuFeature:S}=m;return g.createElement("div",{ref:n,"data-testid":`display-${(0,o.getConf)(m,"displayId")}`,className:t.display,onContextMenu:e=>{e.preventDefault(),u?p(void 0):n.current&&p([e.clientX,e.clientY])},onMouseMove:e=>{if(!n.current)return;const t=n.current.getBoundingClientRect(),{left:r,top:a}=t;l([e.clientX-r,e.clientY-a]),d([e.clientX,e.clientY]),i(t)}},w?g.createElement(w,{model:m}):g.createElement(T,e),f,g.createElement(y,{model:m,height:C,offsetMouseCoord:s,clientMouseCoord:c,clientRect:a,mouseCoord:s}),g.createElement(b.Menu,{open:Boolean(u)&&Boolean(v().length),onMenuItemClick:(e,t)=>{t(),p(void 0)},onClose:()=>{p(void 0),S(void 0)},TransitionProps:{onExit:()=>{p(void 0),S(void 0)}},anchorReference:"anchorPosition",anchorPosition:u?{top:u[1],left:u[0]}:void 0,style:{zIndex:r.zIndex.tooltip},menuItems:v()}))})),B=D;var V=r(57918);const z=20;function O(){return i.types.model({heightPreConfig:i.types.maybe(i.types.refinement("displayHeight",i.types.number,(e=>e>=z)))}).volatile((()=>({scrollTop:0}))).views((e=>({get height(){return e.heightPreConfig??(0,o.getConf)(e,"height")}}))).actions((e=>({setScrollTop(t){e.scrollTop=t},setHeight:t=>(e.heightPreConfig=Math.max(t,z),e.height),resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r}})))}const Z=function({model:e}){const{regionTooLargeReason:t}=e;return g.createElement(N.Z,{severity:"warning",action:()=>{e.setFeatureDensityStatsLimit(e.featureDensityStats),e.reload()},buttonText:"Force load",message:[t,"Zoom in to see features or force load (may be slow)"].filter((e=>!!e)).join(". ")})};var j=r(26809);function W(){return i.types.model({userBpPerPxLimit:i.types.maybe(i.types.number),userByteSizeLimit:i.types.maybe(i.types.number)}).volatile((()=>({featureDensityStatsP:void 0,featureDensityStats:void 0,currStatsBpPerPx:0}))).views((e=>({get currentBytesRequested(){return e.featureDensityStats?.bytes||0},get currentFeatureScreenDensity(){const t=(0,a.getContainingView)(e);return(e.featureDensityStats?.featureDensity||0)*t.bpPerPx},get maxFeatureScreenDensity(){return(0,o.getConf)(e,"maxFeatureScreenDensity")},get featureDensityStatsReady(){const t=(0,a.getContainingView)(e);return!(e.currStatsBpPerPx!==t.bpPerPx||!e.featureDensityStats&&!e.userBpPerPxLimit)},get maxAllowableBytes(){return e.userByteSizeLimit||e.featureDensityStats?.fetchSizeLimit||(0,o.getConf)(e,"fetchSizeLimit")}}))).actions((e=>({afterAttach(){(0,i.addDisposer)(e,(0,p.autorun)((()=>async function(e){try{const t=(0,a.getContainingView)(e);if(!t.initialized||!t.staticBlocks.contentBlocks.length||t.bpPerPx===e.currStatsBpPerPx||e.error)return;if(void 0!==e.featureDensityStats?.featureDensity)return void e.setCurrStatsBpPerPx(t.bpPerPx);e.clearFeatureDensityStats(),e.setCurrStatsBpPerPx(t.bpPerPx);const r=await e.getFeatureDensityStats();(0,i.isAlive)(e)&&e.setFeatureDensityStats(r)}catch(t){!(0,a.isAbortException)(t)&&(0,i.isAlive)(e)&&(console.error(t),e.setError(t))}}(e))))}}))).actions((e=>({setCurrStatsBpPerPx(t){e.currStatsBpPerPx=t},setFeatureDensityStatsLimit(t){const r=(0,a.getContainingView)(e);t?.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=r.bpPerPx},async getFeatureDensityStats(){return e.featureDensityStatsP||(e.featureDensityStatsP=(0,j.Iy)(e).catch((t=>{throw(0,i.isAlive)(e)&&this.setFeatureDensityStatsP(void 0),t}))),e.featureDensityStatsP},setFeatureDensityStatsP(t){e.featureDensityStatsP=t},setFeatureDensityStats(t){e.featureDensityStats=t},clearFeatureDensityStats(){e.featureDensityStatsP=void 0,e.featureDensityStats=void 0}}))).views((e=>({get regionTooLarge(){const t=(0,a.getContainingView)(e);return!(!e.featureDensityStatsReady||t.dynamicBlocks.totalBp<2e4)&&(e.currentBytesRequested>e.maxAllowableBytes||(e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity))},get regionTooLargeReason(){const t=e.currentBytesRequested,r=e.maxAllowableBytes;return t&&t>r?`Requested too much data (${(0,j.ej)(t)})`:""}}))).views((e=>({regionCannotBeRenderedText:t=>e.regionTooLarge?"Force load to see features":"",regionCannotBeRendered:t=>e.regionTooLarge?g.createElement(Z,{model:e}):null})))}const $=i.types.compose("BaseLinearDisplay",c.BaseDisplay,O(),W(),i.types.model({blockState:i.types.map(V.Z),configuration:(0,o.ConfigurationReference)(l)})).volatile((()=>({featureIdUnderMouse:void 0,contextMenuFeature:void 0}))).views((e=>({get blockType(){return"staticBlocks"},get blockDefinitions(){const t=(0,a.getContainingView)(e);if(!t.initialized)throw new Error("view not initialized yet");return t[this.blockType]}}))).views((e=>({get renderDelay(){return 50},get TooltipComponent(){return F},get selectedFeatureId(){if((0,i.isAlive)(e)){const{selection:t}=(0,a.getSession)(e);if((0,a.isFeature)(t))return t.id()}},get DisplayMessageComponent(){}}))).views((e=>({get features(){const t=[];for(const r of e.blockState.values())r?.features&&t.push(r.features);return new d(t)},get featureUnderMouse(){const t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:(t,r,n)=>e.blockState.get(t)?.layout?.getByCoord(r,n),getFeatureByID:(t,r)=>e.blockState.get(t)?.layout?.getByID(r),searchFeatureByID(t){let r;return e.blockState.forEach((e=>{const n=e?.layout?.getByID(t);n&&(r=n)})),r}}))).actions((e=>({addBlock(t,r){e.blockState.set(t,V.Z.create({key:t,region:r.toRegion()}))},deleteBlock(t){e.blockState.delete(t)},selectFeature(t){const r=(0,a.getSession)(e);if((0,a.isSessionModelWithWidgets)(r)){const n=r.addWidget("BaseFeatureWidget","baseFeature",{view:(0,a.getContainingView)(e),track:(0,a.getContainingTrack)(e),featureData:t.toJSON()});r.showWidget(n)}(0,a.isSelectionContainer)(r)&&r.setSelection(t)},clearFeatureSelection(){(0,a.getSession)(e).clearSelection()},setFeatureIdUnderMouse(t){e.featureIdUnderMouse=t},setContextMenuFeature(t){e.contextMenuFeature=t}}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),e.setCurrStatsBpPerPx(0),e.clearFeatureDensityStats(),[...e.blockState.values()].map((e=>e.doReload())),t()}}})).views((e=>({trackMenuItems:()=>[],contextMenuItems:()=>[...e.contextMenuFeature?[{label:"Open feature details",icon:m.Z,onClick:()=>{e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]],renderProps:()=>({...(0,u.getParentRenderProps)(e),notReady:!e.featureDensityStatsReady,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick(t,r){const n=r||e.featureIdUnderMouse;if(n){const t=e.features.get(n);t&&e.selectFeature(t)}else e.clearFeatureSelection()},onClick(){e.clearFeatureSelection()},onFeatureContextMenu(t,r){const n=r||e.featureIdUnderMouse;n?e.setContextMenuFeature(e.features.get(n)):e.clearFeatureSelection()},onMouseMove(t,r){e.setFeatureIdUnderMouse(r)},onMouseLeave(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}))).actions((e=>({async renderSvg(t){const{renderBaseLinearDisplaySvg:n}=await r.e(737).then(r.bind(r,50737));return n(e,t)},afterAttach(){(0,i.addDisposer)(e,(0,p.autorun)((()=>{const t={};(0,a.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((r=>{t[r.key]=!0,e.blockState.has(r.key)||e.addBlock(r.key,r)})),e.blockState.forEach(((r,n)=>{t[n]||e.deleteBlock(n)})))})))}}))).preProcessSnapshot((e=>{if(!e)return e;const{height:t,...r}=e;return{heightPreConfig:t,...r}})).postProcessSnapshot((e=>{const t=e,{blockState:r,...n}=t;return n}));var H=r(20592);function G(e){return(0,o.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})}function q(e){return i.types.compose("LinearBareDisplay",$,i.types.model({type:i.types.literal("LinearBareDisplay"),configuration:(0,o.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),...(0,u.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var U=r(39194);const _=function(e){return(0,o.ConfigurationSchema)("LinearBasicDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:l,explicitlyTyped:!0})};var J=r(72241);const X=(0,g.lazy)((()=>r.e(7930).then(r.bind(r,39004)))),Y=function(e){return i.types.compose("LinearBasicDisplay",$,i.types.model({type:i.types.literal("LinearBasicDisplay"),trackShowLabels:i.types.maybe(i.types.boolean),trackShowDescriptions:i.types.maybe(i.types.boolean),trackDisplayMode:i.types.maybe(i.types.string),trackMaxHeight:i.types.maybe(i.types.number),configuration:(0,o.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return(0,o.getConf)(e,["renderer","type"])},get showLabels(){return e.trackShowLabels??(0,o.getConf)(e,["renderer","showLabels"])},get showDescriptions(){return e.trackShowDescriptions??(0,o.getConf)(e,["renderer","showDescriptions"])},get maxHeight(){return e.trackMaxHeight??(0,o.getConf)(e,["renderer","maxHeight"])},get displayMode(){return e.trackDisplayMode??(0,o.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,o.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,showLabels:e.showLabels,showDescriptions:e.showDescriptions,displayMode:e.displayMode,maxHeight:e.maxHeight},(0,i.getEnv)(e))}}))).actions((e=>({toggleShowLabels(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode(t){e.trackDisplayMode=t},setMaxHeight(t){e.trackMaxHeight=t}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{renderProps(){const t=e.rendererConfig;return{...r(),config:t}},trackMenuItems:()=>[...t(),{label:"Show labels",icon:J.Z,type:"checkbox",checked:e.showLabels,onClick:()=>e.toggleShowLabels()},{label:"Show descriptions",icon:J.Z,type:"checkbox",checked:e.showDescriptions,onClick:()=>e.toggleShowDescriptions()},{label:"Display mode",icon:J.Z,subMenu:["compact","reducedRepresentation","normal","collapse"].map((t=>({label:t,onClick:()=>e.setDisplayMode(t)})))},{label:"Set max height",onClick:()=>{(0,a.getSession)(e).queueDialog((t=>[X,{model:e,handleClose:t}]))}}]}}))};var K=r(26545),Q=r(26783);class ee extends n.Z{name="LinearGenomeViewPlugin";exports={BaseLinearDisplayComponent:B,BaseLinearDisplay:$,baseLinearDisplayConfigSchema:l,SearchBox:U.Rj,ZoomControls:U.FX,LinearGenomeView:U.I1};configurationSchema=(0,o.ConfigurationSchema)("LinearGenomeViewConfigSchema",{trackLabels:{type:"string",defaultValue:"overlapping",model:i.types.enumeration("trackLabelOptions",["offset","overlapping","hidden"])}});install(e){var t;(t=e).addTrackType((()=>{const e=(e=>(0,o.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,H.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(t);return new H.TrackType({name:"FeatureTrack",displayName:"Feature track",configSchema:e,stateModel:(0,H.createBaseTrackModel)(t,"FeatureTrack",e)})})),(e=>{e.addTrackType((()=>{const t=(e=>(0,o.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,H.createBaseTrackConfig)(e),explicitIdentifier:"trackId"}))(e);return new H.TrackType({name:"BasicTrack",configSchema:t,stateModel:(0,H.createBaseTrackModel)(e,"BasicTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const t=_(e);return new H.DisplayType({name:"LinearBasicDisplay",displayName:"Basic feature display",configSchema:t,stateModel:Y(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:B})}))})(e),(0,U.ZP)(e),(e=>{e.addDisplayType((()=>{const t=G(e);return new H.DisplayType({name:"LinearBareDisplay",configSchema:t,displayName:"Bare feature display",stateModel:q(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:B})}))})(e),(e=>{e.addToExtensionPoint("LaunchView-LinearGenomeView",(async({session:e,assembly:t,loc:r,tracks:n=[]})=>{try{const{assemblyManager:o}=e,i=e.addView("LinearGenomeView",{});if(await(0,a.when)((()=>!!i.volatileWidth)),!t)throw new Error("No assembly provided when launching linear genome view");const s=await o.waitForAssembly(t);if(!s)throw new Error(`Assembly "${t}" not found when launching linear genome view`);await(0,K.I8)({input:r,model:i,assembly:s});const l=[];if(n.forEach((e=>function(e,t,r){try{e.showTrack(t)}catch(e){if(!`${e}`.match("Could not resolve identifier"))throw e;r.push(t)}}(i,e,l))),l.length)throw new Error(`Could not resolve identifiers: ${l.join(",")}`)}catch(t){throw e.notify(`${t}`,"error"),t}}))})(e)}configure(e){(0,a.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:s.Z,onClick:e=>{e.addView("LinearGenomeView",{})}})}}},26545:(e,t,r)=>{"use strict";r.d(t,{I8:()=>i,Xp:()=>o});var n=r(90872),a=r(45728);async function o({option:e,model:t,assemblyName:r}){const n=e.getLocation(),a=e.getTrackId();n&&(await t.navToLocString(n,r),a&&t.showTrack(a))}async function i({input:e,model:t,assembly:r}){const i=r?.allRefNamesWithLowerCase||[],s=r.name;if(e.split(" ").every((e=>function(e,t){const[r,n]=function(e,t){const r=e.lastIndexOf(":");return-1===r?[e,""]:[e.slice(0,r),e.slice(r+1)]}(e);return t.includes(e)||t.includes(r)&&!Number.isNaN(Number.parseInt(n,10))}(e,i))))await t.navToLocString(e,r.name);else{const i=t.searchScope(s),{textSearchManager:l}=(0,n.getSession)(t),c=await async function({queryString:e,searchType:t,searchScope:r,rankSearchResults:o,textSearchManager:i,assembly:s}){i||console.warn("No text search manager");const l=await(i?.search({queryString:e,searchType:t},r,o)),c=s?.allRefNames?.filter((t=>t.toLowerCase().startsWith(e.toLowerCase()))).slice(0,10).map((e=>new a.Z({label:e})));return(0,n.dedupe)([...c||[],...l||[]],(e=>e.getId()))}({queryString:e,searchType:"exact",searchScope:i,rankSearchResults:t.rankSearchResults,textSearchManager:l,assembly:r});c.length>1?t.setSearchResults(c,e.toLowerCase(),s):1===c.length?await o({option:c[0],model:t,assemblyName:s}):await t.navToLocString(e,s)}}},59131:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r(25086);const a={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"};function o(e,t,r){if(!t||0===t.length)return["remark","no alternative alleles"];const a=new Set;let o=new Set;if(t.forEach((t=>{let[l,c]=i(e,t,r);l||([l,c]=function(e,t){if((0,n.I)(t))return["breakend",t];if(1===e.length&&1===t.length)return["SNV",s("SNV",e,t)];if("<INS>"===t)return["insertion",t];if("<DEL>"===t)return["deletion",t];if("<INV>"===t)return["inversion",t];if("<TRA>"===t)return["translocation",t];if(t.includes("<"))return["sv",t];if(e.length===t.length)return e.split("").reverse().join("")===t?["inversion",s("inversion",e,t)]:["substitution",s("substitution",e,t)];if(e.length<=t.length){const r=t.length-e.length,n=r.toLocaleString("en-US");return["insertion",r>5?n+"bp INS":s("insertion",e,t)]}if(e.length>t.length){const r=e.length-t.length,n=r.toLocaleString("en-US");return["deletion",r>5?n+"bp DEL":s("deletion",e,t)]}return["indel",s("indel",e,t)]}(e,t)),l&&c&&(a.add(l),o.add(c))})),o.size>1){const e=[...o],t=new Set(e.map((e=>{const t=e.split("->");return t[1]?t[0]:e})));o=new Set([...t].map((e=>e.trim())).map((t=>{const r=e.map((e=>e.split("->").map((e=>e.trim())))).map((e=>e[1]&&e[0]===t?e[1]:"")).filter((e=>!!e));return r.length?`${t} -> ${r.join(",")}`:t})))}return a.size?[[...a].join(","),[...o].join(",")]:[]}function i(e,t,r){if("string"==typeof t&&!t.startsWith("<"))return[];let n=a[t];if(!n&&r.getMetadata("ALT",t)&&(n="sequence_variant"),n)return[n,t];const o=t.split(":");return o.length>1?i(e,`<${o.slice(0,-1).join(":")}>`,r):[]}function s(e,t,r){return`${e} ${t} -> ${r}`}class l{constructor(e){this.variant=e.variant,this.parser=e.parser,this.data=this.dataFromVariant(this.variant),this._id=e.id}get(e){return"samples"===e?this.variant.SAMPLES:this.data[e]??this.variant[e]}set(){}parent(){}children(){}tags(){return[...Object.keys(this.data),...Object.keys(this.variant),"samples"]}id(){return this._id}dataFromVariant(e){const{REF:t,ALT:r,POS:n,CHROM:a,INFO:i,ID:s}=e,l=n-1,[c,d]=o(t,r,this.parser),u=r?.some((e=>"<TRA>"===e)),p=r?.some((e=>e.includes("<")));return{refName:a,start:l,end:p&&i.END&&!u?+i.END[0]:l+t.length,description:d,type:c,name:s?.join(","),aliases:s&&s.length>1?e.ID.slice(1):void 0}}toJSON(){return{uniqueId:this._id,...this.variant,...this.data,samples:this.variant.SAMPLES}}}},56382:(e,t,r)=>{"use strict";r.d(t,{B:()=>A.Z,Z:()=>I});var n=r(31640),a=r(43800);const o=(0,a.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0});var i=r(88196);const s=(0,a.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,a.ConfigurationSchema)("VcfIndex",{indexType:{model:i.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0});var l=r(99512),c=r(5889),d=r(72271),u=r(20592);var p=r(27032),m=r(88309),g=r(63048);var f=r(90872);var h=r(4592);function y(e){return i.types.compose("LinearVariantDisplay",(0,h.l0)(e),i.types.model({type:i.types.literal("LinearVariantDisplay"),configuration:(0,a.ConfigurationReference)(e)})).actions((e=>({async selectFeature(t){const r=(0,f.getSession)(e);if((0,f.isSessionModelWithWidgets)(r)){const{rpcManager:n}=r,o=(0,l.getRpcSessionId)(e),i=(0,f.getContainingTrack)(e),s=(0,f.getContainingView)(e),c=(0,a.getConf)(i,"adapter"),d=await n.call(o,"CoreGetMetadata",{adapterConfig:c});r.showWidget(r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:s,track:i,descriptions:d}))}r.setSelection(t)}})))}var b=r(25216);const w=(0,a.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});var v=r(66204),C=r(80846),S=r(25086);function k(e,t){const r=e.region.elided?0:e.region.start,n=e.region.elided?0:e.region.end;return(e.flipped?n-t:t-r)/e.bpPerRadian+e.startRadians}const T=(0,C.observer)((function({feature:e,blocksForRefs:t,radius:r,config:n,bezierRadius:o,selected:i,onClick:s}){const[l,c]=(0,v.useState)(!1),d=t[e.get("refName")];if(!d)return null;let u,p,m;e.get("INFO")?[u]=e.get("INFO").SVTYPE||[]:e.get("mate")&&(u="mate");const g=e.get("ALT")?.[0],h=g&&(0,S.I)(g);if(h){const e=h.MatePosition.split(":");p=+e[1],m=t[e[0]]}else if("<TRA>"===g){const r=e.get("INFO")?.CHR2?.[0],n=e.get("INFO")?.END?.[0];p=parseInt(n,10),m=t[r]}else if("mate"===u){const r=e.get("mate"),n=r.refName;p=r.start,m=t[n]}if(m){const t=e.get("start"),u=k(d,t),g=k(m,p),h=(0,f.polarToCartesian)(r,u),y=(0,f.polarToCartesian)(r,g),b=(0,f.polarToCartesian)(o,(g+u)/2),w=i?(0,a.readConfObject)(n,"strokeColorSelected",{feature:e}):(0,a.readConfObject)(n,"strokeColor",{feature:e}),C=(0,a.readConfObject)(n,"strokeColorHover",{feature:e});return v.createElement("path",{"data-testid":`chord-${e.id()}`,d:["M",...h,"Q",...b,...y].join(" "),stroke:l?C:w,strokeWidth:l?3:1,onClick:t=>{m&&d&&s(e,d.region,m.region,t)},onMouseOver:()=>{i||c(!0)},onMouseOut:()=>{i||c(!1)}})}return null})),x=(0,C.observer)((function({features:e,config:t,displayModel:r,blockDefinitions:n,radius:a,bezierRadius:o,displayModel:{selectedFeatureId:i},onChordClick:s}){const l=(0,v.useMemo)((()=>{const e={};for(const t of n){const r=t.region.elided?t.region.regions:[t.region];for(const n of r)e[n.refName]=t}return e}),[n]),c=`chords-${"undefined"!=typeof jest?"test":r.id}`;return v.createElement("g",{id:c,"data-testid":"structuralVariantChordRenderer"},v.createElement("style",{dangerouslySetInnerHTML:{__html:`\n          #${c} > path {\n            cursor: crosshair;\n            fill: none;\n          }\n`}}),[...e.values()].map((e=>{const r=e.id(),n=String(i)===String(r);return v.createElement(T,{key:r,feature:e,config:t,radius:a,bezierRadius:o,blocksForRefs:l,selected:n,onClick:s})})))}));var P=r(25077),M=r(63211);const E=(0,a.ConfigurationSchema)("VariantFeatureWidget",{});function R(e){const t=(0,M.e$)(e);return i.types.compose(t,i.types.model("VariantFeatureWidget",{type:i.types.literal("VariantFeatureWidget"),descriptions:i.types.frozen()}))}var A=r(59131);class I extends p.Z{name="VariantsPlugin";install(e){var t;(e=>{e.addAdapterType((()=>new n.Z({name:"VcfAdapter",displayName:"VCF adapter",configSchema:o,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5935),r.e(7452)]).then(r.bind(r,77452)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new n.Z({name:"VcfTabixAdapter",displayName:"VCF tabix adapter",configSchema:s,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8276),r.e(4146)]).then(r.bind(r,24146)).then((e=>e.default))})))})(e),(e=>{e.addWidgetType((()=>new P.Z({name:"VariantFeatureWidget",heading:"Feature details",configSchema:E,stateModel:R(e),ReactComponent:(0,v.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(94)]).then(r.bind(r,17560))))})))})(e),(t=e).addTrackType((()=>{const e=(e=>(0,a.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,u.createBaseTrackConfig)(e)}))(t);return new c.Z({name:"VariantTrack",displayName:"Variant track",configSchema:e,stateModel:(0,d.createBaseTrackModel)(t,"VariantTrack",e)})})),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="VcfTabixAdapter",o=(0,l.getFileName)(t),i=r&&(0,l.getFileName)(r),s={type:a,vcfGzLocation:t,index:{location:r||(0,l.makeIndex)(t,".tbi"),indexType:(0,l.makeIndexType)(i,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(o)&&!n||n===a?s:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="VcfAdapter",o=(0,l.getFileName)(t);return/\.vcf$/i.test(o)||n===a?{type:a,vcfLocation:t}:e(t,r,n)}))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){return(0,a.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:(0,h.RH)(e),explicitlyTyped:!0})}(e);return new g.Z({name:"LinearVariantDisplay",displayName:"Variant display",configSchema:t,stateModel:y(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:h.qb})}))})(e),(e=>{e.addRendererType((()=>new b.Z({name:"StructuralVariantChordRenderer",displayName:"SV chord renderer",ReactComponent:x,configSchema:w,pluginManager:e})))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){return(0,a.ConfigurationSchema)("ChordVariantDisplay",{renderer:i.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:m._U,explicitlyTyped:!0})}(e),r=(e=>i.types.compose("ChordVariantDisplay",m.pL,i.types.model({type:i.types.literal("ChordVariantDisplay"),configuration:(0,a.ConfigurationReference)(e)})).views((e=>({get rendererTypeName(){return e.configuration.renderer.type},renderProps(){const t=(0,f.getContainingView)(e);return{...(0,l.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:e.blockDefinitions,config:e.configuration.renderer,onChordClick:t=>e.onChordClick(t)}}}))))(t);return new g.Z({name:"ChordVariantDisplay",displayName:"Chord variant display",configSchema:t,stateModel:r,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:m.lJ})}))})(e)}}},68549:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(66204),a=r(80846),o=r(90872),i=r(43800),s=r(4592),l=r(93524);const c=(0,a.observer)((e=>{const{model:t}=e,{stats:r,height:a,needsScalebar:c}=t,{trackLabels:d}=(0,o.getContainingView)(t),u=(0,o.getContainingTrack)(t),p="overlapping"===d?(0,o.measureText)((0,i.getConf)(u,"name"),12.8)+100:50;return n.createElement("div",null,n.createElement(s.qb,e),r&&c?n.createElement("svg",{style:{position:"absolute",top:0,left:p,pointerEvents:"none",height:a,width:50}},n.createElement(l.Z,{model:t})):null)}))},42207:(e,t,r)=>{"use strict";r.d(t,{Xl:()=>fe.default,u:()=>ce,Aq:()=>l,Eh:()=>B,Rv:()=>S,ZP:()=>Ye,P$:()=>T,yZ:()=>k,LT:()=>ge});var n={};r.r(n),r.d(n,{YSCALEBAR_LABEL_OFFSET:()=>S,fillRectCtx:()=>A,getNiceDomain:()=>x,getOrigin:()=>T,getQuantitativeStats:()=>P,getScale:()=>k,quantitativeStatsAutorun:()=>M,round:()=>R,toP:()=>E});var a=r(27032),o=r(99512),i=r(90176),s=r(90872);class l extends i.default{supportsSVG=!0;async render(e){const t=await this.getFeatures(e),{height:r,regions:n,bpPerPx:a}=e,[o]=n,i=(o.end-o.start)/a,{reducedFeatures:l,...c}=await(0,s.renderToAbstractCanvas)(i,r,e,(r=>this.draw(r,{...e,features:t}))),d=await super.render({...e,...c,features:t,height:r,width:i});return{...d,...c,features:l?new Map(l.map((e=>[e.id(),e]))):d.features,height:r,width:i,containsNoTransferables:!0}}}var c=r(31640),d=r(43800);const u=(0,d.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}},source:{type:"string",defaultValue:"",description:"Used for multiwiggle"}},{explicitlyTyped:!0});var p=r(72271),m=r(5889);const g=(0,d.ConfigurationSchema)("MultiWiggleAdapter",{subadapters:{type:"frozen",defaultValue:[],description:"array of subadapter JSON objects"},bigWigs:{type:"frozen",description:"array of bigwig filenames, alternative to the subadapters slot",defaultValue:[]}},{explicitlyTyped:!0});var f=r(88196);const h=(0,d.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},bicolorPivot:{type:"stringEnum",model:f.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"}},{explicitlyTyped:!0}),y=(0,d.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:h,explicitlyTyped:!0});var b=r(34692),w=r(63063),v=r(7097),C=r(99247);const S=5;function k({domain:e=[],range:t=[],scaleType:r,pivotValue:n,inverted:a}){let o;const[i,s]=e;if(void 0===i||void 0===s)throw new Error("invalid domain");if("linear"===r)o=(0,b.Z)();else if("log"===r)o=(0,w.Z)(),o.base(2);else{if("quantize"!==r)throw new Error("undefined scaleType");o=(0,v.Z)()}o.domain(void 0!==n?[i,n,s]:[i,s]),o.nice();const[l,c]=t;if(void 0===l||void 0===c)throw new Error("invalid range");return o.range(a?t.slice().reverse():t),o}function T(e){return"log"===e?1:0}function x({scaleType:e,domain:t,bounds:r}){const[n,a]=r;let[o,i]=t;if("linear"===e&&(i<0&&(i=0),o>0&&(o=0)),"log"===e&&(0===o||o>1)&&(o=1),void 0===o||void 0===i)throw new Error("invalid domain supplied to stats function");void 0!==n&&n!==Number.MIN_VALUE&&(o=n),void 0!==a&&a!==Number.MAX_VALUE&&(i=a);const s=(e=>{if("linear"===e)return(0,b.Z)();if("log"===e){const e=(0,w.Z)();return e.base(2),e}if("quantize"===e)return(0,v.Z)();throw new Error(`undefined scaleType ${e}`)})(e);return s.domain([o,i]),s.nice(),s.domain()}async function P(e,t){const{rpcManager:r}=(0,s.getSession)(e),n=(0,d.getConf)(e,"numStdDev")||3,{adapterConfig:a,autoscaleType:i}=e,l=(0,o.getRpcSessionId)(e),c={sessionId:l,adapterConfig:a,statusCallback:t=>{(0,f.isAlive)(e)&&e.setMessage(t)},...t};if("global"===i||"globalsd"===i){const e=await r.call(l,"WiggleGetGlobalQuantitativeStats",c),{scoreMin:t,scoreMean:a,scoreStdDev:o}=e;return"globalsd"===i?{...e,scoreMin:t>=0?0:a-n*o,scoreMax:a+n*o}:e}if("local"===i||"localsd"===i){const{dynamicBlocks:t,bpPerPx:a}=(0,s.getContainingView)(e),o=await r.call(l,"WiggleGetMultiRegionQuantitativeStats",{...c,regions:t.contentBlocks.map((e=>{const{start:t,end:r}=e;return{...JSON.parse(JSON.stringify(e)),start:Math.floor(t),end:Math.ceil(r)}})),bpPerPx:a}),{scoreMin:d,scoreMean:u,scoreStdDev:p}=o;return"localsd"===i?{...o,scoreMin:d>=0?0:u-n*p,scoreMax:u+n*p}:o}if("zscale"===i)return r.call(l,"WiggleGetGlobalQuantitativeStats",c);throw new Error(`invalid autoscaleType '${i}'`)}function M(e){(0,f.addDisposer)(e,(0,C.autorun)((async()=>{try{const t=new AbortController,r=(0,s.getContainingView)(e);if(e.setLoading(t),!r.initialized||!e.featureDensityStatsReady||e.regionTooLarge||e.error)return;const n=JSON.stringify(r.dynamicBlocks),a=await P(e,{signal:t.signal,...e.renderProps()});(0,f.isAlive)(e)&&e.updateQuantitativeStats(a,n)}catch(t){!(0,s.isAbortException)(t)&&(0,f.isAlive)(e)&&(console.error(t),e.setError(t))}}),{delay:1e3}))}function E(e=0){return+(+e).toPrecision(6)}function R(e){return Math.round(1e5*e)/1e5}function A(e,t,r,n,a,o){r<0&&(e+=r,r=-r),n<0&&(t+=n,n=-n),o&&(a.fillStyle=o),a.fillRect(e,t,r,n)}function I(e,t){const{features:r,regions:n,bpPerPx:a,scaleOpts:o,height:i,config:l}=t,[c]=n,u=(0,d.readConfObject)(l,"bicolorPivot"),p=(0,d.readConfObject)(l,"bicolorPivotValue"),m=(0,d.readConfObject)(l,"negColor"),g=(0,d.readConfObject)(l,"posColor"),f=(0,d.readConfObject)(l,"color"),h=(0,d.readConfObject)(l,"clipColor"),y="none"!==u&&"log"!==o.scaleType,b=k({...o,pivotValue:y?p:void 0,range:y?[m,"white",g]:["white",g]}),w=k({...o,range:[0,i]}),v="#f0f"===f?(e,t)=>b(t):(e,t)=>(0,d.readConfObject)(l,"color",{feature:e,score:t}),[C,S]=w.domain();let T=-1/0,x=!1;const P=[];for(const t of r.values()){const[r,n]=(0,s.featureSpanPx)(t,c,a);Math.floor(r)!==Math.floor(T)&&(P.push(t),T=r);const o=t.get("score");x=x||o>S||o<C;const l=n-r+.3;e.fillStyle=v(t,o),e.fillRect(r,0,l,i)}if(e.save(),x){e.fillStyle=h;for(const t of r.values()){const[r,n]=(0,s.featureSpanPx)(t,c,a),i=n-r+.3,l=t.get("score");(l>S||l<C&&"log"!==o.scaleType)&&A(r,0,i,2,e)}}return e.restore(),{reducedFeatures:P}}class F extends l{async draw(e,t){return I(e,t)}}var N=r(80846),L=r(66204),D=r(35421);const B=(0,N.observer)((function(e){const{regions:t,features:r,bpPerPx:n,width:a,height:o,onMouseLeave:i=(()=>{}),onMouseMove:s=(()=>{}),onFeatureClick:l=(()=>{})}=e,[c]=t,d=(0,L.useRef)(null);function u(e){let t=0;d.current&&(t=d.current.getBoundingClientRect().left);const o=e-t,i=c.reversed?a-o:o,s=c.start+n*i;let l;for(const e of r.values())if(s<=e.get("end")+n&&s>=e.get("start")){l=e;break}return l}return L.createElement("div",{ref:d,"data-testid":"wiggle-rendering-test",onMouseMove:e=>s(e,u(e.clientX)?.id()),onClick:e=>l(e,u(e.clientX)?.id()),onMouseLeave:e=>i(e),style:{overflow:"visible",position:"relative",height:o}},L.createElement(D.PrerenderedCanvas,e))}));var V=r(622);function z(e,t){const r=e.toHsl(),n=r.l*(1+t);return(0,V.V)({...r,l:(0,s.clamp)(n,0,100)})}function O(e,t){const r=e.toHsl(),n=r.l*(1-t);return(0,V.V)({...r,l:(0,s.clamp)(n,0,100)})}const Z=.3;function j(e,t){const{features:r,bpPerPx:n,regions:a,scaleOpts:o,height:i,config:l,ticks:c,displayCrossHatches:u,offset:p=0,colorCallback:m}=t,[g]=a,f=(g.end-g.start)/n,h=i-2*p,y=(0,d.readConfObject)(l,"filled"),b=(0,d.readConfObject)(l,"clipColor"),w=(0,d.readConfObject)(l,"summaryScoreMode"),v=(0,d.readConfObject)(l,"bicolorPivotValue"),C=(0,d.readConfObject)(l,"minSize"),S=k({...o,range:[0,h]}),x=T(o.scaleType),[P,M]=S.domain(),E=e=>(0,s.clamp)(h-(S(e)||0),0,h)+p,R=e=>y?(e=>E(x)-E(e))(e):Math.max(C,1);let I=!1,F=-1/0;const N=[],L=P<v&&M>v;if("whiskers"===w){let t,a;for(const o of r.values()){const[r,i]=(0,s.featureSpanPx)(o,g,n);if(o.get("summary")){const n=Math.max(i-r+Z,C),s=o.get("maxScore"),l=m(o,s),c=L?l:l===t?a:a=z((0,V.V)(l),.4).toHex();A(r,E(s),n,R(s),e,c),t=l}}a=void 0,t=void 0;for(const o of r.values()){const[r,i]=(0,s.featureSpanPx)(o,g,n),l=o.get("score"),c=o.get("maxScore"),d=o.get("minScore"),u=o.get("summary"),p=m(o,l),f=L&&u?p===t?a:a=(0,V.V)(m(o,c)).mix((0,V.V)(m(o,d))).toString():p,h=Math.max(i-r+Z,C);Math.floor(r)!==Math.floor(F)&&(N.push(o),F=r),I=I||l<P||l>M,A(r,E(l),h,R(l),e,f),t=p}a=void 0,t=void 0;for(const o of r.values()){const[r,i]=(0,s.featureSpanPx)(o,g,n);if(o.get("summary")){const n=o.get("minScore"),s=m(o,n),l=Math.max(i-r+Z,C),c=L?s:s===t?a:a=O((0,V.V)(s),.4).toHex();A(r,E(n),l,R(n),e,c),t=s}}}else for(const t of r.values()){const[r,a]=(0,s.featureSpanPx)(t,g,n);Math.floor(r)!==Math.floor(F)&&(N.push(t),F=r);const o=t.get("score"),i=m(t,o);I=I||o<P||o>M;const l=Math.max(a-r+Z,C);if("max"===w){const n=t.get("summary")?t.get("maxScore"):o;A(r,E(n),l,R(n),e,i)}else if("min"===w){const n=t.get("summary")?t.get("minScore"):o;A(r,E(n),l,R(n),e,i)}else A(r,E(o),l,R(o),e,i)}if(e.save(),I){e.fillStyle=b;for(const t of r.values()){const[r,a]=(0,s.featureSpanPx)(t,g,n),l=a-r+Z,c=t.get("score");c>M?A(r,p,l,2,e):c<P&&"log"!==o.scaleType&&A(r,i,l,2,e)}}return e.restore(),u&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",c.values.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(E(t))),e.lineTo(f,Math.round(E(t))),e.stroke()}))),{reducedFeatures:N}}class W extends l{async draw(e,t){const{features:r,config:n}=t,a=(0,d.readConfObject)(n,"bicolorPivotValue"),o=(0,d.readConfObject)(n,"negColor"),i=(0,d.readConfObject)(n,"posColor");return j(e,{...t,colorCallback:"#f0f"===(0,d.readConfObject)(n,"color")?(e,t)=>t<a?o:i:(e,t)=>(0,d.readConfObject)(n,"color",{feature:e}),offset:S,features:[...r.values()]})}}const $=(0,d.ConfigurationSchema)("XYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:f.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:h,explicitlyTyped:!0}),H=(0,d.ConfigurationSchema)("LinePlotRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{baseConfiguration:h,explicitlyTyped:!0});function G(e,t){const{features:r,regions:n,bpPerPx:a,scaleOpts:o,height:i,ticks:{values:l},displayCrossHatches:c,colorCallback:u,config:p,offset:m=0}=t,[g]=n,f=(g.end-g.start)/a,h=i-2*m,y=(0,d.readConfObject)(p,"clipColor"),b=k({...o,range:[0,h]}),[w,v]=b.domain(),C=e=>(0,s.clamp)(h-(b(e)||0),0,h)+m;let S,T=-1/0;const x=[];for(const t of r.values()){const[r,n]=(0,s.featureSpanPx)(t,g,a);Math.floor(r)!==Math.floor(T)&&(x.push(t),T=r);const i=t.get("score"),l=i<w,c=i>v,d=n-r+.3,p=u(t,i);e.beginPath(),e.strokeStyle=p;const f=void 0!==S?S:i;g.reversed?(e.moveTo(n,C(f)),e.lineTo(n,C(i)),e.lineTo(r,C(i))):(e.moveTo(r,C(f)),e.lineTo(r,C(i)),e.lineTo(n,C(i))),e.stroke(),S=i,c?(e.fillStyle=y,e.fillRect(r,m,d,2)):l&&"log"!==o.scaleType&&(e.fillStyle=y,e.fillRect(r,h-2,d,h))}return c&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.5)",l.forEach((t=>{e.beginPath(),e.moveTo(0,Math.round(C(t))),e.lineTo(f,Math.round(C(t))),e.stroke()}))),{reducedFeatures:x}}class q extends l{async draw(e,t){return G(e,{...t,offset:S,colorCallback:()=>"grey"})}}var U=r(63048),_=r(4592);function J(){return(0,d.ConfigurationSchema)("MultiLinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:f.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:f.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1}},{baseConfiguration:_.fU,explicitlyTyped:!0})}var X=r(65388),Y=r(73330),K=r(92368),Q=r(70421),ee=r(38684),te=r(82889);function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},re.apply(this,arguments)}const ne=(0,ee.ZL)()((e=>({tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,Y.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:`${R(1.4)}em`,maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:S,cursor:"default",position:"absolute",pointerEvents:"none"}}))),ae=(0,N.observer)((function({model:e,height:t,clientMouseCoord:r,offsetMouseCoord:n,clientRect:a,TooltipContents:o,useClientY:i}){const s=(0,K.Z)(),{featureUnderMouse:l}=e,[c,d]=(0,L.useState)(0),[u,p]=(0,L.useState)(null),{classes:m}=ne(),g=(0,L.useMemo)((()=>({getBoundingClientRect:()=>{const e=r[0]+c/2+20,t=i?r[1]:a?.top||0;return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON(){}}}})),[a?.top,r,c,i]),{styles:f,attributes:h}=(0,te.D)(g,u),y=s?.components?.MuiPopper;return l?L.createElement(L.Fragment,null,L.createElement(Q.h,{container:y?.defaultProps?.container},L.createElement("div",re({ref:p,className:m.tooltip,style:{...f.popper,zIndex:1e5}},h.popper),L.createElement(o,{ref:e=>d(e?.getBoundingClientRect().width||0),model:e,feature:l}))),L.createElement("div",{className:m.hoverVertical,style:{left:n[0],height:t-2*S}})):null})),oe=ae;function ie(){return ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ie.apply(this,arguments)}const se=e=>e.toLocaleString("en-US"),le=L.forwardRef((function({feature:e},t){const r=e.get("start"),n=e.get("end"),a=[e.get("refName"),r===n?se(r):`${se(r)}..${se(n)}`].filter((e=>!!e)).join(":");return void 0!==e.get("summary")?L.createElement("div",{ref:t},a,L.createElement("br",null),"Max: ",E(e.get("maxScore")),L.createElement("br",null),"Avg: ",E(e.get("score")),L.createElement("br",null),"Min: ",E(e.get("minScore"))):L.createElement("div",{ref:t},a,L.createElement("br",null),`${E(e.get("score"))}`)})),ce=(0,N.observer)((function(e){return L.createElement(oe,ie({TooltipContents:le},e))})),de=(0,L.lazy)((()=>r.e(8300).then(r.bind(r,98300))));function ue(e){return f.types.compose(_.fV,f.types.model({selectedRendering:f.types.optional(f.types.string,""),resolution:f.types.optional(f.types.number,1),fill:f.types.maybe(f.types.boolean),minSize:f.types.maybe(f.types.number),color:f.types.maybe(f.types.string),posColor:f.types.maybe(f.types.string),negColor:f.types.maybe(f.types.string),summaryScoreMode:f.types.maybe(f.types.string),rendererTypeNameState:f.types.maybe(f.types.string),scale:f.types.maybe(f.types.string),autoscale:f.types.maybe(f.types.string),displayCrossHatches:f.types.maybe(f.types.boolean),constraints:f.types.optional(f.types.model({max:f.types.maybe(f.types.number),min:f.types.maybe(f.types.number)}),{}),configuration:(0,d.ConfigurationReference)(e)})).volatile((()=>({message:void 0,stats:void 0,statsFetchInProgress:void 0}))).actions((e=>({updateQuantitativeStats(t){const{scoreMin:r,scoreMax:n}=t,a=1e-6;e.stats?(Math.abs(e.stats.scoreMax-n)>a||Math.abs(e.stats.scoreMin-r)>a)&&(e.stats={scoreMin:r,scoreMax:n}):e.stats={scoreMin:r,scoreMax:n}},setColor(t){e.color=t},setPosColor(t){e.posColor=t},setNegColor(t){e.negColor=t},setLoading(t){const{statsFetchInProgress:r}=e;void 0===r||r.signal.aborted||r.abort(),e.statsFetchInProgress=t},selectFeature(t){const r=(0,s.getSession)(e);(0,s.isSelectionContainer)(r)&&r.setSelection(t)},setResolution(t){e.resolution=t},setFill(t){0===t?(e.fill=!0,e.minSize=0):1===t?(e.fill=!1,e.minSize=1):2===t&&(e.fill=!1,e.minSize=2)},toggleLogScale(){e.scale="log"===e.scale?"linear":"log"},setScaleType(t){e.scale=t},setSummaryScoreMode(t){e.summaryScoreMode=t},setAutoscale(t){e.autoscale=t},setMaxScore(t){e.constraints.max=t},setRendererType(t){e.rendererTypeNameState=t},setMinScore(t){e.constraints.min=t},toggleCrossHatches(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches(t){e.displayCrossHatches=t}}))).views((e=>({get adapterTypeName(){return e.adapterConfig.type},get rendererTypeNameSimple(){return e.rendererTypeNameState??(0,d.getConf)(e,"defaultRendering")},get filters(){},get scaleType(){return e.scale??(0,d.getConf)(e,"scaleType")},get maxScore(){return e.constraints.max??(0,d.getConf)(e,"maxScore")},get minScore(){return e.constraints.min??(0,d.getConf)(e,"minScore")}}))).views((e=>({get adapterCapabilities(){const t=e.adapterTypeName,{pluginManager:r}=(0,s.getEnv)(e);return r.getAdapterType(t).adapterCapabilities},get rendererConfig(){const{color:t,displayCrossHatches:r,fill:n,minSize:a,negColor:o,posColor:i,summaryScoreMode:l,scaleType:c,rendererTypeName:u}=e,p=(0,d.getConf)(e,["renderers",u])||{};return e.rendererType.configSchema.create({...p,...c?{scaleType:c}:{},...void 0!==n?{filled:n}:{},...void 0!==r?{displayCrossHatches:r}:{},...void 0!==l?{summaryScoreMode:l}:{},...void 0!==t?{color:t}:{},...void 0!==o?{negColor:o}:{},...void 0!==i?{posColor:i}:{},...void 0!==a?{minSize:a}:{}},(0,s.getEnv)(e))},get autoscaleType(){return e.autoscale??(0,d.getConf)(e,"autoscale")}}))).views((e=>{let t=[0,0];return{get domain(){const{stats:r,scaleType:n,minScore:a,maxScore:o}=e;if(!r)return;const i=x({domain:[r.scoreMin,r.scoreMax],bounds:[a,o],scaleType:n});return"log"===n&&i[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(i)&&(t=i),t)}}})).views((e=>({get filled(){const{fill:t,rendererConfig:r}=e;return t??(0,d.readConfObject)(r,"filled")},get summaryScoreModeSetting(){const{summaryScoreMode:t,rendererConfig:r}=e;return t??(0,d.readConfObject)(r,"summaryScoreMode")},get scaleOpts(){return{domain:e.domain,stats:e.stats,autoscaleType:e.autoscaleType,scaleType:e.scaleType,inverted:(0,d.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get displayCrossHatchesSetting(){const{displayCrossHatches:t,rendererConfig:r}=e;return t??(0,d.readConfObject)(r,"displayCrossHatches")},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")}}))).views((e=>({scoreTrackMenuItems:()=>[...e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>e.setResolution(5*e.resolution)},{label:"Coarser resolution",onClick:()=>e.setResolution(e.resolution/5)}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((t=>({label:t,type:"radio",checked:e.summaryScoreModeSetting===t,onClick:()=>e.setSummaryScoreMode(t)})))}]:[],{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:()=>e.toggleLogScale()},{label:"Autoscale type",subMenu:[["local","Local"],...e.hasGlobalStats?[["global","Global"],["globalsd","Global ± 3σ"]]:[],["localsd","Local ± 3σ"]].map((([t,r])=>({label:r,type:"radio",checked:e.autoscaleType===t,onClick:()=>e.setAutoscale(t)})))},{label:"Set min/max score",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[de,{model:e,handleClose:t}]))}}]}))).actions((e=>{const{reload:t}=e;return{async reload(){e.setError(),t()}}}))}const pe=(0,L.lazy)((()=>Promise.all([r.e(2291),r.e(2986)]).then(r.bind(r,32986)))),me=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),ge=function(e,t){return f.types.compose("LinearWiggleDisplay",ue(t),f.types.model({type:f.types.literal("LinearWiggleDisplay")})).views((e=>({get TooltipComponent(){return ce},get rendererTypeName(){const t=e.rendererTypeNameSimple,r=me.get(t);if(!r)throw new Error(`unknown renderer ${t}`);return r}}))).views((e=>({get ticks(){const{scaleType:t,domain:r,height:n}=e,a=(0,d.getConf)(e,"minimalTicks"),o=(0,d.getConf)(e,"inverted");if(!r)return;const i=k({scaleType:t,domain:r,range:[n-S,S],inverted:o}),s=(0,X.axisPropsFromTickScale)(i,4);return n<100||a?{...s,values:r}:s}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const r=t(),{filters:n,ticks:a,height:o,resolution:i,scaleOpts:s}=e;return{...r,notReady:r.notReady||!e.stats,rpcDriverName:e.rpcDriverName,displayModel:e,config:e.rendererConfig,displayCrossHatches:e.displayCrossHatchesSetting,scaleOpts:s,resolution:i,height:o,ticks:a,filters:n}},get needsScalebar(){const{rendererTypeName:t}=e;return"XYPlotRenderer"===t||"LinePlotRenderer"===t},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((e=>{const{trackMenuItems:t}=e,r=(0,d.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,r)=>({label:t,type:"radio",checked:e.fillSetting===r,onClick:()=>e.setFill(r)})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>e.toggleCrossHatches()}]:[],...r?[{label:"Renderer type",subMenu:["xyplot","density","line"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>e.setRendererType(t)})))}]:[],{label:"Set color",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[pe,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){M(e)},async renderSvg(n){const{renderSvg:a}=await r.e(8240).then(r.bind(r,18240));return a(e,n,t)}}}))};var fe=r(68549);var he=r(28926),ye=r.n(he),be=r(39092);function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},we.apply(this,arguments)}const ve=e=>e.toLocaleString("en-US"),Ce=L.forwardRef((function({model:e,feature:t},r){const n=t.get("start"),a=t.get("end"),o=t.get("refName"),i=n===a?ve(n):`${ve(n)}..${ve(a)}`,s=t.get("sources"),l=t.get("source"),c=t.get("summary"),d=Object.fromEntries(e.sources.map((e=>[e.name,e])));return L.createElement("div",{ref:r},[o,i].filter((e=>!!e)).join(":"),L.createElement("br",null),s?L.createElement("table",null,L.createElement("thead",null,L.createElement("tr",null,L.createElement("th",null,"color"),L.createElement("th",null,"source"),L.createElement("th",null,"score"))),L.createElement("tbody",null,Object.entries(s).map((([e,t])=>L.createElement("tr",{key:e},L.createElement("td",{style:{background:d[e]?.color}}," "),L.createElement("td",null,e),L.createElement("td",null,E(t.score))))))):L.createElement("span",null,l," ",c?`min:${E(t.get("minScore"))} avg:${E(t.get("score"))} max:${E(t.get("maxScore"))}`:E(t.get("score"))))})),Se=(0,N.observer)((e=>L.createElement(oe,we({useClientY:!0,TooltipContents:Ce},e)))),ke=(0,L.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(2382),r.e(2291),r.e(9810)]).then(r.bind(r,39810)))),Te=new Map([["xyplot","MultiXYPlotRenderer"],["multirowxy","MultiRowXYPlotRenderer"],["multirowdensity","MultiDensityRenderer"],["multiline","MultiLineRenderer"],["multirowline","MultiRowLineRenderer"]]),xe=function(e,t){return f.types.compose("MultiLinearWiggleDisplay",ue(t),f.types.model({type:f.types.literal("MultiLinearWiggleDisplay"),layout:f.types.optional(f.types.frozen(),[])})).volatile((()=>({featureUnderMouseVolatile:void 0,sourcesVolatile:void 0}))).actions((e=>({setLayout(t){e.layout=t},clearLayout(){e.layout=[]},setSources(t){ye()(t,e.sourcesVolatile)||(e.sourcesVolatile=t)},setFeatureUnderMouse(t){e.featureUnderMouseVolatile=t}}))).views((e=>({get featureUnderMouse(){return e.featureUnderMouseVolatile},get TooltipComponent(){return Se},get rendererTypeName(){const t=e.rendererTypeNameSimple,r=Te.get(t);if(!r)throw new Error(`unknown renderer ${t}`);return r}}))).views((e=>({get needsScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName},get needsFullHeightScalebar(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiLineRenderer"===e.rendererTypeName},get isMultiRow(){return"MultiRowXYPlotRenderer"===e.rendererTypeName||"MultiRowLineRenderer"===e.rendererTypeName||"MultiDensityRenderer"===e.rendererTypeName},get needsCustomLegend(){return"MultiDensityRenderer"===e.rendererTypeName},get canHaveFill(){return"MultiXYPlotRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName},get renderColorBoxes(){return!("MultiRowLineRenderer"===e.rendererTypeName||"MultiRowXYPlotRenderer"===e.rendererTypeName)},get prefersOffset(){return this.isMultiRow},get sources(){const t=Object.fromEntries(e.sourcesVolatile?.map((e=>[e.name,e]))||[]),r=e.layout.length?e.layout:e.sourcesVolatile;return r?.map((e=>({...t[e.name],...e}))).map(((e,t)=>({...e,color:e.color||(this.isMultiRow?"blue":be.set1[t]||"#000000".replaceAll("0",(()=>(~~(16*Math.random())).toString(16))))})))}}))).views((e=>({get rowHeight(){const{sources:t,height:r,isMultiRow:n}=e;return n?r/(t?.length||1):r},get rowHeightTooSmallForScalebar(){return this.rowHeight<70},get useMinimalTicks(){return(0,d.getConf)(e,"minimalTicks")||this.rowHeightTooSmallForScalebar}}))).views((e=>({get ticks(){const{scaleType:t,domain:r,isMultiRow:n,rowHeight:a,useMinimalTicks:o}=e;if(!r)return;const i=n?0:S,s=(0,X.axisPropsFromTickScale)(k({scaleType:t,domain:r,range:[a-i,i],inverted:(0,d.getConf)(e,"inverted")}),4);return o?{...s,values:r}:s},get colors(){return["red","blue","green","orange","purple","cyan","pink","darkblue","darkred","pink"]}}))).views((e=>{const{renderProps:t}=e;return{renderProps(){const r=t(),{displayCrossHatches:n,filters:a,height:o,resolution:i,rpcDriverName:s,scaleOpts:l,stats:c,sources:d,ticks:u,rendererConfig:p}=e;return{...r,notReady:r.notReady||!d||!c,displayModel:e,config:p,displayCrossHatches:n,filters:a,height:o,resolution:i,rpcDriverName:s,scaleOpts:l,sources:d,ticks:u,onMouseMove:(t,r)=>e.setFeatureUnderMouse(r),onMouseLeave:()=>e.setFeatureUnderMouse(void 0)}},get hasResolution(){return e.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return e.adapterCapabilities.includes("hasGlobalStats")},get fillSetting(){return e.filled?0:e.filled||1!==e.minSize?2:1}}})).views((e=>{const{trackMenuItems:t}=e,r=(0,d.getConf)(e,"defaultRendering");return{trackMenuItems:()=>[...t(),{label:"Score",subMenu:e.scoreTrackMenuItems()},...e.canHaveFill?[{label:"Fill mode",subMenu:["filled","no fill","no fill w/ emphasis"].map(((t,r)=>({label:t,type:"radio",checked:e.fillSetting===r,onClick:()=>e.setFill(r)})))}]:[],...e.needsScalebar?[{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:()=>e.toggleCrossHatches()}]:[],...r?[{label:"Renderer type",subMenu:["xyplot","multirowxy","multirowdensity","multiline","multirowline"].map((t=>({label:t,type:"radio",checked:e.rendererTypeNameSimple===t,onClick:()=>e.setRendererType(t)})))}]:[],{label:"Edit colors/arrangement...",onClick:()=>{(0,s.getSession)(e).queueDialog((t=>[ke,{model:e,handleClose:t}]))}}]}})).actions((e=>{const{renderSvg:t}=e;return{afterAttach(){M(e),(0,f.addDisposer)(e,(0,C.autorun)((async()=>{const{rpcManager:t}=(0,s.getSession)(e),{adapterConfig:r}=e,n=(0,o.getRpcSessionId)(e),a=await t.call(n,"MultiWiggleGetSources",{sessionId:n,adapterConfig:r});(0,f.isAlive)(e)&&e.setSources(a)})))},async renderSvg(n){const{renderSvg:a}=await r.e(2754).then(r.bind(r,22754));return a(e,n,t)}}}))},Pe=(0,N.observer)((function(e){const{regions:t,features:r,bpPerPx:n,width:a,height:o,sources:i,onMouseLeave:l=(()=>{}),onMouseMove:c=(()=>{}),onFeatureClick:d=(()=>{}),displayModel:u}=e,[p]=t,m=(0,L.useRef)(null);function g(e,t){if(!m.current)return;const l=m.current.getBoundingClientRect(),c=e-l.left,d=t-l.top,g=i[Math.floor(d/o*i.length)];if(!g)return;const f=p.reversed?a-c:c,h=p.start+n*f;let y;if(u.isMultiRow){for(const e of r.values())if(e.get("source")===g.name&&h<=e.get("end")+n&&h>=e.get("start")){y=e;break}}else{const e=[];for(const t of r.values())h<=t.get("end")+n&&h>=t.get("start")&&e.push(t);if(e.length){const t=Math.floor(h);y=new s.SimpleFeature({uniqueId:"mouseoverfeat",sources:Object.fromEntries(e.map((e=>e.toJSON())).map((e=>{const{refName:t,start:r,end:n,source:a,...o}=e;return[a,o]}))),...p,start:t,end:t+1})}}return y}return L.createElement("div",{ref:m,onMouseMove:e=>{const{clientX:t,clientY:r}=e,n=g(t,r);c(e,n)},onClick:e=>{const{clientX:t,clientY:r}=e,n=g(t,r);d(e,n)},onMouseLeave:e=>l(e),style:{overflow:"visible",position:"relative",height:o}},L.createElement(D.PrerenderedCanvas,e))}));class Me extends l{async draw(e,t){const{sources:r,features:n}=t,a=(0,s.groupBy)(n.values(),(e=>e.get("source")));let o=[];for(const n of r){const r=a[n.name]||[],{reducedFeatures:i}=j(e,{...t,features:r,offset:S,colorCallback:()=>n.color||"blue"});o=o.concat(i)}return{reducedFeatures:o}}}const Ee=(0,d.ConfigurationSchema)("MultiXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:f.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:h,explicitlyTyped:!0});class Re extends l{async draw(e,t){const{bpPerPx:r,sources:n,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/n.length,d=(i.end-i.start)/r;let u=[];return e.save(),n.forEach((r=>{const{reducedFeatures:n}=j(e,{...t,features:l[r.name]||[],height:c,colorCallback:()=>r.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(n)})),e.restore(),{reducedFeatures:u}}}const Ae=(0,d.ConfigurationSchema)("MultiRowXYPlotRenderer",{filled:{type:"boolean",defaultValue:!0},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:f.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},minSize:{type:"number",defaultValue:0}},{baseConfiguration:h,explicitlyTyped:!0}),Ie=(0,d.ConfigurationSchema)("MultiDensityRenderer",{},{baseConfiguration:h,explicitlyTyped:!0});class Fe extends l{async draw(e,t){const{bpPerPx:r,sources:n,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/n.length,d=(i.end-i.start)/r;let u=[];return e.save(),n.forEach((r=>{const n=l[r.name]||[],{reducedFeatures:a}=I(e,{...t,features:n,height:c});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(a)})),e.restore(),{reducedFeatures:u}}}class Ne extends l{async draw(e,t){const{sources:r,features:n}=t,a=(0,s.groupBy)(n.values(),(e=>e.get("source")));let o=[];return r.forEach((r=>{const{reducedFeatures:n}=G(e,{...t,features:a[r.name]||[],colorCallback:()=>r.color||"blue"});o=o.concat(n)})),{reducedFeatures:o}}}const Le=(0,d.ConfigurationSchema)("MultiLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:f.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:h,explicitlyTyped:!0});class De extends l{async draw(e,t){const{bpPerPx:r,sources:n,regions:a,features:o}=t,[i]=a,l=(0,s.groupBy)(o.values(),(e=>e.get("source"))),c=t.height/n.length,d=(i.end-i.start)/r;let u=[];return e.save(),n.forEach((r=>{const{reducedFeatures:n}=G(e,{...t,features:l[r.name]||[],height:c,colorCallback:()=>r.color||"blue"});e.strokeStyle="rgba(200,200,200,0.8)",e.beginPath(),e.moveTo(0,c),e.lineTo(d,c),e.stroke(),e.translate(0,c),u=u.concat(n)})),e.restore(),{reducedFeatures:u}}}const Be=(0,d.ConfigurationSchema)("MultiRowLineRenderer",{displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1},summaryScoreMode:{type:"stringEnum",model:f.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"avg"}},{baseConfiguration:h,explicitlyTyped:!0}),Ve=(0,L.lazy)((()=>r.e(7063).then(r.bind(r,17063))));var ze=r(20592),Oe=r(86636),Ze=r(46338),je=r(7146);const We=(0,ee.ZL)()((e=>({textbox:{width:"100%"},paper:{margin:e.spacing(),padding:e.spacing()},submit:{marginTop:25,marginBottom:100,display:"block"}})));function $e({model:e}){const{classes:t}=We(),[r,n]=(0,L.useState)(""),[a,i]=(0,L.useState)("MultiWiggle"+ +Date.now());return L.createElement(Oe.Z,{className:t.paper},L.createElement("ul",null,L.createElement("li",null,"Enter list of URLs for bigwig files in the textbox"),L.createElement("li",null,"Or, use the button below the text box to select files from your computer")),L.createElement(Ze.Z,{multiline:!0,rows:10,value:r,onChange:e=>n(e.target.value),placeholder:"Paste list of URLs here, or use file selector below",variant:"outlined",className:t.textbox}),L.createElement(je.Z,{variant:"outlined",component:"label"},"Choose Files from your computer",L.createElement("input",{type:"file",hidden:!0,multiple:!0,onChange:({target:e})=>{const t=[...e?.files||[]].map((e=>({type:"BigWigAdapter",bigWigLocation:s.isElectron?{localPath:e.path,locationType:"LocalPathLocation"}:(0,o.storeBlobLocation)({blob:e}),source:e.name})));n(JSON.stringify(t,null,2))}})),L.createElement(Ze.Z,{value:a,onChange:e=>i(e.target.value),helperText:"Track name"}),L.createElement(je.Z,{variant:"contained",className:t.submit,onClick:()=>{const t=(0,s.getSession)(e),n=[`${a.toLowerCase().replaceAll(" ","_")}-${Date.now()}`,t.adminMode?"":"-sessionTrack"].join("");let o;try{o=JSON.parse(r)}catch(e){o=r.split(/\n|\r\n|\r/)}const i="string"==typeof o[0]?{bigWigs:o}:{subadapters:o};(0,s.isSessionWithAddTracks)(t)&&(t.addTrackConf({trackId:n,type:"MultiQuantitativeTrack",name:a,assemblyNames:[e.assembly],adapter:{type:"MultiWiggleAdapter",...i}}),e.view?.showTrack(n)),e.clearData(),(0,s.isSessionModelWithWidgets)(t)&&t.hideWidget(e)}},"Submit"),L.createElement("p",null,"Additional notes: "),L.createElement("ul",null,L.createElement("li",null,"The list of bigwig files in the text box can be a list of URLs, or a list of elements like"," ",L.createElement("code",null,'[{"type":"BigWigAdapter","bigWigLocation":{"uri":"http://host/file.bw"}, "color":"green","source":"name for subtrack"}]')," ","to apply e.g. the color attribute to the view"),L.createElement("li",null,'Adding local files will update the textbox with JSON contents that are ready to submit with the "Submit" button')))}var He=r(83015),Ge=r(15974),qe=r(93912);class Ue extends He.Z{name="MultiWiggleGetSources";async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Ge.Z({filters:e.filters}):void 0}}async serializeArguments(e,t){const r=this.pluginManager,n=r.rootModel?.session?.assemblyManager;if(!n)return e;const a=await(0,s.renameRegionsIfNeeded)(n,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=n,{dataAdapter:s}=await(0,qe.uP)(r,i,o);return s.getSources(a,n)}}var _e=r(56798);class Je extends He.Z{name="WiggleGetMultiRegionQuantitativeStats";async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Ge.Z({filters:e.filters}):void 0}}async serializeArguments(e,t){const r=this.pluginManager,n=r.rootModel?.session?.assemblyManager;if(!n)return e;const a=await(0,s.renameRegionsIfNeeded)(n,{...e,filters:e.filters?.toJSON().filters});return super.serializeArguments(a,t)}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{regions:a,adapterConfig:o,sessionId:i}=n,{dataAdapter:s}=await(0,qe.uP)(r,i,o);if(s instanceof _e.BaseFeatureDataAdapter)return s.getMultiRegionQuantitativeStats(a,n);throw new Error("Data adapter not found")}}class Xe extends He.Z{name="WiggleGetGlobalQuantitativeStats";async deserializeArguments(e,t){return{...await super.deserializeArguments(e,t),filters:e.filters?new Ge.Z({filters:e.filters}):void 0}}async execute(e,t){const r=this.pluginManager,n=await this.deserializeArguments(e,t),{adapterConfig:a,sessionId:o}=n,{dataAdapter:i}=await(0,qe.uP)(r,o,a);return i.getGlobalStats(n)}}class Ye extends a.Z{name="WigglePlugin";install(e){e.addAdapterType((()=>new c.Z({name:"MultiWiggleAdapter",displayName:"Multi-wiggle adapter",configSchema:g,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(8837).then(r.bind(r,88837)).then((e=>e.default))}))),e.addAdapterType((()=>new c.Z({name:"BigWigAdapter",displayName:"BigWig adapter",configSchema:u,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:()=>Promise.all([r.e(3553),r.e(3757)]).then(r.bind(r,23757)).then((e=>e.default))}))),(e=>{e.addTrackType((()=>{const t=function(e){return(0,d.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e)})}(e);return new m.Z({name:"QuantitativeTrack",displayName:"Quantitative track",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"QuantitativeTrack",t)})}))})(e),(e=>{e.addTrackType((()=>{const t=(e=>(0,d.ConfigurationSchema)("MultiQuantitativeTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e)}))(e);return new m.Z({name:"MultiQuantitativeTrack",displayName:"Multi-quantitative track",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"MultiQuantitativeTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("XYPlotRenderer").configSchema,r=e.getRendererType("DensityRenderer").configSchema,n=e.getRendererType("LinePlotRenderer").configSchema;return(0,d.ConfigurationSchema)("LinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:f.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,d.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:r,XYPlotRenderer:t,LinePlotRenderer:n})},{baseConfiguration:J(),explicitlyTyped:!0})}(e),n=ge(e,t);return new U.Z({name:"LinearWiggleDisplay",displayName:"Wiggle display",configSchema:t,stateModel:n,trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,L.lazy)((()=>Promise.resolve().then(r.bind(r,68549))))})}))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){const t=e.getRendererType("MultiXYPlotRenderer").configSchema,r=e.getRendererType("MultiDensityRenderer").configSchema,n=e.getRendererType("MultiRowXYPlotRenderer").configSchema,a=e.getRendererType("MultiLineRenderer").configSchema,o=e.getRendererType("MultiRowLineRenderer").configSchema;return(0,d.ConfigurationSchema)("MultiLinearWiggleDisplay",{defaultRendering:{type:"stringEnum",model:f.types.enumeration("Rendering",["multirowxy","xyplot","multirowdensity","multiline","multirowline"]),defaultValue:"multirowxy"},renderers:(0,d.ConfigurationSchema)("RenderersConfiguration",{MultiXYPlotRenderer:t,MultiDensityRenderer:r,MultiRowXYPlotRenderer:n,MultiLineRenderer:a,MultiRowLineRenderer:o}),height:{type:"number",defaultValue:200}},{baseConfiguration:J(),explicitlyTyped:!0})}(e);return new U.Z({name:"MultiLinearWiggleDisplay",displayName:"Multi-wiggle display",configSchema:t,stateModel:xe(0,t),trackType:"MultiQuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:(0,L.lazy)((()=>r.e(9443).then(r.bind(r,9443))))})}))})(e),(e=>{e.addRendererType((()=>new q({name:"LinePlotRenderer",ReactComponent:B,configSchema:H,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new W({name:"XYPlotRenderer",ReactComponent:B,configSchema:$,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new F({name:"DensityRenderer",ReactComponent:B,configSchema:y,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Me({name:"MultiXYPlotRenderer",ReactComponent:Pe,configSchema:Ee,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Re({name:"MultiRowXYPlotRenderer",ReactComponent:Pe,configSchema:Ae,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Fe({name:"MultiDensityRenderer",ReactComponent:Pe,configSchema:Ie,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new Ne({name:"MultiLineRenderer",ReactComponent:Pe,configSchema:Le,pluginManager:e})))})(e),(e=>{e.addRendererType((()=>new De({name:"MultiRowLineRenderer",ReactComponent:Pe,configSchema:Be,pluginManager:e})))})(e),(e=>{e.addAddTrackWorkflowType((()=>new ze.AddTrackWorkflowType({name:"Multi-wiggle track",ReactComponent:$e,stateModel:f.types.model({})})))})(e),function(e){e.addToExtensionPoint("TrackSelector-multiTrackMenuItems",((e,t)=>{const{session:r}=t;return[...e,...(0,s.isSessionWithAddTracks)(r)?[{label:"Create multi-wiggle track",onClick:e=>{const t=e.selection,r=t.map((e=>(0,d.readConfObject)(e,"name")));(0,s.getSession)(e).queueDialog((n=>[Ve,{tracks:t,onClose:(a,o)=>{a&&o&&function(n){const a=t.map((e=>(0,d.readConfObject)(e,"adapter"))).map(((e,t)=>({...e,source:r[t]}))),o=[...new Set(t.flatMap((e=>(0,d.readConfObject)(e,"assemblyNames"))))],i=`multitrack-${+Date.now()}-sessionTrack`,l=(0,s.getSession)(e);(0,s.isSessionWithAddTracks)(l)&&(l.addTrackConf({type:"MultiQuantitativeTrack",trackId:i,name:n.name,assemblyNames:o,adapter:{type:"MultiWiggleAdapter",subadapters:a}}),e.view.showTrack(i))}(o),n()}}]))}}]:[]]}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BigWigAdapter",i=(0,o.getFileName)(t),s={type:a,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(i)&&!n||n===a?s:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BigWigAdapter"===t?"QuantitativeTrack":e(t))),e.addRpcMethod((()=>new Xe(e))),e.addRpcMethod((()=>new Je(e))),e.addRpcMethod((()=>new Ue(e)))}exports={LinearWiggleDisplayReactComponent:fe.default,XYPlotRendererReactComponent:B,XYPlotRenderer:W,WiggleBaseRenderer:l,linearWiggleDisplayModelFactory:ge,xyPlotRendererConfigSchema:$,utils:n}}},93524:(e,t,r)=>{"use strict";r.d(t,{Z:()=>l});var n=r(66204),a=r(92368),o=r(80846),i=r(65388);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}const l=(0,o.observer)((function({model:e,orientation:t}){const{ticks:r}=e,o=(0,a.Z)();return r?n.createElement(i.Axis,s({},r,{shadow:2,format:e=>e,style:{orient:"left"===t?i.LEFT:i.RIGHT},bg:o.palette.background.default,fg:o.palette.text.primary})):null}))},48349:(e,t,r)=>{"use strict";r.d(t,{Z:()=>_o});var n=r(45627),a=r(27032),o=r(99831),i=r(43800),s=r(72271);const l=(0,i.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},state:{description:"optional state for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint. can be 'token' or 'code'",type:"string",defaultValue:"code"}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0});var c=r(90872),d=r(88196);function u(e){return e.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}function p(e,t){try{const r=JSON.parse(e);return"invalid_grant"===r.error&&t(),r?.error_description??e}catch(e){}return e}function m(e,t){return e.refresh_token&&t(e.refresh_token),e.access_token}async function g({response:e,reason:t,statusText:r}){return[`HTTP ${e.status}`,t,r??await f(e)].filter((e=>!!e)).join(" - ")}async function f(e){try{return e.text()}catch(t){return e.statusText}}var h=r(41762).lW;const y=e=>s.InternetAccount.named("OAuthInternetAccount").props({type:d.types.literal("OAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>{let e;return{get codeVerifierPKCE(){if(e)return e;const t=new Uint8Array(32);return globalThis.crypto.getRandomValues(t),e=u(h.from(t).toString("base64")),e}}})).views((e=>({get authEndpoint(){return(0,i.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,i.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,i.getConf)(e,"needsPKCE")},get clientId(){return(0,i.getConf)(e,"clientId")},get scopes(){return(0,i.getConf)(e,"scopes")},state:()=>(0,i.getConf)(e,"state"),get responseType(){return(0,i.getConf)(e,"responseType")},get refreshTokenKey(){return`${e.internetAccountId}-refreshToken`}}))).actions((e=>({storeRefreshToken(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:()=>localStorage.getItem(e.refreshTokenKey),async exchangeAuthorizationForAccessToken(t,r){const n=new URLSearchParams(Object.entries({code:t,grant_type:"authorization_code",client_id:e.clientId,redirect_uri:r,...e.needsPKCE?{code_verifier:e.codeVerifierPKCE}:{}})),a=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(!a.ok)throw new Error(await g({response:a,reason:"Failed to obtain token"}));return m(await a.json(),(e=>this.storeRefreshToken(e)))},async exchangeRefreshForAccessToken(t){const r=await fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(Object.entries({grant_type:"refresh_token",refresh_token:t,client_id:e.clientId})).toString()});if(!r.ok){e.removeToken();const t=await r.text();throw new Error(await g({response:r,statusText:p(t,(()=>this.removeRefreshToken()))}))}return m(await r.json(),(e=>this.storeRefreshToken(e)))}}))).actions((e=>{let t,n;return{addMessageChannel(e,r){t=t=>{this.finishOAuthWindow(t,e,r)},window.addEventListener("message",t)},deleteMessageChannel(){window.removeEventListener("message",t)},async finishOAuthWindow(t,r,n){if(t.data.name!==`JBrowseAuthWindow-${e.internetAccountId}`)return this.deleteMessageChannel();const a=t.data.redirectUri,o=a.replace("#","?"),i=new URL(o),s=i.search,l=new URLSearchParams(s);if(l.has("access_token")){const t=l.get("access_token");return t?(e.storeToken(t),r(t)):n(new Error("Error with token endpoint"))}if(l.has("code")){const t=l.get("code");if(!t)return n(new Error("Error with authorization endpoint"));try{const n=await e.exchangeAuthorizationForAccessToken(t,i.origin+i.pathname);return e.storeToken(n),r(n)}catch(e){return e instanceof Error?n(e):n(new Error(String(e)))}}return a.includes("access_denied")?n(new Error("OAuth flow was cancelled")):a.includes("error")?n(new Error("OAuth flow error: "+s)):void this.deleteMessageChannel()},async useEndpointForAuthorization(t,n){const a=c.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,o={client_id:e.clientId,redirect_uri:a,response_type:e.responseType||"code",token_access_type:"offline"};e.state()&&(o.state=e.state()),e.scopes&&(o.scope=e.scopes),e.needsPKCE&&(o.code_challenge=await async function(e){const t=await Promise.all([r.e(1034),r.e(6387)]).then(r.t.bind(r,98070,23)).then((e=>e.default));return u((await Promise.all([r.e(1034),r.e(2567)]).then(r.t.bind(r,35067,23))).stringify(t(e)))}(e.codeVerifierPKCE),o.code_challenge_method="S256");const i=new URLSearchParams(Object.entries(o)),s=new URL(e.authEndpoint);s.search=i.toString();const l=`JBrowseAuthWindow-${e.internetAccountId}`;if(c.isElectron){const{ipcRenderer:r}=window.require("electron"),a=await r.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:o,url:s.toString()}),i=new MessageEvent("message",{data:{name:l,redirectUri:a}});this.finishOAuthWindow(i,t,n)}else window.open(s,l,"width=500,height=600,left=0,top=0")},async getTokenFromUser(t,r){const n=e.retrieveRefreshToken();let a=!0;if(n)try{t(await e.exchangeRefreshForAccessToken(n)),a=!1}catch(t){console.error(t),e.removeRefreshToken()}a&&(this.addMessageChannel(t,r),this.useEndpointForAuthorization(t,r))},async validateToken(t,r){const a=e.addAuthHeaderToInit({method:"HEAD"},t),o=await fetch(r.uri,a);if(!o.ok){e.removeToken();const t=e.retrieveRefreshToken();if(t)try{n||(n=e.exchangeRefreshForAccessToken(t));const r=await n;return n=void 0,r}catch(e){console.error("Token could not be refreshed",e)}throw new Error(await g({response:o,reason:"Error validating token"}))}return t}}})).actions((e=>{const t=e.getFetcher;return{getFetcher(r){const n=t(r);return async(t,a)=>(r&&await e.validateToken(await e.getToken(r),r),n(t,a))}}})),b=(0,i.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0});var w=r(66204),v=r(29520),C=r(46338),S=r(62301),k=r(7146),T=r(35421);const x=({internetAccountId:e,handleClose:t})=>{const[r,n]=(0,w.useState)("");return w.createElement(T.Dialog,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",title:`Enter token for ${e}`},w.createElement(v.Z,{style:{display:"flex",flexDirection:"column"}},w.createElement(C.Z,{required:!0,label:"Enter Token",variant:"outlined",inputProps:{"data-testid":"entry-externalToken"},onChange:e=>n(e.target.value),margin:"dense"})),w.createElement(S.Z,null,w.createElement(k.Z,{variant:"contained",color:"primary",type:"submit",disabled:!r,onClick:()=>{r&&t(r)}},"Add"),w.createElement(k.Z,{variant:"contained",color:"secondary",onClick:()=>t()},"Cancel")))},P=e=>s.InternetAccount.named("ExternalTokenInternetAccount").props({type:d.types.literal("ExternalTokenInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,i.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,r){const{session:n}=(0,d.getRoot)(e);n.queueDialog((n=>[x,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):r(new Error("user cancelled entry")),n()}}]))},async validateToken(t,r){if(!e.validateWithHEAD)return t;const n=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(r.uri,n);if(!a.ok){let e;try{e=await a.text()}catch(t){e=""}throw new Error(`Token could not be validated — ${a.status} (${a.statusText})${e?` (${e})`:""}`)}return t}}))),M=(0,i.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:s.BaseInternetAccountConfig,explicitlyTyped:!0}),E=({internetAccountId:e,handleClose:t})=>{const[r,n]=(0,w.useState)(""),[a,o]=(0,w.useState)("");return w.createElement(T.Dialog,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",title:`Log In for ${e}`},w.createElement("form",{onSubmit:e=>{r&&a?t(btoa(`${r}:${a}`)):t(),e.preventDefault()}},w.createElement(v.Z,{style:{display:"flex",flexDirection:"column"}},w.createElement(C.Z,{required:!0,label:"Username",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-username"},onChange:e=>n(e.target.value),margin:"dense"}),w.createElement(C.Z,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-password"},onChange:e=>o(e.target.value),margin:"dense"})),w.createElement(S.Z,null,w.createElement(k.Z,{variant:"contained",color:"primary",type:"submit"},"Submit"),w.createElement(k.Z,{variant:"contained",color:"secondary",type:"submit",onClick:()=>t()},"Cancel"))))},R=e=>s.InternetAccount.named("HTTPBasicInternetAccount").props({type:d.types.literal("HTTPBasicInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((e=>({get validateWithHEAD(){return(0,i.getConf)(e,"validateWithHEAD")}}))).actions((e=>({getTokenFromUser(t,r){const{session:n}=(0,d.getRoot)(e);n.queueDialog((n=>[E,{internetAccountId:e.internetAccountId,handleClose:e=>{e?t(e):r(new Error("User cancelled entry")),n()}}]))},async validateToken(t,r){if(!e.validateWithHEAD)return t;const n=e.addAuthHeaderToInit({method:"HEAD"},t),a=await fetch(r.uri,n);if(!a.ok)throw new Error(await g({response:a,reason:"Error validating token"}));return t}}))),A=(0,i.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]}},{baseConfiguration:l,explicitlyTyped:!0}),I={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};async function F(e,t){let r="";try{const t=JSON.parse(await e.text()).error[".tag"];r=I[t]||t}catch(e){}return g({response:e,reason:t,statusText:r})}var N=r(81650);function L(e){return w.createElement(N.Z,e,w.createElement("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"}))}const D=e=>y(l).named("DropboxOAuthInternetAccount").props({type:d.types.literal("DropboxOAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return w.createElement(L,null)},get selectorLabel(){return"Enter Dropbox share link"}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=await e.getToken(t),o=e.addAuthHeaderToInit({...n,method:"POST"},a);o.headers.append("Dropbox-API-Arg",JSON.stringify({url:r}));const i=await fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);if(!i.ok)throw new Error(await F(i));return i},async validateToken(t,r){const n=await fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({url:r.uri})});if(!n.ok){const t=e.retrieveRefreshToken();if(t){e.removeRefreshToken();const n=await e.exchangeRefreshForAccessToken(t);return this.validateToken(n,r)}throw new Error(await F(n,"Token could not be validated"))}return t}}))),B=(0,i.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:l,explicitlyTyped:!0});async function V(e,t){let r="";try{r=JSON.parse(await e.text()).error.message}catch(e){}return g({response:e,reason:t,statusText:r})}var z=r(59062);class O extends z.RemoteFileWithRangeCache{constructor(e,t){super(e,t),this.statsPromise=this.fetch(e,{metadataOnly:!0}).then((e=>e.json()))}async fetch(e,t){return super.fetch(e,t)}async stat(){return this.statsPromise}}function Z(e){return w.createElement(N.Z,e,w.createElement("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"}))}function j(e){return`https://www.googleapis.com/drive/v3/files/${e.match(/[-\w]{25,}/)}`}function W(e){return y(l).named("GoogleDriveOAuthInternetAccount").props({type:d.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,i.ConfigurationReference)(e)}).views((()=>({get toggleContents(){return w.createElement(Z,null)},get selectorLabel(){return"Enter Google Drive share link"}}))).actions((e=>({getFetcher:t=>async(r,n)=>{const a=new URL(j(String(r))),o=new URLSearchParams;n?.metadataOnly?o.append("fields","size"):o.append("alt","media"),a.search=o.toString();const i=await e.getToken(t),s=await fetch(a,e.addAuthHeaderToInit({...n,method:"GET",credentials:"same-origin"},i));if(!s.ok)throw new Error(await V(s));return s},openLocation(e){return new O(e.uri,{fetch:this.getFetcher(e)})},async validateToken(e,t){const r=await fetch(j(t.uri),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/x-www-form-urlencoded"}});if(!r.ok)throw new Error(await V(r,"Token could not be validated"));return e}})))}class $ extends a.Z{name="AuthenticationPlugin";exports={OAuthConfigSchema:l,OAuthInternetAccountModelFactory:y,ExternalTokenConfigSchema:b,ExternalTokenInternetAccountModelFactory:P,HTTPBasicConfigSchema:M,HTTPBasicInternetAccountModelFactory:R,DropboxOAuthConfigSchema:A,DropboxOAuthInternetAccountModelFactory:D,GoogleDriveOAuthConfigSchema:B,GoogleDriveOAuthInternetAccountModelFactory:W};install(e){e.addInternetAccountType((()=>new o.Z({name:"OAuthInternetAccount",configSchema:l,stateModel:y(l)}))),e.addInternetAccountType((()=>new o.Z({name:"ExternalTokenInternetAccount",configSchema:b,stateModel:P(b)}))),e.addInternetAccountType((()=>new o.Z({name:"HTTPBasicInternetAccount",configSchema:M,stateModel:R(M)}))),e.addInternetAccountType((()=>new o.Z({name:"DropboxOAuthInternetAccount",configSchema:A,stateModel:D(A)}))),e.addInternetAccountType((()=>new o.Z({name:"GoogleDriveOAuthInternetAccount",configSchema:B,stateModel:W(B)})))}}var H=r(31640);const G=(0,i.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0}),q=(0,i.ConfigurationSchema)("BedpeAdapter",{bedpeLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bedpe.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]}},{explicitlyTyped:!0}),U=(0,i.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("TabixIndex",{indexType:{model:d.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),_=(0,i.ConfigurationSchema)("BedAdapter",{bedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""},colRef:{type:"number",description:'The column to use as a "refName" attribute',defaultValue:0},colStart:{type:"number",description:'The column to use as a "start" attribute',defaultValue:1},colEnd:{type:"number",description:'The column to use as a "end" attribute',defaultValue:2}},{explicitlyTyped:!0});var J=r(99512);class X extends a.Z{name="BedPlugin";install(e){(e=>{e.addAdapterType((()=>new H.Z({name:"BigBedAdapter",displayName:"BigBed adapter",configSchema:G,getAdapterClass:()=>Promise.all([r.e(9460),r.e(3553),r.e(8100)]).then(r.bind(r,38100)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"BedAdapter",displayName:"BED adapter",configSchema:_,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5935),r.e(9460),r.e(5668)]).then(r.bind(r,15668)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"BedpeAdapter",displayName:"BEDPE adapter",configSchema:q,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5935),r.e(8258)]).then(r.bind(r,78258)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"BedTabixAdapter",displayName:"BED tabix adapter",configSchema:U,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(9460),r.e(8276),r.e(2323)]).then(r.bind(r,82323)).then((e=>e.default))})))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BigBedAdapter",o=(0,J.getFileName)(t),i={type:a,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BedpeAdapter",o=(0,J.getFileName)(t);return/\.bedpe(\.gz)?$/i.test(o)||n===a?{type:a,bedpeLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BedTabixAdapter",o=(0,J.getFileName)(t),i=r&&(0,J.getFileName)(r);return/\.bed\.b?gz$/i.test(o)||n===a?{type:a,bedGzLocation:t,index:{location:r||(0,J.makeIndex)(t,".tbi"),indexType:(0,J.makeIndexType)(i,"CSI","TBI")}}:e(t,r,n)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BedAdapter",o=(0,J.getFileName)(t);return/\.bed$/i.test(o)||n===a?{type:a,bedLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BedpeAdapter"===t?"VariantTrack":e(t)))}}var Y=r(1502),K=r(20592);const Q=(0,i.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),ee=d.types.model("BreakpointAlignmentsWidget",{id:Y.ElementId,type:d.types.literal("BreakpointAlignmentsWidget"),featureData:d.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var te=r(59366),re=r(25086);class ne extends te.Z{snapshotFromBreakendFeature(e,t){const r=e.get("ALT")?.[0],n=r?(0,re.I)(r):void 0,a=e.get("start");let o;const{assemblyName:i}=t.displayedRegions[0],{assemblyManager:s}=(0,c.getSession)(t),l=s.get(i);if(!l)throw new Error(`assembly ${i} not found`);if(!l.regions)throw new Error(`assembly ${i} regions not loaded`);const d=l.getCanonicalRefName(e.get("refName")),u=l.regions.find((e=>e.refName===d));let p,m=0,g=0;if("<TRA>"===r){const t=e.get("INFO");o=t.END[0]-1,p=l.getCanonicalRefName(t.CHR2[0])}else if(n?.MatePosition){const e=n.MatePosition.split(":");o=+e[1]-1,p=l.getCanonicalRefName(e[0]),"left"===n.Join&&(m=-1),"left"===n.MateDirection&&(g=-1)}else if(e.get("mate")){const t=e.get("mate");p=l.getCanonicalRefName(t.refName),o=t.start}if(!p)throw new Error(`unable to resolve mate refName ${p} in reference genome`);const f=l.regions.find((e=>e.refName===p));if(!u||!f)throw new Error("unable to find the refName for the top or bottom of the breakpoint view");const h=[{...u},{...u}],y=[{...f},{...f}];return h[0].end=a+m,h[1].start=a+m,y[0].end=o+g,y[1].start=o+g,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:h,hideHeader:!0,bpPerPx:10,offsetPx:(u.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:y,hideHeader:!0,bpPerPx:10,offsetPx:(f.start+o)/10}],displayName:`${e.get("name")||e.get("id")||"breakend"} split detail`,featureData:void 0}}}var ae=r(99247),oe=r(78937),ie=r(55680),se=r(16106),le=r(71416);const ce=(0,w.lazy)((()=>r.e(8142).then(r.bind(r,48142))));function de(e,t){return e.displays[0].searchFeatureByID?.(t.id())}async function ue(e,t){const{views:r}=e,{rpcManager:n,assemblyManager:a}=(0,c.getSession)(e),o=e.views[0].assemblyNames[0];if(!await a.waitForAssembly(o))return;const s=t.configuration.trackId;return Promise.all(r.map((async e=>(await n.call(s,"CoreGetFeatures",{adapterConfig:(0,i.getConf)(t,["adapter"]),sessionId:s,regions:e.staticBlocks.contentBlocks})).flat())))}function pe(e){return d.types.compose("BreakpointSplitView",s.BaseViewModel,d.types.model({type:d.types.literal("BreakpointSplitView"),height:d.types.optional(d.types.refinement("viewHeight",d.types.number,(e=>e>=40)),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:d.types.array(e.getViewType("LinearGenomeView").stateModel)})).volatile((()=>({width:800,matchedTrackFeatures:{}}))).views((e=>({async exportSvg(t={}){const{renderToSvg:n}=await r.e(6194).then(r.bind(r,76194)),a=await n(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,oe.saveAs)(o,t.filename||"image.svg")}}))).views((e=>({get matchedTracks(){return(0,le.wf)((e=>e.configuration.trackId),...e.views.map((e=>e.tracks)))},getMatchedTracks:t=>e.views.map((e=>e.getTrack(t))).filter((e=>!!e)),hasTranslocations(e){return[...this.getTrackFeatures(e).values()].find((e=>"translocation"===e.get("type")))},getTrackFeatures:t=>new Map(e.matchedTrackFeatures[t]?.flat().map((e=>[e.id(),e]))),getMatchedFeaturesInLayout(e,t){const r=this.getMatchedTracks(e);return t.map((e=>e.map((e=>{const t=r.findIndex((t=>de(t,e)));return-1!==t?{feature:e,layout:de(r[t],e),level:t}:void 0})).filter(c.notEmpty)))}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,d.onAction)(e,(({name:t,path:r,args:n})=>{e.linkViews&&["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(t)&&r&&this.onSubviewAction(t,r,n)})))},onSubviewAction(t,r,n){e.views.forEach((e=>{(0,d.getPath)(e).endsWith(r)||e[t](n?.[0])}))},setWidth(t){e.width=t,e.views.forEach((e=>e.setWidth(t)))},removeView(t){e.views.remove(t)},closeView(){(0,d.getParent)(e,2).removeView(e)},toggleInteract(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews(){e.linkViews=!e.linkViews},setMatchedTrackFeatures(t){e.matchedTrackFeatures=t}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((async()=>{try{if(!e.views.every((e=>e.initialized)))return;e.setMatchedTrackFeatures(Object.fromEntries(await Promise.all(e.matchedTracks.map((async t=>[t.configuration.trackId,await ue(e,t)])))))}catch(t){console.error(t),(0,c.getSession)(e).notify(`${t}`,"error")}})))},menuItems:()=>[...e.views.map(((e,t)=>[t,e.menuItems?.()])).filter((e=>!!e[1])).map((e=>({label:`View ${e[0]+1} Menu`,subMenu:e[1]}))),{label:"Show intra-view links",type:"checkbox",checked:e.showIntraviewLinks,onClick:()=>e.toggleIntraviewLinks()},{label:"Allow clicking alignment squiggles?",type:"checkbox",checked:e.interactToggled,onClick:()=>e.toggleInteract()},{label:"Link views",type:"checkbox",icon:se.Z,checked:e.linkViews,onClick:()=>{e.toggleLinkViews()}},{label:"Export SVG",icon:ie.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[ce,{model:e,handleClose:t}]))}}]})))}class me extends a.Z{name="BreakpointSplitViewPlugin";install(e){(e=>{e.addViewType((()=>new ne({name:"BreakpointSplitView",displayName:"Breakpoint split view",stateModel:pe(e),ReactComponent:(0,w.lazy)((()=>r.e(5968).then(r.bind(r,95968))))})))})(e),(e=>{e.addWidgetType((()=>new K.WidgetType({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:Q,stateModel:ee,ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(2555)]).then(r.bind(r,86183))))})))})(e)}configure(){}}var ge=r(88309),fe=r(93533);const he=(0,i.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),ye=(0,i.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),be=(0,i.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),we=(0,i.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0}),ve=(0,i.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Ce=(0,i.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0});class Se extends a.Z{name="ComparativeAdaptersPlugin";install(e){(e=>{e.addAdapterType((()=>new H.Z({name:"PAFAdapter",displayName:"PAF adapter",configSchema:he,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8111)]).then(r.bind(r,98111)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"DeltaAdapter",displayName:"MUMmer delta adapter",configSchema:ve,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8111),r.e(7647)]).then(r.bind(r,77647)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"ChainAdapter",displayName:"Liftover chain adapter",configSchema:Ce,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8111),r.e(9572)]).then(r.bind(r,89572)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"MCScanAnchorsAdapter",displayName:"MCScan anchors adapter",configSchema:ye,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(7736)]).then(r.bind(r,7736)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"MCScanSimpleAnchorsAdapter",displayName:"MCScan anchors.simple adapter",configSchema:be,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(2053)]).then(r.bind(r,42053)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"MashMapAdapter",displayName:"MashMap adapter",configSchema:we,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8111),r.e(327)]).then(r.bind(r,50327)).then((e=>e.default))})))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="PAFAdapter",o=(0,J.getFileName)(t);return/\.paf/i.test(o)||n===a?{type:a,pafLocation:t}:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"PAFAdapter"===t?"SyntenyTrack":e(t)))}}var ke=r(35354),Te=r(81276),xe=r(77911),Pe=r(24728),Me=r(20160),Ee=r(31996),Re=r(33322);const Ae=Ee.Z.extend((e=>{const t=ae.observable.box(1);return{views:{get dynamicBlocks(){return(0,Re.Z)(e,!1,!1)},get scaleFactor(){return t.get()},get maxBpPerPx(){return e.totalBp/(e.width-50)},get minBpPerPx(){return.02},get maxOffset(){return e.displayedRegionsTotalPx-.2*e.width},get minOffset(){return.8*-e.width}},actions:{setScaleFactor(e){t.set(e)},center(){const t=e.totalBp/2/e.bpPerPx;e.scrollTo(t-e.width/2)}}}})),Ie=Ae.extend((e=>({views:{get width(){return(0,d.getParent)(e).viewWidth}}}))),Fe=Ae.extend((e=>({views:{get width(){return(0,d.getParent)(e).viewHeight}}})));var Ne=r(63008);const Le=(0,w.lazy)((()=>r.e(3529).then(r.bind(r,63529)))),De=(0,w.lazy)((()=>Promise.resolve().then(r.bind(r,31547)))),Be=e=>(0,c.measureText)(e.slice(0,30)),Ve=(e,t)=>(0,c.max)([...e.filter((e=>!t.has(e.key))).map((e=>Be(e.refName))),...e.filter((e=>!t.has(e.key))).map((e=>Be(e.end.toLocaleString("en-us"))))]);var ze=r(63048),Oe=r(38684),Ze=r(80013),je=r(80846);const We=(0,Oe.ZL)()((e=>{const t=e.palette.action.disabledBackground;return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.background.default,backgroundImage:`repeating-linear-gradient(45deg, transparent, transparent 5px, ${t} 5px, ${t} 10px)`,textAlign:"center"},blockMessage:{backgroundColor:t,padding:"10px"},blockError:{backgroundColor:t,padding:"10px",color:"red"}}}));function $e(){const[e,t]=(0,w.useState)(!1),{classes:r}=We();return(0,w.useEffect)((()=>{const e=setTimeout((()=>t(!0)),300);return()=>clearTimeout(e)}),[]),e?w.createElement("div",{className:r.loading},w.createElement(T.LoadingEllipses,null)):null}function He({messageText:e}){const{classes:t}=We();return w.createElement("div",{className:t.blockMessage},w.createElement(Ze.Z,null,`${e}`))}function Ge({error:e}){const{classes:t}=We();return w.createElement("div",{className:t.blockError},w.createElement(Ze.Z,null,`${e}`))}const qe=(0,je.observer)((function({model:e,style:t}){return e.error?w.createElement(Ge,{error:e.error,"data-testid":"reload_button"}):e.message?w.createElement(He,{messageText:e.message}):e.filled?e.shouldDisplay?w.createElement("div",{style:t},e.reactElement):null:w.createElement($e,null)})),Ue=qe;var _e=r(91370),Je=r.n(_e);function Xe(e){const{rpcManager:t}=(0,c.getSession)(e),{rendererType:r}=e,{adapterConfig:n}=e,a=(0,c.getContainingView)(e);if((0,i.readConfObject)(e.configuration),(0,d.getSnapshot)(a),a.initialized){const{viewWidth:o,viewHeight:i,borderSize:s,borderX:l,borderY:c}=a;return{rendererType:r,rpcManager:t,renderProps:{...e.renderProps(),view:Je()((0,d.getSnapshot)(a)),width:o,height:i,borderSize:s,borderX:l,borderY:c,adapterConfig:n,rendererType:r.name,sessionId:(0,J.getRpcSessionId)(e),timeout:1e6}}}}function Ye(e){return d.types.compose("DotplotDisplay",s.BaseDisplay,d.types.model({type:d.types.literal("DotplotDisplay"),configuration:(0,i.ConfigurationReference)(e)}).volatile((()=>({warnings:[],renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:Ue})))).views((e=>({get shouldDisplay(){const{vview:t,hview:r}=(0,c.getContainingView)(e);return t.bpPerPx===e.data.bpPerPxY&&r.bpPerPx===e.data.bpPerPxX},get rendererTypeName(){return(0,i.getConf)(e,["renderer","type"])},renderProps:()=>({...(0,J.getParentRenderProps)(e),rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}))).views((e=>({async renderSvg(t){const r=Xe(e);if(!r)return null;const{rendererType:n,rpcManager:a,renderProps:o}=r,i=await n.renderInClient(a,{...o,exportSVG:t,theme:t.theme||o.theme}),{hview:s,vview:l}=(0,c.getContainingView)(e),d=-s.offsetPx+i.offsetX,u=-l.offsetPx+i.offsetY;return w.createElement("g",{transform:`translate(${d} ${-u})`},w.createElement(c.ReactRendering,{rendering:i}))}}))).actions((e=>{let t;return{afterAttach(){(0,c.makeAbortableReaction)(e,(()=>Xe(e)),(e=>async function(e){if(!e)return;const{rendererType:t,rpcManager:r,renderProps:n}=e,{reactElement:a,...o}=await t.renderInClient(r,n);return{reactElement:a,data:o,renderingComponent:t.ReactComponent}}(e)),{name:`${e.type} ${e.id} rendering`,delay:500,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading(r){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=r},setMessage(r){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=r,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered(r){if(void 0===r)return;const{data:n,reactElement:a,renderingComponent:o}=r;e.warnings=n.warnings,e.filled=!0,e.message=void 0,e.reactElement=a,e.data=n,e.error=void 0,e.renderingComponent=o,t=void 0},setError(r){console.error(r),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=r,e.renderingComponent=void 0,t=void 0}}}))}function Ke(){return Ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ke.apply(this,arguments)}const Qe=(0,je.observer)((function(e){const{model:t,children:r}=e,{offsetX:n=0,offsetY:a=0}=t.data||{},o=(0,c.getContainingView)(t),i=o.vview.offsetPx-a,s=-(o.hview.offsetPx-n);return w.createElement("div",{style:{position:"relative"}},w.createElement(t.ReactComponent2,Ke({},e,{style:{position:"absolute",top:i,left:s}})),r)})),et=Qe,tt=(0,je.observer)((function(e){return w.createElement(T.PrerenderedCanvas,e)}));var rt=r(56726),nt=r(52398);const{parseCigar:at}=n.MismatchParser,ot="fell outside of range due to CIGAR string",it="(less than min coordinate of feature)",st="(greater than max coordinate of feature)";function lt(e,t,r,n=1){e.beginPath(),e.arc(t,r,n/2,0,2*Math.PI),e.fill()}class ct extends nt.Z{supportsSVG=!0;async renameRegionsIfNeeded(e){const t=this.pluginManager,r=t.rootModel?.session?.assemblyManager,{view:n,sessionId:a,adapterConfig:o}=e;async function i(e){if(!r)throw new Error("No assembly manager provided");return(await(0,c.renameRegionsIfNeeded)(r,{sessionId:a,adapterConfig:o,regions:e})).regions}return n.hview.displayedRegions=await i(n.hview.displayedRegions),n.vview.displayedRegions=await i(n.vview.displayedRegions),e}async drawDotplot(e,t){const{config:r,views:n,height:a,drawCigar:o,theme:s}=t,l=(0,i.readConfObject)(r,"color"),c=(0,i.readConfObject)(r,"posColor"),u=(0,i.readConfObject)(r,"negColor"),p=(0,i.readConfObject)(r,"colorBy"),m=(0,i.readConfObject)(r,"lineWidth"),g=(0,i.readConfObject)(r,"thresholds"),f=(0,i.readConfObject)(r,"thresholdsPalette"),h=r.color.isCallback,[y,b]=n,w=y.dynamicBlocks.contentBlocks[0]?.offsetPx,v=b.dynamicBlocks.contentBlocks[0]?.offsetPx,C=[];e.lineWidth=m;const{bpPerPx:S}=y,{bpPerPx:k}=b;function x(e,t,r,n){const a=n.get("strand")||1;if(-1===a&&([r,t]=[t,r]),e<t-1){let e=n.get("start"),r=n.get("end");const o=n.get("refName");return-1===a&&([r,e]=[e,r]),C.push({message:`feature at (X ${o}:${e}-${r}) ${ot} ${it}`,effect:"clipped the feature"}),t}if(e>r+1){const e=n.get("strand")||1,t=1===e?n.get("start"):n.get("end"),a=1===e?n.get("end"):n.get("start"),o=n.get("refName");return C.push({message:`feature at (X ${o}:${t}-${a}) ${ot} ${st}`,effect:"clipped the feature"}),r}return e}function P(e,t,r,n){if(e<t-1){const e=n.get("mate"),{refName:r,start:a,end:o}=e;return C.push({message:`feature at (Y ${r}:${a}-${o}) ${ot} ${it}`,effect:"clipped the feature"}),t}if(e>r+1){const e=n.get("mate"),{refName:t,start:a,end:o}=e;return C.push({message:`feature at (Y ${t}:${a}-${o}) ${ot} ${st}`,effect:"clipped the feature"}),r}return e}const M={...(0,d.getSnapshot)(y),staticBlocks:y.staticBlocks,width:y.width},E={...(0,d.getSnapshot)(b),staticBlocks:b.staticBlocks,width:b.width},R=(0,T.createJBrowseTheme)(s);for(const t of y.features||[]){const n=t.get("strand")||1,s=1===n?t.get("start"):t.get("end"),d=1===n?t.get("end"):t.get("start"),y=t.get("refName"),b=t.get("mate"),T=b.refName;let A;if("identity"===p){const e=t.get("identity");for(let t=0;t<g.length;t++)if(e>+g[t]){A=f[t];break}}else"meanQueryIdentity"===p?A=`hsl(${200*t.get("meanScore")},100%,40%)`:"mappingQuality"===p?A=`hsl(${t.get("mappingQual")},100%,40%)`:"strand"===p?A=-1===n?u:c:"default"===p&&(A=h?(0,i.readConfObject)(r,"color",{feature:t}):"#f0f"===l?R.palette.text.primary:l);e.fillStyle=A,e.strokeStyle=A;const I=(0,rt.R)({self:M,refName:y,coord:s}),F=(0,rt.R)({self:M,refName:y,coord:d}),N=(0,rt.R)({self:E,refName:T,coord:b.start}),L=(0,rt.R)({self:E,refName:T,coord:b.end});if(void 0!==I&&void 0!==F&&void 0!==N&&void 0!==L){const r=I.offsetPx-w,i=F.offsetPx-w,s=N.offsetPx-v,l=L.offsetPx-v;if(Math.abs(r-i)<=4&&Math.abs(s-l)<=4)lt(e,r,a-s,m);else{let c=r,d=s;const u=t.get("CIGAR");if(o&&u){const o=at(u);e.beginPath(),e.moveTo(c,a-d);let p=c,m=c;for(let u=0;u<o.length;u+=2){const g=+o[u],f=o[u+1];"M"===f||"="===f||"X"===f?(c+=g/S*n,d+=g/k):"D"===f||"N"===f?c+=g/S*n:"I"===f&&(d+=g/k),c=x(c,r,i,t),d=P(d,s,l,t),(Math.abs(c-p)>.5||Math.abs(d-m)>.5)&&(e.lineTo(c,a-d),p=c,m=d)}e.stroke()}else e.beginPath(),e.moveTo(r,a-s),e.lineTo(i,a-l),e.stroke()}}else C.length<=5&&(void 0===I||void 0===F?C.push({message:`feature at (X ${y}:${s}-${d}) not plotted, fell outside of range`,effect:"feature not rendered"}):C.push({message:`feature at (Y ${T}:${b.start}-${b.end}) not plotted, fell outside of range`,effect:"feature not rendered"}))}return{warnings:C}}async render(e){const{width:t,height:r,view:{hview:n,vview:a}}=e,o=[t,r],i=[n,a].map(((e,t)=>{const r=Ae.create(e);return r.setVolatileWidth(o[t]),r})),s=i[0],l=await this.getFeatures({...e,regions:s.dynamicBlocks.contentBlocks});s.setFeatures(l);const d=await(0,c.renderToAbstractCanvas)(t,r,e,(t=>this.drawDotplot(t,{...e,views:i})));return{...await super.render({...e,...d,height:r,width:t}),...d,height:r,width:t,offsetX:i[0].dynamicBlocks.blocks[0]?.offsetPx||0,offsetY:i[1].dynamicBlocks.blocks[0]?.offsetPx||0,bpPerPxX:i[0].bpPerPx,bpPerPxY:i[1].bpPerPx}}}const dt=(0,i.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default",defaultValue:"#f0f",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"blue"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:d.types.enumeration("colorBy",["identity","meanQueryIdentity","mappingQuality","strand","default"]),description:'Color by options:<br/>\n<ul>\n  <li>"identity" - the identity of the particular hit, similar to D-GENIES, use the other config slots \'thresholds\' and \'thresholdsPalette\' to define colors for this setting</li>\n  <li>"meanQueryIdentity" - calculates the weighted mean identity (weighted by alignment length) of all the hits that the query maps to (e.g. if the query is split aligned to many target, uses their weighted mean. can help show patterns of more related and distant synteny after WGD)</li>\n  <li>"mappingQuality" - uses mapping quality from PAF, some adapters don\'t have this setting</li>\n  <li>"strand" - colors negative alignments with negColor and positive alignments with posColor</li>\n  <li>"default" - uses the \'color\' config slot</li>\n</ul>',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0});var ut=r(83015);class pt extends ut.Z{name="ComparativeRender";async renameRegionsIfNeeded(e,t){return t.renameRegionsIfNeeded(e)}getRenderer(e){return this.pluginManager.getRendererType(e)}async serializeArguments(e,t){const{rendererType:r}=e,n=this.getRenderer(r),a=await super.serializeArguments(e,t),o=await this.renameRegionsIfNeeded(a,n);return"MainThreadRpcDriver"===t?o:n.serializeArgsInClient(o)}async execute(e,t){let r=e;"MainThreadRpcDriver"!==t&&(r=await this.deserializeArguments(e,t));const{sessionId:n,rendererType:a,signal:o}=r;if(!n)throw new Error("must pass a unique session id");(0,c.checkAbortSignal)(o);const i=this.getRenderer(a);return"MainThreadRpcDriver"===t?i.render(r):i.renderInWorker(r)}async deserializeReturn(e,t,r){const n=await super.deserializeReturn(e,t,r);return"MainThreadRpcDriver"===r?n:this.getRenderer(t.rendererType).deserializeResultsInClient(n,t)}}var mt=r(97916);const{featurizeSA:gt,getClip:ft,getTag:ht,getLength:yt,getLengthSansClipping:bt}=n.MismatchParser;class wt extends a.Z{name="DotplotPlugin";install(e){var t;!function(e){e.addViewType((()=>{return new te.Z({name:"DotplotView",displayName:"Dotplot view",stateModel:(t=e,d.types.compose("DotplotView",xe.Z,d.types.model({id:Y.ElementId,type:d.types.literal("DotplotView"),height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:d.types.array(d.types.string),drawCigar:!0,hview:d.types.optional(Ie,{}),vview:d.types.optional(Fe,{}),tracks:d.types.array(t.pluggableMstType("track","stateModel")),viewTrackConfigs:d.types.array(t.pluggableConfigSchemaType("track"))})).volatile((()=>({volatileWidth:void 0,volatileError:void 0,cursorMode:(0,c.localStorageGetItem)("dotplot-cursorMode")||"crosshair",showPanButtons:Boolean(JSON.parse((0,c.localStorageGetItem)("dotplot-showPanbuttons")||"true")),wheelMode:(0,c.localStorageGetItem)("dotplot-wheelMode")||"zoom",borderX:100,borderY:100}))).views((e=>({get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}))).views((e=>({get assemblyErrors(){const{assemblyManager:t}=(0,c.getSession)(e);return e.assemblyNames.map((e=>t.get(e)?.error)).filter((e=>!!e)).join(", ")},get assembliesInitialized(){const{assemblyManager:t}=(0,c.getSession)(e);return e.assemblyNames.every((e=>t.get(e)?.initialized??!0))}}))).views((e=>({get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){const{hview:t}=e,{dynamicBlocks:r,staticBlocks:n,bpPerPx:a}=t;return r.contentBlocks.length>5?[]:(0,Ne.Cz)(n.contentBlocks,a)},get vticks(){const{vview:t}=e,{dynamicBlocks:r,staticBlocks:n,bpPerPx:a}=t;return r.contentBlocks.length>5?[]:(0,Ne.Cz)(n.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps(){const t=(0,c.getSession)(e);return{...(0,J.getParentRenderProps)(e),drawCigar:e.drawCigar,highResolutionScaling:(0,i.getConf)(t,"highResolutionScaling")}}}))).actions((e=>({setShowPanButtons(t){e.showPanButtons=t},setWheelMode(t){e.wheelMode=t},setCursorMode(t){e.cursorMode=t},setDrawCigar(t){e.drawCigar=t},clearView(){e.hview.setDisplayedRegions([]),e.vview.setDisplayedRegions([]),e.assemblyNames=(0,d.cast)([]),e.tracks.clear()},setBorderX(t){e.borderX=t},setBorderY(t){e.borderY=t},setWidth:t=>(e.volatileWidth=t,e.volatileWidth),setHeight:t=>(e.height=t,e.height),setError(t){e.volatileError=t},closeView(){(0,d.getParent)(e,2).removeView(e)},zoomOutButton(){e.hview.zoomOut(),e.vview.zoomOut()},zoomInButton(){e.hview.zoomIn(),e.vview.zoomIn()},activateTrackSelector(){if("hierarchical"===e.trackSelectorType){const t=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(t)){const r=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(r),r}}throw new Error(`invalid track selector type ${e.trackSelectorType}`)},showTrack(r,n={}){const a=t.pluggableConfigSchemaType("track"),o=(0,d.resolveIdentifier)(a,(0,d.getRoot)(e),r),i=t.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=t.getViewType(e.type),l=o.displays.find((e=>s.displayTypes.find((t=>t.name===e.type))));if(!l)throw new Error(`could not find a compatible display for view type ${e.type}`);const c=i.stateModel.create({...n,type:o.type,configuration:o,displays:[{type:l.type,configuration:l}]});e.tracks.push(c)},hideTrack(r){const n=t.pluggableConfigSchemaType("track"),a=(0,d.resolveIdentifier)(n,(0,d.getRoot)(e),r),o=e.tracks.filter((e=>e.configuration===a));return(0,ae.transaction)((()=>o.forEach((t=>e.tracks.remove(t))))),o.length},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},setAssemblyNames(t,r){e.assemblyNames=(0,d.cast)([t,r])},setViews(t){e.hview=(0,d.cast)(t[0]),e.vview=(0,d.cast)(t[1])},getCoords(t,r){const[n,a]=(0,c.minmax)(r[0],t[0]),[o,i]=(0,c.minmax)(r[1],t[1]);return Math.abs(a-n)>3&&Math.abs(i-o)>3?[e.hview.pxToBp(n),e.hview.pxToBp(a),e.vview.pxToBp(e.viewHeight-o),e.vview.pxToBp(e.viewHeight-i)]:void 0},zoomIn(t,r){const n=this.getCoords(t,r);if(n){const[t,r,a,o]=n;e.hview.moveTo(t,r),e.vview.moveTo(o,a)}},showAllRegions(){e.hview.zoomTo(e.hview.maxBpPerPx),e.vview.zoomTo(e.vview.maxBpPerPx),e.vview.center(),e.hview.center()},onDotplotView(t,r){const n=this.getCoords(t,r);if(n){const[t,r,a,o]=n,i=(0,c.getSession)(e),s=Ae.create({...(0,d.getSnapshot)(e.hview),minimumBlockWidth:0,interRegionPaddingWidth:0}),l=Ae.create({...(0,d.getSnapshot)(e.vview),minimumBlockWidth:0,interRegionPaddingWidth:0});s.setVolatileWidth(e.hview.width),l.setVolatileWidth(e.vview.width),s.moveTo(t,r),l.moveTo(o,a),s.zoomTo(s.bpPerPx/(e.width/e.hview.width),0),l.zoomTo(l.bpPerPx/(e.width/e.vview.width),0);const u=e.tracks.map((e=>e.configuration.displays.find((e=>"LinearSyntenyDisplay"===e.type)))).filter((e=>!!e)).map((e=>{const t=(0,d.getParent)(e,2);return{type:t.type,configuration:t,displays:[{type:e.type,configuration:e}]}})),{id:p,...m}=(0,d.getSnapshot)(s),{id:g,...f}=(0,d.getSnapshot)(l),h={type:"LinearSyntenyView",views:[{type:"LinearGenomeView",tracks:[],hideHeader:!0,...m},{type:"LinearGenomeView",tracks:[],hideHeader:!0,...f}],tracks:u};i.addView("LinearSyntenyView",h)}}}))).actions((e=>({async exportSvg(t={}){const{renderToSvg:n}=await r.e(1007).then(r.bind(r,41007)),a=await n(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,oe.saveAs)(o,t.filename||"image.svg")},beforeDestroy(){const t=(0,c.getSession)(e);for(const r in e.assemblyNames)t.removeTemporaryAssembly?.(r)},afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((()=>{const{showPanButtons:t,wheelMode:r,cursorMode:n}=e;var a;"undefined"!=typeof localStorage&&(localStorage.setItem("dotplot-showPanbuttons",(a=t,JSON.stringify(a))),localStorage.setItem("dotplot-cursorMode",n),localStorage.setItem("dotplot-wheelMode",r))}))),(0,d.addDisposer)(e,(0,ae.autorun)((()=>{const t=(0,c.getSession)(e);if(void 0===e.volatileWidth||!e.assembliesInitialized)return;if(e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0)return;const r=[e.hview,e.vview];(0,ae.transaction)((()=>{e.assemblyNames.forEach(((e,n)=>{const a=t.assemblyManager.get(e);r[n].setDisplayedRegions(a?.regions||[])})),e.showAllRegions()}))}),{delay:1e3})),(0,d.addDisposer)(e,(0,ae.autorun)((function(){if(void 0===e.volatileWidth)return;const{vview:t,hview:r,viewHeight:n,viewWidth:a}=e,o=t.dynamicBlocks.contentBlocks,i=r.dynamicBlocks.contentBlocks,s=r.offsetPx,l=t.offsetPx,c=(0,Ne.F$)(o,n,l),d=(0,Ne.F$)(i,a,s),u=Ve(i,d),p=Ve(o,c);e.setBorderY(Math.max(u+40,50)),e.setBorderX(Math.max(p+40,50))})))},squareView(){const{hview:t,vview:r}=e,n=(t.bpPerPx+r.bpPerPx)/2,a=t.pxToBp(t.width/2),o=r.pxToBp(r.width/2);t.setBpPerPx(n),t.centerAt(a.coord,a.refName,a.index),r.setBpPerPx(n),r.centerAt(o.coord,o.refName,o.index)},squareViewProportional(){const{hview:t,vview:r}=e,n=t.width/r.width,a=(t.bpPerPx+r.bpPerPx)/2,o=t.pxToBp(t.width/2),i=r.pxToBp(r.width/2);t.setBpPerPx(a/n),t.centerAt(o.coord,o.refName,o.index),r.setBpPerPx(a),r.centerAt(i.coord,i.refName,i.index)}}))).views((e=>({menuItems(){const t=(0,c.getSession)(e);return[{label:"Return to import form",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[De,{model:e,handleClose:t}]))},icon:Me.Z},{label:"Square view - same bp per pixel",onClick:()=>e.squareView()},{label:"Rectangular view - same total bp",onClick:()=>e.squareView()},{label:"Show all regions",onClick:()=>e.showAllRegions()},{label:"Export SVG",icon:ie.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[Le,{model:e,handleClose:t}]))}},...(0,c.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:Pe.GD}]:[]]},get error(){return e.volatileError||e.assemblyErrors}})))),ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(9469),r.e(1098)]).then(r.bind(r,41098))))});var t}))}(e),(t=e).addDisplayType((()=>{const e=function(e){return(0,i.ConfigurationSchema)("DotplotDisplay",{renderer:d.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(t);return new ze.Z({name:"DotplotDisplay",displayName:"Dotplot display",configSchema:e,stateModel:Ye(e),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:et})})),(e=>{e.addRendererType((()=>new ct({name:"DotplotRenderer",configSchema:dt,ReactComponent:tt,pluginManager:e})))})(e),function(e){e.addToExtensionPoint("LaunchView-DotplotView",(async({session:e,views:t,tracks:r=[]})=>{try{const n=e.addView("DotplotView",{}),a=t.map((e=>e.assembly));(0,ae.transaction)((()=>{n.setViews([{bpPerPx:.1,offsetPx:0},{bpPerPx:.1,offsetPx:0}]),n.setAssemblyNames(a[0],a[1])}));const o=[];if(r.forEach((e=>function(e,t,r){try{e.showTrack(t)}catch(e){if(!`${e}`.match("Could not resolve identifier"))throw e;r.push(t)}}(n,e,o))),o.length)throw new Error(`Could not resolve identifiers: ${o.join(",")}`)}catch(t){throw e.notify(`${t}`,"error"),t}}))}(e),function(e){e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearPileupDisplay"===e.name){const{stateModel:t}=e,r=t.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const r=e.contextMenuFeature;return[...t(),...r?[{label:"Dotplot of read vs ref",icon:mt.Z,onClick:()=>function(e,t){const r=(0,c.getSession)(t);try{const n=e.get("CIGAR"),a=ft(n,1),o=e.get("flags"),s=e.get("strand"),l=e.get("name"),d=`${l}_assembly_${Date.now()}`,{parentTrack:u}=t,[p]=(0,i.getConf)(u,"assemblyNames"),m=[p,d],g=`track-${Date.now()}`,f=`${l}_vs_${p}`,h=ht(e,"SA")||"",y=gt(h,e.id(),s,l,!0),b=e.toJSON();b.strand=1,b.mate={refName:l,start:a,end:a+bt(n)};const w=yt(2048&o?y[0].CIGAR:n),v=[b,...y];v.sort(((e,t)=>e.clipPos-t.clipPos));const C=v.reduce(((e,t)=>e+t.end-t.start),0);r.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:C/800,displayedRegions:(0,c.gatherOverlaps)(v.map(((e,t)=>{const{start:r,end:n,refName:a}=e;return{start:r,end:n,refName:a,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:w/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:d,start:0,end:w,refName:l}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:m,adapter:{type:"FromConfigAdapter",features:v},trackId:g,name:f}],assemblyNames:m,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:`${g}-DotplotDisplay`}]}],displayName:`${l} vs ${p}`})}catch(e){console.error(e),r.notify(`${e}`,"error")}}(r,e)}]:[]]}}}}));e.stateModel=r}return e}))}(e),e.addRpcMethod((()=>new pt(e)))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:Te.Z,onClick:e=>{e.addView("DotplotView",{})}})}}const vt=(0,i.ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0});class Ct extends a.Z{name="GTFPlugin";install(e){e.addAdapterType((()=>new H.Z({name:"GtfAdapter",displayName:"GTF adapter",configSchema:vt,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5935),r.e(8672),r.e(2197)]).then(r.bind(r,7011)).then((e=>e.default))}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="GtfAdapter",o=(0,J.getFileName)(t),i={type:a,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(o)&&!n||n===a?i:e(t,r,n)}))}}const St=(0,i.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,i.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:d.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),kt=(0,i.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Tt=class extends a.Z{name="GFF3Plugin";install(e){(e=>{e.addAdapterType((()=>new K.AdapterType({name:"Gff3TabixAdapter",displayName:"GFF3 tabix adapter",configSchema:St,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(8672),r.e(8276),r.e(501),r.e(1243)]).then(r.bind(r,67072)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new K.AdapterType({name:"Gff3Adapter",displayName:"GFF3 adapter",configSchema:kt,getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5935),r.e(8672),r.e(501),r.e(8537)]).then(r.bind(r,58354)).then((e=>e.default))})))})(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="Gff3TabixAdapter",o=(0,J.getFileName)(t),i=r&&(0,J.getFileName)(r);return/\.gff3?\.b?gz$/i.test(o)||n===a?{type:a,bamLocation:t,gffGzLocation:t,index:{location:r||(0,J.makeIndex)(t,".tbi"),indexType:(0,J.makeIndexType)(i,"CSI","TBI")}}:e(t,r,n)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="Gff3Adapter",o=(0,J.getFileName)(t),i={type:a,gffLocation:t};return/\.gff3?$/i.test(o)&&!n||n===a?i:e(t,r,n)}))})(e)}};var xt=r(25077);r(86394);const Pt=d.types.model("Job",{name:d.types.string,statusMessage:d.types.maybe(d.types.string),progressPct:d.types.number}).volatile((()=>({cancelCallback(){}}))).actions((e=>({setCancelCallback(t){e.cancelCallback=t},setStatusMessage(t){e.statusMessage=t},setProgressPct(t){e.progressPct=t}}))),Mt=(0,i.ConfigurationSchema)("JobsListWidget",{}),Et=class extends a.Z{name="JobsManagementPlugin";install(e){e.addWidgetType((()=>new xt.Z({name:"JobsListWidget",heading:"Jobs list",configSchema:Mt,stateModel:d.types.model("JobsListModel",{id:Y.ElementId,type:d.types.literal("JobsListWidget"),jobs:d.types.array(Pt),finished:d.types.array(Pt),queued:d.types.array(Pt),aborted:d.types.array(Pt)}).actions((e=>({addJob(t){const{cancelCallback:r}=t,n=e.jobs.push(t),a=e.jobs[n-1];return a.setCancelCallback(r),a},removeJob(t){const r=e.jobs.findIndex((e=>e.name===t)),n=e.jobs[r];return e.jobs.splice(r,1),n},addFinishedJob:t=>(e.finished.push(t),e.finished),addQueuedJob:t=>(e.queued.push(t),e.finished),addAbortedJob:t=>(e.aborted.push(t),e.aborted),removeQueuedJob(t){const r=e.queued.findIndex((e=>e.name===t)),n=e.queued[r];return e.queued.splice(r,1),n},updateJobStatusMessage(t,r){const n=e.jobs.find((e=>e.name===t));if(!n)throw new Error(`No job found with name ${t}`);n.setStatusMessage(r)},updateJobProgressPct(t,r){const n=e.jobs.find((e=>e.name===t));if(!n)throw new Error(`No job found with name ${t}`);n.setProgressPct(r)}}))),ReactComponent:(0,w.lazy)((()=>Promise.resolve().then(r.bind(r,86394))))})))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Jobs list",icon:Pe.ks,onClick:e=>{if((0,c.isSessionModelWithWidgets)(e)){const{widgets:t}=e;let r=t.get("JobsList");r||(r=e.addWidget("JobsListWidget","JobsList")),e.showWidget(r)}}})}},Rt=(0,i.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0});var At=r(49368),It=r(56798),Ft=r(45728),Nt=r(86355),Lt=r.n(Nt),Dt=r(41762).lW;class Bt{constructor(e){this.url=e.url.endsWith("/")?e.url:`${e.url}/`}async readMeta(){const e=await this.loadFile("meta.json"),{compress:t,track_names:r}=e;return{hashHexCharacters:Math.ceil(e.hash_bits/4),compress:t,tracks:r}}async getHashHexCharacters(){return(await this.readMeta()).hashHexCharacters}async getCompress(){return(await this.readMeta()).compress}async getTrackNames(){return(await this.readMeta()).tracks}async get(e){return(await this.getBucket(e))[e]}async getBucket(e){const t=this.hash(e),r=await this.hexToDirPath(t);return this.loadFile(r)}async loadFile(e){const t=await fetch(`${this.url}${e}`);if(!t.ok)throw new Error(`HTTP ${t.status} ${t.statusText}`);return t.json()}async hexToDirPath(e){const t=await this.getHashHexCharacters();if(t){const r=await this.getCompress();for(;e.length<8;)e=`0${e}`;e=e.slice(8-t);const n=[];for(let t=0;t<e.length;t+=3)n.push(e.slice(t,t+3));return`${n.join("/")}.json${r?"z":""}`}return""}hash(e){return Lt()(Dt.from(e)).toString("hex").toLowerCase().replace("-","n")}}class Vt extends It.BaseAdapter{constructor(e,t,r){super(e,t,r);const n=(0,i.readConfObject)(e,"namesIndexLocation"),{baseUri:a,uri:o}=n;this.httpMap=new Bt({url:a?new URL(o,a).href:o})}async loadIndexFile(e){return this.httpMap.getBucket(e)}async searchIndex(e){const{searchType:t,queryString:r}=e,n=this.tracksNames||await this.httpMap.getTrackNames(),a=r.toLowerCase(),o=await this.loadIndexFile(a);return o[a]?this.formatResults(o[a],n,t):[]}formatResults(e,t,r){return[..."exact"===r?[]:e.prefix.map((e=>new Ft.Z({label:"object"==typeof e?e.name:e,matchedAttribute:"name",matchedObject:{result:e}}))),...e.exact.map((e=>{const r=e[0],n=e[1],a=`${e[3]||r}:${e[4]}-${e[5]}`;return new Ft.Z({locString:a,label:r,matchedAttribute:"name",matchedObject:e,trackId:t[n]})}))].filter((e=>"too many matches"!==e.getLabel()))}freeResources(){}}const zt=(0,i.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"});var Ot=r(66511);const Zt=(0,i.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:s.baseConnectionConfig});function jt(e){return d.types.compose("JBrowse1Connection",(0,s.BaseConnectionModelFactory)(e),d.types.model({configuration:(0,i.ConfigurationReference)(Zt),type:d.types.literal("JBrowse1Connection")})).actions((e=>({async connect(){const t=(0,c.getSession)(e);try{const n=(0,i.getConf)(e,"dataDirLocation"),{fetchJb1:a}=await r.e(3577).then(r.bind(r,83577)),{convertTrackConfig:o}=await r.e(9901).then(r.bind(r,9901)),s=await a(n),l=(0,i.getConf)(e,"assemblyNames")[0];if(!l)throw new Error("assembly name required for JBrowse 1 connection");const c=t.assemblies.find((e=>(0,i.readConfObject)(e,"name")===l));if(!c)throw new Error(`Assembly "${l}" not found`);const d=(0,i.readConfObject)(c,["sequence","adapter"]),u=s.tracks?.map((e=>({...o(e,s.dataRoot||"",d),assemblyNames:[l]})));e.setTrackConfs(u)}catch(r){console.error(r),t.notify(`There was a problem connecting to the JBrowse 1 data directory "${e.name}". Please make sure you have entered a valid location. The error that was thrown is: "${r}"`,"error"),t.breakConnection?.(e.configuration)}}})))}class Wt extends a.Z{name="LegacyJBrowsePlugin";install(e){(e=>{e.addAdapterType((()=>new K.AdapterType({name:"NCListAdapter",displayName:"NCList adapter",configSchema:Rt,getAdapterClass:()=>Promise.all([r.e(3744),r.e(5192),r.e(3465)]).then(r.bind(r,98994)).then((e=>e.default))})))})(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="NCListAdapter",o=(0,J.getFileName)(t);return/trackData.jsonz?$/i.test(o)||n===a?{type:a,rootUrlTemplate:t}:e(t,r,n)}))})(e),(e=>{e.addTextSearchAdapterType((()=>new At.Z({name:"JBrowse1TextSearchAdapter",configSchema:zt,AdapterClass:Vt,description:"A JBrowse 1 text search adapter"})))})(e),(e=>{e.addConnectionType((()=>new Ot.Z({name:"JBrowse1Connection",configSchema:Zt,stateModel:jt(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})))})(e)}}var $t=r(4592),Ht=r(18632);const Gt=function(e){return(0,i.ConfigurationSchema)("LinearComparativeDisplay",{},{explicitlyTyped:!0,explicitIdentifier:"displayId"})};function qt(e){const{rpcManager:t}=(0,c.getSession)(e),r=e;(0,i.readConfObject)(e.configuration);const{adapterConfig:n}=e,a=(0,c.getContainingView)(e),o=(0,J.getRpcSessionId)(e);return(0,d.getSnapshot)(a),a.initialized?{rpcManager:t,renderProps:{...r.renderProps(),view:a,adapterConfig:n,sessionId:o,timeout:1e6,self:e}}:void 0}async function Ut(e){if(!e)return;const{rpcManager:t,renderProps:r}=e,{adapterConfig:n}=r,a=r.view.views[0],o=await t.call("getFeats","CoreGetFeatures",{regions:a.staticBlocks.contentBlocks,sessionId:"getFeats",adapterConfig:n});return{features:(0,c.dedupe)(o,(e=>e.id()))}}const _t=function(e){return d.types.compose("LinearComparativeDisplay",s.BaseDisplay,d.types.model({type:d.types.literal("LinearComparativeDisplay"),configuration:(0,i.ConfigurationReference)(e),height:100})).volatile((()=>({renderInProgress:void 0,features:void 0,message:void 0}))).views((e=>({renderProps:()=>({rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2})}))).actions((e=>{let t;return{setLoading(r){e.message=void 0,e.error=void 0,t=r},setMessage(r){t&&!t.signal.aborted&&t.abort(),e.message=r,e.error=void 0,t=void 0},setRendered(r){if(!r)return;const{features:n}=r,a=e.features||[],o=new Set(a.map((e=>e.id()))||[]),i=new Set(n?.map((e=>e.id()))||[]);let s=!1,l=!1;for(const e of n)if(!o.has(e.id())){s=!0;break}for(const e of a)if(!i.has(e.id())){l=!0;break}e.message=void 0,e.error=void 0,t=void 0,(s||l||!e.features)&&(e.features=n)},setError(r){console.error(r),t&&!t.signal.aborted&&t.abort(),e.message=void 0,e.error=r,t=void 0}}})).actions((e=>({afterAttach(){(0,c.makeAbortableReaction)(e,qt,Ut,{name:`${e.type} ${e.id} rendering`,delay:1e3,fireImmediately:!0},e.setLoading,e.setRendered,e.setError)}})))},Jt=(0,w.lazy)((()=>Promise.resolve().then(r.bind(r,31547)))),Xt=function(e){return d.types.compose("LinearComparativeView",xe.Z,d.types.model({id:Y.ElementId,type:d.types.literal("LinearComparativeView"),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,middleComparativeHeight:100,tracks:d.types.array(e.pluggableMstType("track","stateModel")),views:d.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:d.types.array(e.pluggableConfigSchemaType("track"))})).volatile((()=>({width:void 0}))).views((e=>({get highResolutionScaling(){return 2},get initialized(){return void 0!==e.width&&e.views.length>0&&e.views.every((e=>e.initialized))},get refNames(){return e.views.map((e=>[...new Set(e.staticBlocks.map((e=>e.refName)))]))},get assemblyNames(){return[...new Set(e.views.flatMap((e=>e.assemblyNames)))]}}))).actions((t=>({afterAttach(){(0,d.addDisposer)(t,(0,d.onAction)(t,(e=>{if(t.linkViews){const{name:t,path:r,args:n}=e;["horizontalScroll","zoomTo","setScaleFactor"].includes(t)&&r&&this.onSubviewAction(t,r,n)}})))},beforeDestroy(){const e=(0,c.getSession)(t);for(const r of t.assemblyNames)e.removeTemporaryAssembly?.(r)},onSubviewAction(e,r,n){t.views.forEach((t=>{(0,d.getPath)(t).endsWith(r)||t[e](n?.[0])}))},setWidth(e){t.width=e},setViews(e){t.views=(0,d.cast)(e)},removeView(e){t.views.remove(e)},closeView(){(0,d.getParent)(t,2).removeView(t)},setMiddleComparativeHeight:e=>(t.middleComparativeHeight=e,t.middleComparativeHeight),toggleLinkViews(){t.linkViews=!t.linkViews},activateTrackSelector(){if("hierarchical"!==t.trackSelectorType)throw new Error(`invalid track selector type ${t.trackSelectorType}`);{const e=(0,c.getSession)(t);if((0,c.isSessionModelWithWidgets)(e)){const r=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(r),r}}},toggleTrack(e){return!this.hideTrack(e)&&(this.showTrack(e),!0)},showTrack(r,n={}){const a=e.pluggableConfigSchemaType("track"),o=(0,d.resolveIdentifier)(a,(0,d.getRoot)(t),r);if(!o)throw new Error(`track not found ${r}`);const i=e.getTrackType(o.type);if(!i)throw new Error(`unknown track type ${o.type}`);const s=e.getViewType(t.type),l=new Set(s.displayTypes.map((e=>e.name))),c=o.displays.find((e=>l.has(e.type)));if(!c)throw new Error(`could not find a compatible display for view type ${t.type}`);t.tracks.push(i.stateModel.create({...n,type:o.type,configuration:o,displays:[{type:c.type,configuration:c}]}))},hideTrack(r){const n=e.pluggableConfigSchemaType("track"),a=(0,d.resolveIdentifier)(n,(0,d.getRoot)(t),r),o=t.tracks.filter((e=>e.configuration===a));return(0,ae.transaction)((()=>o.forEach((e=>t.tracks.remove(e))))),o.length},squareView(){const e=(0,c.avg)(t.views.map((e=>e.bpPerPx)));t.views.forEach((t=>{const r=t.pxToBp(t.width/2);t.setNewView(e,t.offsetPx),r.refName&&t.centerAt(r.coord,r.refName,r.index)}))},clearView(){t.views=(0,d.cast)([]),t.tracks=(0,d.cast)([])}}))).views((()=>({headerMenuItems:()=>[]}))).views((e=>({menuItems:()=>[...e.views.map(((e,t)=>[t,e.menuItems?.()])).filter((e=>!!e[1])).map((e=>({label:`View ${e[0]+1} Menu`,subMenu:e[1]}))),{label:"Return to import form",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[Jt,{model:e,handleClose:t}]))},icon:Me.Z},{label:"Open track selector",onClick:e.activateTrackSelector,icon:Pe.GD}],rubberBandMenuItems:()=>[{label:"Zoom to region(s)",onClick:()=>{e.views.forEach((e=>{const{leftOffset:t,rightOffset:r}=e;t&&r&&e.moveTo(t,r)}))}}]}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((()=>{e.width&&e.views.forEach((t=>t.setWidth(e.width)))})))}})))},Yt=function(e){return d.types.compose("LinearSyntenyDisplay",_t(e),d.types.model({type:d.types.literal("LinearSyntenyDisplay"),configuration:(0,i.ConfigurationReference)(e)})).volatile((()=>({mainCanvas:null,clickMapCanvas:null,cigarClickMapCanvas:null,mouseoverCanvas:null,featPositions:[],mouseoverId:void 0,clickId:void 0,cigarMouseoverId:-1}))).actions((e=>({setFeatPositions(t){e.featPositions=t},setMainCanvasRef(t){e.mainCanvas=t},setClickMapCanvasRef(t){e.clickMapCanvas=t},setCigarClickMapCanvasRef(t){e.cigarClickMapCanvas=t},setMouseoverCanvasRef(t){e.mouseoverCanvas=t},setMouseoverId(t){e.mouseoverId=t},setCigarMouseoverId(t){e.cigarMouseoverId=t},setClickId(t){e.clickId=t}}))).views((e=>({get adapterConfig(){return{name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,i.getConf)(e,"assemblyNames"),...(0,i.getConf)(e.parentTrack,"adapter")}},get trackIds(){return(0,i.getConf)(e,"trackIds")},get numFeats(){return e.featPositions.length},get ready(){return this.numFeats>0},get featMap(){return Object.fromEntries(e.featPositions.map((e=>[e.f.id(),e])))}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(5828).then(r.bind(r,55828));t(e)}catch(t){console.error(t),e.setError(t)}})()}})))},Kt=(0,w.lazy)((()=>r.e(9321).then(r.bind(r,59321))));var Qt=r(84165),er=r(72241);function tr(e){return w.createElement(N.Z,e,w.createElement("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"}))}const rr=(0,w.lazy)((()=>r.e(555).then(r.bind(r,70555))));function nr(e){return d.types.compose("LinearSyntenyView",Xt(e),d.types.model({type:d.types.literal("LinearSyntenyView"),drawCIGAR:!0,drawCurves:!1})).actions((e=>({toggleCurves(){e.drawCurves=!e.drawCurves},toggleCIGAR(){e.drawCIGAR=!e.drawCIGAR},showAllRegions(){(0,ae.transaction)((()=>{e.views.forEach((e=>e.showAllRegionsInAssembly()))}))}}))).actions((e=>({async exportSvg(t){const{renderToSvg:n}=await r.e(3378).then(r.bind(r,73378)),a=await n(e,t),o=new Blob([a],{type:"image/svg+xml"});(0,oe.saveAs)(o,t.filename||"image.svg")}}))).views((e=>{const t=e.headerMenuItems,r=e.menuItems;return{headerMenuItems:()=>[...t(),{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:Qt.Z},{label:"Show all regions",onClick:e.showAllRegions,description:"Show entire genome assemblies",icon:er.Z},{label:"Draw CIGAR",onClick:e.toggleCIGAR,checked:e.drawCIGAR,type:"checkbox",description:"Draws per-base CIGAR level alignments"},{label:"Link views",type:"checkbox",checked:e.linkViews,onClick:e.toggleLinkViews,icon:se.Z},{label:"Use curved lines",type:"checkbox",checked:e.drawCurves,onClick:e.toggleCurves,icon:tr},{label:"Export SVG",icon:ie.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[rr,{model:e,handleClose:t}]))}}],menuItems:()=>[...r(),{label:"Export SVG",icon:ie.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[rr,{model:e,handleClose:t}]))}}]}}))}function ar(e,t,r){try{e.showTrack(t)}catch(e){if(!`${e}`.match("Could not resolve identifier"))throw e;r.push(t)}}var or=r(5889);const ir=(0,i.ConfigurationSchema)("SyntenyFeatureWidget",{}),sr=d.types.model("SyntenyFeatureWidget",{id:Y.ElementId,type:d.types.literal("SyntenyFeatureWidget"),featureData:d.types.frozen()}).actions((e=>({setFeatureData(t){e.featureData=t},clearFeatureData(){e.featureData=void 0}})));var lr=r(10126);const{featurizeSA:cr,getClip:dr,getLength:ur,getLengthSansClipping:pr,getTag:mr}=n.MismatchParser,gr=(0,Oe.ZL)()({root:{width:300}});function fr({track:e,feature:t,handleClose:r}){const{classes:n}=gr(),[a,o]=(0,w.useState)("0"),[s,l]=(0,w.useState)(),[d,u]=(0,w.useState)(),p=+a;return(0,w.useEffect)((()=>{(async()=>{l(void 0);try{if(2048&t.get("flags")){const r=(mr(t,"SA")||"").split(";")[0],[n,a]=r.split(","),{rpcManager:o}=(0,c.getSession)(e),s=(0,i.getConf)(e,"adapter"),l=(0,J.getRpcSessionId)(e),d=(await o.call(l,"CoreGetFeatures",{adapterConfig:s,sessionId:l,regions:[{refName:n,start:+a-1,end:+a}]})).find((e=>!(e.get("name")!==t.get("name")||2048&e.get("flags")||256&e.get("flags"))));if(!d)throw new Error("primary feature not found");u(d)}else u(t)}catch(e){console.error(e),l(e)}})()}),[t,e]),w.createElement(T.Dialog,{open:!0,onClose:r,title:"Set window size"},w.createElement(v.Z,null,s?w.createElement(Ze.Z,{color:"error"},`${s}`):d?w.createElement("div",{className:n.root},256&d.get("flags")?w.createElement(Ze.Z,{style:{color:"orange"}},"Note: You selected a secondary alignment (which generally does not have SA tags or SEQ fields) so do a full reconstruction of the alignment"):null,w.createElement(Ze.Z,null,"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."),w.createElement(C.Z,{value:p,onChange:e=>o(e.target.value),label:"Set window size"})):w.createElement("div",null,w.createElement(Ze.Z,null,"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."),w.createElement(lr.Z,null))),w.createElement(S.Z,null,w.createElement(k.Z,{variant:"contained",color:"secondary",onClick:r},"Cancel"),w.createElement(k.Z,{disabled:!d,variant:"contained",color:"primary",onClick:function(){try{if(!d)return;const t=d,n=(0,c.getSession)(e),a=(0,c.getContainingView)(e),o=t.get("CIGAR"),s=t.get("flags"),l=t.get("strand"),u=mr(t,"SA")||"",m=t.get("name"),g=dr(o,1),f=`${m}_assembly_${Date.now()}`,[h]=(0,i.getConf)(e,"assemblyNames"),y=[h,f],b=`track-${Date.now()}`,w=`${m}_vs_${h}`,{assemblyManager:v}=n,C=v.get(h);if(!C)throw new Error("assembly not found");const S=cr(u,t.id(),l,m,!0),k=t.toJSON();k.clipPos=g,k.strand=1,k.mate={refName:m,start:g,end:g+pr(o)};const T=ur(2048&s?S[0].CIGAR:o),x=[k,...S];x.forEach(((e,t)=>{e.refName=C?.getCanonicalRefName(e.refName)||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId=`${e.uniqueId}_mate`})),x.sort(((e,t)=>e.clipPos-t.clipPos));const P=t.get("seq"),M=[...x,...x.map((e=>e.mate))],E=2*p,R=x.reduce(((e,t)=>e+t.end-t.start+E),0),A=`${m}_${Date.now()}`,I=(0,i.getConf)(C,"sequence"),F=(0,c.gatherOverlaps)(x.map((e=>({...e,start:Math.max(0,e.start-p),end:e.end+p,assemblyName:h}))));n.addTemporaryAssembly?.({name:`${f}`,sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:A,assemblyNames:[f],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:T,seq:P||"",refName:m,uniqueId:`${Math.random()}`}]}}}),n.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:R/a.width,displayedRegions:F,tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",assemblyNames:[h],configuration:I.trackId,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${A}-LinearReferenceSequenceDisplay`}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:T/a.width,displayedRegions:[{assemblyName:f,start:0,end:T,refName:m}],tracks:[{id:`${Math.random()}`,type:"ReferenceSequenceTrack",configuration:A,displays:[{id:`${Math.random()}`,type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:`${A}-LinearReferenceSequenceDisplay`}]}]}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:y,adapter:{type:"FromConfigAdapter",features:M},trackId:b,name:w}],tracks:[{configuration:b,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:`${b}-LinearSyntenyDisplay`}]}],displayName:`${m} vs ${h}`}),r()}catch(e){console.error(e),l(e)}}},"Submit")))}const hr=class extends a.Z{name="LinearComparativeViewPlugin";install(e){(e=>{e.addViewType((()=>new te.Z({name:"LinearComparativeView",displayName:"Linear comparative view",stateModel:Xt(e),ReactComponent:(0,w.lazy)((()=>r.e(4535).then(r.bind(r,64535))))})))})(e),(e=>{e.addViewType((()=>new te.Z({name:"LinearSyntenyView",displayName:"Linear synteny view",stateModel:nr(e),ReactComponent:(0,w.lazy)((()=>r.e(4594).then(r.bind(r,94594))))})))})(e),(e=>{e.addDisplayType((()=>{const e=Gt();return new ze.Z({name:"LinearComparativeDisplay",configSchema:e,stateModel:_t(e),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:()=>null})}))})(e),(e=>{e.addDisplayType((()=>{const e=(0,i.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:Gt(),explicitlyTyped:!0});return new ze.Z({name:"LinearSyntenyDisplay",configSchema:e,stateModel:Yt(e),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:(0,w.lazy)((()=>r.e(2286).then(r.bind(r,62286))))})}))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LGVSyntenyDisplay",{},{baseConfiguration:(0,n.Ct)(e),explicitlyTyped:!0})}(e),r=(a=t,d.types.compose("LGVSyntenyDisplay",(0,n.P1)(a),d.types.model({type:d.types.literal("LGVSyntenyDisplay"),configuration:(0,i.ConfigurationReference)(a)})).views((e=>{const t=e.contextMenuItems;return{contextMenuItems(){const r=e.contextMenuFeature;return[...t(),...r?[{label:"Open synteny view for this position",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[Kt,{model:e,handleClose:t,feature:r}]))}}]:[]]}}})).views((e=>{const{trackMenuItems:t,colorSchemeSubMenuItems:r}=e;return{trackMenuItems:()=>[...t(),{label:"Color scheme",subMenu:[...r()]}]}})).actions((e=>({afterCreate(){e.colorBy?e.setColorScheme({...e.colorBy}):e.setColorScheme({type:"strand"})}}))));var a;return new ze.Z({name:"LGVSyntenyDisplay",configSchema:t,stateModel:r,trackType:"SyntenyTrack",viewType:"LinearGenomeView",ReactComponent:$t.qb})}))})(e),function(e){e.addToExtensionPoint("LaunchView-LinearSyntenyView",(async({session:e,views:t,tracks:r=[]})=>{try{const{assemblyManager:n}=e,a=e.addView("LinearSyntenyView",{});await(0,ae.when)((()=>!!a.width)),a.setViews(await Promise.all(t.map((async e=>{const t=await n.waitForAssembly(e.assembly);if(!t)throw new Error(`Assembly ${e.assembly} failed to load`);return{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:t.regions}})))),await Promise.all(a.views.map((e=>(0,ae.when)((()=>e.initialized)))));const o=[];if(await Promise.all(t.map((async(e,t)=>{const r=a.views[t],{assembly:i,loc:s,tracks:l=[]}=e,c=await n.waitForAssembly(i);if(!c)throw new Error(`Assembly ${e.assembly} failed to load`);await r.navToSearchString({input:s,assembly:c}),l.forEach((e=>ar(r,e,o)))}))),r.forEach((e=>ar(a,e,o))),o.length)throw new Error(`Could not resolve identifiers: ${o.join(",")}`)}catch(t){throw e.notify(`${t}`,"error"),t}}))}(e),function(e){e.addTrackType((()=>{const t=(e=>(0,i.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,s.createBaseTrackConfig)(e)}))(e);return new or.Z({name:"SyntenyTrack",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),(e=>{e.addWidgetType((()=>new xt.Z({name:"SyntenyFeatureWidget",heading:"Synteny feature details",configSchema:ir,stateModel:sr,ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(4081),r.e(3992),r.e(4047),r.e(3363)]).then(r.bind(r,21846))))})))})(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>("LinearPileupDisplay"!==e.name||(e.stateModel=e.stateModel.extend((e=>{const t=e.contextMenuItems;return{views:{contextMenuItems(){const r=e.contextMenuFeature,n=(0,c.getContainingTrack)(e);return[...t(),...r?[{label:"Linear read vs ref",icon:mt.Z,onClick:()=>{(0,c.getSession)(e).queueDialog((e=>[fr,{track:n,feature:r,handleClose:e}]))}}]:[]]}}}}))),e)))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:Ht.Z,onClick:e=>{e.addView("LinearSyntenyView",{})}})}};function yr(e){return d.types.compose("LinearLollipopDisplay",$t.fV,d.types.model({type:d.types.literal("LinearLollipopDisplay"),configuration:(0,i.ConfigurationReference)(e)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.configuration.renderer}),get rendererTypeName(){return e.configuration.renderer.type}}}))}var br=r(71472);function wr({feature:e,config:t,layoutRecord:{y:r,data:{anchorX:n,radiusPx:a,score:o}}}){const s=(0,i.readConfObject)(t,"innerColor",{feature:e}),l=String(o),c=2*a/l.length*1.1;return c<12?null:w.createElement("text",{style:{fontSize:c,fill:(0,br.contrastingTextColor)(s)},x:n,y:r+a-c/2.4,textAnchor:"middle",dominantBaseline:"hanging"},l)}const vr=(0,je.observer)((function(e){const{feature:t,config:r,layoutRecord:n,selectedFeatureId:a}=e,{anchorLocation:o,y:s,data:{radiusPx:l}}=n,c=t=>{const{onFeatureMouseDown:r,feature:n}=e;return r?.(t,n.id())},d=t=>{const{onFeatureMouseEnter:r,feature:n}=e;return r?.(t,n.id())},u=t=>{const{onFeatureMouseOut:r,feature:n}=e;return r?.(t,n.id())},p=t=>{const{onFeatureMouseOver:r,feature:n}=e;return r?.(t,n.id())},m=t=>{const{onFeatureMouseUp:r,feature:n}=e;return r?.(t,n.id())},g=t=>{const{onFeatureMouseLeave:r,feature:n}=e;return r?.(t,n.id())},f=t=>{const{onFeatureMouseMove:r,feature:n}=e;return r?.(t,n.id())},h=t=>{const{onFeatureClick:r,feature:n}=e;return t.stopPropagation(),r?.(t,n.id())},y={fill:(0,i.readConfObject)(r,"strokeColor",{feature:t})};String(a)===String(t.id())&&(y.fill="red");const b={fill:(0,i.readConfObject)(r,"innerColor",{feature:t})},v=(0,i.readConfObject)(r,"strokeWidth",{feature:t});return w.createElement("g",{"data-testid":t.id()},w.createElement("title",null,(0,i.readConfObject)(r,"caption",{feature:t})),w.createElement("circle",{cx:o,cy:s+l,r:l,style:y,onMouseDown:c,onMouseEnter:d,onMouseOut:u,onMouseOver:p,onMouseUp:m,onMouseLeave:g,onMouseMove:f,onClick:h,onFocus:p,onBlur:u}),l-v<=2?null:w.createElement("circle",{cx:o,cy:s+l,r:l-v,style:b,onMouseDown:c,onMouseEnter:d,onMouseOut:u,onMouseOver:p,onMouseUp:m,onMouseLeave:g,onMouseMove:f,onClick:h,onFocus:p,onBlur:u}),w.createElement(wr,{feature:t,config:r,layoutRecord:n}))})),Cr=(0,je.observer)((function({feature:e,config:t,layoutRecord:{anchorLocation:r,y:n,data:{radiusPx:a}}}){return w.createElement("line",{x1:r,y1:0,x2:r,y2:n+2*a,stroke:(0,i.readConfObject)(t,"stickColor",{feature:e}),strokeWidth:(0,i.readConfObject)(t,"stickWidth",{feature:e})})}));function Sr(){return Sr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sr.apply(this,arguments)}function kr(e){const{feature:t,bpPerPx:r,config:n,region:a,layout:o}=e,s=Math.abs(t.get("end")+t.get("start"))/2,l=(0,c.bpToPx)(s,a,r),d=(0,i.readConfObject)(n,"radius",{feature:t});d||console.error(new Error(`lollipop radius ${d} configured for feature ${t.id()}`)),o.add(t.id(),l,2*d,2*d,{featureId:t.id(),anchorX:l,radiusPx:d,score:(0,i.readConfObject)(e.config,"score",{feature:t})})}const Tr=(0,je.observer)((function(e){const t=t=>{const{onMouseEnter:r}=e;return r?.(t)},r=t=>{const{onMouseLeave:r}=e;return r?.(t)},{regions:n,bpPerPx:a,layout:o,config:i,features:s=new Map,displayModel:l={}}=e,{selectedFeatureId:c}=l,[d]=n;for(const e of s.values())kr({feature:e,bpPerPx:a,region:d,config:i,layout:o});const u=(d.end-d.start)/a,p=[...o.getLayout(i).values()],m=o.getTotalHeight();return w.createElement("svg",{width:u,height:m,style:{position:"relative"},onMouseDown:t=>{const{onMouseDown:r}=e;return r?.(t)},onMouseUp:t=>{const{onMouseUp:r}=e;return r?.(t)},onMouseEnter:t,onMouseLeave:r,onMouseOver:t=>{const{onMouseOver:r}=e;return r?.(t)},onMouseOut:t=>{const{onMouseOut:r}=e;return r?.(t)},onFocus:t,onBlur:r,onClick:t=>{const{onClick:r}=e;return r?.(t)}},p.map((t=>{const r=s.get(t.data.featureId);return w.createElement(w.Fragment,{key:r.id()},w.createElement(Cr,Sr({},e,{config:i,layoutRecord:t,feature:r,key:`stick-${r.id()}`})),w.createElement(vr,Sr({},e,{layoutRecord:t,feature:r,key:`body-${r.id()}`,selectedFeatureId:c})))})))})),xr=(0,i.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0});var Pr=r(18930),Mr=r(59612),Er=r(19881);class Rr{totalHeight=0;constructor({width:e}){if(!e)throw new Error("width required to make a new FloatingLayout");this.width=e}items=[];layout=new Map;layoutDirty=!1;add(e,t,r,n,a){this.items.push({uniqueId:e,anchorLocation:t,width:r,height:n,data:a}),this.layoutDirty=!0}getLayout(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");const t=(0,i.readConfObject)(e,"minStickLength"),r=this.items.sort(((e,t)=>e.data.score-t.data.score));let n=0;const a=new Array(r.length);for(let e=0;e<r.length;e+=1){const o=r[e],{anchorLocation:i,width:s,height:l}=o,c=i-s/2,d=c+s;let u=t,p=u+l;for(let t=0;t<e;t+=1){const[,e]=a[t],{x:r,y:n,width:o,height:i}=e,s=r+o,m=n+i;(0,Er.qY)(r,s,c,d)&&(0,Er.qY)(n,m,u,p)&&(u=m,p=u+l,t=-1)}a[e]=[o.uniqueId,{...o,x:c,y:u}],p>n&&(n=p)}return this.totalHeight=n,this.layout=new Map(a),this.layoutDirty=!1,this.layout}getTotalHeight(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}serializeRegion(){return this.toJSON()}toJSON(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:[...this.getLayout()],totalHeight:this.getTotalHeight()}}static fromJSON(){throw new Error("not supported")}}class Ar{constructor({pairs:e,totalHeight:t}){this.layout=new Map(e),this.totalHeight=t}add(e){if(!this.layout.has(e))throw new Error(`layout error, precomputed layout is missing ${e}`)}getLayout(){return this.layout}getTotalHeight(){return this.totalHeight}static fromJSON(e){return new Ar(e)}}class Ir extends Pr.LayoutSession{makeLayout(){const{end:e,start:t}=this.regions[0],r=(e-t)/this.bpPerPx;return new Mr.Z(Rr,{width:r})}layoutIsValid(){return!1}}const Fr=class extends Pr.default{createSession(e){return new Ir(e)}deserializeLayoutInClient(e){return new Ar(e)}},Nr=class extends a.Z{name="LollipopPlugin";install(e){e.addRendererType((()=>new Fr({name:"LollipopRenderer",ReactComponent:Tr,configSchema:xr,pluginManager:e}))),e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:$t.fU,explicitlyTyped:!0})}(e);return new ze.Z({name:"LinearLollipopDisplay",configSchema:t,stateModel:yr(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:$t.qb})}))}};function Lr(e){return d.types.compose("LinearArcDisplay",$t.fV,d.types.model({type:d.types.literal("LinearArcDisplay"),configuration:(0,i.ConfigurationReference)(e),displayMode:d.types.maybe(d.types.string)})).views((e=>({get blockType(){return"staticBlocks"},get renderDelay(){return 500},get rendererTypeName(){return e.configuration.renderer.type}}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,i.getConf)(e,["renderer","displayMode"])}}))).views((e=>({get rendererConfig(){const t=(0,i.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create({...t,displayMode:e.displayModeSetting},(0,c.getEnv)(e))}}))).views((e=>{const{renderProps:t}=e;return{renderProps:()=>({...t(),rpcDriverName:e.rpcDriverName,config:e.rendererConfig,height:e.height})}})).actions((e=>({setDisplayMode(t){e.displayMode=t}}))).views((e=>{const t=e.trackMenuItems;return{trackMenuItems:()=>[...t(),{label:"Display mode",subMenu:[{type:"radio",label:"Arcs",onClick:()=>e.setDisplayMode("arcs"),checked:"arcs"===e.displayMode},{type:"radio",label:"Semi-circles",onClick:()=>e.setDisplayMode("semicircles"),checked:"semicircles"===e.displayMode}]}]}}))}function Dr(e){return d.types.compose("LinearPairedArcDisplay",K.BaseDisplay,(0,$t.eW)(),(0,$t.Ek)(),d.types.model({type:d.types.literal("LinearPairedArcDisplay"),configuration:(0,i.ConfigurationReference)(e),displayMode:d.types.maybe(d.types.string)})).volatile((()=>({lastDrawnOffsetPx:0,features:void 0,loading:!1,drawn:!0}))).views((e=>({get displayModeSetting(){return e.displayMode??(0,i.getConf)(e,["renderer","displayMode"])}}))).actions((e=>({selectFeature(t){const r=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(r)){const n=r.addWidget("VariantFeatureWidget","variantFeature",{view:(0,c.getContainingView)(e),track:(0,c.getContainingTrack)(e),featureData:t.toJSON()});r.showWidget(n)}(0,c.isSelectionContainer)(r)&&r.setSelection(t)},setLoading(t){e.loading=t},setFeatures(t){e.features=t},setDisplayMode(t){e.displayMode=t}}))).actions((e=>({afterAttach(){(async()=>{try{const{doAfterAttach:t}=await r.e(6486).then(r.bind(r,16486));t(e)}catch(t){console.error(t),e.setError(t)}})()},async renderSvg(t){const{renderArcSvg:n}=await r.e(8238).then(r.bind(r,68238));return n(e,t)}})))}var Br=r(94924);function Vr({selectedFeatureId:e,region:t,bpPerPx:r,config:n,onFeatureClick:a,feature:o}){const[s,l]=(0,c.bpSpanPx)(o.get("start"),o.get("end"),t,r),d=o.id();let u=(0,i.readConfObject)(n,"color",{feature:o}),p="black";e&&String(e)===String(o.id())&&(u=p="red");const m=(0,i.readConfObject)(n,"label",{feature:o}),g=(0,i.readConfObject)(n,"caption",{feature:o}),f=(0,i.readConfObject)(n,"thickness",{feature:o})||1,h=(0,i.readConfObject)(n,"height",{feature:o})||100,y=w.createRef(),b=20+(0,c.measureText)(g?.toString()),v=0+.5*h*.75+.375*h+0;return w.createElement("g",null,w.createElement("path",{d:`M ${s} 0 C ${s} ${h}, ${l} ${h}, ${l} 0`,stroke:u,strokeWidth:f,fill:"transparent",onClick:e=>a?.(e,d),ref:y,pointerEvents:"stroke"}),w.createElement(Br.u,{triggerRef:y},w.createElement("rect",{x:12,y:0,width:b,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),w.createElement("text",{x:22,y:14,fontSize:10,fill:"white",textLength:b-20},g)),w.createElement("text",{x:s+(l-s)/2,y:v+3,style:{stroke:"white",strokeWidth:"0.6em"}},m),w.createElement("text",{x:s+(l-s)/2,y:v+3,style:{stroke:p}},m))}function zr(e,t,r,n){const a=(n-90)*Math.PI/180;return{x:e+r*Math.cos(a),y:t+r*Math.sin(a)}}function Or(e,t,r,n,a){const o=zr(e,t,r,a),i=zr(e,t,r,n),s=a-n<=180?"0":"1";return["M",o.x,o.y,"A",r,r,0,s,0,i.x,i.y].join(" ")}function Zr({selectedFeatureId:e,region:t,bpPerPx:r,config:n,onFeatureClick:a,feature:o}){const[s,l]=(0,c.bpSpanPx)(o.get("start"),o.get("end"),t,r),d=o.id();let u=(0,i.readConfObject)(n,"color",{feature:o}),p="black";e&&String(e)===String(o.id())&&(u=p="red");const m=(0,i.readConfObject)(n,"label",{feature:o}),g=(0,i.readConfObject)(n,"caption",{feature:o}),f=(0,i.readConfObject)(n,"thickness",{feature:o})||1,h=w.createRef(),y=20+(0,c.measureText)(g?.toString()),b=(l-s)/2;return w.createElement("g",null,w.createElement("path",{d:Or(s+(l-s)/2,0,(l-s)/2,90,270),stroke:u,strokeWidth:f,fill:"transparent",onClick:e=>a?.(e,d),ref:h,pointerEvents:"stroke"}),w.createElement(Br.u,{triggerRef:h},w.createElement("rect",{x:12,y:0,width:y,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),w.createElement("text",{x:22,y:14,fontSize:10,fill:"white",textLength:y-20},g)),w.createElement("text",{x:s+(l-s)/2,y:b+3,style:{stroke:"white",strokeWidth:"0.6em"}},m),w.createElement("text",{x:s+(l-s)/2,y:b+3,style:{stroke:p}},m))}function jr({exportSVG:e,width:t,height:r,children:n}){return e?w.createElement(w.Fragment,null,n):w.createElement("svg",{width:t,height:r},n)}const Wr=(0,je.observer)((function({features:e,config:t,regions:r,bpPerPx:n,height:a,exportSVG:o,displayModel:{selectedFeatureId:s}}){const[l]=r,c=(l.end-l.start)/n,d="semicircles"===(0,i.readConfObject)(t,"displayMode");return w.createElement(jr,{exportSVG:o,width:c,height:a},[...e.values()].map((e=>d?w.createElement(Zr,{key:e.id(),config:t,region:l,bpPerPx:n,selectedFeatureId:s,feature:e}):w.createElement(Vr,{key:e.id(),config:t,region:l,bpPerPx:n,selectedFeatureId:s,feature:e}))))})),$r=(0,i.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue",contextVariable:["feature"]},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')",contextVariable:["feature"]},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50",contextVariable:["feature"]},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},displayMode:{type:"enum",defaultValue:"arcs",model:d.types.enumeration("DisplayMode",["arcs","semicircles"]),description:"render semi-circles instead of arcs"}},{explicitlyTyped:!0});var Hr=r(90176);const Gr=class extends Hr.default{};var qr=r(39092);class Ur extends a.Z{name="ArcRenderer";install(e){(e=>{e.addRendererType((()=>new Gr({name:"ArcRenderer",ReactComponent:Wr,configSchema:$r,pluginManager:e})))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearArcDisplay",{renderer:d.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:$t.fU,explicitlyTyped:!0})}(e);return new K.DisplayType({name:"LinearArcDisplay",displayName:"Arc display",configSchema:t,stateModel:Lr(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:$t.qb})}))})(e),function(e){e.addDisplayType((()=>{const e=(0,i.ConfigurationSchema)("LinearPairedArcDisplay",{color:{type:"color",description:"the color of the arcs",defaultValue:"jexl:defaultPairedArcColor(feature,alt)",contextVariable:["feature","alt"]}},{baseConfiguration:$t.fU,explicitlyTyped:!0});return new K.DisplayType({name:"LinearPairedArcDisplay",displayName:"Arc display",configSchema:e,stateModel:Dr(e),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:(0,w.lazy)((()=>r.e(9141).then(r.bind(r,59141))))})}))}(e),e.jexl.addFunction("logThickness",((e,t)=>Math.log(e.get(t)+1))),e.jexl.addFunction("defaultPairedArcColor",((e,t)=>t?.startsWith("<DEL")?qr.set1[0]:t?.startsWith("<DUP")?qr.set1[1]:t?.startsWith("<INV")?qr.set1[2]:t?.startsWith("<TRA")?qr.set1[3]:t?.startsWith("<CNV")?qr.set1[4]:qr.set1[6]))}}var _r=r(98621),Jr=r(66490);const Xr=(0,i.ConfigurationSchema)("AboutWidget",{}),Yr=d.types.model("AboutWidget",{id:Y.ElementId,type:d.types.literal("AboutWidget")}),Kr=(0,i.ConfigurationSchema)("HelpWidget",{}),Qr=d.types.model("HelpWidget",{id:Y.ElementId,type:d.types.literal("HelpWidget")}),en=(0,i.ConfigurationSchema)("ImportSessionWidget",{}),tn=d.types.model("ImportSessionWidget",{id:Y.ElementId,type:d.types.literal("ImportSessionWidget")}),rn=(0,i.ConfigurationSchema)("SessionManager",{}),nn=d.types.model("SessionManager",{id:Y.ElementId,type:d.types.literal("SessionManager")}),an=class extends a.Z{name="MenusPlugin";install(e){e.addWidgetType((()=>new xt.Z({name:"AboutWidget",heading:"About",configSchema:Xr,stateModel:Yr,ReactComponent:(0,w.lazy)((()=>r.e(1227).then(r.bind(r,21227))))}))),e.addWidgetType((()=>new xt.Z({name:"HelpWidget",heading:"Help",configSchema:Kr,stateModel:Qr,ReactComponent:(0,w.lazy)((()=>r.e(7438).then(r.bind(r,47438))))}))),e.addWidgetType((()=>new xt.Z({name:"ImportSessionWidget",heading:"Import session",configSchema:en,stateModel:tn,ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(7209),r.e(150)]).then(r.bind(r,20150))))}))),e.addWidgetType((()=>new xt.Z({name:"SessionManager",heading:"Sessions",configSchema:rn,stateModel:nn,ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(3457),r.e(8426)]).then(r.bind(r,48426))))})))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:Jr.Z,onClick:e=>{const t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:_r.Z,onClick:e=>{const t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}};var on=r(16979),sn=r(85291),ln=r(65312),cn=r.n(ln);class dn extends It.BaseFeatureDataAdapter{constructor(e,t,r){super(e,t,r),this.endpoint=(0,i.readConfObject)(e,"endpoint").uri,this.queryTemplate=(0,i.readConfObject)(e,"queryTemplate"),this.additionalQueryParams=(0,i.readConfObject)(e,"additionalQueryParams"),this.refNamesQueryTemplate=(0,i.readConfObject)(e,"refNamesQueryTemplate"),this.configRefNames=(0,i.readConfObject)(e,"refNames")}async getRefNames(e={}){if(this.refNames)return this.refNames;let t=[];if(this.refNamesQueryTemplate){const r=encodeURIComponent(this.refNamesQueryTemplate),n=await this.querySparql(r,e);t=this.resultsToRefNames(n)}else this.configRefNames&&(t=this.configRefNames);return this.refNames=t,t}getFeatures(e,t={}){return(0,on.ObservableCreate)((async r=>{const n=encodeURIComponent(cn()(this.queryTemplate,e)),{refName:a}=e,o=await this.querySparql(n,t);this.resultsToFeatures(o,a).forEach((e=>{r.next(e)})),r.complete()}),t.signal)}async querySparql(e,t){let r="";this.additionalQueryParams.length&&(r=`&${this.additionalQueryParams.join("&")}`);const n=t?.signal;return(await fetch(`${this.endpoint}?query=${e}${r}`,{headers:{accept:"application/json,application/sparql-results+json"},signal:n})).json()}resultsToRefNames(e){const t=e?.results?.bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((e=>e.refName.value))}resultsToFeatures(e,t){const r=e?.results?.bindings||[];if(!r.length)return[];const n=e.head.vars;["start","end","uniqueId"].forEach((e=>{n.includes(e)||console.error(`Required field ${e} missing from feature data`)}));const a={};r.forEach((e=>{const r=[{}];n.forEach((t=>{if(t in e){const{value:n}=e[t];let a=0;for(;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>r.length-1;)r.push({});r[a][t]=n}})),r.forEach(((e,n)=>{const{uniqueId:o}=e;n<r.length-1&&(r[n+1].parentUniqueId=o),a[o]={data:{...e,uniqueId:o,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0}}}))}));for(const[e,t]of Object.entries(a)){const r=t.data.parentUniqueId;if(delete t.data.parentUniqueId,r){const n=a[r];if(n)n.data.subfeatures||(n.data.subfeatures=[]),n.data.subfeatures.push({...t.data,uniqueId:e}),delete a[e];else{const n=Object.values(a).map((e=>e.data.subfeatures)).filter((e=>!!e)).flat();let o=!1;for(const i of n){if(i&&i.uniqueId===r){i.subfeatures||(i.subfeatures=[]),i.subfeatures.push({...t.data,uniqueId:e}),delete a[e],o=!0;break}i?.subfeatures&&n.push(...i.subfeatures)}o||console.error(`Could not find parentID ${r}`)}}}return Object.keys(a).map((e=>new sn.Z({...a[e].data,uniqueId:e,subfeatures:a[e].data.subfeatures})))}async hasDataForRefName(e,t={}){const r=await this.getRefNames(t);return!(r.length&&!r.includes(e))}freeResources(){}}const un=(0,i.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0});class pn extends a.Z{name="RdfPlugin";install(e){e.addAdapterType((()=>new H.Z({name:"SPARQLAdapter",displayName:"SPARQL adapter",configSchema:un,AdapterClass:dn}))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="SPARQLAdapter",o=(0,J.getFileName)(t);return/\/sparql$/i.test(o)||n===a?{type:a,endpoint:t}:e(t,r,n)}))}}const mn=(0,i.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0});function gn(){return gn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gn.apply(this,arguments)}function fn(e){const{codonTable:t,seq:r,frame:n,bpPerPx:a,region:o,height:i,y:s,reverse:l=!1,theme:d}=e,u=a,p=3-o.start%3,m=(n+p+3)%3,g=r.slice(m),f=[];for(let e=0;e<g.length;e+=3){const r=g.slice(e,e+3),n=l?(0,c.revcom)(r):r,a=t[n]||"";f.push({letter:a,codon:n.toUpperCase()})}const h=1/u*3,y=0===o.start?0:h,b=1/a>=12,v=(o.end-o.start)/a,C=["#d8d8d8","#adadad","#8f8f8f"].reverse();return w.createElement(w.Fragment,null,f.map(((e,t)=>{const r=o.reversed?v-(h*(t+1)+m/u-y):h*t+m/u-y,{letter:a,codon:l}=e;return w.createElement(w.Fragment,{key:`${t}-${a}`},w.createElement("rect",{x:r,y:s,width:b?h:h+.7,height:i,stroke:b?"#555":"none",fill:c.defaultStarts.includes(l)?d?.palette.startCodon:c.defaultStops.includes(l)?d?.palette.stopCodon:C[Math.abs(n)]}),b?w.createElement("text",{x:r+h/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle"},a):null)})))}function hn(e){const{bpPerPx:t,region:r,feature:n,theme:a,height:o,seq:i,y:s}=e,l=1/t>=12,[d,u]=(0,c.bpSpanPx)(n.get("start"),n.get("end"),r,t),p=r.reversed,m=n.get("end")-n.get("start"),g=Math.max((u-d)/m,.8);return w.createElement(w.Fragment,null,i.split("").map(((e,t)=>{const r=a.palette.bases[e.toUpperCase()],n=p?u-(t+1)*g:d+t*g;return w.createElement(w.Fragment,{key:t},w.createElement("rect",{x:n,y:s,width:g,height:o,fill:r?r.main:"#aaa",stroke:l?"#555":"none"}),l?w.createElement("text",{x:n+g/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",fill:r?a.palette.getContrastText(r.main):"black"},e):null)})))}function yn({regions:e,theme:t,features:r=new Map,showReverse:n=!0,showForward:a=!0,showTranslation:o=!0,bpPerPx:i}){const[s]=e,l=(0,T.createJBrowseTheme)(t),d=(0,c.generateCodonTable)(c.defaultCodonTable),[u]=[...r.values()];if(!u)return null;const p=u.get("seq");if(!p)return null;let m=-20;return w.createElement(w.Fragment,null,o&&(s.reversed?n:a)?[2,1,0].map((e=>w.createElement(fn,{key:`translation-${e}`,seq:p,y:m+=20,codonTable:d,frame:e,bpPerPx:i,region:s,theme:l,height:20,reverse:s.reversed}))):null,a?w.createElement(hn,{height:20,y:m+=20,feature:u,region:s,seq:s.reversed?(0,c.complement)(p):p,bpPerPx:i,theme:l}):null,n?w.createElement(hn,{height:20,y:m+=20,feature:u,region:s,seq:s.reversed?p:(0,c.complement)(p),bpPerPx:i,theme:l}):null,o&&(s.reversed?a:n)?[0,-1,-2].map((e=>w.createElement(fn,{key:`rev-translation-${e}`,seq:p,y:m+=20,codonTable:d,frame:e,bpPerPx:i,region:s,theme:l,height:20,reverse:!s.reversed}))):null)}function bn({exportSVG:e,width:t,totalHeight:r,children:n}){return e?w.createElement(w.Fragment,null,n):w.createElement("svg",{"data-testid":"sequence_track",width:t,height:r,style:{width:t,height:r}},n)}const wn=(0,je.observer)((function(e){const{regions:t,bpPerPx:r}=e,[n]=t,a=(n.end-n.start)/r;return w.createElement(bn,gn({},e,{totalHeight:200,width:a}),w.createElement(yn,e))})),vn=(0,i.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0});class Cn extends Hr.default{supportsSVG=!0;getExpandedRegion(e){return{...e,start:Math.max(e.start-3,0),end:e.end+3}}}const Sn=(0,i.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0}),kn=(0,i.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Tn=(0,i.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}},metadataLocation:{description:"Optional metadata file",type:"fileLocation",defaultValue:{uri:"/path/to/fa.metadata.yaml",locationType:"UriLocation"}}},{explicitlyTyped:!0}),xn=(0,i.ConfigurationSchema)("SequenceSearchAdapter",{search:{type:"string",defaultValue:"",description:"Search string or regex to search for"},sequenceAdapter:{type:"frozen",defaultValue:null},searchForward:{type:"boolean",defaultValue:!0},searchReverse:{type:"boolean",defaultValue:!0},caseInsensitive:{type:"boolean",defaultValue:!0}},{explicitlyTyped:!0}),Pn=(0,i.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:vn},{explicitIdentifier:"displayId",explicitlyTyped:!0});class Mn extends a.Z{name="SequencePlugin";install(e){(e=>{e.addRendererType((()=>new Cn({name:"DivSequenceRenderer",ReactComponent:wn,configSchema:vn,pluginManager:e})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"TwoBitAdapter",displayName:"TwoBit adapter",configSchema:mn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(4574),r.e(794),r.e(901)]).then(r.bind(r,90901)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"BgzipFastaAdapter",displayName:"Bgzip-indexed FASTA adapter",configSchema:Sn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5626),r.e(4391)]).then(r.bind(r,24391)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"ChromSizesAdapter",displayName:"Chrom sizes adapter",configSchema:kn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>r.e(2955).then(r.bind(r,92955)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"IndexedFastaAdapter",displayName:"Indexed FASTA adapter",configSchema:Tn,adapterMetadata:{hiddenFromGUI:!0},getAdapterClass:()=>Promise.all([r.e(6553),r.e(4574),r.e(5626),r.e(2673)]).then(r.bind(r,22673)).then((e=>e.default))})))})(e),(e=>{e.addAdapterType((()=>new H.Z({name:"SequenceSearchAdapter",displayName:"Sequence search adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:xn,getAdapterClass:()=>r.e(5490).then(r.bind(r,5490)).then((e=>e.default))})))})(e),(e=>{e.addTrackType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:d.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:'optional track name, otherwise uses the "Reference sequence (assemblyName)"',defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},formatAbout:(0,i.ConfigurationSchema)("FormatAbout",{config:{type:"frozen",description:"formats configuration in about dialog",defaultValue:{},contextVariable:["config"]},hideUris:{type:"boolean",defaultValue:!1}})},{preProcessSnapshot:t=>{const r=JSON.parse(JSON.stringify(t)),n=new Set,{displays:a=[]}=r;return"placeholderId"!==r.trackId&&(a.forEach((e=>e&&n.add(e.type))),e.getTrackType(r.type).displayTypes.forEach((e=>{n.has(e.name)||a.push({displayId:`${r.trackId}-${e.name}`,type:e.name})}))),{...r,displays:a}},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:e=>({addDisplayConf(t){const{type:r}=t;if(!r)throw new Error(`unknown display type ${r}`);const n=e.displays.find((e=>e&&e.displayId===t.displayId));if(n)return n;const a=e.displays.push(t);return e.displays[a-1]}})})}(e);return new or.Z({name:"ReferenceSequenceTrack",displayName:"Reference sequence track",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const e=function(e){return d.types.compose("LinearReferenceSequenceDisplay",$t.fV,d.types.model({type:d.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,i.ConfigurationReference)(e),showForward:!0,showReverse:!0,showTranslation:!0})).views((e=>{const{renderProps:t}=e;return{renderProps(){const{showForward:r,rpcDriverName:n,showReverse:a,showTranslation:o}=e;return{...t(),config:e.configuration.renderer,rpcDriverName:n,showForward:r,showReverse:a,showTranslation:o}}}})).views((e=>({regionCannotBeRendered(){const t=(0,c.getContainingView)(e);return t?.bpPerPx>=1?"Zoom in to see sequence":void 0},get rendererTypeName(){return e.configuration.renderer.type}}))).actions((e=>({toggleShowForward(){e.showForward=!e.showForward},toggleShowReverse(){e.showReverse=!e.showReverse},toggleShowTranslation(){e.showTranslation=!e.showTranslation},afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((()=>{const t=(0,c.getContainingView)(e);if(t?.bpPerPx>=1)e.setHeight(50);else{const{showTranslation:t,showReverse:r,showForward:n}=e,a=(r&&t?60:0)+(n&&t?60:0),o=r?20:0,i=n?20:0;e.setHeight(a+o+i)}})))}}))).views((e=>({trackMenuItems:()=>[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:()=>e.toggleShowForward()},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:()=>e.toggleShowReverse()},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:()=>e.toggleShowTranslation()}]})))}(Pn);return new K.DisplayType({name:"LinearReferenceSequenceDisplay",configSchema:Pn,stateModel:e,displayName:"Reference sequence display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:$t.qb})}))})(e),(e=>{e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="TwoBitAdapter",o=(0,J.getFileName)(t),i={type:a,twoBitLocation:t};return/\.2bit$/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="IndexedFastaAdapter",o=(0,J.getFileName)(t),i={type:a,fastaLocation:t,faiLocation:r||(0,J.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t))),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="BgzipFastaAdapter",o=(0,J.getFileName)(t),i={type:a,faiLocation:(0,J.makeIndex)(t,".fai"),gziLocation:(0,J.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)))})(e)}}var En=r(19618),Rn=r(92368);const An=(0,je.observer)((function({text:e,x:t,y:r,region:n,reversed:a,bpPerPx:o,exportSVG:i,feature:s,viewParams:l,color:u="black",fontHeight:p=11,featureWidth:m=0,allowedWidthExpansion:g=0,displayModel:f={}}){const h=m+g,y=(0,c.measureText)(e,p),b=(0,d.isStateTreeNode)(f)&&(0,d.isAlive)(f)&&!i?(0,c.getViewParams)(f):l,v=a?b.end:b.start,[C,S]=(0,w.useState)(i),k=(0,Rn.Z)();if((0,w.useEffect)((()=>{S(!0)}),[]),(0,d.isStateTreeNode)(n)&&!(0,d.isAlive)(n))return null;const T=n.start,x=n.end,P=s.get("start"),M=s.get("end"),E=y*o;return v<x&&v>T&&P<v&&v+E<M?t=b.offsetPx:P<v&&v+E<M&&v+E>T&&v+E<x&&(t=b.offsetPx1),C?w.createElement("text",{x:t,y:r+p,fill:"#f0f"===u?(0,c.stripAlpha)(k.palette.text.primary):u,fontSize:p},y>h?`${e.slice(0,h/(.6*p))}...`:e):null})),In=An;function Fn(){return Fn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fn.apply(this,arguments)}const Nn=(0,je.observer)((function(e){const{feature:t,rootLayout:r,config:n,name:a,description:o,shouldShowName:s,shouldShowDescription:l}=e,c=r.getSubRecord(String(t.id()));if(!c)return null;const{GlyphComponent:d}=c.data||{};return w.createElement("g",null,w.createElement(d,Fn({featureLayout:c},e)),s?w.createElement(In,Fn({text:a,x:r.getSubRecord("nameLabel")?.absolute.left||0,y:r.getSubRecord("nameLabel")?.absolute.top||0,color:(0,i.readConfObject)(n,["labels","nameColor"],{feature:t}),featureWidth:c.width},e)):null,l?w.createElement(In,Fn({text:o,x:r.getSubRecord("descriptionLabel")?.absolute.left||0,y:r.getSubRecord("descriptionLabel")?.absolute.top||0,color:(0,i.readConfObject)(n,["labels","descriptionColor"],{feature:t}),featureWidth:c.width},e)):null)}));function Ln(){return Ln=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ln.apply(this,arguments)}function Dn({rect:e,region:t,bpPerPx:r,...n}){if(!e)return null;const[a,o,i,s]=e,[l,d]=(0,c.bpSpanPx)(a,i,t,r),u=Math.round(o),p=(t.end-t.start)/r,m=Math.round(s-o),g=d-l;if(l+g<0)return null;const f=Math.max(l,0),h=f-l,y=Math.max(1,Math.min(g-h,p));return w.createElement("rect",Ln({x:f-2,y:u-2,width:y+4,height:m+4},n))}const Bn=(0,je.observer)((function({displayModel:e={},blockKey:t,region:r,bpPerPx:n,movedDuringLastMouseDown:a,...o}){const{selectedFeatureId:i,featureIdUnderMouse:s,contextMenuFeature:l}=e,c=s||l?.id(),[d,u]=(0,w.useState)(!1);function p(e){const{onFeatureMouseOut:t}=o;if(t&&c)return t(e,c)}function m(e){const{onFeatureMouseOver:t}=o;if(t&&c)return t(e,c)}return(0,w.useEffect)((()=>{u(!0)}),[]),d?w.createElement(w.Fragment,null,c?w.createElement(Dn,{rect:e.getFeatureByID?.(t,c),region:r,bpPerPx:n,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){const{onFeatureMouseDown:t}=o;if(t&&c)return t(e,c)},onMouseEnter:function(e){const{onFeatureMouseEnter:t}=o;if(t&&c)return t(e,c)},onMouseOut:p,onMouseOver:m,onMouseUp:function(e){const{onFeatureMouseUp:t}=o;if(t&&c)return t(e,c)},onMouseLeave:function(e){const{onFeatureMouseLeave:t}=o;if(t&&c)return t(e,c)},onMouseMove:function(e){const{onFeatureMouseMove:t}=o;if(t&&c)return t(e,c)},onClick:function(e){if(a)return;const{onFeatureClick:t}=o;return t&&c?(e.stopPropagation(),t(e,c)):void 0},onContextMenu:function(e){const{onFeatureContextMenu:t}=o;if(t&&c)return t(e,c)},onFocus:m,onBlur:p,"data-testid":c}):null,i?w.createElement(Dn,{rect:e.getFeatureByID?.(t,i),region:r,bpPerPx:n,stroke:"#00b8ff",fill:"none"}):null):null})),Vn=(0,je.observer)((function({feature:e,featureLayout:t,config:r,region:n}){const a=e.get("strand"),o=n.reversed?-1:1,s=7*a*o,{left:l=0,top:d=0,width:u=0,height:p=0}=t.absolute,m=(0,i.readConfObject)(r,"color2",{feature:e}),g=(0,Rn.Z)(),f="#f0f"===m?(0,c.stripAlpha)(g.palette.text.secondary):m,h=a*o==-1?l:a*o==1?l+u:null,y=d+p/2;return h?w.createElement(w.Fragment,null,w.createElement("line",{x1:h,x2:h+s,y1:y,y2:y,stroke:f}),w.createElement("polygon",{points:[[h+s/2,y-2.5],[h+s/2,y+2.5],[h+s,y]].toString(),stroke:f,fill:f})):null})),zn=(0,je.observer)((function(e){const{feature:t,region:r,config:n,featureLayout:a,bpPerPx:o,topLevel:s}=e,{start:l,end:c}=r,d=(c-l)/o,u=(t.get("end")-t.get("start"))/o,{left:p=0}=a.absolute;let{top:m=0,height:g=0}=a.absolute;if(p+u<0)return null;Qn(t)&&(m+=.175*g,g*=.65);const f=Math.max(p,0),h=f-p,y=Math.max(2,Math.min(u-h,d));return t.parent()&&"intron"===t.get("type")?null:w.createElement(w.Fragment,null,s?w.createElement(Vn,e):null,w.createElement("rect",{"data-testid":`box-${t.id()}`,x:f,y:m,width:y,height:g,fill:Qn(t)?(0,i.readConfObject)(n,"color3",{feature:t}):(0,i.readConfObject)(n,"color1",{feature:t}),stroke:(0,i.readConfObject)(n,"outline",{feature:t})}))}));function On(){return On=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},On.apply(this,arguments)}const Zn=(0,je.observer)((function(e){const{feature:t,featureLayout:r,selected:n,config:a,subfeatures:o=t.get("subfeatures")}=e,s=(0,Rn.Z)(),l=(0,i.readConfObject)(a,"color2",{feature:t}),d="#f0f"===l?(0,c.stripAlpha)(s.palette.text.secondary):l,{left:u=0,top:p=0,width:m=0,height:g=0}=r.absolute,f=p+g/2;return w.createElement(w.Fragment,null,w.createElement("line",{"data-testid":t.id(),x1:u,y1:f,y2:f,x2:u+m,stroke:d}),o?.map((t=>{const a=String(t.id()),o=r.getSubRecord(a);if(!o)return null;const{GlyphComponent:i}=o.data||{};return w.createElement(i,On({key:`glyph-${a}`},e,{feature:t,topLevel:!1,featureLayout:o,selected:n}))})),w.createElement(Vn,e))}));function jn(){return jn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jn.apply(this,arguments)}function Wn(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function $n(e,t){let r=e.get("subfeatures");if(!r||0===r.length)return[];const n=r.some((e=>Wn(e))),a=["mRNA","transcript"].includes(e.get("type"));return(!n&&a||(0,i.readConfObject)(t,"impliedUTRs"))&&(r=function(e,t){const r=[...t];let n,a,o=1/0,i=-1/0;const s=[];for(const t of r){const r=t.get("type");/^cds/i.test(r)?(o>t.get("start")&&(o=t.get("start")),i<t.get("end")&&(i=t.get("end"))):/exon/i.test(r)?s.push(t):Wn(t)&&(n=t.get("start")===e.get("start"),a=t.get("end")===e.get("end"))}if(!(s.length&&o<1/0&&i>-1/0))return r;s.sort(((e,t)=>e.get("start")-t.get("start")));const l=e.get("strand");let d,u;if(!n)for(let t=0;t<s.length&&(d=s[t].get("start"),!(d>=o));t++){u=o>s[t].get("end")?s[t].get("end"):o;const n=l>=0?"five_prime_UTR":"three_prime_UTR";r.unshift(new c.SimpleFeature({parent:e,id:`${e.id()}_${n}_${t}`,data:{start:d,end:u,strand:l,type:n}}))}if(!a)for(let t=s.length-1;t>=0&&(u=s[t].get("end"),!(u<=i));t--){d=i<s[t].get("start")?s[t].get("start"):i;const n=l>=0?"three_prime_UTR":"five_prime_UTR";r.push(new c.SimpleFeature({parent:e,id:`${e.id()}_${n}_${t}`,data:{start:d,end:u,strand:l,type:n}}))}return r}(e,r)),r.filter((e=>function(e,t){return function(e="subParts",t){let r=(0,i.readConfObject)(t,e);return"string"==typeof r&&(r=r.split(/\s*,\s*/)),e=>r.map((e=>e.toLowerCase())).includes(e.get("type").toLowerCase())}("subParts",t)(e)}(e,t)))}const Hn=(0,je.observer)((function(e){const{feature:t,config:r}=e,n=$n(t,r);return w.createElement(Zn,jn({},e,{subfeatures:n}))}));Hn.layOut=({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o})=>{const i=Yn({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o});return Kn({layout:i,subfeatures:$n(t,a),bpPerPx:r,reversed:n,config:a,extraGlyphs:o}),i};const Gn=Hn;function qn(){return qn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qn.apply(this,arguments)}const Un=(0,je.observer)((function(e){const{feature:t,featureLayout:r,selected:n}=e;return w.createElement(w.Fragment,null,t.get("subfeatures")?.map((t=>{const a=String(t.id()),o=r.getSubRecord(a);if(!o)return null;const{GlyphComponent:i}=o.data||{};return w.createElement(i,qn({key:`glyph-${a}`},e,{feature:t,featureLayout:o,selected:n}))})))}));Un.layOut=({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o})=>{const s=Yn({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o}),l=(0,i.readConfObject)(a,"displayMode");if("reducedRepresentation"!==l){let e=0;t.get("subfeatures")?.forEach((t=>{const c=Jn(t,o),d=(0,i.readConfObject)(a,"height",{feature:t});(c.layOut||Xn)({layout:s,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o}).move(0,e),e+="collapse"===l?0:("compact"===l?d/3:d)+2}))}return s};const _n=Un;function Jn(e,t){const r=e.get("type"),n=e.get("subfeatures");if(n&&"CDS"!==r){const t=n.find((e=>!!e.get("subfeatures")));return["mRNA","transcript","primary_transcript"].includes(r)&&n.some((e=>"CDS"===e.get("type")))?Gn:!e.parent()&&t?_n:Zn}return t?.find((t=>t.validator(e)))?.glyph||zn}function Xn({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o}){const s=(0,i.readConfObject)(a,"displayMode"),l=Yn({layout:e,feature:t,bpPerPx:r,reversed:n,config:a,extraGlyphs:o});return"reducedRepresentation"!==s&&Kn({layout:l,subfeatures:t.get("subfeatures")||[],bpPerPx:r,reversed:n,config:a,extraGlyphs:o}),l}function Yn(e){const{layout:t,feature:r,bpPerPx:n,reversed:a,config:o,extraGlyphs:s}=e,l=(0,i.readConfObject)(o,"displayMode"),c="reducedRepresentation"===l?zn:Jn(r,s),d=r.parent();let u=0;d&&(u=(a?d.get("end")-r.get("end"):r.get("start")-d.get("start"))/n);const p=(0,i.readConfObject)(o,"height",{feature:r}),m=(r.get("end")-r.get("start"))/n,g=t.parent,f=g?g.top:0;return t.addChild(String(r.id()),u,"collapse"===l?0:f,Math.max(m,1),"compact"===l?p/2:p,{GlyphComponent:c})}function Kn(e){const{layout:t,subfeatures:r,bpPerPx:n,reversed:a,config:o,extraGlyphs:i}=e;r.forEach((e=>{(Jn(e,i).layOut||Xn)({layout:t,feature:e,bpPerPx:n,reversed:a,config:o,extraGlyphs:i})}))}function Qn(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function ea(){return ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ea.apply(this,arguments)}function ta(e){const{feature:t,detectRerender:r,bpPerPx:n,region:a,config:o,displayMode:s,layout:l,extraGlyphs:d}=e;r?.();const{reversed:u}=a,p=t.get(u?"end":"start"),m=(0,c.bpToPx)(p,a,n),g="collapsed"!==s,f=new En.SceneGraph("root",0,0,0,0),h=(Jn(t,d).layOut||Xn)({layout:f,feature:t,bpPerPx:n,reversed:u,config:o,extraGlyphs:d});let y=!1,b=!1,v="",C="",S=0,k=0;if(g){const e=(0,i.readConfObject)(o,"showLabels"),r=(0,i.readConfObject)(o,"showDescriptions");S=(0,i.readConfObject)(o,["labels","fontSize"],{feature:t}),k=(0,i.readConfObject)(o,"maxFeatureGlyphExpansion")||0,v=String((0,i.readConfObject)(o,["labels","name"],{feature:t})||""),y=/\S/.test(v)&&e;const n=e=>{const t=f.width+k,r=(0,c.measureText)(e,S);return Math.round(Math.min(r,t))};if(C=String((0,i.readConfObject)(o,["labels","description"],{feature:t})||""),b=/\S/.test(C)&&r,y&&f.addChild("nameLabel",0,h.bottom,n(v),S),b){const e=y?f.getSubRecord("nameLabel"):h;f.addChild("descriptionLabel",0,e.bottom,n(C),S)}}const T=l.addRect(t.id(),t.get("start"),t.get("start")+f.width*n+3*n,f.height+5);return null===T?null:(f.move(m,T),w.createElement(Nn,ea({rootLayout:f,name:v,shouldShowName:y,description:C,shouldShowDescription:b,fontHeight:S,allowedWidthExpansion:k,reversed:a.reversed,topLevel:!0},e)))}const ra=(0,je.observer)((e=>{const{features:t=new Map,isFeatureDisplayed:r}=e;return w.createElement(w.Fragment,null,[...t.values()].filter((e=>!r||r(e))).map((t=>w.createElement(ta,ea({key:t.id(),feature:t},e)))))})),na=(0,je.observer)((function(e){const{layout:t,blockKey:r,regions:n=[],bpPerPx:a,config:o,displayModel:s={},exportSVG:l,featureDisplayHandler:c,onMouseOut:d,onMouseDown:u,onMouseLeave:p,onMouseEnter:m,onMouseOver:g,onMouseMove:f,onMouseUp:h,onClick:y}=e,[b]=n,v=(b.end-b.start)/a,C=(0,i.readConfObject)(o,"displayMode"),S=(0,w.useRef)(null),[k,T]=(0,w.useState)(!1),[x,P]=(0,w.useState)(0),[M,E]=(0,w.useState)(!1),R=(0,w.useCallback)((e=>(T(!0),E(!1),u?.(e))),[u]),A=(0,w.useCallback)((e=>(T(!1),h?.(e))),[h]),I=(0,w.useCallback)((e=>{if(!S.current)return;k&&E(!0);const{left:t,top:n}=S.current.getBoundingClientRect(),o=e.clientX-t,i=e.clientY-n,l=b.reversed?v-o:o,c=b.start+a*l,d=s.getFeatureOverlapping?.(r,c,i);f&&f(e,d)}),[r,a,k,f,b.reversed,b.start,s,v]),F=(0,w.useCallback)((e=>{M||y?.(e)}),[M,y]);return(0,w.useEffect)((()=>{P(t.getTotalHeight())}),[t]),l?w.createElement(ra,ea({displayMode:C,isFeatureDisplayed:c,region:b},e)):w.createElement("svg",{ref:S,"data-testid":"svgfeatures",width:v,height:x+100,onMouseDown:R,onMouseUp:A,onMouseEnter:m,onMouseLeave:p,onMouseOver:g,onMouseOut:d,onMouseMove:I,onClick:F},w.createElement(ra,ea({displayMode:C,region:b,movedDuringLastMouseDown:M,isFeatureDisplayed:c},e)),w.createElement(Bn,ea({},e,{region:b,movedDuringLastMouseDown:M})))})),aa=(0,i.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"#f0f",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,i.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"#f0f",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:12,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:d.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:1200},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0});class oa extends Pr.default{supportsSVG=!0}class ia extends a.Z{name="SVGPlugin";install(e){e.addRendererType((()=>new oa({name:"SvgFeatureRenderer",ReactComponent:na,configSchema:aa,pluginManager:e})))}}var sa=r(56382),la=r(42207);const ca=(0,w.lazy)((()=>r.e(7045).then(r.bind(r,77045))));class da extends a.Z{name="GCContentPlugin";install(e){(e=>{e.addAdapterType((()=>new H.Z({name:"GCContentAdapter",displayName:"GC content adapter",adapterMetadata:{hiddenFromGUI:!0},configSchema:(0,i.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:{type:"frozen",defaultValue:null},windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{explicitlyTyped:!0}),getAdapterClass:()=>r.e(6548).then(r.bind(r,86548)).then((e=>e.default))})))})(e),(e=>{e.addDisplayType((()=>{const t=function(e){return(0,i.ConfigurationSchema)("LinearGCContentDisplay",{windowSize:{type:"number",defaultValue:100},windowDelta:{type:"number",defaultValue:100}},{baseConfiguration:e.getDisplayType("LinearWiggleDisplay").configSchema,explicitlyTyped:!0})}(e),r=function(e,t){return d.types.compose("LinearGCContentDisplay",(0,la.LT)(e,t),d.types.model({type:d.types.literal("LinearGCContentDisplay"),windowSize:d.types.maybe(d.types.number),windowDelta:d.types.maybe(d.types.number)})).actions((e=>({setGCContentParams({windowSize:t,windowDelta:r}){e.windowSize=t,e.windowDelta=r}}))).views((e=>({get windowSizeSetting(){return e.windowSize??(0,i.getConf)(e,"windowSize")},get windowDeltaSetting(){return e.windowDelta??(0,i.getConf)(e,"windowDelta")}}))).views((e=>{const{trackMenuItems:t,renderProps:r}=e;return{trackMenuItems:()=>[...t(),{label:"Change GC parameters",onClick:()=>{(0,c.getSession)(e).queueDialog((t=>[ca,{model:e,handleClose:t}]))}}],renderProps(){const t=(0,i.getConf)(e.parentTrack,"adapter");return{...r(),adapterConfig:{type:"GCContentAdapter",sequenceAdapter:t,windowSize:e.windowSizeSetting,windowDelta:e.windowDeltaSetting}}}}}))}(e,t);return new K.DisplayType({name:"LinearGCContentDisplay",configSchema:t,stateModel:r,displayName:"GC content display",trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:la.Xl})}))})(e)}}var ua=r(53877),pa=r(17370),ma=r(88826),ga=r(32339),fa=r(78781),ha=r(81799),ya=r(49140),ba=r(84535),wa=r(92292);function va(e,{DataCellReactComponent:t=null,FilterModelType:r=null,compare:n,displayName:a,categoryName:o}){return d.types.model(`ColumnDataType${e}`,{type:d.types.literal(e)}).volatile((()=>({DataCellReactComponent:t,FilterModelType:r,displayName:a||e,categoryName:o}))).views((()=>({compare:n,get hasFilter(){return!!r}})))}const Ca=(0,Oe.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Sa=(0,je.observer)((function({filterModel:e}){const{classes:t}=Ca(),r=(0,ba.getEnumerationValues)((0,ba.getSubType)((0,ba.getPropertyType)((0,d.getPropertyMembers)(e),"operation")));return w.createElement(w.Fragment,null,w.createElement(ga.Z,{value:e.operation,onChange:t=>e.setOperation(String(t.target.value))},r.map((e=>w.createElement(fa.Z,{key:e,value:e},e))))," ",w.createElement(C.Z,{label:"range",placeholder:"chr1:100-200",error:e.locStringIsInvalid,value:e.locString,onChange:t=>e.setLocString(t.target.value),className:t.textFilterControl,InputProps:{endAdornment:w.createElement(ha.Z,{className:t.textFilterControlAdornment,position:"end"},w.createElement(ya.Z,{"aria-label":"clear filter",onClick:()=>e.setLocString("")},w.createElement(wa.Z,null)))}}))})),ka=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],Ta={"overlaps with":(e,t)=>e.refName===t.refName&&(0,c.doesIntersect2)(e.start,e.end,t.start,t.end),"contained within":(e,t)=>e.refName===t.refName&&(0,c.isContainedWithin)(e.start,e.end,t.start,t.end),"fully contains":(e,t)=>e.refName===t.refName&&(0,c.isContainedWithin)(t.start,t.end,e.start,e.end),"does not overlap":(e,t)=>!Ta["overlaps with"](e,t),"not contained within":(e,t)=>!Ta["contained within"](e,t),"does not contain":(e,t)=>!Ta["fully contains"](e,t)},xa=d.types.model("ColumnLocStringFilter",{type:d.types.literal("LocString"),columnNumber:d.types.integer,locString:"",operation:d.types.optional(d.types.enumeration(ka),ka[0])}).views((e=>({get locStringIsInvalid(){if(e.locString){const e=this.parsedLocString;return!e||""===e.refName||"number"!=typeof e.start||"number"!=typeof e.end||e.start>e.end}return!1},get parsedLocString(){const t=(0,c.getSession)(e),r=(0,d.getParent)(e,3).spreadsheet,{assemblyName:n}=r;try{return(0,c.parseLocString)(e.locString,(e=>t.assemblyManager.isValidRefName(e,n)))}catch(e){return}}}))).views((e=>({get predicate(){const{locString:t,locStringIsInvalid:r,parsedLocString:n,operation:a,columnNumber:o}=e;return t&&!r&&n?function(e,t){const{cellsWithDerived:r}=t,i=r[o];if(!i?.text||!i.extendedData)return!1;const s=i.extendedData;if(!s.refName)return!1;const l=Ta[a];if(!l)throw new Error(`"${a}" not implemented in location filter`);return l(s,n)}:function(){return!0}}}))).actions((e=>({setLocString(t){e.locString=t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:Sa}))),Pa=va("LocString",{categoryName:"Location",displayName:"Full location",compare:(e,t)=>(0,c.compareLocs)(e.extendedData,t.extendedData),FilterModelType:xa,DataCellReactComponent:(0,je.observer)((function({cell:e,columnNumber:t,spreadsheet:r}){return w.createElement("a",{onClick:async t=>{t.preventDefault();const n=(0,c.getSession)(r);try{await async function(e,t,r){const n=(0,c.getSession)(e),{assemblyName:a}=e,{id:o}=(0,d.getParent)(e),i=`${o}_${a}`;let s=n.views.find((e=>e.id===i));s||(s=n.addView("LinearGenomeView",{id:i})),await s.navToLocString(r.text,a)}(r,0,e)}catch(e){console.error(e),n.notify(`${e}`,"error")}},title:"open a new linear genome view here",href:"#link"},e.text)}))}),Ma=["equals","contains","does not contain","does not equal","starts with","ends with"],Ea={contains:(e,t)=>e.toLowerCase().includes(t),equals:(e,t)=>e.toLowerCase()===t,"starts with":(e,t)=>e.toLowerCase().startsWith(t),"ends with":(e,t)=>{const r=e.toLowerCase().indexOf(t);return-1!==r&&r===e.length-t.length},"does not contain":(e,t)=>!Ea.contains(e,t),"does not equal":(e,t)=>!Ea.equals(e,t)},Ra=(0,Oe.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Aa=(0,je.observer)((({filterModel:e})=>{const{classes:t}=Ra(),r=(0,ba.getEnumerationValues)((0,ba.getSubType)((0,ba.getPropertyType)((0,d.getPropertyMembers)(e),"operation")));return w.createElement(w.Fragment,null,w.createElement(ga.Z,{value:e.operation,onChange:t=>{e.setOperation(String(t.target.value))}},r.map((e=>w.createElement(fa.Z,{key:e,value:e},e))))," ",w.createElement(C.Z,{label:"text",value:e.stringToFind,onChange:t=>e.setString(t.target.value),className:t.textFilterControl,InputProps:{endAdornment:w.createElement(ha.Z,{className:t.textFilterControlAdornment,position:"end"},w.createElement(ya.Z,{"aria-label":"clear filter",onClick:()=>e.setString("")},w.createElement(wa.Z,null)))}}))})),Ia=d.types.model("ColumnTextFilter",{type:d.types.literal("Text"),columnNumber:d.types.integer,stringToFind:"",operation:d.types.optional(d.types.enumeration(Ma),Ma[0])}).views((e=>({get predicate(){const{stringToFind:t,columnNumber:r,operation:n}=e;if(!t)return function(){return!0};const a=t.toLowerCase();return function(e,t){const{cellsWithDerived:o}=t,i=o[r];if(!i?.text)return!1;const s=Ea[n];if(!s)throw new Error(`"${n}" not implemented in location filter`);return s(i.text,a)}}}))).actions((e=>({setString(t){e.stringToFind=t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:Aa}))),Fa=va("Text",{compare:(e,t)=>e.text.localeCompare(t.text),FilterModelType:Ia}),Na=va("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:(e,t)=>e.text.localeCompare(t.text),FilterModelType:d.types.compose(Ia,d.types.model({type:d.types.literal("LocRef")}))}),La=["equals","greater than","less than","between","not between"],Da={equals:(e,t)=>e===t,"greater than":(e,t)=>e>t,"less than":(e,t)=>e<t,between:(e,t,r)=>e>t&&void 0!==r&&e<r,"not between":(e,t,r)=>!Da.between(e,t,r)},Ba=(0,Oe.ZL)()({textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}),Va=(0,je.observer)((({filterModel:e})=>{const{classes:t}=Ba(),r=La;return w.createElement(w.Fragment,null,w.createElement(ga.Z,{value:e.operation,onChange:t=>e.setOperation(String(t.target.value))},r.map((e=>w.createElement(fa.Z,{key:e,value:e},e))))," ",w.createElement(C.Z,{label:"number",placeholder:"123",type:"number",error:e.firstNumberIsInvalid,defaultValue:e.firstNumber,onChange:t=>{e.setFirstNumber(parseFloat(t.target.value))},className:t.textFilterControl}),"between"!==e.operation&&"not between"!==e.operation?null:w.createElement(w.Fragment,null," and ",w.createElement(C.Z,{label:"number",placeholder:"456",type:"number",error:e.secondNumberIsInvalid,defaultValue:e.secondNumber,onChange:t=>e.setSecondNumber(parseFloat(t.target.value)),className:t.textFilterControl})))})),za=d.types.model("ColumnNumberFilter",{type:d.types.literal("Number"),columnNumber:d.types.integer,firstNumber:d.types.maybe(d.types.number),secondNumber:d.types.maybe(d.types.number),operation:d.types.optional(d.types.enumeration(La),La[0])}).views((e=>({get predicate(){if("number"!=typeof e.firstNumber)return function(){return!0};const{firstNumber:t,secondNumber:r,operation:n,columnNumber:a}=e;return function(e,o){const{cellsWithDerived:i}=o,s=i[a];if(!s?.text)return!1;const l=parseFloat(s.text);if("number"!=typeof l)return!1;const c=Da[n];if(!c)throw new Error(`"${n}" not implemented in location filter`);return c(l,t,r)}}}))).actions((e=>({setFirstNumber(t){e.firstNumber=Number.isNaN(t)||"number"!=typeof t?void 0:t},setSecondNumber(t){e.secondNumber=Number.isNaN(t)||"number"!=typeof t?void 0:t},setOperation(t){e.operation=t}}))).volatile((()=>({ReactComponent:Va}))),Oa={Number:va("Number",{compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:za}),Text:Fa,LocString:Pa,LocRef:Na,LocStart:va("LocStart",{categoryName:"Location",displayName:"Start",compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:d.types.compose(za,d.types.model({type:d.types.literal("LocStart")}))}),LocEnd:va("LocEnd",{categoryName:"Location",displayName:"End",compare:(e,t)=>parseFloat(e.text)-parseFloat(t.text),FilterModelType:d.types.compose(za,d.types.model({type:d.types.literal("LocEnd")}))})},Za=Object.values(Oa),ja=d.types.union(...Za),Wa=d.types.union(...Za.map((e=>{const{FilterModelType:t}=e.create({type:e.properties.type.value});return t})).filter((e=>!!e))),$a=d.types.model("SpreadsheetCell",{text:d.types.string,extendedData:d.types.maybe(d.types.frozen())}),Ha=d.types.model("SpreadsheetRow",{id:d.types.identifier,cells:d.types.array($a),extendedData:d.types.maybe(d.types.frozen()),isSelected:!1}).actions((e=>({toggleSelect(){e.isSelected=!e.isSelected},unSelect(){e.isSelected=!1},select(){e.isSelected=!0},setExtendedData(t){e.extendedData=t}}))).views((e=>({get cellsWithDerived(){const{columns:t}=(0,d.getParent)(e,3);let r=0;return t.map((t=>t.isDerived?t.expr.evalSync({row:e}):e.cells[r++]))}}))),Ga=d.types.model("StaticRowSet",{isLoaded:d.types.literal(!0),rows:d.types.array(Ha)}).views((e=>({get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){const t=(0,d.getParent)(e);return[...e.rows].sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((e=>e.isSelected))},get selectedFilteredRows(){const t=(0,d.getParent)(e),r=(0,d.getParent)(t),{filterControls:n}=r;return this.selectedRows.filter((e=>n.rowPassesFilters(t,e)))},get sortedFilteredRows(){const t=(0,d.getParent)(e),r=(0,d.getParent)(t),{filterControls:n}=r;return e.rows.filter((e=>n.rowPassesFilters(t,e))).sort(t.rowSortingComparisonFunction)}}))).actions((e=>({unselectAll(){e.rows.forEach((e=>e.unSelect()))}}))),qa=Ga,Ua=d.types.model("ColumnDefinition",{name:d.types.maybe(d.types.string),dataType:d.types.optional(ja,(()=>({type:"Text"}))),isDerived:!1,derivationFunctionText:d.types.maybe(d.types.string)}).views((e=>({get expr(){if(e.isDerived)return(0,ma.P)(String(e.derivationFunctionText),(0,c.getEnv)(e).pluginManager.jexl)}}))),_a=d.types.model("Spreadsheet",{rowSet:d.types.optional(qa,(()=>qa.create())),columns:d.types.array(Ua),columnDisplayOrder:d.types.array(d.types.number),hasColumnNames:!1,sortColumns:d.types.array(d.types.model("SortColumns",{columnNumber:d.types.number,descending:!1}).actions((e=>({switchDirection(){e.descending=!e.descending}})))),assemblyName:d.types.maybe(d.types.string)}).volatile((()=>({defaultDataType:Oa.Text,rowMenuPosition:null,isLoaded:!1}))).views((e=>({get initialized(){const t=(0,c.getSession)(e),r=e.assemblyName;return!!r&&t.assemblyManager.get(r)?.initialized},get hideRowSelection(){return(0,d.getParent)(e).hideRowSelection},get dataTypeChoices(){return Object.keys(Oa).map((e=>{const t=Oa[e].create({type:e}),{displayName:r,categoryName:n}=t;return{typeName:e,displayName:r,categoryName:n}}))},rowSortingComparisonFunction(t,r){for(const{columnNumber:n,descending:a}of e.sortColumns){const{dataType:o}=e.columns[n],i=o.compare(t.cellsWithDerived[n],r.cellsWithDerived[n]);if(i)return a?-i:i}return 0}}))).actions((e=>({afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((async()=>{const t=(0,c.getSession)(e),{assemblyManager:r}=t;try{e.assemblyName&&(await r.waitForAssembly(e.assemblyName),this.setLoaded(!0))}catch(r){t.notify(`failed to load assembly ${e.assemblyName} ${r}`,"error")}})))},setLoaded(t){e.isLoaded=t},setRowMenuPosition(t){e.rowMenuPosition=t},setSortColumns(t){t&&(e.sortColumns=t)},setColumnType(t,r){e.columns[t].dataType={type:r}},unselectAll:()=>e.rowSet.unselectAll()}))),Ja=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],Xa={CSV:()=>r.e(3285).then(r.bind(r,23285)).then((e=>e.parseCsvBuffer)),TSV:()=>r.e(3285).then(r.bind(r,23285)).then((e=>e.parseTsvBuffer)),VCF:()=>r.e(1564).then(r.bind(r,51564)).then((e=>e.parseVcfBuffer)),BED:()=>r.e(5696).then(r.bind(r,5696)).then((e=>e.parseBedBuffer)),BEDPE:()=>r.e(5696).then(r.bind(r,5696)).then((e=>e.parseBedPEBuffer)),"STAR-Fusion":()=>r.e(8180).then(r.bind(r,18180)).then((e=>e.parseSTARFusionBuffer))},Ya=new RegExp(`\\.(${Ja.join("|")})(\\.gz)?$`,"i"),Ka=d.types.model("SpreadsheetImportWizard",{fileType:d.types.optional(d.types.enumeration(Ja),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:d.types.maybe(d.types.string)}).volatile((()=>({fileTypes:Ja,fileSource:void 0,error:void 0,loading:!1}))).views((e=>({get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return(0,d.getParent)(e).readyToDisplay},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName(t,r){const{assemblyManager:n}=(0,c.getSession)(e);return!!r&&n.isValidRefName(t,r)}}))).actions((e=>({setSelectedAssemblyName(t){e.selectedAssemblyName=t},setFileSource(t){if(e.fileSource=t,e.error=void 0,e.fileSource){const t=e.fileName;if(t){const r=Ya.exec(t)?.[1];r&&(e.fileType="tsv"===r&&t.includes("star-fusion")?"STAR-Fusion":r.toUpperCase())}}},toggleHasColumnNameLine(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber(t){t>0&&(e.columnNameLineNumber=t)},setFileType(t){e.fileType=t},setError(t){console.error(t),e.loading=!1,e.error=t},setLoaded(){e.loading=!1,e.error=void 0},cancelButton(){e.error=void 0,(0,d.getParent)(e).setDisplayMode()},async import(t){if(!e.fileSource)return;if(e.loading)throw new Error("Cannot import, load already in progress");e.selectedAssemblyName=t,e.loading=!0;const n=e.fileType,a=await Xa[n]();if(!a)throw new Error(`cannot open files of type '${e.fileType}'`);const{unzip:o}=await Promise.all([r.e(6553),r.e(4574),r.e(1631)]).then(r.bind(r,71631)),{pluginManager:i}=(0,c.getEnv)(e),s=(0,z.openLocation)(e.fileSource,i);try{if((await s.stat()).size>3e7)throw new Error(`File is too big. Tabular files are limited to at most ${3e4.toLocaleString()}kb.`)}catch(e){console.warn(e)}try{await s.readFile().then((t=>e.requiresUnzip?o(t):t)).then((t=>a(t,e))).then((t=>{this.setLoaded(),(0,d.getParent)(e).displaySpreadsheet(t)}))}catch(e){this.setError(e)}}}))),Qa=d.types.model("RowFullTextFilter",{type:d.types.literal("RowFullText"),stringToFind:""}).views((e=>({get predicate(){let t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,r){const{cellsWithDerived:n}=r;for(const e of n)if(e.text&&e.text.toLowerCase().includes(t))return!0;return!1}):function(){return!0}}}))).actions((e=>({setString(t){e.stringToFind=t},clear(){e.stringToFind=""}}))),eo=d.types.model("SpreadsheetFilterControls",{rowFullText:d.types.optional(Qa,(()=>({type:"RowFullText",stringToFind:""}))),columnFilters:d.types.array(Wa)}).views((e=>({get filters(){return[e.rowFullText,...e.columnFilters].filter((e=>!!e))},setRowFullTextFilter(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters(e,t){for(const r of this.filters)if(!r.predicate(e,t))return!1;return!0}}))).actions((e=>({addBlankColumnFilter(t){const{dataType:r}=(0,d.getParent)(e).spreadsheet.columns[t];e.columnFilters.push({type:r.type,columnNumber:t})},removeColumnFilter:t=>e.columnFilters.remove(t),clearAllFilters(){e.columnFilters.clear(),e.rowFullText.clear()}}))),to=[{label:"Toggle select",icon:pa.Z,onClick(e,t){const r=t.rowMenuPosition?.rowNumber;void 0!==r&&t.rowSet.rows[+r-1].toggleSelect()}}],ro=d.types.model("SpreadsheetView",{type:d.types.literal("SpreadsheetView"),offsetPx:0,height:d.types.optional(d.types.refinement("SpreadsheetViewHeight",d.types.number,(e=>e>=40)),440),hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:d.types.optional(eo,(()=>eo.create({}))),mode:d.types.optional(d.types.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:d.types.optional(Ka,(()=>Ka.create())),spreadsheet:d.types.maybe(_a)}).volatile((()=>({width:400,rowMenuItems:to}))).views((e=>({get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!(0,d.getEnv)(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){const t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){const t=e.spreadsheet?.assemblyName;if(t){const r=(0,c.getSession)(e).assemblies;return r?.find((e=>(0,i.readConfObject)(e,"name")===t))}}}))).actions((e=>({setRowMenuItems(t){e.rowMenuItems=t},setWidth:t=>(e.width=t,e.width),setHeight:t=>(e.height=t>40?t:40,e.height),resizeHeight(t){const r=e.height;return this.setHeight(e.height+t)-r},resizeWidth(t){const r=e.width;return this.setWidth(e.width+t)-r},displaySpreadsheet(t){e.filterControls.clearAllFilters(),e.spreadsheet=(0,d.cast)(t),e.mode="display"},setImportMode(){e.mode="import"},setDisplayMode(){e.readyToDisplay&&(e.mode="display")},closeView(){(0,d.getParent)(e,2).removeView(e)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setImportMode(),icon:Me.Z}]}))),no=d.types.compose(s.BaseViewModel,ro);class ao extends a.Z{name="SpreadsheetViewPlugin";install(e){(e=>{e.addViewType((()=>new K.ViewType({name:"SpreadsheetView",displayName:"Spreadsheet view",stateModel:no,ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(7395),r.e(170),r.e(2167)]).then(r.bind(r,32167))))})))})(e),(e=>{e.addToExtensionPoint("LaunchView-SpreadsheetView",(async({session:e,assembly:t,uri:r,fileType:n})=>{const a=e.addView("SpreadsheetView");if(!a)throw new Error("Failed to initialize view");const o=r.split(".");let i=o?.pop()?.toUpperCase();"GZ"===i&&(i=o?.pop()?.toUpperCase()),a.importWizard.setFileType(n||i||""),a.importWizard.setSelectedAssemblyName(t),a.importWizard.setFileSource({uri:r,locationType:"UriLocation"}),await a.importWizard.import(t)}))})(e)}configure(e){const{rootModel:t}=e;(0,c.isAbstractMenuManager)(t)&&t.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:ua.Z,onClick:e=>{e.addView("SpreadsheetView",{})}})}}var oo=r(55022),io=r(88916),so=r(93840),lo=r(39780),co=r(70539);const uo=(0,Oe.ZL)()((e=>({circularViewOptions:{padding:e.spacing(1)}}))),po=(0,je.observer)((function({svInspector:e}){const{classes:t}=uo();return w.createElement(so.ZP,{container:!0,className:t.circularViewOptions,style:{height:e.circularViewOptionsBarHeight}},w.createElement(so.ZP,{item:!0},w.createElement(lo.Z,{control:w.createElement(co.Z,{checked:e.onlyDisplayRelevantRegionsInCircularView,onChange:t=>e.setOnlyDisplayRelevantRegionsInCircularView(t.target.checked)}),label:"show only regions with data"})))})),mo=(0,Oe.ZL)()((e=>({resizeHandleVert:{background:e.palette.action.selected,width:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},resizeHandleHoriz:{background:e.palette.action.selected,height:4,boxSizing:"border-box",borderTop:"1px solid #fafafa"},viewControls:{margin:0},viewsContainer:{display:"flex"},container:{overflow:"hidden"}}))),go=(0,je.observer)((function({model:e}){const{classes:t}=mo(),{SpreadsheetViewReactComponent:r,CircularViewReactComponent:n,showCircularView:a}=e;return w.createElement("div",{className:t.container},w.createElement("div",{className:t.viewsContainer},w.createElement("div",{style:{width:e.spreadsheetView.width},className:t.container},w.createElement(r,{model:e.spreadsheetView})),a?w.createElement(w.Fragment,null,w.createElement(T.ResizeHandle,{onDrag:t=>{const r=e.circularView.resizeWidth(-t);return e.spreadsheetView.resizeWidth(-r)},vertical:!0,flexbox:!0,className:t.resizeHandleVert}),w.createElement("div",{style:{width:e.circularView.width}},w.createElement(po,{svInspector:e}),w.createElement(n,{model:e.circularView}))):null),w.createElement(T.ResizeHandle,{onDrag:e.resizeHeight,className:t.resizeHandleHoriz}))})),fo=go;var ho=r(92454);function yo(e,t,r,n,a,o){const i={};return e.forEach(((e,n)=>{if(t.includes(n))return;let{text:a}=r.cells[n];"Number"===e.dataType.type&&(a=parseFloat(a)),i[e.name]=a})),{...i,uniqueId:`sv-inspector-adhoc-${o}`,refName:n.refName,start:n.start,end:n.end,mate:{refName:a.refName,start:a.start,end:a.end}}}function bo(e,t,r,n){return r.extendedData?.vcfFeature||r.extendedData?.feature||function(e,t,r,n){const{columns:a,columnDisplayOrder:o}=e,i={};o.forEach((e=>{const t=a[e];i[t.dataType.type]||(i[t.dataType.type]=[]),i[t.dataType.type].push(e)}));const s=i.LocString||[],l=i.LocStart||[],d=i.LocEnd||[],u=i.LocRef||[];return s.length>=2?function(e,t,r,n,a){const o=(0,c.parseLocString)(r.cells[t[0]].text,a),i=(0,c.parseLocString)(r.cells[t[1]].text,a);return yo(e,[t[0],t[1]],r,o,i,n)}(a,s,r,t,n):u.length>=2&&l.length>=2&&d.length>=2?function(e,t,r,n,a,o){const i=e=>a.cells[e].text,s={refName:i(t[0]),start:parseInt(i(r[0]),10)-1,end:parseInt(i(n[0]),10)},l={refName:i(t[1]),start:parseInt(i(r[1]),10)-1,end:parseInt(i(n[1]),10)};return yo(e,[t[0],r[0],n[0],t[1],r[1],n[1]],a,s,l,o)}(a,u,l,d,r,t):void 0}(t.spreadsheet,n,r,e.assemblyManager.isValidRefName)}function wo(e,t,r,n,a){const{pluginManager:o}=(0,c.getEnv)(e),i=(0,c.getSession)(t),s=bo(i,r,n,a);if(s){const t=new c.SimpleFeature(s);return i.setSelection(t),o.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(t,e.circularView)}}function vo(e,t,r){const n=(0,c.getSession)(t);n.setSelection(e);const a=(0,c.getContainingView)(t),o=r.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,a);o.views[0].offsetPx-=a.width/2+100,o.views[1].offsetPx-=a.width/2+100,o.featureData=e.toJSON(),n.addView("BreakpointSplitView",o)}class Co extends a.Z{name="SvInspectorViewPlugin";install(e){(e=>{e.jexl.addFunction("defaultOnChordClick",vo),e.addViewType((()=>{const t=function(e){const t=e.getViewType("SpreadsheetView"),r=e.getViewType("CircularView"),n=t.stateModel,a=r.stateModel;return d.types.compose("SvInspectorView",s.BaseViewModel,d.types.model({id:Y.ElementId,type:d.types.literal("SvInspectorView"),height:d.types.optional(d.types.refinement("SvInspectorViewHeight",d.types.number,(e=>e>=400)),550),onlyDisplayRelevantRegionsInCircularView:!1,mode:d.types.optional(d.types.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:d.types.optional(n,(()=>n.create({type:"SpreadsheetView",hideVerticalResizeHandle:!0}))),circularView:d.types.optional(a,(()=>a.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})))})).volatile((()=>({width:800}))).views((e=>({get selectedRows(){return e.spreadsheetView.rowSet.selectedRows},get assemblyName(){const{assembly:t}=e.spreadsheetView;return t?(0,i.readConfObject)(t,"name"):void 0},get showCircularView(){return"display"===e.spreadsheetView.mode},get features(){const t=(0,c.getSession)(e),{spreadsheetView:r}=e,{outputRows:n=[]}=r;return n.map(((e,n)=>bo(t,r,e,n))).filter((e=>!!e))},get featuresAdapterConfigSnapshot(){return{type:"FromConfigAdapter",features:this.features}},get featureRefNames(){const e=this.features.map((e=>e.refName)),t=this.features.flatMap((e=>e.INFO?.CHR2)).filter((e=>!!e));return[...e,...t]},get featuresCircularTrackConfiguration(){return{type:"VariantTrack",trackId:`sv-inspector-variant-track-${e.id}`,name:"features from tabular data",adapter:this.featuresAdapterConfigSnapshot,assemblyNames:[this.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:`sv-inspector-variant-track-chord-display-${e.id}`,onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}))).volatile((()=>({SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:r.ReactComponent,circularViewOptionsBarHeight:52}))).actions((e=>({setWidth(t){e.width=t},setHeight:t=>(e.height=t>400?t:400,e.height),setImportMode(){e.spreadsheetView.setImportMode()},setDisplayMode(){e.spreadsheetView.setDisplayMode()},closeView(){(0,d.getParent)(e,2).removeView(e)},setDisplayedRegions(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}))).views((e=>({menuItems:()=>[{label:"Return to import form",onClick:()=>e.setImportMode(),icon:Me.Z}]}))).actions((e=>({resizeHeight(t){const r=e.height;return e.setHeight(e.height+t)-r},afterAttach(){(0,d.addDisposer)(e,(0,ae.autorun)((()=>{if(e.showCircularView){const t=Math.round(.66*e.width),r=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(r)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,d.addDisposer)(e,(0,ae.autorun)((()=>{e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,d.addDisposer)(e,(0,ae.autorun)((async()=>{const{assemblyName:t,onlyDisplayRelevantRegionsInCircularView:r,circularView:n,featureRefNames:a}=e,{tracks:o}=n,{assemblyManager:i}=(0,c.getSession)(e);if(!t)return;const s=await i.waitForAssembly(t);if(!s)return;const{getCanonicalRefName:l,regions:d=[]}=s;if(r){if(1===o.length)try{const e=new Set(a.map((e=>l(e)||e)));n.setDisplayedRegions(Je()(d.filter((t=>e.has(t.refName)))))}catch(e){n.setError(e)}}else n.setDisplayedRegions(d)}),{name:"SvInspectorView displayed regions bind"})),(0,d.addDisposer)(e,(0,ae.reaction)((()=>({generatedTrackConf:e?.featuresCircularTrackConfiguration,assemblyName:e?.assemblyName})),(t=>{if(!t)return;const{assemblyName:r,generatedTrackConf:n}=t,{circularView:a}=e;a.tracks.forEach((e=>a.hideTrack(e.configuration.trackId))),r&&n&&a.addTrackConf(n,{assemblyName:r})}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),(0,d.addDisposer)(e,(0,ae.autorun)((()=>{e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:ho.Z,disabled:(t,r,n,a)=>!function(e,t,r,n,a){try{return Boolean(wo(e,t,r,n,a))}catch(e){return console.error("Unable to open breakpoint split view from table row",e),!1}}(e,t,r,a,n),onClick(t,r,n,a){!function(e,t,r,n,a){const o=wo(e,t,r,n,a);if(o){const{circularView:r}=e;o.views[0].offsetPx-=r.width/2+100,o.views[1].offsetPx-=r.width/2+100,(0,c.getSession)(t).addView("BreakpointSplitView",o)}}(e,t,r,a,n)}}])})))}})))}(e);return new te.Z({name:"SvInspectorView",displayName:"SV inspector",stateModel:t,ReactComponent:fo})}))})(e),(e=>{e.addToExtensionPoint("LaunchView-SvInspectorView",(async({session:e,assembly:t,uri:r,fileType:n})=>{const a=e.addView("SvInspectorView");if(!a)throw new Error("Failed to initialize view");const o=r.split(".");let i=o?.pop()?.toUpperCase();"GZ"===i&&(i=o?.pop()?.toUpperCase()),a.spreadsheetView.importWizard.setFileType(n||i||""),a.spreadsheetView.importWizard.setSelectedAssemblyName(t),a.spreadsheetView.importWizard.setFileSource({uri:r,locationType:"UriLocation"}),await a.spreadsheetView.importWizard.import(t)}))})(e)}configure(e){(0,oo.J0)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:io.Z,onClick:e=>{e.addView("SvInspectorView",{})}})}}var So=r(622);function ko(){return ko=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ko.apply(this,arguments)}const To=(0,je.observer)((function(e){const{width:t,height:r}=e,n=Math.ceil(t);return w.createElement("div",{style:{position:"relative",width:n,height:r}},w.createElement(T.PrerenderedCanvas,ko({},e,{style:{position:"absolute",left:0,top:0}})))})),xo=(0,i.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0});var Po=r(96595),Mo=r(55619),Eo=r(40011),Ro=r(93912);class Ao extends Po.default{supportsSVG=!0;async makeImageData(e,t){const{features:r,config:n,bpPerPx:a,signal:o,resolution:s,sessionId:l,adapterConfig:d,regions:u}=t,[p]=u,{dataAdapter:m}=await(0,Ro.uP)(this.pluginManager,l,d),g=await m.getResolution(a/s)/(a*Math.sqrt(2)),f=(0,So.V)((0,i.readConfObject)(n,"baseColor"));if(r.length){const h=r[0].bin1;let y=0,b=0,w=0;await(0,c.abortBreakPoint)(o);for(const{bin1:S,bin2:k,counts:T}of r)y=Math.max(T,y),b=Math.min(Math.min(S,k),b),w=Math.max(Math.max(S,k),w);function v(){e.scale(-1,1);const t=(p.end-p.start)/a;e.translate(-t,0)}await(0,c.abortBreakPoint)(o),!0===p.reversed&&v(),e.rotate(-Math.PI/4);let C=Date.now();for(const{bin1:x,bin2:P,counts:M}of r)e.fillStyle=(0,i.readConfObject)(n,"color",{count:M,maxScore:y,baseColor:f}),e.fillRect((x-h)*g,(P-h)*g,g,g),+Date.now()-C>400&&(await(0,c.abortBreakPoint)(o),C=+Date.now())}}async render(e){const{config:t,regions:r,bpPerPx:n}=e,[a]=r,o=(a.end-a.start)/n,s=(0,i.readConfObject)(t,"maxHeight"),l=await this.getFeatures(e),c=await(0,Mo.Cj)(o,s,e,(t=>this.makeImageData(t,{...e,features:l})));return{...await super.render({...e,...c,features:l,region:e.regions[0],height:s,width:o}),...c,height:s,width:o}}async getFeatures(e){const{regions:t,sessionId:r,adapterConfig:n}=e,{dataAdapter:a}=await(0,Ro.uP)(this.pluginManager,r,n);return await a.getFeatures(t[0],e).pipe((0,Eo.q)()).toPromise()}}const Io=e=>d.types.compose("LinearHicDisplay",$t.fV,d.types.model({type:d.types.literal("LinearHicDisplay"),configuration:(0,i.ConfigurationReference)(e),resolution:d.types.optional(d.types.number,1)})).views((e=>{const{renderProps:t}=e;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps(){const r=e.rendererType.configSchema.create((0,i.getConf)(e,"renderer")||{},(0,d.getEnv)(e));return{...t(),config:r,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution}}}})).actions((e=>({setResolution(t){e.resolution=t}}))).views((e=>{const{trackMenuItems:t}=e;return{trackMenuItems:()=>[...t(),{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:()=>{e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:()=>{e.setResolution(e.resolution/2)}}]}]}})),Fo=(0,i.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}}},{explicitlyTyped:!0});class No extends a.Z{name="HicPlugin";install(e){(e=>{e.addAdapterType((()=>new K.AdapterType({name:"HicAdapter",displayName:"Hi-C adapter",configSchema:Fo,getAdapterClass:()=>Promise.all([r.e(6605),r.e(9742)]).then(r.bind(r,29742)).then((e=>e.default))})))})(e),(e=>{e.addRendererType((()=>new Ao({name:"HicRenderer",ReactComponent:To,configSchema:xo,pluginManager:e})))})(e),(e=>{e.addTrackType((()=>{const t=(e=>(0,i.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,K.createBaseTrackConfig)(e)}))(e);return new or.Z({name:"HicTrack",displayName:"Hi-C track",configSchema:t,stateModel:(0,s.createBaseTrackModel)(e,"HicTrack",t)})}))})(e),(e=>{e.addDisplayType((()=>{const t=(e=>(0,i.ConfigurationSchema)("LinearHicDisplay",{renderer:e.getRendererType("HicRenderer").configSchema},{baseConfiguration:$t.fU,explicitlyTyped:!0}))(e);return new K.DisplayType({name:"LinearHicDisplay",displayName:"Hi-C contact matrix display",configSchema:t,stateModel:Io(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:$t.qb})}))})(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(e=>(t,r,n)=>{const a="HicAdapter",o=(0,J.getFileName)(t),i={type:a,hicLocation:t};return/\.hic/i.test(o)&&!n||n===a?i:e(t,r,n)})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(e=>t=>"HicAdapter"===t?"HicTrack":e(t)))}configure(e){const{jexl:t}=e;t.addFunction("alpha",((e,t)=>e.alpha(t))),t.addFunction("hsl",(e=>(0,So.V)(e.toHsl()))),t.addFunction("colorString",(e=>e.toHex()))}}var Lo=r(67963);function Do(e){try{return decodeURIComponent(e)}catch(t){return e}}function Bo(e,t,r=15){const n=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,n-r)>0?"...":"")+e.slice(Math.max(0,n-r),n+t.length+r).trim()+(n+t.length<e.length?"...":"")}class Vo extends It.BaseAdapter{constructor(e,t,r){super(e,t,r);const n=(0,i.readConfObject)(e,"ixFilePath"),a=(0,i.readConfObject)(e,"ixxFilePath");if(!n)throw new Error("must provide out.ix");if(!a)throw new Error("must provide out.ixx");this.trixJs=new Lo.Z((0,z.openLocation)(a,r),(0,z.openLocation)(n,r),1500)}async searchIndex(e){const t=e.queryString.toLowerCase(),r=t.split(" "),n=(await this.trixJs.search(t)).filter((([,e])=>r.every((t=>Do(e).toLowerCase().includes(t))))).map((([e,t])=>{const r=JSON.parse(t.replaceAll("|",",")),[n,a,...o]=r.map((e=>Do(e))),i=o.findIndex((e=>!!e)),s=o.map((e=>e.toLowerCase())).findIndex((t=>t.includes(e.toLowerCase()))),l=o[i],c=o[s],d=-1!==s?Bo(c,e):void 0,u=Bo(l,e),p=d&&u.toLowerCase()!==d.toLowerCase()?`${u} (${d})`:u;return new Ft.Z({locString:n,label:l,displayString:p,matchedObject:r.map((e=>decodeURIComponent(e))),trackId:a})}));return"exact"===e.searchType?n.filter((t=>t.getLabel().toLowerCase()===e.queryString.toLowerCase())):n}freeResources(){}}const zo=(0,i.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),Oo=class extends a.Z{name="TrixPlugin";install(e){e.addTextSearchAdapterType((()=>new At.Z({name:"TrixTextSearchAdapter",displayName:"Trix text search adapter",configSchema:zo,AdapterClass:Vo,description:"Trix adapter"})))}};var Zo=r(44604),jo=r(21771);const Wo=d.types.compose(Y.Region,d.types.model("Label",{label:d.types.optional(d.types.string,"")})).actions((e=>({setLabel(t){e.label=t}}))),$o=d.types.model("SharedBookmarksModel",{sharedBookmarks:d.types.maybe(d.types.array(Wo))}),Ho=()=>void 0!==typeof window?`bookmarks-${[window.location.host+window.location.pathname].join("-")}`:"empty",Go=(0,i.ConfigurationSchema)("GridBookmarkWidget",{}),qo=e=>{e.addWidgetType((()=>new K.WidgetType({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:Go,stateModel:d.types.model("GridBookmarkModel",{id:Y.ElementId,type:d.types.literal("GridBookmarkWidget"),bookmarks:d.types.optional(d.types.array(Wo),(()=>JSON.parse((0,c.localStorageGetItem)(Ho())||"[]")))}).volatile((()=>({selectedBookmarks:[],selectedAssembliesPre:void 0}))).views((e=>({get bookmarkAssemblies(){return[...new Set(e.bookmarks.map((e=>e.assemblyName)))]},get validAssemblies(){const{assemblyManager:t}=(0,c.getSession)(e);return new Set(this.bookmarkAssemblies.filter((e=>t.get(e))))}}))).views((e=>({get bookmarksWithValidAssemblies(){return e.bookmarks.filter((t=>e.validAssemblies.has(t.assemblyName)))}}))).views((e=>({get sharedBookmarksModel(){return $o.create({sharedBookmarks:JSON.parse(JSON.stringify(e.selectedBookmarks))})},get allBookmarksModel(){return $o.create({sharedBookmarks:JSON.parse(JSON.stringify(e.bookmarksWithValidAssemblies))})}}))).actions((e=>({setSelectedAssemblies(t){e.selectedAssembliesPre=t}}))).views((e=>({get selectedAssemblies(){return e.selectedAssembliesPre?.filter((t=>e.validAssemblies.has(t)))??[...e.validAssemblies]}}))).actions((e=>({importBookmarks(t){e.bookmarks=(0,d.cast)([...e.bookmarks,...t])},addBookmark(t){e.bookmarks.push(t)},removeBookmark(t){e.bookmarks.splice(t,1)},updateBookmarkLabel(e,t){e.correspondingObj.setLabel(t)},setSelectedBookmarks(t){e.selectedBookmarks=t},setBookmarkedRegions(t){e.bookmarks=(0,d.cast)(t)}}))).actions((e=>({clearAllBookmarks(){for(const t of e.bookmarks)e.validAssemblies.has(t.assemblyName)&&e.bookmarks.remove(t)},clearSelectedBookmarks(){for(const t of e.selectedBookmarks)e.bookmarks.remove(t.correspondingObj);e.selectedBookmarks=[]}}))).actions((e=>({afterAttach(){const t=Ho();(0,d.addDisposer)(e,(0,ae.autorun)((()=>{(0,c.localStorageSetItem)(t,JSON.stringify(e.bookmarks))})))}}))).postProcessSnapshot((e=>{const{bookmarks:t,...r}=e;return r})),ReactComponent:(0,w.lazy)((()=>Promise.all([r.e(7395),r.e(3155),r.e(5204)]).then(r.bind(r,40402))))})))},Uo=class extends a.Z{name="GridBookmarkPlugin";install(e){qo(e),e.addToExtensionPoint("Core-extendPluggableElement",(e=>{if("LinearGenomeView"===e.name){const{stateModel:t}=e,r=t.actions((e=>({activateBookmarkWidget(){const t=(0,c.getSession)(e);if((0,c.isSessionModelWithWidgets)(t)){let e=t.widgets.get("GridBookmark");return e||(e=t.addWidget("GridBookmarkWidget","GridBookmark")),t.showWidget(e),t.widgets.get("GridBookmark")}throw new Error("Could not open bookmark widget")}}))).actions((e=>({navigateNewestBookmark(){const t=(0,c.getSession)(e),r=e.activateBookmarkWidget().bookmarks;r?.length?e.navTo(r.at(-1)):t.notify("There are no recent bookmarks to navigate to.","info")},bookmarkCurrentRegion(){if(e.id===(0,c.getSession)(e).focusedViewId){const t=e.getSelectedRegions(void 0,void 0);e.activateBookmarkWidget().addBookmark(t[0])}}}))).views((e=>{const t=e.menuItems,r=e.rubberBandMenuItems;return{menuItems:()=>[...t(),{type:"divider"},{label:"Open bookmark widget",icon:jo.Z,onClick:()=>e.activateBookmarkWidget()},{label:"Bookmark current region",icon:Zo.Z,onClick:()=>e.bookmarkCurrentRegion()}],rubberBandMenuItems:()=>[...r(),{label:"Bookmark region",icon:Zo.Z,onClick:()=>{const{leftOffset:t,rightOffset:r}=e,n=e.getSelectedRegions(t,r);e.activateBookmarkWidget().addBookmark(n[0])}}]}})).actions((e=>({afterCreate(){document.addEventListener("keydown",(t=>{const r=(t.ctrlKey||t.metaKey)&&t.shiftKey;r&&"KeyD"===t.code&&(t.preventDefault(),e.activateBookmarkWidget(),e.bookmarkCurrentRegion(),(0,c.getSession)(e).notify("Bookmark created.","success")),r&&"KeyM"===t.code&&(t.preventDefault(),e.navigateNewestBookmark())}))}})));e.stateModel=r}return e}))}configure(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToMenu("Tools",{label:"Bookmarks",icon:jo.Z,onClick:e=>{let t=e.widgets.get("GridBookmark");t||(t=e.addWidget("GridBookmarkWidget","GridBookmark")),e.showWidget(t)}})}},_o=[ia,$t.ZP,n.ZP,$,X,ge.ZP,fe.ZP,ke.Z,wt,Ct,Tt,Et,Wt,hr,Nr,an,pn,Mn,sa.Z,la.ZP,da,ao,Co,me,No,Oo,Uo,Se,Ur]},31158:()=>{}}]);
//# sourceMappingURL=8629.31573473.chunk.js.map