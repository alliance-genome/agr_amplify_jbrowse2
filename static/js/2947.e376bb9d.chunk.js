(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[2947],{92407:function(e,t,n){"use strict";n.d(t,{Z:function(){return j}});var r=n(34795),a=n(96234),i=n(33028),o=n(68079),s=n(77162),c=n.n(s),u=n(30969),l=n(22714),d=n(43175),f=n(1720),p=n(28599),h=n(317),g=n(80975),m=n(13893),v=n(34760),y=n.n(v),b=n(81073),x=n(9077),w=n(33853),k=n(37574),C=(0,l.Z)((function(e){return{button:{margin:e.spacing(1)}}})),Z="rgb(220,220,180)",S="rgba(250,200,200)";function T(e){var t=e.cds,n=e.sequence;return(0,k.jsx)("span",{style:{background:Z},children:(0,w.zo)(t,n)})}function P(e){for(var t=e.cds,n=e.sequence,r=e.codonTable,a=(0,w.zo)(t,n),i="",o=0;o<a.length;o+=3)i+=r[a.slice(o,o+3)]||"&";return(0,k.jsx)("span",{style:{background:"rgb(220,160,220)"},children:i})}function R(e){var t=e.utr,n=e.cds,r=e.exons,a=e.sequence,i=e.upstream,s=e.downstream,c=e.includeIntrons,l=e.collapseIntron,d=n.length?[].concat((0,o.Z)(n),(0,o.Z)(t)).sort((function(e,t){return e.start-t.start})):r;return(0,k.jsxs)(k.Fragment,{children:[i?(0,k.jsx)("span",{style:{background:S},children:i}):null,d.filter((function(e){return e.start!==e.end})).map((function(e,t){var n,r=a.slice(e.end,null===(n=d[t+1])||void 0===n?void 0:n.start);return(0,k.jsxs)(u.Fragment,{children:[(0,k.jsx)("span",{style:{background:"CDS"===e.type?Z:"rgb(200,240,240)"},children:a.slice(e.start,e.end)}),c&&t<d.length-1?(0,k.jsx)("span",{style:{background:undefined},children:l&&r.length>20?"".concat(r.slice(0,10),"...").concat(r.slice(-10)):r}):null]},JSON.stringify(e))})),s?(0,k.jsx)("span",{style:{background:S},children:s}):null]})}var M=u.forwardRef((function(e,t){var n=e.feature,r=e.mode,a=e.sequence,o=a.seq,s=a.upstream,c=void 0===s?"":s,u=a.downstream,l=void 0===u?"":u,d=n.subfeatures,f=(0,b.generateCodonTable)(b.defaultCodonTable);if(!d)return null;var p=d.sort((function(e,t){return e.start-t.start})).map((function(e){return(0,i.Z)((0,i.Z)({},e),{},{start:e.start-n.start,end:e.end-n.start})})),h=(0,w.D8)(p.filter((function(e){return"CDS"===e.type}))),g=(0,w.D8)(p.filter((function(e){return e.type.match(/utr/i)}))),m=(0,w.D8)(p.filter((function(e){return"exon"===e.type})));if(!g.length&&h.length&&m.length&&(g=(0,w.ZK)(h,m)),-1===n.strand){var v=[(0,b.revcom)(o),(0,b.revcom)(l),(0,b.revcom)(c)];o=v[0],c=v[1],l=v[2],h=(0,w.Wx)(h,o.length),m=(0,w.Wx)(m,o.length),g=(0,w.Wx)(g,o.length)}return(0,k.jsx)("div",{ref:t,"data-testid":"sequence_panel",children:(0,k.jsxs)("div",{style:{fontFamily:"monospace",wordWrap:"break-word",maxWidth:600},children:[">".concat(n.name||n.id||"unknown","-").concat(r,"\n"),"cds"===r?(0,k.jsx)(T,{cds:h,sequence:o}):"cdna"===r?(0,k.jsx)(R,{exons:m,cds:h,utr:g,sequence:o}):"protein"===r?(0,k.jsx)(P,{cds:h,codonTable:f,sequence:o}):"gene"===r?(0,k.jsx)(R,{exons:m,cds:h,utr:g,sequence:o,includeIntrons:!0}):"gene_collapsed_intron"===r?(0,k.jsx)(R,{exons:m,cds:h,sequence:o,utr:g,includeIntrons:!0,collapseIntron:!0}):"gene_updownstream"===r?(0,k.jsx)(R,{exons:m,cds:h,sequence:o,utr:g,upstream:c,downstream:l,includeIntrons:!0}):"gene_updownstream_collapsed_intron"===r?(0,k.jsx)(R,{exons:m,cds:h,sequence:o,utr:g,upstream:c,downstream:l,includeIntrons:!0,collapseIntron:!0}):(0,k.jsx)("div",{children:"Unknown type"})]})})}));function j(e){var t,n=e.model,i=e.feature,o=C(),s=i,l=null===(t=s.subfeatures)||void 0===t?void 0:t.find((function(e){return"CDS"===e.type})),v=(0,u.useRef)(null),w=(0,m.YD)(),Z=w.ref,S=w.inView,T=(0,u.useState)(),P=(0,a.Z)(T,2),R=P[0],j=P[1],A=(0,u.useState)(),N=(0,a.Z)(A,2),L=N[0],F=N[1],I=(0,u.useState)(l?"cds":"cdna"),B=(0,a.Z)(I,2),D=B[0],E=B[1],V=(0,u.useState)(!1),O=(0,a.Z)(V,2),z=O[0],W=O[1],H=(0,u.useState)(!1),q=(0,a.Z)(H,2),U=q[0],_=q[1];(0,u.useEffect)((function(){var e,t=!1;if(!n||!S)return function(){};var o=(0,b.getSession)(n),s=o.assemblyManager,u=o.rpcManager,l=(null===(e=n.view)||void 0===e?void 0:e.assemblyNames)||[],d=(0,a.Z)(l,1)[0];function f(e,t,n){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)(c().mark((function e(t,n,r){var i,o,l,f,p,h;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.waitForAssembly(d);case 2:if(i=e.sent){e.next=5;break}throw new Error("assembly not found");case 5:return o="getSequence",e.next=8,u.call(o,"CoreGetFeatures",{adapterConfig:(0,x.getConf)(i,["sequence","adapter"]),sessionId:o,regions:[{start:t,end:n,refName:i.getCanonicalRefName(r)}]});case 8:if(l=e.sent,f=l,p=(0,a.Z)(f,1),h=p[0]){e.next=12;break}throw new Error("sequence not found for feature with refName:".concat(r));case 12:return e.abrupt("return",h.get("seq"));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,r.Z)(c().mark((function e(){var n,r,a,o,s,u,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(n=i).start,a=n.end,o=n.refName,e.next=4,f(r,a,o);case 4:return s=e.sent,e.next=7,f(Math.max(0,r-500),r,o);case 7:return u=e.sent,e.next=10,f(a,a+500,o);case 10:l=e.sent,t||j({seq:s,upstream:u,downstream:l}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),F(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))(),function(){t=!0}}),[i,S,n]);var G=!R;return(0,k.jsxs)("div",{ref:Z,children:[(0,k.jsxs)(d.Z,{value:D,onChange:function(e){return E(e.target.value)},children:[l?(0,k.jsx)(f.Z,{value:"cds",children:"CDS"}):null,l?(0,k.jsx)(f.Z,{value:"protein",children:"Protein"}):null,(0,k.jsx)(f.Z,{value:"gene",children:"Gene w/ introns"}),(0,k.jsx)(f.Z,{value:"gene_collapsed_intron",children:"Gene w/ 10bp of intron"}),(0,k.jsx)(f.Z,{value:"gene_updownstream",children:"Gene w/ 500bp up+down stream"}),(0,k.jsx)(f.Z,{value:"gene_updownstream_collapsed_intron",children:"Gene w/ 500bp up+down stream w/ 10bp intron"}),(0,k.jsx)(f.Z,{value:"cdna",children:"cDNA"})]}),(0,k.jsx)(p.Z,{className:o.button,type:"button",variant:"contained",onClick:function(){var e=v.current;e&&(y()(e.textContent||"",{format:"text/plain"}),W(!0),setTimeout((function(){return W(!1)}),1e3))},children:z?"Copied to clipboard!":"Copy as plaintext"}),(0,k.jsx)(h.ZP,{title:"Note that 'Copy as HTML' can retain the colors but cannot be pasted into some programs like notepad that only expect plain text",children:(0,k.jsx)(p.Z,{className:o.button,type:"button",variant:"contained",onClick:function(){var e=v.current;e&&(y()(e.innerHTML,{format:"text/html"}),_(!0),setTimeout((function(){return _(!1)}),1e3))},children:U?"Copied to clipboard!":"Copy as HTML"})}),(0,k.jsx)("div",{"data-testid":"feature_sequence",children:L?(0,k.jsx)(g.Z,{color:"error",children:"".concat(L)}):G?(0,k.jsx)("div",{children:"Loading gene sequence..."}):R?(0,k.jsx)(M,{ref:v,feature:s,mode:D,sequence:R}):(0,k.jsx)("div",{children:"No sequence found"})})]})}},33853:function(e,t,n){"use strict";n.d(t,{Cn:function(){return l},D8:function(){return s},Wx:function(){return c},ZK:function(){return u},zo:function(){return i}});var r=n(68079),a=n(33028);function i(e,t){return e.map((function(e){return t.slice(e.start,e.end)})).join("")}function o(e){return"".concat(e.start,"-").concat(e.end)}function s(e){return e.filter((function(e,t,n){return!t||o(e)!==o(n[t-1])}))}function c(e,t){return e.map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{start:t-e.end,end:t-e.start})})).sort((function(e,t){return e.start-t.start}))}function u(e,t){var n=e[0],i=e[e.length-1],o=t.findIndex((function(e){return e.end>=n.start&&e.start<=n.start})),s=t.findIndex((function(e){return e.end>=i.end&&e.start<=i.end})),c=t[s],u=t[o],l=[].concat((0,r.Z)(t.slice(0,o)),[{start:u.start,end:n.start}]).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{type:"five_prime_UTR"})})),d=[{start:i.end,end:c.end}].concat((0,r.Z)(t.slice(s+1))).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{type:"three_prime_UTR"})}));return[].concat((0,r.Z)(l),(0,r.Z)(d))}function l(e){return e.length>20?"".concat(e.slice(0,20),"..."):e}},61910:function(e,t,n){"use strict";n.d(t,{Z:function(){return H}});var r={};n.r(r),n.d(r,{CoreEstimateRegionStats:function(){return L},CoreFreeResources:function(){return N},CoreGetFeatureDetails:function(){return I},CoreGetFeatures:function(){return A},CoreGetFileInfo:function(){return M},CoreGetMetadata:function(){return j},CoreGetRefNames:function(){return R},CoreRender:function(){return F}});var a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(30969),u=n(40909),l=n(9077),d=n(29206),f=(0,l.ConfigurationSchema)("BaseFeatureWidget",{});function p(e){return u.types.model("BaseFeatureWidget",{id:d.ElementId,type:u.types.literal("BaseFeatureWidget"),featureData:u.types.frozen(),view:u.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var h=n(49767),g=n(33028),m=n(93069),v=n(95058),y=n(34795),b=n(77162),x=n.n(b),w=n(26080),k=n(3011),C=n(71036),Z=n(67688),S=n(29598),T=n(81073),P=n(14956),R=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetRefNames",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,(0,k.uP)(this.pluginManager,a,i);case 6:if(o=e.sent,!((s=o.dataAdapter)instanceof S.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",s.getRefNames(r));case 10:return e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),M=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetInfo",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,(0,k.uP)(this.pluginManager,a,i);case 6:return o=e.sent,s=o.dataAdapter,e.abrupt("return",(0,S.isFeatureAdapter)(s)?s.getHeader(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),j=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetMetadata",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.sessionId,i=r.adapterConfig,e.next=6,(0,k.uP)(this.pluginManager,a,i);case 6:return o=e.sent,s=o.dataAdapter,e.abrupt("return",(0,S.isFeatureAdapter)(s)?s.getMetadata(r):null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetFeatures",e}return(0,i.Z)(n,[{key:"deserializeReturn",value:function(){var e=(0,y.Z)(x().mark((function e(t,r,a){var i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.Z)((0,v.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:return i=e.sent,e.abrupt("return",i.map((function(e){return new P.Z(e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,y.Z)(x().mark((function e(t,r){var a,i,o,s,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=null===(a=this.pluginManager.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager)){e.next=7;break}return e.next=4,(0,T.renameRegionsIfNeeded)(o,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:return s=e.t0,e.next=11,(0,m.Z)((0,v.Z)(n.prototype),"serializeArguments",this).call(this,s,r);case 11:return c=e.sent,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s,c,u,l,d,f;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.signal,i=r.sessionId,o=r.adapterConfig,s=r.regions,c=r.opts,e.next=6,(0,k.uP)(this.pluginManager,i,o);case 6:if(u=e.sent,l=u.dataAdapter,(0,S.isFeatureAdapter)(l)){e.next=10;break}return e.abrupt("return",[]);case 10:return d=l.getFeaturesInMultipleRegions(s,(0,g.Z)((0,g.Z)({},c),{},{signal:a})),e.next=13,d.pipe((0,w.q)()).toPromise();case 13:return f=e.sent,e.abrupt("return",f.map((function(e){return e.toJSON()})));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),N=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreFreeResources",e}return(0,i.Z)(n,[{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,n+=(0,k.Yr)(t),this.pluginManager.getRendererTypes().forEach((function(e){var t=e.freeResources();t&&(n+=t)})),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),L=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreEstimateRegionStats",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,y.Z)(x().mark((function e(t,r){var a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null===(a=this.pluginManager.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,(0,T.renameRegionsIfNeeded)(o,(0,g.Z)((0,g.Z)({},t),{},{filters:t.filters&&t.filters.toJSON().filters}));case 5:return s=e.sent,e.abrupt("return",(0,m.Z)((0,v.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,e.next=6,(0,k.uP)(this.pluginManager,i,a);case 6:if(s=e.sent,!((c=s.dataAdapter)instanceof S.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",c.estimateRegionsStats(o,r));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z),F=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreRender",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,y.Z)(x().mark((function e(t,r){var a,i,o,s,c,u,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=null===(a=this.pluginManager.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager)){e.next=7;break}return e.next=4,(0,T.renameRegionsIfNeeded)(o,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:return s=e.t0,e.next=11,(0,m.Z)((0,v.Z)(n.prototype),"serializeArguments",this).call(this,s,r);case 11:if(c=e.sent,"MainThreadRpcDriver"!==r){e.next=14;break}return e.abrupt("return",c);case 14:return u=t.rendererType,l=B(u,this.pluginManager.getRendererType(u)),e.abrupt("return",l.serializeArgsInClient(c));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s,c,u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,o=a.rendererType,s=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:if((0,T.checkAbortSignal)(s),c=B(o,this.pluginManager.getRendererType(o)),"MainThreadRpcDriver"!==n){e.next=16;break}return e.next=13,c.render(r);case 13:e.t0=e.sent,e.next=19;break;case 16:return e.next=18,c.renderInWorker(r);case 18:e.t0=e.sent;case 19:return u=e.t0,(0,T.checkAbortSignal)(s),e.abrupt("return",u);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,y.Z)(x().mark((function e(t,r,a){var i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.Z)((0,v.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(i=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",i);case 5:return o=r.rendererType,s=B(o,this.pluginManager.getRendererType(o)),e.abrupt("return",s.deserializeResultsInClient(i,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(C.Z),I=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="CoreGetFeatureDetails",e}return(0,i.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,y.Z)(x().mark((function e(t,r){var a,i,o,s,c,u,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=null===(a=this.pluginManager.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager)){e.next=7;break}return e.next=4,(0,T.renameRegionsIfNeeded)(o,t);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=t;case 8:return s=e.t0,e.next=11,(0,m.Z)((0,v.Z)(n.prototype),"serializeArguments",this).call(this,s,r);case 11:if(c=e.sent,"MainThreadRpcDriver"!==r){e.next=14;break}return e.abrupt("return",c);case 14:return u=t.rendererType,l=B(u,this.pluginManager.getRendererType(u)),e.abrupt("return",l.serializeArgsInClient(c));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,y.Z)(x().mark((function e(t,n){var r,a,i,o,s,c,u,l;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:return i=(a=r).rendererType,o=a.featureId,s=B(i,this.pluginManager.getRendererType(i)),c=s.sessions[(0,T.getLayoutId)(t)],u=c.cachedLayout.layout,l=u.getDataByID(o),e.abrupt("return",{feature:l.toJSON()});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(C.Z);function B(e,t){if(!t)throw new Error('renderer "'.concat(e,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e," has no ReactComponent, it may not be completely implemented yet"));if(!(t instanceof Z.default))throw new Error("CoreRender requires a renderer that is a subclass of ServerSideRendererType");return t}var D=n(93029),E=n(66737),V=n(96234),O=n(33528),z=(0,l.ConfigurationSchema)("CytobandAdapter",{cytobandLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/cytoband.txt.gz"}}},{explicitlyTyped:!0}),W=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"getData",value:function(){var e=(0,y.Z)(x().mark((function e(){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=(0,l.readConfObject)(this.config,"cytobandLocation")).uri&&"/path/to/cytoband.txt.gz"!==t.uri){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,(0,O.openLocation)(t).readFile("utf8");case 5:return n=e.sent,e.abrupt("return",n.split("\n").filter((function(e){return!!e.trim()})).map((function(e){var t=e.split("\t"),n=(0,V.Z)(t,5),r=n[0],a=n[1],i=n[2],o=n[3],s=n[4];return new P.Z({uniqueId:e,refName:r,start:+a,end:+i,name:o,type:s})})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(S.BaseAdapter),H=function(e){(0,o.Z)(u,e);var t=(0,s.Z)(u);function u(){var e;(0,a.Z)(this,u);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="CorePlugin",e}return(0,i.Z)(u,[{key:"install",value:function(e){Object.values(r).forEach((function(t){e.addRpcMethod((function(){return new t(e)}))})),e.addAdapterType((function(){return new D.Z({name:"CytobandAdapter",configSchema:z,AdapterClass:W})})),e.addWidgetType((function(){return new E.Z({name:"BaseFeatureWidget",heading:"Feature details",configSchema:f,stateModel:p(e),ReactComponent:(0,c.lazy)((function(){return Promise.resolve().then(n.bind(n,47762))}))})}))}}]),u}(h.Z)},49767:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9249),a=n(87371),i=function(){function e(){(0,r.Z)(this,e),this.name=void 0,this.url=void 0,this.version=void 0,this.configurationSchema=void 0}return(0,a.Z)(e,[{key:"install",value:function(e){}},{key:"configure",value:function(e){}}]),e}()},10840:function(e,t,n){"use strict";n.d(t,{Z:function(){return Ge}});var r={};n.r(r),n.d(r,{AdapterType:function(){return K.Z},BaseConnectionModelFactory:function(){return ge.BaseConnectionModelFactory},BaseDisplay:function(){return ge.BaseDisplay},BaseInternetAccountConfig:function(){return ge.BaseInternetAccountConfig},BaseViewModel:function(){return ge.BaseViewModel},BoxRendererType:function(){return ue.default},CircularChordRendererType:function(){return le.Z},ComparativeServerSideRendererType:function(){return de.Z},ConnectionType:function(){return ee.Z},DisplayType:function(){return ae.Z},FeatureRendererType:function(){return fe.default},InternetAccount:function(){return ge.InternetAccount},InternetAccountType:function(){return se.Z},RendererType:function(){return te.default},RpcMethodType:function(){return oe.Z},ServerSideRenderedContent:function(){return pe.Z},ServerSideRendererType:function(){return he.default},TextSearchAdapterType:function(){return ce.Z},TrackType:function(){return re.Z},ViewType:function(){return ie.Z},WidgetType:function(){return ne.Z},baseConnectionConfig:function(){return ge.baseConnectionConfig},createBaseTrackConfig:function(){return ge.createBaseTrackConfig},createBaseTrackModel:function(){return ge.createBaseTrackModel}});var a={};n.r(a),n.d(a,{amber:function(){return Ve.Z},blue:function(){return Ae.Z},blueGrey:function(){return qe.Z},brown:function(){return We.Z},cyan:function(){return Le.Z},deepOrange:function(){return ze.Z},deepPurple:function(){return Me.Z},green:function(){return Ie.Z},grey:function(){return He.Z},indigo:function(){return je.Z},lightBlue:function(){return Ne.Z},lightGreen:function(){return Be.Z},lime:function(){return De.Z},orange:function(){return Oe.Z},pink:function(){return Pe.Z},purple:function(){return Re.Z},red:function(){return Te.Z},teal:function(){return Fe.Z},yellow:function(){return Ee.Z}});var i=n(30969),o=n(15749),s=n.t(o,2),c=n(35247),u=n(40909),l=n(90550),d=n(24974),f=n.n(d),p=n(21728),h=n(74956),g=n(32460),m=n(67496),v=n(78954),y=n(22099),b=n(27710),x=n(28599),w=n(69285),k=n(34122),C=n(23957),Z=n(24684),S=n(92628),T=n(83483),P=n(75654),R=n(28224),M=n(93717),j=n(75617),A=n(29623),N=n(17201),L=n(32343),F=n(5877),I=n(94103),B=n(93999),D=n(83421),E=n(11112),V=n(1720),O=n(18189),z=n(55788),W=n(43175),H=n(25267),q=n(1953),U=n(7690),_=n(317),G=n(80975),J=n(38601),X=n(83230),Y=n(29598),Q=n(47762),$=n(54006),K=n(93029),ee=n(58096),te=n(86297),ne=n(66737),re=n(82044),ae=n(81575),ie=n(39798),oe=n(71036),se=n(15875),ce=n(31145),ue=n(21339),le=n(54215),de=n(43103),fe=n(29637),pe=n(79321),he=n(67688),ge=n(59853),me=n(9077),ve=n(49767),ye=n(24998),be=n(81073),xe=n(74426),we=n(41472),ke=n(97891),Ce=n(33528),Ze=n(88981),Se=n(26131),Te=n(8009),Pe=n(5266),Re=n(80925),Me=n(29450),je=n(13828),Ae=n(99505),Ne=n(82252),Le=n(79442),Fe=n(15612),Ie=n(9659),Be=n(12126),De=n(21140),Ee=n(53022),Ve=n(1498),Oe=n(25867),ze=n(7008),We=n(12953),He=n(94980),qe=n(52141),Ue=n(29206),_e={mobx:c,"mobx-state-tree":u,react:i,"react-dom":s,"mobx-react":l,"prop-types":f(),"@material-ui/core":h,"@material-ui/core/SvgIcon":m.Z,"@material-ui/core/utils":g,"@material-ui/lab":v,"@mui/x-data-grid":y,"@material-ui/data-grid":y,"@material-ui/core/colors":a,"@material-ui/core/styles":p,"@material-ui/core/Box":b.Z,"@material-ui/core/Button":x.Z,"@material-ui/core/ButtonGroup":w.Z,"@material-ui/core/Card":k.Z,"@material-ui/core/CardContent":C.Z,"@material-ui/core/Container":S.Z,"@material-ui/core/Checkbox":Z.Z,"@material-ui/core/Dialog":T.Z,"@material-ui/core/FormGroup":j.Z,"@material-ui/core/FormLabel":P.Z,"@material-ui/core/FormControl":R.Z,"@material-ui/core/FormControlLabel":M.Z,"@material-ui/core/Grid":A.Z,"@material-ui/core/Icon":N.Z,"@material-ui/core/IconButton":L.Z,"@material-ui/core/InputAdornment":F.Z,"@material-ui/core/LinearProgress":I.Z,"@material-ui/core/ListItemIcon":B.Z,"@material-ui/core/ListItemText":D.Z,"@material-ui/core/Menu":E.Z,"@material-ui/core/MenuItem":V.Z,"@material-ui/core/RadioGroup":z.Z,"@material-ui/core/Radio":O.Z,"@material-ui/core/Select":W.Z,"@material-ui/core/Snackbar":H.Z,"@material-ui/core/SnackbarContent":q.Z,"@material-ui/core/TextField":U.Z,"@material-ui/core/Tooltip":_.ZP,"@material-ui/core/Typography":G.Z,"@material-ui/lab/ToggleButton":J.Z,"@material-ui/lab/ToggleButtonGroup":X.Z,"@jbrowse/core/Plugin":ve.Z,"@jbrowse/core/pluggableElementTypes":r,"@jbrowse/core/pluggableElementTypes/ViewType":ie.Z,"@jbrowse/core/pluggableElementTypes/AdapterType":K.Z,"@jbrowse/core/pluggableElementTypes/DisplayType":ae.Z,"@jbrowse/core/pluggableElementTypes/TrackType":re.Z,"@jbrowse/core/pluggableElementTypes/WidgetType":ne.Z,"@jbrowse/core/pluggableElementTypes/models":ge,"@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType":he,"@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType":le.Z,"@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType":ue,"@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType":fe,"@jbrowse/core/pluggableElementTypes/renderers/RendererType":te,"@jbrowse/core/configuration":me,"@jbrowse/core/util/types/mst":Ue,"@jbrowse/core/ui":ye,"@jbrowse/core/util":be,"@jbrowse/core/util/color":xe,"@jbrowse/core/util/layouts":we,"@jbrowse/core/util/tracks":ke,"@jbrowse/core/util/Base1DViewModel":$.Z,"@jbrowse/core/util/io":Ce,"@jbrowse/core/util/mst-reflection":Ze,"@jbrowse/core/util/rxjs":Se,"@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail":Q,"@jbrowse/core/data_adapters/BaseAdapter":Y};["mobx","mobx-state-tree","react","react-dom","mobx-react","prop-types","@material-ui/core","@material-ui/core/SvgIcon","@material-ui/core/utils","@material-ui/lab","@mui/x-data-grid","@jbrowse/core/Plugin","@jbrowse/core/pluggableElementTypes","@jbrowse/core/pluggableElementTypes/ViewType","@jbrowse/core/pluggableElementTypes/AdapterType","@jbrowse/core/pluggableElementTypes/DisplayType","@jbrowse/core/pluggableElementTypes/TrackType","@jbrowse/core/pluggableElementTypes/WidgetType","@jbrowse/core/pluggableElementTypes/models","@jbrowse/core/pluggableElementTypes/renderers/ServerSideRendererType","@jbrowse/core/pluggableElementTypes/renderers/CircularChordRendererType","@jbrowse/core/pluggableElementTypes/renderers/BoxRendererType","@jbrowse/core/pluggableElementTypes/renderers/FeatureRendererType","@jbrowse/core/pluggableElementTypes/renderers/RendererType","@jbrowse/core/configuration","@jbrowse/core/util/types/mst","@jbrowse/core/ui","@jbrowse/core/util","@jbrowse/core/util/color","@jbrowse/core/util/layouts","@jbrowse/core/util/tracks","@jbrowse/core/util/Base1DViewModel","@jbrowse/core/util/io","@jbrowse/core/util/mst-reflection","@jbrowse/core/util/rxjs","@jbrowse/core/BaseFeatureWidget/BaseFeatureDetail","@jbrowse/core/data_adapters/BaseAdapter"].forEach((function(e){if(!(e in _e))throw new Error("ReExports/modules is missing ".concat(e))}));var Ge=_e},52185:function(e,t,n){"use strict";n.d(t,{R:function(){return c},Z:function(){return s}});var r=n(45754),a=n(86906),i=n(9249),o=n(87371),s=function(){function e(t){(0,i.Z)(this,e),this.label=void 0,this.renderingComponent=void 0,this.displayString=void 0,this.matchedAttribute=void 0,this.matchedObject=void 0,this.textSearchAdapter=void 0,this.relevance=void 0,this.trackId=void 0,this.score=void 0,this.locString=void 0,this.label=t.label,this.locString=t.locString,this.renderingComponent=t.renderingComponent,this.displayString=t.displayString,this.matchedAttribute=t.matchedAttribute,this.matchedObject=t.matchedObject,this.textSearchAdapter=t.textSearchAdapter,this.relevance=t.relevance,this.trackId=t.trackId,this.score=t.score||1}return(0,o.Z)(e,[{key:"getLabel",value:function(){return this.label}},{key:"getDisplayString",value:function(){return this.displayString||this.label}},{key:"getRenderingComponent",value:function(){return this.renderingComponent}},{key:"getTrackId",value:function(){return this.trackId}},{key:"getScore",value:function(){return this.score}},{key:"updateScore",value:function(e){return this.score=e,this.score}},{key:"getId",value:function(){return"".concat(this.getLabel(),"-").concat(this.getLocation(),"-").concat(this.getTrackId())}},{key:"getLocation",value:function(){return this.locString||this.label}}]),e}(),c=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r,a;return(0,i.Z)(this,n),(a=t.call(this,e)).refName=void 0,a.refName=null!==(r=e.refName)&&void 0!==r?r:"",a}return(0,o.Z)(n,[{key:"getLocation",value:function(){return this.refName}}]),n}(s)},76085:function(e,t,n){"use strict";n.d(t,{B:function(){return b},c:function(){return y}});var r=n(56666),a=n(96234),i=n(33028),o=n(40909),s=n(29206),c=n(32665);var u={stringArray:o.types.array(o.types.string),stringArrayMap:o.types.map(o.types.array(o.types.string)),numberMap:o.types.map(o.types.number),boolean:o.types.boolean,color:o.types.refinement("Color",o.types.string,(function(){return!0})),integer:o.types.integer,number:o.types.number,string:o.types.string,text:o.types.string,fileLocation:s.FileLocation,frozen:o.types.frozen()},l={stringArray:[],stringArrayMap:{},numberMap:{},boolean:!0,color:"black",integer:1,number:1,string:"",text:"",fileLocation:{uri:"/path/to/resource.txt",locationType:"UriLocation"},frozen:{}},d=function(e){return{views:{get valueJSON(){return e.value}}}},f=function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}}}},p={fileLocation:f,number:d,integer:d,boolean:d,frozen:f,stringArray:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t){e.value.push(t)},removeAtIndex:function(t){e.value.splice(t,1)},setAtIndex:function(t,n){e.value[t]=n}}}},stringArrayMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)},addToKey:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.push(n)},removeAtKeyIndex:function(t,n){var r=e.value.get(t);if(!r)throw new Error("".concat(t," not found"));r.splice(n,1)},setAtKeyIndex:function(t,n,r){var a=e.value.get(t);if(!a)throw new Error("".concat(t," not found"));a[n]=r}}}},numberMap:function(e){return{views:{get valueJSON(){return JSON.stringify(e.value)}},actions:{add:function(t,n){e.value.set(t,n)},remove:function(t){e.value.delete(t)}}}}},h=o.types.refinement("JexlString",o.types.string,(function(e){return e.startsWith("jexl:")}));var g=n(47741);function m(e){return Array.isArray(e)&&0===e.length}function v(e,t,n){var d,f={};if(n.explicitlyTyped&&(f.type=o.types.optional(o.types.literal(e),e)),n.explicitIdentifier&&n.implicitIdentifier)throw new Error("Cannot have both explicit and implicit identifiers in ".concat(e));n.explicitIdentifier?"string"===typeof n.explicitIdentifier?(f[n.explicitIdentifier]=o.types.identifier,d=n.explicitIdentifier):(f.id=o.types.identifier,d="id"):n.implicitIdentifier&&("string"===typeof n.implicitIdentifier?(f[n.implicitIdentifier]=s.ElementId,d=n.implicitIdentifier):(f.id=s.ElementId,d="id"));var v={isJBrowseConfigurationSchema:!0,jbrowseSchema:{modelName:e,definition:t,options:n}};Object.entries(t).forEach((function(t){var n=(0,a.Z)(t,2),r=n[0],i=n[1];if((0,o.isType)(i)&&(0,o.isLateType)(i)||(0,g.qN)(i))f[r]=i;else if("string"===typeof i||"number"===typeof i)v[r]=i;else{if("object"!==typeof i)throw new Error('invalid configuration schema definition, "'.concat(r,'" must be either a valid configuration slot definition, a constant, or a nested configuration schema'));if(!i.type)throw new Error("no type set for config slot ".concat(e,".").concat(r));try{f[r]=function(e,t){var n=t.description,r=void 0===n?"":n,a=t.model,i=t.type,s=t.defaultValue,d=t.contextVariable,f=void 0===d?[]:d;if(!i)throw new Error("type name required");if(a||(a=u[i]),!a)throw new Error('no builtin config slot type "'.concat(i,"\", and no 'model' param provided"));if(void 0===s)throw new Error("no 'defaultValue' provided");var g="".concat(e.charAt(0).toUpperCase()).concat(e.slice(1),"ConfigSlot"),m=o.types.model(g,{name:o.types.literal(e),description:o.types.literal(r),type:o.types.literal(i),value:o.types.optional(o.types.union(h,a),s)}).volatile((function(){return{contextVariable:f}})).views((function(e){return{get isCallback(){return String(e.value).startsWith("jexl:")}}})).views((function(e){return{get expr(){if(e.isCallback){var t=(0,o.getEnv)(e).pluginManager;return t||"undefined"!==typeof jest||console.warn("no pluginManager detected on config env (if you dynamically instantiate a config, for example in renderProps for your display model, check that you add the env argument)"),(0,c.P)(String(e.value),null===t||void 0===t?void 0:t.jexl)}return{evalSync:function(){return e.value}}},get valueJSON(){var t;if(!e.isCallback)return(t=e.value)&&t.toJSON?t.toJSON():'"'.concat(t,'"')}}})).preProcessSnapshot((function(t){return"object"===typeof t&&t.name===e?t:{name:e,description:r,type:i,value:t}})).postProcessSnapshot((function(e){return"object"===typeof e.value?JSON.stringify(e.value)!==JSON.stringify(s)?e.value:void 0:e.value!==s?e.value:void 0})).actions((function(e){return{set:function(t){e.value=t},reset:function(){e.value=s},convertToCallback:function(){e.isCallback||(e.value="jexl:".concat(e.valueJSON||"''"))},convertToValue:function(){if(e.isCallback){try{var t=e.expr.evalSync();if(void 0!==t)return void(e.value=t)}catch(n){}if(e.value=s,e.isCallback){if(!(i in l))throw new Error("no fallbackDefault defined for type ".concat(i));e.value=l[i]}}}}}));p[i]&&(m=m.extend(p[i]));var v=o.types.optional(m,{name:e,type:i,description:r,value:s});return Object.defineProperty(v,"isJBrowseConfigurationSlot",{value:!0}),v}(r,i)}catch(s){throw new Error("invalid config slot definition for ".concat(e,".").concat(r,": ").concat(s))}}}));var y=o.types.model("".concat(e,"ConfigurationSchema"),f).actions((function(e){return{setSubschema:function(t,n){if(!(0,g.qN)(f[t]))throw new Error("".concat(t," is not a subschema, cannot replace"));var r=(0,o.isStateTreeNode)(n)?n:f[t].create(n);return e[t]=r,r}}}));Object.keys(v).length&&(y=y.volatile((function(){return v}))),n.actions&&(y=y.actions(n.actions)),n.views&&(y=y.views(n.views)),n.extend&&(y=y.extend(n.extend));var b=d?(0,r.Z)({},d,"placeholderId"):{},x=n.explicitlyTyped?(0,i.Z)({type:e},b):b,w=(0,o.getSnapshot)(y.create(x));return y=y.postProcessSnapshot((function(e){for(var t,n={},r=!0,i=0,o=Object.entries(e);i<o.length;i++){var s=(0,a.Z)(o[i],2),c=s[0],u=s[1];r&&("object"===typeof w[c]&&"object"===typeof u?JSON.stringify(w[c])!==JSON.stringify(u)&&(r=!1):w[c]!==u&&(r=!1)),void 0!==u&&void 0===v[c]&&("object"!==typeof(t=u)||Array.isArray(t)||null===t||0!==Object.keys(t).length)&&!m(u)&&(n[c]=u)}return r?{}:n})),n.preProcessSnapshot&&(y=y.preProcessSnapshot(n.preProcessSnapshot)),o.types.optional(y,x)}function y(e,t,n){var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!==typeof e)throw new Error("first arg must be string name of the model that this config schema goes with");var r=t,a=n;return n.baseConfiguration&&n.baseConfiguration.jbrowseSchemaDefinition&&(r=(0,i.Z)((0,i.Z)({},n.baseConfiguration.jbrowseSchemaDefinition),r),delete(a=(0,i.Z)((0,i.Z)({},n.baseConfiguration.jbrowseSchemaOptions||{}),n)).baseConfiguration),{schemaDefinition:r,options:a}}(e,t,n),a=r.schemaDefinition,o=r.options,s=v(e,a,o);return s.isJBrowseConfigurationSchema=!0,s.jbrowseSchemaDefinition=a,s.jbrowseSchemaOptions=o,s}function b(e){return o.types.union(o.types.reference(e),e)}},47741:function(e,t,n){"use strict";n.d(t,{G:function(){return c},Pb:function(){return u},bc:function(){return s},mu:function(){return f},pS:function(){return o},qN:function(){return l},yt:function(){return d}});var r=n(68079),a=n(40909),i=n(88981);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide conf object to read");if(!t)return JSON.parse(JSON.stringify((0,a.getSnapshot)(e)));if("string"===typeof t){var r=e[t];if(!r&&(0,a.isStateTreeNode)(e)&&(0,a.isMapType)((0,a.getType)(e))&&(r=e.get(t)),!r)return;if(r.expr){var i=r.expr.evalSync(n);return(0,a.isStateTreeNode)(i)?JSON.parse(JSON.stringify((0,a.getSnapshot)(i))):i}return(0,a.isStateTreeNode)(r)?JSON.parse(JSON.stringify((0,a.getSnapshot)(r))):r}var s=t[0];if(t.length>1){var c=t.slice(1),u=e[s];return!u&&(0,a.isStateTreeNode)(e)&&(0,a.isMapType)((0,a.getType)(e))&&(u=e.get(s)),u?o(u,c,n):void 0}return o(e,s,n)}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new TypeError("must provide a model object");var r=e,a=r.configuration;if(d(a))return o(a,t,n);throw new TypeError("cannot getConf on this model, it has no configuration")}function c(e){if((0,a.isType)(e)&&(e=(0,i.resolveLateType)(e),(0,a.isUnionType)(e))){var t=[];return(0,i.getUnionSubTypes)(e).forEach((function(e){var n=c(e=(0,i.resolveLateType)(e));n.length||(n=[(0,i.getDefaultValue)(e).type]);if(!n[0])throw new Error("invalid config schema type ".concat(e));t.push.apply(t,(0,r.Z)(n))})),t}return[]}function u(e){if((0,a.isType)(e)){if((0,a.isModelType)(e)&&("isJBrowseConfigurationSchema"in e||e.name.includes("ConfigurationSchema")))return!0;if((0,a.isLateType)(e))return!0}return!1}function l(e){return!!(0,a.isType)(e)&&(!!u(e)||((0,a.isUnionType)(e)?(0,i.getUnionSubTypes)(e).every((function(e){return l(e)||"undefined"===e.name})):!(!(0,a.isOptionalType)(e)||!l((0,i.getSubType)(e)))||(!(!(0,a.isArrayType)(e)||!l((0,i.getSubType)(e)))||!(!(0,a.isMapType)(e)||!l((0,i.getSubType)(e))))))}function d(e){return(0,a.isStateTreeNode)(e)&&l((0,a.getType)(e))}function f(e){return"object"===typeof e&&null!==e&&"isJBrowseConfigurationSlot"in e}},29598:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseAdapter:function(){return x},BaseFeatureDataAdapter:function(){return w},BaseSequenceAdapter:function(){return k},isFeatureAdapter:function(){return S},isRefNameAliasAdapter:function(){return T},isRegionsAdapter:function(){return Z},isSequenceAdapter:function(){return C},isTextSearchAdapter:function(){return P}});var r=n(33028),a=n(68079),i=n(34795),o=n(45754),s=n(86906),c=n(87371),u=n(9249),l=n(77162),d=n.n(l),f=n(23288),p=n(26080),h=n(40909),g=n(26131),m=n(81073),v=n(9077),y=n(66518),b=n(37813),x=(0,c.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,v.ConfigurationSchema)("empty",{}).create(),n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;if((0,u.Z)(this,e),this.config=t,this.getSubAdapter=n,this.pluginManager=r,this.id=void 0,"undefined"===typeof jest){var a=(0,h.isStateTreeNode)(t)?(0,h.getSnapshot)(t):t;this.id="".concat((0,b.Z)(a))}else this.id="test"}));x.capabilities=[];var w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getConf",value:function(e){return(0,v.readConfObject)(this.config,e)}},{key:"getHeader",value:function(){var e=(0,i.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMetadata",value:function(){var e=(0,i.Z)(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeaturesInRegion",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,g.ObservableCreate)(function(){var r=(0,i.Z)(d().mark((function r(a){var i;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.hasDataForRefName(e.refName,n);case 2:i=r.sent,(0,m.checkAbortSignal)(n.signal),i?t.getFeatures(e,n).subscribe(a):a.complete();case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"getFeaturesInMultipleRegions",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.T.apply(void 0,(0,a.Z)(e.map((function(e){return t.getFeaturesInRegion(e,n)}))))}},{key:"hasDataForRefName",value:function(){var e=(0,i.Z)(d().mark((function e(t){var n,r,a=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:return r=e.sent,e.abrupt("return",r.includes(t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRegionStats",value:function(){var e=(0,i.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getFeatures(t,n),e.abrupt("return",(0,y.fK)(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMultiRegionStats",value:function(){var e=(0,i.Z)(d().mark((function e(){var t,n,r,a,i,o,s,c,u,l=this,f=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:[],n=f.length>1?f[1]:void 0,t.length){e.next=4;break}return e.abrupt("return",(0,y.fY)());case 4:return e.next=6,Promise.all(t.map((function(e){return l.getRegionStats(e,n)})));case 6:return r=e.sent,a=r.map((function(e){return e.scoreMax})).reduce((function(e,t){return Math.max(e,t)})),i=r.map((function(e){return e.scoreMin})).reduce((function(e,t){return Math.min(e,t)})),o=r.reduce((function(e,t){return e+t.scoreSum}),0),s=r.reduce((function(e,t){return e+t.scoreSumSquares}),0),c=r.reduce((function(e,t){return e+t.featureCount}),0),u=r.reduce((function(e,t){return e+t.basesCovered}),0),e.abrupt("return",(0,y.I9)({scoreMin:i,scoreMax:a,featureCount:c,basesCovered:u,scoreSumSquares:s,scoreSum:o}));case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"estimateRegionsStats",value:function(){var e=(0,i.Z)(d().mark((function e(t,n){var a,o,s,c,u=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}throw new Error("No regions to estimate stats for");case 2:return a=t[0],o=+Date.now(),s=function(){var e=(0,i.Z)(d().mark((function e(t,i){var o,s,l,f,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.start,s=a.end,l=.75*o+.25*s,f=(0,r.Z)((0,r.Z)({},a),{},{start:Math.max(0,Math.round(l-t/2)),end:Math.min(Math.round(l+t/2),s)}),e.next=5,u.getFeatures(f,n).pipe((0,p.q)()).toPromise();case 5:return h=e.sent,e.abrupt("return",c(t,{featureDensity:h.length/t},h.length,i));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=function(){var e=(0,i.Z)(d().mark((function e(t,n,r,i){var c,u;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.end-a.start,!(r>=70||2*t>c)){e.next=5;break}return e.abrupt("return",n);case 5:if(!(i<=5e3)){e.next=12;break}return u=+Date.now(),i+=u-o,o=u,e.abrupt("return",s(2*t,i));case 12:return console.warn("Stats estimation reached timeout, or didn't get enough features"),e.abrupt("return",{featureDensity:1/0});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),e.abrupt("return",s(1e3,0));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(x),k=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"estimateRegionsStats",value:function(){var e=(0,i.Z)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{featureDensity:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(w);function C(e){return"getRegions"in e&&"getFeatures"in e}function Z(e){return"getRegions"in e}function S(e){return"getFeatures"in e}function T(e){return"getRefNameAliases"in e}function P(e){return"searchIndex"in e}},3011:function(e,t,n){"use strict";n.d(t,{Yr:function(){return f},uP:function(){return l}});var r=n(96234),a=n(34795),i=n(77162),o=n.n(i),s=n(37813);function c(e){return"".concat((0,s.Z)(e))}var u={};function l(e,t,n){return d.apply(this,arguments)}function d(){return(d=(0,a.Z)(o().mark((function e(t,n,r){var a,i,s,d,f,p,h,g,m,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=c(r),u[a]){e.next=21;break}if(i=(r||{}).type){e.next=5;break}throw new Error("could not determine adapter type from adapter config snapshot");case 5:if(s=t.getAdapterType(i)){e.next=8;break}throw new Error("unknown data adapter type ".concat(i));case 8:if(d=s.configSchema.create(r,{pluginManager:t}),f=l.bind(null,t,n),p=s.AdapterClass,h=s.getAdapterClass,e.t0=p,e.t0){e.next=16;break}return e.next=15,h();case 15:e.t0=e.sent;case 16:if(g=e.t0){e.next=19;break}throw new Error("Failed to get adapter");case 19:m=new g(d,f,t),u[a]={dataAdapter:m,sessionIds:new Set([n])};case 21:return(v=u[a]).sessionIds.add(n),e.abrupt("return",v);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){var t=0,n=Object.keys(e);if(1===n.length&&"sessionId"===n[0]){var a=e.sessionId;Object.entries(u).forEach((function(e){var n=(0,r.Z)(e,2),i=n[0],o=n[1];o.sessionIds.delete(a),0===o.sessionIds.size&&(t+=1,delete u[i])}))}else Object.values(u).forEach((function(t){t.dataAdapter.freeResources?(e.regions||(e.region?[e.region]:[])).forEach((function(e){void 0!==e.refName&&t.dataAdapter.freeResources(e)})):console.warn(t.dataAdapter,"does not implement freeResources")}));return t}},93029:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(34795),a=n(87371),i=n(9249),o=n(45754),s=n(86906),c=n(77162),u=n.n(c),l=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var a;if((0,i.Z)(this,n),(a=t.call(this,e)).AdapterClass=void 0,a.getAdapterClass=void 0,a.configSchema=void 0,a.adapterCapabilities=void 0,a.adapterMetadata=void 0,"AdapterClass"in e)a.AdapterClass=e.AdapterClass,a.getAdapterClass=(0,r.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.AdapterClass);case 1:case"end":return t.stop()}}),t)})));else{if(!("getAdapterClass"in e))throw new Error("no AdapterClass or getAdapterClass is defined for adapter type ".concat(a.name));a.getAdapterClass=e.getAdapterClass}return a.configSchema=e.configSchema,a.adapterCapabilities=e.adapterCapabilities||[],a.adapterMetadata=e.adapterMetadata,a}return(0,a.Z)(n)}(n(78008).Z)},58096:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.displayName=void 0,r.description=void 0,r.url=void 0,r.configEditorComponent=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.displayName=e.displayName,r.description=e.description,r.url=e.url,r.configEditorComponent=e.configEditorComponent,!r.stateModel)throw new Error("no stateModel defined for connection ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema defined for connection ".concat(r.name));return r}return(0,r.Z)(n)}(n(78008).Z)},81575:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=n(78008),c=n(88981),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.ReactComponent=void 0,r.trackType=void 0,r.viewType=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,r.ReactComponent=e.ReactComponent,r.trackType=e.trackType,r.viewType=e.viewType,!r.stateModel)throw new Error("no stateModel defined for display ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for display ".concat(r.name));if(!r.ReactComponent)throw new Error("no ReactComponent provided for display ".concat(r.name));if(!r.trackType)throw new Error("no trackType provided for display ".concat(r.name));if(!r.viewType)throw new Error("no viewType provided for display ".concat(r.name));if(!(0,c.getDefaultValue)(r.configSchema).type){var i=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return r}return(0,r.Z)(n)}(s.Z)},15875:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=n(78008),c=n(88981),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).stateModel=void 0,r.configSchema=void 0,r.stateModel=e.stateModel,r.configSchema=e.configSchema,!r.stateModel)throw new Error("no stateModel defined for internet account type ".concat(r.name));if(!r.configSchema)throw new Error("no configSchema provided for internet account type ".concat(r.name));if(!(0,c.getDefaultValue)(r.configSchema).type){var i=r.configSchema?r.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return r}return(0,r.Z)(n)}(s.Z)},78008:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(87371),a=n(9249),i=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.name="",this.name=t.name}))},71036:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var r=n(41361),a=n(33028),i=n(34795),o=n(9249),s=n(87371),c=n(45754),u=n(86906),l=n(77162),d=n.n(l),f=n(78008),p=n(97891),h=n(40909),g=n(8438),m=n(94943),v=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,{name:""})).pluginManager=e,r.name="UNKNOWN",r}return(0,s.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,i.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,p.getBlobMap)(),e.next=3,this.augmentLocationObjects(t);case 3:return e.abrupt("return",(0,a.Z)((0,a.Z)({},t),{},{blobMap:r}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeNewAuthArguments",value:function(){var e=(0,i.Z)(d().mark((function e(t){var n,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.pluginManager.rootModel,(0,g.dc)(n)&&!t.internetAccountPreAuthorization){e.next=3;break}return e.abrupt("return",t);case 3:if(!(r=null===n||void 0===n?void 0:n.findAppropriateInternetAccount(t))){e.next=8;break}return e.next=7,r.getPreAuthorizationInformation(t);case 7:t.internetAccountPreAuthorization=e.sent;case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deserializeArguments",value:function(){var e=(0,i.Z)(d().mark((function e(t,n){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.blobMap&&(0,p.setBlobMap)(t.blobMap),!(r=t.signal)||!(0,m.k$)(r)){e.next=4;break}return e.abrupt("return",(0,a.Z)((0,a.Z)({},t),{},{signal:(0,m.ie)(r)}));case 4:return e.abrupt("return",(0,a.Z)((0,a.Z)({},t),{},{signal:void 0}));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeReturn",value:function(){var e=(0,i.Z)(d().mark((function e(t,n,r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,i.Z)(d().mark((function e(t,n,r){var a,i,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.pluginManager.rootModel,e.prev=1,e.next=4,t;case 4:a=e.sent,e.next=13;break;case 7:if(e.prev=7,e.t0=e.catch(1),!(0,g.PK)(e.t0)){e.next=12;break}throw o=null===i||void 0===i?void 0:i.createEphemeralInternetAccount("HTTPBasicInternetAccount-".concat(new URL(e.t0.url).origin),{},e.t0.url),new g.Ms("Retrying with created internet account",o.internetAccountId);case 12:throw e.t0;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"augmentLocationObjects",value:function(){var e=(0,i.Z)(d().mark((function e(t){var n,a,i,o,s,c,u,l,f;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,h.isStateTreeNode)(t)||(0,h.isAlive)(t)){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,g.hb)(t)){e.next=5;break}return e.next=5,this.serializeNewAuthArguments(t);case 5:if(!Array.isArray(t)){e.next=23;break}n=(0,r.Z)(t),e.prev=7,n.s();case 9:if((a=n.n()).done){e.next=15;break}return i=a.value,e.next=13,this.augmentLocationObjects(i);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),n.e(e.t0);case 20:return e.prev=20,n.f(),e.finish(20);case 23:if("object"!==typeof t||null===t){e.next=53;break}o=0,s=Object.values(t);case 25:if(!(o<s.length)){e.next=53;break}if(c=s[o],!Array.isArray(c)){e.next=47;break}u=(0,r.Z)(c),e.prev=29,u.s();case 31:if((l=u.n()).done){e.next=37;break}return f=l.value,e.next=35,this.augmentLocationObjects(f);case 35:e.next=31;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(29),u.e(e.t1);case 42:return e.prev=42,u.f(),e.finish(42);case 45:e.next=50;break;case 47:if("object"!==typeof c||null===c){e.next=50;break}return e.next=50,this.augmentLocationObjects(c);case 50:o++,e.next=25;break;case 53:case"end":return e.stop()}}),e,this,[[7,17,20,23],[29,39,42,45]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(f.Z)},31145:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).AdapterClass=void 0,r.configSchema=void 0,r.description=void 0,r.description=e.description,r.configSchema=e.configSchema,r.AdapterClass=e.AdapterClass,!r.AdapterClass)throw new Error("no AdapterClass defined for adapter type ".concat(r.name));return r}return(0,r.Z)(n)}(n(78008).Z)},82044:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(78008),c=n(88981),u=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;if((0,r.Z)(this,n),(a=t.call(this,e)).stateModel=void 0,a.configSchema=void 0,a.displayTypes=[],a.stateModel=e.stateModel,a.configSchema=e.configSchema,!a.stateModel)throw new Error("no stateModel defined for track ".concat(a.name));if(!a.configSchema)throw new Error("no configSchema provided for track ".concat(a.name));if(!(0,c.getDefaultValue)(a.configSchema).type){var i=a.configSchema?a.configSchema.name:"UNKNOWN";throw new Error("".concat(i," is not explicitlyTyped"))}return a}return(0,a.Z)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(s.Z)},39798:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;if((0,r.Z)(this,n),(a=t.call(this,e)).ReactComponent=void 0,a.stateModel=void 0,a.displayTypes=[],a.ReactComponent=e.ReactComponent,a.stateModel=e.stateModel,!a.ReactComponent)throw new Error("no ReactComponent defined for view ".concat(a.name));if(!a.stateModel)throw new Error("no stateModel defined for view ".concat(a.name));return a}return(0,a.Z)(n,[{key:"addDisplayType",value:function(e){this.displayTypes.push(e)}}]),n}(n(78008).Z)},66737:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).heading=void 0,r.configSchema=void 0,r.HeadingComponent=void 0,r.ReactComponent=void 0,r.stateModel=void 0,r.heading=e.heading,r.HeadingComponent=e.HeadingComponent,r.configSchema=e.configSchema,r.stateModel=e.stateModel,r.ReactComponent=e.ReactComponent,!r.ReactComponent)throw new Error("no ReactComponent defined for widget ".concat(r.name));if(!r.stateModel)throw new Error("no stateModel defined for widget ".concat(r.name));return r}return(0,r.Z)(n)}(n(78008).Z)},20478:function(e,t,n){"use strict";var r=n(40909),a=n(29206),i=r.types.model("BaseView",{id:a.ElementId,displayName:r.types.maybe(r.types.string)}).volatile((function(){return{width:800}})).views((function(){return{menuItems:function(){return[]}}})).actions((function(e){return{setDisplayName:function(t){e.displayName=t},setWidth:function(t){e.width=t}}}));t.Z=i},59853:function(e,t,n){"use strict";n.r(t),n.d(t,{BaseConnectionModelFactory:function(){return s},BaseDisplay:function(){return f},BaseInternetAccountConfig:function(){return b},BaseViewModel:function(){return c.Z},InternetAccount:function(){return y},baseConnectionConfig:function(){return a},createBaseTrackConfig:function(){return Z},createBaseTrackModel:function(){return C}});var r=n(9077),a=(0,r.ConfigurationSchema)("BaseConnection",{name:{type:"string",defaultValue:"nameOfConnection",description:"a unique name for this connection"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of names of assemblies in this connection"}},{explicitlyTyped:!0,explicitIdentifier:"connectionId"}),i=n(68079),o=n(40909),s=function(e){return o.types.model("Connection",{name:o.types.identifier,tracks:o.types.array(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{afterAttach:function(){e.tracks.length||e.connect(e.configuration)},addTrackConf:function(t){var n=e.tracks.push(t);return e.tracks[n-1]},addTrackConfs:function(t){var n,r=(n=e.tracks).push.apply(n,(0,i.Z)(t));return e.tracks.slice(r-1-t.length,r-1)},setTrackConfs:function(t){return e.tracks=t,e.tracks},clear:function(){}}}))},c=n(20478),u=n(33028),l=n(97891),d=n(29206),f=o.types.model("BaseDisplay",{id:d.ElementId,type:o.types.string,rpcDriverName:o.types.maybe(o.types.string)}).volatile((function(){return{rendererTypeName:"",error:void 0}})).views((function(e){return{get RenderingComponent(){return(0,o.getEnv)(e).pluginManager.getDisplayType(e.type).ReactComponent},get DisplayBlurb(){return null},get adapterConfig(){return(0,r.getConf)(this.parentTrack,"adapter")},get parentTrack(){for(var t=(0,o.getParent)(e);!t.configuration||!(0,r.getConf)(t,"trackId");){if((0,o.isRoot)(t))throw new Error("No parent track found for ".concat(e.type," ").concat(e.id));t=(0,o.getParent)(t)}return t},renderProps:function(){return(0,u.Z)((0,u.Z)({},(0,l.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e})},get rendererType(){var t=(0,o.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!t)throw new Error('renderer "'.concat(e.rendererTypeName,'" not found'));if(!t.ReactComponent)throw new Error("renderer ".concat(e.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return t},get DisplayMessageComponent(){},trackMenuItems:function(){return[]},get viewMenuActions(){return[]},regionCannotBeRendered:function(){}}})).actions((function(e){return{setError:function(t){e.error=t},setRpcDriverName:function(t){e.rpcDriverName=t},reload:function(){}}})),p=n(34795),h=n(77162),g=n.n(h),m=n(33528),v="undefined"===typeof sessionStorage,y=o.types.model("InternetAccount",{id:d.ElementId,type:o.types.string}).views((function(e){return{get name(){return(0,r.getConf)(e,"name")},get description(){return(0,r.getConf)(e,"description")},get internetAccountId(){return(0,r.getConf)(e,"internetAccountId")},get authHeader(){return(0,r.getConf)(e,"authHeader")},get tokenType(){return(0,r.getConf)(e,"tokenType")},get domains(){return(0,r.getConf)(e,"domains")},get toggleContents(){return null},get SelectorComponent(){},get selectorLabel(){}}})).views((function(e){return{handlesLocation:function(t){return e.domains.some((function(e){return null===t||void 0===t?void 0:t.uri.includes(e)}))},get tokenKey(){return"".concat(e.internetAccountId,"-token")}}})).actions((function(e){return{getTokenFromUser:function(e,t){throw new Error("getTokenFromUser must be implemented by extending model")},storeToken:function(t){sessionStorage.setItem(e.tokenKey,t)},removeToken:function(){sessionStorage.removeItem(e.tokenKey)},retrieveToken:function(){return sessionStorage.getItem(e.tokenKey)},validateToken:function(e,t){return(0,p.Z)(g().mark((function t(){return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)})))()}}})).actions((function(e){var t=void 0;return{getToken:function(n){return(0,p.Z)(g().mark((function r(){var a,i,o;return g().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return",t);case 2:if(!(o=null===n||void 0===n||null===(a=n.internetAccountPreAuthorization)||void 0===a||null===(i=a.authInfo)||void 0===i?void 0:i.token)){r.next=6;break}return t=Promise.resolve(o),r.abrupt("return",t);case 6:if(!v){r.next=8;break}throw new Error("Did not get internet account pre-authorization info in worker");case 8:if(!(o=e.retrieveToken())){r.next=12;break}return t=Promise.resolve(o),r.abrupt("return",t);case 12:return t=new Promise((function(t,n){e.getTokenFromUser((function(n){e.storeToken(n),t(n)}),(function(t){e.removeToken(),n(t)}))})),r.abrupt("return",t);case 14:case"end":return r.stop()}}),r)})))()}}})).actions((function(e){return{addAuthHeaderToInit:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=e.tokenType?"".concat(e.tokenType," ").concat(n):n,a=new Headers(t.headers||{});return a.append(e.authHeader,r),(0,u.Z)((0,u.Z)({},t),{},{headers:a})},getPreAuthorizationInformation:function(t){return(0,p.Z)(g().mark((function n(){var a,i;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return a=n.sent,n.prev=3,n.next=6,e.validateToken(a,t);case 6:i=n.sent,n.next=13;break;case 9:throw n.prev=9,n.t0=n.catch(3),e.removeToken(),n.t0;case 13:return n.abrupt("return",{internetAccountType:e.type,authInfo:{token:i,configuration:(0,r.getConf)(e)}});case 14:case"end":return n.stop()}}),n,null,[[3,9]])})))()}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,p.Z)(g().mark((function n(r,a){var i,o;return g().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return i=n.sent,o=e.addAuthHeaderToInit(a,i),n.abrupt("return",fetch(r,o));case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}}})).actions((function(e){return{openLocation:function(t){return new m.RemoteFileWithRangeCache(t.uri,{fetch:e.getFetcher(t)})}}})),b=(0,r.ConfigurationSchema)("InternetAccount",{name:{description:"descriptive name of the internet account",type:"string",defaultValue:""},description:{description:"a description of the internet account",type:"string",defaultValue:""},authHeader:{description:"request header for credentials",type:"string",defaultValue:"Authorization"},tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:""},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:[]}},{explicitIdentifier:"internetAccountId",explicitlyTyped:!0}),x=n(35247),w=n(81073),k=n(8438);function C(e,t,n){return o.types.model(t,{id:d.ElementId,type:o.types.literal(t),configuration:(0,r.ConfigurationReference)(n),displays:o.types.array(e.pluggableMstType("display","stateModel"))}).views((function(e){return{get rpcSessionId(){return e.configuration.trackId},get name(){return(0,r.getConf)(e,"name")},get textSearchAdapter(){return(0,r.getConf)(e,"textSearchAdapter")},get adapterType(){var t=(0,r.getConf)(e,"adapter"),n=(0,o.getEnv)(e).pluginManager;if(!t)throw new Error("no adapter configuration provided for ".concat(e.type));var a=n.getAdapterType(t.type);if(!a)throw new Error("unknown adapter type ".concat(t.type));return a},get viewMenuActions(){var t=[];return e.displays.forEach((function(e){t.push.apply(t,(0,i.Z)(e.viewMenuActions))})),t},get canConfigure(){var t=(0,w.getSession)(e);return(0,k.cX)(t)&&(t.adminMode||t.sessionTracks.find((function(t){return t.trackId===e.configuration.trackId})))}}})).actions((function(t){return{activateConfigurationUI:function(){var e=(0,w.getSession)(t),n=(0,w.getContainingView)(t);if((0,k.cX)(e)){var r=e.editTrackConfiguration(t.configuration);r&&r!==t.configuration&&(n.hideTrack(t.configuration),n.showTrack(r))}},showDisplay:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("display"),i=(0,o.resolveIdentifier)(a,(0,o.getRoot)(t),n),s=e.getDisplayType(i.type);if(!s)throw new Error("unknown display type ".concat(i.type));var c=s.stateModel.create((0,u.Z)((0,u.Z)({},r),{},{type:i.type,configuration:i}));t.displays.push(c)},hideDisplay:function(n){var r=e.pluggableConfigSchemaType("display"),a=(0,o.resolveIdentifier)(r,(0,o.getRoot)(t),n),i=t.displays.filter((function(e){return e.configuration===a}));return(0,x.transaction)((function(){return i.forEach((function(e){return t.displays.remove(e)}))})),i.length},replaceDisplay:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.displays.findIndex((function(e){return e.configuration.displayId===n}));if(-1===i)throw new Error("could not find display id ".concat(n," to replace"));var s=e.pluggableConfigSchemaType("display"),c=(0,o.resolveIdentifier)(s,(0,o.getRoot)(t),r),l=e.getDisplayType(c.type);if(!l)throw new Error("unknown display type ".concat(c.type));t.displays.splice(i,1,(0,u.Z)((0,u.Z)({},a),{},{type:c.type,configuration:c}))}}})).views((function(t){return{trackMenuItems:function(){var n=[];t.displays.forEach((function(e){n.push.apply(n,(0,i.Z)(e.trackMenuItems()))}));var r=[],a=(0,w.getContainingView)(t),o=e.getViewType(a.type).displayTypes.map((function(e){return e.name})),s=t.configuration.displays.filter((function(e){return o.includes(e.type)})),c=t.displays[0].configuration.displayId;return s.length>1&&(r.push({type:"divider"},{type:"subHeader",label:"Display types"}),s.forEach((function(e){r.push({type:"radio",label:e.type,checked:e.displayId===c,onClick:function(){return t.replaceDisplay(c,e.displayId)}})}))),[].concat(n,r)}}}))}function Z(e){return(0,r.ConfigurationSchema)("BaseTrack",{name:{description:"descriptive name of the track",type:"string",defaultValue:"Track"},assemblyNames:{description:"name of the assembly (or assemblies) track belongs to",type:"stringArray",defaultValue:["assemblyName"]},description:{description:"a description of the track",type:"string",defaultValue:""},category:{description:"the category and sub-categories of a track",type:"stringArray",defaultValue:[]},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}},adapter:e.pluggableConfigSchemaType("adapter"),textSearching:(0,r.ConfigurationSchema)("textSearching",{indexingAttributes:{type:"stringArray",description:"list of which feature attributes to index for text searching",defaultValue:["Name","ID"]},indexingFeatureTypesToExclude:{type:"stringArray",description:"list of feature types to exclude in text search index",defaultValue:["CDS","exon"]},textSearchAdapter:e.pluggableConfigSchemaType("text search adapter")}),displays:o.types.array(e.pluggableConfigSchemaType("display"))},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),r=new Set,a=n.displays,i=void 0===a?[]:a;"placeholderId"!==n.trackId&&(i.forEach((function(e){return e&&r.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){r.has(e.name)||i.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})})));return(0,u.Z)((0,u.Z)({},n),{},{displays:i})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}},21339:function(e,t,n){"use strict";n.r(t),n.d(t,{LayoutSession:function(){return k},default:function(){return C}});var r=n(96234),a=n(34795),i=n(33028),o=n(93069),s=n(95058),c=n(45754),u=n(86906),l=n(9249),d=n(87371),f=n(77162),p=n.n(f),h=n(59264),g=n.n(h),m=n(26354),v=n(35064),y=n(2972),b=n(29637),x=n(81073),w=n(9077),k=function(){function e(t){(0,l.Z)(this,e),this.config=void 0,this.bpPerPx=void 0,this.filters=void 0,this.cachedLayout=void 0,this.config=t.config,this.bpPerPx=t.bpPerPx,this.filters=t.filters,this.update(t)}return(0,d.Z)(e,[{key:"update",value:function(e){Object.assign(this,e)}},{key:"makeLayout",value:function(){return new v.Z(m.Z,{maxHeight:(0,w.readConfObject)(this.config,"maxHeight"),displayMode:(0,w.readConfObject)(this.config,"displayMode"),pitchX:this.bpPerPx,pitchY:(0,w.readConfObject)(this.config,"noSpacing")?1:3})}},{key:"cachedLayoutIsValid",value:function(e){return e&&e.layout.subLayoutConstructorArgs.pitchX===this.bpPerPx&&g()((0,w.readConfObject)(this.config),e.config)&&g()(this.filters,e.filters)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,w.readConfObject)(this.config),filters:this.filters}),this.cachedLayout.layout}}]),e}(),C=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;(0,l.Z)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).sessions={},e}return(0,d.Z)(n,[{key:"getWorkerSession",value:function(e){var t=(0,x.getLayoutId)(e);this.sessions[t]||(this.sessions[t]=this.createSession(e));var n=this.sessions[t];return n.update(e),n}},{key:"getExpandedRegion",value:function(e,t){if(!e)return e;var n=t.bpPerPx,r=t.config,a=void 0===r?0:(0,w.readConfObject)(r,"maxFeatureGlyphExpansion");if(!a)return e;var o=Math.round(a*n);return(0,i.Z)((0,i.Z)({},e),{},{start:Math.floor(Math.max(e.start-o,0)),end:Math.ceil(e.end+o)})}},{key:"createSession",value:function(e){return new k(e)}},{key:"freeResourcesInClient",value:function(){var e=(0,a.Z)(p().mark((function e(t,r){var a,i,c,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.regions,i=(0,x.getLayoutId)(r),c=0,u=this.sessions[i],!a&&u&&(delete this.sessions[i],c=1),u&&a&&u.layout.discardRange(a[0].refName,a[0].start,a[0].end),e.t0=c,e.next=9,(0,o.Z)((0,s.Z)(n.prototype),"freeResourcesInClient",this).call(this,t,r);case 9:return e.t1=e.sent,e.abrupt("return",e.t0+e.t1);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeLayoutInClient",value:function(e){return new y.Z(e)}},{key:"deserializeResultsInClient",value:function(e,t){var r=this.deserializeLayoutInClient(e.layout);return(0,o.Z)((0,s.Z)(n.prototype),"deserializeResultsInClient",this).call(this,(0,i.Z)((0,i.Z)({},e),{},{layout:r}),t)}},{key:"createLayoutInWorker",value:function(e){var t=e.regions;return this.getWorkerSession(e).layout.getSublayout(t[0].refName)}},{key:"serializeResultsInWorker",value:function(e,t){var a=(0,o.Z)((0,s.Z)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),i=(0,r.Z)(t.regions,1)[0];return a.layout=e.layout.serializeRegion(this.getExpandedRegion(i,t)),a.layout.rectangles&&(a.features=a.features.filter((function(e){return Boolean(a.layout.rectangles[e.uniqueId])}))),a.maxHeightReached=a.layout.maxHeightReached,a}},{key:"render",value:function(){var e=(0,a.Z)(p().mark((function e(t){var r,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layout||this.createLayoutInWorker(t),e.next=3,(0,o.Z)((0,s.Z)(n.prototype),"render",this).call(this,(0,i.Z)((0,i.Z)({},t),{},{layout:r}));case 3:return a=e.sent,e.abrupt("return",(0,i.Z)((0,i.Z)({},a),{},{layout:r}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(b.default)},54215:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(n(29637).default)},43103:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var r=n(33028),a=n(34795),i=n(9249),o=n(87371),s=n(93069),c=n(95058),u=n(45754),l=n(86906),d=n(77162),f=n.n(d),p=n(56298),h=n(26080),g=n(67688),m=n(3011),v=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,a.Z)(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"serializeArgsInClient",value:function(e){var t=(0,r.Z)((0,r.Z)({},e),{},{displayModel:{}});return(0,s.Z)((0,c.Z)(n.prototype),"serializeArgsInClient",this).call(this,t)}},{key:"deserializeResultsInClient",value:function(e,t){var a=(0,s.Z)((0,c.Z)(n.prototype),"deserializeResultsInClient",this).call(this,e,t);return(0,r.Z)((0,r.Z)({},a),{},{blockKey:t.blockKey})}},{key:"renderInClient",value:function(){var e=(0,a.Z)(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"ComparativeRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"getFeatures",value:function(){var e=(0,a.Z)(f().mark((function e(t){var n,a,i,o,s,c,u,l,d=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,a=t.sessionId,i=t.adapterConfig,e.next=3,(0,m.uP)(this.pluginManager,a,i);case 3:if(o=e.sent,s=o.dataAdapter,c=[],(c=t.regions)&&0!==c.length){e.next=10;break}return console.warn("no regions supplied to comparative renderer"),e.abrupt("return",[]);case 10:return u=c.map((function(e){var t=(0,r.Z)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.floor(t.end)),t})),l=s.getFeaturesInMultipleRegions(u,{signal:n}),e.abrupt("return",l.pipe((0,p.h)((function(e){return d.featurePassesFilters(t,e)})),(0,h.q)()).toPromise());case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(g.default)},29637:function(e,t,n){"use strict";n.r(t),n.d(t,{NewFeatureRendererType:function(){return b},default:function(){return y}});var r=n(34795),a=n(33028),i=n(9249),o=n(87371),s=n(93069),c=n(95058),u=n(45754),l=n(86906),d=n(77162),f=n.n(d),p=n(26080),h=n(81073),g=n(14956),m=n(3011),v=n(67688),y=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"serializeArgsInClient",value:function(e){var t=e.displayModel,r=e.regions,i=(0,a.Z)((0,a.Z)({},e),{},{displayModel:t&&{id:t.id,selectedFeatureId:t.selectedFeatureId},regions:JSON.parse(JSON.stringify(r))});return(0,s.Z)((0,c.Z)(n.prototype),"serializeArgsInClient",this).call(this,i)}},{key:"deserializeResultsInClient",value:function(e,t){var r=new Map;e.features.forEach((function(e){var t=g.Z.fromJSON(e);r.set(String(t.id()),t)}));var i=(0,s.Z)((0,c.Z)(n.prototype),"deserializeResultsInClient",this).call(this,(0,a.Z)((0,a.Z)({},e),{},{features:r}),t);return(0,a.Z)((0,a.Z)({},i),{},{blockKey:t.blockKey,features:r})}},{key:"serializeResultsInWorker",value:function(e,t){var r=(0,s.Z)((0,c.Z)(n.prototype),"serializeResultsInWorker",this).call(this,e,t),i=e.features;return(0,a.Z)((0,a.Z)({},r),{},{features:(0,h.iterMap)(i.values(),(function(e){return e.toJSON()}),i.size)})}},{key:"getExpandedRegion",value:function(e,t){return e}},{key:"getFeatures",value:function(){var e=(0,r.Z)(f().mark((function e(t){var n,r,i,o,s,c,u,l,d,g,v,y=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,r=t.regions,i=t.sessionId,o=t.adapterConfig,e.next=3,(0,m.uP)(this.pluginManager,i,o);case 3:if(s=e.sent,c=s.dataAdapter,u=new Map,r&&0!==r.length){e.next=8;break}return e.abrupt("return",u);case 8:return l=r.map((function(e){var t=(0,a.Z)({},e);return t.start&&(t.start=Math.floor(t.start)),t.end&&(t.end=Math.ceil(t.end)),t})),d=l[0],g=1===l.length?c.getFeatures(this.getExpandedRegion(d,t),t):c.getFeaturesInMultipleRegions(l,t),e.next=13,g.pipe((0,p.q)()).toPromise();case 13:return v=e.sent,(0,h.checkAbortSignal)(n),e.abrupt("return",new Map(v.filter((function(e){return y.featurePassesFilters(t,e)})).map((function(e){return[e.id(),e]}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featurePassesFilters",value:function(e,t){return!e.filters||e.filters.passes(t,e)}},{key:"render",value:function(){var e=(0,r.Z)(f().mark((function e(t){var r,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.features,e.t0){e.next=5;break}return e.next=4,this.getFeatures(t);case 4:e.t0=e.sent;case 5:return r=e.t0,e.next=8,(0,s.Z)((0,c.Z)(n.prototype),"render",this).call(this,(0,a.Z)((0,a.Z)({},t),{},{features:r}));case 8:return i=e.sent,e.abrupt("return",(0,a.Z)((0,a.Z)({},i),{},{features:r}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(v.default),b=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n)}(v.default)},86297:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var r=n(34795),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(77162),u=n.n(c),l=n(30969),d=n(88981),f=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;if((0,a.Z)(this,n),(r=t.call(this,e)).ReactComponent=void 0,r.supportsSVG=!1,r.configSchema=void 0,r.pluginManager=void 0,r.ReactComponent=e.ReactComponent,r.configSchema=e.configSchema,r.pluginManager=e.pluginManager,!r.ReactComponent)throw new Error("no ReactComponent defined for renderer ".concat(r.name));if(!(0,d.getDefaultValue)(r.configSchema).type)throw new Error("".concat(r.name," config schema ").concat(r.configSchema.name," is not explicitlyTyped"));if(!r.pluginManager)throw new Error("no plugin manager defined for renderer ".concat(r.name));return r}return(0,i.Z)(n,[{key:"render",value:function(){var e=(0,r.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{reactElement:l.createElement(this.ReactComponent,t,null)});case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){return 0}}]),n}(n(78008).Z)},79321:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(33028),a=n(59740),i=n(60734),o=n(30969),s=n(15749),c=n(24998),u=n(81073),l=n(37574),d=["theme","html","RenderingComponent"];function f(e){var t=(0,o.useRef)(null),n=e.theme,f=e.html,p=e.RenderingComponent,h=(0,a.Z)(e,d),g=(0,c.createJBrowseTheme)(n);return(0,o.useEffect)((function(){var e=t.current;return e&&(e&&(0,s.unmountComponentAtNode)(e),e.innerHTML=f,(0,u.rIC)((function(){(0,s.hydrate)((0,l.jsx)(i.Z,{theme:g,children:(0,l.jsx)(p,(0,r.Z)({},h))}),e)}),{timeout:300})),function(){e&&(0,s.unmountComponentAtNode)(e)}}),[f,g,h,p]),(0,l.jsx)("div",{ref:t,"data-html-size":f.length,className:"ssr-container"})}},67688:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n(34795),a=n(59740),i=n(33028),o=n(9249),s=n(87371),c=n(45754),u=n(86906),l=n(77162),d=n.n(l),f=(n(30969),n(60734)),p=n(2082),h=n(40909),g=n(81073),m=n(86297),v=n(37386),y=n(24998),b=n(79321),x=n(37574),w=["html"],k=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"serializeArgsInClient",value:function(e){return(0,i.Z)((0,i.Z)({},e),{},{config:(0,h.isStateTreeNode)(e.config)?(0,h.getSnapshot)(e.config):e.config,filters:e.filters&&e.filters.toJSON().filters})}},{key:"deserializeResultsInClient",value:function(e,t){e.html;var n=(0,a.Z)(e,w);return t.exportSVG?(0,i.Z)((0,i.Z)({},e),{},{html:this.supportsSVG?e.html:'<text y="12" fill="black">SVG export not supported for this track</text>'}):(0,i.Z)((0,i.Z)({},n),{},{reactElement:(0,x.jsx)(b.Z,(0,i.Z)((0,i.Z)((0,i.Z)({},t),e),{},{RenderingComponent:this.ReactComponent}))})}},{key:"deserializeArgsInWorker",value:function(e){var t=(0,i.Z)({},e);return t.config=this.configSchema.create(e.config||{},{pluginManager:this.pluginManager}),t.filters=new v.Z({filters:e.filters}),t}},{key:"serializeResultsInWorker",value:function(e,t){var n=(0,p.renderToString)((0,x.jsx)(f.Z,{theme:(0,y.createJBrowseTheme)(t.theme),children:e.reactElement}));return delete e.reactElement,(0,i.Z)((0,i.Z)({},e),{},{html:n})}},{key:"renderInClient",value:function(){var e=(0,r.Z)(d().mark((function e(t,n){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.call(n.sessionId,"CoreRender",n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"renderInWorker",value:function(){var e=(0,r.Z)(d().mark((function e(t){var n,r,a,i,o,s=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.signal,r=t.statusCallback,a=void 0===r?function(){}:r,i=this.deserializeArgsInWorker(t),e.next=4,(0,g.updateStatus)("Rendering plot",a,(function(){return s.render(i)}));case 4:return o=e.sent,(0,g.checkAbortSignal)(n),e.abrupt("return",(0,g.updateStatus)("Serializing results",a,(function(){return s.serializeResultsInWorker(o,i)})));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResourcesInClient",value:function(){var e=(0,r.Z)(d().mark((function e(t,n){var r,a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.serializeArgsInClient(n),a=this.freeResources(),e.next=4,t.call(n.sessionId,"CoreFreeResources",r);case 4:return i=e.sent,e.abrupt("return",a+i);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(m.default)},37386:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(9249),a=n(87371),i=n(32665),o=function(){function e(t){var n=t.filters,a=void 0===n?[]:n;(0,r.Z)(this,e),this.filterChain=void 0,this.filterChain=a.map((function(e){if("string"===typeof e)return{expr:(0,i.P)(e),string:e};throw new Error('invalid inputFilter string "'.concat(e,'"'))}))}return(0,a.Z)(e,[{key:"passes",value:function(){for(var e=0;e<this.filterChain.length;e+=1)if(!this.filterChain[e].expr.evalSync({feature:arguments.length<=0?void 0:arguments[0]}))return!1;return!0}},{key:"toJSON",value:function(){return{filters:this.filterChain.map((function(e){return e.string}))}}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}()},80303:function(e,t,n){"use strict";n.d(t,{Z:function(){return M}});var r=n(96234),a=n(30969),i=n(22714),o=n(53239),s=n(58257),c=n(36051),u=n(43175),l=n(80975),d=n(1720),f=n(81690),p=n(32343),h=n(317),g=n(11112),m=n(90550),v=n(40909),y=n(53017),b=n(14008),x=n(2638),w=n(36371),k=n(51526),C=n(26737),Z=n(37574),S=(0,i.Z)((function(e){return{paper:{overflowY:"auto",height:"100%",zIndex:e.zIndex.drawer,outline:"none",background:e.palette.background.default},resizeHandle:{width:4,position:"fixed",top:0,zIndex:e.zIndex.drawer+1}}}));var T=(0,m.observer)((function(e){var t=e.children,n=e.session,r=n.drawerPosition,a=n.drawerWidth,i=S();return(0,Z.jsxs)(k.Z,{className:i.paper,elevation:16,square:!0,children:["right"===r?(0,Z.jsx)(C.Z,{onDrag:n.resizeDrawer,className:i.resizeHandle,vertical:!0}):null,t,"left"===r?(0,Z.jsx)(C.Z,{onDrag:n.resizeDrawer,className:i.resizeHandle,style:{left:a},vertical:!0}):null]})})),P=(0,i.Z)((function(e){return{drawerActions:{float:"right","&:hover":{backgroundColor:(0,o.Fq)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},drawerToolbar:{paddingLeft:e.spacing(2)},spacer:{flexGrow:1},drawerSelect:{color:e.palette.secondary.contrastText},drawerLoading:{margin:e.spacing(2)},dropDownIcon:{color:e.palette.secondary.contrastText},header:{background:e.palette.secondary.main}}})),R=(0,m.observer)((function(e){var t=e.session,n=e.setToolbarHeight,i=(0,v.getEnv)(t).pluginManager,o=t.visibleWidget,m=t.activeWidgets,k=t.drawerPosition,C=P(),S=a.useState(null),T=(0,r.Z)(S,2),R=T[0],M=T[1];return(0,Z.jsxs)(s.Z,{position:"sticky",className:C.header,ref:function(e){return n((null===e||void 0===e?void 0:e.getBoundingClientRect().height)||0)},children:[(0,Z.jsxs)(c.Z,{disableGutters:!0,className:C.drawerToolbar,children:[(0,Z.jsx)(u.Z,{value:null===o||void 0===o?void 0:o.id,"data-testid":"widget-drawer-selects",className:C.drawerSelect,classes:{icon:C.dropDownIcon},renderValue:function(e){var n=t.activeWidgets.get(e);if(!n)return(0,Z.jsx)(l.Z,{variant:"h6",color:"inherit",children:"Unknown widget"});var r=i.getWidgetType(n.type),a=r.HeadingComponent,o=r.heading;return a?(0,Z.jsx)(a,{model:n}):(0,Z.jsx)(l.Z,{variant:"h6",color:"inherit",children:o})},onChange:function(e){var n=t.activeWidgets.get(e.target.value);n||t.notify("Widget not found "+e.target.value,"warning"),t.showWidget(n)},children:Array.from(m.values()).map((function(e){var n=i.getWidgetType(e.type),r=n.HeadingComponent,a=n.heading;return(0,Z.jsxs)(d.Z,{"data-testid":"widget-drawer-selects-item-".concat(e.type),value:e.id,children:[r?(0,Z.jsx)(r,{model:e}):(0,Z.jsx)(l.Z,{variant:"h6",color:"inherit",children:a}),(0,Z.jsx)(f.Z,{children:(0,Z.jsx)(p.Z,{"data-testid":"".concat(e.type,"-drawer-delete"),color:"inherit","aria-label":"Delete",onClick:function(){t.hideWidget(e)},children:(0,Z.jsx)(y.Z,{})})})]},e.id)}))}),(0,Z.jsx)("div",{className:C.spacer}),(0,Z.jsxs)("div",{children:[(0,Z.jsx)(p.Z,{"data-testid":"drawer-close",color:"inherit",onClick:function(e){return M(e.currentTarget)},children:(0,Z.jsx)(w.Z,{})}),(0,Z.jsx)(h.ZP,{title:"Minimize drawer",children:(0,Z.jsx)(p.Z,{"data-testid":"drawer-minimize",color:"inherit",onClick:function(){t.notify("Drawer minimized, click button on ".concat(k," side of screen to re-open"),"info"),t.minimizeWidgetDrawer()},children:(0,Z.jsx)(x.Z,{})})}),(0,Z.jsx)(h.ZP,{title:"Close drawer",children:(0,Z.jsx)(p.Z,{"data-testid":"drawer-close",color:"inherit",onClick:function(){t.hideWidget(o)},children:(0,Z.jsx)(b.Z,{})})})]})]}),(0,Z.jsx)(g.Z,{anchorEl:R,open:Boolean(R),onClose:function(){return M(null)},children:["left","right"].map((function(e){return(0,Z.jsx)(d.Z,{selected:"option"===k,onClick:function(){t.setDrawerPosition(e),M(null)},children:e},e)}))})]})})),M=(0,m.observer)((function(e){var t=e.session,n=t.visibleWidget,i=(0,v.getEnv)(t).pluginManager,o=n?i.getWidgetType(n.type).ReactComponent:null,s=(0,a.useState)(0),c=(0,r.Z)(s,2),u=c[0],l=c[1];return(0,Z.jsxs)(T,{session:t,children:[(0,Z.jsx)(R,{session:t,setToolbarHeight:l}),(0,Z.jsx)(a.Suspense,{fallback:(0,Z.jsx)("div",{children:"Loading..."}),children:(0,Z.jsx)(o,{model:n,session:t,toolbarHeight:u})})]})}))},31631:function(e,t,n){"use strict";var r=n(96234),a=n(30969),i=n(28599),o=n(22714),s=n(53239),c=n(58459),u=n(90550),l=n(76770),d=n(37574),f=(0,o.Z)((function(e){return{root:{display:"flex"},buttonRoot:{"&:hover":{backgroundColor:(0,s.Fq)(e.palette.primary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}}}));t.Z=(0,u.observer)((function(e){var t=e.menuTitle,n=e.session,o=e.menuItems,s=(0,a.useState)(!1),u=(0,r.Z)(s,2),p=u[0],h=u[1],g=(0,a.useRef)(null),m=f();function v(){h(!1)}return(0,d.jsxs)("div",{className:m.root,children:[(0,d.jsxs)(i.Z,{ref:g,onClick:function(){h(!p)},color:"inherit","data-testid":"dropDownMenuButton",classes:{root:m.buttonRoot},children:[t,(0,d.jsx)(c.Z,{})]}),(0,d.jsx)(l.Z,{anchorEl:g.current,anchorOrigin:{vertical:"bottom",horizontal:"left"},onMenuItemClick:function(e,t){t(n),v()},open:p,onClose:v,menuItems:o})]})}))},60092:function(e,t,n){"use strict";var r=n(96234),a=n(28599),i=n(83483),o=n(53033),s=n(93138),c=n(64501),u=n(30969),l=n(88896),d=n(37574),f=function(e){var t=e.onFactoryReset,n=e.resetButtonText,i=(0,u.useState)(!1),o=(0,r.Z)(i,2),s=o[0],c=o[1];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(a.Z,{"data-testid":"fatal-error",color:"primary",variant:"contained",onClick:function(){return c(!0)},children:n}),(0,d.jsx)(l.Z,{onClose:function(){return c(!1)},open:s,onFactoryReset:t})]})},p=function(e){var t=e.componentStack,n=e.error,r=e.onFactoryReset,u=e.resetButtonText;return(0,d.jsxs)(i.Z,{open:!0,children:[(0,d.jsx)(c.Z,{style:{backgroundColor:"#e88"},children:"Fatal error"}),(0,d.jsx)(s.Z,{children:(0,d.jsxs)("pre",{children:[n.toString(),t]})}),(0,d.jsxs)(o.Z,{children:[(0,d.jsx)(a.Z,{color:"secondary",variant:"contained",onClick:function(){return window.location.reload()},children:"Refresh"}),(0,d.jsx)(f,{onFactoryReset:r,resetButtonText:u})]})]})};p.defaultProps={error:{message:"No error message provided"},componentStack:"",resetButtonText:"Factory Reset"},t.Z=p},84537:function(e,t,n){"use strict";n(30969);var r=n(22714),a=n(27710),i=n(28224),o=n(28599),s=n(80975),c=n(81073),u=n(97891),l=n(37574);function d(e){return"blobId"in e}var f=(0,r.Z)((function(e){return{filename:{marginLeft:e.spacing(1)}}}));t.Z=function(e){var t=f(),n=e.location,r=e.setLocation,p=n&&(d(n)&&n.name||function(e){return"localPath"in e}(n)&&n.localPath),h=n&&d(n)&&!(0,u.getBlob)(n.blobId);return(0,l.jsxs)(a.Z,{display:"flex",flexDirection:"row",alignItems:"center",children:[(0,l.jsx)(a.Z,{children:(0,l.jsx)(i.Z,{fullWidth:!0,children:(0,l.jsxs)(o.Z,{variant:"outlined",component:"label",children:["Choose File",(0,l.jsx)("input",{type:"file",hidden:!0,onChange:function(e){var t=e.target,n=t&&t.files&&t.files[0];n&&(c.isElectron?r({localPath:n.path,locationType:"LocalPathLocation"}):r((0,u.storeBlobLocation)({blob:n})))}})]})})}),(0,l.jsxs)(a.Z,{children:[(0,l.jsx)(s.Z,{component:"span",className:t.filename,color:p?"initial":"textSecondary",children:p||"No file chosen"}),h?(0,l.jsx)(s.Z,{color:"error",children:"(need to reload)"}):null]})]})}},14808:function(e,t,n){"use strict";n(30969);var r=n(7690),a=n(90550),i=n(8438),o=n(37574);t.Z=(0,a.observer)((function(e){var t=e.location,n=e.setLocation,a=e.label;return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(r.Z,{fullWidth:!0,variant:"outlined",inputProps:{"data-testid":"urlInput"},defaultValue:t&&(0,i.hb)(t)?t.uri:"",label:a||"Enter URL",onChange:function(e){n({uri:e.target.value.trim(),locationType:"UriLocation"})}})})}))},22417:function(e,t,n){"use strict";n.d(t,{GD:function(){return s},pt:function(){return o},sB:function(){return c}});var r=n(33028),a=n(67496),i=(n(30969),n(37574));function o(e){return(0,i.jsx)(a.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,i.jsx)("path",{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"})}))}function s(e){return(0,i.jsx)(a.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,i.jsx)("path",{d:"M21 19v-2H8v2h13m0-6v-2H8v2h13M8 7h13V5H8v2M4 5v2h2V5H4M3 5a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V5m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2m1 6v2h2v-2H4m-1 0a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"})}))}function c(e){return(0,i.jsx)(a.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,i.jsx)("path",{d:"M20 5V4c0-.55-.45-1-1-1h-2c-.55 0-1 .45-1 1v1h-1v4c0 .55.45 1 1 1h1v7c0 1.1-.9 2-2 2s-2-.9-2-2V7c0-2.21-1.79-4-4-4S5 4.79 5 7v7H4c-.55 0-1 .45-1 1v4h1v1c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-1h1v-4c0-.55-.45-1-1-1H7V7c0-1.1.9-2 2-2s2 .9 2 2v10c0 2.21 1.79 4 4 4s4-1.79 4-4v-7h1c.55 0 1-.45 1-1V5h-1z"})}))}},72434:function(e,t,n){"use strict";var r=n(96234),a=n(30969),i=n(25267),o=n(28599),s=n(32343),c=n(14008),u=n(56477),l=n(90550),d=n(37574);t.Z=(0,l.observer)((function(e){var t=e.session,n=(0,a.useState)(!1),l=(0,r.Z)(n,2),f=l[0],p=l[1],h=(0,a.useState)(),g=(0,r.Z)(h,2),m=g[0],v=g[1],y=t.popSnackbarMessage,b=t.snackbarMessages,x=b.length?b[b.length-1]:null;(0,a.useEffect)((function(){var e;return m?x?m[0]!==x[0]&&(p(!1),e=setTimeout((function(){v(x),p(!0)}),100)):v(void 0):x&&(v(x),p(!0)),function(){clearTimeout(e)}}),[x,m]);var w=function(e,t){"clickaway"!==t&&(y(),p(!1))},k=m||[],C=(0,r.Z)(k,3),Z=C[0],S=C[1],T=C[2];return(0,d.jsx)(i.Z,{open:f&&!!Z,onClose:w,children:(0,d.jsx)(u.Z,{onClose:w,action:T?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(o.Z,{color:"inherit",onClick:function(e){T.onClick(),w()},children:T.name}),(0,d.jsx)(s.Z,{"aria-label":"close",color:"inherit",onClick:w,children:(0,d.jsx)(c.Z,{})})]}):null,severity:S||"warning",children:Z})})}))},78734:function(e,t,n){"use strict";var r=n(33028),a=n(96234),i=n(30969),o=n(22714),s=n(53239),c=n(32343),u=n(38827),l=n(51526),d=n(317),f=n(90550),p=n(40909),h=n(92084),g=n(14008),m=n(73876),v=n(78033),y=n(76770),b=n(37574),x=(0,o.Z)((function(e){return{viewContainer:{overflow:"hidden",background:e.palette.secondary.main,margin:e.spacing(.5)},icon:{color:e.palette.secondary.contrastText},grow:{flexGrow:1},iconRoot:{"&:hover":{backgroundColor:(0,s.Fq)(e.palette.secondary.contrastText,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},input:{paddingBottom:0,paddingTop:2},inputBase:{color:e.palette.secondary.contrastText},inputRoot:{"&:hover":{backgroundColor:e.palette.secondary.light}},inputFocused:{borderColor:e.palette.primary.main,backgroundColor:e.palette.secondary.light}}})),w=(0,f.observer)((function(e){var t=e.model,n=e.IconButtonProps,o=e.IconProps,s=(0,i.useState)(),u=(0,a.Z)(s,2),l=u[0],d=u[1],f=t.menuItems,p="function"===typeof f?f():f;return null!==p&&void 0!==p&&p.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.Z,(0,r.Z)((0,r.Z)({},n),{},{"aria-label":"more","aria-controls":"view-menu","aria-haspopup":"true",onClick:function(e){d(e.currentTarget)},"data-testid":"view_menu_icon",children:(0,b.jsx)(m.Z,(0,r.Z)({},o))})),(0,b.jsx)(y.Z,{anchorEl:l,open:Boolean(l),onMenuItemClick:function(e,t){t(),d(void 0)},onClose:function(){d(void 0)},menuItems:t.menuItems()})]}):null})),k=(0,f.observer)((function(e){var t=e.view,n=e.onClose,o=e.style,s=e.children,f=x(),m=(0,u.Z)().spacing(1),y=(0,h.Z)(),k=(0,a.Z)(y,2),C=k[0],Z=k[1].width;(0,i.useEffect)((function(){Z&&(0,p.isAlive)(t)&&t.setWidth(Z-2*m)}),[m,t,Z]);var S=(0,i.useRef)(null);return(0,i.useEffect)((function(){var e,t;null===(e=S.current)||void 0===e||null===(t=e.scrollIntoView)||void 0===t||t.call(e,{block:"center"})}),[]),(0,b.jsxs)(l.Z,{ref:C,elevation:12,className:f.viewContainer,style:(0,r.Z)((0,r.Z)({},o),{},{padding:"0px ".concat(m,"px ").concat(m,"px")}),children:[(0,b.jsxs)("div",{ref:S,style:{display:"flex"},children:[(0,b.jsx)(w,{model:t,IconButtonProps:{classes:{root:f.iconRoot},edge:"start"},IconProps:{className:f.icon}}),(0,b.jsx)("div",{className:f.grow}),(0,b.jsx)(d.ZP,{title:"Rename view",arrow:!0,children:(0,b.jsx)(v.Z,{value:t.displayName||(t.assemblyNames?t.assemblyNames.join(","):"Untitled view"),setValue:function(e){t.setDisplayName(e)},variant:"body2",classes:{input:f.input,inputBase:f.inputBase,inputRoot:f.inputRoot,inputFocused:f.inputFocused}})}),(0,b.jsx)("div",{className:f.grow}),(0,b.jsx)(c.Z,{"data-testid":"close_view",classes:{root:f.iconRoot},edge:"end",onClick:n,children:(0,b.jsx)(g.Z,{className:f.icon})})]}),(0,b.jsx)(l.Z,{children:s})]})}));t.Z=k},54006:function(e,t,n){"use strict";var r=n(33028),a=n(68079),i=n(40909),o=n(81073),s=n(29206),c=n(60717),u=n(31517),l=i.types.model("Base1DView",{id:s.ElementId,displayedRegions:i.types.array(s.Region),bpPerPx:0,offsetPx:0,interRegionPaddingWidth:i.types.optional(i.types.number,0),minimumBlockWidth:i.types.optional(i.types.number,0)}).volatile((function(){return{features:void 0,volatileWidth:0}})).actions((function(e){return{setDisplayedRegions:function(t){e.displayedRegions=(0,i.cast)(t)},setBpPerPx:function(t){e.bpPerPx=t},setVolatileWidth:function(t){e.volatileWidth=t}}})).views((function(e){return{get width(){return e.volatileWidth},get assemblyNames(){return(0,a.Z)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-this.width},get totalBp(){return e.displayedRegions.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},pxToBp:function(t){var n=0,a=(e.offsetPx+t)*e.bpPerPx,o=e.displayedRegions.length;if(a<0){var s=e.displayedRegions[0],c=a;return(0,r.Z)((0,r.Z)({},(0,i.getSnapshot)(s)),{},{oob:!0,coord:s.reversed?Math.floor(s.end-c)+1:Math.floor(s.start+c)+1,offset:c,index:0})}for(var u=e.interRegionPaddingWidth*e.bpPerPx,l=e.minimumBlockWidth*e.bpPerPx,d=0;d<e.displayedRegions.length;d+=1){var f=e.displayedRegions[d],p=f.end-f.start,h=a-n;if(p+n>a&&n<=a)return(0,r.Z)((0,r.Z)({},(0,i.getSnapshot)(f)),{},{oob:!1,offset:h,coord:f.reversed?Math.floor(f.end-h)+1:Math.floor(f.start+h)+1,index:d});f.end-f.start>l&&h/e.bpPerPx>0&&h/e.bpPerPx<this.width?n+=p+u:n+=p}if(a>=n){var g=e.displayedRegions[o-1],m=a-n+(g.end-g.start);return(0,r.Z)((0,r.Z)({},(0,i.getSnapshot)(g)),{},{oob:!0,offset:m,coord:g.reversed?Math.floor(g.end-m)+1:Math.floor(g.start+m)+1,index:o-1})}return{coord:0,index:0,start:0,refName:"",oob:!0,assemblyName:"",offset:0,reversed:!1}}}})).views((function(e){return{get dynamicBlocks(){return(0,c.Z)(e)},get staticBlocks(){return(0,u.Z)(e)},get currBp(){return this.dynamicBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)},bpToPx:function(t){var n,r=t.refName,a=t.coord,i=t.regionNumber;return null===(n=(0,o.viewBpToPx)({refName:r,coord:a,regionNumber:i,self:e}))||void 0===n?void 0:n.offsetPx}}})).actions((function(e){return{setFeatures:function(t){e.features=t},zoomToDisplayedRegions:function(e,t){if(void 0!==e&&void 0!==t){if(e.refName===t.refName&&e.index===t.index&&t.offset<e.offset||e.index>t.index){var n=[t,e];e=n[0],t=n[1]}var r={start:e.start,end:e.end,index:e.index,offset:e.offset},a={start:t.start,end:t.end,index:t.index,offset:t.offset};if(!r||!a)throw new Error("regions not found");this.moveTo(r,a)}},showAllRegions:function(){e.bpPerPx=e.totalBp/e.width,e.offsetPx=0},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var i=t.index+1;i<n.index;i+=1)r+=e.displayedRegions[i].end-e.displayedRegions[i].start;r+=n.offset}this.zoomTo(r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)));for(var o=0,s=0;s<e.displayedRegions.length;s+=1){var c=e.displayedRegions[s];if(t.index===s){o+=t.offset;break}o+=c.end-c.start}e.offsetPx=Math.round(o/e.bpPerPx)+e.interRegionPaddingWidth*t.index},zoomOut:function(){this.zoomTo(2*e.bpPerPx)},zoomIn:function(){this.zoomTo(e.bpPerPx/2)},zoomTo:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.width/2,r=t;if(r!==e.bpPerPx){var a=e.bpPerPx;e.bpPerPx=r,e.offsetPx=(0,o.clamp)(Math.round((e.offsetPx+n)*a/r-n),e.minOffset,e.maxOffset)}},scrollTo:function(t){var n=(0,o.clamp)(t,e.minOffset,e.maxOffset);return e.offsetPx=n,n},centerAt:function(t,n,r){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&this.scrollTo(Math.round(a-e.width/2))},scroll:function(t){var n=e.offsetPx,r=(0,o.clamp)(e.offsetPx+t,e.minOffset,e.maxOffset);return e.offsetPx=r,r-n}}}));t.Z=l},56891:function(e,t,n){"use strict";n.d(t,{Jw:function(){return c},b0:function(){return l},n2:function(){return f},sh:function(){return d}});var r=n(45754),a=n(86906),i=n(33028),o=n(9249),s=n(87371),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,o.Z)(this,e),this.blocks=t}return(0,s.Z)(e,[{key:"push",value:function(e){if(e instanceof d&&this.blocks.length){var t=this.blocks[this.blocks.length-1];if(t instanceof d)return void t.push(e)}this.blocks.push(e)}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRegions",value:function(){return this.blocks.map((function(e){return e.toRegion()}))}},{key:"map",value:function(e,t){return this.blocks.map(e,t)}},{key:"forEach",value:function(e,t){return this.blocks.forEach(e,t)}},{key:"length",get:function(){return this.blocks.length}},{key:"totalWidthPx",get:function(){return this.blocks.length?this.blocks.map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"totalWidthPxWithoutBorders",get:function(){return this.blocks.length?this.blocks.filter((function(e){return"boundary"!==e.variant})).map((function(e){return e.widthPx})).reduce((function(e,t){return e+t})):0}},{key:"offsetPx",get:function(){return this.blocks.length?this.blocks[0].offsetPx:0}},{key:"contentBlocks",get:function(){return this.blocks.filter((function(e){return e instanceof l}))}},{key:"totalBp",get:function(){return this.contentBlocks.map((function(e){return e.end-e.start})).reduce((function(e,t){return e+t}),0)}}]),e}(),u=function(){function e(t){(0,o.Z)(this,e),this.regionNumber=void 0,this.reversed=void 0,this.refName=void 0,this.start=void 0,this.end=void 0,this.assemblyName=void 0,this.key=void 0,this.offsetPx=void 0,this.widthPx=0,this.variant=void 0,this.isLeftEndOfDisplayedRegion=void 0,Object.assign(this,t),this.assemblyName=t.assemblyName,this.refName=t.refName,this.start=t.start,this.end=t.end,this.key=t.key,this.offsetPx=t.offsetPx}return(0,s.Z)(e,[{key:"renameReference",value:function(e){return this.refName&&e!==this.refName?new this.constructor((0,i.Z)((0,i.Z)({},this),{},{refName:e})):this}},{key:"toRegion",value:function(){return{refName:this.refName,start:this.start,end:this.end,assemblyName:this.assemblyName,reversed:this.reversed}}}]),e}(),l=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n)}(u),d=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).widthPx=void 0,r.elidedBlockCount=0,r.widthPx=e.widthPx,r}return(0,s.Z)(n,[{key:"push",value:function(e){this.elidedBlockCount+=1,e&&(this.refName="",this.start=0,this.end=0,this.widthPx+=e.widthPx)}}]),n}(u),f=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n)}(u)},60717:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(96234),a=n(37654),i=n(81073),o=n(56891);function s(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=e.offsetPx,c=e.displayedRegions,u=e.bpPerPx,l=e.width,d=e.minimumBlockWidth,f=e.interRegionPaddingWidth;if(!l)throw new Error("view has no width, cannot calculate displayed blocks");var p=new o.Jw,h=0,g=s,m=g+l;return c.forEach((function(e,v){var y=e.assemblyName,b=e.refName,x=e.start,w=e.end,k=e.reversed,C=h+(w-x)/u,Z=(w-x)/u;if(h<m&&C>g){var S,T,P,R,M,j=(0,a.U0)(g,m,h,C),A=(0,r.Z)(j,2),N=A[0],L=A[1];k?(S=Math.max(x,w-(L-h)*u),P=(T=w-(N-h)*u)===w,R=S===x,M=h+(w-T)/u):(P=(S=(N-h)*u+x)===x,R=(T=Math.min(w,(L-h)*u+x))===w,M=h+(S-x)/u);var F={assemblyName:y,refName:b,start:S,end:T,reversed:k,offsetPx:M,parentRegion:e,regionNumber:v,widthPx:(T-S)/u,isLeftEndOfDisplayedRegion:P,isRightEndOfDisplayedRegion:R,key:""};F.key="".concat((0,i.assembleLocString)(F),"-").concat(v).concat(k?"-reversed":""),t&&0===p.length&&P&&p.push(new o.n2({key:"".concat(F.key,"-beforeFirstRegion"),widthPx:-s,offsetPx:F.offsetPx+s,variant:"boundary"})),n&&Z<d?p.push(new o.sh(F)):p.push(new o.b0(F)),t&&(Z>=d&&F.isRightEndOfDisplayedRegion&&v<c.length-1&&(p.push(new o.n2({key:"".concat(F.key,"-rightpad"),widthPx:f,offsetPx:F.offsetPx+F.widthPx})),h+=f),v===c.length-1&&F.isRightEndOfDisplayedRegion&&(M=F.offsetPx+F.widthPx,p.push(new o.n2({key:"".concat(F.key,"-afterLastRegion"),widthPx:l-M+s,offsetPx:M,variant:"boundary"}))))}h+=(w-x)/u})),p}},31517:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(81073),a=n(56891);function i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"undefined"!==typeof window&&window.innerWidth||e.width,s=e.offsetPx,c=e.displayedRegions,u=e.bpPerPx,l=e.minimumBlockWidth,d=e.interRegionPaddingWidth,f=s*u,p=(s+o)*u,h=o,g=Math.ceil(h*u),m=0,v=new a.Jw;return c.forEach((function(e,s){var h=e.assemblyName,y=e.refName,b=e.start,x=e.end,w=e.reversed,k=Math.ceil((x-b)/g),C=Math.floor((p-m)/g)+i;C>=k&&(C=k-1);var Z=Math.floor((f-m)/g)-i;Z<0&&(Z=0);for(var S=(x-b)/u,T=Z;T<=C;T+=1){var P=void 0,R=void 0,M=void 0,j=void 0;w?(P=Math.max(b,x-(T+1)*g),M=(R=x-T*g)===x,j=P===b):(M=(P=b+T*g)===b,j=(R=Math.min(x,b+(T+1)*g))===x);var A={assemblyName:h,refName:y,start:P,end:R,reversed:w,offsetPx:(m+T*g)/u,parentRegion:e,regionNumber:s,widthPx:(R-P)/u,isLeftEndOfDisplayedRegion:M,isRightEndOfDisplayedRegion:j,key:""};A.key="".concat((0,r.assembleLocString)(A),"-").concat(s).concat(w?"-reversed":""),t&&0===s&&0===T&&v.push(new a.n2({key:"".concat(A.key,"-beforeFirstRegion"),widthPx:o,offsetPx:A.offsetPx-o,variant:"boundary"})),n&&S<l?v.push(new a.sh(A)):v.push(new a.b0(A)),t&&(S>=l&&A.isRightEndOfDisplayedRegion&&s<c.length-1&&(m+=d*u,v.push(new a.n2({key:"".concat(A.key,"-rightpad"),widthPx:d,offsetPx:A.offsetPx+A.widthPx}))),s===c.length-1&&A.isRightEndOfDisplayedRegion&&(m+=d*u,v.push(new a.n2({key:"".concat(A.key,"-afterLastRegion"),widthPx:o,offsetPx:A.offsetPx+A.widthPx,variant:"boundary"}))))}m+=x-b})),v}},74426:function(e,t,n){"use strict";n.r(t),n.d(t,{contrastingTextColor:function(){return s},emphasize:function(){return u},isNamedColor:function(){return o},makeContrasting:function(){return l},namedColorToHex:function(){return i}});var r=n(78310),a={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function i(e){return a[e]}function o(e){return!!a[e]}function s(e){return c(e)>.5?"black":"white"}function c(e){var t=i(e);return(0,r.H3)(t||e)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15,n=i(e);return(0,r._4)(n||e,t)}function l(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"white",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=i(e)||e,o=i(t)||t,s=c(o),u=(0,r.mi)(a,o),l=a,d=.05;u<n;)a=s>.5?(0,r._j)(l,d):(0,r.$n)(l,d),d+=.05,u=(0,r.mi)(a,o);return a}},37813:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(81073);function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Object.keys(e),i=0;i<n.length;i++){var o=n[i];if(t.length>5e3)break;"object"===typeof e[o]&&e[o]?t+=a(e[o],t):t+="".concat(o,"-").concat(e[o],";")}return(0,r.hashCode)(t)}},81073:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthNeededError:function(){return y.yb},ImageBitmapType:function(){return k.Ck},RetryError:function(){return y.Ms},SimpleFeature:function(){return v.Z},abortBreakPoint:function(){return b.ML},assembleLocString:function(){return B},blobToDataURL:function(){return le},bpSpanPx:function(){return Y},bpToPx:function(){return W},bytesForRegions:function(){return we},cartesianToPolar:function(){return J},checkAbortSignal:function(){return b.O8},clamp:function(){return z},compareLocStrings:function(){return O},compareLocs:function(){return V},complement:function(){return ue},createCanvas:function(){return k.vL},createImageBitmap:function(){return k.MC},defaultCodonTable:function(){return ge},defaultStarts:function(){return pe},defaultStops:function(){return he},degToRad:function(){return _},doesIntersect2:function(){return w.qY},drawImageOntoCanvasContext:function(){return k.kv},featureSpanPx:function(){return X},findLastIndex:function(){return ee},findParentThat:function(){return M},findParentThatIs:function(){return A},generateCodonTable:function(){return me},getBpDisplayStr:function(){return Se},getContainingDisplay:function(){return I},getContainingTrack:function(){return F},getContainingView:function(){return L},getLayoutId:function(){return Pe},getSession:function(){return N},getViewParams:function(){return Te},hashCode:function(){return be},inDevelopment:function(){return S},inProduction:function(){return T},intersection2:function(){return w.U0},isAbortException:function(){return b.zF},isAbstractMenuManager:function(){return y.J0},isAppRootModel:function(){return y.dc},isAuthNeededException:function(){return y.PK},isContainedWithin:function(){return w.J7},isDisplayModel:function(){return y.yZ},isElectron:function(){return se},isFeature:function(){return v.T},isRetryException:function(){return y.Z6},isSelectionContainer:function(){return y.zL},isSessionModel:function(){return y.k$},isSessionModelWithConfigEditing:function(){return y.cX},isSessionModelWithWidgets:function(){return y.gI},isSessionWithAddTracks:function(){return y._L},isSessionWithSessionPlugins:function(){return y.uF},isTrackModel:function(){return y.d6},isTrackViewModel:function(){return y.Um},isUriLocation:function(){return y.hb},isViewContainer:function(){return y.BQ},isViewModel:function(){return y.zN},iterMap:function(){return $},makeAbortError:function(){return b.fP},makeAbortableReaction:function(){return te},measureText:function(){return fe},mergeConfigs:function(){return K},minmax:function(){return ie},objectFromEntries:function(){return Q},objectHash:function(){return xe},observeAbortSignal:function(){return b.N7},parseLocString:function(){return E},parseLocStringOneBased:function(){return D},polarToCartesian:function(){return G},rIC:function(){return de},radToDeg:function(){return U},renameRegionIfNeeded:function(){return ne},renameRegionsIfNeeded:function(){return re},renderToAbstractCanvas:function(){return C.C},revcom:function(){return ce},springAnimate:function(){return j},stringify:function(){return oe},supportedIndexingAdapters:function(){return Ze},updateStatus:function(){return ve},useDebounce:function(){return P},useDebouncedCallback:function(){return R},viewBpToPx:function(){return Ce},when:function(){return x.g},whenPresent:function(){return x.q}});var r=n(33028),a=n(34795),i=n(41361),o=n(68079),s=n(96234),c=n(77162),u=n.n(c),l=n(30969),d=n(40909),f=n(35247),p=n(94806),h=n.n(p),g=n(67560),m=n.n(g),v=n(14956),y=n(8438),b=n(55429),x=n(26132),w=n(37654),k=n(54131),C=n(31385),Z=n(40475);Object.fromEntries||h().shim();var S="object"===typeof Z&&{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}&&!1,T=!S;function P(e,t){var n=(0,l.useState)(e),r=(0,s.Z)(n,2),a=r[0],i=r[1];return(0,l.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),a}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400,n=(0,l.useRef)(),r=(0,l.useRef)();function a(){r.current&&clearTimeout(r.current)}return(0,l.useEffect)((function(){return a}),[]),function(){for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];n.current=s,a(),r.current=setTimeout((function(){n.current&&e.apply(void 0,(0,o.Z)(n.current))}),t)}}function M(e,t){if(!(0,d.hasParent)(e))throw new Error("node does not have parent");for(var n=(0,d.getParent)(e);n&&(0,d.isAlive)(n);){if(t(n))return n;if(!(0,d.hasParent)(n))break;n=(0,d.getParent)(n)}throw new Error("no matching node found")}function j(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:170,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:26,c=1;function u(e){var l=Date.now(),d=e.lastPosition,f=e.lastTime||l,p=e.lastVelocity||0;l>f+64&&(f=l);for(var h=Math.floor(l-f),g=0;g<h;++g){d+=1*(p+=1*((-o*(d-t)+-s*p)/c)/1e3)/1e3}var m=Math.abs(p)<=i,v=0===o||Math.abs(t-d)<=i;m&&v?(n(t),a()):(n(d),r=requestAnimationFrame((function(){return u({lastPosition:d,lastTime:l,lastVelocity:p})})))}return i||(i=Math.abs(t-e)/1e3),[function(){return u({lastPosition:e})},function(){return cancelAnimationFrame(r)}]}function A(e,t){return M(e,t)}function N(e){try{return A(e,y.k$)}catch(t){throw new Error("no session model found!")}}function L(e){try{return A(e,y.zN)}catch(t){throw new Error("no containing view found")}}function F(e){try{return A(e,y.d6)}catch(t){throw new Error("no containing track found")}}function I(e){try{return A(e,y.yZ)}catch(t){throw new Error("no containing display found")}}function B(e){var t,n,r=e.assemblyName,a=e.refName,i=e.start,o=e.end,s=e.reversed,c=r?"{".concat(r,"}"):"";t=void 0!==i?":".concat((i+1).toLocaleString("en-US")):void 0!==o?":1":"",n=void 0!==o?void 0!==i&&i+1===o?"":"..".concat(o.toLocaleString("en-US")):void 0!==i?"..":"";var u="";return s&&(u="[rev]"),"".concat(c).concat(a).concat(t).concat(n).concat(u)}function D(e,t){if(!e)throw new Error("no location string provided, could not parse");var n=!1;e.endsWith("[rev]")&&(n=!0,e=e.replace(/\[rev\]$/,""));var r=(e=e.replace(/\s/,"")).match(/(\{(.+)\})?(.+)/);if(!r)throw new Error('invalid location string: "'.concat(e,'"'));var a=(0,s.Z)(r,4),i=a[2],o=a[3];if(!i&&o.startsWith("{}"))throw new Error('no assembly name was provided in location "'.concat(o,'"'));var c=o.lastIndexOf(":");if(-1===c){if(t(o,i))return{assemblyName:i,refName:o,reversed:n};throw new Error('Unknown reference sequence "'.concat(o,'"'))}var u=o.slice(0,c),l=o.slice(c+1);if(t(u,i)&&t(o,i))throw new Error('ambiguous location string: "'.concat(e,'"'));if(t(u,i)){if(!l)return{assemblyName:i,refName:u,reversed:n};var d=l.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)(-?(\d+|\d{1,3}(,\d{3})*))$/),f=l.match(/^(-?(\d+|\d{1,3}(,\d{3})*))(\.\.|-)?$/);if(d){var p=(0,s.Z)(d,6),h=p[1],g=p[5];if(void 0!==h&&void 0!==g)return{assemblyName:i,refName:u,start:+h.replace(/,/g,""),end:+g.replace(/,/g,""),reversed:n}}else{if(!f)throw new Error('could not parse range "'.concat(l,'" on location "').concat(e,'"'));var m=(0,s.Z)(f,5),v=m[1],y=m[4];if(void 0!==v)return y?{assemblyName:i,refName:u,start:+v.replace(/,/g,""),reversed:n}:{assemblyName:i,refName:u,start:+v.replace(/,/g,""),end:+v.replace(/,/g,""),reversed:n}}}else if(t(o,i))return{assemblyName:i,refName:o,reversed:n};throw new Error('unknown reference sequence name in location "'.concat(e,'"'))}function E(e,t){var n=D(e,t);return"number"===typeof n.start&&(n.start-=1),n}function V(e,t){var n=e.assemblyName||t.assemblyName?(e.assemblyName||"").localeCompare(t.assemblyName||""):0;if(n)return n;var r=e.refName||t.refName?(e.refName||"").localeCompare(t.refName||""):0;if(r)return r;if(void 0!==e.start&&void 0!==t.start){var a=e.start-t.start;if(a)return a}if(void 0!==e.end&&void 0!==t.end){var i=e.end-t.end;if(i)return i}return 0}function O(e,t,n){return V(E(e,n),E(t,n))}function z(e,t,n){return e<t?t:e>n?n:e}function W(e,t,n){var r,a=t.reversed,i=t.end,o=void 0===i?0:i,s=t.start;return r=(a?o-e:e-(void 0===s?0:s))/n,Math.round(10*r)/10}var H=180/Math.PI,q=Math.PI/180;function U(e){return e*H%360}function _(e){return e*q%(2*Math.PI)}function G(e,t){return[e*Math.cos(t),e*Math.sin(t)]}function J(e,t){return[Math.sqrt(e*e+t*t),Math.atan(t/e)]}function X(e,t,n){return Y(e.get("start"),e.get("end"),t,n)}function Y(e,t,n,r){var a=W(e,n,r),i=W(t,n,r);return n.reversed?[i,a]:[a,i]}var Q=Object.fromEntries.bind(Object);function $(e,t,n){var r,a=n?new Array(n):[],o=0,s=(0,i.Z)(e);try{for(s.s();!(r=s.n()).done;){var c=r.value;a[o]=t(c),o+=1}}catch(u){s.e(u)}finally{s.f()}return a}function K(e,t){var n=m()(e,t);return t.defaultSession?n.defaultSession=t.defaultSession:e.defaultSession&&(n.defaultSession=e.defaultSession),n}function ee(e,t){for(var n=e.length;n--;)if(t(e[n],n,e))return n;return-1}function te(e,t,n,r,i,o,s){var c;function l(t){(0,b.zF)(t)||((0,d.isAlive)(e)?s(t):console.error(t))}var p=(0,f.reaction)((function(){try{return t(e)}catch(n){return void l(n)}}),function(){var t=(0,a.Z)(u().mark((function t(r,a){var s,f;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c&&!c.signal.aborted&&c.abort(),(0,d.isAlive)(e)){t.next=3;break}return t.abrupt("return");case 3:return c=new AbortController,i(s=c),t.prev=6,t.next=9,n(r,s.signal,e,a);case 9:f=t.sent,(0,b.O8)(s.signal),(0,d.isAlive)(e)&&o(f),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(6),s&&!s.signal.aborted&&s.abort(),l(t.t0);case 18:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,n){return t.apply(this,arguments)}}(),r);(0,d.addDisposer)(e,p),(0,d.addDisposer)(e,(function(){c&&!c.signal.aborted&&c.abort()}))}function ne(e,t){if((0,d.isStateTreeNode)(t)&&!(0,d.isAlive)(t))return t;if(t&&e&&e[t.refName]){var n=e[(t=(0,d.isStateTreeNode)(t)?(0,r.Z)({},(0,d.getSnapshot)(t)):(0,r.Z)({},t)).refName];if(n)return(0,r.Z)((0,r.Z)({},t),{},{refName:n,originalRefName:t.refName})}return t}function re(e,t){return ae.apply(this,arguments)}function ae(){return ae=(0,a.Z)(u().mark((function e(t,n){var i,o,s,c,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.regions,o=void 0===i?[]:i,s=n.adapterConfig,n.sessionId){e.next=3;break}throw new Error("sessionId is required");case 3:return c=o.map((function(e){return e.assemblyName})),e.t0=Object,e.next=7,Promise.all(c.map(function(){var e=(0,a.Z)(u().mark((function e(r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,t.getRefNameMapForAdapter(s,r,n);case 3:return e.t1=e.sent,e.abrupt("return",[e.t0,e.t1]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return e.t1=e.sent,l=e.t0.fromEntries.call(e.t0,e.t1),e.abrupt("return",(0,r.Z)((0,r.Z)({},n),{},{regions:o.map((function(e,t){return ne(l[c[t]],e)}))}));case 10:case"end":return e.stop()}}),e)}))),ae.apply(this,arguments)}function ie(e,t){return[Math.min(e,t),Math.max(e,t)]}function oe(e){var t=e.refName,n=e.coord,r=e.oob;return"".concat(t,":").concat(n.toLocaleString("en-US")).concat(r?" (out of bounds)":"")}var se=/electron/i.test("undefined"!==typeof navigator?navigator.userAgent:"");function ce(e){return ue(e).split("").reverse().join("")}var ue=function(){var e=/[ACGT]/gi,t={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};return function(n){return n.replace(e,(function(e){return t[e]||""}))}}();function le(e){var t=new FileReader;return new Promise((function(n,r){t.onload=function(e){e.target?n(e.target.result):r(new Error("unknown result reading blob from canvas"))},t.readAsDataURL(e)}))}var de="undefined"===typeof jest?"undefined"!==typeof window&&window.requestIdleCallback?window.requestIdleCallback:function(e){return setTimeout((function(){return e()}),1)}:function(e){return e()};function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625],r=.5279276315789471;return String(e).split("").map((function(e){return e.charCodeAt(0)<n.length?n[e.charCodeAt(0)]:r})).reduce((function(e,t){return t+e}),0)*t}var pe=["ATG"],he=["TAA","TAG","TGA"],ge={TCA:"S",TCC:"S",TCG:"S",TCT:"S",TTC:"F",TTT:"F",TTA:"L",TTG:"L",TAC:"Y",TAT:"Y",TAA:"*",TAG:"*",TGC:"C",TGT:"C",TGA:"*",TGG:"W",CTA:"L",CTC:"L",CTG:"L",CTT:"L",CCA:"P",CCC:"P",CCG:"P",CCT:"P",CAC:"H",CAT:"H",CAA:"Q",CAG:"Q",CGA:"R",CGC:"R",CGG:"R",CGT:"R",ATA:"I",ATC:"I",ATT:"I",ATG:"M",ACA:"T",ACC:"T",ACG:"T",ACT:"T",AAC:"N",AAT:"N",AAA:"K",AAG:"K",AGC:"S",AGT:"S",AGA:"R",AGG:"R",GTA:"V",GTC:"V",GTG:"V",GTT:"V",GCA:"A",GCC:"A",GCG:"A",GCT:"A",GAC:"D",GAT:"D",GAA:"E",GAG:"E",GGA:"G",GGC:"G",GGG:"G",GGT:"G"};function me(e){var t={};return Object.keys(e).forEach((function(n){for(var r=e[n],a=[],i=0;i<3;i++){var o=n.charAt(i);a[i]=[],a[i][0]=o.toUpperCase(),a[i][1]=o.toLowerCase()}for(var s=0;s<2;s++)for(var c=a[0][s],u=0;u<2;u++)for(var l=a[1][u],d=0;d<2;d++){var f=a[2][d];t[c+l+f]=r}})),t}function ve(e,t,n){return ye.apply(this,arguments)}function ye(){return(ye=(0,a.Z)(u().mark((function e(t,n,r){var a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(t),e.next=3,r();case 3:return a=e.sent,n(""),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t}function xe(e){return"".concat(be(JSON.stringify(e)))}function we(e,t){return ke.apply(this,arguments)}function ke(){return(ke=(0,a.Z)(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return n.blocksForRange(e.refName,e.start,e.end)})));case 2:return r=e.sent,e.abrupt("return",r.flat().map((function(e){return{start:e.minv.blockPosition,end:e.maxv.blockPosition+65535}})).reduce((function(e,t){return e+t.end-t.start}),0));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e){var t=e.refName,n=e.coord,r=e.regionNumber,a=e.self,i=0,o=a.interRegionPaddingWidth*a.bpPerPx,s=a.minimumBlockWidth*a.bpPerPx,c=a.displayedRegions.findIndex((function(e,c){var u=e.end-e.start;return t===e.refName&&n>=e.start&&n<=e.end&&(!r||r===c)?(i+=e.reversed?e.end-n:n-e.start,!0):(u>s&&i/a.bpPerPx>=0&&i/a.bpPerPx<a.width?i+=u+o:i+=u,!1)}));if(a.displayedRegions[c])return{index:c,offsetPx:Math.round(i/a.bpPerPx)}}function Ze(e){return["Gff3TabixAdapter","VcfTabixAdapter","Gff3Adapter","VcfAdapter"].includes(e)}function Se(e){return Math.floor(e/1e6)>0?"".concat(parseFloat((e/1e6).toPrecision(3)),"Mbp"):Math.floor(e/1e3)>0?"".concat(parseFloat((e/1e3).toPrecision(3)),"Kbp"):"".concat(Math.floor(e),"bp")}function Te(e,t){var n=L(e),r=n.dynamicBlocks,a=n.staticBlocks,i=n.offsetPx,o=(null===r||void 0===r?void 0:r.contentBlocks[0])||{},s=(null===a||void 0===a?void 0:a.contentBlocks[0])||{},c=(null===a||void 0===a?void 0:a.contentBlocks[1])||{};return{offsetPx:t?0:i-s.offsetPx,offsetPx1:t?0:i-c.offsetPx,start:o.start,end:o.end}}function Pe(e){return e.sessionId+"-"+e.layoutId}},33528:function(e,t,n){"use strict";n.r(t),n.d(t,{RemoteFileWithRangeCache:function(){return k},getFetcher:function(){return P},openLocation:function(){return T}});var r=n(34795),a=n(33028),i=n(77162),o=n.n(i),s=n(2877),c=n(88778),u=n.n(c),l=n(41361),d=n(96234),f=n(9249),p=n(87371),h=n(93069),g=n(95058),m=n(45754),v=n(86906),y=n(26165),b=n(44765),x={};var w=new y.t({fetch:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=x[e];if(!a)throw new Error("fetch not registered for ".concat(e));return a(e,t,n,r)},size:500*Math.pow(1024,2),chunkSize:15872,maxFetchSize:100*Math.pow(1024,2),minimumTTL:864e5});var k=function(e){(0,m.Z)(n,e);var t=(0,v.Z)(n);function n(){return(0,f.Z)(this,n),t.apply(this,arguments)}return(0,p.Z)(n,[{key:"fetch",value:function(){var e=(0,r.Z)(o().mark((function e(t,r){var a,i,s,c,u,l,f,p,m,v,y,b;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(x[String(t)]||(x[String(t)]=this.fetchBinaryRange.bind(this)),(a=r&&r.headers)&&(a instanceof Headers?i=a.get("range"):Array.isArray(a)?(s=a.find((function(e){return"range"===(0,d.Z)(e,1)[0]}))||[void 0,void 0],c=(0,d.Z)(s,2),i=c[1]):i=a.range),!i){e.next=14;break}if(!(u=/bytes=(\d+)-(\d+)/.exec(i))){e.next=14;break}return l=(0,d.Z)(u,3),f=l[1],p=l[2],m=parseInt(f,10),v=parseInt(p,10),e.next=11,w.getRange(t,m,v-m+1,{signal:r&&r.signal});case 11:return y=e.sent,b=y.headers,e.abrupt("return",new Response(y.buffer,{status:206,headers:b}));case 14:return e.abrupt("return",(0,h.Z)((0,g.Z)(n.prototype),"fetch",this).call(this,t,r));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchBinaryRange",value:function(){var e=(0,r.Z)(o().mark((function e(t,r,i){var s,c,u,f,p,m,v,y,x,w,k,C,Z,S,T=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=T.length>3&&void 0!==T[3]?T[3]:{},c=new Date,u=(0,a.Z)((0,a.Z)({},s.headers),{},{range:"bytes=".concat(r,"-").concat(i)}),e.next=5,(0,h.Z)((0,g.Z)(n.prototype),"fetch",this).call(this,t,(0,a.Z)((0,a.Z)({},s),{},{headers:u}));case 5:if(f=e.sent,p=new Date,206===f.status){e.next=11;break}throw m="HTTP ".concat(f.status," (").concat(f.statusText,") when fetching ").concat(t," bytes ").concat(r,"-").concat(i),v=" (should be 206 for range requests)",new Error("".concat(m).concat(200===f.status?v:""));case 11:y={},x=(0,l.Z)(f.headers.entries());try{for(x.s();!(w=x.n()).done;)k=(0,d.Z)(w.value,2),C=k[0],Z=k[1],y[C]=Z}catch(o){x.e(o)}finally{x.f()}return e.next=16,f.arrayBuffer();case 16:return S=e.sent,e.abrupt("return",{headers:y,requestDate:c,responseDate:p,buffer:b.Buffer.from(S)});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(s.RemoteFile),C=n(8438),Z=n(97891),S=n(81073);function T(e,t){if(!e)throw new Error("must provide a location to openLocation");if(function(e){return"localPath"in e}(e)){if(!e.localPath)throw new Error("No local path provided");if(u()||S.isElectron)return new s.LocalFile(e.localPath);throw new Error("can't use local files in the browser")}if(function(e){return"blobId"in e}(e)){var n=(0,Z.getBlob)(e.blobId);if(!n)throw new Error('file ("'.concat(e.name,'") was opened locally from a previous session. To restore it, go to track settings and reopen the file'));return new s.BlobFile(n)}if((0,C.hb)(e)){if(!e.uri)throw new Error("No URI provided");var r=e.baseUri?(0,a.Z)((0,a.Z)({},e),{},{uri:new URL(e.uri,e.baseUri).href}):e;if(t){var i=R(e,t);if(i)return i.openLocation(r)}return new k(r.uri,{fetch:M})}throw new Error("invalid fileLocation")}function P(e,t){if(!(0,C.hb)(e))throw new Error("Not a valid UriLocation: ".concat(JSON.stringify(e)));var n=R(e,t);return n?n.getFetcher(e):M}function R(e,t){var n=t.rootModel;if(n&&(0,C.dc)(n))return n.findAppropriateInternetAccount(e);if(e.internetAccountPreAuthorization){if(!e.internetAccountPreAuthorization.authInfo.token)throw new Error("Failed to obtain token from internet account. Try reloading the page");return t.getInternetAccountType(e.internetAccountPreAuthorization.internetAccountType).stateModel.create({type:e.internetAccountPreAuthorization.internetAccountType,configuration:e.internetAccountPreAuthorization.authInfo.configuration})}}function M(e,t){return j.apply(this,arguments)}function j(){return(j=(0,r.Z)(o().mark((function e(t,n){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,n);case 2:if(401!==(r=e.sent).status){e.next=7;break}if(!(a=r.headers.get("WWW-Authenticate"))||!a.includes("Basic")){e.next=7;break}throw new C.yb("Accessing HTTPBasic resource without authentication",t.toString());case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},11192:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(58145),a=n.n(r);function i(){var e=new(a().Jexl);return e.addFunction("get",(function(e,t){return e.get(t)})),e.addFunction("parent",(function(e){return e.parent()})),e.addFunction("id",(function(e){return e.id()})),e.addFunction("cast",(function(e){return e})),e.addFunction("log",(function(e){return console.log(e),e})),e.addFunction("max",Math.max),e.addFunction("min",Math.min),e.addFunction("sqrt",Math.sqrt),e.addFunction("ceil",Math.ceil),e.addFunction("floor",Math.floor),e.addFunction("round",Math.round),e.addFunction("abs",Math.abs),e.addFunction("log10",Math.log10),e.addFunction("parseInt",Number.parseInt),e.addFunction("parseFloat",Number.parseFloat),e.addFunction("split",(function(e,t){return e.split(t)})),e.addFunction("charAt",(function(e,t){return e.charAt(t)})),e.addFunction("charCodeAt",(function(e,t){return e.charCodeAt(t)})),e.addFunction("codePointAt",(function(e,t){return e.codePointAt(t)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("endsWith",(function(e,t,n){return e.endsWith(t,n)})),e.addFunction("padEnd",(function(e,t,n){return e.padEnd(t,n)})),e.addFunction("padStart",(function(e,t,n){return e.padStart(t,n)})),e.addFunction("repeat",(function(e,t){return e.repeat(t)})),e.addFunction("replace",(function(e,t,n){return e.replace(t,n)})),e.addFunction("replaceAll",(function(e,t,n){return e.replaceAll(t,n)})),e.addFunction("slice",(function(e,t,n){return e.slice(t,n)})),e.addFunction("startsWith",(function(e,t,n){return e.startsWith(t,n)})),e.addFunction("substring",(function(e,t,n){return e.substring(t,n)})),e.addFunction("toLowerCase",(function(e){return e.toLowerCase()})),e.addFunction("toUpperCase",(function(e){return e.toUpperCase()})),e.addFunction("trim",(function(e){e.trim()})),e.addFunction("trimEnd",(function(e){return e.trimEnd()})),e.addFunction("trimStart",(function(e){return e.trimStart()})),e.addFunction("getTag",(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)})),e.addBinaryOp("&",15,(function(e,t){return e&t})),e}},32665:function(e,t,n){"use strict";n.d(t,{P:function(){return i}});var r=n(11192),a={};function i(e,t){var n="nosig|".concat(e);if(!a[n]){if(!e.startsWith("jexl:"))throw new Error("string does not appear to be in jexl format");var i=e.split("jexl:")[1],o=t?t.compile("".concat(i)):(0,r.Z)().compile("".concat(i));a[n]=o}return a[n]}},26354:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(41361),a=n(96234),i=n(9249),o=n(87371),s=n(81073),c=1e4;function u(e,t,n,r){return t>=n&&r>=e}var l=function(){function e(){(0,i.Z)(this,e),this.padding=void 0,this.allFilled=void 0,this.widthLimit=void 0,this.rowState=void 0,this.padding=1,this.widthLimit=1e6}return(0,o.Z)(e,[{key:"setAllFilled",value:function(e){this.allFilled=e}},{key:"getItemAt",value:function(e){if(this.allFilled)return this.allFilled;if(this.rowState&&void 0!==this.rowState.min&&!(e<this.rowState.min)&&!(e>=this.rowState.max)){var t=e-this.rowState.offset;return this.rowState.bits[t]}}},{key:"isRangeClear",value:function(e,t){if(this.allFilled)return!1;if(!this.rowState)return!0;var n=this.rowState,r=n.min,a=n.max;if(t<=r||e>=a)return!0;for(var i=Math.min(a,t),o=Math.max(r,e);o<t&&o<i;o+=1)if(this.getItemAt(o))return!1;return!0}},{key:"initialize",value:function(e,t){var n=t-e;return{offset:e-n,min:e,max:t,bits:new Array(3*n)}}},{key:"addRect",value:function(e,t){var n=e.l,r=e.r+this.padding;this.rowState||(this.rowState=this.initialize(n,r));var a=n-this.rowState.offset,i=r-this.rowState.offset,o=this.rowState.bits.length;if(i>=this.rowState.bits.length){var s=i+1;this.rowState.bits.length+s>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):s>0&&(this.rowState.bits=this.rowState.bits.concat(new Array(s)))}if(n<this.rowState.offset){var c=Math.min(o-a,this.rowState.offset);this.rowState.bits.length+c>this.widthLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.rowState=this.initialize(n,r)):(this.rowState.bits=new Array(c).concat(this.rowState.bits),this.rowState.offset-=c)}var u=(i=r-this.rowState.offset)-(a=n-this.rowState.offset);u>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(u," bits in a single row."),e,t);for(var l=a;l<i;l+=1)this.rowState.bits[l]=t;n<this.rowState.min&&(this.rowState.min=n),r>this.rowState.max&&(this.rowState.max=r)}},{key:"discardRange",value:function(e,t){if(!this.allFilled&&this.rowState&&!(t<=this.rowState.min||e>=this.rowState.max))if(e<=this.rowState.min&&t>=this.rowState.max)this.rowState=void 0;else{if(t>this.rowState.min&&e<=this.rowState.min&&(this.rowState.min=t),e<this.rowState.max&&t>=this.rowState.max&&(this.rowState.max=e),this.rowState.offset<this.rowState.min-c&&this.rowState.bits.length>this.rowState.max+c-this.rowState.offset){var n=this.rowState.min-this.rowState.offset,r=this.rowState.bits.length-1-(this.rowState.max-this.rowState.offset);this.rowState.bits=this.rowState.bits.slice(n,this.rowState.bits.length-r),this.rowState.offset+=n}else if(this.rowState.offset<this.rowState.min-c){var a=this.rowState.min-Math.floor(5e3)-this.rowState.offset;this.rowState.bits.splice(0,a),this.rowState.offset+=a}else if(this.rowState.bits.length>this.rowState.max-this.rowState.offset+c){var i=this.rowState.max-this.rowState.offset+1+Math.floor(5e3);this.rowState.bits.length=i}for(var o=Math.max(this.rowState.min,e)-this.rowState.offset,s=Math.min(t,this.rowState.max)-this.rowState.offset,u=o;u>=0&&u<s;u+=1)this.rowState.bits[u]=void 0}}}]),e}(),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pitchX,r=void 0===n?10:n,a=t.pitchY,o=void 0===a?10:a,s=t.maxHeight,c=void 0===s?1e4:s,u=t.hardRowLimit,l=void 0===u?1e4:u,d=t.displayMode,f=void 0===d?"normal":d;(0,i.Z)(this,e),this.pitchX=void 0,this.pitchY=void 0,this.hardRowLimit=void 0,this.bitmap=void 0,this.rectangles=void 0,this.maxHeightReached=void 0,this.maxHeight=void 0,this.displayMode=void 0,this.pTotalHeight=void 0,this.pitchX=r,this.pitchY=o,this.hardRowLimit=l,this.maxHeightReached=!1,this.displayMode=f,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles=new Map,this.maxHeight=Math.ceil(c/this.pitchY),this.pTotalHeight=0}return(0,o.Z)(e,[{key:"addRect",value:function(e,t,n,r,a){var i=this.rectangles.get(e);if(i)return null===i.top?null:(this.addRectToBitmap(i),i.top*this.pitchY);var o=Math.floor(t/this.pitchX),s=Math.floor(n/this.pitchX),c=Math.ceil(r/this.pitchY),u={id:e,l:o,r:s,top:null,h:c,originalHeight:r,data:a},l=this.maxHeight-c,d=0;if("collapse"!==this.displayMode){for(;d<=l&&this.collides(u,d);d+=1);if(d>l)return u.top=null,this.rectangles.set(e,u),this.maxHeightReached=!0,null}return u.top=d,this.addRectToBitmap(u),this.rectangles.set(e,u),this.pTotalHeight=Math.max(this.pTotalHeight||0,d+c),d*this.pitchY}},{key:"collides",value:function(e,t){for(var n=this.bitmap,r=t+e.h,a=t;a<r;a+=1){var i=n[a];if(i&&!i.isRangeClear(e.l,e.r))return!0}return!1}},{key:"autovivifyRow",value:function(e,t){var n=e[t];if(!n){if(t>this.hardRowLimit)throw new Error("layout hard limit (".concat(this.hardRowLimit*this.pitchY,"px) exceeded, aborting layout"));n=new l,e[t]=n}return n}},{key:"addRectToBitmap",value:function(e){if(null!==e.top){var t=e.id,n=e.top+e.h;if(e.r-e.l>2e4)for(var r=e.top;r<n;r+=1)this.autovivifyRow(this.bitmap,r).setAllFilled(t);else for(var a=e.top;a<n;a+=1)this.autovivifyRow(this.bitmap,a).addRect(e,t)}}},{key:"discardRange",value:function(e,t){for(var n=Math.floor(e/this.pitchX),r=Math.floor(t/this.pitchX),a=this.bitmap,i=0;i<a.length;i+=1){var o=a[i];o&&o.discardRange(n,r)}}},{key:"hasSeen",value:function(e){return this.rectangles.has(e)}},{key:"getByCoord",value:function(e,t){var n=Math.floor(t/this.pitchY),r=this.bitmap[n];if(r){var a=Math.floor(e/this.pitchX);return r.getItemAt(a)}}},{key:"getByID",value:function(e){var t=this.rectangles.get(e);if(t){var n=t.top*this.pitchY;return[t.l*this.pitchX,n,t.r*this.pitchX,n+t.originalHeight]}}},{key:"getDataByID",value:function(e){var t;return null===(t=this.rectangles.get(e))||void 0===t?void 0:t.data}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}},{key:"totalHeight",get:function(){return this.getTotalHeight()}},{key:"getRectangles",value:function(){var e=this;return new Map(Array.from(this.rectangles.entries()).map((function(t){var n=(0,a.Z)(t,2),r=n[0],i=n[1],o=i.l,s=i.r,c=i.originalHeight,u=(i.top||0)*e.pitchY,l=u+c;return[r,[o*e.pitchX,u,s*e.pitchX,l]]})))}},{key:"serializeRegion",value:function(e){var t,n={},i=!1,o=(0,r.Z)(this.rectangles.entries());try{for(o.s();!(t=o.n()).done;){var s=(0,a.Z)(t.value,2),c=s[0],l=s[1],d=l.l,f=l.r,p=l.originalHeight,h=l.top;if(null===l.top)i=!0;else{var g=(h||0)*this.pitchY,m=g+p,v=d*this.pitchX,y=f*this.pitchX;u(e.start,e.end,v-this.pitchX,y+this.pitchX)&&(n[c]=[v,g,y,m])}}}catch(b){o.e(b)}finally{o.f()}return{rectangles:n,containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:i}}},{key:"toJSON",value:function(){return{rectangles:(0,s.objectFromEntries)(this.getRectangles()),containsNoTransferables:!0,totalHeight:this.getTotalHeight(),maxHeightReached:this.maxHeightReached}}}]),e}()},35064:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(96234),a=n(41361),i=n(9249),o=n(87371),s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.Z)(this,e),this.SubLayoutClass=t,this.subLayouts=new Map,this.subLayoutConstructorArgs={},this.subLayouts=new Map,this.subLayoutConstructorArgs=n}return(0,o.Z)(e,[{key:"getDataByID",value:function(e){var t,n=(0,a.Z)(this.subLayouts.values());try{for(n.s();!(t=n.n()).done;){var r=t.value.getDataByID(e);if(r)return r}}catch(i){n.e(i)}finally{n.f()}}},{key:"getSublayout",value:function(e){var t=this.subLayouts.get(e);return void 0===t?(t=new this.SubLayoutClass(this.subLayoutConstructorArgs),this.subLayouts.set(e,t),t):t}},{key:"addRect",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.getSublayout(e).addRect(t,n,r,a,i)}},{key:"discardRange",value:function(e,t,n){var r=this.subLayouts.get(e);return r&&r.discardRange(t,n)}},{key:"toJSON",value:function(){var e,t={},n=(0,a.Z)(this.subLayouts.entries());try{for(n.s();!(e=n.n()).done;){var i=(0,r.Z)(e.value,2),o=i[0],s=i[1];t[o]=s.toJSON()}}catch(c){n.e(c)}finally{n.f()}return t}}]),e}()},2972:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(96234),a=n(9249),i=n(87371),o=n(81073),s=n(68294),c=n.n(s),u=function(){function e(t){var n=t.rectangles,i=t.totalHeight,o=t.maxHeightReached;(0,a.Z)(this,e),this.rectangles=void 0,this.totalHeight=void 0,this.maxHeightReached=void 0,this.rbush=void 0,this.rectangles=new Map(Object.entries(n)),this.totalHeight=i,this.maxHeightReached=o,this.rbush=new(c());for(var s=0,u=Object.entries(n);s<u.length;s++){var l=(0,r.Z)(u[s],2),d=l[0],f=l[1];this.rbush.insert({minX:f[0],minY:f[1],maxX:f[2],maxY:f[3],name:d})}}return(0,i.Z)(e,[{key:"addRect",value:function(e){var t=this.rectangles.get(e);if(!t)throw new Error("id ".concat(e," not found in precomputed feature layout"));return t[1]}},{key:"getRectangles",value:function(){return this.rectangles}},{key:"getTotalHeight",value:function(){return this.totalHeight}},{key:"collides",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getByCoord",value:function(e,t){var n={minX:e,minY:t,maxX:e+1,maxY:t+1};return this.rbush.collides(n)?this.rbush.search(n)[0].name:void 0}},{key:"getByID",value:function(e){return this.rectangles.get(e)}},{key:"addRectToBitmap",value:function(e,t){throw new Error("Method not implemented.")}},{key:"discardRange",value:function(e,t){throw new Error("Method not implemented.")}},{key:"serializeRegion",value:function(e){throw new Error("Method not implemented.")}},{key:"toJSON",value:function(){return{rectangles:(0,o.objectFromEntries)(this.rectangles),totalHeight:this.totalHeight,maxHeightReached:!1,containsNoTransferables:!0}}}]),e}()},41472:function(e,t,n){"use strict";n.r(t),n.d(t,{GranularRectLayout:function(){return r.Z},MultiLayout:function(){return a.Z},PrecomputedLayout:function(){return i.Z},PrecomputedMultiLayout:function(){return f},SceneGraph:function(){return g}});var r=n(26354),a=n(35064),i=n(2972),o=n(96234),s=n(45754),c=n(86906),u=n(87371),l=n(9249),d=(0,u.Z)((function e(){throw(0,l.Z)(this,e),new Error("invalid layout name")})),f=function(e){(0,s.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,l.Z)(this,n),r=t.call(this,d),Object.entries(e).forEach((function(e){var t=(0,o.Z)(e,2),n=t[0],a=t[1];r.subLayouts.set(n,new i.Z(a))})),r}return(0,u.Z)(n)}(a.Z),p=n(41361),h=n(81073),g=function(){function e(t,n,r,a,i,o){if((0,l.Z)(this,e),this.name=t,this.left=n,this.top=r,this.width=a,this.height=i,this.data=o,this.children=void 0,this.absoluteCache=void 0,this.parent=void 0,h.inDevelopment&&("string"!==typeof t||"number"!==typeof n||Number.isNaN(n)||"number"!==typeof r||Number.isNaN(r)||"number"!==typeof a||Number.isNaN(a)||"number"!==typeof i||Number.isNaN(i)))throw new TypeError("invalid SceneGraph arguments");this.children=new Map,this.absoluteCache={dirty:!0}}return(0,u.Z)(e,[{key:"addChild",value:function(t,n,r,a,i,o){var s;if(!((s=t instanceof e?t:new e(t,n,r,a,i,o))instanceof e))throw new TypeError("argument to addChild must be an array or a SceneGraph");if(this.children.has(s.name))throw new Error('child named "'.concat(s.name,'" already exists'));s.parent=this;var c=s.absolute,u=c.left,l=c.right,d=c.top,f=c.bottom;return void 0!==u&&void 0!==l&&void 0!==d&&void 0!==f&&(this.expand(u,l,d,f),this.children.set(s.name,s)),s}},{key:"getSubRecord",value:function(e){return this.children.get(e)}},{key:"expand",value:function(e,t,n,r){var a=this.absolute,i=a.left,o=a.right,s=a.top,c=a.bottom;if(void 0!==i&&e<i){var u=i-e;this.width+=u,this.left-=u}if(void 0!==o&&t>o&&(this.width+=t-o),void 0!==s&&n<s){var l=s-n;this.height+=l,this.top-=l}void 0!==c&&r>c&&(this.height+=r-c),this.parent&&this.parent.expand(e,t,n,r),this.absoluteCache.dirty=!0}},{key:"bottom",get:function(){return this.top+this.height}},{key:"right",get:function(){return this.left+this.width}},{key:"walkParents",value:function(e){this.parent&&(e(this.parent),this.parent.walkParents(e))}},{key:"walkChildren",value:function(e){var t,n=(0,p.Z)(this.children.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r),r.walkChildren(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"absolute",get:function(){if(this.absoluteCache.dirty){var e=0,t=0;this.walkParents((function(n){e+=n.left,t+=n.top})),this.absoluteCache={dirty:!1,left:this.left+e,right:this.right+e,top:this.top+t,bottom:this.bottom+t,width:this.width,height:this.height}}return this.absoluteCache}},{key:"move",value:function(e,t){this.left+=e,this.top+=t,this.absoluteCache.dirty=!0,this.walkChildren((function(e){e.absoluteCache.dirty=!0}));var n=this.absolute,r=n.left,a=n.right,i=n.top,o=n.bottom;void 0!==r&&void 0!==a&&void 0!==i&&void 0!==o&&this.expand(r,a,i,o)}}]),e}()},88981:function(e,t,n){"use strict";n.r(t),n.d(t,{getDefaultValue:function(){return s},getEnumerationValues:function(){return c},getPropertyType:function(){return o},getSubType:function(){return a},getUnionSubTypes:function(){return i},resolveLateType:function(){return u}});var r=n(40909);function a(e){var t;if((0,r.isOptionalType)(e))t=e._subtype||e.type;else{if(!(0,r.isArrayType)(e)&&!(0,r.isMapType)(e)){if("function"===typeof e.getSubType)return e.getSubType();throw new TypeError("unsupported mst type")}t=e._subtype||e._subType||e.subType}if(!t)throw new Error("failed to get subtype");return t}function i(e){if(!(0,r.isUnionType)(e))throw new TypeError("not an MST union type");var t=e._types||e.types||a(e)._types||a(e).types;if(!t)throw new Error("failed to extract subtypes from mst union");return t}function o(e,t){return e.properties[t]}function s(e){if(!(0,r.isOptionalType)(e))throw new TypeError("type must be an optional type");return e._defaultValue||e.defaultValue}function c(e){return i(e).map((function(e){return e.value}))}function u(e){return(0,r.isUnionType)(e)||(0,r.isArrayType)(e)||!(0,r.isLateType)(e)?e:e.getSubType()}},84070:function(e,t,n){"use strict";var r=n(25625);t.Z=r.Z},25685:function(e,t,n){"use strict";n.d(t,{E:function(){return g}});var r=n(68079),a=n(33028),i=n(96234),o=n(41361),s=(n(30969),n(64841)),c=n.n(s),u=n(8218),l=n.n(u);function d(e){var t=l()(e);return{hex:t.hex(),opacity:t.alpha()}}function f(e){var t,n=void 0,r=void 0,a="normal",i="normal",o="normal",s="normal",c=e.split(/\s+/);e:for(;t=c.shift();)switch(t){case"normal":break;case"italic":case"oblique":a=t;break;case"small-caps":o=t;break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":i=t;break;default:if(!r){var u=t.split("/");r=u[0],u.length>1&&(s=u[1]);break}n=t,c.length&&(n+=" ".concat(c.join(" ")));break e}return{fontStyle:a,fontVariant:o,fontWeight:i,fontSize:r,lineHeight:s,fontFamily:n}}var p=n(25664),h=n(37574);function g(e){var t,n,s,u,l,g=[],m=[],v=0,y=(0,o.Z)(e.getCommands());try{for(y.s();!(l=y.n()).done;){var b=l.value;if((0,p.FJ)(b)){if("font"===b.name&&b.args){var x=f(b.args[0]);u={fontStyle:x.fontStyle,fontFamily:x.fontFamily,fontSize:x.fontSize}}"fillStyle"===b.name&&b.args&&(t=b.args[0]),"strokeStyle"===b.name&&b.args&&(n=b.args[0])}else{if(!(0,p.$E)(b))throw new Error("invalid call");if("fillRect"===b.name){var w=b.args,k=(0,i.Z)(w,4),C=k[0],Z=k[1],S=k[2],T=k[3],P=d(t),R=P.hex,M=P.opacity,j=Math.min(Z,Z+T),A=Math.abs(T);m.push((0,h.jsx)("rect",{fill:R,fillOpacity:1!==M?M:void 0,x:C.toFixed(3),y:j.toFixed(3),width:S.toFixed(3),height:A.toFixed(3)},v))}if("fillText"===b.name){var N=b.args,L=(0,i.Z)(N,3),F=L[0],I=L[1],B=L[2],D=d(t),E=D.hex,V=D.opacity;m.push((0,h.jsx)("text",(0,a.Z)((0,a.Z)({fill:E,fillOpacity:1!==V?V:void 0,x:I.toFixed(3),y:B.toFixed(3)},u),{},{children:F}),v))}if("beginPath"===b.name&&(g=[]),"moveTo"===b.name&&g.push(b.args),"lineTo"===b.name&&g.push(b.args),b.name,"fill"===b.name){for(var O,z=(O=c()()).moveTo.apply(O,(0,r.Z)(g[0])),W=1;W<g.length;W++){var H;z=(H=z).lineTo.apply(H,(0,r.Z)(g[W]))}z.end();var q=d(t),U=q.hex,_=q.opacity;m.push((0,h.jsx)("path",{fill:U,d:z,fillOpacity:1!==_?_:void 0},v))}if("stroke"===b.name){for(var G,J=(G=c()()).moveTo.apply(G,(0,r.Z)(g[0])),X=1;X<g.length;X++){var Y;J=(Y=J).lineTo.apply(Y,(0,r.Z)(g[X]))}J.end();var Q=d(n),$=Q.hex,K=Q.opacity;m.push((0,h.jsx)("path",{fill:"none",stroke:$,fillOpacity:1!==K?K:void 0,d:J},v))}if("rotate"===b.name){var ee=b.args;s=180*(0,i.Z)(ee,1)[0]/Math.PI}}v++}}catch(te){y.e(te)}finally{y.f()}return s?(0,h.jsx)("g",{transform:"rotate(".concat(s,")"),children:[].concat(m)}):(0,h.jsx)(h.Fragment,{children:[].concat(m)})}},25664:function(e,t,n){"use strict";var r;n.d(t,{$E:function(){return o},FJ:function(){return s}}),function(e){e[e.STRING=0]="STRING",e[e.FLOAT=1]="FLOAT",e[e.BOOL=2]="BOOL",e[e.FOLLOWING_ARGUMENTS_OPTIONAL=3]="FOLLOWING_ARGUMENTS_OPTIONAL"}(r||(r={}));var a={strokeStyle:[r.FOLLOWING_ARGUMENTS_OPTIONAL,r.STRING],font:[r.FOLLOWING_ARGUMENTS_OPTIONAL,r.STRING],fillStyle:[r.FOLLOWING_ARGUMENTS_OPTIONAL,r.STRING]},i={arc:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FOLLOWING_ARGUMENTS_OPTIONAL,r.BOOL],arcTo:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],beginPath:[],clearRect:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],closePath:[],ellipse:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FOLLOWING_ARGUMENTS_OPTIONAL,r.BOOL],fill:[r.FOLLOWING_ARGUMENTS_OPTIONAL,r.STRING],fillRect:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],fillText:[r.STRING,r.FLOAT,r.FLOAT,r.FOLLOWING_ARGUMENTS_OPTIONAL,r.FLOAT],lineTo:[r.FLOAT,r.FLOAT],moveTo:[r.FLOAT,r.FLOAT],quadraticCurveTo:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],rect:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],restore:[],rotate:[r.FLOAT],save:[],setTransform:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],scale:[r.FLOAT,r.FLOAT],stroke:[],strokeRect:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],strokeText:[r.STRING,r.FLOAT,r.FLOAT,r.FOLLOWING_ARGUMENTS_OPTIONAL,r.FLOAT],transform:[r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT,r.FLOAT],translate:[r.FLOAT,r.FLOAT]};function o(e){return Boolean(e.name in i)}function s(e){return Boolean(e.name in a)}},37654:function(e,t,n){"use strict";function r(e,t,n,r){return t>n&&e<r&&r-n&&t-e?e>n?t<r?[e,t]:[e,r]:t<r?[n,t]:[n,r]:[]}function a(e,t,n,r){return t>n&&e<r}function i(e,t,n,r){return n<=e&&r>=t}n.d(t,{J7:function(){return i},U0:function(){return r},qY:function(){return a}})},26131:function(e,t,n){"use strict";n.r(t),n.d(t,{ObservableCreate:function(){return o}});var r=n(45996),a=n(728),i=n(81073);function o(e,t){return r.y.create((function(t){try{var n=e(t);n&&n.catch&&n.catch((function(e){return t.error(e)}))}catch(r){t.error(r)}})).pipe((0,a.R)((0,i.observeAbortSignal)(t)))}},14956:function(e,t,n){"use strict";n.d(t,{T:function(){return o},Z:function(){return c}});var r=n(33028),a=n(9249),i=n(87371);function o(e){return"object"===typeof e&&null!==e&&"function"===typeof e.get&&"function"===typeof e.id}function s(e){return"uniqueId"in e&&"object"!==typeof e.data}var c=function(){function e(t){var n=this;(0,a.Z)(this,e),this.data=void 0,this.subfeatures=void 0,this.parentHandle=void 0,this.uniqueId=void 0,s(t)?this.data=t:(this.data=t.data||{},this.parentHandle=t.parent);var i,o=s(t)?t.uniqueId:t.id;if(void 0===o||null===o)throw new Error("SimpleFeature requires a unique `id` or `data.uniqueId` attribute");if(this.uniqueId=String(o),!(this.data.aliases||this.data.end-this.data.start>=0))throw new Error("invalid feature data, end less than start. end: ".concat(this.data.end," start: ").concat(this.data.start));this.data.subfeatures&&(this.subfeatures=null===(i=this.data.subfeatures)||void 0===i?void 0:i.map((function(t,a){return"function"!==typeof t.get?new e({id:t.uniqueId||"".concat(o,"-").concat(a),data:(0,r.Z)({strand:n.data.strand},t),parent:n}):t})))}return(0,i.Z)(e,[{key:"get",value:function(e){return"subfeatures"===e?this.subfeatures:"parent"===e?this.parent():this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"tags",value:function(){return Object.keys(this.data)}},{key:"id",value:function(){return this.uniqueId}},{key:"parent",value:function(){return this.parentHandle}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"toJSON",value:function(){var e=(0,r.Z)((0,r.Z)({},this.data),{},{uniqueId:this.id()}),t=this.parent();t&&(e.parentId=t.id());var n=this.children();return n&&(e.subfeatures=n.map((function(e){return e.toJSON()}))),e}}],[{key:"fromJSON",value:function(t){return new e((0,r.Z)({},t))}}]),e}()},66518:function(e,t,n){"use strict";n.d(t,{I9:function(){return u},fK:function(){return l},fY:function(){return f}});var r=n(34795),a=n(33028),i=n(77162),o=n.n(i),s=n(6694);function c(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return 0===n?0:(a?r=t/n-e*e/(n*n):(r=t-e*e/n,n>1&&(r/=n-1)),r<0?0:Math.sqrt(r))}function u(e){return(0,a.Z)((0,a.Z)({},e),{},{scoreMean:(e.scoreSum||0)/(e.featureCount||e.basesCovered||1),scoreStdDev:c(e.scoreSum,e.scoreSumSquares,e.featureCount||e.basesCovered),featureDensity:(e.featureCount||1)/e.basesCovered})}function l(e,t){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(o().mark((function e(t,n){var r,a,i,c,l,d,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.start,a=t.end,e.next=3,n.pipe((0,s.u)((function(e,t){var n=t.get("score");return e.scoreMax=Math.max(e.scoreMax,t.get("summary")?t.get("maxScore"):n),e.scoreMin=Math.min(e.scoreMin,t.get("summary")?t.get("minScore"):n),e.scoreSum+=n,e.scoreSumSquares+=n*n,e.featureCount+=1,e}),{scoreMin:Number.MAX_VALUE,scoreMax:Number.MIN_VALUE,scoreSum:0,scoreSumSquares:0,featureCount:0})).toPromise();case 3:return i=e.sent,c=i.scoreMin,l=i.scoreMax,d=i.scoreSum,f=i.scoreSumSquares,p=i.featureCount,e.abrupt("return",u({scoreMax:l,scoreMin:c,scoreSum:d,scoreSumSquares:f,featureCount:p,basesCovered:a-r+1}));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return{scoreMin:0,scoreMax:0,scoreMean:0,scoreStdDev:0,scoreSum:0,scoreSumSquares:0,featureCount:0,featureDensity:0,basesCovered:0}}},97891:function(e,t,n){"use strict";n.r(t),n.d(t,{UNKNOWN:function(){return u},UNSUPPORTED:function(){return l},generateUnknownTrackConf:function(){return k},generateUnsupportedTrackConf:function(){return w},getBlob:function(){return f},getBlobMap:function(){return p},getFileName:function(){return y},getParentRenderProps:function(){return c},getRpcSessionId:function(){return s},getTrackAssemblyNames:function(){return o},guessAdapter:function(){return b},guessTrackType:function(){return x},makeIndex:function(){return m},makeIndexType:function(){return v},setBlobMap:function(){return h},storeBlobLocation:function(){return g}});var r=n(40909),a=n(81073),i=n(9077);function o(e){var t=e.configuration,n=(0,i.readConfObject)(t,"assemblyNames");if(!n){var a=(0,r.getParent)(e.configuration);if("sequence"in a)return[(0,i.readConfObject)(a,"name")]}return n}function s(e){for(var t,n=e;!(0,r.isRoot)(n);n=(0,r.getParent)(n))"rpcSessionId"in n&&(t=n.rpcSessionId);if(!t)throw new Error("getRpcSessionId failed, no parent node in the state tree has an `rpcSessionId` attribute");return t}function c(e){for(var t=(0,r.getParent)(e);!(0,r.isRoot)(t);t=(0,r.getParent)(t))if("renderProps"in t)return t.renderProps();return{}}var u="UNKNOWN",l="UNSUPPORTED",d={};function f(e){return d[e]}function p(){return d}function h(e){d=e}function g(e){if(e&&"blob"in e){var t="b".concat(+Date.now());return d[t]=e.blob,{name:null===e||void 0===e?void 0:e.blob.name,blobId:t,locationType:"BlobLocation"}}return e}function m(e,t){return"uri"in e?{uri:e.uri+t,locationType:"UriLocation"}:"localPath"in e?{localPath:e.localPath+t,locationType:"LocalPathLocation"}:e}function v(e,t,n){return null!==e&&void 0!==e&&e.toUpperCase().endsWith(t)?t:n}function y(e){var t="uri"in e?e.uri:void 0,n="localPath"in e?e.localPath:void 0,r="blobId"in e?e:void 0;return(null===r||void 0===r?void 0:r.name)||(null===t||void 0===t?void 0:t.slice(t.lastIndexOf("/")+1))||(null===n||void 0===n?void 0:n.slice(n.lastIndexOf("/")+1))||""}function b(e,t,n,a){if(a){var i=(0,r.getEnv)(a).pluginManager.evaluateExtensionPoint("Core-guessAdapterForLocation",(function(e,t,n){}))(e,t,n);if(i)return i}return{type:u}}function x(e,t){if(t){var n=(0,a.getSession)(t),i=(0,r.getEnv)(n).pluginManager.evaluateExtensionPoint("Core-guessTrackTypeForLocation",(function(e){}))(e);if(i)return i}return"FeatureTrack"}function w(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unsupported)"),description:'Support not yet implemented for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}function k(e,t,n){var r={type:"FeatureTrack",name:"".concat(e," (Unknown)"),description:'Could not determine track type for "'.concat(t,'"'),category:n,trackId:""};return r.trackId=(0,a.objectHash)(r),r}},29206:function(e,t,n){"use strict";n.r(t),n.d(t,{BlobLocation:function(){return y},ElementId:function(){return p},FileLocation:function(){return w},LocalPathLocation:function(){return v},NoAssemblyRegion:function(){return g},PropTypes:function(){return h},Region:function(){return m},UriLocation:function(){return x},UriLocationRaw:function(){return b}});var r=n(33028),a=n(59740),i=n(22809),o=n.n(i),s=n(40909),c=n(24974),u=n.n(c),l=n(90550),d=["baseUri"],f=["locationType"],p=s.types.optional(s.types.identifier,o().generate),h={Region:u().shape({refName:u().string.isRequired,start:u().number.isRequired,end:u().number.isRequired}),ConfigSchema:l.PropTypes.objectOrObservableObject,Feature:u().shape({get:u().func.isRequired,id:u().func.isRequired})},g=s.types.model("NoAssemblyRegion",{refName:s.types.string,start:s.types.number,end:s.types.number,reversed:s.types.optional(s.types.boolean,!1)}).actions((function(e){return{setRefName:function(t){e.refName=t}}})),m=s.types.compose("Region",g,s.types.model({assemblyName:s.types.string})),v=s.types.model("LocalPathLocation",{locationType:s.types.literal("LocalPathLocation"),localPath:s.types.string}),y=s.types.model("BlobLocation",{locationType:s.types.literal("BlobLocation"),name:s.types.string,blobId:s.types.string}),b=s.types.model("UriLocation",{locationType:s.types.literal("UriLocation"),uri:s.types.string,baseUri:s.types.maybe(s.types.string),internetAccountId:s.types.maybe(s.types.string),internetAccountPreAuthorization:s.types.maybe(s.types.model("InternetAccountPreAuthorization",{internetAccountType:s.types.string,authInfo:s.types.frozen()}))}),x=s.types.snapshotProcessor(b,{postProcessor:function(e){var t=e.baseUri,n=(0,a.Z)(e,d);return t?e:n}}),w=s.types.snapshotProcessor(s.types.union(v,x,y),{preProcessor:function(e){if(e){var t=e.locationType,n=(0,a.Z)(e,f);if(!t){var i=n.uri,o=n.localPath,s=n.blob,c="";return void 0!==i?c="UriLocation":void 0!==o?c="LocalPathLocation":void 0!==s&&(c="BlobLocation"),(0,r.Z)((0,r.Z)({},n),{},{locationType:c})}return e}}})},99703:function(e,t,n){"use strict";n.r(t),n.d(t,{cigarToMismatches:function(){return d},getMismatches:function(){return p},getModificationPositions:function(){return g},getModificationTypes:function(){return m},getNextRefPos:function(){return h},mdToMismatches:function(){return f},parseCigar:function(){return l}});var r=n(96234),a=n(46840),i=n(77162),o=n.n(i),s=n(81073),c=o().mark(h),u=new RegExp(/(\d+|\^[a-z]+|[a-z])/gi);function l(e){return(e||"").split(/([MIDNSHPX=])/)}function d(e,t,n,r){for(var a=0,i=0,o=[],s=n&&t,c=0;c<e.length;c+=2){var u=+e[c],l=e[c+1];if("M"===l||"="===l||"E"===l){if(s)for(var d=0;d<u;d++)t[i+d].toUpperCase()!==n[a+d].toUpperCase()&&o.push({start:a+d,type:"mismatch",base:t[i+d],length:1});i+=u}if("I"===l)o.push({start:a,type:"insertion",base:"".concat(u),length:0}),i+=u;else if("D"===l)o.push({start:a,type:"deletion",base:"*",length:u});else if("N"===l)o.push({start:a,type:"skip",base:"N",length:u});else if("X"===l){for(var f=t.slice(i,i+u),p=(null===r||void 0===r?void 0:r.slice(i,i+u))||[],h=0;h<u;h++)o.push({start:a+h,type:"mismatch",base:f[h],qual:p[h],length:1});i+=u}else"H"===l?o.push({start:a,type:"hardclip",base:"H".concat(u),cliplen:u,length:1}):"S"===l&&(o.push({start:a,type:"softclip",base:"S".concat(u),cliplen:u,length:1}),i+=u);"I"!==l&&"S"!==l&&"H"!==l&&(a+=u)}return o}function f(e,t,n,r,a){var i=[],o={start:0,base:"",length:0,type:"mismatch"},s=n.filter((function(e){return"skip"===e.type})),c=0,l=0,d=0,f=0;function p(e){for(var n=l,r=d,a=c;a<t.length&&r<=e;c=a+=2){var i=+t[a],o=t[a+1];"S"===o||"I"===o?n+=i:"D"===o||"P"===o||"N"===o?r+=i:"H"!==o&&(n+=i,r+=i)}return l=n,d=r,n-(r-e)}for(var h=e.match(u)||[],g=0;g<h.length;g++){var m=h[g],v=+m;if(Number.isNaN(v))if(m.startsWith("^"))o.start+=m.length-1;else for(var y=0;y<m.length;y+=1){for(o.length=1;f<s.length;){var b=s[f];if(!(o.start>=b.start))break;o.start+=b.length,f++}var x=p(o.start);o.base=r[x]||"X";var w=null===a||void 0===a?void 0:a[x];w&&(o.qual=w),o.altbase=m,i.push(o),o={start:o.start+o.length,length:0,base:"",type:"mismatch"}}else o.start+=v}return i}function p(e,t,n,r,a){var i=[],o=l(e);return e&&(i=i.concat(d(o,n,r,a))),t&&(i=i.concat(f(t,o,i,n,a))),i}function h(e,t){var n,r,a,i,s,u,l;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=0,r=0,a=0,i=0;case 4:if(!(i<t.length)){o.next=12;break}for(s=t[i];n<e.length&&r<s;n+=2)u=+e[n],"S"===(l=e[n+1])||"I"===l?r+=u:"D"===l||"N"===l?a+=u:"M"!==l&&"X"!==l&&"="!==l||(r+=u,a+=u);return o.next=9,t[i]-r+a;case 9:i++,o.next=4;break;case 12:case"end":return o.stop()}}),c)}function g(e,t,n){var i=-1===n?(0,s.revcom)(t):t;return e.split(";").filter((function(e){return!!e})).map((function(e){var t=e.split(","),o=(0,a.Z)(t),s=o[0],c=o.slice(1),u=s.match(/([A-Z])([-+])([^,.?]+)([.?])?/);if(!u)throw new Error("bad format for MM tag");var l=(0,r.Z)(u,4),d=l[1],f=l[2],p=l[3].split(/(\d+|.)/).filter((function(e){return!!e}));return"-"===f?(console.warn("unsupported negative strand modifications"),{type:"unsupported",positions:[]}):p.map((function(e){var t=0;return{type:e,positions:c.map((function(e){return+e})).map((function(e){do{"N"!==d&&d!==i[t]||e--,t++}while(e>=0&&t<i.length);var r=t-1;return-1===n?i.length-1-r:r})).sort((function(e,t){return e-t}))}}))})).flat()}function m(e){return e.split(";").filter((function(e){return!!e})).map((function(e){var t=e.split(","),n=(0,r.Z)(t,1)[0].match(/([A-Z])([-+])([^,]+)/);if(!n)throw new Error("bad format for MM tag");return(0,r.Z)(n,4)[3].split(/(\d+|.)/).filter((function(e){return!!e}))})).flat()}},68185:function(e,t,n){"use strict";n.r(t),n.d(t,{capabilities:function(){return C},default:function(){return k}});var r=n(41361),a=n(96234),i=n(34795),o=n(9249),s=n(87371),c=n(45754),u=n(86906),l=n(77162),d=n.n(l),f=n(29598),p=n(14956),h=n(26131),g=n(26080),m=n(54685),v=n(99703);function y(e){return b(e.type)?1:e.length}function b(e){return"softclip"===e||"hardclip"===e||"insertion"===e}function x(e,t,n,r){var a=e[n][r];a||(a=e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),a.total++,a.strands[t]++}function w(e,t,n,r){e[n][r]||(e[n][r]={total:0,strands:{"-1":0,0:0,1:0}}),e[n][r].total--,e[n][r].strands[t]--}var k=function(e){(0,c.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"configure",value:function(){var e=(0,i.Z)(d().mark((function e(){var t,n,r,a,i,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getConf("subadapter"),a=this.getConf(["subadapter","sequenceAdapter"]),e.next=4,null===(t=this.getSubAdapter)||void 0===t?void 0:t.call(this,r);case 4:if(i=e.sent,!a){e.next=11;break}return e.next=8,null===(n=this.getSubAdapter)||void 0===n?void 0:n.call(this,a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=void 0;case 12:if(o=e.t0,i){e.next=15;break}throw new Error("Failed to get subadapter");case 15:return e.abrupt("return",{subadapter:i.dataAdapter,sequenceAdapter:null===o||void 0===o?void 0:o.dataAdapter});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchSequence",value:function(){var e=(0,i.Z)(d().mark((function e(t){var n,r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:if(n=e.sent,r=n.sequenceAdapter){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",(0,m.O)(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,h.ObservableCreate)(function(){var r=(0,i.Z)(d().mark((function r(i){var o,s,c,u,l,f;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.configure();case 2:return o=r.sent,s=o.subadapter,r.next=6,s.getFeatures(e,n).pipe((0,g.q)()).toPromise();case 6:return c=r.sent,r.next=9,t.generateCoverageBins(c,e,n);case 9:u=r.sent,l=u.bins,f=u.skipmap,l.forEach((function(n,r){i.next(new p.Z({id:"".concat(t.id,"-").concat(e.start+r),data:{score:n.total,snpinfo:n,start:e.start+r,end:e.start+r+1,refName:e.refName}}))})),Object.entries(f).forEach((function(e){var t=(0,a.Z)(e,2),n=t[0],r=t[1];i.next(new p.Z({id:n,data:{type:"skip",start:r.start,end:r.end,strand:r.strand,score:r.score,xs:r.xs}}))})),i.complete();case 15:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"estimateRegionsStats",value:function(){var e=(0,i.Z)(d().mark((function e(t,n){var r,a;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.configure();case 2:return r=e.sent,a=r.subadapter,e.abrupt("return",a.estimateRegionsStats(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,i.Z)(d().mark((function e(){var t,n,r,a=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.configure();case 3:return n=e.sent,r=n.subadapter,e.abrupt("return",r.getRefNames(t));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}},{key:"generateCoverageBins",value:function(){var e=(0,i.Z)(d().mark((function e(t,n,a){var i,o,s,c,u,l,f,p;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.colorBy,s=Math.ceil(n.end-n.start),c={},!t.length||!(0,m.ES)(null===(i=a.colorBy)||void 0===i?void 0:i.type)){e.next=9;break}return e.next=6,this.fetchSequence(n);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=void 0;case 10:for(u=e.t0,l=[],f=function(e){for(var a=t[e],i=(0,v.parseCigar)(a.get("CIGAR")),d=a.get("start"),f=a.get("end"),p=a.get("strand"),h=d;h<f;h++){var g=h-n.start;if(g>=0&&g<s){var k=l[g]||{total:0,lowqual:{},cov:{},delskips:{},noncov:{},ref:{}};h!==f&&(k.total++,x(k,p,"ref","ref")),l[g]=k}}if("modifications"===(null===o||void 0===o?void 0:o.type)){var C=a.get("seq"),Z=(0,m.TN)(a,"MM","Mm")||"";(0,v.getModificationPositions)(Z,C,p).forEach((function(e){var t,a=e.type,o=e.positions,s="mod_".concat(a),c=(0,r.Z)((0,v.getNextRefPos)(i,o));try{for(c.s();!(t=c.n()).done;){var u=t.value,h=u+d-n.start;if(h>=0&&h<l.length&&u+d<f)x(l[h],p,"cov",s)}}catch(g){c.e(g)}finally{c.f()}}))}else if("methylation"===(null===o||void 0===o?void 0:o.type)){if(!u)throw new Error("no region sequence detected, need sequenceAdapter configuration");var S=a.get("seq"),T=(0,m.TN)(a,"MM","Mm")||"",P=new Array(n.end-n.start).fill(0);(0,v.getModificationPositions)(T,S,p).forEach((function(e){var t=e.type,a=e.positions;if("m"===t){var o,s=(0,r.Z)((0,v.getNextRefPos)(i,a));try{for(s.s();!(o=s.n()).done;){var c=o.value+d-n.start;c>=0&&c<P.length&&(P[c]=1)}}catch(u){s.e(u)}finally{s.f()}}}));for(var R=d;R<f;R++){var M=R-n.start;if(M>=0&&M<l.length-1){var j=u[M].toLowerCase(),A=u[M+1].toLowerCase(),N=l[M],L=l[M+1];"c"===j&&"g"===A&&(P[M]||P[M+1]?(x(N,p,"cov","meth"),x(L,p,"cov","meth"),w(N,p,"ref","ref"),w(L,p,"ref","ref")):(x(N,p,"cov","unmeth"),x(L,p,"cov","unmeth"),w(N,p,"ref","ref"),w(L,p,"ref","ref")))}}}else{var F=a.get("mismatches");if(F){for(var I=0;I<F.length;I++)for(var B=F[I],D=d+B.start,E=D;E<D+y(B);E++){var V=E-n.start;if(V>=0&&V<l.length){var O=l[V],z=B.base,W=B.type,H=b(W);H?x(O,p,"noncov",W):w(O,p,"ref","ref"),"deletion"===W||"skip"===W?(x(O,p,"delskips",W),O.total--):H||x(O,p,"cov",z)}}F.filter((function(e){return"skip"===e.type})).forEach((function(e){var t=a.get("start")+e.start,n=t,r=t+e.length,i=a.get("strand"),o="".concat(n,"_").concat(r,"_").concat(i);c[o]?c[o].score++:c[o]={feature:a,start:n,end:r,strand:i,xs:(0,m.h1)(a,"XS")||(0,m.h1)(a,"TS"),score:1}}))}}},p=0;p<t.length;p++)f(p);return e.abrupt("return",{bins:l,skipmap:c});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(f.BaseFeatureDataAdapter),C=k.capabilities},26794:function(e,t,n){"use strict";n.d(t,{t:function(){return c},Z:function(){return rt}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(49767),c=n(99703),u=n(93029),l=n(9077),d=n(40909),f=function(e){return d.types.late((function(){return(0,l.ConfigurationSchema)("CramAdapter",{fetchSizeLimit:{type:"number",defaultValue:3e6},cramLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram",locationType:"UriLocation"}},craiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.cram.crai",locationType:"UriLocation"}},sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},p=function(e){e.addAdapterType((function(){return new u.Z({name:"CramAdapter",configSchema:e.load(f),getAdapterClass:function(){return Promise.all([n.e(2821),n.e(6254),n.e(2809),n.e(6925),n.e(6849)]).then(n.bind(n,86646)).then((function(e){return e.default}))}})}))},h=d.types.late((function(){return(0,l.ConfigurationSchema)("BamAdapter",{bamLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam",locationType:"UriLocation"}},index:(0,l.ConfigurationSchema)("BamIndex",{indexType:{model:d.types.enumeration("IndexType",["BAI","CSI"]),type:"stringEnum",defaultValue:"BAI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bam.bai",locationType:"UriLocation"}}}),fetchSizeLimit:{type:"number",defaultValue:5e6},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),g=function(e){e.addAdapterType((function(){return new u.Z({name:"BamAdapter",configSchema:h,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7431),n.e(6824)]).then(n.bind(n,16824)).then((function(e){return e.default}))}})}))},m=d.types.late((function(){return(0,l.ConfigurationSchema)("HtsgetBamAdapter",{htsgetBase:{type:"string",defaultValue:""},htsgetTrackId:{type:"string",defaultValue:""},sequenceAdapter:{type:"frozen",defaultValue:null}},{explicitlyTyped:!0})})),v=function(e){e.addAdapterType((function(){return new u.Z({name:"HtsgetBamAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},configSchema:m,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7431),n.e(4794)]).then(n.bind(n,64794)).then((function(e){return e.default}))}})}))},y=function(e){return d.types.late((function(){return(0,l.ConfigurationSchema)("SNPCoverageAdapter",{subadapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})}))},b=n(68185),x=function(e){e.addAdapterType((function(){return new u.Z({name:"SNPCoverageAdapter",adapterMetadata:{category:null,displayName:null,hiddenFromGUI:!0,description:null},getAdapterClass:function(){return Promise.resolve().then(n.bind(n,68185)).then((function(e){return e.default}))},configSchema:y(e),adapterCapabilities:b.capabilities})}))},w=(0,l.ConfigurationSchema)("SNPCoverageRenderer",{clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},indicatorThreshold:{type:"number",description:"the proportion of reads containing a insertion/clip indicator",defaultValue:.4},drawArcs:{type:"boolean",description:"Draw sashimi-style arcs for intron features",defaultValue:!0},drawInterbaseCounts:{type:"boolean",description:'draw count "upsidedown histogram" of the interbase events that don\'t contribute to the coverage count so are not drawn in the normal histogram',defaultValue:!0},drawIndicators:{type:"boolean",description:"draw a triangular indicator where an event has been detected",defaultValue:!0}},{explicitlyTyped:!0}),k=n(68079),C=n(33028),Z=n(96234),S=n(24998),T=n(81073),P=n(92854),R=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"draw",value:function(e,t){var n=t.features,r=t.regions,a=t.bpPerPx,i=t.displayCrossHatches,o=t.modificationTagMap,s=void 0===o?{}:o,c=t.scaleOpts,u=t.height,d=t.theme,f=t.config,p=t.ticks,h=(0,S.createJBrowseTheme)(d),g=(0,Z.Z)(r,1)[0],m=(g.end-g.start)/a,v=P.Rv,y=u-2*v;if(c.domain){var b=(0,C.Z)((0,C.Z)({},c),{},{range:[0,y]}),x=(0,P.yZ)(b),w=(0,P.yZ)((0,C.Z)((0,C.Z)({},b),{},{range:[0,y/2],scaleType:"linear"})),R=(0,P.P$)(c.scaleType),M=(0,l.readConfObject)(f,"indicatorThreshold"),j=(0,l.readConfObject)(f,"drawInterbaseCounts"),A=(0,l.readConfObject)(f,"drawArcs"),N=(0,l.readConfObject)(f,"drawIndicators"),L=function(e){return y-(x(e)||0)+v},F=function(e){return L(R)-L(e)},I=function(e){return y-(w(e)||0)+v},B=function(e){return I((0,P.P$)("linear"))-I(e)},D={A:h.palette.bases.A.main,C:h.palette.bases.C.main,G:h.palette.bases.G.main,T:h.palette.bases.T.main,total:"lightgrey",insertion:"purple",softclip:"blue",hardclip:"red",meth:"red",unmeth:"blue",ref:"lightgrey"},E=(0,k.Z)(n.values()),V=E.filter((function(e){return"skip"!==e.get("type")})),O=E.filter((function(e){return"skip"===e.get("type")}));e.fillStyle=D.total;for(var z=0;z<V.length;z++){var W=V[z],H=(0,T.featureSpanPx)(W,g,a),q=(0,Z.Z)(H,2),U=q[0],_=q[1]-U+.3,G=W.get("score");e.fillRect(U,L(G),_,F(G))}for(var J=0,X=g.reversed?1/a:0,Y=0;Y<V.length;Y++){for(var Q=V[Y],$=(0,T.featureSpanPx)(Q,g,a),K=(0,Z.Z)($,2),ee=K[0],te=K[1],ne=Q.get("score"),re=Q.get("snpinfo"),ae=Math.max(te-ee+.3,1),ie=re.total,oe=Object.keys(re.cov).sort(),se=0,ce=0;ce<oe.length;ce++){var ue=oe[ce],le=re.cov[ue].total;e.fillStyle=D[ue]||s[ue.replace("mod_","")]||"#888";var de=F(ne),fe=L(ne)+de;e.fillRect(ee,fe-(le+se)/ne*de,ae,le/ne*de),se+=le}var pe=Object.keys(re.noncov);if(j)for(var he=0,ge=0;ge<pe.length;ge++){var me=pe[ge],ve=re.noncov[me].total;e.fillStyle=D[me],e.fillRect(ee-.6+X,4.5+B(he),1.2,B(ve)),he+=ve}if(N){for(var ye=0,be=0,xe="",we=0;we<pe.length;we++){var ke=pe[we],Ce=re.noncov[ke].total;ye+=Ce,Ce>be&&(be=Ce,xe=ke)}var Ze=Math.max(ie,J);if(ye>Ze*M&&Ze>7){e.fillStyle=D[xe],e.beginPath();var Se=ee+X;e.moveTo(Se-3.5,0),e.lineTo(Se+3.5,0),e.lineTo(Se,4.5),e.fill()}}J=ie}if(A)for(var Te=0;Te<O.length;Te++){var Pe=O[Te],Re=(0,T.bpSpanPx)(Pe.get("start"),Pe.get("end"),g,a),Me=(0,Z.Z)(Re,2),je=Me[0],Ae=Me[1];e.beginPath();var Ne=Pe.get("strand"),Le=Pe.get("xs"),Fe="rgba(255,200,200,0.7)",Ie="rgba(200,200,255,0.7)";e.strokeStyle="+"===Le?Fe:"-"===Le?Ie:1===Ne?Fe:-1===Ne?Ie:"rgba(200,200,200,0.7)",e.lineWidth=Math.log(Pe.get("score")+1),e.moveTo(je,y-2*v),e.bezierCurveTo(je,0,Ae,0,Ae,y-2*v),e.stroke()}i&&(e.lineWidth=1,e.strokeStyle="rgba(140,140,140,0.8)",p.values.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(L(t))),e.lineTo(m,Math.round(L(t))),e.stroke()})))}}}]),n}(P.Aq),M=(0,l.ConfigurationSchema)("SNPCoverageRenderer",{},{baseConfiguration:w,explicitlyTyped:!0});function j(e){e.addRendererType((function(){return new R({name:"SNPCoverageRenderer",ReactComponent:P.Eh,configSchema:M,pluginManager:e})}))}var A=n(34795),N=n(41361),L=n(93069),F=n(95058),I=n(77162),B=n.n(I),D=n(8218),E=n.n(D),V=n(21339),O=n(31385),z=n(3011),W=n(37654),H=n(54685),q=n(59264),U=n.n(q),_=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).sortedBy=void 0,a.showSoftClip=!1,a.cachedLayout=void 0,a.config=e.config,a}return(0,a.Z)(n,[{key:"cachedLayoutIsValid",value:function(e){return(0,L.Z)((0,F.Z)(n.prototype),"cachedLayoutIsValid",this).call(this,e)&&this.showSoftClip===e.showSoftClip&&U()(this.sortedBy,e.sortedBy)}},{key:"layout",get:function(){return this.cachedLayout&&this.cachedLayoutIsValid(this.cachedLayout)||(this.cachedLayout={layout:this.makeLayout(),config:(0,l.readConfObject)(this.config),filters:this.filters,sortedBy:this.sortedBy,showSoftClip:this.showSoftClip}),this.cachedLayout.layout}}]),n}(V.LayoutSession);function G(e){return{A:e.palette.bases.A.main,C:e.palette.bases.C.main,G:e.palette.bases.G.main,T:e.palette.bases.T.main,deletion:"#808080"}}function J(e){return Object.fromEntries(Object.entries(G(e)).map((function(t){var n=(0,Z.Z)(t,2),r=n[0],a=n[1];return[r,e.palette.getContrastText(a)]})))}var X={color_fwd_strand_not_proper:"#ECC8C8",color_rev_strand_not_proper:"#BEBED8",color_fwd_strand:"#EC8B8B",color_rev_strand:"#8F8FD8",color_fwd_missing_mate:"#D11919",color_rev_missing_mate:"#1919D1",color_fwd_diff_chr:"#000",color_rev_diff_chr:"#969696",color_pair_lr:"#c8c8c8",color_pair_rr:"navy",color_pair_rl:"teal",color_pair_ll:"green",color_nostrand:"#c8c8c8",color_interchrom:"orange",color_longinsert:"red",color_shortinsert:"pink"};function Y(e){return!["methylation","modifications"].includes(e||"")}var Q=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,a.Z)(n,[{key:"getCharWidthHeight",value:function(e){return{charWidth:e.measureText("A").width,charHeight:e.measureText("M").width}}},{key:"layoutFeature",value:function(e){var t=e.feature,n=e.layout,r=e.bpPerPx,a=e.region,i=e.showSoftClip,o=e.heightPx,s=e.displayMode,c=0,u=0;if(i){var l=t.get("mismatches");if(t.get("seq"))for(var d=0;d<l.length;d+=1){var f=l[d],p=f.type,h=f.start,g=f.cliplen,m=void 0===g?0:g;"softclip"===p&&(0===h?c=m:u=m)}}var v=(0,T.bpSpanPx)(t.get("start")-c,t.get("end")+u,a,r),y=(0,Z.Z)(v,2),b=y[0],x=y[1];if("compact"===s&&(o/=3),t.get("refName")!==a.refName)throw new Error("feature ".concat(t.id()," is not on the current region's reference sequence ").concat(a.refName));var w=n.addRect(t.id(),t.get("start")-c,t.get("end")+u,o,t);return null===w?null:{feature:t,leftPx:b,rightPx:x,topPx:"collapse"===s?0:w,heightPx:o}}},{key:"getExpandedRegion",value:function(e,t){var n=t.config,r=t.showSoftClip,a=(0,l.readConfObject)(n,"maxClippingSize"),i=e.start,o=e.end,s=o-i,c=Math.max(s,r?Math.round(a):0);return(0,C.Z)((0,C.Z)({},e),{},{start:Math.floor(Math.max(i-c,0)),end:Math.ceil(o+c)})}},{key:"colorByOrientation",value:function(e,t){return X[this.getOrientation(e,t)||"color_nostrand"]}},{key:"getOrientation",value:function(e,t){var n=(0,l.readConfObject)(t,"orientationType");return{LR:"color_pair_lr",RR:"color_pair_rr",RL:"color_pair_rl",LL:"color_pair_ll"}[H.uD[n][e.get("pair_orientation")]]}},{key:"colorByInsertSize",value:function(e,t){return e.get("is_paired")&&e.get("seq_id")!==e.get("next_seq_id")?"#555":"hsl(".concat(Math.abs(e.get("template_length"))/10,",50%,50%)")}},{key:"colorByStranded",value:function(e,t){var n=e.get("flags"),r=e.get("strand");if(1&n){var a=64&n?-1:1;return 2&n?r*a===1?"color_rev_strand":"color_fwd_strand":e.get("multi_segment_next_segment_unmapped")?r*a===1?"color_rev_missing_mate":"color_fwd_missing_mate":e.get("seq_id")===e.get("next_seq_id")?r*a===1?"color_rev_strand_not_proper":"color_fwd_strand_not_proper":1===r?"color_fwd_diff_chr":"color_rev_diff_chr"}return 1===r?"color_fwd_strand":"color_rev_strand"}},{key:"colorByPerBaseLettering",value:function(e,t,n,r,a,i){for(var o=i.colorForBase,s=i.contrastForBase,u=i.charWidth,l=i.charHeight-2,d=t.feature,f=t.topPx,p=t.heightPx,h=d.get("seq"),g=(0,c.parseCigar)(d.get("CIGAR")),m=1/a,v=d.get("start"),y=0,b=0,x=0;x<g.length;x+=2){var w=+g[x],k=g[x+1];if("S"===k||"I"===k)y+=w;else if("D"===k||"N"===k)b+=w;else if("M"===k||"X"===k||"="===k){for(var C=0;C<w;C++){var S=h[y+C];e.fillStyle=o[S];var P=(0,T.bpSpanPx)(v+b+C,v+b+C+1,r,a),R=(0,Z.Z)(P,1)[0];e.fillRect(R,f,m+.5,p),m>=u&&p>=l&&(e.fillStyle=s[S],e.fillText(S,R+(m-u)/2+1,f+p))}y+=w,b+=w}}}},{key:"colorByPerBaseQuality",value:function(e,t,n,r,a){for(var i=t.feature,o=t.topPx,s=t.heightPx,u=(i.get("qual")||"").split(" ").map((function(e){return+e})),l=(0,c.parseCigar)(i.get("CIGAR")),d=1/a,f=i.get("start"),p=0,h=0,g=0;g<l.length;g+=2){var m=+l[g],v=l[g+1];if("S"===v||"I"===v)p+=m;else if("D"===v||"N"===v)h+=m;else if("M"===v||"X"===v||"="===v){for(var y=0;y<m;y++){var b=u[p+y];e.fillStyle="hsl(".concat(255===b?150:1.5*b,",55%,50%)");var x=(0,T.bpSpanPx)(f+h+y,f+h+y+1,r,a),w=(0,Z.Z)(x,1)[0];e.fillRect(w,o,d+.5,s)}p+=m,h+=m}}}},{key:"colorByModifications",value:function(e,t,n,r,a,i){for(var o=t.feature,s=t.topPx,u=t.heightPx,l=i.modificationTagMap,d=void 0===l?{}:l,f=(0,H.TN)(o,"MM","Mm")||"",p=(0,H.TN)(o,"ML","Ml")||[],h=p?("string"===typeof p?p.split(",").map((function(e){return+e})):p).map((function(e){return e/255})):(0,H.TN)(o,"MP","Mp").split("").map((function(e){return e.charCodeAt(0)-33})).map((function(e){return Math.min(1,e/50)})),g=o.get("CIGAR"),m=o.get("start"),v=o.get("end"),y=o.get("seq"),b=o.get("strand"),x=(0,c.parseCigar)(g),w=(0,c.getModificationPositions)(f,y,b),k=0,C=0;C<w.length;C++){var S,P=w[C],R=P.type,M=P.positions,j=d[R]||"black",A=E()(j),L=(0,N.Z)((0,c.getNextRefPos)(x,M));try{for(L.s();!(S=L.n()).done;){var F=S.value;if(F>=0&&m+F<v){var I=(0,T.bpSpanPx)(m+F,m+F+1,r,a),B=(0,Z.Z)(I,2),D=B[0],V=B[1];e.fillStyle=A.alpha(h[k]+.1).hsl().string(),e.fillRect(D,s,V-D+.5,u)}k++}}catch(O){L.e(O)}finally{L.f()}}}},{key:"colorByMethylation",value:function(e,t,n,r,a,i){var o=i.regionSequence,s=t.feature,u=t.topPx,l=t.heightPx,d=(0,H.TN)(s,"MM","Mm")||"";if(!o)throw new Error("region sequence required for methylation");for(var f=s.get("CIGAR"),p=s.get("start"),h=s.get("end"),g=s.get("seq"),m=s.get("strand"),v=(0,c.parseCigar)(f),y=r.start,b=r.end,x=new Array(b-y).fill(0),w=(0,c.getModificationPositions)(d,g,m),k=0;k<w.length;k++){var C=w[k],S=C.type,P=C.positions;if("m"===S&&P){var R,M=(0,N.Z)((0,c.getNextRefPos)(v,P));try{for(M.s();!(R=M.n()).done;){var j=R.value+p-y;j>=0&&j<x.length&&(x[j]=1)}}catch(Q){M.e(Q)}finally{M.f()}}}for(var A=p;A<h;A++){var L=A-y;if(L>=0&&L<x.length){var F=o[L].toLowerCase(),I=o[L+1].toLowerCase();if(a>2){if("c"===F&&"g"===I){var B=y+L,D=(0,T.bpSpanPx)(B,B+2,r,a),E=(0,Z.Z)(D,2),V=E[0],O=E[1];x[L]||x[L+1]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(V,u,O-V+.5,l)}}else if("c"===F&&"g"===I){var z=y+L,W=(0,T.bpSpanPx)(z,z+1,r,a),q=(0,Z.Z)(W,2),U=q[0],_=q[1];x[L]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(U,u,_-U+.5,l);var G=(0,T.bpSpanPx)(z+1,z+2,r,a),J=(0,Z.Z)(G,2),X=J[0],Y=J[1];x[L+1]?e.fillStyle="red":e.fillStyle="blue",e.fillRect(X,u,Y-X+.5,l)}}}}},{key:"drawRect",value:function(e,t,n){var r=n.regions,a=n.bpPerPx,i=t.heightPx,o=t.topPx,s=t.feature,c=(0,Z.Z)(r,1)[0],u=(0,T.bpSpanPx)(s.get("start"),s.get("end"),c,a),l=(0,Z.Z)(u,2),d=l[0],f=l[1],p=c.reversed?-1:1,h=s.get("strand")*p;a<10?-1===h?(e.beginPath(),e.moveTo(d-5,o+i/2),e.lineTo(d,o+i),e.lineTo(f,o+i),e.lineTo(f,o),e.lineTo(d,o),e.closePath(),e.fill()):(e.beginPath(),e.moveTo(d,o),e.lineTo(d,o+i),e.lineTo(f,o+i),e.lineTo(f+5,o+i/2),e.lineTo(f,o),e.closePath(),e.fill()):e.fillRect(d,o,f-d,i)}},{key:"drawAlignmentRect",value:function(e,t,n){var r=n.defaultColor,a=n.config,i=n.bpPerPx,o=n.regions,s=n.colorBy,c=n.colorTagMap,u=void 0===c?{}:c,d=n.colorForBase,f=n.contrastForBase,p=n.charWidth,h=n.charHeight,g=s||{},m=g.tag,v=void 0===m?"":m,y=g.type,b=void 0===y?"":y,x=t.feature,w=o[0];switch(b){case"insertSize":e.fillStyle=this.colorByInsertSize(x,a);break;case"strand":e.fillStyle=-1===x.get("strand")?"#8F8FD8":"#EC8B8B";break;case"mappingQuality":e.fillStyle="hsl(".concat(x.get("mq"),",50%,50%)");break;case"pairOrientation":e.fillStyle=this.colorByOrientation(x,a);break;case"stranded":e.fillStyle=X[this.colorByStranded(x,a)];break;case"xs":case"tag":var k=x.get("tags"),C=k?k[v]:x.get(v);if("XS"===v||"TS"===v){e.fillStyle=X[{"-":"color_rev_strand","+":"color_fwd_strand"}[C]||"color_nostrand"]}if("ts"===v){var Z={"-":-1===x.get("strand")?"color_fwd_strand":"color_rev_strand","+":-1===x.get("strand")?"color_rev_strand":"color_fwd_strand"};e.fillStyle=X[Z[C]||"color_nostrand"]}else{var S=u[C];e.fillStyle=S||X.color_nostrand}break;case"insertSizeAndPairOrientation":break;case"modifications":case"methylation":16&x.get("flags")?e.fillStyle="#c8dcc8":e.fillStyle="#c8c8c8";break;default:e.fillStyle=r?"#c8c8c8":(0,l.readConfObject)(a,"color",{feature:x})}switch(this.drawRect(e,t,n),b){case"perBaseQuality":this.colorByPerBaseQuality(e,t,a,w,i);break;case"perBaseLettering":this.colorByPerBaseLettering(e,t,a,w,i,{colorForBase:d,contrastForBase:f,charWidth:p,charHeight:h});break;case"modifications":this.colorByModifications(e,t,a,w,i,n);break;case"methylation":this.colorByMethylation(e,t,a,w,i,n)}}},{key:"drawMismatches",value:function(e,t,n,r){var a=r.minSubfeatureWidth,i=r.largeInsertionIndicatorScale,o=r.mismatchAlpha,s=r.drawSNPs,c=void 0===s||s,u=r.drawIndels,l=void 0===u||u,d=r.charWidth,f=r.charHeight,p=r.colorForBase,h=r.contrastForBase,g=n.bpPerPx,m=n.regions,v=t.heightPx,y=t.topPx,b=t.feature,x=(0,Z.Z)(m,1)[0],w=b.get("start"),k=Math.min(1/g,2),C=Math.max(a,k),S=b.get("mismatches"),P=f-2;function R(e,t){var n=e;return o&&void 0!==t.qual&&(n=E()(e).alpha(Math.min(1,t.qual/50)).hsl().string()),n}for(var M=x.reversed?1/g+1:-1,j=0;j<S.length;j+=1){var A=S[j],N=w+A.start,L=A.length,F=A.base,I=(0,T.bpSpanPx)(N,N+L,x,g),B=(0,Z.Z)(I,2),D=B[0],V=B[1],O=Math.max(a,Math.abs(D-V));if("mismatch"===A.type&&c){var z=p[A.base]||"#888";if(e.fillStyle=R(z,A),e.fillRect(D,y,O,v),O>=d&&v>=P){var W=h[A.base]||"black";e.fillStyle=R(W,A),e.fillText(F,D+(O-d)/2+1,y+v)}}else if("deletion"===A.type&&l){var H=p.deletion;e.fillStyle=H,e.fillRect(D,y,O,v);var q="".concat(A.length),U=(0,T.measureText)(q,10);O>=U&&v>=P&&(e.fillStyle=h.deletion,e.fillText(q,(D+V)/2-U/2,y+v))}else if("insertion"===A.type&&l){e.fillStyle="purple";var _=D+M,G=+A.base||A.length,J=Math.max(a/2,Math.min(1.2,1/g));G<10&&(e.fillRect(_,y,J,v),1/g>=d&&v>=P&&(e.fillRect(_-J,y,3*J,1),e.fillRect(_-J,y+v-1,3*J,1),e.fillText("(".concat(A.base,")"),_+3,y+v)))}else if("hardclip"===A.type||"softclip"===A.type){e.fillStyle="hardclip"===A.type?"red":"blue";var X=D+M;e.fillRect(X,y,C,v),1/g>=d&&v>=P&&(e.fillRect(X-C,y,3*C,1),e.fillRect(X-C,y+v-1,3*C,1),e.fillText("(".concat(A.base,")"),X+3,y+v))}else if("skip"===A.type&&D+O>0){var Y=O-(g>10?1.5:0);e.clearRect(D,y,Y,v),e.fillStyle="#333",e.fillRect(Math.max(0,D),y+v/2-1,Y+(D<0?D:0),2)}}if(l)for(var Q=0;Q<S.length;Q+=1){var $=S[Q],K=w+$.start,ee=$.length,te=(0,T.bpSpanPx)(K,K+ee,x,g),ne=(0,Z.Z)(te,1)[0],re=+$.base||$.length,ae="".concat(re);if("insertion"===$.type&&re>=10)if(g>i)e.fillStyle="purple",e.fillRect(ne-1,y,2,v);else if(v>f){var ie=e.measureText(ae);e.fillStyle="purple",e.fillRect(ne-ie.width/2-5,y,ie.width+10,v),e.fillStyle="white",e.fillText(ae,ne-ie.width/2,y+v)}else{e.fillStyle="purple",e.fillRect(ne-2,y,4,v)}}}},{key:"drawSoftClipping",value:function(e,t,n,r,a){var i=t.feature,o=t.topPx,s=t.heightPx,c=n.regions,u=n.bpPerPx,d=(0,Z.Z)(c,1)[0],f=(0,l.readConfObject)(r,"minSubfeatureWidth"),p=i.get("mismatches"),h=i.get("seq"),g=this.getCharWidthHeight(e),m=g.charWidth,v=g.charHeight,y={A:a.palette.bases.A.main,C:a.palette.bases.C.main,G:a.palette.bases.G.main,T:a.palette.bases.T.main,deletion:"#808080"};h&&p.filter((function(e){return"softclip"===e.type})).forEach((function(t){for(var n=t.cliplen||0,r=i.get("start"),c=0===t.start?r-n:r+t.start,l=0;l<n;l+=1){var p=h.charAt(l+t.start);if(!p)return;var g=(0,T.bpSpanPx)(c+l,c+l+1,d,u),b=(0,Z.Z)(g,2),x=b[0],w=b[1],k=Math.max(f,Math.abs(x-w)),C=y[p]||"#000000";e.fillStyle=C,e.fillRect(x,o,k,s),k>=m&&s>=v-5&&(e.fillStyle=a.palette.getContrastText(C),e.fillText(p,x+(k-m)/2+1,o+s))}}))}},{key:"makeImageData",value:function(){var e=(0,A.Z)(B().mark((function e(t,n,r){var a,i,o,s,c,u,d,f,p,h,g,m,v,y,b,x=this;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layout,i=r.config,o=r.showSoftClip,s=r.colorBy,c=r.theme,u=(0,l.readConfObject)(i,"mismatchAlpha"),d=(0,l.readConfObject)(i,"minSubfeatureWidth"),f=(0,l.readConfObject)(i,"largeInsertionIndicatorScale"),p="#f0f"===(0,l.readConfObject)(i,"color"),h=(0,S.createJBrowseTheme)(c),g=G(h),m=J(h),a){e.next=10;break}throw new Error("layout required");case 10:if(a.addRect){e.next=12;break}throw new Error("invalid layout object");case 12:t.font="bold 10px Courier New,monospace",v=this.getCharWidthHeight(t),y=v.charWidth,b=v.charHeight,n.forEach((function(e){null!==e&&(x.drawAlignmentRect(t,e,(0,C.Z)((0,C.Z)({},r),{},{defaultColor:p,colorForBase:g,contrastForBase:m,charWidth:y,charHeight:b})),x.drawMismatches(t,e,r,{mismatchAlpha:u,drawSNPs:Y(null===s||void 0===s?void 0:s.type),drawIndels:Y(null===s||void 0===s?void 0:s.type),largeInsertionIndicatorScale:f,minSubfeatureWidth:d,charWidth:y,charHeight:b,colorForBase:g,contrastForBase:m}),o&&x.drawSoftClipping(t,e,r,i,h))}));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"layoutFeats",value:function(e){var t=this,n=e.layout,r=e.features,a=e.sortedBy,i=e.config,o=e.bpPerPx,s=e.showSoftClip,c=e.regions,u=(0,Z.Z)(c,1)[0];if(!n)throw new Error("layout required");if(!n.addRect)throw new Error("invalid layout object");var d=null!==a&&void 0!==a&&a.type&&u.start===a.pos?function(e,t){var n=Array.from(e.values()),r=[],a=[],i=t.pos,o=t.type;n.forEach((function(e){var t=e,n=t.get("start"),o=t.get("end");(0,W.qY)(i-1,i,n,o)?r.push(e):a.push(e)}));var s=!!n.length&&n[0].get("tags");switch(o){case"Start location":r.sort((function(e,t){return e.get("start")-t.get("start")}));break;case"tag":var c=t.tag,u=function(e,t){return s?e.get("tags")[t]:e.get(t)};r[0]&&"string"===typeof u(r[0],c)?r.sort((function(e,t){return u(t,c).localeCompare(u(e,c))})):r.sort((function(e,t){return(u(t,c)||0)-(u(e,c)||0)}));break;case"Base pair":var l=[];r.forEach((function(e){e.get("mismatches").forEach((function(t){var n=e.get("start")+t.start+1,r="insertion"===t.type||"softclip"===t.type?0:t.length;i>=n&&i<n+r&&l.push([e.id(),t])}))}));var d=new Map(l);r.sort((function(e,t){var n=d.get(e.id()),r=d.get(t.id()),a=r&&r.base.toUpperCase(),i=n&&n.base.toUpperCase();return a===i&&"*"===a?n.length-r.length:(a?a.charCodeAt(0):0)-(i?i.charCodeAt(0):0)}));break;case"Read strand":r.sort((function(e,t){return e.get("strand")<=t.get("strand")?1:-1}))}return new Map(r.concat(a).map((function(e){return[e.id(),e]})))}(r,a):r,f=(0,l.readConfObject)(i,"height"),p=(0,l.readConfObject)(i,"displayMode");return(0,T.iterMap)(d.values(),(function(e){return t.layoutFeature({feature:e,layout:n,bpPerPx:o,region:u,showSoftClip:s,heightPx:f,displayMode:p})}),d.size)}},{key:"fetchSequence",value:function(){var e=(0,A.Z)(B().mark((function e(t){var n,r,a,i,o,s,c,u;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.sessionId,r=t.regions,a=t.adapterConfig,i=a.sequenceAdapter){e.next=4;break}return e.abrupt("return",void 0);case 4:return e.next=6,(0,z.uP)(this.pluginManager,n,i);case 6:return o=e.sent,s=o.dataAdapter,c=(0,Z.Z)(r,1),u=c[0],e.abrupt("return",(0,H.O)(u,s));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,A.Z)(B().mark((function e(t){var r,a,i,o,s,c,u,l,d,f,p,h,g,m,v,y=this;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:if(a=e.sent,i=this.createLayoutInWorker(t),o=t.regions,s=t.bpPerPx,c=this.layoutFeats((0,C.Z)((0,C.Z)({},t),{},{features:a,layout:i})),u=(0,Z.Z)(o,1),l=u[0],!a.size||!(0,H.ES)(null===(r=t.colorBy)||void 0===r?void 0:r.type)){e.next=13;break}return e.next=10,this.fetchSequence(t);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0=void 0;case 14:return d=e.t0,f=l.end,p=l.start,h=(f-p)/s,g=Math.max(i.getTotalHeight(),1),e.next=20,(0,O.C)(h,g,t,(function(e){return y.makeImageData(e,c,(0,C.Z)((0,C.Z)({},t),{},{layout:i,features:a,regionSequence:d}))}));case 20:return m=e.sent,e.next=23,(0,L.Z)((0,F.Z)(n.prototype),"render",this).call(this,(0,C.Z)((0,C.Z)((0,C.Z)({},t),m),{},{features:a,layout:i,height:g,width:h}));case 23:return v=e.sent,e.abrupt("return",(0,C.Z)((0,C.Z)((0,C.Z)({},v),m),{},{features:new Map,layout:i,height:g,width:h,maxHeightReached:i.maxHeightReached}));case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSession",value:function(e){return new _(e)}}]),n}(V.default),$=n(90550),K=n(30969),ee=n(37574);var te=(0,$.observer)((function(e){var t=e.onMouseMove,n=e.blockKey,r=e.displayModel,a=e.width,i=e.height,o=e.regions,s=e.bpPerPx,c=e.sortedBy,u=e.colorBy,l=r.selectedFeatureId,d=r.featureIdUnderMouse,f=r.contextMenuFeature,p=(0,Z.Z)(o,1)[0],h=(0,K.useRef)(null),g=(0,K.useState)(!1),m=(0,Z.Z)(g,2),v=m[0],y=m[1],b=(0,K.useState)(!1),x=(0,Z.Z)(b,2),w=x[0],k=x[1];function P(e){v&&k(!0);var i=0,o=0,c=h.current;if(c){var u=c.getBoundingClientRect();i=u.left,o=u.top}i=e.clientX-i,o=e.clientY-o;var l=p.reversed?a-i:i,d=p.start+s*l,f=r.getFeatureOverlapping(n,d,o);t&&t(e,f)}function R(t,n){var r=e["onFeature".concat(t)],a=e["on".concat(t)];r&&d?r(n,d):a&&a(n,d)}(0,K.useEffect)((function(){var e,t,a=h.current;if(a){var i=a.getContext("2d");if(i){i.clearRect(0,0,a.width,a.height);var o=l?null===(e=r.getFeatureByID)||void 0===e?void 0:e.call(r,n,l):void 0;if(o){var c=(0,Z.Z)(o,4),u=c[0],g=c[1],m=c[2],v=c[3],y=(0,T.bpSpanPx)(u,m,p,s),b=(0,Z.Z)(y,2),x=b[0],w=b[1],k=Math.round(g),C=Math.round(v-g);i.shadowColor="#222266",i.shadowBlur=10,i.lineJoin="bevel",i.lineWidth=2,i.strokeStyle="#00b8ff",i.strokeRect(x-2,k-2,w-x+4,C+4),i.clearRect(x,k,w-x,C)}var S=d||(null===f||void 0===f?void 0:f.id()),P=S?null===(t=r.getFeatureByID)||void 0===t?void 0:t.call(r,n,S):void 0;if(P){var R=(0,Z.Z)(P,4),M=R[0],j=R[1],A=R[2],N=R[3],L=(0,T.bpSpanPx)(M,A,p,s),F=(0,Z.Z)(L,2),I=F[0],B=F[1],D=Math.round(j),E=Math.round(N-j);i.fillStyle="#0003",i.fillRect(I,D,B-I,E)}}}}),[s,p,n,l,r,d,f]);var M=Math.ceil(a);return(0,ee.jsxs)("div",{className:"PileupRendering","data-testid":"pileup-".concat(c||u?"".concat((null===c||void 0===c?void 0:c.type)||"").concat((null===u||void 0===u?void 0:u.type)||"").concat((null===u||void 0===u?void 0:u.tag)||""):"normal"),style:{position:"relative",width:M,height:i},children:[(0,ee.jsx)(S.PrerenderedCanvas,(0,C.Z)((0,C.Z)({},e),{},{style:{position:"absolute",left:0,top:0}})),(0,ee.jsx)("canvas",{"data-testid":"pileup_overlay_canvas",width:M,height:i+100,style:{position:"absolute",left:0,top:0},className:"highlightOverlayCanvas",ref:h,onMouseDown:function(e){return function(e){y(!0),k(!1),R("MouseDown",e)}(e)},onMouseEnter:function(e){return function(e){R("MouseEnter",e)}(e)},onMouseOut:function(e){return function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseOver:function(e){return function(e){R("MouseOver",e)}(e)},onMouseUp:function(e){return function(e){y(!1),R("MouseUp",e)}(e)},onMouseLeave:function(e){return function(e){R("MouseOut",e),R("MouseLeave",e)}(e)},onMouseMove:function(e){return P(e)},onClick:function(e){return function(e){w||R("Click",e)}(e)},onContextMenu:function(e){return function(e){R("ContextMenu",e)}(e)},onFocus:function(){},onBlur:function(){}})]})})),ne=(0,l.ConfigurationSchema)("PileupRenderer",{color:{type:"color",description:"the color of each feature in a pileup alignment",defaultValue:"#f0f",contextVariable:["feature"]},orientationType:{type:"stringEnum",model:d.types.enumeration("orientationType",["fr","rf","ff"]),defaultValue:"fr",description:'read sequencer orienation. fr is normal "reads pointing at each other ---\x3e <--- while some other sequencers can use other options'},displayMode:{type:"stringEnum",model:d.types.enumeration("displayMode",["normal","compact","collapse"]),description:"Alternative display modes",defaultValue:"normal"},minSubfeatureWidth:{type:"number",description:"the minimum width in px for a pileup mismatch feature. use for increasing mismatch marker widths when zoomed out to e.g. 1px or 0.5px",defaultValue:0},maxHeight:{type:"integer",description:"the maximum height to be used in a pileup rendering",defaultValue:1200},maxClippingSize:{type:"integer",description:"the max clip size to be used in a pileup rendering",defaultValue:1e4},height:{type:"number",description:"the height of each feature in a pileup alignment",defaultValue:7,contextVariable:["feature"]},noSpacing:{type:"boolean",description:"remove spacing between features",defaultValue:!1},largeInsertionIndicatorScale:{type:"number",description:"scale at which to draw the large insertion indicators (bp/pixel)",defaultValue:10},mismatchAlpha:{type:"boolean",defaultValue:!1,description:"Fade low quality mismatches"}},{explicitlyTyped:!0});function re(e){e.addRendererType((function(){return new Q({name:"PileupRenderer",ReactComponent:te,configSchema:ne,pluginManager:e})}))}var ae=n(81575),ie=n(89058),oe=function(e){var t=e.getDisplayType("LinearPileupDisplay").configSchema,n=e.getDisplayType("LinearSNPCoverageDisplay").configSchema;return(0,l.ConfigurationSchema)("LinearAlignmentsDisplay",{pileupDisplay:t,snpCoverageDisplay:n},{baseConfiguration:ie.fU,explicitlyTyped:!0})},se=n(59853),ce=n(35247),ue=function(e,t){return d.types.compose("LinearAlignmentsDisplay",se.BaseDisplay,d.types.model({PileupDisplay:d.types.maybe(e.getDisplayType("LinearPileupDisplay").stateModel),SNPCoverageDisplay:d.types.maybe(e.getDisplayType("LinearSNPCoverageDisplay").stateModel),snpCovHeight:45,type:d.types.literal("LinearAlignmentsDisplay"),configuration:(0,l.ConfigurationReference)(t),height:250,showCoverage:!0,showPileup:!0,userFeatureScreenDensity:d.types.maybe(d.types.number)})).volatile((function(){return{scrollTop:0}})).actions((function(e){return{toggleCoverage:function(){e.showCoverage=!e.showCoverage},togglePileup:function(){e.showPileup=!e.showPileup},setScrollTop:function(t){e.scrollTop=t},setSNPCoverageHeight:function(t){e.snpCovHeight=t}}})).views((function(e){var t=e.trackMenuItems;return{get pileupDisplayConfig(){var t=(0,l.getConf)(e,"pileupDisplay"),n=(0,T.getContainingTrack)(e);return(0,C.Z)((0,C.Z)({},t),{},{type:"LinearPileupDisplay",name:"".concat((0,l.getConf)(n,"name")," pileup"),displayId:"".concat(e.configuration.displayId,"_pileup_xyz")})},getFeatureByID:function(t,n){return e.PileupDisplay.getFeatureByID(t,n)},searchFeatureByID:function(t){return e.PileupDisplay.searchFeatureByID(t)},get features(){return e.PileupDisplay.features},get DisplayBlurb(){var t;return null===(t=e.PileupDisplay)||void 0===t?void 0:t.DisplayBlurb},get sortedBy(){return e.PileupDisplay.sortedBy},get sortedByPosition(){return e.PileupDisplay.sortedByPosition},get sortedByRefName(){return e.PileupDisplay.sortedByRefName},get snpCoverageDisplayConfig(){var t=(0,l.getConf)(e,"snpCoverageDisplay"),n=(0,T.getContainingTrack)(e);return(0,C.Z)((0,C.Z)({},t),{},{type:"LinearSNPCoverageDisplay",name:"".concat((0,l.getConf)(n,"name")," snp coverage"),displayId:"".concat(e.configuration.displayId,"_snpcoverage_xyz")})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{type:"subMenu",label:"Pileup settings",subMenu:e.PileupDisplay.trackMenuItems()},{type:"subMenu",label:"SNPCoverage settings",subMenu:e.SNPCoverageDisplay.trackMenuItems()}])}}})).actions((function(e){return{setSNPCoverageDisplay:function(t){e.SNPCoverageDisplay={type:"LinearSNPCoverageDisplay",configuration:t,height:e.snpCovHeight}},setUserFeatureScreenDensity:function(t){e.PileupDisplay.setUserFeatureScreenDensity(t),e.SNPCoverageDisplay.setUserFeatureScreenDensity(t)},setPileupDisplay:function(t){e.PileupDisplay={type:"LinearPileupDisplay",configuration:t}},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n}}})).actions((function(e){return{afterAttach:function(){(0,d.addDisposer)(e,(0,ce.autorun)((function(){e.SNPCoverageDisplay?U()(e.snpCoverageDisplayConfig,(0,d.getSnapshot)(e.SNPCoverageDisplay.configuration))||(e.SNPCoverageDisplay.setHeight(e.snpCovHeight),e.SNPCoverageDisplay.setConfig(e.snpCoverageDisplayConfig)):e.setSNPCoverageDisplay(e.snpCoverageDisplayConfig),e.PileupDisplay?U()(e.pileupDisplayConfig,(0,d.getSnapshot)(e.PileupDisplay.configuration))||e.PileupDisplay.setConfig(e.pileupDisplayConfig):e.setPileupDisplay(e.pileupDisplayConfig),e.PileupDisplay.filterBy&&!U()((0,d.getSnapshot)(e.PileupDisplay.filterBy),(0,d.getSnapshot)(e.SNPCoverageDisplay.filterBy))&&e.SNPCoverageDisplay.setFilterBy((0,d.getSnapshot)(e.PileupDisplay.filterBy)),e.PileupDisplay.colorBy&&!U()((0,d.getSnapshot)(e.PileupDisplay.colorBy),e.SNPCoverageDisplay.colorBy?(0,d.getSnapshot)(e.SNPCoverageDisplay.colorBy):{})&&e.SNPCoverageDisplay.setColorBy((0,d.getSnapshot)(e.PileupDisplay.colorBy))}))),(0,d.addDisposer)(e,(0,ce.autorun)((function(){e.setSNPCoverageHeight(e.SNPCoverageDisplay.height)})))},renderSvg:function(t){return(0,A.Z)(B().mark((function n(){var r;return B().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height-e.SNPCoverageDisplay.height,n.next=3,(0,ce.when)((function(){return e.PileupDisplay.ready}));case 3:return n.t0=ee.jsxs,n.t1=ee.Fragment,n.t2=ee.jsx,n.next=8,e.SNPCoverageDisplay.renderSvg(t);case 8:return n.t3=n.sent,n.t4={children:n.t3},n.t5=(0,n.t2)("g",n.t4),n.t6=ee.jsx,n.t7="translate(0 ".concat(e.SNPCoverageDisplay.height,")"),n.next=15,e.PileupDisplay.renderSvg((0,C.Z)((0,C.Z)({},t),{},{overrideHeight:r}));case 15:return n.t8=n.sent,n.t9={transform:n.t7,children:n.t8},n.t10=(0,n.t6)("g",n.t9),n.t11=[n.t5,n.t10],n.t12={children:n.t11},n.abrupt("return",(0,n.t0)(n.t1,n.t12));case 21:case"end":return n.stop()}}),n)})))()}}}))},le=(0,n(22714).Z)((function(){return{resizeHandle:{height:2,position:"absolute",zIndex:2}}}));var de=(0,$.observer)((function(e){var t=e.model,n=t.PileupDisplay,r=t.SNPCoverageDisplay,a=t.showPileup,i=t.showCoverage,o=le(),s=r.height;return(0,ee.jsxs)("div",{"data-testid":"display-".concat((0,l.getConf)(t,"displayId")),style:{position:"relative"},children:[i?(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)("div",{"data-testid":"Blockset-snpcoverage",children:(0,ee.jsx)(r.RenderingComponent,{model:r})}),(0,ee.jsx)(S.ResizeHandle,{onDrag:function(e){return r.setHeight(r.height+e),e},className:o.resizeHandle,style:{top:s}})]}):null,a?(0,ee.jsx)("div",{"data-testid":"Blockset-pileup",style:{position:"absolute",top:i?r.height:0},children:(0,ee.jsx)(n.RenderingComponent,{model:n})}):null]})}));function fe(e){e.addDisplayType((function(){var t=oe(e);return new ae.Z({name:"LinearAlignmentsDisplay",configSchema:t,stateModel:ue(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:de})}))}var pe=function(e){return e.toLocaleString("en-US")},he=K.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),i=n.get("refName"),o=n.get("snpinfo"),s=[i,r===a?pe(r):"".concat(pe(r),"..").concat(pe(a))].filter((function(e){return!!e})).join(":"),c=null===o||void 0===o?void 0:o.total;return(0,ee.jsx)("div",{ref:t,children:(0,ee.jsxs)("table",{children:[(0,ee.jsx)("caption",{children:s}),(0,ee.jsx)("thead",{children:(0,ee.jsxs)("tr",{children:[(0,ee.jsx)("th",{children:"Base"}),(0,ee.jsx)("th",{children:"Count"}),(0,ee.jsx)("th",{children:"% of Total"}),(0,ee.jsx)("th",{children:"Strands"}),(0,ee.jsx)("th",{children:"Source"})]})}),(0,ee.jsxs)("tbody",{children:[(0,ee.jsxs)("tr",{children:[(0,ee.jsx)("td",{children:"Total"}),(0,ee.jsx)("td",{children:c}),(0,ee.jsx)("td",{})]}),Object.entries(o).map((function(e){var t=(0,Z.Z)(e,2),n=t[0],r=t[1];return Object.entries(r).map((function(e){var t=(0,Z.Z)(e,2),r=t[0],a=t[1],i=a.strands;return(0,ee.jsxs)("tr",{children:[(0,ee.jsx)("td",{children:r.toUpperCase()}),(0,ee.jsx)("td",{children:a.total}),(0,ee.jsx)("td",{children:"total"===r||"skip"===r?"---":"".concat(Math.floor(a.total/(c||a.total||1)*100),"%")}),(0,ee.jsxs)("td",{children:[i[-1]?"".concat(i[-1],"(-)"):"",i[1]?"".concat(i[1],"(+)"):""]}),(0,ee.jsx)("td",{children:n})]},r)}))}))]})]})})})),ge=(0,$.observer)((function(e){var t=e.model.featureUnderMouse;return t&&"skip"===t.get("type")?null:(0,ee.jsx)(P.u,(0,C.Z)({TooltipContents:he},e))})),me=n(97891);function ve(e,t,n,r){return ye.apply(this,arguments)}function ye(){return(ye=(0,A.Z)(B().mark((function e(t,n,r,a){var i,o,s,c,u;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,T.getSession)(t),o=i.rpcManager,s=t.adapterConfig,c=(0,me.getRpcSessionId)(t),e.next=5,o.call((0,me.getRpcSessionId)(t),"PileupGetGlobalValueForTag",(0,C.Z)({adapterConfig:s,tag:n.tag,sessionId:c,regions:r.contentBlocks},a));case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e,t,n,r,a){return xe.apply(this,arguments)}function xe(){return(xe=(0,A.Z)(B().mark((function e(t,n,r,a,i){var o,s,c,u;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,T.getSession)(t),s=o.rpcManager,c=(0,me.getRpcSessionId)(t),e.next=4,s.call(c,"PileupGetVisibleModifications",(0,C.Z)({adapterConfig:n,tag:r.tag,sessionId:c,regions:a.contentBlocks},i));case 4:return u=e.sent,e.abrupt("return",u);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var we=new Map([["snpcoverage","SNPCoverageRenderer"]]),ke=function(e,t){return d.types.compose("LinearSNPCoverageDisplay",(0,P.LT)(e,t),d.types.model({type:d.types.literal("LinearSNPCoverageDisplay"),drawInterbaseCounts:d.types.maybe(d.types.boolean),drawIndicators:d.types.maybe(d.types.boolean),drawArcs:d.types.maybe(d.types.boolean),filterBy:d.types.optional(d.types.model({flagInclude:d.types.optional(d.types.number,0),flagExclude:d.types.optional(d.types.number,1540),readName:d.types.maybe(d.types.string),tagFilter:d.types.maybe(d.types.model({tag:d.types.string,value:d.types.string}))}),{}),colorBy:d.types.maybe(d.types.model({type:d.types.string,tag:d.types.maybe(d.types.string)}))})).volatile((function(){return{modificationTagMap:ce.observable.map({})}})).actions((function(e){return{setConfig:function(t){e.configuration=t},setFilterBy:function(t){e.filterBy=(0,d.cast)(t)},setColorBy:function(t){e.colorBy=(0,d.cast)(t)},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"],r=0;t.forEach((function(t){if(!e.modificationTagMap.has(t)){var a=n[r++];e.modificationTagMap.set(t,a)}}))}}})).views((function(e){var t=e.renderProps;return{get rendererConfig(){var t=(0,l.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create((0,C.Z)((0,C.Z)({},t),{},{drawInterbaseCounts:void 0===e.drawInterbaseCounts?t.drawInterbaseCounts:e.drawInterbaseCounts,drawIndicators:void 0===e.drawIndicators?t.drawIndicators:e.drawIndicators,drawArcs:void 0===e.drawArcs?t.drawArcs:e.drawArcs}),(0,d.getEnv)(e))},get drawArcsSetting(){return void 0!==e.drawArcs?e.drawArcs:(0,l.readConfObject)(this.rendererConfig,"drawArcs")},get drawInterbaseCountsSetting(){return void 0!==e.drawInterbaseCounts?e.drawInterbaseCounts:(0,l.readConfObject)(this.rendererConfig,"drawInterbaseCounts")},get drawIndicatorsSetting(){return void 0!==e.drawIndicators?e.drawIndicators:(0,l.readConfObject)(this.rendererConfig,"drawIndicators")},get modificationsReady(){var t;return"modifications"!==(null===(t=e.colorBy)||void 0===t?void 0:t.type)||Object.keys(JSON.parse(JSON.stringify(e.modificationTagMap))).length>0},renderProps:function(){var n=t();return(0,C.Z)((0,C.Z)({},n),{},{notReady:n.notReady||!this.modificationsReady,modificationTagMap:JSON.parse(JSON.stringify(e.modificationTagMap)),colorBy:e.colorBy?(0,d.getSnapshot)(e.colorBy):void 0,filterBy:e.filterBy})}}})).actions((function(e){return{toggleDrawIndicators:function(){e.drawIndicators=!e.drawIndicatorsSetting},toggleDrawInterbaseCounts:function(){e.drawInterbaseCounts=!e.drawInterbaseCountsSetting},toggleDrawArcs:function(){e.drawArcs=!e.drawArcsSetting},afterAttach:function(){(0,d.addDisposer)(e,(0,ce.autorun)((0,A.Z)(B().mark((function t(){var n,r,a,i;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.colorBy,r=(0,T.getContainingView)(e),a=r.staticBlocks,"modifications"!==(null===n||void 0===n?void 0:n.type)){t.next=8;break}return t.next=6,be(e,(0,l.getConf)(e.parentTrack,"adapter"),n,a);case 6:i=t.sent,e.updateModificationColorMap(i);case 8:t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e.setError(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),{delay:1e3}))}}})).views((function(e){var t=e.trackMenuItems;return{get TooltipComponent(){return ge},get adapterConfig(){return{type:"SNPCoverageAdapter",subadapter:(0,l.getConf)(e.parentTrack,"adapter")}},get rendererTypeName(){return we.get("snpcoverage")},get needsScalebar(){return!0},contextMenuItems:function(){return[]},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Draw insertion/clipping indicators",type:"checkbox",checked:e.drawIndicatorsSetting,onClick:function(){e.toggleDrawIndicators()}},{label:"Draw insertion/clipping counts",type:"checkbox",checked:e.drawInterbaseCountsSetting,onClick:function(){e.toggleDrawInterbaseCounts()}},{label:"Draw arcs",type:"checkbox",checked:e.drawArcsSetting,onClick:function(){e.toggleDrawArcs()}}])}}}))};function Ce(e){e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("SNPCoverageRenderer").configSchema;return(0,l.ConfigurationSchema)("LinearSNPCoverageDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:d.types.enumeration("Autoscale type",["local"]),description:"performs local autoscaling (no other options for SNP Coverage available)"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},scaleType:{type:"stringEnum",model:d.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},multiTicks:{type:"boolean",description:"Display multiple values for the ticks",defaultValue:!1},renderers:(0,l.ConfigurationSchema)("RenderersConfiguration",{SNPCoverageRenderer:t})},{baseConfiguration:ie.fU,explicitlyTyped:!0})}(e);return new ae.Z({name:"LinearSNPCoverageDisplay",configSchema:t,stateModel:ke(e,t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:P.Xl})}))}var Ze=function(e){var t=e.getRendererType("PileupRenderer").configSchema;return(0,l.ConfigurationSchema)("LinearPileupDisplay",{defaultRendering:{type:"stringEnum",model:d.types.enumeration("Rendering",["pileup"]),defaultValue:"pileup"},renderers:(0,l.ConfigurationSchema)("RenderersConfiguration",{PileupRenderer:t}),renderer:"",maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view",defaultValue:5},colorScheme:{type:"stringEnum",model:d.types.enumeration("colorScheme",["strand","normal","insertSize","insertSizeAndOrientation","mappingQuality","tag"]),description:"color scheme to use",defaultValue:"normal"}},{baseConfiguration:(0,ie.RH)(e),explicitlyTyped:!0})},Se=n(59740),Te=n(74464),Pe=n(22417),Re=n(34760),Me=n.n(Re),je=n(52274),Ae=n(94877),Ne=n(27807),Le=n(42377),Fe=n(80975);var Ie=(0,$.observer)((function(e){var t=e.model,n=t.sortedBy;return n?(0,ee.jsx)("div",{"data-testid":"blurb-".concat(t.sortedBy),style:{backgroundColor:"white"},children:(0,ee.jsx)(Fe.Z,{color:"secondary",variant:"caption",children:t.sortedBy?"Sorted by ".concat(n.type.toLowerCase()," at ").concat(n.refName,":").concat(n.pos):null})}):null})),Be=["uniqueId"],De=(0,K.lazy)((function(){return n.e(6319).then(n.bind(n,96319))})),Ee=(0,K.lazy)((function(){return n.e(354).then(n.bind(n,70354))})),Ve=(0,K.lazy)((function(){return n.e(1510).then(n.bind(n,81510))})),Oe=(0,K.lazy)((function(){return n.e(7281).then(n.bind(n,97281))})),ze=(0,K.lazy)((function(){return n.e(3576).then(n.bind(n,93576))})),We=(0,K.lazy)((function(){return n.e(5058).then(n.bind(n,35058))})),He=new Map([["pileup","PileupRenderer"],["svg","SvgFeatureRenderer"]]),qe=function(e){return d.types.compose("LinearPileupDisplay",ie.fV,d.types.model({type:d.types.literal("LinearPileupDisplay"),configuration:(0,l.ConfigurationReference)(e),showSoftClipping:!1,featureHeight:d.types.maybe(d.types.number),noSpacing:d.types.maybe(d.types.boolean),fadeLikelihood:d.types.maybe(d.types.boolean),trackMaxHeight:d.types.maybe(d.types.number),mismatchAlpha:d.types.maybe(d.types.boolean),sortedBy:d.types.maybe(d.types.model({type:d.types.string,pos:d.types.number,tag:d.types.maybe(d.types.string),refName:d.types.string,assemblyName:d.types.string})),colorBy:d.types.maybe(d.types.model({type:d.types.string,tag:d.types.maybe(d.types.string),extra:d.types.frozen()})),filterBy:d.types.optional(d.types.model({flagInclude:d.types.optional(d.types.number,0),flagExclude:d.types.optional(d.types.number,1540),readName:d.types.maybe(d.types.string),tagFilter:d.types.maybe(d.types.model({tag:d.types.string,value:d.types.string}))}),{})})).volatile((function(){return{colorTagMap:ce.observable.map({}),modificationTagMap:ce.observable.map({}),ready:!1}})).actions((function(e){return{setReady:function(t){e.ready=t},setMaxHeight:function(t){e.trackMaxHeight=t},setFeatureHeight:function(t){e.featureHeight=t},setNoSpacing:function(t){e.noSpacing=t},setColorScheme:function(t){e.colorTagMap=ce.observable.map({}),e.colorBy=(0,d.cast)(t),e.ready=!1},updateModificationColorMap:function(t){var n=["red","blue","green","orange","purple"];t.forEach((function(t){if(!e.modificationTagMap.has(t)){var r=(0,k.Z)(e.modificationTagMap.keys()).length,a=n[r];e.modificationTagMap.set(t,a)}}))},updateColorTagMap:function(t){var n=["#BBCCEE","pink","#CCDDAA","#EEEEBB","#FFCCCC","lightblue","lightgreen","tan","#CCEEFF","lightsalmon"];t.forEach((function(t){if(!e.colorTagMap.has(t)){var r=(0,k.Z)(e.colorTagMap.keys()).length,a=n[r];e.colorTagMap.set(t,a)}}))}}})).actions((function(e){return{afterAttach:function(){(0,d.addDisposer)(e,(0,ce.autorun)((0,A.Z)(B().mark((function t(){var n,r,a,i,o,s,c,u,d,f,p,h,g,m,v;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=(0,T.getSession)(e),r=n.rpcManager,a=(0,T.getContainingView)(e),i=e.sortedBy,o=e.colorBy,s=e.parentTrack,c=e.adapterConfig,u=e.rendererType,d=a.staticBlocks,f=a.bpPerPx,null===o||void 0===o||!o.tag){t.next=10;break}return t.next=8,ve(e,o,d);case 8:p=t.sent,e.updateColorTagMap(p);case 10:if("modifications"!==(null===o||void 0===o?void 0:o.type)){t.next=17;break}return h=(0,l.getConf)(s,["adapter"]),t.t0=e,t.next=15,be(e,h,o,d);case 15:t.t1=t.sent,t.t0.updateModificationColorMap.call(t.t0,t.t1);case 17:if(!i){t.next=25;break}return g=i.pos,m=i.refName,v=i.assemblyName,t.next=21,e.rendererType.renderInClient(r,(0,C.Z)({assemblyName:v,regions:[{start:g,end:g+1,refName:m,assemblyName:v}],adapterConfig:c,rendererType:u.name,sessionId:(0,me.getRpcSessionId)(e),layoutId:a.id,timeout:1e6},e.renderProps()));case 21:e.setReady(!0),e.setCurrBpPerPx(f),t.next=26;break;case 25:e.setReady(!0);case 26:t.next=32;break;case 28:t.prev=28,t.t2=t.catch(0),console.error(t.t2),e.setError(t.t2);case 32:case"end":return t.stop()}}),t,null,[[0,28]])}))),{delay:1e3}))},selectFeature:function(t){var n=(0,T.getSession)(e);if((0,T.isSessionModelWithWidgets)(n)){var r=n.addWidget("AlignmentsFeatureWidget","alignmentFeature",{featureData:t.toJSON(),view:(0,T.getContainingView)(e)});n.showWidget(r)}n.setSelection(t)},clearSelected:function(){e.sortedBy=void 0},copyFeatureToClipboard:function(t){var n=t.toJSON(),r=(n.uniqueId,(0,Se.Z)(n,Be)),a=(0,T.getSession)(e);Me()(JSON.stringify(r,null,4)),a.notify("Copied to clipboard","success")},toggleSoftClipping:function(){e.showSoftClipping=!e.showSoftClipping},toggleMismatchAlpha:function(){e.mismatchAlpha=!e.mismatchAlpha},setConfig:function(t){e.configuration=t},setSortedBy:function(t,n){var r=(0,T.getContainingView)(e).centerLineInfo;if(r){var a=r.refName,i=r.assemblyName,o=r.offset,s=Math.round(o)+1,c=a;s<0||(e.sortedBy={type:t,pos:s,refName:c,assemblyName:i,tag:n},e.ready=!1)}},setFilterBy:function(t){e.filterBy=(0,d.cast)(t)}}})).actions((function(e){var t=e.reload;return{reload:function(){e.clearSelected(),t()}}})).views((function(e){return{get maxHeight(){var t=(0,l.getConf)(e,["renderers",e.rendererTypeName])||{};return void 0!==e.trackMaxHeight?e.trackMaxHeight:t.maxHeight},get rendererConfig(){var t=(0,l.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create((0,C.Z)((0,C.Z)({},t),{},{height:e.featureHeight,noSpacing:e.noSpacing,maxHeight:this.maxHeight,mismatchAlpha:e.mismatchAlpha}),(0,d.getEnv)(e))},get featureHeightSetting(){return e.featureHeight||(0,l.readConfObject)(this.rendererConfig,"height")},get mismatchAlphaSetting(){return void 0!==e.mismatchAlpha?e.mismatchAlpha:(0,l.readConfObject)(this.rendererConfig,"mismatchAlpha")}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{get rendererTypeName(){var t=(0,l.getConf)(e,"defaultRendering"),n=He.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},contextMenuItems:function(){var t=e.contextMenuFeature,n=t?[{label:"Open feature details",icon:je.Z,onClick:function(){e.clearFeatureSelection(),t&&e.selectFeature(t)}},{label:"Copy info to clipboard",icon:Pe.pt,onClick:function(){t&&e.copyFeatureToClipboard(t)}}]:[];return n},get DisplayBlurb(){return Ie},renderProps:function(){var t=(0,T.getContainingView)(e),r=e.colorTagMap,a=e.modificationTagMap,i=e.sortedBy,o=e.colorBy,s=e.filterBy,c=e.rpcDriverName,u=n();return(0,C.Z)((0,C.Z)({},u),{},{notReady:u.notReady||!e.ready||i&&e.currBpPerPx!==t.bpPerPx,rpcDriverName:c,displayModel:e,sortedBy:i,colorBy:o,filterBy:s,colorTagMap:JSON.parse(JSON.stringify(r)),modificationTagMap:JSON.parse(JSON.stringify(a)),showSoftClip:e.showSoftClipping,config:e.rendererConfig,onFeatureClick:function(t,n){return(0,A.Z)(B().mark((function t(){var r,a,i,o,s,c;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,T.getSession)(e),a=r.rpcManager,t.prev=2,i=n||e.featureIdUnderMouse){t.next=8;break}e.clearFeatureSelection(),t.next=14;break;case 8:return o=(0,me.getRpcSessionId)(e),t.next=11,a.call(o,"CoreGetFeatureDetails",{featureId:i,sessionId:o,layoutId:(0,T.getContainingView)(e).id,rendererType:"PileupRenderer"});case 11:s=t.sent,(c=s.feature)&&e.selectFeature(new T.SimpleFeature(c));case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.error(t.t0),r.notify("".concat(t.t0));case 20:case"end":return t.stop()}}),t,null,[[2,16]])})))()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){return(0,A.Z)(B().mark((function t(){var r,a,i,o,s,c;return B().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,T.getSession)(e),a=r.rpcManager,t.prev=2,i=n||e.featureIdUnderMouse){t.next=8;break}e.clearFeatureSelection(),t.next=14;break;case 8:return o=(0,me.getRpcSessionId)(e),t.next=11,a.call(o,"CoreGetFeatureDetails",{featureId:i,sessionId:o,layoutId:(0,T.getContainingView)(e).id,rendererType:"PileupRenderer"});case 11:s=t.sent,(c=s.feature)&&e.setContextMenuFeature(new T.SimpleFeature(c));case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(2),console.error(t.t0),r.notify("".concat(t.t0));case 20:case"end":return t.stop()}}),t,null,[[2,16]])})))()}})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Show soft clipping",icon:Te.Z,type:"checkbox",checked:e.showSoftClipping,onClick:function(){e.toggleSoftClipping(),e.showSoftClipping&&e.clearSelected()}},{label:"Sort by",icon:Ae.Z,disabled:e.showSoftClipping,subMenu:[].concat((0,k.Z)(["Start location","Read strand","Base pair"].map((function(t){return{label:t,onClick:function(){return e.setSortedBy(t)}}}))),[{label:"Sort by tag...",onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[Ve,{model:e,handleClose:t}]}))}},{label:"Clear sort",onClick:function(){return e.clearSelected()}}])},{label:"Color scheme",icon:Ne.Z,subMenu:[{label:"Normal",onClick:function(){e.setColorScheme({type:"normal"})}},{label:"Mapping quality",onClick:function(){e.setColorScheme({type:"mappingQuality"})}},{label:"Strand",onClick:function(){e.setColorScheme({type:"strand"})}},{label:"Pair orientation",onClick:function(){e.setColorScheme({type:"pairOrientation"})}},{label:"Per-base quality",onClick:function(){e.setColorScheme({type:"perBaseQuality"})}},{label:"Per-base lettering",onClick:function(){e.setColorScheme({type:"perBaseLettering"})}},{label:"Modifications or methylation",onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[We,{model:e,handleClose:t}]}))}},{label:"Insert size",onClick:function(){e.setColorScheme({type:"insertSize"})}},{label:"Stranded paired-end",onClick:function(){e.setColorScheme({type:"reverseTemplate"})}},{label:"Color by tag...",onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[De,{model:e,handleClose:t}]}))}}]},{label:"Filter by",icon:Le.Z,onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[Ee,{model:e,handleClose:t}]}))}},{label:"Set feature height",onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[Oe,{model:e,handleClose:t}]}))}},{label:"Set max height",onClick:function(){(0,T.getSession)(e).queueDialog((function(t){return[ze,{model:e,handleClose:t}]}))}},{label:"Fade mismatches by quality",type:"checkbox",checked:e.mismatchAlphaSetting,onClick:function(){e.toggleMismatchAlpha()}}])}}}))};function Ue(e){e.addDisplayType((function(){var t=Ze(e);return new ae.Z({name:"LinearPileupDisplay",configSchema:t,stateModel:qe(t),trackType:"AlignmentsTrack",viewType:"LinearGenomeView",ReactComponent:ie.qb})}))}var _e=n(82044);function Ge(e){e.addTrackType((function(){var t=function(e){return(0,l.ConfigurationSchema)("AlignmentsTrack",{},{baseConfiguration:(0,se.createBaseTrackConfig)(e)})}(e),n=new _e.Z({name:"AlignmentsTrack",configSchema:t,stateModel:(0,se.createBaseTrackModel)(e,"AlignmentsTrack",t)}),r=e.getDisplayType("LinearAlignmentsDisplay");return n.addDisplayType(r),n}))}var Je=n(29206),Xe=n(66737),Ye=(0,l.ConfigurationSchema)("AlignmentsFeatureWidget",{});function Qe(e){return d.types.model("AlignmentsFeatureWidget",{id:Je.ElementId,type:d.types.literal("AlignmentsFeatureWidget"),featureData:d.types.frozen(),view:d.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}function $e(e){e.addWidgetType((function(){return new Xe.Z({name:"AlignmentsFeatureWidget",heading:"Feature details",configSchema:Ye,stateModel:Qe(e),ReactComponent:(0,K.lazy)((function(){return n.e(6524).then(n.bind(n,6524))}))})}))}var Ke=n(71036),et=n(26080),tt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="PileupGetGlobalValueForTag",e}return(0,a.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,A.Z)(B().mark((function e(t,r){var a,i,o,s;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pluginManager.rootModel,o=null===i||void 0===i||null===(a=i.session)||void 0===a?void 0:a.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.next=6,(0,T.renameRegionsIfNeeded)(o,t);case 6:return s=e.sent,e.abrupt("return",(0,L.Z)((0,F.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,A.Z)(B().mark((function e(t,n){var r,a,i,o,s,c,u,l,d;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,s=r.tag,e.next=6,(0,z.uP)(this.pluginManager,i,a);case 6:return c=e.sent.dataAdapter,u=c.getFeaturesInMultipleRegions(o),e.next=10,u.pipe((0,et.q)()).toPromise();case 10:return l=e.sent,d=new Set,l.forEach((function(e){var t=e.get("tags"),n=t?t[s]:e.get(s);void 0!==n&&d.add("".concat(n))})),e.abrupt("return",(0,k.Z)(d));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Ke.Z),nt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="PileupGetVisibleModifications",e}return(0,a.Z)(n,[{key:"serializeArguments",value:function(){var e=(0,A.Z)(B().mark((function e(t,r){var a,i,o,s;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.pluginManager.rootModel,o=null===i||void 0===i||null===(a=i.session)||void 0===a?void 0:a.assemblyManager){e.next=4;break}throw new Error("no assembly manager available");case 4:return e.next=6,(0,T.renameRegionsIfNeeded)(o,t);case 6:return s=e.sent,e.abrupt("return",(0,L.Z)((0,F.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,A.Z)(B().mark((function e(t,n){var r,a,i,o,s,u,l,d;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,o=r.regions,e.next=6,(0,z.uP)(this.pluginManager,i,a);case 6:return s=e.sent.dataAdapter,u=s.getFeaturesInMultipleRegions(o),e.next=10,u.pipe((0,et.q)()).toPromise();case 10:return l=e.sent,d=new Set,l.forEach((function(e){var t=(0,H.TN)(e,"MM","Mm")||"";void 0!==t&&(0,c.getModificationTypes)(t).forEach((function(e){return d.add(e)}))})),e.abrupt("return",(0,k.Z)(d));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Ke.Z),rt=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="AlignmentsPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){[g,p,Ue,Ce,Ge,x,v,re,j,fe,$e].map((function(t){return t(e)})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="CramAdapter",i=(0,me.getFileName)(t),o={type:a,cramLocation:t,craiLocation:n||(0,me.makeIndex)(t,".crai")};return/\.cram$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BamAdapter",i=(0,me.getFileName)(t),o=n&&(0,me.getFileName)(n),s={type:a,bamLocation:t,index:{location:n||(0,me.makeIndex)(t,".bai"),indexType:(0,me.makeIndexType)(o,"CSI","BAI")}};return/\.bam$/i.test(i)&&!r||r===a?s:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BamAdapter"===t||"CramAdapter"===t?"AlignmentsTrack":e(t)}})),e.addRpcMethod((function(){return new tt(e)})),e.addRpcMethod((function(){return new nt(e)}))}}]),n}(s.Z)},54685:function(e,t,n){"use strict";n.d(t,{ES:function(){return p},O:function(){return d},TN:function(){return u},h1:function(){return c},uD:function(){return l}});var r=n(33028),a=n(34795),i=n(77162),o=n.n(i),s=n(26080);function c(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function u(e,t,n){return c(e,t)||c(e,n)}var l={fr:{F1R2:"LR",F2R1:"LR",F1F2:"LL",F2F1:"LL",R1R2:"RR",R2R1:"RR",R1F2:"RL",R2F1:"RL"},rf:{R1F2:"LR",R2F1:"LR",R1R2:"LL",R2R1:"LL",F1F2:"RR",F2F1:"RR",F1R2:"RL",F2R1:"RL"},ff:{F2F1:"LR",R1R2:"LR",F2R1:"LL",R1F2:"LL",R2F1:"RR",F1R2:"RR",R2R1:"RL",F1F2:"RL"}};function d(e,t){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)(o().mark((function e(t,n){var a,i,c,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.end,c=t.originalRefName,u=t.refName,e.next=3,n.getFeatures((0,r.Z)((0,r.Z)({},t),{},{refName:c||u,end:i+1})).pipe((0,s.q)()).toPromise();case 3:return l=e.sent,e.abrupt("return",null===(a=l[0])||void 0===a?void 0:a.get("seq"));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return"methylation"===e}},2290:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(49767),c=n(81575),u=n(40909),l=n(9077);var d=n(33028),f=n(76085);function p(e,t){var n=t.getPlugin("LinearGenomeViewPlugin").exports.BaseLinearDisplay;return u.types.compose("LinearArcDisplay",n,u.types.model({type:u.types.literal("LinearArcDisplay"),configuration:(0,f.B)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"staticBlocks"},get renderDelay(){return 500},renderProps:function(){return(0,d.Z)((0,d.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var h=n(41361),g=n(96234),m=n(30969),v=n(81073),y=n(90550),b=n(6364),x=n(37574);var w=(0,y.observer)((function(e){var t,n=function(t,n){var r=e.onFeatureClick;if(r)return r(t,n)},r=e.features,a=e.config,i=e.regions,o=e.blockKey,s=e.bpPerPx,c=e.displayModel.selectedFeatureId,u=(0,g.Z)(i,1)[0],d=[],f=(0,h.Z)(r.values());try{var p=function(){var e=t.value,r=(0,v.bpSpanPx)(e.get("start"),e.get("end"),u,s),i=(0,g.Z)(r,2),f=i[0],p=i[1],h=e.id(),y=o+"-"+h,w=(0,l.readConfObject)(a,"color",{feature:e}),k="black";c&&String(c)===String(e.id())&&(w=k="red");var C=(0,l.readConfObject)(a,"label",{feature:e}),Z=(0,l.readConfObject)(a,"caption",{feature:e}),S=(0,l.readConfObject)(a,"thickness",{feature:e})||1,T=(0,l.readConfObject)(a,"height",{feature:e})||100,P=m.createRef(),R=20+(0,v.measureText)(null===Z||void 0===Z?void 0:Z.toString()),M=.5,j=0+M*T*.75+.375*T+0;d.push((0,x.jsxs)("g",{onClick:function(e){return n(e,h)},children:[(0,x.jsx)("path",{id:y,d:"M ".concat(f," 0 C ").concat(f," ").concat(T,", ").concat(p," ").concat(T,", ").concat(p," 0"),stroke:w,strokeWidth:S,fill:"transparent",onClick:function(e){return n(e,h)},ref:P,pointerEvents:"stroke"}),(0,x.jsxs)(b.u,{triggerRef:P,children:[(0,x.jsx)("rect",{x:12,y:0,width:R,height:20,rx:5,ry:5,fill:"black",fillOpacity:"50%"}),(0,x.jsx)("text",{x:22,y:14,fontSize:10,fill:"white",textLength:R-20,children:Z})]}),(0,x.jsx)("text",{x:f+(p-f)/2,y:j+3,style:{stroke:"white",strokeWidth:"0.6em"},children:C}),(0,x.jsx)("text",{x:f+(p-f)/2,y:j+3,style:{stroke:k},children:C})]},y))};for(f.s();!(t=f.n()).done;)p()}catch(w){f.e(w)}finally{f.f()}var y=(u.end-u.start)/s;return(0,x.jsx)("svg",{className:"ArcRendering",width:y,height:500,style:{outline:"none",position:"relative"},children:d})})),k=(0,l.ConfigurationSchema)("ArcRenderer",{color:{type:"color",description:"the color of the arcs",defaultValue:"darkblue"},thickness:{type:"number",description:"the thickness of the arcs",defaultValue:"jexl:logThickness(feature,'score')"},label:{type:"string",description:"the label to appear at the apex of the arcs",defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]},height:{type:"number",description:"the height of the arcs",defaultValue:"jexl:log10(get(feature,'end')-get(feature,'start'))*50"},caption:{type:"string",description:"the caption to appear when hovering over any point on the arcs",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]}},{explicitlyTyped:!0}),C=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n)}(n(29637).default),Z=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ArcRenderer",e}return(0,a.Z)(n,[{key:"install",value:function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.BaseLinearDisplayComponent;e.addRendererType((function(){return new C({name:"ArcRenderer",ReactComponent:w,configSchema:k,pluginManager:e})})),e.addDisplayType((function(){var n=function(e){var t=e.getPlugin("LinearGenomeViewPlugin").exports.baseLinearDisplayConfigSchema;return(0,l.ConfigurationSchema)("LinearArcDisplay",{renderer:u.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"ArcRenderer"})},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new c.Z({name:"LinearArcDisplay",configSchema:n,stateModel:p(n,e),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:t})})),e.jexl.addFunction("logThickness",(function(e,t){return Math.log(e.get(t)+1)}))}}]),n}(s.Z)},47672:function(e,t,n){"use strict";n.d(t,{Z:function(){return te}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(49767),c=n(15875),u=n(9077),l=n(59853),d=(0,u.ConfigurationSchema)("OAuthInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Bearer"},authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:""},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:""},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!1},clientId:{description:"id for the OAuth application",type:"string",defaultValue:""},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:""},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"code"},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!1}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),f=n(34795),p=n(77162),h=n.n(p),g=n(81073),m=n(84489),v=n.n(m),y=n(67923),b=n.n(y),x=n(40909),w=n(49882).Buffer;function k(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var C=function(e){return x.types.compose("OAuthInternetAccount",l.InternetAccount,x.types.model("OAuthModel",{type:x.types.literal("OAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)})).views((function(){var e=void 0;return{get codeVerifierPKCE(){if(e)return e;var t=function(){return"object"===typeof self&&self.self===self&&self||"object"===typeof n.g&&n.g.global===n.g&&n.g||this}(),r=new Uint8Array(32);return t.crypto.getRandomValues(r),e=k(w.from(r).toString("base64"))}}})).views((function(e){return{get authEndpoint(){return(0,u.getConf)(e,"authEndpoint")},get tokenEndpoint(){return(0,u.getConf)(e,"tokenEndpoint")},get needsPKCE(){return(0,u.getConf)(e,"needsPKCE")},get clientId(){return(0,u.getConf)(e,"clientId")},get scopes(){return(0,u.getConf)(e,"scopes")},get responseType(){return(0,u.getConf)(e,"responseType")},get hasRefreshToken(){return(0,u.getConf)(e,"hasRefreshToken")},get refreshTokenKey(){return"".concat(e.internetAccountId,"-refreshToken")}}})).actions((function(e){return{storeRefreshToken:function(t){localStorage.setItem(e.refreshTokenKey,t)},removeRefreshToken:function(){localStorage.removeItem(e.refreshTokenKey)},retrieveRefreshToken:function(){return localStorage.getItem(e.refreshTokenKey)},exchangeAuthorizationForAccessToken:function(t,n){var r=this;return(0,f.Z)(h().mark((function a(){var i,o,s,c,u;return h().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i={code:t,grant_type:"authorization_code",client_id:e.clientId,code_verifier:e.codeVerifierPKCE,redirect_uri:n},o=new URLSearchParams(Object.entries(i)),a.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});case 4:if((s=a.sent).ok){a.next=16;break}return a.prev=6,a.next=9,s.text();case 9:c=a.sent,a.next=15;break;case 12:a.prev=12,a.t0=a.catch(6),c="";case 15:throw new Error("Failed to obtain token from endpoint: ".concat(s.status," (").concat(s.statusText,")").concat(c?" (".concat(c,")"):""));case 16:return a.next=18,s.json();case 18:return(u=a.sent).refresh_token&&r.storeRefreshToken(u.refresh_token),a.abrupt("return",u.access_token);case 21:case"end":return a.stop()}}),a,null,[[6,12]])})))()},exchangeRefreshForAccessToken:function(t){return(0,f.Z)(h().mark((function n(){var r,a,i,o,s;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={grant_type:"refresh_token",refresh_token:t,client_id:e.clientId},a=new URLSearchParams(Object.entries(r)),n.next=4,fetch(e.tokenEndpoint,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()});case 4:if((i=n.sent).ok){n.next=17;break}return e.removeToken(),n.prev=7,n.next=10,i.text();case 10:o=n.sent,n.next=16;break;case 13:n.prev=13,n.t0=n.catch(7),o="";case 16:throw new Error("Network response failure \u2014 ".concat(i.status," (").concat(i.statusText,") ").concat(o?" (".concat(o,")"):""));case 17:return n.next=19,i.json();case 19:return s=n.sent,n.abrupt("return",s.access_token);case 21:case"end":return n.stop()}}),n,null,[[7,13]])})))()}}})).actions((function(e){var t;return{addMessageChannel:function(e,n){var r=this;t=function(t){r.finishOAuthWindow(t,e,n)},window.addEventListener("message",t)},deleteMessageChannel:function(){window.removeEventListener("message",t)},finishOAuthWindow:function(t,n,r){var a=this;return(0,f.Z)(h().mark((function i(){var o,s,c,u,l,d,f,p,g,m;return h().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t.data.name==="JBrowseAuthWindow-".concat(e.internetAccountId)){i.next=2;break}return i.abrupt("return",a.deleteMessageChannel());case 2:if(!(o=t.data.redirectUri).includes("access_token")){i.next=12;break}if(s=o.replace("#","?"),c=new URL(s).search,u=new URLSearchParams(c),l=u.get("access_token")){i.next=10;break}return i.abrupt("return",r(new Error("Error with token endpoint")));case 10:return e.storeToken(l),i.abrupt("return",n(l));case 12:if(!o.includes("code")){i.next=34;break}if(d=new URL(o),f=d.search,p=new URLSearchParams(f),g=p.get("code")){i.next=19;break}return i.abrupt("return",r(new Error("Error with authorization endpoint")));case 19:return i.prev=19,i.next=22,e.exchangeAuthorizationForAccessToken(g,d.origin+d.pathname);case 22:return m=i.sent,e.storeToken(m),i.abrupt("return",n(m));case 27:if(i.prev=27,i.t0=i.catch(19),!(i.t0 instanceof Error)){i.next=33;break}return i.abrupt("return",r(i.t0));case 33:return i.abrupt("return",r(new Error(String(i.t0))));case 34:if(!o.includes("access_denied")){i.next=36;break}return i.abrupt("return",r(new Error("OAuth flow was cancelled")));case 36:a.deleteMessageChannel();case 37:case"end":return i.stop()}}),i,null,[[19,27]])})))()},useEndpointForAuthorization:function(t,n){var r=this;return(0,f.Z)(h().mark((function a(){var i,o,s,c,u,l,d,f,p,m,y;return h().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=g.isElectron?"http://localhost/auth":window.location.origin+window.location.pathname,o={client_id:e.clientId,redirect_uri:i,response_type:e.responseType||"code"},e.scopes&&(o.scope=e.scopes),e.needsPKCE&&(s=e.codeVerifierPKCE,c=k(b().stringify(v()(s))),o.code_challenge=c,o.code_challenge_method="S256"),e.hasRefreshToken&&(o.token_access_type="offline"),u=new URLSearchParams(Object.entries(o)),(l=new URL(e.authEndpoint)).search=u.toString(),d="JBrowseAuthWindow-".concat(e.internetAccountId),!g.isElectron){a.next=18;break}return f=window.require("electron"),p=f.ipcRenderer,a.next=13,p.invoke("openAuthWindow",{internetAccountId:e.internetAccountId,data:o,url:l.toString()});case 13:m=a.sent,y=new MessageEvent("message",{data:{name:d,redirectUri:m}}),r.finishOAuthWindow(y,t,n),a.next=20;break;case 18:"width=500,height=600,left=0,top=0",window.open(l,d,"width=500,height=600,left=0,top=0");case 20:case"end":return a.stop()}}),a)})))()},getTokenFromUser:function(t,n){var r=this;return(0,f.Z)(h().mark((function a(){var i;return h().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!(i=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=7;break}return a.t0=t,a.next=5,e.exchangeRefreshForAccessToken(i);case 5:a.t1=a.sent,(0,a.t0)(a.t1);case 7:r.addMessageChannel(t,n),r.useEndpointForAuthorization(t,n);case 9:case"end":return a.stop()}}),a)})))()}}}))},Z=(0,u.ConfigurationSchema)("ExternalTokenInternetAccount",{validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),S=n(96234),T=n(30969),P=n(28599),R=n(83483),M=n(93138),j=n(64501),A=n(53033),N=n(7690),L=n(37574),F=function(e){var t=e.internetAccountId,n=e.handleClose,r=(0,T.useState)(""),a=(0,S.Z)(r,2),i=a[0],o=a[1];return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(R.Z,{open:!0,maxWidth:"xl","data-testid":"externalToken-form",children:[(0,L.jsxs)(j.Z,{children:["Enter Token for ",t]}),(0,L.jsx)(M.Z,{style:{display:"flex",flexDirection:"column"},children:(0,L.jsx)(N.Z,{required:!0,label:"Enter Token",variant:"outlined",inputProps:{"data-testid":"entry-externalToken"},onChange:function(e){o(e.target.value)},margin:"dense"})}),(0,L.jsxs)(A.Z,{children:[(0,L.jsx)(P.Z,{variant:"contained",color:"primary",type:"submit",disabled:!i,onClick:function(){i&&n(i)},children:"Add"}),(0,L.jsx)(P.Z,{variant:"contained",color:"primary",onClick:function(){n()},children:"Cancel"})]})]})})},I=function(e){return x.types.compose("ExternalTokenInternetAccount",l.InternetAccount,x.types.model({type:x.types.literal("ExternalTokenInternetAccount"),configuration:(0,u.ConfigurationReference)(e)})).views((function(e){return{get validateWithHEAD(){return(0,u.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){(0,x.getRoot)(e).session.queueDialog((function(r){return[F,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return(0,f.Z)(h().mark((function r(){var a,i,o;return h().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((i=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,i.text();case 10:o=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),o="";case 16:throw new Error("Token could not be validated \u2014 ".concat(i.status," (").concat(i.statusText,")").concat(o?" (".concat(o,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))},B=(0,u.ConfigurationSchema)("HTTPBasicInternetAccount",{tokenType:{description:"a custom name for a token to include in the header",type:"string",defaultValue:"Basic"},validateWithHEAD:{description:"validate the token with a HEAD request before using it",type:"boolean",defaultValue:!0}},{baseConfiguration:l.BaseInternetAccountConfig,explicitlyTyped:!0}),D=function(e){var t=e.internetAccountId,n=e.handleClose,r=(0,T.useState)(""),a=(0,S.Z)(r,2),i=a[0],o=a[1],s=(0,T.useState)(""),c=(0,S.Z)(s,2),u=c[0],l=c[1];return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(R.Z,{open:!0,maxWidth:"xl","data-testid":"login-httpbasic",children:[(0,L.jsxs)(j.Z,{children:["Log In for ",t]}),(0,L.jsxs)("form",{onSubmit:function(e){i&&u?n(btoa("".concat(i,":").concat(u))):n(),e.preventDefault()},children:[(0,L.jsxs)(M.Z,{style:{display:"flex",flexDirection:"column"},children:[(0,L.jsx)(N.Z,{required:!0,label:"Username",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-username"},onChange:function(e){o(e.target.value)},margin:"dense"}),(0,L.jsx)(N.Z,{required:!0,label:"Password",type:"password",autoComplete:"current-password",variant:"outlined",inputProps:{"data-testid":"login-httpbasic-password"},onChange:function(e){l(e.target.value)},margin:"dense"})]}),(0,L.jsxs)(A.Z,{children:[(0,L.jsx)(P.Z,{variant:"contained",color:"primary",type:"submit",children:"Submit"}),(0,L.jsx)(P.Z,{variant:"contained",color:"default",type:"submit",onClick:function(){n()},children:"Cancel"})]})]})]})})},E=function(e){return x.types.compose("HTTPBasicInternetAccount",l.InternetAccount,x.types.model({type:x.types.literal("HTTPBasicInternetAccount"),configuration:(0,u.ConfigurationReference)(e)})).views((function(e){return{get validateWithHEAD(){return(0,u.getConf)(e,"validateWithHEAD")}}})).actions((function(e){return{getTokenFromUser:function(t,n){(0,x.getRoot)(e).session.queueDialog((function(r){return[D,{internetAccountId:e.internetAccountId,handleClose:function(e){e?t(e):n(new Error("user cancelled entry")),r()}}]}))},validateToken:function(t,n){return(0,f.Z)(h().mark((function r(){var a,i,o;return h().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e.validateWithHEAD){r.next=2;break}return r.abrupt("return",t);case 2:return a=e.addAuthHeaderToInit({method:"HEAD"},t),r.next=5,fetch(n.uri,a);case 5:if((i=r.sent).ok){r.next=17;break}return r.prev=7,r.next=10,i.text();case 10:o=r.sent,r.next=16;break;case 13:r.prev=13,r.t0=r.catch(7),o="";case 16:throw new Error("Error validating token \u2014 ".concat(i.status," (").concat(i.statusText,")").concat(o?" (".concat(o,")"):""));case 17:return r.abrupt("return",t);case 18:case"end":return r.stop()}}),r,null,[[7,13]])})))()}}}))},V=(0,u.ConfigurationSchema)("DropboxOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://www.dropbox.com/oauth2/authorize"},tokenEndpoint:{description:"the token endpoint of the internet account",type:"string",defaultValue:"https://api.dropbox.com/oauth2/token"},needsPKCE:{description:"boolean to indicate if the endpoint needs a PKCE code",type:"boolean",defaultValue:!0},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:["addtodropbox.com","db.tt","dropbox.com","dropboxapi.com","dropboxbusiness.com","dropbox.tech","getdropbox.com"]},hasRefreshToken:{description:"true if the endpoint can supply a refresh token",type:"boolean",defaultValue:!0}},{baseConfiguration:d,explicitlyTyped:!0}),O=n(33028),z=n(67496),W={shared_link_not_found:"The shared link wasn't found.",shared_link_access_denied:"The caller is not allowed to access this shared link.",unsupported_link_type:"This type of link is not supported; use files/export instead.",shared_link_is_directory:"Directories cannot be retrieved by this endpoint."};function H(e){return(0,L.jsx)(z.Z,(0,O.Z)((0,O.Z)({},e),{},{children:(0,L.jsx)("path",{d:"M3 6.2L8 9.39L13 6.2L8 3L3 6.2M13 6.2L18 9.39L23 6.2L18 3L13 6.2M3 12.55L8 15.74L13 12.55L8 9.35L3 12.55M18 9.35L13 12.55L18 15.74L23 12.55L18 9.35M8.03 16.8L13.04 20L18.04 16.8L13.04 13.61L8.03 16.8Z"})}))}function q(e){return U.apply(this,arguments)}function U(){return(U=(0,f.Z)(h().mark((function e(t){var n,r,a;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(i){r=void 0}r&&(a=r.error[".tag"],n=W[a]||a)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var _=function(e){return x.types.compose("DropboxOAuthInternetAccount",C(d),x.types.model({type:x.types.literal("DropboxOAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)})).views((function(){return{get toggleContents(){return(0,L.jsx)(H,{})},get selectorLabel(){return"Enter Dropbox share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,f.Z)(h().mark((function n(r,a){var i,o,s,c;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getToken(t);case 2:return i=n.sent,(o=e.addAuthHeaderToInit((0,O.Z)((0,O.Z)({},a),{},{method:"POST"}),i)).headers.append("Dropbox-API-Arg",JSON.stringify({url:r})),n.next=7,fetch("https://content.dropboxapi.com/2/sharing/get_shared_link_file",o);case 7:if((s=n.sent).ok){n.next=13;break}return n.next=11,q(s);case 11:throw c=n.sent,new Error(c);case 13:return n.abrupt("return",s);case 14:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},validateToken:function(t,n){var r=this;return(0,f.Z)(h().mark((function a(){var i,o,s,c;return h().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch("https://api.dropboxapi.com/2/sharing/get_shared_link_metadata",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({url:n.uri})});case 2:if((i=a.sent).ok){a.next=15;break}if(!(o=e.hasRefreshToken&&e.retrieveRefreshToken())){a.next=11;break}return e.removeRefreshToken(),a.next=9,e.exchangeRefreshForAccessToken(o);case 9:return s=a.sent,a.abrupt("return",r.validateToken(s,n));case 11:return a.next=13,q(i);case 13:throw c=a.sent,new Error("Token could not be validated. ".concat(c));case 15:return a.abrupt("return",t);case 16:case"end":return a.stop()}}),a)})))()}}}))},G=(0,u.ConfigurationSchema)("GoogleDriveOAuthInternetAccount",{authEndpoint:{description:"the authorization code endpoint of the internet account",type:"string",defaultValue:"https://accounts.google.com/o/oauth2/v2/auth"},scopes:{description:"optional scopes for the authorization call",type:"string",defaultValue:"https://www.googleapis.com/auth/drive.readonly"},domains:{description:"array of valid domains the url can contain to use this account",type:"stringArray",defaultValue:['drive.google.com"']},responseType:{description:"the type of response from the authorization endpoint",type:"string",defaultValue:"token"}},{baseConfiguration:d,explicitlyTyped:!0}),J=n(93069),X=n(95058),Y=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a){var i;return(0,r.Z)(this,n),(i=t.call(this,e,a)).statsPromise=void 0,i.statsPromise=i.fetch(e,{metadataOnly:!0}).then((function(e){return e.json()})),i}return(0,a.Z)(n,[{key:"fetch",value:function(){var e=(0,f.Z)(h().mark((function e(t,r){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,J.Z)((0,X.Z)(n.prototype),"fetch",this).call(this,t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var e=(0,f.Z)(h().mark((function e(){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.statsPromise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(n(33528).RemoteFileWithRangeCache);function Q(e){return(0,L.jsx)(z.Z,(0,O.Z)((0,O.Z)({},e),{},{children:(0,L.jsx)("path",{d:"M7.71,3.5L1.15,15L4.58,21L11.13,9.5M9.73,15L6.3,21H19.42L22.85,15M22.28,14L15.42,2H8.58L8.57,2L15.43,14H22.28Z"})}))}function $(e){return K.apply(this,arguments)}function K(){return(K=(0,f.Z)(h().mark((function e(t){var n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.text();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n="";case 9:if(n){try{r=JSON.parse(n)}catch(a){r=void 0}r&&(n=r.error.message)}return e.abrupt("return","Network response failure \u2014 ".concat(t.status," (").concat(t.statusText,")").concat(n?" (".concat(n,")"):""));case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var ee=function(e){return x.types.compose("GoogleDriveOAuthInternetAccount",C(d),x.types.model({type:x.types.literal("GoogleDriveOAuthInternetAccount"),configuration:(0,u.ConfigurationReference)(e)})).views((function(){return{get toggleContents(){return(0,L.jsx)(Q,{})},get selectorLabel(){return"Enter Google Drive share link"}}})).actions((function(e){return{getFetcher:function(t){return function(){var n=(0,f.Z)(h().mark((function n(r,a){var i,o,s,c,u,l,d;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=String(r).match(/[-\w]{25,}/),o=new URL("https://www.googleapis.com/drive/v3/files/".concat(i)),s=new URLSearchParams,null!==a&&void 0!==a&&a.metadataOnly?s.append("fields","size"):s.append("alt","media"),o.search=s.toString(),n.next=7,e.getToken(t);case 7:return c=n.sent,u=e.addAuthHeaderToInit((0,O.Z)((0,O.Z)({},a),{},{method:"GET",credentials:"same-origin"}),c),n.next=11,fetch(o.toString(),u);case 11:if((l=n.sent).ok){n.next=17;break}return n.next=15,$(l);case 15:throw d=n.sent,new Error(d);case 17:return n.abrupt("return",l);case 18:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},openLocation:function(e){return new Y(e.uri,{fetch:this.getFetcher(e)})},validateToken:function(e,t){return(0,f.Z)(h().mark((function n(){var r,a,i;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.uri.match(/[-\w]{25,}/),n.next=3,fetch("https://www.googleapis.com/drive/v3/files/".concat(r),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/x-www-form-urlencoded"}});case 3:if((a=n.sent).ok){n.next=9;break}return n.next=7,$(a);case 7:throw i=n.sent,new Error("Token could not be validated. ".concat(i));case 9:return n.abrupt("return",e);case 10:case"end":return n.stop()}}),n)})))()}}}))},te=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="AuthenticationPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addInternetAccountType((function(){return new c.Z({name:"OAuthInternetAccount",configSchema:d,stateModel:C(d)})})),e.addInternetAccountType((function(){return new c.Z({name:"ExternalTokenInternetAccount",configSchema:Z,stateModel:I(Z)})})),e.addInternetAccountType((function(){return new c.Z({name:"HTTPBasicInternetAccount",configSchema:B,stateModel:E(B)})})),e.addInternetAccountType((function(){return new c.Z({name:"DropboxOAuthInternetAccount",configSchema:V,stateModel:_(V)})})),e.addInternetAccountType((function(){return new c.Z({name:"GoogleDriveOAuthInternetAccount",configSchema:G,stateModel:ee(G)})}))}}]),n}(s.Z)},39600:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(93029),c=n(49767),u=n(9077),l=(0,u.ConfigurationSchema)("BigBedAdapter",{bigBedLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bb",locationType:"UriLocation"}}},{explicitlyTyped:!0}),d=n(40909),f=(0,u.ConfigurationSchema)("BedTabixAdapter",{bedGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz",locationType:"UriLocation"}},index:(0,u.ConfigurationSchema)("TabixIndex",{indexType:{model:d.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bed.gz.tbi",locationType:"UriLocation"}}}),columnNames:{type:"stringArray",description:"List of column names",defaultValue:[]},scoreColumn:{type:"string",description:'The column to use as a "score" attribute',defaultValue:""},autoSql:{type:"string",description:"The autoSql definition for the data fields in the file",defaultValue:""}},{explicitlyTyped:!0}),p=n(97891),h=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BedPlugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"BigBedAdapter",configSchema:l,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7904),n.e(6254),n.e(8982),n.e(1462),n.e(3787)]).then(n.bind(n,63787)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigBedAdapter",i=(0,p.getFileName)(t),o={type:a,bigBedLocation:t};return/\.(bb|bigbed)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addAdapterType((function(){return new s.Z({name:"BedTabixAdapter",configSchema:f,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7904),n.e(4061),n.e(1462),n.e(3653)]).then(n.bind(n,53653)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BedTabixAdapter",i=(0,p.getFileName)(t),o=n&&(0,p.getFileName)(n);return/\.bed\.b?gz$/i.test(i)||r===a?{type:a,bedGzLocation:t,index:{location:n||(0,p.makeIndex)(t,".tbi"),indexType:(0,p.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}}))}}]),c}(c.Z)},18549:function(e,t,n){"use strict";n.d(t,{Z:function(){return fe}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(66737),u=n(49767),l=n(9077),d=n(29206),f=n(40909),p=(0,l.ConfigurationSchema)("BreakpointAlignmentsWidget",{}),h=f.types.model("BreakpointAlignmentsWidget",{id:d.ElementId,type:f.types.literal("BreakpointAlignmentsWidget"),featureData:f.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}})),g=n(33028),m=n(81073),v=n(39798),y=n(6556),b=n(90550),x=n(22714),w=n(96234),k=n(68079),C=n(41361),Z=n(64841),S=n.n(Z),T=[0,1,2,3],P=T[1],R=T[3];function M(e,t,n){return((e.bpToPx({refName:t,coord:n})||{}).offsetPx||0)-e.offsetPx}function j(e,t,n,r,a){var i,o=r[t].displays[0],s=o.height,c=0,u=o.showCoverage,l=o.SNPCoverageDisplay;return l&&u&&(c=l.height),(0,m.clamp)(a[P]-o.scrollTop+((i=a)[R]-i[P])/2+c,0,s)+function(e,t,n){var r=e[n].trackRefs[t];return(null===r||void 0===r?void 0:r.getBoundingClientRect().top)||0}(n,e,t)+o.scrollTop}var A=function(e){var t=(0,s.useState)(),n=(0,w.Z)(t,2)[1];(0,s.useEffect)((function(){n(e)}),[e])},N=n(37574),L=[0,1,2,3],F=L[0],I=L[2];var B=(0,b.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=t.showIntraviewLinks,o=(0,m.getSession)(t),c=(0,f.getSnapshot)(t),u=o.assemblyManager.get(a[0].assemblyNames[0]);A(c);var l=t.getTrackFeatures(n),d=(0,s.useMemo)((function(){return e=l,(0,k.Z)(e.values()).find((function(e){return 64&e.get("flags")}));var e}),[l]),p=(0,s.useMemo)((function(){var e=d?function(e){var t,n={},r=new Set,a=(0,C.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.get("flags"),s=i.id(),c=4&o,u=2&o;if(!r.has(s)&&!u&&!c){var l=i.get("name");n[l]||(n[l]=[]),n[l].push(i)}r.add(i.id())}}catch(d){a.e(d)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(l):function(e){var t,n={},r=new Set,a=(0,C.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.id(),s=4&i.get("flags");if(!r.has(o)&&!s){var c=i.get("name");n[c]||(n[c]=[]),n[c].push(i)}r.add(i.id())}}catch(u){a.e(u)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(l),r=t.getMatchedFeaturesInLayout(n,e);return d||r.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))})),r}),[l,n,d,t]),h=(0,s.useState)(),g=(0,w.Z)(h,2),v=g[0],y=g[1],b=0;if(r.current){var x=r.current.getBoundingClientRect();b=x.top}return u?(0,N.jsx)("g",{stroke:"#333",fill:"none","data-testid":p.length?"".concat(n,"-loaded"):n,children:p.map((function(e){for(var t=[],r=function(r){var s=e[r],c=s.layout,f=s.feature,p=s.level,h=e[r+1],g=h.layout,m=h.feature,x=h.level;if(!c||!g)return console.warn("received null layout for a overlay feature"),{v:null};if(!i&&p===x)return{v:null};var w=f.get("refName"),k=m.get("refName"),C=u.getCanonicalRefName(w),Z=u.getCanonicalRefName(k);if(!C||!Z)throw new Error("unable to find ref for ".concat(C||Z));var T=f.get("strand"),P=m.get("strand"),R=c[-1===T?F:I],A=d?g[-1===P?F:I]:g[-1===P?I:F],L=M(a[p],C,R),B=M(a[x],Z,A),D=a[p].pxToBp(L).reversed,E=a[x].pxToBp(B).reversed,V=a.map((function(e){return e.getTrack(n)})),O=j(n,p,a,V,c)-b,z=j(n,x,a,V,g)-b,W=S()().moveTo(L,O).curveTo(L+200*f.get("strand")*(D?-1:1),O,B-200*m.get("strand")*(E?-1:1)*(d?-1:1),z,B,z).end(),H="".concat(f.id(),"-").concat(m.id());t.push((0,N.jsx)("path",{d:W,"data-testid":"r1",strokeWidth:v===H?5:1,onClick:function(){var e,t,n=null===(e=o.addWidget)||void 0===e?void 0:e.call(o,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(l.get(f.id())||{toJSON:function(){}}).toJSON(),feature2:(l.get(m.id())||{toJSON:function(){}}).toJSON()}});null===(t=o.showWidget)||void 0===t||t.call(o,n)},onMouseOver:function(){return y(H)},onMouseOut:function(){return y(void 0)}},H))},s=0;s<e.length-1;s+=1){var c=r(s);if("object"===typeof c)return c.v}return t}))}):(console.warn("Unable to read assembly"),null)}));var D=(0,b.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=(0,m.getSession)(t),o=i.assemblyManager,c=t.getTrackFeatures(n),u=(0,s.useMemo)((function(){return t.getMatchedFeaturesInLayout(n,function(e){var t,n={},r=new Set,a=(0,C.Z)(e.values());try{var i=function(){var e=t.value;if(!r.has(e.id())&&"breakend"===e.get("type")){var a=e.get("ALT");null===a||void 0===a||a.forEach((function(t){var r="".concat(e.get("refName"),":").concat(e.get("start")+1),a=(0,y.I)(t);a&&(n[r]?n[r].push(e):n[a.MatePosition]=[e])}))}r.add(e.id())};for(a.s();!(t=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return Object.values(n).filter((function(e){return e.length>1}))}(c))}),[c,n,t]),l=(0,s.useState)(),d=(0,w.Z)(l,2),p=d[0],h=d[1],g=(0,f.getSnapshot)(t);A(g);var v=o.get(a[0].assemblyNames[0]);if(!v)return null;var b=0;if(r.current){var x=r.current.getBoundingClientRect();b=x.top}return(0,N.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":u.length?"".concat(n,"-loaded"):n,children:u.map((function(e){for(var t=[],r=function(r){var o=e[r],s=o.layout,u=o.feature,l=o.level,d=e[r+1],f=d.layout,g=d.feature,m=d.level,x=u.id(),w=function(e,t){var n=e.get("ALT");if(n)return Object.fromEntries(null===n||void 0===n?void 0:n.map((function(e){return(0,y.I)(e)})).filter((function(e){return!!e})).map((function(e){return[e.MatePosition,e]})))["".concat(t.get("refName"),":").concat(t.get("start")+1)]}(u,g);if(!s||!f)return{v:null};var k=u.get("refName"),C=g.get("refName"),Z=v.getCanonicalRefName(k),T=v.getCanonicalRefName(C);if(!Z||!T)throw new Error("unable to find ref for ".concat(Z||T));var P=M(a[l],Z,s[0]),R=M(a[m],T,f[0]),A=a[l].pxToBp(P).reversed,L=a[m].pxToBp(R).reversed,F=a.map((function(e){return e.getTrack(n)})),I=j(n,l,a,F,s)-b,B=j(n,m,a,F,f)-b;if(w){var D=S()().moveTo(P-20*("left"===w.Join?-1:1)*(A?-1:1),I).lineTo(P,I).lineTo(R,B).lineTo(R-20*("left"===w.MateDirection?1:-1)*(L?-1:1),B).end();t.push((0,N.jsx)("path",{d:D,strokeWidth:x===p?10:5,onClick:function(){var e,t,n=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:c.get(x)});null===(t=i.showWidget)||void 0===t||t.call(i,n)},onMouseOver:function(){return h(x)},onMouseOut:function(){return h(void 0)}},JSON.stringify(D)))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1){var s=r(o);if("object"===typeof s)return s.v}return t}))})})),E=n(32343),V=n(18229),O=n(80676),z=n(40791),W=n(54129),H=n(77977),q=n(8623),U=(0,x.Z)((function(e){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1}}})),_=(0,b.observer)((function(e){var t=e.model;return(0,N.jsx)(E.Z,{onClick:function(){return t.toggleInteract()},title:"Toggle interacting with the overlay",children:t.interactToggled?(0,N.jsx)(V.Z,{}):(0,N.jsx)(O.Z,{})})})),G=(0,b.observer)((function(e){var t=e.model;return(0,N.jsx)(E.Z,{onClick:function(){return t.toggleLinkViews()},title:"Toggle linked scrolls and behavior across views",children:t.linkViews?(0,N.jsx)(H.Z,{color:"secondary"}):(0,N.jsx)(q.Z,{color:"secondary"})})})),J=(0,b.observer)((function(e){var t=e.model;return(0,N.jsx)(E.Z,{onClick:t.toggleIntraviewLinks,title:"Toggle rendering intraview links",children:t.showIntraviewLinks?(0,N.jsx)(z.Z,{color:"secondary"}):(0,N.jsx)(W.Z,{color:"secondary"})})})),X=(0,b.observer)((function(e){var t=e.model,n=U();return(0,N.jsxs)("div",{className:n.headerBar,children:[(0,N.jsx)(G,{model:t}),(0,N.jsx)(_,{model:t}),(0,N.jsx)(J,{model:t}),(0,N.jsx)("div",{className:n.spacer})]})}));var Y=(0,b.observer)((function(e){var t=e.model,n=e.trackId,r=e.parentRef,a=t.views,i=(0,m.getSession)(t),o=i.assemblyManager,c=t.getTrackFeatures(n),u=(0,s.useMemo)((function(){return t.getMatchedFeaturesInLayout(n,function(e){var t,n=[],r=new Set,a=(0,C.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value;r.has(i.id())||"<TRA>"===i.get("ALT")[0]&&n.push([i]),r.add(i.id())}}catch(o){a.e(o)}finally{a.f()}return n}(c))}),[c,n,t]),l=(0,s.useState)(),d=(0,w.Z)(l,2),p=d[0],h=d[1],g=(0,f.getSnapshot)(t);if(A(g),!o.get(a[0].assemblyNames[0]))return console.warn("Unable to read assembly"),null;var v=0;if(r.current){var y=r.current.getBoundingClientRect();v=y.top}return a.length<2?null:(0,N.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":u.length?"".concat(n,"-loaded"):n,children:u.map((function(e){for(var t=[],r=function(r){var o=e[r],s=o.layout,u=o.feature,l=o.level,d=0===l?1:0,f=u.id();if(!s)return{v:null};var g=u.get("INFO"),m=g.CHR2[0],y=g.END[0],b=g.STRANDS[0].split(""),x=(0,w.Z)(b,2),k=x[0],C=x[1],Z=M(a[d],m,y);if(Z){var T=[Z,0,Z+1,0],P=M(a[l],u.get("refName"),s[0]),R=Z,A=a[l].pxToBp(P).reversed,L=a[d].pxToBp(R).reversed,F=a.map((function(e){return e.getTrack(n)})),I=j(n,l,a,F,s)-v,B=j(n,d,a,F,T)-v,D=S()().moveTo(P-20*("+"===k?1:-1)*(A?-1:1),I).lineTo(P,I).lineTo(R,B).lineTo(R-20*("+"===C?1:-1)*(L?-1:1),B).end();t.push((0,N.jsx)("path",{d:D,strokeWidth:f===p?10:5,onClick:function(){var e,t,n=null===(e=i.addWidget)||void 0===e?void 0:e.call(i,"VariantFeatureWidget","variantFeature",{featureData:(c.get(f)||{toJSON:function(){}}).toJSON()});null===(t=i.showWidget)||void 0===t||t.call(i,n)},onMouseOver:function(){return h(f)},onMouseOut:function(){return h(void 0)}},JSON.stringify(D)))}},o=0;o<e.length;o+=1){var s=r(o);if("object"===typeof s)return s.v}return t}))})})),Q=(0,x.Z)((function(e){return{root:{position:"relative",marginBottom:e.spacing(1),overflow:"hidden"},breakpointMarker:{position:"absolute",top:0,height:"100%",width:3,background:"magenta"},viewDivider:{background:e.palette.secondary.main,height:3},container:{display:"grid"},overlay:{display:"flex",width:"100%",gridArea:"1/1","& path":{cursor:"crosshair",fill:"none"}},content:{gridArea:"1/1"}}})),$=(0,b.observer)((function(e){var t,n,r,a=e.model,i=e.trackId,o=a.getMatchedTracks(i);return"PileupTrack"===(null===(t=o[0])||void 0===t?void 0:t.type)||"AlignmentsTrack"===(null===(n=o[0])||void 0===n?void 0:n.type)?(0,N.jsx)(B,(0,g.Z)({},e)):"VariantTrack"===(null===(r=o[0])||void 0===r?void 0:r.type)?a.hasTranslocations(i)?(0,N.jsx)(Y,(0,g.Z)({},e)):(0,N.jsx)(D,(0,g.Z)({},e)):null})),K=(0,b.observer)((function(e){var t=e.model,n=Q(),r=t.views,a=(0,f.getEnv)(t).pluginManager,i=(0,s.useRef)(null);return(0,N.jsxs)("div",{children:[(0,N.jsx)(X,{model:t}),(0,N.jsxs)("div",{className:n.container,children:[(0,N.jsx)("div",{className:n.content,children:(0,N.jsx)("div",{style:{position:"relative"},children:r.map((function(e,t){var i=a.getViewType(e.type).ReactComponent,o=(0,N.jsx)(i,{model:e},e.id);return t===r.length-1?o:[o,(0,N.jsx)("div",{className:n.viewDivider},"".concat(e.id,"-divider"))]}))})}),(0,N.jsx)("div",{className:n.overlay,children:(0,N.jsx)("svg",{ref:i,style:{width:"100%",zIndex:10,pointerEvents:t.interactToggled?void 0:"none"},children:t.matchedTracks.map((function(e){return(0,N.jsx)($,{parentRef:i,model:t,trackId:e.configuration.trackId},e.configuration.trackId)}))})})]})]})})),ee=K,te=n(34795),ne=n(77162),re=n.n(ne),ae=n(59853),ie=n(35247);function oe(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=n.map((function(t){return e(t)})),a=t.filter((function(t){return r.includes(e(t))})),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return 0===o.length?a:oe.apply(void 0,[e,a].concat(o))}function se(e,t){return ce.apply(this,arguments)}function ce(){return ce=(0,te.Z)(re().mark((function e(t,n){var r,a,i,o,s,c;return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.views,a=(0,m.getSession)(t),i=a.rpcManager,o=a.assemblyManager,s=t.views[0].assemblyNames[0],e.next=5,o.waitForAssembly(s);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",void 0);case 8:return c=n.configuration.trackId,e.abrupt("return",Promise.all(r.map(function(){var e=(0,te.Z)(re().mark((function e(t){return re().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.call(c,"CoreGetFeatures",{adapterConfig:(0,l.getConf)(n,["adapter"]),sessionId:c,regions:t.staticBlocks.contentBlocks});case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 10:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function ue(e){var t=f.types.model("BreakpointSplitView",{type:f.types.literal("BreakpointSplitView"),height:f.types.optional(f.types.refinement("viewHeight",f.types.number,(function(e){return e>=40})),400),trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,views:f.types.array(e.getViewType("LinearGenomeView").stateModel)}).volatile((function(){return{width:800,matchedTrackFeatures:{}}})).views((function(e){return{get matchedTracks(){return oe.apply(void 0,[function(e){return e.configuration.trackId}].concat((0,k.Z)(e.views.map((function(e){return e.tracks})))))},menuItems:function(){e.views.map((function(e,t){var n;return[t,null===(n=e.menuItems)||void 0===n?void 0:n.call(e)]})).filter((function(e){return!!e[1]})).map((function(e){return{label:"View ".concat(e[0]," Menu"),subMenu:e[1]}}))},getMatchedTracks:function(t){return e.views.map((function(e){return e.getTrack(t)})).filter((function(e){return!!e}))},hasTranslocations:function(e){return(0,k.Z)(this.getTrackFeatures(e).values()).find((function(e){return"translocation"===e.get("type")}))},getTrackFeatures:function(t){var n;return new Map(null===(n=e.matchedTrackFeatures[t])||void 0===n?void 0:n.flat().map((function(e){return[e.id(),e]})))},getMatchedFeaturesInLayout:function(e,t){var n=this.getMatchedTracks(e),r=function(e,t){return e.displays[0].searchFeatureByID(t.id())};return t.map((function(e){return e.map((function(e){var t=n.findIndex((function(t){return r(t,e)}));if(-1!==t){var a=r(n[t],e);return{feature:e,layout:a,level:t}}})).filter((function(e){return!!e}))}))}}})).actions((function(e){return{afterAttach:function(){var t=this;(0,f.addDisposer)(e,(0,f.onAction)(e,(function(n){var r=n.name,a=n.path,i=n.args;if(e.linkViews){["horizontalScroll","zoomTo","setScaleFactor","showTrack","toggleTrack","hideTrack","setTrackLabels","toggleCenterLine"].includes(r)&&a&&t.onSubviewAction(r,a,i)}})))},onSubviewAction:function(t,n,r){e.views.forEach((function(e){var a=(0,f.getPath)(e);a.lastIndexOf(n)!==a.length-n.length&&e[t](null===r||void 0===r?void 0:r[0])}))},setWidth:function(t){e.width=t,e.views.forEach((function(e){return e.setWidth(t)}))},removeView:function(t){e.views.remove(t)},closeView:function(){(0,f.getParent)(e,2).removeView(e)},toggleInteract:function(){e.interactToggled=!e.interactToggled},toggleIntraviewLinks:function(){e.showIntraviewLinks=!e.showIntraviewLinks},toggleLinkViews:function(){e.linkViews=!e.linkViews},setMatchedTrackFeatures:function(t){e.matchedTrackFeatures=t}}})).actions((function(e){return{afterAttach:function(){(0,f.addDisposer)(e,(0,ie.autorun)((0,te.Z)(re().mark((function t(){var n;return re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Object,t.next=3,Promise.all(e.matchedTracks.map(function(){var t=(0,te.Z)(re().mark((function t(n){return re().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=n.configuration.trackId,t.next=3,se(e,n);case 3:return t.t1=t.sent,t.abrupt("return",[t.t0,t.t1]);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:t.t1=t.sent,n=t.t0.fromEntries.call(t.t0,t.t1),e.setMatchedTrackFeatures(n);case 6:case"end":return t.stop()}}),t)})))))}}}));return{stateModel:f.types.compose(ae.BaseViewModel,t)}}var le=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"snapshotFromBreakendFeature",value:function(e,t){var n,r,a=null===(n=e.get("ALT"))||void 0===n?void 0:n[0],i=a?(0,y.I)(a):void 0,o=e.get("start"),s=t.displayedRegions[0].assemblyName,c=(0,m.getSession)(t).assemblyManager.get(s);if(!c)throw new Error("assembly ".concat(s," not found"));if(!c.regions)throw new Error("assembly ".concat(s," regions not loaded"));var u,l=c.getCanonicalRefName,d=l(e.get("refName")),f=c.regions.find((function(e){return e.refName===d})),p=0,h=0;if("<TRA>"===a){var v=e.get("INFO");r=v.END[0]-1,u=l(v.CHR2[0])}else if(i){var b=i.MatePosition.split(":");r=+b[1]-1,u=l(b[0]),"left"===i.Join&&(p=-1),"left"===i.MateDirection&&(h=-1)}else if(e.get("mate")){var x=e.get("mate");u=l(x.refName),r=x.start}if(!u)return console.warn("unable to resolve mate refName ".concat(u," in reference genome")),{};var w=c.regions.find((function(e){return e.refName===u}));if(!f||!w)return console.warn("unable to find the refName for the top or bottom of the breakpoint view"),{};var k=[(0,g.Z)({},f),(0,g.Z)({},f)],C=[(0,g.Z)({},w),(0,g.Z)({},w)];return k[0].end=o+p,k[1].start=o+p,C[0].end=r+h,C[1].start=r+h,{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:k,hideHeader:!0,bpPerPx:10,offsetPx:(f.start+e.get("start"))/10},{type:"LinearGenomeView",displayedRegions:C,hideHeader:!0,bpPerPx:10,offsetPx:(w.start+r)/10}],displayName:"".concat(e.get("name")||e.get("id")||"breakend"," split detail")}}}]),n}(v.Z),de=function(e){var t=(0,e.load)(ue).stateModel;return new le({name:"BreakpointSplitView",stateModel:t,ReactComponent:ee})},fe=function(e){(0,i.Z)(u,e);var t=(0,o.Z)(u);function u(){var e;(0,r.Z)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="BreakpointSplitViewPlugin",e}return(0,a.Z)(u,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(de)})),e.addWidgetType((function(){return new c.Z({name:"BreakpointAlignmentsWidget",heading:"Breakpoint feature details",configSchema:p,stateModel:h,ReactComponent:(0,s.lazy)((function(){return n.e(6618).then(n.bind(n,46618))}))})}))}},{key:"configure",value:function(){}}]),u}(u.Z)},35681:function(e,t,n){"use strict";n.d(t,{H8:function(){return F},pL:function(){return z},_U:function(){return W},ZP:function(){return H}});var r=n(34795),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(77162),u=n.n(c),l=n(30969),d=n(35247),f=n(81073),p=n(49767),h=n(39798),g=n(45067),m=n(33028),v=n(41361),y=n(40909),b=n(29206),x=n(9077),w=n(59853),k=n(96234);function C(e,t,n,r,a){var i=Math.abs(e-n);if(!(i>r)){i===r&&a.push([t,e]);var o=Math.sqrt(r*r-i*i);a.push([t-o,e]),a.push([t+o,e])}}function Z(e,t,n,r,a){var i=Math.abs(e-t);if(!(i>r)){i===r&&a.push([e,n]);var o=Math.sqrt(r*r-i*i);a.push([e,n-o]),a.push([e,n+o])}}function S(e,t){var n=Math.sqrt(e*e+t*t);if(0===n)return[0,0];var r=function(e,t){var n=(Math.atan(t/e)+2*Math.PI)%(2*Math.PI);return e<0&&(t<=0?n+=Math.PI:n-=Math.PI),n}(e,t);return[n,r]}var T=2*Math.PI;var P=function(){function e(t,n,r,i){(0,a.Z)(this,e),this.region=n,this.radianWidth=i,this.key=void 0,this.offsetRadians=void 0,this.startRadians=void 0,this.endRadians=void 0,this.bpPerRadian=void 0,this.flipped=void 0;var o=t.bpPerRadian;this.key=(0,f.assembleLocString)(n),this.offsetRadians=r,this.bpPerRadian=o,this.flipped=!1,this.startRadians=this.offsetRadians,this.endRadians=n.widthBp/this.bpPerRadian+this.offsetRadians,Object.freeze(this)}return(0,i.Z)(e,[{key:"bpToXY",value:function(e,t){var n=(this.region.elided?this.region.widthBp/2:this.flipped?this.region.end-e:e-this.region.start)/this.bpPerRadian+this.offsetRadians;return(0,f.polarToCartesian)(t,n)}},{key:"toJSON",value:function(){return(0,f.objectFromEntries)(Object.entries(this))}}]),e}();function R(e,t){var n,r,a,i,o=(0,k.Z)(e.visibleSection.theta,2),s=o[0],c=o[1];return n=t.offsetRadians+e.offsetRadians,r=t.radianWidth,a=s,i=c-s,!(r<=0||i<=0)&&(r+1e-4>=T||i+1e-4>=T||(n=(n%T+T)%T+T)<(a=(a%T+T)%T+T)+i&&n+r>a||n<(a-=T)+i&&n+r>a||n<(a+=T+T)+i&&n+r>a)}function M(e){return y.types.compose(w.BaseViewModel,y.types.model("CircularView",{type:y.types.literal("CircularView"),offsetRadians:-Math.PI/2,bpPerPx:2e6,tracks:y.types.array(e.pluggableMstType("track","stateModel")),hideVerticalResizeHandle:!1,hideTrackSelectorButton:!1,lockedFitToWindow:!0,disableImportForm:!1,height:y.types.optional(y.types.refinement("trackHeight",y.types.number,(function(e){return e>=40})),400),minimumRadiusPx:25,spacingPx:10,paddingPx:80,lockedPaddingPx:100,minVisibleWidth:6,minimumBlockWidth:20,displayedRegions:y.types.array(b.Region),scrollX:0,scrollY:0,trackSelectorType:"hierarchical"}).volatile((function(){return{width:0}})).views((function(e){return{get staticSlices(){return function(e){var t,n=[],r=0,a=(0,v.Z)(e.elidedRegions);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.widthBp/e.bpPerRadian+e.spacingPx/e.pxPerRadian;n.push(new P(e,i,r,o)),r+=o}}catch(s){a.e(s)}finally{a.f()}return n}(e)},get visibleStaticSlices(){return this.staticSlices.filter(R.bind(this,e))},get visibleSection(){return function(e,t,n){var r=(0,k.Z)(e,4),a=r[0],i=r[1],o=r[2],s=r[3],c=(0,k.Z)(t,2),u=c[0],l=c[1];if(i-=u,o-=l,s-=l,(a-=u)<0&&i>0&&o<0&&s>0){for(var d=[[a,o],[i,o],[a,s],[i,s]],f=-1/0,p=0;p<d.length;p+=1){var h=(0,k.Z)(d[p],2),g=h[0],m=h[1],v=Math.sqrt(g*g+m*m);v>f&&(f=v)}return{rho:[0,Math.min(n,f)],theta:[0,2*Math.PI]}}var y=[[a,o],[i,o],[a,s],[i,s]];Z(a,0,0,n,y),Z(i,0,0,n,y),C(o,0,0,n,y),C(s,0,0,n,y),-a<n&&y.push([a,0]),i<n&&y.push([i,0]),-o<n&&y.push([0,o]),s<n&&y.push([0,s]);for(var b=a>=0?-1:1,x=1/0,w=-1/0,T=1/0,P=-1/0,R=0;R<y.length;R+=1){var M=(0,k.Z)(y[R],2),j=M[0],A=M[1];if(j>=a&&j<=i&&A>=o&&A<=s){var N=S(j*b,A*b),L=(0,k.Z)(N,2),F=L[0],I=L[1];F<=n+.001&&(I<T&&F>1e-4&&(T=I),I>P&&F>1e-4&&(P=I),F<x&&(x=F),F>w&&(w=F))}}return-1===b&&(T+=Math.PI,P+=Math.PI),T>2*Math.PI&&P>2*Math.PI&&(T-=2*Math.PI,P-=2*Math.PI),{rho:[x,Math.min(n,w)],theta:[T,P]}}([e.scrollX,e.scrollX+e.width,e.scrollY,e.scrollY+e.height],this.centerXY,this.radiusPx)},get circumferencePx(){var t,n=0,r=(0,v.Z)(this.elidedRegions);try{for(r.s();!(t=r.n()).done;){n+=t.value.widthBp}}catch(a){r.e(a)}finally{r.f()}return n/e.bpPerPx+e.spacingPx*this.elidedRegions.length},get radiusPx(){return this.circumferencePx/(2*Math.PI)},get bpPerRadian(){return e.bpPerPx*this.radiusPx},get pxPerRadian(){return this.radiusPx},get centerXY(){return[this.radiusPx+e.paddingPx,this.radiusPx+e.paddingPx]},get totalBp(){var t,n=0,r=(0,v.Z)(e.displayedRegions);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=a.end-a.start}}catch(i){r.e(i)}finally{r.f()}return n},get maximumRadiusPx(){return e.lockedFitToWindow?Math.min(e.width,e.height)/2-e.lockedPaddingPx:1e6},get maxBpPerPx(){var t=2*Math.PI*e.minimumRadiusPx;return this.totalBp/t},get minBpPerPx(){var e=2*Math.PI*this.maximumRadiusPx;return(0,f.clamp)(this.totalBp/e,1e-10,this.maxBpPerPx)},get atMaxBpPerPx(){return e.bpPerPx>=this.maxBpPerPx},get atMinBpPerPx(){return e.bpPerPx<=this.minBpPerPx},get tooSmallToLock(){return this.minBpPerPx<=1e-10},get figureDimensions(){return[2*this.radiusPx+2*e.paddingPx,2*this.radiusPx+2*e.paddingPx]},get figureWidth(){return this.figureDimensions[0]},get figureHeight(){return this.figureDimensions[1]},get elidedRegions(){var t=[];e.displayedRegions.forEach((function(n){var r=n.end-n.start;if(r/e.bpPerPx<e.minVisibleWidth){var a=t[t.length-1];a&&a.elided?(a.regions.push((0,m.Z)({},n)),a.widthBp+=r):t.push({elided:!0,widthBp:r,regions:[(0,m.Z)({},n)]})}else t.push((0,m.Z)((0,m.Z)({},n),{},{widthBp:r}))}));for(var n=0;n<t.length;n+=1){var r=t[n];r.elided&&1===r.regions.length&&(delete r.elided,t[n]=(0,m.Z)((0,m.Z)({},r),r.regions[0]))}return t},get assemblyNames(){var t=[];return e.displayedRegions.forEach((function(e){t.includes(e.assemblyName)||t.push(e.assemblyName)})),t},get initialized(){var t=(0,f.getSession)(e).assemblyManager;return this.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))}}})).volatile((function(){return{error:void 0}})).actions((function(t){return{setWidth:function(e){return t.width=Math.max(e,100),t.width},setHeight:function(e){return t.height=Math.max(e,40),t.height},resizeHeight:function(e){var n=t.height,r=this.setHeight(t.height+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},resizeWidth:function(e){var n=t.width,r=this.setWidth(t.width+e);return this.setModelViewWhenAdjust(!t.tooSmallToLock),r-n},rotateClockwiseButton:function(){this.rotateClockwise(Math.PI/6)},rotateCounterClockwiseButton:function(){this.rotateCounterClockwise(Math.PI/6)},rotateClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians+=e},rotateCounterClockwise:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;t.offsetRadians-=e},zoomInButton:function(){this.setBpPerPx(t.bpPerPx/1.4)},zoomOutButton:function(){this.setBpPerPx(1.4*t.bpPerPx)},setBpPerPx:function(e){t.bpPerPx=(0,f.clamp)(e,t.minBpPerPx,t.maxBpPerPx)},setModelViewWhenAdjust:function(e){t.lockedFitToWindow&&e&&this.setBpPerPx(t.minBpPerPx)},closeView:function(){(0,y.getParent)(t,2).removeView(t)},setDisplayedRegions:function(e){var n=0===t.displayedRegions.length;t.displayedRegions=(0,y.cast)(e),n?this.setBpPerPx(t.minBpPerPx):this.setBpPerPx(t.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=(0,f.getSession)(t);if((0,f.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setError:function(e){console.error(e),t.error=e},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=(0,y.resolveIdentifier)(a,(0,y.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=e.getViewType(t.type),c=s.displayTypes.map((function(e){return e.name})),u=i.displays.find((function(e){return c.includes(e.type)})),l=o.stateModel.create((0,m.Z)((0,m.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},addTrackConf:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n.type,i=(0,x.readConfObject)(n,"name"),o=e.getTrackType(a);if(!o)throw new Error("unknown track type ".concat(n.type));var s=e.getViewType(t.type),c=s.displayTypes.map((function(e){return e.name})),u=n.displays.find((function(e){return c.includes(e.type)})),l=o.stateModel.create((0,m.Z)((0,m.Z)({},r),{},{name:i,type:a,configuration:n,displays:[{type:u.type,configuration:u}]}));t.tracks.push(l)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,y.resolveIdentifier)(r,(0,y.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,d.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},toggleFitToWindowLock:function(){return t.lockedFitToWindow=!t.lockedFitToWindow,this.setModelViewWhenAdjust(t.atMinBpPerPx),t.lockedFitToWindow}}})))}var j=n(37574),A=function(e){var t=e.lib,n=t.react,r=n.useState,a=n.useEffect,i=t["@material-ui/core/styles"].makeStyles,o=t["mobx-react"].observer,s=i((function(e){return{path:{strokeDasharray:187,strokeDashoffset:50,animation:"$dash ".concat(1.4,"s ease-in-out infinite, $colors ").concat(5.6,"s ease-in-out infinite")},"@keyframes colors":{"0%":{stroke:e.palette.primary.light},"25%":{stroke:e.palette.secondary.light},"50%":{stroke:e.palette.tertiary.light},"75%":{stroke:e.palette.quaternary.light},"100%":{stroke:e.palette.primary.light}},"@keyframes dash":{"0%":{strokeDashoffset:2},"50%":{strokeDashoffset:.5,transform:"rotate(135deg)"},"100%":{strokeDashoffset:2,transform:"rotate(720deg)"}}}}));return o((function(e){var t=e.model.renderProps.radius,n=s(),i=r(!1),o=(0,k.Z)(i,2),c=o[0],u=o[1];return a((function(){var e=setTimeout((function(){return u(!0)}),400);return function(){return clearTimeout(e)}})),c?(0,j.jsxs)("g",{children:[(0,j.jsx)("defs",{children:(0,j.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,j.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,255,255,0.5)",strokeWidth:10}})})}),(0,j.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"#f1f1f1"}),(0,j.jsx)("circle",{cx:"0",cy:"0",r:t,fill:"url(#diagonalHatch)"}),(0,j.jsx)("text",{x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:"Loading\u2026"}),(0,j.jsx)("circle",{className:n.path,fill:"none",strokeWidth:"4",strokeLinecap:"round",cx:"0",cy:"0",r:"60"})]}):null}))},N=function(e){var t=e.jbrequire,n=(t("react"),t("@material-ui/core/styles").makeStyles),r=t("mobx-react").observer,a=n({errorMessage:{},errorBackground:{},errorText:{}});return r((function(e){var t=e.model,n=t.renderProps.radius,r=t.error,i=a();return(0,j.jsxs)("g",{className:i.errorMessage,children:[(0,j.jsx)("defs",{children:(0,j.jsx)("pattern",{id:"diagonalHatch",width:"10",height:"10",patternTransform:"rotate(45 0 0)",patternUnits:"userSpaceOnUse",children:(0,j.jsx)("line",{x1:"0",y1:"0",x2:"0",y2:"10",style:{stroke:"rgba(255,0,0,0.5)",strokeWidth:10}})})}),(0,j.jsx)("circle",{className:i.errorBackground,cx:"0",cy:"0",r:n,fill:"#ffb4b4"}),(0,j.jsx)("circle",{className:i.errorPattern,cx:"0",cy:"0",r:n,fill:"url(#diagonalHatch)"}),(0,j.jsx)("text",{className:i.errorText,x:"0",y:"0",transform:"rotate(90 0 0)",dominantBaseline:"middle",textAnchor:"middle",children:String(r)})]})}))},L=function(e){var t=e.jbrequire,n=t("react"),r=t("mobx-state-tree").isAlive,a=n.useEffect,i=n.useRef,o=t("mobx-react"),s=o.observer,c=(o.PropTypes,t("react-dom")),u=c.unmountComponentAtNode,l=c.hydrate,d=t("@jbrowse/core/util").rIC;return s((function(e){var t=e.model,o=t.data,s=t.html,c=t.filled,f=t.renderingComponent,p=i(null);return a((function(){var e=p.current;return e&&c&&(e&&e.innerHTML&&(e.style.display="none",u(e)),e.style.outline="none",e.innerHTML=s,d((function(){if(r(t)){var a=n.createElement(f,(0,m.Z)((0,m.Z)({},o),t.renderProps()),null);d((function(){r(t)&&l(a,e)}))}}))),function(){e&&u(e)}})),(0,j.jsx)("g",{ref:p})}))},F=function(e){var t=e.lib,n=e.load,r=(t.react,t["mobx-react"]),a=r.observer,i=(r.PropTypes,n(A)),o=n(N),s=n(L);return a((function(e){var t=e.display;return t.error?(0,j.jsx)(o,{model:t}):t.filled?(0,j.jsx)(s,{model:t}):(0,j.jsx)(i,{model:t})}))},I=n(54215),B=n(14956),D=n(97891),E=n(59740),V=["html"],O=function(e){var t=e.jbrequire,n=t("@jbrowse/core/util/tracks").getRpcSessionId,a=t("@jbrowse/core/util").getContainingView,i=t("@jbrowse/core/util").getSession;function o(){return(o=(0,r.Z)(u().mark((function e(t,n,r){var a,i,o,s,c,l,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:if(a=t.rendererType,i=t.rpcManager,o=t.cannotBeRenderedReason,s=t.renderArgs,c=t.renderProps,!o){e.next=5;break}return e.abrupt("return",{message:o});case 5:if(t.renderProps.radius&&t.renderArgs.regions&&t.renderArgs.regions.length){e.next=7;break}return e.abrupt("return",{message:"Skipping render"});case 7:if(r.isCompatibleWithRenderer(a)){e.next=9;break}throw new Error("renderer ".concat(a.name," is not compatible with this display type"));case 9:return e.next=11,a.renderInClient(i,(0,m.Z)((0,m.Z)((0,m.Z)({},s),c),{},{signal:n}));case 11:return l=e.sent,d=l.html,f=(0,E.Z)(l,V),e.abrupt("return",{html:d,data:f,renderingComponent:a.ReactComponent});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{renderReactionData:function(e){var t,r=a(e),o=e.rendererType;return{rendererType:o,rpcManager:i(r).rpcManager,renderProps:e.renderProps(),renderArgs:{assemblyName:null===(t=r.displayedRegions[0])||void 0===t?void 0:t.assemblyName,adapterConfig:JSON.parse(JSON.stringify(e.adapterConfig)),rendererType:o.name,regions:JSON.parse(JSON.stringify(r.displayedRegions)),blockDefinitions:e.blockDefinitions,sessionId:n(e),timeout:1e6}}},renderReactionEffect:function(e,t,n){return o.apply(this,arguments)}}},z=y.types.compose("BaseChordDisplay",w.BaseDisplay,y.types.model({bezierRadiusRatio:.1,assemblyName:y.types.maybe(y.types.string)})).volatile((function(){return{filled:!1,reactElement:void 0,data:void 0,message:"",renderingComponent:void 0,refNameMap:void 0}})).actions((function(e){var t=(0,y.getEnv)(e).pluginManager,n=e;return{onChordClick:function(r){(0,x.getConf)(e,"onChordClick",{feature:r,track:n,pluginManager:t})}}})).views((function(e){return{get blockDefinitions(){var t=(0,f.getContainingView)(e).staticSlices;if(!e.refNameMap)return t;var n=JSON.parse(JSON.stringify(t));return n.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(t){var n,r=null===(n=e.refNameMap)||void 0===n?void 0:n[t.refName];r&&t.refName!==r&&(t.refName=r)}))})),n},renderProps:function(){var t=(0,f.getContainingView)(e);return(0,m.Z)((0,m.Z)({},(0,D.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,onChordClick:e.onChordClick})},get rendererType(){var t=e,n=(0,y.getEnv)(e).pluginManager.getRendererType(e.rendererTypeName);if(!n)throw new Error('renderer "'.concat(t.rendererTypeName,'" not found'));if(!n.ReactComponent)throw new Error("renderer ".concat(t.rendererTypeName," has no ReactComponent, it may not be completely implemented yet"));return n},isCompatibleWithRenderer:function(e){return!!(e instanceof I.Z)},get selectedFeatureId(){if((0,y.isAlive)(e)){var t=(0,f.getSession)(e);if(t){var n=t.selection;return(0,B.T)(n)?n.id():void 0}}}}})).actions((function(e){return{renderStarted:function(){e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0},renderSuccess:function(t){var n=t.message,r=t.data,a=t.reactElement,i=t.renderingComponent;n?(e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0):(e.filled=!0,e.message="",e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i)},renderError:function(t){console.error(t),e.filled=!1,e.message="",e.reactElement=void 0,e.data=void 0,e.error=t,e.renderingComponent=void 0},setRefNameMap:function(t){e.refNameMap=t}}})).actions((function(e){var t=(0,y.getEnv)(e).pluginManager.jbrequire(O),n=t.renderReactionData,a=t.renderReactionEffect;return{afterAttach:function(){(0,f.makeAbortableReaction)(e,n,a,{name:"".concat(e.type," ").concat(e.id," rendering"),fireImmediately:!0},e.renderStarted,e.renderSuccess,e.renderError),(0,f.makeAbortableReaction)(e,(function(){return{assemblyNames:(0,D.getTrackAssemblyNames)(e.parentTrack),adapter:(0,x.getConf)((0,y.getParent)(e,2),"adapter"),assemblyManager:(0,f.getSession)(e).assemblyManager}}),function(){var t=(0,r.Z)(u().mark((function t(n,r){var a,i,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.assemblyNames,i=n.adapter,o=n.assemblyManager,t.abrupt("return",o.getRefNameMapForAdapter(i,a[0],{signal:r,sessionId:(0,D.getRpcSessionId)(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),{name:"".concat(e.type," ").concat(e.id," getting refNames"),fireImmediately:!0},(function(){}),(function(t){e.setRefNameMap(t)}),(function(t){console.error(t),e.setError(t)}))}}})),W=(0,x.ConfigurationSchema)("BaseChordDisplay",{onChordClick:{type:"boolean",description:"callback that should be run when a chord in the track is clicked",defaultValue:!1,contextVariable:["feature","track","pluginManager"]}},{explicitIdentifier:"displayId"}),H=function(e){(0,o.Z)(c,e);var t=(0,s.Z)(c);function c(){var e;(0,a.Z)(this,c);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="CircularViewPlugin",e}return(0,i.Z)(c,[{key:"install",value:function(e){e.addViewType((function(){return new h.Z({ReactComponent:(0,l.lazy)((function(){return n.e(9135).then(n.bind(n,49135))})),stateModel:M(e),name:"CircularView"})})),e.addToExtensionPoint("LaunchView-CircularView",function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a,i,o,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,t.loc,a=t.tracks,i=void 0===a?[]:a,o=n.assemblyManager,s=n.addView("CircularView",{}),e.next=5,(0,d.when)((function(){return s.initialized}));case 5:if(r){e.next=7;break}throw new Error("No assembly provided when launching circular genome view");case 7:return e.next=9,o.waitForAssembly(r);case 9:if(c=e.sent){e.next=12;break}throw new Error('Assembly "'.concat(r,'" not found when launching circular genome view'));case 12:s.setDisplayedRegions(c.regions||[]),i.forEach((function(e){return s.showTrack(e)}));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"configure",value:function(e){(0,f.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Circular view",icon:g.Z,onClick:function(e){e.addView("CircularView",{})}})}}]),c}(p.Z)},26742:function(e,t,n){"use strict";n.d(t,{Z:function(){return G}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(49767),c=n(93029),u=n(33028),l=n(46840),d=n(34795),f=n(77162),p=n.n(f),h=n(29598),g=n(37654),m=n(33528),v=n(26131),y=n(14956),b=n(42098);function x(e){return 31===e[0]&&139===e[1]&&8===e[2]}var w=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).setupP=void 0,e}return(0,a.Z)(n,[{key:"setup",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.openLocation)(this.getConf("pafLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!x(r=e.sent)){e.next=10;break}return e.next=7,(0,b.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return i=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",i.split("\n").filter((function(e){return!!e})).map((function(e){var t=e.split("\t"),n=(0,l.Z)(t),r=n[0],a=n[2],i=n[3],o=n[4],s=n[5],c=n[7],d=n[8],f=n[9],p=n[10],h=n[11],g=n.slice(12),m=Object.fromEntries(g.map((function(e){var t=e.indexOf(":");return[e.slice(0,t),e.slice(t+3)]})));return{tname:s,tstart:+c,tend:+d,qname:r,qstart:+a,qend:+i,strand:"-"===o?-1:1,extra:(0,u.Z)({numMatches:+f,blockLen:+p,mappingQual:+h},m)}})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=(0,d.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyNames",value:function(){var e=this.getConf("assemblyNames");0===e.length&&(e=[this.getConf("queryAssembly"),this.getConf("targetAssembly")]);return e}},{key:"getRefNames",value:function(){var e=(0,d.Z)(p().mark((function e(){var t,n,r,a,i,o,s,c,u=arguments;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>0&&void 0!==u[0]?u[0]:{},r=null===(t=n.regions)||void 0===t?void 0:t[0].assemblyName,e.next=4,this.setup();case 4:if(a=e.sent,-1===(i=this.getAssemblyNames().indexOf(r))){e.next=10;break}for(o=new Set,s=0;s<a.length;s++)c=a[s],0===i?o.add(c.qname):o.add(c.tname);return e.abrupt("return",Array.from(o));case 10:return console.warn("Unable to do ref renaming on adapter"),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,v.ObservableCreate)(function(){var r=(0,d.Z)(p().mark((function r(a){var i,o,s,c,l,d,f,h,m,v,b,x,w,k;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:if(i=r.sent,o=t.getAssemblyNames(),s=e.assemblyName,-1!==(c=o.indexOf(s)))for(l=0;l<i.length;l++)d=i[l],f=0,h=0,m="",v="",b=0,x=0,0===c?(f=d.qstart,h=d.qend,m=d.qname,v=d.tname,b=d.tstart,x=d.tend):(f=d.tstart,h=d.tend,m=d.tname,v=d.qname,b=d.qstart,x=d.qend),w=d.extra,k=d.strand,m===e.refName&&(0,g.qY)(e.start,e.end,f,h)&&a.next(new y.Z((0,u.Z)({uniqueId:"".concat(l),start:f,end:h,refName:m,strand:k,assemblyName:s,syntenyId:l,mate:{start:b,end:x,refName:v}},w)));a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(h.BaseFeatureDataAdapter);w.capabilities=["getFeatures","getRefNames"];var k=n(9077),C=(0,k.ConfigurationSchema)("PAFAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},pafLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.paf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),Z=n(96234),S=n(81073);function T(e){return 31===e[0]&&139===e[1]&&8===e[2]}function P(e){return new Map(e.split("\n").filter((function(e){return!!e||e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=(0,Z.Z)(t,6),r=n[0],a=n[1],i=n[2],o=n[3];return[o,{refName:r,start:+a,end:+i,score:+n[4],name:o,strand:"-"===n[5]?-1:1}]})))}function R(e,t){return M.apply(this,arguments)}function M(){return(M=(0,d.Z)(p().mark((function e(t,n){var r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readFile(n);case 2:if(r=e.sent,e.t0=new TextDecoder("utf8",{fatal:!0}),!T(r)){e.next=10;break}return e.next=7,(0,b.unzip)(r);case 7:e.t1=e.sent,e.next=11;break;case 10:e.t1=r;case 11:return e.t2=e.t1,e.abrupt("return",e.t0.decode.call(e.t0,e.t2));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).setupP=void 0,e}return(0,a.Z)(n,[{key:"setup",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i,o,s,c,u,l,d,f,h,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConf("assemblyNames"),r=this.pluginManager,a=(0,m.openLocation)(this.getConf("bed1Location"),r),i=(0,m.openLocation)(this.getConf("bed2Location"),r),o=(0,m.openLocation)(this.getConf("mcscanAnchorsLocation"),r),e.next=7,Promise.all([a,i,o].map((function(e){return R(e,t)})));case 7:return s=e.sent,c=(0,Z.Z)(s,3),u=c[0],l=c[1],d=c[2],f=P(u),h=P(l),g=d.split("\n").filter((function(e){return!!e&&"###"!==e})).map((function(e,t){var n=e.split("\t"),r=(0,Z.Z)(n,3),a=r[0],i=r[1],o=r[2],s=f.get(a),c=h.get(i);if(!s||!c)throw new Error("feature not found, ".concat(a," ").concat(i," ").concat(s," ").concat(c));return[s,c,+o,t]})),e.abrupt("return",{assemblyNames:n,feats:g});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=(0,d.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,d.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,v.ObservableCreate)(function(){var r=(0,d.Z)(p().mark((function r(a){var i,o,s,c;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:i=r.sent,o=i.assemblyNames,s=i.feats,-1!==(c=o.indexOf(e.assemblyName))&&s.forEach((function(t){var n=(0,Z.Z)(t,4),r=n[0],i=n[1],o=n[2],s=n[3],l=1===c?[i,r]:[r,i],d=(0,Z.Z)(l,2),f=d[0],p=d[1];f.refName===e.refName&&(0,S.doesIntersect2)(e.start,e.end,f.start,f.end)&&a.next(new y.Z((0,u.Z)((0,u.Z)({},f),{},{uniqueId:"".concat(c,"-").concat(s),syntenyId:s,score:o,mate:p})))})),a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(h.BaseFeatureDataAdapter);j.capabilities=["getFeatures","getRefNames"];var A=(0,k.ConfigurationSchema)("MCScanAnchorsAdapter",{mcscanAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0}),N=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).setupP=void 0,e}return(0,a.Z)(n,[{key:"setup",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupP||(this.setupP=this.setupPre(t).catch((function(e){throw n.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i,o,s,c,u,l,d,f,h,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConf("assemblyNames"),r=this.pluginManager,a=(0,m.openLocation)(this.getConf("bed1Location"),r),i=(0,m.openLocation)(this.getConf("bed2Location"),r),o=(0,m.openLocation)(this.getConf("mcscanSimpleAnchorsLocation"),r),e.next=7,Promise.all([a,i,o].map((function(e){return R(e,t)})));case 7:return s=e.sent,c=(0,Z.Z)(s,3),u=c[0],l=c[1],d=c[2],f=P(u),h=P(l),g=d.split("\n").filter((function(e){return!!e&&"###"!==e})).map((function(e,t){var n=e.split("\t"),r=(0,Z.Z)(n,6),a=r[0],i=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=f.get(a),d=f.get(i),p=h.get(o),g=h.get(s);if(!l||!d||!p||!g)throw new Error("feature not found, ".concat(a," ").concat(i," ").concat(o," ").concat(s," ").concat(l," ").concat(d," ").concat(p," ").concat(g));return[l,d,p,g,+c,"-"===u?-1:1,t]})),e.abrupt("return",{assemblyNames:n,feats:g});case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasDataForRefName",value:function(){var e=(0,d.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNames",value:function(){var e=(0,d.Z)(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,v.ObservableCreate)(function(){var r=(0,d.Z)(p().mark((function r(a){var i,o,s,c;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.setup(n);case 2:i=r.sent,o=i.assemblyNames,s=i.feats,-1!==(c=o.indexOf(e.assemblyName))&&s.forEach((function(t){var n=(0,Z.Z)(t,7),r=n[0],i=n[1],o=n[2],s=n[3],l=n[4],d=n[5],f=n[6],p={refName:r.refName,start:Math.min(r.start,i.start),end:Math.max(r.end,i.end)},h={refName:o.refName,start:Math.min(o.start,s.start),end:Math.max(o.end,s.end)};if(1===c){var g=[p,h];h=g[0],p=g[1]}p.refName===e.refName&&(0,S.doesIntersect2)(p.start,p.end,e.start,e.end)&&a.next(new y.Z((0,u.Z)((0,u.Z)({},p),{},{uniqueId:"".concat(f),syntenyId:f,score:l,strand:d,mate:h})))})),a.complete();case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}]),n}(h.BaseFeatureDataAdapter);N.capabilities=["getFeatures","getRefNames"];var L=(0,k.ConfigurationSchema)("MCScanSimpleAnchorsAdapter",{mcscanSimpleAnchorsLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mcscan.anchors.simple",locationType:"UriLocation"}},bed1Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},bed2Location:{type:"fileLocation",defaultValue:{uri:"/path/to/file.bed",locationType:"UriLocation"}},assemblyNames:{type:"stringArray",defaultValue:[]}},{explicitlyTyped:!0});function F(e){return 31===e[0]&&139===e[1]&&8===e[2]}var I=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.openLocation)(this.getConf("outLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!F(r=e.sent)){e.next=10;break}return e.next=7,(0,b.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return i=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",i.split("\n").filter((function(e){return!!e})).map((function(e){var t=e.split(" ");if(t.length<9)throw new Error("improperly formatted line: "+e);var n=(0,Z.Z)(t,10),r=n[0],a=n[2],i=n[3],o=n[4];return{tname:n[5],tstart:+n[7],tend:+n[8],qname:r,qstart:+a,qend:+i,strand:"-"===o?-1:1,extra:{mappingQual:+n[9]}}})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(w),B=(0,k.ConfigurationSchema)("MashMapAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},outLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/mashmap.out",locationType:"UriLocation"}}},{explicitlyTyped:!0});function D(e){return 31===e[0]&&139===e[1]&&8===e[2]}function E(e){for(var t="",n="",r=0,a=0,i=0,o=0,s=0,c=0,u=[],l=0,d=0,f=!1,p=[],h=new RegExp(/^>(\S+)\s+(\S+)\s+(\d+)\s+(\d+)/),g=0;g<e.length;g++){var m=e[g],v=h.exec(m);if(null===v){if(f){var y=m.split(" ");if(7===y.length){var b=+y[0],x=+y[1],w=+y[2],k=+y[3];s=b<x&&w<k||b>x&&w>k?1:-1,i=+(b<x?b:x)-1,o=+(x>b?x:b),r=+(w<k?w:k)-1,a=+(k>w?k:w),l=d=0,c=+y[4],u=[]}else if(1===y.length){var C=+y[0];if(0===C){var Z=0,S=[];if(o-i-l!==a-r-d)throw new Error("inconsistent alignment on line ".concat(g));u.push(o-i-l<<4);for(var T=0;T<u.length;++T){var P=u[T]>>4;Z+=P,S.push(P+"MID".charAt(15&u[T]))}p.push({qname:n,qstart:r,qend:a,tname:t,tstart:i,tend:o,strand:s,extra:{numMatches:Z-c,blockLen:Z,mappingQual:0,NM:c,cg:S.join("")}})}else if(C>0){var R=C-1;l+=R+1,d+=R,R>0&&u.push(R<<4),u.length>0&&2===(15&u[u.length-1])?u[u.length-1]+=16:u.push(18)}else{var M=-C-1;l+=M,d+=M+1,M>0&&u.push(M<<4),u.length>0&&1===(15&u[u.length-1])?u[u.length-1]+=16:u.push(17)}}}}else t=v[1],n=v[2],f=!0}return p}var V=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.openLocation)(this.getConf("deltaLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!D(r=e.sent)){e.next=10;break}return e.next=7,(0,b.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return i=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",E(i.split("\n").filter((function(e){return!!e}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(w),O=(0,k.ConfigurationSchema)("DeltaAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Array of assembly names to use for this file. The target assembly name is the first value in the array, query assembly name is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the target assembly name"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames: the query assembly name"},deltaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.delta",locationType:"UriLocation"}}},{explicitlyTyped:!0});function z(e){return 31===e[0]&&139===e[1]&&8===e[2]}function W(e,t,n,r,a,i,o,s,c){return{qname:e,qstart:t,qend:n,tname:a,tstart:i,tend:o,strand:"-"===r?-1:1,extra:{numMatches:c,blockLen:Math.max(n-t,o-i),mappingQual:0,cg:s}}}function H(e){for(var t="",n=0,r=0,a="",i="",o="",s=0,c=0,u=0,l="",d=[],f=0;f<e.length;f++){var p=e[f].replace(/ /g,"\t").split("\t");if("chain"===p[0]){if(l&&d.push(W(a,s,c,o,t,n,r,l,u)),t=p[2],n=+p[5],r=+p[6],a=p[7],i=p[8],o=p[9],s=+p[10],c=+p[11],"-"===o){var h=s;s=+i-c,c=+i-h}u=0,l=""}else{var g=+p[0]||0,m=p.length>1?+p[1]:0,v=p.length>2?+p[2]:0;0!==g&&(u+=+g,l+=g+"M"),0!==v&&(l+=v+"I"),0!==m&&(l+=m+"D")}}return l&&W(a,s,c,o,t,n,r,l,u),d}var q=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"setupPre",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,m.openLocation)(this.getConf("chainLocation"),this.pluginManager),e.next=3,n.readFile(t);case 3:if(!z(r=e.sent)){e.next=10;break}return e.next=7,(0,b.unzip)(r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=r;case 11:if(!((a=e.t0).length>536870888)){e.next=14;break}throw new Error("Data exceeds maximum string length (512MB)");case 14:return i=new TextDecoder("utf8",{fatal:!0}).decode(a),e.abrupt("return",H(i.split("\n").filter((function(e){return!!e}))));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(w),U=(0,k.ConfigurationSchema)("ChainAdapter",{assemblyNames:{type:"stringArray",defaultValue:[],description:"Target is the first value in the array, query is the second"},targetAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the target assembly"},queryAssembly:{type:"string",defaultValue:"",description:"Alternative to assemblyNames array: the query assembly"},chainLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/file.chain",locationType:"UriLocation"}}},{explicitlyTyped:!0}),_=n(97891),G=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ComparativeAdaptersPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){!function(e){e.addAdapterType((function(){return new c.Z({name:"PAFAdapter",configSchema:C,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:w})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"DeltaAdapter",configSchema:O,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:V})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"ChainAdapter",configSchema:U,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:q})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MCScanAnchorsAdapter",configSchema:A,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:j})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MCScanSimpleAnchorsAdapter",configSchema:L,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:N})}))}(e),function(e){e.addAdapterType((function(){return new c.Z({name:"MashMapAdapter",configSchema:B,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},AdapterClass:I})}))}(e),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="PAFAdapter",i=(0,_.getFileName)(t);return/\.paf/i.test(i)||r===a?{type:a,pafLocation:t}:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"PAFAdapter"===t?"SyntenyTrack":e(t)}}))}}]),n}(s.Z)},49388:function(e,t,n){"use strict";var r=n(96234),a=n(30969),i=n(81073),o=n(22714),s=n(28224),c=n(57071),u=n(98302),l=n(90550),d=n(37574),f=(0,o.Z)({error:{color:"red",fontSize:"0.8em"}}),p=(0,a.lazy)((function(){return Promise.all([n.e(5304),n.e(6189),n.e(7207)]).then(n.bind(n,87207))}));t.Z=(0,l.observer)((function(e){var t=e.slot,n=f(),o=(0,a.useState)(JSON.stringify(t.value,null,"  ")),l=(0,r.Z)(o,2),h=l[0],g=l[1],m=(0,a.useState)(),v=(0,r.Z)(m,2),y=v[0],b=v[1],x=(0,i.useDebounce)(h,400);return(0,a.useEffect)((function(){try{t.set(JSON.parse(x)),b(void 0)}catch(e){b(e.message)}}),[x,t]),(0,d.jsxs)(d.Fragment,{children:[y?(0,d.jsx)("p",{className:n.error,children:y}):null,(0,d.jsxs)(s.Z,{error:y,children:[(0,d.jsx)(c.Z,{shrink:!0,htmlFor:"callback-editor",children:t.name}),(0,d.jsx)(a.Suspense,{fallback:(0,d.jsx)("div",{}),children:(0,d.jsx)(p,{contents:h,setContents:g})}),(0,d.jsx)(u.Z,{children:t.description})]})]})}))},5634:function(e,t,n){"use strict";n.d(t,{wP:function(){return O},ZP:function(){return z}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(93029),u=n(66737),l=n(49767),d=n(90550),f=n(40909),p=n(9077),h=n(29206),g=function(e){return f.types.model("ConfigurationEditorWidget",{id:h.ElementId,type:f.types.literal("ConfigurationEditorWidget"),target:f.types.safeReference(e.pluggableConfigSchemaType("track"))}).actions((function(e){return{setTarget:function(t){e.target=t}}}))},m=(0,p.ConfigurationSchema)("ConfigurationEditorWidget",{}),v=(0,d.observer)((function(e){var t=e.model;if(t&&t.target){if(t.target.type)return"".concat(t.target.type," settings");if((0,f.isStateTreeNode)(t.target)){var n=(0,f.getType)(t.target);if(n&&n.name)return"".concat(n.name.replace("ConfigurationSchema","")," settings")}}return"Settings"})),y=n(41361),b=n(68079),x=n(34795),w=n(77162),k=n.n(w),C=n(29598),Z=n(14956),S=n(26131),T=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).features=void 0;var s=(0,p.readConfObject)(e,"features");return o.features=n.makeFeatures(s||[]),o}return(0,a.Z)(n,[{key:"getRefNames",value:function(){var e=(0,x.Z)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.Z)(this.features.keys()));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRefNameAliases",value:function(){var e=(0,x.Z)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Array.from(this.features.values()).map((function(e){return{refName:e[0].get("refName"),aliases:e[0].get("aliases")}})));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=e.refName,r=e.start,a=e.end;return(0,S.ObservableCreate)(function(){var e=(0,x.Z)(k().mark((function e(i){var o,s,c;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=t.features.get(n)||[],s=0;s<o.length;s++)(c=o[s]).get("end")>r&&c.get("start")<a&&i.next(c);i.complete();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"freeResources",value:function(){}}],[{key:"makeFeatures",value:function(e){for(var t=new Map,n=0;n<e.length;n+=1)if(e[n]){var r=this.makeFeature(e[n]),a=r.get("refName"),i=t.get(a);i||(i=[],t.set(a,i)),i.push(r)}var o,s=(0,y.Z)(t.values());try{for(s.s();!(o=s.n()).done;){o.value.sort((function(e,t){return e.get("start")-t.get("start")}))}}catch(c){s.e(c)}finally{s.f()}return t}},{key:"makeFeature",value:function(e){return new Z.Z(e)}}]),n}(C.BaseFeatureDataAdapter),P=n(96234),R=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).features=void 0;var s=(0,p.readConfObject)(e,"features");return o.features=T.makeFeatures(s||[]),o}return(0,a.Z)(n,[{key:"getRegions",value:function(){var e=(0,x.Z)(k().mark((function e(){var t,n,r,a,i,o,s,c,u,l;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,y.Z)(this.features);try{for(n.s();!(r=n.n()).done;){a=(0,P.Z)(r.value,2),i=a[0],o=a[1],s=void 0,c=(0,y.Z)(o);try{for(c.s();!(u=c.n()).done;)l=u.value,s&&s.end>=l.get("start")&&s.start<=l.get("end")?s.end=l.get("end"):(s&&t.push(s),s={refName:i,start:l.get("start"),end:l.get("end")})}catch(d){c.e(d)}finally{c.f()}s&&t.push(s)}}catch(d){n.e(d)}finally{n.f()}return t.sort((function(e,t){return e.refName.localeCompare(t.refName)})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(C.BaseAdapter),M=n(33028),j=n(93069),A=n(95058),N=n(26080),L=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"getFeatures",value:function(e){var t=this,r=(0,j.Z)((0,A.Z)(n.prototype),"getFeatures",this);return(0,S.ObservableCreate)(function(){var n=(0,x.Z)(k().mark((function n(a){var i,o;return k().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.call(t,e).pipe((0,N.q)()).toPromise();case 2:i=n.sent,o=i[0],a.next(new Z.Z((0,M.Z)((0,M.Z)({},o.toJSON()),{},{uniqueId:"".concat(o.id(),":").concat(e.start,"-").concat(e.end),end:e.end,start:e.start,seq:o.get("seq").slice(Math.max(e.start-o.get("start"),0),Math.max(e.end-o.get("start"),0))}))),a.complete();case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"getRegions",value:function(){var e=(0,x.Z)(k().mark((function e(){var t,n,r,a,i,o,s,c,u,l;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,y.Z)(this.features);try{for(n.s();!(r=n.n()).done;){a=(0,P.Z)(r.value,2),i=a[0],o=a[1],s=void 0,c=(0,y.Z)(o);try{for(c.s();!(u=c.n()).done;)l=u.value,s&&s.end>=l.get("start")&&s.start<=l.get("end")?s.end=l.get("end"):(s&&t.push(s),s={refName:i,start:l.get("start"),end:l.get("end")})}catch(d){c.e(d)}finally{c.f()}s&&t.push(s)}}catch(d){n.e(d)}finally{n.f()}return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(T),F=(0,p.ConfigurationSchema)("FromConfigAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),I=(0,p.ConfigurationSchema)("FromConfigRegionsAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),B=(0,p.ConfigurationSchema)("FromConfigSequenceAdapter",{features:{type:"frozen",defaultValue:[]},featureClass:{type:"string",defaultValue:"SimpleFeature"}},{explicitlyTyped:!0,implicitIdentifier:"adapterId"}),D=n(33528),E=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"getRefNameAliases",value:function(){var e=(0,x.Z)(k().mark((function e(){var t,n,r;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=(0,p.readConfObject)(this.config,"location")).uri&&"/path/to/my/aliases.txt"!==t.uri){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,(0,D.openLocation)(t).readFile("utf8");case 5:return n=e.sent,r=(0,p.readConfObject)(this.config,"refNameColumn"),e.abrupt("return",n.trim().split("\n").filter((function(e){return!!e&&!e.startsWith("#")})).map((function(e){var t=e.split("\t"),n=t.splice(r,1);return{refName:(0,P.Z)(n,1)[0],aliases:t}})));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){var e=(0,x.Z)(k().mark((function e(){return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(C.BaseAdapter),V=(0,p.ConfigurationSchema)("RefNameAliasAdapter",{location:{type:"fileLocation",defaultValue:{uri:"/path/to/my/aliases.txt",locationType:"UriLocation"}},refNameColumn:{type:"number",defaultValue:0}},{explicitlyTyped:!0}),O=(n(49388),(0,s.lazy)((function(){return Promise.all([n.e(5304),n.e(4594)]).then(n.bind(n,54594))}))),z=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ConfigurationPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new c.Z({name:"FromConfigAdapter",configSchema:F,AdapterClass:T,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new c.Z({name:"FromConfigRegionsAdapter",configSchema:I,AdapterClass:R,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new c.Z({name:"FromConfigSequenceAdapter",configSchema:B,AdapterClass:L,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addAdapterType((function(){return new c.Z({name:"RefNameAliasAdapter",configSchema:V,AdapterClass:E,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}})})),e.addWidgetType((function(){return new u.Z({name:"ConfigurationEditorWidget",HeadingComponent:v,configSchema:m,stateModel:g(e),ReactComponent:O})}))}}]),n}(l.Z)},18287:function(e,t,n){"use strict";n.d(t,{j:function(){return s},e:function(){return o}});var r=n(9077),a=n(40909),i=n(29206),o=a.types.model("AddConnectionModel",{id:i.ElementId,type:a.types.literal("AddConnectionWidget")}),s=(0,r.ConfigurationSchema)("AddConnectionWidget",{})},63824:function(e,t,n){"use strict";n.d(t,{j:function(){return u},e:function(){return c}});var r=n(9077),a=n(40909),i=n(29206),o=n(97891);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{return new URL(e),!0}catch(t){return e.startsWith("/")}}function c(e){return a.types.model("AddTrackModel",{id:i.ElementId,type:a.types.literal("AddTrackWidget"),view:a.types.safeReference(e.pluggableMstType("view","stateModel"))}).volatile((function(){return{trackSource:"fromFile",trackData:void 0,indexTrackData:void 0,altAssemblyName:"",altTrackName:"",altTrackType:"",adapterHint:"",textIndexTrack:!0,textIndexingConf:void 0}})).actions((function(e){return{setAdapterHint:function(t){e.adapterHint=t},setTrackSource:function(t){e.trackSource=t},setTextIndexingConf:function(t){e.textIndexingConf=t},setTextIndexTrack:function(t){e.textIndexTrack=t},setTrackData:function(t){e.trackData=t},setIndexTrackData:function(t){e.indexTrackData=t},setAssembly:function(t){e.altAssemblyName=t},setTrackName:function(t){e.altTrackName=t},setTrackType:function(t){e.altTrackType=t},clearData:function(){e.trackSource="",e.altTrackName="",e.altTrackType="",e.altAssemblyName="",e.adapterHint="",e.indexTrackData=void 0,e.trackData=void 0,e.textIndexingConf=void 0,e.textIndexTrack=!1}}})).views((function(e){return{get trackAdapter(){var t=e.trackData,n=e.indexTrackData,r=e.adapterHint;return t?(0,o.guessAdapter)(t,n,r,e):void 0},get trackName(){return e.altTrackName||(e.trackData?(0,o.getFileName)(e.trackData):"")},get isFtp(){var t,n,r=e.trackData,a=e.indexTrackData;return!!(null!==a&&void 0!==a&&null!==(t=a.uri)&&void 0!==t&&t.startsWith("ftp://")||null!==r&&void 0!==r&&null!==(n=r.uri)&&void 0!==n&&n.startsWith("ftp://"))},get isRelativeTrackUrl(){var t,n=null===(t=e.trackData)||void 0===t?void 0:t.uri;return!!n&&!s(n)},get isRelativeIndexUrl(){var t,n=null===(t=e.indexTrackData)||void 0===t?void 0:t.uri;return!!n&&!s(n)},get isRelativeUrl(){return this.isRelativeIndexUrl||this.isRelativeTrackUrl},get trackHttp(){var t,n;return null===(t=e.trackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get indexHttp(){var t,n;return null===(t=e.indexTrackData)||void 0===t||null===(n=t.uri)||void 0===n?void 0:n.startsWith("http://")},get wrongProtocol(){return"https:"===window.location.protocol&&(this.trackHttp||this.indexHttp)},get unsupported(){var e;return(null===(e=this.trackAdapter)||void 0===e?void 0:e.type)===o.UNSUPPORTED},get assembly(){var t;return e.altAssemblyName||(null===(t=e.view.assemblyNames)||void 0===t?void 0:t[0])},get trackType(){return e.altTrackType||(this.trackAdapter?(0,o.guessTrackType)(this.trackAdapter.type,e):"")}}})).views((function(e){return{get warningMessage(){return e.isFtp?"Warning: JBrowse cannot access files using the ftp protocol":e.isRelativeUrl?"Warning: one or more of your files do not provide the protocol e.g.\n          https://, please provide an absolute URL unless you are sure a\n          relative URL is intended.":e.wrongProtocol?"Warning: You entered a http:// resources but we cannot access HTTP\n          resources from JBrowse when it is running on https. Please use an\n          https URL for your track, or access the JBrowse app from the http\n          protocol":""}}}))}var u=(0,r.ConfigurationSchema)("AddTrackWidget",{})},27971:function(e,t,n){"use strict";n.d(t,{j:function(){return p},e:function(){return f}});var r=n(9077),a=n(41361),i=n(68079),o=n(40909),s=n(81073),c=n(29206),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return!!e.find((function(e){return t.includes(e)}))};function l(e){if(!e.trackId)throw new Error("not a track");return(0,r.readConfObject)(e,"name")||"Reference sequence (".concat((0,r.readConfObject)((0,o.getParent)(e),"name"),")")}function d(e,t,n){var a={children:[]},o=e.filterText,s=e.view;return t.filter((function(e){return function(e,t){var n=l(t),a=(0,r.readConfObject)(t,"category")||[],i=e.toLowerCase();return!!n.toLowerCase().includes(i)||a.filter((function(e){return!!e.toLowerCase().includes(i)})).length}(o,e)})).forEach((function(e){var t=(0,i.Z)((0,r.readConfObject)(e,"category")||[]);e.trackId.endsWith("sessionTrack")&&t.unshift(" Session tracks");for(var o=a,c=function(e){var r=t[e],a=o.children.find((function(e){return e.name===r})),i=t.slice(0,e+1).join(",");if(a)o=a;else{var s={children:[],name:r,id:i,isOpenByDefault:!n.get(i)};o.children.push(s),o=s}},u=0;u<t.length;u++)c(u);o.children.splice(o.children.findIndex((function(e){return e.children.length})),0,{id:e.trackId,name:l(e),conf:e,checked:!!s.tracks.find((function(t){return t.configuration===e})),children:[]})})),a.children}var f=function(e){return o.types.model("HierarchicalTrackSelectorWidget",{id:c.ElementId,type:o.types.literal("HierarchicalTrackSelectorWidget"),collapsed:o.types.map(o.types.boolean),filterText:"",view:o.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{setView:function(t){e.view=t},toggleCategory:function(t){e.collapsed.set(t,!e.collapsed.get(t))},clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}})).views((function(t){return{getRefSeqTrackConf:function(n){var r=(0,s.getSession)(t).assemblyManager.get(n),i=null===r||void 0===r?void 0:r.configuration.sequence,o=e.getViewType(t.view.type);if(i){var c,u=(0,a.Z)(i.displays);try{var l=function(){var e=c.value;if(o.displayTypes.find((function(t){return t.name===e.type})))return{v:i}};for(u.s();!(c=u.n()).done;){var d=l();if("object"===typeof d)return d.v}}catch(f){u.e(f)}finally{u.f()}}},trackConfigurations:function(n){if(!t.view)return[];var a=(0,s.getSession)(t),o=a.tracks,c=a.assemblyManager.get(n);if(!c)return[];var l=t.getRefSeqTrackConf(n);return(l?[l]:[]).concat((0,i.Z)(o.filter((function(e){var t=(0,r.readConfObject)(e,"assemblyNames"),n=c.allAliases;return u(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return u(r,a)}))))},get assemblyNames(){return t.view?t.view.assemblyNames:[]},connectionTrackConfigurations:function(n,a){if(!t.view)return[];var i=a.tracks,o=(0,s.getSession)(t).assemblyManager.get(n);return o&&o.initialized?i.filter((function(e){var t=(0,r.readConfObject)(e,"assemblyNames"),n=o.allAliases;return u(n,t)})).filter((function(n){var r=e.getViewType(t.view.type).displayTypes.map((function(e){return e.name})),a=n.displays.map((function(e){return e.type}));return u(r,a)})):[]},hierarchy:function(e){var n=this,a=d(t,t.trackConfigurations(e),t.collapsed),o=(0,s.getSession)(t),c=o.connectionInstances.filter((function(t){var n=(0,r.readConfObject)(t.configuration,"assemblyNames");return 0===n.length||n.includes(e)})).map((function(t,a){var i=o.connections[a];return{id:i.connectionId,name:(0,r.readConfObject)(i,"name"),children:n.connectionHierarchy(e,t),state:{expanded:!0}}}));return{name:"Root",id:"Root",children:[{name:"Tracks",id:"Tracks",children:a}].concat((0,i.Z)(c))}},connectionHierarchy:function(e,n){return d(t,t.connectionTrackConfigurations(e,n),t.collapsed)},allTracksInCategoryPath:function(e,n,r){var a=n?t.connectionHierarchy(n):t.hierarchy(r);e.forEach((function(e){a=a.get(e)||new Map}));var i={};return a.forEach((function(n,r){n.trackId?i[n.trackId]=n:i=Object.assign(i,t.allTracksInCategoryPath(e.concat([r])))})),i}}}))},p=(0,r.ConfigurationSchema)("HierarchicalTrackSelectorWidget",{})},72365:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ee}});var r=n(34795),a=n(96234),i=n(77162),o=n.n(i),s=n(30969),c=n(90550),u=n(40909),l=n(22714),d=n(80975),f=n(28599),p=n(7690),h=n(5877),g=n(32343),m=n(31273),v=n(76647),y=n(81073),b=n(5088),x=n(49430),w=n(80485),k=n(67071),C=n(317),Z=n(83483),S=n(64501),T=n(93138),P=n(53033),R=n(57886),M=n(14008),j=n(45335),A=n(8438),N=n(37574),L=(0,l.Z)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},lockedPluginTooltip:{marginRight:"0.5rem"}}}));function F(){var e=L();return(0,N.jsx)(C.ZP,{className:e.lockedPluginTooltip,title:"This plugin was installed by an administrator, you cannot remove it.",children:(0,N.jsx)(j.Z,{})})}function I(e){var t=e.onClose,n=e.plugin,r=L();return(0,N.jsxs)(Z.Z,{open:!0,onClose:function(){return t()},children:[(0,N.jsx)(S.Z,{children:(0,N.jsx)(g.Z,{className:r.closeDialog,"aria-label":"close-dialog",onClick:function(){return t()},children:(0,N.jsx)(M.Z,{})})}),(0,N.jsxs)(T.Z,{children:[(0,N.jsxs)(d.Z,{children:["Please confirm that you want to remove ",n,". Note: if any resources in this session still use this plugin, it may cause your session to crash"]}),(0,N.jsxs)(P.Z,{children:[(0,N.jsx)(f.Z,{variant:"contained",color:"primary",onClick:function(){window.setTimeout((function(){t(n)}),500)},children:"Confirm"}),(0,N.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:function(){t()},children:"Cancel"})]})]})]})}var B=(0,c.observer)((function(e){var t=e.plugin,n=e.model,r=e.pluginManager,i=(0,s.useState)(),o=(0,a.Z)(i,2),c=o[0],l=o[1],f=(0,y.getSession)(n),p=f.sessionPlugins,h=null===p||void 0===p?void 0:p.some((function(e){return r.pluginMetadata[t.name].url===e.url})),m=(0,u.getParent)(n,3),v=m.jbrowse,b=m.adminMode;return(0,N.jsxs)(N.Fragment,{children:[c?(0,N.jsx)(I,{plugin:c,onClose:function(e){if(e){var n=r.pluginMetadata[t.name];b?v.removePlugin(n):(0,A.uF)(f)&&f.removeSessionPlugin(n)}l(void 0)}}):null,(0,N.jsxs)(R.Z,{children:[b||h?(0,N.jsx)(g.Z,{"aria-label":"removePlugin","data-testid":"removePlugin-".concat(t.name),onClick:function(){return l(t.name)},children:(0,N.jsx)(M.Z,{})}):(0,N.jsx)(F,{}),(0,N.jsx)(d.Z,{children:t.name})]},t.name)]})}));var D=(0,c.observer)((function(e){var t=e.pluginManager,n=e.model,r=t.plugins,a=r.filter((function(e){var n;return null===(n=t.pluginMetadata[e.name])||void 0===n?void 0:n.isCore})).map((function(e){return e.name})),i=r.filter((function(e){return!a.includes(e.name)}));return(0,N.jsx)(k.Z,{children:i.length?i.filter((function(e){return e.name.toLowerCase().includes(n.filterText.toLowerCase())})).map((function(e){return(0,N.jsx)(B,{plugin:e,model:n,pluginManager:t},e.name)})):(0,N.jsx)(d.Z,{children:"No plugins currently installed"})})})),E=n(34122),V=n(23957),O=n(24940),z=n(14721),W=n(17949),H=n(10901),q=n(89247),U=(0,l.Z)((function(){return{card:{margin:"1em"},icon:{marginLeft:"0.5em",marginRight:"0.5em"},bold:{fontWeight:600},dataField:{display:"flex",alignItems:"center",margin:"0.4em 0em"}}}));var _=(0,c.observer)((function(e){var t=e.plugin,n=e.model,r=e.adminMode,i=U(),o=(0,y.getSession)(n),c=(0,u.getEnv)(n).pluginManager,l=Boolean(c.runtimePluginDefinitions.find((function(e){return e.url===t.url}))),p=(0,s.useState)(!1),h=(0,a.Z)(p,2),g=h[0],m=h[1],v=l||g,b=(0,u.getParent)(n,3).jbrowse;return(0,N.jsxs)(E.Z,{variant:"outlined",className:i.card,children:[(0,N.jsxs)(V.Z,{children:[(0,N.jsx)("div",{className:i.dataField,children:(0,N.jsx)(d.Z,{variant:"h5",children:(0,N.jsx)(O.Z,{href:"".concat(t.location,"#readme"),target:"_blank",rel:"noopener",children:t.name})})}),(0,N.jsxs)("div",{className:i.dataField,children:[(0,N.jsx)(W.Z,{style:{marginRight:"0.5em"}}),(0,N.jsx)(d.Z,{children:t.authors.join(", ")})]}),(0,N.jsx)(d.Z,{className:i.bold,children:"Description:"}),(0,N.jsx)(d.Z,{children:t.description})]}),(0,N.jsx)(z.Z,{children:(0,N.jsx)(f.Z,{variant:"contained",color:"primary",disabled:v,startIcon:l?(0,N.jsx)(q.Z,{}):(0,N.jsx)(H.Z,{}),onClick:function(){r?b.addPlugin({name:t.name,url:t.url}):(0,A.uF)(o)&&o.addSessionPlugin(t),m(!0)},children:l?"Installed":"Install"})})]},t.name)})),G=n(56666),J=n(81856),X=n(54249),Y=n(52654),Q=(0,l.Z)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1)},dialogContent:{display:"flex",flexDirection:"column"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"}}}));var $=(0,c.observer)((function(e){var t=e.open,n=e.onClose,r=e.model,i=Q(),o=(0,s.useState)(""),c=(0,a.Z)(o,2),l=c[0],d=c[1],h=(0,s.useState)(""),m=(0,a.Z)(h,2),v=m[0],y=m[1],x=(0,s.useState)(""),w=(0,a.Z)(x,2),k=w[0],C=w[1],R=(0,s.useState)(""),j=(0,a.Z)(R,2),A=j[0],L=j[1],F=(0,s.useState)(!1),I=(0,a.Z)(F,2),B=I[0],D=I[1];function E(e){var t=e.target,n=t.name,r=t.value;"umdName"===n&&d(r),"umdUrl"===n&&y(r),"esmUrl"===n&&C(r),"cjsUrl"===n&&L(r)}var V=(0,u.getRoot)(r).jbrowse,O=Boolean(l&&v||k||A);function z(){if(O){var e={};l&&v&&(e.name=l,e.umdUrl=v),k&&(e.esmUrl=k),A&&(e.cjsUrl=A),V.addPlugin(e)}}function W(){d(""),y(""),C(""),L(""),n()}return(0,N.jsxs)(Z.Z,{open:t,onClose:W,children:[(0,N.jsxs)(S.Z,{children:["Add custom plugin",(0,N.jsx)(g.Z,{size:"medium",className:i.closeButton,onClick:function(){return n()},children:(0,N.jsx)(M.Z,{})})]}),(0,N.jsxs)("form",{onSubmit:z,children:[(0,N.jsxs)(T.Z,{className:i.dialogContent,children:[(0,N.jsx)(X.Z,{children:"Enter the name of the plugin and its URL. The name should match what is defined in the plugin's build."}),(0,N.jsx)(p.Z,{id:"umd-name-input",name:"umdName",label:"Plugin name",variant:"outlined",value:l,onChange:E}),(0,N.jsx)(p.Z,{id:"umd-url-input",name:"umdUrl",label:"Plugin URL",variant:"outlined",value:v,onChange:E}),(0,N.jsxs)(X.Z,{onClick:function(){D(!B)},children:[(0,N.jsx)(g.Z,{className:(0,J.Z)(i.expand,(0,G.Z)({},i.expandOpen,B)),"aria-expanded":B,"aria-label":"show more",children:(0,N.jsx)(b.Z,{})}),"Advanced options"]}),(0,N.jsx)(Y.Z,{in:B,children:(0,N.jsxs)("div",{className:i.dialogContent,children:[(0,N.jsx)(X.Z,{children:"The above fields assume that the plugin is built in UMD format. If your plugin is in another format, or you have additional builds you want to add (such as a CJS build for using NodeJS APIs in desktop), you can enter the URLs for those builds below."}),(0,N.jsx)(p.Z,{id:"esm-url-input",name:"esmUrl",label:"ESM build URL",variant:"outlined",value:k,onChange:E}),(0,N.jsx)(p.Z,{id:"cjs-url-input",name:"cjsUrl",label:"CJS build URL",variant:"outlined",value:A,onChange:E})]})})]}),(0,N.jsxs)(P.Z,{children:[(0,N.jsx)(f.Z,{variant:"contained",onClick:W,children:"Cancel"}),(0,N.jsx)(f.Z,{variant:"contained",color:"primary",onClick:z,disabled:!O,children:"Submit"})]})]})]})})),K=(0,l.Z)((function(e){return{root:{margin:e.spacing(1)},expandIcon:{color:"#fff"},adminBadge:{margin:"0.5em",borderRadius:3,backgroundColor:"#FFB11D",padding:"1em",display:"flex",alignContent:"center"},customPluginButton:{margin:"0.5em",display:"flex",justifyContent:"center"}}}));var ee=(0,c.observer)((function(e){var t=e.model,n=K(),i=(0,s.useState)(),c=(0,a.Z)(i,2),l=c[0],k=c[1],C=(0,s.useState)(),Z=(0,a.Z)(C,2),S=Z[0],T=Z[1],P=(0,s.useState)(!1),R=(0,a.Z)(P,2),M=R[0],j=R[1],A=(0,y.getSession)(t).adminMode,L=(0,u.getEnv)(t).pluginManager;return(0,s.useEffect)((function(){var e=new AbortController,t=e.signal;return(0,r.Z)(o().mark((function e(){var n,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://jbrowse.org/plugin-store/plugins.json",{signal:t});case 3:if((n=e.sent).ok){e.next=9;break}return e.next=7,n.text();case 7:throw r=e.sent,new Error("Failed to fetch plugin data: ".concat(n.status," ").concat(n.statusText," ").concat(r));case 9:return e.next=11,n.json();case 11:a=e.sent,t.aborted||k(a.plugins),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0),T(e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))(),function(){e.abort()}}),[]),(0,N.jsxs)("div",{className:n.root,children:[A&&(0,N.jsxs)(N.Fragment,{children:[!y.isElectron&&(0,N.jsxs)("div",{className:n.adminBadge,children:[(0,N.jsx)(w.Z,{style:{marginRight:"0.3em"}}),(0,N.jsxs)(d.Z,{children:["You are using the ",(0,N.jsx)("code",{children:"admin-server"}),". Any changes you make will be saved to your configuration file. You also have the ability to add custom plugins that are not in the store."]})]}),(0,N.jsx)("div",{className:n.customPluginButton,children:(0,N.jsx)(f.Z,{variant:"contained",color:"primary",onClick:function(){return j(!0)},children:"Add custom plugin"})}),(0,N.jsx)($,{open:M,onClose:function(){return j(!1)},model:t})]}),(0,N.jsx)(p.Z,{label:"Filter plugins",value:t.filterText,onChange:function(e){return t.setFilterText(e.target.value)},fullWidth:!0,InputProps:{endAdornment:(0,N.jsx)(h.Z,{position:"end",children:(0,N.jsx)(g.Z,{color:"secondary",onClick:function(){return t.clearFilterText()},children:(0,N.jsx)(x.Z,{})})})}}),(0,N.jsxs)(m.Z,{defaultExpanded:!0,children:[(0,N.jsx)(v.Z,{expandIcon:(0,N.jsx)(b.Z,{className:n.expandIcon}),children:(0,N.jsx)(d.Z,{variant:"h5",children:"Installed plugins"})}),(0,N.jsx)("div",{style:{margin:"1em"},children:(0,N.jsx)(D,{pluginManager:L,model:t})})]}),(0,N.jsxs)(m.Z,{defaultExpanded:!0,children:[(0,N.jsx)(v.Z,{expandIcon:(0,N.jsx)(b.Z,{className:n.expandIcon}),children:(0,N.jsx)(d.Z,{variant:"h5",children:"Available plugins"})}),S?(0,N.jsx)(d.Z,{color:"error",children:"".concat(S)}):l?l.filter((function(e){return!!(y.isElectron||e.esmUrl||e.url||e.umdUrl)&&e.name.toLowerCase().includes(t.filterText.toLowerCase())})).map((function(e){return(0,N.jsx)(_,{plugin:e,model:t,adminMode:!!A},e.name)})):(0,N.jsx)(d.Z,{children:"Loading..."})]})]})}))},20120:function(e,t,n){"use strict";n.d(t,{jS:function(){return s},e$:function(){return o}});var r=n(9077),a=(n(72365),n(40909)),i=n(29206);function o(e){return a.types.model("PluginStoreModel",{id:i.ElementId,type:a.types.literal("PluginStoreWidget"),filterText:"",view:a.types.safeReference(e.pluggableMstType("view","stateModel"))}).actions((function(e){return{clearFilterText:function(){e.filterText=""},setFilterText:function(t){e.filterText=t}}}))}var s=(0,r.ConfigurationSchema)("PluginStoreWidget",{})},46891:function(e,t,n){"use strict";n.d(t,{j:function(){return u},u:function(){return k}});var r=n(41361),a=n(96234),i=n(59853),o=n(9077),s=n(81073),c=n(40909),u=(0,o.ConfigurationSchema)("UCSCTrackHubConnection",{hubTxtLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/path/to/hub.txt",locationType:"UriLocation"},description:"location of the hub file (usually called hub.txt)"},assemblyNames:{type:"stringArray",defaultValue:[],description:"optional list of genomes to import from this track hub, if empty all genomes will be imported"}},{baseConfiguration:i.baseConnectionConfig}),l=n(34795),d=n(77162),f=n.n(d),p=n(33528),h=n(97891);"ailMel1\nallMis1\nanoCar1\nanoCar2\nanoGam1\nanoGam3\napiMel1\napiMel2\naplCal1\naptMan1\naquChr2\nbalAcu1\nbisBis1\nbosTau2\nbosTau3\nbosTau4\nbosTau6\nbosTau7\nbosTau8\nbraFlo1\ncaeJap1\ncaePb1\ncaePb2\ncaeRem2\ncaeRem3\ncalJac1\ncalJac3\ncalMil1\ncanFam1\ncanFam3\ncavPor3\ncb3\nce10\nce11\nce2\nce4\nce6\ncerSim1\nchlSab2\nchoHof1\nchrPic1\nci1\nci2\nci3\ncriGri1\ncriGriChoV1\ndanRer10\ndanRer11\ndanRer3\ndanRer4\ndanRer5\ndanRer6\ndanRer7\ndasNov3\ndipOrd1\ndm1\ndm2\ndm3\ndm6\ndp2\ndp3\ndroAna1\ndroAna2\ndroEre1\ndroGri1\ndroMoj1\ndroMoj2\ndroPer1\ndroSec1\ndroSim1\ndroVir1\ndroVir2\ndroYak1\ndroYak2\neboVir3\nechTel1\nechTel2\nequCab1\nequCab2\neriEur1\neriEur2\nfelCat3\nfelCat4\nfelCat5\nfelCat8\nfr1\nfr2\nfr3\ngadMor1\ngalGal2\ngalGal3\ngalGal4\ngalGal5\ngalGal6\ngalVar1\ngasAcu1\ngeoFor1\ngorGor3\ngorGor4\ngorGor5\nhetGla1\nhetGla2\nhg16\nhg18\nhg19\nhg38\nlatCha1\nloxAfr3\nmacEug2\nmacFas5\nmanPen1\nmelGal1\nmelGal5\nmelUnd1\nmicMur1\nmicMur2\nmm10\nmm7\nmm8\nmm9\nmonDom2\nmonDom4\nmonDom5\nmusFur1\nmyoLuc2\nnanPar1\nnasLar1\nnomLeu1\nnomLeu2\nnomLeu3\nochPri2\nochPri3\noreNil2\nornAna1\nornAna2\noryCun2\noryLat2\notoGar3\noviAri1\noviAri3\noviAri4\npanPan1\npanPan2\npanTro1\npanTro2\npanTro3\npanTro4\npanTro5\npanTro6\npapAnu2\npapHam1\npetMar1\npetMar2\nponAbe2\nponAbe3\npriPac1\nproCap1\npteVam1\nrheMac2\nrheMac3\nrheMac8\nrhiRox1\nrn4\nrn5\nrn6\nsacCer1\nsacCer2\nsacCer3\nsaiBol1\nsarHar1\nsorAra1\nsorAra2\nspeTri2\nstrPur1\nstrPur2\nsusScr11\nsusScr2\nsusScr3\ntaeGut1\ntaeGut2\ntarSyr1\ntarSyr2\ntetNig1\ntetNig2\nthaSir1\ntriMan1\ntupBel1\nturTru2\nventer1\nvicPac1\nvicPac2\nxenLae2\nxenTro1\nxenTro2\nxenTro3\nxenTro7\nxenTro9".split(/\r?\n/);function g(){return(g=(0,l.Z)(f().mark((function e(t){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,p.openLocation)(t).readFile("utf8");case 3:return r=e.sent,e.next=6,n.e(8118).then(n.t.bind(n,8118,23));case 6:return a=e.sent,i=a.HubFile,e.abrupt("return",new i(r));case 11:throw e.prev=11,e.t0=e.catch(0),new Error("Not a valid hub.txt file, got error: '".concat(e.t0,"'"));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function m(e){return v.apply(this,arguments)}function v(){return(v=(0,l.Z)(f().mark((function e(t){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(8118).then(n.t.bind(n,8118,23));case 5:return a=e.sent,i=a.GenomesFile,e.abrupt("return",new i(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=(0,l.Z)(f().mark((function e(t){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.openLocation)(t).readFile("utf8");case 2:return r=e.sent,e.next=5,n.e(8118).then(n.t.bind(n,8118,23));case 5:return a=e.sent,i=a.TrackDbFile,e.abrupt("return",new i(r));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t,n,r){var i=[];return e.forEach((function(o,c){var u=Array.from(o.keys()),l=["superTrack","compositeTrack","container","view"];if(!u.some((function(e){return l.includes(e)}))){var d=[],f=c;do{if(f=e.get(f).get("parent")){var p=f.split(" ");f=(0,a.Z)(p,1)[0],d.push(e.get(f))}}while(f);d.reverse();var h=w(o,d.map((function(e){return e.get("shortLabel")})),t,e,r);h.trackId="ucsc-trackhub-".concat((0,s.objectHash)(h)),h.assemblyNames=[n],i.push(h)}})),i}function w(e,t,n,r,a){var i=e.get("type");i||(i=r.get(e.get("parent")).get("type"));var o,s,c=i.split(" ")[0];switch("bam"===c&&e.get("bigDataUrl").toLowerCase().endsWith("cram")&&(c="cram"),o=n.uri?{uri:new URL(e.get("bigDataUrl"),n.uri).href,locationType:"UriLocation"}:{localPath:e.get("bigDataUrl"),locationType:"LocalPathLocation"},c){case"bam":return s=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".bai"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BamAdapter",bamLocation:o,index:{location:s}}};case"bed":case"bed5FloatScore":case"bedGraph":case"bedRnaElements":case"broadPeak":case"coloredExon":case"gvf":case"ld2":case"narrowPeak":case"peptideMapping":case"wig":case"wigMaf":case"halSnake":return(0,h.generateUnsupportedTrackConf)(e.get("shortLabel"),c,t);case"bigBarChart":case"bigChain":case"bigInteract":case"bigMaf":case"bigPsl":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o},renderer:{type:"SvgFeatureRenderer"}};case"bigBed":case"bigGenePred":case"bigNarrowPeak":return{type:"FeatureTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigBedAdapter",bigBedLocation:o}};case"bigWig":return{type:"QuantitativeTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"BigWigAdapter",bigWigLocation:o}};case"cram":return s=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".crai"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".crai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"CramAdapter",cramLocation:o,craiLocation:s,sequenceAdapter:a}};case"vcfTabix":return s=n.uri?e.get("bigDataIndex")?{uri:new URL(e.get("bigDataIndex"),n.uri).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.get("bigDataUrl"),".tbi"),n.uri).href,locationType:"UriLocation"}:e.get("bigDataIndex")?{localPath:e.get("bigDataIndex"),locationType:"LocalPathLocation"}:{localPath:"".concat(e.get("bigDataUrl"),".tbi"),locationType:"LocalPathLocation"},{type:"VariantTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"VcfTabixAdapter",vcfGzLocation:o,index:{location:s}}};case"hic":return{type:"HicTrack",name:e.get("shortLabel"),description:e.get("longLabel"),category:t,adapter:{type:"HicAdapter",hicLocation:o}};default:return(0,h.generateUnknownTrackConf)(e.get("shortLabel"),c,t)}}function k(e){return c.types.compose("UCSCTrackHubConnection",(0,i.BaseConnectionModelFactory)(e),c.types.model({configuration:(0,o.ConfigurationReference)(u),type:c.types.literal("UCSCTrackHubConnection")}).actions((function(e){return{connect:function(){var t=(0,o.getConf)(e,"name"),n=(0,o.getConf)(e,"hubTxtLocation"),i=(0,s.getSession)(e);(function(e){return g.apply(this,arguments)})(n).then((function(e){var t=n.uri?{uri:new URL(e.get("genomesFile"),n.uri).href,locationType:"UriLocation"}:{localPath:e.get("genomesFile"),locationType:"LocalPathLocation"};return Promise.all([e,m(t)])})).then((function(s){var c,u=(0,a.Z)(s,2),l=u[0],d=u[1],f=[],p=(0,r.Z)(d);try{var h=function(){var r=(0,a.Z)(c.value,2),s=r[0],u=r[1],d=(0,o.getConf)(e,"assemblyNames");if(d.length>0&&!d.includes(s))return"break";var p=i.assemblies.find((function(e){return(0,o.readConfObject)(e,"name")===s}));if(!p)throw new Error('Cannot find assembly for "'.concat(s,'" from the genomes file for connection "').concat(t,'"'));var h=n.uri?{uri:new URL(u.get("trackDb"),new URL(l.get("genomesFile"),n.uri)).href,locationType:"UriLocation"}:{localPath:u.get("trackDb"),locationType:"LocalPathLocation"};f.push(Promise.all([h,y(h),s,p]))};for(p.s();!(c=p.n()).done;){if("break"===h())break}}catch(g){p.e(g)}finally{p.f()}return Promise.all([].concat(f))})).then((function(t){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var s=(0,a.Z)(n.value,4),c=s[0],u=s[1],l=s[2],d=s[3],f=x(u,c,l,(0,o.readConfObject)(d,["sequence","adapter"]));e.addTrackConfs(f)}}catch(p){i.e(p)}finally{i.f()}})).catch((function(t){console.error(t),i.notify('There was a problem connecting to the UCSC Track Hub "'.concat(e.name,'". Please make sure you have entered a valid hub.txt file. The error that was thrown is: "').concat(t,'"'),"error"),i.breakConnection(e.configuration)}))}}})))}},59594:function(e,t,n){"use strict";function r(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.pxToBp(e),a=r.assemblyName,i=r.refName,o=r.start,s=r.offset,c=r.oob,u=Math.floor(o+s);return c?"out of bounds":"".concat(n?"{"+a+"}":"").concat(i,":").concat(u.toLocaleString("en-US"))}function a(e,t,n){var r=[],a=e.slice(0).sort((function(e,t){var n=e.end-e.start;return t.end-t.start-n})),i=new Array(Math.round(t));return a.forEach((function(e){var a=e.key,o=e.offsetPx,s=Math.round(t-o+n),c=[Math.max(s-12,0),s];0===s||i.slice.apply(i,c).some(Boolean)?r.push(a):i.fill.apply(i,[!0].concat(c))})),r}function i(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),i=Math.pow(10,a);i<r&&!((i*=2)>=r);)i*=2.5;var o=(i=Math.max(i,5))/e,s=0;return!(i%10)&&o/10>=n?s=i/10:!(i%5)&&o/5>=n?s=i/5:!(i%2)&&o/2>=n&&(s=i/2),{majorPitch:i,minorPitch:s}}function o(e,t){for(var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[],o=i(t,60,15),s=o.minorPitch||o.majorPitch,c=0;c<e.length;c++)for(var u=e[c],l=u.start,d=u.end,f=u.refName,p=0,h=l,g=d,m=Math.ceil(h/s)*s;m<g;m+=s)r&&m%o.majorPitch?(a.push({type:"minor",base:m-1,index:p,refName:f}),p+=1):n&&Math.abs(m-u.start)>o.minorPitch&&(a.push({type:"major",base:m-1,index:p,refName:f}),p+=1);return a}n.d(t,{Cz:function(){return o},F$:function(){return a},c4:function(){return r}})},62667:function(e,t,n){"use strict";n.d(t,{Z:function(){return ye}});var r=n(68079),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(49767),u=n(30969),l=n(39798),d=n(96234),f=n(33028),p=n(40909),h=n(22417),g=n(59594),m=n(20478),v=n(24998),y=n(52477),b=n(35247),x=n(97891),w=n(54006),k=n(60717),C=n(81073),Z=n(9077),S=n(29206),T=w.Z.extend((function(e){var t=b.observable.box(1);return{views:{get dynamicBlocks(){return(0,k.Z)(e,!1,!1)},get scaleFactor(){return t.get()}},actions:{setScaleFactor:function(e){t.set(e)}}}})),P=T.extend((function(e){return{views:{get width(){return(0,p.getParent)(e).viewWidth}}}})),R=T.extend((function(e){return{views:{get width(){return(0,p.getParent)(e).viewHeight}}}}));function M(e){return p.types.compose(m.Z,p.types.model("DotplotView",{id:S.ElementId,type:p.types.literal("DotplotView"),headerHeight:0,height:600,borderSize:20,tickSize:5,vtextRotation:0,htextRotation:-90,fontSize:15,trackSelectorType:"hierarchical",assemblyNames:p.types.array(p.types.string),hview:p.types.optional(P,{}),vview:p.types.optional(R,{}),tracks:p.types.array(e.pluggableMstType("track","stateModel")),viewTrackConfigs:p.types.array(e.pluggableConfigSchemaType("track")),viewAssemblyConfigs:p.types.array(p.types.frozen())})).volatile((function(){return{volatileWidth:void 0,volatileError:void 0,borderX:100,borderY:100}})).views((function(e){return{get width(){if(!e.volatileWidth)throw new Error("width not initialized");return e.volatileWidth}}})).views((function(e){return{get assemblyErrors(){var t=(0,C.getSession)(e).assemblyManager;return e.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=e.assemblyNames,n=(0,C.getSession)(e).assemblyManager;return t.every((function(e){var t,r;return null===(t=null===(r=n.get(e))||void 0===r?void 0:r.initialized)||void 0===t||t}))}}})).views((function(e){return{get initialized(){return void 0!==e.volatileWidth&&e.hview.displayedRegions.length>0&&e.vview.displayedRegions.length>0&&e.assembliesInitialized},get hticks(){var t=e.hview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:(0,g.Cz)(r.contentBlocks,a)},get vticks(){var t=e.vview,n=t.dynamicBlocks,r=t.staticBlocks,a=t.bpPerPx;return n.contentBlocks.length>5?[]:(0,g.Cz)(r.contentBlocks,a)},get loading(){return e.assemblyNames.length>0&&!this.initialized},get viewWidth(){return e.width-e.borderX},get viewHeight(){return e.height-e.borderY},get views(){return[e.hview,e.vview]},renderProps:function(){return(0,f.Z)((0,f.Z)({},(0,x.getParentRenderProps)(e)),{},{highResolutionScaling:(0,Z.getConf)((0,C.getSession)(e),"highResolutionScaling")})}}})).actions((function(t){return{clearView:function(){t.hview.setDisplayedRegions([]),t.vview.setDisplayedRegions([]),t.assemblyNames=(0,p.cast)([])},setBorderX:function(e){t.borderX=e},setBorderY:function(e){t.borderY=e},setWidth:function(e){return t.volatileWidth=e,t.volatileWidth},setHeight:function(e){return t.height=e,t.height},setError:function(e){t.volatileError=e},closeView:function(){(0,p.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},zoomOutButton:function(){t.hview.zoomOut(),t.vview.zoomOut()},zoomInButton:function(){t.hview.zoomIn(),t.vview.zoomIn()},activateTrackSelector:function(){if("hierarchical"===t.trackSelectorType){var e=(0,C.getSession)(t),n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}throw new Error("invalid track selector type ".concat(t.trackSelectorType))},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=(0,p.resolveIdentifier)(a,(0,p.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=e.getViewType(t.type),c=i.displays.find((function(e){return!!s.displayTypes.find((function(t){return t.name===e.type}))}));if(!c)throw new Error("could not find a compatible display for view type ".concat(t.type));var u=o.stateModel.create((0,f.Z)((0,f.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:c.type,configuration:c}]}));t.tracks.push(u)},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,p.resolveIdentifier)(r,(0,p.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,b.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},setAssemblyNames:function(e,n){t.assemblyNames=(0,p.cast)([e,n])},setViews:function(e){t.hview=(0,p.cast)(e[0]),t.vview=(0,p.cast)(e[1])},getCoords:function(e,n){var r=(0,C.minmax)(n[0],e[0]),a=(0,d.Z)(r,2),i=a[0],o=a[1],s=(0,C.minmax)(n[1],e[1]),c=(0,d.Z)(s,2),u=c[0],l=c[1];return Math.abs(o-i)>3&&Math.abs(l-u)>3?[t.hview.pxToBp(i),t.hview.pxToBp(o),t.vview.pxToBp(t.viewHeight-u),t.vview.pxToBp(t.viewHeight-l)]:void 0},zoomIn:function(e,n){var r=this.getCoords(e,n);if(r){var a=(0,d.Z)(r,4),i=a[0],o=a[1],s=a[2],c=a[3];t.hview.moveTo(i,o),t.vview.moveTo(c,s)}},onDotplotView:function(e,n){var r=this.getCoords(e,n);if(r){var a=(0,d.Z)(r,4),i=a[0],o=a[1],s=a[2],c=a[3],u=(0,C.getSession)(t),l=T.create((0,f.Z)((0,f.Z)({},(0,p.getSnapshot)(t.hview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0})),h=T.create((0,f.Z)((0,f.Z)({},(0,p.getSnapshot)(t.vview)),{},{minimumBlockWidth:0,interRegionPaddingWidth:0}));l.setVolatileWidth(t.hview.width),h.setVolatileWidth(t.vview.width),l.moveTo(i,o),h.moveTo(c,s),l.zoomTo(l.bpPerPx/(t.width/t.hview.width),0),h.zoomTo(h.bpPerPx/(t.width/t.vview.width),0);var g=t.tracks.map((function(e){return e.configuration.displays.find((function(e){return"LinearSyntenyDisplay"===e.type}))})).filter((function(e){return!!e})).map((function(e){var t=(0,p.getParent)(e,2);return{type:(0,p.getParent)(e,2).type,configuration:t,displays:[{type:e.type,configuration:e}]}})),m={type:"LinearSyntenyView",views:[(0,f.Z)((0,f.Z)({type:"LinearGenomeView"},(0,p.getSnapshot)(l)),{},{tracks:[],hideHeader:!0}),(0,f.Z)((0,f.Z)({type:"LinearGenomeView"},(0,p.getSnapshot)(h)),{},{tracks:[],hideHeader:!0})],tracks:g};u.addView("LinearSyntenyView",m)}}}})).actions((function(e){return{afterAttach:function(){(0,p.addDisposer)(e,(0,b.autorun)((function(){var t=(0,C.getSession)(e);if(void 0!==e.volatileWidth&&!e.initialized){var n=[e.viewWidth,e.viewHeight],r=[e.hview,e.vview];e.assemblyNames.forEach((function(a,i){var o=t.assemblyManager.get(a);if(o){o.error&&e.setError(o.error);var s=o.regions;if(s&&s.length){var c=s;c&&(0,b.transaction)((function(){var e=r[i];e.setDisplayedRegions(c),e.setBpPerPx(e.totalBp/n[i])}))}}}))}}),{delay:1e3})),(0,p.addDisposer)(e,(0,b.autorun)((function(){var t=e.vview,n=e.hview;if(void 0!==e.volatileWidth){var r=t.dynamicBlocks.contentBlocks,a=n.dynamicBlocks.contentBlocks,i=function(e){return(0,C.measureText)(e.slice(0,30))},o=a.reduce((function(e,t){return Math.max(e,i(t.refName))}),0),s=r.reduce((function(e,t){return Math.max(e,i(t.refName))}),0);e.setBorderY(Math.max(o+10,100)),e.setBorderX(Math.max(s+10,100))}})))},squareView:function(){var t=e.hview,n=e.vview,r=(t.bpPerPx+n.bpPerPx)/2,a=t.pxToBp(t.width/2),i=n.pxToBp(n.width/2);t.setBpPerPx(r),t.centerAt(a.coord,a.refName,a.index),n.setBpPerPx(r),n.centerAt(i.coord,i.refName,i.index)},squareViewProportional:function(){var t=e.hview,n=e.vview,r=t.width/n.width,a=(t.bpPerPx+n.bpPerPx)/2,i=t.pxToBp(t.width/2),o=n.pxToBp(n.width/2);t.setBpPerPx(a/r),t.centerAt(i.coord,i.refName,i.index),n.setBpPerPx(a),n.centerAt(o.coord,o.refName,o.index)}}})).views((function(e){return{menuItems:function(){var t=(0,C.getSession)(e);return[{label:"Return to import form",onClick:function(){(0,C.getSession)(e).queueDialog((function(t){return[v.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:y.Z},{label:"Square view - same bp per pixel",onClick:function(){return e.squareView()}},{label:"Rectangular view - same total bp",onClick:function(){return e.squareView()}}].concat((0,r.Z)((0,C.isSessionModelWithWidgets)(t)?[{label:"Open track selector",onClick:e.activateTrackSelector,icon:h.GD}]:[]))},get error(){return e.volatileError||e.assemblyErrors}}}))}var j=n(59740),A=n(34795),N=n(77162),L=n.n(N),F=n(39554),I=n.n(F),B=n(81575),D=n(59853),E=n(22714),V=n(80975),O=n(94103),z=n(90550),W=n(37574),H=(0,E.Z)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",textAlign:"center"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function q(){var e=(0,u.useState)(!1),t=(0,d.Z)(e,2),n=t[0],r=t[1],a=H();return(0,u.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}}),[]),n?(0,W.jsxs)("div",{"data-testid":"loading-synteny",className:a.loading,children:[(0,W.jsx)(V.Z,{children:"Loading \u2026"}),(0,W.jsx)(O.Z,{})]}):null}function U(e){var t=e.messageText,n=H();return(0,W.jsx)("div",{className:n.blockMessage,children:(0,W.jsx)(V.Z,{children:t})})}function _(e){var t=e.error,n=H();return(0,W.jsx)("div",{className:n.blockError,children:(0,W.jsx)(V.Z,{children:t.message})})}var G=(0,z.observer)((function(e){var t=e.model,n=e.style;return t.error?(0,W.jsx)(_,{error:t.error,"data-testid":"reload_button"}):t.message?(0,W.jsx)(U,{messageText:t.message}):t.filled?(0,W.jsx)("div",{style:n,children:t.reactElement}):(0,W.jsx)(q,{})})),J=(0,z.observer)((function(e){var t=e.model,n=e.children,r=t.data||{},a=r.offsetX,i=void 0===a?0:a,o=r.offsetY,s=void 0===o?0:o,c=(0,C.getContainingView)(t),u=c.vview.offsetPx-s,l=-(c.hview.offsetPx-i);return(0,W.jsxs)("div",{style:{position:"relative"},children:[(0,W.jsx)(t.ReactComponent2,(0,f.Z)((0,f.Z)({},e),{},{style:{position:"absolute",top:u,left:l}})),n]})})),X=["reactElement"],Y=function(e){e.addDisplayType((function(){var t=function(e){return(0,Z.ConfigurationSchema)("DotplotDisplay",{renderer:p.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"DotplotRenderer"})},{explicitIdentifier:"displayId",explicitlyTyped:!0})}(e);return new B.Z({name:"DotplotDisplay",configSchema:t,stateModel:Q(t),trackType:"SyntenyTrack",viewType:"DotplotView",ReactComponent:J})}))};function Q(e){return p.types.compose("DotplotDisplay",D.BaseDisplay,p.types.model({type:p.types.literal("DotplotDisplay"),configuration:(0,Z.ConfigurationReference)(e)}).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:G}}))).views((function(e){return{get rendererTypeName(){return(0,Z.getConf)(e,["renderer","type"])},renderProps:function(){return(0,f.Z)((0,f.Z)({},(0,x.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,config:e.configuration.renderer})}}})).actions((function(e){var t;return{afterAttach:function(){(0,C.makeAbortableReaction)(e,(function(){return function(e){var t=(0,C.getSession)(e).rpcManager,n=e.rendererType,r=e.adapterConfig,a=(0,C.getContainingView)(e);if((0,Z.readConfObject)(e.configuration),(0,p.getSnapshot)(a),a.initialized){var i=a.viewWidth,o=a.viewHeight,s=a.borderSize,c=a.borderX,u=a.borderY;return{rendererType:n,rpcManager:t,renderProps:(0,f.Z)((0,f.Z)({},e.renderProps()),{},{view:I()((0,p.getSnapshot)(a)),width:i,height:o,borderSize:s,borderX:c,borderY:u,adapterConfig:r,rendererType:n.name,sessionId:(0,x.getRpcSessionId)(e),timeout:1e6})}}return}(e)}),(function(e){return e?function(e){return $.apply(this,arguments)}(e):void 0}),{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){if(void 0!==n){var r=n.data,a=n.reactElement,i=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function $(){return($=(0,A.Z)(L().mark((function e(t){var n,r,a,i,o,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,e.next=5,n.renderInClient(r,a);case 5:return i=e.sent,o=i.reactElement,s=(0,j.Z)(i,X),e.abrupt("return",{reactElement:o,data:s,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=(0,z.observer)((function(e){return(0,W.jsx)(v.PrerenderedCanvas,(0,f.Z)({},e))})),ee=(0,Z.ConfigurationSchema)("DotplotRenderer",{color:{type:"color",description:"the color of each feature in a synteny, used with colorBy:default or colorBy:callback",defaultValue:"black",contextVariable:["feature"]},posColor:{type:"color",description:"the color for forward alignments, used with colorBy:strand",defaultValue:"black"},negColor:{type:"color",description:"the color for reverse alignments, used with colorBy:strand",defaultValue:"red"},lineWidth:{type:"number",description:"width of the lines to be drawn",defaultValue:2.5},colorBy:{type:"stringEnum",model:p.types.enumeration("colorBy",["identity","mappingQuality","strand","default","callback"]),description:'Color by. Setting "identity" (similar to D-GENIES, use thresholds and thresholds palette to define colors for this setting), setting "mappingQuality" (uses mapping quality from PAF, some adapters don\'t have this setting), setting "strand" colors negative alignments with negColor and positive alignments with posColor, default uses the \'color\' field, callback uses the \'color\' field as a callback',defaultValue:"default"},thresholdsPalette:{type:"stringArray",defaultValue:["#094b09","#2ebd40","#d5670b","#ffd84b"],description:"threshold colors, used with colorBy:identity"},thresholds:{type:"stringArray",defaultValue:["0.75","0.5","0.25","0"],description:"threshold breakpoints, used with colorBy:identity"}},{explicitlyTyped:!0}),te=n(93069),ne=n(95058),re=n(54131),ae=n(43103),ie=n(26794),oe=ie.t.parseCigar;function se(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.beginPath(),e.arc(t,n,a/2,0,2*Math.PI),r?e.fill():e.stroke()}var ce=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,A.Z)(L().mark((function e(t){var n,r,a;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager){e.next=3;break}throw new Error("No assembly manager provided");case 3:return e.next=5,(0,C.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:t.view.hview.displayedRegions,adapterConfig:t.adapterConfig});case 5:return t.view.hview.displayedRegions=e.sent.regions,e.next=8,(0,C.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:t.view.vview.displayedRegions,adapterConfig:t.adapterConfig});case 8:return t.view.vview.displayedRegions=e.sent.regions,e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"makeImageData",value:function(){var e=(0,A.Z)(L().mark((function e(t){var n,r,a,i,o,s,c,u,l,h,g,m,v,y,b,x,w,k,S,T,P,R,M,j;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.highResolutionScaling,a=void 0===r?1:r,i=t.width,o=t.height,s=t.config,c=t.views,u=(0,re.vL)(Math.ceil(i*a),o*a),l=u.getContext("2d"),h=(0,Z.readConfObject)(s,"color"),g=(0,Z.readConfObject)(s,"posColor"),m=(0,Z.readConfObject)(s,"negColor"),v=(0,Z.readConfObject)(s,"colorBy"),y=(0,Z.readConfObject)(s,"lineWidth"),l.lineWidth=y,l.scale(a,a),b=(0,d.Z)(c,2),x=b[0],w=b[1],k=x.dynamicBlocks.contentBlocks[0].offsetPx,S=w.dynamicBlocks.contentBlocks[0].offsetPx,T=[],P=x.bpPerPx,R=w.bpPerPx,M=(0,f.Z)((0,f.Z)({},(0,p.getSnapshot)(x)),{},{width:x.width}),j=(0,f.Z)((0,f.Z)({},(0,p.getSnapshot)(w)),{},{width:w.width}),null===(n=x.features)||void 0===n||n.forEach((function(e){var t,n,r,a,i,c=e.get("start"),u=e.get("end"),d=e.get("strand")||1,f=e.get("refName"),p=e.get("mate"),b=p.refName;if(-1===d){var x=[c,u];u=x[0],c=x[1]}if("identity"===v){for(var w=e.get("numMatches")/e.get("blockLen"),A=(0,Z.readConfObject)(s,"thresholds"),N=(0,Z.readConfObject)(s,"thresholdsPalette"),L=0;L<A.length;L++)if(w>+A[L]){i=N[L];break}}else if("mappingQuality"===v){var F=e.get("mappingQual");i="hsl(".concat(F,",50%,50%)")}else"strand"===v?i=-1===d?m:g:"default"===v?i=h:"callback"===v&&(i=(0,Z.readConfObject)(s,"color",{feature:e}));l.fillStyle=i,l.strokeStyle=i;var I=null===(t=(0,C.viewBpToPx)({self:M,refName:f,coord:c}))||void 0===t?void 0:t.offsetPx,B=null===(n=(0,C.viewBpToPx)({self:M,refName:f,coord:u}))||void 0===n?void 0:n.offsetPx,D=null===(r=(0,C.viewBpToPx)({self:j,refName:b,coord:p.start}))||void 0===r?void 0:r.offsetPx,E=null===(a=(0,C.viewBpToPx)({self:j,refName:b,coord:p.end}))||void 0===a?void 0:a.offsetPx;if(void 0!==I&&void 0!==B&&void 0!==D&&void 0!==E){var V=I-k,O=B-k,z=D-S,W=E-S;if(Math.abs(V-O)<=4&&Math.abs(z-W)<=4)se(l,V,o-z,!0,y);else{var H=V,q=z,U=e.get("cg")||e.get("CIGAR");if(U){var _=oe(U);l.beginPath(),l.moveTo(H,o-q);for(var G=0;G<_.length;G+=2){var J=+_[G],X=_[G+1];"M"===X||"="===X||"X"===X?(H+=J/P*d,q+=J/R):"D"===X||"N"===X?H+=J/P*d:"I"===X&&(q+=J/R)}l.lineTo(H,o-q),l.stroke()}else l.beginPath(),l.moveTo(V,o-z),l.lineTo(O,o-W),l.stroke()}}else T.length<=5&&T.push("feature at ".concat(f,":").concat(c,"-").concat(u," ").concat(b,":").concat(p.start,"-").concat(p.end," not plotted, fell outside of range ").concat(I," ").concat(B," ").concat(D," ").concat(E))})),T.length&&console.warn((T.length>5?"Many features fell outside the boundaries of the contigs.....sample of features: ":"Some features fell outside the boundaries of the contigs: ")+T.slice(0,5).join("\n")),e.abrupt("return",(0,re.MC)(u));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,A.Z)(L().mark((function e(t){var r,a,i,o,s,c,u,l,d,p,h;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,a=t.height,i=t.view,o=i.hview,s=i.vview,c=[r,a],u=[o,s].map((function(e,t){var n=T.create(e);return n.setVolatileWidth(c[t]),n})),l=u[0],e.next=6,this.getFeatures((0,f.Z)((0,f.Z)({},t),{},{regions:l.dynamicBlocks.contentBlocks}));case 6:return d=e.sent,l.setFeatures(d),e.next=10,this.makeImageData((0,f.Z)((0,f.Z)({},t),{},{views:u}));case 10:return p=e.sent,e.next=13,(0,te.Z)((0,ne.Z)(n.prototype),"render",this).call(this,(0,f.Z)((0,f.Z)({},t),{},{height:a,width:r,imageData:p}));case 13:return h=e.sent,e.abrupt("return",(0,f.Z)((0,f.Z)({},h),{},{imageData:p,height:a,width:r,offsetX:u[0].dynamicBlocks.blocks[0].offsetPx,offsetY:u[1].dynamicBlocks.blocks[0].offsetPx}));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ae.Z),ue=n(10901),le=n(42746),de=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="ComparativeRender",e}return(0,i.Z)(n,[{key:"renameRegionsIfNeeeded",value:function(){var e=(0,A.Z)(L().mark((function e(t,n){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.renameRegionsIfNeeded(t));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,A.Z)(L().mark((function e(t,r){var a,i,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.rendererType,i=this.pluginManager.getRendererType(a),e.t0=this,e.next=5,(0,te.Z)((0,ne.Z)(n.prototype),"serializeArguments",this).call(this,t,r);case 5:return e.t1=e.sent,e.t2=i,e.next=9,e.t0.renameRegionsIfNeeeded.call(e.t0,e.t1,e.t2);case 9:return o=e.sent,e.abrupt("return","MainThreadRpcDriver"===r?o:i.serializeArgsInClient(o));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,A.Z)(L().mark((function e(t,n){var r,a,i,o,s,c,u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t,"MainThreadRpcDriver"===n){e.next=5;break}return e.next=4,this.deserializeArguments(t,n);case 4:r=e.sent;case 5:if(i=(a=r).sessionId,o=a.rendererType,s=a.signal,i){e.next=8;break}throw new Error("must pass a unique session id");case 8:if((0,C.checkAbortSignal)(s),c=this.pluginManager.getRendererType(o)){e.next=12;break}throw new Error('renderer "'.concat(o,'" not found'));case 12:if(c.ReactComponent){e.next=14;break}throw new Error("renderer ".concat(o," has no ReactComponent, it may not be completely implemented yet"));case 14:if("MainThreadRpcDriver"!==n){e.next=20;break}return e.next=17,c.render(r);case 17:e.t0=e.sent,e.next=23;break;case 20:return e.next=22,c.renderInWorker(r);case 22:e.t0=e.sent;case 23:return u=e.t0,(0,C.checkAbortSignal)(s),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deserializeReturn",value:function(){var e=(0,A.Z)(L().mark((function e(t,r,a){var i,o,s;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,te.Z)((0,ne.Z)(n.prototype),"deserializeReturn",this).call(this,t,r,a);case 2:if(i=e.sent,"MainThreadRpcDriver"!==a){e.next=5;break}return e.abrupt("return",i);case 5:if(o=r.rendererType,s=this.pluginManager.getRendererType(o)){e.next=9;break}throw new Error('renderer "'.concat(o,'" not found'));case 9:if(s.ReactComponent){e.next=11;break}throw new Error("renderer ".concat(o," has no ReactComponent, it may not be completely implemented yet"));case 11:return e.abrupt("return",s.deserializeResultsInClient(i,r));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(n(71036).Z),fe=ie.t.parseCigar;function pe(e){for(var t=fe(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"D"!==i&&"N"!==i&&(n+=a)}return n}function he(e){for(var t=fe(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"D"!==i&&"N"!==i&&(n+=a)}return n}function ge(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}function me(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}function ve(e,t){var n=(0,C.getSession)(t);try{var a=e.get("CIGAR"),i=ge(a,1),o=e.get("flags"),s=e.get("strand"),c=e.get("name"),u="".concat(c,"_assembly_").concat(Date.now()),l=t.parentTrack,f=(0,Z.getConf)(l,"assemblyNames"),p=(0,d.Z)(f,1)[0],h=[p,u],g="track-".concat(Date.now()),m="".concat(c,"_vs_").concat(p),v=(function(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}(e,"SA")||"").split(";").filter((function(e){return!!e})).map((function(t,n){var r=t.split(","),a=(0,d.Z)(r,4),i=a[0],o=a[1],u=a[2],l=a[3],f=function(e){for(var t=fe(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"I"!==i&&(n+=a)}return n}(l),h=pe(l),g=he(l),m="-"===u?-1:1,v=ge(l,m*s),y=+o-1;return{refName:i,start:y,end:y+f,seqLength:h,clipPos:v,CIGAR:l,assemblyName:p,strand:s*m,uniqueId:"".concat(e.id(),"_SA").concat(n),mate:{start:v,end:v+g,refName:c}}})),y=e.toJSON();y.strand=1,y.mate={refName:c,start:i,end:i+he(a)};var b=pe(2048&o?v[0].CIGAR:a),x=[y].concat((0,r.Z)(v));x.sort((function(e,t){return e.clipPos-t.clipPos}));var w=x.reduce((function(e,t){return e+t.end-t.start}),0);n.addView("DotplotView",{type:"DotplotView",hview:{offsetPx:0,bpPerPx:w/800,displayedRegions:me(x.map((function(e,t){return{start:e.start,end:e.end,refName:e.refName,index:t,assemblyName:p}})))},vview:{offsetPx:0,bpPerPx:b/400,minimumBlockWidth:0,interRegionPaddingWidth:0,displayedRegions:[{assemblyName:u,start:0,end:b,refName:c}]},viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:h,adapter:{type:"FromConfigAdapter",features:x},trackId:g,name:m}],viewAssemblyConfigs:[{name:u,sequence:{type:"ReferenceSequenceTrack",trackId:"".concat(c,"_").concat(Date.now()),adapter:{type:"FromConfigSequenceAdapter",features:[e.toJSON()]}}}],assemblyNames:h,tracks:[{configuration:g,type:"SyntenyTrack",displays:[{type:"DotplotDisplay",configuration:"".concat(g,"-DotplotDisplay")}]}],displayName:"".concat(c," vs ").concat(p)})}catch(k){console.error(k),n.notify("".concat(k),"error")}}var ye=function(e){(0,o.Z)(c,e);var t=(0,s.Z)(c);function c(){var e;(0,a.Z)(this,c);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="DotplotPlugin",e}return(0,i.Z)(c,[{key:"install",value:function(e){!function(e){e.addViewType((function(){return new l.Z({name:"DotplotView",stateModel:M(e),ReactComponent:(0,u.lazy)((function(){return n.e(8012).then(n.bind(n,38012))}))})}))}(e),Y(e),function(e){e.addRendererType((function(){return new ce({name:"DotplotRenderer",configSchema:ee,ReactComponent:K,pluginManager:e})}))}(e),e.addRpcMethod((function(){return new de(e)})),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearPileupDisplay"===e.name){var t=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature;return n?[].concat((0,r.Z)(t()),[{label:"Dotplot of read vs ref",icon:ue.Z,onClick:function(){return ve(n,e)}}]):t()}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){(0,C.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Dotplot view",icon:le.Z,onClick:function(e){e.addView("DotplotView",{})}})}}]),c}(c.Z)},8512:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(93029),c=n(49767),u=n(40909),l=n(9077),d=(0,l.ConfigurationSchema)("Gff3TabixAdapter",{gffGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz",locationType:"UriLocation"}},index:(0,l.ConfigurationSchema)("Gff3TabixIndex",{indexType:{model:u.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff.gz.tbi",locationType:"UriLocation"}}}),dontRedispatch:{type:"stringArray",defaultValue:["chromosome","region"]}},{explicitlyTyped:!0}),f=n(97891),p=(0,l.ConfigurationSchema)("Gff3Adapter",{gffLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gff",locationType:"UriLocation"}}},{explicitlyTyped:!0}),h=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GFF3Plugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"Gff3TabixAdapter",configSchema:d,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7904),n.e(1032),n.e(4061),n.e(4526),n.e(1025)]).then(n.bind(n,58268)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3TabixAdapter",i=(0,f.getFileName)(t),o=n&&(0,f.getFileName)(n);return/\.gff3?\.b?gz$/i.test(i)||r===a?{type:a,bamLocation:t,gffGzLocation:t,index:{location:n||(0,f.makeIndex)(t,".tbi"),indexType:(0,f.makeIndexType)(o,"CSI","TBI")}}:e(t,n,r)}})),e.addAdapterType((function(){return new s.Z({name:"Gff3Adapter",configSchema:p,getAdapterClass:function(){return Promise.all([n.e(1032),n.e(6362),n.e(4526),n.e(9342)]).then(n.bind(n,59894)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="Gff3Adapter",i=(0,f.getFileName)(t),o={type:a,gffLocation:t};return/\.gff3?$/i.test(i)&&!r||r===a?o:e(t,n,r)}}))}}]),c}(c.Z)},17135:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return $}});var r=n(68079),a=n(33028),i=n(59740),o=n(96234),s=n(30969),c=n(90550),u=n(22714),l=n(24940),d=n(32343),f=n(28599),p=n(80975),h=n(22099),g=n(81073),m=n(53017),v=n(34762),y=n(28224),b=n(43175),x=n(1720),w=n(37574),k=(0,u.Z)((function(){return{container:{display:"flex",flexDirection:"row",margin:5},selectText:{marginRight:8,marginTop:10},flexItem:{marginRight:8}}}));var C=(0,c.observer)((function(e){var t=e.model,n=k(),r=t.assemblies,a=t.selectedAssembly,i=t.setSelectedAssembly,o=0===r.length;return(0,w.jsxs)("div",{className:n.container,children:[(0,w.jsx)(p.Z,{className:n.selectText,children:"Select assembly:"}),(0,w.jsx)(y.Z,{className:n.flexItem,disabled:o,children:(0,w.jsxs)(b.Z,{value:function(e){return"all"===e?"all":r.includes(e)?e:"none"}(a),onChange:function(e){return i(e.target.value)},children:[(0,w.jsx)(x.Z,{value:"none",children:"none"},"no-assembly"),(0,w.jsx)(x.Z,{value:"all",children:"all"},"all-assemblies"),r.map((function(e){return(0,w.jsx)(x.Z,{value:e,children:e},e)}))]})})]})})),Z=n(83483),S=n(64501),T=n(93138),P=n(53033),R=n(14008),M=(0,u.Z)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15}}}));var j=(0,c.observer)((function(e){var t=e.rowNumber,n=e.model,r=e.onClose,a=M(),i=n.removeBookmark;return(0,w.jsxs)(Z.Z,{open:void 0!==t,onClose:r,children:[(0,w.jsxs)(S.Z,{children:["Delete bookmark",(0,w.jsx)(d.Z,{className:a.closeDialog,"aria-label":"close-dialog",onClick:r,children:(0,w.jsx)(R.Z,{})})]}),(0,w.jsx)(T.Z,{children:(0,w.jsxs)(p.Z,{children:["Remove"," ",(0,w.jsx)("code",{children:void 0!==t?(0,g.assembleLocString)(n.bookmarkedRegions[t]):""})," ","?"]})}),(0,w.jsxs)(P.Z,{children:[(0,w.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:function(){r()},children:"Cancel"}),(0,w.jsx)(f.Z,{variant:"contained",color:"primary",onClick:function(){void 0!==t&&(i(t),r())},children:"Confirm"})]})]})})),A=n(75966),N=n(34795),L=n(77162),F=n.n(L),I=n(21918);function B(){return(B=(0,N.Z)(F().mark((function e(t,n,r){var a,i,o,s,c,u,l,d,f,p,h;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.selectedAssembly,i=n.find((function(e){return"LinearGenomeView"===e.type&&e.assemblyNames[0]===a})),!i){e.next=6;break}i.navToLocString(t),e.next=28;break;case 6:return o=(0,g.getSession)(r),s=o.assemblyManager,e.next=10,s.waitForAssembly(a);case 10:if(!(c=e.sent)){e.next=28;break}return e.prev=12,u=(0,g.parseLocString)(t,(function(e){return o.assemblyManager.isValidRefName(e,a)})),l=u.refName,d=c.regions,f=c.getCanonicalRefName(l),d&&(p=d.find((function(e){return e.refName===f}))),h=o.addView("LinearGenomeView",{displayName:a}),e.next=21,(0,g.when)((function(){return h.initialized}));case 21:h.setDisplayedRegions([JSON.parse(JSON.stringify(p))]),h.navToLocString(t),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(12),o.notify("".concat(e.t0),"error");case 28:case"end":return e.stop()}}),e,null,[[12,25]])})))).apply(this,arguments)}var D=(0,u.Z)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},flexItem:{margin:5},flexContainer:{display:"flex",justifyContent:"space-evenly",width:200}}}));var E=(0,c.observer)((function(e){var t=e.model,n=D(),r=(0,s.useState)(!1),a=(0,o.Z)(r,2),i=a[0],c=a[1],u=(0,s.useState)("BED"),l=(0,o.Z)(u,2),h=l[0],m=l[1],v=t.bookmarkedRegions;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{startIcon:(0,w.jsx)(A.Z,{}),onClick:function(){return c(!0)},children:"Download"}),(0,w.jsxs)(Z.Z,{open:i,onClose:function(){return c(!1)},children:[(0,w.jsx)(S.Z,{children:(0,w.jsx)(d.Z,{className:n.closeDialog,"aria-label":"close-dialog",onClick:function(){return c(!1)},children:(0,w.jsx)(R.Z,{})})}),(0,w.jsxs)(T.Z,{children:[(0,w.jsx)(p.Z,{children:"Format to download"}),(0,w.jsxs)(b.Z,{className:n.flexItem,"data-testid":"selectFileType",value:h,onChange:function(e){return m(e.target.value)},children:[(0,w.jsx)(x.Z,{value:"BED",children:"BED"}),(0,w.jsx)(x.Z,{value:"TSV",children:"TSV"})]})]}),(0,w.jsxs)(P.Z,{children:[(0,w.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:function(){return c(!1)},children:"Cancel"}),(0,w.jsx)(f.Z,{className:n.flexItem,"data-testid":"dialogDownload",variant:"contained",color:"primary",startIcon:(0,w.jsx)(A.Z,{}),onClick:function(){!function(e,t,n){var r,a=n.selectedAssembly,i="TSV"===t?"chrom\tstart\tend\tlabel\tassembly_name\tcoord_range\n":"",o=e.map((function(e){var n=e.label,r=""===n?".":n,i=(0,g.assembleLocString)(e);return"BED"===t?e.assemblyName===a||"all"===a?"".concat(e.refName,"\t").concat(e.start,"\t").concat(e.end,"\t").concat(r.slice(0,255),"\n"):"":"".concat(e.refName,"\t").concat(e.start+1,"\t").concat(e.end,"\t").concat(r,"\t").concat(e.assemblyName,"\t").concat(i,"\n")})).reduce((function(e,t){return e+t}),i),s=new Blob([o||""],{type:"BED"===t?"text/x-bed;charset=utf-8":"text/tab-separated-values;charset=utf-8"});r="BED"===t?"jbrowse_bookmarks_".concat(a,".bed"):"jbrowse_bookmarks.tsv",(0,I.saveAs)(s,r)}(v,h,t),c(!1)},children:"Download"})]})]})]})})),V=n(84291),O=n(24998),z=n(33528),W=n(18765),H=(0,u.Z)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15},flexItem:{margin:5}}}));var q=(0,c.observer)((function(e){var t=e.model,n=e.assemblyName,r=H(),a=(0,g.getSession)(t),i=a.assemblyNames,c=(0,s.useState)(!1),u=(0,o.Z)(c,2),l=u[0],h=u[1],m=(0,s.useState)(),v=(0,o.Z)(m,2),y=v[0],b=v[1],x=(0,s.useState)(),k=(0,o.Z)(x,2),C=k[0],M=k[1],j=(0,s.useState)(n||i[0]),A=(0,o.Z)(j,2),L=A[0],I=A[1];return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{startIcon:(0,w.jsx)(W.Z,{}),onClick:function(){return h(!0)},children:"Import"}),(0,w.jsxs)(Z.Z,{open:l,onClose:function(){return h(!1)},maxWidth:"xl",children:[(0,w.jsxs)(S.Z,{children:["Import bookmarks",(0,w.jsx)(d.Z,{className:r.closeDialog,"aria-label":"close-dialog",onClick:function(){return h(!1)},children:(0,w.jsx)(R.Z,{})})]}),(0,w.jsxs)(T.Z,{children:[(0,w.jsx)(p.Z,{children:"Choose a BED format file to import. The first 4 columns will be used"}),(0,w.jsx)(O.FileSelector,{location:y,setLocation:b,name:"File"}),(0,w.jsx)(p.Z,{children:"Select assembly that your data belongs to"}),(0,w.jsx)(V.Z,{onChange:function(e){return I(e)},session:a,selected:L}),C?(0,w.jsx)(p.Z,{color:"error",variant:"h6",children:"".concat(C)}):null]}),(0,w.jsxs)(P.Z,{children:[(0,w.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:function(){return h(!1)},children:"Cancel"}),(0,w.jsx)(f.Z,{className:r.flexItem,"data-testid":"dialogImport",variant:"contained",color:"primary",disabled:!y,startIcon:(0,w.jsx)(W.Z,{}),onClick:(0,N.Z)(F().mark((function e(){var n,r;return F().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,(0,z.openLocation)(y).readFile("utf8");case 5:n=e.sent,r=n.split("\n").filter((function(e){return!!e.trim()})).filter((function(e){return!e.startsWith("#")&&!e.startsWith("track")&&!e.startsWith("browser")})).map((function(e){var t=e.split("\t"),n=(0,o.Z)(t,4),r=n[0],a=n[1],i=n[2],s=n[3];return{assemblyName:L,refName:r,start:+a,end:+i,label:"."===s?void 0:s}})),t.importBookmarks(r),h(!1),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),M(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),children:"Import"})]})]})]})})),U=n(42377),_=(0,u.Z)((function(){return{closeDialog:{position:"absolute",right:0,top:0},dialogContainer:{margin:15}}}));var G=(0,c.observer)((function(e){var t=e.model,n=_(),r=(0,s.useState)(!1),a=(0,o.Z)(r,2),i=a[0],c=a[1],u=t.clearAllBookmarks;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(f.Z,{startIcon:(0,w.jsx)(U.Z,{}),"aria-label":"clear bookmarks",onClick:function(){return c(!0)},children:"Clear"}),(0,w.jsxs)(Z.Z,{open:i,onClose:function(){return c(!1)},children:[(0,w.jsxs)(S.Z,{children:["Clear bookmarks",(0,w.jsx)(d.Z,{className:n.closeDialog,"aria-label":"close-dialog",onClick:function(){return c(!1)},children:(0,w.jsx)(R.Z,{})})]}),(0,w.jsx)(T.Z,{children:(0,w.jsx)(p.Z,{children:"Clear all bookmarks? Note this will clear bookmarks for all assemblies"})}),(0,w.jsxs)(P.Z,{children:[(0,w.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:function(){c(!1)},children:"Cancel"}),(0,w.jsx)(f.Z,{variant:"contained",color:"primary",onClick:function(){u(),c(!1)},children:"Confirm"})]})]})]})})),J=["assemblyName"],X=(0,u.Z)((function(){return{link:{cursor:"pointer"}}})),Y=function(e,t){return Math.min(Math.max((0,g.measureText)(String(e[t]),14)+20,80),1e3)},Q=(0,c.observer)((function(e){var t=e.compact,n=e.model,c=X(),u=(0,s.useState)(),f=(0,o.Z)(u,2),p=f[0],v=f[1],y=n.bookmarkedRegions,b=n.selectedAssembly,x=(0,g.getSession)(n).views,k=y.toJS().filter((function(e){return"all"===b||e.assemblyName===b})).map((function(e,t){e.assemblyName;var n=(0,i.Z)(e,J);return(0,a.Z)((0,a.Z)({},e),{},{id:t,delete:t,locString:(0,g.assembleLocString)("all"===b?e:n)})})),C=[{field:"locString",headerName:"bookmark link",width:Math.max.apply(Math,(0,r.Z)(k.map((function(e){return Y(e,"locString")})))),renderCell:function(e){var t=e.value;return(0,w.jsx)(l.Z,{className:c.link,onClick:function(e){!function(e,t,n){B.apply(this,arguments)}(t,x,n),e.preventDefault()},children:t})}},{field:"label",width:Math.max(100,Math.max.apply(Math,(0,r.Z)(k.map((function(e){return Y(e,"label")}))))),editable:!0},{field:"delete",width:30,renderCell:function(e){var t=e.value;return(0,w.jsx)(d.Z,{"data-testid":"deleteBookmark","aria-label":"delete",onClick:function(){null!==t&&void 0!==t&&v(+t)},children:(0,w.jsx)(m.Z,{})})}}];return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(h.DataGrid,{rows:k,rowHeight:t?25:void 0,headerHeight:t?25:void 0,columns:C,onCellEditCommit:function(e){var t=e.value,r=e.id;n.updateBookmarkLabel(r,t)},disableSelectionOnClick:!0}),(0,w.jsx)(j,{rowNumber:p,model:n,onClose:function(){return v(void 0)}})]})}));var $=(0,c.observer)((function(e){var t=e.model,n=t.selectedAssembly,r=(0,s.useState)(!1),a=(0,o.Z)(r,2),i=a[0],c=a[1];return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(C,{model:t}),(0,w.jsx)(E,{model:t}),(0,w.jsx)(q,{model:t,assemblyName:n}),(0,w.jsx)(G,{model:t}),(0,w.jsx)(f.Z,{startIcon:(0,w.jsx)(v.Z,{}),onClick:function(){return c(!i)},children:"Compact"}),(0,w.jsx)("div",{style:{margin:12},children:(0,w.jsxs)(p.Z,{children:["Note: you can double click the ",(0,w.jsx)("code",{children:"label"})," field to add your own custom notes"]})}),(0,w.jsx)("div",{style:{height:750,width:"100%"},children:(0,w.jsx)(Q,{model:t,compact:i})})]})}))},73212:function(e,t,n){"use strict";n.d(t,{Z:function(){return x}});var r=n(68079),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(30969),u=n(50166),l=n(78958),d=n(66737),f=n(49767),p=n(81073),h=n(9077),g=(n(17135),n(40909)),m=n(29206),v=g.types.compose(m.Region,g.types.model("Label",{label:g.types.optional(g.types.string,"")})).actions((function(e){return{setLabel:function(t){e.label=t}}}));function y(e){return g.types.model("GridBookmarkModel",{id:m.ElementId,type:g.types.literal("GridBookmarkWidget"),view:g.types.safeReference(e.pluggableMstType("view","stateModel")),bookmarkedRegions:g.types.array(v),modelSelectedAssembly:""}).actions((function(e){return{importBookmarks:function(t){e.bookmarkedRegions=(0,g.cast)(e.bookmarkedRegions.concat(t))},addBookmark:function(t){e.bookmarkedRegions.push(t)},removeBookmark:function(t){e.bookmarkedRegions.splice(t,1)},clearAllBookmarks:function(){e.bookmarkedRegions.clear()},updateBookmarkLabel:function(t,n){var r;null===(r=e.bookmarkedRegions[t])||void 0===r||r.setLabel(n)},setSelectedAssembly:function(t){e.modelSelectedAssembly=t}}})).views((function(e){return{get selectedAssembly(){return e.modelSelectedAssembly||(e.bookmarkedRegions.length?e.bookmarkedRegions[0].assemblyName:"")},get assemblies(){return(0,r.Z)(new Set(e.bookmarkedRegions.map((function(e){return e.assemblyName}))))}}}))}var b=(0,h.ConfigurationSchema)("GridBookmarkWidget",{}),x=function(e){(0,o.Z)(f,e);var t=(0,s.Z)(f);function f(){var e;(0,a.Z)(this,f);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="GridBookmarkPlugin",e}return(0,i.Z)(f,[{key:"install",value:function(e){e.addWidgetType((function(){return new d.Z({name:"GridBookmarkWidget",heading:"Bookmarked regions",configSchema:b,stateModel:y(e),ReactComponent:(0,c.lazy)((function(){return Promise.resolve().then(n.bind(n,17135))}))})})),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearGenomeView"===e.name){var t=e.stateModel.extend((function(e){var t=e.menuItems,n=e.rubberBandMenuItems;return{actions:{activateBookmarkWidget:function(){var t=(0,p.getSession)(e);if((0,p.isSessionModelWithWidgets)(t)){var n=t.widgets.get("GridBookmark");return n||(n=t.addWidget("GridBookmarkWidget","GridBookmark",{view:e})),t.showWidget(n),n}throw new Error("Could not open bookmark widget")},bookmarkCurrentRegion:function(){var t=e.getSelectedRegions(e.leftOffset,e.rightOffset)[0],n=(0,p.getSession)(e);if((0,p.isSessionModelWithWidgets)(n)){var r=n.widgets,a=r.get("GridBookmark");a||(this.activateBookmarkWidget(),a=r.get("GridBookmark")),a.addBookmark(t)}}},views:{menuItems:function(){return[].concat((0,r.Z)(t()),[{type:"divider"},{label:"Open bookmark widget",icon:l.Z,onClick:e.activateBookmarkWidget},{label:"Bookmark current region",icon:u.Z,onClick:e.bookmarkCurrentRegion}])},rubberBandMenuItems:function(){return[].concat((0,r.Z)(n()),[{label:"Bookmark region",icon:u.Z,onClick:function(){var t=e.leftOffset,n=e.rightOffset,r=e.getSelectedRegions(t,n)[0],a=(0,p.getSession)(e);if((0,p.isSessionModelWithWidgets)(a)){var i=a.widgets,o=i.get("GridBookmark");o||(e.activateBookmarkWidget(),o=i.get("GridBookmark")),o.addBookmark(r)}}}])}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){}}]),f}(f.Z)},81919:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(93029),c=n(49767),u=(0,n(9077).ConfigurationSchema)("GtfAdapter",{gtfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.gtf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),l=n(97891),d=function(e){(0,i.Z)(c,e);var t=(0,o.Z)(c);function c(){var e;(0,r.Z)(this,c);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="GTFPlugin",e}return(0,a.Z)(c,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"GtfAdapter",configSchema:u,getAdapterClass:function(){return Promise.all([n.e(1032),n.e(6362),n.e(2687)]).then(n.bind(n,74375)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="GtfAdapter",i=(0,l.getFileName)(t),o={type:a,gtfLocation:t};return/\.gtf(\.gz)?$/i.test(i)&&!r||r===a?o:e(t,n,r)}}))}}]),c}(c.Z)},74307:function(e,t,n){"use strict";n.d(t,{Z:function(){return O}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(9077),c=n(93029),u=n(81575),l=n(59853),d=n(82044),f=n(49767),p=n(89058),h=n(33028),g=n(24998),m=n(90550),v=(n(30969),n(37574));var y=(0,m.observer)((function(e){var t=e.width,n=e.height,r=Math.ceil(t);return(0,v.jsx)("div",{className:"PileupRendering",style:{position:"relative",width:r,height:n},children:(0,v.jsx)(g.PrerenderedCanvas,(0,h.Z)((0,h.Z)({},e),{},{style:{position:"absolute",left:0,top:0}}))})})),b=(0,s.ConfigurationSchema)("HicRenderer",{baseColor:{type:"color",description:"base color to be used in the hic alignment",defaultValue:"#f00"},color:{type:"color",description:"the color of each feature in a hic alignment",defaultValue:"jexl:colorString(hsl(alpha(baseColor,min(1,count/(maxScore/20)))))",contextVariable:["count","maxScore","baseColor"]},maxHeight:{type:"integer",description:"the maximum height to be used in a hic rendering",defaultValue:600}},{explicitlyTyped:!0}),x=n(96234),w=n(34795),k=n(93069),C=n(95058),Z=n(77162),S=n.n(Z),T=n(8218),P=n.n(T),R=n(67688),M=n(81073),j=n(31385),A=n(26080),N=n(3011),L=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,a.Z)(n,[{key:"makeImageData",value:function(){var e=(0,w.Z)(S().mark((function e(t,n){var r,a,i,o,c,u,l,d,f,p,h,g,m,v,y,b,x,w,k,C,Z,T,R,j,A,L,F;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.features,a=n.config,i=n.bpPerPx,o=n.signal,c=n.resolution,u=n.sessionId,l=n.adapterConfig,e.next=3,(0,N.uP)(this.pluginManager,u,l);case 3:return d=e.sent,f=d.dataAdapter,e.next=7,f.getResolution(i/c);case 7:if(p=e.sent,h=p/(i*Math.sqrt(2)),g=P()((0,s.readConfObject)(a,"baseColor")),!r.length){e.next=34;break}return m=r[0].bin1,v=0,y=0,b=0,e.next=17,(0,M.abortBreakPoint)(o);case 17:for(x=0;x<r.length;x++)w=r[x],k=w.bin1,C=w.bin2,Z=w.counts,v=Math.max(Z,v),y=Math.min(Math.min(k,C),y),b=Math.max(Math.max(k,C),b);return e.next=20,(0,M.abortBreakPoint)(o);case 20:t.rotate(-Math.PI/4),T=Date.now(),R=0;case 23:if(!(R<r.length)){e.next=34;break}if(j=r[R],A=j.bin1,L=j.bin2,F=j.counts,t.fillStyle=(0,s.readConfObject)(a,"color",{count:F,maxScore:v,baseColor:g}),t.fillRect((A-m)*h,(L-m)*h,h,h),!(+Date.now()-T>400)){e.next=31;break}return e.next=30,(0,M.abortBreakPoint)(o);case 30:T=+Date.now();case 31:R++,e.next=23;break;case 34:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,w.Z)(S().mark((function e(t){var r,a,i,o,c,u,l,d,f,p,g=this;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.config,a=t.regions,i=t.bpPerPx,o=(0,x.Z)(a,1),c=o[0],u=(c.end-c.start)/i,l=(0,s.readConfObject)(r,"maxHeight"),e.next=6,this.getFeatures(t);case 6:return d=e.sent,e.next=9,(0,j.C)(u,l,t,(function(e){return g.makeImageData(e,(0,h.Z)((0,h.Z)({},t),{},{features:d}))}));case 9:return f=e.sent,e.next=12,(0,k.Z)((0,C.Z)(n.prototype),"render",this).call(this,(0,h.Z)((0,h.Z)((0,h.Z)({},t),f),{},{features:d,region:t.regions[0],height:l,width:u}));case 12:return p=e.sent,e.abrupt("return",(0,h.Z)((0,h.Z)((0,h.Z)({},p),f),{},{height:l,width:u}));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(){var e=(0,w.Z)(S().mark((function e(t){var n,r,a,i,o,s;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.regions,r=t.sessionId,a=t.adapterConfig,e.next=3,(0,N.uP)(this.pluginManager,r,a);case 3:return i=e.sent,o=i.dataAdapter,e.next=7,o.getFeatures(n[0],t).pipe((0,A.q)()).toPromise();case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(R.default),F=function(e){var t=e.getRendererType("HicRenderer").configSchema;return(0,s.ConfigurationSchema)("LinearHicDisplay",{renderer:t},{baseConfiguration:p.fU,explicitlyTyped:!0})},I=n(68079),B=n(40909),D=function(e){return B.types.compose("LinearHicDisplay",p.fV,B.types.model({type:B.types.literal("LinearHicDisplay"),configuration:(0,s.ConfigurationReference)(e),resolution:B.types.optional(B.types.number,1)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get rendererTypeName(){return"HicRenderer"},renderProps:function(){var n=e.rendererType.configSchema.create((0,s.getConf)(e,"renderer")||{},(0,B.getEnv)(e));return(0,h.Z)((0,h.Z)({},t()),{},{config:n,rpcDriverName:e.rpcDriverName,displayModel:e,resolution:e.resolution})}}})).actions((function(e){return{setResolution:function(t){e.resolution=t}}})).views((function(e){var t=e.trackMenuItems;return{trackMenuItems:function(){return[].concat((0,I.Z)(t()),[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(2*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/2)}}]}])}}}))},E=(0,s.ConfigurationSchema)("HicAdapter",{hicLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.hic",locationType:"UriLocation"}}},{explicitlyTyped:!0}),V=n(97891),O=function(e){(0,i.Z)(f,e);var t=(0,o.Z)(f);function f(){var e;(0,r.Z)(this,f);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="HicPlugin",e}return(0,a.Z)(f,[{key:"install",value:function(e){e.addAdapterType((function(){return new c.Z({name:"HicAdapter",configSchema:E,getAdapterClass:function(){return Promise.all([n.e(1754),n.e(5758)]).then(n.bind(n,43212)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="HicAdapter",i=(0,V.getFileName)(t),o={type:a,hicLocation:t};return/\.hic/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"HicAdapter"===t?"HicTrack":e(t)}})),e.addRendererType((function(){return new L({name:"HicRenderer",ReactComponent:y,configSchema:b,pluginManager:e})})),e.addTrackType((function(){var t=(0,s.ConfigurationSchema)("HicTrack",{},{baseConfiguration:(0,l.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new d.Z({name:"HicTrack",configSchema:t,stateModel:(0,l.createBaseTrackModel)(e,"HicTrack",t)})})),e.addDisplayType((function(){var t=F(e);return new u.Z({name:"LinearHicDisplay",configSchema:t,stateModel:D(t),trackType:"HicTrack",viewType:"LinearGenomeView",ReactComponent:p.qb})}))}},{key:"configure",value:function(e){e.jexl.addFunction("alpha",(function(e,t){return e.alpha(t)})),e.jexl.addFunction("hsl",(function(e){return e.hsl()})),e.jexl.addFunction("colorString",(function(e){return e.string()}))}}]),f}(f.Z)},1945:function(e,t,n){"use strict";n.d(t,{Z:function(){return le}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(93029),c=n(31145),u=n(58096),l=n(49767),d=n(9077),f=(0,d.ConfigurationSchema)("NCListAdapter",{rootUrlTemplate:{type:"fileLocation",defaultValue:{uri:"/path/to/my/{refseq}/trackData.json",locationType:"UriLocation"}},refNames:{type:"stringArray",defaultValue:[],description:"List of refNames used by the NCList used for aliasing"}},{explicitlyTyped:!0}),p=n(68079),h=n(34795),g=n(77162),m=n.n(g),v=n(29598),y=n(52185),b=n(10326),x=n.n(b),w=n(49882).Buffer,k=function(){function e(t){(0,r.Z)(this,e),this.url=void 0,this.url=/\/$/.test(t.url)?t.url:"".concat(t.url,"/")}return(0,a.Z)(e,[{key:"readMeta",value:function(){var e=(0,h.Z)(m().mark((function e(){var t,n,r,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadFile("meta.json");case 2:return t=e.sent,n=t.compress,r=t.track_names,a=Math.ceil(t.hash_bits/4),e.abrupt("return",{hashHexCharacters:a,compress:n,tracks:r});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHashHexCharacters",value:function(){var e=(0,h.Z)(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.hashHexCharacters);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCompress",value:function(){var e=(0,h.Z)(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.compress);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrackNames",value:function(){var e=(0,h.Z)(m().mark((function e(){var t;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readMeta();case 2:return t=e.sent,e.abrupt("return",t.tracks);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,h.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBucket(t);case 2:return n=e.sent,e.abrupt("return",n[t]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBucket",value:function(){var e=(0,h.Z)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.hash(t),e.next=3,this.hexToDirPath(n);case 3:return r=e.sent,e.abrupt("return",this.loadFile(r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFile",value:function(){var e=(0,h.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(this.url).concat(t));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error("HTTP ".concat(n.status," ").concat(n.statusText));case 5:return e.abrupt("return",n.json());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hexToDirPath",value:function(){var e=(0,h.Z)(m().mark((function e(t){var n,r,a,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getHashHexCharacters();case 2:if(!(n=e.sent)){e.next=12;break}return e.next=6,this.getCompress();case 6:for(r=e.sent;t.length<8;)t="0".concat(t);for(t=t.substr(8-n),a=[],i=0;i<t.length;i+=3)a.push(t.substring(i,i+3));return e.abrupt("return","".concat(a.join("/"),".json").concat(r?"z":""));case 12:return e.abrupt("return","");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hash",value:function(e){return x()(w.from(e)).toString("hex").toLowerCase().replace("-","n")}}]),e}(),C=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).httpMap=void 0,o.tracksNames=void 0;var s=(0,d.readConfObject)(e,"namesIndexLocation");if(!s)throw new Error("must provide namesIndexLocation");return o.httpMap=new k({url:s.baseUri?new URL(s.uri,s.baseUri).href:s.uri}),o}return(0,a.Z)(n,[{key:"loadIndexFile",value:function(){var e=(0,h.Z)(m().mark((function e(t){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpMap.getBucket(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchIndex",value:function(){var e=(0,h.Z)(m().mark((function e(t){var n,r,a,i;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.searchType,r=t.queryString,e.t0=this.tracksNames,e.t0){e.next=6;break}return e.next=5,this.httpMap.getTrackNames();case 5:e.t0=e.sent;case 6:return a=e.t0,e.next=9,this.loadIndexFile(r.toLowerCase());case 9:if(!(i=e.sent)[r]){e.next=12;break}return e.abrupt("return",this.formatResults(i[r],a,n));case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"formatResults",value:function(e,t,n){return[].concat((0,p.Z)("exact"===n?[]:e.prefix.map((function(e){return new y.Z({label:"object"===typeof e?e.name:e,matchedAttribute:"name",matchedObject:{result:e}})}))),(0,p.Z)(e.exact.map((function(e){var n=e[0],r=e[1],a=e[3],i=e[4],o=e[5],s="".concat(a||n,":").concat(i,"-").concat(o);return new y.Z({locString:s,label:n,matchedAttribute:"name",matchedObject:e,trackId:t[r]})})))).filter((function(e){return"too many matches"!==e.getLabel()}))}},{key:"freeResources",value:function(){}}]),n}(v.BaseAdapter),Z=(0,d.ConfigurationSchema)("JBrowse1TextSearchAdapter",{namesIndexLocation:{type:"fileLocation",defaultValue:{uri:"/volvox/names",locationType:"UriLocation"},description:"the location of the JBrowse1 names index data directory"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),S=n(97891),T=n(81073),P=n(59853),R=n(40909),M=(0,d.ConfigurationSchema)("JBrowse1Connection",{dataDirLocation:{type:"fileLocation",defaultValue:{uri:"http://mysite.com/jbrowse/data/",locationType:"UriLocation"},description:"the location of the JBrowse 1 data directory, often something like http://mysite.com/jbrowse/data/"},assemblyNames:{description:"name of the assembly the connection belongs to, should be a single entry",type:"stringArray",defaultValue:[]}},{baseConfiguration:P.baseConnectionConfig}),j=n(56666),A=n(33528),N=n(33028),L=n(96234),F=n(78560),I=n.n(F),B=n(20815),D=n.n(B);function E(e){return e&&e.label&&"string"===typeof e.label}function V(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?V(e[a],t[a]):"undefined"!==typeof e[a]&&"undefined"===typeof t[a]||(e[a]=t[a])}return e}function O(e){if(!e||"object"!==typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,n,r;if(Array.isArray(e))for(t=[],n=0,r=e.length;n<r;++n)n in e&&(t[n]=O(e[n]));else t=e.constructor?new e.constructor:{};return function(e,t,n){var r,a,i={};for(r in t)a=t[r],r in e&&(e[r]===a||r in i&&i[r]===a)||(e[r]=n?n(a):a);return e}(t,e,O)}function z(e,t){if("string"===typeof e){var n;try{n=JSON.parse(e)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return H(n,t)}return H(e,t)}function W(e,t){var n;try{n=function(e,t){var n,r,a,i,o=[],s={tracks:{}};function c(){var e;if(void 0!==a)try{var c=a.match(/^json:(.+)/i);if(e=c?JSON.parse(c[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(a)?parseFloat(a.replace(/,/g,"")):a,!n)throw new Error("Error parsing in section ".concat(o.join(" - ")));var u=o.concat(n).join(".");if("+="===r){var l=I()(s,u);l?Array.isArray(l)||(l=[l]):l=[],l.push(e),e=l}"true"===e&&(e=!0),"false"===e&&(e=!1),D()(s,u,e)}catch(d){throw new Error("syntax error".concat(t?" in ".concat(t):"").concat(i?" at line ".concat(i-1):""))}}return e.split("\n").forEach((function(e,t){i=t+1;var s,u=e.replace(/^\s*#.+/,"");if(s=u.match(/^\s*\[([^\]]+)/))c(),n=void 0,a=void 0,1===(o=s[1].trim().split(/\s*\.\s*/)).length&&"general"===o[0].toLowerCase()&&(o=[]);else if(s=u.match(void 0===a?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/)){c(),n=s[1].trim().split(/\s*\.\s*/);var l=s,d=(0,L.Z)(l,3);r=d[2],function(e){if("include"===e)return!0;return!1}(o.concat(n).join("."))&&(r="+="),a=s[3].trim()}else void 0!==n&&(s=u.match(/^\s{0,4}\+\s*(.+)/))?(c(),r="+=",a=s[1].trim()):void 0!==a&&(s=u.match(/^\s+(\S.*)/))?a+=a.length?" ".concat(s[1].trim()):s[1].trim():(c(),n=void 0,a=void 0)})),c(),s}(e,t)}catch(r){throw new Error("".concat(r," when parsing configuration."))}return H(n,t)}function H(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(E(e.tracks))e.tracks=[e.tracks];else{for(var n=[],r=0,a=Object.keys(e.tracks);r<a.length;r++){var i=a[r],o=e.tracks[i];E(o)?n.push(o):n.push((0,N.Z)({label:i},o))}e.tracks=n}var s,c=e.trackMetadata;if(c&&c.sources){if("string"===typeof c.sources&&(c.sources=[c.sources]),(s=c.sources)&&s.url&&"string"===typeof s.url&&(c.sources=[c.sources]),!Array.isArray(c.sources)){for(var u=[],l=0,d=Object.keys(c.sources);l<d.length;l++){var f=d[l],h=c.sources[f];"name"in h||(h.name=f),u.push(h)}c.sources=u}c.sources=c.sources.map((function(e){if("string"===typeof e){var t={url:e},n=e.match(/\.(\w+)$/);return n&&(t.type=n[1].toLowerCase()),t}return e}))}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){var g=[];e.tracks&&g.push.apply(g,(0,p.Z)(e.tracks)),e.stores&&g.push.apply(g,(0,p.Z)(Object.values(e.stores))),e.names&&g.push(e.names),g.forEach((function(t){t.baseUrl||(t.baseUrl=e.baseUrl||"/")})),e.refSeqs&&"string"===typeof e.refSeqs&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}return e.stores=e.stores||{},(e.tracks||[]).forEach((function(t){if(t.config){var n=t.config;delete t.config,t=(0,N.Z)((0,N.Z)({},n),t)}var r;t.store||(r="FeatureTrack"===t.type?"JBrowse/View/Track/HTMLFeatures":"ImageTrack"===t.type?"JBrowse/View/Track/FixedImage":"ImageTrack.Wiggle"===t.type?"JBrowse/View/Track/FixedImage/Wiggle":"SequenceTrack"===t.type?"JBrowse/View/Track/Sequence":q("JBrowse/View/Track",t.type),t.type=r,U(e,t),t.histograms&&(t.histograms.baseUrl||(t.histograms.baseUrl=t.baseUrl),U(e,t.histograms)))})),e}function q(e,t){return t?(t.includes("/")||(t="".concat(e,"/").concat(t)),t=t.replace(/^\//,"")):""}function U(e,t){var n,r=t.urlTemplate,a=void 0===r?"":r;if(n=t.storeClass?q("JBrowse/Store",t.storeClass):function(e,t){return e?e.type&&e.type.includes("/FixedImage")?"JBrowse/Store/TiledImage/Fixed".concat(0===e.backendVersion?"_v0":""):/\.jsonz?$/i.test(t)?"JBrowse/Store/SeqFeature/NCList".concat(0===e.backendVersion?"_v0":""):/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":e.type&&e.type.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}(t,a),n){var i=(0,N.Z)((0,N.Z)({},t),{},{type:n});"JBrowse/Store/Sequence/StaticChunked"!==n&&"JBrowse/Store/Sequence/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/IndexedFasta"!==n&&"JBrowse/Store/SeqFeature/BgzipIndexedFasta"!==n&&"JBrowse/Store/SeqFeature/TwoBit"!==n&&"JBrowse/Store/Sequence/TwoBit"!==n&&!t.useAsRefSeqStore||e.stores&&e.stores.refseqs?i.name="store".concat((0,T.objectHash)(i)):i.name="refseqs",e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}else console.warn("Unable to determine an appropriate data store to use with track '".concat(t.label,"', please explicitly specify a storeClass in the configuration."))}function _(e){return void 0!==e.uri}function G(e){return void 0!==e.localPath}function J(){return J=(0,h.Z)(m().mark((function e(){var t,n,r,a,i,o,s,c,u,l,d,f,p,h,g=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.length>0&&void 0!==g[0]?g[0]:{uri:"",locationType:"UriLocation"},n=g.length>1&&void 0!==g[1]?g[1]:{include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r=g.length>2&&void 0!==g[2]?g[2]:{uri:"",locationType:"UriLocation"},a="uri"in t?"uri":"localPath",i=JSON.parse(JSON.stringify(t)),o="",_(t)&&(o=t.uri),G(t)&&(o=t.localPath),o.endsWith("/")&&(i[a]=o.slice(0,o.length-1)),!(_(r)&&r.uri||G(r)&&r.localPath)){e.next=35;break}s="uri"in r?"uri":"localPath",c="",_(r)&&(c=r.uri),G(r)&&(c=r.localPath),c.endsWith("/")&&(c=c.slice(0,c.length-1)),u={},l=0,d=["jbrowse.conf","jbrowse_conf.json"];case 17:if(!(l<d.length)){e.next=33;break}return f=d[l],p=null,e.prev=20,e.next=23,Q((0,j.Z)({},s,"".concat(c,"/").concat(f)));case 23:p=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(20),console.error("tried to access ".concat(c,"/").concat(f,", but failed"));case 29:u=ee(u,p)||{};case 30:l++,e.next=17;break;case 33:return i[a]&&(u.dataRoot=i[a]),e.abrupt("return",X(u));case 35:return h=H(n,window.location.href),i[a]&&(h.dataRoot=i[a]),e.abrupt("return",X(h));case 38:case"end":return e.stop()}}),e,null,[[20,26]])}))),J.apply(this,arguments)}function X(e){return Y.apply(this,arguments)}function Y(){return Y=(0,h.Z)(m().mark((function e(t){var n,r,a,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:oe,r=V(O(n),t),e.next=4,ne(r);case 4:return ie(a=ee(a=e.sent,t)||a,a),se(a),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function Q(e){return $.apply(this,arguments)}function $(){return($=(0,h.Z)(m().mark((function e(t){var n;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.openLocation)(t).readFile("utf8");case 2:if(n=e.sent,!_(t)){e.next=5;break}return e.abrupt("return",K(n,t.uri));case 5:if(!G(t)){e.next=7;break}return e.abrupt("return",K(n,t.localPath));case 7:return e.abrupt("return",K(n));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.trim().startsWith("{")?z(e,t):W(e,t)}function ee(e,t){if(null===t)return null;null===e&&(e={});for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("tracks"===a&&a in e){var i=e[a]||[],o=t[a]||[];if(!Array.isArray(i)||!Array.isArray(o))throw new Error("Track config has not been properly regularized: ".concat(i," ").concat(o));e[a]=te(i||[],o||[])}else"datasets"!==a&&a in e&&"object"===typeof t[a]&&"object"===typeof e[a]?e[a]=V(e[a],t[a]):"dataRoot"===a?(void 0===e[a]||"data"===e[a]&&void 0!==t[a])&&(e[a]=t[a]):void 0!==e[a]&&void 0===t[a]||(e[a]=t[a])}return e}function te(e,t){if(!t.length)return e;var n={};return e.forEach((function(e,t){e.index=t,n[e.label]=e})),t.forEach((function(t){var r=n[t.label];r?ee(r,t):e.push(t)})),e}function ne(e){return re.apply(this,arguments)}function re(){return re=(0,h.Z)(m().mark((function e(t){var n,r;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return r=(0,h.Z)(m().mark((function e(r,a){var i,o,s,c;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.sourceUrl||r.baseUrl){e.next=3;break}throw new Error("Could not determine source URL: ".concat(JSON.stringify(r)));case 3:if(o=ee(O(a),r)){e.next=6;break}throw new Error("Problem merging configs");case 6:return s=ie(ae(r.include||[]),o),delete r.include,c=s.map(function(){var e=(0,h.Z)(m().mark((function e(r){var a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.cacheBuster=t.cacheBuster,e.next=3,Q({uri:new URL(r.url,i).href,locationType:"UriLocation"});case 3:return a=e.sent,e.abrupt("return",n(a,o));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(c);case 11:return e.sent.forEach((function(e){r=ee(r,e)||r})),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)},n=function(e,t){return r.apply(this,arguments)},t=O(t),e.abrupt("return",n(t,{}));case 4:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ae(e){return e?(Array.isArray(e)||(e=[e]),e.map((function(e){return"string"===typeof e&&(e={url:e}),"format"in e||(e.format=e.url.endsWith(".conf")?"conf":"JB_json"),"JB_json"!==e.format||"version"in e||(e.version=1),e}))):[]}function ie(e,t){if(!e)return e;if(Array.isArray(e))for(var n=0;n<e.length;n+=1)e[n]=ie(e[n],t);else if("object"===typeof e)for(var r=e,a=0,i=Object.keys(r);a<i.length;a++){var o=i[a];r[o]=ie(r[o],t)}else if("string"===typeof e)return function(e,t){var n=this;return e.replace(/\{([\w\s.]+)\}/g,(function(e,r){r=r.replace(/\s+/g,"");var a=I()(t,r);if(void 0!==a)return"function"===typeof a?a(r):a;if(t.callback){var i=t.callback.call(n,r);if(void 0!==i)return i}return e}))}(e,t);return e}var oe={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function se(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}function ce(e,t,n){var r={trackId:(0,T.objectHash)(e),name:e.key||e.label},a=e.metadata&&(e.metadata.description||e.metadata.Description);a&&(r.description=a);var i=e.category||e.metadata&&e.metadata.category;r.category=i?i.split(/\s*\/\s*/):[];var o=e.storeClass;if(!e.urlTemplate){if(!o||!o.endsWith("FromConfig")){var s=e.key||e.label;return console.warn('Could not import JBrowse1 track "'.concat(s,'" because it does not have a "urlTemplate" or is not a "FromConfig" track')),(0,S.generateUnsupportedTrackConf)(r.name,s,r.category)}return function(e,t){var n=(e.features||[]).map((function(e){var t=JSON.parse(JSON.stringify(e));return t.refName=e.seq_id,t.uniqueId="".concat(e.seq_id,":").concat(e.start,"-").concat(e.end,":").concat(e.name||""),t}));return t.adapter={type:"FromConfigAdapter",features:n},t.type="FeatureTrack",t}(e,r)}var c=function(e){return new URL(e,"".concat(t,"/")).href.replace(/%7B/gi,"{").replace(/%7D/gi,"}")},u=c(e.urlTemplate);if(o){if("JBrowse/Store/SeqFeature/BAM"===o){var l={type:"BamAdapter",bamLocation:{uri:u,locationType:"UriLocation"}};return e.baiUrlTemplate?l.index={location:{uri:c(e.baiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?l.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:l.index={location:{uri:"".concat(u,".bai"),locationType:"UriLocation"}},(0,N.Z)((0,N.Z)({},r),{},{type:"AlignmentsTrack",adapter:l})}if("JBrowse/Store/SeqFeature/CRAM"===o){var d={type:"CramAdapter",cramLocation:{uri:u,locationType:"UriLocation"},sequenceAdapter:n};return e.craiUrlTemplate?d.craiLocation={uri:c(e.craiUrlTemplate),locationType:"UriLocation"}:d.craiLocation={uri:"".concat(u,".crai"),locationType:"UriLocation"},(0,N.Z)((0,N.Z)({},r),{},{type:"AlignmentsTrack",adapter:d})}if("JBrowse/Store/SeqFeature/NCList"===o)return(0,N.Z)((0,N.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"NCListAdapter",rootUrlTemplate:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/BigWig"===o||"JBrowse/Store/BigWig"===o)return e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density"),(0,N.Z)((0,N.Z)({},r),{},{type:"QuantitativeTrack",adapter:{type:"BigWigAdapter",bigWigLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/VCFTabix"===o){var f={type:"VcfTabixAdapter",vcfGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?f.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?f.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:f.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,N.Z)((0,N.Z)({},r),{},{type:"VariantTrack",adapter:f})}if("JBrowse/Store/SeqFeature/VCFTribble"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"VCFTribble (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/GFF3"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"GFF3 (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/BigBed"===o)return(0,N.Z)((0,N.Z)({},r),{},{type:"FeatureTrack",adapter:{type:"BigBedAdapter",bigBedLocation:{uri:u,locationType:"UriLocation"}}});if("JBrowse/Store/SeqFeature/GFF3Tabix"===o){var p={type:"Gff3TabixAdapter",gffGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?p.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?p.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:p.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,N.Z)((0,N.Z)({},r),{},{type:"FeatureTrack",adapter:p})}if("JBrowse/Store/SeqFeature/BED"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"BED (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/BEDTabix"===o){var h={type:"BedTabixAdapter",bedGzLocation:{uri:u,locationType:"UriLocation"}};return e.tbiUrlTemplate?h.index={location:{uri:c(e.tbiUrlTemplate),locationType:"UriLocation"}}:e.csiUrlTemplate?h.index={location:{uri:c(e.csiUrlTemplate),locationType:"UriLocation"},indexType:"CSI"}:h.index={location:{uri:"".concat(u,".tbi"),locationType:"UriLocation"}},(0,N.Z)((0,N.Z)({},r),{},{type:"FeatureTrack",adapter:h})}if("JBrowse/Store/SeqFeature/GTF"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"GTF (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/StaticChunked"===o||"JBrowse/Store/Sequence/StaticChunked"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"StaticChunked (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/UnindexedFasta"===o)return(0,S.generateUnsupportedTrackConf)(r.name,"UnindexedFasta (".concat(u,")"),r.category);if("JBrowse/Store/SeqFeature/IndexedFasta"===o){var g={type:"IndexedFastaAdapter",fastaLocation:{uri:u,locationType:"UriLocation"}};return e.faiUrlTemplate?g.faiLocation={uri:c(e.faiUrlTemplate),locationType:"UriLocation"}:g.faiLocation={uri:"".concat(u,".fai"),locationType:"UriLocation"},(0,N.Z)((0,N.Z)({},r),{},{type:"SequenceTrack",adapter:g})}if("JBrowse/Store/SeqFeature/BgzipIndexedFasta"===o){var m={type:"BgzipFastaAdapter",fastaLocation:{uri:u,locationType:"UriLocation"}};return e.faiUrlTemplate?m.faiLocation={uri:c(e.faiUrlTemplate),locationType:"UriLocation"}:m.faiLocation={uri:"".concat(u,".fai"),locationType:"UriLocation"},e.gziUrlTemplate?m.gziLocation={uri:c(e.gziUrlTemplate),locationType:"UriLocation"}:m.gziLocation={uri:"".concat(u,".gzi"),locationType:"UriLocation"},(0,N.Z)((0,N.Z)({},r),{},{type:"ReferenceSequenceTrack",adapter:m})}if("JBrowse/Store/SeqFeature/TwoBit"===o)return(0,N.Z)((0,N.Z)({},r),{},{type:"ReferenceSequenceTrack",adapter:{type:"TwoBitAdapter",twoBitLocation:{uri:u,locationType:"UriLocation"}}})}if(r.adapter=(0,S.guessAdapter)({uri:u,locationType:"UriLocation"},void 0,u),!r.adapter)throw new Error("Could not determine adapter");return r.adapter.type===S.UNSUPPORTED?(0,S.generateUnsupportedTrackConf)(r.name,u,r.category):r.adapter.type===S.UNKNOWN?(0,S.generateUnknownTrackConf)(r.name,u,r.category):(r.type=(0,S.guessTrackType)(r.adapter.type),"QuantitativeTrack"===r.type&&(e.type&&e.type.endsWith("XYPlot")?r.defaultRendering="xyplot":e.type&&e.type.endsWith("Density")&&(r.defaultRendering="density")),r)}function ue(e){return R.types.compose("JBrowse1Connection",(0,P.BaseConnectionModelFactory)(e),R.types.model({configuration:(0,d.ConfigurationReference)(M),type:R.types.literal("JBrowse1Connection")}).actions((function(e){return{connect:function(){var t=(0,d.readConfObject)(e.configuration,"dataDirLocation"),n=(0,T.getSession)(e);(function(){return J.apply(this,arguments)})(t).then((function(t){var r=(0,d.readConfObject)(e.configuration,"assemblyNames")[0];if(!r)throw new Error("assembly name required for JBrowse 1 connection");var a=n.assemblies.find((function(e){return(0,d.readConfObject)(e,"name")===r})),i=(0,d.readConfObject)(a,["sequence","adapter"]),o=t.tracks.map((function(e){var n=ce(e,t.dataRoot,i);return n.assemblyNames=[r],n}));e.setTrackConfs(o)})).catch((function(t){console.error(t),n.notify('There was a problem connecting to the JBrowse 1 data directory "'.concat(e.name,'". Please make sure you have entered a valid location. The error that was thrown is: "').concat(t,'"'),"error"),n.breakConnection(e.configuration)}))}}})))}var le=function(e){(0,i.Z)(l,e);var t=(0,o.Z)(l);function l(){var e;(0,r.Z)(this,l);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="LegacyJBrowsePlugin",e}return(0,a.Z)(l,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"NCListAdapter",configSchema:f,getAdapterClass:function(){return Promise.all([n.e(7904),n.e(2809),n.e(933),n.e(5046)]).then(n.bind(n,45046)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="NCListAdapter",i=(0,S.getFileName)(t);return/trackData.jsonz?$/i.test(i)||r===a?{type:a,rootUrlTemplate:t}:e(t,n,r)}})),e.addTextSearchAdapterType((function(){return new c.Z({name:"JBrowse1TextSearchAdapter",configSchema:Z,AdapterClass:C,description:"A JBrowse 1 text search adapter"})})),e.addConnectionType((function(){return new u.Z({name:"JBrowse1Connection",configSchema:M,stateModel:ue(e),displayName:"JBrowse 1 Data",description:"A JBrowse 1 data directory",url:"//jbrowse.org/"})}))}}]),l}(l.Z)},6348:function(e,t,n){"use strict";n.d(t,{Z:function(){return s},f:function(){return o}});var r=n(33028),a=(n(30969),n(67496)),i=n(37574);function o(e){return(0,i.jsx)(a.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,i.jsx)("path",{fill:"currentColor",d:"M16.5,21C13.5,21 12.31,16.76 11.05,12.28C10.14,9.04 9,5 7.5,5C4.11,5 4,11.93 4,12H2C2,11.63 2.06,3 7.5,3C10.5,3 11.71,7.25 12.97,11.74C13.83,14.8 15,19 16.5,19C19.94,19 20.03,12.07 20.03,12H22.03C22.03,12.37 21.97,21 16.5,21Z"})}))}function s(e){return(0,i.jsx)(a.Z,(0,r.Z)((0,r.Z)({},e),{},{children:(0,i.jsx)("path",{fill:"currentColor",d:"M22 12L17 22L7.1 6.04L4.24 12H2L7 2L16.9 17.96L19.76 12H22Z"})}))}},72584:function(e,t,n){"use strict";n.d(t,{Z:function(){return He}});var r=n(68079),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(49767),u=n(81073),l=n(10901),d=n(9519),f=n(59740),p=n(34795),h=n(33028),g=n(77162),m=n.n(g),v=n(9077),y=n(40909),b=n(39554),x=n.n(b),w=n(89058),k=n(97891),C=n(59853),Z=n(81575),S=n(96234),T=n(22714),P=n(94103),R=n(90550),M=n(30969),j=n(37574),A=(0,T.Z)({loading:{paddingLeft:"0.6em",backgroundColor:"#f1f1f1",backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",textAlign:"center"},error:{display:"block",color:"red",width:"30em",wordWrap:"normal",whiteSpace:"normal"},blockMessage:{background:"#f1f1f1",padding:"10px"},blockError:{background:"#f1f1f1",padding:"10px",color:"red"}});function N(){var e=(0,M.useState)(!1),t=(0,S.Z)(e,2),n=t[0],r=t[1],a=A();return(0,M.useEffect)((function(){var e=setTimeout((function(){return r(!0)}),300);return function(){return clearTimeout(e)}})),n?(0,j.jsxs)("div",{"data-testid":"loading-synteny",className:a.loading,children:["Loading \u2026",(0,j.jsx)(P.Z,{})]}):null}function L(e){var t=e.messageText,n=A();return(0,j.jsx)("div",{className:n.blockMessage,children:t})}function F(e){var t=e.error,n=A();return(0,j.jsx)("div",{className:n.blockError,children:t.message})}var I=(0,R.observer)((function(e){var t=e.model;return t.error?(0,j.jsx)(F,{error:t.error}):t.message?(0,j.jsx)(L,{messageText:t.message}):t.filled?t.reactElement:(0,j.jsx)(N,{})})),B=function(e){var t=e.model,n=e.children;return(0,j.jsxs)("div",{children:[(0,j.jsx)(t.ReactComponent2,(0,h.Z)({},e)),n]})};B.defaultProps={children:null};var D=(0,R.observer)(B),E=["reactElement"];function V(e){return(0,v.ConfigurationSchema)("LinearComparativeDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:w.fU,explicitlyTyped:!0})}function O(e){return y.types.compose("LinearComparativeDisplay",C.BaseDisplay,y.types.model({type:y.types.literal("LinearComparativeDisplay"),configuration:(0,v.ConfigurationReference)(e),height:100})).volatile((function(){return{renderInProgress:void 0,filled:!1,data:void 0,reactElement:void 0,message:void 0,renderingComponent:void 0,ReactComponent2:I}})).views((function(e){return{get rendererTypeName(){return(0,v.getConf)(e,["renderer","type"])},renderProps:function(){return{rpcDriverName:e.rpcDriverName,displayModel:e,highResolutionScaling:2}}}})).actions((function(e){var t;return{afterAttach:function(){(0,u.makeAbortableReaction)(e,z,W,{name:"".concat(e.type," ").concat(e.id," rendering"),delay:1e3,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setLoading:function(n){e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.data=void 0,e.error=void 0,e.renderingComponent=void 0,t=void 0},setRendered:function(n){var r=n.data,a=n.reactElement,i=n.renderingComponent;e.filled=!0,e.message=void 0,e.reactElement=a,e.data=r,e.error=void 0,e.renderingComponent=i,t=void 0},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.data=void 0,e.error=n,e.renderingComponent=void 0,t=void 0}}}))}function z(e){var t=(0,u.getSession)(e).rpcManager,n=e,r=n.rendererType;(0,v.readConfObject)(e.configuration);var a=e.adapterConfig,i=(0,u.getContainingView)(e),o=(0,k.getRpcSessionId)(e);return(0,y.getSnapshot)(i),{rendererType:r,rpcManager:t,renderProps:(0,h.Z)((0,h.Z)({},n.renderProps()),{},{view:x()((0,y.getSnapshot)(i)),adapterConfig:a,rendererType:r.name,sessionId:o,timeout:1e6})}}function W(e){return H.apply(this,arguments)}function H(){return(H=(0,p.Z)(m().mark((function e(t){var n,r,a,i,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("cannot render with no props");case 2:return n=t.rendererType,r=t.rpcManager,a=t.renderProps,e.next=5,n.renderInClient(r,a);case 5:return i=e.sent,o=i.reactElement,s=(0,f.Z)(i,E),e.abrupt("return",{reactElement:o,data:s,renderingComponent:n.ReactComponent});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=n(20478),U=n(24998),_=n(35247),G=n(22417),J=n(29206),X=n(52477);function Y(e){return y.types.compose("LinearComparativeView",q.Z,y.types.model({id:J.ElementId,type:y.types.literal("LinearComparativeView"),height:400,trackSelectorType:"hierarchical",showIntraviewLinks:!0,linkViews:!1,interactToggled:!1,middleComparativeHeight:100,tracks:y.types.array(e.pluggableMstType("track","stateModel")),views:y.types.array(e.getViewType("LinearGenomeView").stateModel),viewTrackConfigs:y.types.array(e.pluggableConfigSchemaType("track"))})).volatile((function(){return{headerHeight:0,width:800}})).views((function(e){return{get highResolutionScaling(){return 2},get initialized(){return e.views.length>0},get refNames(){return e.views.map((function(e){return(0,r.Z)(new Set(e.staticBlocks.map((function(e){return e.refName}))))}))},get assemblyNames(){return(0,r.Z)(new Set(e.views.map((function(e){return e.assemblyNames})).flat()))}}})).actions((function(t){return{afterAttach:function(){var e=this;(0,y.addDisposer)(t,(0,y.onAction)(t,(function(n){if(t.linkViews){var r=n.name,a=n.path,i=n.args;["horizontalScroll","zoomTo","setScaleFactor","showTrack","hideTrack","toggleTrack"].includes(r)&&a&&e.onSubviewAction(r,a,i)}})))},beforeDestroy:function(){var e=(0,u.getSession)(t);t.assemblyNames.forEach((function(t){var n;t.endsWith("-temp")&&(null===(n=e.removeAssembly)||void 0===n||n.call(e,t))}))},onSubviewAction:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];t.views.forEach((function(t){var a=(0,y.getPath)(t);a.lastIndexOf(n)!==a.length-n.length&&t[e](r[0])}))},setWidth:function(e){t.width=e,t.views.forEach((function(t){return t.setWidth(e)}))},setHeight:function(e){t.height=e},setViews:function(e){t.views=(0,y.cast)(e)},removeView:function(e){t.views.remove(e)},closeView:function(){(0,y.getParent)(t,2).removeView(t)},setHeaderHeight:function(e){t.headerHeight=e},setMiddleComparativeHeight:function(e){return t.middleComparativeHeight=e,t.middleComparativeHeight},toggleLinkViews:function(){t.linkViews=!t.linkViews},activateTrackSelector:function(){if("hierarchical"!==t.trackSelectorType)throw new Error("invalid track selector type ".concat(t.trackSelectorType));var e=(0,u.getSession)(t);if((0,u.isSessionModelWithWidgets)(e)){var n=e.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:t});return e.showWidget(n),n}},toggleTrack:function(e){this.hideTrack(e)||this.showTrack(e)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.pluggableConfigSchemaType("track"),i=(0,y.resolveIdentifier)(a,(0,y.getRoot)(t),n),o=e.getTrackType(i.type);if(!o)throw new Error("unknown track type ".concat(i.type));var s=e.getViewType(t.type),c=s.displayTypes.map((function(e){return e.name})),u=i.displays.find((function(e){return c.includes(e.type)}));if(!u)throw new Error("could not find a compatible display for view type ".concat(t.type));t.tracks.push(o.stateModel.create((0,h.Z)((0,h.Z)({},r),{},{type:i.type,configuration:i,displays:[{type:u.type,configuration:u}]})))},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,y.resolveIdentifier)(r,(0,y.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,_.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length},squareView:function(){var e=t.views.map((function(e){return e.bpPerPx})),n=e.reduce((function(e,t){return e+t}),0)/e.length;t.views.forEach((function(e){var t=e.pxToBp(e.width/2);e.setNewView(n,e.offsetPx),e.centerAt(t.coord,t.refName,t.index)}))},clearView:function(){t.views=(0,y.cast)([])}}})).views((function(e){return{menuItems:function(){var t=[];return e.views.forEach((function(e,n){var r;null!==(r=e.menuItems)&&void 0!==r&&r.call(e)&&t.push({label:"View ".concat(n+1," Menu"),subMenu:e.menuItems()})})),t.push({label:"Return to import form",onClick:function(){(0,u.getSession)(e).queueDialog((function(t){return[U.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:X.Z}),t.push({label:"Open track selector",onClick:e.activateTrackSelector,icon:G.GD}),t},rubberBandMenuItems:function(){return[{label:"Zoom to region(s)",onClick:function(){e.views.forEach((function(e){var t=e.leftOffset,n=e.rightOffset;t&&n&&e.moveTo(t,n)}))}}]}}}))}var Q=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearComparativeView",stateModel:t(Y),ReactComponent:(0,M.lazy)((function(){return n.e(4493).then(n.bind(n,34493))}))})},$=function(e){e.addDisplayType((function(){var t=function(e){return(0,v.ConfigurationSchema)("LinearSyntenyDisplay",{trackIds:{type:"stringArray",defaultValue:[]},renderer:y.types.optional(e.pluggableConfigSchemaType("renderer"),{type:"LinearSyntenyRenderer"}),middle:{type:"boolean",defaultValue:!0}},{baseConfiguration:V(e),explicitlyTyped:!0})}(e);return new Z.Z({name:"LinearSyntenyDisplay",configSchema:t,stateModel:K(t),trackType:"SyntenyTrack",viewType:"LinearSyntenyView",ReactComponent:D})}))};function K(e){return y.types.compose("LinearSyntenyDisplay",O(e),y.types.model({type:y.types.literal("LinearSyntenyDisplay"),configuration:(0,v.ConfigurationReference)(e)})).views((function(e){return{renderProps:function(){var t=(0,u.getContainingView)(e);return{rpcDriverName:e.rpcDriverName,displayModel:e,config:(0,v.getConf)(e,"renderer"),width:t.width,height:t.middleComparativeHeight}},get rendererTypeName(){return e.configuration.renderer.type},get adapterConfig(){return(0,h.Z)({name:e.parentTrack.configuration.adapter.type,assemblyNames:(0,v.getConf)(e,"assemblyNames")},(0,v.getConf)(e.parentTrack,"adapter"))},get trackIds(){return(0,v.getConf)(e,"trackIds")}}}))}var ee=n(41361),te=n(14956),ne=n(26794),re=m().mark(ie);function ae(e,t){return e?0:t}function ie(){var e,t,n,r,a,i,o,s=arguments;return m().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:e=s.length>0&&void 0!==s[0]?s[0]:[],t=s.length>1&&void 0!==s[1]?s[1]:[],n=s.length>2?s[2]:void 0,r=0,a=0;case 5:if(!(r<e.length&&a<t.length)){c.next=22;break}if(i=n(e[r]),o=n(t[a]),!(i<o)){c.next=12;break}r++,c.next=20;break;case 12:if(!(o<i)){c.next=16;break}a++,c.next=20;break;case 16:return c.next=18,[e[r],t[a]];case 18:r++,a++;case 20:c.next=5;break;case 22:case"end":return c.stop()}}),re)}var oe=[0,1,2,3],se=oe[0],ce=oe[2],ue={I:"#ff03",N:"#0a03",D:"#00f3",X:"brown",M:"#f003","=":"#f003"};function le(e,t){var n;return(null===(n=(0,u.viewBpToPx)((0,h.Z)((0,h.Z)({},t),{},{self:e})))||void 0===n?void 0:n.offsetPx)||0}var de=(0,R.observer)((function(e){var t=e.height,n=e.width,r=e.displayModel,a=e.features,i=e.trackIds,o=e.highResolutionScaling,s=void 0===o?1:o,c=(0,M.useRef)(null),l=function(e){if("type"in e&&(0,y.isAlive)(e)){var t=(0,u.getContainingView)(e),n=(0,v.getConf)(e,["renderer","color"]),r=(0,u.getSession)(e);return{color:n,session:r,parentView:t,assemblyManager:r.assemblyManager}}return{}}(r),d=l.color,f=l.assemblyManager,p=l.parentView,g=(0,M.useMemo)((function(){return a.map((function(e){return e.map((function(e){return new te.Z(e)})).sort((function(e,t){return e.get("syntenyId")-t.get("syntenyId")}))}))}),[a]),m=(0,M.useMemo)((function(){return function(e,t){for(var n=[],r=0;r<e.length;r++)for(var a=r;a<e.length;a++)if(r!==a){var i,o=(0,ee.Z)(ie(e[r],e[a],(function(e){return e.get("syntenyId")})));try{for(o.s();!(i=o.n()).done;){var s=(0,S.Z)(i.value,2),c=s[0],u=s[1],l=c.get("start"),d=c.get("end"),f=u.get("start"),p=u.get("end");if(-1===c.get("strand")){var h=[l,d];d=h[0],l=h[1]}var g=null===t||void 0===t?void 0:t.get(c.get("assemblyName")),m=null===t||void 0===t?void 0:t.get(u.get("assemblyName")),v=c.get("refName"),y=u.get("refName");n.push([{feature:c,level:r,refName:(null===g||void 0===g?void 0:g.getCanonicalRefName(c.get("refName")))||v,layout:[l,0,d,10]},{feature:u,level:a,refName:(null===m||void 0===m?void 0:m.getCanonicalRefName(c.get("refName")))||y,layout:[f,0,p,10]}])}}catch(b){o.e(b)}finally{o.f()}}return n}(g,f)}),[g,f]),b=(0,M.useMemo)((function(){return new Map(g.flat().map((function(e){var t=e.get("cg")||e.get("CIGAR");return[e.id(),t?ne.t.parseCigar(t):void 0]})))}),[g]),x=null===p||void 0===p?void 0:p.drawCurves,w=null===p||void 0===p?void 0:p.views,k=null===w||void 0===w?void 0:w.map((function(e){return e.offsetPx}));return(0,M.useEffect)((function(){if(c.current&&k&&w&&(0,y.isAlive)(r)){var e=c.current.getContext("2d");if(e){e.resetTransform(),e.scale(s,s),e.clearRect(0,0,n,t),e.fillStyle=d,e.strokeStyle=d;for(var a=w.map((function(e){return(0,h.Z)((0,h.Z)({},(0,y.getSnapshot)(e)),{},{width:e.width,interRegionPaddingWidth:e.interRegionPaddingWidth,minimumBlockWidth:e.minimumBlockWidth})})),i=0;i<m.length;i++)for(var o=m[i],u=0;u<o.length-1;u+=1){var l=o[u],f=l.layout,p=l.feature,g=l.level,v=l.refName,C=o[u+1],Z=C.layout,S=C.feature,T=C.level,P=C.refName,R=a[g],M=a[T];if(!f||!Z)return void console.warn("received null layout for a overlay feature");if(g!==T){var j=p.get("end")-p.get("start"),A=S.get("end")-S.get("start");j<R.bpPerPx||M.bpPerPx,0;var N=le(R,{refName:v,coord:f[se]})-k[g],L=le(R,{refName:v,coord:f[ce]})-k[g],F=le(M,{refName:P,coord:Z[se]})-k[T],I=le(M,{refName:P,coord:Z[ce]})-k[T],B=ae(g<T,t),D=ae(T<g,t),E=(D-B)/2;if(j<R.bpPerPx||A<M.bpPerPx)e.beginPath(),e.moveTo(N,B),x?e.bezierCurveTo(N,E,F,E,F,D):e.lineTo(F,D),e.stroke();else{var V=N,O=F,z=N<L?1:-1,W=F<I?1:-1,H=b.get(p.id());if(H)for(var q=!1,U=0,_=0,G=0;G<H.length;G+=2){var J=+H[G],X=H[G+1];q||(U=V,_=O);var Y=J/a[0].bpPerPx,Q=J/a[1].bpPerPx;"M"===X||"="===X||"X"===X?(V+=Y*z,O+=Q*W):"D"===X||"N"===X?V+=Y*z:"I"===X&&(O+=Q*W),Math.max(U,_,V,O)<0||Math.min(U,_,V,O)>n||(V-U<1&&O-_<1&&G<H.length-2?q=!0:(q=!1,e.fillStyle=ue[q&&Y>1||Q>1?X:"M"],e.beginPath(),e.moveTo(U,B),e.lineTo(V,B),x?e.bezierCurveTo(V,E,O,E,O,D):e.lineTo(O,D),e.lineTo(_,D),x?e.bezierCurveTo(_,E,U,E,U,B):e.lineTo(U,B),e.closePath(),e.fill()))}else e.beginPath(),e.moveTo(N,B),e.lineTo(L,B),x?e.bezierCurveTo(L,E,I,E,I,D):e.lineTo(I,D),e.lineTo(F,D),x?e.bezierCurveTo(F,E,N,E,N,B):e.lineTo(N,B),e.closePath(),e.fill()}}}}}}),[r,s,i,n,w,k,x,d,t,m,b]),(0,j.jsx)("canvas",{ref:c,"data-testid":"synteny_canvas",style:{width:n,height:t},width:n*s,height:t*s})})),fe=(0,v.ConfigurationSchema)("LinearSyntenyRenderer",{color:{type:"color",description:"the color of each feature in a synteny",defaultValue:"rgb(255,100,100,0.3)"}},{explicitlyTyped:!0}),pe=n(43103),he=n(54006),ge=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"renameRegionsIfNeeded",value:function(){var e=(0,p.Z)(m().mark((function e(t){var n,r,a,i,o,s;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(n=this.pluginManager.rootModel)||void 0===n||null===(r=n.session)||void 0===r?void 0:r.assemblyManager){e.next=3;break}throw new Error("No assembly manager provided");case 3:i=t.view.views,o=0;case 5:if(!(o<i.length)){e.next=13;break}return s=i[o],e.next=9,(0,u.renameRegionsIfNeeded)(a,{sessionId:t.sessionId,regions:s.displayedRegions,adapterConfig:t.adapterConfig});case 9:s.displayedRegions=e.sent.regions;case 10:o++,e.next=5;break;case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=(0,p.Z)(m().mark((function e(t){var n,r,a,i,o,s,c,u=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,r=t.view.views,a=r.map((function(e){var t=he.Z.create(e);return t.setVolatileWidth(n),t})),e.next=4,Promise.all(a.map((function(e){return u.getFeatures((0,h.Z)((0,h.Z)({},t),{},{regions:e.staticBlocks.contentBlocks}))})));case 4:for(i=e.sent,o=JSON.parse(JSON.stringify(i)),s=0;s<o.length;s++)for(c=0;c<o[s].length;c++)o[s][c]._level=s;return e.abrupt("return",{reactElement:M.createElement(this.ReactComponent,(0,h.Z)((0,h.Z)({},t),{},{features:i})),features:o});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(pe.Z),me=n(79582),ve=n(77977),ye=n(8623),be=n(6348);function xe(e){return y.types.compose(Y(e),y.types.model("LinearSyntenyView",{type:y.types.literal("LinearSyntenyView"),drawCurves:!1}).actions((function(e){return{toggleCurves:function(){e.drawCurves=!e.drawCurves}}}))).views((function(e){var t=e.menuItems;return{menuItems:function(){return[].concat((0,r.Z)(t()),[{label:"Square view",onClick:e.squareView,description:"Makes both views use the same zoom level, adjusting to the average of each",icon:me.Z},{label:e.linkViews?"Unlink views":"Link views",onClick:e.toggleLinkViews,icon:e.linkViews?ye.Z:ve.Z},{label:e.drawCurves?"Use straight lines":"Use curved lines",onClick:e.toggleCurves,icon:e.drawCurves?be.Z:be.f}])}}}))}var we=function(e){var t=e.jbrequire;return new(t("@jbrowse/core/pluggableElementTypes/ViewType"))({name:"LinearSyntenyView",stateModel:t(xe),ReactComponent:(0,M.lazy)((function(){return n.e(3420).then(n.bind(n,83420))}))})},ke=n(82044),Ce=n(83483),Ze=n(64501),Se=n(32343),Te=n(93138),Pe=n(80975),Re=n(537),Me=n(7690),je=n(93717),Ae=n(24684),Ne=n(53033),Le=n(28599),Fe=n(14008),Ie=ne.t.parseCigar;function Be(e){for(var t=Ie(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"D"!==i&&"N"!==i&&(n+=a)}return n}function De(e){for(var t=Ie(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"D"!==i&&"N"!==i&&(n+=a)}return n}function Ee(e,t){return-1===t?+(e.match(/(\d+)[SH]$/)||[])[1]||0:+(e.match(/^(\d+)([SH])/)||[])[1]||0}var Ve=(0,T.Z)((function(e){return{root:{width:300},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Oe(e,t){var n=e.get("tags");return n?n[t]:e.get(t)}function ze(e){var t=e.reduce((function(e,t){return e[t.refName]||(e[t.refName]=[]),e[t.refName].push(t),e}),{});return Object.values(t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;if(e.length<=1)return e;var n=[],r=null;e=e.sort((function(e,t){return e.start-t.start})),n.push(e[0]);for(var a=1;a<e.length;a++)(r=n[n.length-1]).end+t<e[a].start-t?n.push(e[a]):r.end<e[a].end&&(r.end=Math.max(r.end,e[a].end),n.pop(),n.push(r));return n}(e.sort((function(e,t){return e.start-t.start})))})).flat()}function We(e){var t=Ve(),n=e.track,a=e.feature,i=e.handleClose,o=(0,M.useState)("0"),s=(0,S.Z)(o,2),c=s[0],l=s[1],d=(0,M.useState)(),f=(0,S.Z)(d,2),g=f[0],y=f[1],b=(0,M.useState)(),x=(0,S.Z)(b,2),w=x[0],C=x[1],Z=(0,M.useState)(!1),T=(0,S.Z)(Z,2),P=T[0],R=T[1],A=+c;return(0,M.useEffect)((function(){var e=!1;return(0,p.Z)(m().mark((function t(){var r,i,o,s,c,l,d,f,p,h,g,b;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(2048&a.get("flags"))){t.next=19;break}return r=Oe(a,"SA")||"",i=r.split(";")[0],o=i.split(","),s=(0,S.Z)(o,2),c=s[0],l=s[1],d=(0,u.getSession)(n),f=d.rpcManager,p=(0,v.getConf)(n,"adapter"),h=(0,k.getRpcSessionId)(n),t.next=10,f.call(h,"CoreGetFeatures",{adapterConfig:p,sessionId:h,regions:[{refName:c,start:+l-1,end:+l}]});case 10:if(g=t.sent,!(b=g.find((function(e){return e.get("name")===a.get("name")&&!(2048&e.get("flags"))})))){t.next=16;break}e||C(b),t.next=17;break;case 16:throw new Error("primary feature not found");case 17:t.next=20;break;case 19:C(a);case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(0),console.error(t.t0),y(t.t0);case 26:case"end":return t.stop()}}),t,null,[[0,22]])})))(),function(){e=!0}}),[a,n]),(0,j.jsxs)(Ce.Z,{open:!0,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,j.jsxs)(Ze.Z,{id:"alert-dialog-title",children:["Set window size",(0,j.jsx)(Se.Z,{"aria-label":"close",className:t.closeButton,onClick:i,children:(0,j.jsx)(Fe.Z,{})})]}),(0,j.jsx)(Te.Z,{children:w?(0,j.jsxs)("div",{className:t.root,children:[(0,j.jsx)(Pe.Z,{children:"Show an extra window size around each part of the split alignment. Using a larger value can allow you to see more genomic context."}),g?(0,j.jsx)(Pe.Z,{color:"error",children:"".concat(g)}):null,(0,j.jsx)(Me.Z,{value:A,onChange:function(e){return l(e.target.value)},label:"Set window size"}),(0,j.jsx)(je.Z,{control:(0,j.jsx)(Ae.Z,{checked:P,onChange:function(){return R((function(e){return!e}))}}),label:"Show qual track"})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)(Pe.Z,{children:"To accurately perform comparison we are fetching the primary alignment. Loading primary feature..."}),(0,j.jsx)(Re.Z,{})]})}),(0,j.jsxs)(Ne.Z,{children:[(0,j.jsx)(Le.Z,{variant:"contained",color:"secondary",onClick:i,children:"Cancel"}),(0,j.jsx)(Le.Z,{variant:"contained",color:"primary",onClick:function(){try{var e;if(!w)return;var t=w,a=(0,u.getSession)(n),o=(0,u.getContainingView)(n),s=t.get("CIGAR"),c=Ee(s,1),l=t.get("flags"),d=t.get("qual"),f=t.get("strand"),p=Oe(t,"SA")||"",g=t.get("name"),m="".concat(g,"_assembly_").concat(Date.now()),b=(0,v.getConf)(n,"assemblyNames"),x=(0,S.Z)(b,1)[0],k=[x,m],C="track-".concat(Date.now()),Z="".concat(g,"_vs_").concat(x),T=a.assemblyManager.get(x),R=p.split(";").filter((function(e){return!!e})).map((function(e,n){var r=e.split(","),a=(0,S.Z)(r,4),i=a[0],o=a[1],s=a[2],c=a[3],u=function(e){for(var t=Ie(e),n=0,r=0;r<t.length;r+=2){var a=+t[r],i=t[r+1];"H"!==i&&"S"!==i&&"I"!==i&&(n+=a)}return n}(c),l=Be(c),d=De(c),p="-"===s?-1:1,h=Ee(c,p*f),m=+o-1;return{refName:i,start:m,end:m+u,seqLength:l,clipPos:h,CIGAR:c,assemblyName:x,strand:f*p,uniqueId:"".concat(t.id(),"_SA").concat(n),mate:{start:h,end:h+d,refName:g}}})),M=t.toJSON();M.clipPos=c,M.strand=1,M.mate={refName:g,start:c,end:c+De(s)};var j=Be(2048&l?R[0].CIGAR:s),N=[M].concat((0,r.Z)(R));N.forEach((function(e,t){e.refName=(null===T||void 0===T?void 0:T.getCanonicalRefName(e.refName))||e.refName,e.syntenyId=t,e.mate.syntenyId=t,e.mate.uniqueId="".concat(e.uniqueId,"_mate")})),N.sort((function(e,t){return e.clipPos-t.clipPos}));var L=t.get("seq"),F=N.concat(N.map((function(e){return e.mate}))),I=2*A,B=N.reduce((function(e,t){return e+t.end-t.start+I}),0),D="".concat(g,"_").concat(Date.now()),E=(0,v.getConf)(T,"sequence"),V=ze(N.map((function(e){return(0,h.Z)((0,h.Z)({},e),{},{start:Math.max(0,e.start-A),end:e.end+A,assemblyName:x})})));null===(e=a.addAssembly)||void 0===e||e.call(a,{name:"".concat(m),sequence:{type:"ReferenceSequenceTrack",name:"Read sequence",trackId:D,assemblyNames:[m],adapter:{type:"FromConfigSequenceAdapter",noAssemblyManager:!0,features:[{start:0,end:j,seq:L,refName:g,uniqueId:"".concat(Math.random())}]}}}),a.addView("LinearSyntenyView",{type:"LinearSyntenyView",views:[{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:B/o.width,displayedRegions:V,tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",assemblyNames:[x],configuration:E.trackId,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(D,"-LinearReferenceSequenceDisplay")}]}]},{type:"LinearGenomeView",hideHeader:!0,offsetPx:0,bpPerPx:j/o.width,displayedRegions:[{assemblyName:m,start:0,end:j,refName:g}],tracks:[{id:"".concat(Math.random()),type:"ReferenceSequenceTrack",configuration:D,displays:[{id:"".concat(Math.random()),type:"LinearReferenceSequenceDisplay",showReverse:!0,showTranslation:!1,height:35,configuration:"".concat(D,"-LinearReferenceSequenceDisplay")}]}].concat((0,r.Z)(P?[{id:"".concat(Math.random()),type:"QuantitativeTrack",configuration:{trackId:"qualTrack",assemblyNames:[m],name:"Read quality",type:"QuantitativeTrack",adapter:{type:"FromConfigAdapter",noAssemblyManager:!0,features:d.split(" ").map((function(e,t){return{start:t,end:t+1,refName:g,score:+e,uniqueId:"feat_".concat(t)}}))}},displays:[{id:"".concat(Math.random()),type:"LinearWiggleDisplay",height:100}]}]:[]))}],viewTrackConfigs:[{type:"SyntenyTrack",assemblyNames:k,adapter:{type:"FromConfigAdapter",features:F},trackId:C,name:Z}],tracks:[{configuration:C,type:"SyntenyTrack",displays:[{type:"LinearSyntenyDisplay",configuration:"".concat(C,"-LinearSyntenyDisplay")}]}],displayName:"".concat(g," vs ").concat(x)}),i()}catch(O){console.error(O),y(O)}},children:"Submit"})]})]})}var He=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="LinearComparativeViewPlugin",e}return(0,i.Z)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(Q)})),e.addViewType((function(){return e.jbrequire(we)})),function(e){e.addRendererType((function(){return new ge({name:"LinearSyntenyRenderer",configSchema:fe,ReactComponent:de,pluginManager:e})}))}(e),function(e){e.addDisplayType((function(){var t=V(e);return new Z.Z({name:"LinearComparativeDisplay",configSchema:t,stateModel:O(t),trackType:"SyntenyTrack",viewType:"LinearComparativeView",ReactComponent:D})}))}(e),$(e),function(e){e.addTrackType((function(){var t=(0,v.ConfigurationSchema)("SyntenyTrack",{},{baseConfiguration:(0,C.createBaseTrackConfig)(e)});return new ke.Z({name:"SyntenyTrack",configSchema:t,stateModel:(0,C.createBaseTrackModel)(e,"SyntenyTrack",t)})}))}(e),e.addToExtensionPoint("Core-extendPluggableElement",(function(e){if("LinearPileupDisplay"===e.name){var t=e.stateModel.extend((function(e){var t=e.contextMenuItems;return{views:{contextMenuItems:function(){var n=e.contextMenuFeature;return n?[].concat((0,r.Z)(t()),[{label:"Linear read vs ref",icon:l.Z,onClick:function(){(0,u.getSession)(e).queueDialog((function(t){return[We,{track:(0,u.getContainingTrack)(e),feature:n,handleClose:t}]}))}}]):t()}}}}));e.stateModel=t}return e}))}},{key:"configure",value:function(e){(0,u.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear synteny view",icon:d.Z,onClick:function(e){e.addView("LinearSyntenyView",{})}})}}]),n}(c.Z)},53515:function(e,t,n){"use strict";n.d(t,{b0:function(){return c},n2:function(){return l},sh:function(){return u}});var r=n(33028),a=(n(30969),n(22714)),i=n(90550),o=n(37574),s=(0,a.Z)((function(e){return{contentBlock:{position:"relative",minHeight:"100%",boxSizing:"border-box",whiteSpace:"nowrap",overflow:"hidden"},elidedBlock:{minHeight:"100%",boxSizing:"border-box",backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"},interRegionPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.text.primary},boundaryPaddingBlock:{minHeight:"100%",backgroundColor:e.palette.action.disabledBackground}}})),c=(0,i.observer)((function(e){var t=e.block,n=e.children,r=s(),a=t.widthPx;return(0,o.jsx)("div",{style:{width:a},className:r.contentBlock,children:n})}));function u(e){var t=e.width,n=s();return(0,o.jsx)("div",{className:n.elidedBlock,style:{width:t}})}function l(e){var t=e.boundary,n=e.width,a=e.style,i=void 0===a?{}:a,c=s();return(0,o.jsx)("div",{style:(0,r.Z)((0,r.Z)({},i),{},{width:n}),className:t?c.boundaryPaddingBlock:c.interRegionPaddingBlock})}},4935:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Qe}});var r=n(30969),a=n(22714),i=n(80975),o=n(51526),s=n(28599),c=n(22417),u=n(90550),l=n(53239),d=n(75617),f=n(3223),p=n(93639),h=n(16172),g=n(97862),m=n(1433),v=n(96234),y=n(32343),b=n(33403),x=n(90722),w=n(58792),k=n(37574),C=(0,a.Z)({container:{display:"flex",flexDirection:"row",alignItems:"center"},slider:{width:70}});var Z=(0,u.observer)((function(e){var t=e.model,n=C(),a=t.maxBpPerPx,i=t.minBpPerPx,o=t.bpPerPx,s=t.scaleFactor,c=(0,r.useState)(100*-Math.log2(o)),u=(0,v.Z)(c,2),l=u[0],d=u[1];return(0,r.useEffect)((function(){d(100*-Math.log2(o))}),[d,o]),(0,k.jsxs)("div",{className:n.container,children:[(0,k.jsx)(y.Z,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*o)},disabled:o>=a-1e-4||1!==s,color:"secondary",children:(0,k.jsx)(w.Z,{})}),(0,k.jsx)(b.Z,{className:n.slider,value:l,min:100*-Math.log2(a),max:100*-Math.log2(i),onChange:function(e,t){return d(t)},onChangeCommitted:function(){return t.zoomTo(Math.pow(2,-l/100))},disabled:1!==s}),(0,k.jsx)(y.Z,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:o<=i+1e-4||1!==s,color:"secondary",children:(0,k.jsx)(x.Z,{})})]})})),S=(0,a.Z)((function(e){return{headerBar:{height:g.Od,display:"flex"},headerForm:{flexWrap:"nowrap",marginRight:7},spacer:{flexGrow:1},panButton:{background:(0,l.Fq)(e.palette.background.paper,.8),height:g.EE,margin:g.N_},bp:{display:"flex",alignItems:"center",marginLeft:5},toggleButton:{height:44,border:"none",margin:e.spacing(.5)},buttonSpacer:{marginRight:e.spacing(2)}}})),T=(0,u.observer)((function(e){var t=e.model,n=S();return(0,k.jsx)(s.Z,{onClick:t.activateTrackSelector,className:n.toggleButton,title:"Open track selector",value:"track_select",color:"secondary",children:(0,k.jsx)(c.GD,{className:n.buttonSpacer})})}));function P(e){var t=e.model,n=S();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(s.Z,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(-.9)},children:(0,k.jsx)(h.Z,{})}),(0,k.jsx)(s.Z,{variant:"outlined",className:n.panButton,onClick:function(){return t.slide(.9)},children:(0,k.jsx)(p.Z,{})})]})}var R=(0,u.observer)((function(e){var t=e.model,n=S(),r=t.coarseTotalBp;return(0,k.jsxs)(i.Z,{variant:"body2",color:"textSecondary",className:n.bp,children:[Math.round(r).toLocaleString("en-US")," bp"]})})),M=function(e){var t=e.model,n=S();return(0,k.jsxs)("div",{className:n.headerBar,children:[(0,k.jsx)(T,{model:t}),(0,k.jsx)("div",{className:n.spacer}),(0,k.jsxs)(d.Z,{row:!0,className:n.headerForm,children:[(0,k.jsx)(P,{model:t}),(0,k.jsx)(f.Z,{model:t})]}),(0,k.jsx)(R,{model:t}),(0,k.jsx)(Z,{model:t}),(0,k.jsx)("div",{className:n.spacer})]})},j=(0,u.observer)((function(e){var t=e.model;return t.hideHeaderOverview?(0,k.jsx)(M,{model:t}):(0,k.jsx)(m.ZP,{model:t,children:(0,k.jsx)(M,{model:t})})})),A=n(40909),N=n(9077),L=n(24998),F=n(81073),I=n(81856),B=n(68079),D=n(36371),E=n(2940),V=n(14008),O=(0,a.Z)((function(e){return{root:{background:(0,l.Fq)(e.palette.background.paper,.8),"&:hover":{background:e.palette.background.paper},transition:e.transitions.create(["background"],{duration:e.transitions.duration.shortest})},trackName:{margin:"0 auto",width:"90%",fontSize:"0.8rem",pointerEvents:"none"},dragHandle:{cursor:"grab",color:"#135560"},dragHandleIcon:{display:"inline-block",verticalAlign:"middle",pointerEvents:"none"},iconButton:{padding:e.spacing(1)}}})),z=r.forwardRef((function(e,t){var n,a=O(),s=r.useState(null),c=(0,v.Z)(s,2),u=c[0],l=c[1],d=e.track,f=e.className,p=(0,F.getContainingView)(d),h=(0,F.getSession)(d),g=d.configuration,m=(0,N.getConf)(d,"trackId"),b=function(){l(null)},x=(0,N.getConf)(d,"name");if("ReferenceSequenceTrack"===(0,N.getConf)(d,"type")){var w=h.assemblies.find((function(e){return e.sequence===g}));x=(0,N.readConfObject)(g,"name")||(w?"Reference Sequence (".concat((0,N.readConfObject)(w,"name"),")"):"Reference Sequence")}var C=[].concat((0,B.Z)((null===(n=h.getTrackActionMenuItems)||void 0===n?void 0:n.call(h,g))||[]),(0,B.Z)(d.trackMenuItems())).sort((function(e,t){return(t.priority||0)-(e.priority||0)}));return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(o.Z,{ref:t,className:(0,I.Z)(f,a.root),children:[(0,k.jsx)("span",{draggable:!0,className:a.dragHandle,onDragStart:function(e){var t=e.target;t.parentNode&&(e.dataTransfer.setDragImage(t.parentNode,20,20),p.setDraggingTrackId(d.id))},onDragEnd:function(){p.setDraggingTrackId(void 0)},"data-testid":"dragHandle-".concat(p.id,"-").concat(m),children:(0,k.jsx)(E.Z,{className:a.dragHandleIcon})}),(0,k.jsx)(y.Z,{onClick:function(){return p.hideTrack(m)},className:a.iconButton,title:"close this track",color:"secondary",children:(0,k.jsx)(V.Z,{})}),(0,k.jsx)(i.Z,{variant:"body1",component:"span",className:a.trackName,children:x}),(0,k.jsx)(y.Z,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){l(e.currentTarget)},className:a.iconButton,color:"secondary","data-testid":"track_menu_icon",disabled:!C.length,children:(0,k.jsx)(D.Z,{})})]}),(0,k.jsx)(L.Menu,{anchorEl:u,onMenuItemClick:function(e,t){t(),b()},open:Boolean(u),onClose:b,menuItems:C})]})})),W=(0,u.observer)(z),H=(0,a.Z)((function(e){return{root:{marginTop:2},resizeHandle:{height:g.kB,boxSizing:"border-box",position:"relative",zIndex:2},overlay:{pointerEvents:"none",position:"absolute",top:0,left:0,width:"100%",zIndex:3,borderRadius:e.shape.borderRadius},trackLabel:{zIndex:3},renderingComponentContainer:{position:"absolute",left:-1,height:"100%",width:"100%"},trackLabelInline:{position:"relative",display:"inline-block"},trackLabelOverlap:{position:"absolute"},trackRenderingContainer:{overflowY:"auto",overflowX:"hidden",whiteSpace:"nowrap",position:"relative",background:"none",zIndex:2}}})),q=(0,u.observer)((function(e){var t=e.model,n=e.view,r=H(),a="overlapping"===n.trackLabels?r.trackLabelOverlap:r.trackLabelInline;return"hidden"!==n.trackLabels?(0,k.jsx)(W,{track:t,className:(0,I.Z)(r.trackLabel,a)}):null}));var U=(0,u.observer)((function(e){var t=e.model,n=e.track,a=H(),i=n.displays[0],s=t.horizontalScroll,c=t.draggingTrackId,u=t.moveTrack,l=i.height,d=(0,N.getConf)(n,"trackId"),f=(0,r.useRef)(null);(0,r.useEffect)((function(){return f.current&&(t.trackRefs[d]=f.current),function(){delete t.trackRefs[d]}}),[t.trackRefs,d]);var p=(0,F.useDebouncedCallback)((function(){void 0!==c&&(0,A.isAlive)(i)&&c!==i.id&&u(c,n.id)}),100),h=i.RenderingComponent,g=i.DisplayBlurb,m=void 0!==c&&c!==i.id;return(0,k.jsxs)(o.Z,{className:a.root,variant:"outlined",children:[(0,k.jsx)(q,{model:n,view:t}),(0,k.jsxs)("div",{className:a.trackRenderingContainer,style:{height:l},onScroll:function(e){var t=e.target;i.setScrollTop(t.scrollTop)},onDragEnter:p,"data-testid":"trackRenderingContainer-".concat(t.id,"-").concat(d),role:"presentation",children:[(0,k.jsx)("div",{ref:f,className:a.renderingComponentContainer,style:{transform:"scaleX(".concat(t.scaleFactor,")")},children:(0,k.jsx)(h,{model:i,onHorizontalScroll:s})}),g?(0,k.jsx)("div",{style:{position:"absolute",left:0,top:i.height-20},children:(0,k.jsx)(g,{model:i})}):null]}),(0,k.jsx)("div",{className:a.overlay,style:{height:i.height,background:m?"rgba(0, 0, 0, 0.4)":void 0},onDragEnter:p}),(0,k.jsx)(L.ResizeHandle,{onDrag:i.resizeHeight,className:a.resizeHandle})]})})),_=n(87321),G=n.n(_),J=n(317),X=n(2296),Y=(0,a.Z)((function(e){return{rubberBand:{height:"100%",background:e.palette.tertiary?(0,l.Fq)(e.palette.tertiary.main,.7):(0,l.Fq)(e.palette.primary.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:e.palette.tertiary?e.palette.tertiary.contrastText:e.palette.primary.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),Q=(0,u.observer)((function(e){var t=e.model,n=e.coordX,r=Y();return(0,k.jsx)(J.ZP,{open:!0,placement:"top",title:(0,F.stringify)(t.pxToBp(n)),arrow:!0,children:(0,k.jsx)("div",{className:r.guide,style:{left:n,background:"red"}})})}));var $=(0,u.observer)((function(e){var t=e.model,n=e.ControlComponent,a=void 0===n?(0,k.jsx)("div",{}):n,o=(0,r.useState)(),s=(0,v.Z)(o,2),c=s[0],u=s[1],l=(0,r.useState)(),d=(0,v.Z)(l,2),f=d[0],p=d[1],h=(0,r.useState)(),g=(0,v.Z)(h,2),m=g[0],y=g[1],b=(0,r.useState)(),x=(0,v.Z)(b,2),w=x[0],C=x[1],Z=(0,r.useRef)(null),S=(0,r.useRef)(null),T=Y(),P=void 0!==c&&void 0===m,R=t.setOffsets,M=t.pxToBp;function j(e){e.preventDefault(),e.stopPropagation();var t=e.clientX-e.target.getBoundingClientRect().left;u(t),p(t)}function A(e){var t=e.target;C(e.clientX-t.getBoundingClientRect().left)}function N(){C(void 0),t.setOffsets(void 0,void 0)}function I(){y(void 0),u(void 0),p(void 0)}(0,r.useEffect)((function(){function e(e){if(Z.current&&P){var t=e.clientX-Z.current.getBoundingClientRect().left;p(t)}}function t(e){if(void 0!==c&&Z.current){var t=e.clientX,n=e.clientY,r=t-Z.current.getBoundingClientRect().left;y({offsetX:r,clientX:t,clientY:n});var a=function(e){if(void 0!==c){var t=c,n=e;if(n<t){var r=[n,t];t=r[0],n=r[1]}return{leftOffset:M(t),rightOffset:M(n)}}}(r);if(a){var i=a.leftOffset,o=a.rightOffset;R(i,o)}C(void 0)}}return P?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[c,P,m,R,M]),(0,r.useEffect)((function(){!P&&void 0!==f&&void 0!==c&&Math.abs(f-c)<=3&&I()}),[P,f,c,t.bpPerPx]);var B=Boolean(m);if(void 0===c)return(0,k.jsxs)(k.Fragment,{children:[void 0!==w?(0,k.jsx)(Q,{model:t,coordX:w}):null,(0,k.jsx)("div",{"data-testid":"rubberBand_controls",className:T.rubberBandControl,role:"presentation",ref:Z,onMouseDown:j,onMouseOut:N,onMouseMove:A,children:a})]});var D=m?m.offsetX:f||0,E=D<c?D:c,V=Math.abs(D-c),O=t.pxToBp(E),z=t.pxToBp(E+V),W=Math.ceil(V*t.bpPerPx);return(0,k.jsxs)(k.Fragment,{children:[S.current?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(X.ZP,{className:T.popover,classes:{paper:T.paper},open:!0,anchorEl:S.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:(0,k.jsx)(i.Z,{children:(0,F.stringify)(O)})}),(0,k.jsx)(X.ZP,{className:T.popover,classes:{paper:T.paper},open:!0,anchorEl:S.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:(0,k.jsx)(i.Z,{children:(0,F.stringify)(z)})})]}):null,(0,k.jsx)("div",{ref:S,className:T.rubberBand,style:{left:E,width:V},children:(0,k.jsxs)(i.Z,{variant:"h6",className:T.rubberBandText,children:[W.toLocaleString("en-US")," bp"]})}),(0,k.jsx)("div",{"data-testid":"rubberBand_controls",className:T.rubberBandControl,role:"presentation",ref:Z,onMouseDown:j,onMouseOut:N,onMouseMove:A,children:a}),m?(0,k.jsx)(L.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:m.clientX,top:m.clientY},onMenuItemClick:function(e,t){t(),I()},open:B,onClose:I,menuItems:t.rubberBandMenuItems()}):null]})})),K=n(33028),ee=n(59740),te=n(56891),ne=n(53515),re=n(73326),ae=["model","style","className"],ie=(0,a.Z)((function(e){return{scaleBarContainer:{overflow:"hidden",position:"relative"},scaleBarZoomContainer:{position:"relative",zIndex:1},scaleBar:{position:"absolute",display:"flex",pointerEvents:"none"},majorTickLabel:{fontSize:"11px",zIndex:1,background:e.palette.background.paper,lineHeight:"normal",pointerEvents:"none"},tick:{position:"absolute",width:0,display:"flex",justifyContent:"center",pointerEvents:"none"},refLabel:{fontSize:"11px",position:"absolute",left:"2px",top:"-1px",fontWeight:"bold",lineHeight:"normal",zIndex:1,pointerEvents:"none",background:e.palette.background.paper}}})),oe=(0,u.observer)((function(e){var t=e.model,n=ie(),r=0;return t.staticBlocks.forEach((function(e,n){e.offsetPx-t.offsetPx<0&&(r=n)})),(0,k.jsx)(k.Fragment,{children:t.staticBlocks.map((function(e,a){return e instanceof te.b0&&(e.isLeftEndOfDisplayedRegion||a===r)?(0,k.jsx)(i.Z,{style:{left:a===r?Math.max(0,-t.offsetPx):e.offsetPx-t.offsetPx-1,paddingLeft:a===r?0:1},className:n.refLabel,"data-testid":"refLabel-".concat(e.refName),children:e.refName},"refLabel-".concat(e.key,"-").concat(a)):null}))})})),se=(0,u.observer)((function(e){var t=e.model,n=ie();return(0,k.jsx)(k.Fragment,{children:t.staticBlocks.map((function(e,r){if(e instanceof te.b0){var a=(0,re.C)(e.start,e.end,t.bpPerPx,!0,!1);return(0,k.jsx)(ne.b0,{block:e,children:a.map((function(r){if("major"===r.type){var a=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx,o=(r.base+1).toLocaleString("en-US");return(0,k.jsx)("div",{className:n.tick,style:{left:a},children:o?(0,k.jsx)(i.Z,{className:n.majorTickLabel,children:o}):null},r.base)}return null}))},"".concat(e.key,"-").concat(r))}return e instanceof te.sh?(0,k.jsx)(ne.sh,{width:e.widthPx},e.key):e instanceof te.n2?(0,k.jsx)(ne.n2,{width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant},e.key):null}))})})),ce=r.forwardRef((function(e,t){var n=e.model,r=e.style,a=e.className,i=(0,ee.Z)(e,ae),s=ie(),c=n.staticBlocks.offsetPx-n.offsetPx;return(0,k.jsxs)(o.Z,(0,K.Z)((0,K.Z)({"data-resizer":"true",className:(0,I.Z)(s.scaleBarContainer,a),variant:"outlined",ref:t,style:r},i),{},{children:[(0,k.jsx)("div",{className:s.scaleBarZoomContainer,style:{transform:1!==n.scaleFactor?"scaleX(".concat(n.scaleFactor,")"):void 0},children:(0,k.jsx)("div",{className:s.scaleBar,style:(0,K.Z)({left:c-1,width:n.staticBlocks.totalWidthPx},r),children:(0,k.jsx)(se,{model:n})})}),(0,k.jsx)(oe,{model:n})]}))})),ue=(0,u.observer)(ce),le=(0,a.Z)((function(e){return{verticalGuidesZoomContainer:{position:"absolute",height:"100%",width:"100%",zIndex:1,pointerEvents:"none"},verticalGuidesContainer:{position:"absolute",height:"100%",zIndex:1,pointerEvents:"none",display:"flex"},tick:{position:"absolute",height:"100%",width:1},majorTick:{background:e.palette.text.hint},minorTick:{background:e.palette.divider}}})),de=(0,u.observer)((function(e){var t=e.model,n=le();return(0,k.jsx)(k.Fragment,{children:t.staticBlocks.map((function(e,r){if(e instanceof te.b0){var a=(0,re.C)(e.start,e.end,t.bpPerPx);return(0,k.jsx)(ne.b0,{block:e,children:a.map((function(r){var a=(e.reversed?e.end-r.base:r.base-e.start)/t.bpPerPx;return(0,k.jsx)("div",{className:(0,I.Z)(n.tick,"major"===r.type||"labeledMajor"===r.type?n.majorTick:n.minorTick),style:{left:a}},r.base)}))},"".concat(e.key,"-").concat(r))}return e instanceof te.sh?(0,k.jsx)(ne.sh,{width:e.widthPx},e.key):e instanceof te.n2?(0,k.jsx)(ne.n2,{width:e.widthPx,boundary:"boundary"===e.variant},e.key):null}))})}));var fe=(0,u.observer)((function(e){var t=e.model,n=le(),r=t.staticBlocks.offsetPx-t.offsetPx;return(0,k.jsx)("div",{className:n.verticalGuidesZoomContainer,style:{transform:1!==t.scaleFactor?"scaleX(".concat(t.scaleFactor,")"):void 0},children:(0,k.jsx)("div",{className:n.verticalGuidesContainer,style:{left:r,width:t.staticBlocks.totalWidthPx},children:(0,k.jsx)(de,{model:t})})})})),pe=(0,a.Z)((function(){return{centerLineContainer:{background:"transparent",height:"100%",zIndex:5,position:"absolute",border:"1px black dashed",borderTop:"none",borderBottom:"none",pointerEvents:"none"},centerLineText:{position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",fontWeight:"bold"}}}));var he=(0,u.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.centerLineInfo,i=t.trackHeights,o=t.tracks,s=t.width,c=(0,r.useRef)(null),u=pe(),l=s/2;return o.length?(0,k.jsx)("div",{"data-testid":"centerline_container",className:u.centerLineContainer,role:"presentation",ref:c,style:{left:"".concat(l,"px"),width:Math.max(1/n,1)},children:a&&(0,k.jsxs)("div",{"data-testid":"centerline_text",className:u.centerLineText,role:"presentation",style:{left:Math.max(1/n,1)+5,top:i},children:[a.refName,":"," ",Math.max(Math.round(a.offset)+1,0)]})}):null})),ge=(0,a.Z)((function(e){return{tracksContainer:{position:"relative",borderRadius:e.shape.borderRadius,overflow:"hidden"},spacer:{position:"relative",height:g.kB}}}));var me=(0,u.observer)((function(e){var t=e.children,n=e.model,a=ge(),i=(0,r.useRef)(0),o=(0,r.useRef)(!1),s=(0,r.useRef)(),c=(0,r.useRef)(null),u=(0,r.useRef)(0),l=(0,r.useState)(!1),d=(0,v.Z)(l,2),f=d[0],p=d[1];return(0,r.useEffect)((function(){var e=function(){};function t(e){e.preventDefault();var t=e.clientX-u.current;t&&(o.current||(o.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(-t),o.current=!1,u.current=e.clientX}))))}function r(){u.current=0,f&&p(!1)}return f&&(window.addEventListener("mousemove",t,!0),window.addEventListener("mouseup",r,!0),e=function(){window.removeEventListener("mousemove",t,!0),window.removeEventListener("mouseup",r,!0)}),e}),[n,f,u]),(0,r.useEffect)((function(){var e=c.current;function t(e){var t=G()(e);!0===e.ctrlKey?(e.preventDefault(),i.current+=t.pixelY/500,n.setScaleFactor(i.current<0?1-i.current:1/(1+i.current)),s.current&&clearTimeout(s.current),s.current=setTimeout((function(){n.setScaleFactor(1),n.zoomTo(i.current>0?n.bpPerPx*(1+i.current):n.bpPerPx/(1-i.current)),i.current=0}),300)):(Math.abs(t.pixelX)>Math.abs(2*t.pixelY)&&e.preventDefault(),i.current+=t.pixelX,o.current||(o.current=!0,window.requestAnimationFrame((function(){n.horizontalScroll(i.current),i.current=0,o.current=!1}))))}return e?(e.addEventListener("wheel",t),function(){e.removeEventListener("wheel",t)}):function(){}}),[n]),(0,k.jsxs)("div",{ref:c,role:"presentation",className:a.tracksContainer,onMouseDown:function(e){var t=e.target;t.draggable||t.dataset.resizer||0===e.button&&(u.current=e.clientX,p(!0))},onMouseUp:function(e){e.preventDefault(),p(!1)},onMouseLeave:function(e){e.preventDefault()},children:[(0,k.jsx)(fe,{model:n}),n.showCenterLine?(0,k.jsx)(he,{model:n}):null,(0,k.jsx)($,{model:n,ControlComponent:(0,k.jsx)(ue,{model:n,style:{height:g.n8,boxSizing:"border-box"}})}),t]})})),ve=n(34795),ye=n(77162),be=n.n(ye),xe=n(92628),we=n(29623),ke=n(537),Ce=n(16383),Ze=n(52185),Se=n(84291),Te=n(33964),Pe=(0,r.lazy)((function(){return Promise.resolve().then(n.bind(n,51160))})),Re=(0,a.Z)((function(e){return{importFormContainer:{padding:e.spacing(2)},button:{margin:e.spacing(2)},container:{padding:e.spacing(4)}}})),Me=(0,u.observer)((function(e){var t,n=e.model,a=Re(),i=(0,F.getSession)(n),o=i.assemblyNames,c=i.assemblyManager,u=i.textSearchManager,l=n.rankSearchResults,d=n.isSearchDialogDisplayed,f=n.error,p=(0,r.useState)(o[0]),h=(0,v.Z)(p,2),m=h[0],y=h[1],b=(0,r.useState)(f),x=(0,v.Z)(b,2),w=x[0],C=x[1],Z=n.searchScope(m),S=c.get(m),T=o.length?null===S||void 0===S?void 0:S.error:"No configured assemblies",P=(null===S||void 0===S?void 0:S.regions)||[],R=T||w,M=(0,r.useState)(),j=(0,v.Z)(M,2),A=j[0],N=j[1],L=A||new Ze.Z({label:null===(t=P[0])||void 0===t?void 0:t.refName}),I=null===L||void 0===L?void 0:L.getLocation();function D(e,t){return E.apply(this,arguments)}function E(){return(E=(0,ve.Z)(be().mark((function e(t,n){var r,a,i;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u||console.warn("No text search manager"),e.next=3,null===u||void 0===u?void 0:u.search({queryString:t,searchType:n},Z,l);case 3:return a=e.sent,i=null===S||void 0===S||null===(r=S.allRefNames)||void 0===r?void 0:r.filter((function(e){return e.startsWith(t)})).map((function(e){return new Ze.Z({label:e})})).slice(0,10),e.abrupt("return",[].concat((0,B.Z)(i||[]),(0,B.Z)(a||[])));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return(O=(0,ve.Z)(be().mark((function e(t){var r,a,o,s;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L){e.next=2;break}return e.abrupt("return");case 2:if(r=L.getTrackId(),a=t||L.getLocation()||"",e.prev=4,null===S||void 0===S||null===(o=S.allRefNames)||void 0===o||!o.includes(a)){e.next=9;break}n.navToLocString(a,m),e.next=20;break;case 9:return e.next=11,D(t,"exact");case 11:if(!((s=e.sent)&&s.length>1)){e.next=17;break}return n.setSearchResults(s,t.toLowerCase()),e.abrupt("return");case 17:1===(null===s||void 0===s?void 0:s.length)&&(a=s[0].getLocation(),r=s[0].getTrackId());case 18:n.navToLocString(a,m),r&&n.showTrack(r);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),console.error(e.t0),i.notify("".concat(e.t0),"warning");case 26:case"end":return e.stop()}}),e,null,[[4,22]])})))).apply(this,arguments)}var z=g.EE+5;return(0,k.jsxs)("div",{className:a.container,children:[R?(0,k.jsx)(Ce.default,{error:R}):null,(0,k.jsx)(xe.Z,{className:a.importFormContainer,children:(0,k.jsx)("form",{onSubmit:function(e){return e.preventDefault()},children:(0,k.jsxs)(we.Z,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,k.jsx)(we.Z,{item:!0,children:(0,k.jsx)(Se.Z,{onChange:function(e){C(void 0),y(e)},session:i,selected:m,InputProps:{style:{height:z}}})}),(0,k.jsx)(we.Z,{item:!0,children:m?R?(0,k.jsx)(V.Z,{style:{color:"red"}}):I?(0,k.jsx)(Te.Z,{fetchResults:D,model:n,assemblyName:T?void 0:m,value:I,minWidth:270,onSelect:function(e){return N(e)},TextFieldProps:{variant:"outlined",helperText:"Enter sequence name, feature name, or location",style:{minWidth:"175px"},InputProps:{style:{height:z}}}}):(0,k.jsx)(ke.Z,{role:"progressbar",size:20,disableShrink:!0}):null}),(0,k.jsxs)(we.Z,{item:!0,children:[(0,k.jsx)(s.Z,{type:"submit",disabled:!I,className:a.button,onClick:function(){n.setError(void 0),I&&function(e){O.apply(this,arguments)}(I)},variant:"contained",color:"primary",children:"Open"}),(0,k.jsx)(s.Z,{disabled:!I,className:a.button,onClick:function(){n.setError(void 0),n.showAllRegionsInAssembly(m)},variant:"contained",color:"secondary",children:"Show all regions in assembly"})]})]})})}),d?(0,k.jsx)(Pe,{model:n,optAssemblyName:m,handleClose:function(){return n.setSearchResults(void 0,void 0)}}):null]})})),je=Me,Ae=n(23064),Ne=n(76770),Le=(0,u.observer)((function(e){var t=e.model,n=t.bpPerPx,a=t.maxBpPerPx,i=t.minBpPerPx,s=t.scaleFactor,c=(0,r.useState)(),u=(0,v.Z)(c,2),l=u[0],d=u[1];return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(o.Z,{style:{background:"#aaa7"},children:[(0,k.jsx)(y.Z,{color:"secondary",onClick:function(e){d(e.currentTarget)},children:(0,k.jsx)(Ae.Z,{})}),(0,k.jsx)(y.Z,{"data-testid":"zoom_out",onClick:function(){t.zoom(2*n)},disabled:n>=a-1e-4||1!==s,color:"secondary",children:(0,k.jsx)(w.Z,{})}),(0,k.jsx)(y.Z,{"data-testid":"zoom_in",onClick:function(){t.zoom(t.bpPerPx/2)},disabled:n<=i+1e-4||1!==s,color:"secondary",children:(0,k.jsx)(x.Z,{})})]}),(0,k.jsx)(Ne.Z,{anchorEl:l,open:Boolean(l),onMenuItemClick:function(e,t){t(),d(void 0)},onClose:function(){d(void 0)},menuItems:t.menuItems()})]})})),Fe=n(83483),Ie=n(64501),Be=n(89001),De=n(93138),Ee=n(7690),Ve=n(53033),Oe=n(21918),ze=n(34760),We=n.n(ze);function He(e){return e.map((function(e){return">".concat(e.header,"\n").concat(e.seq.replace(/(.{1,80})/g,"$1\n").trimEnd())})).join("\n")}var qe=n(75966),Ue=(0,a.Z)((function(e){return{loadingMessage:{padding:e.spacing(5)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"}}}));function _e(e,t,n){return Ge.apply(this,arguments)}function Ge(){return(Ge=(0,ve.Z)(be().mark((function e(t,n,r){var a,i,o,s,c,u,l,d,f;return be().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,F.getSession)(t),i=t.leftOffset,o=t.rightOffset,i&&o){e.next=4;break}throw new Error("no offsets on model to use for range");case 4:if(i.assemblyName===o.assemblyName){e.next=6;break}throw new Error("not able to fetch sequences from multiple assemblies");case 6:if(s=a.rpcManager,c=a.assemblyManager,u=i.assemblyName||o.assemblyName||"",l=c.get(u)){e.next=11;break}throw new Error("assembly ".concat(u," not found"));case 11:return d=(0,N.getConf)(l,["sequence","adapter"]),f="getSequence",e.abrupt("return",s.call(f,"CoreGetFeatures",{adapterConfig:d,regions:n,sessionId:f,signal:r}));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Je=(0,u.observer)((function(e){var t=e.model,n=e.handleClose,a=Ue(),o=(0,F.getSession)(t),u=(0,r.useState)(),l=(0,v.Z)(u,2),d=l[0],f=l[1],p=(0,r.useState)(),h=(0,v.Z)(p,2),g=h[0],m=h[1],b=Boolean(void 0===g),x=t.leftOffset,w=t.rightOffset,C=(0,r.useMemo)((function(){return t.getSelectedRegions(x,w)}),[t,x,w]);(0,r.useEffect)((function(){var e=!0,n=new AbortController;return(0,ve.Z)(be().mark((function r(){var a;return be().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(C.length>0)){r.next=8;break}return r.next=4,_e(t,C,n.signal);case 4:a=r.sent,e&&m(He(a.filter((function(e){return!!e})).map((function(e){var t=e.get("seq"),n=e.get("refName"),r=e.get("start")+1,a=e.get("end"),i="".concat(n,":").concat(r,"-").concat(a);if((null===t||void 0===t?void 0:t.length)!==a-r+1)throw new Error("".concat(i," returned ").concat(t.length.toLocaleString()," bases, but should have returned ").concat((a-r).toLocaleString()));return{header:i,seq:t}})))),r.next=9;break;case 8:throw new Error("Selected region is out of bounds");case 9:r.next=15;break;case 11:r.prev=11,r.t0=r.catch(0),console.error(r.t0),e&&f(r.t0);case 15:case"end":return r.stop()}}),r,null,[[0,11]])})))(),function(){n.abort(),e=!1}}),[t,o,C,m]);var Z=!!g&&g.length>1e6;return(0,k.jsxs)(Fe.Z,{"data-testid":"sequence-dialog",maxWidth:"xl",open:!0,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,k.jsxs)(Ie.Z,{id:"alert-dialog-title",children:["Reference sequence",n?(0,k.jsx)(y.Z,{"data-testid":"close-seqDialog",className:a.closeButton,onClick:function(){n(),t.setOffsets(void 0,void 0)},children:(0,k.jsx)(V.Z,{})}):null]}),(0,k.jsx)(Be.Z,{}),(0,k.jsxs)(De.Z,{children:[d?(0,k.jsx)(i.Z,{color:"error",children:"".concat(d)}):null,b&&!d?(0,k.jsxs)(xe.Z,{children:["Retrieving reference sequence...",(0,k.jsx)(ke.Z,{style:{marginLeft:10},size:20,disableShrink:!0})]}):null,(0,k.jsx)(Ee.Z,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,disabled:Z,className:a.dialogContent,fullWidth:!0,value:Z?"Reference sequence too large to display, use the download FASTA button":g,InputProps:{readOnly:!0,classes:{input:a.textAreaFont}}})]}),(0,k.jsxs)(Ve.Z,{children:[(0,k.jsx)(s.Z,{onClick:function(){We()(g||""),o.notify("Copied to clipboard","success")},disabled:b||!!d||Z,color:"primary",startIcon:(0,k.jsx)(c.pt,{}),children:"Copy to clipboard"}),(0,k.jsx)(s.Z,{onClick:function(){var e=new Blob([g||""],{type:"text/x-fasta;charset=utf-8"});(0,Oe.saveAs)(e,"jbrowse_ref_seq.fa")},disabled:b||!!d,color:"primary",startIcon:(0,k.jsx)(qe.Z,{}),children:"Download FASTA"}),(0,k.jsx)(s.Z,{onClick:n,color:"primary",autoFocus:!0,children:"Close"})]})]})})),Xe=n(51160),Ye=(0,a.Z)((function(e){return{note:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(1)},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}})),Qe=(0,u.observer)((function(e){var t=e.model,n=t.tracks,r=t.error,a=t.hideHeader,u=t.initialized,l=t.hasDisplayedRegions,d=Ye();return u||r?!l||r?(0,k.jsx)(je,{model:t}):(0,k.jsxs)("div",{style:{position:"relative"},children:[t.seqDialogDisplayed?(0,k.jsx)(Je,{model:t,handleClose:function(){t.setSequenceDialogOpen(!1)}}):null,t.isSearchDialogDisplayed?(0,k.jsx)(Xe.default,{model:t,handleClose:function(){t.setSearchResults(void 0,void 0)}}):null,a?(0,k.jsx)("div",{style:{position:"absolute",right:0,zIndex:1001},children:(0,k.jsx)(Le,{model:t})}):(0,k.jsx)(j,{model:t}),(0,k.jsx)(me,{model:t,children:n.length?n.map((function(e){return(0,k.jsx)(U,{model:t,track:e},e.id)})):(0,k.jsxs)(o.Z,{variant:"outlined",className:d.note,children:[(0,k.jsx)(i.Z,{children:"No tracks active."}),(0,k.jsx)(s.Z,{variant:"contained",color:"primary",onClick:t.activateTrackSelector,style:{zIndex:1e3},startIcon:(0,k.jsx)(c.GD,{}),children:"Open track selector"})]})})]}):(0,k.jsx)(i.Z,{className:d.dots,variant:"h5",children:"Loading"})}))},1433:function(e,t,n){"use strict";n.d(t,{VZ:function(){return R},mg:function(){return S},ZP:function(){return A}});var r=n(96234),a=n(33028),i=n(30969),o=n(22714),s=n(38827),c=n(53239),u=n(80975),l=n(90550),d=n(81856),f=n(54006),p=n(81073),h=n(56891),g=n(97862),m=n(73326),v=n(317),y=n(2296),b=n(37574),x=(0,o.Z)((function(e){var t=e.palette,n=t.tertiary,r=t.primary;return{rubberBand:{height:"100%",background:n?(0,c.Fq)(n.main,.7):(0,c.Fq)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberBandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberBandText:{color:n?n.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10}}})),w=(0,l.observer)((function(e){var t,n=e.model,r=e.open,a=e.guideX,i=e.overview,o=x(),s=n.cytobandOffset,c=(0,p.getSession)(n).assemblyManager,u=i.pxToBp(a-s),l=c.get(u.assemblyName),d=null===l||void 0===l||null===(t=l.cytobands)||void 0===t?void 0:t.find((function(e){return u.coord>e.get("start")&&u.coord<e.get("end")&&u.refName===l.getCanonicalRefName(e.get("refName"))}));return(0,b.jsx)(v.ZP,{open:r,placement:"top",title:[(0,p.stringify)(u),null===d||void 0===d?void 0:d.get("name")].join(" "),arrow:!0,children:(0,b.jsx)("div",{className:o.guide,style:{left:a}})})}));function k(e){var t=e.model,n=e.overview,a=e.ControlComponent,o=void 0===a?(0,b.jsx)("div",{}):a,s=t.cytobandOffset,c=(0,i.useState)(),l=(0,r.Z)(c,2),d=l[0],f=l[1],h=(0,i.useState)(),m=(0,r.Z)(h,2),v=m[0],k=m[1],C=(0,i.useState)(),Z=(0,r.Z)(C,2),S=Z[0],T=Z[1],P=(0,i.useRef)(null),R=(0,i.useRef)(null),M=x(),j=void 0!==d;function A(e){e.preventDefault(),e.stopPropagation(),P.current&&f(e.clientX-P.current.getBoundingClientRect().left)}function N(e){P.current&&T(e.clientX-P.current.getBoundingClientRect().left)}function L(){T(void 0)}if((0,i.useEffect)((function(){function e(e){var t=P.current;if(t&&j){var n=e.clientX-t.getBoundingClientRect().left;k(n)}}function r(){if(P.current&&void 0!==d&&void 0!==v&&Math.abs(v-d)>3&&t.zoomToDisplayedRegions(n.pxToBp(d-s),n.pxToBp(v-s)),P.current&&void 0!==d&&void 0===v){var e=n.pxToBp(d-s);t.centerAt(Math.round(e.coord),e.refName,e.index)}f(void 0),k(void 0),void 0!==d&&T(void 0)}function a(e){"Escape"===e.key&&(f(void 0),k(void 0))}return j?(window.addEventListener("mousemove",e,!0),window.addEventListener("mouseup",r,!0),window.addEventListener("keydown",a,!0),function(){window.removeEventListener("mousemove",e,!0),window.removeEventListener("mouseup",r,!0),window.removeEventListener("keydown",a,!0)}):function(){}}),[j,v,d,t,n,s]),void 0===d)return(0,b.jsxs)("div",{style:{position:"relative"},children:[void 0!==S?(0,b.jsx)(w,{model:t,open:!j,overview:n,guideX:S}):null,(0,b.jsx)("div",{className:M.rubberBandControl,role:"presentation",ref:P,onMouseDown:A,onMouseOut:L,onMouseMove:N,children:o})]});var F,I,B=d||0,D=0;if(void 0!==d&&void 0!==v&&(B=v<d?v:d,D=v-d),d&&(F=n.pxToBp(d-s),I=n.pxToBp(d+D-s),v&&v<d)){var E=[I,F];F=E[0],I=E[1]}return(0,b.jsxs)("div",{style:{position:"relative"},children:[R.current?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.ZP,{className:M.popover,classes:{paper:M.paper},open:!0,anchorEl:R.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:(0,b.jsx)(u.Z,{children:F?(0,p.stringify)(F):""})}),(0,b.jsx)(y.ZP,{className:M.popover,classes:{paper:M.paper},open:!0,anchorEl:R.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:(0,b.jsx)(u.Z,{children:I?(0,p.stringify)(I):""})})]}):null,(0,b.jsx)("div",{ref:R,className:M.rubberBand,style:{left:B,width:Math.abs(D),height:g.VH}}),(0,b.jsx)("div",{"data-testid":"rubberBand_controls",className:M.rubberBandControl,role:"presentation",ref:P,onMouseDown:A,onMouseOut:L,onMouseMove:N,children:o})]})}k.defaultProps={ControlComponent:(0,b.jsx)("div",{})};var C=(0,l.observer)(k),Z=(0,o.Z)((function(e){return{scaleBar:{height:g.VH},scaleBarBorder:{border:"1px solid"},scaleBarContig:{backgroundColor:e.palette.background.default,position:"absolute",top:0,height:g.VH},scaleBarContigForward:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M-.1 0L6 4.5L-.1 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarContigReverse:{backgroundImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 15 9'%3E%3Cpath d='M6 0L0 4.5L6 9' fill='none' stroke='%23ddd'/%3E%3C/svg%3E\")",backgroundRepeat:"repeat"},scaleBarRefName:{position:"absolute",fontWeight:"bold",pointerEvents:"none",zIndex:100},scaleBarLabel:{height:g.VH,width:1,position:"absolute",display:"flex",justifyContent:"center",pointerEvents:"none"},scaleBarVisibleRegion:{position:"absolute",height:g.VH,pointerEvents:"none",zIndex:100,border:"1px solid"},overview:{height:g.Od,position:"relative"},overviewSvg:{width:"100%",position:"absolute"}}})),S=(0,l.observer)((function(e){var t=e.model,n=e.overview,r=e.useOffset,i=void 0===r||r,o=(0,s.Z)(),u=Number(i),l=t.interRegionPaddingWidth,d=t.offsetPx,f=t.dynamicBlocks,p=t.cytobandOffset,h=f.contentBlocks,m=f.totalWidthPxWithoutBorders,v=o.palette,y=v.tertiary,x=v.primary,w=y?y.light:x.light;if(!h.length)return null;var k=h[0],C=h[h.length-1],Z=(n.bpToPx((0,a.Z)((0,a.Z)({},k),{},{coord:k.reversed?k.end:k.start}))||0)+p*u,S=(n.bpToPx((0,a.Z)((0,a.Z)({},C),{},{coord:C.reversed?C.start:C.end}))||0)+p*u,T=Math.max(0,-d),P=T+m+h.length*l/2,R=[[T,g.Od],[P,g.Od],[S,0],[Z,0]];return(0,b.jsx)("polygon",{points:R.toString(),fill:(0,c.Fq)(w,.3),stroke:(0,c.Fq)(w,.8)})}));function T(e,t,n,r,a){return"M"+e+","+t+"h"+(n-a)+"a"+a+","+a+" 0 0 1 "+a+","+a+"v"+(r-2*a)+"a"+a+","+a+" 0 0 1 "+-a+","+a+"h"+(a-n)+"z"}var P={gneg:"rgb(227,227,227)",gpos25:"rgb(142,142,142)",gpos50:"rgb(85,85,85)",gpos100:"rgb(0,0,0)",gpos75:"rgb(57,57,57)",gvar:"rgb(0,0,0)",stalk:"rgb(127,127,127)",acen:"#800"},R=(0,l.observer)((function(e){var t,n=e.overview,a=e.block,i=e.assembly,o=a.offsetPx,s=a.reversed,c=null===i||void 0===i||null===(t=i.cytobands)||void 0===t?void 0:t.map((function(e){return{refName:i.getCanonicalRefName(e.get("refName")),start:e.get("start"),end:e.get("end"),type:e.get("type")}})).filter((function(e){return e.refName===a.refName})).map((function(e){var t=e.refName,r=e.start,a=e.end,i=e.type;return[n.bpToPx({refName:t,coord:r}),n.bpToPx({refName:t,coord:a}),i]})),u=c||[],l=s?u.length-1:0,d=s?0:u.length-1,f=!0;return c?(0,b.jsx)("g",{transform:"translate(-".concat(o,")"),children:c.map((function(e,t){var n,a,i,o,s,c=(0,r.Z)(e,3),u=c[0],p=c[1],h=c[2],m="".concat(u,"-").concat(p,"-").concat(h);return"acen"===h&&f?(f=!1,(0,b.jsx)("polygon",{points:[[u,0],[p,g.VH/2],[u,g.VH]].toString(),fill:P[h]},m)):"acen"!==h||f?l===t?(0,b.jsx)("path",{d:(n=Math.min(u,p),a=0,i=Math.abs(p-u),o=g.VH,s=8,"M"+(n+s)+","+a+"h"+(i-s)+"v"+o+"h"+(s-i)+"a"+s+","+s+" 0 0 1 "+-s+","+-s+"v"+(2*s-o)+"a"+s+","+s+" 0 0 1 "+s+","+-s+"z"),fill:P[h]},m):d===t?(0,b.jsx)("path",{d:T(Math.min(u,p),0,Math.abs(p-u)-2,g.VH,8),fill:P[h]},m):(0,b.jsx)("rect",{x:Math.min(u,p),y:0,width:Math.abs(p-u),height:g.VH,fill:P[h]},m):(0,b.jsx)("polygon",{points:[[u,g.VH/2],[p,0],[p,g.VH]].toString(),fill:P[h]},m)}))}):null})),M=(0,l.observer)((function(e){for(var t=e.scale,n=e.model,r=e.block,a=e.overview,i=Z(),o=n.cytobandOffset,s=n.showCytobands,c=r.start,l=r.end,f=r.reversed,h=r.refName,g=r.assemblyName,v=(0,m._)(t,120,15).majorPitch,y=(0,p.getSession)(n).assemblyManager.get(g),x=null===y||void 0===y?void 0:y.getRefNameColor(h),w=[],k=0;k<Math.floor((l-c)/v);k++){var C=(k+1)*v;w.push(f?l-C:c+C)}return(0,b.jsxs)("div",{children:[(0,b.jsx)(u.Z,{style:{left:r.offsetPx+3,color:s?"black":x},className:i.scaleBarRefName,children:h}),(0,b.jsxs)("div",{className:(0,d.Z)(i.scaleBarContig,s?void 0:f?i.scaleBarContigReverse:i.scaleBarContigForward,s?void 0:i.scaleBarBorder),style:{left:r.offsetPx+o,width:r.widthPx,borderColor:x},children:[s?null:w.map((function(e,n){return(0,b.jsx)(u.Z,{className:i.scaleBarLabel,variant:"body2",style:{left:(n+1)*v/t,pointerEvents:"none",color:x},children:e.toLocaleString("en-US")},"".concat(JSON.stringify(r),"-").concat(e,"-").concat(n))})),s?(0,b.jsx)("svg",{style:{width:"100%"},children:(0,b.jsx)(R,{overview:a,assembly:y,block:r})}):null]})]})})),j=(0,l.observer)((function(e){var t=e.model,n=e.scale,r=e.overview,i=Z(),o=(0,s.Z)(),u=t.dynamicBlocks,l=t.showCytobands,d=t.cytobandOffset,f=u.contentBlocks,p=r.dynamicBlocks,g=o.palette,m=g.tertiary,v=g.primary,y=m?m.light:v.light;if(!f.length)return null;var x=f[0],w=r.bpToPx((0,a.Z)((0,a.Z)({},x),{},{coord:x.reversed?x.end:x.start}))||0,k=f[f.length-1],C=r.bpToPx((0,a.Z)((0,a.Z)({},k),{},{coord:k.reversed?k.start:k.end}))||0,S=l?"#f00":y,T=l?.1:.3;return(0,b.jsxs)("div",{className:i.scaleBar,children:[(0,b.jsx)("div",{className:i.scaleBarVisibleRegion,style:{width:C-w,left:w+d,background:(0,c.Fq)(S,T),borderColor:S}}),p.map((function(e,a){return e instanceof h.b0?(0,b.jsx)(M,{scale:n,block:e,model:t,overview:r},"".concat(JSON.stringify(e),"-").concat(a)):(0,b.jsx)("div",{className:i.scaleBarContig,style:{width:e.widthPx,left:e.offsetPx,backgroundColor:"#999",backgroundImage:"repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,.5) 1px, rgba(255,255,255,.5) 3px)"}},"".concat(JSON.stringify(e),"-").concat(a))}))]})}));var A=(0,l.observer)((function(e){var t=e.model,n=e.children,r=Z(),a=t.totalBp,i=t.width,o=t.cytobandOffset,s=t.displayedRegions,c=f.Z.create({displayedRegions:JSON.parse(JSON.stringify(s)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),u=i-o;c.setVolatileWidth(u),c.showAllRegions();var l=a/(u-2*(s.length-1));return(0,b.jsxs)("div",{children:[(0,b.jsx)(C,{model:t,overview:c,ControlComponent:(0,b.jsx)(j,{model:t,overview:c,scale:l})}),(0,b.jsxs)("div",{className:r.overview,children:[(0,b.jsx)("svg",{height:g.Od,className:r.overviewSvg,children:(0,b.jsx)(S,{model:t,overview:c})}),n]})]})}))},33964:function(e,t,n){"use strict";var r=n(68079),a=n(34795),i=n(96234),o=n(33028),s=n(77162),c=n.n(s),u=n(30969),l=n(90550),d=n(81073),f=n(52185),p=n(89603),h=n(7690),g=n(537),m=n(5877),v=n(32343),y=n(80975),b=n(99712),x=n(27061),w=n(22874),k=n(73922),C=n(37574),Z=(0,u.lazy)((function(){return n.e(5375).then(n.bind(n,25375))}));var S=function(e){var t=e.style;return(0,C.jsx)(p.Z,(0,o.Z)((0,o.Z)({},e),{},{style:{width:"fit-content",minWidth:Math.min(+((null===t||void 0===t?void 0:t.width)||0),200),background:"white"},placement:"bottom-start"}))};t.Z=(0,l.observer)((function(e){var t=e.model,n=e.showHelp,s=void 0===n||n,l=e.onSelect,p=e.assemblyName,T=e.style,P=e.fetchResults,R=e.value,M=e.minWidth,j=void 0===M?200:M,A=e.TextFieldProps,N=void 0===A?{}:A,L=(0,d.getSession)(t),F=L.assemblyManager,I=(0,u.useState)(!1),B=(0,i.Z)(I,2),D=B[0],E=B[1],V=(0,u.useState)(!0),O=(0,i.Z)(V,2),z=O[0],W=O[1],H=(0,u.useState)(!1),q=(0,i.Z)(H,2),U=q[0],_=q[1],G=(0,u.useState)(""),J=(0,i.Z)(G,2),X=J[0],Y=J[1],Q=(0,u.useState)(""),$=(0,i.Z)(Q,2),K=$[0],ee=$[1],te=(0,u.useState)(),ne=(0,i.Z)(te,2),re=ne[0],ae=ne[1],ie=(0,d.useDebounce)(X,300),oe=t.coarseVisibleLocStrings,se=t.hasDisplayedRegions,ce=p?F.get(p):void 0,ue=(null===ce||void 0===ce?void 0:ce.regions)||[],le=(0,u.useMemo)((function(){return ue.map((function(e){return{result:new f.R({refName:e.refName,label:e.refName,matchedAttribute:"refName"})}}))}),[ue]);(0,u.useEffect)((function(){var e=!0;return(0,a.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,""!==ie&&p){t.next=3;break}return t.abrupt("return");case 3:return W(!1),t.next=6,P(ie);case 6:n=t.sent,e&&(ae((0,k.D)(n,(function(e){return e.getDisplayString()})).map((function(e){return{result:e}}))),W(!0)),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),console.error(t.t0),e&&L.notify("".concat(t.t0),"error");case 14:case"end":return t.stop()}}),t,null,[[0,10]])})))(),function(){e=!1}}),[p,P,ie,L,t]);var de=oe||R||"",fe=Math.min(Math.max((0,d.measureText)(de,16)+45,j),550);return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(x.ZP,{id:"refNameAutocomplete-".concat(t.id),"data-testid":"autocomplete",disableListWrap:!0,disableClearable:!0,PopperComponent:S,disabled:!p,freeSolo:!0,includeInputInList:!0,selectOnFocus:!0,style:(0,o.Z)((0,o.Z)({},T),{},{width:fe}),value:de,loading:!z,inputValue:K,onInputChange:function(e,t){return ee(t)},loadingText:"loading results",open:D,onOpen:function(){return E(!0)},onClose:function(){E(!1),W(!0),se&&(Y(""),ae(void 0))},onChange:function(e,t){t&&p&&(l("string"===typeof t?new f.Z({label:t}):t.result),ee(de))},options:null!==re&&void 0!==re&&re.length?re:le,getOptionDisabled:function(e){return"limitOption"===(null===e||void 0===e?void 0:e.group)},filterOptions:function(e,t){var n=function(e,t){return e.filter((function(e){var n=e.result;return n.getLabel().toLowerCase().includes(t)||n.matchedObject}))}(e,t.inputValue.toLocaleLowerCase());return[].concat((0,r.Z)(n.slice(0,100)),(0,r.Z)(n.length>100?[{group:"limitOption",result:new f.Z({label:"keep typing for more results"})}]:[]))},renderInput:function(e){var t=N.helperText,n=N.InputProps,r=void 0===n?{}:n;return(0,C.jsx)(h.Z,(0,o.Z)((0,o.Z)((0,o.Z)({onBlur:function(){ee(de)}},e),N),{},{helperText:t,InputProps:(0,o.Z)((0,o.Z)((0,o.Z)({},e.InputProps),r),{},{endAdornment:(0,C.jsxs)(C.Fragment,{children:[0===ue.length?(0,C.jsx)(g.Z,{color:"inherit",size:20}):(0,C.jsxs)(m.Z,{position:"end",style:{marginRight:7},children:[(0,C.jsx)(b.Z,{}),s?(0,C.jsx)(v.Z,{onClick:function(){return _(!0)},children:(0,C.jsx)(w.Z,{})}):null]}),e.InputProps.endAdornment]})}),placeholder:"Search for location",onChange:function(e){Y(e.target.value)}}))},renderOption:function(e){var t=e.result,n=t.getRenderingComponent();return n&&u.isValidElement(n)?n:(0,C.jsx)(y.Z,{noWrap:!0,children:t.getDisplayString()})},getOptionLabel:function(e){return("string"===typeof e?e:e.result.getLabel())||""}}),U?(0,C.jsx)(u.Suspense,{fallback:(0,C.jsx)("div",{}),children:(0,C.jsx)(Z,{handleClose:function(){return _(!1)}})}):null]})}))},3223:function(e,t,n){"use strict";var r=n(68079),a=n(34795),i=n(77162),o=n.n(i),s=(n(30969),n(90550)),c=n(22714),u=n(38827),l=n(53239),d=n(52185),f=n(81073),p=n(33964),h=n(73922),g=n(97862),m=n(37574),v=(0,c.Z)((function(){return{headerRefName:{minWidth:100}}}));t.Z=(0,s.observer)((function(e){var t=e.model,n=e.showHelp,i=v(),s=(0,u.Z)(),c=(0,f.getSession)(t),y=c.textSearchManager,b=c.assemblyManager,x=t.assemblyNames,w=t.rankSearchResults,k=x[0],C=b.get(k),Z=t.searchScope(k);function S(e,t){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)(o().mark((function e(t,n){var a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y||console.warn("No text search manager"),e.next=3,null===y||void 0===y?void 0:y.search({queryString:t,searchType:n},Z,w);case 3:return i=e.sent,s=null===C||void 0===C||null===(a=C.allRefNames)||void 0===a?void 0:a.filter((function(e){return e.startsWith(t)})).map((function(e){return new d.Z({label:e})})).slice(0,10),e.abrupt("return",(0,h.D)([].concat((0,r.Z)(s||[]),(0,r.Z)(i||[])),(function(e){return e.getId()})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=(0,a.Z)(o().mark((function e(n){var r,a,i,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.getTrackId(),a=n.getLocation(),i=n.getLabel(),e.prev=3,null===C||void 0===C||null===(s=C.allRefNames)||void 0===s||!s.includes(a)){e.next=8;break}t.navToLocString(a),e.next=19;break;case 8:return e.next=10,S(i,"exact");case 10:if(!((u=e.sent)&&u.length>1)){e.next=16;break}return t.setSearchResults(u,i.toLowerCase()),e.abrupt("return");case 16:1===(null===u||void 0===u?void 0:u.length)&&(a=u[0].getLocation(),r=u[0].getTrackId());case 17:t.navToLocString(a,k),r&&t.showTrack(r);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),console.error(e.t0),c.notify("".concat(e.t0),"warning");case 25:case"end":return e.stop()}}),e,null,[[3,21]])})))).apply(this,arguments)}return(0,m.jsx)(p.Z,{showHelp:n,onSelect:function(e){return P.apply(this,arguments)},assemblyName:k,fetchResults:S,model:t,TextFieldProps:{variant:"outlined",className:i.headerRefName,style:{margin:g.N_,minWidth:"175px"},InputProps:{style:{padding:0,height:g.EE,background:(0,l.Fq)(s.palette.background.paper,.8)}}}})}))},51160:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Z},useStyles:function(){return C}});n(30969);var r=n(40909),a=n(81073),i=n(22714),o=n(83483),s=n(64501),c=n(32343),u=n(89001),l=n(93138),d=n(80975),f=n(84690),p=n(51526),h=n(19521),g=n(50158),m=n(43555),v=n(77810),y=n(3407),b=n(28599),x=n(53033),w=n(14008),k=n(37574),C=(0,i.Z)((function(e){return{dialogContent:{width:"80em"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function Z(e){var t,n,i=e.model,Z=e.optAssemblyName,S=e.handleClose,T=C(),P=(0,a.getSession)(i),R=(0,r.getEnv)(P).pluginManager,M=P.assemblyManager,j=Z;i.displayedRegions.length>0&&(j=null===(n=i.displayedRegions[0])||void 0===n?void 0:n.assemblyName);if(!j)throw new Error("Assembly name not found");var A=M.get(j);if(!A)throw new Error("assembly ".concat(j," not found"));if(!A.regions)throw new Error("assembly ".concat(j," regions not loaded"));var N=A.regions;function L(e){if(e){var t,n=R.pluggableConfigSchemaType("track"),a=(0,r.resolveIdentifier)(n,(0,r.getRoot)(i),e);if(a)return null===(t=a.name)||void 0===t?void 0:t.value}return""}return(0,k.jsxs)(o.Z,{open:!0,maxWidth:"xl",onClose:S,children:[(0,k.jsxs)(s.Z,{children:["Search results",S?(0,k.jsx)(c.Z,{"data-testid":"close-resultsDialog",className:T.closeButton,onClick:function(){S()},children:(0,k.jsx)(w.Z,{})}):null]}),(0,k.jsx)(u.Z,{}),(0,k.jsx)(l.Z,{children:null!==(t=i.searchResults)&&void 0!==t&&t.length?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(d.Z,{children:["Showing results for ",(0,k.jsx)("b",{children:i.searchQuery})]}),(0,k.jsx)(f.Z,{component:p.Z,children:(0,k.jsxs)(h.Z,{children:[(0,k.jsx)(g.Z,{children:(0,k.jsxs)(m.Z,{children:[(0,k.jsx)(v.Z,{children:"Name"}),(0,k.jsx)(v.Z,{align:"right",children:"Location"}),(0,k.jsx)(v.Z,{align:"right",children:"Track"}),(0,k.jsx)(v.Z,{align:"right"})]})}),(0,k.jsx)(y.Z,{children:i.searchResults.map((function(e){return(0,k.jsxs)(m.Z,{children:[(0,k.jsx)(v.Z,{component:"th",scope:"row",children:e.getLabel()}),(0,k.jsx)(v.Z,{align:"right",children:e.getLocation()}),(0,k.jsx)(v.Z,{align:"right",children:L(e.getTrackId())||"N/A"}),(0,k.jsx)(v.Z,{align:"right",children:(0,k.jsx)(b.Z,{onClick:function(){!function(e){try{var t=N.find((function(t){return e===t.refName}));t?(i.setDisplayedRegions([t]),i.showAllRegions()):i.navToLocString(e,j)}catch(n){console.warn(n),P.notify("".concat(n),"warning")}}(e.getLocation());var t=e.getTrackId();t&&i.showTrack(t),S()},disabled:!L(e.getTrackId()),color:"primary",variant:"contained",children:"Go"})})]},"".concat(e.getId()))}))})]})})]}):(0,k.jsxs)(d.Z,{children:["No results found for ",(0,k.jsx)("b",{children:i.searchQuery})]})}),(0,k.jsx)(u.Z,{}),(0,k.jsx)(x.Z,{children:(0,k.jsx)(b.Z,{onClick:function(){return S()},color:"primary",children:"Cancel"})})]})}},73922:function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.filter((function(e,n,r){return n===r.findIndex((function(n){return t(n)===t(e)}))}))}n.d(t,{D:function(){return r}})},97862:function(e,t,n){"use strict";n.d(t,{Od:function(){return pe},VH:function(){return he},kB:function(){return me},n8:function(){return ge},N_:function(){return ve},Rj:function(){return $.Z},EE:function(){return ye},e$:function(){return xe}});var r=n(34795),a=n(41361),i=n(96234),o=n(68079),s=n(33028),c=n(77162),u=n.n(c),l=n(9077),d=n(59853),f=n(29206),p=n(24998),h=n(81073),g=n(60717),m=n(31517),v=n(97891),y=n(35247),b=n(40909),x=n(54006),w=n(39554),k=n.n(w),C=n(21918),Z=n(22417),S=n(43184),T=n(74464),P=n(18406),R=n(52477),M=n(69650),j=n(90722),A=n(52274),N=n(30969),L=n(2082),F=n(22714),I=n(90550),B=n(73326),D=n(37574);function E(e){return e<999?String(e):"".concat(E(~~(e/1e3)),",").concat("00".concat(~~(e%1e3)).substr(-3,3))}var V=(0,F.Z)((function(){return{majorTickLabel:{fontSize:"11px"},majorTick:{stroke:"#555"},minorTick:{stroke:"#999"}}}));function O(e){var t=e.start,n=e.end,r=e.bpPerPx,a=e.reversed,i=e.major,o=e.minor,s=V(),c=(0,B.C)(t,n,r,i,o);return(0,D.jsxs)(D.Fragment,{children:[c.map((function(e){var i=(a?n-e.base:e.base-t)/r;return(0,D.jsx)("line",{x1:i,x2:i,y1:0,y2:"major"===e.type?6:4,strokeWidth:1,stroke:"major"===e.type?"#555":"#999",className:"major"===e.type?s.majorTick:s.minorTick,"data-bp":e.base},e.base)})),c.filter((function(e){return"major"===e.type})).map((function(e){var i=(a?n-e.base:e.base-t)/r;return(0,D.jsx)("text",{x:i-3,y:18,style:{fontSize:"11px"},className:s.majorTickLabel,children:E(e.base+1)},"label-".concat(e.base))}))]})}O.defaultProps={reversed:!1,major:!0,minor:!0};var z=(0,I.observer)(O),W=n(1433);function H(e){var t=e.model,n=e.fontSize,r=t.offsetPx,a=t.dynamicBlocks,i=a.totalWidthPxWithoutBorders,o=a.totalBp,s=(0,h.getBpDisplayStr)(o),c=Math.max(-r,0),u=c+i;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("line",{x1:c,x2:u,y1:10,y2:10,stroke:"black"}),(0,D.jsx)("line",{x1:c,x2:c,y1:5,y2:15,stroke:"black"}),(0,D.jsx)("line",{x1:u,x2:u,y1:5,y2:15,stroke:"black"}),(0,D.jsx)("text",{x:c+(u-c)/2,y:2*n,textAnchor:"middle",fontSize:n,children:s})]})}function q(e){var t=e.model,n=e.fontSize,r=e.width,a=t.dynamicBlocks.contentBlocks,i=t.offsetPx,o=t.bpPerPx,s=a.length<5;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("defs",{children:(0,D.jsx)("clipPath",{id:"clip-ruler",children:(0,D.jsx)("rect",{x:0,y:0,width:r,height:20})})}),a.map((function(e){var t=e.key,r=e.start,a=e.end,c=e.reversed,u=e.offsetPx,l=e.refName,d=u-i;return(0,D.jsxs)("g",{transform:"translate(".concat(d," 0)"),children:[(0,D.jsx)("text",{x:d/o,y:n,fontSize:n,children:l}),s?(0,D.jsx)("g",{transform:"translate(0 20)",clipPath:"url(#clip-ruler)",children:(0,D.jsx)(z,{start:r,end:a,bpPerPx:o,reversed:c})}):(0,D.jsx)("line",{strokeWidth:1,stroke:"black",x1:r/o,x2:a/o,y1:20,y2:20})]},"".concat(t))}))]})}var U=15,_=function(e){return e.reduce((function(e,t){return e+t.displays[0].height+20+20}),0)},G=function(e){var t=e.model,n=t.width,r=t.assemblyNames,a=t.showCytobands,i=t.displayedRegions,o=(0,h.getSession)(t).assemblyManager,c=r.length>1?"":r[0],u=o.get(c),l=x.Z.create({displayedRegions:JSON.parse(JSON.stringify(i)),interRegionPaddingWidth:0,minimumBlockWidth:t.minimumBlockWidth}),d=t.dynamicBlocks.contentBlocks;l.setVolatileWidth(n),l.showAllRegions();var f=l.dynamicBlocks.contentBlocks[0],p=d[0],g=l.bpToPx((0,s.Z)((0,s.Z)({},p),{},{coord:p.reversed?p.end:p.start}))||0,m=d[d.length-1],v=l.bpToPx((0,s.Z)((0,s.Z)({},m),{},{coord:m.reversed?m.start:m.end}))||0,y=a?100:0;return(0,D.jsxs)("g",{id:"header",children:[(0,D.jsx)("text",{x:0,y:U,fontSize:U,children:c}),a?(0,D.jsxs)("g",{transform:"translate(0 ".concat(50,")"),children:[(0,D.jsx)(W.VZ,{overview:l,assembly:u,block:f}),(0,D.jsx)("rect",{stroke:"red",fill:"rgb(255,0,0,0.1)",width:Math.max(v-g,.5),height:he-1,x:g,y:.5}),(0,D.jsx)("g",{transform:"translate(0,".concat(he,")"),children:(0,D.jsx)(W.mg,{overview:l,model:t,useOffset:!1})})]}):null,(0,D.jsx)("g",{transform:"translate(0 ".concat(U+y,")"),children:(0,D.jsx)(H,{model:t,fontSize:U})}),(0,D.jsx)("g",{transform:"translate(0 ".concat(50+y,")"),children:(0,D.jsx)(q,{model:t,fontSize:U,width:n})})]})},J=function(e){var t=e.model,n=e.height,r=t.dynamicBlocks,a=t.offsetPx,i=t.interRegionPaddingWidth;return(0,D.jsx)(D.Fragment,{children:r.contentBlocks.slice(1).map((function(e){return(0,D.jsx)("rect",{x:e.offsetPx-a-i,width:i,y:0,height:n,stroke:"none",fill:"grey"},e.key)}))})};function X(e){var t=e.displayResults,n=e.model,r=e.offset;return(0,D.jsx)(D.Fragment,{children:t.map((function(e){var t=e.track,a=e.result,i=r,o=(0,l.getConf)(t,"name")||"Reference sequence (".concat((0,l.readConfObject)((0,b.getParent)(t.configuration),"name"),")"),s=t.displays[0];return r+=s.height+20+20,(0,D.jsxs)("g",{transform:"translate(0 ".concat(i,")"),children:[(0,D.jsx)("text",{fontSize:U,x:Math.max(-n.offsetPx,0),children:o}),(0,D.jsxs)("g",{transform:"translate(0 ".concat(20,")"),children:[a,(0,D.jsx)(J,{model:n,height:s.height})]})]},t.configuration.trackId)}))})}function Y(e,t){return Q.apply(this,arguments)}function Q(){return Q=(0,r.Z)(u().mark((function e(t,n){var a,i,o,s,c,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,y.when)((function(){return t.initialized}));case 2:return a=t.width,i=t.tracks,o=t.showCytobands,s=50,c=90+(o?100:0)+20,l=_(i)+c,e.next=8,Promise.all(i.map(function(){var e=(0,r.Z)(u().mark((function e(t){var r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.displays[0],e.next=3,(0,y.when)((function(){return void 0===r.ready||r.ready}));case 3:return e.next=5,r.renderSvg(n);case 5:return a=e.sent,e.abrupt("return",{track:t,result:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return d=e.sent,e.abrupt("return",(0,L.renderToStaticMarkup)((0,D.jsxs)("svg",{width:a,height:l,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,a+2*s,l].toString(),children:[(0,D.jsx)("rect",{width:a+2*s,height:l,fill:"white"}),(0,D.jsxs)("g",{stroke:"none",transform:"translate(".concat(s," ").concat(U,")"),children:[(0,D.jsx)(G,{model:t}),(0,D.jsx)(X,{model:t,displayResults:d,offset:c})]})]})));case 10:case"end":return e.stop()}}),e)}))),Q.apply(this,arguments)}n(33964);var $=n(3223),K=n(83483),ee=n(64501),te=n(32343),ne=n(93138),re=n(537),ae=n(80975),ie=n(93717),oe=n(24684),se=n(53033),ce=n(28599),ue=n(14008),le=(0,F.Z)((function(e){return{closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));function de(e){var t=e.model,n=e.handleClose,a="undefined"!==typeof OffscreenCanvas,o=(0,N.useState)(a),s=(0,i.Z)(o,2),c=s[0],l=s[1],d=(0,N.useState)(!1),f=(0,i.Z)(d,2),p=f[0],h=f[1],g=(0,N.useState)(),m=(0,i.Z)(g,2),v=m[0],y=m[1],b=le();return(0,D.jsxs)(K.Z,{open:!0,onClose:n,children:[(0,D.jsxs)(ee.Z,{children:["Export SVG",(0,D.jsx)(te.Z,{className:b.closeButton,onClick:n,children:(0,D.jsx)(ue.Z,{})})]}),(0,D.jsxs)(ne.Z,{children:[v?(0,D.jsx)("div",{style:{color:"red"},children:"".concat(v)}):p?(0,D.jsxs)("div",{children:[(0,D.jsx)(re.Z,{size:20,style:{marginRight:20}}),(0,D.jsx)(ae.Z,{display:"inline",children:"Creating SVG"})]}):null,a?(0,D.jsx)(ie.Z,{control:(0,D.jsx)(oe.Z,{checked:c,onChange:function(){return l((function(e){return!e}))}}),label:"Rasterize canvas based tracks? File may be much larger if this is turned off"}):(0,D.jsx)(ae.Z,{children:"Note: rasterizing layers not yet supported in this browser, so SVG size may be large"})]}),(0,D.jsxs)(se.Z,{children:[(0,D.jsx)(ce.Z,{variant:"contained",color:"secondary",onClick:function(){return n()},children:"Cancel"}),(0,D.jsx)(ce.Z,{variant:"contained",color:"primary",type:"submit",onClick:(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),y(void 0),e.prev=2,e.next=5,t.exportSvg({rasterizeLayers:c});case 5:n(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),console.error(e.t0),y(e.t0);case 12:return e.prev=12,h(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,8,12,15]])}))),children:"Submit"})]})]})}n(4935);function fe(e){if(!e.length)return"";var t=e.every((function(t){return t.assemblyName===e[0].assemblyName}));return e.map((function(e){return(0,h.assembleLocString)((0,s.Z)((0,s.Z)({},e),{},{start:Math.round(e.start),end:Math.round(e.end),assemblyName:t?void 0:e.assemblyName}))})).join(" ")}var pe=48,he=20,ge=17,me=3,ve=7,ye=32;function be(e){return"undefined"!==typeof localStorage?localStorage.getItem(e):void 0}function xe(e){return b.types.compose(d.BaseViewModel,b.types.model("LinearGenomeView",{id:f.ElementId,type:b.types.literal("LinearGenomeView"),offsetPx:0,bpPerPx:1,displayedRegions:b.types.array(f.Region),tracks:b.types.array(e.pluggableMstType("track","stateModel")),hideHeader:!1,hideHeaderOverview:!1,trackSelectorType:b.types.optional(b.types.enumeration(["hierarchical"]),"hierarchical"),trackLabels:b.types.optional(b.types.string,(function(){return be("lgv-trackLabels")||"overlapping"})),showCenterLine:b.types.optional(b.types.boolean,(function(){var e=be("lgv-showCenterLine");return void 0!==e&&null!==e&&!!+e})),showCytobandsSetting:b.types.optional(b.types.boolean,(function(){var e=be("lgv-showCytobands");return void 0===e||null===e||!!+e}))})).volatile((function(){return{volatileWidth:void 0,minimumBlockWidth:3,draggingTrackId:void 0,volatileError:void 0,afterDisplayedRegionsSetCallbacks:[],scaleFactor:1,trackRefs:{},coarseDynamicBlocks:[],coarseTotalBp:0,leftOffset:void 0,rightOffset:void 0,searchResults:void 0,searchQuery:void 0,seqDialogDisplayed:!1}})).views((function(e){return{get width(){if(void 0===e.volatileWidth)throw new Error("width undefined, make sure to check for model.initialized");return e.volatileWidth},get interRegionPaddingWidth(){return 2}}})).views((function(e){return{get assemblyErrors(){var t=(0,h.getSession)(e).assemblyManager;return this.assemblyNames.map((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.error})).filter((function(e){return!!e})).join(", ")},get assembliesInitialized(){var t=(0,h.getSession)(e).assemblyManager;return this.assemblyNames.every((function(e){var n;return null===(n=t.get(e))||void 0===n?void 0:n.initialized}))},get initialized(){return void 0!==e.volatileWidth&&this.assembliesInitialized},get hasDisplayedRegions(){return e.displayedRegions.length>0},get isSearchDialogDisplayed(){return void 0!==e.searchResults},get scaleBarHeight(){return ge+me},get headerHeight(){return e.hideHeader?0:e.hideHeaderOverview?pe:pe+he},get trackHeights(){return e.tracks.map((function(e){return e.displays[0].height})).reduce((function(e,t){return e+t}),0)},get trackHeightsWithResizeHandles(){return this.trackHeights+e.tracks.length*me},get height(){return this.trackHeightsWithResizeHandles+this.headerHeight+this.scaleBarHeight},get totalBp(){return e.displayedRegions.reduce((function(e,t){return e+t.end-t.start}),0)},get maxBpPerPx(){return this.totalBp/(.9*e.width)},get minBpPerPx(){return.02},get error(){return e.volatileError||this.assemblyErrors},get maxOffset(){return this.displayedRegionsTotalPx-10},get minOffset(){return 30-e.width},get displayedRegionsTotalPx(){return this.totalBp/e.bpPerPx},renderProps:function(){return(0,s.Z)((0,s.Z)({},(0,v.getParentRenderProps)(e)),{},{bpPerPx:e.bpPerPx,highResolutionScaling:(0,l.getConf)((0,h.getSession)(e),"highResolutionScaling")})},get assemblyNames(){return(0,o.Z)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))))},searchScope:function(t){return{assemblyName:t,includeAggregateIndexes:!0,tracks:e.tracks}},bpToPx:function(t){var n=t.refName,r=t.coord,a=t.regionNumber;return(0,h.viewBpToPx)({refName:n,coord:r,regionNumber:a,self:e})},pxToBp:function(t){var n=0,r=(e.offsetPx+t)*e.bpPerPx,a=e.displayedRegions.length;if(r<0){var i=e.displayedRegions[0],o=r;return(0,s.Z)((0,s.Z)({},(0,b.getSnapshot)(i)),{},{oob:!0,coord:i.reversed?Math.floor(i.end-o)+1:Math.floor(i.start+o)+1,offset:o,index:0})}for(var c=e.interRegionPaddingWidth*e.bpPerPx,u=e.minimumBlockWidth*e.bpPerPx,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l],f=d.end-d.start,p=r-n;if(f+n>r&&n<=r)return(0,s.Z)((0,s.Z)({},(0,b.getSnapshot)(d)),{},{oob:!1,offset:p,coord:d.reversed?Math.floor(d.end-p)+1:Math.floor(d.start+p)+1,index:l});d.end-d.start>u&&p/e.bpPerPx>0&&p/e.bpPerPx<e.width?n+=f+c:n+=f}if(r>=n){var h=e.displayedRegions[a-1],g=r-n+(h.end-h.start);return(0,s.Z)((0,s.Z)({},(0,b.getSnapshot)(h)),{},{oob:!0,offset:g,coord:h.reversed?Math.floor(h.end-g)+1:Math.floor(h.start+g)+1,index:a-1})}return{coord:0,index:0,refName:"",oob:!0,assemblyName:"",offset:0,start:0,end:0,reversed:!1}},getTrack:function(t){return e.tracks.find((function(e){return e.configuration.trackId===t}))},rankSearchResults:function(t){var n=e.tracks.map((function(e){return e.configuration.trackId}));return t.forEach((function(e){n!==[]&&n.includes(e.trackId)&&e.updateScore(e.getScore()+1)})),t},rewriteOnClicks:function(t,n){var r=this;n.forEach((function(n){if("subMenu"in n&&r.rewriteOnClicks(t,n.subMenu),"onClick"in n){var a=n.onClick;n.onClick=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];e.tracks.forEach((function(e){e.type===t&&a.apply(e,[e].concat(r))}))}}}))},get trackTypeActions(){var t=this,n=new Map;return e.tracks.forEach((function(e){if(!n.get(e.type)){var r=k()(e.viewMenuActions);t.rewriteOnClicks(e.type,r),n.set(e.type,r)}})),n},get centerLineInfo(){return e.displayedRegions.length?this.pxToBp(e.width/2):void 0}}})).actions((function(t){return{setShowCytobands:function(e){t.showCytobandsSetting=e,localStorage.setItem("lgv-showCytobands","".concat(+e))},setWidth:function(e){t.volatileWidth=e},setError:function(e){t.volatileError=e},toggleHeader:function(){t.hideHeader=!t.hideHeader},toggleHeaderOverview:function(){t.hideHeaderOverview=!t.hideHeaderOverview},scrollTo:function(e){var n=(0,h.clamp)(e,t.minOffset,t.maxOffset);return t.offsetPx=n,n},zoomTo:function(e){var n=(0,h.clamp)(e,t.minBpPerPx,t.maxBpPerPx);if(n===t.bpPerPx)return n;var r=t.bpPerPx;if(t.bpPerPx=n,Math.abs(r-n)<1e-6)return console.warn("zoomTo bpPerPx rounding error"),r;var a=t.width;return this.scrollTo(Math.round((t.offsetPx+a/2)*r/n-a/2)),n},setOffsets:function(e,n){t.leftOffset=e,t.rightOffset=n},setSearchResults:function(e,n){t.searchResults=e,t.searchQuery=n},setSequenceDialogOpen:function(e){t.seqDialogDisplayed=e},setNewView:function(e,t){this.zoomTo(e),this.scrollTo(t)},horizontallyFlip:function(){t.displayedRegions=(0,b.cast)(t.displayedRegions.slice().reverse().map((function(e){return(0,s.Z)((0,s.Z)({},e),{},{reversed:!e.reversed})}))),this.scrollTo(t.totalBp/t.bpPerPx-t.offsetPx-t.width)},showTrack:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=e.pluggableConfigSchemaType("track"),o=(0,b.resolveIdentifier)(i,(0,b.getRoot)(t),n);if(!o)throw new Error('Could not resolve identifier "'.concat(n,'"'));var c=e.getTrackType(null===o||void 0===o?void 0:o.type);if(!c)throw new Error("Unknown track type ".concat(o.type));var u=e.getViewType(t.type),l=u.displayTypes.map((function(e){return e.name})),d=o.displays.find((function(e){return l.includes(e.type)}));if(!d)throw new Error("Could not find a compatible display for view type ".concat(t.type));var f=t.tracks.filter((function(e){return e.configuration===o}));if(0===f.length){var p=c.stateModel.create((0,s.Z)((0,s.Z)({},r),{},{type:o.type,configuration:o,displays:[(0,s.Z)({type:d.type,configuration:d},a)]}));return t.tracks.push(p),p}return f[0]},hideTrack:function(n){var r=e.pluggableConfigSchemaType("track"),a=(0,b.resolveIdentifier)(r,(0,b.getRoot)(t),n),i=t.tracks.filter((function(e){return e.configuration===a}));return(0,y.transaction)((function(){return i.forEach((function(e){return t.tracks.remove(e)}))})),i.length}}})).actions((function(e){return{moveTrack:function(t,n){var r=e.tracks.findIndex((function(e){return e.id===t}));if(-1===r)throw new Error("Track ID ".concat(t," not found"));var a=e.tracks.findIndex((function(e){return e.id===n}));if(-1===a)throw new Error("Track ID ".concat(n," not found"));var i=(0,b.getSnapshot)(e.tracks[r]);e.tracks.splice(r,1),e.tracks.splice(a,0,i)},closeView:function(){var t=(0,h.getContainingView)(e);t?(0,h.isViewContainer)(t)&&t.removeView(e):(0,h.getSession)(e).removeView(e)},toggleTrack:function(t){e.hideTrack(t)||e.showTrack(t)},setTrackLabels:function(t){e.trackLabels=t,localStorage.setItem("lgv-trackLabels",t)},toggleCenterLine:function(){e.showCenterLine=!e.showCenterLine,localStorage.setItem("lgv-showCenterLine","".concat(+e.showCenterLine))},setDisplayedRegions:function(t){e.displayedRegions=(0,b.cast)(t),e.zoomTo(e.bpPerPx)},activateTrackSelector:function(){if("hierarchical"===e.trackSelectorType){var t=(0,h.getSession)(e);if((0,h.isSessionModelWithWidgets)(t)){var n=t.addWidget("HierarchicalTrackSelectorWidget","hierarchicalTrackSelector",{view:e});return t.showWidget(n),n}}throw new Error("invalid track selector type ".concat(e.trackSelectorType))},navToLocString:function(t,n){var r=e.assemblyNames,a=(0,h.getSession)(e).assemblyManager,i=a.isValidRefName,o=n||r[0],c=t.split(" ").filter((function(e){return!!e.trim()})).map((function(e){return(0,h.parseLocString)(e,(function(e){return i(e,o)}))})).map((function(e){var t=e.assemblyName||o,n=a.get(t),r=e.refName;if(!n)throw new Error("assembly ".concat(t," not found"));var i=n.regions;if(!i)throw new Error("regions not loaded yet for ".concat(t));var c=n.getCanonicalRefName(e.refName);if(!c)throw new Error("Could not find refName ".concat(r," in ").concat(n.name));var u=i.find((function(e){return e.refName===c}));if(!u)throw new Error("Could not find refName ".concat(r," in ").concat(t));return(0,s.Z)((0,s.Z)({},e),{},{assemblyName:t,parentRegion:u})}));if(1===c.length){var u=c[0];this.setDisplayedRegions([(0,s.Z)({reversed:u.reversed},u.parentRegion)]);var l=u.start,d=u.end,f=u.parentRegion;this.navTo((0,s.Z)((0,s.Z)({},u),{},{start:(0,h.clamp)(null!==l&&void 0!==l?l:0,0,f.end),end:(0,h.clamp)(null!==d&&void 0!==d?d:f.end,0,f.end)}))}else this.setDisplayedRegions(c.map((function(e){return void 0===e.start?e.parentRegion:e}))),this.showAllRegions()},navTo:function(e){this.navToMultiple([e])},navToMultiple:function(t){var n=t[0],r=n.refName,a=n.start,i=n.end,o=n.assemblyName,s=void 0===o?e.assemblyNames[0]:o;if(void 0!==a&&void 0!==i&&a>i)throw new Error('start "'.concat(a+1,'" is greater than end "').concat(i,'"'));var c=(0,h.getSession)(e).assemblyManager.get(s);if(c){var u=c.getCanonicalRefName(r);u&&(r=u)}for(var l,d=a,f=i,p=!1,g=function(e){if(r===e.refName){if(p=!0,void 0===d&&(d=e.start),void 0===f&&(f=e.end),d>=e.start&&d<=e.end&&f<=e.end&&f>=e.start)return!0;d=a,f=i}return!1},m=(0,h.findLastIndex)(e.displayedRegions,g);l!==m;)try{var v=l;if(l=e.displayedRegions.slice(void 0===v?0:v+1).findIndex(g),void 0!==v&&(l+=v+1),!p)throw new Error('could not find a region with refName "'.concat(r,'"'));if(void 0===d)throw new Error('could not find a region with refName "'.concat(r,'" that contained an end position ').concat(f));if(void 0===f)throw new Error('could not find a region with refName "'.concat(r,'" that contained a start position ').concat(d+1));if(-1===l)throw new Error('could not find a region that completely contained "'.concat((0,h.assembleLocString)(n),'"'));if(1===t.length){var y=e.displayedRegions[l];return void this.moveTo({index:l,offset:y.reversed?y.end-f:d-y.start},{index:l,offset:y.reversed?y.end-d:f-y.start})}for(var b=0,x=0,w=0;b<t.length;b++){var k=t[b],C=e.displayedRegions[l+b];if(x=k.start||C.start,w=k.end||C.end,k.refName!==C.refName)throw new Error("Entered location ".concat((0,h.assembleLocString)(k)," does not match with displayed regions"))}b-=1;var Z=e.displayedRegions[l],S=e.displayedRegions[l+b];return void this.moveTo({index:l,offset:Z.reversed?Z.end-f:d-Z.start},{index:l+b,offset:S.reversed?S.end-x:w-S.start})}catch(T){if(l===m)throw T}},zoomToDisplayedRegions:function(t,n){if(void 0!==t&&void 0!==n){if(t.refName===n.refName&&t.index===n.index&&n.offset<t.offset||t.index>n.index){var r=[n,t];t=r[0],n=r[1]}var a={start:t.start,end:t.end,index:t.index,offset:t.offset},i={start:n.start,end:n.end,index:n.index,offset:n.offset};if(a&&i)this.moveTo(a,i);else(0,h.getSession)(e).notify("No regions found to navigate to","warning")}},getSelectedRegions:function(t,n){var r=x.Z.create((0,s.Z)((0,s.Z)({},(0,b.getSnapshot)(e)),{},{interRegionPaddingWidth:e.interRegionPaddingWidth}));return r.setVolatileWidth(e.width),r.zoomToDisplayedRegions(t,n),r.dynamicBlocks.contentBlocks.map((function(e){return(0,s.Z)((0,s.Z)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},afterDisplayedRegionsSet:function(t){e.afterDisplayedRegionsSetCallbacks.push(t)},moveTo:function(t,n){var r=0;if(t.index===n.index)r+=n.offset-t.offset;else{var a=e.displayedRegions[t.index];if(r+=a.end-a.start-t.offset,n.index-t.index>=2)for(var i=t.index+1;i<n.index;i+=1)r+=e.displayedRegions[i].end-e.displayedRegions[i].start;r+=n.offset}var o=r/(e.width-e.interRegionPaddingWidth*(n.index-t.index)),s=e.zoomTo(o),c=0;o<s&&(c=(s-o)*e.width/2);for(var u=-c,l=0;l<e.displayedRegions.length;l+=1){var d=e.displayedRegions[l];if(t.index===l){u+=t.offset;break}u+=d.end-d.start}e.scrollTo(Math.round(u/e.bpPerPx)+e.interRegionPaddingWidth*t.index)},horizontalScroll:function(t){var n=e.offsetPx;return e.scrollTo(e.offsetPx+t)-n},centerAt:function(t,n,r){var a=e.bpToPx({refName:n,coord:t,regionNumber:r});a&&e.scrollTo(Math.round(a.offsetPx-e.width/2))},center:function(){var t=e.totalBp/2;e.scrollTo(Math.round(t/e.bpPerPx-e.width/2))},showAllRegions:function(){e.zoomTo(e.maxBpPerPx),this.center()},showAllRegionsInAssembly:function(t){var n=(0,h.getSession)(e),r=n.assemblyManager;if(!t){var a=(0,o.Z)(new Set(e.displayedRegions.map((function(e){return e.assemblyName}))));if(a.length>1)return void n.notify("Can't perform this with multiple assemblies currently");t=(0,i.Z)(a,1)[0]}var s=r.get(t);if(s){var c=s.regions;c&&(this.setDisplayedRegions(c),e.zoomTo(e.maxBpPerPx),this.center())}},setDraggingTrackId:function(t){e.draggingTrackId=t},setScaleFactor:function(t){e.scaleFactor=t}}})).actions((function(e){var t=function(){};return{slide:function(n){var r=(0,h.springAnimate)(e.offsetPx,e.offsetPx+e.width*n,e.scrollTo),a=(0,i.Z)(r,2),o=a[0],s=a[1];t(),t=s,o()}}})).actions((function(e){var t=function(){};return{zoom:function(n){if(e.zoomTo(e.bpPerPx),!(n<e.bpPerPx&&e.bpPerPx===e.minBpPerPx||n>e.bpPerPx&&e.bpPerPx===e.maxBpPerPx)){var r=e.bpPerPx/n,a=(0,h.springAnimate)(1,r,e.setScaleFactor,(function(){e.zoomTo(n),e.setScaleFactor(1)})),o=(0,i.Z)(a,2),s=o[0],c=o[1];t(),t=c,s()}}}})).views((function(e){return{get canShowCytobands(){return 1===e.displayedRegions.length&&this.anyCytobandsExist},get showCytobands(){return this.canShowCytobands&&e.showCytobandsSetting},get anyCytobandsExist(){var t=(0,h.getSession)(e).assemblyManager;return e.assemblyNames.some((function(e){var n,r;return null===(n=t.get(e))||void 0===n||null===(r=n.cytobands)||void 0===r?void 0:r.length}))},get cytobandOffset(){return this.showCytobands?(0,h.measureText)(e.displayedRegions[0].refName,12)+15:0}}})).views((function(e){return{menuItems:function(){var t,n=e.canShowCytobands,r=e.showCytobands,s=[{label:"Return to import form",onClick:function(){(0,h.getSession)(e).queueDialog((function(t){return[p.ReturnToImportFormDialog,{model:e,handleClose:t}]}))},icon:R.Z},{label:"Export SVG",icon:M.Z,onClick:function(){(0,h.getSession)(e).queueDialog((function(t){return[de,{model:e,handleClose:t}]}))}},{label:"Open track selector",onClick:e.activateTrackSelector,icon:Z.GD},{label:"Horizontally flip",icon:S.Z,onClick:e.horizontallyFlip},{type:"divider"},{label:"Show all regions in assembly",icon:T.Z,onClick:e.showAllRegionsInAssembly},{label:"Show center line",icon:T.Z,type:"checkbox",checked:e.showCenterLine,onClick:e.toggleCenterLine},{label:"Show header",icon:T.Z,type:"checkbox",checked:!e.hideHeader,onClick:e.toggleHeader},{label:"Show header overview",icon:T.Z,type:"checkbox",checked:!e.hideHeaderOverview,onClick:e.toggleHeaderOverview,disabled:e.hideHeader},{label:"Track labels",icon:P.Z,subMenu:[{label:"Overlapping",icon:T.Z,type:"radio",checked:"overlapping"===e.trackLabels,onClick:function(){return e.setTrackLabels("overlapping")}},{label:"Offset",icon:T.Z,type:"radio",checked:"offset"===e.trackLabels,onClick:function(){return e.setTrackLabels("offset")}},{label:"Hidden",icon:T.Z,type:"radio",checked:"hidden"===e.trackLabels,onClick:function(){return e.setTrackLabels("hidden")}}]}].concat((0,o.Z)(n?[{label:r?"Hide ideogram":"Show ideograms",onClick:function(){e.setShowCytobands(!r)}}]:[])),c=(0,a.Z)(e.trackTypeActions.entries());try{for(c.s();!(t=c.n()).done;){var u=(0,i.Z)(t.value,2),l=u[0],d=u[1];d.length&&(s.push({type:"divider"},{type:"subHeader",label:l}),d.forEach((function(e){s.push(e)})))}}catch(f){c.e(f)}finally{c.f()}return s}}})).views((function(e){var t,n="";return{get staticBlocks(){var r=(0,m.Z)(e),a=JSON.stringify(r);return n!==a&&(t=r,n=a),t},get dynamicBlocks(){return(0,g.Z)(e)},get roundedDynamicBlocks(){return this.dynamicBlocks.contentBlocks.map((function(e){return(0,s.Z)((0,s.Z)({},e),{},{start:Math.floor(e.start),end:Math.ceil(e.end)})}))},get visibleLocStrings(){return fe(this.dynamicBlocks.contentBlocks)},get coarseVisibleLocStrings(){return fe(e.coarseDynamicBlocks)}}})).actions((function(e){return{clearView:function(){e.setDisplayedRegions([]),e.tracks.clear(),e.scrollTo(0),e.zoomTo(10)},setCoarseDynamicBlocks:function(t){e.coarseDynamicBlocks=t.contentBlocks,e.coarseTotalBp=t.totalBp},afterAttach:function(){var t=this;(0,b.addDisposer)(e,(0,y.autorun)((function(){e.initialized&&t.setCoarseDynamicBlocks(e.dynamicBlocks)}),{delay:150}))}}})).actions((function(e){return{exportSvg:function(){var t=arguments;return(0,r.Z)(u().mark((function n(){var r,a,i;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},n.next=3,Y(e,r);case 3:a=n.sent,i=new Blob([a],{type:"image/svg+xml"}),(0,C.saveAs)(i,"image.svg");case 6:case"end":return n.stop()}}),n)})))()}}})).views((function(e){return{rubberBandMenuItems:function(){return[{label:"Zoom to region",icon:j.Z,onClick:function(){var t=e.leftOffset,n=e.rightOffset;t&&n&&e.moveTo(t,n)}},{label:"Get sequence",icon:A.Z,onClick:function(){e.setSequenceDialogOpen(!0)}}]}}}))}},73326:function(e,t,n){"use strict";function r(e,t,n){for(var r=t*(e=Math.abs(e)),a=parseInt(Number(r).toExponential().split(/e/i)[1],10),i=Math.pow(10,a);i<r&&!((i*=2)>=r);)i*=2.5;var o=(i=Math.max(i,5))/e,s=0;return!(i%10)&&o/10>=n?s=i/10:!(i%5)&&o/5>=n?s=i/5:!(i%2)&&o/2>=n&&(s=i/2),{majorPitch:i,minorPitch:s}}function a(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=r(n,60,15),s=e,c=t;if(null===s||null===c)return[];if(n<0){var u=[c,s];s=u[0],c=u[1]}s-=Math.abs(20*n)-1,c+=Math.abs(20*n)+1;for(var l=o.minorPitch||o.majorPitch,d=0,f=[],p=Math.ceil(s/l)*l;p<c;p+=l)i&&p%(2*o.majorPitch)?(f.push({type:"minor",base:p-1,index:d}),d+=1):!a||p%(2*o.majorPitch)||(f.push({type:"major",base:p-1,index:d}),d+=1);return f}n.d(t,{C:function(){return a},_:function(){return r}})},89058:function(e,t,n){"use strict";n.d(t,{fV:function(){return pe},qb:function(){return Y},Rj:function(){return me.Rj},fU:function(){return x},ZP:function(){return we},RH:function(){return xe},l0:function(){return be}});var r=n(34795),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(77162),u=n.n(c),l=n(30969),d=n(35247),f=n(9077),p=n(59853),h=n(82044),g=n(81575),m=n(39798),v=n(49767),y=n(81073),b=n(7027),x=(0,f.ConfigurationSchema)("BaseLinearDisplay",{maxFeatureScreenDensity:{type:"number",description:"maximum features per pixel that is displayed in the view, used if byte size estimates not available",defaultValue:.3},fetchSizeLimit:{type:"number",defaultValue:1e6,description:"maximum data to attempt to download for a given track, used if adapter doesn't specify one"}},{explicitIdentifier:"displayId"}),w=n(59740),k=n(68079),C=n(33028),Z=n(41361),S=n(80975),T=n(28599),P=function(e){function t(e){(0,a.Z)(this,t),this.submaps=e}return(0,i.Z)(t,[{key:"has",value:function(e){var t,n=(0,Z.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){if(t.value.has(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"get",value:function(e){var t,n=(0,Z.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.has(e))return r.get(e)}}catch(a){n.e(a)}finally{n.f()}}},{key:"values",value:u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,Z.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,this.get(r);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"keys",value:u().mark((function(){var e,t,n,r,a,i,o,s,c,l;return u().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:e=new Set,t=(0,Z.Z)(this.submaps.values());try{for(t.s();!(n=t.n()).done;){r=n.value,a=(0,Z.Z)(r.keys());try{for(a.s();!(i=a.n()).done;)o=i.value,e.add(o)}catch(d){a.e(d)}finally{a.f()}}}catch(d){t.e(d)}finally{t.f()}s=(0,Z.Z)(e),u.prev=4,s.s();case 6:if((c=s.n()).done){u.next=12;break}return l=c.value,u.next=10,l;case 10:u.next=6;break;case 12:u.next=17;break;case 14:u.prev=14,u.t0=u.catch(4),s.e(u.t0);case 17:return u.prev=17,s.f(),u.finish(17);case 20:case"end":return u.stop()}}),e,this,[[4,14,17,20]])}))},{key:"find",value:function(e){var t,n=(0,Z.Z)(this.submaps.values());try{for(n.s();!(t=n.n()).done;){var r,a=t.value,i=(0,Z.Z)(a.values());try{for(i.s();!(r=i.n()).done;){var o=r.value;if(e(o))return o}}catch(s){i.e(s)}finally{i.f()}}}catch(s){n.e(s)}finally{n.f()}}},{key:e,value:u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,Z.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"entries",value:u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,Z.Z)(this.keys()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,[r,this.get(r)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))}]),t}(Symbol.iterator),R=n(14956),M=n(97891),j=n(40909),A=n(52274),N=n(96234),L=n(90550),F=n(22714),I=n(53239),B=n(23554),D=n(38827),E=n(24998),V=n(11611),O=n(56891),z=n(53515),W=n(37574),H=(0,F.Z)({linearBlocks:{whiteSpace:"nowrap",textAlign:"left",position:"absolute",minHeight:"100%",display:"flex"},heightOverflowed:{position:"absolute",color:"rgb(77,77,77)",borderBottom:"2px solid rgb(77,77,77)",textShadow:"white 0px 0px 1px",whiteSpace:"nowrap",width:"100%",fontWeight:"bold",textAlign:"center",zIndex:2e3,boxSizing:"border-box"}}),q=(0,L.observer)((function(e){var t=e.model,n=H(),r=t.blockDefinitions,a=t.blockState;return(0,W.jsx)(W.Fragment,{children:r.map((function(e){if(e instanceof O.b0){var r=a.get(e.key);return(0,W.jsxs)(z.b0,{block:e,children:[r&&r.ReactComponent?(0,W.jsx)(r.ReactComponent,{model:r}):null,r&&r.maxHeightReached?(0,W.jsx)("div",{className:n.heightOverflowed,style:{top:r.layout.getTotalHeight()-16,pointerEvents:"none",height:16},children:"Max height reached"}):null]},"".concat(t.id,"-").concat(e.key))}if(e instanceof O.sh)return(0,W.jsx)(z.sh,{width:e.widthPx},"".concat(t.id,"-").concat(e.key));if(e instanceof O.n2)return(0,W.jsx)(z.n2,{width:e.widthPx,style:{background:"none"},boundary:"boundary"===e.variant},e.key);throw new Error("invalid block type ".concat(typeof e))}))})}));var U=(0,L.observer)((function(e){var t=e.model,n=H(),r=t.blockDefinitions,a=(0,y.getContainingView)(t);return(0,W.jsx)("div",{"data-testid":"Blockset",className:n.linearBlocks,style:{left:r.offsetPx-a.offsetPx},children:(0,W.jsx)(q,{model:t})})}));var _=(0,F.Z)((function(e){return{display:{position:"relative",whiteSpace:"nowrap",textAlign:"left",width:"100%",minHeight:"100%"},tooltip:{pointerEvents:"none",backgroundColor:(0,I.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"}};var t})),G=l.forwardRef((function(e,t){var n=e.message;return(0,W.jsx)("div",{ref:t,children:n})})),J=(0,L.observer)((function(e){var t=e.model,n=e.clientMouseCoord,r=_(),a=t.featureUnderMouse,i=(0,l.useState)(0),o=(0,N.Z)(i,2),s=o[0],c=o[1],u=(0,l.useState)(null),d=(0,N.Z)(u,2),p=d[0],h=d[1],g=(0,l.useMemo)((function(){return{getBoundingClientRect:function(){var e=n[0]+s/2+20,t=n[1];return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[n,s]),m=(0,V.D)(g,p),v=m.styles,y=m.attributes,b=a?(0,f.getConf)(t,"mouseover",{feature:a}):void 0;return a&&b?(0,W.jsx)(B.Z,{children:(0,W.jsx)("div",(0,C.Z)((0,C.Z)({ref:h,className:r.tooltip,style:(0,C.Z)((0,C.Z)({},v.popper),{},{zIndex:1e5})},y.popper),{},{children:(0,W.jsx)(G,{ref:function(e){return c((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},message:b})}))}):null})),X=(0,L.observer)((function(e){var t=_(),n=(0,D.Z)(),r=(0,l.useRef)(null),a=(0,l.useState)(),i=(0,N.Z)(a,2),o=i[0],s=i[1],c=(0,l.useState)([0,0]),u=(0,N.Z)(c,2),d=u[0],p=u[1],h=(0,l.useState)([0,0]),g=(0,N.Z)(h,2),m=g[0],v=g[1],y=(0,l.useState)(),b=(0,N.Z)(y,2),x=b[0],w=b[1],k=e.model,Z=e.children,S=k.TooltipComponent,T=k.DisplayMessageComponent,P=k.contextMenuItems,R=k.height,M=k.setContextMenuFeature;return(0,W.jsxs)("div",{ref:r,"data-testid":"display-".concat((0,f.getConf)(k,"displayId")),className:t.display,onContextMenu:function(e){e.preventDefault(),x?w(void 0):r.current&&w([e.clientX,e.clientY])},onMouseMove:function(e){if(r.current){var t=r.current.getBoundingClientRect(),n=t.left,a=t.top;p([e.clientX-n,e.clientY-a]),v([e.clientX,e.clientY]),s(t)}},children:[T?(0,W.jsx)(T,{model:k}):(0,W.jsx)(U,(0,C.Z)({},e)),Z,(0,W.jsx)(S,{model:k,height:R,offsetMouseCoord:d,clientMouseCoord:m,clientRect:o,mouseCoord:d}),(0,W.jsx)(E.Menu,{open:Boolean(x)&&Boolean(P().length),onMenuItemClick:function(e,t){t(),w(void 0)},onClose:function(){w(void 0),M(void 0)},TransitionProps:{onExit:function(){w(void 0),M(void 0)}},anchorReference:"anchorPosition",anchorPosition:x?{top:x[1],left:x[0]}:void 0,style:{zIndex:n.zIndex.tooltip},menuItems:P(),"data-testid":"base_linear_display_context_menu"})]})})),Y=X,Q=n(29206),$=n(8438),K=n(46920),ee=(0,F.Z)((function(e){return{loading:{paddingLeft:"0.6em",backgroundColor:e.palette.action.disabledBackground,backgroundImage:"repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255,255,255,.5) 5px, rgba(255,255,255,.5) 10px)",height:"100%",width:"100%",pointerEvents:"none",textAlign:"center"},blockMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),pointerEvents:"none",textAlign:"center"},blockError:{padding:e.spacing(2),width:"100%",whiteSpace:"normal",color:e.palette.error.main,overflowY:"auto"},blockReactNodeMessage:{width:"100%",background:e.palette.action.disabledBackground,padding:e.spacing(2),textAlign:"center"},dots:{"&::after":{display:"inline-block",animation:"$ellipsis 1.5s infinite",content:'"."',width:"1em",textAlign:"left"}},"@keyframes ellipsis":{"0%":{content:'"."'},"33%":{content:'".."'},"66%":{content:'"..."'}}}}));function te(e){var t=e.children;return(0,W.jsxs)("div",{style:{display:"flex"},children:[t,t]})}var ne=(0,L.observer)((function(e){var t=e.model,n=(0,l.useState)(!1),r=(0,N.Z)(n,2),a=r[0],i=r[1],o=ee();(0,l.useEffect)((function(){var e=!1,t=setTimeout((function(){e||i(!0)}),300);return function(){clearTimeout(t),e=!0}}),[]);var s=t.status,c=(0,j.getParent)(t,2).message||s;return(0,W.jsx)(W.Fragment,{children:a?(0,W.jsx)("div",{className:o.loading,children:(0,W.jsx)(S.Z,{className:o.dots,variant:"body2",children:c?"".concat(c):"Loading"})}):null})}));function re(e){var t=e.messageContent,n=ee();return l.isValidElement(t)?(0,W.jsx)("div",{className:n.blockReactNodeMessage,children:t}):(0,W.jsx)(S.Z,{variant:"body2",className:n.blockMessage,children:t})}function ae(e){var t=e.error,n=e.reload,r=e.displayHeight,a=ee();return(0,W.jsxs)("div",{className:a.blockError,style:{height:r},children:[n?(0,W.jsx)(T.Z,{"data-testid":"reload_button",onClick:n,startIcon:(0,W.jsx)(K.Z,{}),children:"Reload"}):null,(0,W.jsx)(S.Z,{color:"error",variant:"body2",display:"inline",children:"".concat(t)})]})}var ie=(0,L.observer)((function(e){var t=e.model;return t.error?(0,W.jsx)(te,{children:(0,W.jsx)(ae,{error:t.error,reload:t.reload,displayHeight:(0,M.getParentRenderProps)(t).displayModel.height})}):t.message?(0,W.jsx)(te,{children:(0,W.jsx)(re,{messageContent:t.message})}):t.filled?t.reactElement:(0,W.jsx)(te,{children:(0,W.jsx)(ne,{model:t})})})),oe=ie,se=j.types.model("BlockState",{key:j.types.string,region:Q.Region,reloadFlag:0,isLeftEndOfDisplayedRegion:!1,isRightEndOfDisplayedRegion:!1}).volatile((function(){return{renderInProgress:void 0,filled:!1,reactElement:void 0,features:void 0,layout:void 0,status:"",error:void 0,message:void 0,maxHeightReached:!1,ReactComponent:oe,renderProps:void 0}})).actions((function(e){var t;return{doReload:function(){e.reloadFlag=e.reloadFlag+1},afterAttach:function(){var t=(0,y.getContainingDisplay)(e);(0,y.makeAbortableReaction)(e,ce,ue,{name:"".concat(t.id,"/").concat((0,y.assembleLocString)(e.region)," rendering"),delay:t.renderDelay,fireImmediately:!0},this.setLoading,this.setRendered,this.setError)},setStatus:function(t){e.status=t},setLoading:function(n){void 0!==t&&(t.signal.aborted||t.abort()),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=n},setMessage:function(n){t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=n,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.maxHeightReached=!1,e.renderProps=void 0,t=void 0},setRendered:function(n){if(n){var r=n.reactElement,a=n.features,i=n.layout,o=n.maxHeightReached,s=n.renderProps;e.filled=!0,e.message=void 0,e.reactElement=r,e.features=a,e.layout=i,e.error=void 0,e.maxHeightReached=o,e.renderProps=s,t=void 0}},setError:function(n){console.error(n),t&&!t.signal.aborted&&t.abort(),e.filled=!1,e.message=void 0,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.maxHeightReached=!1,e.error=n,e.renderProps=void 0,t=void 0,(0,$.Z6)(n)&&this.reload()},reload:function(){e.renderInProgress=void 0,e.filled=!1,e.reactElement=void 0,e.features=void 0,e.layout=void 0,e.error=void 0,e.message=void 0,e.maxHeightReached=!1,e.ReactComponent=oe,e.renderProps=void 0,(0,j.getParent)(e,2).reload()},beforeDestroy:function(){t&&!t.signal.aborted&&t.abort();var n=(0,y.getContainingDisplay)(e),r=(0,y.getSession)(e).rpcManager,a=n.rendererType,i=ce((0,j.cast)(e)).renderArgs;i&&a.freeResourcesInClient(r,JSON.parse(JSON.stringify(i))).catch((function(e){console.warn("Error while destroying block",e)}))}}}));function ce(e,t){try{var n=t||(0,y.getContainingDisplay)(e),r=(0,y.getSession)(n),a=r.assemblyManager,i=r.rpcManager,o=n.adapterConfig,s=n.rendererType,c=n.error,u=n.parentTrack,l=(0,M.getTrackAssemblyNames)(u),d=e.region.assemblyName;if(!l.includes(d)&&!l.find((function(e){var t;return null===(t=a.get(e))||void 0===t?void 0:t.hasName(d)})))throw new Error("region assembly (".concat(d,") does not match track assemblies (").concat(l,")"));var p=n.renderProps(),h=p.config;(0,f.readConfObject)(h);var g=(0,M.getRpcSessionId)(n),m=(0,y.getContainingView)(n).id;return{rendererType:s,rpcManager:i,renderProps:p,cannotBeRenderedReason:n.regionCannotBeRendered(e.region),displayError:c,renderArgs:{statusCallback:function(t){(0,j.isAlive)(e)&&e.setStatus(t)},assemblyName:e.region.assemblyName,regions:[e.region],adapterConfig:o,rendererType:s.name,sessionId:g,layoutId:m,blockKey:e.key,reloadFlag:e.reloadFlag,timeout:1e6}}}catch(v){return{displayError:v}}}function ue(e,t,n){return le.apply(this,arguments)}function le(){return(le=(0,r.Z)(u().mark((function e(t,n,r){var a,i,o,s,c,l,d,f,p,h,g,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(a=t).rendererType,o=a.renderProps,s=a.rpcManager,c=a.renderArgs,l=a.cannotBeRenderedReason,d=a.displayError,(0,j.isAlive)(r)){e.next=3;break}return e.abrupt("return",void 0);case 3:if(!d){e.next=6;break}return r.setError(d),e.abrupt("return",void 0);case 6:if(!l){e.next=9;break}return r.setMessage(l),e.abrupt("return",void 0);case 9:if(!o.notReady){e.next=11;break}return e.abrupt("return",void 0);case 11:return e.next=13,i.renderInClient(s,(0,C.Z)((0,C.Z)((0,C.Z)({},c),o),{},{viewParams:(0,y.getViewParams)(r),signal:n}));case 13:return f=e.sent,p=f.reactElement,h=f.features,g=f.layout,m=f.maxHeightReached,e.abrupt("return",{reactElement:p,features:h,layout:g,maxHeightReached:m});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var de=["blockState"];function fe(e,t){var n="undefined"===typeof jest;return"clip-".concat(n?e:"jest","-").concat(t)}var pe=j.types.compose("BaseLinearDisplay",p.BaseDisplay,j.types.model({height:j.types.optional(j.types.refinement("displayHeight",j.types.number,(function(e){return e>=20})),100),blockState:j.types.map(se),userBpPerPxLimit:j.types.maybe(j.types.number),userByteSizeLimit:j.types.maybe(j.types.number)})).volatile((function(){return{currBpPerPx:0,message:"",featureIdUnderMouse:void 0,contextMenuFeature:void 0,scrollTop:0,estimatedRegionStatsP:void 0,estimatedRegionStats:void 0}})).views((function(e){return{get blockType(){return"staticBlocks"},get blockDefinitions(){var t=this.blockType,n=(0,y.getContainingView)(e);if(!n.initialized)throw new Error("view not initialized yet");return n[t]}}})).views((function(e){return{get renderDelay(){return 50},get TooltipComponent(){return J},get selectedFeatureId(){if((0,j.isAlive)(e)){var t=(0,y.getSession)(e).selection;if((0,R.T)(t))return t.id()}},get DisplayMessageComponent(){}}})).views((function(e){return{get features(){var t,n=[],r=(0,Z.Z)(e.blockState.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;a&&a.features&&n.push(a.features)}}catch(i){r.e(i)}finally{r.f()}return new P(n)},get featureUnderMouse(){var t=e.featureIdUnderMouse;return t?this.features.get(t):void 0},getFeatureOverlapping:function(t,n,r){var a,i;return null===(a=e.blockState.get(t))||void 0===a||null===(i=a.layout)||void 0===i?void 0:i.getByCoord(n,r)},getFeatureByID:function(t,n){var r,a;return null===(r=e.blockState.get(t))||void 0===r||null===(a=r.layout)||void 0===a?void 0:a.getByID(n)},searchFeatureByID:function(t){var n;return e.blockState.forEach((function(e){var r,a=null===e||void 0===e||null===(r=e.layout)||void 0===r?void 0:r.getByID(t);a&&(n=a)})),n},get currentBytesRequested(){var t;return(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.bytes)||0},get currentFeatureScreenDensity(){var t,n=(0,y.getContainingView)(e);return((null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.featureDensity)||0)*n.bpPerPx},get maxFeatureScreenDensity(){return(0,f.getConf)(e,"maxFeatureScreenDensity")},get estimatedStatsReady(){return!!e.estimatedRegionStats},get maxAllowableBytes(){var t;return e.userByteSizeLimit||(null===(t=e.estimatedRegionStats)||void 0===t?void 0:t.fetchSizeLimit)||(0,f.getConf)(e,"fetchSizeLimit")}}})).actions((function(e){return{setMessage:function(t){e.message=t},afterAttach:function(){var t=this,n=(0,d.autorun)((function(){var n={};(0,y.getContainingView)(e).initialized&&(e.blockDefinitions.contentBlocks.forEach((function(r){n[r.key]=!0,e.blockState.has(r.key)||t.addBlock(r.key,r)})),e.blockState.forEach((function(e,r){n[r]||t.deleteBlock(r)})))}));(0,j.addDisposer)(e,n)},estimateRegionsStats:function(t,n){var r=this;if(e.estimatedRegionStatsP)return e.estimatedRegionStatsP;var a=(0,y.getSession)(e).rpcManager,i=e.adapterConfig;if(!i)return Promise.resolve({});var o=(0,M.getRpcSessionId)(e),s=(0,C.Z)({sessionId:o,regions:t,adapterConfig:i,statusCallback:function(t){(0,j.isAlive)(e)&&r.setMessage(t)}},n);return e.estimatedRegionStatsP=a.call(o,"CoreEstimateRegionStats",s).catch((function(e){throw r.setRegionStatsP(void 0),e})),e.estimatedRegionStatsP},setRegionStatsP:function(t){e.estimatedRegionStatsP=t},setRegionStats:function(t){e.estimatedRegionStats=t},clearRegionStats:function(){e.estimatedRegionStatsP=void 0,e.estimatedRegionStats=void 0},setHeight:function(t){return e.height=t>20?t:20,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},setScrollTop:function(t){e.scrollTop=t},updateStatsLimit:function(t){var n=(0,y.getContainingView)(e);t.bytes?e.userByteSizeLimit=t.bytes:e.userBpPerPxLimit=n.bpPerPx},addBlock:function(t,n){e.blockState.set(t,se.create({key:t,region:n.toRegion()}))},setCurrBpPerPx:function(t){e.currBpPerPx=t},deleteBlock:function(t){e.blockState.delete(t)},selectFeature:function(t){var n=(0,y.getSession)(e);if((0,y.isSessionModelWithWidgets)(n)){var r=n.addWidget("BaseFeatureWidget","baseFeature",{featureData:t.toJSON(),view:(0,y.getContainingView)(e)});n.showWidget(r)}(0,y.isSelectionContainer)(n)&&n.setSelection(t)},clearFeatureSelection:function(){(0,y.getSession)(e).clearSelection()},setFeatureIdUnderMouse:function(t){e.featureIdUnderMouse=t},reload:function(){(0,k.Z)(e.blockState.values()).map((function(e){return e.doReload()}))},setContextMenuFeature:function(t){e.contextMenuFeature=t}}})).views((function(e){return{get regionTooLarge(){var t=(0,y.getContainingView)(e);if(!e.estimatedStatsReady||t.dynamicBlocks.totalBp<2e4)return!1;var n=e.userBpPerPxLimit?t.bpPerPx>e.userBpPerPxLimit:e.currentFeatureScreenDensity>e.maxFeatureScreenDensity;return e.currentBytesRequested>e.maxAllowableBytes||n},get regionTooLargeReason(){var t,n=e.currentBytesRequested,r=e.maxAllowableBytes;return n&&n>r?"Requested too much data (".concat((t=n,Math.floor(t/1e6)>0?"".concat(parseFloat((t/1e6).toPrecision(3))," Mb"):Math.floor(t/1e3)>0?"".concat(parseFloat((t/1e3).toPrecision(3))," Kb"):"".concat(Math.floor(t)," bytes")),")"):""}}})).actions((function(e){var t=e.reload;return{reload:function(){return(0,r.Z)(u().mark((function n(){var r,a,i;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.setError(),r=new AbortController,(a=(0,y.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){n.next=5;break}return n.abrupt("return");case 5:return n.prev=5,e.estimatedRegionStatsP=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),n.next=9,e.estimatedRegionStatsP;case 9:if(i=n.sent,!(0,j.isAlive)(e)){n.next=15;break}e.setRegionStats(i),t(),n.next=16;break;case 15:return n.abrupt("return");case 16:n.next=22;break;case 18:n.prev=18,n.t0=n.catch(5),console.error(n.t0),e.setError(n.t0);case 22:case"end":return n.stop()}}),n,null,[[5,18]])})))()},afterAttach:function(){(0,j.addDisposer)(e,(0,d.autorun)((0,r.Z)(u().mark((function t(){var n,r,a,i,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=new AbortController,(a=(0,y.getContainingView)(e)).initialized&&a.staticBlocks.contentBlocks.length){t.next=5;break}return t.abrupt("return");case 5:if(void 0===(null===(n=e.estimatedRegionStats)||void 0===n?void 0:n.featureDensity)){t.next=8;break}return e.setCurrBpPerPx(a.bpPerPx),t.abrupt("return");case 8:if(a.bpPerPx!==e.currBpPerPx){t.next=10;break}return t.abrupt("return");case 10:return e.clearRegionStats(),e.setCurrBpPerPx(a.bpPerPx),i=e.estimateRegionsStats(a.staticBlocks.contentBlocks,{signal:r.signal}),e.setRegionStatsP(i),t.next=16,i;case 16:o=t.sent,(0,j.isAlive)(e)&&e.setRegionStats(o),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),!(0,y.isAbortException)(t.t0)&&(0,j.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 23:case"end":return t.stop()}}),t,null,[[0,20]])}))),{delay:500}))}}})).views((function(e){return{regionCannotBeRenderedText:function(t){return e.regionTooLarge?"Force load to see features":""},regionCannotBeRendered:function(t){var n=e.regionTooLarge,r=e.regionTooLargeReason;if(n)return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(S.Z,{component:"span",variant:"body2",children:[r?r+". ":"","Zoom in to see features or"," "]}),(0,W.jsx)(T.Z,{"data-testid":"force_reload_button",onClick:function(){e.estimatedRegionStats?(e.updateStatsLimit(e.estimatedRegionStats),e.reload()):console.error("No global stats?")},variant:"outlined",children:"Force Load"}),(0,W.jsx)(S.Z,{component:"span",variant:"body2",children:"(force load may be slow)"})]})},trackMenuItems:function(){return[]},contextMenuItems:function(){return e.contextMenuFeature?[{label:"Open feature details",icon:A.Z,onClick:function(){e.contextMenuFeature&&e.selectFeature(e.contextMenuFeature)}}]:[]},renderProps:function(){var t=(0,y.getContainingView)(e);return(0,C.Z)((0,C.Z)({},(0,M.getParentRenderProps)(e)),{},{notReady:e.currBpPerPx!==t.bpPerPx||!e.estimatedRegionStats,rpcDriverName:e.rpcDriverName,displayModel:e,onFeatureClick:function(t,n){var r=n||e.featureIdUnderMouse;if(r){var a=e.features.get(r);a&&e.selectFeature(a)}else e.clearFeatureSelection()},onClick:function(){e.clearFeatureSelection()},onFeatureContextMenu:function(t,n){var r=n||e.featureIdUnderMouse;r?e.setContextMenuFeature(e.features.get(r)):e.clearFeatureSelection()},onMouseMove:function(t,n){e.setFeatureIdUnderMouse(n)},onMouseLeave:function(t){e.setFeatureIdUnderMouse(void 0)},onContextMenu:function(){e.setContextMenuFeature(void 0),e.clearFeatureSelection()}})}}})).actions((function(e){return{renderSvg:function(t){return(0,r.Z)(u().mark((function n(){var r,a,i,o,s,c,d,f;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.height,a=e.id,i=t.overrideHeight,o=(0,y.getContainingView)(e),s=o.offsetPx,c=o.roundedDynamicBlocks,d=o.width,n.next=6,Promise.all(c.map((function(n){var r=se.create({key:n.key,region:n}),a=e.regionCannotBeRenderedText(n)||e.regionCannotBeRendered(n);if(a)return{reactElement:(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)("rect",{x:0,y:0,width:d,height:20,fill:"#aaa"}),(0,W.jsx)("text",{x:0,y:15,children:a})]})};var i=ce(r,e),o=i.rpcManager,s=i.renderArgs,c=i.renderProps;return i.rendererType.renderInClient(o,(0,C.Z)((0,C.Z)((0,C.Z)({},s),c),{},{viewParams:(0,y.getViewParams)(e,!0),exportSVG:t}))})));case 6:return f=n.sent,n.abrupt("return",(0,W.jsx)(W.Fragment,{children:f.map((function(e,t){var n=c[t].offsetPx-s,o=fe(a,t);return(0,W.jsxs)(l.Fragment,{children:[(0,W.jsx)("defs",{children:(0,W.jsx)("clipPath",{id:o,children:(0,W.jsx)("rect",{x:0,y:0,width:d,height:i||r})})}),(0,W.jsx)("g",{transform:"translate(".concat(n," 0)"),children:(0,W.jsx)("g",{clipPath:"url(#".concat(o,")"),children:l.isValidElement(e.reactElement)?e.reactElement:(0,W.jsx)("g",{dangerouslySetInnerHTML:{__html:e.html}})})})]},"frag-".concat(t))}))}));case 8:case"end":return n.stop()}}),n)})))()}}})).postProcessSnapshot((function(e){e.blockState;return(0,w.Z)(e,de)}));var he=n(76085);function ge(e){return j.types.compose("LinearBareDisplay",pe,j.types.model({type:j.types.literal("LinearBareDisplay"),configuration:(0,he.B)(e)})).views((function(e){var t=e.renderProps;return{renderProps:function(){return(0,C.Z)((0,C.Z)((0,C.Z)({},t()),(0,M.getParentRenderProps)(e)),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var me=n(97862),ve=n(74464),ye=(0,l.lazy)((function(){return n.e(6161).then(n.bind(n,36161))})),be=function(e){return j.types.compose("LinearBasicDisplay",pe,j.types.model({type:j.types.literal("LinearBasicDisplay"),trackShowLabels:j.types.maybe(j.types.boolean),trackShowDescriptions:j.types.maybe(j.types.boolean),trackDisplayMode:j.types.maybe(j.types.string),trackMaxHeight:j.types.maybe(j.types.number),configuration:(0,f.ConfigurationReference)(e)})).views((function(e){return{get rendererTypeName(){return(0,f.getConf)(e,["renderer","type"])},get showLabels(){var t;return null!==(t=e.trackShowLabels)&&void 0!==t?t:(0,f.getConf)(e,["renderer","showLabels"])},get showDescriptions(){var t;return null!==(t=e.trackShowDescriptions)&&void 0!==t?t:(0,f.getConf)(e,["renderer","showLabels"])},get maxHeight(){var t;return null!==(t=e.trackMaxHeight)&&void 0!==t?t:(0,f.getConf)(e,["renderer","maxHeight"])},get displayMode(){var t,n=(0,f.getConf)(e,["renderer","displayMode"]);return null!==(t=e.trackDisplayMode)&&void 0!==t?t:n},get rendererConfig(){var t=(0,f.getConf)(e,["renderer"])||{};return e.rendererType.configSchema.create((0,C.Z)((0,C.Z)({},t),{},{showLabels:this.showLabels,showDescriptions:this.showDescriptions,displayMode:this.displayMode,maxHeight:this.maxHeight}),(0,j.getEnv)(e))}}})).actions((function(e){return{toggleShowLabels:function(){e.trackShowLabels=!e.showLabels},toggleShowDescriptions:function(){e.trackShowDescriptions=!e.showDescriptions},setDisplayMode:function(t){e.trackDisplayMode=t},setMaxHeight:function(t){e.trackMaxHeight=t}}})).views((function(e){var t=e.trackMenuItems,n=e.renderProps;return{renderProps:function(){var t=e.rendererConfig;return(0,C.Z)((0,C.Z)({},n()),{},{config:t})},trackMenuItems:function(){return[].concat((0,k.Z)(t()),[{label:"Show labels",icon:ve.Z,type:"checkbox",checked:e.showLabels,onClick:function(){e.toggleShowLabels()}},{label:"Show descriptions",icon:ve.Z,type:"checkbox",checked:e.showDescriptions,onClick:function(){e.toggleShowDescriptions()}},{label:"Display mode",icon:ve.Z,subMenu:["compact","reducedRepresentation","normal","collapse"].map((function(t){return{label:t,onClick:function(){e.setDisplayMode(t)}}}))},{label:"Set max height",onClick:function(){(0,y.getSession)(e).queueDialog((function(t){return[ye,{model:e,handleClose:t}]}))}}])}}}))};function xe(e){return(0,f.ConfigurationSchema)("LinearBasicDisplay",{mouseover:{type:"string",description:"what to display in a given mouseover",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:x,explicitlyTyped:!0})}var we=function(e){(0,o.Z)(c,e);var t=(0,s.Z)(c);function c(){var e;(0,a.Z)(this,c);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="LinearGenomeViewPlugin",e.exports={BaseLinearDisplayComponent:Y,BaseLinearDisplay:pe,baseLinearDisplayConfigSchema:x},e}return(0,i.Z)(c,[{key:"install",value:function(e){e.addTrackType((function(){var t=(0,f.ConfigurationSchema)("FeatureTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new h.Z({name:"FeatureTrack",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"FeatureTrack",t)})})),e.addTrackType((function(){var t=(0,f.ConfigurationSchema)("BasicTrack",{},{baseConfiguration:(0,p.createBaseTrackConfig)(e),explicitIdentifier:"trackId"});return new h.Z({name:"BasicTrack",configSchema:t,stateModel:(0,p.createBaseTrackModel)(e,"BasicTrack",t)})})),e.addDisplayType((function(){var t=function(e){return(0,f.ConfigurationSchema)("LinearBareDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:x,explicitlyTyped:!0})}(e);return new g.Z({name:"LinearBareDisplay",configSchema:t,stateModel:ge(t),trackType:"BasicTrack",viewType:"LinearGenomeView",ReactComponent:Y})})),e.addDisplayType((function(){var t=xe(e);return new g.Z({name:"LinearBasicDisplay",configSchema:t,stateModel:be(t),trackType:"FeatureTrack",viewType:"LinearGenomeView",ReactComponent:Y})})),e.addViewType((function(){return new m.Z({name:"LinearGenomeView",stateModel:(0,me.e$)(e),ReactComponent:(0,l.lazy)((function(){return Promise.resolve().then(n.bind(n,4935))}))})})),e.addToExtensionPoint("LaunchView-LinearGenomeView",function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,a,i,o,s,c,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.assembly,a=t.loc,i=t.tracks,o=void 0===i?[]:i,s=n.assemblyManager,c=n.addView("LinearGenomeView",{}),e.next=5,(0,d.when)((function(){return!!c.volatileWidth}));case 5:if(r){e.next=7;break}throw new Error("No assembly provided when launching linear genome view");case 7:return e.next=9,s.waitForAssembly(r);case 9:if(e.sent){e.next=12;break}throw new Error('Assembly "'.concat(r,'" not found when launching linear genome view'));case 12:if(c.navToLocString(a,r),l=[],o.forEach((function(e){try{c.showTrack(e)}catch(t){if(!"".concat(t).match("Could not resolve identifier"))throw t;l.push(e)}})),!l.length){e.next=17;break}throw new Error("Could not resolve identifiers: ".concat(l.join(",")));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"configure",value:function(e){(0,y.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Linear genome view",icon:b.Z,onClick:function(e){e.addView("LinearGenomeView",{})}})}}]),c}(v.Z)},87146:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(81575),c=n(49767),u=n(89058),l=n(9077);var d=n(33028),f=n(76085),p=n(40909);function h(e){return p.types.compose("LinearLollipopDisplay",u.fV,p.types.model({type:p.types.literal("LinearLollipopDisplay"),configuration:(0,f.B)(e)})).views((function(e){var t=e.renderProps;return{get blockType(){return"dynamicBlocks"},get renderDelay(){return 500},renderProps:function(){return(0,d.Z)((0,d.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer})},get rendererTypeName(){return e.configuration.renderer.type}}}))}var g=n(41361),m=n(96234),v=(n(29206),n(81073)),y=n(90550),b=n(30969),x=n(74426),w=n(37574);function k(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.y,i=r.data,o=i.anchorX,s=i.radiusPx,c=i.score,u=(0,l.readConfObject)(n,"innerColor",{feature:t}),d=String(c),f=1.1*(2*s/d.length);return f<12?null:(0,w.jsx)("text",{style:{fontSize:f,fill:(0,x.contrastingTextColor)(u)},x:o,y:a+s-f/2.4,textAnchor:"middle",dominantBaseline:"hanging",children:d})}function C(e){var t=function(t){var n=e.onFeatureMouseDown,r=e.feature;if(n)return n(t,r.id())},n=function(t){var n=e.onFeatureMouseEnter,r=e.feature;if(n)return n(t,r.id())},r=function(t){var n=e.onFeatureMouseOut,r=e.feature;if(n)return n(t,r.id())},a=function(t){var n=e.onFeatureMouseOver,r=e.feature;if(n)return n(t,r.id())},i=function(t){var n=e.onFeatureMouseUp,r=e.feature;if(n)return n(t,r.id())},o=function(t){var n=e.onFeatureMouseLeave,r=e.feature;if(n)return n(t,r.id())},s=function(t){var n=e.onFeatureMouseMove,r=e.feature;if(n)return n(t,r.id())},c=function(t){var n=e.onFeatureClick,r=e.feature;if(n)return t.stopPropagation(),n(t,r.id())},u=e.feature,f=e.config,p=e.layoutRecord,h=p.anchorLocation,g=p.y,m=p.data,v=m.radiusPx,y=m.score,b=e.selectedFeatureId,x={fill:(0,l.readConfObject)(f,"strokeColor",{feature:u})};String(b)===String(u.id())&&(x.fill="red");var C={fill:(0,l.readConfObject)(f,"innerColor",{feature:u})},Z=(0,l.readConfObject)(f,"strokeWidth",{feature:u});return(0,w.jsxs)("g",{"data-testid":u.id(),children:[(0,w.jsx)("title",{children:(0,l.readConfObject)(f,"caption",{feature:u})}),(0,w.jsx)("circle",{cx:h,cy:g+v,r:v,style:x,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:s,onClick:c,onFocus:a,onBlur:r}),v-Z<=2?null:(0,w.jsx)("circle",{cx:h,cy:g+v,r:v-Z,style:C,onMouseDown:t,onMouseEnter:n,onMouseOut:r,onMouseOver:a,onMouseUp:i,onMouseLeave:o,onMouseMove:s,onClick:c,onFocus:a,onBlur:r}),(0,w.jsx)(k,(0,d.Z)((0,d.Z)({},e),{},{score:y}))]})}C.defaultProps={selectedFeatureId:void 0,onFeatureMouseDown:void 0,onFeatureMouseEnter:void 0,onFeatureMouseOut:void 0,onFeatureMouseOver:void 0,onFeatureMouseUp:void 0,onFeatureMouseLeave:void 0,onFeatureMouseMove:void 0,onFeatureClick:void 0};var Z=(0,y.observer)(C);function S(e){var t=e.feature,n=e.config,r=e.layoutRecord,a=r.anchorLocation,i=r.y,o=r.data.radiusPx,s=e.selectedFeatureId,c={fill:(0,l.readConfObject)(n,"bodyColor",{feature:t})};return String(s)===String(t.id())&&(c.fill="red"),(0,w.jsx)("line",{x1:a,y1:0,x2:a,y2:i+2*o,stroke:(0,l.readConfObject)(n,"stickColor",{feature:t}),strokeWidth:(0,l.readConfObject)(n,"stickWidth",{feature:t})})}S.defaultProps={selectedFeatureId:void 0};var T=(0,y.observer)(S);function P(e){var t=function(t){var n=e.onMouseEnter;if(n)return n(t)},n=function(t){var n=e.onMouseLeave;if(n)return n(t)};function r(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.layout,i=Math.abs(t.get("end")+t.get("start"))/2,o=(0,v.bpToPx)(i,r,n),s=(0,l.readConfObject)(e.config,"radius",{feature:t});s||console.error(new Error("lollipop radius ".concat(s," configured for feature ").concat(t.id()))),a.add(t.id(),o,2*s,2*s,{featureId:t.id(),anchorX:o,radiusPx:s,score:(0,l.readConfObject)(e.config,"score",{feature:t})})}var a,i=e.regions,o=e.bpPerPx,s=e.layout,c=e.config,u=e.features,f=e.displayModel.selectedFeatureId,p=(0,m.Z)(i,1)[0],h=[],y=(0,g.Z)(u.values());try{for(y.s();!(a=y.n()).done;){r({feature:a.value,bpPerPx:o,region:p,config:c,layout:s})}}catch(L){y.e(L)}finally{y.f()}var x,k=(0,g.Z)(s.getLayout(c).values());try{for(k.s();!(x=k.n()).done;){var C=x.value,S=u.get(C.data.featureId);h.push((0,b.createElement)(T,(0,d.Z)((0,d.Z)({},e),{},{layoutRecord:C,feature:S,key:"stick-".concat(S.id()),selectedFeatureId:f})))}}catch(L){k.e(L)}finally{k.f()}var P,R=(0,g.Z)(s.getLayout(c).values());try{for(R.s();!(P=R.n()).done;){var M=P.value,j=u.get(M.data.featureId);h.push((0,b.createElement)(Z,(0,d.Z)((0,d.Z)({},e),{},{layoutRecord:M,feature:j,key:"body-".concat(j.id()),selectedFeatureId:f})))}}catch(L){R.e(L)}finally{R.f()}var A=(p.end-p.start)/o,N=s.getTotalHeight();return(0,w.jsxs)("svg",{className:"LollipopRendering",width:A,height:N,style:{position:"relative"},onMouseDown:function(t){var n=e.onMouseDown;if(n)return n(t)},onMouseUp:function(t){var n=e.onMouseUp;if(n)return n(t)},onMouseEnter:t,onMouseLeave:n,onMouseOver:function(t){var n=e.onMouseOver;if(n)return n(t)},onMouseOut:function(t){var n=e.onMouseOut;if(n)return n(t)},onFocus:t,onBlur:n,onClick:function(t){var n=e.onClick;if(n)return n(t)},children:[[],h]})}P.defaultProps={displayModel:{},features:new Map,onMouseDown:void 0,onMouseUp:void 0,onMouseEnter:void 0,onMouseLeave:void 0,onMouseOver:void 0,onMouseOut:void 0,onClick:void 0};var R=(0,y.observer)(P),M=(0,l.ConfigurationSchema)("LollipopRenderer",{strokeColor:{type:"color",description:"the outer color of each lollipop",defaultValue:"green",contextVariable:["feature"]},innerColor:{type:"color",description:"the inner color of each lollipop",defaultValue:"#7fc75f",contextVariable:["feature"]},strokeWidth:{type:"number",description:"width of the stroked border",defaultValue:4,contextVariable:["feature"]},radius:{type:"number",description:"radius in pixels of each lollipop body",defaultValue:"jexl:sqrt(max(3, (get(feature,'score')*10)/3.14))",contextVariable:["feature"]},caption:{type:"string",description:"the tooltip caption displayed when the mouse hovers over a lollipop",defaultValue:"jexl:get(feature,'name')",contextVariable:["feature"]},minStickLength:{type:"number",description:'minimum lollipop "stick" length, in pixels',defaultValue:5},stickColor:{type:"color",description:"color of the lollipop stick",defaultValue:"black",contextVariable:["feature"]},stickWidth:{type:"number",description:"width in pixels of the lollipop stick",defaultValue:2,contextVariable:["feature"]},score:{type:"number",description:'the "score" of each lollipop, displayed as a number in the center of the circle',defaultValue:"jexl:get(feature,'score')",contextVariable:["feature"]}},{explicitlyTyped:!0}),j=n(21339),A=n(35064),N=n(68079),L=n(37654),F=function(){function e(t){var n=t.width;if((0,r.Z)(this,e),this.width=void 0,this.totalHeight=0,this.items=[],this.layout=new Map,this.layoutDirty=!1,!n)throw new Error("width required to make a new FloatingLayout");this.width=n}return(0,a.Z)(e,[{key:"add",value:function(e,t,n,r,a){this.items.push({uniqueId:e,anchorLocation:t,width:n,height:r,data:a}),this.layoutDirty=!0}},{key:"getLayout",value:function(e){if(!this.layoutDirty)return this.layout;if(!e)throw new Error("configuration object required");for(var t=(0,l.readConfObject)(e,"minStickLength"),n=this.items.sort((function(e,t){return e.data.score-t.data.score})),r=0,a=Array(n.length),i=0;i<n.length;i+=1){for(var o=n[i],s=o.anchorLocation,c=o.width,u=o.height,f=s-c/2,p=f+c,h=t,g=h+u,v=0;v<i;v+=1){var y=(0,m.Z)(a[v],2)[1],b=y.x,x=y.y,w=b+y.width,k=x+y.height;(0,L.qY)(b,w,f,p)&&(0,L.qY)(x,k,h,g)&&(g=(h=k)+u,v=-1)}a[i]=[o.uniqueId,(0,d.Z)((0,d.Z)({},o),{},{x:f,y:h})],g>r&&(r=g)}return this.totalHeight=r,this.layout=new Map(a),this.layoutDirty=!1,this.layout}},{key:"getTotalHeight",value:function(){if(this.layoutDirty)throw new Error("getTotalHeight does not work when the layout is dirty.");return this.totalHeight}},{key:"serializeRegion",value:function(){return this.toJSON()}},{key:"toJSON",value:function(){if(this.layoutDirty)throw new Error("toJSON does not work when the layout is dirty.");return{pairs:(0,N.Z)(this.getLayout()),totalHeight:this.getTotalHeight()}}}],[{key:"fromJSON",value:function(){throw new Error("not supported")}}]),e}(),I=function(){function e(t){var n=t.pairs,a=t.totalHeight;(0,r.Z)(this,e),this.layout=void 0,this.totalHeight=void 0,this.layout=new Map(n),this.totalHeight=a}return(0,a.Z)(e,[{key:"add",value:function(e){if(!this.layout.has(e))throw new Error("layout error, precomputed layout is missing ".concat(e))}},{key:"getLayout",value:function(){return this.layout}},{key:"getTotalHeight",value:function(){return this.totalHeight}}],[{key:"fromJSON",value:function(t){return new e(t)}}]),e}(),B=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"makeLayout",value:function(){var e=this.regions[0],t=(e.end-e.start)/this.bpPerPx;return new A.Z(F,{width:t})}},{key:"layoutIsValid",value:function(){return!1}}]),n}(j.LayoutSession),D=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"createSession",value:function(e){return new B(e)}},{key:"deserializeLayoutInClient",value:function(e){return new I(e)}}]),n}(j.default),E=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="LollipopPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new D({name:"LollipopRenderer",ReactComponent:R,configSchema:M,pluginManager:e})})),e.addDisplayType((function(){var t=function(e){return(0,l.ConfigurationSchema)("LinearLollipopDisplay",{renderer:e.pluggableConfigSchemaType("renderer")},{baseConfiguration:u.fU,explicitlyTyped:!0})}(e);return new s.Z({name:"LinearLollipopDisplay",configSchema:t,stateModel:h(t),trackType:"LollipopTrack",viewType:"LinearGenomeView",ReactComponent:u.qb})}))}}]),n}(c.Z)},49934:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(66737),u=n(49767),l=n(81073),d=n(22874),f=n(43904),p=n(9077),h=n(29206),g=n(40909),m=(0,p.ConfigurationSchema)("AboutWidget",{}),v=g.types.model("AboutWidget",{id:h.ElementId,type:g.types.literal("AboutWidget")}),y=(0,p.ConfigurationSchema)("HelpWidget",{}),b=g.types.model("HelpWidget",{id:h.ElementId,type:g.types.literal("HelpWidget")}),x=(0,p.ConfigurationSchema)("ImportSessionWidget",{}),w=g.types.model("ImportSessionWidget",{id:h.ElementId,type:g.types.literal("ImportSessionWidget")}),k=(0,p.ConfigurationSchema)("SessionManager",{}),C=g.types.model("SessionManager",{id:h.ElementId,type:g.types.literal("SessionManager")}),Z=function(e){(0,i.Z)(u,e);var t=(0,o.Z)(u);function u(){var e;(0,r.Z)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="MenusPlugin",e}return(0,a.Z)(u,[{key:"install",value:function(e){e.addWidgetType((function(){return new c.Z({name:"AboutWidget",heading:"About",configSchema:m,stateModel:v,ReactComponent:(0,s.lazy)((function(){return n.e(4637).then(n.bind(n,94637))}))})})),e.addWidgetType((function(){return new c.Z({name:"HelpWidget",heading:"Help",configSchema:y,stateModel:b,ReactComponent:(0,s.lazy)((function(){return n.e(8935).then(n.bind(n,58935))}))})})),e.addWidgetType((function(){return new c.Z({name:"ImportSessionWidget",heading:"Import session",configSchema:x,stateModel:w,ReactComponent:(0,s.lazy)((function(){return Promise.all([n.e(4119),n.e(9915)]).then(n.bind(n,79915))}))})})),e.addWidgetType((function(){return new c.Z({name:"SessionManager",heading:"Sessions",configSchema:k,stateModel:C,ReactComponent:(0,s.lazy)((function(){return n.e(5486).then(n.bind(n,20218))}))})}))}},{key:"configure",value:function(e){(0,l.isAbstractMenuManager)(e.rootModel)&&(e.rootModel.appendToMenu("Help",{label:"About",icon:f.Z,onClick:function(e){var t=e.addWidget("AboutWidget","aboutWidget");e.showWidget(t)}}),e.rootModel.appendToMenu("Help",{label:"Help",icon:d.Z,onClick:function(e){var t=e.addWidget("HelpWidget","helpWidget");e.showWidget(t)}}))}}]),u}(u.Z)},47059:function(e,t,n){"use strict";n.d(t,{Z:function(){return S}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(93029),c=n(49767),u=n(68079),l=n(41361),d=n(96234),f=n(33028),p=n(34795),h=n(77162),g=n.n(h),m=n(29598),v=n(26131),y=n(14956),b=n(64953),x=n.n(b),w=n(9077),k=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;return(0,r.Z)(this,n),(o=t.call(this,e,a,i)).endpoint=void 0,o.queryTemplate=void 0,o.refNamesQueryTemplate=void 0,o.additionalQueryParams=void 0,o.configRefNames=void 0,o.refNames=void 0,o.endpoint=(0,w.readConfObject)(e,"endpoint").uri,o.queryTemplate=(0,w.readConfObject)(e,"queryTemplate"),o.additionalQueryParams=(0,w.readConfObject)(e,"additionalQueryParams"),o.refNamesQueryTemplate=(0,w.readConfObject)(e,"refNamesQueryTemplate"),o.configRefNames=(0,w.readConfObject)(e,"refNames"),o}return(0,a.Z)(n,[{key:"getRefNames",value:function(){var e=(0,p.Z)(g().mark((function e(){var t,n,r,a,i=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},!this.refNames){e.next=3;break}return e.abrupt("return",this.refNames);case 3:if(n=[],!this.refNamesQueryTemplate){e.next=12;break}return r=encodeURIComponent(this.refNamesQueryTemplate),e.next=8,this.querySparql(r,t);case 8:a=e.sent,n=this.resultsToRefNames(a),e.next=13;break;case 12:this.configRefNames&&(n=this.configRefNames);case 13:return this.refNames=n,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,v.ObservableCreate)(function(){var r=(0,p.Z)(g().mark((function r(a){var i,o,s;return g().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=encodeURIComponent(x()(t.queryTemplate,e)),o=e.refName,r.next=4,t.querySparql(i,n);case 4:s=r.sent,t.resultsToFeatures(s,o).forEach((function(e){a.next(e)})),a.complete();case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),n.signal)}},{key:"querySparql",value:function(){var e=(0,p.Z)(g().mark((function e(t,n){var r,a,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="",this.additionalQueryParams.length&&(r="&".concat(this.additionalQueryParams.join("&"))),a=n&&n.signal,e.next=5,fetch("".concat(this.endpoint,"?query=").concat(t).concat(r),{headers:{accept:"application/json,application/sparql-results+json"},signal:a});case 5:return i=e.sent,e.abrupt("return",i.json());case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"resultsToRefNames",value:function(e){var t=((e||{}).results||{}).bindings||[];if(!t.length)return[];if(!e.head.vars.includes("refName"))throw new Error('"refName" not found in refNamesQueryTemplate response');return t.map((function(e){return e.refName.value}))}},{key:"resultsToFeatures",value:function(e,t){var n=((e||{}).results||{}).bindings||[];if(!n.length)return[];var r=e.head.vars;["start","end","uniqueId"].forEach((function(e){r.includes(e)||console.error("Required field ".concat(e," missing from feature data"))}));var a={};n.forEach((function(e){var n=[{}];r.forEach((function(t){if(t in e){for(var r=e[t].value,a=0;t.startsWith("sub_");)t=t.slice(4),a+=1;for(;a>n.length-1;)n.push({});n[a][t]=r}})),n.forEach((function(e,r){var i=e.uniqueId;r<n.length-1&&(n[r+1].parentUniqueId=i),a[i]={data:(0,f.Z)((0,f.Z)({},e),{},{uniqueId:i,refName:t,start:parseInt(e.start,10),end:parseInt(e.end,10),strand:parseInt(e.strand,10)||0})}}))}));for(var i=0,o=Object.entries(a);i<o.length;i++){var s=(0,d.Z)(o[i],2),c=s[0],p=s[1],h=p.data.parentUniqueId;if(delete p.data.parentUniqueId,h){var g=a[h];if(g)g.data.subfeatures||(g.data.subfeatures=[]),g.data.subfeatures.push((0,f.Z)((0,f.Z)({},p.data),{},{uniqueId:c})),delete a[c];else{var m,v=Object.values(a).map((function(e){return e.data.subfeatures})).filter((function(e){return!!e})).flat(),b=!1,x=(0,l.Z)(v);try{for(x.s();!(m=x.n()).done;){var w=m.value;if(w&&w.uniqueId===h){w.subfeatures||(w.subfeatures=[]),w.subfeatures.push((0,f.Z)((0,f.Z)({},p.data),{},{uniqueId:c})),delete a[c],b=!0;break}w&&w.subfeatures&&v.push.apply(v,(0,u.Z)(w.subfeatures))}}catch(k){x.e(k)}finally{x.f()}b||console.error("Could not find parentID ".concat(h))}}}return Object.keys(a).map((function(e){return new y.Z((0,f.Z)((0,f.Z)({},a[e].data),{},{uniqueId:e,subfeatures:a[e].data.subfeatures}))}))}},{key:"hasDataForRefName",value:function(){var e=(0,p.Z)(g().mark((function e(t){var n,r,a=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.getRefNames(n);case 3:if(!(r=e.sent).length||r.includes(t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(m.BaseFeatureDataAdapter),C=(0,w.ConfigurationSchema)("SPARQLAdapter",{endpoint:{type:"fileLocation",defaultValue:{uri:"https://somesite.com/sparql",locationType:"UriLocation"},description:"URL of the SPARQL endpoint"},queryTemplate:{type:"text",defaultValue:"",description:"SPARQL query where {start} {end} and {refName} will get replaced for each call"},refNamesQueryTemplate:{type:"text",defaultValue:"",description:"SPARQL query that returns the possible refNames in a ?refName column"},refNames:{type:"stringArray",defaultValue:[],description:'Possible refNames used by the SPARQL endpoint (ignored if "refNamesQueryTemplate" is provided)'},additionalQueryParams:{type:"stringArray",defaultValue:[],description:'Additional parameters to add to the query, e.g. "format=JSON"'}},{explicitlyTyped:!0}),Z=n(97891),S=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="RdfPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addAdapterType((function(){return new s.Z({name:"SPARQLAdapter",configSchema:C,AdapterClass:k})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="SPARQLAdapter",i=(0,Z.getFileName)(t);return/\/sparql$/i.test(i)||r===a?{type:a,endpoint:t}:e(t,n,r)}}))}}]),n}(c.Z)},17816:function(e,t,n){"use strict";n.d(t,{Z:function(){return V}});var r=n(33028),a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(93029),u=n(59853),l=n(29637),d=n(82044),f=n(49767),p=n(89058),h=n(97891),g=n(9077),m=(0,g.ConfigurationSchema)("BgzipFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.fai",locationType:"UriLocation"}},gziLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.gz.gzi",locationType:"UriLocation"}}},{explicitlyTyped:!0}),v=(0,g.ConfigurationSchema)("ChromSizesAdapter",{chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/species.chrom.sizes",locationType:"UriLocation"}}},{explicitlyTyped:!0}),y=n(68079),b=n(96234),x=n(30969),w=n(74426),k=n(24998),C=n(90550),Z=n(81073),S=n(37574);function T(e){for(var t=e.codonTable,n=e.seq,r=e.frame,a=e.bpPerPx,i=e.region,o=e.height,s=e.y,c=e.reverse,u=void 0!==c&&c,l=e.theme,d=a,f=3-i.start%3,p=(r+f+3)%3,h=n.slice(p),g=[],m=0;m<h.length;m+=3){var v=h.slice(m,m+3),y=u?(0,Z.revcom)(v):v,b=t[y]||"";g.push({letter:b,codon:y.toUpperCase()})}var w=1/d*3,k=0===i.start?0:w,C=1/a>=12,T=(i.end-i.start)/a,P=["#d8d8d8","#adadad","#8f8f8f"].reverse();return(0,S.jsx)(S.Fragment,{children:g.map((function(e,t){var n=i.reversed?T-(w*(t+1)+p/d-k):w*t+p/d-k,a=e.letter,c=e.codon;return(0,S.jsxs)(x.Fragment,{children:[(0,S.jsx)("rect",{x:n,y:s,width:C?w:w+.7,height:o,stroke:C?"#555":"none",fill:Z.defaultStarts.includes(c)?l.palette.startCodon:Z.defaultStops.includes(c)?l.palette.stopCodon:P[Math.abs(r)]}),C?(0,S.jsx)("text",{x:n+w/2,y:s+o/2,dominantBaseline:"middle",textAnchor:"middle",children:a}):null]},"".concat(t,"-").concat(a))}))})}function P(e){var t=e.bpPerPx,n=e.region,r=e.feature,a=e.theme,i=e.height,o=e.seq,s=e.y,c=1/t>=12,u=(0,Z.bpSpanPx)(r.get("start"),r.get("end"),n,t),l=(0,b.Z)(u,2),d=l[0],f=l[1],p=n.reversed,h=r.get("end")-r.get("start"),g=Math.max((f-d)/h,.8);return(0,S.jsx)(S.Fragment,{children:o.split("").map((function(e,t){var n=a.palette.bases[e.toUpperCase()],r=p?f-(t+1)*g:d+t*g;return(0,S.jsxs)(x.Fragment,{children:[(0,S.jsx)("rect",{x:r,y:s,width:g,height:i,fill:n?n.main:"#aaa",stroke:c?"#555":"none"}),c?(0,S.jsx)("text",{x:r+g/2,y:s+i/2,dominantBaseline:"middle",textAnchor:"middle",fill:n?(0,w.contrastingTextColor)(n.main):"black",children:e}):null]},t)}))})}var R=function(e){var t=e.regions,n=e.theme,r=e.features,a=void 0===r?new Map:r,i=e.showReverse,o=e.showForward,s=e.showTranslation,c=e.bpPerPx,u=(0,b.Z)(t,1)[0],l=(0,k.createJBrowseTheme)(n),d=(0,Z.generateCodonTable)(Z.defaultCodonTable),f=(0,y.Z)(a.values())[0];if(!f)return null;var p=f.get("seq");if(!p)return null;var h=-20;return(0,S.jsxs)(S.Fragment,{children:[s&&(u.reversed?i:o)?[2,1,0].map((function(e){return(0,S.jsx)(T,{seq:p,y:h+=20,codonTable:d,frame:e,bpPerPx:c,region:u,theme:l,height:20,reverse:u.reversed},"translation-".concat(e))})):null,o?(0,S.jsx)(P,{height:20,y:h+=20,feature:f,region:u,seq:u.reversed?(0,Z.complement)(p):p,bpPerPx:c,theme:l}):null,i?(0,S.jsx)(P,{height:20,y:h+=20,feature:f,region:u,seq:u.reversed?p:(0,Z.complement)(p),bpPerPx:c,theme:l}):null,s&&(u.reversed?o:i)?[0,-1,-2].map((function(e){return(0,S.jsx)(T,{seq:p,y:h+=20,codonTable:d,frame:e,bpPerPx:c,region:u,theme:l,height:20,reverse:!u.reversed},"rev-translation-".concat(e))})):null]})},M=function(e){var t=e.exportSVG,n=e.width,r=e.totalHeight,a=e.children;return t?(0,S.jsx)(S.Fragment,{children:a}):(0,S.jsx)("svg",{"data-testid":"sequence_track",width:n,height:r,style:{width:n,height:r},children:a})};var j=(0,C.observer)((function(e){var t=e.regions,n=e.bpPerPx,a=(0,b.Z)(t,1)[0],i=(a.end-a.start)/n;return(0,S.jsx)(M,(0,r.Z)((0,r.Z)({},e),{},{totalHeight:200,width:i,children:(0,S.jsx)(R,(0,r.Z)({},e))}))})),A=(0,g.ConfigurationSchema)("DivSequenceRenderer",{height:{type:"number",description:"height in pixels of each line of sequence",defaultValue:16}},{explicitlyTyped:!0}),N=(0,g.ConfigurationSchema)("IndexedFastaAdapter",{fastaLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa",locationType:"UriLocation"}},faiLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/seq.fa.fai",locationType:"UriLocation"}}},{explicitlyTyped:!0}),L=(0,g.ConfigurationSchema)("LinearReferenceSequenceDisplay",{renderer:A},{explicitIdentifier:"displayId",explicitlyTyped:!0}),F=n(40909);var I=(0,g.ConfigurationSchema)("TwoBitAdapter",{twoBitLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.2bit",locationType:"UriLocation"}},chromSizesLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/default.chrom.sizes",locationType:"UriLocation"},description:"An optional chrom.sizes file can be supplied to speed up loading since parsing the twobit file can take time"}},{explicitlyTyped:!0}),B=function(e){return(0,g.ConfigurationSchema)("GCContentAdapter",{sequenceAdapter:e.pluggableConfigSchemaType("adapter")},{explicitlyTyped:!0})},D=function(e){return{configSchema:e.load(B),getAdapterClass:function(){return n.e(2734).then(n.bind(n,82734)).then((function(e){return e.default}))}}};var E=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,i.Z)(n,[{key:"getExpandedRegion",value:function(e){return(0,r.Z)((0,r.Z)({},e),{},{start:Math.max(e.start-3,0),end:e.end+3})}}]),n}(l.default),V=function(e){(0,o.Z)(l,e);var t=(0,s.Z)(l);function l(){var e;(0,a.Z)(this,l);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).name="SequencePlugin",e}return(0,i.Z)(l,[{key:"install",value:function(e){e.addAdapterType((function(){return new c.Z({name:"TwoBitAdapter",configSchema:I,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return Promise.all([n.e(2821),n.e(6254),n.e(7028)]).then(n.bind(n,97028)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="TwoBitAdapter",i=(0,h.getFileName)(t),o={type:a,twoBitLocation:t};return/\.2bit$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"TwoBitAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new c.Z({name:"ChromSizesAdapter",configSchema:v,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return n.e(7040).then(n.bind(n,17040)).then((function(e){return e.default}))}})})),e.addAdapterType((function(){return new c.Z({name:"IndexedFastaAdapter",configSchema:N,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return Promise.all([n.e(4285),n.e(9202)]).then(n.bind(n,29202)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="IndexedFastaAdapter",i=(0,h.getFileName)(t),o={type:a,fastaLocation:t,faiLocation:n||(0,h.makeIndex)(t,".fai")};return/\.(fa|fasta|fas|fna|mfa)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"IndexedFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new c.Z({name:"BgzipFastaAdapter",configSchema:m,adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null},getAdapterClass:function(){return Promise.all([n.e(4285),n.e(2796)]).then(n.bind(n,2796)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BgzipFastaAdapter",i=(0,h.getFileName)(t),o={type:a,faiLocation:(0,h.makeIndex)(t,".fai"),gziLocation:(0,h.makeIndex)(t,".gzi")};return/\.(fa|fasta|fas|fna|mfa)\.b?gz$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BgzipFastaAdapter"===t?"ReferenceSequenceTrack":e(t)}})),e.addAdapterType((function(){return new c.Z((0,r.Z)({name:"GCContentAdapter",adapterMetadata:{category:null,hiddenFromGUI:!0,displayName:null,description:null}},e.load(D)))})),e.addTrackType((function(){var t=function(e){return(0,g.ConfigurationSchema)("ReferenceSequenceTrack",{adapter:e.pluggableConfigSchemaType("adapter"),displays:F.types.array(e.pluggableConfigSchemaType("display")),name:{type:"string",description:"optional track name",defaultValue:""},metadata:{type:"frozen",description:"anything to add about this track",defaultValue:{}}},{preProcessSnapshot:function(t){var n=JSON.parse(JSON.stringify(t)),a=new Set,i=n.displays,o=void 0===i?[]:i;return"placeholderId"!==n.trackId&&(o.forEach((function(e){return e&&a.add(e.type)})),e.getTrackType(n.type).displayTypes.forEach((function(e){a.has(e.name)||o.push({displayId:"".concat(n.trackId,"-").concat(e.name),type:e.name})}))),(0,r.Z)((0,r.Z)({},n),{},{displays:o})},explicitIdentifier:"trackId",explicitlyTyped:!0,actions:function(e){return{addDisplayConf:function(t){var n=t.type;if(!n)throw new Error("unknown display type ".concat(n));var r=e.displays.find((function(e){return e&&e.displayId===t.displayId}));if(r)return r;var a=e.displays.push(t);return e.displays[a-1]}}}})}(e);return new d.Z({name:"ReferenceSequenceTrack",configSchema:t,stateModel:(0,u.createBaseTrackModel)(e,"ReferenceSequenceTrack",t)})})),e.addDisplayType((function(){var e=function(e){return F.types.compose("LinearReferenceSequenceDisplay",p.fV,F.types.model({type:F.types.literal("LinearReferenceSequenceDisplay"),configuration:(0,g.ConfigurationReference)(e),showForward:F.types.optional(F.types.boolean,!0),showReverse:F.types.optional(F.types.boolean,!0),showTranslation:F.types.optional(F.types.boolean,!0),height:180})).views((function(e){var t=e.renderProps;return{renderProps:function(){var n=e.showForward,a=e.showReverse,i=e.showTranslation;return(0,r.Z)((0,r.Z)({},t()),{},{rpcDriverName:e.rpcDriverName,config:e.configuration.renderer,showForward:n,showReverse:a,showTranslation:i})},regionCannotBeRendered:function(){var t=(0,Z.getContainingView)(e);if(t&&t.bpPerPx>=1)return"Zoom in to see sequence"},get rendererTypeName(){return e.configuration.renderer.type}}})).actions((function(e){return{toggleShowForward:function(){e.showForward=!e.showForward},toggleShowReverse:function(){e.showReverse=!e.showReverse},toggleShowTranslation:function(){e.showTranslation=!e.showTranslation}}})).views((function(e){return{trackMenuItems:function(){return[{label:"Show forward",type:"checkbox",checked:e.showForward,onClick:function(){e.toggleShowForward()}},{label:"Show reverse",type:"checkbox",checked:e.showReverse,onClick:function(){e.toggleShowReverse()}},{label:"Show translation",type:"checkbox",checked:e.showTranslation,onClick:function(){e.toggleShowTranslation()}}]}}}))}(L);return{name:"LinearReferenceSequenceDisplay",configSchema:L,stateModel:e,trackType:"ReferenceSequenceTrack",viewType:"LinearGenomeView",ReactComponent:p.qb}})),e.addRendererType((function(){return new E({name:"DivSequenceRenderer",ReactComponent:j,configSchema:A,pluginManager:e})}))}}]),l}(f.Z)},30852:function(e,t,n){"use strict";n.d(t,{Z:function(){return xe}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(81073),u=n(49767),l=n(30188),d=n(39798),f=n(40909),p=n(59853),h=n(9077),g=n(23698),m=n(34795),v=n(77162),y=n.n(v),b=n(32665),x=n(35247),w=n(68079),k=n(90550),C=n(37654),Z=n(49430);function S(e,t){var n=t.DataCellReactComponent,r=void 0===n?null:n,a=t.FilterModelType,i=void 0===a?null:a,o=t.compare,s=t.displayName,c=void 0===s?void 0:s,u=t.categoryName,l=void 0===u?void 0:u;return f.types.model("ColumnDataType".concat(e),{type:f.types.literal(e)}).volatile((function(){return{DataCellReactComponent:r,FilterModelType:i,displayName:c||e,categoryName:l}})).views((function(){return{compare:o,get hasFilter(){return!!i}}}))}var T=n(88981),P=n(22714),R=n(43175),M=n(1720),j=n(7690),A=n(5877),N=n(32343),L=n(37574),F=(0,P.Z)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),I=(0,k.observer)((function(e){var t=e.filterModel,n=F(),r=(0,T.getEnumerationValues)((0,T.getSubType)((0,T.getPropertyType)((0,f.getType)(t),"operation")));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(R.Z,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(M.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(j.Z,{label:"range",placeholder:"chr1:100-200",error:t.locStringIsInvalid,value:t.locString,onChange:function(e){return t.setLocString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:(0,L.jsx)(A.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,L.jsx)(N.Z,{"aria-label":"clear filter",onClick:function(){return t.setLocString("")},color:"secondary",children:(0,L.jsx)(Z.Z,{})})})}})]})})),B=["overlaps with","contained within","fully contains","does not overlap","not contained within","does not contain"],D={"overlaps with":function(e,t){return e.refName===t.refName&&(0,C.qY)(e.start,e.end,t.start,t.end)},"contained within":function(e,t){return e.refName===t.refName&&(0,C.J7)(e.start,e.end,t.start,t.end)},"fully contains":function(e,t){return e.refName===t.refName&&(0,C.J7)(t.start,t.end,e.start,e.end)},"does not overlap":function(e,t){return!D["overlaps with"](e,t)},"not contained within":function(e,t){return!D["contained within"](e,t)},"does not contain":function(e,t){return!D["fully contains"](e,t)}},E=f.types.model("ColumnLocStringFilter",{type:f.types.literal("LocString"),columnNumber:f.types.integer,locString:"",operation:f.types.optional(f.types.enumeration(B),B[0])}).views((function(e){return{get locStringIsInvalid(){if(e.locString){var t=e.parsedLocString;return!t||""===t.refName||"number"!==typeof t.start||"number"!==typeof t.end||t.start>t.end}return!1},get parsedLocString(){var t=(0,c.getSession)(e),n=(0,f.getParent)(e,3).spreadsheet.assemblyName;try{return(0,c.parseLocString)(e.locString,(function(e){return t.assemblyManager.isValidRefName(e,n)}))}catch(r){return}},get predicate(){if(!e.locString||e.locStringIsInvalid)return function(){return!0};var t=e.parsedLocString,n=e.operation,r=e.columnNumber;return function(e,a){var i=a.cellsWithDerived[r];if(!i||!i.text||!i.extendedData)return!1;var o=i.extendedData;if(!o.refName)return!1;var s=D[n];if(!s)throw new Error('"'.concat(n,'" not implemented in location filter'));return s(o,t)}}}})).actions((function(e){return{setLocString:function(t){e.locString=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:I}}));function V(){return(V=(0,m.Z)(y().mark((function e(t,n,r){var a,i,o,s,u,l,d,p,h,g,m,v;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,c.getSession)(t),i=a.assemblyManager,o=t.assemblyName,s=(0,f.getParent)(t),u=s.id,e.next=6,i.waitForAssembly(o);case 6:if(l=e.sent,e.prev=7,d=(0,c.parseLocString)(r.text,(function(e){return i.isValidRefName(e,t.assemblyName)})),p=d.refName,h=l.getCanonicalRefName(p),g=l.regions.find((function(e){return e.refName===h})),m="".concat(u,"_").concat(o),v=a.views.find((function(e){return e.id===m}))){e.next=19;break}return v=a.addView("LinearGenomeView",{displayName:o,id:m}),e.next=18,(0,c.when)((function(){return v.initialized}));case 18:v.setDisplayedRegions([JSON.parse(JSON.stringify(g))]);case 19:v.navToLocString(r.text),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),a.notify("".concat(e.t0),"error");case 25:case"end":return e.stop()}}),e,null,[[7,22]])})))).apply(this,arguments)}var O=(0,k.observer)((function(e){var t=e.cell,n=e.columnNumber,r=e.spreadsheet;return(0,L.jsx)("a",{onClick:function(e){e.preventDefault(),function(e,t,n){V.apply(this,arguments)}(r,n,t)},title:"open a new linear genome view here",href:"#link",children:t.text})})),z=S("LocString",{categoryName:"Location",displayName:"Full location",compare:function(e,t){return(0,c.compareLocs)(e.extendedData,t.extendedData)},FilterModelType:E,DataCellReactComponent:O}),W=["equals","contains","does not contain","does not equal","starts with","ends with"],H={contains:function(e,t){return-1!==e.toLowerCase().indexOf(t)},equals:function(e,t){return e.toLowerCase()===t},"starts with":function(e,t){return 0===e.toLowerCase().indexOf(t)},"ends with":function(e,t){var n=e.toLowerCase().indexOf(t);return-1!==n&&n===e.length-t.length},"does not contain":function(e,t){return!H.contains(e,t)},"does not equal":function(e,t){return!H.equals(e,t)}},q=(0,P.Z)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:0,"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),U=(0,k.observer)((function(e){var t=e.filterModel,n=q(),r=(0,T.getEnumerationValues)((0,T.getSubType)((0,T.getPropertyType)((0,f.getType)(t),"operation")));return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(R.Z,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(M.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(j.Z,{label:"text",value:t.stringToFind,onChange:function(e){return t.setString(e.target.value)},className:n.textFilterControl,InputProps:{endAdornment:(0,L.jsx)(A.Z,{className:n.textFilterControlAdornment,position:"end",children:(0,L.jsx)(N.Z,{"aria-label":"clear filter",onClick:function(){return t.setString("")},color:"secondary",children:(0,L.jsx)(Z.Z,{})})})}})]})})),_=f.types.model("ColumnTextFilter",{type:f.types.literal("Text"),columnNumber:f.types.integer,stringToFind:"",operation:f.types.optional(f.types.enumeration(W),W[0])}).views((function(e){return{get predicate(){var t=e.stringToFind,n=e.columnNumber,r=e.operation;if(!t)return function(){return!0};var a=t.toLowerCase();return function(e,t){var i=t.cellsWithDerived[n];if(!i||!i.text)return!1;var o=H[r];if(!o)throw new Error('"'.concat(r,'" not implemented in location filter'));return o(i.text,a)}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:U}})),G=S("Text",{compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:_}),J=S("LocRef",{categoryName:"Location",displayName:"Reference seq",compare:function(e,t){return e.text.localeCompare(t.text)},FilterModelType:f.types.compose(_,f.types.model({type:f.types.literal("LocRef")}))}),X=["equals","greater than","less than","between","not between"],Y={equals:function(e,t){return e===t},"greater than":function(e,t){return e>t},"less than":function(e,t){return e<t},between:function(e,t,n){return e>t&&e<n},"not between":function(e,t,n){return!Y.between(e,t,n)}},Q=(0,P.Z)((function(){return{textFilterControlAdornment:{marginRight:"-18px"},textFilterControl:{margin:[[0,0,0,"0.4rem"]],"& .MuiInput-formControl":{marginTop:8},"& .MuiInputLabel-formControl":{top:"-7px","&.MuiInputLabel-shrink":{top:"-3px"}}}}})),$=(0,k.observer)((function(e){var t=e.filterModel,n=Q(),r=X;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(R.Z,{value:t.operation,onChange:function(e){t.setOperation(String(e.target.value))},children:r.map((function(e){return(0,L.jsx)(M.Z,{value:e,children:e},e)}))})," ",(0,L.jsx)(j.Z,{label:"number",placeholder:"123",type:"number",error:t.firstNumberIsInvalid,defaultValue:t.firstNumber,onChange:function(e){t.setFirstNumber(parseFloat(e.target.value))},className:n.textFilterControl}),"between"!==t.operation&&"not between"!==t.operation?null:(0,L.jsxs)(L.Fragment,{children:[" and ",(0,L.jsx)(j.Z,{label:"number",placeholder:"456",type:"number",error:t.secondNumberIsInvalid,defaultValue:t.secondNumber,onChange:function(e){return t.setSecondNumber(parseFloat(e.target.value))},className:n.textFilterControl})]})]})})),K=f.types.model("ColumnNumberFilter",{type:f.types.literal("Number"),columnNumber:f.types.integer,firstNumber:f.types.maybe(f.types.number),secondNumber:f.types.maybe(f.types.number),operation:f.types.optional(f.types.enumeration(X),X[0])}).views((function(e){return{get predicate(){if("number"!==typeof e.firstNumber)return function(){return!0};var t=e.firstNumber,n=e.secondNumber,r=e.operation,a=e.columnNumber;return function(e,i){var o=i.cellsWithDerived[a];if(!o||!o.text)return!1;var s=parseFloat(o.text);if("number"!==typeof s)return!1;var c=Y[r];if(!c)throw new Error('"'.concat(r,'" not implemented in location filter'));return c(s,t,n)}}}})).actions((function(e){return{setFirstNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.firstNumber=void 0:e.firstNumber=t},setSecondNumber:function(t){Number.isNaN(t)||"number"!==typeof t?e.secondNumber=void 0:e.secondNumber=t},setOperation:function(t){e.operation=t}}})).volatile((function(){return{ReactComponent:$}})),ee={Number:S("Number",{compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:K}),Text:G,LocString:z,LocRef:J,LocStart:S("LocStart",{categoryName:"Location",displayName:"Start",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:f.types.compose(K,f.types.model({type:f.types.literal("LocStart")}))}),LocEnd:S("LocEnd",{categoryName:"Location",displayName:"End",compare:function(e,t){return parseFloat(e.text)-parseFloat(t.text)},FilterModelType:f.types.compose(K,f.types.model({type:f.types.literal("LocEnd")}))})},te=Object.values(ee),ne=f.types.union.apply(f.types,(0,w.Z)(te)),re=f.types.union.apply(f.types,(0,w.Z)(te.map((function(e){return e.create({type:e.properties.type.value}).FilterModelType})).filter((function(e){return!!e})))),ae=f.types.model("SpreadsheetCell",{text:f.types.string,extendedData:f.types.maybe(f.types.frozen())}),ie=f.types.model("SpreadsheetRow",{id:f.types.identifier,cells:f.types.array(ae),extendedData:f.types.maybe(f.types.frozen()),isSelected:!1}).actions((function(e){return{toggleSelect:function(){e.isSelected=!e.isSelected},unSelect:function(){e.isSelected=!1},select:function(){e.isSelected=!0},setExtendedData:function(t){e.extendedData=t}}})).views((function(e){return{get cellsWithDerived(){var t=(0,f.getParent)(e,3).columns,n=0;return t.map((function(t){return t.isDerived?t.expr.evalSync({row:e}):e.cells[n++]}))}}})),oe=f.types.model("StaticRowSet",{isLoaded:f.types.literal(!0),rows:f.types.array(ie)}).views((function(e){return{get count(){return e.rows.length},get passingFiltersCount(){return this.sortedFilteredRows.length},get selectedCount(){return this.selectedRows.length},get selectedAndPassingFiltersCount(){return this.selectedFilteredRows.length},get sortedRows(){var t=(0,f.getParent)(e);return e.rows.slice().sort(t.rowSortingComparisonFunction)},get selectedRows(){return e.rows.filter((function(e){return e.isSelected}))},get selectedFilteredRows(){var t=(0,f.getParent)(e),n=(0,f.getParent)(t).filterControls;return this.selectedRows.filter((function(e){return n.rowPassesFilters(t,e)}))},get sortedFilteredRows(){var t=(0,f.getParent)(e),n=(0,f.getParent)(t).filterControls;return e.rows.filter((function(e){return n.rowPassesFilters(t,e)})).sort(t.rowSortingComparisonFunction)}}})).actions((function(e){return{unselectAll:function(){e.rows.forEach((function(e){return e.unSelect()}))}}})),se=f.types.model("ColumnDefinition",{name:f.types.maybe(f.types.string),dataType:f.types.optional(ne,(function(){return{type:"Text"}})),isDerived:!1,derivationFunctionText:f.types.maybe(f.types.string)}).views((function(e){return{get expr(){if(e.isDerived)return(0,b.P)(String(e.derivationFunctionText),(0,f.getEnv)(e).pluginManager.jexl)}}})),ce=f.types.model("Spreadsheet",{rowSet:f.types.optional(oe,(function(){return oe.create()})),columns:f.types.array(se),columnDisplayOrder:f.types.array(f.types.number),hasColumnNames:!1,sortColumns:f.types.array(f.types.model("SortColumns",{columnNumber:f.types.number,descending:!1}).actions((function(e){return{switchDirection:function(){e.descending=!e.descending}}}))),assemblyName:f.types.maybe(f.types.string)}).volatile((function(){return{defaultDataType:ee.Text,rowMenuPosition:null,isLoaded:!1}})).views((function(e){return{get initialized(){var t,n=(0,c.getSession)(e),r=e.assemblyName;return!!r&&(null===(t=n.assemblyManager.get(r))||void 0===t?void 0:t.initialized)},get hideRowSelection(){return(0,f.getParent)(e).hideRowSelection},get dataTypeChoices(){return Object.keys(ee).map((function(e){var t=ee[e].create({type:e});return{typeName:e,displayName:t.displayName,categoryName:t.categoryName}}))},rowSortingComparisonFunction:function(t,n){for(var r=0;r<e.sortColumns.length;r+=1){var a=e.sortColumns[r],i=a.columnNumber,o=a.descending,s=e.columns[i].dataType.compare(t.cellsWithDerived[i],n.cellsWithDerived[i]);if(s)return o?-s:s}return 0}}})).actions((function(e){return{afterAttach:function(){var t=this;(0,f.addDisposer)(e,(0,x.autorun)((0,m.Z)(y().mark((function n(){var r,a;return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(0,c.getSession)(e),a=r.assemblyManager,n.prev=2,!e.assemblyName){n.next=7;break}return n.next=6,a.waitForAssembly(e.assemblyName);case 6:t.setLoaded(!0);case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),r.notify("failed to load assembly ".concat(e.assemblyName," ").concat(n.t0),"error");case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))))},setLoaded:function(t){e.isLoaded=t},setRowMenuPosition:function(t){e.rowMenuPosition=t},setSortColumns:function(t){t&&(e.sortColumns=t)},setColumnType:function(t,n){e.columns[t].dataType={type:n}},unselectAll:function(){return e.rowSet.unselectAll()}}})),ue=n(33528),le=3e7,de=["CSV","TSV","VCF","BED","BEDPE","STAR-Fusion"],fe={CSV:function(){return n.e(5997).then(n.bind(n,45997)).then((function(e){return e.parseCsvBuffer}))},TSV:function(){return n.e(5997).then(n.bind(n,45997)).then((function(e){return e.parseTsvBuffer}))},VCF:function(){return n.e(5098).then(n.bind(n,31311)).then((function(e){return e.parseVcfBuffer}))},BED:function(){return n.e(847).then(n.bind(n,90847)).then((function(e){return e.parseBedBuffer}))},BEDPE:function(){return n.e(847).then(n.bind(n,90847)).then((function(e){return e.parseBedPEBuffer}))},"STAR-Fusion":function(){return n.e(2533).then(n.bind(n,32533)).then((function(e){return e.parseSTARFusionBuffer}))}},pe=new RegExp("\\.(".concat(de.join("|"),")(\\.gz)?$"),"i"),he=f.types.model("SpreadsheetImportWizard",{fileType:f.types.optional(f.types.enumeration(de),"CSV"),hasColumnNameLine:!0,columnNameLineNumber:1,selectedAssemblyName:f.types.maybe(f.types.string)}).volatile((function(){return{fileTypes:de,fileSource:void 0,error:void 0,loading:!1}})).views((function(e){return{get isReadyToOpen(){return!e.error&&e.fileSource&&(e.fileSource.blobId||e.fileSource.localPath||e.fileSource.uri)},get canCancel(){return(0,f.getParent)(e).readyToDisplay},get fileName(){return e.fileSource.uri||e.fileSource.localPath||e.fileSource.blobId&&e.fileSource.name},get requiresUnzip(){return this.fileName.endsWith("gz")},isValidRefName:function(t,n){return(0,c.getSession)(e).assemblyManager.isValidRefName(t,n)}}})).actions((function(e){return{setSelectedAssemblyName:function(t){e.selectedAssemblyName=t},setFileSource:function(t){if(e.fileSource=t,e.error=void 0,e.fileSource){var n=e.fileName;if(n){var r=pe.exec(n);r&&r[1]&&("tsv"===r[1]&&n.includes("star-fusion")?e.fileType="STAR-Fusion":e.fileType=r[1].toUpperCase())}}},toggleHasColumnNameLine:function(){e.hasColumnNameLine=!e.hasColumnNameLine},setColumnNameLineNumber:function(t){t>0&&(e.columnNameLineNumber=t)},setFileType:function(t){e.fileType=t},setError:function(t){console.error(t),e.loading=!1,e.error=t},setLoaded:function(){e.loading=!1,e.error=void 0},cancelButton:function(){e.error=void 0,(0,f.getParent)(e).setDisplayMode()},import:function(t){var r=this;return(0,m.Z)(y().mark((function a(){var i,o,s,c,u,l,d;return y().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.fileSource){a.next=2;break}return a.abrupt("return");case 2:if(!e.loading){a.next=4;break}throw new Error("Cannot import, load already in progress");case 4:return e.selectedAssemblyName=t,e.loading=!0,i=e.fileType,a.next=9,fe[i]();case 9:if(o=a.sent){a.next=12;break}throw new Error("cannot open files of type '".concat(e.fileType,"'"));case 12:return a.next=14,Promise.resolve().then(n.bind(n,42098));case 14:return s=a.sent,c=s.unzip,u=(0,f.getEnv)(e),l=u.pluginManager,d=(0,ue.openLocation)(e.fileSource,l),a.prev=18,a.next=21,d.stat();case 21:if(!(a.sent.size>le)){a.next=24;break}throw new Error("File is too big. Tabular files are limited to at most ".concat(3e4.toLocaleString(),"kb."));case 24:a.next=29;break;case 26:a.prev=26,a.t0=a.catch(18),console.warn(a.t0);case 29:return a.next=31,d.readFile().then((function(t){return e.requiresUnzip?c(t):t})).then((function(t){return o(t,e)})).then((function(t){r.setLoaded(),(0,f.getParent)(e).displaySpreadsheet(t)}));case 31:case"end":return a.stop()}}),a,null,[[18,26]])})))()}}})),ge=f.types.model("RowFullTextFilter",{type:f.types.literal("RowFullText"),stringToFind:""}).views((function(e){return{get predicate(){var t=e.stringToFind;return t?(t=t.toLowerCase(),function(e,n){for(var r=n.cellsWithDerived,a=0;a<r.length;a+=1){var i=r[a];if(i.text&&i.text.toLowerCase().includes(t))return!0}return!1}):function(){return!0}}}})).actions((function(e){return{setString:function(t){e.stringToFind=t},clear:function(){e.stringToFind=""}}})),me=f.types.model("SpreadsheetFilterControls",{rowFullText:f.types.optional(ge,(function(){return{type:"RowFullText",stringToFind:""}})),columnFilters:f.types.array(re)}).views((function(e){return{get filters(){return[e.rowFullText].concat((0,w.Z)(e.columnFilters)).filter((function(e){return!!e}))},setRowFullTextFilter:function(t){e.rowFullText={type:"RowFullText",stringToFind:t}},rowPassesFilters:function(e,t){for(var n=0;n<this.filters.length;n+=1)if(!this.filters[n].predicate(e,t))return!1;return!0}}})).actions((function(e){return{addBlankColumnFilter:function(t){var n=(0,f.getParent)(e).spreadsheet.columns[t].dataType;e.columnFilters.push({type:n.type,columnNumber:t})},removeColumnFilter:function(t){return e.columnFilters.remove(t)},clearAllFilters:function(){e.columnFilters.clear(),e.rowFullText.clear()}}})),ve=[{label:"Toggle select",icon:g.Z,onClick:function(e,t){var n,r=null===(n=t.rowMenuPosition)||void 0===n?void 0:n.rowNumber;void 0!==r&&t.rowSet.rows[r-1].toggleSelect()}}],ye=f.types.model("SpreadsheetView",{type:f.types.literal("SpreadsheetView"),offsetPx:0,height:f.types.optional(f.types.refinement("SpreadsheetViewHeight",f.types.number,(function(e){return e>=40})),440),hideViewControls:!1,hideVerticalResizeHandle:!1,hideFilterControls:!1,filterControls:f.types.optional(me,(function(){return me.create({})})),mode:f.types.optional(f.types.enumeration("SpreadsheetViewMode",["import","display"]),"import"),importWizard:f.types.optional(he,(function(){return he.create()})),spreadsheet:f.types.maybe(ce)}).volatile((function(){return{width:400,rowMenuItems:ve}})).views((function(e){return{get readyToDisplay(){return!!e.spreadsheet&&e.spreadsheet.isLoaded},get hideRowSelection(){return!!(0,f.getEnv)(e).hideRowSelection},get outputRows(){if(e.spreadsheet&&e.spreadsheet.rowSet.isLoaded){var t=e.spreadsheet.rowSet.selectedFilteredRows;return t.length?t:e.spreadsheet.rowSet.sortedFilteredRows}},get assembly(){var t,n=null===(t=e.spreadsheet)||void 0===t?void 0:t.assemblyName;if(n){var r=(0,c.getSession)(e).assemblies;return null===r||void 0===r?void 0:r.find((function(e){return(0,h.readConfObject)(e,"name")===n}))}}}})).actions((function(e){return{setRowMenuItems:function(t){e.rowMenuItems=t},setWidth:function(t){return e.width=t,e.width},setHeight:function(t){return e.height=t>40?t:40,e.height},resizeHeight:function(t){var n=e.height;return this.setHeight(e.height+t)-n},resizeWidth:function(t){var n=e.width;return this.setWidth(e.width+t)-n},displaySpreadsheet:function(t){e.filterControls.clearAllFilters(),e.spreadsheet=(0,f.cast)(t),e.mode="display"},setImportMode:function(){e.mode="import"},setDisplayMode:function(){e.readyToDisplay&&(e.mode="display")},closeView:function(){(0,f.getParent)(e,2).removeView(e)}}})),be=f.types.compose(p.BaseViewModel,ye),xe=function(e){(0,i.Z)(u,e);var t=(0,o.Z)(u);function u(){var e;(0,r.Z)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="SpreadsheetViewPlugin",e}return(0,a.Z)(u,[{key:"install",value:function(e){e.addViewType((function(){return new d.Z({name:"SpreadsheetView",stateModel:be,ReactComponent:(0,s.lazy)((function(){return n.e(8613).then(n.bind(n,68613))}))})}))}},{key:"configure",value:function(e){(0,c.isAbstractMenuManager)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"Spreadsheet view",icon:l.Z,onClick:function(e){e.addView("SpreadsheetView",{})}})}}]),u}(u.Z)},63328:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(49767),c=n(8438),u=n(72002),l=n(52477),d=n(37574),f=function(e){var t=e.jbrequire,n=t("mobx-react"),r=n.observer,a=(n.PropTypes,t("react"),t("@material-ui/core/IconButton")),i=t("@material-ui/core/styles").makeStyles,o=t("@material-ui/core/Grid"),s=t("@material-ui/core/FormControlLabel"),c=t("@material-ui/core/Checkbox"),u=t("@jbrowse/core/ui").ResizeHandle,f=t("@material-ui/core/colors").grey,p={width:4,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"},h=i((function(e){return{root:{marginBottom:e.spacing(1),background:"white",overflow:"hidden"},header:{overflow:"hidden",whiteSpace:"nowrap",boxSizing:"border-box",height:52,background:f[200]},viewControls:{margin:0},viewsContainer:{display:"flex"},spreadsheetViewContainer:{borderRight:[["1px","solid",f[400]]],overflow:"hidden"},circularViewOptions:{padding:e.spacing(1),background:f[200]}}})),g=r((function(e){var t=e.model,n=h();return(0,d.jsx)(o,{className:n.viewControls,container:!0,spacing:1,direction:"row",alignItems:"center",children:(0,d.jsx)(o,{item:!0,children:(0,d.jsx)(a,{onClick:function(){return t.setImportMode()},className:n.iconButton,title:"open a tabular file","data-testid":"sv_inspector_view_open",color:"secondary",children:(0,d.jsx)(l.Z,{})})})})})),m=r((function(e){var t=e.svInspector,n=h();return(0,d.jsx)(o,{container:!0,className:n.circularViewOptions,style:{height:t.circularViewOptionsBarHeight},children:(0,d.jsx)(o,{item:!0,children:(0,d.jsx)(s,{control:(0,d.jsx)(c,{className:n.rowSelector,checked:t.onlyDisplayRelevantRegionsInCircularView,onClick:function(e){return t.setOnlyDisplayRelevantRegionsInCircularView(e.target.checked)}}),label:"show only regions with data"})})})}));return r((function(e){var t=e.model,n=h(),r=t.resizeHeight,a=t.dragHandleHeight,i=t.SpreadsheetViewReactComponent,s=t.CircularViewReactComponent,c=t.showCircularView;return(0,d.jsxs)("div",{className:n.root,"data-testid":t.id,children:[(0,d.jsx)(o,{container:!0,direction:"row",className:n.header,children:(0,d.jsx)(o,{item:!0,children:(0,d.jsx)(g,{model:t})})}),(0,d.jsxs)("div",{className:n.viewsContainer,children:[(0,d.jsx)("div",{className:n.spreadsheetViewContainer,children:(0,d.jsx)(i,{model:t.spreadsheetView})}),c?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{onDrag:function(e){var n=t.circularView.resizeWidth(-e);return t.spreadsheetView.resizeWidth(-n)},vertical:!0,flexbox:!0,style:p}),(0,d.jsxs)("div",{className:n.circularViewContainer,style:{width:t.circularView.width},children:[(0,d.jsx)(m,{svInspector:t}),(0,d.jsx)(s,{model:t.circularView})]})]}):null]}),(0,d.jsx)(u,{onDrag:r,style:{height:a,background:"#ccc",boxSizing:"border-box",borderTop:"1px solid #fafafa"}})]})}))},p=n(34795),h=n(77162),g=n.n(h),m=n(67897),v=n(81073),y=n(35247),b=n(9077),x=n(40909),w=n(59853),k=n(14956),C=n(33028);function Z(e,t,n,r,a,i){var o={};return e.forEach((function(e,r){if(!t.includes(r)){var a=n.cells[r].text;"Number"===e.dataType.type&&(a=parseFloat(a)),o[e.name]=a}})),(0,C.Z)((0,C.Z)({},o),{},{uniqueId:"sv-inspector-adhoc-".concat(i),refName:r.refName,start:r.start,end:r.end,mate:{refName:a.refName,start:a.start,end:a.end}})}function S(e,t,n,r){var a=e.columns,i=e.columnDisplayOrder,o={};i.forEach((function(e){var t=a[e];o[t.dataType.type]||(o[t.dataType.type]=[]),o[t.dataType.type].push(e)}));var s=o.LocString||[],c=o.LocStart||[],u=o.LocEnd||[],l=o.LocRef||[];return s.length>=2?function(e,t,n,r,a){var i=(0,v.parseLocString)(n.cells[t[0]].text,a),o=(0,v.parseLocString)(n.cells[t[1]].text,a);return Z(e,[t[0],t[1]],n,i,o,r)}(a,s,n,t,r):l.length>=2&&c.length>=2&&u.length>=2?function(e,t,n,r,a,i){var o=function(e){return a.cells[e].text},s={refName:o(t[0]),start:parseInt(o(n[0]),10)-1,end:parseInt(o(r[0]),10)},c={refName:o(t[1]),start:parseInt(o(n[1]),10)-1,end:parseInt(o(r[1]),10)};return Z(e,[t[0],n[0],r[0],t[1],n[1],r[1]],a,s,c,i)}(a,l,c,u,n,t):void 0}function T(e,t,n,r){if(n.extendedData){if(n.extendedData.vcfFeature)return n.extendedData.vcfFeature;if(n.extendedData.feature)return n.extendedData.feature}var a=S(t.spreadsheet,r,n,e.assemblyManager.isValidRefName);if(a)return a}function P(e,t,n,r,a){var i=(0,x.getEnv)(e).pluginManager,o=(0,v.getSession)(t),s=T(o,n,r,a);if(s){var c=new k.Z(s);o.setSelection(c);var u=i.getViewType("BreakpointSplitView"),l=e.circularView;return u.snapshotFromBreakendFeature(c,l)}}function R(e,t,n){var r=(0,v.getSession)(t);r.setSelection(e);var a=(0,v.getContainingView)(t),i=n.getViewType("BreakpointSplitView").snapshotFromBreakendFeature(e,a);i.views[0].offsetPx-=a.width/2+100,i.views[1].offsetPx-=a.width/2+100,i.featureData=e.data,r.addView("BreakpointSplitView",i)}var M=function(e){var t=e.getViewType("SpreadsheetView"),n=e.getViewType("CircularView"),r=x.types.model("SvInspectorView",{type:x.types.literal("SvInspectorView"),dragHandleHeight:4,height:x.types.optional(x.types.refinement("SvInspectorViewHeight",x.types.number,(function(e){return e>=400})),500),onlyDisplayRelevantRegionsInCircularView:!1,mode:x.types.optional(x.types.enumeration("SvInspectorViewMode",["import","display"]),"import"),spreadsheetView:x.types.optional(t.stateModel,(function(){return t.stateModel.create({type:"SpreadsheetView",hideViewControls:!0,hideVerticalResizeHandle:!0})})),circularView:x.types.optional(n.stateModel,(function(){return n.stateModel.create({type:"CircularView",hideVerticalResizeHandle:!0,hideTrackSelectorButton:!0,disableImportForm:!0})}))}).volatile((function(){return{width:800}})).views((function(t){return{get selectedRows(){return t.spreadsheetView.rowSet.selectedRows},get assemblyName(){var e=t.spreadsheetView.assembly;if(e)return(0,b.readConfObject)(e,"name")},get showCircularView(){return"display"===t.spreadsheetView.mode},get featuresAdapterConfigSnapshot(){var e=(0,v.getSession)(t);return{type:"FromConfigAdapter",features:(t.spreadsheetView.outputRows||[]).map((function(n,r){return T(e,t.spreadsheetView,n,r)})).filter((function(e){return Boolean(e)}))}},get featuresRefNamesP(){return new(0,e.getAdapterType("FromConfigAdapter").AdapterClass)(t.featuresAdapterConfigSnapshot).getRefNames()},get featuresCircularTrackConfiguration(){return e.jexl.addFunction("defaultOnChordClick",R),{type:"VariantTrack",trackId:"sv-inspector-variant-track-".concat(t.id),name:"features from tabular data",adapter:t.featuresAdapterConfigSnapshot,assemblyNames:[t.assemblyName],displays:[{type:"ChordVariantDisplay",displayId:"sv-inspector-variant-track-chord-display-".concat(t.id),onChordClick:"jexl:defaultOnChordClick(feature, track, pluginManager)",renderer:{type:"StructuralVariantChordRenderer"}}]}}}})).volatile((function(){return{SpreadsheetViewReactComponent:t.ReactComponent,CircularViewReactComponent:n.ReactComponent,circularViewOptionsBarHeight:52}})).actions((function(e){return{afterAttach:function(){(0,x.addDisposer)(e,(0,y.autorun)((function(){if(e.showCircularView){var t=Math.round(.66*e.width),n=e.width-t;e.spreadsheetView.setWidth(t-1),e.circularView.setWidth(n)}else e.spreadsheetView.setWidth(e.width)}),{name:"SvInspectorView width binding"})),(0,x.addDisposer)(e,(0,y.autorun)((function(){e.spreadsheetView.setHeight(e.height-52),e.circularView.setHeight(e.height-52-52)}),{name:"SvInspectorView height binding"})),(0,x.addDisposer)(e,(0,y.autorun)((0,p.Z)(g().mark((function t(){var n,r,a,i,o,s,c,u,l,d;return g().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.assemblyName,r=e.onlyDisplayRelevantRegionsInCircularView,a=e.circularView,i=e.featuresRefNamesP,o=a.tracks,s=(0,v.getSession)(e),!n){t.next=8;break}return t.next=6,s.assemblyManager.waitForAssembly(n);case 6:(c=t.sent)?(u=c.getCanonicalRefName,l=c.regions,d=void 0===l?[]:l,r?1===o.length&&i.then((function(e){var t=new Set(e.map((function(e){return u(e)||e}))),n=d.filter((function(e){return t.has(e.refName)}));a.setDisplayedRegions(JSON.parse(JSON.stringify(n)))})).catch((function(e){return a.setError(e)})):a.setDisplayedRegions(d)):a.setDisplayedRegions([]);case 8:case"end":return t.stop()}}),t)}))),{name:"SvInspectorView displayed regions bind"})),(0,x.addDisposer)(e,(0,y.reaction)((function(){return{generatedTrackConf:e&&e.featuresCircularTrackConfiguration,assemblyName:e&&e.assemblyName}}),(function(t){if(t){var n=t.assemblyName,r=t.generatedTrackConf;e.circularView.tracks.length&&e.circularView.tracks.forEach((function(t){e.circularView.hideTrack(t.configuration.trackId)})),n&&r&&e.circularView.addTrackConf(r,{assemblyName:n})}}),{name:"SvInspectorView track configuration binding",fireImmediately:!0})),(0,x.addDisposer)(e,(0,y.autorun)((function(){e.spreadsheetView.setRowMenuItems([{label:"Open split detail view",icon:m.Z,disabled:function(t,n,r,a){return!function(e,t,n,r,a){try{var i=P(e,t,n,r,a);return Boolean(i)}catch(o){return console.error("Unable to open breakpoint split view from table row",o),!1}}(e,t,n,a,r)},onClick:function(t,n,r,a){!function(e,t,n,r,a){var i=P(e,t,n,r,a);if(i){var o=e.circularView;i.views[0].offsetPx-=o.width/2+100,i.views[1].offsetPx-=o.width/2+100,(0,v.getSession)(t).addView("BreakpointSplitView",i)}}(e,t,n,a,r)}}])})))},setWidth:function(t){e.width=t},setHeight:function(t){return e.height=t>400?t:400,e.height},resizeHeight:function(t){var n=e.height;return e.setHeight(e.height+t)-n},setImportMode:function(){e.spreadsheetView.setImportMode()},setDisplayMode:function(){e.spreadsheetView.setDisplayMode()},closeView:function(){(0,x.getParent)(e,2).removeView(e)},setDisplayedRegions:function(t){e.circularView.setDisplayedRegions(t)},setOnlyDisplayRelevantRegionsInCircularView:function(t){e.onlyDisplayRelevantRegionsInCircularView=Boolean(t)}}}));return{stateModel:x.types.compose(w.BaseViewModel,r)}},j=function(e){var t=e.jbrequire,n=t("@jbrowse/core/pluggableElementTypes/ViewType"),r=t(f);return new n({name:"SvInspectorView",stateModel:t(M).stateModel,ReactComponent:r})},A=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="SvInspectorViewPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addViewType((function(){return e.jbrequire(j)}))}},{key:"configure",value:function(e){(0,c.J0)(e.rootModel)&&e.rootModel.appendToSubMenu(["Add"],{label:"SV inspector",icon:u.Z,onClick:function(e){e.addView("SvInspectorView",{})}})}}]),n}(s.Z)},52044:function(e,t,n){"use strict";n.d(t,{ZP:function(){return _}});var r=n(87371),a=n(9249),i=n(45754),o=n(86906),s=n(21339),c=n(49767),u=n(96234),l=n(68079),d=n(33028),f=n(30969),p=n(90550),h=n(9077),g=n(81073),m=n(41472),v=n(40909),y=n(37574),b=(0,p.observer)((function(e){var t=e.text,n=e.x,r=e.y,a=e.region,i=e.reversed,o=e.bpPerPx,s=e.feature,c=e.viewParams,u=e.color,l=void 0===u?"black":u,d=e.fontHeight,f=void 0===d?13:d,p=e.featureWidth,h=void 0===p?0:p,m=e.allowedWidthExpansion,b=void 0===m?0:m,x=e.displayModel,w=void 0===x?{}:x,k=h+b,C=(0,g.measureText)(t,f),Z=(0,v.isStateTreeNode)(w)?(0,g.getViewParams)(w):c,S=i?Z.end:Z.start,T=a.start,P=a.end,R=s.get("start"),M=s.get("end"),j=C*o;return S<P&&S>T&&R<S&&S+j<M?n=Z.offsetPx:R<S&&S+j<M&&(n=Z.offsetPx1),(0,y.jsx)("text",{x:n,y:r+f,fill:l,fontSize:f,children:C>k?"".concat(t.slice(0,k/(.6*f)),"..."):t})}));var x=(0,p.observer)((function(e){var t,n,r,a,i=e.feature,o=e.rootLayout,s=e.config,c=e.name,u=e.description,l=e.shouldShowName,f=e.shouldShowDescription,p=o.getSubRecord(String(i.id()));if(!p)return null;var g=(p.data||{}).GlyphComponent;return(0,y.jsxs)("g",{children:[(0,y.jsx)(g,(0,d.Z)({featureLayout:p},e)),l?(0,y.jsx)(b,(0,d.Z)({text:c,x:(null===(t=o.getSubRecord("nameLabel"))||void 0===t?void 0:t.absolute.left)||0,y:(null===(n=o.getSubRecord("nameLabel"))||void 0===n?void 0:n.absolute.top)||0,color:(0,h.readConfObject)(s,["labels","nameColor"],{feature:i}),featureWidth:p.width},e)):null,f?(0,y.jsx)(b,(0,d.Z)({text:u,x:(null===(r=o.getSubRecord("descriptionLabel"))||void 0===r?void 0:r.absolute.left)||0,y:(null===(a=o.getSubRecord("descriptionLabel"))||void 0===a?void 0:a.absolute.top)||0,color:(0,h.readConfObject)(s,["labels","descriptionColor"],{feature:i}),featureWidth:p.width},e)):null]})})),w=n(59740),k=["rect","region","bpPerPx"],C=["displayModel","blockKey","region","bpPerPx","movedDuringLastMouseDown"];function Z(e){var t=e.rect,n=e.region,r=e.bpPerPx,a=(0,w.Z)(e,k);if(!t)return null;var i=(0,u.Z)(t,4),o=i[0],s=i[1],c=i[2],l=i[3],f=(0,g.bpSpanPx)(o,c,n,r),p=(0,u.Z)(f,2),h=p[0],m=p[1],v=Math.round(s),b=(n.end-n.start)/r,x=Math.round(l-s),C=m-h;if(h+C<0)return null;var Z=Math.max(h,0),S=Z-h,T=Math.max(1,Math.min(C-S,b));return(0,y.jsx)("rect",(0,d.Z)({x:Z-2,y:v-2,width:T+4,height:x+4},a))}var S=(0,p.observer)((function(e){var t,n,r=e.displayModel,a=void 0===r?{}:r,i=e.blockKey,o=e.region,s=e.bpPerPx,c=e.movedDuringLastMouseDown,u=(0,w.Z)(e,C),l=a.selectedFeatureId,d=a.featureIdUnderMouse,f=a.contextMenuFeature,p=d||(null===f||void 0===f?void 0:f.id());function h(e){var t=u.onFeatureMouseOut;if(t&&p)return t(e,p)}function g(e){var t=u.onFeatureMouseOver;if(t&&p)return t(e,p)}return(0,y.jsxs)(y.Fragment,{children:[p?(0,y.jsx)(Z,{rect:null===(t=a.getFeatureByID)||void 0===t?void 0:t.call(a,i,p),region:o,bpPerPx:s,fill:"#000",fillOpacity:"0.2",onMouseDown:function(e){var t=u.onFeatureMouseDown;if(t&&p)return t(e,p)},onMouseEnter:function(e){var t=u.onFeatureMouseEnter;if(t&&p)return t(e,p)},onMouseOut:h,onMouseOver:g,onMouseUp:function(e){var t=u.onFeatureMouseUp;if(t&&p)return t(e,p)},onMouseLeave:function(e){var t=u.onFeatureMouseLeave;if(t&&p)return t(e,p)},onMouseMove:function(e){var t=u.onFeatureMouseMove;if(t&&p)return t(e,p)},onClick:function(e){if(!c){var t=u.onFeatureClick;if(t&&p)return e.stopPropagation(),t(e,p)}},onContextMenu:function(e){var t=u.onFeatureContextMenu;if(t&&p)return t(e,p)},onFocus:g,onBlur:h,"data-testid":p}):null,l?(0,y.jsx)(Z,{rect:null===(n=a.getFeatureByID)||void 0===n?void 0:n.call(a,i,l),region:o,bpPerPx:s,stroke:"#00b8ff",fill:"none"}):null]})})),T=(0,p.observer)((function(e){var t=e.feature,n=e.featureLayout,r=e.config,a=e.region,i=t.get("strand"),o=a.reversed?-1:1,s=7*i*o,c=n.absolute,u=c.left,l=void 0===u?0:u,d=c.top,f=void 0===d?0:d,p=c.width,g=void 0===p?0:p,m=c.height,v=void 0===m?0:m,b=(0,h.readConfObject)(r,"color2",{feature:t}),x=i*o===-1?l:i*o===1?l+g:null,w=f+v/2;return x?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("line",{x1:x,x2:x+s,y1:w,y2:w,stroke:b}),(0,y.jsx)("polygon",{points:[[x+s/2,w-2.5],[x+s/2,w+2.5],[x+s,w]].toString(),stroke:b})]}):null}));var P=(0,p.observer)((function(e){var t=e.feature,n=e.region,r=e.config,a=e.featureLayout,i=e.bpPerPx,o=e.topLevel,s=n.start,c=(n.end-s)/i,u=(t.get("end")-t.get("start"))/i,l=a.absolute.left,f=void 0===l?0:l,p=a.absolute,g=p.top,m=void 0===g?0:g,v=p.height,b=void 0===v?0:v;if(f+u<0)return null;O(t)&&(m+=.175*b,b*=.65);var x=Math.max(f,0),w=x-f,k=Math.max(2,Math.min(u-w,c));return t.parent()&&"intron"===t.get("type")?null:(0,y.jsxs)(y.Fragment,{children:[o?(0,y.jsx)(T,(0,d.Z)({},e)):null,(0,y.jsx)("rect",{"data-testid":"box-".concat(t.id()),x:x,y:m,width:k,height:b,fill:O(t)?(0,h.readConfObject)(r,"color3",{feature:t}):(0,h.readConfObject)(r,"color1",{feature:t}),stroke:(0,h.readConfObject)(r,"outline",{feature:t})})]})}));var R=(0,p.observer)((function(e){var t=e.feature,n=e.featureLayout,r=e.selected,a=e.config,i=e.subfeatures,o=void 0===i?t.get("subfeatures"):i,s=(0,h.readConfObject)(a,"color2",{feature:t}),c=n.absolute,u=c.left,l=void 0===u?0:u,f=c.top,p=void 0===f?0:f,g=c.width,m=void 0===g?0:g,v=c.height,b=p+(void 0===v?0:v)/2;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("line",{"data-testid":t.id(),x1:l,y1:b,y2:b,x2:l+m,stroke:s}),null===o||void 0===o?void 0:o.map((function(t){var a=String(t.id()),i=n.getSubRecord(a);if(!i)return null;var o=(i.data||{}).GlyphComponent;return(0,y.jsx)(o,(0,d.Z)((0,d.Z)({},e),{},{feature:t,topLevel:!1,featureLayout:i,selected:r}),"glyph-".concat(a))})),(0,y.jsx)(T,(0,d.Z)({},e))]})}));function M(e){var t=N(e.feature,e.config);return(0,y.jsx)(R,(0,d.Z)((0,d.Z)({},e),{},{subfeatures:t}))}function j(e,t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"subParts",t=arguments.length>1?arguments[1]:void 0,n=(0,h.readConfObject)(t,e);return"string"==typeof n&&(n=n.split(/\s*,\s*/)),function(e){return n.map((function(e){return e.toLowerCase()})).includes(e.get("type").toLowerCase())}}("subParts",t)(e)}function A(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function N(e,t){var n=e.get("subfeatures");if(!n||!n.length)return[];var r=!!n.find((function(e){return A(e)})),a=["mRNA","transcript"].includes(e.get("type"));return(!r&&a||(0,h.readConfObject)(t,"impliedUTRs"))&&(n=function(e,t){for(var n,r,a=(0,l.Z)(t),i=1/0,o=-1/0,s=[],c=0;c<a.length;c++){var u=a[c].get("type");/^cds/i.test(u)?(i>a[c].get("start")&&(i=a[c].get("start")),o<a[c].get("end")&&(o=a[c].get("end"))):/exon/i.test(u)?s.push(a[c]):A(a[c])&&(n=a[c].get("start")===e.get("start"),r=a[c].get("end")===e.get("end"))}if(!(s.length&&i<1/0&&o>-1/0))return a;s.sort((function(e,t){return e.get("start")-t.get("start")}));var d,f,p=e.get("strand");if(!n)for(var h=0;h<s.length&&!((d=s[h].get("start"))>=i);h++){f=i>s[h].get("end")?s[h].get("end"):i;var m=p>=0?"five_prime_UTR":"three_prime_UTR";a.unshift(new g.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(m,"_").concat(h),data:{start:d,end:f,strand:p,type:m}}))}if(!r)for(var v=s.length-1;v>=0&&!((f=s[v].get("end"))<=o);v--){d=o<s[v].get("start")?s[v].get("start"):o;var y=p>=0?"three_prime_UTR":"five_prime_UTR";a.push(new g.SimpleFeature({parent:e,id:"".concat(e.id(),"_").concat(y,"_").concat(v),data:{start:d,end:f,strand:p,type:y}}))}return a}(e,n)),n.filter((function(e){return j(e,t)}))}M.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=E({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o});return V({layout:s,subfeatures:N(n,i),bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),s};var L=(0,p.observer)(M);function F(e){var t,n=e.feature,r=e.featureLayout,a=e.selected;return(0,y.jsx)(y.Fragment,{children:null===(t=n.get("subfeatures"))||void 0===t?void 0:t.map((function(t){var n=String(t.id()),i=r.getSubRecord(n);if(!i)return null;var o=(i.data||{}).GlyphComponent;return(0,y.jsx)(o,(0,d.Z)((0,d.Z)({},e),{},{feature:t,featureLayout:i,selected:a}),"glyph-".concat(n))}))})}F.layOut=function(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=E({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),c=(0,h.readConfObject)(i,"displayMode");if("reducedRepresentation"!==c){var u,l=0;null===(u=n.get("subfeatures"))||void 0===u||u.forEach((function(e){var t=B(e,o),n=(0,h.readConfObject)(i,"height",{feature:e});(t.layOut||D)({layout:s,feature:e,bpPerPx:r,reversed:a,config:i,extraGlyphs:o}).move(0,l),l+="collapse"===c?0:("compact"===c?n/3:n)+2}))}return s};var I=(0,p.observer)(F);function B(e,t){var n,r=e.get("type"),a=e.get("subfeatures");if(a&&"CDS"!==r){var i=a.find((function(e){return!!e.get("subfeatures")}));return["mRNA","transcript","primary_transcript"].includes(r)&&a.find((function(e){return"CDS"===e.get("type")}))?L:!e.parent()&&i?I:R}return(null===t||void 0===t||null===(n=t.find((function(t){return t.validator(e)})))||void 0===n?void 0:n.glyph)||P}function D(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=(0,h.readConfObject)(i,"displayMode"),c=E({layout:t,feature:n,bpPerPx:r,reversed:a,config:i,extraGlyphs:o});return"reducedRepresentation"!==s&&V({layout:c,subfeatures:n.get("subfeatures")||[],bpPerPx:r,reversed:a,config:i,extraGlyphs:o}),c}function E(e){var t=e.layout,n=e.feature,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs,s=(0,h.readConfObject)(i,"displayMode"),c="reducedRepresentation"===s?P:B(n,o),u=n.parent(),l=0;u&&(l=(a?u.get("end")-n.get("end"):n.get("start")-u.get("start"))/r);var d=(0,h.readConfObject)(i,"height",{feature:n}),f=(n.get("end")-n.get("start"))/r,p=t.parent,g=p?p.top:0;return t.addChild(String(n.id()),l,"collapse"===s?0:g,Math.max(f,1),"compact"===s?d/2:d,{GlyphComponent:c})}function V(e){var t=e.layout,n=e.subfeatures,r=e.bpPerPx,a=e.reversed,i=e.config,o=e.extraGlyphs;n.forEach((function(e){(B(e,o).layOut||D)({layout:t,feature:e,bpPerPx:r,reversed:a,config:i,extraGlyphs:o})}))}function O(e){return/(\bUTR|_UTR|untranslated[_\s]region)\b/.test(e.get("type")||"")}function z(e){var t=e.feature,n=e.bpPerPx,r=e.region,a=e.config,i=e.displayMode,o=e.layout,s=e.extraGlyphs,c=r.reversed,u=t.get(c?"end":"start"),l=(0,g.bpToPx)(u,r,n),f="compact"!==i&&"collapsed"!==i,p=new m.SceneGraph("root",0,0,0,0),v=(B(t,s).layOut||D)({layout:p,feature:t,bpPerPx:n,reversed:c,config:a,extraGlyphs:s}),b=!1,w=!1,k="",C="",Z=0,S=0;if(f){var T=(0,h.readConfObject)(a,"showLabels"),P=(0,h.readConfObject)(a,"showDescriptions");Z=(0,h.readConfObject)(a,["labels","fontSize"],{feature:t}),S=(0,h.readConfObject)(a,"maxFeatureGlyphExpansion")||0,k=String((0,h.readConfObject)(a,["labels","name"],{feature:t})||""),b=/\S/.test(k)&&T;var R=function(e){var t=p.width+S,n=(0,g.measureText)(e,Z);return Math.round(Math.min(n,t))+2};if(C=String((0,h.readConfObject)(a,["labels","description"],{feature:t})||""),w=/\S/.test(C)&&T&&P,b&&p.addChild("nameLabel",0,v.bottom+2,R(k),Z),w){var M=b?p.getSubRecord("nameLabel"):v;p.addChild("descriptionLabel",0,M.bottom+2,R(C),Z)}}var j=o.addRect(t.id(),t.get("start"),t.get("start")+p.width*n,p.height);return null===j?null:(p.move(l,j),(0,y.jsx)(x,(0,d.Z)({rootLayout:p,name:k,shouldShowName:b,description:C,shouldShowDescription:w,fontHeight:Z,allowedWidthExpansion:S,reversed:r.reversed,topLevel:!0},e)))}var W=(0,p.observer)((function(e){var t=e.features,n=void 0===t?new Map:t,r=e.isFeatureDisplayed;return(0,y.jsx)(y.Fragment,{children:(0,l.Z)(n.values()).filter((function(e){return r(e)})).map((function(t){return(0,y.jsx)(z,(0,d.Z)({feature:t},e),t.id())}))})}));var H=(0,p.observer)((function(e){var t=e.layout,n=e.blockKey,r=e.regions,a=e.bpPerPx,i=e.config,o=e.displayModel,s=void 0===o?{}:o,c=e.exportSVG,l=e.featureDisplayHandler,p=void 0===l?function(){return!0}:l,g=e.onMouseOut,m=e.onMouseDown,v=e.onMouseLeave,b=e.onMouseEnter,x=e.onMouseOver,w=e.onMouseMove,k=e.onMouseUp,C=e.onClick,Z=r||[],T=(0,u.Z)(Z,1)[0],P=(T.end-T.start)/a,R=(0,h.readConfObject)(i,"displayMode"),M=(0,f.useRef)(null),j=(0,f.useState)(!1),A=(0,u.Z)(j,2),N=A[0],L=A[1],F=(0,f.useState)(0),I=(0,u.Z)(F,2),B=I[0],D=I[1],E=(0,f.useState)(!1),V=(0,u.Z)(E,2),O=V[0],z=V[1],H=(0,f.useCallback)((function(e){return L(!0),z(!1),null===m||void 0===m?void 0:m(e)}),[m]),q=(0,f.useCallback)((function(e){return L(!1),null===k||void 0===k?void 0:k(e)}),[k]),U=(0,f.useCallback)((function(e){var t;if(M.current){N&&z(!0);var r=M.current.getBoundingClientRect(),i=r.left,o=r.top,c=e.clientX-i,u=e.clientY-o,l=T.reversed?P-c:c,d=T.start+a*l,f=null===(t=s.getFeatureOverlapping)||void 0===t?void 0:t.call(s,n,d,u);w&&w(e,f)}}),[n,a,N,w,T.reversed,T.start,s,P]),_=(0,f.useCallback)((function(e){O||null===C||void 0===C||C(e)}),[O,C]);return(0,f.useEffect)((function(){D(t.getTotalHeight())}),[t]),c?(0,y.jsx)(W,(0,d.Z)({displayMode:R,isFeatureDisplayed:p,region:T},e)):(0,y.jsxs)("svg",{ref:M,"data-testid":"svgfeatures",width:P,height:B+100,onMouseDown:H,onMouseUp:q,onMouseEnter:b,onMouseLeave:v,onMouseOver:x,onMouseOut:g,onMouseMove:U,onClick:_,children:[(0,y.jsx)(W,(0,d.Z)({displayMode:R,region:T,movedDuringLastMouseDown:O,isFeatureDisplayed:p},e)),(0,y.jsx)(S,(0,d.Z)((0,d.Z)({},e),{},{region:T,movedDuringLastMouseDown:O}))]})})),q=(0,h.ConfigurationSchema)("SvgFeatureRenderer",{color1:{type:"color",description:"the main color of each feature",defaultValue:"goldenrod",contextVariable:["feature"]},color2:{type:"color",description:"the secondary color of each feature, used for connecting lines, etc",defaultValue:"black",contextVariable:["feature"]},color3:{type:"color",description:"the tertiary color of each feature, often used for contrasting fills, like on UTRs",defaultValue:"#357089",contextVariable:["feature"]},outline:{type:"color",description:"the outline for features",defaultValue:"",contextVariable:["feature"]},height:{type:"number",description:"height in pixels of the main body of each feature",defaultValue:10,contextVariable:["feature"]},showLabels:{type:"boolean",defaultValue:!0},showDescriptions:{type:"boolean",defaultValue:!0},labels:(0,h.ConfigurationSchema)("SvgFeatureLabels",{name:{type:"string",description:"the primary name of the feature to show, if space is available",defaultValue:"jexl:get(feature,'name') || get(feature,'id')",contextVariable:["feature"]},nameColor:{type:"color",description:"the color of the name label, if shown",defaultValue:"black",contextVariable:["feature"]},description:{type:"string",description:"the text description to show, if space is available",defaultValue:"jexl:get(feature,'note') || get(feature,'description')",contextVariable:["feature"]},descriptionColor:{type:"color",description:"the color of the description, if shown",defaultValue:"blue",contextVariable:["feature"]},fontSize:{type:"number",description:"height in pixels of the text to use for names and descriptions",defaultValue:13,contextVariable:["feature"]}}),displayMode:{type:"stringEnum",model:v.types.enumeration("displayMode",["normal","compact","reducedRepresentation","collapse"]),description:"Alternative display modes",defaultValue:"normal"},maxFeatureGlyphExpansion:{type:"number",description:"maximum number of pixels on each side of a feature's bounding coordinates that a glyph is allowed to use",defaultValue:500},maxHeight:{type:"integer",description:"the maximum height to be used in a svg rendering",defaultValue:600},subParts:{type:"string",description:"subparts for a glyph",defaultValue:"CDS,UTR,five_prime_UTR,three_prime_UTR"},impliedUTRs:{type:"boolean",description:"imply UTR from the exon and CDS differences",defaultValue:!1}},{explicitlyTyped:!0}),U=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,r.Z)(n)}(s.default),_=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="SVGPlugin",e}return(0,r.Z)(n,[{key:"install",value:function(e){e.addRendererType((function(){return new U({name:"SvgFeatureRenderer",ReactComponent:H,configSchema:q,pluginManager:e})}))}}]),n}(c.Z)},29145:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(58096),u=n(49767),l=n(9077),d=n(59853),f=n(81073),p=n(40909),h=(0,l.ConfigurationSchema)("TheTrackHubRegistryConnection",{trackDbId:{type:"string",defaultValue:"",description:"id of the trackDb in The Track Hub Registry"}},{baseConfiguration:d.baseConnectionConfig}),g=n(97891);function m(e,t,n){var r=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.members)return Object.values(t.members).map((function(r){return e(r,t.shortLabel?n.concat([t.shortLabel]):n)})).flat();return t.categories=n,[t]}({members:e._source.configuration});return r.map((function(r){var a=function(e,t,n){var r=e.type.split(" ")[0].toLowerCase();"bam"===r&&e.bigDataUrl.toLowerCase().endsWith("cram")&&(r="cram");var a,i=e.bigDataUrl,o={uri:new URL(i,t).href,locationType:"UriLocation"},s=e.categories;switch(r){case"bam":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href,locationType:"UriLocation"}:e.bigDataIndex?{localPath:e.bigDataIndex,locationType:"LocalPathLocation"}:{localPath:"".concat(e.bigDataUrl,".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:s,adapter:{type:"BamAdapter",bamLocation:o,index:{location:a}}};case"bed":case"bed5floatscore":case"bedgraph":case"bedrnaelements":case"bigbarchart":case"bigchain":case"biginteract":case"bigmaf":case"bigpsl":case"broadpeak":case"coloredexon":case"gvf":case"ld2":case"narrowpeak":case"peptidemapping":case"vcftabix":case"wig":case"wigmaf":return(0,g.generateUnsupportedTrackConf)(e.shortLabel,r,s);case"bigbed":return{type:"FeatureTrack",name:e.shortLabel,description:e.longLabel,category:s,adapter:{type:"BigBedAdapter",bigBedLocation:o}};case"bigwig":return{type:"QuantitativeTrack",name:e.shortLabel,description:e.longLabel,category:s,adapter:{type:"BigWigAdapter",bigWigLocation:o}};case"cram":return a=t?e.bigDataIndex?{uri:new URL(e.bigDataIndex,t).href,locationType:"UriLocation"}:{uri:new URL("".concat(e.bigDataUrl,".bai"),t).href,locationType:"UriLocation"}:e.bigDataIndex?{localPath:e.bigDataIndex,locationType:"LocalPathLocation"}:{localPath:"".concat(e.bigDataUrl,".bai"),locationType:"LocalPathLocation"},{type:"AlignmentsTrack",name:e.shortLabel,description:e.longLabel,category:s,adapter:{type:"CramAdapter",bamLocation:o,index:{location:a},sequenceAdapter:n}};default:throw new Error("Unsupported track type: ".concat(r))}}(r,e._source.hub.url,n);return a.trackId="trackhub-registry-".concat((0,f.objectHash)(a)),a.assemblyNames=[t],a}))}function v(e){return p.types.compose("TheTrackHubRegistryConnection",(0,d.BaseConnectionModelFactory)(e),p.types.model({type:p.types.literal("TheTrackHubRegistryConnection"),configuration:(0,l.ConfigurationReference)(h)}).actions((function(e){return{connect:function(t){e.clear();var n=(0,l.readConfObject)(t,"trackDbId");fetch("https://www.trackhubregistry.org/api/search/trackdb/".concat(n)).then((function(e){return e.json()})).then((function(t){var n=t._source.assembly.name,r=(0,f.getSession)(e).assemblyManager.get(n).configuration,a=(0,l.readConfObject)(r,["sequence","adapter"]);e.setTrackConfs(m(t,n,a))})).catch((function(e){console.error(e)}))}}})))}var y=function(e){(0,i.Z)(u,e);var t=(0,o.Z)(u);function u(){var e;(0,r.Z)(this,u);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="TrackHubRegistryPlugin",e}return(0,a.Z)(u,[{key:"install",value:function(e){e.addConnectionType((function(){return new c.Z({name:"TheTrackHubRegistryConnection",configSchema:h,configEditorComponent:(0,s.lazy)((function(){return Promise.all([n.e(8118),n.e(3134)]).then(n.bind(n,83134))})),stateModel:v(e),displayName:"The Track Hub Registry",description:"A hub from The Track Hub Registry",url:"//trackhubregistry.org/"})}))}}]),u}(u.Z)},42123:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(31145),c=n(49767),u=n(46840),l=n(96234),d=n(34795),f=n(77162),p=n.n(f),h=n(36806),g=n(29598),m=n(33528),v=n(52185),y=n(9077);function b(e){try{return decodeURIComponent(e)}catch(t){return e}}function x(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15,r=e.toLowerCase().indexOf(t);return e.length<40?e:(Math.max(0,r-n)>0?"...":"")+e.slice(Math.max(0,r-n),r+t.length+n).trim()+(r+t.length<e.length?"...":"")}var w=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(e,a,i){var o;(0,r.Z)(this,n),(o=t.call(this,e,a,i)).indexingAttributes=void 0,o.trixJs=void 0,o.tracksNames=void 0;var s=(0,y.readConfObject)(e,"ixFilePath"),c=(0,y.readConfObject)(e,"ixxFilePath");if(!s)throw new Error("must provide out.ix");if(!c)throw new Error("must provide out.ixx");return o.trixJs=new h.Z((0,m.openLocation)(c),(0,m.openLocation)(s),1500),o}return(0,a.Z)(n,[{key:"searchIndex",value:function(){var e=(0,d.Z)(p().mark((function e(t){var n,r,a,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.queryString.toLowerCase(),r=n.split(" "),e.next=4,this.trixJs.search(n);case 4:if(a=e.sent,i=a.filter((function(e){var t=(0,l.Z)(e,2)[1];return r.every((function(e){return b(t).toLowerCase().includes(e)}))})).map((function(e){var t=(0,l.Z)(e,2),n=t[0],r=t[1],a=JSON.parse(r.replace(/\|/g,",")),i=a.map((function(e){return b(e)})),o=(0,u.Z)(i),s=o[0],c=o[1],d=o.slice(2),f=d.findIndex((function(e){return!!e})),p=d.map((function(e){return e.toLowerCase()})).findIndex((function(e){return-1!==e.indexOf(n.toLowerCase())})),h=d[f],g=d[p],m=-1!==p?x(g,n):void 0,y=x(h,n),w=m&&y.toLowerCase()!==m.toLowerCase()?"".concat(y," (").concat(m,")"):y;return new v.Z({locString:s,label:h,displayString:w,matchedObject:a.map((function(e){return decodeURIComponent(e)})),trackId:c})})),"exact"!==t.searchType){e.next=8;break}return e.abrupt("return",i.filter((function(e){return e.getLabel().toLowerCase()===t.queryString.toLowerCase()})));case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeResources",value:function(){}}]),n}(g.BaseAdapter),k=(0,y.ConfigurationSchema)("TrixTextSearchAdapter",{ixFilePath:{type:"fileLocation",defaultValue:{uri:"out.ix",locationType:"UriLocation"},description:"the location of the trix ix file"},ixxFilePath:{type:"fileLocation",defaultValue:{uri:"out.ixx",locationType:"UriLocation"},description:"the location of the trix ixx file"},metaFilePath:{type:"fileLocation",defaultValue:{uri:"meta.json",locationType:"UriLocation"},description:"the location of the metadata json file for the trix index"},tracks:{type:"stringArray",defaultValue:[],description:"List of tracks covered by text search adapter"},assemblyNames:{type:"stringArray",defaultValue:[],description:"List of assemblies covered by text search adapter"}},{explicitlyTyped:!0,explicitIdentifier:"textSearchAdapterId"}),C=function(e){(0,i.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,r.Z)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="TrixPlugin",e}return(0,a.Z)(n,[{key:"install",value:function(e){e.addTextSearchAdapterType((function(){return new s.Z({name:"TrixTextSearchAdapter",configSchema:k,AdapterClass:w,description:"Trix adapter"})}))}}]),n}(c.Z)},4795:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var r=n(33028),a=n(96234),i=n(68079),o=n(9249),s=n(87371),c=n(6556),u=function(){function e(t){(0,o.Z)(this,e),this.variant=void 0,this.parser=void 0,this.data=void 0,this._id=void 0,this.variant=t.variant,this.parser=t.parser,this.data=this.dataFromVariant(this.variant),this._id=t.id}return(0,s.Z)(e,[{key:"get",value:function(e){return"samples"===e?this.variant.SAMPLES:this.data[e]||this.variant[e]}},{key:"set",value:function(){}},{key:"parent",value:function(){}},{key:"children",value:function(){}},{key:"tags",value:function(){return[].concat((0,i.Z)(Object.keys(this.data)),(0,i.Z)(Object.keys(this.variant)),["samples"])}},{key:"id",value:function(){return this._id}},{key:"dataFromVariant",value:function(e){var t=e.REF,n=e.ALT,r=e.POS,i=e.CHROM,o=e.INFO,s=e.ID,c=r-1,u=this._getSOTermAndDescription(t,n),l=(0,a.Z)(u,2),d=l[0],f=l[1],p=null===n||void 0===n?void 0:n.some((function(e){return"<TRA>"===e}));return{refName:i,start:c,end:(null===n||void 0===n?void 0:n.some((function(e){return-1!==e.indexOf("<")})))&&o.END&&!p?+o.END[0]:c+t.length,description:f,type:d,name:null===s||void 0===s?void 0:s.join(","),aliases:s&&s.length>1?e.ID.slice(1):void 0}}},{key:"_getSOTermAndDescription",value:function(e,t){var n=this;if(!t||t===[])return["remark","no alternative alleles"];var r=new Set,o=new Set;if(t.forEach((function(t){var i=n._getSOAndDescFromAltDefs(e,t),s=(0,a.Z)(i,2),c=s[0],u=s[1];if(!c){var l=n._getSOAndDescByExamination(e,t),d=(0,a.Z)(l,2);c=d[0],u=d[1]}c&&u&&(r.add(c),o.add(u))})),o.size>1){var s=new Set((0,i.Z)(o).map((function(e){var t=e.split("->");return t[1]?t[0]:e}))),c=(0,i.Z)(s).map((function(e){var t=(0,i.Z)(o).map((function(t){var n=t.split("-> ");return n[1]&&n[0]===e?n[1]:""})).filter((function(e){return!!e}));return t.length?e+"-> "+t.join(","):(0,i.Z)(o).join(",")}));o=new Set(c)}return r.size?[(0,i.Z)(r).join(","),(0,i.Z)(o).join(",")]:[void 0,void 0]}},{key:"_getSOAndDescFromAltDefs",value:function(t,n){if("string"===typeof n&&!n.startsWith("<"))return[void 0,void 0];var r=e._altTypeToSO[n];if(!r&&this.parser.getMetadata("ALT",n)&&(r="sequence_variant"),r)return[r,n];var a=n.split(":");return a.length>1?this._getSOAndDescFromAltDefs(t,"<".concat(a.slice(0,a.length-1).join(":"),">")):[void 0,void 0]}},{key:"_getSOAndDescByExamination",value:function(e,t){return(0,c.I)(t)?["breakend",t]:1===e.length&&1===t.length?["SNV",this._makeDescriptionString("SNV",e,t)]:"<INS>"===t?["insertion",t]:"<DEL>"===t||"<INV>"===t?["deletion",t]:"<TRA>"===t?["translocation",t]:t.includes("<")?["sv",t]:e.length===t.length?e.split("").reverse().join("")===t?["inversion",this._makeDescriptionString("inversion",e,t)]:["substitution",this._makeDescriptionString("substitution",e,t)]:e.length<=t.length?["insertion",this._makeDescriptionString("insertion",e,t)]:e.length>t.length?["deletion",this._makeDescriptionString("deletion",e,t)]:["indel",this._makeDescriptionString("indel",e,t)]}},{key:"_makeDescriptionString",value:function(e,t,n){return"".concat(e," ").concat(t," -> ").concat(n)}},{key:"toJSON",value:function(){return(0,r.Z)((0,r.Z)((0,r.Z)({uniqueId:this._id},this.variant),this.data),{},{samples:this.variant.SAMPLES})}}]),e}();u._altTypeToSO={DEL:"deletion",INS:"insertion",DUP:"duplication",INV:"inversion",INVDUP:"inverted duplication",CNV:"copy_number_variation",TRA:"translocation","DUP:TANDEM":"tandem_duplication",NON_REF:"sequence_variant","*":"sequence_variant"}},24511:function(e,t,n){"use strict";n.d(t,{B:function(){return q.Z},Z:function(){return U}});var r=n(9249),a=n(87371),i=n(45754),o=n(86906),s=n(30969),c=n(9077),u=n(93029),l=n(81575),d=n(59853),f=n(82044),p=n(66737),h=n(49767),g=n(89058),m=n(35681),v=n(33028),y=function(e){var t=e.jbrequire,n=t("mobx-state-tree").types,r=t("@jbrowse/core/configuration"),a=r.ConfigurationSchema,i=r.ConfigurationReference,o=t("@jbrowse/core/util").getContainingView,s=t("@jbrowse/core/util/tracks").getParentRenderProps,c=a("ChordVariantDisplay",{renderer:n.optional(e.pluggableConfigSchemaType("renderer"),{type:"StructuralVariantChordRenderer"})},{baseConfiguration:m._U,explicitlyTyped:!0});return{stateModel:n.compose("ChordVariantDisplay",m.pL,n.model({type:n.literal("ChordVariantDisplay"),configuration:i(c)})).views((function(e){return{get rendererTypeName(){return e.configuration.renderer.type},renderProps:function(){var t=o(e);return(0,v.Z)((0,v.Z)({},s(e)),{},{rpcDriverName:e.rpcDriverName,displayModel:e,bezierRadius:t.radiusPx*e.bezierRadiusRatio,radius:t.radiusPx,blockDefinitions:this.blockDefinitions,config:e.configuration.renderer,onChordClick:e.onChordClick})}}})),configSchema:c}},b=function(e){var t=e.lib,n=e.load,r=t["@jbrowse/core/pluggableElementTypes/DisplayType"],a=n(y),i=a.stateModel;return new r({name:"ChordVariantDisplay",configSchema:a.configSchema,stateModel:i,trackType:"VariantTrack",viewType:"CircularView",ReactComponent:(0,m.H8)(e)})};var x=n(34795),w=n(77162),k=n.n(w),C=n(97891),Z=n(81073),S=n(40909);function T(e){return S.types.compose("LinearVariantDisplay",(0,g.l0)(e),S.types.model({type:S.types.literal("LinearVariantDisplay"),configuration:(0,c.ConfigurationReference)(e)})).actions((function(e){return{selectFeature:function(t){return(0,x.Z)(k().mark((function n(){var r,a,i,o,s,u,l;return k().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(0,Z.getSession)(e),!(0,Z.isSessionModelWithWidgets)(r)){n.next=11;break}return a=r.rpcManager,i=(0,C.getRpcSessionId)(e),o=(0,Z.getContainingTrack)(e),s=(0,c.getConf)(o,"adapter"),n.next=8,a.call(i,"CoreGetMetadata",{adapterConfig:s});case 8:u=n.sent,l=r.addWidget("VariantFeatureWidget","variantFeature",{featureData:t.toJSON(),view:(0,Z.getContainingView)(e),descriptions:u}),r.showWidget(l);case 11:r.setSelection(t);case 12:case"end":return n.stop()}}),n)})))()}}}))}var P=n(54215),R=n(41361),M=n(68079),j=n(96234),A=n(90550),N=n(29206),L=n(6556),F=n(37574);function I(e,t){var n=e.region.elided?0:e.region.start,r=e.region.elided?0:e.region.end;return(e.flipped?r-t:t-n)/e.bpPerRadian+e.startRadians}var B=(0,A.observer)((function(e){var t,n,r,a,i=e.feature,o=e.blocksForRefs,s=e.radius,u=e.config,l=e.bezierRadius,d=e.selected,f=e.onClick,p=o[i.get("refName")];if(!p)return null;if(i.get("INFO")){var h=i.get("INFO").SVTYPE||[];n=(0,j.Z)(h,1)[0]}else i.get("mate")&&(n="mate");var g=null===(t=i.get("ALT"))||void 0===t?void 0:t[0],m=g&&(0,L.I)(g);if(m){var v=m.MatePosition.split(":");r=+v[1],a=o[v[0]]}else if("<TRA>"===g){var y,b,x,w,k=null===(y=i.get("INFO"))||void 0===y||null===(b=y.CHR2)||void 0===b?void 0:b[0],C=null===(x=i.get("INFO"))||void 0===x||null===(w=x.END)||void 0===w?void 0:w[0];r=parseInt(C,10),a=o[k]}else if("mate"===n){var S=i.get("mate"),T=S.refName;r=S.start,a=o[T]}if(a){var P=i.get("start"),R=I(p,P),A=I(a,r),N=(0,Z.polarToCartesian)(s,R),B=(0,Z.polarToCartesian)(s,A),D=(0,Z.polarToCartesian)(l,(A+R)/2),E=d?(0,c.readConfObject)(u,"strokeColorSelected",{feature:i}):(0,c.readConfObject)(u,"strokeColor",{feature:i}),V=(0,c.readConfObject)(u,"strokeColorHover",{feature:i});return(0,F.jsx)("path",{"data-testid":"chord-".concat(i.id()),d:["M"].concat((0,M.Z)(N),["Q"],(0,M.Z)(D),(0,M.Z)(B)).join(" "),style:{stroke:E},onClick:function(e){return f(i,p.region,a.region,e)},onMouseOver:function(e){d||(e.target.style.stroke=V,e.target.style.strokeWidth=3)},onMouseOut:function(e){d||(e.target.style.stroke=E,e.target.style.strokeWidth=1)}})}return null}));function D(e){var t,n=e.features,r=e.config,a=e.displayModel,i=e.blockDefinitions,o=e.radius,c=e.bezierRadius,u=e.displayModel.selectedFeatureId,l=e.onChordClick,d=(0,s.useMemo)((function(){var e={};return i.forEach((function(t){(t.region.elided?t.region.regions:[t.region]).forEach((function(n){e[n.refName]=t}))})),e}),[i]),f=[],p=(0,R.Z)(n);try{for(p.s();!(t=p.n()).done;){var h=(0,j.Z)(t.value,2),g=h[0],m=h[1],v=String(u)===String(m.id());f.push((0,F.jsx)(B,{feature:m,config:r,displayModel:a,radius:o,bezierRadius:c,blocksForRefs:d,selected:v,onClick:l},g))}}catch(b){p.e(b)}finally{p.f()}var y="chords-".concat(a.id);return(0,F.jsxs)("g",{id:y,"data-testid":"structuralVariantChordRenderer",children:[(0,F.jsx)("style",{dangerouslySetInnerHTML:{__html:"\n          #".concat(y," > path {\n            cursor: crosshair;\n            fill: none;\n          }\n")}}),f]})}D.defaultProps={displayModel:void 0,selectedFeatureId:"",onChordClick:void 0};var E=(0,A.observer)(D),V=function(e){var t=(0,c.ConfigurationSchema)("StructuralVariantChordRenderer",{strokeColor:{type:"color",description:"the line color of each arc",defaultValue:"rgba(255,133,0,0.32)",contextVariable:["feature"]},strokeColorSelected:{type:"color",description:"the line color of an arc that has been selected",defaultValue:"black",contextVariable:["feature"]},strokeColorHover:{type:"color",description:"the line color of an arc that is being hovered over with the mouse",defaultValue:"#555",contextVariable:["feature"]}},{explicitlyTyped:!0});return new P.Z({name:"StructuralVariantChordRenderer",ReactComponent:E,configSchema:t,pluginManager:e})},O=(0,c.ConfigurationSchema)("VariantFeatureWidget",{});function z(e){return S.types.model("VariantFeatureWidget",{id:N.ElementId,type:S.types.literal("VariantFeatureWidget"),view:S.types.safeReference(e.pluggableMstType("view","stateModel")),featureData:S.types.frozen(),descriptions:S.types.frozen()}).actions((function(e){return{setFeatureData:function(t){e.featureData=t},clearFeatureData:function(){e.featureData=void 0}}}))}var W=(0,c.ConfigurationSchema)("VcfTabixAdapter",{vcfGzLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz",locationType:"UriLocation"}},index:(0,c.ConfigurationSchema)("VcfIndex",{indexType:{model:S.types.enumeration("IndexType",["TBI","CSI"]),type:"stringEnum",defaultValue:"TBI"},location:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf.gz.tbi",locationType:"UriLocation"}}})},{explicitlyTyped:!0}),H=(0,c.ConfigurationSchema)("VcfAdapter",{vcfLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.vcf",locationType:"UriLocation"}}},{explicitlyTyped:!0}),q=n(4795),U=function(e){(0,i.Z)(h,e);var t=(0,o.Z)(h);function h(){var e;(0,r.Z)(this,h);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).name="VariantsPlugin",e}return(0,a.Z)(h,[{key:"install",value:function(e){e.addAdapterType((function(){return new u.Z({name:"VcfTabixAdapter",configSchema:W,getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7904),n.e(4061),n.e(8873)]).then(n.bind(n,98873)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfTabixAdapter",i=(0,C.getFileName)(t),o=n&&(0,C.getFileName)(n),s={type:a,vcfGzLocation:t,index:{location:n||(0,C.makeIndex)(t,".tbi"),indexType:(0,C.makeIndexType)(o,"CSI","TBI")}};return/\.vcf\.b?gz$/i.test(i)&&!r||r===a?s:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"VcfTabixAdapter"===t||"VcfAdapter"===t?"VariantTrack":e(t)}})),e.addAdapterType((function(){return new u.Z({name:"VcfAdapter",configSchema:H,getAdapterClass:function(){return Promise.all([n.e(6362),n.e(8930)]).then(n.bind(n,38930)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="VcfAdapter",i=(0,C.getFileName)(t);return/\.vcf$/i.test(i)||r===a?{type:a,vcfLocation:t}:e(t,n,r)}})),e.addRendererType((function(){return e.jbrequire(V)})),e.addTrackType((function(){var t=(0,c.ConfigurationSchema)("VariantTrack",{},{baseConfiguration:(0,d.createBaseTrackConfig)(e)});return new f.Z({name:"VariantTrack",configSchema:t,stateModel:(0,d.createBaseTrackModel)(e,"VariantTrack",t)})})),e.addDisplayType((function(){return e.jbrequire(b)})),e.addDisplayType((function(){var t=function(e){var t=(0,g.RH)(e);return(0,c.ConfigurationSchema)("LinearVariantDisplay",{},{baseConfiguration:t,explicitlyTyped:!0})}(e);return new l.Z({name:"LinearVariantDisplay",configSchema:t,stateModel:T(t),trackType:"VariantTrack",viewType:"LinearGenomeView",ReactComponent:g.qb})})),e.addWidgetType((function(){return new p.Z({name:"VariantFeatureWidget",heading:"Feature details",configSchema:O,stateModel:z(e),ReactComponent:(0,s.lazy)((function(){return n.e(3242).then(n.bind(n,83242))}))})}))}}]),h}(h.Z)},92854:function(e,t,n){"use strict";n.d(t,{Xl:function(){return oe},u:function(){return te},Aq:function(){return C},Eh:function(){return M},Rv:function(){return ue},ZP:function(){return Ze},P$:function(){return B},yZ:function(){return I},LT:function(){return de}});var r={};n.r(r),n.d(r,{getNiceDomain:function(){return D},getOrigin:function(){return B},getScale:function(){return I}});var a=n(9249),i=n(87371),o=n(45754),s=n(86906),c=n(93029),u=n(82044),l=n(49767),d=n(9077),f=n(59853),p=n(81575),h=n(33028),g=n(96234),m=n(34795),v=n(93069),y=n(95058),b=n(77162),x=n.n(b),w=n(29637),k=n(31385),C=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).supportsSVG=!0,e}return(0,i.Z)(n,[{key:"render",value:function(){var e=(0,m.Z)(x().mark((function e(t){var r,a,i,o,s,c,u,l,d,f=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getFeatures(t);case 2:return r=e.sent,a=t.height,i=t.regions,o=t.bpPerPx,s=(0,g.Z)(i,1),c=s[0],u=(c.end-c.start)/o,e.next=8,(0,k.C)(u,a,t,(function(e){return f.draw(e,(0,h.Z)((0,h.Z)({},t),{},{features:r}))}));case 8:return l=e.sent,e.next=11,(0,v.Z)((0,y.Z)(n.prototype),"render",this).call(this,(0,h.Z)((0,h.Z)((0,h.Z)({},t),l),{},{features:r,height:a,width:u}));case 11:return d=e.sent,e.abrupt("return",(0,h.Z)((0,h.Z)((0,h.Z)({},d),l),{},{features:r,containsNoTransferables:!0,height:a,width:u}));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(w.default),Z=n(41361),S=n(90550),T=n(30969),P=n(24998),R=n(37574);var M=(0,S.observer)((function(e){var t=e.regions,n=e.features,r=e.bpPerPx,a=e.width,i=e.height,o=e.onMouseLeave,s=void 0===o?function(){}:o,c=e.onMouseMove,u=void 0===c?function(){}:c,l=e.onFeatureClick,d=void 0===l?function(){}:l,f=(0,g.Z)(t,1)[0],p=(0,T.useRef)(null);function m(e){var t=0;p.current&&(t=p.current.getBoundingClientRect().left);var i,o,s=e-t,c=f.reversed?a-s:s,u=f.start+r*c,l=(0,Z.Z)(n.values());try{for(l.s();!(o=l.n()).done;){var d=o.value;if(u<=d.get("end")&&u>=d.get("start")){i=d;break}}}catch(h){l.e(h)}finally{l.f()}return i}return(0,R.jsx)("div",{ref:p,"data-testid":"wiggle-rendering-test",onMouseMove:function(e){var t=m(e.clientX);u(e,t?t.id():void 0)},onClick:function(e){var t=m(e.clientX);d(e,t?t.id():void 0)},onMouseLeave:function(e){return s(e)},role:"presentation",className:"WiggleRendering",style:{overflow:"visible",position:"relative",height:i},children:(0,R.jsx)(P.PrerenderedCanvas,(0,h.Z)({},e))})})),j=(0,d.ConfigurationSchema)("BigWigAdapter",{bigWigLocation:{type:"fileLocation",defaultValue:{uri:"/path/to/my.bw",locationType:"UriLocation"}}},{explicitlyTyped:!0}),A=n(81073),N=n(83005),L=n(62872),F=n(69359);function I(e){var t,n=e.domain,r=void 0===n?[]:n,a=e.range,i=void 0===a?[]:a,o=e.scaleType,s=e.pivotValue,c=e.inverted,u=(0,g.Z)(r,2),l=u[0],d=u[1];if(void 0===l||void 0===d)throw new Error("invalid domain");if("linear"===o)t=(0,N.Z)();else if("log"===o)(t=(0,L.Z)()).base(2);else{if("quantize"!==o)throw new Error("undefined scaleType");t=(0,F.Z)()}t.domain(void 0!==s?[l,s,d]:[l,d]),t.nice();var f=(0,g.Z)(i,2),p=f[0],h=f[1];if(void 0===p||void 0===h)throw new Error("invalid range");return t.range(c?i.slice().reverse():i),t}function B(e){return"log"===e?1:0}function D(e){var t=e.scaleType,n=e.domain,r=e.bounds,a=(0,g.Z)(r,2),i=a[0],o=a[1],s=(0,g.Z)(n,2),c=s[0],u=s[1];if("linear"===t&&(u<0&&(u=0),c>0&&(c=0)),"log"===t&&(0===c||c>1)&&(c=1),void 0===c||void 0===u)throw new Error("invalid domain supplied to stats function");void 0!==i&&i!==Number.MIN_VALUE&&(c=i),void 0!==o&&o!==Number.MAX_VALUE&&(u=o);var l=function(e){if("linear"===e)return(0,N.Z)();if("log"===e){var t=(0,L.Z)();return t.base(2),t}if("quantize"===e)return(0,F.Z)();throw new Error("undefined scaleType ".concat(e))}(t);return l.domain([c,u]),l.nice(),l.domain()}var E=n(40909),V=(0,d.ConfigurationSchema)("WiggleRenderer",{color:{type:"color",description:"the color of track, overrides posColor and negColor",defaultValue:"#f0f"},posColor:{type:"color",description:"the color to use when the score is positive",defaultValue:"blue"},negColor:{type:"color",description:"the color to use when the score is negative",defaultValue:"red"},highlightColor:{type:"color",description:"the color of highlights over the wiggle track",defaultValue:"rgba(255,255,0,0.5)"},clipColor:{type:"color",description:"the color of the clipping marker",defaultValue:"red"},renderType:{type:"stringEnum",model:E.types.enumeration("Rendering type",["xyplot","density","line"]),description:"The type of rendering for wiggle data to use",defaultValue:"xyplot"},filled:{type:"boolean",description:"fill in histogram",defaultValue:!0},bicolorPivot:{type:"stringEnum",model:E.types.enumeration("Scale type",["numeric","mean","z_score","none"]),description:"type of bicolor pivot",defaultValue:"numeric"},bicolorPivotValue:{type:"number",defaultValue:0,description:"value to use for bicolor pivot"},summaryScoreMode:{type:"stringEnum",model:E.types.enumeration("Score type",["max","min","avg","whiskers"]),description:"choose whether to use max/min/average or whiskers which combines all three into the same rendering",defaultValue:"whiskers"},displayCrossHatches:{type:"boolean",description:"choose to draw cross hatches (sideways lines)",defaultValue:!1}},{explicitlyTyped:!0}),O=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.regions,i=t.bpPerPx,o=t.scaleOpts,s=t.height,c=t.config,u=(0,g.Z)(a,1)[0],l=(0,d.readConfObject)(c,"bicolorPivot"),f=(0,d.readConfObject)(c,"bicolorPivotValue"),p=(0,d.readConfObject)(c,"negColor"),m=(0,d.readConfObject)(c,"posColor");if("#f0f"===(0,d.readConfObject)(c,"color")){var v=I("none"!==l?(0,h.Z)((0,h.Z)({},o),{},{pivotValue:f,range:[p,"white",m]}):(0,h.Z)((0,h.Z)({},o),{},{range:["white",m]}));n=function(e){return v(e.get("score"))}}else n=function(e){return(0,d.readConfObject)(c,"color",{feature:e})};var y,b=(0,Z.Z)(r.values());try{for(b.s();!(y=b.n()).done;){var x=y.value,w=(0,A.featureSpanPx)(x,u,i),k=(0,g.Z)(w,2),C=k[0],S=k[1]-C+.3;e.fillStyle=n(x),e.fillRect(C,0,S,s)}}catch(T){b.e(T)}finally{b.f()}}}]),n}(C),z=(0,d.ConfigurationSchema)("DensityRenderer",{},{baseConfiguration:V,explicitlyTyped:!0}),W=n(89058);var H=n(68079),q=n(97891),U=n(35247),_=n(40659),G=n(22714),J=n(53239),X=n(23554),Y=n(11611);function Q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return+(+e).toPrecision(6)}var $=function(e){return e.toLocaleString("en-US")},K=(0,G.Z)((function(e){return{tooltip:{position:"absolute",pointerEvents:"none",backgroundColor:(0,J.Fq)(e.palette.grey[700],.9),borderRadius:e.shape.borderRadius,color:e.palette.common.white,fontFamily:e.typography.fontFamily,padding:"4px 8px",fontSize:e.typography.pxToRem(12),lineHeight:"".concat((t=1.4,Math.round(1e5*t)/1e5),"em"),maxWidth:300,wordWrap:"break-word"},hoverVertical:{background:"#333",border:"none",width:1,height:"100%",top:ue,cursor:"default",position:"absolute",pointerEvents:"none"}};var t})),ee=T.forwardRef((function(e,t){var n=e.feature,r=n.get("start"),a=n.get("end"),i=[n.get("refName"),r===a?$(r):"".concat($(r),"..").concat($(a))].filter((function(e){return!!e})).join(":");return void 0!==n.get("summary")?(0,R.jsxs)("div",{ref:t,children:[i,(0,R.jsx)("br",{}),"Max: ",Q(n.get("maxScore")),(0,R.jsx)("br",{}),"Avg: ",Q(n.get("score")),(0,R.jsx)("br",{}),"Min: ",Q(n.get("minScore"))]}):(0,R.jsxs)("div",{ref:t,children:[i,(0,R.jsx)("br",{}),"".concat(Q(n.get("score")))]})})),te=(0,S.observer)((function(e){var t=e.model,n=e.height,r=e.clientMouseCoord,a=e.offsetMouseCoord,i=e.clientRect,o=e.TooltipContents,s=t.featureUnderMouse,c=(0,T.useState)(0),u=(0,g.Z)(c,2),l=u[0],d=u[1],f=(0,T.useState)(null),p=(0,g.Z)(f,2),m=p[0],v=p[1],y=K(),b=(0,T.useMemo)((function(){return{getBoundingClientRect:function(){var e=r[0]+l/2+20,t=(null===i||void 0===i?void 0:i.top)||0;return{top:t,left:e,bottom:t,right:e,width:0,height:0,x:e,y:t,toJSON:function(){}}}}}),[null===i||void 0===i?void 0:i.top,r,l]),x=(0,Y.D)(b,m),w=x.styles,k=x.attributes;return s?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(X.Z,{children:(0,R.jsx)("div",(0,h.Z)((0,h.Z)({ref:v,className:y.tooltip,style:(0,h.Z)((0,h.Z)({},w.popper),{},{zIndex:1e5})},k.popper),{},{children:(0,R.jsx)(o,{ref:function(e){d((null===e||void 0===e?void 0:e.getBoundingClientRect().width)||0)},feature:s})}))}),(0,R.jsx)("div",{className:y.hoverVertical,style:{left:a[0],height:n-2*ue}})]}):null})),ne=(0,S.observer)((function(e){return(0,R.jsx)(te,(0,h.Z)({TooltipContents:ee},e))})),re=(0,S.observer)((function(e){var t=e.model,n=e.orientation,r=t.ticks;return r?(0,R.jsx)(_.RD,(0,h.Z)((0,h.Z)({},r),{},{shadow:2,format:function(e){return e},style:{orient:"left"===n?_.RL:_.pX}})):null})),ae=re,ie=(0,S.observer)((function(e){var t=e.model,n=t.stats,r=t.height,a=t.needsScalebar,i="overlapping"===(0,A.getContainingView)(t).trackLabels?(0,A.measureText)((0,d.getConf)((0,A.getContainingTrack)(t),"name"),12.8)+100:50;return(0,R.jsxs)("div",{children:[(0,R.jsx)(W.qb,(0,h.Z)({},e)),n&&a?(0,R.jsx)("svg",{style:{position:"absolute",top:0,left:i,pointerEvents:"none",height:r,width:50},children:(0,R.jsx)(ae,{model:t})}):null]})})),oe=ie,se=(0,T.lazy)((function(){return n.e(1195).then(n.bind(n,91195))})),ce=(0,T.lazy)((function(){return Promise.all([n.e(8017),n.e(6082)]).then(n.bind(n,56082))})),ue=5,le=new Map([["xyplot","XYPlotRenderer"],["density","DensityRenderer"],["line","LinePlotRenderer"]]),de=function(e,t){return E.types.compose("LinearWiggleDisplay",W.fV,E.types.model({type:E.types.literal("LinearWiggleDisplay"),configuration:(0,d.ConfigurationReference)(t),selectedRendering:E.types.optional(E.types.string,""),resolution:E.types.optional(E.types.number,1),fill:E.types.maybe(E.types.boolean),color:E.types.maybe(E.types.string),posColor:E.types.maybe(E.types.string),negColor:E.types.maybe(E.types.string),summaryScoreMode:E.types.maybe(E.types.string),rendererTypeNameState:E.types.maybe(E.types.string),scale:E.types.maybe(E.types.string),autoscale:E.types.maybe(E.types.string),displayCrossHatches:E.types.maybe(E.types.boolean),constraints:E.types.optional(E.types.model({max:E.types.maybe(E.types.number),min:E.types.maybe(E.types.number)}),{})})).volatile((function(){return{statsReady:!1,message:void 0,stats:{scoreMin:0,scoreMax:50},statsFetchInProgress:void 0}})).actions((function(e){return{updateStats:function(t){var n=t.scoreMin,r=t.scoreMax;e.stats.scoreMin===n&&e.stats.scoreMax===r||(e.stats={scoreMin:n,scoreMax:r}),e.statsReady=!0},setColor:function(t){e.color=t},setPosColor:function(t){e.posColor=t},setNegColor:function(t){e.negColor=t},setLoading:function(t){var n=e.statsFetchInProgress;void 0===n||n.signal.aborted||n.abort(),e.statsFetchInProgress=t},selectFeature:function(t){var n=(0,A.getSession)(e);(0,A.isSelectionContainer)(n)&&n.setSelection(t)},setResolution:function(t){e.resolution=t},setFill:function(t){e.fill=t},toggleLogScale:function(){"log"!==e.scale?e.scale="log":e.scale="linear"},setScaleType:function(t){e.scale=t},setSummaryScoreMode:function(t){e.summaryScoreMode=t},setAutoscale:function(t){e.autoscale=t},setMaxScore:function(t){e.constraints.max=t},setRendererType:function(t){e.rendererTypeNameState=t},setMinScore:function(t){e.constraints.min=t},toggleCrossHatches:function(){e.displayCrossHatches=!e.displayCrossHatches},setCrossHatches:function(t){e.displayCrossHatches=t}}})).views((function(e){return{get TooltipComponent(){return ne},get adapterTypeName(){return e.adapterConfig.type},get rendererTypeName(){var t=e.rendererTypeNameState||(0,d.getConf)(e,"defaultRendering"),n=le.get(t);if(!n)throw new Error("unknown alignments view name ".concat(t));return n},get filters(){},get scaleType(){return e.scale||(0,d.getConf)(e,"scaleType")},get maxScore(){var t=e.constraints.max;return void 0!==t?t:(0,d.getConf)(e,"maxScore")},get minScore(){var t=e.constraints.min;return void 0!==t?t:(0,d.getConf)(e,"minScore")}}})).views((function(e){return{get rendererConfig(){var t=(0,d.getConf)(e,["renderers",e.rendererTypeName])||{};return e.rendererType.configSchema.create((0,h.Z)((0,h.Z)((0,h.Z)((0,h.Z)({},t),{},{filled:e.fill,scaleType:e.scaleType,displayCrossHatches:e.displayCrossHatches,summaryScoreMode:e.summaryScoreMode},e.color?{color:e.color}:{}),e.negColor?{negColor:e.negColor}:{}),e.posColor?{posColor:e.posColor}:{}),(0,E.getEnv)(e))}}})).views((function(e){var t=[0,0];return{get filled(){return"undefined"!==typeof e.fill?e.fill:(0,d.readConfObject)(e.rendererConfig,"filled")},get summaryScoreModeSetting(){return e.summaryScoreMode||(0,d.readConfObject)(e.rendererConfig,"summaryScoreMode")},get domain(){var n=e.stats,r=e.scaleType,a=e.minScore,i=e.maxScore,o=D({domain:[n.scoreMin,n.scoreMax],bounds:[a,i],scaleType:r});return"log"===r&&o[1]===Number.MIN_VALUE?[0,Number.MIN_VALUE]:(JSON.stringify(t)!==JSON.stringify(o)&&(t=o),t)},get needsScalebar(){return"XYPlotRenderer"===e.rendererTypeName||"LinePlotRenderer"===e.rendererTypeName},get scaleOpts(){return{domain:this.domain,stats:e.stats,autoscaleType:this.autoscaleType,scaleType:e.scaleType,inverted:(0,d.getConf)(e,"inverted")}},get canHaveFill(){return"XYPlotRenderer"===e.rendererTypeName},get autoscaleType(){return e.autoscale||(0,d.getConf)(e,"autoscale")},get displayCrossHatchesSetting(){return e.displayCrossHatches||(0,d.readConfObject)(e.rendererConfig,"displayCrossHatches")}}})).views((function(e){return{get ticks(){var t=e.scaleType,n=e.domain,r=e.height,a=(0,d.getConf)(e,"minimalTicks"),i=I({scaleType:t,domain:n,range:[r-ue,ue],inverted:(0,d.getConf)(e,"inverted")}),o=(0,_.th)(i,4);return r<100||a?(0,h.Z)((0,h.Z)({},o),{},{values:n}):o}}})).views((function(t){var n=t.renderProps;return{renderProps:function(){var e=n();return(0,h.Z)((0,h.Z)({},e),{},{notReady:e.notReady||!t.statsReady,rpcDriverName:t.rpcDriverName,displayModel:t,config:t.rendererConfig,scaleOpts:t.scaleOpts,resolution:t.resolution,height:t.height,ticks:t.ticks,displayCrossHatches:t.displayCrossHatches,filters:t.filters})},get adapterCapabilities(){return e.getAdapterType(t.adapterTypeName).adapterCapabilities},get hasResolution(){return this.adapterCapabilities.includes("hasResolution")},get hasGlobalStats(){return this.adapterCapabilities.includes("hasGlobalStats")}}})).views((function(e){var t=e.trackMenuItems;return{trackMenuItems:function(){return[].concat((0,H.Z)(t()),(0,H.Z)(e.hasResolution?[{label:"Resolution",subMenu:[{label:"Finer resolution",onClick:function(){e.setResolution(5*e.resolution)}},{label:"Coarser resolution",onClick:function(){e.setResolution(e.resolution/5)}}]},{label:"Summary score mode",subMenu:["min","max","avg","whiskers"].map((function(t){return{label:t,onClick:function(){return e.setSummaryScoreMode(t)}}}))}]:[]),(0,H.Z)(e.canHaveFill?[{label:e.filled?"Turn off histogram fill":"Turn on histogram fill",onClick:function(){e.setFill(!e.filled)}}]:[]),[{label:"log"===e.scaleType?"Set linear scale":"Set log scale",onClick:function(){e.toggleLogScale()}},{type:"checkbox",label:"Draw cross hatches",checked:e.displayCrossHatchesSetting,onClick:function(){e.toggleCrossHatches()}}],(0,H.Z)(Object.keys((0,d.getConf)(e,"renderers")||{}).length>1?[{label:"Renderer type",subMenu:(0,H.Z)(le.keys()).map((function(t){return{label:t,onClick:function(){return e.setRendererType(t)}}}))}]:[]),[{label:"Autoscale type",subMenu:[["local","Local"]].concat((0,H.Z)(e.hasGlobalStats?[["global","Global"],["globalsd","Global \xb1 3\u03c3"]]:[]),[["localsd","Local \xb1 3\u03c3"]]).map((function(t){var n=(0,g.Z)(t,2),r=n[0];return{label:n[1],onClick:function(){e.setAutoscale(r)}}}))},{label:"Set min/max score",onClick:function(){(0,A.getSession)(e).queueDialog((function(t){return[se,{model:e,handleClose:t}]}))}},{label:"Set color",onClick:function(){(0,A.getSession)(e).queueDialog((function(t){return[ce,{model:e,handleClose:t}]}))}}])}}})).actions((function(e){var t=e.reload,n=e.renderSvg;function r(e){return a.apply(this,arguments)}function a(){return(a=(0,m.Z)(x().mark((function t(n){var r,a,i,o,s,c,u,l,f,p,g,m,v,y,b,w,k,C;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=(0,A.getSession)(e),a=r.rpcManager,i=(0,d.getConf)(e,"numStdDev")||3,o=e.adapterConfig,s=e.autoscaleType,c=(0,q.getRpcSessionId)(e),u=(0,h.Z)({sessionId:c,adapterConfig:o,statusCallback:function(t){(0,E.isAlive)(e)&&e.setMessage(t)}},n),"global"!==s&&"globalsd"!==s){t.next=11;break}return t.next=8,a.call(c,"WiggleGetGlobalStats",u);case 8:return l=t.sent,f=l.scoreMin,p=l.scoreMean,g=l.scoreStdDev,t.abrupt("return","globalsd"===s?(0,h.Z)((0,h.Z)({},l),{},{scoreMin:f>=0?0:p-i*g,scoreMax:p+i*g}):l);case 11:if("local"!==s&&"localsd"!==s){t.next=18;break}return m=(0,A.getContainingView)(e),v=m.dynamicBlocks,y=m.bpPerPx,t.next=15,a.call(c,"WiggleGetMultiRegionStats",(0,h.Z)((0,h.Z)({},u),{},{regions:v.contentBlocks.map((function(e){var t=e.start,n=e.end;return(0,h.Z)((0,h.Z)({},JSON.parse(JSON.stringify(e))),{},{start:Math.floor(t),end:Math.ceil(n)})})),bpPerPx:y}));case 15:return b=t.sent,w=b.scoreMin,k=b.scoreMean,C=b.scoreStdDev,t.abrupt("return","localsd"===s?(0,h.Z)((0,h.Z)({},b),{},{scoreMin:w>=0?0:k-i*C,scoreMax:k+i*C}):b);case 18:if("zscale"!==s){t.next=20;break}return t.abrupt("return",a.call(c,"WiggleGetGlobalStats",u));case 20:throw new Error("invalid autoscaleType '".concat(s,"'"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return{reload:function(){return(0,m.Z)(x().mark((function n(){var a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.setError(),a=new AbortController,n.prev=2,n.next=5,r((0,h.Z)({signal:a.signal},e.renderProps()));case 5:i=n.sent,(0,E.isAlive)(e)&&(e.updateStats(i),t()),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),e.setError(n.t0);case 12:case"end":return n.stop()}}),n,null,[[2,9]])})))()},afterAttach:function(){(0,E.addDisposer)(e,(0,U.autorun)((0,m.Z)(x().mark((function t(){var n,a,i;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=new AbortController,a=(0,A.getContainingView)(e),e.setLoading(n),a.initialized){t.next=6;break}return t.abrupt("return");case 6:if(e.estimatedStatsReady){t.next=8;break}return t.abrupt("return");case 8:if(!e.regionTooLarge){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,r((0,h.Z)({signal:n.signal},e.renderProps()));case 12:i=t.sent,(0,E.isAlive)(e)&&e.updateStats(i),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),!(0,A.isAbortException)(t.t0)&&(0,E.isAlive)(e)&&(console.error(t.t0),e.setError(t.t0));case 19:case"end":return t.stop()}}),t,null,[[0,16]])}))),{delay:1e3}))},renderSvg:function(t){return(0,m.Z)(x().mark((function r(){var a,i,o,s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,U.when)((function(){return e.statsReady&&!!e.regionCannotBeRenderedText}));case 2:return a=e.needsScalebar,i=e.stats,o=(0,A.getContainingView)(e),s=o.offsetPx,r.t0=R.jsxs,r.t1=R.Fragment,r.t2=R.jsx,r.next=9,n(t);case 9:return r.t3=r.sent,r.t4={id:"snpcov",children:r.t3},r.t5=(0,r.t2)("g",r.t4),r.t6=a&&i?(0,R.jsx)("g",{transform:"translate(".concat(Math.max(-s,0),")"),children:(0,R.jsx)(ae,{model:e,orientation:"left"})}):null,r.t7=[r.t5,r.t6],r.t8={children:r.t7},r.abrupt("return",(0,r.t0)(r.t1,r.t8));case 16:case"end":return r.stop()}}),r)})))()}}}))},fe=n(8218),pe=n.n(fe),he=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(e,t){var n,r=t.features,a=t.bpPerPx,i=t.regions,o=t.scaleOpts,s=t.height,c=t.config,u=t.ticks,l=t.displayCrossHatches,f=(0,g.Z)(i,1)[0],p=(f.end-f.start)/a,m=ue,v=s-2*m,y=(0,d.readConfObject)(c,"bicolorPivotValue"),b=(0,d.readConfObject)(c,"negColor"),x=(0,d.readConfObject)(c,"posColor"),w=(0,d.readConfObject)(c,"filled"),k=(0,d.readConfObject)(c,"clipColor"),C=(0,d.readConfObject)(c,"highlightColor"),S=(0,d.readConfObject)(c,"summaryScoreMode"),T=I((0,h.Z)((0,h.Z)({},o),{},{range:[0,v]})),P=B(o.scaleType),R=T.domain(),M=(0,g.Z)(R,2),j=M[0],N=M[1],L=function(e){return v-(T(e)||0)+m},F=function(e){return L(P)-L(e)},D="#f0f"===(0,d.readConfObject)(c,"color")?function(e,t){return t<y?b:x}:function(e,t){return(0,d.readConfObject)(c,"color",{feature:e})},E=j<y&&N>y,V=(0,Z.Z)(r.values());try{for(V.s();!(n=V.n()).done;){var O=n.value,z=(0,A.featureSpanPx)(O,f,a),W=(0,g.Z)(z,2),H=W[0],q=W[1],U=O.get("score"),_=O.get("maxScore"),G=O.get("minScore"),J=U<j,X=U>N,Y=q-H+.4,Q=O.get("summary");if("max"===S)U=Q?_:U,e.fillStyle=D(O,U),e.fillRect(H,L(U),Y,w?F(U):1);else if("min"===S)U=Q?G:U,e.fillStyle=D(O,U),e.fillRect(H,L(U),Y,w?F(U):1);else if("whiskers"===S){var $=D(O,U);Q&&(e.fillStyle=E?D(O,_):pe()($).lighten(.6).toString(),e.fillRect(H,L(_),Y,w?F(_)-F(U):1)),e.fillStyle=E&&Q?pe()(D(O,_)).mix(pe()(D(O,G))):$,e.fillRect(H,L(U),Y,w?F(U)-(Q?F(G):0):1),Q&&(e.fillStyle=E?D(O,G):pe()($).darken(.6).toString(),e.fillRect(H,L(G),Y,w?F(G):1))}else e.fillStyle=D(O,U),e.fillRect(H,L(U),Y,w?F(U):1);X?(e.fillStyle=k,e.fillRect(H,0,Y,4)):J&&"log"!==o.scaleType&&(e.fillStyle=k,e.fillRect(H,s-4,Y,4)),O.get("highlighted")&&(e.fillStyle=C,e.fillRect(H,0,Y,v))}}catch(K){V.e(K)}finally{V.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",u.values.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(L(t))),e.lineTo(p,Math.round(L(t))),e.stroke()})))}}]),n}(C),ge=(0,d.ConfigurationSchema)("XYPlotRenderer",{},{baseConfiguration:V,explicitlyTyped:!0}),me=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"draw",value:function(e,t){var n,r,a=t.features,i=t.regions,o=t.bpPerPx,s=t.scaleOpts,c=t.height,u=t.ticks.values,l=t.displayCrossHatches,f=t.config,p=(0,g.Z)(i,1)[0],m=(p.end-p.start)/o,v=ue,y=c-2*v,b=(0,d.readConfObject)(f,"clipColor"),x=(0,d.readConfObject)(f,"highlightColor"),w=I((0,h.Z)((0,h.Z)({},s),{},{range:[0,y]})),k=w.domain(),C=(0,g.Z)(k,2),S=C[0],T=C[1],P=function(e){return y-w(e)+v},R="#f0f"===(0,d.readConfObject)(f,"color")?function(){return"grey"}:function(e){return(0,d.readConfObject)(f,"color",{feature:e})},M=(0,Z.Z)(a.values());try{for(M.s();!(r=M.n()).done;){var j=r.value,N=(0,A.featureSpanPx)(j,p,o),L=(0,g.Z)(N,2),F=L[0],B=L[1],D=j.get("score"),E=D<S,V=D>T,O=B-F+.3,z=R(j);e.strokeStyle=z,e.beginPath(),p.reversed?(e.moveTo(B,P("undefined"!==typeof n?n:D)),e.lineTo(B,P(D)),e.lineTo(F,P(D))):(e.moveTo(F,P("undefined"!==typeof n?n:D)),e.lineTo(F,P(D)),e.lineTo(B,P(D))),e.stroke(),n=D,V?(e.fillStyle=b,e.fillRect(F,0,O,4)):E&&"log"!==s.scaleType&&(e.fillStyle=b,e.fillRect(F,y-4,O,y)),j.get("highlighted")&&(e.fillStyle=x,e.fillRect(F,0,O,y))}}catch(W){M.e(W)}finally{M.f()}l&&(e.lineWidth=1,e.strokeStyle="rgba(200,200,200,0.8)",u.forEach((function(t){e.beginPath(),e.moveTo(0,Math.round(P(t))),e.lineTo(m,Math.round(P(t))),e.stroke()})))}}]),n}(C),ve=(0,d.ConfigurationSchema)("LinePlotRenderer",{},{baseConfiguration:V,explicitlyTyped:!0}),ye=n(3011),be=n(71036),xe=n(29598),we=n(37386),ke=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WiggleGetGlobalStats",e}return(0,i.Z)(n,[{key:"deserializeArguments",value:function(){var e=(0,m.Z)(x().mark((function e(t,r){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.Z)((0,y.Z)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",(0,h.Z)((0,h.Z)({},a),{},{filters:t.filters?new we.Z({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,m.Z)(x().mark((function e(t,n){var r,a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.adapterConfig,i=r.sessionId,e.next=6,(0,ye.uP)(this.pluginManager,i,a);case 6:return o=e.sent,s=o.dataAdapter,e.abrupt("return",s.getGlobalStats(r));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(be.Z),Ce=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WiggleGetMultiRegionStats",e}return(0,i.Z)(n,[{key:"deserializeArguments",value:function(){var e=(0,m.Z)(x().mark((function e(t,r){var a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.Z)((0,y.Z)(n.prototype),"deserializeArguments",this).call(this,t,r);case 2:return a=e.sent,e.abrupt("return",(0,h.Z)((0,h.Z)({},a),{},{filters:t.filters?new we.Z({filters:t.filters}):void 0}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeArguments",value:function(){var e=(0,m.Z)(x().mark((function e(t,r){var a,i,o,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null===(a=this.pluginManager.rootModel)||void 0===a||null===(i=a.session)||void 0===i?void 0:i.assemblyManager){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,(0,A.renameRegionsIfNeeded)(o,(0,h.Z)((0,h.Z)({},t),{},{filters:t.filters&&t.filters.toJSON().filters}));case 5:return s=e.sent,e.abrupt("return",(0,v.Z)((0,y.Z)(n.prototype),"serializeArguments",this).call(this,s,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=(0,m.Z)(x().mark((function e(t,n){var r,a,i,o,s,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deserializeArguments(t,n);case 2:return r=e.sent,a=r.regions,i=r.adapterConfig,o=r.sessionId,e.next=6,(0,ye.uP)(this.pluginManager,o,i);case 6:if(s=e.sent,!((c=s.dataAdapter)instanceof xe.BaseFeatureDataAdapter)){e.next=10;break}return e.abrupt("return",c.getMultiRegionStats(a,r));case 10:throw new Error("Data adapter not found");case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(be.Z),Ze=function(e){(0,o.Z)(l,e);var t=(0,s.Z)(l);function l(){var e;(0,a.Z)(this,l);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).name="WigglePlugin",e.exports={LinearWiggleDisplayReactComponent:oe,XYPlotRendererReactComponent:M,XYPlotRenderer:he,xyPlotRendererConfigSchema:ge,utils:r,WiggleBaseRenderer:C,linearWiggleDisplayModelFactory:de},e}return(0,i.Z)(l,[{key:"install",value:function(e){e.addTrackType((function(){var t=(0,d.ConfigurationSchema)("QuantitativeTrack",{},{baseConfiguration:(0,f.createBaseTrackConfig)(e)});return new u.Z({name:"QuantitativeTrack",configSchema:t,stateModel:(0,f.createBaseTrackModel)(e,"QuantitativeTrack",t)})})),e.addDisplayType((function(){var t=function(e){var t=e.getRendererType("XYPlotRenderer").configSchema,n=e.getRendererType("DensityRenderer").configSchema,r=e.getRendererType("LinePlotRenderer").configSchema;return(0,d.ConfigurationSchema)("LinearWiggleDisplay",{autoscale:{type:"stringEnum",defaultValue:"local",model:E.types.enumeration("Autoscale type",["global","local","globalsd","localsd","zscore"]),description:"global/local using their min/max values or w/ standard deviations (globalsd/localsd)"},minimalTicks:{type:"boolean",defaultValue:!1,description:"use the minimal amount of ticks"},minScore:{type:"number",defaultValue:Number.MIN_VALUE,description:"minimum value for the y-scale"},maxScore:{type:"number",description:"maximum value for the y-scale",defaultValue:Number.MAX_VALUE},numStdDev:{type:"number",description:"number of standard deviations to use for autoscale types globalsd or localsd",defaultValue:3},scaleType:{type:"stringEnum",model:E.types.enumeration("Scale type",["linear","log"]),description:"The type of scale to use",defaultValue:"linear"},inverted:{type:"boolean",description:"draw upside down",defaultValue:!1},defaultRendering:{type:"stringEnum",model:E.types.enumeration("Rendering",["density","xyplot","line"]),defaultValue:"xyplot"},renderers:(0,d.ConfigurationSchema)("RenderersConfiguration",{DensityRenderer:n,XYPlotRenderer:t,LinePlotRenderer:r})},{baseConfiguration:W.fU,explicitlyTyped:!0})}(e);return new p.Z({name:"LinearWiggleDisplay",configSchema:t,stateModel:de(e,t),trackType:"QuantitativeTrack",viewType:"LinearGenomeView",ReactComponent:oe})})),e.addAdapterType((function(){return new c.Z({name:"BigWigAdapter",configSchema:j,adapterCapabilities:["hasResolution","hasLocalStats","hasGlobalStats"],getAdapterClass:function(){return Promise.all([n.e(2821),n.e(7904),n.e(6254),n.e(8982),n.e(2094)]).then(n.bind(n,22094)).then((function(e){return e.default}))}})})),e.addToExtensionPoint("Core-guessAdapterForLocation",(function(e){return function(t,n,r){var a="BigWigAdapter",i=(0,q.getFileName)(t),o={type:a,bigWigLocation:t};return/\.(bw|bigwig)$/i.test(i)&&!r||r===a?o:e(t,n,r)}})),e.addToExtensionPoint("Core-guessTrackTypeForLocation",(function(e){return function(t){return"BigWigAdapter"===t?"QuantitativeTrack":e(t)}})),e.addRendererType((function(){return new O({name:"DensityRenderer",ReactComponent:M,configSchema:z,pluginManager:e})})),e.addRendererType((function(){return new me({name:"LinePlotRenderer",ReactComponent:M,configSchema:ve,pluginManager:e})})),e.addRendererType((function(){return new he({name:"XYPlotRenderer",ReactComponent:M,configSchema:ge,pluginManager:e})})),e.addRpcMethod((function(){return new ke(e)})),e.addRpcMethod((function(){return new Ce(e)}))}}]),l}(l.Z)},92467:function(){},53260:function(){}}]);
//# sourceMappingURL=2947.e376bb9d.chunk.js.map