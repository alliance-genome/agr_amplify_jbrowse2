"use strict";(globalThis.webpackChunk_jbrowse_web=globalThis.webpackChunk_jbrowse_web||[]).push([[4958],{14958:(e,t,s)=>{s.d(t,{C:()=>D,j:()=>U});const r=BigInt(32);"getBigInt64"in DataView||(DataView.prototype.getBigInt64=function(e,t){return function(e,t,s){const i=Number(!!s),n=Number(!s);return BigInt(e.getInt32(t,s)*n+e.getInt32(t+4,s)*i)<<r|BigInt(e.getUint32(t,s)*i+e.getUint32(t+4,s)*n)}(this,e,t)}),"getBigUint64"in DataView||(DataView.prototype.getBigUint64=function(e,t){return function(e,t,s){const i=e.getUint32(t,s),n=e.getUint32(t+4,s),o=Number(!!s),a=Number(!s);return BigInt(i*a+n*o)<<r|BigInt(i*o+n*a)}(this,e,t)}),"setBigInt64"in DataView||(DataView.prototype.setBigInt64=function(e,t,s){!function(e,t,s,i){const n=Number(s>>r),o=Number(s&BigInt(4294967295));i?(e.setInt32(t+4,n,i),e.setUint32(t,o,i)):(e.setInt32(t,n,i),e.setUint32(t+4,o,i))}(this,e,t,s)}),"setBigUint64"in DataView||(DataView.prototype.setBigUint64=function(e,t,s){!function(e,t,s,i){const n=Number(s>>r),o=Number(s&BigInt(4294967295));i?(e.setUint32(t+4,n,i),e.setUint32(t,o,i)):(e.setUint32(t,n,i),e.setUint32(t+4,o,i))}(this,e,t,s)});var i=s(35451);class n{constructor(e,t){this.code="",this.scopes=[["vars"]],this.bitFields=[],this.tmpVariableCount=0,this.references=new Map,this.imports=[],this.reverseImports=new Map,this.useContextVariables=!1,this.importPath=e,this.useContextVariables=t}generateVariable(e){const t=[...this.scopes[this.scopes.length-1]];return e&&t.push(e),t.join(".")}generateOption(e){switch(typeof e){case"number":return e.toString();case"string":return this.generateVariable(e);case"function":return`${this.addImport(e)}.call(${this.generateVariable()}, vars)`}}generateError(e){this.pushCode(`throw new Error(${e});`)}generateTmpVariable(){return"$tmp"+this.tmpVariableCount++}pushCode(e){this.code+=e+"\n"}pushPath(e){e&&this.scopes[this.scopes.length-1].push(e)}popPath(e){e&&this.scopes[this.scopes.length-1].pop()}pushScope(e){this.scopes.push([e])}popScope(){this.scopes.pop()}addImport(e){if(!this.importPath)return`(${e})`;let t=this.reverseImports.get(e);return t||(t=this.imports.push(e)-1,this.reverseImports.set(e,t)),`${this.importPath}[${t}]`}addReference(e){this.references.has(e)||this.references.set(e,{resolved:!1,requested:!1})}markResolved(e){const t=this.references.get(e);t&&(t.resolved=!0)}markRequested(e){e.forEach((e=>{const t=this.references.get(e);t&&(t.requested=!0)}))}getUnresolvedReferences(){return Array.from(this.references).filter((([e,t])=>!t.resolved&&!t.requested)).map((([e,t])=>e))}}const o=new Map,a="___parser_",h={uint8:1,uint16le:2,uint16be:2,uint32le:4,uint32be:4,int8:1,int16le:2,int16be:2,int32le:4,int32be:4,int64be:8,int64le:8,uint64be:8,uint64le:8,floatle:4,floatbe:4,doublele:8,doublebe:8},f={uint8:"Uint8",uint16le:"Uint16",uint16be:"Uint16",uint32le:"Uint32",uint32be:"Uint32",int8:"Int8",int16le:"Int16",int16be:"Int16",int32le:"Int32",int32be:"Int32",int64be:"BigInt64",int64le:"BigInt64",uint64be:"BigUint64",uint64le:"BigUint64",floatle:"Float32",floatbe:"Float32",doublele:"Float64",doublebe:"Float64"},u={uint8:!1,uint16le:!0,uint16be:!1,uint32le:!0,uint32be:!1,int8:!1,int16le:!0,int16be:!1,int32le:!0,int32be:!1,int64be:!1,int64le:!0,uint64be:!1,uint64le:!0,floatle:!0,floatbe:!1,doublele:!0,doublebe:!1};class p{constructor(){this.varName="",this.type="",this.options={},this.endian="be",this.useContextVariables=!1}static start(){return new p}primitiveGenerateN(e,t){const s=f[e],r=u[e];t.pushCode(`${t.generateVariable(this.varName)} = dataView.get${s}(offset, ${r});`),t.pushCode(`offset += ${h[e]};`)}primitiveN(e,t,s){return this.setNextParser(e,t,s)}useThisEndian(e){return e+this.endian.toLowerCase()}uint8(e,t={}){return this.primitiveN("uint8",e,t)}uint16(e,t={}){return this.primitiveN(this.useThisEndian("uint16"),e,t)}uint16le(e,t={}){return this.primitiveN("uint16le",e,t)}uint16be(e,t={}){return this.primitiveN("uint16be",e,t)}uint32(e,t={}){return this.primitiveN(this.useThisEndian("uint32"),e,t)}uint32le(e,t={}){return this.primitiveN("uint32le",e,t)}uint32be(e,t={}){return this.primitiveN("uint32be",e,t)}int8(e,t={}){return this.primitiveN("int8",e,t)}int16(e,t={}){return this.primitiveN(this.useThisEndian("int16"),e,t)}int16le(e,t={}){return this.primitiveN("int16le",e,t)}int16be(e,t={}){return this.primitiveN("int16be",e,t)}int32(e,t={}){return this.primitiveN(this.useThisEndian("int32"),e,t)}int32le(e,t={}){return this.primitiveN("int32le",e,t)}int32be(e,t={}){return this.primitiveN("int32be",e,t)}bigIntVersionCheck(){if(!DataView.prototype.getBigInt64)throw new Error("BigInt64 is unsupported on this runtime")}int64(e,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("int64"),e,t)}int64be(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64be",e,t)}int64le(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("int64le",e,t)}uint64(e,t={}){return this.bigIntVersionCheck(),this.primitiveN(this.useThisEndian("uint64"),e,t)}uint64be(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64be",e,t)}uint64le(e,t={}){return this.bigIntVersionCheck(),this.primitiveN("uint64le",e,t)}floatle(e,t={}){return this.primitiveN("floatle",e,t)}floatbe(e,t={}){return this.primitiveN("floatbe",e,t)}doublele(e,t={}){return this.primitiveN("doublele",e,t)}doublebe(e,t={}){return this.primitiveN("doublebe",e,t)}bitN(e,t,s){return s.length=e,this.setNextParser("bit",t,s)}bit1(e,t={}){return this.bitN(1,e,t)}bit2(e,t={}){return this.bitN(2,e,t)}bit3(e,t={}){return this.bitN(3,e,t)}bit4(e,t={}){return this.bitN(4,e,t)}bit5(e,t={}){return this.bitN(5,e,t)}bit6(e,t={}){return this.bitN(6,e,t)}bit7(e,t={}){return this.bitN(7,e,t)}bit8(e,t={}){return this.bitN(8,e,t)}bit9(e,t={}){return this.bitN(9,e,t)}bit10(e,t={}){return this.bitN(10,e,t)}bit11(e,t={}){return this.bitN(11,e,t)}bit12(e,t={}){return this.bitN(12,e,t)}bit13(e,t={}){return this.bitN(13,e,t)}bit14(e,t={}){return this.bitN(14,e,t)}bit15(e,t={}){return this.bitN(15,e,t)}bit16(e,t={}){return this.bitN(16,e,t)}bit17(e,t={}){return this.bitN(17,e,t)}bit18(e,t={}){return this.bitN(18,e,t)}bit19(e,t={}){return this.bitN(19,e,t)}bit20(e,t={}){return this.bitN(20,e,t)}bit21(e,t={}){return this.bitN(21,e,t)}bit22(e,t={}){return this.bitN(22,e,t)}bit23(e,t={}){return this.bitN(23,e,t)}bit24(e,t={}){return this.bitN(24,e,t)}bit25(e,t={}){return this.bitN(25,e,t)}bit26(e,t={}){return this.bitN(26,e,t)}bit27(e,t={}){return this.bitN(27,e,t)}bit28(e,t={}){return this.bitN(28,e,t)}bit29(e,t={}){return this.bitN(29,e,t)}bit30(e,t={}){return this.bitN(30,e,t)}bit31(e,t={}){return this.bitN(31,e,t)}bit32(e,t={}){return this.bitN(32,e,t)}namely(e){return o.set(e,this),this.alias=e,this}skip(e,t={}){return this.seek(e,t)}seek(e,t={}){if(t.assert)throw new Error("assert option on seek is not allowed.");return this.setNextParser("seek","",{length:e})}string(e,t){if(!t.zeroTerminated&&!t.length&&!t.greedy)throw new Error("One of length, zeroTerminated, or greedy must be defined for string.");if((t.zeroTerminated||t.length)&&t.greedy)throw new Error("greedy is mutually exclusive with length and zeroTerminated for string.");if(t.stripNull&&!t.length&&!t.greedy)throw new Error("length or greedy must be defined if stripNull is enabled.");return t.encoding=t.encoding||"utf8",this.setNextParser("string",e,t)}buffer(e,t){if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for buffer.");return this.setNextParser("buffer",e,t)}wrapped(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t||!t.wrapper||!t.type)throw new Error("Both wrapper and type must be defined for wrapped.");if(!t.length&&!t.readUntil)throw new Error("length or readUntil must be defined for wrapped.");return this.setNextParser("wrapper",e,t)}array(e,t){if(!t.readUntil&&!t.length&&!t.lengthInBytes)throw new Error("One of readUntil, length and lengthInBytes must be defined for array.");if(!t.type)throw new Error("type is required for array.");if("string"==typeof t.type&&!o.has(t.type)&&!(t.type in h))throw new Error(`Array element type "${t.type}" is unkown.`);return this.setNextParser("array",e,t)}choice(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t)throw new Error("tag and choices are are required for choice.");if(!t.tag)throw new Error("tag is requird for choice.");if(!t.choices)throw new Error("choices is required for choice.");for(const e in t.choices){const s=parseInt(e,10),r=t.choices[s];if(isNaN(s))throw new Error(`Choice key "${e}" is not a number.`);if("string"==typeof r&&!o.has(r)&&!(r in h))throw new Error(`Choice type "${r}" is unkown.`)}return this.setNextParser("choice",e,t)}nest(e,t){if("object"!=typeof t&&"object"==typeof e&&(t=e,e=""),!t||!t.type)throw new Error("type is required for nest.");if(!(t.type instanceof p||o.has(t.type)))throw new Error("type must be a known parser name or a Parser object.");if(!(t.type instanceof p||e))throw new Error("type must be a Parser object if the variable name is omitted.");return this.setNextParser("nest",e,t)}pointer(e,t){if(!t.offset)throw new Error("offset is required for pointer.");if(!t.type)throw new Error("type is required for pointer.");if("string"==typeof t.type&&!(t.type in h)&&!o.has(t.type))throw new Error(`Pointer type "${t.type}" is unkown.`);return this.setNextParser("pointer",e,t)}saveOffset(e,t={}){return this.setNextParser("saveOffset",e,t)}endianness(e){switch(e.toLowerCase()){case"little":this.endian="le";break;case"big":this.endian="be";break;default:throw new Error('endianness must be one of "little" or "big"')}return this}endianess(e){return this.endianness(e)}useContextVars(e=!0){return this.useContextVariables=e,this}create(e){if(!(e instanceof Function))throw new Error("Constructor must be a Function object.");return this.constructorFn=e,this}getContext(e){const t=new n(e,this.useContextVariables);return t.pushCode("var dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.alias?(this.addAliasedCode(t),t.pushCode(`return ${a+this.alias}(0).result;`)):this.addRawCode(t),t}getCode(){return this.getContext("imports").code}addRawCode(e){e.pushCode("var offset = 0;"),e.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),e.pushCode("vars.$parent = null;"),e.pushCode("vars.$root = vars;"),this.generate(e),this.resolveReferences(e),e.pushCode("delete vars.$parent;"),e.pushCode("delete vars.$root;"),e.pushCode("return vars;")}addAliasedCode(e){return e.pushCode(`function ${a+this.alias}(offset, context) {`),e.pushCode(`var vars = ${this.constructorFn?"new constructorFn()":"{}"};`),e.pushCode("var ctx = Object.assign({$parent: null, $root: vars}, context || {});"),e.pushCode("vars = Object.assign(vars, ctx);"),this.generate(e),e.markResolved(this.alias),this.resolveReferences(e),e.pushCode("Object.keys(ctx).forEach(function (item) { delete vars[item]; });"),e.pushCode("return { offset: offset, result: vars };"),e.pushCode("}"),e}resolveReferences(e){const t=e.getUnresolvedReferences();e.markRequested(t),t.forEach((t=>{var s;null===(s=o.get(t))||void 0===s||s.addAliasedCode(e)}))}compile(){const e="imports",t=this.getContext(e);this.compiled=new Function(e,"TextDecoder",`return function (buffer, constructorFn) { ${t.code} };`)(t.imports,TextDecoder)}sizeOf(){let e=NaN;if(Object.keys(h).indexOf(this.type)>=0)e=h[this.type];else if("string"===this.type&&"number"==typeof this.options.length)e=this.options.length;else if("buffer"===this.type&&"number"==typeof this.options.length)e=this.options.length;else if("array"===this.type&&"number"==typeof this.options.length){let t=NaN;"string"==typeof this.options.type?t=h[this.options.type]:this.options.type instanceof p&&(t=this.options.type.sizeOf()),e=this.options.length*t}else"seek"===this.type?e=this.options.length:"nest"===this.type?e=this.options.type.sizeOf():this.type||(e=0);return this.next&&(e+=this.next.sizeOf()),e}parse(e){return this.compiled||this.compile(),this.compiled(e,this.constructorFn)}setNextParser(e,t,s){const r=new p;return r.type=e,r.varName=t,r.options=s,r.endian=this.endian,this.head?this.head.next=r:this.next=r,this.head=r,this}generate(e){if(this.type){switch(this.type){case"uint8":case"uint16le":case"uint16be":case"uint32le":case"uint32be":case"int8":case"int16le":case"int16be":case"int32le":case"int32be":case"int64be":case"int64le":case"uint64be":case"uint64le":case"floatle":case"floatbe":case"doublele":case"doublebe":this.primitiveGenerateN(this.type,e);break;case"bit":this.generateBit(e);break;case"string":this.generateString(e);break;case"buffer":this.generateBuffer(e);break;case"seek":this.generateSeek(e);break;case"nest":this.generateNest(e);break;case"array":this.generateArray(e);break;case"choice":this.generateChoice(e);break;case"pointer":this.generatePointer(e);break;case"saveOffset":this.generateSaveOffset(e);break;case"wrapper":this.generateWrapper(e)}"bit"!==this.type&&this.generateAssert(e)}const t=e.generateVariable(this.varName);return this.options.formatter&&"bit"!==this.type&&this.generateFormatter(e,t,this.options.formatter),this.generateNext(e)}generateAssert(e){if(!this.options.assert)return;const t=e.generateVariable(this.varName);switch(typeof this.options.assert){case"function":{const s=e.addImport(this.options.assert);e.pushCode(`if (!${s}.call(vars, ${t})) {`)}break;case"number":e.pushCode(`if (${this.options.assert} !== ${t}) {`);break;case"string":e.pushCode(`if (${JSON.stringify(this.options.assert)} !== ${t}) {`);break;default:throw new Error("assert option must be a string, number or a function.")}e.generateError(`"Assertion error: ${t} is " + ${JSON.stringify(this.options.assert.toString())}`),e.pushCode("}")}generateNext(e){return this.next&&(e=this.next.generate(e)),e}generateBit(e){const t=JSON.parse(JSON.stringify(this));if(t.options=this.options,t.generateAssert=this.generateAssert.bind(this),t.generateFormatter=this.generateFormatter.bind(this),t.varName=e.generateVariable(t.varName),e.bitFields.push(t),!this.next||this.next&&["bit","nest"].indexOf(this.next.type)<0){const t=e.generateTmpVariable();e.pushCode(`var ${t} = 0;`);const s=(t=0)=>{let s=0;for(let r=t;r<e.bitFields.length;r++){const t=e.bitFields[r].options.length;if(s+t>32)break;s+=t}return s},r=s=>(s<=8?(e.pushCode(`${t} = dataView.getUint8(offset);`),s=8):s<=16?(e.pushCode(`${t} = dataView.getUint16(offset);`),s=16):s<=24?(e.pushCode(`${t} = (dataView.getUint16(offset) << 8) | dataView.getUint8(offset + 2);`),s=24):(e.pushCode(`${t} = dataView.getUint32(offset);`),s=32),e.pushCode(`offset += ${s/8};`),s);let i=0;const n="be"===this.endian;let o=0,a=0;e.bitFields.forEach(((h,f)=>{let u=h.options.length;if(u>a){if(a){const s=-1>>>32-a;e.pushCode(`${h.varName} = (${t} & 0x${s.toString(16)}) << ${u-a};`),u-=a}i=0,a=o=r(s(f)-a)}const p=n?o-i-u:i,c=-1>>>32-u;e.pushCode(`${h.varName} ${u<h.options.length?"|=":"="} ${t} >> ${p} & 0x${c.toString(16)};`),32===h.options.length&&e.pushCode(`${h.varName} >>>= 0`),h.options.assert&&h.generateAssert(e),h.options.formatter&&h.generateFormatter(e,h.varName,h.options.formatter),i+=u,a-=u})),e.bitFields=[]}}generateSeek(e){const t=e.generateOption(this.options.length);e.pushCode(`offset += ${t};`)}generateString(e){const t=e.generateVariable(this.varName),s=e.generateTmpVariable(),r=this.options.encoding,i="hex"===r.toLowerCase(),n='b => b.toString(16).padStart(2, "0")';if(this.options.length&&this.options.zeroTerminated){const o=this.options.length;e.pushCode(`var ${s} = offset;`),e.pushCode(`while(dataView.getUint8(offset++) !== 0 && offset - ${s} < ${o});`);const a=`offset - ${s} < ${o} ? offset - 1 : offset`;e.pushCode(i?`${t} = Array.from(buffer.subarray(${s}, ${a}), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${s}, ${a}));`)}else if(this.options.length){const s=e.generateOption(this.options.length);e.pushCode(i?`${t} = Array.from(buffer.subarray(offset, offset + ${s}), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(offset, offset + ${s}));`),e.pushCode(`offset += ${s};`)}else this.options.zeroTerminated?(e.pushCode(`var ${s} = offset;`),e.pushCode("while(dataView.getUint8(offset++) !== 0);"),e.pushCode(i?`${t} = Array.from(buffer.subarray(${s}, offset - 1), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${s}, offset - 1));`)):this.options.greedy&&(e.pushCode(`var ${s} = offset;`),e.pushCode("while(buffer.length > offset++);"),e.pushCode(i?`${t} = Array.from(buffer.subarray(${s}, offset), ${n}).join('');`:`${t} = new TextDecoder('${r}').decode(buffer.subarray(${s}, offset));`));this.options.stripNull&&e.pushCode(`${t} = ${t}.replace(/\\x00+$/g, '')`)}generateBuffer(e){const t=e.generateVariable(this.varName);if("function"==typeof this.options.readUntil){const s=this.options.readUntil,r=e.generateTmpVariable(),i=e.generateTmpVariable();e.pushCode(`var ${r} = offset;`),e.pushCode(`var ${i} = 0;`),e.pushCode("while (offset < buffer.length) {"),e.pushCode(`${i} = dataView.getUint8(offset);`);const n=e.addImport(s);e.pushCode(`if (${n}.call(${e.generateVariable()}, ${i}, buffer.subarray(offset))) break;`),e.pushCode("offset += 1;"),e.pushCode("}"),e.pushCode(`${t} = buffer.subarray(${r}, offset);`)}else if("eof"===this.options.readUntil)e.pushCode(`${t} = buffer.subarray(offset);`);else{const s=e.generateOption(this.options.length);e.pushCode(`${t} = buffer.subarray(offset, offset + ${s});`),e.pushCode(`offset += ${s};`)}this.options.clone&&e.pushCode(`${t} = buffer.constructor.from(${t});`)}generateArray(e){const t=e.generateOption(this.options.length),s=e.generateOption(this.options.lengthInBytes),r=this.options.type,i=e.generateTmpVariable(),n=e.generateVariable(this.varName),c=e.generateTmpVariable(),d=this.options.key,l="string"==typeof d;if(l?e.pushCode(`${n} = {};`):e.pushCode(`${n} = [];`),"function"==typeof this.options.readUntil?e.pushCode("do {"):"eof"===this.options.readUntil?e.pushCode(`for (var ${i} = 0; offset < buffer.length; ${i}++) {`):void 0!==s?e.pushCode(`for (var ${i} = offset + ${s}; offset < ${i}; ) {`):e.pushCode(`for (var ${i} = ${t}; ${i} > 0; ${i}--) {`),"string"==typeof r)if(o.get(r)){const n=e.generateTmpVariable();if(e.pushCode(`var ${n} = ${a+r}(offset, {`),e.useContextVariables){const r=e.generateVariable();e.pushCode(`$parent: ${r},`),e.pushCode(`$root: ${r}.$root,`),this.options.readUntil||void 0!==s||e.pushCode(`$index: ${t} - ${i},`)}e.pushCode("});"),e.pushCode(`var ${c} = ${n}.result; offset = ${n}.offset;`),r!==this.alias&&e.addReference(r)}else{const t=f[r],s=u[r];e.pushCode(`var ${c} = dataView.get${t}(offset, ${s});`),e.pushCode(`offset += ${h[r]};`)}else if(r instanceof p){e.pushCode(`var ${c} = {};`);const n=e.generateVariable();e.pushScope(c),e.useContextVariables&&(e.pushCode(`${c}.$parent = ${n};`),e.pushCode(`${c}.$root = ${n}.$root;`),this.options.readUntil||void 0!==s||e.pushCode(`${c}.$index = ${t} - ${i};`)),r.generate(e),e.useContextVariables&&(e.pushCode(`delete ${c}.$parent;`),e.pushCode(`delete ${c}.$root;`),e.pushCode(`delete ${c}.$index;`)),e.popScope()}if(l?e.pushCode(`${n}[${c}.${d}] = ${c};`):e.pushCode(`${n}.push(${c});`),e.pushCode("}"),"function"==typeof this.options.readUntil){const t=this.options.readUntil,s=e.addImport(t);e.pushCode(`while (!${s}.call(${e.generateVariable()}, ${c}, buffer.subarray(offset)));`)}}generateChoiceCase(e,t,s){if("string"==typeof s){const t=e.generateVariable(this.varName);if(o.has(s)){const r=e.generateTmpVariable();e.pushCode(`var ${r} = ${a+s}(offset, {`),e.useContextVariables&&(e.pushCode(`$parent: ${t}.$parent,`),e.pushCode(`$root: ${t}.$root,`)),e.pushCode("});"),e.pushCode(`${t} = ${r}.result; offset = ${r}.offset;`),s!==this.alias&&e.addReference(s)}else{const r=f[s],i=u[s];e.pushCode(`${t} = dataView.get${r}(offset, ${i});`),e.pushCode(`offset += ${h[s]}`)}}else s instanceof p&&(e.pushPath(t),s.generate(e),e.popPath(t))}generateChoice(e){const t=e.generateOption(this.options.tag),s=e.generateVariable(this.varName);if(this.varName&&(e.pushCode(`${s} = {};`),e.useContextVariables)){const t=e.generateVariable();e.pushCode(`${s}.$parent = ${t};`),e.pushCode(`${s}.$root = ${t}.$root;`)}e.pushCode(`switch(${t}) {`);for(const t in this.options.choices){const s=parseInt(t,10),r=this.options.choices[s];e.pushCode(`case ${s}:`),this.generateChoiceCase(e,this.varName,r),e.pushCode("break;")}e.pushCode("default:"),this.options.defaultChoice?this.generateChoiceCase(e,this.varName,this.options.defaultChoice):e.generateError(`"Met undefined tag value " + ${t} + " at choice"`),e.pushCode("}"),this.varName&&e.useContextVariables&&(e.pushCode(`delete ${s}.$parent;`),e.pushCode(`delete ${s}.$root;`))}generateNest(e){const t=e.generateVariable(this.varName);if(this.options.type instanceof p){if(this.varName&&(e.pushCode(`${t} = {};`),e.useContextVariables)){const s=e.generateVariable();e.pushCode(`${t}.$parent = ${s};`),e.pushCode(`${t}.$root = ${s}.$root;`)}e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName),this.varName&&e.useContextVariables&&e.useContextVariables&&(e.pushCode(`delete ${t}.$parent;`),e.pushCode(`delete ${t}.$root;`))}else if(o.has(this.options.type)){const s=e.generateTmpVariable();if(e.pushCode(`var ${s} = ${a+this.options.type}(offset, {`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`$parent: ${t},`),e.pushCode(`$root: ${t}.$root,`)}e.pushCode("});"),e.pushCode(`${t} = ${s}.result; offset = ${s}.offset;`),this.options.type!==this.alias&&e.addReference(this.options.type)}}generateWrapper(e){const t=e.generateVariable(this.varName),s=e.generateTmpVariable();if("function"==typeof this.options.readUntil){const t=this.options.readUntil,r=e.generateTmpVariable(),i=e.generateTmpVariable();e.pushCode(`var ${r} = offset;`),e.pushCode(`var ${i} = 0;`),e.pushCode("while (offset < buffer.length) {"),e.pushCode(`${i} = dataView.getUint8(offset);`);const n=e.addImport(t);e.pushCode(`if (${n}.call(${e.generateVariable()}, ${i}, buffer.subarray(offset))) break;`),e.pushCode("offset += 1;"),e.pushCode("}"),e.pushCode(`${s} = buffer.subarray(${r}, offset);`)}else if("eof"===this.options.readUntil)e.pushCode(`${s} = buffer.subarray(offset);`);else{const t=e.generateOption(this.options.length);e.pushCode(`${s} = buffer.subarray(offset, offset + ${t});`),e.pushCode(`offset += ${t};`)}this.options.clone&&e.pushCode(`${s} = buffer.constructor.from(${s});`);const r=e.generateTmpVariable(),i=e.generateTmpVariable(),n=e.generateTmpVariable(),h=e.addImport(this.options.wrapper);if(e.pushCode(`${s} = ${h}.call(this, ${s}).subarray(0);`),e.pushCode(`var ${r} = buffer;`),e.pushCode(`var ${i} = offset;`),e.pushCode(`var ${n} = dataView;`),e.pushCode(`buffer = ${s};`),e.pushCode("offset = 0;"),e.pushCode("dataView = new DataView(buffer.buffer, buffer.byteOffset, buffer.length);"),this.options.type instanceof p)this.varName&&e.pushCode(`${t} = {};`),e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName);else if(o.has(this.options.type)){const s=e.generateTmpVariable();e.pushCode(`var ${s} = ${a+this.options.type}(0);`),e.pushCode(`${t} = ${s}.result;`),this.options.type!==this.alias&&e.addReference(this.options.type)}e.pushCode(`buffer = ${r};`),e.pushCode(`dataView = ${n};`),e.pushCode(`offset = ${i};`)}generateFormatter(e,t,s){if("function"==typeof s){const r=e.addImport(s);e.pushCode(`${t} = ${r}.call(${e.generateVariable()}, ${t});`)}}generatePointer(e){const t=this.options.type,s=e.generateOption(this.options.offset),r=e.generateTmpVariable(),i=e.generateVariable(this.varName);if(e.pushCode(`var ${r} = offset;`),e.pushCode(`offset = ${s};`),this.options.type instanceof p){if(e.pushCode(`${i} = {};`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`${i}.$parent = ${t};`),e.pushCode(`${i}.$root = ${t}.$root;`)}e.pushPath(this.varName),this.options.type.generate(e),e.popPath(this.varName),e.useContextVariables&&(e.pushCode(`delete ${i}.$parent;`),e.pushCode(`delete ${i}.$root;`))}else if(o.has(this.options.type)){const t=e.generateTmpVariable();if(e.pushCode(`var ${t} = ${a+this.options.type}(offset, {`),e.useContextVariables){const t=e.generateVariable();e.pushCode(`$parent: ${t},`),e.pushCode(`$root: ${t}.$root,`)}e.pushCode("});"),e.pushCode(`${i} = ${t}.result; offset = ${t}.offset;`),this.options.type!==this.alias&&e.addReference(this.options.type)}else if(Object.keys(h).indexOf(this.options.type)>=0){const s=f[t],r=u[t];e.pushCode(`${i} = dataView.get${s}(offset, ${r});`),e.pushCode(`offset += ${h[t]};`)}e.pushCode(`offset = ${r};`)}generateSaveOffset(e){const t=e.generateVariable(this.varName);e.pushCode(`${t} = offset`)}}var c=s(5742),d=s.n(c),l=s(16308),b=s.n(l);class g{constructor(e){this.ranges=e}get min(){return this.ranges[0].min}get max(){return this.ranges[this.ranges.length-1].max}contains(e){for(const t of this.ranges)if(t.min<=e&&t.max>=e)return!0;return!1}isContiguous(){return this.ranges.length>1}getRanges(){return this.ranges.map((e=>new g([{min:e.min,max:e.max}])))}toString(){return this.ranges.map((e=>`[${e.min}-${e.max}]`)).join(",")}union(e){const t=[...this.getRanges(),...e.getRanges()].sort(((e,t)=>e.min<t.min?-1:e.min>t.min?1:e.max<t.max?-1:t.max>e.max?1:0)),s=[];let r=t[0];for(const e of t)e.min>r.max+1?(s.push(r),r=e):e.max>r.max&&(r=new g([{min:r.min,max:e.max}]));return s.push(r),1===s.length?s[0]:new g(s)}}var m=s(25469);class $ extends Error{constructor(e){super(e),this.code="ERR_ABORTED"}}function y(e){if(e&&e.aborted){if("undefined"==typeof DOMException){const e=new $("aborted");throw e.code="ERR_ABORTED",e}throw new DOMException("aborted","AbortError")}}const w=1,C=2,N=3;function v(e,t,s,r){return e<r&&t>=s}class x{constructor(e,t,s,r,n,o){if(this.bbi=e,this.refsByName=t,this.cirTreeOffset=s,this.isBigEndian=r,this.isCompressed=n,this.blockType=o,this.featureCache=new(d())({cache:new(b())({maxSize:1e3}),fill:async(e,t)=>{const s=Number(e.length),r=Number(e.offset),{buffer:n}=await this.bbi.read(i.Buffer.alloc(s),0,s,r,{signal:t});return n}}),!(s>=0))throw new Error("invalid cirTreeOffset!");const a=function(e){const t=e?"big":"little",s=(new p).endianess(t).uint32("chromId").uint32("start").uint32("end").uint32("validCnt").floatle("minScore").floatle("maxScore").floatle("sumData").floatle("sumSqData").saveOffset("offset"),r=(new p).endianess(t).uint8("isLeaf").skip(1).uint16("cnt").choice({tag:"isLeaf",choices:{1:(new p).endianess(t).array("blocksToFetch",{length:"cnt",type:(new p).endianess(t).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").uint64("blockSize").saveOffset("offset")}),0:(new p).array("recurOffsets",{length:"cnt",type:(new p).endianess(t).uint32("startChrom").uint32("startBase").uint32("endChrom").uint32("endBase").uint64("blockOffset").saveOffset("offset")})}}),i=(new p).endianess(t).uint32("chromId").int32("start").int32("end").string("rest",{zeroTerminated:!0}).saveOffset("offset");return{bigWigParser:(new p).endianess(t).skip(4).int32("blockStart").skip(4).uint32("itemStep").uint32("itemSpan").uint8("blockType").skip(1).uint16("itemCount").choice({tag:"blockType",choices:{[N]:(new p).array("items",{length:"itemCount",type:(new p).floatle("score")}),[C]:(new p).array("items",{length:"itemCount",type:(new p).endianess(t).int32("start").floatle("score")}),[w]:(new p).array("items",{length:"itemCount",type:(new p).endianess(t).int32("start").int32("end").floatle("score")})}}),bigBedParser:i,summaryParser:s,leafParser:r}}(r);this.leafParser=a.leafParser,this.bigBedParser=a.bigBedParser}async readWigData(e,t,s,r,n){try{const{refsByName:o,bbi:a,cirTreeOffset:h,isBigEndian:f}=this,u=o[e];void 0===u&&r.complete();const p={chrId:u,start:t,end:s};this.cirTreePromise||(this.cirTreePromise=a.read(i.Buffer.alloc(48),0,48,Number(h),n));const{buffer:c}=await this.cirTreePromise,d=f?c.readUInt32BE(4):c.readUInt32LE(4);let l=[],b=0;const m=(e,t,s)=>{try{const r=e.subarray(t),i=this.leafParser.parse(r);if(i.blocksToFetch&&(l=l.concat(i.blocksToFetch.filter((e=>$(e))).map((e=>({offset:e.blockOffset,length:e.blockSize}))))),i.recurOffsets){const e=i.recurOffsets.filter((e=>$(e))).map((e=>Number(e.blockOffset)));e.length>0&&w(e,s+1)}}catch(e){r.error(e)}},$=e=>{const{startChrom:r,startBase:i,endChrom:n,endBase:o}=e;return(r<u||r===u&&i<=s)&&(n>u||n===u&&o>=t)},y=async(e,t,s)=>{try{const i=t.max-t.min,o=t.min,a=await this.featureCache.get(`${i}_${o}`,{length:i,offset:o},null==n?void 0:n.signal);for(const i of e)t.contains(i)&&(m(a,i-o,s),b-=1,0===b&&this.readFeatures(r,l,{...n,request:p}).catch((e=>r.error(e))))}catch(e){r.error(e)}},w=(e,t)=>{try{b+=e.length;const s=4+32*Number(d);let r=new g([{min:e[0],max:e[0]+s}]);for(let t=1;t<e.length;t+=1){const i=new g([{min:e[t],max:e[t]+s}]);r=r.union(i)}r.getRanges().map((s=>y(e,s,t)))}catch(e){r.error(e)}};return w([Number(h)+48],1)}catch(e){r.error(e)}}parseSummaryBlock(e,t,s){const r=[];let i=t;const n=new DataView(e.buffer,e.byteOffset,e.length);for(;i<e.byteLength;){const e=n.getUint32(i,!0);i+=4;const t=n.getUint32(i,!0);i+=4;const o=n.getUint32(i,!0);i+=4;const a=n.getUint32(i,!0);i+=4;const h=n.getFloat32(i,!0);i+=4;const f=n.getFloat32(i,!0);i+=4;const u=n.getFloat32(i,!0);i+=4,i+=4,(!s||e===s.chrId&&v(t,o,s.start,s.end))&&r.push({start:t,end:o,maxScore:f,minScore:h,summary:!0,score:u/(a||1)})}return r}parseBigBedBlock(e,t,s,r){const i=[];let n=t;for(;n<e.byteLength;){const t=this.bigBedParser.parse(e.subarray(n));t.uniqueId=`bb-${s+n}`,i.push(t),n+=t.offset}return r?i.filter((e=>v(e.start,e.end,r.start,r.end))):i}parseBigWigBlock(e,t,s){const r=e.subarray(t),i=new DataView(r.buffer,r.byteOffset,r.length);let n=0;n+=4;const o=i.getInt32(n,!0);n+=8;const a=i.getUint32(n,!0);n+=4;const h=i.getUint32(n,!0);n+=4;const f=i.getUint8(n);n+=2;const u=i.getUint16(n,!0);n+=2;const p=new Array(u);switch(f){case 1:for(let e=0;e<u;e++){const t=i.getInt32(n,!0);n+=4;const s=i.getInt32(n,!0);n+=4;const r=i.getFloat32(n,!0);n+=4,p[e]={start:t,end:s,score:r}}break;case 2:for(let e=0;e<u;e++){const t=i.getInt32(n,!0);n+=4;const s=i.getFloat32(n,!0);n+=4,p[e]={score:s,start:t,end:t+h}}break;case 3:for(let e=0;e<u;e++){const t=i.getFloat32(n,!0);n+=4;const s=o+e*a;p[e]={score:t,start:s,end:s+h}}}return s?p.filter((e=>v(e.start,e.end,s.start,s.end))):p}async readFeatures(e,t,s={}){try{const{blockType:r,isCompressed:i}=this,{signal:n,request:o}=s,a=function(e){e.sort(((e,t)=>Number(e.offset)-Number(t.offset)));const t=[];let s,r;for(const i of e)s&&r&&Number(i.offset)-r<=2e3?(s.length=BigInt(Number(s.length)+Number(i.length)-r+Number(i.offset)),s.blocks.push(i)):t.push(s={blocks:[i],length:i.length,offset:i.offset}),r=Number(s.offset)+Number(s.length);return t}(t);y(n),await Promise.all(a.map((async t=>{y(n);const{length:s,offset:a}=t,h=await this.featureCache.get(`${s}_${a}`,t,n);for(const s of t.blocks){y(n);let a=Number(s.offset)-Number(t.offset),u=h;switch(i&&(f=h.subarray(a),u=(0,m.wS)(f.subarray(2)),a=0),y(n),r){case"summary":e.next(this.parseSummaryBlock(u,a,o));break;case"bigwig":e.next(this.parseBigWigBlock(u,a,o));break;case"bigbed":e.next(this.parseBigBedBlock(u,a,256*Number(s.offset),o));break;default:console.warn(`Don't know what to do with ${r}`)}}var f}))),e.complete()}catch(t){e.error(t)}}}var V=s(45834),k=s(89592),B=s(44728),O=s(82088);const I=-2003829722,S=-2021002517;function E(e){const t=e?"big":"little",s=(new p).endianess(t).int32("magic").uint16("version").uint16("numZoomLevels").uint64("chromTreeOffset").uint64("unzoomedDataOffset").uint64("unzoomedIndexOffset").uint16("fieldCount").uint16("definedFieldCount").uint64("asOffset").uint64("totalSummaryOffset").uint32("uncompressBufSize").uint64("extHeaderOffset").array("zoomLevels",{length:"numZoomLevels",type:(new p).endianess(t).uint32("reductionLevel").uint32("reserved").uint64("dataOffset").uint64("indexOffset")}),r=(new p).endianess(t).uint64("basesCovered").doublele("scoreMin").doublele("scoreMax").doublele("scoreSum").doublele("scoreSumSquares");return{chromTreeParser:(new p).endianess(t).uint32("magic").uint32("blockSize").uint32("keySize").uint32("valSize").uint64("itemCount"),totalSummaryParser:r,headerParser:s,isLeafNode:(new p).endianess(t).uint8("isLeafNode").skip(1).uint16("cnt").saveOffset("offset")}}class T{getHeader(e){return this.headerP||(this.headerP=this._getHeader(e).catch((e=>{throw this.headerP=void 0,e}))),this.headerP}constructor(e){const{filehandle:t,renameRefSeqs:s=(e=>e),path:r,url:i}=e;if(this.renameRefSeqs=s,t)this.bbi=t;else if(i)this.bbi=new V.Tx(i);else{if(!r)throw new Error("no file given");this.bbi=new V.EY(r)}}async _getHeader(e){const t=await this._getMainHeader(e),s=await this._readChromTree(t,e);return{...t,...s}}async _getMainHeader(e,t=2e3){const{buffer:s}=await this.bbi.read(i.Buffer.alloc(t),0,t,0,e),r=this._isBigEndian(s),n=E(r),o=n.headerParser.parse(s),{magic:a,asOffset:h,totalSummaryOffset:f}=o;if(o.fileType=a===S?"bigbed":"bigwig",h>t||f>t)return this._getMainHeader(e,2*t);if(h){const e=Number(o.asOffset);o.autoSql=(u=s.subarray(e,s.indexOf(0,e)),(new TextDecoder).decode(u))}var u;if(o.totalSummaryOffset>t-40)return this._getMainHeader(e,2*t);if(o.totalSummaryOffset){const e=s.subarray(Number(o.totalSummaryOffset)),t=n.totalSummaryParser.parse(e);o.totalSummary={...t,basesCovered:Number(t.basesCovered)}}return{...o,isBigEndian:r}}_isBigEndian(e){let t=e.readInt32LE(0);if(t===I||t===S)return!1;if(t=e.readInt32BE(0),t===I||t===S)return!0;throw new Error("not a BigWig/BigBed file")}async _readChromTree(e,t){const s=e.isBigEndian,r=s?"big":"little",n=[],o={};let a=Number(e.unzoomedDataOffset);const h=Number(e.chromTreeOffset);for(;a%4!=0;)a+=1;const f=a-h,{buffer:u}=await this.bbi.read(i.Buffer.alloc(f),0,f,Number(h),t),c=E(s),{keySize:d}=c.chromTreeParser.parse(u),l=(new p).endianess(r).string("key",{stripNull:!0,length:d}).uint32("refId").uint32("refSize").saveOffset("offset"),b=(new p).endianess(r).skip(d).uint64("childOffset").saveOffset("offset"),g=async e=>{let t=e;if(t>=u.length)throw new Error("reading beyond end of buffer");const s=c.isLeafNode.parse(u.subarray(t)),{isLeafNode:r,cnt:i}=s;if(t+=s.offset,r)for(let e=0;e<i;e+=1){const e=l.parse(u.subarray(t));t+=e.offset;const{key:s,refId:r,refSize:i}=e,a={name:s,id:r,length:i};o[this.renameRefSeqs(s)]=r,n[r]=a}else{const e=[];for(let s=0;s<i;s+=1){const s=b.parse(u.subarray(t)),{childOffset:r}=s;t+=s.offset,e.push(g(Number(r)-Number(h)))}await Promise.all(e)}};return await g(32),{refsByName:o,refsByNumber:n}}async getUnzoomedView(e){const{unzoomedIndexOffset:t,refsByName:s,uncompressBufSize:r,isBigEndian:i,fileType:n}=await this.getHeader(e);return new x(this.bbi,s,t,i,r>0,n)}async getFeatureStream(e,t,s,r){await this.getHeader(r);const i=this.renameRefSeqs(e);let n;const{basesPerSpan:o,scale:a}=r||{};return n=o?await this.getView(1/o,r):a?await this.getView(a,r):await this.getView(1,r),new k.c((e=>{n.readWigData(i,t,s,e,r).catch((t=>e.error(t)))}))}async getFeatures(e,t,s,r){const i=await this.getFeatureStream(e,t,s,r);return(await(0,B._)(i.pipe((0,O.$)()))).flat()}}class U extends T{async getView(e,t){const{zoomLevels:s,refsByName:r,fileSize:i,isBigEndian:n,uncompressBufSize:o}=await this.getHeader(t),a=1/e;let h=s.length;i||(h-=1);for(let e=h;e>=0;e-=1){const t=s[e];if(t&&t.reductionLevel<=2*a){const e=Number(t.indexOffset);return new x(this.bbi,r,e,n,o>0,"summary")}}return this.getUnzoomedView(t)}}var P=s(62718),z=s(69652),F=s(34796);class D extends T{constructor(){super(...arguments),this.readIndicesCache=new(d())({cache:new(b())({maxSize:1}),fill:(e,t)=>this._readIndices({...e,signal:t})})}readIndices(e={}){const{signal:t,...s}=e;return this.readIndicesCache.get(JSON.stringify(s),e,t)}async getView(e,t){return this.getUnzoomedView(t)}async _readIndices(e){const{extHeaderOffset:t,isBigEndian:s}=await this.getHeader(e),{buffer:r}=await this.bbi.read(i.Buffer.alloc(64),0,64,Number(t)),n=s?"big":"little",o=(new p).endianess(n).uint16("size").uint16("count").uint64("offset").parse(r),{count:a,offset:h}=o;if(0===a)return[];const f=20*a,{buffer:u}=await this.bbi.read(i.Buffer.alloc(f),0,f,Number(h)),c=(new p).endianess(n).int16("type").int16("fieldcount").uint64("offset").skip(4).int16("field"),d=[];for(let e=0;e<a;e+=1)d.push(c.parse(u.subarray(20*e)));return d}async searchExtraIndexBlocks(e,t={}){const{isBigEndian:s}=await this.getHeader(t),r=await this.readIndices(t);if(0===r.length)return[];const n=r.map((async r=>{const{offset:n,field:o}=r,{buffer:a}=await this.bbi.read(i.Buffer.alloc(32),0,32,Number(n),t),h=s?"big":"little",f=(new p).endianess(h).int32("magic").int32("blockSize").int32("keySize").int32("valSize").uint64("itemCount"),{blockSize:u,keySize:c,valSize:d}=f.parse(a),l=(new p).endianess(h).int8("nodeType").skip(1).int16("cnt").choice({tag:"nodeType",choices:{0:(new p).array("leafkeys",{length:"cnt",type:(new p).endianess(h).string("key",{length:c,stripNull:!0}).uint64("offset")}),1:(new p).array("keys",{length:"cnt",type:(new p).endianess(h).string("key",{length:c,stripNull:!0}).uint64("offset").uint32("length").uint32("reserved")})}}),b=async s=>{const r=Number(s),n=4+u*(c+d),{buffer:a}=await this.bbi.read(i.Buffer.alloc(n),0,n,r,t),h=l.parse(a);if(h.leafkeys){let t;for(const{key:s,offset:r}of h.leafkeys){if(e.localeCompare(s)<0&&t)return b(t);t=r}return b(t)}for(const t of h.keys)if(t.key===e)return{...t,field:o}};return b(Number(n)+32)}));return(await Promise.all(n)).filter((e=>!!e))}async searchExtraIndex(e,t={}){const s=await this.searchExtraIndexBlocks(e,t);if(0===s.length)return[];const r=await this.getUnzoomedView(t),i=s.map((e=>new k.c((s=>{r.readFeatures(s,[e],t).catch((e=>s.error(e)))})).pipe((0,z.T)(((e,t)=>e.concat(t))),(0,F.T)((t=>{for(const s of t)s.field=e.field;return t})))));return(await(0,B._)((0,P.h)(...i))).filter((t=>{var s;return(null===(s=t.rest)||void 0===s?void 0:s.split("\t")[(t.field||0)-3])===e}))}}}}]);
//# sourceMappingURL=4958.4c2337cc.chunk.js.map