"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[9116,7554],{47554:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var r=t(33028),s=t(96234),o=t(96902),a=t(91188),i=t(4782),c=t(99836),l=t(27664),u=t(18849),d=t(16644),m=t(78263),f=t(72988),h=t(94354),p=t(29938),v=(0,a.ZL)()((function(e){var n=e.palette,t=n.tertiary,r=n.primary;return{rubberband:{height:"100%",background:t?(0,d.Fq)(t.main,.7):(0,d.Fq)(r.main,.7),position:"absolute",zIndex:10,textAlign:"center",overflow:"hidden"},rubberbandControl:{cursor:"crosshair",width:"100%",minHeight:8},rubberbandText:{color:t?t.contrastText:r.contrastText},popover:{mouseEvents:"none",cursor:"crosshair"},paper:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1)},guide:{pointerEvents:"none",height:"100%",width:1,position:"absolute",zIndex:10},sm:{fontSize:10}}})),x=(0,i.observer)((function(e){var n=e.model,t=e.coordX,r=v().classes;return(0,p.jsx)(m.Z,{open:!0,placement:"top",title:n.views.map((function(e){return e.pxToBp(t)})).map((function(e){return(0,p.jsx)(f.Z,{className:r.sm,children:(0,l.stringify)(e)},JSON.stringify(e))})),arrow:!0,children:(0,p.jsx)("div",{className:r.guide,style:{left:t,background:"red"}})})}));var b=(0,i.observer)((function(e){var n=e.model,t=e.ControlComponent,r=void 0===t?(0,p.jsx)("div",{}):t,a=(0,o.useState)(),i=(0,s.Z)(a,2),c=i[0],d=i[1],m=(0,o.useState)(),b=(0,s.Z)(m,2),g=b[0],j=b[1],y=(0,o.useState)(),Z=(0,s.Z)(y,2),w=Z[0],k=Z[1],C=(0,o.useState)(),S=(0,s.Z)(C,2),L=S[0],M=S[1],N=(0,o.useRef)(null),A=(0,o.useRef)(null),P=v().classes,E=void 0!==c&&void 0===w;function T(e){e.preventDefault(),e.stopPropagation();var n=e.clientX-e.target.getBoundingClientRect().left;d(n),j(n)}function O(e){var n=e.target;M(e.clientX-n.getBoundingClientRect().left)}function B(){M(void 0),n.views.forEach((function(e){return e.setOffsets(void 0,void 0)}))}function F(){k(void 0),d(void 0),j(void 0)}(0,o.useEffect)((function(){function e(e){if(N.current&&E){var n=e.clientX-N.current.getBoundingClientRect().left;j(n)}}function t(e){if(void 0!==c&&N.current){var t=e.clientX,r=e.clientY,s=t-N.current.getBoundingClientRect().left;k({offsetX:s,clientX:t,clientY:r}),n.views.forEach((function(e){var n=function(e,n){if(void 0!==c){var t=c,r=e;if(r<t){var s=[r,t];t=s[0],r=s[1]}return{leftOffset:n.pxToBp(t),rightOffset:n.pxToBp(r)}}}(s,e);if(n){var t=n.leftOffset,r=n.rightOffset;e.setOffsets(t,r)}})),M(void 0)}}return E?(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),function(){window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}):function(){}}),[c,E,w,n]),(0,o.useEffect)((function(){!E&&void 0!==g&&void 0!==c&&Math.abs(g-c)<=3&&F()}),[E,g,c]);var I=Boolean(w);if(void 0===c)return(0,p.jsxs)(p.Fragment,{children:[void 0!==L?(0,p.jsx)(x,{model:n,coordX:L}):null,(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:P.rubberbandControl,role:"presentation",ref:N,onMouseDown:T,onMouseOut:B,onMouseMove:O,children:r})]});var R=w?w.offsetX:g||0,z=R<c?R:c,q=Math.abs(R-c),D=n.views,X=D.map((function(e){return e.pxToBp(z)})),H=D.map((function(e){return e.pxToBp(z+q)})),V=D.map((function(e){return Math.ceil(q*e.bpPerPx)}));return(0,p.jsxs)(p.Fragment,{children:[A.current?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(h.ZP,{className:P.popover,classes:{paper:P.paper},open:!0,anchorEl:A.current,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,disableRestoreFocus:!0,children:X.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))}),(0,p.jsx)(h.ZP,{className:P.popover,classes:{paper:P.paper},open:!0,anchorEl:A.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,disableRestoreFocus:!0,children:H.map((function(e){return(0,p.jsx)(f.Z,{children:(0,l.stringify)(e)},JSON.stringify(e))}))})]}):null,(0,p.jsx)("div",{ref:A,className:P.rubberband,style:{left:z,width:q},children:(0,p.jsx)(f.Z,{variant:"h6",className:P.rubberbandText,children:V.map((function(e,n){return(0,p.jsx)(f.Z,{children:"".concat(e.toLocaleString("en-US"),"bp")},"".concat(e,"_").concat(n))}))})}),(0,p.jsx)("div",{"data-testid":"rubberband_controls",className:P.rubberbandControl,role:"presentation",ref:N,onMouseDown:T,onMouseOut:B,onMouseMove:O,children:r}),w?(0,p.jsx)(u.Menu,{anchorReference:"anchorPosition",anchorPosition:{left:w.clientX,top:w.clientY},onMenuItemClick:function(e,n){n(),F()},open:I,onClose:F,menuItems:n.rubberBandMenuItems()}):null]})})),g=t(3915),j=t(22338),y=t(56452),Z=t(49391),w=t(3252),k=t(23642),C=(0,a.ZL)()((function(){return{headerBar:{gridArea:"1/1/auto/span 2",display:"flex"},spacer:{flexGrow:1},bp:{display:"flex",alignItems:"center",marginLeft:10},searchContainer:{marginLeft:5},searchBox:{display:"flex"}}})),S=(0,i.observer)((function(e){var n=e.model;return(0,p.jsx)(g.Z,{onClick:n.activateTrackSelector,title:"Open track selector",children:(0,p.jsx)(k.GD,{color:"primary"})})})),L=(0,i.observer)((function(e){var n=e.model;return(0,p.jsx)(g.Z,{onClick:n.toggleLinkViews,title:"Toggle linked scrolls and behavior across views",children:n.linkViews?(0,p.jsx)(Z.Z,{color:"primary"}):(0,p.jsx)(y.Z,{color:"primary"})})})),M=(0,i.observer)((function(e){var n=e.model;return(0,p.jsx)(g.Z,{onClick:n.squareView,title:"Square view (make both the same zoom level)",children:(0,p.jsx)(w.Z,{color:"primary"})})})),N=(0,i.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=C().classes,s=n.views.some((function(e){return!e.hideHeader}));return(0,p.jsxs)("div",{className:r.headerBar,children:[(0,p.jsx)(S,{model:n}),(0,p.jsx)(L,{model:n}),(0,p.jsx)(M,{model:n}),t,s?null:n.views.map((function(e){return(0,p.jsxs)("div",{className:r.searchBox,children:[(0,p.jsx)("div",{className:r.searchContainer,children:(0,p.jsx)(j.Rj,{model:e,showHelp:!1})}),(0,p.jsx)("div",{className:r.bp,children:(0,p.jsxs)(f.Z,{variant:"body2",color:"textSecondary",className:r.bp,children:[Math.round(e.coarseTotalBp).toLocaleString("en-US")," bp"]})})]},e.id)})),(0,p.jsx)("div",{className:r.spacer})]})})),A=(0,a.ZL)()((function(){return{container:{display:"grid"},overlay:{zIndex:100,gridArea:"1/1"},content:{gridArea:"1/1",position:"relative"},grid:{display:"grid"},relative:{position:"relative"},rubberbandContainer:{position:"relative",overflow:"hidden"}}})),P=(0,i.observer)((function(e){var n=e.model,t=A().classes;return(0,p.jsx)(p.Fragment,{children:n.tracks.map((function(e){var r=(0,s.Z)(e.displays,1)[0],o=r.RenderingComponent,a=(0,c.getConf)(e,"trackId");return o?(0,p.jsx)("div",{className:t.overlay,style:{height:n.middleComparativeHeight,overflow:"hidden"},children:(0,p.jsx)(o,{model:r})},a):null}))})})),E=(0,i.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=A().classes,a=n.views,i=(0,l.getEnv)(n).pluginManager.getViewType(a[0].type).ReactComponent,c=(0,o.useState)(!1),d=(0,s.Z)(c,2),m=d[0],f=d[1];return(0,p.jsxs)("div",{className:r.rubberbandContainer,children:[(0,p.jsx)(N,{ExtraButtons:t,model:n}),(0,p.jsx)(b,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",background:m?"#999":"#ccc",height:15},onMouseOver:function(){return f(!0)},onMouseLeave:function(){return f(!1)}})}),(0,p.jsxs)("div",{className:r.container,children:[(0,p.jsx)(i,{model:a[0]}),(0,p.jsx)("div",{className:r.grid,children:(0,p.jsx)(P,{model:n})}),(0,p.jsx)(u.ResizeHandle,{onDrag:function(e){return n.setMiddleComparativeHeight(n.middleComparativeHeight+e)},style:{height:4,background:"#ccc"}}),(0,p.jsx)(i,{model:a[1]})]})]})})),T=(0,i.observer)((function(e){var n=e.model,t=e.ExtraButtons,r=A().classes,a=n.views,i=(0,l.getEnv)(n).pluginManager,c=(0,o.useState)(!1),u=(0,s.Z)(c,2),d=u[0],m=u[1];return(0,p.jsxs)("div",{className:r.rubberbandContainer,children:[(0,p.jsx)(N,{model:n,ExtraButtons:t}),(0,p.jsx)(b,{model:n,ControlComponent:(0,p.jsx)("div",{style:{width:"100%",background:d?"#aaa":"#ccc",height:15},onMouseOver:function(){return m(!0)},onMouseLeave:function(){return m(!1)}})}),(0,p.jsx)("div",{className:r.container,children:(0,p.jsxs)("div",{className:r.content,children:[(0,p.jsx)("div",{className:r.relative,children:a.map((function(e){var n=i.getViewType(e.type).ReactComponent;return(0,p.jsx)(n,{model:e},e.id)}))}),(0,p.jsx)(P,{model:n})]})})]})})),O=(0,i.observer)((function(e){return e.model.tracks.some((function(e){return e.displays.some((function(e){return(0,c.getConf)(e,"middle")}))}))?(0,p.jsx)(E,(0,r.Z)({},e)):(0,p.jsx)(T,(0,r.Z)({},e))}))},49116:function(e,n,t){t.r(n),t.d(n,{default:function(){return z}});var r=t(96902),s=t(4782),o=t(3915),a=t(47554),i=t(10357),c=t(32723),l=t(34795),u=t(96234),d=t(65097),m=t(87212),f=t(71078),h=t(37910),p=t(96565),v=t(42523),x=t(23739),b=t(79002),g=t(32212),j=t(91188),y=t(27664),Z=t(18849),w=t(88315),k=t.n(w),C=t(72988),S=t(29938);function L(e){var n=e.radioOption,t=e.assembly1,r=e.assembly2,s=e.fileLocation,o=e.bed1Location,a=e.bed2Location;if(".paf"===n)return{type:"PAFAdapter",pafLocation:s,queryAssembly:t,targetAssembly:r};if(".out"===n)return{type:"MashMapAdapter",outLocation:s,queryAssembly:t,targetAssembly:r};if(".delta"===n)return{type:"DeltaAdapter",deltaLocation:s,queryAssembly:t,targetAssembly:r};if(".chain"===n)return{type:"ChainAdapter",chainLocation:s,queryAssembly:t,targetAssembly:r};if(".anchors"===n)return{type:"MCScanAnchorsAdapter",mcscanAnchorsLocation:s,bed1Location:o,bed2Location:a,assemblyNames:[t,r]};if(".anchors.simple"===n)return{type:"MCScanSimpleAnchorsAdapter",mcscanSimpleAnchorsLocation:s,bed1Location:o,bed2Location:a,assemblyNames:[t,r]};throw new Error("Unknown type")}var M=(0,s.observer)((function(e){e.sessionTrackData;var n=e.assembly1,t=e.assembly2,s=e.setSessionTrackData,o=(0,r.useState)(),a=(0,u.Z)(o,2),i=a[0],c=a[1],l=(0,r.useState)(),d=(0,u.Z)(l,2),h=d[0],p=d[1],v=(0,r.useState)(),j=(0,u.Z)(v,2),y=j[0],w=j[1],M=(0,r.useState)(""),N=(0,u.Z)(M,2),A=N[0],P=N[1],E=(0,r.useState)(),T=(0,u.Z)(E,2),O=T[0],B=T[1],F=function(e){return e?e.uri||e.localPath||e.name:void 0}(y),I=A||(F?k().extname(function(e){return e.endsWith(".gz")?e.slice(0,e.length-3):e}(F)):"");return(0,r.useEffect)((function(){try{if(y){var e=F?k().basename(F):"MyTrack",r="".concat(e,"-").concat(Date.now());B(void 0),s({trackId:r,name:e,assemblyNames:[t,n],type:"SyntenyTrack",adapter:L({radioOption:I,assembly1:n,assembly2:t,fileLocation:y,bed1Location:h,bed2Location:i})})}}catch(o){console.error(o),B(o)}}),[F,n,t,h,i,y,I,s]),(0,S.jsxs)(f.Z,{style:{padding:12},children:[O?(0,S.jsx)(Z.ErrorMessage,{error:O}):null,(0,S.jsx)(C.Z,{style:{textAlign:"center"},children:"Add a .paf, .out (MashMap), .delta (Mummer), .chain, .anchors or .anchors.simple (MCScan) file to view in the dotplot. These file types can also be gzipped. The first assembly should be the query sequence (e.g. left column of the PAF) and the second assembly should be the target sequence (e.g. right column of the PAF)"}),(0,S.jsx)(x.Z,{value:I,onChange:function(e){return P(e.target.value)},children:(0,S.jsxs)(m.ZP,{container:!0,justifyContent:"center",children:[(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".paf",control:(0,S.jsx)(g.Z,{}),label:".paf"})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".out",control:(0,S.jsx)(g.Z,{}),label:".out"})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".delta",control:(0,S.jsx)(g.Z,{}),label:".delta"})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".chain",control:(0,S.jsx)(g.Z,{}),label:".chain"})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".anchors",control:(0,S.jsx)(g.Z,{}),label:".anchors"})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(b.Z,{value:".anchors.simple",control:(0,S.jsx)(g.Z,{}),label:".anchors.simple"})})]})}),(0,S.jsx)(m.ZP,{container:!0,justifyContent:"center",children:(0,S.jsx)(m.ZP,{item:!0,children:".anchors"===A||".anchors.simple"===A?(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{style:{margin:20},children:["Open the ",A," and .bed files for both genome assemblies from the MCScan (Python version) pipeline"," ",(0,S.jsx)("a",{href:"https://github.com/tanghaibao/jcvi/wiki/MCscan-(Python-version)",children:"(more info)"})]}),(0,S.jsxs)("div",{style:{display:"flex"},children:[(0,S.jsx)("div",{children:(0,S.jsx)(Z.FileSelector,{name:".anchors file",description:"",location:y,setLocation:function(e){return w(e)}})}),(0,S.jsx)("div",{children:(0,S.jsx)(Z.FileSelector,{name:"genome 1 .bed (left column of anchors file)",description:"",location:h,setLocation:function(e){return p(e)}})}),(0,S.jsx)("div",{children:(0,S.jsx)(Z.FileSelector,{name:"genome 2 .bed (right column of anchors file)",description:"",location:i,setLocation:function(e){return c(e)}})})]})]}):(0,S.jsx)(Z.FileSelector,{name:A?A+" location":"",description:"",location:y,setLocation:function(e){return w(e)}})})})]})})),N=t(68079),A=t(64229),P=t(5792),E=t(16151),T=t(99836);var O=(0,s.observer)((function(e){var n,t=e.model,s=e.assembly1,o=e.assembly2,a=e.setShowTrackId,i=(0,y.getSession)(t),c=i.tracks,l=void 0===c?[]:c,d=i.sessionTracks,m=void 0===d?[]:d,h=[].concat((0,N.Z)(l),(0,N.Z)(m)).filter((function(e){return function(e,n,t){var r=(0,T.readConfObject)(e,"assemblyNames");return r.includes(n)&&r.includes(t)&&e.type.includes("Synteny")}(e,o,s)})),p=(null===(n=h[0])||void 0===n?void 0:n.trackId)||"",v=(0,r.useState)(p),x=(0,u.Z)(v,2),b=x[0],g=x[1];return(0,r.useEffect)((function(){g(p)}),[p]),(0,r.useEffect)((function(){a(b)}),[b,a]),(0,S.jsxs)(f.Z,{style:{padding:12},children:[(0,S.jsx)(C.Z,{paragraph:!0,children:'Select a track from the select box below, the track will be shown when you hit "Launch".'}),h.length?(0,S.jsx)(A.Z,{value:b,onChange:function(e){return g(e.target.value)},children:h.map((function(e){return(0,S.jsx)(P.Z,{value:e.trackId,children:(0,E.getTrackName)(e,i)},e.trackId)}))}):(0,S.jsx)(Z.ErrorMessage,{error:"No synteny tracks found for ".concat(s,",").concat(o)})]})})),B=(0,j.ZL)()((function(e){return{importFormContainer:{padding:e.spacing(4),margin:"0 auto"},assemblySelector:{width:"75%",margin:"0 auto"}}})),F=(0,s.observer)((function(e){var n=e.model,t=B().classes,s=(0,y.getSession)(n),o=s.assemblyNames,a=(0,r.useState)(o.length?o[0]:""),i=(0,u.Z)(a,2),j=i[0],w=i[1],k=(0,r.useState)(o.length?o[0]:""),C=(0,u.Z)(k,2),L=C[0],N=C[1],A=(0,r.useState)(),P=(0,u.Z)(A,2),E=P[0],T=P[1],F=(0,r.useState)(),I=(0,u.Z)(F,2),R=I[0],z=I[1],q=(0,r.useState)(),D=(0,u.Z)(q,2),X=D[0],H=D[1],V=(0,r.useState)("none"),_=(0,u.Z)(V,2),G=_[0],J=_[1];function U(){return U=(0,l.Z)((0,c.Z)().mark((function e(){var t,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(0,y.isSessionWithAddTracks)(s)){e.next=3;break}return e.abrupt("return");case 3:return T(void 0),t=s.assemblyManager,r=[L,j],e.t0=n,e.next=9,Promise.all(r.map(function(){var e=(0,l.Z)((0,c.Z)().mark((function e(n){var r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.waitForAssembly(n);case 2:if(r=e.sent){e.next=5;break}throw new Error("Assembly ".concat(n," failed to load"));case 5:return e.abrupt("return",{type:"LinearGenomeView",bpPerPx:1,offsetPx:0,hideHeader:!0,displayedRegions:r.regions});case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 9:e.t1=e.sent,e.t0.setViews.call(e.t0,e.t1),n.views.forEach((function(e){return e.setWidth(n.width)})),R?(s.addTrackConf(R),n.toggleTrack(R.trackId)):X&&n.showTrack(X),e.next=19;break;case 15:e.prev=15,e.t2=e.catch(0),console.error(e.t2),T(e.t2);case 19:case"end":return e.stop()}}),e,null,[[0,15]])}))),U.apply(this,arguments)}(0,r.useEffect)((function(){"none"===G&&(z(void 0),H(void 0))}),[G]);var W=E;return(0,S.jsxs)(d.Z,{className:t.importFormContainer,children:[W?(0,S.jsx)(Z.ErrorMessage,{error:W}):null,(0,S.jsx)(m.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",className:t.assemblySelector,children:(0,S.jsxs)(m.ZP,{item:!0,children:[(0,S.jsxs)(f.Z,{style:{padding:12},children:[(0,S.jsx)("p",{style:{textAlign:"center"},children:"Select assemblies for linear synteny view"}),(0,S.jsxs)(m.ZP,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:[(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(Z.AssemblySelector,{extra:0,selected:L,onChange:function(e){return N(e)},session:s})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(Z.AssemblySelector,{extra:1,selected:j,onChange:function(e){return w(e)},session:s})}),(0,S.jsx)(m.ZP,{item:!0,children:(0,S.jsx)(h.Z,{children:(0,S.jsx)(p.Z,{onClick:function(){return U.apply(this,arguments)},variant:"contained",color:"primary",children:"Launch"})})})]})]}),(0,S.jsxs)(h.Z,{children:[(0,S.jsx)(v.Z,{id:"group-label",children:"(Optional) Select or add a synteny track"}),(0,S.jsxs)(x.Z,{row:!0,value:G,onChange:function(e){return J(e.target.value)},"aria-labelledby":"group-label",children:[(0,S.jsx)(b.Z,{value:"none",control:(0,S.jsx)(g.Z,{}),label:"None"}),(0,S.jsx)(b.Z,{value:"tracklist",control:(0,S.jsx)(g.Z,{}),label:"Existing track"}),(0,S.jsx)(b.Z,{value:"custom",control:(0,S.jsx)(g.Z,{}),label:"New track"})]})]}),"custom"===G?(0,S.jsx)(M,{setSessionTrackData:z,sessionTrackData:R,assembly2:j,assembly1:L}):null,"tracklist"===G?(0,S.jsx)(O,{model:n,assembly1:L,assembly2:j,setShowTrackId:H}):null]})})]})})),I=F,R=(0,s.observer)((function(e){var n=e.model;return(0,S.jsx)(o.Z,{onClick:function(){n.toggleCurves()},title:"Toggle drawing straight or curved synteny lines",children:n.drawCurves?(0,S.jsx)(i.Z,{color:"primary"}):(0,S.jsx)(i.f,{color:"primary"})})})),z=(0,s.observer)((function(e){var n=e.model;return n.initialized?(0,S.jsx)(a.default,{model:n,ExtraButtons:(0,S.jsx)(R,{model:n})}):(0,S.jsx)(I,{model:n})}))}}]);
//# sourceMappingURL=9116.9fb59df6.chunk.js.map