"use strict";(self.webpackChunk_jbrowse_web=self.webpackChunk_jbrowse_web||[]).push([[4381],{74945:function(e,t,r){r.d(t,{Z:function(){return j}});var n=r(33028),a=r(30969),i=r(90550),o=r(96234),u=r(40909),s=r(94702),c=r(81073),l=r(68079),f=r(41361),d=r(6556);function v(e,t){var r=e.get("tags");return r?r[t]:e.get(t)}var g=r(44750),h=r(37574),p=[0,1,2,3],m=p[0],x=p[2],k=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,d=t.views,p=t.showIntraviewLinks,k=(0,s.Z)(),w=(0,c.getSession)(t),y=(0,u.getSnapshot)(t),j=w.assemblyManager.get(d[0].assemblyNames[0]);(0,g.Go)(y);var S=t.getTrackFeatures(r),b=(0,a.useMemo)((function(){return function(e){var t,r=(0,f.Z)(e.values());try{for(r.s();!(t=r.n()).done;)if(1&t.value.get("flags"))return!0}catch(n){r.e(n)}finally{r.f()}return!1}(S)}),[S]),Z=(0,a.useMemo)((function(){var e=t.getMatchedFeaturesInLayout(r,b?function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.get("flags"),u=i.id(),s=4&o,c=2&o;if(!n.has(u)&&!c&&!s){var d=i.get("name"),v=r.get(d);v||(v=[],r.set(d,v)),v.push(i)}n.add(i.id())}}catch(g){a.e(g)}finally{a.f()}return(0,l.Z)(r.values()).filter((function(e){return e.length>1}))}(S):function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value,o=i.id(),u=4&i.get("flags"),s=!!v(i,"SA");if(!n.has(o)&&!u&&s){var c=i.get("name"),d=r.get(c);d||(d=[],r.set(c,d)),d.push(i)}n.add(i.id())}}catch(g){a.e(g)}finally{a.f()}return(0,l.Z)(r.values()).filter((function(e){return e.length>1}))}(S));return b||e.forEach((function(e){e.sort((function(e,t){return e.feature.get("clipPos")-t.feature.get("clipPos")}))})),e}),[S,r,b,t]),T=(0,a.useState)(),N=(0,o.Z)(T,2),M=N[0],O=N[1],L=0;if(n.current){var R=n.current.getBoundingClientRect();L=R.top}return j?(0,h.jsx)("g",{stroke:k.palette.text.disabled,fill:"none","data-testid":Z.length?"".concat(r,"-loaded"):r,children:Z.map((function(e){for(var t,n=[],a=function(){var t=e[o],a=t.layout,u=t.feature,s=t.level,c=e[o+1],l=c.layout,f=c.feature,v=c.level;if(!a||!l)return console.warn("received null layout for a overlay feature"),{v:null};if(!p&&s===v)return{v:null};var k=j.getCanonicalRefName(u.get("refName")),y=j.getCanonicalRefName(f.get("refName"));if(!k||!y)throw new Error("unable to find ref for ".concat(k||y));var Z=u.get("strand"),T=f.get("strand"),N=a[-1===Z?m:x],R=-1===T,I=b?l[R?m:x]:l[R?x:m],W=(0,g.mu)(d[s],k,N),C=(0,g.mu)(d[v],y,I),B=d[s].pxToBp(W).reversed,F=d[v].pxToBp(C).reversed,P=d.map((function(e){return e.getTrack(r)})),A=(0,g.cO)(r,s,d,P,a,i)-L,J=(0,g.cO)(r,v,d,P,l,i)-L,z=["M",W,A,"C",W+200*u.get("strand")*(B?-1:1),A,C-200*f.get("strand")*(F?-1:1)*(b?-1:1),J,C,J].join(" "),D="".concat(u.id(),"-").concat(f.id());n.push((0,h.jsx)("path",{d:z,"data-testid":"r1",strokeWidth:M===D?5:1,onClick:function(){var e,t,r=null===(e=w.addWidget)||void 0===e?void 0:e.call(w,"BreakpointAlignmentsWidget","breakpointAlignments",{featureData:{feature1:(S.get(u.id())||{toJSON:function(){}}).toJSON(),feature2:(S.get(f.id())||{toJSON:function(){}}).toJSON()}});null===(t=w.showWidget)||void 0===t||t.call(w,r)},onMouseOver:function(){return O(D)},onMouseOut:function(){return O(void 0)}},D))},o=0;o<e.length-1;o++)if(t=a())return t.v;return n}))}):null})),w=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,s=t.views,v=(0,c.getSession)(t),p=v.assemblyManager,m=t.getTrackFeatures(r),x=(0,a.useMemo)((function(){return t.getMatchedFeaturesInLayout(r,function(e){var t,r=new Map,n=new Set,a=(0,f.Z)(e.values());try{var i=function(){var e=t.value;if(!n.has(e.id())&&"breakend"===e.get("type")){var a=e.get("ALT");null===a||void 0===a||a.forEach((function(t){var n="".concat(e.get("refName"),":").concat(e.get("start")+1),a=(0,d.I)(t);if(a){var i=r.get(n);i?i.push(e):r.set(a.MatePosition||"none",[e])}}))}n.add(e.id())};for(a.s();!(t=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return(0,l.Z)(r.values()).filter((function(e){return e.length>1}))}(m))}),[m,r,t]),k=(0,a.useState)(),w=(0,o.Z)(k,2),y=w[0],j=w[1],S=(0,u.getSnapshot)(t);(0,g.Go)(S);var b=p.get(s[0].assemblyNames[0]);if(!b)return null;var Z=0;if(n.current){var T=n.current.getBoundingClientRect();Z=T.top}return(0,h.jsx)("g",{stroke:"green",strokeWidth:5,fill:"none","data-testid":x.length?"".concat(r,"-loaded"):r,children:x.map((function(e){for(var t,n=[],a=function(){var t=e[o],a=t.layout,u=t.feature,l=t.level,f=e[o+1],p=f.layout,x=f.feature,k=f.level,w=u.id(),S=function(e,t){var r=e.get("ALT");if(r)return new Map(null===r||void 0===r?void 0:r.map((function(e){return(0,d.I)(e)})).filter(c.notEmpty).map((function(e){return[e.MatePosition,e]}))).get("".concat(t.get("refName"),":").concat(t.get("start")+1))}(u,x);if(!a||!p)return{v:null};var T=u.get("refName"),N=x.get("refName"),M=b.getCanonicalRefName(T),O=b.getCanonicalRefName(N);if(!M||!O)throw new Error("unable to find ref for ".concat(M||O));var L=(0,g.mu)(s[l],M,a[0]),R=(0,g.mu)(s[k],O,p[0]),I=s[l].pxToBp(L).reversed,W=s[k].pxToBp(R).reversed,C=s.map((function(e){return e.getTrack(r)})),B=(0,g.cO)(r,l,s,C,a,i)-Z,F=(0,g.cO)(r,k,s,C,p,i)-Z;if(S){var P=["M",L-20*("left"===S.Join?-1:1)*(I?-1:1),B,"L",L,B,"L",R,F,"L",R-20*("left"===S.MateDirection?1:-1)*(W?-1:1),F].join(" ");n.push((0,h.jsx)("path",{d:P,strokeWidth:w===y?10:5,onClick:function(){var e,t,r,n=null===(e=v.addWidget)||void 0===e?void 0:e.call(v,"VariantFeatureWidget","variantFeature",{featureData:null===(t=m.get(w))||void 0===t?void 0:t.toJSON()});null===(r=v.showWidget)||void 0===r||r.call(v,n)},onMouseOver:function(){return j(w)},onMouseOut:function(){return j(void 0)}},JSON.stringify(P)))}else console.warn("the relevant ALT allele was not found, cannot render")},o=0;o<e.length-1;o+=1)if(t=a())return t.v;return n}))})})),y=(0,i.observer)((function(e){var t=e.model,r=e.trackId,n=e.parentRef,i=e.getTrackYPosOverride,s=t.views,l=(0,c.getSession)(t),d=l.assemblyManager,v=t.getTrackFeatures(r),p=(0,a.useMemo)((function(){return t.getMatchedFeaturesInLayout(r,function(e){var t,r=[],n=new Set,a=(0,f.Z)(e.values());try{for(a.s();!(t=a.n()).done;){var i=t.value;n.has(i.id())||"<TRA>"!==i.get("ALT")[0]||r.push([i]),n.add(i.id())}}catch(o){a.e(o)}finally{a.f()}return r}(v))}),[v,r,t]),m=(0,a.useState)(),x=(0,o.Z)(m,2),k=x[0],w=x[1],y=(0,u.getSnapshot)(t);if((0,g.Go)(y),!d.get(s[0].assemblyNames[0]))return null;var j=0;if(n.current){var S=n.current.getBoundingClientRect();j=S.top}return s.length<2?null:(0,h.jsx)("g",{fill:"none",stroke:"green",strokeWidth:5,"data-testid":p.length?"".concat(r,"-loaded"):r,children:p.map((function(e){var t,n=[],a=(0,f.Z)(e);try{var u,c=function(){var e=t.value,a=e.layout,u=e.feature,c=e.level,f=0===c?1:0,d=u.id();if(!a)return{v:null};var p=u.get("INFO"),m=p.CHR2[0],x=p.END[0],y=p.STRANDS[0].split(""),S=(0,o.Z)(y,2),b=S[0],Z=S[1],T=(0,g.mu)(s[f],m,x);if(T){var N=[T,0,T+1,0],M=(0,g.mu)(s[c],u.get("refName"),a[0]),O=T,L=s[c].pxToBp(M).reversed,R=s[f].pxToBp(O).reversed,I=s.map((function(e){return e.getTrack(r)})),W=(0,g.cO)(r,c,s,I,a,i)-j,C=(0,g.cO)(r,f,s,I,N,i)-j,B=["M",M-20*("+"===b?1:-1)*(L?-1:1),W,"L",M,W,"L",O,C,"L",O-20*("+"===Z?1:-1)*(R?-1:1),C].join(" ");n.push((0,h.jsx)("path",{d:B,strokeWidth:d===k?10:5,onClick:function(){var e,t,r=null===(e=l.addWidget)||void 0===e?void 0:e.call(l,"VariantFeatureWidget","variantFeature",{featureData:(v.get(d)||{toJSON:function(){}}).toJSON()});null===(t=l.showWidget)||void 0===t||t.call(l,r)},onMouseOver:function(){return w(d)},onMouseOut:function(){return w(void 0)}},JSON.stringify(B)))}};for(a.s();!(t=a.n()).done;)if(u=c())return u.v}catch(d){a.e(d)}finally{a.f()}return n}))})})),j=(0,i.observer)((function(e){var t,r,a=e.model,i=e.trackId,o=a.getMatchedTracks(i);return"AlignmentsTrack"===(null===(t=o[0])||void 0===t?void 0:t.type)?(0,h.jsx)(k,(0,n.Z)({},e)):"VariantTrack"===(null===(r=o[0])||void 0===r?void 0:r.type)?a.hasTranslocations(i)?(0,h.jsx)(y,(0,n.Z)({},e)):(0,h.jsx)(w,(0,n.Z)({},e)):null}))},44381:function(e,t,r){r.r(t),r.d(t,{renderToSvg:function(){return w}});var n=r(32723),a=r(33028),i=r(34795),o=r(41361),u=(r(30969),r(2082)),s=r(90689),c=r(81073),l=r(75844),f=r(59767),d=r(57211),v=r(94702),g=r(37574);function h(e){var t=e.width,r=e.height,n=e.shift,a=(0,v.Z)();return(0,g.jsx)("rect",{width:t+2*n,height:r,fill:(0,c.stripAlpha)(a.palette.background.default)})}var p=r(97891),m=r(74945);function x(e,t,r){return(0,c.max)(e.flatMap((function(e){return e.tracks.map((function(e){return(0,c.measureText)((0,p.getTrackName)(e.configuration,r),t)}))})),0)}function k(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a={},i=t,u=(0,o.Z)(e.tracks);try{for(u.s();!(r=u.n()).done;){var s=r.value;a[s.configuration.trackId]=i+n,i+=s.displays[0].height+t}}catch(c){u.e(c)}finally{u.f()}return a}function w(e,t){return y.apply(this,arguments)}function y(){return y=(0,i.Z)((0,n.Z)().mark((function e(t,r){var o,v,p,w,y,j,S,b,Z,T,N,M,O,L,R,I,W,C,B,F,P,A,J,z,D,E,H,G,Y,_;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=r.textHeight,p=void 0===v?18:v,w=r.headerHeight,y=void 0===w?30:w,j=r.rulerHeight,S=void 0===j?30:j,b=r.fontSize,Z=void 0===b?13:b,T=r.trackLabels,N=void 0===T?"offset":T,M=r.Wrapper,O=void 0===M?function(e){var t=e.children;return(0,g.jsx)(g.Fragment,{children:t})}:M,L=r.themeName,R=void 0===L?"default":L,I=(0,c.getSession)(t),W=null===(o=I.allThemes)||void 0===o?void 0:o.call(I)[R],C=t.width,B=t.views,F=50,P=y+S,A=B.map((function(e){return(0,d.hY)(e.tracks,p,N)+P})),J=(0,c.sum)(A)+100,e.next=10,Promise.all(B.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,Promise.all(t.tracks.map(function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.displays[0],e.next=3,(0,s.when)((function(){return void 0===i.ready||i.ready}));case 3:return e.t0=t,e.next=6,i.renderSvg((0,a.Z)((0,a.Z)({},r),{},{theme:W}));case 6:return e.t1=e.sent,e.abrupt("return",{track:e.t0,result:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.t1=e.sent,e.abrupt("return",{view:e.t0,data:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 10:return z=e.sent,D=x(B,Z,I)+40,E="left"===N?D:0,H="offset"===N?p:0,G=[k(B[0],H,Z+P),k(B[1],H,Z+A[0]+P)],Y=C+E,_=(0,f.createJBrowseTheme)(W),e.abrupt("return",(0,u.uS)((0,g.jsx)(l.Z,{theme:_,children:(0,g.jsx)(O,{children:(0,g.jsxs)("svg",{width:C,height:J,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,Y+2*F,J].toString(),children:[(0,g.jsx)(h,{width:Y,height:J,shift:F}),(0,g.jsxs)("g",{transform:"translate(".concat(F," ").concat(Z,")"),children:[(0,g.jsxs)("g",{transform:"translate(".concat(E,")"),children:[(0,g.jsx)("text",{x:0,fontSize:Z,fill:_.palette.text.primary,children:B[0].assemblyNames.join(", ")}),(0,g.jsx)(d.Uc,{model:z[0].view,fontSize:Z})]}),(0,g.jsx)(d.Ge,{textHeight:p,trackLabels:N,fontSize:Z,model:z[0].view,displayResults:z[0].data,offset:P,trackLabelOffset:E})]}),(0,g.jsxs)("g",{transform:"translate(".concat(F," ").concat(Z+A[0],")"),children:[(0,g.jsxs)("g",{transform:"translate(".concat(E,")"),children:[(0,g.jsx)("text",{x:0,fontSize:Z,fill:_.palette.text.primary,children:B[1].assemblyNames.join(", ")}),(0,g.jsx)(d.Uc,{model:z[1].view,fontSize:Z})]}),(0,g.jsx)(d.Ge,{textHeight:p,trackLabels:N,fontSize:Z,model:z[1].view,displayResults:z[1].data,offset:P,trackLabelOffset:E})]}),(0,g.jsx)("defs",{children:(0,g.jsx)("clipPath",{id:"clip-bsv",children:(0,g.jsx)("rect",{x:0,y:0,width:C,height:J})})}),(0,g.jsx)("g",{transform:"translate(".concat(E+F,")"),clipPath:"url(#clip-bsv)",children:t.matchedTracks.map((function(e){return(0,g.jsx)(m.Z,{parentRef:{current:null},model:t,trackId:e.configuration.trackId,getTrackYPosOverride:function(e,t){return G[t][e]}},e.configuration.trackId)}))})]})})})));case 18:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}}}]);
//# sourceMappingURL=4381.13fc1c89.chunk.js.map