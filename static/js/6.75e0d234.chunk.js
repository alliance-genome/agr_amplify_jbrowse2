(this["webpackJsonp@jbrowse/web"]=this["webpackJsonp@jbrowse/web"]||[]).push([[6],{1436:function(e,t,r){"use strict";t.a={BAM_FPAIRED:1,BAM_FPROPER_PAIR:2,BAM_FUNMAP:4,BAM_FMUNMAP:8,BAM_FREVERSE:16,BAM_FMREVERSE:32,BAM_FREAD1:64,BAM_FREAD2:128,BAM_FSECONDARY:256,BAM_FQCFAIL:512,BAM_FDUP:1024,BAM_FSUPPLEMENTARY:2048}},1437:function(e,t){!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,a="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function f(e){return"string"!==typeof e&&(e=String(e)),e}function h(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function b(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"===typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&a&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=v(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,r=p(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}l.prototype.append=function(e,t){e=c(e),t=f(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},l.prototype.delete=function(e){delete this.map[c(e)]},l.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},l.prototype.set=function(e,t){this.map[c(e)]=f(t)},l.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),h(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),h(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),h(e)},n&&(l.prototype[Symbol.iterator]=l.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function x(e,t){var r=(t=t||{}).body;if(e instanceof x){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=function(e){var t=e.toUpperCase();return m.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function k(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(a))}})),t}function g(e){var t=new l;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var a=r.join(":").trim();t.append(n,a)}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}x.prototype.clone=function(){return new x(this,{body:this._bodyInit})},y.call(x.prototype),y.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];w.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(O){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function E(e,r){return new Promise((function(n,i){var s=new x(e,r);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function u(){o.abort()}o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:g(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new w(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},o.open(s.method,s.url,!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),s.headers.forEach((function(e,t){o.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),o.onreadystatechange=function(){4===o.readyState&&s.signal.removeEventListener("abort",u)}),o.send("undefined"===typeof s._bodyInit?null:s._bodyInit)}))}E.polyfill=!0,e.fetch||(e.fetch=E,e.Headers=l,e.Request=x,e.Response=w),t.Headers=l,t.Request=x,t.Response=w,t.fetch=E,Object.defineProperty(t,"__esModule",{value:!0})}({})}("undefined"!==typeof self?self:this)},261:function(e,t,r){"use strict";function n(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new a(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function a(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return a=function(e){this.s=e,this.n=e.next},a.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new a(e)}r.d(t,"a",(function(){return n}))},291:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(362);function a(e){return new n.a(e)}},297:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(362);function a(e){var t,r;function a(t,r){try{var s=e[t](r),o=s.value,u=o instanceof n.a;Promise.resolve(u?o.wrapped:o).then((function(e){u?a("return"===t?"return":"next",e):i(s.done?"return":"normal",e)}),(function(e){a("throw",e)}))}catch(c){i("throw",c)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?a(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise((function(i,s){var o={key:e,arg:n,resolve:i,reject:s,next:null};r?r=r.next=o:(t=r=o,a(e,n))}))},"function"!==typeof e.return&&(this.return=void 0)}function i(e){return function(){return new a(e.apply(this,arguments))}}a.prototype["function"===typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},a.prototype.next=function(e){return this._invoke("next",e)},a.prototype.throw=function(e){return this._invoke("throw",e)},a.prototype.return=function(e){return this._invoke("return",e)}},362:function(e,t,r){"use strict";function n(e){this.wrapped=e}r.d(t,"a",(function(){return n}))},363:function(e,t,r){"use strict";function n(e,t){var r={},n=!1;function a(r,a){return n=!0,a=new Promise((function(t){t(e[r](a))})),{done:!1,value:t(a)}}return r["undefined"!==typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},r.next=function(e){return n?(n=!1,e):a("next",e)},"function"===typeof e.throw&&(r.throw=function(e){if(n)throw n=!1,e;return a("throw",e)}),"function"===typeof e.return&&(r.return=function(e){return n?(n=!1,e):a("return",e)}),r}r.d(t,"a",(function(){return n}))},602:function(e,t,r){"use strict";r(603),r(605);var n=r(606);r.d(t,"a",(function(){return n.b}));var a=r(904);r.d(t,"b",(function(){return a.a}));r(607)},603:function(e,t,r){"use strict";r.d(t,"a",(function(){return w}));var n=r(29),a=r(103),i=r(86),s=r(82),o=r(81),u=r(11),c=r(88),f=r(89),h=r(80),l=r.n(h),d=r(211),p=r.n(d),b=r(900),v=r(901),y=r(902),m=r(604),x=21578050;function k(e,t){return e-e%t}function g(e,t){return e-e%t+t}var w=function(e){Object(c.a)(r,e);var t=Object(f.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"parsePseudoBin",value:function(e,t){return{lineCount:Object(m.c)(p.a.fromBytesLE(Array.prototype.slice.call(e,t+16,t+24),!0))}}},{key:"lineCount",value:function(){var e=Object(s.a)(l.a.mark((function e(t){var r,n,a,i,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},e.next=3,this.parse(r);case 3:if(n=e.sent,a=n.indices[t]){e.next=7;break}return e.abrupt("return",-1);case 7:return i=a.stats||{},e.abrupt("return",void 0===i.lineCount?-1:i.lineCount);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchBai",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.baiP||(this.baiP=this.filehandle.readFile(t).catch((function(t){throw e.baiP=void 0,t}))),this.baiP}},{key:"_parse",value:function(){var e=Object(s.a)(l.a.mark((function e(){var t,r,n,a,i,s,o,u,c,f,h,d,p,y,k,g,w,_,E,O=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=O.length>0&&void 0!==O[0]?O[0]:{},r={bai:!0,maxBlockSize:65536},e.next=4,this.fetchBai();case 4:if((n=e.sent).readUInt32LE(0)===x){e.next=7;break}throw new Error("Not a BAI file");case 7:r.refCount=n.readInt32LE(4),a=((1<<3*(5+1))-1)/7,r.indices=new Array(r.refCount),i=8,s=0;case 13:if(!(s<r.refCount)){e.next=50;break}return e.next=16,Object(m.a)(t.signal);case 16:o=n.readInt32LE(i),u=void 0,i+=4,c={},f=0;case 21:if(!(f<o)){e.next=42;break}if(h=n.readUInt32LE(i),i+=4,h!==a+1){e.next=30;break}i+=4,u=this.parsePseudoBin(n,i),i+=32,e.next=39;break;case 30:if(!(h>a+1)){e.next=34;break}throw new Error("bai index contains too many bins, please use CSI");case 34:for(d=n.readInt32LE(i),i+=4,p=new Array(d),y=0;y<d;y+=1)k=Object(b.b)(n,i),g=Object(b.b)(n,i+8),i+=16,this._findFirstData(r,k),p[y]=new v.a(k,g,h);c[h]=p;case 39:f+=1,e.next=21;break;case 42:for(w=n.readInt32LE(i),i+=4,_=new Array(w),E=0;E<w;E+=1)_[E]=Object(b.b)(n,i),i+=8,this._findFirstData(r,_[E]);r.indices[s]={binIndex:c,linearIndex:_,stats:u};case 47:s+=1,e.next=13;break;case 50:return e.abrupt("return",r);case 51:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=Object(s.a)(l.a.mark((function e(t,r,n){var a,s,o,u,c,f,h,d,p,b,v,y,m,x,w,_=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=_.length>3&&void 0!==_[3]?_[3]:{},s=16384,o=void 0!==r,e.next=5,this.parse(a);case 5:if(u=e.sent,c=u.indices[t]){e.next=9;break}return e.abrupt("return",[]);case 9:if(f=c.linearIndex,h=void 0===f?[]:f,d=c.stats,h.length){e.next=12;break}return e.abrupt("return",[]);case 12:if(p=void 0!==n?g(n,s):(h.length-1)*s,b=void 0!==r?k(r,s):0,v=new Array(o?(p-b)/s:h.length-1),y=h[h.length-1].blockPosition,!(p>(h.length-1)*s)){e.next=18;break}throw new Error("query outside of range of linear index");case 18:for(m=h[b/s].blockPosition,x=b/s,w=0;x<p/s;x++,w++)v[w]={score:h[x+1].blockPosition-m,start:x*s,end:x*s+s},m=h[x+1].blockPosition;return e.abrupt("return",v.map((function(e){return Object(i.a)(Object(i.a)({},e),{},{score:e.score*d.lineCount/y})})));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){return[[0,0],[1+(e>>26),1+((t-=1)>>26)],[9+(e>>23),9+(t>>23)],[73+(e>>20),73+(t>>20)],[585+(e>>17),585+(t>>17)],[4681+(e>>14),4681+(t>>14)]]}},{key:"blocksForRange",value:function(){var e=Object(s.a)(l.a.mark((function e(t,r,i){var s,o,u,c,f,h,d,p,b,y,x,k,g,w,_,E,O,j,A,I=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=I.length>3&&void 0!==I[3]?I[3]:{},r<0&&(r=0),e.next=4,this.parse(s);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(u=o.indices[t]){e.next=10;break}return e.abrupt("return",[]);case 10:c=this.reg2bins(r,i),f=[],h=Object(a.a)(c);try{for(h.s();!(d=h.n()).done;)for(p=Object(n.a)(d.value,2),b=p[0],y=p[1],x=b;x<=y;x++)if(u.binIndex[x])for(k=u.binIndex[x],g=0;g<k.length;++g)f.push(new v.a(k[g].minv,k[g].maxv,x))}catch(l){h.e(l)}finally{h.f()}for(w=u.linearIndex.length,_=null,E=Math.min(r>>14,w-1),O=Math.min(i>>14,w-1),j=E;j<=O;++j)(A=u.linearIndex[j])&&(!_||A.compareTo(_)<0)&&(_=A);return e.abrupt("return",Object(m.e)(f,_));case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(y.a)},604:function(e,t,r){"use strict";r.d(t,"f",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return c})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return l}));var n=r(82),a=r(80),i=r.n(a);function s(e){return new Promise((function(t){return setTimeout(t,e)}))}function o(e){if(e.greaterThan(Number.MAX_SAFE_INTEGER)||e.lessThan(Number.MIN_SAFE_INTEGER))throw new Error("integer overflow");return e.toNumber()}function u(e){if(e&&e.aborted){if("undefined"!==typeof DOMException)throw new DOMException("aborted","AbortError");var t=new Error("aborted");throw t.code="ERR_ABORTED",t}}function c(e){return f.apply(this,arguments)}function f(){return(f=Object(n.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:u(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"aborted"in e?{signal:e}:e}function l(e,t){var r=[],n=null;return 0===e.length?e:(e.sort((function(e,t){var r=e.minv.blockPosition-t.minv.blockPosition;return 0!==r?r:e.minv.dataPosition-t.minv.dataPosition})),e.forEach((function(e){var a,i;(!t||e.maxv.compareTo(t)>0)&&(null===n?(r.push(e),n=e):(a=n,(i=e).minv.blockPosition-a.maxv.blockPosition<65e3&&i.maxv.blockPosition-a.minv.blockPosition<5e6?e.maxv.compareTo(n.maxv)>0&&(n.maxv=e.maxv):(r.push(e),n=e)))})),r)}},605:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var n=r(29),a=r(103),i=r(82),s=r(81),o=r(11),u=r(88),c=r(89),f=r(80),h=r.n(f),l=r(211),d=r.n(l),p=r(176),b=r(900),v=r(901),y=r(604),m=r(902);function x(e,t){return Math.floor(e/Math.pow(2,t))}var k=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e){var n;return Object(s.a)(this,r),(n=t.call(this,e)).maxBinNumber=0,n.depth=0,n.minShift=0,n}return Object(o.a)(r,[{key:"lineCount",value:function(){var e=Object(i.a)(h.a.mark((function e(t){var r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parse();case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",-1);case 5:if(r.indices[t]){e.next=8;break}return e.abrupt("return",-1);case 8:if(!(n=r.indices[t].stats)){e.next=11;break}return e.abrupt("return",n.lineCount);case 11:return e.abrupt("return",-1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=Object(i.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"parseAuxData",value:function(e,t,r){if(r<30)return{};var n={};if(n.formatFlags=e.readInt32LE(t),n.coordinateType=65536&n.formatFlags?"zero-based-half-open":"1-based-closed",n.format={0:"generic",1:"SAM",2:"VCF"}[15&n.formatFlags],!n.format)throw new Error("invalid Tabix preset format flags ".concat(n.formatFlags));n.columnNumbers={ref:e.readInt32LE(t+4),start:e.readInt32LE(t+8),end:e.readInt32LE(t+12)},n.metaValue=e.readInt32LE(t+16),n.metaChar=n.metaValue?String.fromCharCode(n.metaValue):"",n.skipLines=e.readInt32LE(t+20);var a=e.readInt32LE(t+24);return Object.assign(n,this._parseNameBytes(e.slice(t+28,t+28+a))),n}},{key:"_parseNameBytes",value:function(e){for(var t=0,r=0,n=[],a={},i=0;i<e.length;i+=1)if(!e[i]){if(r<i){var s=e.toString("utf8",r,i);s=this.renameRefSeq(s),n[t]=s,a[s]=t}r=i+1,t+=1}return{refNameToId:a,refIdToName:n}}},{key:"_parse",value:function(){var e=Object(i.a)(h.a.mark((function e(t){var r,n,a,i,s,o,u,c,f,l,d,m,x,k,g,w,_;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={csi:!0,maxBlockSize:65536},e.next=3,this.filehandle.readFile(t);case 3:return n=e.sent,e.next=6,Object(p.unzip)(n);case 6:if(21582659!==(a=e.sent).readUInt32LE(0)){e.next=11;break}r.csiVersion=1,e.next=16;break;case 11:if(38359875!==a.readUInt32LE(0)){e.next=15;break}r.csiVersion=2,e.next=16;break;case 15:throw new Error("Not a CSI file");case 16:this.minShift=a.readInt32LE(4),this.depth=a.readInt32LE(8),this.maxBinNumber=((1<<3*(this.depth+1))-1)/7,(i=a.readInt32LE(12))&&Object.assign(r,this.parseAuxData(a,16,i)),r.refCount=a.readInt32LE(16+i),r.indices=new Array(r.refCount),s=16+i+4,o=0;case 25:if(!(o<r.refCount)){e.next=37;break}return e.next=28,Object(y.a)(t.signal);case 28:for(u=a.readInt32LE(s),s+=4,c={},f=void 0,l=0;l<u;l+=1)if((d=a.readUInt32LE(s))>this.maxBinNumber)f=this.parsePseudoBin(a,s+4),s+=48;else{for(m=Object(b.b)(a,s+4),this._findFirstData(r,m),x=a.readInt32LE(s+12),s+=16,k=new Array(x),g=0;g<x;g+=1)w=Object(b.b)(a,s),_=Object(b.b)(a,s+8),s+=16,k[g]=new v.a(w,_,d);c[d]=k}r.indices[o]={binIndex:c,stats:f};case 34:o+=1,e.next=25;break;case 37:return e.abrupt("return",r);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parsePseudoBin",value:function(e,t){return{lineCount:Object(y.c)(d.a.fromBytesLE(Array.prototype.slice.call(e,t+28,t+36),!0))}}},{key:"blocksForRange",value:function(){var e=Object(i.a)(h.a.mark((function e(t,r,i){var s,o,u,c,f,l,d,p,m,x,k,g,w,_=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=_.length>3&&void 0!==_[3]?_[3]:{},r<0&&(r=0),e.next=4,this.parse(s);case 4:if(o=e.sent){e.next=7;break}return e.abrupt("return",[]);case 7:if(u=o.indices[t]){e.next=10;break}return e.abrupt("return",[]);case 10:c=this.reg2bins(r,i),f=[],l=Object(a.a)(c);try{for(l.s();!(d=l.n()).done;)for(p=Object(n.a)(d.value,2),m=p[0],x=p[1],k=m;k<=x;k++)if(u.binIndex[k])for(g=u.binIndex[k],w=0;w<g.length;++w)f.push(new v.a(g[w].minv,g[w].maxv,k))}catch(h){l.e(h)}finally{l.f()}return e.abrupt("return",Object(y.e)(f,new b.a(0,0)));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"reg2bins",value:function(e,t){(e-=1)<1&&(e=1),t>Math.pow(2,50)&&(t=Math.pow(2,34)),t-=1;for(var r,n=0,a=0,i=this.minShift+3*this.depth,s=[];n<=this.depth;i-=3,a+=(r=3*n,1*Math.pow(2,r)),n+=1){var o=a+x(e,i),u=a+x(t,i);if(u-o+s.length>this.maxBinNumber)throw new Error("query ".concat(e,"-").concat(t," is too large for current binning scheme (shift ").concat(this.minShift,", depth ").concat(this.depth,"), try a smaller query or a coarser index binning scheme"));s.push([o,u])}return s}}]),r}(m.a)},606:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return E})),r.d(t,"b",(function(){return j}));var n=r(29),a=r(82),i=r(81),s=r(11),o=r(297),u=r(291),c=r(363),f=r(261),h=r(80),l=r.n(h),d=r(603),p=r(605),b=r(596),v=r.n(b),y=r(176),m=r(834),x=r.n(m),k=r(158),g=r(607),w=r(903),_=r(604),E=21840194,O=65536,j=function(){function t(e){var r=e.bamFilehandle,n=e.bamPath,a=e.bamUrl,s=e.baiPath,o=e.baiFilehandle,u=e.baiUrl,c=e.csiPath,f=e.csiFilehandle,h=e.csiUrl,l=e.fetchSizeLimit,b=e.chunkSizeLimit,v=e.yieldThreadTime,y=void 0===v?100:v,m=e.renameRefSeqs,x=void 0===m?function(e){return e}:m;if(Object(i.a)(this,t),this.renameRefSeq=x,r)this.bam=r;else if(n)this.bam=new k.LocalFile(n);else{if(!a)throw new Error("unable to initialize bam");this.bam=new k.RemoteFile(a)}if(f)this.index=new p.a({filehandle:f});else if(c)this.index=new p.a({filehandle:new k.LocalFile(c)});else if(h)this.index=new p.a({filehandle:new k.RemoteFile(h)});else if(o)this.index=new d.a({filehandle:o});else if(s)this.index=new d.a({filehandle:new k.LocalFile(s)});else if(u)this.index=new d.a({filehandle:new k.RemoteFile(u)});else if(n)this.index=new d.a({filehandle:new k.LocalFile("".concat(n,".bai"))});else{if(!a)throw new Error("unable to infer index format");this.index=new d.a({filehandle:new k.RemoteFile("".concat(a,".bai"))})}this.fetchSizeLimit=l||5e8,this.chunkSizeLimit=b||3e8,this.yieldThreadTime=y}return Object(s.a)(t,[{key:"getHeader",value:function(){var t=Object(a.a)(l.a.mark((function t(){var r,n,a,i,s,o,u,c,f,h,d,p,b=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=b.length>0&&void 0!==b[0]?b[0]:{},n=Object(_.d)(r),t.next=4,this.index.parse(n);case 4:if(a=t.sent,!(i=a.firstDataLine?a.firstDataLine.blockPosition+65535:void 0)){t.next=17;break}return t.next=9,this.bam.read(e.alloc(i+O),0,i+O,0,n);case 9:if(o=t.sent,u=o.bytesRead,s=o.buffer,u){t.next=14;break}throw new Error("Error reading header");case 14:s=u<i?s.slice(0,u):s.slice(0,i),t.next=20;break;case 17:return t.next=19,this.bam.readFile(n);case 19:s=t.sent;case 20:return t.next=22,Object(y.unzip)(s);case 22:if((c=t.sent).readInt32LE(0)===E){t.next=25;break}throw new Error("Not a BAM file");case 25:return f=c.readInt32LE(4),this.header=c.toString("utf8",8,8+f),t.next=29,this._readRefSeqs(f+8,65535,n);case 29:return h=t.sent,d=h.chrToIndex,p=h.indexToChr,this.chrToIndex=d,this.indexToChr=p,t.abrupt("return",Object(w.a)(this.header));case 35:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getHeaderText",value:function(){var e=Object(a.a)(l.a.mark((function e(){var t,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getHeader(t);case 3:return e.abrupt("return",this.header);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_readRefSeqs",value:function(){var t=Object(a.a)(l.a.mark((function t(r,n){var a,i,s,o,u,c,f,h,d,p,b,v,m,x=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=x.length>2&&void 0!==x[2]?x[2]:{},!(r>n)){t.next=3;break}return t.abrupt("return",this._readRefSeqs(r,2*n,a));case 3:return t.next=5,this.bam.read(e.alloc(n+O),0,n,0,a);case 5:if(i=t.sent,s=i.bytesRead,o=i.buffer,s){t.next=10;break}throw new Error("Error reading refseqs from header");case 10:return o=s<n?o.slice(0,s):o.slice(0,n),t.next=13,Object(y.unzip)(o);case 13:u=t.sent,c=u.readInt32LE(r),f=r+4,h={},d=[],p=0;case 19:if(!(p<c)){t.next=34;break}return t.next=22,Object(_.a)(a.signal);case 22:if(b=u.readInt32LE(f),v=this.renameRefSeq(u.toString("utf8",f+4,f+4+b-1)),m=u.readInt32LE(f+b+4),h[v]=p,d.push({refName:v,length:m}),!((f=f+8+b)>u.length)){t.next=31;break}return console.warn("BAM header is very big.  Re-fetching ".concat(n," bytes.")),t.abrupt("return",this._readRefSeqs(r,2*n,a));case 31:p+=1,t.next=19;break;case 34:return t.abrupt("return",{chrToIndex:h,indexToChr:d});case 35:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}()},{key:"getRecordsForRange",value:function(){var e=Object(a.a)(l.a.mark((function e(t,r,n){var a,i,s,o,u,c,h,d,p=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=p.length>3&&void 0!==p[3]?p[3]:{viewAsPairs:!1,pairAcrossChr:!1,maxInsertSize:2e5},i=[],s=!1,o=!1,e.prev=4,c=Object(f.a)(this.streamRecordsForRange(t,r,n,a));case 6:return e.next=8,c.next();case 8:if(!(s=!(h=e.sent).done)){e.next=14;break}d=h.value,i=i.concat(d);case 11:s=!1,e.next=6;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(4),o=!0,u=e.t0;case 20:if(e.prev=20,e.prev=21,!s||null==c.return){e.next=25;break}return e.next=25,c.return();case 25:if(e.prev=25,!o){e.next=28;break}throw u;case 28:return e.finish(25);case 29:return e.finish(20);case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,this,[[4,16,20,30],[21,,25,29]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"streamRecordsForRange",value:function(e,t,r){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(o.a)(l.a.mark((function i(){var s,o,h,d,p,b;return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=a.signal,(o=n.chrToIndex&&n.chrToIndex[e])>=0){i.next=6;break}h=[],i.next=11;break;case 6:return i.next=8,Object(u.a)(n.index.blocksForRange(o,t-1,r,a));case 8:if(h=i.sent){i.next=11;break}throw new Error("Error in index fetch");case 11:d=0;case 12:if(!(d<h.length)){i.next=21;break}return i.next=15,Object(u.a)(Object(_.a)(s));case 15:if(!((p=h[d].fetchedSize())>n.chunkSizeLimit)){i.next=18;break}throw new Error("Too many BAM features. BAM chunk size ".concat(p," bytes exceeds chunkSizeLimit of ").concat(n.chunkSizeLimit));case 18:d+=1,i.next=12;break;case 21:if(!((b=h.map((function(e){return e.fetchedSize()})).reduce((function(e,t){return e+t}),0))>n.fetchSizeLimit)){i.next=24;break}throw new Error("data size of ".concat(b.toLocaleString()," bytes exceeded fetch size limit of ").concat(n.fetchSizeLimit.toLocaleString()," bytes"));case 24:return i.delegateYield(Object(c.a)(Object(f.a)(n._fetchChunkFeatures(h,o,t,r,a)),u.a),"t0",25);case 25:case"end":return i.stop()}}),i)})))()}},{key:"_fetchChunkFeatures",value:function(e,t,r,n,a){var i=this;return Object(o.a)(l.a.mark((function s(){var o,c,f,h,d,p,b,v,y,m,x,k;return l.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:o=a.viewAsPairs,c=void 0!==o&&o,f=[],h=!1,d=0;case 4:if(!(d<e.length)){s.next=21;break}return s.next=7,Object(u.a)(i._readChunk({chunk:e[d],opts:a}));case 7:return p=s.sent,b=p.data,v=p.cpositions,y=p.dpositions,m=p.chunk,x=i.readBamFeatures(b,v,y,m).then((function(e){for(var a=[],i=0;i<e.length;i+=1){var s=e[i];if(s.seq_id()===t){if(s.get("start")>=n){h=!0;break}s.get("end")>=r&&a.push(s)}}return a})),f.push(x),s.next=16,Object(u.a)(x);case 16:if(!h){s.next=18;break}return s.abrupt("break",21);case 18:d++,s.next=4;break;case 21:Object(_.b)(a.signal),k=0;case 23:if(!(k<f.length)){s.next=29;break}return s.next=26,f[k];case 26:k++,s.next=23;break;case 29:if(Object(_.b)(a.signal),!c){s.next=33;break}return s.next=33,i.fetchPairs(t,f,a);case 33:case"end":return s.stop()}}),s)})))()}},{key:"fetchPairs",value:function(){var e=Object(a.a)(l.a.mark((function e(t,r,i){var s,o,u,c,f,h,d,p,b,v,y,m,k,g,w,_=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.pairAcrossChr,o=void 0!==s&&s,u=i.maxInsertSize,c=void 0===u?2e5:u,f={},h={},e.next=5,Promise.all(r.map(function(){var e=Object(a.a)(l.a.mark((function e(t){var r,a,i,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:for(r=e.sent,a={},i=0;i<r.length;i++)s=r[i].name(),o=r[i].id(),a[s]||(a[s]=0),a[s]++,h[o]=1;x()(a).forEach((function(e){var t=Object(n.a)(e,2),r=t[0];1===t[1]&&(f[r]=!0)}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return d=[],e.next=8,Promise.all(r.map(function(){var e=Object(a.a)(l.a.mark((function e(r){var n,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r;case 2:for(n=e.sent,a=0;a<n.length;a++)s=n[a].name(),f[s]&&(o||n[a]._next_refid()===t&&Math.abs(n[a].get("start")-n[a]._next_pos())<c)&&d.push(_.index.blocksForRange(n[a]._next_refid(),n[a]._next_pos(),n[a]._next_pos()+1,i));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,Promise.all(d);case 10:for(p=e.sent,b=[],v=0;v<p.length;v++)b=b.concat(p[v]);if(b=b.sort().filter((function(e,t,r){return!t||e.toString()!==r[t-1].toString()})),!((y=b.map((function(e){return e.fetchedSize()})).reduce((function(e,t){return e+t}),0))>this.fetchSizeLimit)){e.next=17;break}throw new Error("data size of ".concat(y.toLocaleString()," bytes exceeded fetch size limit of ").concat(this.fetchSizeLimit.toLocaleString()," bytes"));case 17:return m=b.map(function(){var e=Object(a.a)(l.a.mark((function e(t){var r,n,a,s,o,u,c,d,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_._readChunk({chunk:t,opts:i});case 2:return r=e.sent,n=r.data,a=r.cpositions,s=r.dpositions,o=r.chunk,e.next=9,_.readBamFeatures(n,a,s,o);case 9:for(u=e.sent,c=[],d=0;d<u.length;d+=1)p=u[d],f[p.get("name")]&&!h[p.id()]&&c.push(p);return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=20,Promise.all(m);case 20:return k=e.sent,g=[],k.length&&(w=k.reduce((function(e,t){return e.concat(t)})),g=g.concat(w)),e.abrupt("return",g);case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_readChunk",value:function(){var t=Object(a.a)(l.a.mark((function t(r){var n,a,i,s,o,u,c,f,h,d,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.chunk,a=r.opts,i=a.signal,s=n.fetchedSize(),t.next=5,this.bam.read(e.alloc(s),0,s,n.minv.blockPosition,a);case 5:return o=t.sent,u=o.bytesRead,c=o.buffer,Object(_.b)(i),c=u<s?c.slice(0,u):c.slice(0,s),t.next=12,Object(y.unzipChunkSlice)(c,n);case 12:return f=t.sent,h=f.buffer,d=f.cpositions,p=f.dpositions,Object(_.b)(i),t.abrupt("return",{data:h,cpositions:d,dpositions:p,chunk:n});case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"readBamFeatures",value:function(){var e=Object(a.a)(l.a.mark((function e(t,r,n,a){var i,s,o,u,c,f,h;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,s=[],o=0,u=+Date.now();case 4:if(!(i+4<t.length)){e.next=18;break}if(c=t.readInt32LE(i),f=i+4+c-1,n){for(;i+a.minv.dataPosition>=n[o++];);o--}if(!(f<t.length)){e.next=15;break}if(h=new g.a({bytes:{byteArray:t,start:i,end:f},fileOffset:r?256*r[o]+(i-n[o])+a.minv.dataPosition+1:v.a.signed(t.slice(i,f))}),s.push(h),!(this.yieldThreadTime&&+Date.now()-u>this.yieldThreadTime)){e.next=15;break}return e.next=14,Object(_.f)(1);case 14:u=+Date.now();case 15:i=f+1,e.next=4;break;case 18:return e.abrupt("return",s);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=Object(a.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.hasRefSeq(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lineCount",value:function(){var e=Object(a.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.lineCount(r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexCov",value:function(){var e=Object(a.a)(l.a.mark((function e(t,r,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.index.parse();case 2:return a=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.indexCov(a,r,n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"blocksForRange",value:function(){var e=Object(a.a)(l.a.mark((function e(t,r,n,a){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.index.parse();case 2:return i=this.chrToIndex&&this.chrToIndex[t],e.abrupt("return",this.index.blocksForRange(i,r,n,a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()}]),t}()}).call(this,r(99).Buffer)},607:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return u}));var n=r(81),a=r(11),i=r(1436),s="=ACMGRSVTWYHKDBN".split("").map((function(e){return e.charCodeAt(0)})),o="MIDNSHP=X???????".split(""),u=function(){function t(e){Object(n.a)(this,t),this._tagOffset=void 0,this._tagList=[],this._allTagsParsed=!1,this.data={},this.bytes={start:e.bytes.start,end:e.bytes.end,byteArray:e.bytes.byteArray},this._id=e.fileOffset;var r=this.bytes,a=r.start,i=r.byteArray;this._refID=i.readInt32LE(a+4),this.data.start=i.readInt32LE(a+8),this.flags=(4294901760&i.readInt32LE(a+16))>>16}return Object(a.a)(t,[{key:"get",value:function(e){return this[e]?(this.data[e]||(this.data[e]=this[e]()),this.data[e]):this._get(e.toLowerCase())}},{key:"end",value:function(){return this.get("start")+(this.get("length_on_ref")||this.get("seq_length")||void 0)}},{key:"seq_id",value:function(){return this._refID}},{key:"_get",value:function(e){return e in this.data||(this.data[e]=this._parseTag(e)),this.data[e]}},{key:"_tags",value:function(){var e=this;this._parseAllTags();var t=["seq"];this.isSegmentUnmapped()||t.push("start","end","strand","score","qual","MQ","CIGAR","length_on_ref","template_length"),this.isPaired()&&t.push("next_segment_position","pair_orientation"),t=t.concat(this._tagList||[]),Object.keys(this.data).forEach((function(e){"_"!==e[0]&&"next_seq_id"!==e&&t.push(e)}));var r={};return t=t.filter((function(t){if(t in e.data&&void 0===e.data[t]||"CG"===t||"cg"===t)return!1;var n=t.toLowerCase(),a=r[n];return r[n]=!0,!a}))}},{key:"parent",value:function(){}},{key:"children",value:function(){return this.get("subfeatures")}},{key:"id",value:function(){return this._id}},{key:"mq",value:function(){var e=(65280&this.get("_bin_mq_nl"))>>8;return 255===e?void 0:e}},{key:"score",value:function(){return this.get("mq")}},{key:"qual",value:function(){var e;return null===(e=this.qualRaw())||void 0===e?void 0:e.join(" ")}},{key:"qualRaw",value:function(){if(!this.isSegmentUnmapped()){for(var t=this.bytes.byteArray,r=this.bytes.start+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes"),n=this.get("seq_length"),a=e.allocUnsafe(n),i=0;i<n;++i)a[i]=t[r+i];return a}}},{key:"strand",value:function(){return this.isReverseComplemented()?-1:1}},{key:"multi_segment_next_segment_strand",value:function(){if(!this.isMateUnmapped())return this.isMateReverseComplemented()?-1:1}},{key:"name",value:function(){return this.get("_read_name")}},{key:"_read_name",value:function(){var e=this.get("_l_read_name");return this.bytes.byteArray.toString("ascii",this.bytes.start+36,this.bytes.start+36+e-1)}},{key:"_parseTag",value:function(e){if(!this._allTagsParsed){for(var t,r=this.bytes.byteArray,n=this._tagOffset||this.bytes.start+36+this.get("_l_read_name")+4*this.get("_n_cigar_op")+this.get("_seq_bytes")+this.get("seq_length"),a=this.bytes.end;n<a&&t!==e;){var i=String.fromCharCode(r[n],r[n+1]);t=i.toLowerCase();var s=String.fromCharCode(r[n+2]);n+=3;var u=void 0;switch(s){case"A":u=String.fromCharCode(r[n]),n+=1;break;case"i":u=r.readInt32LE(n),n+=4;break;case"I":u=r.readUInt32LE(n),n+=4;break;case"c":u=r.readInt8(n),n+=1;break;case"C":u=r.readUInt8(n),n+=1;break;case"s":u=r.readInt16LE(n),n+=2;break;case"S":u=r.readUInt16LE(n),n+=2;break;case"f":u=r.readFloatLE(n),n+=4;break;case"Z":case"H":for(u="";n<=a;){var c=r[n++];if(0===c)break;u+=String.fromCharCode(c)}break;case"B":u="";var f=r[n++],h=String.fromCharCode(f),l=r.readInt32LE(n);if(n+=4,"i"===h)if("CG"===i)for(var d=0;d<l;d++){var p=r.readInt32LE(n);u+=(p>>4)+o[15&p],n+=4}else for(var b=0;b<l;b++)u+=r.readInt32LE(n),b+1<l&&(u+=","),n+=4;if("I"===h)if("CG"===i)for(var v=0;v<l;v++){var y=r.readUInt32LE(n);u+=(y>>4)+o[15&y],n+=4}else for(var m=0;m<l;m++)u+=r.readUInt32LE(n),m+1<l&&(u+=","),n+=4;if("s"===h)for(var x=0;x<l;x++)u+=r.readInt16LE(n),x+1<l&&(u+=","),n+=2;if("S"===h)for(var k=0;k<l;k++)u+=r.readUInt16LE(n),k+1<l&&(u+=","),n+=2;if("c"===h)for(var g=0;g<l;g++)u+=r.readInt8(n),g+1<l&&(u+=","),n+=1;if("C"===h)for(var w=0;w<l;w++)u+=r.readUInt8(n),w+1<l&&(u+=","),n+=1;if("f"===h)for(var _=0;_<l;_++)u+=r.readFloatLE(n),_+1<l&&(u+=","),n+=4;break;default:console.warn("Unknown BAM tag type '".concat(s,"', tags may be incomplete")),u=void 0,n=a}if(this._tagOffset=n,this._tagList.push(i),t===e)return u;this.data[t]=u}this._allTagsParsed=!0}}},{key:"_parseAllTags",value:function(){this._parseTag("")}},{key:"_parseCigar",value:function(e){return e.match(/\d+\D/g).map((function(e){return[e.match(/\D/)[0].toUpperCase(),parseInt(e,10)]}))}},{key:"isPaired",value:function(){return!!(this.flags&i.a.BAM_FPAIRED)}},{key:"isProperlyPaired",value:function(){return!!(this.flags&i.a.BAM_FPROPER_PAIR)}},{key:"isSegmentUnmapped",value:function(){return!!(this.flags&i.a.BAM_FUNMAP)}},{key:"isMateUnmapped",value:function(){return!!(this.flags&i.a.BAM_FMUNMAP)}},{key:"isReverseComplemented",value:function(){return!!(this.flags&i.a.BAM_FREVERSE)}},{key:"isMateReverseComplemented",value:function(){return!!(this.flags&i.a.BAM_FMREVERSE)}},{key:"isRead1",value:function(){return!!(this.flags&i.a.BAM_FREAD1)}},{key:"isRead2",value:function(){return!!(this.flags&i.a.BAM_FREAD2)}},{key:"isSecondary",value:function(){return!!(this.flags&i.a.BAM_FSECONDARY)}},{key:"isFailedQc",value:function(){return!!(this.flags&i.a.BAM_FQCFAIL)}},{key:"isDuplicate",value:function(){return!!(this.flags&i.a.BAM_FDUP)}},{key:"isSupplementary",value:function(){return!!(this.flags&i.a.BAM_FSUPPLEMENTARY)}},{key:"cigar",value:function(){if(!this.isSegmentUnmapped()){var e=this.bytes,t=e.byteArray,r=e.start,n=this.get("_n_cigar_op"),a=r+36+this.get("_l_read_name"),i=this.get("seq_length"),s="",u=0,c=t.readInt32LE(a),f=c>>4,h=o[15&c];if("S"===h&&f===i)return a+=4,f=(c=t.readInt32LE(a))>>4,"N"!==(h=o[15&c])&&console.warn("CG tag with no N tag"),this.data.length_on_ref=f,this.get("CG");for(var l=0;l<n;++l)s+=(f=(c=t.readInt32LE(a))>>4)+(h=o[15&c]),"H"!==h&&"S"!==h&&"I"!==h&&(u+=f),a+=4;return this.data.length_on_ref=u,s}}},{key:"_flags",value:function(){}},{key:"length_on_ref",value:function(){return this.get("cigar"),this.data.length_on_ref}},{key:"_n_cigar_op",value:function(){return 65535&this.get("_flag_nc")}},{key:"_l_read_name",value:function(){return 255&this.get("_bin_mq_nl")}},{key:"_seq_bytes",value:function(){return this.get("seq_length")+1>>1}},{key:"getReadBases",value:function(){return this.seq()}},{key:"seq",value:function(){for(var e=this.bytes.byteArray,t=this.bytes.start+36+this.get("_l_read_name")+4*this.get("_n_cigar_op"),r=this.get("_seq_bytes"),n=this.get("seq_length"),a="",i=0,o=0;o<r;++o){var u=e[t+o];a+=String.fromCharCode(s[(240&u)>>4]),++i<n&&(a+=String.fromCharCode(s[15&u]),i++)}return a}},{key:"getPairOrientation",value:function(){if(!this.isSegmentUnmapped()&&!this.isMateUnmapped()&&this._refID===this._next_refid()){var e=this.isReverseComplemented()?"R":"F",t=this.isMateReverseComplemented()?"R":"F",r=" ",n=" ";this.isRead1()?(r="1",n="2"):this.isRead2()&&(r="2",n="1");var a=[];return this.template_length()>0?(a[0]=e,a[1]=r,a[2]=t,a[3]=n):(a[2]=e,a[3]=r,a[0]=t,a[1]=n),a.join("")}return null}},{key:"_bin_mq_nl",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+12)}},{key:"_flag_nc",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+16)}},{key:"seq_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+20)}},{key:"_next_refid",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+24)}},{key:"_next_pos",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+28)}},{key:"template_length",value:function(){return this.bytes.byteArray.readInt32LE(this.bytes.start+32)}},{key:"toJSON",value:function(){var e=this,t={};return Object.keys(this).forEach((function(r){"_"!==r.charAt(0)&&"bytes"!==r&&(t[r]=e[r])})),t}}]),t}()}).call(this,r(99).Buffer)},900:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));var n=r(81),a=r(11),i=function(){function e(t,r){Object(n.a)(this,e),this.blockPosition=t,this.dataPosition=r}return Object(a.a)(e,[{key:"toString",value:function(){return"".concat(this.blockPosition,":").concat(this.dataPosition)}},{key:"compareTo",value:function(e){return this.blockPosition-e.blockPosition||this.dataPosition-e.dataPosition}}],[{key:"min",value:function(){for(var e,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(;!e;t+=1)e=n[t];for(;t<n.length;t+=1)e.compareTo(n[t])>0&&(e=n[t]);return e}}]),e}();function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r)throw new Error("big-endian virtual file offsets not implemented");return new i(1099511627776*e[t+7]+4294967296*e[t+6]+16777216*e[t+5]+65536*e[t+4]+256*e[t+3]+e[t+2],e[t+1]<<8|e[t])}},901:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(81),a=r(11),i=function(){function e(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;Object(n.a)(this,e),this.minv=t,this.maxv=r,this.bin=a,this._fetchedSize=i}return Object(a.a)(e,[{key:"toUniqueString",value:function(){return"".concat(this.minv,"..").concat(this.maxv," (bin ").concat(this.bin,", fetchedSize ").concat(this.fetchedSize(),")")}},{key:"toString",value:function(){return this.toUniqueString()}},{key:"compareTo",value:function(e){return this.minv.compareTo(e.minv)||this.maxv.compareTo(e.maxv)||this.bin-e.bin}},{key:"fetchedSize",value:function(){return void 0!==this._fetchedSize?this._fetchedSize:this.maxv.blockPosition+65536-this.minv.blockPosition}}]),e}()},902:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(82),a=r(81),i=r(11),s=r(80),o=r.n(s),u=function(){function e(t){var r=t.filehandle,n=t.renameRefSeq,i=void 0===n?function(e){return e}:n;Object(a.a)(this,e),this.filehandle=r,this.renameRefSeq=i}return Object(i.a)(e,[{key:"_findFirstData",value:function(e,t){var r=e.firstDataLine;e.firstDataLine=r?r.compareTo(t)>0?t:r:t}},{key:"parse",value:function(){var e=Object(n.a)(o.a.mark((function e(){var t,r=this,n=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},this.setupP||(this.setupP=this._parse(t).catch((function(e){throw r.setupP=void 0,e}))),e.abrupt("return",this.setupP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasRefSeq",value:function(){var e=Object(n.a)(o.a.mark((function e(t){var r,n=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,this.parse(r);case 3:if(e.t1=t,e.t0=e.sent.indices[e.t1],e.t0){e.next=7;break}e.t0={};case 7:return e.abrupt("return",!!e.t0.binIndex);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},903:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(29),a=r(232);function i(e){var t=e.split(/\r?\n/),r=[];return t.forEach((function(e){var t=e.split(/\t/),i=Object(a.a)(t),s=i[0],o=i.slice(1).map((function(e){var t=e.split(":",2),r=Object(n.a)(t,2);return{tag:r[0],value:r[1]}}));s&&r.push({tag:s.substr(1),data:o})})),r}},904:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return w}));var n=r(2),a=r(86),i=r(81),s=r(11),o=r(88),u=r(89),c=r(82),f=r(297),h=r(291),l=r(261),d=r(363),p=r(80),b=r.n(p),v=r(606),y=(r(1437),r(176)),m=r(903),x=["referer"];function k(e,t){return g.apply(this,arguments)}function g(){return g=Object(c.a)(b.a.mark((function t(r,i){var s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(r.map(function(){var t=Object(c.a)(b.a.mark((function t(r){var s,o,u,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=r.url,o=r.headers,!s.startsWith("data:")){t.next=5;break}return t.abrupt("return",e.from(s.split(",")[1],"base64"));case 5:return o.referer,u=Object(n.a)(o,x),t.next=8,fetch(s,Object(a.a)(Object(a.a)({},i),{},{headers:Object(a.a)(Object(a.a)({},i.headers),u)}));case 8:if((c=t.sent).ok){t.next=11;break}throw new Error("Failed to fetch ".concat(c.statusText));case 11:return t.t0=e,t.next=14,c.arrayBuffer();case 14:return t.t1=t.sent,t.abrupt("return",t.t0.from.call(t.t0,t.t1));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:return s=t.sent,t.t0=e,t.next=6,Promise.all(s.map((function(e){return Object(y.unzip)(e)})));case 6:return t.t1=t.sent,t.abrupt("return",t.t0.concat.call(t.t0,t.t1));case 8:case"end":return t.stop()}}),t)}))),g.apply(this,arguments)}var w=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,{bamFilehandle:"?",baiFilehandle:"?"})).baseUrl=e.baseUrl,n.trackId=e.trackId,n}return Object(s.a)(r,[{key:"streamRecordsForRange",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{viewAsPairs:!1,pairAcrossChr:!1,maxInsertSize:2e5};return Object(f.a)(b.a.mark((function s(){var o,u,c,f,p,v,y;return b.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o="".concat(n.baseUrl,"/").concat(n.trackId),u="".concat(o,"?referenceName=").concat(e,"&start=").concat(t,"&end=").concat(r,"&format=BAM"),c=n.chrToIndex&&n.chrToIndex[e],s.next=5,Object(h.a)(fetch(u,Object(a.a)({},i)));case 5:if((f=s.sent).ok){s.next=8;break}throw new Error(f.statusText);case 8:return s.next=10,Object(h.a)(f.json());case 10:return p=s.sent,s.next=13,Object(h.a)(k(p.htsget.urls.slice(1),i));case 13:return v=s.sent,y={buffer:v,chunk:{minv:{dataPosition:0}},toString:function(){return"".concat(e,"_").concat(t,"_").concat(r)}},s.delegateYield(Object(d.a)(Object(l.a)(n._fetchChunkFeatures([y],c,t,r,i)),h.a),"t0",16);case 16:case"end":return s.stop()}}),s)})))()}},{key:"_readChunk",value:function(){var e=Object(c.a)(b.a.mark((function e(t){var r,n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.chunk,n=r.buffer,a=r.chunk,e.abrupt("return",{data:n,cpositions:null,dpositions:null,chunk:a});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHeader",value:function(){var e=Object(c.a)(b.a.mark((function e(){var t,r,n,a,i,s,o,u,c,f,h=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:{},r="".concat(this.baseUrl,"/").concat(this.trackId,"?referenceName=na&class=header"),e.next=4,fetch(r,t);case 4:if((n=e.sent).ok){e.next=7;break}throw new Error("Failed to fetch ".concat(n.statusText));case 7:return e.next=9,n.json();case 9:return a=e.sent,e.next=12,k(a.htsget.urls,t);case 12:if((i=e.sent).readInt32LE(0)===v.a){e.next=15;break}throw new Error("Not a BAM file");case 15:return s=i.readInt32LE(4),o=i.toString("utf8",8,8+s),u=Object(m.a)(o),c=[],f={},u.filter((function(e){return"SQ"===e.tag})).forEach((function(e,t){e.data.forEach((function(e){if("SN"===e.tag){var r=e.value;f[r]=t,c[t]=r}}))})),this.chrToIndex=f,this.indexToChr=c,e.abrupt("return",u);case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(v.b)}).call(this,r(99).Buffer)}}]);
//# sourceMappingURL=6.75e0d234.chunk.js.map